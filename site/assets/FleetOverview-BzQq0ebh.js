var JC=Object.defineProperty;var QC=(m,g,l)=>g in m?JC(m,g,{enumerable:!0,configurable:!0,writable:!0,value:l}):m[g]=l;var Li=(m,g,l)=>QC(m,typeof g!="symbol"?g+"":g,l);import{g as t_,e as eA,c as tA,a as a0,r as Ke,R as px,j as gi,f as Qt,h as iA,i as qw,u as rA,k as nA}from"./index-DcHVG-ns.js";import{L as sA}from"./Loading-BaoT7n4K.js";var Lx=eA();const oA=t_(Lx);/**
 * @license lucide-react v0.485.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aA=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],lA=tA("funnel",aA),cA=async(m,g,l)=>(await a0.get("/VesselCargoDelivered",{params:{VesseID:m,dtStart:`${g} 00:00`,DtEnd:`${l} 23:59`}})).data,uA=async(m,g,l)=>(await a0.get("/VesselCIIGraph",{params:{VesseID:m,dtStart:g,DtEnd:l}})).data,hA=async(m,g,l)=>(await a0.get("/VesselDistance",{params:{VesseID:m,dtStart:g,DtEnd:l}})).data,dA=async m=>{const{vesselId:g,fromDate:l,toDate:c}=m;return(await a0.get("/VesselVoyageRoutes",{params:{VesseID:g,dtStart:l,DtEnd:c}})).data};function cf(m){"@babel/helpers - typeof";return cf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},cf(m)}function pA(m,g){if(cf(m)!="object"||!m)return m;var l=m[Symbol.toPrimitive];if(l!==void 0){var c=l.call(m,g);if(cf(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(m)}function jT(m){var g=pA(m,"string");return cf(g)=="symbol"?g:g+""}function Vg(m,g,l){return(g=jT(g))in m?Object.defineProperty(m,g,{value:l,enumerable:!0,configurable:!0,writable:!0}):m[g]=l,m}function Yw(m,g){var l=Object.keys(m);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(m);g&&(c=c.filter(function(_){return Object.getOwnPropertyDescriptor(m,_).enumerable})),l.push.apply(l,c)}return l}function vr(m){for(var g=1;g<arguments.length;g++){var l=arguments[g]!=null?arguments[g]:{};g%2?Yw(Object(l),!0).forEach(function(c){Vg(m,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(l)):Yw(Object(l)).forEach(function(c){Object.defineProperty(m,c,Object.getOwnPropertyDescriptor(l,c))})}return m}function fA(m){if(Array.isArray(m))return m}function mA(m,g){var l=m==null?null:typeof Symbol<"u"&&m[Symbol.iterator]||m["@@iterator"];if(l!=null){var c,_,A,N,r=[],q=!0,ie=!1;try{if(A=(l=l.call(m)).next,g===0){if(Object(l)!==l)return;q=!1}else for(;!(q=(c=A.call(l)).done)&&(r.push(c.value),r.length!==g);q=!0);}catch(ae){ie=!0,_=ae}finally{try{if(!q&&l.return!=null&&(N=l.return(),Object(N)!==N))return}finally{if(ie)throw _}}return r}}function fx(m,g){(g==null||g>m.length)&&(g=m.length);for(var l=0,c=Array(g);l<g;l++)c[l]=m[l];return c}function $T(m,g){if(m){if(typeof m=="string")return fx(m,g);var l={}.toString.call(m).slice(8,-1);return l==="Object"&&m.constructor&&(l=m.constructor.name),l==="Map"||l==="Set"?Array.from(m):l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?fx(m,g):void 0}}function gA(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Eh(m,g){return fA(m)||mA(m,g)||$T(m,g)||gA()}function GT(m,g){if(m==null)return{};var l={};for(var c in m)if({}.hasOwnProperty.call(m,c)){if(g.indexOf(c)!==-1)continue;l[c]=m[c]}return l}function Lh(m,g){if(m==null)return{};var l,c,_=GT(m,g);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(m);for(c=0;c<A.length;c++)l=A[c],g.indexOf(l)===-1&&{}.propertyIsEnumerable.call(m,l)&&(_[l]=m[l])}return _}var _A=["defaultInputValue","defaultMenuIsOpen","defaultValue","inputValue","menuIsOpen","onChange","onInputChange","onMenuClose","onMenuOpen","value"];function yA(m){var g=m.defaultInputValue,l=g===void 0?"":g,c=m.defaultMenuIsOpen,_=c===void 0?!1:c,A=m.defaultValue,N=A===void 0?null:A,r=m.inputValue,q=m.menuIsOpen,ie=m.onChange,ae=m.onInputChange,he=m.onMenuClose,ve=m.onMenuOpen,Ae=m.value,we=Lh(m,_A),Pe=Ke.useState(r!==void 0?r:l),Ve=Eh(Pe,2),We=Ve[0],rt=Ve[1],ht=Ke.useState(q!==void 0?q:_),tt=Eh(ht,2),at=tt[0],Rt=tt[1],Ne=Ke.useState(Ae!==void 0?Ae:N),Tt=Eh(Ne,2),qt=Tt[0],Te=Tt[1],gt=Ke.useCallback(function(Yt,jt){typeof ie=="function"&&ie(Yt,jt),Te(Yt)},[ie]),oi=Ke.useCallback(function(Yt,jt){var Ri;typeof ae=="function"&&(Ri=ae(Yt,jt)),rt(Ri!==void 0?Ri:Yt)},[ae]),Ti=Ke.useCallback(function(){typeof ve=="function"&&ve(),Rt(!0)},[ve]),ni=Ke.useCallback(function(){typeof he=="function"&&he(),Rt(!1)},[he]),Mt=r!==void 0?r:We,zt=q!==void 0?q:at,ii=Ae!==void 0?Ae:qt;return vr(vr({},we),{},{inputValue:Mt,menuIsOpen:zt,onChange:gt,onInputChange:oi,onMenuClose:ni,onMenuOpen:Ti,value:ii})}function yr(){return yr=Object.assign?Object.assign.bind():function(m){for(var g=1;g<arguments.length;g++){var l=arguments[g];for(var c in l)({}).hasOwnProperty.call(l,c)&&(m[c]=l[c])}return m},yr.apply(null,arguments)}function vA(m,g){if(!(m instanceof g))throw new TypeError("Cannot call a class as a function")}function Xw(m,g){for(var l=0;l<g.length;l++){var c=g[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(m,jT(c.key),c)}}function xA(m,g,l){return g&&Xw(m.prototype,g),l&&Xw(m,l),Object.defineProperty(m,"prototype",{writable:!1}),m}function Ny(m,g){return Ny=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,c){return l.__proto__=c,l},Ny(m,g)}function bA(m,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function");m.prototype=Object.create(g&&g.prototype,{constructor:{value:m,writable:!0,configurable:!0}}),Object.defineProperty(m,"prototype",{writable:!1}),g&&Ny(m,g)}function Vy(m){return Vy=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)},Vy(m)}function HT(){try{var m=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(HT=function(){return!!m})()}function WT(m){if(m===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m}function wA(m,g){if(g&&(cf(g)=="object"||typeof g=="function"))return g;if(g!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return WT(m)}function SA(m){var g=HT();return function(){var l,c=Vy(m);if(g){var _=Vy(this).constructor;l=Reflect.construct(c,arguments,_)}else l=c.apply(this,arguments);return wA(this,l)}}function TA(m){if(Array.isArray(m))return fx(m)}function MA(m){if(typeof Symbol<"u"&&m[Symbol.iterator]!=null||m["@@iterator"]!=null)return Array.from(m)}function EA(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rx(m){return TA(m)||MA(m)||$T(m)||EA()}function CA(m){if(m.sheet)return m.sheet;for(var g=0;g<document.styleSheets.length;g++)if(document.styleSheets[g].ownerNode===m)return document.styleSheets[g]}function AA(m){var g=document.createElement("style");return g.setAttribute("data-emotion",m.key),m.nonce!==void 0&&g.setAttribute("nonce",m.nonce),g.appendChild(document.createTextNode("")),g.setAttribute("data-s",""),g}var PA=function(){function m(l){var c=this;this._insertTag=function(_){var A;c.tags.length===0?c.insertionPoint?A=c.insertionPoint.nextSibling:c.prepend?A=c.container.firstChild:A=c.before:A=c.tags[c.tags.length-1].nextSibling,c.container.insertBefore(_,A),c.tags.push(_)},this.isSpeedy=l.speedy===void 0?!0:l.speedy,this.tags=[],this.ctr=0,this.nonce=l.nonce,this.key=l.key,this.container=l.container,this.prepend=l.prepend,this.insertionPoint=l.insertionPoint,this.before=null}var g=m.prototype;return g.hydrate=function(c){c.forEach(this._insertTag)},g.insert=function(c){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(AA(this));var _=this.tags[this.tags.length-1];if(this.isSpeedy){var A=CA(_);try{A.insertRule(c,A.cssRules.length)}catch{}}else _.appendChild(document.createTextNode(c));this.ctr++},g.flush=function(){this.tags.forEach(function(c){var _;return(_=c.parentNode)==null?void 0:_.removeChild(c)}),this.tags=[],this.ctr=0},m}(),ia="-ms-",Uy="-moz-",vn="-webkit-",qT="comm",zx="rule",Fx="decl",IA="@import",YT="@keyframes",DA="@layer",kA=Math.abs,l0=String.fromCharCode,OA=Object.assign;function LA(m,g){return Go(m,0)^45?(((g<<2^Go(m,0))<<2^Go(m,1))<<2^Go(m,2))<<2^Go(m,3):0}function XT(m){return m.trim()}function RA(m,g){return(m=g.exec(m))?m[0]:m}function xn(m,g,l){return m.replace(g,l)}function mx(m,g){return m.indexOf(g)}function Go(m,g){return m.charCodeAt(g)|0}function qg(m,g,l){return m.slice(g,l)}function ku(m){return m.length}function Bx(m){return m.length}function cy(m,g){return g.push(m),m}function zA(m,g){return m.map(g).join("")}var c0=1,Cm=1,ZT=0,ja=0,io=0,zm="";function u0(m,g,l,c,_,A,N){return{value:m,root:g,parent:l,type:c,props:_,children:A,line:c0,column:Cm,length:N,return:""}}function kg(m,g){return OA(u0("",null,null,"",null,null,0),m,{length:-m.length},g)}function FA(){return io}function BA(){return io=ja>0?Go(zm,--ja):0,Cm--,io===10&&(Cm=1,c0--),io}function cl(){return io=ja<ZT?Go(zm,ja++):0,Cm++,io===10&&(Cm=1,c0++),io}function Nu(){return Go(zm,ja)}function Sy(){return ja}function i_(m,g){return qg(zm,m,g)}function Yg(m){switch(m){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function KT(m){return c0=Cm=1,ZT=ku(zm=m),ja=0,[]}function JT(m){return zm="",m}function Ty(m){return XT(i_(ja-1,gx(m===91?m+2:m===40?m+1:m)))}function NA(m){for(;(io=Nu())&&io<33;)cl();return Yg(m)>2||Yg(io)>3?"":" "}function VA(m,g){for(;--g&&cl()&&!(io<48||io>102||io>57&&io<65||io>70&&io<97););return i_(m,Sy()+(g<6&&Nu()==32&&cl()==32))}function gx(m){for(;cl();)switch(io){case m:return ja;case 34:case 39:m!==34&&m!==39&&gx(io);break;case 40:m===41&&gx(m);break;case 92:cl();break}return ja}function UA(m,g){for(;cl()&&m+io!==57;)if(m+io===84&&Nu()===47)break;return"/*"+i_(g,ja-1)+"*"+l0(m===47?m:cl())}function jA(m){for(;!Yg(Nu());)cl();return i_(m,ja)}function $A(m){return JT(My("",null,null,null,[""],m=KT(m),0,[0],m))}function My(m,g,l,c,_,A,N,r,q){for(var ie=0,ae=0,he=N,ve=0,Ae=0,we=0,Pe=1,Ve=1,We=1,rt=0,ht="",tt=_,at=A,Rt=c,Ne=ht;Ve;)switch(we=rt,rt=cl()){case 40:if(we!=108&&Go(Ne,he-1)==58){mx(Ne+=xn(Ty(rt),"&","&\f"),"&\f")!=-1&&(We=-1);break}case 34:case 39:case 91:Ne+=Ty(rt);break;case 9:case 10:case 13:case 32:Ne+=NA(we);break;case 92:Ne+=VA(Sy()-1,7);continue;case 47:switch(Nu()){case 42:case 47:cy(GA(UA(cl(),Sy()),g,l),q);break;default:Ne+="/"}break;case 123*Pe:r[ie++]=ku(Ne)*We;case 125*Pe:case 59:case 0:switch(rt){case 0:case 125:Ve=0;case 59+ae:We==-1&&(Ne=xn(Ne,/\f/g,"")),Ae>0&&ku(Ne)-he&&cy(Ae>32?Kw(Ne+";",c,l,he-1):Kw(xn(Ne," ","")+";",c,l,he-2),q);break;case 59:Ne+=";";default:if(cy(Rt=Zw(Ne,g,l,ie,ae,_,r,ht,tt=[],at=[],he),A),rt===123)if(ae===0)My(Ne,g,Rt,Rt,tt,A,he,r,at);else switch(ve===99&&Go(Ne,3)===110?100:ve){case 100:case 108:case 109:case 115:My(m,Rt,Rt,c&&cy(Zw(m,Rt,Rt,0,0,_,r,ht,_,tt=[],he),at),_,at,he,r,c?tt:at);break;default:My(Ne,Rt,Rt,Rt,[""],at,0,r,at)}}ie=ae=Ae=0,Pe=We=1,ht=Ne="",he=N;break;case 58:he=1+ku(Ne),Ae=we;default:if(Pe<1){if(rt==123)--Pe;else if(rt==125&&Pe++==0&&BA()==125)continue}switch(Ne+=l0(rt),rt*Pe){case 38:We=ae>0?1:(Ne+="\f",-1);break;case 44:r[ie++]=(ku(Ne)-1)*We,We=1;break;case 64:Nu()===45&&(Ne+=Ty(cl())),ve=Nu(),ae=he=ku(ht=Ne+=jA(Sy())),rt++;break;case 45:we===45&&ku(Ne)==2&&(Pe=0)}}return A}function Zw(m,g,l,c,_,A,N,r,q,ie,ae){for(var he=_-1,ve=_===0?A:[""],Ae=Bx(ve),we=0,Pe=0,Ve=0;we<c;++we)for(var We=0,rt=qg(m,he+1,he=kA(Pe=N[we])),ht=m;We<Ae;++We)(ht=XT(Pe>0?ve[We]+" "+rt:xn(rt,/&\f/g,ve[We])))&&(q[Ve++]=ht);return u0(m,g,l,_===0?zx:r,q,ie,ae)}function GA(m,g,l){return u0(m,g,l,qT,l0(FA()),qg(m,2,-2),0)}function Kw(m,g,l,c){return u0(m,g,l,Fx,qg(m,0,c),qg(m,c+1,-1),c)}function Sm(m,g){for(var l="",c=Bx(m),_=0;_<c;_++)l+=g(m[_],_,m,g)||"";return l}function HA(m,g,l,c){switch(m.type){case DA:if(m.children.length)break;case IA:case Fx:return m.return=m.return||m.value;case qT:return"";case YT:return m.return=m.value+"{"+Sm(m.children,c)+"}";case zx:m.value=m.props.join(",")}return ku(l=Sm(m.children,c))?m.return=m.value+"{"+l+"}":""}function WA(m){var g=Bx(m);return function(l,c,_,A){for(var N="",r=0;r<g;r++)N+=m[r](l,c,_,A)||"";return N}}function qA(m){return function(g){g.root||(g=g.return)&&m(g)}}function QT(m){var g=Object.create(null);return function(l){return g[l]===void 0&&(g[l]=m(l)),g[l]}}var YA=function(g,l,c){for(var _=0,A=0;_=A,A=Nu(),_===38&&A===12&&(l[c]=1),!Yg(A);)cl();return i_(g,ja)},XA=function(g,l){var c=-1,_=44;do switch(Yg(_)){case 0:_===38&&Nu()===12&&(l[c]=1),g[c]+=YA(ja-1,l,c);break;case 2:g[c]+=Ty(_);break;case 4:if(_===44){g[++c]=Nu()===58?"&\f":"",l[c]=g[c].length;break}default:g[c]+=l0(_)}while(_=cl());return g},ZA=function(g,l){return JT(XA(KT(g),l))},Jw=new WeakMap,KA=function(g){if(!(g.type!=="rule"||!g.parent||g.length<1)){for(var l=g.value,c=g.parent,_=g.column===c.column&&g.line===c.line;c.type!=="rule";)if(c=c.parent,!c)return;if(!(g.props.length===1&&l.charCodeAt(0)!==58&&!Jw.get(c))&&!_){Jw.set(g,!0);for(var A=[],N=ZA(l,A),r=c.props,q=0,ie=0;q<N.length;q++)for(var ae=0;ae<r.length;ae++,ie++)g.props[ie]=A[q]?N[q].replace(/&\f/g,r[ae]):r[ae]+" "+N[q]}}},JA=function(g){if(g.type==="decl"){var l=g.value;l.charCodeAt(0)===108&&l.charCodeAt(2)===98&&(g.return="",g.value="")}};function e2(m,g){switch(LA(m,g)){case 5103:return vn+"print-"+m+m;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return vn+m+m;case 5349:case 4246:case 4810:case 6968:case 2756:return vn+m+Uy+m+ia+m+m;case 6828:case 4268:return vn+m+ia+m+m;case 6165:return vn+m+ia+"flex-"+m+m;case 5187:return vn+m+xn(m,/(\w+).+(:[^]+)/,vn+"box-$1$2"+ia+"flex-$1$2")+m;case 5443:return vn+m+ia+"flex-item-"+xn(m,/flex-|-self/,"")+m;case 4675:return vn+m+ia+"flex-line-pack"+xn(m,/align-content|flex-|-self/,"")+m;case 5548:return vn+m+ia+xn(m,"shrink","negative")+m;case 5292:return vn+m+ia+xn(m,"basis","preferred-size")+m;case 6060:return vn+"box-"+xn(m,"-grow","")+vn+m+ia+xn(m,"grow","positive")+m;case 4554:return vn+xn(m,/([^-])(transform)/g,"$1"+vn+"$2")+m;case 6187:return xn(xn(xn(m,/(zoom-|grab)/,vn+"$1"),/(image-set)/,vn+"$1"),m,"")+m;case 5495:case 3959:return xn(m,/(image-set\([^]*)/,vn+"$1$`$1");case 4968:return xn(xn(m,/(.+:)(flex-)?(.*)/,vn+"box-pack:$3"+ia+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+vn+m+m;case 4095:case 3583:case 4068:case 2532:return xn(m,/(.+)-inline(.+)/,vn+"$1$2")+m;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(ku(m)-1-g>6)switch(Go(m,g+1)){case 109:if(Go(m,g+4)!==45)break;case 102:return xn(m,/(.+:)(.+)-([^]+)/,"$1"+vn+"$2-$3$1"+Uy+(Go(m,g+3)==108?"$3":"$2-$3"))+m;case 115:return~mx(m,"stretch")?e2(xn(m,"stretch","fill-available"),g)+m:m}break;case 4949:if(Go(m,g+1)!==115)break;case 6444:switch(Go(m,ku(m)-3-(~mx(m,"!important")&&10))){case 107:return xn(m,":",":"+vn)+m;case 101:return xn(m,/(.+:)([^;!]+)(;|!.+)?/,"$1"+vn+(Go(m,14)===45?"inline-":"")+"box$3$1"+vn+"$2$3$1"+ia+"$2box$3")+m}break;case 5936:switch(Go(m,g+11)){case 114:return vn+m+ia+xn(m,/[svh]\w+-[tblr]{2}/,"tb")+m;case 108:return vn+m+ia+xn(m,/[svh]\w+-[tblr]{2}/,"tb-rl")+m;case 45:return vn+m+ia+xn(m,/[svh]\w+-[tblr]{2}/,"lr")+m}return vn+m+ia+m+m}return m}var QA=function(g,l,c,_){if(g.length>-1&&!g.return)switch(g.type){case Fx:g.return=e2(g.value,g.length);break;case YT:return Sm([kg(g,{value:xn(g.value,"@","@"+vn)})],_);case zx:if(g.length)return zA(g.props,function(A){switch(RA(A,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Sm([kg(g,{props:[xn(A,/:(read-\w+)/,":"+Uy+"$1")]})],_);case"::placeholder":return Sm([kg(g,{props:[xn(A,/:(plac\w+)/,":"+vn+"input-$1")]}),kg(g,{props:[xn(A,/:(plac\w+)/,":"+Uy+"$1")]}),kg(g,{props:[xn(A,/:(plac\w+)/,ia+"input-$1")]})],_)}return""})}},eP=[QA],tP=function(g){var l=g.key;if(l==="css"){var c=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(c,function(Pe){var Ve=Pe.getAttribute("data-emotion");Ve.indexOf(" ")!==-1&&(document.head.appendChild(Pe),Pe.setAttribute("data-s",""))})}var _=g.stylisPlugins||eP,A={},N,r=[];N=g.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+l+' "]'),function(Pe){for(var Ve=Pe.getAttribute("data-emotion").split(" "),We=1;We<Ve.length;We++)A[Ve[We]]=!0;r.push(Pe)});var q,ie=[KA,JA];{var ae,he=[HA,qA(function(Pe){ae.insert(Pe)})],ve=WA(ie.concat(_,he)),Ae=function(Ve){return Sm($A(Ve),ve)};q=function(Ve,We,rt,ht){ae=rt,Ae(Ve?Ve+"{"+We.styles+"}":We.styles),ht&&(we.inserted[We.name]=!0)}}var we={key:l,sheet:new PA({key:l,container:N,nonce:g.nonce,speedy:g.speedy,prepend:g.prepend,insertionPoint:g.insertionPoint}),nonce:g.nonce,inserted:A,registered:{},insert:q};return we.sheet.hydrate(r),we},Hv={exports:{}},Mn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qw;function iP(){if(Qw)return Mn;Qw=1;var m=typeof Symbol=="function"&&Symbol.for,g=m?Symbol.for("react.element"):60103,l=m?Symbol.for("react.portal"):60106,c=m?Symbol.for("react.fragment"):60107,_=m?Symbol.for("react.strict_mode"):60108,A=m?Symbol.for("react.profiler"):60114,N=m?Symbol.for("react.provider"):60109,r=m?Symbol.for("react.context"):60110,q=m?Symbol.for("react.async_mode"):60111,ie=m?Symbol.for("react.concurrent_mode"):60111,ae=m?Symbol.for("react.forward_ref"):60112,he=m?Symbol.for("react.suspense"):60113,ve=m?Symbol.for("react.suspense_list"):60120,Ae=m?Symbol.for("react.memo"):60115,we=m?Symbol.for("react.lazy"):60116,Pe=m?Symbol.for("react.block"):60121,Ve=m?Symbol.for("react.fundamental"):60117,We=m?Symbol.for("react.responder"):60118,rt=m?Symbol.for("react.scope"):60119;function ht(at){if(typeof at=="object"&&at!==null){var Rt=at.$$typeof;switch(Rt){case g:switch(at=at.type,at){case q:case ie:case c:case A:case _:case he:return at;default:switch(at=at&&at.$$typeof,at){case r:case ae:case we:case Ae:case N:return at;default:return Rt}}case l:return Rt}}}function tt(at){return ht(at)===ie}return Mn.AsyncMode=q,Mn.ConcurrentMode=ie,Mn.ContextConsumer=r,Mn.ContextProvider=N,Mn.Element=g,Mn.ForwardRef=ae,Mn.Fragment=c,Mn.Lazy=we,Mn.Memo=Ae,Mn.Portal=l,Mn.Profiler=A,Mn.StrictMode=_,Mn.Suspense=he,Mn.isAsyncMode=function(at){return tt(at)||ht(at)===q},Mn.isConcurrentMode=tt,Mn.isContextConsumer=function(at){return ht(at)===r},Mn.isContextProvider=function(at){return ht(at)===N},Mn.isElement=function(at){return typeof at=="object"&&at!==null&&at.$$typeof===g},Mn.isForwardRef=function(at){return ht(at)===ae},Mn.isFragment=function(at){return ht(at)===c},Mn.isLazy=function(at){return ht(at)===we},Mn.isMemo=function(at){return ht(at)===Ae},Mn.isPortal=function(at){return ht(at)===l},Mn.isProfiler=function(at){return ht(at)===A},Mn.isStrictMode=function(at){return ht(at)===_},Mn.isSuspense=function(at){return ht(at)===he},Mn.isValidElementType=function(at){return typeof at=="string"||typeof at=="function"||at===c||at===ie||at===A||at===_||at===he||at===ve||typeof at=="object"&&at!==null&&(at.$$typeof===we||at.$$typeof===Ae||at.$$typeof===N||at.$$typeof===r||at.$$typeof===ae||at.$$typeof===Ve||at.$$typeof===We||at.$$typeof===rt||at.$$typeof===Pe)},Mn.typeOf=ht,Mn}var eS;function rP(){return eS||(eS=1,Hv.exports=iP()),Hv.exports}var Wv,tS;function nP(){if(tS)return Wv;tS=1;var m=rP(),g={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},l={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},c={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},_={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},A={};A[m.ForwardRef]=c,A[m.Memo]=_;function N(we){return m.isMemo(we)?_:A[we.$$typeof]||g}var r=Object.defineProperty,q=Object.getOwnPropertyNames,ie=Object.getOwnPropertySymbols,ae=Object.getOwnPropertyDescriptor,he=Object.getPrototypeOf,ve=Object.prototype;function Ae(we,Pe,Ve){if(typeof Pe!="string"){if(ve){var We=he(Pe);We&&We!==ve&&Ae(we,We,Ve)}var rt=q(Pe);ie&&(rt=rt.concat(ie(Pe)));for(var ht=N(we),tt=N(Pe),at=0;at<rt.length;++at){var Rt=rt[at];if(!l[Rt]&&!(Ve&&Ve[Rt])&&!(tt&&tt[Rt])&&!(ht&&ht[Rt])){var Ne=ae(Pe,Rt);try{r(we,Rt,Ne)}catch{}}}}return we}return Wv=Ae,Wv}nP();var sP=!0;function t2(m,g,l){var c="";return l.split(" ").forEach(function(_){m[_]!==void 0?g.push(m[_]+";"):_&&(c+=_+" ")}),c}var Nx=function(g,l,c){var _=g.key+"-"+l.name;(c===!1||sP===!1)&&g.registered[_]===void 0&&(g.registered[_]=l.styles)},i2=function(g,l,c){Nx(g,l,c);var _=g.key+"-"+l.name;if(g.inserted[l.name]===void 0){var A=l;do g.insert(l===A?"."+_:"",A,g.sheet,!0),A=A.next;while(A!==void 0)}};function oP(m){for(var g=0,l,c=0,_=m.length;_>=4;++c,_-=4)l=m.charCodeAt(c)&255|(m.charCodeAt(++c)&255)<<8|(m.charCodeAt(++c)&255)<<16|(m.charCodeAt(++c)&255)<<24,l=(l&65535)*1540483477+((l>>>16)*59797<<16),l^=l>>>24,g=(l&65535)*1540483477+((l>>>16)*59797<<16)^(g&65535)*1540483477+((g>>>16)*59797<<16);switch(_){case 3:g^=(m.charCodeAt(c+2)&255)<<16;case 2:g^=(m.charCodeAt(c+1)&255)<<8;case 1:g^=m.charCodeAt(c)&255,g=(g&65535)*1540483477+((g>>>16)*59797<<16)}return g^=g>>>13,g=(g&65535)*1540483477+((g>>>16)*59797<<16),((g^g>>>15)>>>0).toString(36)}var aP={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},lP=/[A-Z]|^ms/g,cP=/_EMO_([^_]+?)_([^]*?)_EMO_/g,r2=function(g){return g.charCodeAt(1)===45},iS=function(g){return g!=null&&typeof g!="boolean"},qv=QT(function(m){return r2(m)?m:m.replace(lP,"-$&").toLowerCase()}),rS=function(g,l){switch(g){case"animation":case"animationName":if(typeof l=="string")return l.replace(cP,function(c,_,A){return Ou={name:_,styles:A,next:Ou},_})}return aP[g]!==1&&!r2(g)&&typeof l=="number"&&l!==0?l+"px":l};function Xg(m,g,l){if(l==null)return"";var c=l;if(c.__emotion_styles!==void 0)return c;switch(typeof l){case"boolean":return"";case"object":{var _=l;if(_.anim===1)return Ou={name:_.name,styles:_.styles,next:Ou},_.name;var A=l;if(A.styles!==void 0){var N=A.next;if(N!==void 0)for(;N!==void 0;)Ou={name:N.name,styles:N.styles,next:Ou},N=N.next;var r=A.styles+";";return r}return uP(m,g,l)}case"function":{if(m!==void 0){var q=Ou,ie=l(m);return Ou=q,Xg(m,g,ie)}break}}var ae=l;if(g==null)return ae;var he=g[ae];return he!==void 0?he:ae}function uP(m,g,l){var c="";if(Array.isArray(l))for(var _=0;_<l.length;_++)c+=Xg(m,g,l[_])+";";else for(var A in l){var N=l[A];if(typeof N!="object"){var r=N;g!=null&&g[r]!==void 0?c+=A+"{"+g[r]+"}":iS(r)&&(c+=qv(A)+":"+rS(A,r)+";")}else if(Array.isArray(N)&&typeof N[0]=="string"&&(g==null||g[N[0]]===void 0))for(var q=0;q<N.length;q++)iS(N[q])&&(c+=qv(A)+":"+rS(A,N[q])+";");else{var ie=Xg(m,g,N);switch(A){case"animation":case"animationName":{c+=qv(A)+":"+ie+";";break}default:c+=A+"{"+ie+"}"}}}return c}var nS=/label:\s*([^\s;{]+)\s*(;|$)/g,Ou;function h0(m,g,l){if(m.length===1&&typeof m[0]=="object"&&m[0]!==null&&m[0].styles!==void 0)return m[0];var c=!0,_="";Ou=void 0;var A=m[0];if(A==null||A.raw===void 0)c=!1,_+=Xg(l,g,A);else{var N=A;_+=N[0]}for(var r=1;r<m.length;r++)if(_+=Xg(l,g,m[r]),c){var q=A;_+=q[r]}nS.lastIndex=0;for(var ie="",ae;(ae=nS.exec(_))!==null;)ie+="-"+ae[1];var he=oP(_)+ie;return{name:he,styles:_,next:Ou}}var hP=function(g){return g()},dP=px.useInsertionEffect?px.useInsertionEffect:!1,n2=dP||hP,s2=Ke.createContext(typeof HTMLElement<"u"?tP({key:"css"}):null);s2.Provider;var o2=function(g){return Ke.forwardRef(function(l,c){var _=Ke.useContext(s2);return g(l,_,c)})},a2=Ke.createContext({}),Vx={}.hasOwnProperty,_x="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",pP=function(g,l){var c={};for(var _ in l)Vx.call(l,_)&&(c[_]=l[_]);return c[_x]=g,c},fP=function(g){var l=g.cache,c=g.serialized,_=g.isStringTag;return Nx(l,c,_),n2(function(){return i2(l,c,_)}),null},mP=o2(function(m,g,l){var c=m.css;typeof c=="string"&&g.registered[c]!==void 0&&(c=g.registered[c]);var _=m[_x],A=[c],N="";typeof m.className=="string"?N=t2(g.registered,A,m.className):m.className!=null&&(N=m.className+" ");var r=h0(A,void 0,Ke.useContext(a2));N+=g.key+"-"+r.name;var q={};for(var ie in m)Vx.call(m,ie)&&ie!=="css"&&ie!==_x&&(q[ie]=m[ie]);return q.className=N,l&&(q.ref=l),Ke.createElement(Ke.Fragment,null,Ke.createElement(fP,{cache:g,serialized:r,isStringTag:typeof _=="string"}),Ke.createElement(_,q))}),gP=mP,hr=function(g,l){var c=arguments;if(l==null||!Vx.call(l,"css"))return Ke.createElement.apply(void 0,c);var _=c.length,A=new Array(_);A[0]=gP,A[1]=pP(g,l);for(var N=2;N<_;N++)A[N]=c[N];return Ke.createElement.apply(null,A)};(function(m){var g;g||(g=m.JSX||(m.JSX={}))})(hr||(hr={}));function r_(){for(var m=arguments.length,g=new Array(m),l=0;l<m;l++)g[l]=arguments[l];return h0(g)}function Fm(){var m=r_.apply(void 0,arguments),g="animation-"+m.name;return{name:g,styles:"@keyframes "+g+"{"+m.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}function _P(m,g){return g||(g=m.slice(0)),Object.freeze(Object.defineProperties(m,{raw:{value:Object.freeze(g)}}))}const Am=Math.min,of=Math.max,jy=Math.round,uy=Math.floor,Vu=m=>({x:m,y:m}),yP={left:"right",right:"left",bottom:"top",top:"bottom"},vP={start:"end",end:"start"};function xP(m,g,l){return of(m,Am(g,l))}function d0(m,g){return typeof m=="function"?m(g):m}function Pm(m){return m.split("-")[0]}function n_(m){return m.split("-")[1]}function bP(m){return m==="x"?"y":"x"}function Ux(m){return m==="y"?"height":"width"}function Zg(m){return["top","bottom"].includes(Pm(m))?"y":"x"}function jx(m){return bP(Zg(m))}function wP(m,g,l){l===void 0&&(l=!1);const c=n_(m),_=jx(m),A=Ux(_);let N=_==="x"?c===(l?"end":"start")?"right":"left":c==="start"?"bottom":"top";return g.reference[A]>g.floating[A]&&(N=$y(N)),[N,$y(N)]}function SP(m){const g=$y(m);return[yx(m),g,yx(g)]}function yx(m){return m.replace(/start|end/g,g=>vP[g])}function TP(m,g,l){const c=["left","right"],_=["right","left"],A=["top","bottom"],N=["bottom","top"];switch(m){case"top":case"bottom":return l?g?_:c:g?c:_;case"left":case"right":return g?A:N;default:return[]}}function MP(m,g,l,c){const _=n_(m);let A=TP(Pm(m),l==="start",c);return _&&(A=A.map(N=>N+"-"+_),g&&(A=A.concat(A.map(yx)))),A}function $y(m){return m.replace(/left|right|bottom|top/g,g=>yP[g])}function EP(m){return{top:0,right:0,bottom:0,left:0,...m}}function l2(m){return typeof m!="number"?EP(m):{top:m,right:m,bottom:m,left:m}}function Gy(m){const{x:g,y:l,width:c,height:_}=m;return{width:c,height:_,top:l,left:g,right:g+c,bottom:l+_,x:g,y:l}}function sS(m,g,l){let{reference:c,floating:_}=m;const A=Zg(g),N=jx(g),r=Ux(N),q=Pm(g),ie=A==="y",ae=c.x+c.width/2-_.width/2,he=c.y+c.height/2-_.height/2,ve=c[r]/2-_[r]/2;let Ae;switch(q){case"top":Ae={x:ae,y:c.y-_.height};break;case"bottom":Ae={x:ae,y:c.y+c.height};break;case"right":Ae={x:c.x+c.width,y:he};break;case"left":Ae={x:c.x-_.width,y:he};break;default:Ae={x:c.x,y:c.y}}switch(n_(g)){case"start":Ae[N]-=ve*(l&&ie?-1:1);break;case"end":Ae[N]+=ve*(l&&ie?-1:1);break}return Ae}const CP=async(m,g,l)=>{const{placement:c="bottom",strategy:_="absolute",middleware:A=[],platform:N}=l,r=A.filter(Boolean),q=await(N.isRTL==null?void 0:N.isRTL(g));let ie=await N.getElementRects({reference:m,floating:g,strategy:_}),{x:ae,y:he}=sS(ie,c,q),ve=c,Ae={},we=0;for(let Pe=0;Pe<r.length;Pe++){const{name:Ve,fn:We}=r[Pe],{x:rt,y:ht,data:tt,reset:at}=await We({x:ae,y:he,initialPlacement:c,placement:ve,strategy:_,middlewareData:Ae,rects:ie,platform:N,elements:{reference:m,floating:g}});ae=rt??ae,he=ht??he,Ae={...Ae,[Ve]:{...Ae[Ve],...tt}},at&&we<=50&&(we++,typeof at=="object"&&(at.placement&&(ve=at.placement),at.rects&&(ie=at.rects===!0?await N.getElementRects({reference:m,floating:g,strategy:_}):at.rects),{x:ae,y:he}=sS(ie,ve,q)),Pe=-1)}return{x:ae,y:he,placement:ve,strategy:_,middlewareData:Ae}};async function AP(m,g){var l;g===void 0&&(g={});const{x:c,y:_,platform:A,rects:N,elements:r,strategy:q}=m,{boundary:ie="clippingAncestors",rootBoundary:ae="viewport",elementContext:he="floating",altBoundary:ve=!1,padding:Ae=0}=d0(g,m),we=l2(Ae),Ve=r[ve?he==="floating"?"reference":"floating":he],We=Gy(await A.getClippingRect({element:(l=await(A.isElement==null?void 0:A.isElement(Ve)))==null||l?Ve:Ve.contextElement||await(A.getDocumentElement==null?void 0:A.getDocumentElement(r.floating)),boundary:ie,rootBoundary:ae,strategy:q})),rt=he==="floating"?{x:c,y:_,width:N.floating.width,height:N.floating.height}:N.reference,ht=await(A.getOffsetParent==null?void 0:A.getOffsetParent(r.floating)),tt=await(A.isElement==null?void 0:A.isElement(ht))?await(A.getScale==null?void 0:A.getScale(ht))||{x:1,y:1}:{x:1,y:1},at=Gy(A.convertOffsetParentRelativeRectToViewportRelativeRect?await A.convertOffsetParentRelativeRectToViewportRelativeRect({elements:r,rect:rt,offsetParent:ht,strategy:q}):rt);return{top:(We.top-at.top+we.top)/tt.y,bottom:(at.bottom-We.bottom+we.bottom)/tt.y,left:(We.left-at.left+we.left)/tt.x,right:(at.right-We.right+we.right)/tt.x}}const PP=m=>({name:"arrow",options:m,async fn(g){const{x:l,y:c,placement:_,rects:A,platform:N,elements:r,middlewareData:q}=g,{element:ie,padding:ae=0}=d0(m,g)||{};if(ie==null)return{};const he=l2(ae),ve={x:l,y:c},Ae=jx(_),we=Ux(Ae),Pe=await N.getDimensions(ie),Ve=Ae==="y",We=Ve?"top":"left",rt=Ve?"bottom":"right",ht=Ve?"clientHeight":"clientWidth",tt=A.reference[we]+A.reference[Ae]-ve[Ae]-A.floating[we],at=ve[Ae]-A.reference[Ae],Rt=await(N.getOffsetParent==null?void 0:N.getOffsetParent(ie));let Ne=Rt?Rt[ht]:0;(!Ne||!await(N.isElement==null?void 0:N.isElement(Rt)))&&(Ne=r.floating[ht]||A.floating[we]);const Tt=tt/2-at/2,qt=Ne/2-Pe[we]/2-1,Te=Am(he[We],qt),gt=Am(he[rt],qt),oi=Te,Ti=Ne-Pe[we]-gt,ni=Ne/2-Pe[we]/2+Tt,Mt=xP(oi,ni,Ti),zt=!q.arrow&&n_(_)!=null&&ni!==Mt&&A.reference[we]/2-(ni<oi?Te:gt)-Pe[we]/2<0,ii=zt?ni<oi?ni-oi:ni-Ti:0;return{[Ae]:ve[Ae]+ii,data:{[Ae]:Mt,centerOffset:ni-Mt-ii,...zt&&{alignmentOffset:ii}},reset:zt}}}),IP=function(m){return m===void 0&&(m={}),{name:"flip",options:m,async fn(g){var l,c;const{placement:_,middlewareData:A,rects:N,initialPlacement:r,platform:q,elements:ie}=g,{mainAxis:ae=!0,crossAxis:he=!0,fallbackPlacements:ve,fallbackStrategy:Ae="bestFit",fallbackAxisSideDirection:we="none",flipAlignment:Pe=!0,...Ve}=d0(m,g);if((l=A.arrow)!=null&&l.alignmentOffset)return{};const We=Pm(_),rt=Zg(r),ht=Pm(r)===r,tt=await(q.isRTL==null?void 0:q.isRTL(ie.floating)),at=ve||(ht||!Pe?[$y(r)]:SP(r)),Rt=we!=="none";!ve&&Rt&&at.push(...MP(r,Pe,we,tt));const Ne=[r,...at],Tt=await AP(g,Ve),qt=[];let Te=((c=A.flip)==null?void 0:c.overflows)||[];if(ae&&qt.push(Tt[We]),he){const ni=wP(_,N,tt);qt.push(Tt[ni[0]],Tt[ni[1]])}if(Te=[...Te,{placement:_,overflows:qt}],!qt.every(ni=>ni<=0)){var gt,oi;const ni=(((gt=A.flip)==null?void 0:gt.index)||0)+1,Mt=Ne[ni];if(Mt)return{data:{index:ni,overflows:Te},reset:{placement:Mt}};let zt=(oi=Te.filter(ii=>ii.overflows[0]<=0).sort((ii,Yt)=>ii.overflows[1]-Yt.overflows[1])[0])==null?void 0:oi.placement;if(!zt)switch(Ae){case"bestFit":{var Ti;const ii=(Ti=Te.filter(Yt=>{if(Rt){const jt=Zg(Yt.placement);return jt===rt||jt==="y"}return!0}).map(Yt=>[Yt.placement,Yt.overflows.filter(jt=>jt>0).reduce((jt,Ri)=>jt+Ri,0)]).sort((Yt,jt)=>Yt[1]-jt[1])[0])==null?void 0:Ti[0];ii&&(zt=ii);break}case"initialPlacement":zt=r;break}if(_!==zt)return{reset:{placement:zt}}}return{}}}};async function DP(m,g){const{placement:l,platform:c,elements:_}=m,A=await(c.isRTL==null?void 0:c.isRTL(_.floating)),N=Pm(l),r=n_(l),q=Zg(l)==="y",ie=["left","top"].includes(N)?-1:1,ae=A&&q?-1:1,he=d0(g,m);let{mainAxis:ve,crossAxis:Ae,alignmentAxis:we}=typeof he=="number"?{mainAxis:he,crossAxis:0,alignmentAxis:null}:{mainAxis:he.mainAxis||0,crossAxis:he.crossAxis||0,alignmentAxis:he.alignmentAxis};return r&&typeof we=="number"&&(Ae=r==="end"?we*-1:we),q?{x:Ae*ae,y:ve*ie}:{x:ve*ie,y:Ae*ae}}const kP=function(m){return m===void 0&&(m=0),{name:"offset",options:m,async fn(g){var l,c;const{x:_,y:A,placement:N,middlewareData:r}=g,q=await DP(g,m);return N===((l=r.offset)==null?void 0:l.placement)&&(c=r.arrow)!=null&&c.alignmentOffset?{}:{x:_+q.x,y:A+q.y,data:{...q,placement:N}}}}};function p0(){return typeof window<"u"}function Bm(m){return c2(m)?(m.nodeName||"").toLowerCase():"#document"}function ul(m){var g;return(m==null||(g=m.ownerDocument)==null?void 0:g.defaultView)||window}function ju(m){var g;return(g=(c2(m)?m.ownerDocument:m.document)||window.document)==null?void 0:g.documentElement}function c2(m){return p0()?m instanceof Node||m instanceof ul(m).Node:!1}function Sa(m){return p0()?m instanceof Element||m instanceof ul(m).Element:!1}function Uu(m){return p0()?m instanceof HTMLElement||m instanceof ul(m).HTMLElement:!1}function oS(m){return!p0()||typeof ShadowRoot>"u"?!1:m instanceof ShadowRoot||m instanceof ul(m).ShadowRoot}function s_(m){const{overflow:g,overflowX:l,overflowY:c,display:_}=Zl(m);return/auto|scroll|overlay|hidden|clip/.test(g+c+l)&&!["inline","contents"].includes(_)}function OP(m){return["table","td","th"].includes(Bm(m))}function f0(m){return[":popover-open",":modal"].some(g=>{try{return m.matches(g)}catch{return!1}})}function $x(m){const g=Gx(),l=Sa(m)?Zl(m):m;return["transform","translate","scale","rotate","perspective"].some(c=>l[c]?l[c]!=="none":!1)||(l.containerType?l.containerType!=="normal":!1)||!g&&(l.backdropFilter?l.backdropFilter!=="none":!1)||!g&&(l.filter?l.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(c=>(l.willChange||"").includes(c))||["paint","layout","strict","content"].some(c=>(l.contain||"").includes(c))}function LP(m){let g=Nd(m);for(;Uu(g)&&!Im(g);){if($x(g))return g;if(f0(g))return null;g=Nd(g)}return null}function Gx(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Im(m){return["html","body","#document"].includes(Bm(m))}function Zl(m){return ul(m).getComputedStyle(m)}function m0(m){return Sa(m)?{scrollLeft:m.scrollLeft,scrollTop:m.scrollTop}:{scrollLeft:m.scrollX,scrollTop:m.scrollY}}function Nd(m){if(Bm(m)==="html")return m;const g=m.assignedSlot||m.parentNode||oS(m)&&m.host||ju(m);return oS(g)?g.host:g}function u2(m){const g=Nd(m);return Im(g)?m.ownerDocument?m.ownerDocument.body:m.body:Uu(g)&&s_(g)?g:u2(g)}function Kg(m,g,l){var c;g===void 0&&(g=[]),l===void 0&&(l=!0);const _=u2(m),A=_===((c=m.ownerDocument)==null?void 0:c.body),N=ul(_);if(A){const r=vx(N);return g.concat(N,N.visualViewport||[],s_(_)?_:[],r&&l?Kg(r):[])}return g.concat(_,Kg(_,[],l))}function vx(m){return m.parent&&Object.getPrototypeOf(m.parent)?m.frameElement:null}function h2(m){const g=Zl(m);let l=parseFloat(g.width)||0,c=parseFloat(g.height)||0;const _=Uu(m),A=_?m.offsetWidth:l,N=_?m.offsetHeight:c,r=jy(l)!==A||jy(c)!==N;return r&&(l=A,c=N),{width:l,height:c,$:r}}function Hx(m){return Sa(m)?m:m.contextElement}function Tm(m){const g=Hx(m);if(!Uu(g))return Vu(1);const l=g.getBoundingClientRect(),{width:c,height:_,$:A}=h2(g);let N=(A?jy(l.width):l.width)/c,r=(A?jy(l.height):l.height)/_;return(!N||!Number.isFinite(N))&&(N=1),(!r||!Number.isFinite(r))&&(r=1),{x:N,y:r}}const RP=Vu(0);function d2(m){const g=ul(m);return!Gx()||!g.visualViewport?RP:{x:g.visualViewport.offsetLeft,y:g.visualViewport.offsetTop}}function zP(m,g,l){return g===void 0&&(g=!1),!l||g&&l!==ul(m)?!1:g}function uf(m,g,l,c){g===void 0&&(g=!1),l===void 0&&(l=!1);const _=m.getBoundingClientRect(),A=Hx(m);let N=Vu(1);g&&(c?Sa(c)&&(N=Tm(c)):N=Tm(m));const r=zP(A,l,c)?d2(A):Vu(0);let q=(_.left+r.x)/N.x,ie=(_.top+r.y)/N.y,ae=_.width/N.x,he=_.height/N.y;if(A){const ve=ul(A),Ae=c&&Sa(c)?ul(c):c;let we=ve,Pe=vx(we);for(;Pe&&c&&Ae!==we;){const Ve=Tm(Pe),We=Pe.getBoundingClientRect(),rt=Zl(Pe),ht=We.left+(Pe.clientLeft+parseFloat(rt.paddingLeft))*Ve.x,tt=We.top+(Pe.clientTop+parseFloat(rt.paddingTop))*Ve.y;q*=Ve.x,ie*=Ve.y,ae*=Ve.x,he*=Ve.y,q+=ht,ie+=tt,we=ul(Pe),Pe=vx(we)}}return Gy({width:ae,height:he,x:q,y:ie})}function Wx(m,g){const l=m0(m).scrollLeft;return g?g.left+l:uf(ju(m)).left+l}function p2(m,g,l){l===void 0&&(l=!1);const c=m.getBoundingClientRect(),_=c.left+g.scrollLeft-(l?0:Wx(m,c)),A=c.top+g.scrollTop;return{x:_,y:A}}function FP(m){let{elements:g,rect:l,offsetParent:c,strategy:_}=m;const A=_==="fixed",N=ju(c),r=g?f0(g.floating):!1;if(c===N||r&&A)return l;let q={scrollLeft:0,scrollTop:0},ie=Vu(1);const ae=Vu(0),he=Uu(c);if((he||!he&&!A)&&((Bm(c)!=="body"||s_(N))&&(q=m0(c)),Uu(c))){const Ae=uf(c);ie=Tm(c),ae.x=Ae.x+c.clientLeft,ae.y=Ae.y+c.clientTop}const ve=N&&!he&&!A?p2(N,q,!0):Vu(0);return{width:l.width*ie.x,height:l.height*ie.y,x:l.x*ie.x-q.scrollLeft*ie.x+ae.x+ve.x,y:l.y*ie.y-q.scrollTop*ie.y+ae.y+ve.y}}function BP(m){return Array.from(m.getClientRects())}function NP(m){const g=ju(m),l=m0(m),c=m.ownerDocument.body,_=of(g.scrollWidth,g.clientWidth,c.scrollWidth,c.clientWidth),A=of(g.scrollHeight,g.clientHeight,c.scrollHeight,c.clientHeight);let N=-l.scrollLeft+Wx(m);const r=-l.scrollTop;return Zl(c).direction==="rtl"&&(N+=of(g.clientWidth,c.clientWidth)-_),{width:_,height:A,x:N,y:r}}function VP(m,g){const l=ul(m),c=ju(m),_=l.visualViewport;let A=c.clientWidth,N=c.clientHeight,r=0,q=0;if(_){A=_.width,N=_.height;const ie=Gx();(!ie||ie&&g==="fixed")&&(r=_.offsetLeft,q=_.offsetTop)}return{width:A,height:N,x:r,y:q}}function UP(m,g){const l=uf(m,!0,g==="fixed"),c=l.top+m.clientTop,_=l.left+m.clientLeft,A=Uu(m)?Tm(m):Vu(1),N=m.clientWidth*A.x,r=m.clientHeight*A.y,q=_*A.x,ie=c*A.y;return{width:N,height:r,x:q,y:ie}}function aS(m,g,l){let c;if(g==="viewport")c=VP(m,l);else if(g==="document")c=NP(ju(m));else if(Sa(g))c=UP(g,l);else{const _=d2(m);c={x:g.x-_.x,y:g.y-_.y,width:g.width,height:g.height}}return Gy(c)}function f2(m,g){const l=Nd(m);return l===g||!Sa(l)||Im(l)?!1:Zl(l).position==="fixed"||f2(l,g)}function jP(m,g){const l=g.get(m);if(l)return l;let c=Kg(m,[],!1).filter(r=>Sa(r)&&Bm(r)!=="body"),_=null;const A=Zl(m).position==="fixed";let N=A?Nd(m):m;for(;Sa(N)&&!Im(N);){const r=Zl(N),q=$x(N);!q&&r.position==="fixed"&&(_=null),(A?!q&&!_:!q&&r.position==="static"&&!!_&&["absolute","fixed"].includes(_.position)||s_(N)&&!q&&f2(m,N))?c=c.filter(ae=>ae!==N):_=r,N=Nd(N)}return g.set(m,c),c}function $P(m){let{element:g,boundary:l,rootBoundary:c,strategy:_}=m;const N=[...l==="clippingAncestors"?f0(g)?[]:jP(g,this._c):[].concat(l),c],r=N[0],q=N.reduce((ie,ae)=>{const he=aS(g,ae,_);return ie.top=of(he.top,ie.top),ie.right=Am(he.right,ie.right),ie.bottom=Am(he.bottom,ie.bottom),ie.left=of(he.left,ie.left),ie},aS(g,r,_));return{width:q.right-q.left,height:q.bottom-q.top,x:q.left,y:q.top}}function GP(m){const{width:g,height:l}=h2(m);return{width:g,height:l}}function HP(m,g,l){const c=Uu(g),_=ju(g),A=l==="fixed",N=uf(m,!0,A,g);let r={scrollLeft:0,scrollTop:0};const q=Vu(0);if(c||!c&&!A)if((Bm(g)!=="body"||s_(_))&&(r=m0(g)),c){const ve=uf(g,!0,A,g);q.x=ve.x+g.clientLeft,q.y=ve.y+g.clientTop}else _&&(q.x=Wx(_));const ie=_&&!c&&!A?p2(_,r):Vu(0),ae=N.left+r.scrollLeft-q.x-ie.x,he=N.top+r.scrollTop-q.y-ie.y;return{x:ae,y:he,width:N.width,height:N.height}}function Yv(m){return Zl(m).position==="static"}function lS(m,g){if(!Uu(m)||Zl(m).position==="fixed")return null;if(g)return g(m);let l=m.offsetParent;return ju(m)===l&&(l=l.ownerDocument.body),l}function m2(m,g){const l=ul(m);if(f0(m))return l;if(!Uu(m)){let _=Nd(m);for(;_&&!Im(_);){if(Sa(_)&&!Yv(_))return _;_=Nd(_)}return l}let c=lS(m,g);for(;c&&OP(c)&&Yv(c);)c=lS(c,g);return c&&Im(c)&&Yv(c)&&!$x(c)?l:c||LP(m)||l}const WP=async function(m){const g=this.getOffsetParent||m2,l=this.getDimensions,c=await l(m.floating);return{reference:HP(m.reference,await g(m.floating),m.strategy),floating:{x:0,y:0,width:c.width,height:c.height}}};function qP(m){return Zl(m).direction==="rtl"}const YP={convertOffsetParentRelativeRectToViewportRelativeRect:FP,getDocumentElement:ju,getClippingRect:$P,getOffsetParent:m2,getElementRects:WP,getClientRects:BP,getDimensions:GP,getScale:Tm,isElement:Sa,isRTL:qP};function g2(m,g){return m.x===g.x&&m.y===g.y&&m.width===g.width&&m.height===g.height}function XP(m,g){let l=null,c;const _=ju(m);function A(){var r;clearTimeout(c),(r=l)==null||r.disconnect(),l=null}function N(r,q){r===void 0&&(r=!1),q===void 0&&(q=1),A();const ie=m.getBoundingClientRect(),{left:ae,top:he,width:ve,height:Ae}=ie;if(r||g(),!ve||!Ae)return;const we=uy(he),Pe=uy(_.clientWidth-(ae+ve)),Ve=uy(_.clientHeight-(he+Ae)),We=uy(ae),ht={rootMargin:-we+"px "+-Pe+"px "+-Ve+"px "+-We+"px",threshold:of(0,Am(1,q))||1};let tt=!0;function at(Rt){const Ne=Rt[0].intersectionRatio;if(Ne!==q){if(!tt)return N();Ne?N(!1,Ne):c=setTimeout(()=>{N(!1,1e-7)},1e3)}Ne===1&&!g2(ie,m.getBoundingClientRect())&&N(),tt=!1}try{l=new IntersectionObserver(at,{...ht,root:_.ownerDocument})}catch{l=new IntersectionObserver(at,ht)}l.observe(m)}return N(!0),A}function _2(m,g,l,c){c===void 0&&(c={});const{ancestorScroll:_=!0,ancestorResize:A=!0,elementResize:N=typeof ResizeObserver=="function",layoutShift:r=typeof IntersectionObserver=="function",animationFrame:q=!1}=c,ie=Hx(m),ae=_||A?[...ie?Kg(ie):[],...Kg(g)]:[];ae.forEach(We=>{_&&We.addEventListener("scroll",l,{passive:!0}),A&&We.addEventListener("resize",l)});const he=ie&&r?XP(ie,l):null;let ve=-1,Ae=null;N&&(Ae=new ResizeObserver(We=>{let[rt]=We;rt&&rt.target===ie&&Ae&&(Ae.unobserve(g),cancelAnimationFrame(ve),ve=requestAnimationFrame(()=>{var ht;(ht=Ae)==null||ht.observe(g)})),l()}),ie&&!q&&Ae.observe(ie),Ae.observe(g));let we,Pe=q?uf(m):null;q&&Ve();function Ve(){const We=uf(m);Pe&&!g2(Pe,We)&&l(),Pe=We,we=requestAnimationFrame(Ve)}return l(),()=>{var We;ae.forEach(rt=>{_&&rt.removeEventListener("scroll",l),A&&rt.removeEventListener("resize",l)}),he==null||he(),(We=Ae)==null||We.disconnect(),Ae=null,q&&cancelAnimationFrame(we)}}const ZP=kP,KP=IP,cS=PP,JP=(m,g,l)=>{const c=new Map,_={platform:YP,...l},A={..._.platform,_c:c};return CP(m,g,{..._,platform:A})};var xx=Ke.useLayoutEffect,QP=["className","clearValue","cx","getStyles","getClassNames","getValue","hasValue","isMulti","isRtl","options","selectOption","selectProps","setValue","theme"],Hy=function(){};function eI(m,g){return g?g[0]==="-"?m+g:m+"__"+g:m}function tI(m,g){for(var l=arguments.length,c=new Array(l>2?l-2:0),_=2;_<l;_++)c[_-2]=arguments[_];var A=[].concat(c);if(g&&m)for(var N in g)g.hasOwnProperty(N)&&g[N]&&A.push("".concat(eI(m,N)));return A.filter(function(r){return r}).map(function(r){return String(r).trim()}).join(" ")}var uS=function(g){return uI(g)?g.filter(Boolean):cf(g)==="object"&&g!==null?[g]:[]},y2=function(g){g.className,g.clearValue,g.cx,g.getStyles,g.getClassNames,g.getValue,g.hasValue,g.isMulti,g.isRtl,g.options,g.selectOption,g.selectProps,g.setValue,g.theme;var l=Lh(g,QP);return vr({},l)},Us=function(g,l,c){var _=g.cx,A=g.getStyles,N=g.getClassNames,r=g.className;return{css:A(l,g),className:_(c??{},N(l,g),r)}};function g0(m){return[document.documentElement,document.body,window].indexOf(m)>-1}function iI(m){return g0(m)?window.innerHeight:m.clientHeight}function v2(m){return g0(m)?window.pageYOffset:m.scrollTop}function Wy(m,g){if(g0(m)){window.scrollTo(0,g);return}m.scrollTop=g}function rI(m){var g=getComputedStyle(m),l=g.position==="absolute",c=/(auto|scroll)/;if(g.position==="fixed")return document.documentElement;for(var _=m;_=_.parentElement;)if(g=getComputedStyle(_),!(l&&g.position==="static")&&c.test(g.overflow+g.overflowY+g.overflowX))return _;return document.documentElement}function nI(m,g,l,c){return l*((m=m/c-1)*m*m+1)+g}function hy(m,g){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:200,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Hy,_=v2(m),A=g-_,N=10,r=0;function q(){r+=N;var ie=nI(r,_,A,l);Wy(m,ie),r<l?window.requestAnimationFrame(q):c(m)}q()}function hS(m,g){var l=m.getBoundingClientRect(),c=g.getBoundingClientRect(),_=g.offsetHeight/3;c.bottom+_>l.bottom?Wy(m,Math.min(g.offsetTop+g.clientHeight-m.offsetHeight+_,m.scrollHeight)):c.top-_<l.top&&Wy(m,Math.max(g.offsetTop-_,0))}function sI(m){var g=m.getBoundingClientRect();return{bottom:g.bottom,height:g.height,left:g.left,right:g.right,top:g.top,width:g.width}}function dS(){try{return document.createEvent("TouchEvent"),!0}catch{return!1}}function oI(){try{return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}catch{return!1}}var x2=!1,aI={get passive(){return x2=!0}},dy=typeof window<"u"?window:{};dy.addEventListener&&dy.removeEventListener&&(dy.addEventListener("p",Hy,aI),dy.removeEventListener("p",Hy,!1));var lI=x2;function cI(m){return m!=null}function uI(m){return Array.isArray(m)}function py(m,g,l){return m?g:l}var hI=function(g){for(var l=arguments.length,c=new Array(l>1?l-1:0),_=1;_<l;_++)c[_-1]=arguments[_];var A=Object.entries(g).filter(function(N){var r=Eh(N,1),q=r[0];return!c.includes(q)});return A.reduce(function(N,r){var q=Eh(r,2),ie=q[0],ae=q[1];return N[ie]=ae,N},{})},dI=["children","innerProps"],pI=["children","innerProps"];function fI(m){var g=m.maxHeight,l=m.menuEl,c=m.minHeight,_=m.placement,A=m.shouldScroll,N=m.isFixedPosition,r=m.controlHeight,q=rI(l),ie={placement:"bottom",maxHeight:g};if(!l||!l.offsetParent)return ie;var ae=q.getBoundingClientRect(),he=ae.height,ve=l.getBoundingClientRect(),Ae=ve.bottom,we=ve.height,Pe=ve.top,Ve=l.offsetParent.getBoundingClientRect(),We=Ve.top,rt=N?window.innerHeight:iI(q),ht=v2(q),tt=parseInt(getComputedStyle(l).marginBottom,10),at=parseInt(getComputedStyle(l).marginTop,10),Rt=We-at,Ne=rt-Pe,Tt=Rt+ht,qt=he-ht-Pe,Te=Ae-rt+ht+tt,gt=ht+Pe-at,oi=160;switch(_){case"auto":case"bottom":if(Ne>=we)return{placement:"bottom",maxHeight:g};if(qt>=we&&!N)return A&&hy(q,Te,oi),{placement:"bottom",maxHeight:g};if(!N&&qt>=c||N&&Ne>=c){A&&hy(q,Te,oi);var Ti=N?Ne-tt:qt-tt;return{placement:"bottom",maxHeight:Ti}}if(_==="auto"||N){var ni=g,Mt=N?Rt:Tt;return Mt>=c&&(ni=Math.min(Mt-tt-r,g)),{placement:"top",maxHeight:ni}}if(_==="bottom")return A&&Wy(q,Te),{placement:"bottom",maxHeight:g};break;case"top":if(Rt>=we)return{placement:"top",maxHeight:g};if(Tt>=we&&!N)return A&&hy(q,gt,oi),{placement:"top",maxHeight:g};if(!N&&Tt>=c||N&&Rt>=c){var zt=g;return(!N&&Tt>=c||N&&Rt>=c)&&(zt=N?Rt-at:Tt-at),A&&hy(q,gt,oi),{placement:"top",maxHeight:zt}}return{placement:"bottom",maxHeight:g};default:throw new Error('Invalid placement provided "'.concat(_,'".'))}return ie}function mI(m){var g={bottom:"top",top:"bottom"};return m?g[m]:"bottom"}var b2=function(g){return g==="auto"?"bottom":g},gI=function(g,l){var c,_=g.placement,A=g.theme,N=A.borderRadius,r=A.spacing,q=A.colors;return vr((c={label:"menu"},Vg(c,mI(_),"100%"),Vg(c,"position","absolute"),Vg(c,"width","100%"),Vg(c,"zIndex",1),c),l?{}:{backgroundColor:q.neutral0,borderRadius:N,boxShadow:"0 0 0 1px hsla(0, 0%, 0%, 0.1), 0 4px 11px hsla(0, 0%, 0%, 0.1)",marginBottom:r.menuGutter,marginTop:r.menuGutter})},w2=Ke.createContext(null),_I=function(g){var l=g.children,c=g.minMenuHeight,_=g.maxMenuHeight,A=g.menuPlacement,N=g.menuPosition,r=g.menuShouldScrollIntoView,q=g.theme,ie=Ke.useContext(w2)||{},ae=ie.setPortalPlacement,he=Ke.useRef(null),ve=Ke.useState(_),Ae=Eh(ve,2),we=Ae[0],Pe=Ae[1],Ve=Ke.useState(null),We=Eh(Ve,2),rt=We[0],ht=We[1],tt=q.spacing.controlHeight;return xx(function(){var at=he.current;if(at){var Rt=N==="fixed",Ne=r&&!Rt,Tt=fI({maxHeight:_,menuEl:at,minHeight:c,placement:A,shouldScroll:Ne,isFixedPosition:Rt,controlHeight:tt});Pe(Tt.maxHeight),ht(Tt.placement),ae==null||ae(Tt.placement)}},[_,A,N,r,c,ae,tt]),l({ref:he,placerProps:vr(vr({},g),{},{placement:rt||b2(A),maxHeight:we})})},yI=function(g){var l=g.children,c=g.innerRef,_=g.innerProps;return hr("div",yr({},Us(g,"menu",{menu:!0}),{ref:c},_),l)},vI=yI,xI=function(g,l){var c=g.maxHeight,_=g.theme.spacing.baseUnit;return vr({maxHeight:c,overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},l?{}:{paddingBottom:_,paddingTop:_})},bI=function(g){var l=g.children,c=g.innerProps,_=g.innerRef,A=g.isMulti;return hr("div",yr({},Us(g,"menuList",{"menu-list":!0,"menu-list--is-multi":A}),{ref:_},c),l)},S2=function(g,l){var c=g.theme,_=c.spacing.baseUnit,A=c.colors;return vr({textAlign:"center"},l?{}:{color:A.neutral40,padding:"".concat(_*2,"px ").concat(_*3,"px")})},wI=S2,SI=S2,TI=function(g){var l=g.children,c=l===void 0?"No options":l,_=g.innerProps,A=Lh(g,dI);return hr("div",yr({},Us(vr(vr({},A),{},{children:c,innerProps:_}),"noOptionsMessage",{"menu-notice":!0,"menu-notice--no-options":!0}),_),c)},MI=function(g){var l=g.children,c=l===void 0?"Loading...":l,_=g.innerProps,A=Lh(g,pI);return hr("div",yr({},Us(vr(vr({},A),{},{children:c,innerProps:_}),"loadingMessage",{"menu-notice":!0,"menu-notice--loading":!0}),_),c)},EI=function(g){var l=g.rect,c=g.offset,_=g.position;return{left:l.left,position:_,top:c,width:l.width,zIndex:1}},CI=function(g){var l=g.appendTo,c=g.children,_=g.controlElement,A=g.innerProps,N=g.menuPlacement,r=g.menuPosition,q=Ke.useRef(null),ie=Ke.useRef(null),ae=Ke.useState(b2(N)),he=Eh(ae,2),ve=he[0],Ae=he[1],we=Ke.useMemo(function(){return{setPortalPlacement:Ae}},[]),Pe=Ke.useState(null),Ve=Eh(Pe,2),We=Ve[0],rt=Ve[1],ht=Ke.useCallback(function(){if(_){var Ne=sI(_),Tt=r==="fixed"?0:window.pageYOffset,qt=Ne[ve]+Tt;(qt!==(We==null?void 0:We.offset)||Ne.left!==(We==null?void 0:We.rect.left)||Ne.width!==(We==null?void 0:We.rect.width))&&rt({offset:qt,rect:Ne})}},[_,r,ve,We==null?void 0:We.offset,We==null?void 0:We.rect.left,We==null?void 0:We.rect.width]);xx(function(){ht()},[ht]);var tt=Ke.useCallback(function(){typeof ie.current=="function"&&(ie.current(),ie.current=null),_&&q.current&&(ie.current=_2(_,q.current,ht,{elementResize:"ResizeObserver"in window}))},[_,ht]);xx(function(){tt()},[tt]);var at=Ke.useCallback(function(Ne){q.current=Ne,tt()},[tt]);if(!l&&r!=="fixed"||!We)return null;var Rt=hr("div",yr({ref:at},Us(vr(vr({},g),{},{offset:We.offset,position:r,rect:We.rect}),"menuPortal",{"menu-portal":!0}),A),c);return hr(w2.Provider,{value:we},l?Lx.createPortal(Rt,l):Rt)},AI=function(g){var l=g.isDisabled,c=g.isRtl;return{label:"container",direction:c?"rtl":void 0,pointerEvents:l?"none":void 0,position:"relative"}},PI=function(g){var l=g.children,c=g.innerProps,_=g.isDisabled,A=g.isRtl;return hr("div",yr({},Us(g,"container",{"--is-disabled":_,"--is-rtl":A}),c),l)},II=function(g,l){var c=g.theme.spacing,_=g.isMulti,A=g.hasValue,N=g.selectProps.controlShouldRenderValue;return vr({alignItems:"center",display:_&&A&&N?"flex":"grid",flex:1,flexWrap:"wrap",WebkitOverflowScrolling:"touch",position:"relative",overflow:"hidden"},l?{}:{padding:"".concat(c.baseUnit/2,"px ").concat(c.baseUnit*2,"px")})},DI=function(g){var l=g.children,c=g.innerProps,_=g.isMulti,A=g.hasValue;return hr("div",yr({},Us(g,"valueContainer",{"value-container":!0,"value-container--is-multi":_,"value-container--has-value":A}),c),l)},kI=function(){return{alignItems:"center",alignSelf:"stretch",display:"flex",flexShrink:0}},OI=function(g){var l=g.children,c=g.innerProps;return hr("div",yr({},Us(g,"indicatorsContainer",{indicators:!0}),c),l)},pS,LI=["size"],RI=["innerProps","isRtl","size"],zI={name:"8mmkcg",styles:"display:inline-block;fill:currentColor;line-height:1;stroke:currentColor;stroke-width:0"},T2=function(g){var l=g.size,c=Lh(g,LI);return hr("svg",yr({height:l,width:l,viewBox:"0 0 20 20","aria-hidden":"true",focusable:"false",css:zI},c))},qx=function(g){return hr(T2,yr({size:20},g),hr("path",{d:"M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"}))},M2=function(g){return hr(T2,yr({size:20},g),hr("path",{d:"M4.516 7.548c0.436-0.446 1.043-0.481 1.576 0l3.908 3.747 3.908-3.747c0.533-0.481 1.141-0.446 1.574 0 0.436 0.445 0.408 1.197 0 1.615-0.406 0.418-4.695 4.502-4.695 4.502-0.217 0.223-0.502 0.335-0.787 0.335s-0.57-0.112-0.789-0.335c0 0-4.287-4.084-4.695-4.502s-0.436-1.17 0-1.615z"}))},E2=function(g,l){var c=g.isFocused,_=g.theme,A=_.spacing.baseUnit,N=_.colors;return vr({label:"indicatorContainer",display:"flex",transition:"color 150ms"},l?{}:{color:c?N.neutral60:N.neutral20,padding:A*2,":hover":{color:c?N.neutral80:N.neutral40}})},FI=E2,BI=function(g){var l=g.children,c=g.innerProps;return hr("div",yr({},Us(g,"dropdownIndicator",{indicator:!0,"dropdown-indicator":!0}),c),l||hr(M2,null))},NI=E2,VI=function(g){var l=g.children,c=g.innerProps;return hr("div",yr({},Us(g,"clearIndicator",{indicator:!0,"clear-indicator":!0}),c),l||hr(qx,null))},UI=function(g,l){var c=g.isDisabled,_=g.theme,A=_.spacing.baseUnit,N=_.colors;return vr({label:"indicatorSeparator",alignSelf:"stretch",width:1},l?{}:{backgroundColor:c?N.neutral10:N.neutral20,marginBottom:A*2,marginTop:A*2})},jI=function(g){var l=g.innerProps;return hr("span",yr({},l,Us(g,"indicatorSeparator",{"indicator-separator":!0})))},$I=Fm(pS||(pS=_P([`
  0%, 80%, 100% { opacity: 0; }
  40% { opacity: 1; }
`]))),GI=function(g,l){var c=g.isFocused,_=g.size,A=g.theme,N=A.colors,r=A.spacing.baseUnit;return vr({label:"loadingIndicator",display:"flex",transition:"color 150ms",alignSelf:"center",fontSize:_,lineHeight:1,marginRight:_,textAlign:"center",verticalAlign:"middle"},l?{}:{color:c?N.neutral60:N.neutral20,padding:r*2})},Xv=function(g){var l=g.delay,c=g.offset;return hr("span",{css:r_({animation:"".concat($I," 1s ease-in-out ").concat(l,"ms infinite;"),backgroundColor:"currentColor",borderRadius:"1em",display:"inline-block",marginLeft:c?"1em":void 0,height:"1em",verticalAlign:"top",width:"1em"},"","")})},HI=function(g){var l=g.innerProps,c=g.isRtl,_=g.size,A=_===void 0?4:_,N=Lh(g,RI);return hr("div",yr({},Us(vr(vr({},N),{},{innerProps:l,isRtl:c,size:A}),"loadingIndicator",{indicator:!0,"loading-indicator":!0}),l),hr(Xv,{delay:0,offset:c}),hr(Xv,{delay:160,offset:!0}),hr(Xv,{delay:320,offset:!c}))},WI=function(g,l){var c=g.isDisabled,_=g.isFocused,A=g.theme,N=A.colors,r=A.borderRadius,q=A.spacing;return vr({label:"control",alignItems:"center",cursor:"default",display:"flex",flexWrap:"wrap",justifyContent:"space-between",minHeight:q.controlHeight,outline:"0 !important",position:"relative",transition:"all 100ms"},l?{}:{backgroundColor:c?N.neutral5:N.neutral0,borderColor:c?N.neutral10:_?N.primary:N.neutral20,borderRadius:r,borderStyle:"solid",borderWidth:1,boxShadow:_?"0 0 0 1px ".concat(N.primary):void 0,"&:hover":{borderColor:_?N.primary:N.neutral30}})},qI=function(g){var l=g.children,c=g.isDisabled,_=g.isFocused,A=g.innerRef,N=g.innerProps,r=g.menuIsOpen;return hr("div",yr({ref:A},Us(g,"control",{control:!0,"control--is-disabled":c,"control--is-focused":_,"control--menu-is-open":r}),N,{"aria-disabled":c||void 0}),l)},YI=qI,XI=["data"],ZI=function(g,l){var c=g.theme.spacing;return l?{}:{paddingBottom:c.baseUnit*2,paddingTop:c.baseUnit*2}},KI=function(g){var l=g.children,c=g.cx,_=g.getStyles,A=g.getClassNames,N=g.Heading,r=g.headingProps,q=g.innerProps,ie=g.label,ae=g.theme,he=g.selectProps;return hr("div",yr({},Us(g,"group",{group:!0}),q),hr(N,yr({},r,{selectProps:he,theme:ae,getStyles:_,getClassNames:A,cx:c}),ie),hr("div",null,l))},JI=function(g,l){var c=g.theme,_=c.colors,A=c.spacing;return vr({label:"group",cursor:"default",display:"block"},l?{}:{color:_.neutral40,fontSize:"75%",fontWeight:500,marginBottom:"0.25em",paddingLeft:A.baseUnit*3,paddingRight:A.baseUnit*3,textTransform:"uppercase"})},QI=function(g){var l=y2(g);l.data;var c=Lh(l,XI);return hr("div",yr({},Us(g,"groupHeading",{"group-heading":!0}),c))},eD=KI,tD=["innerRef","isDisabled","isHidden","inputClassName"],iD=function(g,l){var c=g.isDisabled,_=g.value,A=g.theme,N=A.spacing,r=A.colors;return vr(vr({visibility:c?"hidden":"visible",transform:_?"translateZ(0)":""},rD),l?{}:{margin:N.baseUnit/2,paddingBottom:N.baseUnit/2,paddingTop:N.baseUnit/2,color:r.neutral80})},C2={gridArea:"1 / 2",font:"inherit",minWidth:"2px",border:0,margin:0,outline:0,padding:0},rD={flex:"1 1 auto",display:"inline-grid",gridArea:"1 / 1 / 2 / 3",gridTemplateColumns:"0 min-content","&:after":vr({content:'attr(data-value) " "',visibility:"hidden",whiteSpace:"pre"},C2)},nD=function(g){return vr({label:"input",color:"inherit",background:0,opacity:g?0:1,width:"100%"},C2)},sD=function(g){var l=g.cx,c=g.value,_=y2(g),A=_.innerRef,N=_.isDisabled,r=_.isHidden,q=_.inputClassName,ie=Lh(_,tD);return hr("div",yr({},Us(g,"input",{"input-container":!0}),{"data-value":c||""}),hr("input",yr({className:l({input:!0},q),ref:A,style:nD(r),disabled:N},ie)))},oD=sD,aD=function(g,l){var c=g.theme,_=c.spacing,A=c.borderRadius,N=c.colors;return vr({label:"multiValue",display:"flex",minWidth:0},l?{}:{backgroundColor:N.neutral10,borderRadius:A/2,margin:_.baseUnit/2})},lD=function(g,l){var c=g.theme,_=c.borderRadius,A=c.colors,N=g.cropWithEllipsis;return vr({overflow:"hidden",textOverflow:N||N===void 0?"ellipsis":void 0,whiteSpace:"nowrap"},l?{}:{borderRadius:_/2,color:A.neutral80,fontSize:"85%",padding:3,paddingLeft:6})},cD=function(g,l){var c=g.theme,_=c.spacing,A=c.borderRadius,N=c.colors,r=g.isFocused;return vr({alignItems:"center",display:"flex"},l?{}:{borderRadius:A/2,backgroundColor:r?N.dangerLight:void 0,paddingLeft:_.baseUnit,paddingRight:_.baseUnit,":hover":{backgroundColor:N.dangerLight,color:N.danger}})},A2=function(g){var l=g.children,c=g.innerProps;return hr("div",c,l)},uD=A2,hD=A2;function dD(m){var g=m.children,l=m.innerProps;return hr("div",yr({role:"button"},l),g||hr(qx,{size:14}))}var pD=function(g){var l=g.children,c=g.components,_=g.data,A=g.innerProps,N=g.isDisabled,r=g.removeProps,q=g.selectProps,ie=c.Container,ae=c.Label,he=c.Remove;return hr(ie,{data:_,innerProps:vr(vr({},Us(g,"multiValue",{"multi-value":!0,"multi-value--is-disabled":N})),A),selectProps:q},hr(ae,{data:_,innerProps:vr({},Us(g,"multiValueLabel",{"multi-value__label":!0})),selectProps:q},l),hr(he,{data:_,innerProps:vr(vr({},Us(g,"multiValueRemove",{"multi-value__remove":!0})),{},{"aria-label":"Remove ".concat(l||"option")},r),selectProps:q}))},fD=pD,mD=function(g,l){var c=g.isDisabled,_=g.isFocused,A=g.isSelected,N=g.theme,r=N.spacing,q=N.colors;return vr({label:"option",cursor:"default",display:"block",fontSize:"inherit",width:"100%",userSelect:"none",WebkitTapHighlightColor:"rgba(0, 0, 0, 0)"},l?{}:{backgroundColor:A?q.primary:_?q.primary25:"transparent",color:c?q.neutral20:A?q.neutral0:"inherit",padding:"".concat(r.baseUnit*2,"px ").concat(r.baseUnit*3,"px"),":active":{backgroundColor:c?void 0:A?q.primary:q.primary50}})},gD=function(g){var l=g.children,c=g.isDisabled,_=g.isFocused,A=g.isSelected,N=g.innerRef,r=g.innerProps;return hr("div",yr({},Us(g,"option",{option:!0,"option--is-disabled":c,"option--is-focused":_,"option--is-selected":A}),{ref:N,"aria-disabled":c},r),l)},_D=gD,yD=function(g,l){var c=g.theme,_=c.spacing,A=c.colors;return vr({label:"placeholder",gridArea:"1 / 1 / 2 / 3"},l?{}:{color:A.neutral50,marginLeft:_.baseUnit/2,marginRight:_.baseUnit/2})},vD=function(g){var l=g.children,c=g.innerProps;return hr("div",yr({},Us(g,"placeholder",{placeholder:!0}),c),l)},xD=vD,bD=function(g,l){var c=g.isDisabled,_=g.theme,A=_.spacing,N=_.colors;return vr({label:"singleValue",gridArea:"1 / 1 / 2 / 3",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},l?{}:{color:c?N.neutral40:N.neutral80,marginLeft:A.baseUnit/2,marginRight:A.baseUnit/2})},wD=function(g){var l=g.children,c=g.isDisabled,_=g.innerProps;return hr("div",yr({},Us(g,"singleValue",{"single-value":!0,"single-value--is-disabled":c}),_),l)},SD=wD,TD={ClearIndicator:VI,Control:YI,DropdownIndicator:BI,DownChevron:M2,CrossIcon:qx,Group:eD,GroupHeading:QI,IndicatorsContainer:OI,IndicatorSeparator:jI,Input:oD,LoadingIndicator:HI,Menu:vI,MenuList:bI,MenuPortal:CI,LoadingMessage:MI,NoOptionsMessage:TI,MultiValue:fD,MultiValueContainer:uD,MultiValueLabel:hD,MultiValueRemove:dD,Option:_D,Placeholder:xD,SelectContainer:PI,SingleValue:SD,ValueContainer:DI},MD=function(g){return vr(vr({},TD),g.components)},fS=Number.isNaN||function(g){return typeof g=="number"&&g!==g};function ED(m,g){return!!(m===g||fS(m)&&fS(g))}function CD(m,g){if(m.length!==g.length)return!1;for(var l=0;l<m.length;l++)if(!ED(m[l],g[l]))return!1;return!0}function AD(m,g){g===void 0&&(g=CD);var l=null;function c(){for(var _=[],A=0;A<arguments.length;A++)_[A]=arguments[A];if(l&&l.lastThis===this&&g(_,l.lastArgs))return l.lastResult;var N=m.apply(this,_);return l={lastResult:N,lastArgs:_,lastThis:this},N}return c.clear=function(){l=null},c}var PD={name:"7pg0cj-a11yText",styles:"label:a11yText;z-index:9999;border:0;clip:rect(1px, 1px, 1px, 1px);height:1px;width:1px;position:absolute;overflow:hidden;padding:0;white-space:nowrap"},ID=function(g){return hr("span",yr({css:PD},g))},mS=ID,DD={guidance:function(g){var l=g.isSearchable,c=g.isMulti,_=g.tabSelectsValue,A=g.context,N=g.isInitialFocus;switch(A){case"menu":return"Use Up and Down to choose options, press Enter to select the currently focused option, press Escape to exit the menu".concat(_?", press Tab to select the option and exit the menu":"",".");case"input":return N?"".concat(g["aria-label"]||"Select"," is focused ").concat(l?",type to refine list":"",", press Down to open the menu, ").concat(c?" press left to focus selected values":""):"";case"value":return"Use left and right to toggle between focused values, press Backspace to remove the currently focused value";default:return""}},onChange:function(g){var l=g.action,c=g.label,_=c===void 0?"":c,A=g.labels,N=g.isDisabled;switch(l){case"deselect-option":case"pop-value":case"remove-value":return"option ".concat(_,", deselected.");case"clear":return"All selected options have been cleared.";case"initial-input-focus":return"option".concat(A.length>1?"s":""," ").concat(A.join(","),", selected.");case"select-option":return N?"option ".concat(_," is disabled. Select another option."):"option ".concat(_,", selected.");default:return""}},onFocus:function(g){var l=g.context,c=g.focused,_=g.options,A=g.label,N=A===void 0?"":A,r=g.selectValue,q=g.isDisabled,ie=g.isSelected,ae=g.isAppleDevice,he=function(Pe,Ve){return Pe&&Pe.length?"".concat(Pe.indexOf(Ve)+1," of ").concat(Pe.length):""};if(l==="value"&&r)return"value ".concat(N," focused, ").concat(he(r,c),".");if(l==="menu"&&ae){var ve=q?" disabled":"",Ae="".concat(ie?" selected":"").concat(ve);return"".concat(N).concat(Ae,", ").concat(he(_,c),".")}return""},onFilter:function(g){var l=g.inputValue,c=g.resultsMessage;return"".concat(c).concat(l?" for search term "+l:"",".")}},kD=function(g){var l=g.ariaSelection,c=g.focusedOption,_=g.focusedValue,A=g.focusableOptions,N=g.isFocused,r=g.selectValue,q=g.selectProps,ie=g.id,ae=g.isAppleDevice,he=q.ariaLiveMessages,ve=q.getOptionLabel,Ae=q.inputValue,we=q.isMulti,Pe=q.isOptionDisabled,Ve=q.isSearchable,We=q.menuIsOpen,rt=q.options,ht=q.screenReaderStatus,tt=q.tabSelectsValue,at=q.isLoading,Rt=q["aria-label"],Ne=q["aria-live"],Tt=Ke.useMemo(function(){return vr(vr({},DD),he||{})},[he]),qt=Ke.useMemo(function(){var Mt="";if(l&&Tt.onChange){var zt=l.option,ii=l.options,Yt=l.removedValue,jt=l.removedValues,Ri=l.value,Yi=function(qr){return Array.isArray(qr)?null:qr},Wi=Yt||zt||Yi(Ri),vi=Wi?ve(Wi):"",Wr=ii||jt||void 0,an=Wr?Wr.map(ve):[],_n=vr({isDisabled:Wi&&Pe(Wi,r),label:vi,labels:an},l);Mt=Tt.onChange(_n)}return Mt},[l,Tt,Pe,r,ve]),Te=Ke.useMemo(function(){var Mt="",zt=c||_,ii=!!(c&&r&&r.includes(c));if(zt&&Tt.onFocus){var Yt={focused:zt,label:ve(zt),isDisabled:Pe(zt,r),isSelected:ii,options:A,context:zt===c?"menu":"value",selectValue:r,isAppleDevice:ae};Mt=Tt.onFocus(Yt)}return Mt},[c,_,ve,Pe,Tt,A,r,ae]),gt=Ke.useMemo(function(){var Mt="";if(We&&rt.length&&!at&&Tt.onFilter){var zt=ht({count:A.length});Mt=Tt.onFilter({inputValue:Ae,resultsMessage:zt})}return Mt},[A,Ae,We,Tt,rt,ht,at]),oi=(l==null?void 0:l.action)==="initial-input-focus",Ti=Ke.useMemo(function(){var Mt="";if(Tt.guidance){var zt=_?"value":We?"menu":"input";Mt=Tt.guidance({"aria-label":Rt,context:zt,isDisabled:c&&Pe(c,r),isMulti:we,isSearchable:Ve,tabSelectsValue:tt,isInitialFocus:oi})}return Mt},[Rt,c,_,we,Pe,Ve,We,Tt,r,tt,oi]),ni=hr(Ke.Fragment,null,hr("span",{id:"aria-selection"},qt),hr("span",{id:"aria-focused"},Te),hr("span",{id:"aria-results"},gt),hr("span",{id:"aria-guidance"},Ti));return hr(Ke.Fragment,null,hr(mS,{id:ie},oi&&ni),hr(mS,{"aria-live":Ne,"aria-atomic":"false","aria-relevant":"additions text",role:"log"},N&&!oi&&ni))},OD=kD,bx=[{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],LD=new RegExp("["+bx.map(function(m){return m.letters}).join("")+"]","g"),P2={};for(var Zv=0;Zv<bx.length;Zv++)for(var Kv=bx[Zv],Jv=0;Jv<Kv.letters.length;Jv++)P2[Kv.letters[Jv]]=Kv.base;var I2=function(g){return g.replace(LD,function(l){return P2[l]})},RD=AD(I2),gS=function(g){return g.replace(/^\s+|\s+$/g,"")},zD=function(g){return"".concat(g.label," ").concat(g.value)},FD=function(g){return function(l,c){if(l.data.__isNew__)return!0;var _=vr({ignoreCase:!0,ignoreAccents:!0,stringify:zD,trim:!0,matchFrom:"any"},g),A=_.ignoreCase,N=_.ignoreAccents,r=_.stringify,q=_.trim,ie=_.matchFrom,ae=q?gS(c):c,he=q?gS(r(l)):r(l);return A&&(ae=ae.toLowerCase(),he=he.toLowerCase()),N&&(ae=RD(ae),he=I2(he)),ie==="start"?he.substr(0,ae.length)===ae:he.indexOf(ae)>-1}},BD=["innerRef"];function ND(m){var g=m.innerRef,l=Lh(m,BD),c=hI(l,"onExited","in","enter","exit","appear");return hr("input",yr({ref:g},c,{css:r_({label:"dummyInput",background:0,border:0,caretColor:"transparent",fontSize:"inherit",gridArea:"1 / 1 / 2 / 3",outline:0,padding:0,width:1,color:"transparent",left:-100,opacity:0,position:"relative",transform:"scale(.01)"},"","")}))}var VD=function(g){g.cancelable&&g.preventDefault(),g.stopPropagation()};function UD(m){var g=m.isEnabled,l=m.onBottomArrive,c=m.onBottomLeave,_=m.onTopArrive,A=m.onTopLeave,N=Ke.useRef(!1),r=Ke.useRef(!1),q=Ke.useRef(0),ie=Ke.useRef(null),ae=Ke.useCallback(function(Ve,We){if(ie.current!==null){var rt=ie.current,ht=rt.scrollTop,tt=rt.scrollHeight,at=rt.clientHeight,Rt=ie.current,Ne=We>0,Tt=tt-at-ht,qt=!1;Tt>We&&N.current&&(c&&c(Ve),N.current=!1),Ne&&r.current&&(A&&A(Ve),r.current=!1),Ne&&We>Tt?(l&&!N.current&&l(Ve),Rt.scrollTop=tt,qt=!0,N.current=!0):!Ne&&-We>ht&&(_&&!r.current&&_(Ve),Rt.scrollTop=0,qt=!0,r.current=!0),qt&&VD(Ve)}},[l,c,_,A]),he=Ke.useCallback(function(Ve){ae(Ve,Ve.deltaY)},[ae]),ve=Ke.useCallback(function(Ve){q.current=Ve.changedTouches[0].clientY},[]),Ae=Ke.useCallback(function(Ve){var We=q.current-Ve.changedTouches[0].clientY;ae(Ve,We)},[ae]),we=Ke.useCallback(function(Ve){if(Ve){var We=lI?{passive:!1}:!1;Ve.addEventListener("wheel",he,We),Ve.addEventListener("touchstart",ve,We),Ve.addEventListener("touchmove",Ae,We)}},[Ae,ve,he]),Pe=Ke.useCallback(function(Ve){Ve&&(Ve.removeEventListener("wheel",he,!1),Ve.removeEventListener("touchstart",ve,!1),Ve.removeEventListener("touchmove",Ae,!1))},[Ae,ve,he]);return Ke.useEffect(function(){if(g){var Ve=ie.current;return we(Ve),function(){Pe(Ve)}}},[g,we,Pe]),function(Ve){ie.current=Ve}}var _S=["boxSizing","height","overflow","paddingRight","position"],yS={boxSizing:"border-box",overflow:"hidden",position:"relative",height:"100%"};function vS(m){m.cancelable&&m.preventDefault()}function xS(m){m.stopPropagation()}function bS(){var m=this.scrollTop,g=this.scrollHeight,l=m+this.offsetHeight;m===0?this.scrollTop=1:l===g&&(this.scrollTop=m-1)}function wS(){return"ontouchstart"in window||navigator.maxTouchPoints}var SS=!!(typeof window<"u"&&window.document&&window.document.createElement),Og=0,mm={capture:!1,passive:!1};function jD(m){var g=m.isEnabled,l=m.accountForScrollbars,c=l===void 0?!0:l,_=Ke.useRef({}),A=Ke.useRef(null),N=Ke.useCallback(function(q){if(SS){var ie=document.body,ae=ie&&ie.style;if(c&&_S.forEach(function(we){var Pe=ae&&ae[we];_.current[we]=Pe}),c&&Og<1){var he=parseInt(_.current.paddingRight,10)||0,ve=document.body?document.body.clientWidth:0,Ae=window.innerWidth-ve+he||0;Object.keys(yS).forEach(function(we){var Pe=yS[we];ae&&(ae[we]=Pe)}),ae&&(ae.paddingRight="".concat(Ae,"px"))}ie&&wS()&&(ie.addEventListener("touchmove",vS,mm),q&&(q.addEventListener("touchstart",bS,mm),q.addEventListener("touchmove",xS,mm))),Og+=1}},[c]),r=Ke.useCallback(function(q){if(SS){var ie=document.body,ae=ie&&ie.style;Og=Math.max(Og-1,0),c&&Og<1&&_S.forEach(function(he){var ve=_.current[he];ae&&(ae[he]=ve)}),ie&&wS()&&(ie.removeEventListener("touchmove",vS,mm),q&&(q.removeEventListener("touchstart",bS,mm),q.removeEventListener("touchmove",xS,mm)))}},[c]);return Ke.useEffect(function(){if(g){var q=A.current;return N(q),function(){r(q)}}},[g,N,r]),function(q){A.current=q}}var $D=function(g){var l=g.target;return l.ownerDocument.activeElement&&l.ownerDocument.activeElement.blur()},GD={name:"1kfdb0e",styles:"position:fixed;left:0;bottom:0;right:0;top:0"};function HD(m){var g=m.children,l=m.lockEnabled,c=m.captureEnabled,_=c===void 0?!0:c,A=m.onBottomArrive,N=m.onBottomLeave,r=m.onTopArrive,q=m.onTopLeave,ie=UD({isEnabled:_,onBottomArrive:A,onBottomLeave:N,onTopArrive:r,onTopLeave:q}),ae=jD({isEnabled:l}),he=function(Ae){ie(Ae),ae(Ae)};return hr(Ke.Fragment,null,l&&hr("div",{onClick:$D,css:GD}),g(he))}var WD={name:"1a0ro4n-requiredInput",styles:"label:requiredInput;opacity:0;pointer-events:none;position:absolute;bottom:0;left:0;right:0;width:100%"},qD=function(g){var l=g.name,c=g.onFocus;return hr("input",{required:!0,name:l,tabIndex:-1,"aria-hidden":"true",onFocus:c,css:WD,value:"",onChange:function(){}})},YD=qD;function Yx(m){var g;return typeof window<"u"&&window.navigator!=null?m.test(((g=window.navigator.userAgentData)===null||g===void 0?void 0:g.platform)||window.navigator.platform):!1}function XD(){return Yx(/^iPhone/i)}function D2(){return Yx(/^Mac/i)}function ZD(){return Yx(/^iPad/i)||D2()&&navigator.maxTouchPoints>1}function KD(){return XD()||ZD()}function JD(){return D2()||KD()}var QD=function(g){return g.label},ek=function(g){return g.label},tk=function(g){return g.value},ik=function(g){return!!g.isDisabled},rk={clearIndicator:NI,container:AI,control:WI,dropdownIndicator:FI,group:ZI,groupHeading:JI,indicatorsContainer:kI,indicatorSeparator:UI,input:iD,loadingIndicator:GI,loadingMessage:SI,menu:gI,menuList:xI,menuPortal:EI,multiValue:aD,multiValueLabel:lD,multiValueRemove:cD,noOptionsMessage:wI,option:mD,placeholder:yD,singleValue:bD,valueContainer:II},nk={primary:"#2684FF",primary75:"#4C9AFF",primary50:"#B2D4FF",primary25:"#DEEBFF",danger:"#DE350B",dangerLight:"#FFBDAD",neutral0:"hsl(0, 0%, 100%)",neutral5:"hsl(0, 0%, 95%)",neutral10:"hsl(0, 0%, 90%)",neutral20:"hsl(0, 0%, 80%)",neutral30:"hsl(0, 0%, 70%)",neutral40:"hsl(0, 0%, 60%)",neutral50:"hsl(0, 0%, 50%)",neutral60:"hsl(0, 0%, 40%)",neutral70:"hsl(0, 0%, 30%)",neutral80:"hsl(0, 0%, 20%)",neutral90:"hsl(0, 0%, 10%)"},sk=4,k2=4,ok=38,ak=k2*2,lk={baseUnit:k2,controlHeight:ok,menuGutter:ak},Qv={borderRadius:sk,colors:nk,spacing:lk},ck={"aria-live":"polite",backspaceRemovesValue:!0,blurInputOnSelect:dS(),captureMenuScroll:!dS(),classNames:{},closeMenuOnSelect:!0,closeMenuOnScroll:!1,components:{},controlShouldRenderValue:!0,escapeClearsValue:!1,filterOption:FD(),formatGroupLabel:QD,getOptionLabel:ek,getOptionValue:tk,isDisabled:!1,isLoading:!1,isMulti:!1,isRtl:!1,isSearchable:!0,isOptionDisabled:ik,loadingMessage:function(){return"Loading..."},maxMenuHeight:300,minMenuHeight:140,menuIsOpen:!1,menuPlacement:"bottom",menuPosition:"absolute",menuShouldBlockScroll:!1,menuShouldScrollIntoView:!oI(),noOptionsMessage:function(){return"No options"},openMenuOnFocus:!1,openMenuOnClick:!0,options:[],pageSize:5,placeholder:"Select...",screenReaderStatus:function(g){var l=g.count;return"".concat(l," result").concat(l!==1?"s":""," available")},styles:{},tabIndex:0,tabSelectsValue:!0,unstyled:!1};function TS(m,g,l,c){var _=R2(m,g,l),A=z2(m,g,l),N=L2(m,g),r=qy(m,g);return{type:"option",data:g,isDisabled:_,isSelected:A,label:N,value:r,index:c}}function Ey(m,g){return m.options.map(function(l,c){if("options"in l){var _=l.options.map(function(N,r){return TS(m,N,g,r)}).filter(function(N){return ES(m,N)});return _.length>0?{type:"group",data:l,options:_,index:c}:void 0}var A=TS(m,l,g,c);return ES(m,A)?A:void 0}).filter(cI)}function O2(m){return m.reduce(function(g,l){return l.type==="group"?g.push.apply(g,Rx(l.options.map(function(c){return c.data}))):g.push(l.data),g},[])}function MS(m,g){return m.reduce(function(l,c){return c.type==="group"?l.push.apply(l,Rx(c.options.map(function(_){return{data:_.data,id:"".concat(g,"-").concat(c.index,"-").concat(_.index)}}))):l.push({data:c.data,id:"".concat(g,"-").concat(c.index)}),l},[])}function uk(m,g){return O2(Ey(m,g))}function ES(m,g){var l=m.inputValue,c=l===void 0?"":l,_=g.data,A=g.isSelected,N=g.label,r=g.value;return(!B2(m)||!A)&&F2(m,{label:N,value:r,data:_},c)}function hk(m,g){var l=m.focusedValue,c=m.selectValue,_=c.indexOf(l);if(_>-1){var A=g.indexOf(l);if(A>-1)return l;if(_<g.length)return g[_]}return null}function dk(m,g){var l=m.focusedOption;return l&&g.indexOf(l)>-1?l:g[0]}var ex=function(g,l){var c,_=(c=g.find(function(A){return A.data===l}))===null||c===void 0?void 0:c.id;return _||null},L2=function(g,l){return g.getOptionLabel(l)},qy=function(g,l){return g.getOptionValue(l)};function R2(m,g,l){return typeof m.isOptionDisabled=="function"?m.isOptionDisabled(g,l):!1}function z2(m,g,l){if(l.indexOf(g)>-1)return!0;if(typeof m.isOptionSelected=="function")return m.isOptionSelected(g,l);var c=qy(m,g);return l.some(function(_){return qy(m,_)===c})}function F2(m,g,l){return m.filterOption?m.filterOption(g,l):!0}var B2=function(g){var l=g.hideSelectedOptions,c=g.isMulti;return l===void 0?c:l},pk=1,N2=function(m){bA(l,m);var g=SA(l);function l(c){var _;if(vA(this,l),_=g.call(this,c),_.state={ariaSelection:null,focusedOption:null,focusedOptionId:null,focusableOptionsWithIds:[],focusedValue:null,inputIsHidden:!1,isFocused:!1,selectValue:[],clearFocusValueOnUpdate:!1,prevWasFocused:!1,inputIsHiddenAfterUpdate:void 0,prevProps:void 0,instancePrefix:""},_.blockOptionHover=!1,_.isComposing=!1,_.commonProps=void 0,_.initialTouchX=0,_.initialTouchY=0,_.openAfterFocus=!1,_.scrollToFocusedOptionOnUpdate=!1,_.userIsDragging=void 0,_.isAppleDevice=JD(),_.controlRef=null,_.getControlRef=function(q){_.controlRef=q},_.focusedOptionRef=null,_.getFocusedOptionRef=function(q){_.focusedOptionRef=q},_.menuListRef=null,_.getMenuListRef=function(q){_.menuListRef=q},_.inputRef=null,_.getInputRef=function(q){_.inputRef=q},_.focus=_.focusInput,_.blur=_.blurInput,_.onChange=function(q,ie){var ae=_.props,he=ae.onChange,ve=ae.name;ie.name=ve,_.ariaOnChange(q,ie),he(q,ie)},_.setValue=function(q,ie,ae){var he=_.props,ve=he.closeMenuOnSelect,Ae=he.isMulti,we=he.inputValue;_.onInputChange("",{action:"set-value",prevInputValue:we}),ve&&(_.setState({inputIsHiddenAfterUpdate:!Ae}),_.onMenuClose()),_.setState({clearFocusValueOnUpdate:!0}),_.onChange(q,{action:ie,option:ae})},_.selectOption=function(q){var ie=_.props,ae=ie.blurInputOnSelect,he=ie.isMulti,ve=ie.name,Ae=_.state.selectValue,we=he&&_.isOptionSelected(q,Ae),Pe=_.isOptionDisabled(q,Ae);if(we){var Ve=_.getOptionValue(q);_.setValue(Ae.filter(function(We){return _.getOptionValue(We)!==Ve}),"deselect-option",q)}else if(!Pe)he?_.setValue([].concat(Rx(Ae),[q]),"select-option",q):_.setValue(q,"select-option");else{_.ariaOnChange(q,{action:"select-option",option:q,name:ve});return}ae&&_.blurInput()},_.removeValue=function(q){var ie=_.props.isMulti,ae=_.state.selectValue,he=_.getOptionValue(q),ve=ae.filter(function(we){return _.getOptionValue(we)!==he}),Ae=py(ie,ve,ve[0]||null);_.onChange(Ae,{action:"remove-value",removedValue:q}),_.focusInput()},_.clearValue=function(){var q=_.state.selectValue;_.onChange(py(_.props.isMulti,[],null),{action:"clear",removedValues:q})},_.popValue=function(){var q=_.props.isMulti,ie=_.state.selectValue,ae=ie[ie.length-1],he=ie.slice(0,ie.length-1),ve=py(q,he,he[0]||null);ae&&_.onChange(ve,{action:"pop-value",removedValue:ae})},_.getFocusedOptionId=function(q){return ex(_.state.focusableOptionsWithIds,q)},_.getFocusableOptionsWithIds=function(){return MS(Ey(_.props,_.state.selectValue),_.getElementId("option"))},_.getValue=function(){return _.state.selectValue},_.cx=function(){for(var q=arguments.length,ie=new Array(q),ae=0;ae<q;ae++)ie[ae]=arguments[ae];return tI.apply(void 0,[_.props.classNamePrefix].concat(ie))},_.getOptionLabel=function(q){return L2(_.props,q)},_.getOptionValue=function(q){return qy(_.props,q)},_.getStyles=function(q,ie){var ae=_.props.unstyled,he=rk[q](ie,ae);he.boxSizing="border-box";var ve=_.props.styles[q];return ve?ve(he,ie):he},_.getClassNames=function(q,ie){var ae,he;return(ae=(he=_.props.classNames)[q])===null||ae===void 0?void 0:ae.call(he,ie)},_.getElementId=function(q){return"".concat(_.state.instancePrefix,"-").concat(q)},_.getComponents=function(){return MD(_.props)},_.buildCategorizedOptions=function(){return Ey(_.props,_.state.selectValue)},_.getCategorizedOptions=function(){return _.props.menuIsOpen?_.buildCategorizedOptions():[]},_.buildFocusableOptions=function(){return O2(_.buildCategorizedOptions())},_.getFocusableOptions=function(){return _.props.menuIsOpen?_.buildFocusableOptions():[]},_.ariaOnChange=function(q,ie){_.setState({ariaSelection:vr({value:q},ie)})},_.onMenuMouseDown=function(q){q.button===0&&(q.stopPropagation(),q.preventDefault(),_.focusInput())},_.onMenuMouseMove=function(q){_.blockOptionHover=!1},_.onControlMouseDown=function(q){if(!q.defaultPrevented){var ie=_.props.openMenuOnClick;_.state.isFocused?_.props.menuIsOpen?q.target.tagName!=="INPUT"&&q.target.tagName!=="TEXTAREA"&&_.onMenuClose():ie&&_.openMenu("first"):(ie&&(_.openAfterFocus=!0),_.focusInput()),q.target.tagName!=="INPUT"&&q.target.tagName!=="TEXTAREA"&&q.preventDefault()}},_.onDropdownIndicatorMouseDown=function(q){if(!(q&&q.type==="mousedown"&&q.button!==0)&&!_.props.isDisabled){var ie=_.props,ae=ie.isMulti,he=ie.menuIsOpen;_.focusInput(),he?(_.setState({inputIsHiddenAfterUpdate:!ae}),_.onMenuClose()):_.openMenu("first"),q.preventDefault()}},_.onClearIndicatorMouseDown=function(q){q&&q.type==="mousedown"&&q.button!==0||(_.clearValue(),q.preventDefault(),_.openAfterFocus=!1,q.type==="touchend"?_.focusInput():setTimeout(function(){return _.focusInput()}))},_.onScroll=function(q){typeof _.props.closeMenuOnScroll=="boolean"?q.target instanceof HTMLElement&&g0(q.target)&&_.props.onMenuClose():typeof _.props.closeMenuOnScroll=="function"&&_.props.closeMenuOnScroll(q)&&_.props.onMenuClose()},_.onCompositionStart=function(){_.isComposing=!0},_.onCompositionEnd=function(){_.isComposing=!1},_.onTouchStart=function(q){var ie=q.touches,ae=ie&&ie.item(0);ae&&(_.initialTouchX=ae.clientX,_.initialTouchY=ae.clientY,_.userIsDragging=!1)},_.onTouchMove=function(q){var ie=q.touches,ae=ie&&ie.item(0);if(ae){var he=Math.abs(ae.clientX-_.initialTouchX),ve=Math.abs(ae.clientY-_.initialTouchY),Ae=5;_.userIsDragging=he>Ae||ve>Ae}},_.onTouchEnd=function(q){_.userIsDragging||(_.controlRef&&!_.controlRef.contains(q.target)&&_.menuListRef&&!_.menuListRef.contains(q.target)&&_.blurInput(),_.initialTouchX=0,_.initialTouchY=0)},_.onControlTouchEnd=function(q){_.userIsDragging||_.onControlMouseDown(q)},_.onClearIndicatorTouchEnd=function(q){_.userIsDragging||_.onClearIndicatorMouseDown(q)},_.onDropdownIndicatorTouchEnd=function(q){_.userIsDragging||_.onDropdownIndicatorMouseDown(q)},_.handleInputChange=function(q){var ie=_.props.inputValue,ae=q.currentTarget.value;_.setState({inputIsHiddenAfterUpdate:!1}),_.onInputChange(ae,{action:"input-change",prevInputValue:ie}),_.props.menuIsOpen||_.onMenuOpen()},_.onInputFocus=function(q){_.props.onFocus&&_.props.onFocus(q),_.setState({inputIsHiddenAfterUpdate:!1,isFocused:!0}),(_.openAfterFocus||_.props.openMenuOnFocus)&&_.openMenu("first"),_.openAfterFocus=!1},_.onInputBlur=function(q){var ie=_.props.inputValue;if(_.menuListRef&&_.menuListRef.contains(document.activeElement)){_.inputRef.focus();return}_.props.onBlur&&_.props.onBlur(q),_.onInputChange("",{action:"input-blur",prevInputValue:ie}),_.onMenuClose(),_.setState({focusedValue:null,isFocused:!1})},_.onOptionHover=function(q){if(!(_.blockOptionHover||_.state.focusedOption===q)){var ie=_.getFocusableOptions(),ae=ie.indexOf(q);_.setState({focusedOption:q,focusedOptionId:ae>-1?_.getFocusedOptionId(q):null})}},_.shouldHideSelectedOptions=function(){return B2(_.props)},_.onValueInputFocus=function(q){q.preventDefault(),q.stopPropagation(),_.focus()},_.onKeyDown=function(q){var ie=_.props,ae=ie.isMulti,he=ie.backspaceRemovesValue,ve=ie.escapeClearsValue,Ae=ie.inputValue,we=ie.isClearable,Pe=ie.isDisabled,Ve=ie.menuIsOpen,We=ie.onKeyDown,rt=ie.tabSelectsValue,ht=ie.openMenuOnFocus,tt=_.state,at=tt.focusedOption,Rt=tt.focusedValue,Ne=tt.selectValue;if(!Pe&&!(typeof We=="function"&&(We(q),q.defaultPrevented))){switch(_.blockOptionHover=!0,q.key){case"ArrowLeft":if(!ae||Ae)return;_.focusValue("previous");break;case"ArrowRight":if(!ae||Ae)return;_.focusValue("next");break;case"Delete":case"Backspace":if(Ae)return;if(Rt)_.removeValue(Rt);else{if(!he)return;ae?_.popValue():we&&_.clearValue()}break;case"Tab":if(_.isComposing||q.shiftKey||!Ve||!rt||!at||ht&&_.isOptionSelected(at,Ne))return;_.selectOption(at);break;case"Enter":if(q.keyCode===229)break;if(Ve){if(!at||_.isComposing)return;_.selectOption(at);break}return;case"Escape":Ve?(_.setState({inputIsHiddenAfterUpdate:!1}),_.onInputChange("",{action:"menu-close",prevInputValue:Ae}),_.onMenuClose()):we&&ve&&_.clearValue();break;case" ":if(Ae)return;if(!Ve){_.openMenu("first");break}if(!at)return;_.selectOption(at);break;case"ArrowUp":Ve?_.focusOption("up"):_.openMenu("last");break;case"ArrowDown":Ve?_.focusOption("down"):_.openMenu("first");break;case"PageUp":if(!Ve)return;_.focusOption("pageup");break;case"PageDown":if(!Ve)return;_.focusOption("pagedown");break;case"Home":if(!Ve)return;_.focusOption("first");break;case"End":if(!Ve)return;_.focusOption("last");break;default:return}q.preventDefault()}},_.state.instancePrefix="react-select-"+(_.props.instanceId||++pk),_.state.selectValue=uS(c.value),c.menuIsOpen&&_.state.selectValue.length){var A=_.getFocusableOptionsWithIds(),N=_.buildFocusableOptions(),r=N.indexOf(_.state.selectValue[0]);_.state.focusableOptionsWithIds=A,_.state.focusedOption=N[r],_.state.focusedOptionId=ex(A,N[r])}return _}return xA(l,[{key:"componentDidMount",value:function(){this.startListeningComposition(),this.startListeningToTouch(),this.props.closeMenuOnScroll&&document&&document.addEventListener&&document.addEventListener("scroll",this.onScroll,!0),this.props.autoFocus&&this.focusInput(),this.props.menuIsOpen&&this.state.focusedOption&&this.menuListRef&&this.focusedOptionRef&&hS(this.menuListRef,this.focusedOptionRef)}},{key:"componentDidUpdate",value:function(_){var A=this.props,N=A.isDisabled,r=A.menuIsOpen,q=this.state.isFocused;(q&&!N&&_.isDisabled||q&&r&&!_.menuIsOpen)&&this.focusInput(),q&&N&&!_.isDisabled?this.setState({isFocused:!1},this.onMenuClose):!q&&!N&&_.isDisabled&&this.inputRef===document.activeElement&&this.setState({isFocused:!0}),this.menuListRef&&this.focusedOptionRef&&this.scrollToFocusedOptionOnUpdate&&(hS(this.menuListRef,this.focusedOptionRef),this.scrollToFocusedOptionOnUpdate=!1)}},{key:"componentWillUnmount",value:function(){this.stopListeningComposition(),this.stopListeningToTouch(),document.removeEventListener("scroll",this.onScroll,!0)}},{key:"onMenuOpen",value:function(){this.props.onMenuOpen()}},{key:"onMenuClose",value:function(){this.onInputChange("",{action:"menu-close",prevInputValue:this.props.inputValue}),this.props.onMenuClose()}},{key:"onInputChange",value:function(_,A){this.props.onInputChange(_,A)}},{key:"focusInput",value:function(){this.inputRef&&this.inputRef.focus()}},{key:"blurInput",value:function(){this.inputRef&&this.inputRef.blur()}},{key:"openMenu",value:function(_){var A=this,N=this.state,r=N.selectValue,q=N.isFocused,ie=this.buildFocusableOptions(),ae=_==="first"?0:ie.length-1;if(!this.props.isMulti){var he=ie.indexOf(r[0]);he>-1&&(ae=he)}this.scrollToFocusedOptionOnUpdate=!(q&&this.menuListRef),this.setState({inputIsHiddenAfterUpdate:!1,focusedValue:null,focusedOption:ie[ae],focusedOptionId:this.getFocusedOptionId(ie[ae])},function(){return A.onMenuOpen()})}},{key:"focusValue",value:function(_){var A=this.state,N=A.selectValue,r=A.focusedValue;if(this.props.isMulti){this.setState({focusedOption:null});var q=N.indexOf(r);r||(q=-1);var ie=N.length-1,ae=-1;if(N.length){switch(_){case"previous":q===0?ae=0:q===-1?ae=ie:ae=q-1;break;case"next":q>-1&&q<ie&&(ae=q+1);break}this.setState({inputIsHidden:ae!==-1,focusedValue:N[ae]})}}}},{key:"focusOption",value:function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"first",A=this.props.pageSize,N=this.state.focusedOption,r=this.getFocusableOptions();if(r.length){var q=0,ie=r.indexOf(N);N||(ie=-1),_==="up"?q=ie>0?ie-1:r.length-1:_==="down"?q=(ie+1)%r.length:_==="pageup"?(q=ie-A,q<0&&(q=0)):_==="pagedown"?(q=ie+A,q>r.length-1&&(q=r.length-1)):_==="last"&&(q=r.length-1),this.scrollToFocusedOptionOnUpdate=!0,this.setState({focusedOption:r[q],focusedValue:null,focusedOptionId:this.getFocusedOptionId(r[q])})}}},{key:"getTheme",value:function(){return this.props.theme?typeof this.props.theme=="function"?this.props.theme(Qv):vr(vr({},Qv),this.props.theme):Qv}},{key:"getCommonProps",value:function(){var _=this.clearValue,A=this.cx,N=this.getStyles,r=this.getClassNames,q=this.getValue,ie=this.selectOption,ae=this.setValue,he=this.props,ve=he.isMulti,Ae=he.isRtl,we=he.options,Pe=this.hasValue();return{clearValue:_,cx:A,getStyles:N,getClassNames:r,getValue:q,hasValue:Pe,isMulti:ve,isRtl:Ae,options:we,selectOption:ie,selectProps:he,setValue:ae,theme:this.getTheme()}}},{key:"hasValue",value:function(){var _=this.state.selectValue;return _.length>0}},{key:"hasOptions",value:function(){return!!this.getFocusableOptions().length}},{key:"isClearable",value:function(){var _=this.props,A=_.isClearable,N=_.isMulti;return A===void 0?N:A}},{key:"isOptionDisabled",value:function(_,A){return R2(this.props,_,A)}},{key:"isOptionSelected",value:function(_,A){return z2(this.props,_,A)}},{key:"filterOption",value:function(_,A){return F2(this.props,_,A)}},{key:"formatOptionLabel",value:function(_,A){if(typeof this.props.formatOptionLabel=="function"){var N=this.props.inputValue,r=this.state.selectValue;return this.props.formatOptionLabel(_,{context:A,inputValue:N,selectValue:r})}else return this.getOptionLabel(_)}},{key:"formatGroupLabel",value:function(_){return this.props.formatGroupLabel(_)}},{key:"startListeningComposition",value:function(){document&&document.addEventListener&&(document.addEventListener("compositionstart",this.onCompositionStart,!1),document.addEventListener("compositionend",this.onCompositionEnd,!1))}},{key:"stopListeningComposition",value:function(){document&&document.removeEventListener&&(document.removeEventListener("compositionstart",this.onCompositionStart),document.removeEventListener("compositionend",this.onCompositionEnd))}},{key:"startListeningToTouch",value:function(){document&&document.addEventListener&&(document.addEventListener("touchstart",this.onTouchStart,!1),document.addEventListener("touchmove",this.onTouchMove,!1),document.addEventListener("touchend",this.onTouchEnd,!1))}},{key:"stopListeningToTouch",value:function(){document&&document.removeEventListener&&(document.removeEventListener("touchstart",this.onTouchStart),document.removeEventListener("touchmove",this.onTouchMove),document.removeEventListener("touchend",this.onTouchEnd))}},{key:"renderInput",value:function(){var _=this.props,A=_.isDisabled,N=_.isSearchable,r=_.inputId,q=_.inputValue,ie=_.tabIndex,ae=_.form,he=_.menuIsOpen,ve=_.required,Ae=this.getComponents(),we=Ae.Input,Pe=this.state,Ve=Pe.inputIsHidden,We=Pe.ariaSelection,rt=this.commonProps,ht=r||this.getElementId("input"),tt=vr(vr(vr({"aria-autocomplete":"list","aria-expanded":he,"aria-haspopup":!0,"aria-errormessage":this.props["aria-errormessage"],"aria-invalid":this.props["aria-invalid"],"aria-label":this.props["aria-label"],"aria-labelledby":this.props["aria-labelledby"],"aria-required":ve,role:"combobox","aria-activedescendant":this.isAppleDevice?void 0:this.state.focusedOptionId||""},he&&{"aria-controls":this.getElementId("listbox")}),!N&&{"aria-readonly":!0}),this.hasValue()?(We==null?void 0:We.action)==="initial-input-focus"&&{"aria-describedby":this.getElementId("live-region")}:{"aria-describedby":this.getElementId("placeholder")});return N?Ke.createElement(we,yr({},rt,{autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",id:ht,innerRef:this.getInputRef,isDisabled:A,isHidden:Ve,onBlur:this.onInputBlur,onChange:this.handleInputChange,onFocus:this.onInputFocus,spellCheck:"false",tabIndex:ie,form:ae,type:"text",value:q},tt)):Ke.createElement(ND,yr({id:ht,innerRef:this.getInputRef,onBlur:this.onInputBlur,onChange:Hy,onFocus:this.onInputFocus,disabled:A,tabIndex:ie,inputMode:"none",form:ae,value:""},tt))}},{key:"renderPlaceholderOrValue",value:function(){var _=this,A=this.getComponents(),N=A.MultiValue,r=A.MultiValueContainer,q=A.MultiValueLabel,ie=A.MultiValueRemove,ae=A.SingleValue,he=A.Placeholder,ve=this.commonProps,Ae=this.props,we=Ae.controlShouldRenderValue,Pe=Ae.isDisabled,Ve=Ae.isMulti,We=Ae.inputValue,rt=Ae.placeholder,ht=this.state,tt=ht.selectValue,at=ht.focusedValue,Rt=ht.isFocused;if(!this.hasValue()||!we)return We?null:Ke.createElement(he,yr({},ve,{key:"placeholder",isDisabled:Pe,isFocused:Rt,innerProps:{id:this.getElementId("placeholder")}}),rt);if(Ve)return tt.map(function(Tt,qt){var Te=Tt===at,gt="".concat(_.getOptionLabel(Tt),"-").concat(_.getOptionValue(Tt));return Ke.createElement(N,yr({},ve,{components:{Container:r,Label:q,Remove:ie},isFocused:Te,isDisabled:Pe,key:gt,index:qt,removeProps:{onClick:function(){return _.removeValue(Tt)},onTouchEnd:function(){return _.removeValue(Tt)},onMouseDown:function(Ti){Ti.preventDefault()}},data:Tt}),_.formatOptionLabel(Tt,"value"))});if(We)return null;var Ne=tt[0];return Ke.createElement(ae,yr({},ve,{data:Ne,isDisabled:Pe}),this.formatOptionLabel(Ne,"value"))}},{key:"renderClearIndicator",value:function(){var _=this.getComponents(),A=_.ClearIndicator,N=this.commonProps,r=this.props,q=r.isDisabled,ie=r.isLoading,ae=this.state.isFocused;if(!this.isClearable()||!A||q||!this.hasValue()||ie)return null;var he={onMouseDown:this.onClearIndicatorMouseDown,onTouchEnd:this.onClearIndicatorTouchEnd,"aria-hidden":"true"};return Ke.createElement(A,yr({},N,{innerProps:he,isFocused:ae}))}},{key:"renderLoadingIndicator",value:function(){var _=this.getComponents(),A=_.LoadingIndicator,N=this.commonProps,r=this.props,q=r.isDisabled,ie=r.isLoading,ae=this.state.isFocused;if(!A||!ie)return null;var he={"aria-hidden":"true"};return Ke.createElement(A,yr({},N,{innerProps:he,isDisabled:q,isFocused:ae}))}},{key:"renderIndicatorSeparator",value:function(){var _=this.getComponents(),A=_.DropdownIndicator,N=_.IndicatorSeparator;if(!A||!N)return null;var r=this.commonProps,q=this.props.isDisabled,ie=this.state.isFocused;return Ke.createElement(N,yr({},r,{isDisabled:q,isFocused:ie}))}},{key:"renderDropdownIndicator",value:function(){var _=this.getComponents(),A=_.DropdownIndicator;if(!A)return null;var N=this.commonProps,r=this.props.isDisabled,q=this.state.isFocused,ie={onMouseDown:this.onDropdownIndicatorMouseDown,onTouchEnd:this.onDropdownIndicatorTouchEnd,"aria-hidden":"true"};return Ke.createElement(A,yr({},N,{innerProps:ie,isDisabled:r,isFocused:q}))}},{key:"renderMenu",value:function(){var _=this,A=this.getComponents(),N=A.Group,r=A.GroupHeading,q=A.Menu,ie=A.MenuList,ae=A.MenuPortal,he=A.LoadingMessage,ve=A.NoOptionsMessage,Ae=A.Option,we=this.commonProps,Pe=this.state.focusedOption,Ve=this.props,We=Ve.captureMenuScroll,rt=Ve.inputValue,ht=Ve.isLoading,tt=Ve.loadingMessage,at=Ve.minMenuHeight,Rt=Ve.maxMenuHeight,Ne=Ve.menuIsOpen,Tt=Ve.menuPlacement,qt=Ve.menuPosition,Te=Ve.menuPortalTarget,gt=Ve.menuShouldBlockScroll,oi=Ve.menuShouldScrollIntoView,Ti=Ve.noOptionsMessage,ni=Ve.onMenuScrollToTop,Mt=Ve.onMenuScrollToBottom;if(!Ne)return null;var zt=function(vi,Wr){var an=vi.type,_n=vi.data,Cn=vi.isDisabled,qr=vi.isSelected,es=vi.label,Ye=vi.value,ds=Pe===_n,Bi=Cn?void 0:function(){return _.onOptionHover(_n)},Xs=Cn?void 0:function(){return _.selectOption(_n)},Wt="".concat(_.getElementId("option"),"-").concat(Wr),jn={id:Wt,onClick:Xs,onMouseMove:Bi,onMouseOver:Bi,tabIndex:-1,role:"option","aria-selected":_.isAppleDevice?void 0:qr};return Ke.createElement(Ae,yr({},we,{innerProps:jn,data:_n,isDisabled:Cn,isSelected:qr,key:Wt,label:es,type:an,value:Ye,isFocused:ds,innerRef:ds?_.getFocusedOptionRef:void 0}),_.formatOptionLabel(vi.data,"menu"))},ii;if(this.hasOptions())ii=this.getCategorizedOptions().map(function(Wi){if(Wi.type==="group"){var vi=Wi.data,Wr=Wi.options,an=Wi.index,_n="".concat(_.getElementId("group"),"-").concat(an),Cn="".concat(_n,"-heading");return Ke.createElement(N,yr({},we,{key:_n,data:vi,options:Wr,Heading:r,headingProps:{id:Cn,data:Wi.data},label:_.formatGroupLabel(Wi.data)}),Wi.options.map(function(qr){return zt(qr,"".concat(an,"-").concat(qr.index))}))}else if(Wi.type==="option")return zt(Wi,"".concat(Wi.index))});else if(ht){var Yt=tt({inputValue:rt});if(Yt===null)return null;ii=Ke.createElement(he,we,Yt)}else{var jt=Ti({inputValue:rt});if(jt===null)return null;ii=Ke.createElement(ve,we,jt)}var Ri={minMenuHeight:at,maxMenuHeight:Rt,menuPlacement:Tt,menuPosition:qt,menuShouldScrollIntoView:oi},Yi=Ke.createElement(_I,yr({},we,Ri),function(Wi){var vi=Wi.ref,Wr=Wi.placerProps,an=Wr.placement,_n=Wr.maxHeight;return Ke.createElement(q,yr({},we,Ri,{innerRef:vi,innerProps:{onMouseDown:_.onMenuMouseDown,onMouseMove:_.onMenuMouseMove},isLoading:ht,placement:an}),Ke.createElement(HD,{captureEnabled:We,onTopArrive:ni,onBottomArrive:Mt,lockEnabled:gt},function(Cn){return Ke.createElement(ie,yr({},we,{innerRef:function(es){_.getMenuListRef(es),Cn(es)},innerProps:{role:"listbox","aria-multiselectable":we.isMulti,id:_.getElementId("listbox")},isLoading:ht,maxHeight:_n,focusedOption:Pe}),ii)}))});return Te||qt==="fixed"?Ke.createElement(ae,yr({},we,{appendTo:Te,controlElement:this.controlRef,menuPlacement:Tt,menuPosition:qt}),Yi):Yi}},{key:"renderFormField",value:function(){var _=this,A=this.props,N=A.delimiter,r=A.isDisabled,q=A.isMulti,ie=A.name,ae=A.required,he=this.state.selectValue;if(ae&&!this.hasValue()&&!r)return Ke.createElement(YD,{name:ie,onFocus:this.onValueInputFocus});if(!(!ie||r))if(q)if(N){var ve=he.map(function(Pe){return _.getOptionValue(Pe)}).join(N);return Ke.createElement("input",{name:ie,type:"hidden",value:ve})}else{var Ae=he.length>0?he.map(function(Pe,Ve){return Ke.createElement("input",{key:"i-".concat(Ve),name:ie,type:"hidden",value:_.getOptionValue(Pe)})}):Ke.createElement("input",{name:ie,type:"hidden",value:""});return Ke.createElement("div",null,Ae)}else{var we=he[0]?this.getOptionValue(he[0]):"";return Ke.createElement("input",{name:ie,type:"hidden",value:we})}}},{key:"renderLiveRegion",value:function(){var _=this.commonProps,A=this.state,N=A.ariaSelection,r=A.focusedOption,q=A.focusedValue,ie=A.isFocused,ae=A.selectValue,he=this.getFocusableOptions();return Ke.createElement(OD,yr({},_,{id:this.getElementId("live-region"),ariaSelection:N,focusedOption:r,focusedValue:q,isFocused:ie,selectValue:ae,focusableOptions:he,isAppleDevice:this.isAppleDevice}))}},{key:"render",value:function(){var _=this.getComponents(),A=_.Control,N=_.IndicatorsContainer,r=_.SelectContainer,q=_.ValueContainer,ie=this.props,ae=ie.className,he=ie.id,ve=ie.isDisabled,Ae=ie.menuIsOpen,we=this.state.isFocused,Pe=this.commonProps=this.getCommonProps();return Ke.createElement(r,yr({},Pe,{className:ae,innerProps:{id:he,onKeyDown:this.onKeyDown},isDisabled:ve,isFocused:we}),this.renderLiveRegion(),Ke.createElement(A,yr({},Pe,{innerRef:this.getControlRef,innerProps:{onMouseDown:this.onControlMouseDown,onTouchEnd:this.onControlTouchEnd},isDisabled:ve,isFocused:we,menuIsOpen:Ae}),Ke.createElement(q,yr({},Pe,{isDisabled:ve}),this.renderPlaceholderOrValue(),this.renderInput()),Ke.createElement(N,yr({},Pe,{isDisabled:ve}),this.renderClearIndicator(),this.renderLoadingIndicator(),this.renderIndicatorSeparator(),this.renderDropdownIndicator())),this.renderMenu(),this.renderFormField())}}],[{key:"getDerivedStateFromProps",value:function(_,A){var N=A.prevProps,r=A.clearFocusValueOnUpdate,q=A.inputIsHiddenAfterUpdate,ie=A.ariaSelection,ae=A.isFocused,he=A.prevWasFocused,ve=A.instancePrefix,Ae=_.options,we=_.value,Pe=_.menuIsOpen,Ve=_.inputValue,We=_.isMulti,rt=uS(we),ht={};if(N&&(we!==N.value||Ae!==N.options||Pe!==N.menuIsOpen||Ve!==N.inputValue)){var tt=Pe?uk(_,rt):[],at=Pe?MS(Ey(_,rt),"".concat(ve,"-option")):[],Rt=r?hk(A,rt):null,Ne=dk(A,tt),Tt=ex(at,Ne);ht={selectValue:rt,focusedOption:Ne,focusedOptionId:Tt,focusableOptionsWithIds:at,focusedValue:Rt,clearFocusValueOnUpdate:!1}}var qt=q!=null&&_!==N?{inputIsHidden:q,inputIsHiddenAfterUpdate:void 0}:{},Te=ie,gt=ae&&he;return ae&&!gt&&(Te={value:py(We,rt,rt[0]||null),options:rt,action:"initial-input-focus"},gt=!he),(ie==null?void 0:ie.action)==="initial-input-focus"&&(Te=null),vr(vr(vr({},ht),qt),{},{prevProps:_,ariaSelection:Te,prevWasFocused:gt})}}]),l}(Ke.Component);N2.defaultProps=ck;var fk=Ke.forwardRef(function(m,g){var l=yA(m);return Ke.createElement(N2,yr({ref:g},l))}),CS=fk;function V2(m){var g,l,c="";if(typeof m=="string"||typeof m=="number")c+=m;else if(typeof m=="object")if(Array.isArray(m)){var _=m.length;for(g=0;g<_;g++)m[g]&&(l=V2(m[g]))&&(c&&(c+=" "),c+=l)}else for(l in m)m[l]&&(c&&(c+=" "),c+=l);return c}function gn(){for(var m,g,l=0,c="",_=arguments.length;l<_;l++)(m=arguments[l])&&(g=V2(m))&&(c&&(c+=" "),c+=g);return c}const U2=6048e5,mk=864e5,_0=6e4,y0=36e5,gk=1e3,AS=Symbol.for("constructDateFrom");function Rn(m,g){return typeof m=="function"?m(g):m&&typeof m=="object"&&AS in m?m[AS](g):m instanceof Date?new m.constructor(g):new Date(g)}function ar(m,g){return Rn(g||m,m)}function zc(m,g,l){const c=ar(m,l==null?void 0:l.in);return isNaN(g)?Rn((l==null?void 0:l.in)||m,NaN):(g&&c.setDate(c.getDate()+g),c)}function Fc(m,g,l){const c=ar(m,l==null?void 0:l.in);if(isNaN(g))return Rn(m,NaN);if(!g)return c;const _=c.getDate(),A=Rn(m,c.getTime());A.setMonth(c.getMonth()+g+1,0);const N=A.getDate();return _>=N?A:(c.setFullYear(A.getFullYear(),A.getMonth(),_),c)}function j2(m,g,l){return Rn(m,+ar(m)+g)}function _k(m,g,l){return j2(m,g*y0)}let yk={};function ff(){return yk}function kh(m,g){var r,q,ie,ae;const l=ff(),c=(g==null?void 0:g.weekStartsOn)??((q=(r=g==null?void 0:g.locale)==null?void 0:r.options)==null?void 0:q.weekStartsOn)??l.weekStartsOn??((ae=(ie=l.locale)==null?void 0:ie.options)==null?void 0:ae.weekStartsOn)??0,_=ar(m,g==null?void 0:g.in),A=_.getDay(),N=(A<c?7:0)+A-c;return _.setDate(_.getDate()-N),_.setHours(0,0,0,0),_}function Dm(m,g){return kh(m,{...g,weekStartsOn:1})}function $2(m,g){const l=ar(m,g==null?void 0:g.in),c=l.getFullYear(),_=Rn(l,0);_.setFullYear(c+1,0,4),_.setHours(0,0,0,0);const A=Dm(_),N=Rn(l,0);N.setFullYear(c,0,4),N.setHours(0,0,0,0);const r=Dm(N);return l.getTime()>=A.getTime()?c+1:l.getTime()>=r.getTime()?c:c-1}function Yy(m){const g=ar(m),l=new Date(Date.UTC(g.getFullYear(),g.getMonth(),g.getDate(),g.getHours(),g.getMinutes(),g.getSeconds(),g.getMilliseconds()));return l.setUTCFullYear(g.getFullYear()),+m-+l}function Rh(m,...g){const l=Rn.bind(null,g.find(c=>typeof c=="object"));return g.map(l)}function hf(m,g){const l=ar(m,g==null?void 0:g.in);return l.setHours(0,0,0,0),l}function km(m,g,l){const[c,_]=Rh(l==null?void 0:l.in,m,g),A=hf(c),N=hf(_),r=+A-Yy(A),q=+N-Yy(N);return Math.round((r-q)/mk)}function vk(m,g){const l=$2(m,g),c=Rn(m,0);return c.setFullYear(l,0,4),c.setHours(0,0,0,0),Dm(c)}function wx(m,g,l){const c=ar(m,l==null?void 0:l.in);return c.setTime(c.getTime()+g*_0),c}function Xx(m,g,l){return Fc(m,g*3,l)}function xk(m,g,l){return j2(m,g*1e3)}function Xy(m,g,l){return zc(m,g*7,l)}function Ch(m,g,l){return Fc(m,g*12,l)}function PS(m,g){let l,c=g==null?void 0:g.in;return m.forEach(_=>{!c&&typeof _=="object"&&(c=Rn.bind(null,_));const A=ar(_,c);(!l||l<A||isNaN(+A))&&(l=A)}),Rn(c,l||NaN)}function IS(m,g){let l,c=g==null?void 0:g.in;return m.forEach(_=>{!c&&typeof _=="object"&&(c=Rn.bind(null,_));const A=ar(_,c);(!l||l>A||isNaN(+A))&&(l=A)}),Rn(c,l||NaN)}function bk(m,g,l){const[c,_]=Rh(l==null?void 0:l.in,m,g);return+hf(c)==+hf(_)}function Ah(m){return m instanceof Date||typeof m=="object"&&Object.prototype.toString.call(m)==="[object Date]"}function Zy(m){return!(!Ah(m)&&typeof m!="number"||isNaN(+ar(m)))}function Ky(m,g,l){const[c,_]=Rh(l==null?void 0:l.in,m,g),A=c.getFullYear()-_.getFullYear(),N=c.getMonth()-_.getMonth();return A*12+N}function af(m,g){const l=ar(m,g==null?void 0:g.in);return Math.trunc(l.getMonth()/3)+1}function Jy(m,g,l){const[c,_]=Rh(l==null?void 0:l.in,m,g),A=c.getFullYear()-_.getFullYear(),N=af(c)-af(_);return A*4+N}function Qy(m,g,l){const[c,_]=Rh(l==null?void 0:l.in,m,g);return c.getFullYear()-_.getFullYear()}function wk(m,g,l){const[c,_]=Rh(l==null?void 0:l.in,m,g),A=DS(c,_),N=Math.abs(km(c,_));c.setDate(c.getDate()-A*N);const r=+(DS(c,_)===-A),q=A*(N-r);return q===0?0:q}function DS(m,g){const l=m.getFullYear()-g.getFullYear()||m.getMonth()-g.getMonth()||m.getDate()-g.getDate()||m.getHours()-g.getHours()||m.getMinutes()-g.getMinutes()||m.getSeconds()-g.getSeconds()||m.getMilliseconds()-g.getMilliseconds();return l<0?-1:l>0?1:l}function G2(m,g){const l=ar(m,g==null?void 0:g.in);return l.setHours(23,59,59,999),l}function H2(m,g){const l=ar(m,g==null?void 0:g.in),c=l.getMonth();return l.setFullYear(l.getFullYear(),c+1,0),l.setHours(23,59,59,999),l}function Sx(m,g){const l=ar(m,g==null?void 0:g.in),c=l.getMonth(),_=c-c%3;return l.setMonth(_,1),l.setHours(0,0,0,0),l}function W2(m,g){const l=ar(m,g==null?void 0:g.in);return l.setDate(1),l.setHours(0,0,0,0),l}function q2(m,g){const l=ar(m,g==null?void 0:g.in),c=l.getFullYear();return l.setFullYear(c+1,0,0),l.setHours(23,59,59,999),l}function v0(m,g){const l=ar(m,g==null?void 0:g.in);return l.setFullYear(l.getFullYear(),0,1),l.setHours(0,0,0,0),l}function Sk(m,g){var r,q;const l=ff(),c=l.weekStartsOn??((q=(r=l.locale)==null?void 0:r.options)==null?void 0:q.weekStartsOn)??0,_=ar(m,g==null?void 0:g.in),A=_.getDay(),N=(A<c?-7:0)+6-(A-c);return _.setDate(_.getDate()+N),_.setHours(23,59,59,999),_}const Tk={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Mk=(m,g,l)=>{let c;const _=Tk[m];return typeof _=="string"?c=_:g===1?c=_.one:c=_.other.replace("{{count}}",g.toString()),l!=null&&l.addSuffix?l.comparison&&l.comparison>0?"in "+c:c+" ago":c};function tx(m){return(g={})=>{const l=g.width?String(g.width):m.defaultWidth;return m.formats[l]||m.formats[m.defaultWidth]}}const Ek={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Ck={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Ak={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Pk={date:tx({formats:Ek,defaultWidth:"full"}),time:tx({formats:Ck,defaultWidth:"full"}),dateTime:tx({formats:Ak,defaultWidth:"full"})},Ik={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Dk=(m,g,l,c)=>Ik[m];function Lg(m){return(g,l)=>{const c=l!=null&&l.context?String(l.context):"standalone";let _;if(c==="formatting"&&m.formattingValues){const N=m.defaultFormattingWidth||m.defaultWidth,r=l!=null&&l.width?String(l.width):N;_=m.formattingValues[r]||m.formattingValues[N]}else{const N=m.defaultWidth,r=l!=null&&l.width?String(l.width):m.defaultWidth;_=m.values[r]||m.values[N]}const A=m.argumentCallback?m.argumentCallback(g):g;return _[A]}}const kk={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Ok={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Lk={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Rk={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},zk={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Fk={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Bk=(m,g)=>{const l=Number(m),c=l%100;if(c>20||c<10)switch(c%10){case 1:return l+"st";case 2:return l+"nd";case 3:return l+"rd"}return l+"th"},Nk={ordinalNumber:Bk,era:Lg({values:kk,defaultWidth:"wide"}),quarter:Lg({values:Ok,defaultWidth:"wide",argumentCallback:m=>m-1}),month:Lg({values:Lk,defaultWidth:"wide"}),day:Lg({values:Rk,defaultWidth:"wide"}),dayPeriod:Lg({values:zk,defaultWidth:"wide",formattingValues:Fk,defaultFormattingWidth:"wide"})};function Rg(m){return(g,l={})=>{const c=l.width,_=c&&m.matchPatterns[c]||m.matchPatterns[m.defaultMatchWidth],A=g.match(_);if(!A)return null;const N=A[0],r=c&&m.parsePatterns[c]||m.parsePatterns[m.defaultParseWidth],q=Array.isArray(r)?Uk(r,he=>he.test(N)):Vk(r,he=>he.test(N));let ie;ie=m.valueCallback?m.valueCallback(q):q,ie=l.valueCallback?l.valueCallback(ie):ie;const ae=g.slice(N.length);return{value:ie,rest:ae}}}function Vk(m,g){for(const l in m)if(Object.prototype.hasOwnProperty.call(m,l)&&g(m[l]))return l}function Uk(m,g){for(let l=0;l<m.length;l++)if(g(m[l]))return l}function jk(m){return(g,l={})=>{const c=g.match(m.matchPattern);if(!c)return null;const _=c[0],A=g.match(m.parsePattern);if(!A)return null;let N=m.valueCallback?m.valueCallback(A[0]):A[0];N=l.valueCallback?l.valueCallback(N):N;const r=g.slice(_.length);return{value:N,rest:r}}}const $k=/^(\d+)(th|st|nd|rd)?/i,Gk=/\d+/i,Hk={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Wk={any:[/^b/i,/^(a|c)/i]},qk={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Yk={any:[/1/i,/2/i,/3/i,/4/i]},Xk={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Zk={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Kk={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Jk={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Qk={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},eO={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},tO={ordinalNumber:jk({matchPattern:$k,parsePattern:Gk,valueCallback:m=>parseInt(m,10)}),era:Rg({matchPatterns:Hk,defaultMatchWidth:"wide",parsePatterns:Wk,defaultParseWidth:"any"}),quarter:Rg({matchPatterns:qk,defaultMatchWidth:"wide",parsePatterns:Yk,defaultParseWidth:"any",valueCallback:m=>m+1}),month:Rg({matchPatterns:Xk,defaultMatchWidth:"wide",parsePatterns:Zk,defaultParseWidth:"any"}),day:Rg({matchPatterns:Kk,defaultMatchWidth:"wide",parsePatterns:Jk,defaultParseWidth:"any"}),dayPeriod:Rg({matchPatterns:Qk,defaultMatchWidth:"any",parsePatterns:eO,defaultParseWidth:"any"})},Y2={code:"en-US",formatDistance:Mk,formatLong:Pk,formatRelative:Dk,localize:Nk,match:tO,options:{weekStartsOn:0,firstWeekContainsDate:1}};function iO(m,g){const l=ar(m,g==null?void 0:g.in);return km(l,v0(l))+1}function Zx(m,g){const l=ar(m,g==null?void 0:g.in),c=+Dm(l)-+vk(l);return Math.round(c/U2)+1}function Kx(m,g){var ae,he,ve,Ae;const l=ar(m,g==null?void 0:g.in),c=l.getFullYear(),_=ff(),A=(g==null?void 0:g.firstWeekContainsDate)??((he=(ae=g==null?void 0:g.locale)==null?void 0:ae.options)==null?void 0:he.firstWeekContainsDate)??_.firstWeekContainsDate??((Ae=(ve=_.locale)==null?void 0:ve.options)==null?void 0:Ae.firstWeekContainsDate)??1,N=Rn((g==null?void 0:g.in)||m,0);N.setFullYear(c+1,0,A),N.setHours(0,0,0,0);const r=kh(N,g),q=Rn((g==null?void 0:g.in)||m,0);q.setFullYear(c,0,A),q.setHours(0,0,0,0);const ie=kh(q,g);return+l>=+r?c+1:+l>=+ie?c:c-1}function rO(m,g){var r,q,ie,ae;const l=ff(),c=(g==null?void 0:g.firstWeekContainsDate)??((q=(r=g==null?void 0:g.locale)==null?void 0:r.options)==null?void 0:q.firstWeekContainsDate)??l.firstWeekContainsDate??((ae=(ie=l.locale)==null?void 0:ie.options)==null?void 0:ae.firstWeekContainsDate)??1,_=Kx(m,g),A=Rn((g==null?void 0:g.in)||m,0);return A.setFullYear(_,0,c),A.setHours(0,0,0,0),kh(A,g)}function X2(m,g){const l=ar(m,g==null?void 0:g.in),c=+kh(l,g)-+rO(l,g);return Math.round(c/U2)+1}function Ln(m,g){const l=m<0?"-":"",c=Math.abs(m).toString().padStart(g,"0");return l+c}const Ld={y(m,g){const l=m.getFullYear(),c=l>0?l:1-l;return Ln(g==="yy"?c%100:c,g.length)},M(m,g){const l=m.getMonth();return g==="M"?String(l+1):Ln(l+1,2)},d(m,g){return Ln(m.getDate(),g.length)},a(m,g){const l=m.getHours()/12>=1?"pm":"am";switch(g){case"a":case"aa":return l.toUpperCase();case"aaa":return l;case"aaaaa":return l[0];case"aaaa":default:return l==="am"?"a.m.":"p.m."}},h(m,g){return Ln(m.getHours()%12||12,g.length)},H(m,g){return Ln(m.getHours(),g.length)},m(m,g){return Ln(m.getMinutes(),g.length)},s(m,g){return Ln(m.getSeconds(),g.length)},S(m,g){const l=g.length,c=m.getMilliseconds(),_=Math.trunc(c*Math.pow(10,l-3));return Ln(_,g.length)}},gm={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},kS={G:function(m,g,l){const c=m.getFullYear()>0?1:0;switch(g){case"G":case"GG":case"GGG":return l.era(c,{width:"abbreviated"});case"GGGGG":return l.era(c,{width:"narrow"});case"GGGG":default:return l.era(c,{width:"wide"})}},y:function(m,g,l){if(g==="yo"){const c=m.getFullYear(),_=c>0?c:1-c;return l.ordinalNumber(_,{unit:"year"})}return Ld.y(m,g)},Y:function(m,g,l,c){const _=Kx(m,c),A=_>0?_:1-_;if(g==="YY"){const N=A%100;return Ln(N,2)}return g==="Yo"?l.ordinalNumber(A,{unit:"year"}):Ln(A,g.length)},R:function(m,g){const l=$2(m);return Ln(l,g.length)},u:function(m,g){const l=m.getFullYear();return Ln(l,g.length)},Q:function(m,g,l){const c=Math.ceil((m.getMonth()+1)/3);switch(g){case"Q":return String(c);case"QQ":return Ln(c,2);case"Qo":return l.ordinalNumber(c,{unit:"quarter"});case"QQQ":return l.quarter(c,{width:"abbreviated",context:"formatting"});case"QQQQQ":return l.quarter(c,{width:"narrow",context:"formatting"});case"QQQQ":default:return l.quarter(c,{width:"wide",context:"formatting"})}},q:function(m,g,l){const c=Math.ceil((m.getMonth()+1)/3);switch(g){case"q":return String(c);case"qq":return Ln(c,2);case"qo":return l.ordinalNumber(c,{unit:"quarter"});case"qqq":return l.quarter(c,{width:"abbreviated",context:"standalone"});case"qqqqq":return l.quarter(c,{width:"narrow",context:"standalone"});case"qqqq":default:return l.quarter(c,{width:"wide",context:"standalone"})}},M:function(m,g,l){const c=m.getMonth();switch(g){case"M":case"MM":return Ld.M(m,g);case"Mo":return l.ordinalNumber(c+1,{unit:"month"});case"MMM":return l.month(c,{width:"abbreviated",context:"formatting"});case"MMMMM":return l.month(c,{width:"narrow",context:"formatting"});case"MMMM":default:return l.month(c,{width:"wide",context:"formatting"})}},L:function(m,g,l){const c=m.getMonth();switch(g){case"L":return String(c+1);case"LL":return Ln(c+1,2);case"Lo":return l.ordinalNumber(c+1,{unit:"month"});case"LLL":return l.month(c,{width:"abbreviated",context:"standalone"});case"LLLLL":return l.month(c,{width:"narrow",context:"standalone"});case"LLLL":default:return l.month(c,{width:"wide",context:"standalone"})}},w:function(m,g,l,c){const _=X2(m,c);return g==="wo"?l.ordinalNumber(_,{unit:"week"}):Ln(_,g.length)},I:function(m,g,l){const c=Zx(m);return g==="Io"?l.ordinalNumber(c,{unit:"week"}):Ln(c,g.length)},d:function(m,g,l){return g==="do"?l.ordinalNumber(m.getDate(),{unit:"date"}):Ld.d(m,g)},D:function(m,g,l){const c=iO(m);return g==="Do"?l.ordinalNumber(c,{unit:"dayOfYear"}):Ln(c,g.length)},E:function(m,g,l){const c=m.getDay();switch(g){case"E":case"EE":case"EEE":return l.day(c,{width:"abbreviated",context:"formatting"});case"EEEEE":return l.day(c,{width:"narrow",context:"formatting"});case"EEEEEE":return l.day(c,{width:"short",context:"formatting"});case"EEEE":default:return l.day(c,{width:"wide",context:"formatting"})}},e:function(m,g,l,c){const _=m.getDay(),A=(_-c.weekStartsOn+8)%7||7;switch(g){case"e":return String(A);case"ee":return Ln(A,2);case"eo":return l.ordinalNumber(A,{unit:"day"});case"eee":return l.day(_,{width:"abbreviated",context:"formatting"});case"eeeee":return l.day(_,{width:"narrow",context:"formatting"});case"eeeeee":return l.day(_,{width:"short",context:"formatting"});case"eeee":default:return l.day(_,{width:"wide",context:"formatting"})}},c:function(m,g,l,c){const _=m.getDay(),A=(_-c.weekStartsOn+8)%7||7;switch(g){case"c":return String(A);case"cc":return Ln(A,g.length);case"co":return l.ordinalNumber(A,{unit:"day"});case"ccc":return l.day(_,{width:"abbreviated",context:"standalone"});case"ccccc":return l.day(_,{width:"narrow",context:"standalone"});case"cccccc":return l.day(_,{width:"short",context:"standalone"});case"cccc":default:return l.day(_,{width:"wide",context:"standalone"})}},i:function(m,g,l){const c=m.getDay(),_=c===0?7:c;switch(g){case"i":return String(_);case"ii":return Ln(_,g.length);case"io":return l.ordinalNumber(_,{unit:"day"});case"iii":return l.day(c,{width:"abbreviated",context:"formatting"});case"iiiii":return l.day(c,{width:"narrow",context:"formatting"});case"iiiiii":return l.day(c,{width:"short",context:"formatting"});case"iiii":default:return l.day(c,{width:"wide",context:"formatting"})}},a:function(m,g,l){const _=m.getHours()/12>=1?"pm":"am";switch(g){case"a":case"aa":return l.dayPeriod(_,{width:"abbreviated",context:"formatting"});case"aaa":return l.dayPeriod(_,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return l.dayPeriod(_,{width:"narrow",context:"formatting"});case"aaaa":default:return l.dayPeriod(_,{width:"wide",context:"formatting"})}},b:function(m,g,l){const c=m.getHours();let _;switch(c===12?_=gm.noon:c===0?_=gm.midnight:_=c/12>=1?"pm":"am",g){case"b":case"bb":return l.dayPeriod(_,{width:"abbreviated",context:"formatting"});case"bbb":return l.dayPeriod(_,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return l.dayPeriod(_,{width:"narrow",context:"formatting"});case"bbbb":default:return l.dayPeriod(_,{width:"wide",context:"formatting"})}},B:function(m,g,l){const c=m.getHours();let _;switch(c>=17?_=gm.evening:c>=12?_=gm.afternoon:c>=4?_=gm.morning:_=gm.night,g){case"B":case"BB":case"BBB":return l.dayPeriod(_,{width:"abbreviated",context:"formatting"});case"BBBBB":return l.dayPeriod(_,{width:"narrow",context:"formatting"});case"BBBB":default:return l.dayPeriod(_,{width:"wide",context:"formatting"})}},h:function(m,g,l){if(g==="ho"){let c=m.getHours()%12;return c===0&&(c=12),l.ordinalNumber(c,{unit:"hour"})}return Ld.h(m,g)},H:function(m,g,l){return g==="Ho"?l.ordinalNumber(m.getHours(),{unit:"hour"}):Ld.H(m,g)},K:function(m,g,l){const c=m.getHours()%12;return g==="Ko"?l.ordinalNumber(c,{unit:"hour"}):Ln(c,g.length)},k:function(m,g,l){let c=m.getHours();return c===0&&(c=24),g==="ko"?l.ordinalNumber(c,{unit:"hour"}):Ln(c,g.length)},m:function(m,g,l){return g==="mo"?l.ordinalNumber(m.getMinutes(),{unit:"minute"}):Ld.m(m,g)},s:function(m,g,l){return g==="so"?l.ordinalNumber(m.getSeconds(),{unit:"second"}):Ld.s(m,g)},S:function(m,g){return Ld.S(m,g)},X:function(m,g,l){const c=m.getTimezoneOffset();if(c===0)return"Z";switch(g){case"X":return LS(c);case"XXXX":case"XX":return rf(c);case"XXXXX":case"XXX":default:return rf(c,":")}},x:function(m,g,l){const c=m.getTimezoneOffset();switch(g){case"x":return LS(c);case"xxxx":case"xx":return rf(c);case"xxxxx":case"xxx":default:return rf(c,":")}},O:function(m,g,l){const c=m.getTimezoneOffset();switch(g){case"O":case"OO":case"OOO":return"GMT"+OS(c,":");case"OOOO":default:return"GMT"+rf(c,":")}},z:function(m,g,l){const c=m.getTimezoneOffset();switch(g){case"z":case"zz":case"zzz":return"GMT"+OS(c,":");case"zzzz":default:return"GMT"+rf(c,":")}},t:function(m,g,l){const c=Math.trunc(+m/1e3);return Ln(c,g.length)},T:function(m,g,l){return Ln(+m,g.length)}};function OS(m,g=""){const l=m>0?"-":"+",c=Math.abs(m),_=Math.trunc(c/60),A=c%60;return A===0?l+String(_):l+String(_)+g+Ln(A,2)}function LS(m,g){return m%60===0?(m>0?"-":"+")+Ln(Math.abs(m)/60,2):rf(m,g)}function rf(m,g=""){const l=m>0?"-":"+",c=Math.abs(m),_=Ln(Math.trunc(c/60),2),A=Ln(c%60,2);return l+_+g+A}const RS=(m,g)=>{switch(m){case"P":return g.date({width:"short"});case"PP":return g.date({width:"medium"});case"PPP":return g.date({width:"long"});case"PPPP":default:return g.date({width:"full"})}},Z2=(m,g)=>{switch(m){case"p":return g.time({width:"short"});case"pp":return g.time({width:"medium"});case"ppp":return g.time({width:"long"});case"pppp":default:return g.time({width:"full"})}},nO=(m,g)=>{const l=m.match(/(P+)(p+)?/)||[],c=l[1],_=l[2];if(!_)return RS(m,g);let A;switch(c){case"P":A=g.dateTime({width:"short"});break;case"PP":A=g.dateTime({width:"medium"});break;case"PPP":A=g.dateTime({width:"long"});break;case"PPPP":default:A=g.dateTime({width:"full"});break}return A.replace("{{date}}",RS(c,g)).replace("{{time}}",Z2(_,g))},Tx={p:Z2,P:nO},sO=/^D+$/,oO=/^Y+$/,aO=["D","DD","YY","YYYY"];function lO(m){return sO.test(m)}function cO(m){return oO.test(m)}function uO(m,g,l){const c=hO(m,g,l);if(console.warn(c),aO.includes(m))throw new RangeError(c)}function hO(m,g,l){const c=m[0]==="Y"?"years":"days of the month";return`Use \`${m.toLowerCase()}\` instead of \`${m}\` (in \`${g}\`) for formatting ${c} to the input \`${l}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const dO=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,pO=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,fO=/^'([^]*?)'?$/,mO=/''/g,gO=/[a-zA-Z]/;function zS(m,g,l){var ae,he,ve,Ae,we,Pe,Ve,We;const c=ff(),_=(l==null?void 0:l.locale)??c.locale??Y2,A=(l==null?void 0:l.firstWeekContainsDate)??((he=(ae=l==null?void 0:l.locale)==null?void 0:ae.options)==null?void 0:he.firstWeekContainsDate)??c.firstWeekContainsDate??((Ae=(ve=c.locale)==null?void 0:ve.options)==null?void 0:Ae.firstWeekContainsDate)??1,N=(l==null?void 0:l.weekStartsOn)??((Pe=(we=l==null?void 0:l.locale)==null?void 0:we.options)==null?void 0:Pe.weekStartsOn)??c.weekStartsOn??((We=(Ve=c.locale)==null?void 0:Ve.options)==null?void 0:We.weekStartsOn)??0,r=ar(m,l==null?void 0:l.in);if(!Zy(r))throw new RangeError("Invalid time value");let q=g.match(pO).map(rt=>{const ht=rt[0];if(ht==="p"||ht==="P"){const tt=Tx[ht];return tt(rt,_.formatLong)}return rt}).join("").match(dO).map(rt=>{if(rt==="''")return{isToken:!1,value:"'"};const ht=rt[0];if(ht==="'")return{isToken:!1,value:_O(rt)};if(kS[ht])return{isToken:!0,value:rt};if(ht.match(gO))throw new RangeError("Format string contains an unescaped latin alphabet character `"+ht+"`");return{isToken:!1,value:rt}});_.localize.preprocessor&&(q=_.localize.preprocessor(r,q));const ie={firstWeekContainsDate:A,weekStartsOn:N,locale:_};return q.map(rt=>{if(!rt.isToken)return rt.value;const ht=rt.value;(!(l!=null&&l.useAdditionalWeekYearTokens)&&cO(ht)||!(l!=null&&l.useAdditionalDayOfYearTokens)&&lO(ht))&&uO(ht,g,String(m));const tt=kS[ht[0]];return tt(r,ht,_.localize,ie)}).join("")}function _O(m){const g=m.match(fO);return g?g[1].replace(mO,"'"):m}function FS(m,g){return ar(m,g==null?void 0:g.in).getDate()}function yO(m,g){return ar(m,g==null?void 0:g.in).getDay()}function vO(m,g){const l=ar(m,g==null?void 0:g.in),c=l.getFullYear(),_=l.getMonth(),A=Rn(l,0);return A.setFullYear(c,_+1,0),A.setHours(0,0,0,0),A.getDate()}function xO(){return Object.assign({},ff())}function Ph(m,g){return ar(m,g==null?void 0:g.in).getHours()}function bO(m,g){const l=ar(m,g==null?void 0:g.in).getDay();return l===0?7:l}function Ih(m,g){return ar(m,g==null?void 0:g.in).getMinutes()}function Ta(m,g){return ar(m,g==null?void 0:g.in).getMonth()}function Fd(m){return ar(m).getSeconds()}function Mx(m){return+ar(m)}function Zr(m,g){return ar(m,g==null?void 0:g.in).getFullYear()}function Vd(m,g){return+ar(m)>+ar(g)}function df(m,g){return+ar(m)<+ar(g)}function wO(m,g){return+ar(m)==+ar(g)}function SO(m,g){const l=TO(g)?new g(0):Rn(g,0);return l.setFullYear(m.getFullYear(),m.getMonth(),m.getDate()),l.setHours(m.getHours(),m.getMinutes(),m.getSeconds(),m.getMilliseconds()),l}function TO(m){var g;return typeof m=="function"&&((g=m.prototype)==null?void 0:g.constructor)===m}const MO=10;class K2{constructor(){Li(this,"subPriority",0)}validate(g,l){return!0}}class EO extends K2{constructor(g,l,c,_,A){super(),this.value=g,this.validateValue=l,this.setValue=c,this.priority=_,A&&(this.subPriority=A)}validate(g,l){return this.validateValue(g,this.value,l)}set(g,l,c){return this.setValue(g,l,this.value,c)}}class CO extends K2{constructor(l,c){super();Li(this,"priority",MO);Li(this,"subPriority",-1);this.context=l||(_=>Rn(c,_))}set(l,c){return c.timestampIsSet?l:Rn(l,SO(l,this.context))}}class bn{run(g,l,c,_){const A=this.parse(g,l,c,_);return A?{setter:new EO(A.value,this.validate,this.set,this.priority,this.subPriority),rest:A.rest}:null}validate(g,l,c){return!0}}class AO extends bn{constructor(){super(...arguments);Li(this,"priority",140);Li(this,"incompatibleTokens",["R","u","t","T"])}parse(l,c,_){switch(c){case"G":case"GG":case"GGG":return _.era(l,{width:"abbreviated"})||_.era(l,{width:"narrow"});case"GGGGG":return _.era(l,{width:"narrow"});case"GGGG":default:return _.era(l,{width:"wide"})||_.era(l,{width:"abbreviated"})||_.era(l,{width:"narrow"})}}set(l,c,_){return c.era=_,l.setFullYear(_,0,1),l.setHours(0,0,0,0),l}}const Ws={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},Ru={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function qs(m,g){return m&&{value:g(m.value),rest:m.rest}}function Cs(m,g){const l=g.match(m);return l?{value:parseInt(l[0],10),rest:g.slice(l[0].length)}:null}function zu(m,g){const l=g.match(m);if(!l)return null;if(l[0]==="Z")return{value:0,rest:g.slice(1)};const c=l[1]==="+"?1:-1,_=l[2]?parseInt(l[2],10):0,A=l[3]?parseInt(l[3],10):0,N=l[5]?parseInt(l[5],10):0;return{value:c*(_*y0+A*_0+N*gk),rest:g.slice(l[0].length)}}function J2(m){return Cs(Ws.anyDigitsSigned,m)}function js(m,g){switch(m){case 1:return Cs(Ws.singleDigit,g);case 2:return Cs(Ws.twoDigits,g);case 3:return Cs(Ws.threeDigits,g);case 4:return Cs(Ws.fourDigits,g);default:return Cs(new RegExp("^\\d{1,"+m+"}"),g)}}function e0(m,g){switch(m){case 1:return Cs(Ws.singleDigitSigned,g);case 2:return Cs(Ws.twoDigitsSigned,g);case 3:return Cs(Ws.threeDigitsSigned,g);case 4:return Cs(Ws.fourDigitsSigned,g);default:return Cs(new RegExp("^-?\\d{1,"+m+"}"),g)}}function Jx(m){switch(m){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function Q2(m,g){const l=g>0,c=l?g:1-g;let _;if(c<=50)_=m||100;else{const A=c+50,N=Math.trunc(A/100)*100,r=m>=A%100;_=m+N-(r?100:0)}return l?_:1-_}function eM(m){return m%400===0||m%4===0&&m%100!==0}class PO extends bn{constructor(){super(...arguments);Li(this,"priority",130);Li(this,"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"])}parse(l,c,_){const A=N=>({year:N,isTwoDigitYear:c==="yy"});switch(c){case"y":return qs(js(4,l),A);case"yo":return qs(_.ordinalNumber(l,{unit:"year"}),A);default:return qs(js(c.length,l),A)}}validate(l,c){return c.isTwoDigitYear||c.year>0}set(l,c,_){const A=l.getFullYear();if(_.isTwoDigitYear){const r=Q2(_.year,A);return l.setFullYear(r,0,1),l.setHours(0,0,0,0),l}const N=!("era"in c)||c.era===1?_.year:1-_.year;return l.setFullYear(N,0,1),l.setHours(0,0,0,0),l}}class IO extends bn{constructor(){super(...arguments);Li(this,"priority",130);Li(this,"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"])}parse(l,c,_){const A=N=>({year:N,isTwoDigitYear:c==="YY"});switch(c){case"Y":return qs(js(4,l),A);case"Yo":return qs(_.ordinalNumber(l,{unit:"year"}),A);default:return qs(js(c.length,l),A)}}validate(l,c){return c.isTwoDigitYear||c.year>0}set(l,c,_,A){const N=Kx(l,A);if(_.isTwoDigitYear){const q=Q2(_.year,N);return l.setFullYear(q,0,A.firstWeekContainsDate),l.setHours(0,0,0,0),kh(l,A)}const r=!("era"in c)||c.era===1?_.year:1-_.year;return l.setFullYear(r,0,A.firstWeekContainsDate),l.setHours(0,0,0,0),kh(l,A)}}class DO extends bn{constructor(){super(...arguments);Li(this,"priority",130);Li(this,"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"])}parse(l,c){return e0(c==="R"?4:c.length,l)}set(l,c,_){const A=Rn(l,0);return A.setFullYear(_,0,4),A.setHours(0,0,0,0),Dm(A)}}class kO extends bn{constructor(){super(...arguments);Li(this,"priority",130);Li(this,"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"])}parse(l,c){return e0(c==="u"?4:c.length,l)}set(l,c,_){return l.setFullYear(_,0,1),l.setHours(0,0,0,0),l}}class OO extends bn{constructor(){super(...arguments);Li(this,"priority",120);Li(this,"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"])}parse(l,c,_){switch(c){case"Q":case"QQ":return js(c.length,l);case"Qo":return _.ordinalNumber(l,{unit:"quarter"});case"QQQ":return _.quarter(l,{width:"abbreviated",context:"formatting"})||_.quarter(l,{width:"narrow",context:"formatting"});case"QQQQQ":return _.quarter(l,{width:"narrow",context:"formatting"});case"QQQQ":default:return _.quarter(l,{width:"wide",context:"formatting"})||_.quarter(l,{width:"abbreviated",context:"formatting"})||_.quarter(l,{width:"narrow",context:"formatting"})}}validate(l,c){return c>=1&&c<=4}set(l,c,_){return l.setMonth((_-1)*3,1),l.setHours(0,0,0,0),l}}class LO extends bn{constructor(){super(...arguments);Li(this,"priority",120);Li(this,"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"])}parse(l,c,_){switch(c){case"q":case"qq":return js(c.length,l);case"qo":return _.ordinalNumber(l,{unit:"quarter"});case"qqq":return _.quarter(l,{width:"abbreviated",context:"standalone"})||_.quarter(l,{width:"narrow",context:"standalone"});case"qqqqq":return _.quarter(l,{width:"narrow",context:"standalone"});case"qqqq":default:return _.quarter(l,{width:"wide",context:"standalone"})||_.quarter(l,{width:"abbreviated",context:"standalone"})||_.quarter(l,{width:"narrow",context:"standalone"})}}validate(l,c){return c>=1&&c<=4}set(l,c,_){return l.setMonth((_-1)*3,1),l.setHours(0,0,0,0),l}}class RO extends bn{constructor(){super(...arguments);Li(this,"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]);Li(this,"priority",110)}parse(l,c,_){const A=N=>N-1;switch(c){case"M":return qs(Cs(Ws.month,l),A);case"MM":return qs(js(2,l),A);case"Mo":return qs(_.ordinalNumber(l,{unit:"month"}),A);case"MMM":return _.month(l,{width:"abbreviated",context:"formatting"})||_.month(l,{width:"narrow",context:"formatting"});case"MMMMM":return _.month(l,{width:"narrow",context:"formatting"});case"MMMM":default:return _.month(l,{width:"wide",context:"formatting"})||_.month(l,{width:"abbreviated",context:"formatting"})||_.month(l,{width:"narrow",context:"formatting"})}}validate(l,c){return c>=0&&c<=11}set(l,c,_){return l.setMonth(_,1),l.setHours(0,0,0,0),l}}class zO extends bn{constructor(){super(...arguments);Li(this,"priority",110);Li(this,"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"])}parse(l,c,_){const A=N=>N-1;switch(c){case"L":return qs(Cs(Ws.month,l),A);case"LL":return qs(js(2,l),A);case"Lo":return qs(_.ordinalNumber(l,{unit:"month"}),A);case"LLL":return _.month(l,{width:"abbreviated",context:"standalone"})||_.month(l,{width:"narrow",context:"standalone"});case"LLLLL":return _.month(l,{width:"narrow",context:"standalone"});case"LLLL":default:return _.month(l,{width:"wide",context:"standalone"})||_.month(l,{width:"abbreviated",context:"standalone"})||_.month(l,{width:"narrow",context:"standalone"})}}validate(l,c){return c>=0&&c<=11}set(l,c,_){return l.setMonth(_,1),l.setHours(0,0,0,0),l}}function FO(m,g,l){const c=ar(m,l==null?void 0:l.in),_=X2(c,l)-g;return c.setDate(c.getDate()-_*7),ar(c,l==null?void 0:l.in)}class BO extends bn{constructor(){super(...arguments);Li(this,"priority",100);Li(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"])}parse(l,c,_){switch(c){case"w":return Cs(Ws.week,l);case"wo":return _.ordinalNumber(l,{unit:"week"});default:return js(c.length,l)}}validate(l,c){return c>=1&&c<=53}set(l,c,_,A){return kh(FO(l,_,A),A)}}function NO(m,g,l){const c=ar(m,l==null?void 0:l.in),_=Zx(c,l)-g;return c.setDate(c.getDate()-_*7),c}class VO extends bn{constructor(){super(...arguments);Li(this,"priority",100);Li(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"])}parse(l,c,_){switch(c){case"I":return Cs(Ws.week,l);case"Io":return _.ordinalNumber(l,{unit:"week"});default:return js(c.length,l)}}validate(l,c){return c>=1&&c<=53}set(l,c,_){return Dm(NO(l,_))}}const UO=[31,28,31,30,31,30,31,31,30,31,30,31],jO=[31,29,31,30,31,30,31,31,30,31,30,31];class $O extends bn{constructor(){super(...arguments);Li(this,"priority",90);Li(this,"subPriority",1);Li(this,"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"])}parse(l,c,_){switch(c){case"d":return Cs(Ws.date,l);case"do":return _.ordinalNumber(l,{unit:"date"});default:return js(c.length,l)}}validate(l,c){const _=l.getFullYear(),A=eM(_),N=l.getMonth();return A?c>=1&&c<=jO[N]:c>=1&&c<=UO[N]}set(l,c,_){return l.setDate(_),l.setHours(0,0,0,0),l}}class GO extends bn{constructor(){super(...arguments);Li(this,"priority",90);Li(this,"subpriority",1);Li(this,"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"])}parse(l,c,_){switch(c){case"D":case"DD":return Cs(Ws.dayOfYear,l);case"Do":return _.ordinalNumber(l,{unit:"date"});default:return js(c.length,l)}}validate(l,c){const _=l.getFullYear();return eM(_)?c>=1&&c<=366:c>=1&&c<=365}set(l,c,_){return l.setMonth(0,_),l.setHours(0,0,0,0),l}}function Qx(m,g,l){var he,ve,Ae,we;const c=ff(),_=(l==null?void 0:l.weekStartsOn)??((ve=(he=l==null?void 0:l.locale)==null?void 0:he.options)==null?void 0:ve.weekStartsOn)??c.weekStartsOn??((we=(Ae=c.locale)==null?void 0:Ae.options)==null?void 0:we.weekStartsOn)??0,A=ar(m,l==null?void 0:l.in),N=A.getDay(),q=(g%7+7)%7,ie=7-_,ae=g<0||g>6?g-(N+ie)%7:(q+ie)%7-(N+ie)%7;return zc(A,ae,l)}class HO extends bn{constructor(){super(...arguments);Li(this,"priority",90);Li(this,"incompatibleTokens",["D","i","e","c","t","T"])}parse(l,c,_){switch(c){case"E":case"EE":case"EEE":return _.day(l,{width:"abbreviated",context:"formatting"})||_.day(l,{width:"short",context:"formatting"})||_.day(l,{width:"narrow",context:"formatting"});case"EEEEE":return _.day(l,{width:"narrow",context:"formatting"});case"EEEEEE":return _.day(l,{width:"short",context:"formatting"})||_.day(l,{width:"narrow",context:"formatting"});case"EEEE":default:return _.day(l,{width:"wide",context:"formatting"})||_.day(l,{width:"abbreviated",context:"formatting"})||_.day(l,{width:"short",context:"formatting"})||_.day(l,{width:"narrow",context:"formatting"})}}validate(l,c){return c>=0&&c<=6}set(l,c,_,A){return l=Qx(l,_,A),l.setHours(0,0,0,0),l}}class WO extends bn{constructor(){super(...arguments);Li(this,"priority",90);Li(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"])}parse(l,c,_,A){const N=r=>{const q=Math.floor((r-1)/7)*7;return(r+A.weekStartsOn+6)%7+q};switch(c){case"e":case"ee":return qs(js(c.length,l),N);case"eo":return qs(_.ordinalNumber(l,{unit:"day"}),N);case"eee":return _.day(l,{width:"abbreviated",context:"formatting"})||_.day(l,{width:"short",context:"formatting"})||_.day(l,{width:"narrow",context:"formatting"});case"eeeee":return _.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return _.day(l,{width:"short",context:"formatting"})||_.day(l,{width:"narrow",context:"formatting"});case"eeee":default:return _.day(l,{width:"wide",context:"formatting"})||_.day(l,{width:"abbreviated",context:"formatting"})||_.day(l,{width:"short",context:"formatting"})||_.day(l,{width:"narrow",context:"formatting"})}}validate(l,c){return c>=0&&c<=6}set(l,c,_,A){return l=Qx(l,_,A),l.setHours(0,0,0,0),l}}class qO extends bn{constructor(){super(...arguments);Li(this,"priority",90);Li(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"])}parse(l,c,_,A){const N=r=>{const q=Math.floor((r-1)/7)*7;return(r+A.weekStartsOn+6)%7+q};switch(c){case"c":case"cc":return qs(js(c.length,l),N);case"co":return qs(_.ordinalNumber(l,{unit:"day"}),N);case"ccc":return _.day(l,{width:"abbreviated",context:"standalone"})||_.day(l,{width:"short",context:"standalone"})||_.day(l,{width:"narrow",context:"standalone"});case"ccccc":return _.day(l,{width:"narrow",context:"standalone"});case"cccccc":return _.day(l,{width:"short",context:"standalone"})||_.day(l,{width:"narrow",context:"standalone"});case"cccc":default:return _.day(l,{width:"wide",context:"standalone"})||_.day(l,{width:"abbreviated",context:"standalone"})||_.day(l,{width:"short",context:"standalone"})||_.day(l,{width:"narrow",context:"standalone"})}}validate(l,c){return c>=0&&c<=6}set(l,c,_,A){return l=Qx(l,_,A),l.setHours(0,0,0,0),l}}function YO(m,g,l){const c=ar(m,l==null?void 0:l.in),_=bO(c,l),A=g-_;return zc(c,A,l)}class XO extends bn{constructor(){super(...arguments);Li(this,"priority",90);Li(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"])}parse(l,c,_){const A=N=>N===0?7:N;switch(c){case"i":case"ii":return js(c.length,l);case"io":return _.ordinalNumber(l,{unit:"day"});case"iii":return qs(_.day(l,{width:"abbreviated",context:"formatting"})||_.day(l,{width:"short",context:"formatting"})||_.day(l,{width:"narrow",context:"formatting"}),A);case"iiiii":return qs(_.day(l,{width:"narrow",context:"formatting"}),A);case"iiiiii":return qs(_.day(l,{width:"short",context:"formatting"})||_.day(l,{width:"narrow",context:"formatting"}),A);case"iiii":default:return qs(_.day(l,{width:"wide",context:"formatting"})||_.day(l,{width:"abbreviated",context:"formatting"})||_.day(l,{width:"short",context:"formatting"})||_.day(l,{width:"narrow",context:"formatting"}),A)}}validate(l,c){return c>=1&&c<=7}set(l,c,_){return l=YO(l,_),l.setHours(0,0,0,0),l}}class ZO extends bn{constructor(){super(...arguments);Li(this,"priority",80);Li(this,"incompatibleTokens",["b","B","H","k","t","T"])}parse(l,c,_){switch(c){case"a":case"aa":case"aaa":return _.dayPeriod(l,{width:"abbreviated",context:"formatting"})||_.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaaa":return _.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaa":default:return _.dayPeriod(l,{width:"wide",context:"formatting"})||_.dayPeriod(l,{width:"abbreviated",context:"formatting"})||_.dayPeriod(l,{width:"narrow",context:"formatting"})}}set(l,c,_){return l.setHours(Jx(_),0,0,0),l}}class KO extends bn{constructor(){super(...arguments);Li(this,"priority",80);Li(this,"incompatibleTokens",["a","B","H","k","t","T"])}parse(l,c,_){switch(c){case"b":case"bb":case"bbb":return _.dayPeriod(l,{width:"abbreviated",context:"formatting"})||_.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbbb":return _.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbb":default:return _.dayPeriod(l,{width:"wide",context:"formatting"})||_.dayPeriod(l,{width:"abbreviated",context:"formatting"})||_.dayPeriod(l,{width:"narrow",context:"formatting"})}}set(l,c,_){return l.setHours(Jx(_),0,0,0),l}}class JO extends bn{constructor(){super(...arguments);Li(this,"priority",80);Li(this,"incompatibleTokens",["a","b","t","T"])}parse(l,c,_){switch(c){case"B":case"BB":case"BBB":return _.dayPeriod(l,{width:"abbreviated",context:"formatting"})||_.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBBB":return _.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBB":default:return _.dayPeriod(l,{width:"wide",context:"formatting"})||_.dayPeriod(l,{width:"abbreviated",context:"formatting"})||_.dayPeriod(l,{width:"narrow",context:"formatting"})}}set(l,c,_){return l.setHours(Jx(_),0,0,0),l}}class QO extends bn{constructor(){super(...arguments);Li(this,"priority",70);Li(this,"incompatibleTokens",["H","K","k","t","T"])}parse(l,c,_){switch(c){case"h":return Cs(Ws.hour12h,l);case"ho":return _.ordinalNumber(l,{unit:"hour"});default:return js(c.length,l)}}validate(l,c){return c>=1&&c<=12}set(l,c,_){const A=l.getHours()>=12;return A&&_<12?l.setHours(_+12,0,0,0):!A&&_===12?l.setHours(0,0,0,0):l.setHours(_,0,0,0),l}}class eL extends bn{constructor(){super(...arguments);Li(this,"priority",70);Li(this,"incompatibleTokens",["a","b","h","K","k","t","T"])}parse(l,c,_){switch(c){case"H":return Cs(Ws.hour23h,l);case"Ho":return _.ordinalNumber(l,{unit:"hour"});default:return js(c.length,l)}}validate(l,c){return c>=0&&c<=23}set(l,c,_){return l.setHours(_,0,0,0),l}}class tL extends bn{constructor(){super(...arguments);Li(this,"priority",70);Li(this,"incompatibleTokens",["h","H","k","t","T"])}parse(l,c,_){switch(c){case"K":return Cs(Ws.hour11h,l);case"Ko":return _.ordinalNumber(l,{unit:"hour"});default:return js(c.length,l)}}validate(l,c){return c>=0&&c<=11}set(l,c,_){return l.getHours()>=12&&_<12?l.setHours(_+12,0,0,0):l.setHours(_,0,0,0),l}}class iL extends bn{constructor(){super(...arguments);Li(this,"priority",70);Li(this,"incompatibleTokens",["a","b","h","H","K","t","T"])}parse(l,c,_){switch(c){case"k":return Cs(Ws.hour24h,l);case"ko":return _.ordinalNumber(l,{unit:"hour"});default:return js(c.length,l)}}validate(l,c){return c>=1&&c<=24}set(l,c,_){const A=_<=24?_%24:_;return l.setHours(A,0,0,0),l}}class rL extends bn{constructor(){super(...arguments);Li(this,"priority",60);Li(this,"incompatibleTokens",["t","T"])}parse(l,c,_){switch(c){case"m":return Cs(Ws.minute,l);case"mo":return _.ordinalNumber(l,{unit:"minute"});default:return js(c.length,l)}}validate(l,c){return c>=0&&c<=59}set(l,c,_){return l.setMinutes(_,0,0),l}}class nL extends bn{constructor(){super(...arguments);Li(this,"priority",50);Li(this,"incompatibleTokens",["t","T"])}parse(l,c,_){switch(c){case"s":return Cs(Ws.second,l);case"so":return _.ordinalNumber(l,{unit:"second"});default:return js(c.length,l)}}validate(l,c){return c>=0&&c<=59}set(l,c,_){return l.setSeconds(_,0),l}}class sL extends bn{constructor(){super(...arguments);Li(this,"priority",30);Li(this,"incompatibleTokens",["t","T"])}parse(l,c){const _=A=>Math.trunc(A*Math.pow(10,-c.length+3));return qs(js(c.length,l),_)}set(l,c,_){return l.setMilliseconds(_),l}}class oL extends bn{constructor(){super(...arguments);Li(this,"priority",10);Li(this,"incompatibleTokens",["t","T","x"])}parse(l,c){switch(c){case"X":return zu(Ru.basicOptionalMinutes,l);case"XX":return zu(Ru.basic,l);case"XXXX":return zu(Ru.basicOptionalSeconds,l);case"XXXXX":return zu(Ru.extendedOptionalSeconds,l);case"XXX":default:return zu(Ru.extended,l)}}set(l,c,_){return c.timestampIsSet?l:Rn(l,l.getTime()-Yy(l)-_)}}class aL extends bn{constructor(){super(...arguments);Li(this,"priority",10);Li(this,"incompatibleTokens",["t","T","X"])}parse(l,c){switch(c){case"x":return zu(Ru.basicOptionalMinutes,l);case"xx":return zu(Ru.basic,l);case"xxxx":return zu(Ru.basicOptionalSeconds,l);case"xxxxx":return zu(Ru.extendedOptionalSeconds,l);case"xxx":default:return zu(Ru.extended,l)}}set(l,c,_){return c.timestampIsSet?l:Rn(l,l.getTime()-Yy(l)-_)}}class lL extends bn{constructor(){super(...arguments);Li(this,"priority",40);Li(this,"incompatibleTokens","*")}parse(l){return J2(l)}set(l,c,_){return[Rn(l,_*1e3),{timestampIsSet:!0}]}}class cL extends bn{constructor(){super(...arguments);Li(this,"priority",20);Li(this,"incompatibleTokens","*")}parse(l){return J2(l)}set(l,c,_){return[Rn(l,_),{timestampIsSet:!0}]}}const uL={G:new AO,y:new PO,Y:new IO,R:new DO,u:new kO,Q:new OO,q:new LO,M:new RO,L:new zO,w:new BO,I:new VO,d:new $O,D:new GO,E:new HO,e:new WO,c:new qO,i:new XO,a:new ZO,b:new KO,B:new JO,h:new QO,H:new eL,K:new tL,k:new iL,m:new rL,s:new nL,S:new sL,X:new oL,x:new aL,t:new lL,T:new cL},hL=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,dL=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,pL=/^'([^]*?)'?$/,fL=/''/g,mL=/\S/,gL=/[a-zA-Z]/;function _L(m,g,l,c){var Ve,We,rt,ht,tt,at,Rt,Ne;const _=()=>Rn((c==null?void 0:c.in)||l,NaN),A=xO(),N=(c==null?void 0:c.locale)??A.locale??Y2,r=(c==null?void 0:c.firstWeekContainsDate)??((We=(Ve=c==null?void 0:c.locale)==null?void 0:Ve.options)==null?void 0:We.firstWeekContainsDate)??A.firstWeekContainsDate??((ht=(rt=A.locale)==null?void 0:rt.options)==null?void 0:ht.firstWeekContainsDate)??1,q=(c==null?void 0:c.weekStartsOn)??((at=(tt=c==null?void 0:c.locale)==null?void 0:tt.options)==null?void 0:at.weekStartsOn)??A.weekStartsOn??((Ne=(Rt=A.locale)==null?void 0:Rt.options)==null?void 0:Ne.weekStartsOn)??0;if(!g)return m?_():ar(l,c==null?void 0:c.in);const ie={firstWeekContainsDate:r,weekStartsOn:q,locale:N},ae=[new CO(c==null?void 0:c.in,l)],he=g.match(dL).map(Tt=>{const qt=Tt[0];if(qt in Tx){const Te=Tx[qt];return Te(Tt,N.formatLong)}return Tt}).join("").match(hL),ve=[];for(let Tt of he){const qt=Tt[0],Te=uL[qt];if(Te){const{incompatibleTokens:gt}=Te;if(Array.isArray(gt)){const Ti=ve.find(ni=>gt.includes(ni.token)||ni.token===qt);if(Ti)throw new RangeError(`The format string mustn't contain \`${Ti.fullToken}\` and \`${Tt}\` at the same time`)}else if(Te.incompatibleTokens==="*"&&ve.length>0)throw new RangeError(`The format string mustn't contain \`${Tt}\` and any other token at the same time`);ve.push({token:qt,fullToken:Tt});const oi=Te.run(m,Tt,N.match,ie);if(!oi)return _();ae.push(oi.setter),m=oi.rest}else{if(qt.match(gL))throw new RangeError("Format string contains an unescaped latin alphabet character `"+qt+"`");if(Tt==="''"?Tt="'":qt==="'"&&(Tt=yL(Tt)),m.indexOf(Tt)===0)m=m.slice(Tt.length);else return _()}}if(m.length>0&&mL.test(m))return _();const Ae=ae.map(Tt=>Tt.priority).sort((Tt,qt)=>qt-Tt).filter((Tt,qt,Te)=>Te.indexOf(Tt)===qt).map(Tt=>ae.filter(qt=>qt.priority===Tt).sort((qt,Te)=>Te.subPriority-qt.subPriority)).map(Tt=>Tt[0]);let we=ar(l,c==null?void 0:c.in);if(isNaN(+we))return _();const Pe={};for(const Tt of Ae){if(!Tt.validate(we,ie))return _();const qt=Tt.set(we,Pe,ie);Array.isArray(qt)?(we=qt[0],Object.assign(Pe,qt[1])):we=qt}return we}function yL(m){return m.match(pL)[1].replace(fL,"'")}function vL(m,g,l){const[c,_]=Rh(l==null?void 0:l.in,m,g);return c.getFullYear()===_.getFullYear()&&c.getMonth()===_.getMonth()}function xL(m,g,l){const[c,_]=Rh(l==null?void 0:l.in,m,g);return+Sx(c)==+Sx(_)}function bL(m,g,l){const[c,_]=Rh(l==null?void 0:l.in,m,g);return c.getFullYear()===_.getFullYear()}function Jg(m,g,l){const c=+ar(m,l==null?void 0:l.in),[_,A]=[+ar(g.start,l==null?void 0:l.in),+ar(g.end,l==null?void 0:l.in)].sort((N,r)=>N-r);return c>=_&&c<=A}function wL(m,g,l){return zc(m,-1,l)}function SL(m,g){const l=()=>Rn(g==null?void 0:g.in,NaN),_=CL(m);let A;if(_.date){const ie=AL(_.date,2);A=PL(ie.restDateString,ie.year)}if(!A||isNaN(+A))return l();const N=+A;let r=0,q;if(_.time&&(r=IL(_.time),isNaN(r)))return l();if(_.timezone){if(q=DL(_.timezone),isNaN(q))return l()}else{const ie=new Date(N+r),ae=ar(0,g==null?void 0:g.in);return ae.setFullYear(ie.getUTCFullYear(),ie.getUTCMonth(),ie.getUTCDate()),ae.setHours(ie.getUTCHours(),ie.getUTCMinutes(),ie.getUTCSeconds(),ie.getUTCMilliseconds()),ae}return ar(N+r+q,g==null?void 0:g.in)}const fy={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},TL=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,ML=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,EL=/^([+-])(\d{2})(?::?(\d{2}))?$/;function CL(m){const g={},l=m.split(fy.dateTimeDelimiter);let c;if(l.length>2)return g;if(/:/.test(l[0])?c=l[0]:(g.date=l[0],c=l[1],fy.timeZoneDelimiter.test(g.date)&&(g.date=m.split(fy.timeZoneDelimiter)[0],c=m.substr(g.date.length,m.length))),c){const _=fy.timezone.exec(c);_?(g.time=c.replace(_[1],""),g.timezone=_[1]):g.time=c}return g}function AL(m,g){const l=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+g)+"})|(\\d{2}|[+-]\\d{"+(2+g)+"})$)"),c=m.match(l);if(!c)return{year:NaN,restDateString:""};const _=c[1]?parseInt(c[1]):null,A=c[2]?parseInt(c[2]):null;return{year:A===null?_:A*100,restDateString:m.slice((c[1]||c[2]).length)}}function PL(m,g){if(g===null)return new Date(NaN);const l=m.match(TL);if(!l)return new Date(NaN);const c=!!l[4],_=zg(l[1]),A=zg(l[2])-1,N=zg(l[3]),r=zg(l[4]),q=zg(l[5])-1;if(c)return zL(g,r,q)?kL(g,r,q):new Date(NaN);{const ie=new Date(0);return!LL(g,A,N)||!RL(g,_)?new Date(NaN):(ie.setUTCFullYear(g,A,Math.max(_,N)),ie)}}function zg(m){return m?parseInt(m):1}function IL(m){const g=m.match(ML);if(!g)return NaN;const l=ix(g[1]),c=ix(g[2]),_=ix(g[3]);return FL(l,c,_)?l*y0+c*_0+_*1e3:NaN}function ix(m){return m&&parseFloat(m.replace(",","."))||0}function DL(m){if(m==="Z")return 0;const g=m.match(EL);if(!g)return 0;const l=g[1]==="+"?-1:1,c=parseInt(g[2]),_=g[3]&&parseInt(g[3])||0;return BL(c,_)?l*(c*y0+_*_0):NaN}function kL(m,g,l){const c=new Date(0);c.setUTCFullYear(m,0,4);const _=c.getUTCDay()||7,A=(g-1)*7+l+1-_;return c.setUTCDate(c.getUTCDate()+A),c}const OL=[31,null,31,30,31,30,31,31,30,31,30,31];function tM(m){return m%400===0||m%4===0&&m%100!==0}function LL(m,g,l){return g>=0&&g<=11&&l>=1&&l<=(OL[g]||(tM(m)?29:28))}function RL(m,g){return g>=1&&g<=(tM(m)?366:365)}function zL(m,g,l){return g>=1&&g<=53&&l>=0&&l<=6}function FL(m,g,l){return m===24?g===0&&l===0:l>=0&&l<60&&g>=0&&g<60&&m>=0&&m<25}function BL(m,g){return g>=0&&g<=59}function Wl(m,g,l){const c=ar(m,l==null?void 0:l.in),_=c.getFullYear(),A=c.getDate(),N=Rn(m,0);N.setFullYear(_,g,15),N.setHours(0,0,0,0);const r=vO(N);return c.setMonth(g,Math.min(A,r)),c}function Cy(m,g,l){const c=ar(m,l==null?void 0:l.in);return c.setHours(g),c}function Ay(m,g,l){const c=ar(m,l==null?void 0:l.in);return c.setMinutes(g),c}function wm(m,g,l){const c=ar(m,l==null?void 0:l.in),_=Math.trunc(c.getMonth()/3)+1,A=g-_;return Wl(c,c.getMonth()+A*3)}function Py(m,g,l){const c=ar(m,l==null?void 0:l.in);return c.setSeconds(g),c}function Du(m,g,l){const c=ar(m,l==null?void 0:l.in);return isNaN(+c)?Rn(m,NaN):(c.setFullYear(g),c)}function lf(m,g,l){return Fc(m,-g,l)}function iM(m,g,l){return Xx(m,-1,l)}function BS(m,g,l){return Xy(m,-1,l)}function Om(m,g,l){return Ch(m,-g,l)}var Iy=typeof document<"u"?Ke.useLayoutEffect:Ke.useEffect;function t0(m,g){if(m===g)return!0;if(typeof m!=typeof g)return!1;if(typeof m=="function"&&m.toString()===g.toString())return!0;let l,c,_;if(m&&g&&typeof m=="object"){if(Array.isArray(m)){if(l=m.length,l!==g.length)return!1;for(c=l;c--!==0;)if(!t0(m[c],g[c]))return!1;return!0}if(_=Object.keys(m),l=_.length,l!==Object.keys(g).length)return!1;for(c=l;c--!==0;)if(!{}.hasOwnProperty.call(g,_[c]))return!1;for(c=l;c--!==0;){const A=_[c];if(!(A==="_owner"&&m.$$typeof)&&!t0(m[A],g[A]))return!1}return!0}return m!==m&&g!==g}function rM(m){return typeof window>"u"?1:(m.ownerDocument.defaultView||window).devicePixelRatio||1}function NS(m,g){const l=rM(m);return Math.round(g*l)/l}function rx(m){const g=Ke.useRef(m);return Iy(()=>{g.current=m}),g}function NL(m){m===void 0&&(m={});const{placement:g="bottom",strategy:l="absolute",middleware:c=[],platform:_,elements:{reference:A,floating:N}={},transform:r=!0,whileElementsMounted:q,open:ie}=m,[ae,he]=Ke.useState({x:0,y:0,strategy:l,placement:g,middlewareData:{},isPositioned:!1}),[ve,Ae]=Ke.useState(c);t0(ve,c)||Ae(c);const[we,Pe]=Ke.useState(null),[Ve,We]=Ke.useState(null),rt=Ke.useCallback(Yt=>{Yt!==Rt.current&&(Rt.current=Yt,Pe(Yt))},[]),ht=Ke.useCallback(Yt=>{Yt!==Ne.current&&(Ne.current=Yt,We(Yt))},[]),tt=A||we,at=N||Ve,Rt=Ke.useRef(null),Ne=Ke.useRef(null),Tt=Ke.useRef(ae),qt=q!=null,Te=rx(q),gt=rx(_),oi=rx(ie),Ti=Ke.useCallback(()=>{if(!Rt.current||!Ne.current)return;const Yt={placement:g,strategy:l,middleware:ve};gt.current&&(Yt.platform=gt.current),JP(Rt.current,Ne.current,Yt).then(jt=>{const Ri={...jt,isPositioned:oi.current!==!1};ni.current&&!t0(Tt.current,Ri)&&(Tt.current=Ri,Lx.flushSync(()=>{he(Ri)}))})},[ve,g,l,gt,oi]);Iy(()=>{ie===!1&&Tt.current.isPositioned&&(Tt.current.isPositioned=!1,he(Yt=>({...Yt,isPositioned:!1})))},[ie]);const ni=Ke.useRef(!1);Iy(()=>(ni.current=!0,()=>{ni.current=!1}),[]),Iy(()=>{if(tt&&(Rt.current=tt),at&&(Ne.current=at),tt&&at){if(Te.current)return Te.current(tt,at,Ti);Ti()}},[tt,at,Ti,Te,qt]);const Mt=Ke.useMemo(()=>({reference:Rt,floating:Ne,setReference:rt,setFloating:ht}),[rt,ht]),zt=Ke.useMemo(()=>({reference:tt,floating:at}),[tt,at]),ii=Ke.useMemo(()=>{const Yt={position:l,left:0,top:0};if(!zt.floating)return Yt;const jt=NS(zt.floating,ae.x),Ri=NS(zt.floating,ae.y);return r?{...Yt,transform:"translate("+jt+"px, "+Ri+"px)",...rM(zt.floating)>=1.5&&{willChange:"transform"}}:{position:l,left:jt,top:Ri}},[l,r,zt.floating,ae.x,ae.y]);return Ke.useMemo(()=>({...ae,update:Ti,refs:Mt,elements:zt,floatingStyles:ii}),[ae,Ti,Mt,zt,ii])}const VL=m=>{function g(l){return{}.hasOwnProperty.call(l,"current")}return{name:"arrow",options:m,fn(l){const{element:c,padding:_}=typeof m=="function"?m(l):m;return c&&g(c)?c.current!=null?cS({element:c.current,padding:_}).fn(l):{}:c?cS({element:c,padding:_}).fn(l):{}}}},UL=(m,g)=>({...ZP(m),options:[m,g]}),jL=(m,g)=>({...KP(m),options:[m,g]}),$L=(m,g)=>({...VL(m),options:[m,g]}),nM={...px},GL=nM.useInsertionEffect,HL=GL||(m=>m());function WL(m){const g=Ke.useRef(()=>{});return HL(()=>{g.current=m}),Ke.useCallback(function(){for(var l=arguments.length,c=new Array(l),_=0;_<l;_++)c[_]=arguments[_];return g.current==null?void 0:g.current(...c)},[])}var i0=typeof document<"u"?Ke.useLayoutEffect:Ke.useEffect;let VS=!1,qL=0;const US=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+qL++;function YL(){const[m,g]=Ke.useState(()=>VS?US():void 0);return i0(()=>{m==null&&g(US())},[]),Ke.useEffect(()=>{VS=!0},[]),m}const XL=nM.useId,sM=XL||YL,ZL=Ke.forwardRef(function(g,l){const{context:{placement:c,elements:{floating:_},middlewareData:{arrow:A,shift:N}},width:r=14,height:q=7,tipRadius:ie=0,strokeWidth:ae=0,staticOffset:he,stroke:ve,d:Ae,style:{transform:we,...Pe}={},...Ve}=g,We=sM(),[rt,ht]=Ke.useState(!1);if(i0(()=>{if(!_)return;Zl(_).direction==="rtl"&&ht(!0)},[_]),!_)return null;const[tt,at]=c.split("-"),Rt=tt==="top"||tt==="bottom";let Ne=he;(Rt&&N!=null&&N.x||!Rt&&N!=null&&N.y)&&(Ne=null);const Tt=ae*2,qt=Tt/2,Te=r/2*(ie/-8+1),gt=q/2*ie/4,oi=!!Ae,Ti=Ne&&at==="end"?"bottom":"top";let ni=Ne&&at==="end"?"right":"left";Ne&&rt&&(ni=at==="end"?"left":"right");const Mt=(A==null?void 0:A.x)!=null?Ne||A.x:"",zt=(A==null?void 0:A.y)!=null?Ne||A.y:"",ii=Ae||"M0,0"+(" H"+r)+(" L"+(r-Te)+","+(q-gt))+(" Q"+r/2+","+q+" "+Te+","+(q-gt))+" Z",Yt={top:oi?"rotate(180deg)":"",left:oi?"rotate(90deg)":"rotate(-90deg)",bottom:oi?"":"rotate(180deg)",right:oi?"rotate(-90deg)":"rotate(90deg)"}[tt];return gi.jsxs("svg",{...Ve,"aria-hidden":!0,ref:l,width:oi?r:r+Tt,height:r,viewBox:"0 0 "+r+" "+(q>r?q:r),style:{position:"absolute",pointerEvents:"none",[ni]:Mt,[Ti]:zt,[tt]:Rt||oi?"100%":"calc(100% - "+Tt/2+"px)",transform:[Yt,we].filter(jt=>!!jt).join(" "),...Pe},children:[Tt>0&&gi.jsx("path",{clipPath:"url(#"+We+")",fill:"none",stroke:ve,strokeWidth:Tt+(Ae?0:1),d:ii}),gi.jsx("path",{stroke:Tt&&!Ae?Ve.fill:"none",d:ii}),gi.jsx("clipPath",{id:We,children:gi.jsx("rect",{x:-qt,y:qt*(oi?-1:1),width:r+Tt,height:r})})]})});function KL(){const m=new Map;return{emit(g,l){var c;(c=m.get(g))==null||c.forEach(_=>_(l))},on(g,l){m.set(g,[...m.get(g)||[],l])},off(g,l){var c;m.set(g,((c=m.get(g))==null?void 0:c.filter(_=>_!==l))||[])}}}const JL=Ke.createContext(null),QL=Ke.createContext(null),eR=()=>{var m;return((m=Ke.useContext(JL))==null?void 0:m.id)||null},tR=()=>Ke.useContext(QL);function iR(m){const{open:g=!1,onOpenChange:l,elements:c}=m,_=sM(),A=Ke.useRef({}),[N]=Ke.useState(()=>KL()),r=eR()!=null,[q,ie]=Ke.useState(c.reference),ae=WL((Ae,we,Pe)=>{A.current.openEvent=Ae?we:void 0,N.emit("openchange",{open:Ae,event:we,reason:Pe,nested:r}),l==null||l(Ae,we,Pe)}),he=Ke.useMemo(()=>({setPositionReference:ie}),[]),ve=Ke.useMemo(()=>({reference:q||c.reference||null,floating:c.floating||null,domReference:c.reference}),[q,c.reference,c.floating]);return Ke.useMemo(()=>({dataRef:A,open:g,onOpenChange:ae,elements:ve,events:N,floatingId:_,refs:he}),[g,ae,ve,N,_,he])}function rR(m){m===void 0&&(m={});const{nodeId:g}=m,l=iR({...m,elements:{reference:null,floating:null,...m.elements}}),c=m.rootContext||l,_=c.elements,[A,N]=Ke.useState(null),[r,q]=Ke.useState(null),ae=(_==null?void 0:_.domReference)||A,he=Ke.useRef(null),ve=tR();i0(()=>{ae&&(he.current=ae)},[ae]);const Ae=NL({...m,elements:{..._,...r&&{reference:r}}}),we=Ke.useCallback(ht=>{const tt=Sa(ht)?{getBoundingClientRect:()=>ht.getBoundingClientRect(),contextElement:ht}:ht;q(tt),Ae.refs.setReference(tt)},[Ae.refs]),Pe=Ke.useCallback(ht=>{(Sa(ht)||ht===null)&&(he.current=ht,N(ht)),(Sa(Ae.refs.reference.current)||Ae.refs.reference.current===null||ht!==null&&!Sa(ht))&&Ae.refs.setReference(ht)},[Ae.refs]),Ve=Ke.useMemo(()=>({...Ae.refs,setReference:Pe,setPositionReference:we,domReference:he}),[Ae.refs,Pe,we]),We=Ke.useMemo(()=>({...Ae.elements,domReference:ae}),[Ae.elements,ae]),rt=Ke.useMemo(()=>({...Ae,...c,refs:Ve,elements:We,nodeId:g}),[Ae,Ve,We,g,c]);return i0(()=>{c.dataRef.current.floatingContext=rt;const ht=ve==null?void 0:ve.nodesRef.current.find(tt=>tt.id===g);ht&&(ht.context=rt)}),Ke.useMemo(()=>({...Ae,context:rt,refs:Ve,elements:We}),[Ae,Ve,We,rt])}/*!
  react-datepicker v8.2.1
  https://github.com/Hacker0x01/react-datepicker
  Released under the MIT License.
*/var Ex=function(g,l){return Ex=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,_){c.__proto__=_}||function(c,_){for(var A in _)Object.prototype.hasOwnProperty.call(_,A)&&(c[A]=_[A])},Ex(g,l)};function Ao(m,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");Ex(m,g);function l(){this.constructor=m}m.prototype=g===null?Object.create(g):(l.prototype=g.prototype,new l)}var mn=function(){return mn=Object.assign||function(l){for(var c,_=1,A=arguments.length;_<A;_++){c=arguments[_];for(var N in c)Object.prototype.hasOwnProperty.call(c,N)&&(l[N]=c[N])}return l},mn.apply(this,arguments)};function Bu(m,g,l){if(l||arguments.length===2)for(var c=0,_=g.length,A;c<_;c++)(A||!(c in g))&&(A||(A=Array.prototype.slice.call(g,0,c)),A[c]=g[c]);return m.concat(A||Array.prototype.slice.call(g))}var nR=function(m){var g=m.showTimeSelectOnly,l=g===void 0?!1:g,c=m.showTime,_=c===void 0?!1:c,A=m.className,N=m.children,r=l?"Choose Time":"Choose Date".concat(_?" and Time":"");return Qt.createElement("div",{className:A,role:"dialog","aria-label":r,"aria-modal":"true"},N)},sR=function(m,g){var l=Ke.useRef(null),c=Ke.useRef(m);c.current=m;var _=Ke.useCallback(function(A){var N,r=A.composed&&A.composedPath&&A.composedPath().find(function(q){return q instanceof Node})||A.target;l.current&&!l.current.contains(r)&&(g&&r instanceof HTMLElement&&r.classList.contains(g)||(N=c.current)===null||N===void 0||N.call(c,A))},[g]);return Ke.useEffect(function(){return document.addEventListener("mousedown",_),function(){document.removeEventListener("mousedown",_)}},[_]),l},x0=function(m){var g=m.children,l=m.onClickOutside,c=m.className,_=m.containerRef,A=m.style,N=m.ignoreClass,r=sR(l,N);return Qt.createElement("div",{className:c,style:A,ref:function(q){r.current=q,_&&(_.current=q)}},g)},Ui;(function(m){m.ArrowUp="ArrowUp",m.ArrowDown="ArrowDown",m.ArrowLeft="ArrowLeft",m.ArrowRight="ArrowRight",m.PageUp="PageUp",m.PageDown="PageDown",m.Home="Home",m.End="End",m.Enter="Enter",m.Space=" ",m.Tab="Tab",m.Escape="Escape",m.Backspace="Backspace",m.X="x"})(Ui||(Ui={}));function oM(){var m=typeof window<"u"?window:globalThis;return m}var o_=12;function En(m){if(m==null)return new Date;var g=typeof m=="string"?SL(m):ar(m);return b0(g)?g:new Date}function nx(m,g,l,c,_){_===void 0&&(_=En());for(var A=Lm(l)||Lm(eb()),N=Array.isArray(g)?g:[g],r=0,q=N;r<q.length;r++){var ie=q[r],ae=_L(m,ie,_,{locale:A});if(b0(ae)&&(!c||m===vs(ae,ie,l)))return ae}return null}function b0(m,g){return Zy(m)&&!df(m,new Date("1/1/1800"))}function vs(m,g,l){if(l==="en")return zS(m,g,{useAdditionalWeekYearTokens:!0,useAdditionalDayOfYearTokens:!0});var c=l?Lm(l):void 0;return l&&!c&&console.warn('A locale object was not found for the provided string ["'.concat(l,'"].')),c=c||Lm(eb()),zS(m,g,{locale:c,useAdditionalWeekYearTokens:!0,useAdditionalDayOfYearTokens:!0})}function Hl(m,g){var l=g.dateFormat,c=g.locale,_=Array.isArray(l)&&l.length>0?l[0]:l;return m&&vs(m,_,c)||""}function oR(m,g,l){if(!m)return"";var c=Hl(m,l),_=g?Hl(g,l):"";return"".concat(c," - ").concat(_)}function aR(m,g){if(!(m!=null&&m.length))return"";var l=m[0]?Hl(m[0],g):"";if(m.length===1)return l;if(m.length===2&&m[1]){var c=Hl(m[1],g);return"".concat(l,", ").concat(c)}var _=m.length-1;return"".concat(l," (+").concat(_,")")}function sx(m,g){var l=g.hour,c=l===void 0?0:l,_=g.minute,A=_===void 0?0:_,N=g.second,r=N===void 0?0:N;return Cy(Ay(Py(m,r),A),c)}function lR(m){return Zx(m)}function cR(m,g){return vs(m,"ddd",g)}function Dy(m){return hf(m)}function Bd(m,g,l){var c=Lm(g||eb());return kh(m,{locale:c,weekStartsOn:l})}function Dh(m){return W2(m)}function Ug(m){return v0(m)}function jS(m){return Sx(m)}function $S(){return hf(En())}function GS(m){return G2(m)}function uR(m){return Sk(m)}function hR(m){return H2(m)}function Lu(m,g){return m&&g?bL(m,g):!m&&!g}function wa(m,g){return m&&g?vL(m,g):!m&&!g}function r0(m,g){return m&&g?xL(m,g):!m&&!g}function fn(m,g){return m&&g?bk(m,g):!m&&!g}function nf(m,g){return m&&g?wO(m,g):!m&&!g}function jg(m,g,l){var c,_=hf(g),A=G2(l);try{c=Jg(m,{start:_,end:A})}catch{c=!1}return c}function eb(){var m=oM();return m.__localeId__}function Lm(m){if(typeof m=="string"){var g=oM();return g.__localeData__?g.__localeData__[m]:void 0}else return m}function dR(m,g,l){return g(vs(m,"EEEE",l))}function pR(m,g){return vs(m,"EEEEEE",g)}function fR(m,g){return vs(m,"EEE",g)}function tb(m,g){return vs(Wl(En(),m),"LLLL",g)}function aM(m,g){return vs(Wl(En(),m),"LLL",g)}function mR(m,g){return vs(wm(En(),m),"QQQ",g)}function Yl(m,g){var l=g===void 0?{}:g,c=l.minDate,_=l.maxDate,A=l.excludeDates,N=l.excludeDateIntervals,r=l.includeDates,q=l.includeDateIntervals,ie=l.filterDate;return a_(m,{minDate:c,maxDate:_})||A&&A.some(function(ae){return ae instanceof Date?fn(m,ae):fn(m,ae.date)})||N&&N.some(function(ae){var he=ae.start,ve=ae.end;return Jg(m,{start:he,end:ve})})||r&&!r.some(function(ae){return fn(m,ae)})||q&&!q.some(function(ae){var he=ae.start,ve=ae.end;return Jg(m,{start:he,end:ve})})||ie&&!ie(En(m))||!1}function ib(m,g){var l=g===void 0?{}:g,c=l.excludeDates,_=l.excludeDateIntervals;return _&&_.length>0?_.some(function(A){var N=A.start,r=A.end;return Jg(m,{start:N,end:r})}):c&&c.some(function(A){var N;return A instanceof Date?fn(m,A):fn(m,(N=A.date)!==null&&N!==void 0?N:new Date)})||!1}function lM(m,g){var l=g===void 0?{}:g,c=l.minDate,_=l.maxDate,A=l.excludeDates,N=l.includeDates,r=l.filterDate;return a_(m,{minDate:c?W2(c):void 0,maxDate:_?H2(_):void 0})||(A==null?void 0:A.some(function(q){return wa(m,q instanceof Date?q:q.date)}))||N&&!N.some(function(q){return wa(m,q)})||r&&!r(En(m))||!1}function my(m,g,l,c){var _=Zr(m),A=Ta(m),N=Zr(g),r=Ta(g),q=Zr(c);return _===N&&_===q?A<=l&&l<=r:_<N?q===_&&A<=l||q===N&&r>=l||q<N&&q>_:!1}function gR(m,g){var l=g===void 0?{}:g,c=l.minDate,_=l.maxDate,A=l.excludeDates,N=l.includeDates;return a_(m,{minDate:c,maxDate:_})||A&&A.some(function(r){return wa(r instanceof Date?r:r.date,m)})||N&&!N.some(function(r){return wa(r,m)})||!1}function gy(m,g){var l=g===void 0?{}:g,c=l.minDate,_=l.maxDate,A=l.excludeDates,N=l.includeDates,r=l.filterDate;return a_(m,{minDate:c,maxDate:_})||(A==null?void 0:A.some(function(q){return r0(m,q instanceof Date?q:q.date)}))||N&&!N.some(function(q){return r0(m,q)})||r&&!r(En(m))||!1}function _y(m,g,l){if(!g||!l||!Zy(g)||!Zy(l))return!1;var c=Zr(g),_=Zr(l);return c<=m&&_>=m}function ky(m,g){var l=g===void 0?{}:g,c=l.minDate,_=l.maxDate,A=l.excludeDates,N=l.includeDates,r=l.filterDate,q=new Date(m,0,1);return a_(q,{minDate:c?v0(c):void 0,maxDate:_?q2(_):void 0})||(A==null?void 0:A.some(function(ie){return Lu(q,ie instanceof Date?ie:ie.date)}))||N&&!N.some(function(ie){return Lu(q,ie)})||r&&!r(En(q))||!1}function yy(m,g,l,c){var _=Zr(m),A=af(m),N=Zr(g),r=af(g),q=Zr(c);return _===N&&_===q?A<=l&&l<=r:_<N?q===_&&A<=l||q===N&&r>=l||q<N&&q>_:!1}function a_(m,g){var l,c=g===void 0?{}:g,_=c.minDate,A=c.maxDate;return(l=_&&km(m,_)<0||A&&km(m,A)>0)!==null&&l!==void 0?l:!1}function HS(m,g){return g.some(function(l){return Ph(l)===Ph(m)&&Ih(l)===Ih(m)&&Fd(l)===Fd(m)})}function WS(m,g){var l=g===void 0?{}:g,c=l.excludeTimes,_=l.includeTimes,A=l.filterTime;return c&&HS(m,c)||_&&!HS(m,_)||A&&!A(m)||!1}function qS(m,g){var l=g.minTime,c=g.maxTime;if(!l||!c)throw new Error("Both minTime and maxTime props required");var _=En();_=Cy(_,Ph(m)),_=Ay(_,Ih(m)),_=Py(_,Fd(m));var A=En();A=Cy(A,Ph(l)),A=Ay(A,Ih(l)),A=Py(A,Fd(l));var N=En();N=Cy(N,Ph(c)),N=Ay(N,Ih(c)),N=Py(N,Fd(c));var r;try{r=!Jg(_,{start:A,end:N})}catch{r=!1}return r}function YS(m,g){var l=g===void 0?{}:g,c=l.minDate,_=l.includeDates,A=lf(m,1);return c&&Ky(c,A)>0||_&&_.every(function(N){return Ky(N,A)>0})||!1}function XS(m,g){var l=g===void 0?{}:g,c=l.maxDate,_=l.includeDates,A=Fc(m,1);return c&&Ky(A,c)>0||_&&_.every(function(N){return Ky(A,N)>0})||!1}function _R(m,g){var l=g===void 0?{}:g,c=l.minDate,_=l.includeDates,A=v0(m),N=iM(A);return c&&Jy(c,N)>0||_&&_.every(function(r){return Jy(r,N)>0})||!1}function yR(m,g){var l=g===void 0?{}:g,c=l.maxDate,_=l.includeDates,A=q2(m),N=Xx(A,1);return c&&Jy(N,c)>0||_&&_.every(function(r){return Jy(N,r)>0})||!1}function ZS(m,g){var l=g===void 0?{}:g,c=l.minDate,_=l.includeDates,A=Om(m,1);return c&&Qy(c,A)>0||_&&_.every(function(N){return Qy(N,A)>0})||!1}function vR(m,g){var l=g===void 0?{}:g,c=l.minDate,_=l.yearItemNumber,A=_===void 0?o_:_,N=Ug(Om(m,A)),r=zd(N,A).endPeriod,q=c&&Zr(c);return q&&q>r||!1}function KS(m,g){var l=g===void 0?{}:g,c=l.maxDate,_=l.includeDates,A=Ch(m,1);return c&&Qy(A,c)>0||_&&_.every(function(N){return Qy(A,N)>0})||!1}function xR(m,g){var l=g===void 0?{}:g,c=l.maxDate,_=l.yearItemNumber,A=_===void 0?o_:_,N=Ch(m,A),r=zd(N,A).startPeriod,q=c&&Zr(c);return q&&q<r||!1}function cM(m){var g=m.minDate,l=m.includeDates;if(l&&g){var c=l.filter(function(_){return km(_,g)>=0});return IS(c)}else return l?IS(l):g}function uM(m){var g=m.maxDate,l=m.includeDates;if(l&&g){var c=l.filter(function(_){return km(_,g)<=0});return PS(c)}else return l?PS(l):g}function JS(m,g){var l;m===void 0&&(m=[]),g===void 0&&(g="react-datepicker__day--highlighted");for(var c=new Map,_=0,A=m.length;_<A;_++){var N=m[_];if(Ah(N)){var r=vs(N,"MM.dd.yyyy"),q=c.get(r)||[];q.includes(g)||(q.push(g),c.set(r,q))}else if(typeof N=="object"){var ie=Object.keys(N),ae=(l=ie[0])!==null&&l!==void 0?l:"",he=N[ae];if(typeof ae=="string"&&Array.isArray(he))for(var ve=0,Ae=he.length;ve<Ae;ve++){var we=he[ve];if(we){var r=vs(we,"MM.dd.yyyy"),q=c.get(r)||[];q.includes(ae)||(q.push(ae),c.set(r,q))}}}}return c}function bR(m,g){return m.length!==g.length?!1:m.every(function(l,c){return l===g[c]})}function wR(m,g){m===void 0&&(m=[]),g===void 0&&(g="react-datepicker__day--holidays");var l=new Map;return m.forEach(function(c){var _=c.date,A=c.holidayName;if(Ah(_)){var N=vs(_,"MM.dd.yyyy"),r=l.get(N)||{className:"",holidayNames:[]};if(!("className"in r&&r.className===g&&bR(r.holidayNames,[A]))){r.className=g;var q=r.holidayNames;r.holidayNames=q?Bu(Bu([],q,!0),[A],!1):[A],l.set(N,r)}}}),l}function SR(m,g,l,c,_){for(var A=_.length,N=[],r=0;r<A;r++){var q=m,ie=_[r];ie&&(q=_k(q,Ph(ie)),q=wx(q,Ih(ie)),q=xk(q,Fd(ie)));var ae=wx(m,(l+1)*c);Vd(q,g)&&df(q,ae)&&ie!=null&&N.push(ie)}return N}function QS(m){return m<10?"0".concat(m):"".concat(m)}function zd(m,g){g===void 0&&(g=o_);var l=Math.ceil(Zr(m)/g)*g,c=l-(g-1);return{startPeriod:c,endPeriod:l}}function TR(m){var g=new Date(m.getFullYear(),m.getMonth(),m.getDate()),l=new Date(m.getFullYear(),m.getMonth(),m.getDate(),24);return Math.round((+l-+g)/36e5)}function eT(m){var g=m.getSeconds(),l=m.getMilliseconds();return ar(m.getTime()-g*1e3-l)}function MR(m,g){return eT(m).getTime()===eT(g).getTime()}function tT(m){if(!Ah(m))throw new Error("Invalid date");var g=new Date(m);return g.setHours(0,0,0,0),g}function iT(m,g){if(!Ah(m)||!Ah(g))throw new Error("Invalid date received");var l=tT(m),c=tT(g);return df(l,c)}function hM(m){return m.key===Ui.Space}var ER=function(m){Ao(g,m);function g(l){var c=m.call(this,l)||this;return c.inputRef=Qt.createRef(),c.onTimeChange=function(_){var A,N;c.setState({time:_});var r=c.props.date,q=r instanceof Date&&!isNaN(+r),ie=q?r:new Date;if(_!=null&&_.includes(":")){var ae=_.split(":"),he=ae[0],ve=ae[1];ie.setHours(Number(he)),ie.setMinutes(Number(ve))}(N=(A=c.props).onChange)===null||N===void 0||N.call(A,ie)},c.renderTimeInput=function(){var _=c.state.time,A=c.props,N=A.date,r=A.timeString,q=A.customTimeInput;return q?Ke.cloneElement(q,{date:N,value:_,onChange:c.onTimeChange}):Qt.createElement("input",{type:"time",className:"react-datepicker-time__input",placeholder:"Time",name:"time-input",ref:c.inputRef,onClick:function(){var ie;(ie=c.inputRef.current)===null||ie===void 0||ie.focus()},required:!0,value:_,onChange:function(ie){c.onTimeChange(ie.target.value||r)}})},c.state={time:c.props.timeString},c}return g.getDerivedStateFromProps=function(l,c){return l.timeString!==c.time?{time:l.timeString}:null},g.prototype.render=function(){return Qt.createElement("div",{className:"react-datepicker__input-time-container"},Qt.createElement("div",{className:"react-datepicker-time__caption"},this.props.timeInputLabel),Qt.createElement("div",{className:"react-datepicker-time__input-container"},Qt.createElement("div",{className:"react-datepicker-time__input"},this.renderTimeInput())))},g}(Ke.Component),CR=function(m){Ao(g,m);function g(){var l=m!==null&&m.apply(this,arguments)||this;return l.dayEl=Ke.createRef(),l.handleClick=function(c){!l.isDisabled()&&l.props.onClick&&l.props.onClick(c)},l.handleMouseEnter=function(c){!l.isDisabled()&&l.props.onMouseEnter&&l.props.onMouseEnter(c)},l.handleOnKeyDown=function(c){var _,A,N=c.key;N===Ui.Space&&(c.preventDefault(),c.key=Ui.Enter),(A=(_=l.props).handleOnKeyDown)===null||A===void 0||A.call(_,c)},l.isSameDay=function(c){return fn(l.props.day,c)},l.isKeyboardSelected=function(){var c;if(l.props.disabledKeyboardNavigation)return!1;var _=l.props.selectsMultiple?(c=l.props.selectedDates)===null||c===void 0?void 0:c.some(function(N){return l.isSameDayOrWeek(N)}):l.isSameDayOrWeek(l.props.selected),A=l.props.preSelection&&l.isDisabled(l.props.preSelection);return!_&&l.isSameDayOrWeek(l.props.preSelection)&&!A},l.isDisabled=function(c){return c===void 0&&(c=l.props.day),Yl(c,{minDate:l.props.minDate,maxDate:l.props.maxDate,excludeDates:l.props.excludeDates,excludeDateIntervals:l.props.excludeDateIntervals,includeDateIntervals:l.props.includeDateIntervals,includeDates:l.props.includeDates,filterDate:l.props.filterDate})},l.isExcluded=function(){return ib(l.props.day,{excludeDates:l.props.excludeDates,excludeDateIntervals:l.props.excludeDateIntervals})},l.isStartOfWeek=function(){return fn(l.props.day,Bd(l.props.day,l.props.locale,l.props.calendarStartDay))},l.isSameWeek=function(c){return l.props.showWeekPicker&&fn(c,Bd(l.props.day,l.props.locale,l.props.calendarStartDay))},l.isSameDayOrWeek=function(c){return l.isSameDay(c)||l.isSameWeek(c)},l.getHighLightedClass=function(){var c=l.props,_=c.day,A=c.highlightDates;if(!A)return!1;var N=vs(_,"MM.dd.yyyy");return A.get(N)},l.getHolidaysClass=function(){var c,_=l.props,A=_.day,N=_.holidays;if(!N)return[void 0];var r=vs(A,"MM.dd.yyyy");return N.has(r)?[(c=N.get(r))===null||c===void 0?void 0:c.className]:[void 0]},l.isInRange=function(){var c=l.props,_=c.day,A=c.startDate,N=c.endDate;return!A||!N?!1:jg(_,A,N)},l.isInSelectingRange=function(){var c,_=l.props,A=_.day,N=_.selectsStart,r=_.selectsEnd,q=_.selectsRange,ie=_.selectsDisabledDaysInRange,ae=_.startDate,he=_.endDate,ve=(c=l.props.selectingDate)!==null&&c!==void 0?c:l.props.preSelection;return!(N||r||q)||!ve||!ie&&l.isDisabled()?!1:N&&he&&(df(ve,he)||nf(ve,he))?jg(A,ve,he):r&&ae&&(Vd(ve,ae)||nf(ve,ae))||q&&ae&&!he&&(Vd(ve,ae)||nf(ve,ae))?jg(A,ae,ve):!1},l.isSelectingRangeStart=function(){var c;if(!l.isInSelectingRange())return!1;var _=l.props,A=_.day,N=_.startDate,r=_.selectsStart,q=(c=l.props.selectingDate)!==null&&c!==void 0?c:l.props.preSelection;return r?fn(A,q):fn(A,N)},l.isSelectingRangeEnd=function(){var c;if(!l.isInSelectingRange())return!1;var _=l.props,A=_.day,N=_.endDate,r=_.selectsEnd,q=_.selectsRange,ie=(c=l.props.selectingDate)!==null&&c!==void 0?c:l.props.preSelection;return r||q?fn(A,ie):fn(A,N)},l.isRangeStart=function(){var c=l.props,_=c.day,A=c.startDate,N=c.endDate;return!A||!N?!1:fn(A,_)},l.isRangeEnd=function(){var c=l.props,_=c.day,A=c.startDate,N=c.endDate;return!A||!N?!1:fn(N,_)},l.isWeekend=function(){var c=yO(l.props.day);return c===0||c===6},l.isAfterMonth=function(){return l.props.month!==void 0&&(l.props.month+1)%12===Ta(l.props.day)},l.isBeforeMonth=function(){return l.props.month!==void 0&&(Ta(l.props.day)+1)%12===l.props.month},l.isCurrentDay=function(){return l.isSameDay(En())},l.isSelected=function(){var c;return l.props.selectsMultiple?(c=l.props.selectedDates)===null||c===void 0?void 0:c.some(function(_){return l.isSameDayOrWeek(_)}):l.isSameDayOrWeek(l.props.selected)},l.getClassNames=function(c){var _=l.props.dayClassName?l.props.dayClassName(c):void 0;return gn("react-datepicker__day",_,"react-datepicker__day--"+cR(l.props.day),{"react-datepicker__day--disabled":l.isDisabled(),"react-datepicker__day--excluded":l.isExcluded(),"react-datepicker__day--selected":l.isSelected(),"react-datepicker__day--keyboard-selected":l.isKeyboardSelected(),"react-datepicker__day--range-start":l.isRangeStart(),"react-datepicker__day--range-end":l.isRangeEnd(),"react-datepicker__day--in-range":l.isInRange(),"react-datepicker__day--in-selecting-range":l.isInSelectingRange(),"react-datepicker__day--selecting-range-start":l.isSelectingRangeStart(),"react-datepicker__day--selecting-range-end":l.isSelectingRangeEnd(),"react-datepicker__day--today":l.isCurrentDay(),"react-datepicker__day--weekend":l.isWeekend(),"react-datepicker__day--outside-month":l.isAfterMonth()||l.isBeforeMonth()},l.getHighLightedClass(),l.getHolidaysClass())},l.getAriaLabel=function(){var c=l.props,_=c.day,A=c.ariaLabelPrefixWhenEnabled,N=A===void 0?"Choose":A,r=c.ariaLabelPrefixWhenDisabled,q=r===void 0?"Not available":r,ie=l.isDisabled()||l.isExcluded()?q:N;return"".concat(ie," ").concat(vs(_,"PPPP",l.props.locale))},l.getTitle=function(){var c=l.props,_=c.day,A=c.holidays,N=A===void 0?new Map:A,r=c.excludeDates,q=vs(_,"MM.dd.yyyy"),ie=[];return N.has(q)&&ie.push.apply(ie,N.get(q).holidayNames),l.isExcluded()&&ie.push(r==null?void 0:r.filter(function(ae){return ae instanceof Date?fn(ae,_):fn(ae==null?void 0:ae.date,_)}).map(function(ae){if(!(ae instanceof Date))return ae==null?void 0:ae.message})),ie.join(", ")},l.getTabIndex=function(){var c=l.props.selected,_=l.props.preSelection,A=!(l.props.showWeekPicker&&(l.props.showWeekNumber||!l.isStartOfWeek()))&&(l.isKeyboardSelected()||l.isSameDay(c)&&fn(_,c))?0:-1;return A},l.handleFocusDay=function(){var c;l.shouldFocusDay()&&((c=l.dayEl.current)===null||c===void 0||c.focus({preventScroll:!0}))},l.renderDayContents=function(){return l.props.monthShowsDuplicateDaysEnd&&l.isAfterMonth()||l.props.monthShowsDuplicateDaysStart&&l.isBeforeMonth()?null:l.props.renderDayContents?l.props.renderDayContents(FS(l.props.day),l.props.day):FS(l.props.day)},l.render=function(){return Qt.createElement("div",{ref:l.dayEl,className:l.getClassNames(l.props.day),onKeyDown:l.handleOnKeyDown,onClick:l.handleClick,onMouseEnter:l.props.usePointerEvent?void 0:l.handleMouseEnter,onPointerEnter:l.props.usePointerEvent?l.handleMouseEnter:void 0,tabIndex:l.getTabIndex(),"aria-label":l.getAriaLabel(),role:"option",title:l.getTitle(),"aria-disabled":l.isDisabled(),"aria-current":l.isCurrentDay()?"date":void 0,"aria-selected":l.isSelected()||l.isInRange()},l.renderDayContents(),l.getTitle()!==""&&Qt.createElement("span",{className:"overlay"},l.getTitle()))},l}return g.prototype.componentDidMount=function(){this.handleFocusDay()},g.prototype.componentDidUpdate=function(){this.handleFocusDay()},g.prototype.shouldFocusDay=function(){var l=!1;return this.getTabIndex()===0&&this.isSameDay(this.props.preSelection)&&((!document.activeElement||document.activeElement===document.body)&&(l=!0),this.props.inline&&!this.props.shouldFocusDayInline&&(l=!1),this.isDayActiveElement()&&(l=!0),this.isDuplicateDay()&&(l=!1)),l},g.prototype.isDayActiveElement=function(){var l,c,_;return((c=(l=this.props.containerRef)===null||l===void 0?void 0:l.current)===null||c===void 0?void 0:c.contains(document.activeElement))&&((_=document.activeElement)===null||_===void 0?void 0:_.classList.contains("react-datepicker__day"))},g.prototype.isDuplicateDay=function(){return this.props.monthShowsDuplicateDaysEnd&&this.isAfterMonth()||this.props.monthShowsDuplicateDaysStart&&this.isBeforeMonth()},g}(Ke.Component),AR=function(m){Ao(g,m);function g(){var l=m!==null&&m.apply(this,arguments)||this;return l.weekNumberEl=Ke.createRef(),l.handleClick=function(c){l.props.onClick&&l.props.onClick(c)},l.handleOnKeyDown=function(c){var _,A,N=c.key;N===Ui.Space&&(c.preventDefault(),c.key=Ui.Enter),(A=(_=l.props).handleOnKeyDown)===null||A===void 0||A.call(_,c)},l.isKeyboardSelected=function(){return!l.props.disabledKeyboardNavigation&&!fn(l.props.date,l.props.selected)&&fn(l.props.date,l.props.preSelection)},l.getTabIndex=function(){return l.props.showWeekPicker&&l.props.showWeekNumber&&(l.isKeyboardSelected()||fn(l.props.date,l.props.selected)&&fn(l.props.preSelection,l.props.selected))?0:-1},l.handleFocusWeekNumber=function(c){var _=!1;l.getTabIndex()===0&&!(c!=null&&c.isInputFocused)&&fn(l.props.date,l.props.preSelection)&&((!document.activeElement||document.activeElement===document.body)&&(_=!0),l.props.inline&&!l.props.shouldFocusDayInline&&(_=!1),l.props.containerRef&&l.props.containerRef.current&&l.props.containerRef.current.contains(document.activeElement)&&document.activeElement&&document.activeElement.classList.contains("react-datepicker__week-number")&&(_=!0)),_&&l.weekNumberEl.current&&l.weekNumberEl.current.focus({preventScroll:!0})},l}return Object.defineProperty(g,"defaultProps",{get:function(){return{ariaLabelPrefix:"week "}},enumerable:!1,configurable:!0}),g.prototype.componentDidMount=function(){this.handleFocusWeekNumber()},g.prototype.componentDidUpdate=function(l){this.handleFocusWeekNumber(l)},g.prototype.render=function(){var l=this.props,c=l.weekNumber,_=l.isWeekDisabled,A=l.ariaLabelPrefix,N=A===void 0?g.defaultProps.ariaLabelPrefix:A,r=l.onClick,q={"react-datepicker__week-number":!0,"react-datepicker__week-number--clickable":!!r&&!_,"react-datepicker__week-number--selected":!!r&&fn(this.props.date,this.props.selected)};return Qt.createElement("div",{ref:this.weekNumberEl,className:gn(q),"aria-label":"".concat(N," ").concat(this.props.weekNumber),onClick:this.handleClick,onKeyDown:this.handleOnKeyDown,tabIndex:this.getTabIndex()},c)},g}(Ke.Component),PR=function(m){Ao(g,m);function g(){var l=m!==null&&m.apply(this,arguments)||this;return l.isDisabled=function(c){return Yl(c,{minDate:l.props.minDate,maxDate:l.props.maxDate,excludeDates:l.props.excludeDates,excludeDateIntervals:l.props.excludeDateIntervals,includeDateIntervals:l.props.includeDateIntervals,includeDates:l.props.includeDates,filterDate:l.props.filterDate})},l.handleDayClick=function(c,_){l.props.onDayClick&&l.props.onDayClick(c,_)},l.handleDayMouseEnter=function(c){l.props.onDayMouseEnter&&l.props.onDayMouseEnter(c)},l.handleWeekClick=function(c,_,A){for(var N,r,q,ie=new Date(c),ae=0;ae<7;ae++){var he=new Date(c);he.setDate(he.getDate()+ae);var ve=!l.isDisabled(he);if(ve){ie=he;break}}typeof l.props.onWeekSelect=="function"&&l.props.onWeekSelect(ie,_,A),l.props.showWeekPicker&&l.handleDayClick(ie,A),((N=l.props.shouldCloseOnSelect)!==null&&N!==void 0?N:g.defaultProps.shouldCloseOnSelect)&&((q=(r=l.props).setOpen)===null||q===void 0||q.call(r,!1))},l.formatWeekNumber=function(c){return l.props.formatWeekNumber?l.props.formatWeekNumber(c):lR(c)},l.isWeekDisabled=function(){for(var c=l.startOfWeek(),_=zc(c,6),A=new Date(c);A<=_;){if(!l.isDisabled(A))return!1;A=zc(A,1)}return!0},l.renderDays=function(){var c=l.startOfWeek(),_=[],A=l.formatWeekNumber(c);if(l.props.showWeekNumber){var N=l.props.onWeekSelect||l.props.showWeekPicker?l.handleWeekClick.bind(l,c,A):void 0;_.push(Qt.createElement(AR,mn({key:"W"},g.defaultProps,l.props,{weekNumber:A,isWeekDisabled:l.isWeekDisabled(),date:c,onClick:N})))}return _.concat([0,1,2,3,4,5,6].map(function(r){var q=zc(c,r);return Qt.createElement(CR,mn({},g.defaultProps,l.props,{ariaLabelPrefixWhenEnabled:l.props.chooseDayAriaLabelPrefix,ariaLabelPrefixWhenDisabled:l.props.disabledDayAriaLabelPrefix,key:q.valueOf(),day:q,onClick:l.handleDayClick.bind(l,q),onMouseEnter:l.handleDayMouseEnter.bind(l,q)}))}))},l.startOfWeek=function(){return Bd(l.props.day,l.props.locale,l.props.calendarStartDay)},l.isKeyboardSelected=function(){return!l.props.disabledKeyboardNavigation&&!fn(l.startOfWeek(),l.props.selected)&&fn(l.startOfWeek(),l.props.preSelection)},l}return Object.defineProperty(g,"defaultProps",{get:function(){return{shouldCloseOnSelect:!0}},enumerable:!1,configurable:!0}),g.prototype.render=function(){var l={"react-datepicker__week":!0,"react-datepicker__week--selected":fn(this.startOfWeek(),this.props.selected),"react-datepicker__week--keyboard-selected":this.isKeyboardSelected()};return Qt.createElement("div",{className:gn(l)},this.renderDays())},g}(Ke.Component),Fg,IR=6,Mm={TWO_COLUMNS:"two_columns",THREE_COLUMNS:"three_columns",FOUR_COLUMNS:"four_columns"},ox=(Fg={},Fg[Mm.TWO_COLUMNS]={grid:[[0,1],[2,3],[4,5],[6,7],[8,9],[10,11]],verticalNavigationOffset:2},Fg[Mm.THREE_COLUMNS]={grid:[[0,1,2],[3,4,5],[6,7,8],[9,10,11]],verticalNavigationOffset:3},Fg[Mm.FOUR_COLUMNS]={grid:[[0,1,2,3],[4,5,6,7],[8,9,10,11]],verticalNavigationOffset:4},Fg),vy=1;function rT(m,g){return m?Mm.FOUR_COLUMNS:g?Mm.TWO_COLUMNS:Mm.THREE_COLUMNS}var DR=function(m){Ao(g,m);function g(){var l=m!==null&&m.apply(this,arguments)||this;return l.MONTH_REFS=Bu([],Array(12),!0).map(function(){return Ke.createRef()}),l.QUARTER_REFS=Bu([],Array(4),!0).map(function(){return Ke.createRef()}),l.isDisabled=function(c){return Yl(c,{minDate:l.props.minDate,maxDate:l.props.maxDate,excludeDates:l.props.excludeDates,excludeDateIntervals:l.props.excludeDateIntervals,includeDateIntervals:l.props.includeDateIntervals,includeDates:l.props.includeDates,filterDate:l.props.filterDate})},l.isExcluded=function(c){return ib(c,{excludeDates:l.props.excludeDates,excludeDateIntervals:l.props.excludeDateIntervals})},l.handleDayClick=function(c,_){var A,N;(N=(A=l.props).onDayClick)===null||N===void 0||N.call(A,c,_,l.props.orderInDisplay)},l.handleDayMouseEnter=function(c){var _,A;(A=(_=l.props).onDayMouseEnter)===null||A===void 0||A.call(_,c)},l.handleMouseLeave=function(){var c,_;(_=(c=l.props).onMouseLeave)===null||_===void 0||_.call(c)},l.isRangeStartMonth=function(c){var _=l.props,A=_.day,N=_.startDate,r=_.endDate;return!N||!r?!1:wa(Wl(A,c),N)},l.isRangeStartQuarter=function(c){var _=l.props,A=_.day,N=_.startDate,r=_.endDate;return!N||!r?!1:r0(wm(A,c),N)},l.isRangeEndMonth=function(c){var _=l.props,A=_.day,N=_.startDate,r=_.endDate;return!N||!r?!1:wa(Wl(A,c),r)},l.isRangeEndQuarter=function(c){var _=l.props,A=_.day,N=_.startDate,r=_.endDate;return!N||!r?!1:r0(wm(A,c),r)},l.isInSelectingRangeMonth=function(c){var _,A=l.props,N=A.day,r=A.selectsStart,q=A.selectsEnd,ie=A.selectsRange,ae=A.startDate,he=A.endDate,ve=(_=l.props.selectingDate)!==null&&_!==void 0?_:l.props.preSelection;return!(r||q||ie)||!ve?!1:r&&he?my(ve,he,c,N):q&&ae||ie&&ae&&!he?my(ae,ve,c,N):!1},l.isSelectingMonthRangeStart=function(c){var _;if(!l.isInSelectingRangeMonth(c))return!1;var A=l.props,N=A.day,r=A.startDate,q=A.selectsStart,ie=Wl(N,c),ae=(_=l.props.selectingDate)!==null&&_!==void 0?_:l.props.preSelection;return q?wa(ie,ae):wa(ie,r)},l.isSelectingMonthRangeEnd=function(c){var _;if(!l.isInSelectingRangeMonth(c))return!1;var A=l.props,N=A.day,r=A.endDate,q=A.selectsEnd,ie=A.selectsRange,ae=Wl(N,c),he=(_=l.props.selectingDate)!==null&&_!==void 0?_:l.props.preSelection;return q||ie?wa(ae,he):wa(ae,r)},l.isInSelectingRangeQuarter=function(c){var _,A=l.props,N=A.day,r=A.selectsStart,q=A.selectsEnd,ie=A.selectsRange,ae=A.startDate,he=A.endDate,ve=(_=l.props.selectingDate)!==null&&_!==void 0?_:l.props.preSelection;return!(r||q||ie)||!ve?!1:r&&he?yy(ve,he,c,N):q&&ae||ie&&ae&&!he?yy(ae,ve,c,N):!1},l.isWeekInMonth=function(c){var _=l.props.day,A=zc(c,6);return wa(c,_)||wa(A,_)},l.isCurrentMonth=function(c,_){return Zr(c)===Zr(En())&&_===Ta(En())},l.isCurrentQuarter=function(c,_){return Zr(c)===Zr(En())&&_===af(En())},l.isSelectedMonth=function(c,_,A){return Ta(A)===_&&Zr(c)===Zr(A)},l.isSelectMonthInList=function(c,_,A){return A.some(function(N){return l.isSelectedMonth(c,_,N)})},l.isSelectedQuarter=function(c,_,A){return af(c)===_&&Zr(c)===Zr(A)},l.renderWeeks=function(){for(var c=[],_=l.props.fixedHeight,A=0,N=!1,r=Bd(Dh(l.props.day),l.props.locale,l.props.calendarStartDay),q=function(we){return l.props.showWeekPicker?Bd(we,l.props.locale,l.props.calendarStartDay):l.props.preSelection},ie=function(we){return l.props.showWeekPicker?Bd(we,l.props.locale,l.props.calendarStartDay):l.props.selected},ae=l.props.selected?ie(l.props.selected):void 0,he=l.props.preSelection?q(l.props.preSelection):void 0;c.push(Qt.createElement(PR,mn({},l.props,{ariaLabelPrefix:l.props.weekAriaLabelPrefix,key:A,day:r,month:Ta(l.props.day),onDayClick:l.handleDayClick,onDayMouseEnter:l.handleDayMouseEnter,selected:ae,preSelection:he,showWeekNumber:l.props.showWeekNumbers}))),!N;){A++,r=Xy(r,1);var ve=_&&A>=IR,Ae=!_&&!l.isWeekInMonth(r);if(ve||Ae)if(l.props.peekNextMonth)N=!0;else break}return c},l.onMonthClick=function(c,_){var A=l.isMonthDisabledForLabelDate(_),N=A.isDisabled,r=A.labelDate;N||l.handleDayClick(Dh(r),c)},l.onMonthMouseEnter=function(c){var _=l.isMonthDisabledForLabelDate(c),A=_.isDisabled,N=_.labelDate;A||l.handleDayMouseEnter(Dh(N))},l.handleMonthNavigation=function(c,_){var A,N,r,q;(N=(A=l.props).setPreSelection)===null||N===void 0||N.call(A,_),(q=(r=l.MONTH_REFS[c])===null||r===void 0?void 0:r.current)===null||q===void 0||q.focus()},l.handleKeyboardNavigation=function(c,_,A){var N,r=l.props,q=r.selected,ie=r.preSelection,ae=r.setPreSelection,he=r.minDate,ve=r.maxDate,Ae=r.showFourColumnMonthYearPicker,we=r.showTwoColumnMonthYearPicker;if(ie){var Pe=rT(Ae,we),Ve=l.getVerticalOffset(Pe),We=(N=ox[Pe])===null||N===void 0?void 0:N.grid,rt=function(Ne,Tt,qt){var Te,gt,oi=Tt,Ti=qt;switch(Ne){case Ui.ArrowRight:oi=Fc(Tt,vy),Ti=qt===11?0:qt+vy;break;case Ui.ArrowLeft:oi=lf(Tt,vy),Ti=qt===0?11:qt-vy;break;case Ui.ArrowUp:oi=lf(Tt,Ve),Ti=!((Te=We==null?void 0:We[0])===null||Te===void 0)&&Te.includes(qt)?qt+12-Ve:qt-Ve;break;case Ui.ArrowDown:oi=Fc(Tt,Ve),Ti=!((gt=We==null?void 0:We[We.length-1])===null||gt===void 0)&&gt.includes(qt)?qt-12+Ve:qt+Ve;break}return{newCalculatedDate:oi,newCalculatedMonth:Ti}},ht=function(Ne,Tt,qt){for(var Te=40,gt=Ne,oi=!1,Ti=0,ni=rt(gt,Tt,qt),Mt=ni.newCalculatedDate,zt=ni.newCalculatedMonth;!oi;){if(Ti>=Te){Mt=Tt,zt=qt;break}if(he&&Mt<he){gt=Ui.ArrowRight;var ii=rt(gt,Mt,zt);Mt=ii.newCalculatedDate,zt=ii.newCalculatedMonth}if(ve&&Mt>ve){gt=Ui.ArrowLeft;var ii=rt(gt,Mt,zt);Mt=ii.newCalculatedDate,zt=ii.newCalculatedMonth}if(gR(Mt,l.props)){var ii=rt(gt,Mt,zt);Mt=ii.newCalculatedDate,zt=ii.newCalculatedMonth}else oi=!0;Ti++}return{newCalculatedDate:Mt,newCalculatedMonth:zt}};if(_===Ui.Enter){l.isMonthDisabled(A)||(l.onMonthClick(c,A),ae==null||ae(q));return}var tt=ht(_,ie,A),at=tt.newCalculatedDate,Rt=tt.newCalculatedMonth;switch(_){case Ui.ArrowRight:case Ui.ArrowLeft:case Ui.ArrowUp:case Ui.ArrowDown:l.handleMonthNavigation(Rt,at);break}}},l.getVerticalOffset=function(c){var _,A;return(A=(_=ox[c])===null||_===void 0?void 0:_.verticalNavigationOffset)!==null&&A!==void 0?A:0},l.onMonthKeyDown=function(c,_){var A=l.props,N=A.disabledKeyboardNavigation,r=A.handleOnMonthKeyDown,q=c.key;q!==Ui.Tab&&c.preventDefault(),N||l.handleKeyboardNavigation(c,q,_),r&&r(c)},l.onQuarterClick=function(c,_){var A=wm(l.props.day,_);gy(A,l.props)||l.handleDayClick(jS(A),c)},l.onQuarterMouseEnter=function(c){var _=wm(l.props.day,c);gy(_,l.props)||l.handleDayMouseEnter(jS(_))},l.handleQuarterNavigation=function(c,_){var A,N,r,q;l.isDisabled(_)||l.isExcluded(_)||((N=(A=l.props).setPreSelection)===null||N===void 0||N.call(A,_),(q=(r=l.QUARTER_REFS[c-1])===null||r===void 0?void 0:r.current)===null||q===void 0||q.focus())},l.onQuarterKeyDown=function(c,_){var A,N,r=c.key;if(!l.props.disabledKeyboardNavigation)switch(r){case Ui.Enter:l.onQuarterClick(c,_),(N=(A=l.props).setPreSelection)===null||N===void 0||N.call(A,l.props.selected);break;case Ui.ArrowRight:if(!l.props.preSelection)break;l.handleQuarterNavigation(_===4?1:_+1,Xx(l.props.preSelection,1));break;case Ui.ArrowLeft:if(!l.props.preSelection)break;l.handleQuarterNavigation(_===1?4:_-1,iM(l.props.preSelection));break}},l.isMonthDisabledForLabelDate=function(c){var _,A=l.props,N=A.day,r=A.minDate,q=A.maxDate,ie=A.excludeDates,ae=A.includeDates,he=Wl(N,c);return{isDisabled:(_=(r||q||ie||ae)&&lM(he,l.props))!==null&&_!==void 0?_:!1,labelDate:he}},l.isMonthDisabled=function(c){var _=l.isMonthDisabledForLabelDate(c).isDisabled;return _},l.getMonthClassNames=function(c){var _=l.props,A=_.day,N=_.startDate,r=_.endDate,q=_.preSelection,ie=_.monthClassName,ae=ie?ie(Wl(A,c)):void 0,he=l.getSelection();return gn("react-datepicker__month-text","react-datepicker__month-".concat(c),ae,{"react-datepicker__month-text--disabled":l.isMonthDisabled(c),"react-datepicker__month-text--selected":he?l.isSelectMonthInList(A,c,he):void 0,"react-datepicker__month-text--keyboard-selected":!l.props.disabledKeyboardNavigation&&q&&l.isSelectedMonth(A,c,q)&&!l.isMonthDisabled(c),"react-datepicker__month-text--in-selecting-range":l.isInSelectingRangeMonth(c),"react-datepicker__month-text--in-range":N&&r?my(N,r,c,A):void 0,"react-datepicker__month-text--range-start":l.isRangeStartMonth(c),"react-datepicker__month-text--range-end":l.isRangeEndMonth(c),"react-datepicker__month-text--selecting-range-start":l.isSelectingMonthRangeStart(c),"react-datepicker__month-text--selecting-range-end":l.isSelectingMonthRangeEnd(c),"react-datepicker__month-text--today":l.isCurrentMonth(A,c)})},l.getTabIndex=function(c){if(l.props.preSelection==null)return"-1";var _=Ta(l.props.preSelection),A=l.isMonthDisabledForLabelDate(_).isDisabled,N=c===_&&!(A||l.props.disabledKeyboardNavigation)?"0":"-1";return N},l.getQuarterTabIndex=function(c){if(l.props.preSelection==null)return"-1";var _=af(l.props.preSelection),A=gy(l.props.day,l.props),N=c===_&&!(A||l.props.disabledKeyboardNavigation)?"0":"-1";return N},l.getAriaLabel=function(c){var _=l.props,A=_.chooseDayAriaLabelPrefix,N=A===void 0?"Choose":A,r=_.disabledDayAriaLabelPrefix,q=r===void 0?"Not available":r,ie=_.day,ae=_.locale,he=Wl(ie,c),ve=l.isDisabled(he)||l.isExcluded(he)?q:N;return"".concat(ve," ").concat(vs(he,"MMMM yyyy",ae))},l.getQuarterClassNames=function(c){var _=l.props,A=_.day,N=_.startDate,r=_.endDate,q=_.selected,ie=_.minDate,ae=_.maxDate,he=_.excludeDates,ve=_.includeDates,Ae=_.filterDate,we=_.preSelection,Pe=_.disabledKeyboardNavigation,Ve=(ie||ae||he||ve||Ae)&&gy(wm(A,c),l.props);return gn("react-datepicker__quarter-text","react-datepicker__quarter-".concat(c),{"react-datepicker__quarter-text--disabled":Ve,"react-datepicker__quarter-text--selected":q?l.isSelectedQuarter(A,c,q):void 0,"react-datepicker__quarter-text--keyboard-selected":!Pe&&we&&l.isSelectedQuarter(A,c,we)&&!Ve,"react-datepicker__quarter-text--in-selecting-range":l.isInSelectingRangeQuarter(c),"react-datepicker__quarter-text--in-range":N&&r?yy(N,r,c,A):void 0,"react-datepicker__quarter-text--range-start":l.isRangeStartQuarter(c),"react-datepicker__quarter-text--range-end":l.isRangeEndQuarter(c),"react-datepicker__quarter-text--today":l.isCurrentQuarter(A,c)})},l.getMonthContent=function(c){var _=l.props,A=_.showFullMonthYearPicker,N=_.renderMonthContent,r=_.locale,q=_.day,ie=aM(c,r),ae=tb(c,r);return N?N(c,ie,ae,q):A?ae:ie},l.getQuarterContent=function(c){var _,A=l.props,N=A.renderQuarterContent,r=A.locale,q=mR(c,r);return(_=N==null?void 0:N(c,q))!==null&&_!==void 0?_:q},l.renderMonths=function(){var c,_=l.props,A=_.showTwoColumnMonthYearPicker,N=_.showFourColumnMonthYearPicker,r=_.day,q=_.selected,ie=(c=ox[rT(N,A)])===null||c===void 0?void 0:c.grid;return ie==null?void 0:ie.map(function(ae,he){return Qt.createElement("div",{className:"react-datepicker__month-wrapper",key:he},ae.map(function(ve,Ae){return Qt.createElement("div",{ref:l.MONTH_REFS[ve],key:Ae,onClick:function(we){l.onMonthClick(we,ve)},onKeyDown:function(we){hM(we)&&(we.preventDefault(),we.key=Ui.Enter),l.onMonthKeyDown(we,ve)},onMouseEnter:l.props.usePointerEvent?void 0:function(){return l.onMonthMouseEnter(ve)},onPointerEnter:l.props.usePointerEvent?function(){return l.onMonthMouseEnter(ve)}:void 0,tabIndex:Number(l.getTabIndex(ve)),className:l.getMonthClassNames(ve),"aria-disabled":l.isMonthDisabled(ve),role:"option","aria-label":l.getAriaLabel(ve),"aria-current":l.isCurrentMonth(r,ve)?"date":void 0,"aria-selected":q?l.isSelectedMonth(r,ve,q):void 0},l.getMonthContent(ve))}))})},l.renderQuarters=function(){var c=l.props,_=c.day,A=c.selected,N=[1,2,3,4];return Qt.createElement("div",{className:"react-datepicker__quarter-wrapper"},N.map(function(r,q){return Qt.createElement("div",{key:q,ref:l.QUARTER_REFS[q],role:"option",onClick:function(ie){l.onQuarterClick(ie,r)},onKeyDown:function(ie){l.onQuarterKeyDown(ie,r)},onMouseEnter:l.props.usePointerEvent?void 0:function(){return l.onQuarterMouseEnter(r)},onPointerEnter:l.props.usePointerEvent?function(){return l.onQuarterMouseEnter(r)}:void 0,className:l.getQuarterClassNames(r),"aria-selected":A?l.isSelectedQuarter(_,r,A):void 0,tabIndex:Number(l.getQuarterTabIndex(r)),"aria-current":l.isCurrentQuarter(_,r)?"date":void 0},l.getQuarterContent(r))}))},l.getClassNames=function(){var c=l.props,_=c.selectingDate,A=c.selectsStart,N=c.selectsEnd,r=c.showMonthYearPicker,q=c.showQuarterYearPicker,ie=c.showWeekPicker;return gn("react-datepicker__month",{"react-datepicker__month--selecting-range":_&&(A||N)},{"react-datepicker__monthPicker":r},{"react-datepicker__quarterPicker":q},{"react-datepicker__weekPicker":ie})},l}return g.prototype.getSelection=function(){var l=this.props,c=l.selected,_=l.selectedDates,A=l.selectsMultiple;if(A)return _;if(c)return[c]},g.prototype.render=function(){var l=this.props,c=l.showMonthYearPicker,_=l.showQuarterYearPicker,A=l.day,N=l.ariaLabelPrefix,r=N===void 0?"Month ":N,q=r?r.trim()+" ":"";return Qt.createElement("div",{className:this.getClassNames(),onMouseLeave:this.props.usePointerEvent?void 0:this.handleMouseLeave,onPointerLeave:this.props.usePointerEvent?this.handleMouseLeave:void 0,"aria-label":"".concat(q).concat(vs(A,"MMMM, yyyy",this.props.locale)),role:"listbox"},c?this.renderMonths():_?this.renderQuarters():this.renderWeeks())},g}(Ke.Component),kR=function(m){Ao(g,m);function g(){var l=m!==null&&m.apply(this,arguments)||this;return l.isSelectedMonth=function(c){return l.props.month===c},l.renderOptions=function(){return l.props.monthNames.map(function(c,_){return Qt.createElement("div",{className:l.isSelectedMonth(_)?"react-datepicker__month-option react-datepicker__month-option--selected_month":"react-datepicker__month-option",key:c,onClick:l.onChange.bind(l,_),"aria-selected":l.isSelectedMonth(_)?"true":void 0},l.isSelectedMonth(_)?Qt.createElement("span",{className:"react-datepicker__month-option--selected"},"✓"):"",c)})},l.onChange=function(c){return l.props.onChange(c)},l.handleClickOutside=function(){return l.props.onCancel()},l}return g.prototype.render=function(){return Qt.createElement(x0,{className:"react-datepicker__month-dropdown",onClickOutside:this.handleClickOutside},this.renderOptions())},g}(Ke.Component),OR=function(m){Ao(g,m);function g(){var l=m!==null&&m.apply(this,arguments)||this;return l.state={dropdownVisible:!1},l.renderSelectOptions=function(c){return c.map(function(_,A){return Qt.createElement("option",{key:_,value:A},_)})},l.renderSelectMode=function(c){return Qt.createElement("select",{value:l.props.month,className:"react-datepicker__month-select",onChange:function(_){return l.onChange(parseInt(_.target.value))}},l.renderSelectOptions(c))},l.renderReadView=function(c,_){return Qt.createElement("div",{key:"read",style:{visibility:c?"visible":"hidden"},className:"react-datepicker__month-read-view",onClick:l.toggleDropdown},Qt.createElement("span",{className:"react-datepicker__month-read-view--down-arrow"}),Qt.createElement("span",{className:"react-datepicker__month-read-view--selected-month"},_[l.props.month]))},l.renderDropdown=function(c){return Qt.createElement(kR,mn({key:"dropdown"},l.props,{monthNames:c,onChange:l.onChange,onCancel:l.toggleDropdown}))},l.renderScrollMode=function(c){var _=l.state.dropdownVisible,A=[l.renderReadView(!_,c)];return _&&A.unshift(l.renderDropdown(c)),A},l.onChange=function(c){l.toggleDropdown(),c!==l.props.month&&l.props.onChange(c)},l.toggleDropdown=function(){return l.setState({dropdownVisible:!l.state.dropdownVisible})},l}return g.prototype.render=function(){var l=this,c=[0,1,2,3,4,5,6,7,8,9,10,11].map(this.props.useShortMonthInDropdown?function(A){return aM(A,l.props.locale)}:function(A){return tb(A,l.props.locale)}),_;switch(this.props.dropdownMode){case"scroll":_=this.renderScrollMode(c);break;case"select":_=this.renderSelectMode(c);break}return Qt.createElement("div",{className:"react-datepicker__month-dropdown-container react-datepicker__month-dropdown-container--".concat(this.props.dropdownMode)},_)},g}(Ke.Component);function LR(m,g){for(var l=[],c=Dh(m),_=Dh(g);!Vd(c,_);)l.push(En(c)),c=Fc(c,1);return l}var RR=function(m){Ao(g,m);function g(l){var c=m.call(this,l)||this;return c.renderOptions=function(){return c.state.monthYearsList.map(function(_){var A=Mx(_),N=Lu(c.props.date,_)&&wa(c.props.date,_);return Qt.createElement("div",{className:N?"react-datepicker__month-year-option--selected_month-year":"react-datepicker__month-year-option",key:A,onClick:c.onChange.bind(c,A),"aria-selected":N?"true":void 0},N?Qt.createElement("span",{className:"react-datepicker__month-year-option--selected"},"✓"):"",vs(_,c.props.dateFormat,c.props.locale))})},c.onChange=function(_){return c.props.onChange(_)},c.handleClickOutside=function(){c.props.onCancel()},c.state={monthYearsList:LR(c.props.minDate,c.props.maxDate)},c}return g.prototype.render=function(){var l=gn({"react-datepicker__month-year-dropdown":!0,"react-datepicker__month-year-dropdown--scrollable":this.props.scrollableMonthYearDropdown});return Qt.createElement(x0,{className:l,onClickOutside:this.handleClickOutside},this.renderOptions())},g}(Ke.Component),zR=function(m){Ao(g,m);function g(){var l=m!==null&&m.apply(this,arguments)||this;return l.state={dropdownVisible:!1},l.renderSelectOptions=function(){for(var c=Dh(l.props.minDate),_=Dh(l.props.maxDate),A=[];!Vd(c,_);){var N=Mx(c);A.push(Qt.createElement("option",{key:N,value:N},vs(c,l.props.dateFormat,l.props.locale))),c=Fc(c,1)}return A},l.onSelectChange=function(c){l.onChange(parseInt(c.target.value))},l.renderSelectMode=function(){return Qt.createElement("select",{value:Mx(Dh(l.props.date)),className:"react-datepicker__month-year-select",onChange:l.onSelectChange},l.renderSelectOptions())},l.renderReadView=function(c){var _=vs(l.props.date,l.props.dateFormat,l.props.locale);return Qt.createElement("div",{key:"read",style:{visibility:c?"visible":"hidden"},className:"react-datepicker__month-year-read-view",onClick:l.toggleDropdown},Qt.createElement("span",{className:"react-datepicker__month-year-read-view--down-arrow"}),Qt.createElement("span",{className:"react-datepicker__month-year-read-view--selected-month-year"},_))},l.renderDropdown=function(){return Qt.createElement(RR,mn({key:"dropdown"},l.props,{onChange:l.onChange,onCancel:l.toggleDropdown}))},l.renderScrollMode=function(){var c=l.state.dropdownVisible,_=[l.renderReadView(!c)];return c&&_.unshift(l.renderDropdown()),_},l.onChange=function(c){l.toggleDropdown();var _=En(c);Lu(l.props.date,_)&&wa(l.props.date,_)||l.props.onChange(_)},l.toggleDropdown=function(){return l.setState({dropdownVisible:!l.state.dropdownVisible})},l}return g.prototype.render=function(){var l;switch(this.props.dropdownMode){case"scroll":l=this.renderScrollMode();break;case"select":l=this.renderSelectMode();break}return Qt.createElement("div",{className:"react-datepicker__month-year-dropdown-container react-datepicker__month-year-dropdown-container--".concat(this.props.dropdownMode)},l)},g}(Ke.Component),FR=function(m){Ao(g,m);function g(){var l=m!==null&&m.apply(this,arguments)||this;return l.state={height:null},l.scrollToTheSelectedTime=function(){requestAnimationFrame(function(){var c,_,A;l.list&&(l.list.scrollTop=(A=l.centerLi&&g.calcCenterPosition(l.props.monthRef?l.props.monthRef.clientHeight-((_=(c=l.header)===null||c===void 0?void 0:c.clientHeight)!==null&&_!==void 0?_:0):l.list.clientHeight,l.centerLi))!==null&&A!==void 0?A:0)})},l.handleClick=function(c){var _,A;(l.props.minTime||l.props.maxTime)&&qS(c,l.props)||(l.props.excludeTimes||l.props.includeTimes||l.props.filterTime)&&WS(c,l.props)||(A=(_=l.props).onChange)===null||A===void 0||A.call(_,c)},l.isSelectedTime=function(c){return l.props.selected&&MR(l.props.selected,c)},l.isDisabledTime=function(c){return(l.props.minTime||l.props.maxTime)&&qS(c,l.props)||(l.props.excludeTimes||l.props.includeTimes||l.props.filterTime)&&WS(c,l.props)},l.liClasses=function(c){var _,A=["react-datepicker__time-list-item",l.props.timeClassName?l.props.timeClassName(c):void 0];return l.isSelectedTime(c)&&A.push("react-datepicker__time-list-item--selected"),l.isDisabledTime(c)&&A.push("react-datepicker__time-list-item--disabled"),l.props.injectTimes&&(Ph(c)*3600+Ih(c)*60+Fd(c))%(((_=l.props.intervals)!==null&&_!==void 0?_:g.defaultProps.intervals)*60)!==0&&A.push("react-datepicker__time-list-item--injected"),A.join(" ")},l.handleOnKeyDown=function(c,_){var A,N;c.key===Ui.Space&&(c.preventDefault(),c.key=Ui.Enter),(c.key===Ui.ArrowUp||c.key===Ui.ArrowLeft)&&c.target instanceof HTMLElement&&c.target.previousSibling&&(c.preventDefault(),c.target.previousSibling instanceof HTMLElement&&c.target.previousSibling.focus()),(c.key===Ui.ArrowDown||c.key===Ui.ArrowRight)&&c.target instanceof HTMLElement&&c.target.nextSibling&&(c.preventDefault(),c.target.nextSibling instanceof HTMLElement&&c.target.nextSibling.focus()),c.key===Ui.Enter&&l.handleClick(_),(N=(A=l.props).handleOnKeyDown)===null||N===void 0||N.call(A,c)},l.renderTimes=function(){for(var c,_=[],A=typeof l.props.format=="string"?l.props.format:"p",N=(c=l.props.intervals)!==null&&c!==void 0?c:g.defaultProps.intervals,r=l.props.selected||l.props.openToDate||En(),q=Dy(r),ie=l.props.injectTimes&&l.props.injectTimes.sort(function(Ve,We){return Ve.getTime()-We.getTime()}),ae=60*TR(r),he=ae/N,ve=0;ve<he;ve++){var Ae=wx(q,ve*N);if(_.push(Ae),ie){var we=SR(q,Ae,ve,N,ie);_=_.concat(we)}}var Pe=_.reduce(function(Ve,We){return We.getTime()<=r.getTime()?We:Ve},_[0]);return _.map(function(Ve){return Qt.createElement("li",{key:Ve.valueOf(),onClick:l.handleClick.bind(l,Ve),className:l.liClasses(Ve),ref:function(We){Ve===Pe&&(l.centerLi=We)},onKeyDown:function(We){l.handleOnKeyDown(We,Ve)},tabIndex:Ve===Pe?0:-1,role:"option","aria-selected":l.isSelectedTime(Ve)?"true":void 0,"aria-disabled":l.isDisabledTime(Ve)?"true":void 0},vs(Ve,A,l.props.locale))})},l.renderTimeCaption=function(){return l.props.showTimeCaption===!1?Qt.createElement(Qt.Fragment,null):Qt.createElement("div",{className:"react-datepicker__header react-datepicker__header--time ".concat(l.props.showTimeSelectOnly?"react-datepicker__header--time--only":""),ref:function(c){l.header=c}},Qt.createElement("div",{className:"react-datepicker-time__header"},l.props.timeCaption))},l}return Object.defineProperty(g,"defaultProps",{get:function(){return{intervals:30,todayButton:null,timeCaption:"Time",showTimeCaption:!0}},enumerable:!1,configurable:!0}),g.prototype.componentDidMount=function(){this.scrollToTheSelectedTime(),this.props.monthRef&&this.header&&this.setState({height:this.props.monthRef.clientHeight-this.header.clientHeight})},g.prototype.render=function(){var l=this,c,_=this.state.height;return Qt.createElement("div",{className:"react-datepicker__time-container ".concat(((c=this.props.todayButton)!==null&&c!==void 0?c:g.defaultProps.todayButton)?"react-datepicker__time-container--with-today-button":"")},this.renderTimeCaption(),Qt.createElement("div",{className:"react-datepicker__time"},Qt.createElement("div",{className:"react-datepicker__time-box"},Qt.createElement("ul",{className:"react-datepicker__time-list",ref:function(A){l.list=A},style:_?{height:_}:{},role:"listbox","aria-label":this.props.timeCaption},this.renderTimes()))))},g.calcCenterPosition=function(l,c){return c.offsetTop-(l/2-c.clientHeight/2)},g}(Ke.Component),nT=3,BR=function(m){Ao(g,m);function g(l){var c=m.call(this,l)||this;return c.YEAR_REFS=Bu([],Array(c.props.yearItemNumber),!0).map(function(){return Ke.createRef()}),c.isDisabled=function(_){return Yl(_,{minDate:c.props.minDate,maxDate:c.props.maxDate,excludeDates:c.props.excludeDates,includeDates:c.props.includeDates,filterDate:c.props.filterDate})},c.isExcluded=function(_){return ib(_,{excludeDates:c.props.excludeDates})},c.selectingDate=function(){var _;return(_=c.props.selectingDate)!==null&&_!==void 0?_:c.props.preSelection},c.updateFocusOnPaginate=function(_){var A=function(){var N,r;(r=(N=c.YEAR_REFS[_])===null||N===void 0?void 0:N.current)===null||r===void 0||r.focus()};window.requestAnimationFrame(A)},c.handleYearClick=function(_,A){c.props.onDayClick&&c.props.onDayClick(_,A)},c.handleYearNavigation=function(_,A){var N,r,q,ie,ae=c.props,he=ae.date,ve=ae.yearItemNumber;if(!(he===void 0||ve===void 0)){var Ae=zd(he,ve).startPeriod;c.isDisabled(A)||c.isExcluded(A)||((r=(N=c.props).setPreSelection)===null||r===void 0||r.call(N,A),_-Ae<0?c.updateFocusOnPaginate(ve-(Ae-_)):_-Ae>=ve?c.updateFocusOnPaginate(Math.abs(ve-(_-Ae))):(ie=(q=c.YEAR_REFS[_-Ae])===null||q===void 0?void 0:q.current)===null||ie===void 0||ie.focus())}},c.isSameDay=function(_,A){return fn(_,A)},c.isCurrentYear=function(_){return _===Zr(En())},c.isRangeStart=function(_){return c.props.startDate&&c.props.endDate&&Lu(Du(En(),_),c.props.startDate)},c.isRangeEnd=function(_){return c.props.startDate&&c.props.endDate&&Lu(Du(En(),_),c.props.endDate)},c.isInRange=function(_){return _y(_,c.props.startDate,c.props.endDate)},c.isInSelectingRange=function(_){var A=c.props,N=A.selectsStart,r=A.selectsEnd,q=A.selectsRange,ie=A.startDate,ae=A.endDate;return!(N||r||q)||!c.selectingDate()?!1:N&&ae?_y(_,c.selectingDate(),ae):r&&ie||q&&ie&&!ae?_y(_,ie,c.selectingDate()):!1},c.isSelectingRangeStart=function(_){var A;if(!c.isInSelectingRange(_))return!1;var N=c.props,r=N.startDate,q=N.selectsStart,ie=Du(En(),_);return q?Lu(ie,(A=c.selectingDate())!==null&&A!==void 0?A:null):Lu(ie,r??null)},c.isSelectingRangeEnd=function(_){var A;if(!c.isInSelectingRange(_))return!1;var N=c.props,r=N.endDate,q=N.selectsEnd,ie=N.selectsRange,ae=Du(En(),_);return q||ie?Lu(ae,(A=c.selectingDate())!==null&&A!==void 0?A:null):Lu(ae,r??null)},c.isKeyboardSelected=function(_){if(!(c.props.date===void 0||c.props.selected==null||c.props.preSelection==null)){var A=c.props,N=A.minDate,r=A.maxDate,q=A.excludeDates,ie=A.includeDates,ae=A.filterDate,he=Ug(Du(c.props.date,_)),ve=(N||r||q||ie||ae)&&ky(_,c.props);return!c.props.disabledKeyboardNavigation&&!c.props.inline&&!fn(he,Ug(c.props.selected))&&fn(he,Ug(c.props.preSelection))&&!ve}},c.onYearClick=function(_,A){var N=c.props.date;N!==void 0&&c.handleYearClick(Ug(Du(N,A)),_)},c.onYearKeyDown=function(_,A){var N,r,q=_.key,ie=c.props,ae=ie.date,he=ie.yearItemNumber,ve=ie.handleOnKeyDown;if(q!==Ui.Tab&&_.preventDefault(),!c.props.disabledKeyboardNavigation)switch(q){case Ui.Enter:if(c.props.selected==null)break;c.onYearClick(_,A),(r=(N=c.props).setPreSelection)===null||r===void 0||r.call(N,c.props.selected);break;case Ui.ArrowRight:if(c.props.preSelection==null)break;c.handleYearNavigation(A+1,Ch(c.props.preSelection,1));break;case Ui.ArrowLeft:if(c.props.preSelection==null)break;c.handleYearNavigation(A-1,Om(c.props.preSelection,1));break;case Ui.ArrowUp:{if(ae===void 0||he===void 0||c.props.preSelection==null)break;var Ae=zd(ae,he).startPeriod,we=nT,Pe=A-we;if(Pe<Ae){var Ve=he%we;A>=Ae&&A<Ae+Ve?we=Ve:we+=Ve,Pe=A-we}c.handleYearNavigation(Pe,Om(c.props.preSelection,we));break}case Ui.ArrowDown:{if(ae===void 0||he===void 0||c.props.preSelection==null)break;var We=zd(ae,he).endPeriod,we=nT,Pe=A+we;if(Pe>We){var Ve=he%we;A<=We&&A>We-Ve?we=Ve:we+=Ve,Pe=A+we}c.handleYearNavigation(Pe,Ch(c.props.preSelection,we));break}}ve&&ve(_)},c.getYearClassNames=function(_){var A=c.props,N=A.date,r=A.minDate,q=A.maxDate,ie=A.selected,ae=A.excludeDates,he=A.includeDates,ve=A.filterDate,Ae=A.yearClassName;return gn("react-datepicker__year-text","react-datepicker__year-".concat(_),N?Ae==null?void 0:Ae(Du(N,_)):void 0,{"react-datepicker__year-text--selected":ie?_===Zr(ie):void 0,"react-datepicker__year-text--disabled":(r||q||ae||he||ve)&&ky(_,c.props),"react-datepicker__year-text--keyboard-selected":c.isKeyboardSelected(_),"react-datepicker__year-text--range-start":c.isRangeStart(_),"react-datepicker__year-text--range-end":c.isRangeEnd(_),"react-datepicker__year-text--in-range":c.isInRange(_),"react-datepicker__year-text--in-selecting-range":c.isInSelectingRange(_),"react-datepicker__year-text--selecting-range-start":c.isSelectingRangeStart(_),"react-datepicker__year-text--selecting-range-end":c.isSelectingRangeEnd(_),"react-datepicker__year-text--today":c.isCurrentYear(_)})},c.getYearTabIndex=function(_){if(c.props.disabledKeyboardNavigation||c.props.preSelection==null)return"-1";var A=Zr(c.props.preSelection),N=ky(_,c.props);return _===A&&!N?"0":"-1"},c.getYearContent=function(_){return c.props.renderYearContent?c.props.renderYearContent(_):_},c}return g.prototype.render=function(){var l=this,c=[],_=this.props,A=_.date,N=_.yearItemNumber,r=_.onYearMouseEnter,q=_.onYearMouseLeave;if(A===void 0)return null;for(var ie=zd(A,N),ae=ie.startPeriod,he=ie.endPeriod,ve=function(Pe){c.push(Qt.createElement("div",{ref:Ae.YEAR_REFS[Pe-ae],onClick:function(Ve){l.onYearClick(Ve,Pe)},onKeyDown:function(Ve){hM(Ve)&&(Ve.preventDefault(),Ve.key=Ui.Enter),l.onYearKeyDown(Ve,Pe)},tabIndex:Number(Ae.getYearTabIndex(Pe)),className:Ae.getYearClassNames(Pe),onMouseEnter:Ae.props.usePointerEvent?void 0:function(Ve){return r(Ve,Pe)},onPointerEnter:Ae.props.usePointerEvent?function(Ve){return r(Ve,Pe)}:void 0,onMouseLeave:Ae.props.usePointerEvent?void 0:function(Ve){return q(Ve,Pe)},onPointerLeave:Ae.props.usePointerEvent?function(Ve){return q(Ve,Pe)}:void 0,key:Pe,"aria-current":Ae.isCurrentYear(Pe)?"date":void 0},Ae.getYearContent(Pe)))},Ae=this,we=ae;we<=he;we++)ve(we);return Qt.createElement("div",{className:"react-datepicker__year"},Qt.createElement("div",{className:"react-datepicker__year-wrapper",onMouseLeave:this.props.usePointerEvent?void 0:this.props.clearSelectingDate,onPointerLeave:this.props.usePointerEvent?this.props.clearSelectingDate:void 0},c))},g}(Ke.Component);function NR(m,g,l,c){for(var _=[],A=0;A<2*g+1;A++){var N=m+g-A,r=!0;l&&(r=Zr(l)<=N),c&&r&&(r=Zr(c)>=N),r&&_.push(N)}return _}var VR=function(m){Ao(g,m);function g(l){var c=m.call(this,l)||this;c.renderOptions=function(){var r=c.props.year,q=c.state.yearsList.map(function(he){return Qt.createElement("div",{className:r===he?"react-datepicker__year-option react-datepicker__year-option--selected_year":"react-datepicker__year-option",key:he,onClick:c.onChange.bind(c,he),"aria-selected":r===he?"true":void 0},r===he?Qt.createElement("span",{className:"react-datepicker__year-option--selected"},"✓"):"",he)}),ie=c.props.minDate?Zr(c.props.minDate):null,ae=c.props.maxDate?Zr(c.props.maxDate):null;return(!ae||!c.state.yearsList.find(function(he){return he===ae}))&&q.unshift(Qt.createElement("div",{className:"react-datepicker__year-option",key:"upcoming",onClick:c.incrementYears},Qt.createElement("a",{className:"react-datepicker__navigation react-datepicker__navigation--years react-datepicker__navigation--years-upcoming"}))),(!ie||!c.state.yearsList.find(function(he){return he===ie}))&&q.push(Qt.createElement("div",{className:"react-datepicker__year-option",key:"previous",onClick:c.decrementYears},Qt.createElement("a",{className:"react-datepicker__navigation react-datepicker__navigation--years react-datepicker__navigation--years-previous"}))),q},c.onChange=function(r){c.props.onChange(r)},c.handleClickOutside=function(){c.props.onCancel()},c.shiftYears=function(r){var q=c.state.yearsList.map(function(ie){return ie+r});c.setState({yearsList:q})},c.incrementYears=function(){return c.shiftYears(1)},c.decrementYears=function(){return c.shiftYears(-1)};var _=l.yearDropdownItemNumber,A=l.scrollableYearDropdown,N=_||(A?10:5);return c.state={yearsList:NR(c.props.year,N,c.props.minDate,c.props.maxDate)},c.dropdownRef=Ke.createRef(),c}return g.prototype.componentDidMount=function(){var l=this.dropdownRef.current;if(l){var c=l.children?Array.from(l.children):null,_=c?c.find(function(A){return A.ariaSelected}):null;l.scrollTop=_&&_ instanceof HTMLElement?_.offsetTop+(_.clientHeight-l.clientHeight)/2:(l.scrollHeight-l.clientHeight)/2}},g.prototype.render=function(){var l=gn({"react-datepicker__year-dropdown":!0,"react-datepicker__year-dropdown--scrollable":this.props.scrollableYearDropdown});return Qt.createElement(x0,{className:l,containerRef:this.dropdownRef,onClickOutside:this.handleClickOutside},this.renderOptions())},g}(Ke.Component),UR=function(m){Ao(g,m);function g(){var l=m!==null&&m.apply(this,arguments)||this;return l.state={dropdownVisible:!1},l.renderSelectOptions=function(){for(var c=l.props.minDate?Zr(l.props.minDate):1900,_=l.props.maxDate?Zr(l.props.maxDate):2100,A=[],N=c;N<=_;N++)A.push(Qt.createElement("option",{key:N,value:N},N));return A},l.onSelectChange=function(c){l.onChange(parseInt(c.target.value))},l.renderSelectMode=function(){return Qt.createElement("select",{value:l.props.year,className:"react-datepicker__year-select",onChange:l.onSelectChange},l.renderSelectOptions())},l.renderReadView=function(c){return Qt.createElement("div",{key:"read",style:{visibility:c?"visible":"hidden"},className:"react-datepicker__year-read-view",onClick:function(_){return l.toggleDropdown(_)}},Qt.createElement("span",{className:"react-datepicker__year-read-view--down-arrow"}),Qt.createElement("span",{className:"react-datepicker__year-read-view--selected-year"},l.props.year))},l.renderDropdown=function(){return Qt.createElement(VR,mn({key:"dropdown"},l.props,{onChange:l.onChange,onCancel:l.toggleDropdown}))},l.renderScrollMode=function(){var c=l.state.dropdownVisible,_=[l.renderReadView(!c)];return c&&_.unshift(l.renderDropdown()),_},l.onChange=function(c){l.toggleDropdown(),c!==l.props.year&&l.props.onChange(c)},l.toggleDropdown=function(c){l.setState({dropdownVisible:!l.state.dropdownVisible},function(){l.props.adjustDateOnChange&&l.handleYearChange(l.props.date,c)})},l.handleYearChange=function(c,_){var A;(A=l.onSelect)===null||A===void 0||A.call(l,c,_),l.setOpen()},l.onSelect=function(c,_){var A,N;(N=(A=l.props).onSelect)===null||N===void 0||N.call(A,c,_)},l.setOpen=function(){var c,_;(_=(c=l.props).setOpen)===null||_===void 0||_.call(c,!0)},l}return g.prototype.render=function(){var l;switch(this.props.dropdownMode){case"scroll":l=this.renderScrollMode();break;case"select":l=this.renderSelectMode();break}return Qt.createElement("div",{className:"react-datepicker__year-dropdown-container react-datepicker__year-dropdown-container--".concat(this.props.dropdownMode)},l)},g}(Ke.Component),jR=["react-datepicker__year-select","react-datepicker__month-select","react-datepicker__month-year-select"],$R=function(m){var g=(m.className||"").split(/\s+/);return jR.some(function(l){return g.indexOf(l)>=0})},GR=function(m){Ao(g,m);function g(l){var c=m.call(this,l)||this;return c.monthContainer=void 0,c.handleClickOutside=function(_){c.props.onClickOutside(_)},c.setClickOutsideRef=function(){return c.containerRef.current},c.handleDropdownFocus=function(_){var A,N;$R(_.target)&&((N=(A=c.props).onDropdownFocus)===null||N===void 0||N.call(A,_))},c.getDateInView=function(){var _=c.props,A=_.preSelection,N=_.selected,r=_.openToDate,q=cM(c.props),ie=uM(c.props),ae=En(),he=r||N||A;return he||(q&&df(ae,q)?q:ie&&Vd(ae,ie)?ie:ae)},c.increaseMonth=function(){c.setState(function(_){var A=_.date;return{date:Fc(A,1)}},function(){return c.handleMonthChange(c.state.date)})},c.decreaseMonth=function(){c.setState(function(_){var A=_.date;return{date:lf(A,1)}},function(){return c.handleMonthChange(c.state.date)})},c.handleDayClick=function(_,A,N){c.props.onSelect(_,A,N),c.props.setPreSelection&&c.props.setPreSelection(_)},c.handleDayMouseEnter=function(_){c.setState({selectingDate:_}),c.props.onDayMouseEnter&&c.props.onDayMouseEnter(_)},c.handleMonthMouseLeave=function(){c.setState({selectingDate:void 0}),c.props.onMonthMouseLeave&&c.props.onMonthMouseLeave()},c.handleYearMouseEnter=function(_,A){c.setState({selectingDate:Du(En(),A)}),c.props.onYearMouseEnter&&c.props.onYearMouseEnter(_,A)},c.handleYearMouseLeave=function(_,A){c.props.onYearMouseLeave&&c.props.onYearMouseLeave(_,A)},c.handleYearChange=function(_){var A,N,r,q;(N=(A=c.props).onYearChange)===null||N===void 0||N.call(A,_),c.setState({isRenderAriaLiveMessage:!0}),c.props.adjustDateOnChange&&(c.props.onSelect(_),(q=(r=c.props).setOpen)===null||q===void 0||q.call(r,!0)),c.props.setPreSelection&&c.props.setPreSelection(_)},c.getEnabledPreSelectionDateForMonth=function(_){if(!Yl(_,c.props))return _;for(var A=Dh(_),N=hR(_),r=wk(N,A),q=null,ie=0;ie<=r;ie++){var ae=zc(A,ie);if(!Yl(ae,c.props)){q=ae;break}}return q},c.handleMonthChange=function(_){var A,N,r,q=(A=c.getEnabledPreSelectionDateForMonth(_))!==null&&A!==void 0?A:_;c.handleCustomMonthChange(q),c.props.adjustDateOnChange&&(c.props.onSelect(q),(r=(N=c.props).setOpen)===null||r===void 0||r.call(N,!0)),c.props.setPreSelection&&c.props.setPreSelection(q)},c.handleCustomMonthChange=function(_){var A,N;(N=(A=c.props).onMonthChange)===null||N===void 0||N.call(A,_),c.setState({isRenderAriaLiveMessage:!0})},c.handleMonthYearChange=function(_){c.handleYearChange(_),c.handleMonthChange(_)},c.changeYear=function(_){c.setState(function(A){var N=A.date;return{date:Du(N,Number(_))}},function(){return c.handleYearChange(c.state.date)})},c.changeMonth=function(_){c.setState(function(A){var N=A.date;return{date:Wl(N,Number(_))}},function(){return c.handleMonthChange(c.state.date)})},c.changeMonthYear=function(_){c.setState(function(A){var N=A.date;return{date:Du(Wl(N,Ta(_)),Zr(_))}},function(){return c.handleMonthYearChange(c.state.date)})},c.header=function(_){_===void 0&&(_=c.state.date);var A=Bd(_,c.props.locale,c.props.calendarStartDay),N=[];return c.props.showWeekNumbers&&N.push(Qt.createElement("div",{key:"W",className:"react-datepicker__day-name"},c.props.weekLabel||"#")),N.concat([0,1,2,3,4,5,6].map(function(r){var q=zc(A,r),ie=c.formatWeekday(q,c.props.locale),ae=c.props.weekDayClassName?c.props.weekDayClassName(q):void 0;return Qt.createElement("div",{key:r,"aria-label":vs(q,"EEEE",c.props.locale),className:gn("react-datepicker__day-name",ae)},ie)}))},c.formatWeekday=function(_,A){return c.props.formatWeekDay?dR(_,c.props.formatWeekDay,A):c.props.useWeekdaysShort?fR(_,A):pR(_,A)},c.decreaseYear=function(){c.setState(function(_){var A,N=_.date;return{date:Om(N,c.props.showYearPicker?(A=c.props.yearItemNumber)!==null&&A!==void 0?A:g.defaultProps.yearItemNumber:1)}},function(){return c.handleYearChange(c.state.date)})},c.clearSelectingDate=function(){c.setState({selectingDate:void 0})},c.renderPreviousButton=function(){var _,A,N;if(!c.props.renderCustomHeader){var r=(_=c.props.monthsShown)!==null&&_!==void 0?_:g.defaultProps.monthsShown,q=c.props.showPreviousMonths?r-1:0,ie=(A=c.props.monthSelectedIn)!==null&&A!==void 0?A:q,ae=lf(c.state.date,ie),he;switch(!0){case c.props.showMonthYearPicker:he=ZS(c.state.date,c.props);break;case c.props.showYearPicker:he=vR(c.state.date,c.props);break;case c.props.showQuarterYearPicker:he=_R(c.state.date,c.props);break;default:he=YS(ae,c.props);break}if(!(!((N=c.props.forceShowMonthNavigation)!==null&&N!==void 0?N:g.defaultProps.forceShowMonthNavigation)&&!c.props.showDisabledMonthNavigation&&he||c.props.showTimeSelectOnly)){var ve=["react-datepicker__navigation-icon","react-datepicker__navigation-icon--previous"],Ae=["react-datepicker__navigation","react-datepicker__navigation--previous"],we=c.decreaseMonth;(c.props.showMonthYearPicker||c.props.showQuarterYearPicker||c.props.showYearPicker)&&(we=c.decreaseYear),he&&c.props.showDisabledMonthNavigation&&(Ae.push("react-datepicker__navigation--previous--disabled"),we=void 0);var Pe=c.props.showMonthYearPicker||c.props.showQuarterYearPicker||c.props.showYearPicker,Ve=c.props,We=Ve.previousMonthButtonLabel,rt=We===void 0?g.defaultProps.previousMonthButtonLabel:We,ht=Ve.previousYearButtonLabel,tt=ht===void 0?g.defaultProps.previousYearButtonLabel:ht,at=c.props,Rt=at.previousMonthAriaLabel,Ne=Rt===void 0?typeof rt=="string"?rt:"Previous Month":Rt,Tt=at.previousYearAriaLabel,qt=Tt===void 0?typeof tt=="string"?tt:"Previous Year":Tt;return Qt.createElement("button",{type:"button",className:Ae.join(" "),onClick:we,onKeyDown:c.props.handleOnKeyDown,"aria-label":Pe?qt:Ne},Qt.createElement("span",{className:ve.join(" ")},Pe?tt:rt))}}},c.increaseYear=function(){c.setState(function(_){var A,N=_.date;return{date:Ch(N,c.props.showYearPicker?(A=c.props.yearItemNumber)!==null&&A!==void 0?A:g.defaultProps.yearItemNumber:1)}},function(){return c.handleYearChange(c.state.date)})},c.renderNextButton=function(){var _;if(!c.props.renderCustomHeader){var A;switch(!0){case c.props.showMonthYearPicker:A=KS(c.state.date,c.props);break;case c.props.showYearPicker:A=xR(c.state.date,c.props);break;case c.props.showQuarterYearPicker:A=yR(c.state.date,c.props);break;default:A=XS(c.state.date,c.props);break}if(!(!((_=c.props.forceShowMonthNavigation)!==null&&_!==void 0?_:g.defaultProps.forceShowMonthNavigation)&&!c.props.showDisabledMonthNavigation&&A||c.props.showTimeSelectOnly)){var N=["react-datepicker__navigation","react-datepicker__navigation--next"],r=["react-datepicker__navigation-icon","react-datepicker__navigation-icon--next"];c.props.showTimeSelect&&N.push("react-datepicker__navigation--next--with-time"),c.props.todayButton&&N.push("react-datepicker__navigation--next--with-today-button");var q=c.increaseMonth;(c.props.showMonthYearPicker||c.props.showQuarterYearPicker||c.props.showYearPicker)&&(q=c.increaseYear),A&&c.props.showDisabledMonthNavigation&&(N.push("react-datepicker__navigation--next--disabled"),q=void 0);var ie=c.props.showMonthYearPicker||c.props.showQuarterYearPicker||c.props.showYearPicker,ae=c.props,he=ae.nextMonthButtonLabel,ve=he===void 0?g.defaultProps.nextMonthButtonLabel:he,Ae=ae.nextYearButtonLabel,we=Ae===void 0?g.defaultProps.nextYearButtonLabel:Ae,Pe=c.props,Ve=Pe.nextMonthAriaLabel,We=Ve===void 0?typeof ve=="string"?ve:"Next Month":Ve,rt=Pe.nextYearAriaLabel,ht=rt===void 0?typeof we=="string"?we:"Next Year":rt;return Qt.createElement("button",{type:"button",className:N.join(" "),onClick:q,onKeyDown:c.props.handleOnKeyDown,"aria-label":ie?ht:We},Qt.createElement("span",{className:r.join(" ")},ie?we:ve))}}},c.renderCurrentMonth=function(_){_===void 0&&(_=c.state.date);var A=["react-datepicker__current-month"];return c.props.showYearDropdown&&A.push("react-datepicker__current-month--hasYearDropdown"),c.props.showMonthDropdown&&A.push("react-datepicker__current-month--hasMonthDropdown"),c.props.showMonthYearDropdown&&A.push("react-datepicker__current-month--hasMonthYearDropdown"),Qt.createElement("h2",{className:A.join(" ")},vs(_,c.props.dateFormat,c.props.locale))},c.renderYearDropdown=function(_){if(_===void 0&&(_=!1),!(!c.props.showYearDropdown||_))return Qt.createElement(UR,mn({},g.defaultProps,c.props,{date:c.state.date,onChange:c.changeYear,year:Zr(c.state.date)}))},c.renderMonthDropdown=function(_){if(_===void 0&&(_=!1),!(!c.props.showMonthDropdown||_))return Qt.createElement(OR,mn({},g.defaultProps,c.props,{month:Ta(c.state.date),onChange:c.changeMonth}))},c.renderMonthYearDropdown=function(_){if(_===void 0&&(_=!1),!(!c.props.showMonthYearDropdown||_))return Qt.createElement(zR,mn({},g.defaultProps,c.props,{date:c.state.date,onChange:c.changeMonthYear}))},c.handleTodayButtonClick=function(_){c.props.onSelect($S(),_),c.props.setPreSelection&&c.props.setPreSelection($S())},c.renderTodayButton=function(){if(!(!c.props.todayButton||c.props.showTimeSelectOnly))return Qt.createElement("div",{className:"react-datepicker__today-button",onClick:c.handleTodayButtonClick},c.props.todayButton)},c.renderDefaultHeader=function(_){var A=_.monthDate,N=_.i;return Qt.createElement("div",{className:"react-datepicker__header ".concat(c.props.showTimeSelect?"react-datepicker__header--has-time-select":"")},c.renderCurrentMonth(A),Qt.createElement("div",{className:"react-datepicker__header__dropdown react-datepicker__header__dropdown--".concat(c.props.dropdownMode),onFocus:c.handleDropdownFocus},c.renderMonthDropdown(N!==0),c.renderMonthYearDropdown(N!==0),c.renderYearDropdown(N!==0)),Qt.createElement("div",{className:"react-datepicker__day-names"},c.header(A)))},c.renderCustomHeader=function(_){var A,N,r=_.monthDate,q=_.i;if(c.props.showTimeSelect&&!c.state.monthContainer||c.props.showTimeSelectOnly)return null;var ie=YS(c.state.date,c.props),ae=XS(c.state.date,c.props),he=ZS(c.state.date,c.props),ve=KS(c.state.date,c.props),Ae=!c.props.showMonthYearPicker&&!c.props.showQuarterYearPicker&&!c.props.showYearPicker;return Qt.createElement("div",{className:"react-datepicker__header react-datepicker__header--custom",onFocus:c.props.onDropdownFocus},(N=(A=c.props).renderCustomHeader)===null||N===void 0?void 0:N.call(A,mn(mn({},c.state),{customHeaderCount:q,monthDate:r,changeMonth:c.changeMonth,changeYear:c.changeYear,decreaseMonth:c.decreaseMonth,increaseMonth:c.increaseMonth,decreaseYear:c.decreaseYear,increaseYear:c.increaseYear,prevMonthButtonDisabled:ie,nextMonthButtonDisabled:ae,prevYearButtonDisabled:he,nextYearButtonDisabled:ve})),Ae&&Qt.createElement("div",{className:"react-datepicker__day-names"},c.header(r)))},c.renderYearHeader=function(_){var A=_.monthDate,N=c.props,r=N.showYearPicker,q=N.yearItemNumber,ie=q===void 0?g.defaultProps.yearItemNumber:q,ae=zd(A,ie),he=ae.startPeriod,ve=ae.endPeriod;return Qt.createElement("div",{className:"react-datepicker__header react-datepicker-year-header"},r?"".concat(he," - ").concat(ve):Zr(A))},c.renderHeader=function(_){var A=_.monthDate,N=_.i,r=N===void 0?0:N,q={monthDate:A,i:r};switch(!0){case c.props.renderCustomHeader!==void 0:return c.renderCustomHeader(q);case(c.props.showMonthYearPicker||c.props.showQuarterYearPicker||c.props.showYearPicker):return c.renderYearHeader(q);default:return c.renderDefaultHeader(q)}},c.renderMonths=function(){var _,A;if(!(c.props.showTimeSelectOnly||c.props.showYearPicker)){for(var N=[],r=(_=c.props.monthsShown)!==null&&_!==void 0?_:g.defaultProps.monthsShown,q=c.props.showPreviousMonths?r-1:0,ie=c.props.showMonthYearPicker||c.props.showQuarterYearPicker?Ch(c.state.date,q):lf(c.state.date,q),ae=(A=c.props.monthSelectedIn)!==null&&A!==void 0?A:q,he=0;he<r;++he){var ve=he-ae+q,Ae=c.props.showMonthYearPicker||c.props.showQuarterYearPicker?Ch(ie,ve):Fc(ie,ve),we="month-".concat(he),Pe=he<r-1,Ve=he>0;N.push(Qt.createElement("div",{key:we,ref:function(We){c.monthContainer=We??void 0},className:"react-datepicker__month-container"},c.renderHeader({monthDate:Ae,i:he}),Qt.createElement(DR,mn({},g.defaultProps,c.props,{containerRef:c.containerRef,ariaLabelPrefix:c.props.monthAriaLabelPrefix,day:Ae,onDayClick:c.handleDayClick,handleOnKeyDown:c.props.handleOnDayKeyDown,handleOnMonthKeyDown:c.props.handleOnKeyDown,onDayMouseEnter:c.handleDayMouseEnter,onMouseLeave:c.handleMonthMouseLeave,orderInDisplay:he,selectingDate:c.state.selectingDate,monthShowsDuplicateDaysEnd:Pe,monthShowsDuplicateDaysStart:Ve}))))}return N}},c.renderYears=function(){if(!c.props.showTimeSelectOnly&&c.props.showYearPicker)return Qt.createElement("div",{className:"react-datepicker__year--container"},c.renderHeader({monthDate:c.state.date}),Qt.createElement(BR,mn({},g.defaultProps,c.props,{selectingDate:c.state.selectingDate,date:c.state.date,onDayClick:c.handleDayClick,clearSelectingDate:c.clearSelectingDate,onYearMouseEnter:c.handleYearMouseEnter,onYearMouseLeave:c.handleYearMouseLeave})))},c.renderTimeSection=function(){if(c.props.showTimeSelect&&(c.state.monthContainer||c.props.showTimeSelectOnly))return Qt.createElement(FR,mn({},g.defaultProps,c.props,{onChange:c.props.onTimeChange,format:c.props.timeFormat,intervals:c.props.timeIntervals,monthRef:c.state.monthContainer}))},c.renderInputTimeSection=function(){var _=c.props.selected?new Date(c.props.selected):void 0,A=_&&b0(_)&&!!c.props.selected,N=A?"".concat(QS(_.getHours()),":").concat(QS(_.getMinutes())):"";if(c.props.showTimeInput)return Qt.createElement(ER,mn({},g.defaultProps,c.props,{date:_,timeString:N,onChange:c.props.onTimeChange}))},c.renderAriaLiveRegion=function(){var _,A=zd(c.state.date,(_=c.props.yearItemNumber)!==null&&_!==void 0?_:g.defaultProps.yearItemNumber),N=A.startPeriod,r=A.endPeriod,q;return c.props.showYearPicker?q="".concat(N," - ").concat(r):c.props.showMonthYearPicker||c.props.showQuarterYearPicker?q=Zr(c.state.date):q="".concat(tb(Ta(c.state.date),c.props.locale)," ").concat(Zr(c.state.date)),Qt.createElement("span",{role:"alert","aria-live":"polite",className:"react-datepicker__aria-live"},c.state.isRenderAriaLiveMessage&&q)},c.renderChildren=function(){if(c.props.children)return Qt.createElement("div",{className:"react-datepicker__children-container"},c.props.children)},c.containerRef=Ke.createRef(),c.state={date:c.getDateInView(),selectingDate:void 0,monthContainer:void 0,isRenderAriaLiveMessage:!1},c}return Object.defineProperty(g,"defaultProps",{get:function(){return{monthsShown:1,forceShowMonthNavigation:!1,timeCaption:"Time",previousYearButtonLabel:"Previous Year",nextYearButtonLabel:"Next Year",previousMonthButtonLabel:"Previous Month",nextMonthButtonLabel:"Next Month",yearItemNumber:o_}},enumerable:!1,configurable:!0}),g.prototype.componentDidMount=function(){var l=this;this.props.showTimeSelect&&(this.assignMonthContainer=function(){l.setState({monthContainer:l.monthContainer})}())},g.prototype.componentDidUpdate=function(l){var c=this;if(this.props.preSelection&&(!fn(this.props.preSelection,l.preSelection)||this.props.monthSelectedIn!==l.monthSelectedIn)){var _=!wa(this.state.date,this.props.preSelection);this.setState({date:this.props.preSelection},function(){return _&&c.handleCustomMonthChange(c.state.date)})}else this.props.openToDate&&!fn(this.props.openToDate,l.openToDate)&&this.setState({date:this.props.openToDate})},g.prototype.render=function(){var l=this.props.container||nR;return Qt.createElement(x0,{onClickOutside:this.handleClickOutside,style:{display:"contents"},ignoreClass:this.props.outsideClickIgnoreClass},Qt.createElement("div",{style:{display:"contents"},ref:this.containerRef},Qt.createElement(l,{className:gn("react-datepicker",this.props.className,{"react-datepicker--time-only":this.props.showTimeSelectOnly}),showTime:this.props.showTimeSelect||this.props.showTimeInput,showTimeSelectOnly:this.props.showTimeSelectOnly},this.renderAriaLiveRegion(),this.renderPreviousButton(),this.renderNextButton(),this.renderMonths(),this.renderYears(),this.renderTodayButton(),this.renderTimeSection(),this.renderInputTimeSection(),this.renderChildren())))},g}(Ke.Component),HR=function(m){var g=m.icon,l=m.className,c=l===void 0?"":l,_=m.onClick,A="react-datepicker__calendar-icon";if(typeof g=="string")return Qt.createElement("i",{className:"".concat(A," ").concat(g," ").concat(c),"aria-hidden":"true",onClick:_});if(Qt.isValidElement(g)){var N=g;return Qt.cloneElement(N,{className:"".concat(N.props.className||""," ").concat(A," ").concat(c),onClick:function(r){typeof N.props.onClick=="function"&&N.props.onClick(r),typeof _=="function"&&_(r)}})}return Qt.createElement("svg",{className:"".concat(A," ").concat(c),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",onClick:_},Qt.createElement("path",{d:"M96 32V64H48C21.5 64 0 85.5 0 112v48H448V112c0-26.5-21.5-48-48-48H352V32c0-17.7-14.3-32-32-32s-32 14.3-32 32V64H160V32c0-17.7-14.3-32-32-32S96 14.3 96 32zM448 192H0V464c0 26.5 21.5 48 48 48H400c26.5 0 48-21.5 48-48V192z"}))},dM=function(m){Ao(g,m);function g(l){var c=m.call(this,l)||this;return c.portalRoot=null,c.el=document.createElement("div"),c}return g.prototype.componentDidMount=function(){this.portalRoot=(this.props.portalHost||document).getElementById(this.props.portalId),this.portalRoot||(this.portalRoot=document.createElement("div"),this.portalRoot.setAttribute("id",this.props.portalId),(this.props.portalHost||document.body).appendChild(this.portalRoot)),this.portalRoot.appendChild(this.el)},g.prototype.componentWillUnmount=function(){this.portalRoot&&this.portalRoot.removeChild(this.el)},g.prototype.render=function(){return oA.createPortal(this.props.children,this.el)},g}(Ke.Component),WR="[tabindex], a, button, input, select, textarea",qR=function(m){return(m instanceof HTMLAnchorElement||!m.disabled)&&m.tabIndex!==-1},pM=function(m){Ao(g,m);function g(l){var c=m.call(this,l)||this;return c.getTabChildren=function(){var _;return Array.prototype.slice.call((_=c.tabLoopRef.current)===null||_===void 0?void 0:_.querySelectorAll(WR),1,-1).filter(qR)},c.handleFocusStart=function(){var _=c.getTabChildren();_&&_.length>1&&_[_.length-1].focus()},c.handleFocusEnd=function(){var _=c.getTabChildren();_&&_.length>1&&_[0].focus()},c.tabLoopRef=Ke.createRef(),c}return g.prototype.render=function(){var l;return((l=this.props.enableTabLoop)!==null&&l!==void 0?l:g.defaultProps.enableTabLoop)?Qt.createElement("div",{className:"react-datepicker__tab-loop",ref:this.tabLoopRef},Qt.createElement("div",{className:"react-datepicker__tab-loop__start",tabIndex:0,onFocus:this.handleFocusStart}),this.props.children,Qt.createElement("div",{className:"react-datepicker__tab-loop__end",tabIndex:0,onFocus:this.handleFocusEnd})):this.props.children},g.defaultProps={enableTabLoop:!0},g}(Ke.Component);function YR(m){var g=function(l){var c,_=typeof l.hidePopper=="boolean"?l.hidePopper:!0,A=Ke.useRef(null),N=rR(mn({open:!_,whileElementsMounted:_2,placement:l.popperPlacement,middleware:Bu([jL({padding:15}),UL(10),$L({element:A})],(c=l.popperModifiers)!==null&&c!==void 0?c:[],!0)},l.popperProps)),r=mn(mn({},l),{hidePopper:_,popperProps:mn(mn({},N),{arrowRef:A})});return Qt.createElement(m,mn({},r))};return g}var XR=function(m){Ao(g,m);function g(){return m!==null&&m.apply(this,arguments)||this}return Object.defineProperty(g,"defaultProps",{get:function(){return{hidePopper:!0}},enumerable:!1,configurable:!0}),g.prototype.render=function(){var l=this.props,c=l.className,_=l.wrapperClassName,A=l.hidePopper,N=A===void 0?g.defaultProps.hidePopper:A,r=l.popperComponent,q=l.targetComponent,ie=l.enableTabLoop,ae=l.popperOnKeyDown,he=l.portalId,ve=l.portalHost,Ae=l.popperProps,we=l.showArrow,Pe=void 0;if(!N){var Ve=gn("react-datepicker-popper",c);Pe=Qt.createElement(pM,{enableTabLoop:ie},Qt.createElement("div",{ref:Ae.refs.setFloating,style:Ae.floatingStyles,className:Ve,"data-placement":Ae.placement,onKeyDown:ae},r,we&&Qt.createElement(ZL,{ref:Ae.arrowRef,context:Ae.context,fill:"currentColor",strokeWidth:1,height:8,width:16,style:{transform:"translateY(-1px)"},className:"react-datepicker__triangle"})))}this.props.popperContainer&&(Pe=Ke.createElement(this.props.popperContainer,{},Pe)),he&&!N&&(Pe=Qt.createElement(dM,{portalId:he,portalHost:ve},Pe));var We=gn("react-datepicker-wrapper",_);return Qt.createElement(Qt.Fragment,null,Qt.createElement("div",{ref:Ae.refs.setReference,className:We},q),Pe)},g}(Ke.Component),ZR=YR(XR),sT="react-datepicker-ignore-onclickoutside";function KR(m,g){return m&&g?Ta(m)!==Ta(g)||Zr(m)!==Zr(g):m!==g}var ax="Date input not valid.",oT=function(m){Ao(g,m);function g(l){var c=m.call(this,l)||this;return c.calendar=null,c.input=null,c.getPreSelection=function(){return c.props.openToDate?c.props.openToDate:c.props.selectsEnd&&c.props.startDate?c.props.startDate:c.props.selectsStart&&c.props.endDate?c.props.endDate:En()},c.modifyHolidays=function(){var _;return(_=c.props.holidays)===null||_===void 0?void 0:_.reduce(function(A,N){var r=new Date(N.date);return b0(r)?Bu(Bu([],A,!0),[mn(mn({},N),{date:r})],!1):A},[])},c.calcInitialState=function(){var _,A=c.getPreSelection(),N=cM(c.props),r=uM(c.props),q=N&&df(A,Dy(N))?N:r&&Vd(A,GS(r))?r:A;return{open:c.props.startOpen||!1,preventFocus:!1,inputValue:null,preSelection:(_=c.props.selectsRange?c.props.startDate:c.props.selected)!==null&&_!==void 0?_:q,highlightDates:JS(c.props.highlightDates),focused:!1,shouldFocusDayInline:!1,isRenderAriaLiveMessage:!1,wasHidden:!1}},c.resetHiddenStatus=function(){c.setState(mn(mn({},c.state),{wasHidden:!1}))},c.setHiddenStatus=function(){c.setState(mn(mn({},c.state),{wasHidden:!0}))},c.setHiddenStateOnVisibilityHidden=function(){document.visibilityState==="hidden"&&c.setHiddenStatus()},c.clearPreventFocusTimeout=function(){c.preventFocusTimeout&&clearTimeout(c.preventFocusTimeout)},c.setFocus=function(){var _,A;(A=(_=c.input)===null||_===void 0?void 0:_.focus)===null||A===void 0||A.call(_,{preventScroll:!0})},c.setBlur=function(){var _,A;(A=(_=c.input)===null||_===void 0?void 0:_.blur)===null||A===void 0||A.call(_),c.cancelFocusInput()},c.deferBlur=function(){requestAnimationFrame(function(){c.setBlur()})},c.setOpen=function(_,A){A===void 0&&(A=!1),c.setState({open:_,preSelection:_&&c.state.open?c.state.preSelection:c.calcInitialState().preSelection,lastPreSelectChange:lx},function(){_||c.setState(function(N){return{focused:A?N.focused:!1}},function(){!A&&c.deferBlur(),c.setState({inputValue:null})})})},c.inputOk=function(){return Ah(c.state.preSelection)},c.isCalendarOpen=function(){return c.props.open===void 0?c.state.open&&!c.props.disabled&&!c.props.readOnly:c.props.open},c.handleFocus=function(_){var A,N,r=c.state.wasHidden,q=r?c.state.open:!0;r&&c.resetHiddenStatus(),c.state.preventFocus||((N=(A=c.props).onFocus)===null||N===void 0||N.call(A,_),q&&!c.props.preventOpenOnFocus&&!c.props.readOnly&&c.setOpen(!0)),c.setState({focused:!0})},c.sendFocusBackToInput=function(){c.preventFocusTimeout&&c.clearPreventFocusTimeout(),c.setState({preventFocus:!0},function(){c.preventFocusTimeout=setTimeout(function(){c.setFocus(),c.setState({preventFocus:!1})})})},c.cancelFocusInput=function(){clearTimeout(c.inputFocusTimeout),c.inputFocusTimeout=void 0},c.deferFocusInput=function(){c.cancelFocusInput(),c.inputFocusTimeout=setTimeout(function(){return c.setFocus()},1)},c.handleDropdownFocus=function(){c.cancelFocusInput()},c.handleBlur=function(_){var A,N;(!c.state.open||c.props.withPortal||c.props.showTimeInput)&&((N=(A=c.props).onBlur)===null||N===void 0||N.call(A,_)),c.state.open&&c.props.open===!1&&c.setOpen(!1),c.setState({focused:!1})},c.handleCalendarClickOutside=function(_){var A,N;c.props.inline||c.setOpen(!1),(N=(A=c.props).onClickOutside)===null||N===void 0||N.call(A,_),c.props.withPortal&&_.preventDefault()},c.handleChange=function(){for(var _,A,N,r,q,ie=[],ae=0;ae<arguments.length;ae++)ie[ae]=arguments[ae];var he=ie[0];if(!(c.props.onChangeRaw&&(c.props.onChangeRaw.apply(c,ie),!he||typeof he.isDefaultPrevented!="function"||he.isDefaultPrevented()))){c.setState({inputValue:(he==null?void 0:he.target)instanceof HTMLInputElement?he.target.value:null,lastPreSelectChange:JR});var ve=c.props,Ae=ve.selectsRange,we=ve.startDate,Pe=ve.endDate,Ve=(_=c.props.dateFormat)!==null&&_!==void 0?_:g.defaultProps.dateFormat,We=(A=c.props.strictParsing)!==null&&A!==void 0?A:g.defaultProps.strictParsing,rt=(he==null?void 0:he.target)instanceof HTMLInputElement?he.target.value:"";if(Ae){var ht=rt.split("-",2).map(function(gt){return gt.trim()}),tt=ht[0],at=ht[1],Rt=nx(tt??"",Ve,c.props.locale,We),Ne=nx(at??"",Ve,c.props.locale,We),Tt=(we==null?void 0:we.getTime())!==(Rt==null?void 0:Rt.getTime()),qt=(Pe==null?void 0:Pe.getTime())!==(Ne==null?void 0:Ne.getTime());if(!Tt&&!qt||Rt&&Yl(Rt,c.props)||Ne&&Yl(Ne,c.props))return;(r=(N=c.props).onChange)===null||r===void 0||r.call(N,[Rt,Ne],he)}else{var Te=nx(rt,Ve,c.props.locale,We,(q=c.props.selected)!==null&&q!==void 0?q:void 0);(Te||!rt)&&c.setSelected(Te,he,!0)}}},c.handleSelect=function(_,A,N){if(c.props.shouldCloseOnSelect&&!c.props.showTimeSelect&&c.sendFocusBackToInput(),c.props.onChangeRaw&&c.props.onChangeRaw(A),c.setSelected(_,A,!1,N),c.props.showDateSelect&&c.setState({isRenderAriaLiveMessage:!0}),!c.props.shouldCloseOnSelect||c.props.showTimeSelect)c.setPreSelection(_);else if(!c.props.inline){c.props.selectsRange||c.setOpen(!1);var r=c.props,q=r.startDate,ie=r.endDate;q&&!ie&&(c.props.swapRange||!iT(_,q))&&c.setOpen(!1)}},c.setSelected=function(_,A,N,r){var q,ie,ae=_;if(c.props.showYearPicker){if(ae!==null&&ky(Zr(ae),c.props))return}else if(c.props.showMonthYearPicker){if(ae!==null&&lM(ae,c.props))return}else if(ae!==null&&Yl(ae,c.props))return;var he=c.props,ve=he.onChange,Ae=he.selectsRange,we=he.startDate,Pe=he.endDate,Ve=he.selectsMultiple,We=he.selectedDates,rt=he.minTime,ht=he.swapRange;if(!nf(c.props.selected,ae)||c.props.allowSameDay||Ae||Ve)if(ae!==null&&(c.props.selected&&(!N||!c.props.showTimeSelect&&!c.props.showTimeSelectOnly&&!c.props.showTimeInput)&&(ae=sx(ae,{hour:Ph(c.props.selected),minute:Ih(c.props.selected),second:Fd(c.props.selected)})),!N&&(c.props.showTimeSelect||c.props.showTimeSelectOnly)&&rt&&(ae=sx(ae,{hour:rt.getHours(),minute:rt.getMinutes(),second:rt.getSeconds()})),c.props.inline||c.setState({preSelection:ae}),c.props.focusSelectedMonth||c.setState({monthSelectedIn:r})),Ae){var tt=!we&&!Pe,at=we&&!Pe,Rt=we&&Pe;tt?ve==null||ve([ae,null],A):at&&(ae===null?ve==null||ve([null,null],A):iT(ae,we)?ht?ve==null||ve([ae,we],A):ve==null||ve([ae,null],A):ve==null||ve([we,ae],A)),Rt&&(ve==null||ve([ae,null],A))}else if(Ve){if(ae!==null)if(!(We!=null&&We.length))ve==null||ve([ae],A);else{var Ne=We.some(function(qt){return fn(qt,ae)});if(Ne){var Tt=We.filter(function(qt){return!fn(qt,ae)});ve==null||ve(Tt,A)}else ve==null||ve(Bu(Bu([],We,!0),[ae],!1),A)}}else ve==null||ve(ae,A);N||((ie=(q=c.props).onSelect)===null||ie===void 0||ie.call(q,ae,A),c.setState({inputValue:null}))},c.setPreSelection=function(_){var A=Ah(c.props.minDate),N=Ah(c.props.maxDate),r=!0;if(_){var q=Dy(_);if(A&&N)r=jg(_,c.props.minDate,c.props.maxDate);else if(A){var ie=Dy(c.props.minDate);r=Vd(_,ie)||nf(q,ie)}else if(N){var ae=GS(c.props.maxDate);r=df(_,ae)||nf(q,ae)}}r&&c.setState({preSelection:_})},c.toggleCalendar=function(){c.setOpen(!c.state.open)},c.handleTimeChange=function(_){var A,N;if(!(c.props.selectsRange||c.props.selectsMultiple)){var r=c.props.selected?c.props.selected:c.getPreSelection(),q=c.props.selected?_:sx(r,{hour:Ph(_),minute:Ih(_)});c.setState({preSelection:q}),(N=(A=c.props).onChange)===null||N===void 0||N.call(A,q),c.props.shouldCloseOnSelect&&!c.props.showTimeInput&&(c.sendFocusBackToInput(),c.setOpen(!1)),c.props.showTimeInput&&c.setOpen(!0),(c.props.showTimeSelectOnly||c.props.showTimeSelect)&&c.setState({isRenderAriaLiveMessage:!0}),c.setState({inputValue:null})}},c.onInputClick=function(){var _,A;!c.props.disabled&&!c.props.readOnly&&c.setOpen(!0),(A=(_=c.props).onInputClick)===null||A===void 0||A.call(_)},c.onInputKeyDown=function(_){var A,N,r,q,ie,ae;(N=(A=c.props).onKeyDown)===null||N===void 0||N.call(A,_);var he=_.key;if(!c.state.open&&!c.props.inline&&!c.props.preventOpenOnFocus){(he===Ui.ArrowDown||he===Ui.ArrowUp||he===Ui.Enter)&&((r=c.onInputClick)===null||r===void 0||r.call(c));return}if(c.state.open){if(he===Ui.ArrowDown||he===Ui.ArrowUp){_.preventDefault();var ve=c.props.showTimeSelectOnly?".react-datepicker__time-list-item[tabindex='0']":c.props.showWeekPicker&&c.props.showWeekNumbers?'.react-datepicker__week-number[tabindex="0"]':c.props.showFullMonthYearPicker||c.props.showMonthYearPicker?'.react-datepicker__month-text[tabindex="0"]':'.react-datepicker__day[tabindex="0"]',Ae=((q=c.calendar)===null||q===void 0?void 0:q.containerRef.current)instanceof Element&&c.calendar.containerRef.current.querySelector(ve);Ae instanceof HTMLElement&&Ae.focus({preventScroll:!0});return}var we=En(c.state.preSelection);he===Ui.Enter?(_.preventDefault(),_.target.blur(),c.inputOk()&&c.state.lastPreSelectChange===lx?(c.handleSelect(we,_),!c.props.shouldCloseOnSelect&&c.setPreSelection(we)):c.setOpen(!1)):he===Ui.Escape?(_.preventDefault(),_.target.blur(),c.sendFocusBackToInput(),c.setOpen(!1)):he===Ui.Tab&&c.setOpen(!1),c.inputOk()||(ae=(ie=c.props).onInputError)===null||ae===void 0||ae.call(ie,{code:1,msg:ax})}},c.onPortalKeyDown=function(_){var A=_.key;A===Ui.Escape&&(_.preventDefault(),c.setState({preventFocus:!0},function(){c.setOpen(!1),setTimeout(function(){c.setFocus(),c.setState({preventFocus:!1})})}))},c.onDayKeyDown=function(_){var A,N,r,q,ie,ae,he=c.props,ve=he.minDate,Ae=he.maxDate,we=he.disabledKeyboardNavigation,Pe=he.showWeekPicker,Ve=he.shouldCloseOnSelect,We=he.locale,rt=he.calendarStartDay,ht=he.adjustDateOnChange,tt=he.inline;if((N=(A=c.props).onKeyDown)===null||N===void 0||N.call(A,_),!we){var at=_.key,Rt=_.shiftKey,Ne=En(c.state.preSelection),Tt=function(Mt,zt){var ii=zt;switch(Mt){case Ui.ArrowRight:ii=Pe?Xy(zt,1):zc(zt,1);break;case Ui.ArrowLeft:ii=Pe?BS(zt):wL(zt);break;case Ui.ArrowUp:ii=BS(zt);break;case Ui.ArrowDown:ii=Xy(zt,1);break;case Ui.PageUp:ii=Rt?Om(zt,1):lf(zt,1);break;case Ui.PageDown:ii=Rt?Ch(zt,1):Fc(zt,1);break;case Ui.Home:ii=Bd(zt,We,rt);break;case Ui.End:ii=uR(zt);break}return ii},qt=function(Mt,zt){for(var ii=40,Yt=Mt,jt=!1,Ri=0,Yi=Tt(Mt,zt);!jt;){if(Ri>=ii){Yi=zt;break}ve&&Yi<ve&&(Yt=Ui.ArrowRight,Yi=Yl(ve,c.props)?Tt(Yt,Yi):ve),Ae&&Yi>Ae&&(Yt=Ui.ArrowLeft,Yi=Yl(Ae,c.props)?Tt(Yt,Yi):Ae),Yl(Yi,c.props)?((Yt===Ui.PageUp||Yt===Ui.Home)&&(Yt=Ui.ArrowRight),(Yt===Ui.PageDown||Yt===Ui.End)&&(Yt=Ui.ArrowLeft),Yi=Tt(Yt,Yi)):jt=!0,Ri++}return Yi};if(at===Ui.Enter){_.preventDefault(),c.handleSelect(Ne,_),!Ve&&c.setPreSelection(Ne);return}else if(at===Ui.Escape){_.preventDefault(),c.setOpen(!1),c.inputOk()||(q=(r=c.props).onInputError)===null||q===void 0||q.call(r,{code:1,msg:ax});return}var Te=null;switch(at){case Ui.ArrowLeft:case Ui.ArrowRight:case Ui.ArrowUp:case Ui.ArrowDown:case Ui.PageUp:case Ui.PageDown:case Ui.Home:case Ui.End:Te=qt(at,Ne);break}if(!Te){(ae=(ie=c.props).onInputError)===null||ae===void 0||ae.call(ie,{code:1,msg:ax});return}if(_.preventDefault(),c.setState({lastPreSelectChange:lx}),ht&&c.setSelected(Te),c.setPreSelection(Te),tt){var gt=Ta(Ne),oi=Ta(Te),Ti=Zr(Ne),ni=Zr(Te);gt!==oi||Ti!==ni?c.setState({shouldFocusDayInline:!0}):c.setState({shouldFocusDayInline:!1})}}},c.onPopperKeyDown=function(_){var A=_.key;A===Ui.Escape&&(_.preventDefault(),c.sendFocusBackToInput())},c.onClearClick=function(_){_&&_.preventDefault&&_.preventDefault(),c.sendFocusBackToInput();var A=c.props,N=A.selectsRange,r=A.onChange;N?r==null||r([null,null],_):r==null||r(null,_),c.setState({inputValue:null})},c.clear=function(){c.onClearClick()},c.onScroll=function(_){typeof c.props.closeOnScroll=="boolean"&&c.props.closeOnScroll?(_.target===document||_.target===document.documentElement||_.target===document.body)&&c.setOpen(!1):typeof c.props.closeOnScroll=="function"&&c.props.closeOnScroll(_)&&c.setOpen(!1)},c.renderCalendar=function(){var _,A;return!c.props.inline&&!c.isCalendarOpen()?null:Qt.createElement(GR,mn({showMonthYearDropdown:void 0,ref:function(N){c.calendar=N}},c.props,c.state,{setOpen:c.setOpen,dateFormat:(_=c.props.dateFormatCalendar)!==null&&_!==void 0?_:g.defaultProps.dateFormatCalendar,onSelect:c.handleSelect,onClickOutside:c.handleCalendarClickOutside,holidays:wR(c.modifyHolidays()),outsideClickIgnoreClass:sT,onDropdownFocus:c.handleDropdownFocus,onTimeChange:c.handleTimeChange,className:c.props.calendarClassName,container:c.props.calendarContainer,handleOnKeyDown:c.props.onKeyDown,handleOnDayKeyDown:c.onDayKeyDown,setPreSelection:c.setPreSelection,dropdownMode:(A=c.props.dropdownMode)!==null&&A!==void 0?A:g.defaultProps.dropdownMode}),c.props.children)},c.renderAriaLiveRegion=function(){var _=c.props,A=_.dateFormat,N=A===void 0?g.defaultProps.dateFormat:A,r=_.locale,q=c.props.showTimeInput||c.props.showTimeSelect,ie=q?"PPPPp":"PPPP",ae;return c.props.selectsRange?ae="Selected start date: ".concat(Hl(c.props.startDate,{dateFormat:ie,locale:r}),". ").concat(c.props.endDate?"End date: "+Hl(c.props.endDate,{dateFormat:ie,locale:r}):""):c.props.showTimeSelectOnly?ae="Selected time: ".concat(Hl(c.props.selected,{dateFormat:N,locale:r})):c.props.showYearPicker?ae="Selected year: ".concat(Hl(c.props.selected,{dateFormat:"yyyy",locale:r})):c.props.showMonthYearPicker?ae="Selected month: ".concat(Hl(c.props.selected,{dateFormat:"MMMM yyyy",locale:r})):c.props.showQuarterYearPicker?ae="Selected quarter: ".concat(Hl(c.props.selected,{dateFormat:"yyyy, QQQ",locale:r})):ae="Selected date: ".concat(Hl(c.props.selected,{dateFormat:ie,locale:r})),Qt.createElement("span",{role:"alert","aria-live":"polite",className:"react-datepicker__aria-live"},ae)},c.renderDateInput=function(){var _,A,N,r=gn(c.props.className,(_={},_[sT]=c.state.open,_)),q=c.props.customInput||Qt.createElement("input",{type:"text"}),ie=c.props.customInputRef||"ref",ae=c.props,he=ae.dateFormat,ve=he===void 0?g.defaultProps.dateFormat:he,Ae=ae.locale,we=typeof c.props.value=="string"?c.props.value:typeof c.state.inputValue=="string"?c.state.inputValue:c.props.selectsRange?oR(c.props.startDate,c.props.endDate,{dateFormat:ve,locale:Ae}):c.props.selectsMultiple?aR((N=c.props.selectedDates)!==null&&N!==void 0?N:[],{dateFormat:ve,locale:Ae}):Hl(c.props.selected,{dateFormat:ve,locale:Ae});return Ke.cloneElement(q,(A={},A[ie]=function(Pe){c.input=Pe},A.value=we,A.onBlur=c.handleBlur,A.onChange=c.handleChange,A.onClick=c.onInputClick,A.onFocus=c.handleFocus,A.onKeyDown=c.onInputKeyDown,A.id=c.props.id,A.name=c.props.name,A.form=c.props.form,A.autoFocus=c.props.autoFocus,A.placeholder=c.props.placeholderText,A.disabled=c.props.disabled,A.autoComplete=c.props.autoComplete,A.className=gn(q.props.className,r),A.title=c.props.title,A.readOnly=c.props.readOnly,A.required=c.props.required,A.tabIndex=c.props.tabIndex,A["aria-describedby"]=c.props.ariaDescribedBy,A["aria-invalid"]=c.props.ariaInvalid,A["aria-labelledby"]=c.props.ariaLabelledBy,A["aria-required"]=c.props.ariaRequired,A))},c.renderClearButton=function(){var _=c.props,A=_.isClearable,N=_.disabled,r=_.selected,q=_.startDate,ie=_.endDate,ae=_.clearButtonTitle,he=_.clearButtonClassName,ve=he===void 0?"":he,Ae=_.ariaLabelClose,we=Ae===void 0?"Close":Ae,Pe=_.selectedDates;return A&&(r!=null||q!=null||ie!=null||Pe!=null&&Pe.length)?Qt.createElement("button",{type:"button",className:gn("react-datepicker__close-icon",ve,{"react-datepicker__close-icon--disabled":N}),disabled:N,"aria-label":we,onClick:c.onClearClick,title:ae,tabIndex:-1}):null},c.state=c.calcInitialState(),c.preventFocusTimeout=void 0,c}return Object.defineProperty(g,"defaultProps",{get:function(){return{allowSameDay:!1,dateFormat:"MM/dd/yyyy",dateFormatCalendar:"LLLL yyyy",disabled:!1,disabledKeyboardNavigation:!1,dropdownMode:"scroll",preventOpenOnFocus:!1,monthsShown:1,readOnly:!1,withPortal:!1,selectsDisabledDaysInRange:!1,shouldCloseOnSelect:!0,showTimeSelect:!1,showTimeInput:!1,showPreviousMonths:!1,showMonthYearPicker:!1,showFullMonthYearPicker:!1,showTwoColumnMonthYearPicker:!1,showFourColumnMonthYearPicker:!1,showYearPicker:!1,showQuarterYearPicker:!1,showWeekPicker:!1,strictParsing:!1,swapRange:!1,timeIntervals:30,timeCaption:"Time",previousMonthAriaLabel:"Previous Month",previousMonthButtonLabel:"Previous Month",nextMonthAriaLabel:"Next Month",nextMonthButtonLabel:"Next Month",previousYearAriaLabel:"Previous Year",previousYearButtonLabel:"Previous Year",nextYearAriaLabel:"Next Year",nextYearButtonLabel:"Next Year",timeInputLabel:"Time",enableTabLoop:!0,yearItemNumber:o_,focusSelectedMonth:!1,showPopperArrow:!0,excludeScrollbar:!0,customTimeInput:null,calendarStartDay:void 0,toggleCalendarOnIconClick:!1,usePointerEvent:!1}},enumerable:!1,configurable:!0}),g.prototype.componentDidMount=function(){window.addEventListener("scroll",this.onScroll,!0),document.addEventListener("visibilitychange",this.setHiddenStateOnVisibilityHidden)},g.prototype.componentDidUpdate=function(l,c){var _,A,N,r;l.inline&&KR(l.selected,this.props.selected)&&this.setPreSelection(this.props.selected),this.state.monthSelectedIn!==void 0&&l.monthsShown!==this.props.monthsShown&&this.setState({monthSelectedIn:0}),l.highlightDates!==this.props.highlightDates&&this.setState({highlightDates:JS(this.props.highlightDates)}),!c.focused&&!nf(l.selected,this.props.selected)&&this.setState({inputValue:null}),c.open!==this.state.open&&(c.open===!1&&this.state.open===!0&&((A=(_=this.props).onCalendarOpen)===null||A===void 0||A.call(_)),c.open===!0&&this.state.open===!1&&((r=(N=this.props).onCalendarClose)===null||r===void 0||r.call(N)))},g.prototype.componentWillUnmount=function(){this.clearPreventFocusTimeout(),window.removeEventListener("scroll",this.onScroll,!0),document.removeEventListener("visibilitychange",this.setHiddenStateOnVisibilityHidden)},g.prototype.renderInputContainer=function(){var l=this.props,c=l.showIcon,_=l.icon,A=l.calendarIconClassname,N=l.calendarIconClassName,r=l.toggleCalendarOnIconClick,q=this.state.open;return A&&console.warn("calendarIconClassname props is deprecated. should use calendarIconClassName props."),Qt.createElement("div",{className:"react-datepicker__input-container".concat(c?" react-datepicker__view-calendar-icon":"")},c&&Qt.createElement(HR,mn({icon:_,className:gn(N,!N&&A,q&&"react-datepicker-ignore-onclickoutside")},r?{onClick:this.toggleCalendar}:null)),this.state.isRenderAriaLiveMessage&&this.renderAriaLiveRegion(),this.renderDateInput(),this.renderClearButton())},g.prototype.render=function(){var l=this.renderCalendar();if(this.props.inline)return l;if(this.props.withPortal){var c=this.state.open?Qt.createElement(pM,{enableTabLoop:this.props.enableTabLoop},Qt.createElement("div",{className:"react-datepicker__portal",tabIndex:-1,onKeyDown:this.onPortalKeyDown},l)):null;return this.state.open&&this.props.portalId&&(c=Qt.createElement(dM,mn({portalId:this.props.portalId},this.props),c)),Qt.createElement("div",null,this.renderInputContainer(),c)}return Qt.createElement(ZR,mn({},this.props,{className:this.props.popperClassName,hidePopper:!this.isCalendarOpen(),targetComponent:this.renderInputContainer(),popperComponent:l,popperOnKeyDown:this.onPopperKeyDown,showArrow:this.props.showPopperArrow}))},g}(Ke.Component),JR="input",lx="navigate",Oy={exports:{}},QR=Oy.exports,aT;function e3(){return aT||(aT=1,function(m,g){(function(l,c){m.exports=c()})(QR,function(){var l=1e3,c=6e4,_=36e5,A="millisecond",N="second",r="minute",q="hour",ie="day",ae="week",he="month",ve="quarter",Ae="year",we="date",Pe="Invalid Date",Ve=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,We=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,rt={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(ni){var Mt=["th","st","nd","rd"],zt=ni%100;return"["+ni+(Mt[(zt-20)%10]||Mt[zt]||Mt[0])+"]"}},ht=function(ni,Mt,zt){var ii=String(ni);return!ii||ii.length>=Mt?ni:""+Array(Mt+1-ii.length).join(zt)+ni},tt={s:ht,z:function(ni){var Mt=-ni.utcOffset(),zt=Math.abs(Mt),ii=Math.floor(zt/60),Yt=zt%60;return(Mt<=0?"+":"-")+ht(ii,2,"0")+":"+ht(Yt,2,"0")},m:function ni(Mt,zt){if(Mt.date()<zt.date())return-ni(zt,Mt);var ii=12*(zt.year()-Mt.year())+(zt.month()-Mt.month()),Yt=Mt.clone().add(ii,he),jt=zt-Yt<0,Ri=Mt.clone().add(ii+(jt?-1:1),he);return+(-(ii+(zt-Yt)/(jt?Yt-Ri:Ri-Yt))||0)},a:function(ni){return ni<0?Math.ceil(ni)||0:Math.floor(ni)},p:function(ni){return{M:he,y:Ae,w:ae,d:ie,D:we,h:q,m:r,s:N,ms:A,Q:ve}[ni]||String(ni||"").toLowerCase().replace(/s$/,"")},u:function(ni){return ni===void 0}},at="en",Rt={};Rt[at]=rt;var Ne="$isDayjsObject",Tt=function(ni){return ni instanceof oi||!(!ni||!ni[Ne])},qt=function ni(Mt,zt,ii){var Yt;if(!Mt)return at;if(typeof Mt=="string"){var jt=Mt.toLowerCase();Rt[jt]&&(Yt=jt),zt&&(Rt[jt]=zt,Yt=jt);var Ri=Mt.split("-");if(!Yt&&Ri.length>1)return ni(Ri[0])}else{var Yi=Mt.name;Rt[Yi]=Mt,Yt=Yi}return!ii&&Yt&&(at=Yt),Yt||!ii&&at},Te=function(ni,Mt){if(Tt(ni))return ni.clone();var zt=typeof Mt=="object"?Mt:{};return zt.date=ni,zt.args=arguments,new oi(zt)},gt=tt;gt.l=qt,gt.i=Tt,gt.w=function(ni,Mt){return Te(ni,{locale:Mt.$L,utc:Mt.$u,x:Mt.$x,$offset:Mt.$offset})};var oi=function(){function ni(zt){this.$L=qt(zt.locale,null,!0),this.parse(zt),this.$x=this.$x||zt.x||{},this[Ne]=!0}var Mt=ni.prototype;return Mt.parse=function(zt){this.$d=function(ii){var Yt=ii.date,jt=ii.utc;if(Yt===null)return new Date(NaN);if(gt.u(Yt))return new Date;if(Yt instanceof Date)return new Date(Yt);if(typeof Yt=="string"&&!/Z$/i.test(Yt)){var Ri=Yt.match(Ve);if(Ri){var Yi=Ri[2]-1||0,Wi=(Ri[7]||"0").substring(0,3);return jt?new Date(Date.UTC(Ri[1],Yi,Ri[3]||1,Ri[4]||0,Ri[5]||0,Ri[6]||0,Wi)):new Date(Ri[1],Yi,Ri[3]||1,Ri[4]||0,Ri[5]||0,Ri[6]||0,Wi)}}return new Date(Yt)}(zt),this.init()},Mt.init=function(){var zt=this.$d;this.$y=zt.getFullYear(),this.$M=zt.getMonth(),this.$D=zt.getDate(),this.$W=zt.getDay(),this.$H=zt.getHours(),this.$m=zt.getMinutes(),this.$s=zt.getSeconds(),this.$ms=zt.getMilliseconds()},Mt.$utils=function(){return gt},Mt.isValid=function(){return this.$d.toString()!==Pe},Mt.isSame=function(zt,ii){var Yt=Te(zt);return this.startOf(ii)<=Yt&&Yt<=this.endOf(ii)},Mt.isAfter=function(zt,ii){return Te(zt)<this.startOf(ii)},Mt.isBefore=function(zt,ii){return this.endOf(ii)<Te(zt)},Mt.$g=function(zt,ii,Yt){return gt.u(zt)?this[ii]:this.set(Yt,zt)},Mt.unix=function(){return Math.floor(this.valueOf()/1e3)},Mt.valueOf=function(){return this.$d.getTime()},Mt.startOf=function(zt,ii){var Yt=this,jt=!!gt.u(ii)||ii,Ri=gt.p(zt),Yi=function(es,Ye){var ds=gt.w(Yt.$u?Date.UTC(Yt.$y,Ye,es):new Date(Yt.$y,Ye,es),Yt);return jt?ds:ds.endOf(ie)},Wi=function(es,Ye){return gt.w(Yt.toDate()[es].apply(Yt.toDate("s"),(jt?[0,0,0,0]:[23,59,59,999]).slice(Ye)),Yt)},vi=this.$W,Wr=this.$M,an=this.$D,_n="set"+(this.$u?"UTC":"");switch(Ri){case Ae:return jt?Yi(1,0):Yi(31,11);case he:return jt?Yi(1,Wr):Yi(0,Wr+1);case ae:var Cn=this.$locale().weekStart||0,qr=(vi<Cn?vi+7:vi)-Cn;return Yi(jt?an-qr:an+(6-qr),Wr);case ie:case we:return Wi(_n+"Hours",0);case q:return Wi(_n+"Minutes",1);case r:return Wi(_n+"Seconds",2);case N:return Wi(_n+"Milliseconds",3);default:return this.clone()}},Mt.endOf=function(zt){return this.startOf(zt,!1)},Mt.$set=function(zt,ii){var Yt,jt=gt.p(zt),Ri="set"+(this.$u?"UTC":""),Yi=(Yt={},Yt[ie]=Ri+"Date",Yt[we]=Ri+"Date",Yt[he]=Ri+"Month",Yt[Ae]=Ri+"FullYear",Yt[q]=Ri+"Hours",Yt[r]=Ri+"Minutes",Yt[N]=Ri+"Seconds",Yt[A]=Ri+"Milliseconds",Yt)[jt],Wi=jt===ie?this.$D+(ii-this.$W):ii;if(jt===he||jt===Ae){var vi=this.clone().set(we,1);vi.$d[Yi](Wi),vi.init(),this.$d=vi.set(we,Math.min(this.$D,vi.daysInMonth())).$d}else Yi&&this.$d[Yi](Wi);return this.init(),this},Mt.set=function(zt,ii){return this.clone().$set(zt,ii)},Mt.get=function(zt){return this[gt.p(zt)]()},Mt.add=function(zt,ii){var Yt,jt=this;zt=Number(zt);var Ri=gt.p(ii),Yi=function(Wr){var an=Te(jt);return gt.w(an.date(an.date()+Math.round(Wr*zt)),jt)};if(Ri===he)return this.set(he,this.$M+zt);if(Ri===Ae)return this.set(Ae,this.$y+zt);if(Ri===ie)return Yi(1);if(Ri===ae)return Yi(7);var Wi=(Yt={},Yt[r]=c,Yt[q]=_,Yt[N]=l,Yt)[Ri]||1,vi=this.$d.getTime()+zt*Wi;return gt.w(vi,this)},Mt.subtract=function(zt,ii){return this.add(-1*zt,ii)},Mt.format=function(zt){var ii=this,Yt=this.$locale();if(!this.isValid())return Yt.invalidDate||Pe;var jt=zt||"YYYY-MM-DDTHH:mm:ssZ",Ri=gt.z(this),Yi=this.$H,Wi=this.$m,vi=this.$M,Wr=Yt.weekdays,an=Yt.months,_n=Yt.meridiem,Cn=function(Ye,ds,Bi,Xs){return Ye&&(Ye[ds]||Ye(ii,jt))||Bi[ds].slice(0,Xs)},qr=function(Ye){return gt.s(Yi%12||12,Ye,"0")},es=_n||function(Ye,ds,Bi){var Xs=Ye<12?"AM":"PM";return Bi?Xs.toLowerCase():Xs};return jt.replace(We,function(Ye,ds){return ds||function(Bi){switch(Bi){case"YY":return String(ii.$y).slice(-2);case"YYYY":return gt.s(ii.$y,4,"0");case"M":return vi+1;case"MM":return gt.s(vi+1,2,"0");case"MMM":return Cn(Yt.monthsShort,vi,an,3);case"MMMM":return Cn(an,vi);case"D":return ii.$D;case"DD":return gt.s(ii.$D,2,"0");case"d":return String(ii.$W);case"dd":return Cn(Yt.weekdaysMin,ii.$W,Wr,2);case"ddd":return Cn(Yt.weekdaysShort,ii.$W,Wr,3);case"dddd":return Wr[ii.$W];case"H":return String(Yi);case"HH":return gt.s(Yi,2,"0");case"h":return qr(1);case"hh":return qr(2);case"a":return es(Yi,Wi,!0);case"A":return es(Yi,Wi,!1);case"m":return String(Wi);case"mm":return gt.s(Wi,2,"0");case"s":return String(ii.$s);case"ss":return gt.s(ii.$s,2,"0");case"SSS":return gt.s(ii.$ms,3,"0");case"Z":return Ri}return null}(Ye)||Ri.replace(":","")})},Mt.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},Mt.diff=function(zt,ii,Yt){var jt,Ri=this,Yi=gt.p(ii),Wi=Te(zt),vi=(Wi.utcOffset()-this.utcOffset())*c,Wr=this-Wi,an=function(){return gt.m(Ri,Wi)};switch(Yi){case Ae:jt=an()/12;break;case he:jt=an();break;case ve:jt=an()/3;break;case ae:jt=(Wr-vi)/6048e5;break;case ie:jt=(Wr-vi)/864e5;break;case q:jt=Wr/_;break;case r:jt=Wr/c;break;case N:jt=Wr/l;break;default:jt=Wr}return Yt?jt:gt.a(jt)},Mt.daysInMonth=function(){return this.endOf(he).$D},Mt.$locale=function(){return Rt[this.$L]},Mt.locale=function(zt,ii){if(!zt)return this.$L;var Yt=this.clone(),jt=qt(zt,ii,!0);return jt&&(Yt.$L=jt),Yt},Mt.clone=function(){return gt.w(this.$d,this)},Mt.toDate=function(){return new Date(this.valueOf())},Mt.toJSON=function(){return this.isValid()?this.toISOString():null},Mt.toISOString=function(){return this.$d.toISOString()},Mt.toString=function(){return this.$d.toUTCString()},ni}(),Ti=oi.prototype;return Te.prototype=Ti,[["$ms",A],["$s",N],["$m",r],["$H",q],["$W",ie],["$M",he],["$y",Ae],["$D",we]].forEach(function(ni){Ti[ni[1]]=function(Mt){return this.$g(Mt,ni[0],ni[1])}}),Te.extend=function(ni,Mt){return ni.$i||(ni(Mt,oi,Te),ni.$i=!0),Te},Te.locale=qt,Te.isDayjs=Tt,Te.unix=function(ni){return Te(1e3*ni)},Te.en=Rt[at],Te.Ls=Rt,Te.p={},Te})}(Oy)),Oy.exports}var t3=e3();const tf=t_(t3),i3=({fleetData:m,onFilterChange:g})=>{const l=tf().year(),c=tf().subtract(1,"day").toDate(),_=tf(`${l}-01-01`).toDate(),[A,N]=Ke.useState(_),[r,q]=Ke.useState(c),[ie,ae]=Ke.useState(null),[he,ve]=Ke.useState([]),[Ae,we]=Ke.useState([]),[Pe,Ve]=Ke.useState([]),We=()=>A&&r?tf(r).diff(tf(A),"day")+1:0;return Ke.useEffect(()=>{const rt=Array.from(new Set(m.map(tt=>tt.vesselType))).map(tt=>({value:tt,label:tt}));we(rt);const ht=m.map(tt=>({value:tt.name,label:tt.name}));Ve(ht)},[m]),Ke.useEffect(()=>{if(A&&r){const rt=tf(A).format("DD-MMM-YYYY"),ht=tf(r).format("DD-MMM-YYYY");g({startDate:rt,endDate:ht,vesselType:(ie==null?void 0:ie.value)||"",vesselNames:he.map(tt=>tt.value)})}},[A,r,ie,he]),gi.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 p-4",children:[gi.jsxs("div",{className:"grid flex-wrap items-center gap-2",children:[gi.jsxs("div",{className:"grid",children:[gi.jsx("label",{className:"text-sm font-bold text-body mb-1",children:"Start Date:"}),gi.jsx(oT,{selected:A,onChange:rt=>N(rt),dateFormat:"dd-MMM-yyyy",className:"min-h-[38px] border border-borderColor rounded px-2 py-1 w-[190px] text-sm focus:outline-none"})]}),gi.jsxs("div",{className:"grid",children:[gi.jsx("label",{className:"text-sm font-bold text-body mb-1",children:"End Date:"}),gi.jsx(oT,{selected:r,onChange:rt=>q(rt),dateFormat:"dd-MMM-yyyy",className:"min-h-[38px] border border-borderColor rounded px-2 py-1 w-[190px] text-sm focus:outline-none"})]}),gi.jsxs("span",{className:"text-sm",children:[We()," days"]})]}),gi.jsxs("div",{className:"grid items-center gap-2",children:[gi.jsx("label",{className:"text-sm font-bold text-body",children:"Filter:"}),gi.jsx(CS,{options:Ae,value:ie,onChange:rt=>ae(rt),placeholder:"Vessel Type",className:"w-[190px] text-sm",isClearable:!0}),gi.jsx(CS,{options:Pe,value:he,onChange:rt=>ve(rt),placeholder:"Vessel Name",isMulti:!0,className:"w-[190px] text-sm"})]})]})},r3={A:"bg-green-600 text-white",B:"bg-green-400 text-black",C:"bg-yellow-400 text-black",E:"bg-red-600 text-white"},n3=({status:m})=>gi.jsx("span",{className:`w-6 h-6 flex items-center justify-center rounded-full text-xs font-bold ${r3[m]}`,children:m});var Ly={exports:{}},s3=Ly.exports,lT;function o3(){return lT||(lT=1,function(m,g){(function(l,c){m.exports=c()})(s3,function(){var l,c,_;function A(r,q){if(!l)l=q;else if(!c)c=q;else{var ie="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",ae={};l(ae),_=q(ae),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(_.workerUrl=window.URL.createObjectURL(new Blob([ie],{type:"text/javascript"})))}}A(["exports"],function(r){function q(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var ie,ae={},he={};function ve(){if(ie)return he;ie=1,Object.defineProperty(he,"__esModule",{value:!0}),he.setMatrixArrayType=function(p){he.ARRAY_TYPE=e=p},he.toRadian=function(p){return p*o},he.equals=function(p,a){return Math.abs(p-a)<=s*Math.max(1,Math.abs(p),Math.abs(a))},he.RANDOM=he.ARRAY_TYPE=he.EPSILON=void 0;var s=1e-6;he.EPSILON=s;var e=typeof Float32Array<"u"?Float32Array:Array;he.ARRAY_TYPE=e;var i=Math.random;he.RANDOM=i;var o=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var p=0,a=arguments.length;a--;)p+=arguments[a]*arguments[a];return Math.sqrt(p)}),he}var Ae,we={};function Pe(){if(Ae)return we;function s(a){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},s(a)}Ae=1,Object.defineProperty(we,"__esModule",{value:!0}),we.create=function(){var a=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},we.clone=function(a){var f=new e.ARRAY_TYPE(4);return f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],f},we.copy=function(a,f){return a[0]=f[0],a[1]=f[1],a[2]=f[2],a[3]=f[3],a},we.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},we.fromValues=function(a,f,w,E){var O=new e.ARRAY_TYPE(4);return O[0]=a,O[1]=f,O[2]=w,O[3]=E,O},we.set=function(a,f,w,E,O){return a[0]=f,a[1]=w,a[2]=E,a[3]=O,a},we.transpose=function(a,f){if(a===f){var w=f[1];a[1]=f[2],a[2]=w}else a[0]=f[0],a[1]=f[2],a[2]=f[1],a[3]=f[3];return a},we.invert=function(a,f){var w=f[0],E=f[1],O=f[2],x=f[3],C=w*x-O*E;return C?(a[0]=x*(C=1/C),a[1]=-E*C,a[2]=-O*C,a[3]=w*C,a):null},we.adjoint=function(a,f){var w=f[0];return a[0]=f[3],a[1]=-f[1],a[2]=-f[2],a[3]=w,a},we.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},we.multiply=o,we.rotate=function(a,f,w){var E=f[0],O=f[1],x=f[2],C=f[3],k=Math.sin(w),M=Math.cos(w);return a[0]=E*M+x*k,a[1]=O*M+C*k,a[2]=E*-k+x*M,a[3]=O*-k+C*M,a},we.scale=function(a,f,w){var E=f[1],O=f[2],x=f[3],C=w[0],k=w[1];return a[0]=f[0]*C,a[1]=E*C,a[2]=O*k,a[3]=x*k,a},we.fromRotation=function(a,f){var w=Math.sin(f),E=Math.cos(f);return a[0]=E,a[1]=w,a[2]=-w,a[3]=E,a},we.fromScaling=function(a,f){return a[0]=f[0],a[1]=0,a[2]=0,a[3]=f[1],a},we.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},we.frob=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},we.LDU=function(a,f,w,E){return a[2]=E[2]/E[0],w[0]=E[0],w[1]=E[1],w[3]=E[3]-a[2]*w[1],[a,f,w]},we.add=function(a,f,w){return a[0]=f[0]+w[0],a[1]=f[1]+w[1],a[2]=f[2]+w[2],a[3]=f[3]+w[3],a},we.subtract=p,we.exactEquals=function(a,f){return a[0]===f[0]&&a[1]===f[1]&&a[2]===f[2]&&a[3]===f[3]},we.equals=function(a,f){var w=a[0],E=a[1],O=a[2],x=a[3],C=f[0],k=f[1],M=f[2],P=f[3];return Math.abs(w-C)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(C))&&Math.abs(E-k)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(k))&&Math.abs(O-M)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(M))&&Math.abs(x-P)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(P))},we.multiplyScalar=function(a,f,w){return a[0]=f[0]*w,a[1]=f[1]*w,a[2]=f[2]*w,a[3]=f[3]*w,a},we.multiplyScalarAndAdd=function(a,f,w,E){return a[0]=f[0]+w[0]*E,a[1]=f[1]+w[1]*E,a[2]=f[2]+w[2]*E,a[3]=f[3]+w[3]*E,a},we.sub=we.mul=void 0;var e=function(a,f){if(a&&a.__esModule)return a;if(a===null||s(a)!=="object"&&typeof a!="function")return{default:a};var w=i(void 0);if(w&&w.has(a))return w.get(a);var E={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in a)if(x!=="default"&&Object.prototype.hasOwnProperty.call(a,x)){var C=O?Object.getOwnPropertyDescriptor(a,x):null;C&&(C.get||C.set)?Object.defineProperty(E,x,C):E[x]=a[x]}return E.default=a,w&&w.set(a,E),E}(ve());function i(a){if(typeof WeakMap!="function")return null;var f=new WeakMap,w=new WeakMap;return(i=function(E){return E?w:f})(a)}function o(a,f,w){var E=f[0],O=f[1],x=f[2],C=f[3],k=w[0],M=w[1],P=w[2],R=w[3];return a[0]=E*k+x*M,a[1]=O*k+C*M,a[2]=E*P+x*R,a[3]=O*P+C*R,a}function p(a,f,w){return a[0]=f[0]-w[0],a[1]=f[1]-w[1],a[2]=f[2]-w[2],a[3]=f[3]-w[3],a}return we.mul=o,we.sub=p,we}var Ve,We={};function rt(){if(Ve)return We;function s(a){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},s(a)}Ve=1,Object.defineProperty(We,"__esModule",{value:!0}),We.create=function(){var a=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[4]=0,a[5]=0),a[0]=1,a[3]=1,a},We.clone=function(a){var f=new e.ARRAY_TYPE(6);return f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],f[4]=a[4],f[5]=a[5],f},We.copy=function(a,f){return a[0]=f[0],a[1]=f[1],a[2]=f[2],a[3]=f[3],a[4]=f[4],a[5]=f[5],a},We.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},We.fromValues=function(a,f,w,E,O,x){var C=new e.ARRAY_TYPE(6);return C[0]=a,C[1]=f,C[2]=w,C[3]=E,C[4]=O,C[5]=x,C},We.set=function(a,f,w,E,O,x,C){return a[0]=f,a[1]=w,a[2]=E,a[3]=O,a[4]=x,a[5]=C,a},We.invert=function(a,f){var w=f[0],E=f[1],O=f[2],x=f[3],C=f[4],k=f[5],M=w*x-E*O;return M?(a[0]=x*(M=1/M),a[1]=-E*M,a[2]=-O*M,a[3]=w*M,a[4]=(O*k-x*C)*M,a[5]=(E*C-w*k)*M,a):null},We.determinant=function(a){return a[0]*a[3]-a[1]*a[2]},We.multiply=o,We.rotate=function(a,f,w){var E=f[0],O=f[1],x=f[2],C=f[3],k=f[4],M=f[5],P=Math.sin(w),R=Math.cos(w);return a[0]=E*R+x*P,a[1]=O*R+C*P,a[2]=E*-P+x*R,a[3]=O*-P+C*R,a[4]=k,a[5]=M,a},We.scale=function(a,f,w){var E=f[1],O=f[2],x=f[3],C=f[4],k=f[5],M=w[0],P=w[1];return a[0]=f[0]*M,a[1]=E*M,a[2]=O*P,a[3]=x*P,a[4]=C,a[5]=k,a},We.translate=function(a,f,w){var E=f[0],O=f[1],x=f[2],C=f[3],k=f[4],M=f[5],P=w[0],R=w[1];return a[0]=E,a[1]=O,a[2]=x,a[3]=C,a[4]=E*P+x*R+k,a[5]=O*P+C*R+M,a},We.fromRotation=function(a,f){var w=Math.sin(f),E=Math.cos(f);return a[0]=E,a[1]=w,a[2]=-w,a[3]=E,a[4]=0,a[5]=0,a},We.fromScaling=function(a,f){return a[0]=f[0],a[1]=0,a[2]=0,a[3]=f[1],a[4]=0,a[5]=0,a},We.fromTranslation=function(a,f){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=f[0],a[5]=f[1],a},We.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},We.frob=function(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],1)},We.add=function(a,f,w){return a[0]=f[0]+w[0],a[1]=f[1]+w[1],a[2]=f[2]+w[2],a[3]=f[3]+w[3],a[4]=f[4]+w[4],a[5]=f[5]+w[5],a},We.subtract=p,We.multiplyScalar=function(a,f,w){return a[0]=f[0]*w,a[1]=f[1]*w,a[2]=f[2]*w,a[3]=f[3]*w,a[4]=f[4]*w,a[5]=f[5]*w,a},We.multiplyScalarAndAdd=function(a,f,w,E){return a[0]=f[0]+w[0]*E,a[1]=f[1]+w[1]*E,a[2]=f[2]+w[2]*E,a[3]=f[3]+w[3]*E,a[4]=f[4]+w[4]*E,a[5]=f[5]+w[5]*E,a},We.exactEquals=function(a,f){return a[0]===f[0]&&a[1]===f[1]&&a[2]===f[2]&&a[3]===f[3]&&a[4]===f[4]&&a[5]===f[5]},We.equals=function(a,f){var w=a[0],E=a[1],O=a[2],x=a[3],C=a[4],k=a[5],M=f[0],P=f[1],R=f[2],$=f[3],G=f[4],J=f[5];return Math.abs(w-M)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(M))&&Math.abs(E-P)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(P))&&Math.abs(O-R)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(R))&&Math.abs(x-$)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs($))&&Math.abs(C-G)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(G))&&Math.abs(k-J)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(J))},We.sub=We.mul=void 0;var e=function(a,f){if(a&&a.__esModule)return a;if(a===null||s(a)!=="object"&&typeof a!="function")return{default:a};var w=i(void 0);if(w&&w.has(a))return w.get(a);var E={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in a)if(x!=="default"&&Object.prototype.hasOwnProperty.call(a,x)){var C=O?Object.getOwnPropertyDescriptor(a,x):null;C&&(C.get||C.set)?Object.defineProperty(E,x,C):E[x]=a[x]}return E.default=a,w&&w.set(a,E),E}(ve());function i(a){if(typeof WeakMap!="function")return null;var f=new WeakMap,w=new WeakMap;return(i=function(E){return E?w:f})(a)}function o(a,f,w){var E=f[0],O=f[1],x=f[2],C=f[3],k=f[4],M=f[5],P=w[0],R=w[1],$=w[2],G=w[3],J=w[4],ee=w[5];return a[0]=E*P+x*R,a[1]=O*P+C*R,a[2]=E*$+x*G,a[3]=O*$+C*G,a[4]=E*J+x*ee+k,a[5]=O*J+C*ee+M,a}function p(a,f,w){return a[0]=f[0]-w[0],a[1]=f[1]-w[1],a[2]=f[2]-w[2],a[3]=f[3]-w[3],a[4]=f[4]-w[4],a[5]=f[5]-w[5],a}return We.mul=o,We.sub=p,We}var ht,tt={};function at(){if(ht)return tt;function s(a){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},s(a)}ht=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.create=function(){var a=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},tt.fromMat4=function(a,f){return a[0]=f[0],a[1]=f[1],a[2]=f[2],a[3]=f[4],a[4]=f[5],a[5]=f[6],a[6]=f[8],a[7]=f[9],a[8]=f[10],a},tt.clone=function(a){var f=new e.ARRAY_TYPE(9);return f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],f[4]=a[4],f[5]=a[5],f[6]=a[6],f[7]=a[7],f[8]=a[8],f},tt.copy=function(a,f){return a[0]=f[0],a[1]=f[1],a[2]=f[2],a[3]=f[3],a[4]=f[4],a[5]=f[5],a[6]=f[6],a[7]=f[7],a[8]=f[8],a},tt.fromValues=function(a,f,w,E,O,x,C,k,M){var P=new e.ARRAY_TYPE(9);return P[0]=a,P[1]=f,P[2]=w,P[3]=E,P[4]=O,P[5]=x,P[6]=C,P[7]=k,P[8]=M,P},tt.set=function(a,f,w,E,O,x,C,k,M,P){return a[0]=f,a[1]=w,a[2]=E,a[3]=O,a[4]=x,a[5]=C,a[6]=k,a[7]=M,a[8]=P,a},tt.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},tt.transpose=function(a,f){if(a===f){var w=f[1],E=f[2],O=f[5];a[1]=f[3],a[2]=f[6],a[3]=w,a[5]=f[7],a[6]=E,a[7]=O}else a[0]=f[0],a[1]=f[3],a[2]=f[6],a[3]=f[1],a[4]=f[4],a[5]=f[7],a[6]=f[2],a[7]=f[5],a[8]=f[8];return a},tt.invert=function(a,f){var w=f[0],E=f[1],O=f[2],x=f[3],C=f[4],k=f[5],M=f[6],P=f[7],R=f[8],$=R*C-k*P,G=-R*x+k*M,J=P*x-C*M,ee=w*$+E*G+O*J;return ee?(a[0]=$*(ee=1/ee),a[1]=(-R*E+O*P)*ee,a[2]=(k*E-O*C)*ee,a[3]=G*ee,a[4]=(R*w-O*M)*ee,a[5]=(-k*w+O*x)*ee,a[6]=J*ee,a[7]=(-P*w+E*M)*ee,a[8]=(C*w-E*x)*ee,a):null},tt.adjoint=function(a,f){var w=f[0],E=f[1],O=f[2],x=f[3],C=f[4],k=f[5],M=f[6],P=f[7],R=f[8];return a[0]=C*R-k*P,a[1]=O*P-E*R,a[2]=E*k-O*C,a[3]=k*M-x*R,a[4]=w*R-O*M,a[5]=O*x-w*k,a[6]=x*P-C*M,a[7]=E*M-w*P,a[8]=w*C-E*x,a},tt.determinant=function(a){var f=a[3],w=a[4],E=a[5],O=a[6],x=a[7],C=a[8];return a[0]*(C*w-E*x)+a[1]*(-C*f+E*O)+a[2]*(x*f-w*O)},tt.multiply=o,tt.translate=function(a,f,w){var E=f[0],O=f[1],x=f[2],C=f[3],k=f[4],M=f[5],P=f[6],R=f[7],$=f[8],G=w[0],J=w[1];return a[0]=E,a[1]=O,a[2]=x,a[3]=C,a[4]=k,a[5]=M,a[6]=G*E+J*C+P,a[7]=G*O+J*k+R,a[8]=G*x+J*M+$,a},tt.rotate=function(a,f,w){var E=f[0],O=f[1],x=f[2],C=f[3],k=f[4],M=f[5],P=f[6],R=f[7],$=f[8],G=Math.sin(w),J=Math.cos(w);return a[0]=J*E+G*C,a[1]=J*O+G*k,a[2]=J*x+G*M,a[3]=J*C-G*E,a[4]=J*k-G*O,a[5]=J*M-G*x,a[6]=P,a[7]=R,a[8]=$,a},tt.scale=function(a,f,w){var E=w[0],O=w[1];return a[0]=E*f[0],a[1]=E*f[1],a[2]=E*f[2],a[3]=O*f[3],a[4]=O*f[4],a[5]=O*f[5],a[6]=f[6],a[7]=f[7],a[8]=f[8],a},tt.fromTranslation=function(a,f){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=f[0],a[7]=f[1],a[8]=1,a},tt.fromRotation=function(a,f){var w=Math.sin(f),E=Math.cos(f);return a[0]=E,a[1]=w,a[2]=0,a[3]=-w,a[4]=E,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},tt.fromScaling=function(a,f){return a[0]=f[0],a[1]=0,a[2]=0,a[3]=0,a[4]=f[1],a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},tt.fromMat2d=function(a,f){return a[0]=f[0],a[1]=f[1],a[2]=0,a[3]=f[2],a[4]=f[3],a[5]=0,a[6]=f[4],a[7]=f[5],a[8]=1,a},tt.fromQuat=function(a,f){var w=f[0],E=f[1],O=f[2],x=f[3],C=w+w,k=E+E,M=O+O,P=w*C,R=E*C,$=E*k,G=O*C,J=O*k,ee=O*M,Z=x*C,ne=x*k,le=x*M;return a[0]=1-$-ee,a[3]=R-le,a[6]=G+ne,a[1]=R+le,a[4]=1-P-ee,a[7]=J-Z,a[2]=G-ne,a[5]=J+Z,a[8]=1-P-$,a},tt.normalFromMat4=function(a,f){var w=f[0],E=f[1],O=f[2],x=f[3],C=f[4],k=f[5],M=f[6],P=f[7],R=f[8],$=f[9],G=f[10],J=f[11],ee=f[12],Z=f[13],ne=f[14],le=f[15],fe=w*k-E*C,Ce=w*M-O*C,Ee=w*P-x*C,Me=E*M-O*k,$e=E*P-x*k,De=O*P-x*M,Ge=R*Z-$*ee,Xe=R*ne-G*ee,qe=R*le-J*ee,et=$*ne-G*Z,nt=$*le-J*Z,ct=G*le-J*ne,it=fe*ct-Ce*nt+Ee*et+Me*qe-$e*Xe+De*Ge;return it?(a[0]=(k*ct-M*nt+P*et)*(it=1/it),a[1]=(M*qe-C*ct-P*Xe)*it,a[2]=(C*nt-k*qe+P*Ge)*it,a[3]=(O*nt-E*ct-x*et)*it,a[4]=(w*ct-O*qe+x*Xe)*it,a[5]=(E*qe-w*nt-x*Ge)*it,a[6]=(Z*De-ne*$e+le*Me)*it,a[7]=(ne*Ee-ee*De-le*Ce)*it,a[8]=(ee*$e-Z*Ee+le*fe)*it,a):null},tt.projection=function(a,f,w){return a[0]=2/f,a[1]=0,a[2]=0,a[3]=0,a[4]=-2/w,a[5]=0,a[6]=-1,a[7]=1,a[8]=1,a},tt.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},tt.frob=function(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},tt.add=function(a,f,w){return a[0]=f[0]+w[0],a[1]=f[1]+w[1],a[2]=f[2]+w[2],a[3]=f[3]+w[3],a[4]=f[4]+w[4],a[5]=f[5]+w[5],a[6]=f[6]+w[6],a[7]=f[7]+w[7],a[8]=f[8]+w[8],a},tt.subtract=p,tt.multiplyScalar=function(a,f,w){return a[0]=f[0]*w,a[1]=f[1]*w,a[2]=f[2]*w,a[3]=f[3]*w,a[4]=f[4]*w,a[5]=f[5]*w,a[6]=f[6]*w,a[7]=f[7]*w,a[8]=f[8]*w,a},tt.multiplyScalarAndAdd=function(a,f,w,E){return a[0]=f[0]+w[0]*E,a[1]=f[1]+w[1]*E,a[2]=f[2]+w[2]*E,a[3]=f[3]+w[3]*E,a[4]=f[4]+w[4]*E,a[5]=f[5]+w[5]*E,a[6]=f[6]+w[6]*E,a[7]=f[7]+w[7]*E,a[8]=f[8]+w[8]*E,a},tt.exactEquals=function(a,f){return a[0]===f[0]&&a[1]===f[1]&&a[2]===f[2]&&a[3]===f[3]&&a[4]===f[4]&&a[5]===f[5]&&a[6]===f[6]&&a[7]===f[7]&&a[8]===f[8]},tt.equals=function(a,f){var w=a[0],E=a[1],O=a[2],x=a[3],C=a[4],k=a[5],M=a[6],P=a[7],R=a[8],$=f[0],G=f[1],J=f[2],ee=f[3],Z=f[4],ne=f[5],le=f[6],fe=f[7],Ce=f[8];return Math.abs(w-$)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs($))&&Math.abs(E-G)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(G))&&Math.abs(O-J)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(J))&&Math.abs(x-ee)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(ee))&&Math.abs(C-Z)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(Z))&&Math.abs(k-ne)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(ne))&&Math.abs(M-le)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(le))&&Math.abs(P-fe)<=e.EPSILON*Math.max(1,Math.abs(P),Math.abs(fe))&&Math.abs(R-Ce)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(Ce))},tt.sub=tt.mul=void 0;var e=function(a,f){if(a&&a.__esModule)return a;if(a===null||s(a)!=="object"&&typeof a!="function")return{default:a};var w=i(void 0);if(w&&w.has(a))return w.get(a);var E={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in a)if(x!=="default"&&Object.prototype.hasOwnProperty.call(a,x)){var C=O?Object.getOwnPropertyDescriptor(a,x):null;C&&(C.get||C.set)?Object.defineProperty(E,x,C):E[x]=a[x]}return E.default=a,w&&w.set(a,E),E}(ve());function i(a){if(typeof WeakMap!="function")return null;var f=new WeakMap,w=new WeakMap;return(i=function(E){return E?w:f})(a)}function o(a,f,w){var E=f[0],O=f[1],x=f[2],C=f[3],k=f[4],M=f[5],P=f[6],R=f[7],$=f[8],G=w[0],J=w[1],ee=w[2],Z=w[3],ne=w[4],le=w[5],fe=w[6],Ce=w[7],Ee=w[8];return a[0]=G*E+J*C+ee*P,a[1]=G*O+J*k+ee*R,a[2]=G*x+J*M+ee*$,a[3]=Z*E+ne*C+le*P,a[4]=Z*O+ne*k+le*R,a[5]=Z*x+ne*M+le*$,a[6]=fe*E+Ce*C+Ee*P,a[7]=fe*O+Ce*k+Ee*R,a[8]=fe*x+Ce*M+Ee*$,a}function p(a,f,w){return a[0]=f[0]-w[0],a[1]=f[1]-w[1],a[2]=f[2]-w[2],a[3]=f[3]-w[3],a[4]=f[4]-w[4],a[5]=f[5]-w[5],a[6]=f[6]-w[6],a[7]=f[7]-w[7],a[8]=f[8]-w[8],a}return tt.mul=o,tt.sub=p,tt}var Rt,Ne={};function Tt(){if(Rt)return Ne;function s(x){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},s(x)}Rt=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.create=function(){var x=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=0,x[12]=0,x[13]=0,x[14]=0),x[0]=1,x[5]=1,x[10]=1,x[15]=1,x},Ne.clone=function(x){var C=new e.ARRAY_TYPE(16);return C[0]=x[0],C[1]=x[1],C[2]=x[2],C[3]=x[3],C[4]=x[4],C[5]=x[5],C[6]=x[6],C[7]=x[7],C[8]=x[8],C[9]=x[9],C[10]=x[10],C[11]=x[11],C[12]=x[12],C[13]=x[13],C[14]=x[14],C[15]=x[15],C},Ne.copy=function(x,C){return x[0]=C[0],x[1]=C[1],x[2]=C[2],x[3]=C[3],x[4]=C[4],x[5]=C[5],x[6]=C[6],x[7]=C[7],x[8]=C[8],x[9]=C[9],x[10]=C[10],x[11]=C[11],x[12]=C[12],x[13]=C[13],x[14]=C[14],x[15]=C[15],x},Ne.fromValues=function(x,C,k,M,P,R,$,G,J,ee,Z,ne,le,fe,Ce,Ee){var Me=new e.ARRAY_TYPE(16);return Me[0]=x,Me[1]=C,Me[2]=k,Me[3]=M,Me[4]=P,Me[5]=R,Me[6]=$,Me[7]=G,Me[8]=J,Me[9]=ee,Me[10]=Z,Me[11]=ne,Me[12]=le,Me[13]=fe,Me[14]=Ce,Me[15]=Ee,Me},Ne.set=function(x,C,k,M,P,R,$,G,J,ee,Z,ne,le,fe,Ce,Ee,Me){return x[0]=C,x[1]=k,x[2]=M,x[3]=P,x[4]=R,x[5]=$,x[6]=G,x[7]=J,x[8]=ee,x[9]=Z,x[10]=ne,x[11]=le,x[12]=fe,x[13]=Ce,x[14]=Ee,x[15]=Me,x},Ne.identity=o,Ne.transpose=function(x,C){if(x===C){var k=C[1],M=C[2],P=C[3],R=C[6],$=C[7],G=C[11];x[1]=C[4],x[2]=C[8],x[3]=C[12],x[4]=k,x[6]=C[9],x[7]=C[13],x[8]=M,x[9]=R,x[11]=C[14],x[12]=P,x[13]=$,x[14]=G}else x[0]=C[0],x[1]=C[4],x[2]=C[8],x[3]=C[12],x[4]=C[1],x[5]=C[5],x[6]=C[9],x[7]=C[13],x[8]=C[2],x[9]=C[6],x[10]=C[10],x[11]=C[14],x[12]=C[3],x[13]=C[7],x[14]=C[11],x[15]=C[15];return x},Ne.invert=function(x,C){var k=C[0],M=C[1],P=C[2],R=C[3],$=C[4],G=C[5],J=C[6],ee=C[7],Z=C[8],ne=C[9],le=C[10],fe=C[11],Ce=C[12],Ee=C[13],Me=C[14],$e=C[15],De=k*G-M*$,Ge=k*J-P*$,Xe=k*ee-R*$,qe=M*J-P*G,et=M*ee-R*G,nt=P*ee-R*J,ct=Z*Ee-ne*Ce,it=Z*Me-le*Ce,Ct=Z*$e-fe*Ce,Nt=ne*Me-le*Ee,Et=ne*$e-fe*Ee,si=le*$e-fe*Me,ti=De*si-Ge*Et+Xe*Nt+qe*Ct-et*it+nt*ct;return ti?(x[0]=(G*si-J*Et+ee*Nt)*(ti=1/ti),x[1]=(P*Et-M*si-R*Nt)*ti,x[2]=(Ee*nt-Me*et+$e*qe)*ti,x[3]=(le*et-ne*nt-fe*qe)*ti,x[4]=(J*Ct-$*si-ee*it)*ti,x[5]=(k*si-P*Ct+R*it)*ti,x[6]=(Me*Xe-Ce*nt-$e*Ge)*ti,x[7]=(Z*nt-le*Xe+fe*Ge)*ti,x[8]=($*Et-G*Ct+ee*ct)*ti,x[9]=(M*Ct-k*Et-R*ct)*ti,x[10]=(Ce*et-Ee*Xe+$e*De)*ti,x[11]=(ne*Xe-Z*et-fe*De)*ti,x[12]=(G*it-$*Nt-J*ct)*ti,x[13]=(k*Nt-M*it+P*ct)*ti,x[14]=(Ee*Ge-Ce*qe-Me*De)*ti,x[15]=(Z*qe-ne*Ge+le*De)*ti,x):null},Ne.adjoint=function(x,C){var k=C[0],M=C[1],P=C[2],R=C[3],$=C[4],G=C[5],J=C[6],ee=C[7],Z=C[8],ne=C[9],le=C[10],fe=C[11],Ce=C[12],Ee=C[13],Me=C[14],$e=C[15];return x[0]=G*(le*$e-fe*Me)-ne*(J*$e-ee*Me)+Ee*(J*fe-ee*le),x[1]=-(M*(le*$e-fe*Me)-ne*(P*$e-R*Me)+Ee*(P*fe-R*le)),x[2]=M*(J*$e-ee*Me)-G*(P*$e-R*Me)+Ee*(P*ee-R*J),x[3]=-(M*(J*fe-ee*le)-G*(P*fe-R*le)+ne*(P*ee-R*J)),x[4]=-($*(le*$e-fe*Me)-Z*(J*$e-ee*Me)+Ce*(J*fe-ee*le)),x[5]=k*(le*$e-fe*Me)-Z*(P*$e-R*Me)+Ce*(P*fe-R*le),x[6]=-(k*(J*$e-ee*Me)-$*(P*$e-R*Me)+Ce*(P*ee-R*J)),x[7]=k*(J*fe-ee*le)-$*(P*fe-R*le)+Z*(P*ee-R*J),x[8]=$*(ne*$e-fe*Ee)-Z*(G*$e-ee*Ee)+Ce*(G*fe-ee*ne),x[9]=-(k*(ne*$e-fe*Ee)-Z*(M*$e-R*Ee)+Ce*(M*fe-R*ne)),x[10]=k*(G*$e-ee*Ee)-$*(M*$e-R*Ee)+Ce*(M*ee-R*G),x[11]=-(k*(G*fe-ee*ne)-$*(M*fe-R*ne)+Z*(M*ee-R*G)),x[12]=-($*(ne*Me-le*Ee)-Z*(G*Me-J*Ee)+Ce*(G*le-J*ne)),x[13]=k*(ne*Me-le*Ee)-Z*(M*Me-P*Ee)+Ce*(M*le-P*ne),x[14]=-(k*(G*Me-J*Ee)-$*(M*Me-P*Ee)+Ce*(M*J-P*G)),x[15]=k*(G*le-J*ne)-$*(M*le-P*ne)+Z*(M*J-P*G),x},Ne.determinant=function(x){var C=x[0],k=x[1],M=x[2],P=x[3],R=x[4],$=x[5],G=x[6],J=x[7],ee=x[8],Z=x[9],ne=x[10],le=x[11],fe=x[12],Ce=x[13],Ee=x[14],Me=x[15];return(C*$-k*R)*(ne*Me-le*Ee)-(C*G-M*R)*(Z*Me-le*Ce)+(C*J-P*R)*(Z*Ee-ne*Ce)+(k*G-M*$)*(ee*Me-le*fe)-(k*J-P*$)*(ee*Ee-ne*fe)+(M*J-P*G)*(ee*Ce-Z*fe)},Ne.multiply=p,Ne.translate=function(x,C,k){var M,P,R,$,G,J,ee,Z,ne,le,fe,Ce,Ee=k[0],Me=k[1],$e=k[2];return C===x?(x[12]=C[0]*Ee+C[4]*Me+C[8]*$e+C[12],x[13]=C[1]*Ee+C[5]*Me+C[9]*$e+C[13],x[14]=C[2]*Ee+C[6]*Me+C[10]*$e+C[14],x[15]=C[3]*Ee+C[7]*Me+C[11]*$e+C[15]):(P=C[1],R=C[2],$=C[3],G=C[4],J=C[5],ee=C[6],Z=C[7],ne=C[8],le=C[9],fe=C[10],Ce=C[11],x[0]=M=C[0],x[1]=P,x[2]=R,x[3]=$,x[4]=G,x[5]=J,x[6]=ee,x[7]=Z,x[8]=ne,x[9]=le,x[10]=fe,x[11]=Ce,x[12]=M*Ee+G*Me+ne*$e+C[12],x[13]=P*Ee+J*Me+le*$e+C[13],x[14]=R*Ee+ee*Me+fe*$e+C[14],x[15]=$*Ee+Z*Me+Ce*$e+C[15]),x},Ne.scale=function(x,C,k){var M=k[0],P=k[1],R=k[2];return x[0]=C[0]*M,x[1]=C[1]*M,x[2]=C[2]*M,x[3]=C[3]*M,x[4]=C[4]*P,x[5]=C[5]*P,x[6]=C[6]*P,x[7]=C[7]*P,x[8]=C[8]*R,x[9]=C[9]*R,x[10]=C[10]*R,x[11]=C[11]*R,x[12]=C[12],x[13]=C[13],x[14]=C[14],x[15]=C[15],x},Ne.rotate=function(x,C,k,M){var P,R,$,G,J,ee,Z,ne,le,fe,Ce,Ee,Me,$e,De,Ge,Xe,qe,et,nt,ct,it,Ct,Nt,Et=M[0],si=M[1],ti=M[2],Gt=Math.hypot(Et,si,ti);return Gt<e.EPSILON?null:(Et*=Gt=1/Gt,si*=Gt,ti*=Gt,P=Math.sin(k),R=Math.cos(k),J=C[1],ee=C[2],Z=C[3],le=C[5],fe=C[6],Ce=C[7],Me=C[9],$e=C[10],De=C[11],Ge=Et*Et*($=1-R)+R,et=Et*si*$-ti*P,nt=si*si*$+R,ct=ti*si*$+Et*P,it=Et*ti*$+si*P,Ct=si*ti*$-Et*P,Nt=ti*ti*$+R,x[0]=(G=C[0])*Ge+(ne=C[4])*(Xe=si*Et*$+ti*P)+(Ee=C[8])*(qe=ti*Et*$-si*P),x[1]=J*Ge+le*Xe+Me*qe,x[2]=ee*Ge+fe*Xe+$e*qe,x[3]=Z*Ge+Ce*Xe+De*qe,x[4]=G*et+ne*nt+Ee*ct,x[5]=J*et+le*nt+Me*ct,x[6]=ee*et+fe*nt+$e*ct,x[7]=Z*et+Ce*nt+De*ct,x[8]=G*it+ne*Ct+Ee*Nt,x[9]=J*it+le*Ct+Me*Nt,x[10]=ee*it+fe*Ct+$e*Nt,x[11]=Z*it+Ce*Ct+De*Nt,C!==x&&(x[12]=C[12],x[13]=C[13],x[14]=C[14],x[15]=C[15]),x)},Ne.rotateX=function(x,C,k){var M=Math.sin(k),P=Math.cos(k),R=C[4],$=C[5],G=C[6],J=C[7],ee=C[8],Z=C[9],ne=C[10],le=C[11];return C!==x&&(x[0]=C[0],x[1]=C[1],x[2]=C[2],x[3]=C[3],x[12]=C[12],x[13]=C[13],x[14]=C[14],x[15]=C[15]),x[4]=R*P+ee*M,x[5]=$*P+Z*M,x[6]=G*P+ne*M,x[7]=J*P+le*M,x[8]=ee*P-R*M,x[9]=Z*P-$*M,x[10]=ne*P-G*M,x[11]=le*P-J*M,x},Ne.rotateY=function(x,C,k){var M=Math.sin(k),P=Math.cos(k),R=C[0],$=C[1],G=C[2],J=C[3],ee=C[8],Z=C[9],ne=C[10],le=C[11];return C!==x&&(x[4]=C[4],x[5]=C[5],x[6]=C[6],x[7]=C[7],x[12]=C[12],x[13]=C[13],x[14]=C[14],x[15]=C[15]),x[0]=R*P-ee*M,x[1]=$*P-Z*M,x[2]=G*P-ne*M,x[3]=J*P-le*M,x[8]=R*M+ee*P,x[9]=$*M+Z*P,x[10]=G*M+ne*P,x[11]=J*M+le*P,x},Ne.rotateZ=function(x,C,k){var M=Math.sin(k),P=Math.cos(k),R=C[0],$=C[1],G=C[2],J=C[3],ee=C[4],Z=C[5],ne=C[6],le=C[7];return C!==x&&(x[8]=C[8],x[9]=C[9],x[10]=C[10],x[11]=C[11],x[12]=C[12],x[13]=C[13],x[14]=C[14],x[15]=C[15]),x[0]=R*P+ee*M,x[1]=$*P+Z*M,x[2]=G*P+ne*M,x[3]=J*P+le*M,x[4]=ee*P-R*M,x[5]=Z*P-$*M,x[6]=ne*P-G*M,x[7]=le*P-J*M,x},Ne.fromTranslation=function(x,C){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=C[0],x[13]=C[1],x[14]=C[2],x[15]=1,x},Ne.fromScaling=function(x,C){return x[0]=C[0],x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=C[1],x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=C[2],x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Ne.fromRotation=function(x,C,k){var M,P,R,$=k[0],G=k[1],J=k[2],ee=Math.hypot($,G,J);return ee<e.EPSILON?null:($*=ee=1/ee,G*=ee,J*=ee,M=Math.sin(C),P=Math.cos(C),x[0]=$*$*(R=1-P)+P,x[1]=G*$*R+J*M,x[2]=J*$*R-G*M,x[3]=0,x[4]=$*G*R-J*M,x[5]=G*G*R+P,x[6]=J*G*R+$*M,x[7]=0,x[8]=$*J*R+G*M,x[9]=G*J*R-$*M,x[10]=J*J*R+P,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x)},Ne.fromXRotation=function(x,C){var k=Math.sin(C),M=Math.cos(C);return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=M,x[6]=k,x[7]=0,x[8]=0,x[9]=-k,x[10]=M,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Ne.fromYRotation=function(x,C){var k=Math.sin(C),M=Math.cos(C);return x[0]=M,x[1]=0,x[2]=-k,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=k,x[9]=0,x[10]=M,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Ne.fromZRotation=function(x,C){var k=Math.sin(C),M=Math.cos(C);return x[0]=M,x[1]=k,x[2]=0,x[3]=0,x[4]=-k,x[5]=M,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Ne.fromRotationTranslation=a,Ne.fromQuat2=function(x,C){var k=new e.ARRAY_TYPE(3),M=-C[0],P=-C[1],R=-C[2],$=C[3],G=C[4],J=C[5],ee=C[6],Z=C[7],ne=M*M+P*P+R*R+$*$;return ne>0?(k[0]=2*(G*$+Z*M+J*R-ee*P)/ne,k[1]=2*(J*$+Z*P+ee*M-G*R)/ne,k[2]=2*(ee*$+Z*R+G*P-J*M)/ne):(k[0]=2*(G*$+Z*M+J*R-ee*P),k[1]=2*(J*$+Z*P+ee*M-G*R),k[2]=2*(ee*$+Z*R+G*P-J*M)),a(x,C,k),x},Ne.getTranslation=function(x,C){return x[0]=C[12],x[1]=C[13],x[2]=C[14],x},Ne.getScaling=f,Ne.getRotation=function(x,C){var k=new e.ARRAY_TYPE(3);f(k,C);var M=1/k[0],P=1/k[1],R=1/k[2],$=C[0]*M,G=C[1]*P,J=C[2]*R,ee=C[4]*M,Z=C[5]*P,ne=C[6]*R,le=C[8]*M,fe=C[9]*P,Ce=C[10]*R,Ee=$+Z+Ce,Me=0;return Ee>0?(Me=2*Math.sqrt(Ee+1),x[3]=.25*Me,x[0]=(ne-fe)/Me,x[1]=(le-J)/Me,x[2]=(G-ee)/Me):$>Z&&$>Ce?(Me=2*Math.sqrt(1+$-Z-Ce),x[3]=(ne-fe)/Me,x[0]=.25*Me,x[1]=(G+ee)/Me,x[2]=(le+J)/Me):Z>Ce?(Me=2*Math.sqrt(1+Z-$-Ce),x[3]=(le-J)/Me,x[0]=(G+ee)/Me,x[1]=.25*Me,x[2]=(ne+fe)/Me):(Me=2*Math.sqrt(1+Ce-$-Z),x[3]=(G-ee)/Me,x[0]=(le+J)/Me,x[1]=(ne+fe)/Me,x[2]=.25*Me),x},Ne.fromRotationTranslationScale=function(x,C,k,M){var P=C[0],R=C[1],$=C[2],G=C[3],J=P+P,ee=R+R,Z=$+$,ne=P*J,le=P*ee,fe=P*Z,Ce=R*ee,Ee=R*Z,Me=$*Z,$e=G*J,De=G*ee,Ge=G*Z,Xe=M[0],qe=M[1],et=M[2];return x[0]=(1-(Ce+Me))*Xe,x[1]=(le+Ge)*Xe,x[2]=(fe-De)*Xe,x[3]=0,x[4]=(le-Ge)*qe,x[5]=(1-(ne+Me))*qe,x[6]=(Ee+$e)*qe,x[7]=0,x[8]=(fe+De)*et,x[9]=(Ee-$e)*et,x[10]=(1-(ne+Ce))*et,x[11]=0,x[12]=k[0],x[13]=k[1],x[14]=k[2],x[15]=1,x},Ne.fromRotationTranslationScaleOrigin=function(x,C,k,M,P){var R=C[0],$=C[1],G=C[2],J=C[3],ee=R+R,Z=$+$,ne=G+G,le=R*ee,fe=R*Z,Ce=R*ne,Ee=$*Z,Me=$*ne,$e=G*ne,De=J*ee,Ge=J*Z,Xe=J*ne,qe=M[0],et=M[1],nt=M[2],ct=P[0],it=P[1],Ct=P[2],Nt=(1-(Ee+$e))*qe,Et=(fe+Xe)*qe,si=(Ce-Ge)*qe,ti=(fe-Xe)*et,Gt=(1-(le+$e))*et,Ut=(Me+De)*et,xi=(Ce+Ge)*nt,ui=(Me-De)*nt,fi=(1-(le+Ee))*nt;return x[0]=Nt,x[1]=Et,x[2]=si,x[3]=0,x[4]=ti,x[5]=Gt,x[6]=Ut,x[7]=0,x[8]=xi,x[9]=ui,x[10]=fi,x[11]=0,x[12]=k[0]+ct-(Nt*ct+ti*it+xi*Ct),x[13]=k[1]+it-(Et*ct+Gt*it+ui*Ct),x[14]=k[2]+Ct-(si*ct+Ut*it+fi*Ct),x[15]=1,x},Ne.fromQuat=function(x,C){var k=C[0],M=C[1],P=C[2],R=C[3],$=k+k,G=M+M,J=P+P,ee=k*$,Z=M*$,ne=M*G,le=P*$,fe=P*G,Ce=P*J,Ee=R*$,Me=R*G,$e=R*J;return x[0]=1-ne-Ce,x[1]=Z+$e,x[2]=le-Me,x[3]=0,x[4]=Z-$e,x[5]=1-ee-Ce,x[6]=fe+Ee,x[7]=0,x[8]=le+Me,x[9]=fe-Ee,x[10]=1-ee-ne,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Ne.frustum=function(x,C,k,M,P,R,$){var G=1/(k-C),J=1/(P-M),ee=1/(R-$);return x[0]=2*R*G,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=2*R*J,x[6]=0,x[7]=0,x[8]=(k+C)*G,x[9]=(P+M)*J,x[10]=($+R)*ee,x[11]=-1,x[12]=0,x[13]=0,x[14]=$*R*2*ee,x[15]=0,x},Ne.perspectiveNO=w,Ne.perspectiveZO=function(x,C,k,M,P){var R,$=1/Math.tan(C/2);return x[0]=$/k,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=$,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,P!=null&&P!==1/0?(x[10]=P*(R=1/(M-P)),x[14]=P*M*R):(x[10]=-1,x[14]=-M),x},Ne.perspectiveFromFieldOfView=function(x,C,k,M){var P=Math.tan(C.upDegrees*Math.PI/180),R=Math.tan(C.downDegrees*Math.PI/180),$=Math.tan(C.leftDegrees*Math.PI/180),G=Math.tan(C.rightDegrees*Math.PI/180),J=2/($+G),ee=2/(P+R);return x[0]=J,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=ee,x[6]=0,x[7]=0,x[8]=-($-G)*J*.5,x[9]=(P-R)*ee*.5,x[10]=M/(k-M),x[11]=-1,x[12]=0,x[13]=0,x[14]=M*k/(k-M),x[15]=0,x},Ne.orthoNO=E,Ne.orthoZO=function(x,C,k,M,P,R,$){var G=1/(C-k),J=1/(M-P),ee=1/(R-$);return x[0]=-2*G,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*J,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=ee,x[11]=0,x[12]=(C+k)*G,x[13]=(P+M)*J,x[14]=R*ee,x[15]=1,x},Ne.lookAt=function(x,C,k,M){var P,R,$,G,J,ee,Z,ne,le,fe,Ce=C[0],Ee=C[1],Me=C[2],$e=M[0],De=M[1],Ge=M[2],Xe=k[0],qe=k[1],et=k[2];return Math.abs(Ce-Xe)<e.EPSILON&&Math.abs(Ee-qe)<e.EPSILON&&Math.abs(Me-et)<e.EPSILON?o(x):(Z=Ce-Xe,ne=Ee-qe,le=Me-et,P=De*(le*=fe=1/Math.hypot(Z,ne,le))-Ge*(ne*=fe),R=Ge*(Z*=fe)-$e*le,$=$e*ne-De*Z,(fe=Math.hypot(P,R,$))?(P*=fe=1/fe,R*=fe,$*=fe):(P=0,R=0,$=0),G=ne*$-le*R,J=le*P-Z*$,ee=Z*R-ne*P,(fe=Math.hypot(G,J,ee))?(G*=fe=1/fe,J*=fe,ee*=fe):(G=0,J=0,ee=0),x[0]=P,x[1]=G,x[2]=Z,x[3]=0,x[4]=R,x[5]=J,x[6]=ne,x[7]=0,x[8]=$,x[9]=ee,x[10]=le,x[11]=0,x[12]=-(P*Ce+R*Ee+$*Me),x[13]=-(G*Ce+J*Ee+ee*Me),x[14]=-(Z*Ce+ne*Ee+le*Me),x[15]=1,x)},Ne.targetTo=function(x,C,k,M){var P=C[0],R=C[1],$=C[2],G=M[0],J=M[1],ee=M[2],Z=P-k[0],ne=R-k[1],le=$-k[2],fe=Z*Z+ne*ne+le*le;fe>0&&(Z*=fe=1/Math.sqrt(fe),ne*=fe,le*=fe);var Ce=J*le-ee*ne,Ee=ee*Z-G*le,Me=G*ne-J*Z;return(fe=Ce*Ce+Ee*Ee+Me*Me)>0&&(Ce*=fe=1/Math.sqrt(fe),Ee*=fe,Me*=fe),x[0]=Ce,x[1]=Ee,x[2]=Me,x[3]=0,x[4]=ne*Me-le*Ee,x[5]=le*Ce-Z*Me,x[6]=Z*Ee-ne*Ce,x[7]=0,x[8]=Z,x[9]=ne,x[10]=le,x[11]=0,x[12]=P,x[13]=R,x[14]=$,x[15]=1,x},Ne.str=function(x){return"mat4("+x[0]+", "+x[1]+", "+x[2]+", "+x[3]+", "+x[4]+", "+x[5]+", "+x[6]+", "+x[7]+", "+x[8]+", "+x[9]+", "+x[10]+", "+x[11]+", "+x[12]+", "+x[13]+", "+x[14]+", "+x[15]+")"},Ne.frob=function(x){return Math.hypot(x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8],x[9],x[10],x[11],x[12],x[13],x[14],x[15])},Ne.add=function(x,C,k){return x[0]=C[0]+k[0],x[1]=C[1]+k[1],x[2]=C[2]+k[2],x[3]=C[3]+k[3],x[4]=C[4]+k[4],x[5]=C[5]+k[5],x[6]=C[6]+k[6],x[7]=C[7]+k[7],x[8]=C[8]+k[8],x[9]=C[9]+k[9],x[10]=C[10]+k[10],x[11]=C[11]+k[11],x[12]=C[12]+k[12],x[13]=C[13]+k[13],x[14]=C[14]+k[14],x[15]=C[15]+k[15],x},Ne.subtract=O,Ne.multiplyScalar=function(x,C,k){return x[0]=C[0]*k,x[1]=C[1]*k,x[2]=C[2]*k,x[3]=C[3]*k,x[4]=C[4]*k,x[5]=C[5]*k,x[6]=C[6]*k,x[7]=C[7]*k,x[8]=C[8]*k,x[9]=C[9]*k,x[10]=C[10]*k,x[11]=C[11]*k,x[12]=C[12]*k,x[13]=C[13]*k,x[14]=C[14]*k,x[15]=C[15]*k,x},Ne.multiplyScalarAndAdd=function(x,C,k,M){return x[0]=C[0]+k[0]*M,x[1]=C[1]+k[1]*M,x[2]=C[2]+k[2]*M,x[3]=C[3]+k[3]*M,x[4]=C[4]+k[4]*M,x[5]=C[5]+k[5]*M,x[6]=C[6]+k[6]*M,x[7]=C[7]+k[7]*M,x[8]=C[8]+k[8]*M,x[9]=C[9]+k[9]*M,x[10]=C[10]+k[10]*M,x[11]=C[11]+k[11]*M,x[12]=C[12]+k[12]*M,x[13]=C[13]+k[13]*M,x[14]=C[14]+k[14]*M,x[15]=C[15]+k[15]*M,x},Ne.exactEquals=function(x,C){return x[0]===C[0]&&x[1]===C[1]&&x[2]===C[2]&&x[3]===C[3]&&x[4]===C[4]&&x[5]===C[5]&&x[6]===C[6]&&x[7]===C[7]&&x[8]===C[8]&&x[9]===C[9]&&x[10]===C[10]&&x[11]===C[11]&&x[12]===C[12]&&x[13]===C[13]&&x[14]===C[14]&&x[15]===C[15]},Ne.equals=function(x,C){var k=x[0],M=x[1],P=x[2],R=x[3],$=x[4],G=x[5],J=x[6],ee=x[7],Z=x[8],ne=x[9],le=x[10],fe=x[11],Ce=x[12],Ee=x[13],Me=x[14],$e=x[15],De=C[0],Ge=C[1],Xe=C[2],qe=C[3],et=C[4],nt=C[5],ct=C[6],it=C[7],Ct=C[8],Nt=C[9],Et=C[10],si=C[11],ti=C[12],Gt=C[13],Ut=C[14],xi=C[15];return Math.abs(k-De)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(De))&&Math.abs(M-Ge)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(Ge))&&Math.abs(P-Xe)<=e.EPSILON*Math.max(1,Math.abs(P),Math.abs(Xe))&&Math.abs(R-qe)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(qe))&&Math.abs($-et)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(et))&&Math.abs(G-nt)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(nt))&&Math.abs(J-ct)<=e.EPSILON*Math.max(1,Math.abs(J),Math.abs(ct))&&Math.abs(ee-it)<=e.EPSILON*Math.max(1,Math.abs(ee),Math.abs(it))&&Math.abs(Z-Ct)<=e.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Ct))&&Math.abs(ne-Nt)<=e.EPSILON*Math.max(1,Math.abs(ne),Math.abs(Nt))&&Math.abs(le-Et)<=e.EPSILON*Math.max(1,Math.abs(le),Math.abs(Et))&&Math.abs(fe-si)<=e.EPSILON*Math.max(1,Math.abs(fe),Math.abs(si))&&Math.abs(Ce-ti)<=e.EPSILON*Math.max(1,Math.abs(Ce),Math.abs(ti))&&Math.abs(Ee-Gt)<=e.EPSILON*Math.max(1,Math.abs(Ee),Math.abs(Gt))&&Math.abs(Me-Ut)<=e.EPSILON*Math.max(1,Math.abs(Me),Math.abs(Ut))&&Math.abs($e-xi)<=e.EPSILON*Math.max(1,Math.abs($e),Math.abs(xi))},Ne.sub=Ne.mul=Ne.ortho=Ne.perspective=void 0;var e=function(x,C){if(x&&x.__esModule)return x;if(x===null||s(x)!=="object"&&typeof x!="function")return{default:x};var k=i(void 0);if(k&&k.has(x))return k.get(x);var M={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var R in x)if(R!=="default"&&Object.prototype.hasOwnProperty.call(x,R)){var $=P?Object.getOwnPropertyDescriptor(x,R):null;$&&($.get||$.set)?Object.defineProperty(M,R,$):M[R]=x[R]}return M.default=x,k&&k.set(x,M),M}(ve());function i(x){if(typeof WeakMap!="function")return null;var C=new WeakMap,k=new WeakMap;return(i=function(M){return M?k:C})(x)}function o(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x}function p(x,C,k){var M=C[0],P=C[1],R=C[2],$=C[3],G=C[4],J=C[5],ee=C[6],Z=C[7],ne=C[8],le=C[9],fe=C[10],Ce=C[11],Ee=C[12],Me=C[13],$e=C[14],De=C[15],Ge=k[0],Xe=k[1],qe=k[2],et=k[3];return x[0]=Ge*M+Xe*G+qe*ne+et*Ee,x[1]=Ge*P+Xe*J+qe*le+et*Me,x[2]=Ge*R+Xe*ee+qe*fe+et*$e,x[3]=Ge*$+Xe*Z+qe*Ce+et*De,x[4]=(Ge=k[4])*M+(Xe=k[5])*G+(qe=k[6])*ne+(et=k[7])*Ee,x[5]=Ge*P+Xe*J+qe*le+et*Me,x[6]=Ge*R+Xe*ee+qe*fe+et*$e,x[7]=Ge*$+Xe*Z+qe*Ce+et*De,x[8]=(Ge=k[8])*M+(Xe=k[9])*G+(qe=k[10])*ne+(et=k[11])*Ee,x[9]=Ge*P+Xe*J+qe*le+et*Me,x[10]=Ge*R+Xe*ee+qe*fe+et*$e,x[11]=Ge*$+Xe*Z+qe*Ce+et*De,x[12]=(Ge=k[12])*M+(Xe=k[13])*G+(qe=k[14])*ne+(et=k[15])*Ee,x[13]=Ge*P+Xe*J+qe*le+et*Me,x[14]=Ge*R+Xe*ee+qe*fe+et*$e,x[15]=Ge*$+Xe*Z+qe*Ce+et*De,x}function a(x,C,k){var M=C[0],P=C[1],R=C[2],$=C[3],G=M+M,J=P+P,ee=R+R,Z=M*G,ne=M*J,le=M*ee,fe=P*J,Ce=P*ee,Ee=R*ee,Me=$*G,$e=$*J,De=$*ee;return x[0]=1-(fe+Ee),x[1]=ne+De,x[2]=le-$e,x[3]=0,x[4]=ne-De,x[5]=1-(Z+Ee),x[6]=Ce+Me,x[7]=0,x[8]=le+$e,x[9]=Ce-Me,x[10]=1-(Z+fe),x[11]=0,x[12]=k[0],x[13]=k[1],x[14]=k[2],x[15]=1,x}function f(x,C){var k=C[4],M=C[5],P=C[6],R=C[8],$=C[9],G=C[10];return x[0]=Math.hypot(C[0],C[1],C[2]),x[1]=Math.hypot(k,M,P),x[2]=Math.hypot(R,$,G),x}function w(x,C,k,M,P){var R,$=1/Math.tan(C/2);return x[0]=$/k,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=$,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,P!=null&&P!==1/0?(x[10]=(P+M)*(R=1/(M-P)),x[14]=2*P*M*R):(x[10]=-1,x[14]=-2*M),x}function E(x,C,k,M,P,R,$){var G=1/(C-k),J=1/(M-P),ee=1/(R-$);return x[0]=-2*G,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*J,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=2*ee,x[11]=0,x[12]=(C+k)*G,x[13]=(P+M)*J,x[14]=($+R)*ee,x[15]=1,x}function O(x,C,k){return x[0]=C[0]-k[0],x[1]=C[1]-k[1],x[2]=C[2]-k[2],x[3]=C[3]-k[3],x[4]=C[4]-k[4],x[5]=C[5]-k[5],x[6]=C[6]-k[6],x[7]=C[7]-k[7],x[8]=C[8]-k[8],x[9]=C[9]-k[9],x[10]=C[10]-k[10],x[11]=C[11]-k[11],x[12]=C[12]-k[12],x[13]=C[13]-k[13],x[14]=C[14]-k[14],x[15]=C[15]-k[15],x}return Ne.perspective=w,Ne.ortho=E,Ne.mul=p,Ne.sub=O,Ne}var qt,Te={},gt={};function oi(){if(qt)return gt;function s(P){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},s(P)}qt=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.create=o,gt.clone=function(P){var R=new e.ARRAY_TYPE(3);return R[0]=P[0],R[1]=P[1],R[2]=P[2],R},gt.length=p,gt.fromValues=function(P,R,$){var G=new e.ARRAY_TYPE(3);return G[0]=P,G[1]=R,G[2]=$,G},gt.copy=function(P,R){return P[0]=R[0],P[1]=R[1],P[2]=R[2],P},gt.set=function(P,R,$,G){return P[0]=R,P[1]=$,P[2]=G,P},gt.add=function(P,R,$){return P[0]=R[0]+$[0],P[1]=R[1]+$[1],P[2]=R[2]+$[2],P},gt.subtract=a,gt.multiply=f,gt.divide=w,gt.ceil=function(P,R){return P[0]=Math.ceil(R[0]),P[1]=Math.ceil(R[1]),P[2]=Math.ceil(R[2]),P},gt.floor=function(P,R){return P[0]=Math.floor(R[0]),P[1]=Math.floor(R[1]),P[2]=Math.floor(R[2]),P},gt.min=function(P,R,$){return P[0]=Math.min(R[0],$[0]),P[1]=Math.min(R[1],$[1]),P[2]=Math.min(R[2],$[2]),P},gt.max=function(P,R,$){return P[0]=Math.max(R[0],$[0]),P[1]=Math.max(R[1],$[1]),P[2]=Math.max(R[2],$[2]),P},gt.round=function(P,R){return P[0]=Math.round(R[0]),P[1]=Math.round(R[1]),P[2]=Math.round(R[2]),P},gt.scale=function(P,R,$){return P[0]=R[0]*$,P[1]=R[1]*$,P[2]=R[2]*$,P},gt.scaleAndAdd=function(P,R,$,G){return P[0]=R[0]+$[0]*G,P[1]=R[1]+$[1]*G,P[2]=R[2]+$[2]*G,P},gt.distance=E,gt.squaredDistance=O,gt.squaredLength=x,gt.negate=function(P,R){return P[0]=-R[0],P[1]=-R[1],P[2]=-R[2],P},gt.inverse=function(P,R){return P[0]=1/R[0],P[1]=1/R[1],P[2]=1/R[2],P},gt.normalize=function(P,R){var $=R[0],G=R[1],J=R[2],ee=$*$+G*G+J*J;return ee>0&&(ee=1/Math.sqrt(ee)),P[0]=R[0]*ee,P[1]=R[1]*ee,P[2]=R[2]*ee,P},gt.dot=C,gt.cross=function(P,R,$){var G=R[0],J=R[1],ee=R[2],Z=$[0],ne=$[1],le=$[2];return P[0]=J*le-ee*ne,P[1]=ee*Z-G*le,P[2]=G*ne-J*Z,P},gt.lerp=function(P,R,$,G){var J=R[0],ee=R[1],Z=R[2];return P[0]=J+G*($[0]-J),P[1]=ee+G*($[1]-ee),P[2]=Z+G*($[2]-Z),P},gt.hermite=function(P,R,$,G,J,ee){var Z=ee*ee,ne=Z*(2*ee-3)+1,le=Z*(ee-2)+ee,fe=Z*(ee-1),Ce=Z*(3-2*ee);return P[0]=R[0]*ne+$[0]*le+G[0]*fe+J[0]*Ce,P[1]=R[1]*ne+$[1]*le+G[1]*fe+J[1]*Ce,P[2]=R[2]*ne+$[2]*le+G[2]*fe+J[2]*Ce,P},gt.bezier=function(P,R,$,G,J,ee){var Z=1-ee,ne=Z*Z,le=ee*ee,fe=ne*Z,Ce=3*ee*ne,Ee=3*le*Z,Me=le*ee;return P[0]=R[0]*fe+$[0]*Ce+G[0]*Ee+J[0]*Me,P[1]=R[1]*fe+$[1]*Ce+G[1]*Ee+J[1]*Me,P[2]=R[2]*fe+$[2]*Ce+G[2]*Ee+J[2]*Me,P},gt.random=function(P,R){R=R||1;var $=2*e.RANDOM()*Math.PI,G=2*e.RANDOM()-1,J=Math.sqrt(1-G*G)*R;return P[0]=Math.cos($)*J,P[1]=Math.sin($)*J,P[2]=G*R,P},gt.transformMat4=function(P,R,$){var G=R[0],J=R[1],ee=R[2],Z=$[3]*G+$[7]*J+$[11]*ee+$[15];return P[0]=($[0]*G+$[4]*J+$[8]*ee+$[12])/(Z=Z||1),P[1]=($[1]*G+$[5]*J+$[9]*ee+$[13])/Z,P[2]=($[2]*G+$[6]*J+$[10]*ee+$[14])/Z,P},gt.transformMat3=function(P,R,$){var G=R[0],J=R[1],ee=R[2];return P[0]=G*$[0]+J*$[3]+ee*$[6],P[1]=G*$[1]+J*$[4]+ee*$[7],P[2]=G*$[2]+J*$[5]+ee*$[8],P},gt.transformQuat=function(P,R,$){var G=$[0],J=$[1],ee=$[2],Z=R[0],ne=R[1],le=R[2],fe=J*le-ee*ne,Ce=ee*Z-G*le,Ee=G*ne-J*Z,Me=J*Ee-ee*Ce,$e=ee*fe-G*Ee,De=G*Ce-J*fe,Ge=2*$[3];return Ce*=Ge,Ee*=Ge,$e*=2,De*=2,P[0]=Z+(fe*=Ge)+(Me*=2),P[1]=ne+Ce+$e,P[2]=le+Ee+De,P},gt.rotateX=function(P,R,$,G){var J=[],ee=[];return J[0]=R[0]-$[0],J[1]=R[1]-$[1],J[2]=R[2]-$[2],ee[0]=J[0],ee[1]=J[1]*Math.cos(G)-J[2]*Math.sin(G),ee[2]=J[1]*Math.sin(G)+J[2]*Math.cos(G),P[0]=ee[0]+$[0],P[1]=ee[1]+$[1],P[2]=ee[2]+$[2],P},gt.rotateY=function(P,R,$,G){var J=[],ee=[];return J[0]=R[0]-$[0],J[1]=R[1]-$[1],J[2]=R[2]-$[2],ee[0]=J[2]*Math.sin(G)+J[0]*Math.cos(G),ee[1]=J[1],ee[2]=J[2]*Math.cos(G)-J[0]*Math.sin(G),P[0]=ee[0]+$[0],P[1]=ee[1]+$[1],P[2]=ee[2]+$[2],P},gt.rotateZ=function(P,R,$,G){var J=[],ee=[];return J[0]=R[0]-$[0],J[1]=R[1]-$[1],J[2]=R[2]-$[2],ee[0]=J[0]*Math.cos(G)-J[1]*Math.sin(G),ee[1]=J[0]*Math.sin(G)+J[1]*Math.cos(G),ee[2]=J[2],P[0]=ee[0]+$[0],P[1]=ee[1]+$[1],P[2]=ee[2]+$[2],P},gt.angle=function(P,R){var $=P[0],G=P[1],J=P[2],ee=R[0],Z=R[1],ne=R[2],le=Math.sqrt($*$+G*G+J*J)*Math.sqrt(ee*ee+Z*Z+ne*ne),fe=le&&C(P,R)/le;return Math.acos(Math.min(Math.max(fe,-1),1))},gt.zero=function(P){return P[0]=0,P[1]=0,P[2]=0,P},gt.str=function(P){return"vec3("+P[0]+", "+P[1]+", "+P[2]+")"},gt.exactEquals=function(P,R){return P[0]===R[0]&&P[1]===R[1]&&P[2]===R[2]},gt.equals=function(P,R){var $=P[0],G=P[1],J=P[2],ee=R[0],Z=R[1],ne=R[2];return Math.abs($-ee)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(ee))&&Math.abs(G-Z)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(Z))&&Math.abs(J-ne)<=e.EPSILON*Math.max(1,Math.abs(J),Math.abs(ne))},gt.forEach=gt.sqrLen=gt.len=gt.sqrDist=gt.dist=gt.div=gt.mul=gt.sub=void 0;var e=function(P,R){if(P&&P.__esModule)return P;if(P===null||s(P)!=="object"&&typeof P!="function")return{default:P};var $=i(void 0);if($&&$.has(P))return $.get(P);var G={},J=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ee in P)if(ee!=="default"&&Object.prototype.hasOwnProperty.call(P,ee)){var Z=J?Object.getOwnPropertyDescriptor(P,ee):null;Z&&(Z.get||Z.set)?Object.defineProperty(G,ee,Z):G[ee]=P[ee]}return G.default=P,$&&$.set(P,G),G}(ve());function i(P){if(typeof WeakMap!="function")return null;var R=new WeakMap,$=new WeakMap;return(i=function(G){return G?$:R})(P)}function o(){var P=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(P[0]=0,P[1]=0,P[2]=0),P}function p(P){return Math.hypot(P[0],P[1],P[2])}function a(P,R,$){return P[0]=R[0]-$[0],P[1]=R[1]-$[1],P[2]=R[2]-$[2],P}function f(P,R,$){return P[0]=R[0]*$[0],P[1]=R[1]*$[1],P[2]=R[2]*$[2],P}function w(P,R,$){return P[0]=R[0]/$[0],P[1]=R[1]/$[1],P[2]=R[2]/$[2],P}function E(P,R){return Math.hypot(R[0]-P[0],R[1]-P[1],R[2]-P[2])}function O(P,R){var $=R[0]-P[0],G=R[1]-P[1],J=R[2]-P[2];return $*$+G*G+J*J}function x(P){var R=P[0],$=P[1],G=P[2];return R*R+$*$+G*G}function C(P,R){return P[0]*R[0]+P[1]*R[1]+P[2]*R[2]}gt.sub=a,gt.mul=f,gt.div=w,gt.dist=E,gt.sqrDist=O,gt.len=p,gt.sqrLen=x;var k,M=(k=o(),function(P,R,$,G,J,ee){var Z,ne;for(R||(R=3),$||($=0),ne=G?Math.min(G*R+$,P.length):P.length,Z=$;Z<ne;Z+=R)k[0]=P[Z],k[1]=P[Z+1],k[2]=P[Z+2],J(k,k,ee),P[Z]=k[0],P[Z+1]=k[1],P[Z+2]=k[2];return P});return gt.forEach=M,gt}var Ti,ni,Mt={};function zt(){if(Ti)return Mt;function s(M){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},s(M)}Ti=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.create=o,Mt.clone=function(M){var P=new e.ARRAY_TYPE(4);return P[0]=M[0],P[1]=M[1],P[2]=M[2],P[3]=M[3],P},Mt.fromValues=function(M,P,R,$){var G=new e.ARRAY_TYPE(4);return G[0]=M,G[1]=P,G[2]=R,G[3]=$,G},Mt.copy=function(M,P){return M[0]=P[0],M[1]=P[1],M[2]=P[2],M[3]=P[3],M},Mt.set=function(M,P,R,$,G){return M[0]=P,M[1]=R,M[2]=$,M[3]=G,M},Mt.add=function(M,P,R){return M[0]=P[0]+R[0],M[1]=P[1]+R[1],M[2]=P[2]+R[2],M[3]=P[3]+R[3],M},Mt.subtract=p,Mt.multiply=a,Mt.divide=f,Mt.ceil=function(M,P){return M[0]=Math.ceil(P[0]),M[1]=Math.ceil(P[1]),M[2]=Math.ceil(P[2]),M[3]=Math.ceil(P[3]),M},Mt.floor=function(M,P){return M[0]=Math.floor(P[0]),M[1]=Math.floor(P[1]),M[2]=Math.floor(P[2]),M[3]=Math.floor(P[3]),M},Mt.min=function(M,P,R){return M[0]=Math.min(P[0],R[0]),M[1]=Math.min(P[1],R[1]),M[2]=Math.min(P[2],R[2]),M[3]=Math.min(P[3],R[3]),M},Mt.max=function(M,P,R){return M[0]=Math.max(P[0],R[0]),M[1]=Math.max(P[1],R[1]),M[2]=Math.max(P[2],R[2]),M[3]=Math.max(P[3],R[3]),M},Mt.round=function(M,P){return M[0]=Math.round(P[0]),M[1]=Math.round(P[1]),M[2]=Math.round(P[2]),M[3]=Math.round(P[3]),M},Mt.scale=function(M,P,R){return M[0]=P[0]*R,M[1]=P[1]*R,M[2]=P[2]*R,M[3]=P[3]*R,M},Mt.scaleAndAdd=function(M,P,R,$){return M[0]=P[0]+R[0]*$,M[1]=P[1]+R[1]*$,M[2]=P[2]+R[2]*$,M[3]=P[3]+R[3]*$,M},Mt.distance=w,Mt.squaredDistance=E,Mt.length=O,Mt.squaredLength=x,Mt.negate=function(M,P){return M[0]=-P[0],M[1]=-P[1],M[2]=-P[2],M[3]=-P[3],M},Mt.inverse=function(M,P){return M[0]=1/P[0],M[1]=1/P[1],M[2]=1/P[2],M[3]=1/P[3],M},Mt.normalize=function(M,P){var R=P[0],$=P[1],G=P[2],J=P[3],ee=R*R+$*$+G*G+J*J;return ee>0&&(ee=1/Math.sqrt(ee)),M[0]=R*ee,M[1]=$*ee,M[2]=G*ee,M[3]=J*ee,M},Mt.dot=function(M,P){return M[0]*P[0]+M[1]*P[1]+M[2]*P[2]+M[3]*P[3]},Mt.cross=function(M,P,R,$){var G=R[0]*$[1]-R[1]*$[0],J=R[0]*$[2]-R[2]*$[0],ee=R[0]*$[3]-R[3]*$[0],Z=R[1]*$[2]-R[2]*$[1],ne=R[1]*$[3]-R[3]*$[1],le=R[2]*$[3]-R[3]*$[2],fe=P[0],Ce=P[1],Ee=P[2],Me=P[3];return M[0]=Ce*le-Ee*ne+Me*Z,M[1]=-fe*le+Ee*ee-Me*J,M[2]=fe*ne-Ce*ee+Me*G,M[3]=-fe*Z+Ce*J-Ee*G,M},Mt.lerp=function(M,P,R,$){var G=P[0],J=P[1],ee=P[2],Z=P[3];return M[0]=G+$*(R[0]-G),M[1]=J+$*(R[1]-J),M[2]=ee+$*(R[2]-ee),M[3]=Z+$*(R[3]-Z),M},Mt.random=function(M,P){var R,$,G,J,ee,Z;P=P||1;do ee=(R=2*e.RANDOM()-1)*R+($=2*e.RANDOM()-1)*$;while(ee>=1);do Z=(G=2*e.RANDOM()-1)*G+(J=2*e.RANDOM()-1)*J;while(Z>=1);var ne=Math.sqrt((1-ee)/Z);return M[0]=P*R,M[1]=P*$,M[2]=P*G*ne,M[3]=P*J*ne,M},Mt.transformMat4=function(M,P,R){var $=P[0],G=P[1],J=P[2],ee=P[3];return M[0]=R[0]*$+R[4]*G+R[8]*J+R[12]*ee,M[1]=R[1]*$+R[5]*G+R[9]*J+R[13]*ee,M[2]=R[2]*$+R[6]*G+R[10]*J+R[14]*ee,M[3]=R[3]*$+R[7]*G+R[11]*J+R[15]*ee,M},Mt.transformQuat=function(M,P,R){var $=P[0],G=P[1],J=P[2],ee=R[0],Z=R[1],ne=R[2],le=R[3],fe=le*$+Z*J-ne*G,Ce=le*G+ne*$-ee*J,Ee=le*J+ee*G-Z*$,Me=-ee*$-Z*G-ne*J;return M[0]=fe*le+Me*-ee+Ce*-ne-Ee*-Z,M[1]=Ce*le+Me*-Z+Ee*-ee-fe*-ne,M[2]=Ee*le+Me*-ne+fe*-Z-Ce*-ee,M[3]=P[3],M},Mt.zero=function(M){return M[0]=0,M[1]=0,M[2]=0,M[3]=0,M},Mt.str=function(M){return"vec4("+M[0]+", "+M[1]+", "+M[2]+", "+M[3]+")"},Mt.exactEquals=function(M,P){return M[0]===P[0]&&M[1]===P[1]&&M[2]===P[2]&&M[3]===P[3]},Mt.equals=function(M,P){var R=M[0],$=M[1],G=M[2],J=M[3],ee=P[0],Z=P[1],ne=P[2],le=P[3];return Math.abs(R-ee)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(ee))&&Math.abs($-Z)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(Z))&&Math.abs(G-ne)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(ne))&&Math.abs(J-le)<=e.EPSILON*Math.max(1,Math.abs(J),Math.abs(le))},Mt.forEach=Mt.sqrLen=Mt.len=Mt.sqrDist=Mt.dist=Mt.div=Mt.mul=Mt.sub=void 0;var e=function(M,P){if(M&&M.__esModule)return M;if(M===null||s(M)!=="object"&&typeof M!="function")return{default:M};var R=i(void 0);if(R&&R.has(M))return R.get(M);var $={},G=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var J in M)if(J!=="default"&&Object.prototype.hasOwnProperty.call(M,J)){var ee=G?Object.getOwnPropertyDescriptor(M,J):null;ee&&(ee.get||ee.set)?Object.defineProperty($,J,ee):$[J]=M[J]}return $.default=M,R&&R.set(M,$),$}(ve());function i(M){if(typeof WeakMap!="function")return null;var P=new WeakMap,R=new WeakMap;return(i=function($){return $?R:P})(M)}function o(){var M=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0,M[3]=0),M}function p(M,P,R){return M[0]=P[0]-R[0],M[1]=P[1]-R[1],M[2]=P[2]-R[2],M[3]=P[3]-R[3],M}function a(M,P,R){return M[0]=P[0]*R[0],M[1]=P[1]*R[1],M[2]=P[2]*R[2],M[3]=P[3]*R[3],M}function f(M,P,R){return M[0]=P[0]/R[0],M[1]=P[1]/R[1],M[2]=P[2]/R[2],M[3]=P[3]/R[3],M}function w(M,P){return Math.hypot(P[0]-M[0],P[1]-M[1],P[2]-M[2],P[3]-M[3])}function E(M,P){var R=P[0]-M[0],$=P[1]-M[1],G=P[2]-M[2],J=P[3]-M[3];return R*R+$*$+G*G+J*J}function O(M){return Math.hypot(M[0],M[1],M[2],M[3])}function x(M){var P=M[0],R=M[1],$=M[2],G=M[3];return P*P+R*R+$*$+G*G}Mt.sub=p,Mt.mul=a,Mt.div=f,Mt.dist=w,Mt.sqrDist=E,Mt.len=O,Mt.sqrLen=x;var C,k=(C=o(),function(M,P,R,$,G,J){var ee,Z;for(P||(P=4),R||(R=0),Z=$?Math.min($*P+R,M.length):M.length,ee=R;ee<Z;ee+=P)C[0]=M[ee],C[1]=M[ee+1],C[2]=M[ee+2],C[3]=M[ee+3],G(C,C,J),M[ee]=C[0],M[ee+1]=C[1],M[ee+2]=C[2],M[ee+3]=C[3];return M});return Mt.forEach=k,Mt}function ii(){if(ni)return Te;function s(De){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Ge){return typeof Ge}:function(Ge){return Ge&&typeof Symbol=="function"&&Ge.constructor===Symbol&&Ge!==Symbol.prototype?"symbol":typeof Ge},s(De)}ni=1,Object.defineProperty(Te,"__esModule",{value:!0}),Te.create=w,Te.identity=function(De){return De[0]=0,De[1]=0,De[2]=0,De[3]=1,De},Te.setAxisAngle=E,Te.getAxisAngle=function(De,Ge){var Xe=2*Math.acos(Ge[3]),qe=Math.sin(Xe/2);return qe>e.EPSILON?(De[0]=Ge[0]/qe,De[1]=Ge[1]/qe,De[2]=Ge[2]/qe):(De[0]=1,De[1]=0,De[2]=0),Xe},Te.getAngle=function(De,Ge){var Xe=R(De,Ge);return Math.acos(2*Xe*Xe-1)},Te.multiply=O,Te.rotateX=function(De,Ge,Xe){Xe*=.5;var qe=Ge[0],et=Ge[1],nt=Ge[2],ct=Ge[3],it=Math.sin(Xe),Ct=Math.cos(Xe);return De[0]=qe*Ct+ct*it,De[1]=et*Ct+nt*it,De[2]=nt*Ct-et*it,De[3]=ct*Ct-qe*it,De},Te.rotateY=function(De,Ge,Xe){Xe*=.5;var qe=Ge[0],et=Ge[1],nt=Ge[2],ct=Ge[3],it=Math.sin(Xe),Ct=Math.cos(Xe);return De[0]=qe*Ct-nt*it,De[1]=et*Ct+ct*it,De[2]=nt*Ct+qe*it,De[3]=ct*Ct-et*it,De},Te.rotateZ=function(De,Ge,Xe){Xe*=.5;var qe=Ge[0],et=Ge[1],nt=Ge[2],ct=Ge[3],it=Math.sin(Xe),Ct=Math.cos(Xe);return De[0]=qe*Ct+et*it,De[1]=et*Ct-qe*it,De[2]=nt*Ct+ct*it,De[3]=ct*Ct-nt*it,De},Te.calculateW=function(De,Ge){var Xe=Ge[0],qe=Ge[1],et=Ge[2];return De[0]=Xe,De[1]=qe,De[2]=et,De[3]=Math.sqrt(Math.abs(1-Xe*Xe-qe*qe-et*et)),De},Te.exp=x,Te.ln=C,Te.pow=function(De,Ge,Xe){return C(De,Ge),P(De,De,Xe),x(De,De),De},Te.slerp=k,Te.random=function(De){var Ge=e.RANDOM(),Xe=e.RANDOM(),qe=e.RANDOM(),et=Math.sqrt(1-Ge),nt=Math.sqrt(Ge);return De[0]=et*Math.sin(2*Math.PI*Xe),De[1]=et*Math.cos(2*Math.PI*Xe),De[2]=nt*Math.sin(2*Math.PI*qe),De[3]=nt*Math.cos(2*Math.PI*qe),De},Te.invert=function(De,Ge){var Xe=Ge[0],qe=Ge[1],et=Ge[2],nt=Ge[3],ct=Xe*Xe+qe*qe+et*et+nt*nt,it=ct?1/ct:0;return De[0]=-Xe*it,De[1]=-qe*it,De[2]=-et*it,De[3]=nt*it,De},Te.conjugate=function(De,Ge){return De[0]=-Ge[0],De[1]=-Ge[1],De[2]=-Ge[2],De[3]=Ge[3],De},Te.fromMat3=M,Te.fromEuler=function(De,Ge,Xe,qe){var et=.5*Math.PI/180;Ge*=et,Xe*=et,qe*=et;var nt=Math.sin(Ge),ct=Math.cos(Ge),it=Math.sin(Xe),Ct=Math.cos(Xe),Nt=Math.sin(qe),Et=Math.cos(qe);return De[0]=nt*Ct*Et-ct*it*Nt,De[1]=ct*it*Et+nt*Ct*Nt,De[2]=ct*Ct*Nt-nt*it*Et,De[3]=ct*Ct*Et+nt*it*Nt,De},Te.str=function(De){return"quat("+De[0]+", "+De[1]+", "+De[2]+", "+De[3]+")"},Te.setAxes=Te.sqlerp=Te.rotationTo=Te.equals=Te.exactEquals=Te.normalize=Te.sqrLen=Te.squaredLength=Te.len=Te.length=Te.lerp=Te.dot=Te.scale=Te.mul=Te.add=Te.set=Te.copy=Te.fromValues=Te.clone=void 0;var e=f(ve()),i=f(at()),o=f(oi()),p=f(zt());function a(De){if(typeof WeakMap!="function")return null;var Ge=new WeakMap,Xe=new WeakMap;return(a=function(qe){return qe?Xe:Ge})(De)}function f(De,Ge){if(De&&De.__esModule)return De;if(De===null||s(De)!=="object"&&typeof De!="function")return{default:De};var Xe=a(Ge);if(Xe&&Xe.has(De))return Xe.get(De);var qe={},et=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var nt in De)if(nt!=="default"&&Object.prototype.hasOwnProperty.call(De,nt)){var ct=et?Object.getOwnPropertyDescriptor(De,nt):null;ct&&(ct.get||ct.set)?Object.defineProperty(qe,nt,ct):qe[nt]=De[nt]}return qe.default=De,Xe&&Xe.set(De,qe),qe}function w(){var De=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(De[0]=0,De[1]=0,De[2]=0),De[3]=1,De}function E(De,Ge,Xe){Xe*=.5;var qe=Math.sin(Xe);return De[0]=qe*Ge[0],De[1]=qe*Ge[1],De[2]=qe*Ge[2],De[3]=Math.cos(Xe),De}function O(De,Ge,Xe){var qe=Ge[0],et=Ge[1],nt=Ge[2],ct=Ge[3],it=Xe[0],Ct=Xe[1],Nt=Xe[2],Et=Xe[3];return De[0]=qe*Et+ct*it+et*Nt-nt*Ct,De[1]=et*Et+ct*Ct+nt*it-qe*Nt,De[2]=nt*Et+ct*Nt+qe*Ct-et*it,De[3]=ct*Et-qe*it-et*Ct-nt*Nt,De}function x(De,Ge){var Xe=Ge[0],qe=Ge[1],et=Ge[2],nt=Ge[3],ct=Math.sqrt(Xe*Xe+qe*qe+et*et),it=Math.exp(nt),Ct=ct>0?it*Math.sin(ct)/ct:0;return De[0]=Xe*Ct,De[1]=qe*Ct,De[2]=et*Ct,De[3]=it*Math.cos(ct),De}function C(De,Ge){var Xe=Ge[0],qe=Ge[1],et=Ge[2],nt=Ge[3],ct=Math.sqrt(Xe*Xe+qe*qe+et*et),it=ct>0?Math.atan2(ct,nt)/ct:0;return De[0]=Xe*it,De[1]=qe*it,De[2]=et*it,De[3]=.5*Math.log(Xe*Xe+qe*qe+et*et+nt*nt),De}function k(De,Ge,Xe,qe){var et,nt,ct,it,Ct,Nt=Ge[0],Et=Ge[1],si=Ge[2],ti=Ge[3],Gt=Xe[0],Ut=Xe[1],xi=Xe[2],ui=Xe[3];return(nt=Nt*Gt+Et*Ut+si*xi+ti*ui)<0&&(nt=-nt,Gt=-Gt,Ut=-Ut,xi=-xi,ui=-ui),1-nt>e.EPSILON?(et=Math.acos(nt),ct=Math.sin(et),it=Math.sin((1-qe)*et)/ct,Ct=Math.sin(qe*et)/ct):(it=1-qe,Ct=qe),De[0]=it*Nt+Ct*Gt,De[1]=it*Et+Ct*Ut,De[2]=it*si+Ct*xi,De[3]=it*ti+Ct*ui,De}function M(De,Ge){var Xe,qe=Ge[0]+Ge[4]+Ge[8];if(qe>0)Xe=Math.sqrt(qe+1),De[3]=.5*Xe,De[0]=(Ge[5]-Ge[7])*(Xe=.5/Xe),De[1]=(Ge[6]-Ge[2])*Xe,De[2]=(Ge[1]-Ge[3])*Xe;else{var et=0;Ge[4]>Ge[0]&&(et=1),Ge[8]>Ge[3*et+et]&&(et=2);var nt=(et+1)%3,ct=(et+2)%3;Xe=Math.sqrt(Ge[3*et+et]-Ge[3*nt+nt]-Ge[3*ct+ct]+1),De[et]=.5*Xe,De[3]=(Ge[3*nt+ct]-Ge[3*ct+nt])*(Xe=.5/Xe),De[nt]=(Ge[3*nt+et]+Ge[3*et+nt])*Xe,De[ct]=(Ge[3*ct+et]+Ge[3*et+ct])*Xe}return De}Te.clone=p.clone,Te.fromValues=p.fromValues,Te.copy=p.copy,Te.set=p.set,Te.add=p.add,Te.mul=O;var P=p.scale;Te.scale=P;var R=p.dot;Te.dot=R,Te.lerp=p.lerp;var $=p.length;Te.length=$,Te.len=$;var G=p.squaredLength;Te.squaredLength=G,Te.sqrLen=G;var J=p.normalize;Te.normalize=J,Te.exactEquals=p.exactEquals,Te.equals=p.equals;var ee,Z,ne,le=(ee=o.create(),Z=o.fromValues(1,0,0),ne=o.fromValues(0,1,0),function(De,Ge,Xe){var qe=o.dot(Ge,Xe);return qe<-.999999?(o.cross(ee,Z,Ge),o.len(ee)<1e-6&&o.cross(ee,ne,Ge),o.normalize(ee,ee),E(De,ee,Math.PI),De):qe>.999999?(De[0]=0,De[1]=0,De[2]=0,De[3]=1,De):(o.cross(ee,Ge,Xe),De[0]=ee[0],De[1]=ee[1],De[2]=ee[2],De[3]=1+qe,J(De,De))});Te.rotationTo=le;var fe,Ce,Ee=(fe=w(),Ce=w(),function(De,Ge,Xe,qe,et,nt){return k(fe,Ge,et,nt),k(Ce,Xe,qe,nt),k(De,fe,Ce,2*nt*(1-nt)),De});Te.sqlerp=Ee;var Me,$e=(Me=i.create(),function(De,Ge,Xe,qe){return Me[0]=Xe[0],Me[3]=Xe[1],Me[6]=Xe[2],Me[1]=qe[0],Me[4]=qe[1],Me[7]=qe[2],Me[2]=-Ge[0],Me[5]=-Ge[1],Me[8]=-Ge[2],J(De,M(De,Me))});return Te.setAxes=$e,Te}var Yt,jt={};function Ri(){if(Yt)return jt;function s(k){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},s(k)}Yt=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.create=function(){var k=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(k[0]=0,k[1]=0,k[2]=0,k[4]=0,k[5]=0,k[6]=0,k[7]=0),k[3]=1,k},jt.clone=function(k){var M=new e.ARRAY_TYPE(8);return M[0]=k[0],M[1]=k[1],M[2]=k[2],M[3]=k[3],M[4]=k[4],M[5]=k[5],M[6]=k[6],M[7]=k[7],M},jt.fromValues=function(k,M,P,R,$,G,J,ee){var Z=new e.ARRAY_TYPE(8);return Z[0]=k,Z[1]=M,Z[2]=P,Z[3]=R,Z[4]=$,Z[5]=G,Z[6]=J,Z[7]=ee,Z},jt.fromRotationTranslationValues=function(k,M,P,R,$,G,J){var ee=new e.ARRAY_TYPE(8);ee[0]=k,ee[1]=M,ee[2]=P,ee[3]=R;var Z=.5*$,ne=.5*G,le=.5*J;return ee[4]=Z*R+ne*P-le*M,ee[5]=ne*R+le*k-Z*P,ee[6]=le*R+Z*M-ne*k,ee[7]=-Z*k-ne*M-le*P,ee},jt.fromRotationTranslation=f,jt.fromTranslation=function(k,M){return k[0]=0,k[1]=0,k[2]=0,k[3]=1,k[4]=.5*M[0],k[5]=.5*M[1],k[6]=.5*M[2],k[7]=0,k},jt.fromRotation=function(k,M){return k[0]=M[0],k[1]=M[1],k[2]=M[2],k[3]=M[3],k[4]=0,k[5]=0,k[6]=0,k[7]=0,k},jt.fromMat4=function(k,M){var P=i.create();o.getRotation(P,M);var R=new e.ARRAY_TYPE(3);return o.getTranslation(R,M),f(k,P,R),k},jt.copy=w,jt.identity=function(k){return k[0]=0,k[1]=0,k[2]=0,k[3]=1,k[4]=0,k[5]=0,k[6]=0,k[7]=0,k},jt.set=function(k,M,P,R,$,G,J,ee,Z){return k[0]=M,k[1]=P,k[2]=R,k[3]=$,k[4]=G,k[5]=J,k[6]=ee,k[7]=Z,k},jt.getDual=function(k,M){return k[0]=M[4],k[1]=M[5],k[2]=M[6],k[3]=M[7],k},jt.setDual=function(k,M){return k[4]=M[0],k[5]=M[1],k[6]=M[2],k[7]=M[3],k},jt.getTranslation=function(k,M){var P=M[4],R=M[5],$=M[6],G=M[7],J=-M[0],ee=-M[1],Z=-M[2],ne=M[3];return k[0]=2*(P*ne+G*J+R*Z-$*ee),k[1]=2*(R*ne+G*ee+$*J-P*Z),k[2]=2*($*ne+G*Z+P*ee-R*J),k},jt.translate=function(k,M,P){var R=M[0],$=M[1],G=M[2],J=M[3],ee=.5*P[0],Z=.5*P[1],ne=.5*P[2],le=M[4],fe=M[5],Ce=M[6],Ee=M[7];return k[0]=R,k[1]=$,k[2]=G,k[3]=J,k[4]=J*ee+$*ne-G*Z+le,k[5]=J*Z+G*ee-R*ne+fe,k[6]=J*ne+R*Z-$*ee+Ce,k[7]=-R*ee-$*Z-G*ne+Ee,k},jt.rotateX=function(k,M,P){var R=-M[0],$=-M[1],G=-M[2],J=M[3],ee=M[4],Z=M[5],ne=M[6],le=M[7],fe=ee*J+le*R+Z*G-ne*$,Ce=Z*J+le*$+ne*R-ee*G,Ee=ne*J+le*G+ee*$-Z*R,Me=le*J-ee*R-Z*$-ne*G;return i.rotateX(k,M,P),k[4]=fe*(J=k[3])+Me*(R=k[0])+Ce*(G=k[2])-Ee*($=k[1]),k[5]=Ce*J+Me*$+Ee*R-fe*G,k[6]=Ee*J+Me*G+fe*$-Ce*R,k[7]=Me*J-fe*R-Ce*$-Ee*G,k},jt.rotateY=function(k,M,P){var R=-M[0],$=-M[1],G=-M[2],J=M[3],ee=M[4],Z=M[5],ne=M[6],le=M[7],fe=ee*J+le*R+Z*G-ne*$,Ce=Z*J+le*$+ne*R-ee*G,Ee=ne*J+le*G+ee*$-Z*R,Me=le*J-ee*R-Z*$-ne*G;return i.rotateY(k,M,P),k[4]=fe*(J=k[3])+Me*(R=k[0])+Ce*(G=k[2])-Ee*($=k[1]),k[5]=Ce*J+Me*$+Ee*R-fe*G,k[6]=Ee*J+Me*G+fe*$-Ce*R,k[7]=Me*J-fe*R-Ce*$-Ee*G,k},jt.rotateZ=function(k,M,P){var R=-M[0],$=-M[1],G=-M[2],J=M[3],ee=M[4],Z=M[5],ne=M[6],le=M[7],fe=ee*J+le*R+Z*G-ne*$,Ce=Z*J+le*$+ne*R-ee*G,Ee=ne*J+le*G+ee*$-Z*R,Me=le*J-ee*R-Z*$-ne*G;return i.rotateZ(k,M,P),k[4]=fe*(J=k[3])+Me*(R=k[0])+Ce*(G=k[2])-Ee*($=k[1]),k[5]=Ce*J+Me*$+Ee*R-fe*G,k[6]=Ee*J+Me*G+fe*$-Ce*R,k[7]=Me*J-fe*R-Ce*$-Ee*G,k},jt.rotateByQuatAppend=function(k,M,P){var R=P[0],$=P[1],G=P[2],J=P[3],ee=M[0],Z=M[1],ne=M[2],le=M[3];return k[0]=ee*J+le*R+Z*G-ne*$,k[1]=Z*J+le*$+ne*R-ee*G,k[2]=ne*J+le*G+ee*$-Z*R,k[3]=le*J-ee*R-Z*$-ne*G,k[4]=(ee=M[4])*J+(le=M[7])*R+(Z=M[5])*G-(ne=M[6])*$,k[5]=Z*J+le*$+ne*R-ee*G,k[6]=ne*J+le*G+ee*$-Z*R,k[7]=le*J-ee*R-Z*$-ne*G,k},jt.rotateByQuatPrepend=function(k,M,P){var R=M[0],$=M[1],G=M[2],J=M[3],ee=P[0],Z=P[1],ne=P[2],le=P[3];return k[0]=R*le+J*ee+$*ne-G*Z,k[1]=$*le+J*Z+G*ee-R*ne,k[2]=G*le+J*ne+R*Z-$*ee,k[3]=J*le-R*ee-$*Z-G*ne,k[4]=R*(le=P[7])+J*(ee=P[4])+$*(ne=P[6])-G*(Z=P[5]),k[5]=$*le+J*Z+G*ee-R*ne,k[6]=G*le+J*ne+R*Z-$*ee,k[7]=J*le-R*ee-$*Z-G*ne,k},jt.rotateAroundAxis=function(k,M,P,R){if(Math.abs(R)<e.EPSILON)return w(k,M);var $=Math.hypot(P[0],P[1],P[2]);R*=.5;var G=Math.sin(R),J=G*P[0]/$,ee=G*P[1]/$,Z=G*P[2]/$,ne=Math.cos(R),le=M[0],fe=M[1],Ce=M[2],Ee=M[3];k[0]=le*ne+Ee*J+fe*Z-Ce*ee,k[1]=fe*ne+Ee*ee+Ce*J-le*Z,k[2]=Ce*ne+Ee*Z+le*ee-fe*J,k[3]=Ee*ne-le*J-fe*ee-Ce*Z;var Me=M[4],$e=M[5],De=M[6],Ge=M[7];return k[4]=Me*ne+Ge*J+$e*Z-De*ee,k[5]=$e*ne+Ge*ee+De*J-Me*Z,k[6]=De*ne+Ge*Z+Me*ee-$e*J,k[7]=Ge*ne-Me*J-$e*ee-De*Z,k},jt.add=function(k,M,P){return k[0]=M[0]+P[0],k[1]=M[1]+P[1],k[2]=M[2]+P[2],k[3]=M[3]+P[3],k[4]=M[4]+P[4],k[5]=M[5]+P[5],k[6]=M[6]+P[6],k[7]=M[7]+P[7],k},jt.multiply=E,jt.scale=function(k,M,P){return k[0]=M[0]*P,k[1]=M[1]*P,k[2]=M[2]*P,k[3]=M[3]*P,k[4]=M[4]*P,k[5]=M[5]*P,k[6]=M[6]*P,k[7]=M[7]*P,k},jt.lerp=function(k,M,P,R){var $=1-R;return O(M,P)<0&&(R=-R),k[0]=M[0]*$+P[0]*R,k[1]=M[1]*$+P[1]*R,k[2]=M[2]*$+P[2]*R,k[3]=M[3]*$+P[3]*R,k[4]=M[4]*$+P[4]*R,k[5]=M[5]*$+P[5]*R,k[6]=M[6]*$+P[6]*R,k[7]=M[7]*$+P[7]*R,k},jt.invert=function(k,M){var P=C(M);return k[0]=-M[0]/P,k[1]=-M[1]/P,k[2]=-M[2]/P,k[3]=M[3]/P,k[4]=-M[4]/P,k[5]=-M[5]/P,k[6]=-M[6]/P,k[7]=M[7]/P,k},jt.conjugate=function(k,M){return k[0]=-M[0],k[1]=-M[1],k[2]=-M[2],k[3]=M[3],k[4]=-M[4],k[5]=-M[5],k[6]=-M[6],k[7]=M[7],k},jt.normalize=function(k,M){var P=C(M);if(P>0){P=Math.sqrt(P);var R=M[0]/P,$=M[1]/P,G=M[2]/P,J=M[3]/P,ee=M[4],Z=M[5],ne=M[6],le=M[7],fe=R*ee+$*Z+G*ne+J*le;k[0]=R,k[1]=$,k[2]=G,k[3]=J,k[4]=(ee-R*fe)/P,k[5]=(Z-$*fe)/P,k[6]=(ne-G*fe)/P,k[7]=(le-J*fe)/P}return k},jt.str=function(k){return"quat2("+k[0]+", "+k[1]+", "+k[2]+", "+k[3]+", "+k[4]+", "+k[5]+", "+k[6]+", "+k[7]+")"},jt.exactEquals=function(k,M){return k[0]===M[0]&&k[1]===M[1]&&k[2]===M[2]&&k[3]===M[3]&&k[4]===M[4]&&k[5]===M[5]&&k[6]===M[6]&&k[7]===M[7]},jt.equals=function(k,M){var P=k[0],R=k[1],$=k[2],G=k[3],J=k[4],ee=k[5],Z=k[6],ne=k[7],le=M[0],fe=M[1],Ce=M[2],Ee=M[3],Me=M[4],$e=M[5],De=M[6],Ge=M[7];return Math.abs(P-le)<=e.EPSILON*Math.max(1,Math.abs(P),Math.abs(le))&&Math.abs(R-fe)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(fe))&&Math.abs($-Ce)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(Ce))&&Math.abs(G-Ee)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(Ee))&&Math.abs(J-Me)<=e.EPSILON*Math.max(1,Math.abs(J),Math.abs(Me))&&Math.abs(ee-$e)<=e.EPSILON*Math.max(1,Math.abs(ee),Math.abs($e))&&Math.abs(Z-De)<=e.EPSILON*Math.max(1,Math.abs(Z),Math.abs(De))&&Math.abs(ne-Ge)<=e.EPSILON*Math.max(1,Math.abs(ne),Math.abs(Ge))},jt.sqrLen=jt.squaredLength=jt.len=jt.length=jt.dot=jt.mul=jt.setReal=jt.getReal=void 0;var e=a(ve()),i=a(ii()),o=a(Tt());function p(k){if(typeof WeakMap!="function")return null;var M=new WeakMap,P=new WeakMap;return(p=function(R){return R?P:M})(k)}function a(k,M){if(k&&k.__esModule)return k;if(k===null||s(k)!=="object"&&typeof k!="function")return{default:k};var P=p(M);if(P&&P.has(k))return P.get(k);var R={},$=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var G in k)if(G!=="default"&&Object.prototype.hasOwnProperty.call(k,G)){var J=$?Object.getOwnPropertyDescriptor(k,G):null;J&&(J.get||J.set)?Object.defineProperty(R,G,J):R[G]=k[G]}return R.default=k,P&&P.set(k,R),R}function f(k,M,P){var R=.5*P[0],$=.5*P[1],G=.5*P[2],J=M[0],ee=M[1],Z=M[2],ne=M[3];return k[0]=J,k[1]=ee,k[2]=Z,k[3]=ne,k[4]=R*ne+$*Z-G*ee,k[5]=$*ne+G*J-R*Z,k[6]=G*ne+R*ee-$*J,k[7]=-R*J-$*ee-G*Z,k}function w(k,M){return k[0]=M[0],k[1]=M[1],k[2]=M[2],k[3]=M[3],k[4]=M[4],k[5]=M[5],k[6]=M[6],k[7]=M[7],k}function E(k,M,P){var R=M[0],$=M[1],G=M[2],J=M[3],ee=P[4],Z=P[5],ne=P[6],le=P[7],fe=M[4],Ce=M[5],Ee=M[6],Me=M[7],$e=P[0],De=P[1],Ge=P[2],Xe=P[3];return k[0]=R*Xe+J*$e+$*Ge-G*De,k[1]=$*Xe+J*De+G*$e-R*Ge,k[2]=G*Xe+J*Ge+R*De-$*$e,k[3]=J*Xe-R*$e-$*De-G*Ge,k[4]=R*le+J*ee+$*ne-G*Z+fe*Xe+Me*$e+Ce*Ge-Ee*De,k[5]=$*le+J*Z+G*ee-R*ne+Ce*Xe+Me*De+Ee*$e-fe*Ge,k[6]=G*le+J*ne+R*Z-$*ee+Ee*Xe+Me*Ge+fe*De-Ce*$e,k[7]=J*le-R*ee-$*Z-G*ne+Me*Xe-fe*$e-Ce*De-Ee*Ge,k}jt.getReal=i.copy,jt.setReal=i.copy,jt.mul=E;var O=i.dot;jt.dot=O;var x=i.length;jt.length=x,jt.len=x;var C=i.squaredLength;return jt.squaredLength=C,jt.sqrLen=C,jt}var Yi,Wi,vi={};function Wr(){if(Yi)return vi;function s(M){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},s(M)}Yi=1,Object.defineProperty(vi,"__esModule",{value:!0}),vi.create=o,vi.clone=function(M){var P=new e.ARRAY_TYPE(2);return P[0]=M[0],P[1]=M[1],P},vi.fromValues=function(M,P){var R=new e.ARRAY_TYPE(2);return R[0]=M,R[1]=P,R},vi.copy=function(M,P){return M[0]=P[0],M[1]=P[1],M},vi.set=function(M,P,R){return M[0]=P,M[1]=R,M},vi.add=function(M,P,R){return M[0]=P[0]+R[0],M[1]=P[1]+R[1],M},vi.subtract=p,vi.multiply=a,vi.divide=f,vi.ceil=function(M,P){return M[0]=Math.ceil(P[0]),M[1]=Math.ceil(P[1]),M},vi.floor=function(M,P){return M[0]=Math.floor(P[0]),M[1]=Math.floor(P[1]),M},vi.min=function(M,P,R){return M[0]=Math.min(P[0],R[0]),M[1]=Math.min(P[1],R[1]),M},vi.max=function(M,P,R){return M[0]=Math.max(P[0],R[0]),M[1]=Math.max(P[1],R[1]),M},vi.round=function(M,P){return M[0]=Math.round(P[0]),M[1]=Math.round(P[1]),M},vi.scale=function(M,P,R){return M[0]=P[0]*R,M[1]=P[1]*R,M},vi.scaleAndAdd=function(M,P,R,$){return M[0]=P[0]+R[0]*$,M[1]=P[1]+R[1]*$,M},vi.distance=w,vi.squaredDistance=E,vi.length=O,vi.squaredLength=x,vi.negate=function(M,P){return M[0]=-P[0],M[1]=-P[1],M},vi.inverse=function(M,P){return M[0]=1/P[0],M[1]=1/P[1],M},vi.normalize=function(M,P){var R=P[0],$=P[1],G=R*R+$*$;return G>0&&(G=1/Math.sqrt(G)),M[0]=P[0]*G,M[1]=P[1]*G,M},vi.dot=function(M,P){return M[0]*P[0]+M[1]*P[1]},vi.cross=function(M,P,R){var $=P[0]*R[1]-P[1]*R[0];return M[0]=M[1]=0,M[2]=$,M},vi.lerp=function(M,P,R,$){var G=P[0],J=P[1];return M[0]=G+$*(R[0]-G),M[1]=J+$*(R[1]-J),M},vi.random=function(M,P){P=P||1;var R=2*e.RANDOM()*Math.PI;return M[0]=Math.cos(R)*P,M[1]=Math.sin(R)*P,M},vi.transformMat2=function(M,P,R){var $=P[0],G=P[1];return M[0]=R[0]*$+R[2]*G,M[1]=R[1]*$+R[3]*G,M},vi.transformMat2d=function(M,P,R){var $=P[0],G=P[1];return M[0]=R[0]*$+R[2]*G+R[4],M[1]=R[1]*$+R[3]*G+R[5],M},vi.transformMat3=function(M,P,R){var $=P[0],G=P[1];return M[0]=R[0]*$+R[3]*G+R[6],M[1]=R[1]*$+R[4]*G+R[7],M},vi.transformMat4=function(M,P,R){var $=P[0],G=P[1];return M[0]=R[0]*$+R[4]*G+R[12],M[1]=R[1]*$+R[5]*G+R[13],M},vi.rotate=function(M,P,R,$){var G=P[0]-R[0],J=P[1]-R[1],ee=Math.sin($),Z=Math.cos($);return M[0]=G*Z-J*ee+R[0],M[1]=G*ee+J*Z+R[1],M},vi.angle=function(M,P){var R=M[0],$=M[1],G=P[0],J=P[1],ee=Math.sqrt(R*R+$*$)*Math.sqrt(G*G+J*J);return Math.acos(Math.min(Math.max(ee&&(R*G+$*J)/ee,-1),1))},vi.zero=function(M){return M[0]=0,M[1]=0,M},vi.str=function(M){return"vec2("+M[0]+", "+M[1]+")"},vi.exactEquals=function(M,P){return M[0]===P[0]&&M[1]===P[1]},vi.equals=function(M,P){var R=M[0],$=M[1],G=P[0],J=P[1];return Math.abs(R-G)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(G))&&Math.abs($-J)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(J))},vi.forEach=vi.sqrLen=vi.sqrDist=vi.dist=vi.div=vi.mul=vi.sub=vi.len=void 0;var e=function(M,P){if(M&&M.__esModule)return M;if(M===null||s(M)!=="object"&&typeof M!="function")return{default:M};var R=i(void 0);if(R&&R.has(M))return R.get(M);var $={},G=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var J in M)if(J!=="default"&&Object.prototype.hasOwnProperty.call(M,J)){var ee=G?Object.getOwnPropertyDescriptor(M,J):null;ee&&(ee.get||ee.set)?Object.defineProperty($,J,ee):$[J]=M[J]}return $.default=M,R&&R.set(M,$),$}(ve());function i(M){if(typeof WeakMap!="function")return null;var P=new WeakMap,R=new WeakMap;return(i=function($){return $?R:P})(M)}function o(){var M=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0),M}function p(M,P,R){return M[0]=P[0]-R[0],M[1]=P[1]-R[1],M}function a(M,P,R){return M[0]=P[0]*R[0],M[1]=P[1]*R[1],M}function f(M,P,R){return M[0]=P[0]/R[0],M[1]=P[1]/R[1],M}function w(M,P){return Math.hypot(P[0]-M[0],P[1]-M[1])}function E(M,P){var R=P[0]-M[0],$=P[1]-M[1];return R*R+$*$}function O(M){return Math.hypot(M[0],M[1])}function x(M){var P=M[0],R=M[1];return P*P+R*R}vi.len=O,vi.sub=p,vi.mul=a,vi.div=f,vi.dist=w,vi.sqrDist=E,vi.sqrLen=x;var C,k=(C=o(),function(M,P,R,$,G,J){var ee,Z;for(P||(P=2),R||(R=0),Z=$?Math.min($*P+R,M.length):M.length,ee=R;ee<Z;ee+=P)C[0]=M[ee],C[1]=M[ee+1],G(C,C,J),M[ee]=C[0],M[ee+1]=C[1];return M});return vi.forEach=k,vi}function an(){if(Wi)return ae;function s(M){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},s(M)}Wi=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.vec4=ae.vec3=ae.vec2=ae.quat2=ae.quat=ae.mat4=ae.mat3=ae.mat2d=ae.mat2=ae.glMatrix=void 0;var e=k(ve());ae.glMatrix=e;var i=k(Pe());ae.mat2=i;var o=k(rt());ae.mat2d=o;var p=k(at());ae.mat3=p;var a=k(Tt());ae.mat4=a;var f=k(ii());ae.quat=f;var w=k(Ri());ae.quat2=w;var E=k(Wr());ae.vec2=E;var O=k(oi());ae.vec3=O;var x=k(zt());function C(M){if(typeof WeakMap!="function")return null;var P=new WeakMap,R=new WeakMap;return(C=function($){return $?R:P})(M)}function k(M,P){if(M&&M.__esModule)return M;if(M===null||s(M)!=="object"&&typeof M!="function")return{default:M};var R=C(P);if(R&&R.has(M))return R.get(M);var $={},G=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var J in M)if(J!=="default"&&Object.prototype.hasOwnProperty.call(M,J)){var ee=G?Object.getOwnPropertyDescriptor(M,J):null;ee&&(ee.get||ee.set)?Object.defineProperty($,J,ee):$[J]=M[J]}return $.default=M,R&&R.set(M,$),$}return ae.vec4=x,ae}var _n,Cn,qr,es,Ye=an(),ds=function(){if(Cn)return _n;function s(e,i,o,p){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(p-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=p}return Cn=1,_n=s,s.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,p=0;p<8;p++){var a=this.sampleCurveX(o)-e;if(Math.abs(a)<i)return o;var f=this.sampleCurveDerivativeX(o);if(Math.abs(f)<1e-6)break;o-=a/f}var w=0,E=1;for(o=e,p=0;p<20&&(a=this.sampleCurveX(o),!(Math.abs(a-e)<i));p++)e>a?w=o:E=o,o=.5*(E-w)+w;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},_n}(),Bi=q(ds);function Xs(){if(es)return qr;function s(e,i){this.x=e,this.y=i}return es=1,qr=s,s.prototype={clone:function(){return new s(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,o=e.y-this.y;return i*i+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),o=Math.sin(e),p=o*this.x+i*this.y;return this.x=i*this.x-o*this.y,this.y=p,this},_rotateAround:function(e,i){var o=Math.cos(e),p=Math.sin(e),a=i.y+p*(this.x-i.x)+o*(this.y-i.y);return this.x=i.x+o*(this.x-i.x)-p*(this.y-i.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},s.convert=function(e){return e instanceof s?e:Array.isArray(e)?new s(e[0],e[1]):e},qr}var Wt=q(Xs());function jn(s,e){if(Array.isArray(s)){if(!Array.isArray(e)||s.length!==e.length)return!1;for(let i=0;i<s.length;i++)if(!jn(s[i],e[i]))return!1;return!0}if(typeof s=="object"&&s!==null&&e!==null){if(typeof e!="object"||Object.keys(s).length!==Object.keys(e).length)return!1;for(const i in s)if(!jn(s[i],e[i]))return!1;return!0}return s===e}const As=Math.PI/180,mo=180/Math.PI;function rr(s){return s*As}function $n(s){return s*mo}const xs=[[0,0],[1,0],[1,1],[0,1]];function Ea(s){if(s<=0)return 0;if(s>=1)return 1;const e=s*s,i=e*s;return 4*(s<.5?i:3*(s-e)+i-.75)}function xr(s,e,i,o){const p=new Bi(s,e,i,o);return function(a){return p.solve(a)}}const go=xr(.25,.1,.25,1);function nr(s,e,i){return Math.min(i,Math.max(e,s))}function Kr(s,e,i){return(i=nr((i-s)/(e-s),0,1))*i*(3-2*i)}function ra(s,e,i){const o=i-e,p=((s-e)%o+o)%o+e;return p===e?i:p}function dl(s,e,i){if(!s.length)return i(null,[]);let o=s.length;const p=new Array(s.length);let a=null;s.forEach((f,w)=>{e(f,(E,O)=>{E&&(a=E),p[w]=O,--o==0&&i(a,p)})})}function Zs(s,...e){for(const i of e)for(const o in i)s[o]=i[o];return s}let Ca=1;function $a(){return Ca++}function Nc(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Vc(s,e){s.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function ro(s,e){return s.indexOf(e,s.length-e.length)!==-1}function na(s,e,i){const o={};for(const p in s)o[p]=e.call(this,s[p],p,s);return o}function pl(s,e,i){const o={};for(const p in s)e.call(this,s[p],p,s)&&(o[p]=s[p]);return o}function zn(s){return Array.isArray(s)?s.map(zn):typeof s=="object"&&s?na(s,zn):s}const Aa={};function qi(s){Aa[s]||(typeof console<"u"&&console.warn(s),Aa[s]=!0)}function Fn(s,e,i){return(i.y-s.y)*(e.x-s.x)>(e.y-s.y)*(i.x-s.x)}function $u(s){let e=0;for(let i,o,p=0,a=s.length,f=a-1;p<a;f=p++)i=s[p],o=s[f],e+=(o.x-i.x)*(i.y+o.y);return e}function Jr([s,e,i]){const o=rr(e+90),p=rr(i);return{x:s*Math.cos(o)*Math.sin(p),y:s*Math.sin(o)*Math.sin(p),z:s*Math.cos(p),azimuthal:e,polar:i}}function Pa(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Uc(s){const e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,p,a)=>{const f=p||a;return e[o]=!f||f.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let fl=null;function jc(s,e){return[s[4*e],s[4*e+1],s[4*e+2],s[4*e+3]]}function Ps(s,e,i,o){for(;e<i;){const p=e+i>>1;s[p]<o?e=p+1:i=p}return e}function $c(s,e,i,o){for(;e<i;){const p=e+i>>1;s[p]<=o?e=p+1:i=p}return e}function zh(s){return s>0?1/(1.001-s):1+s}function Fh(s){return s>0?1-1/(1.001-s):-s}const ts={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ts.API_URL)return null;try{const s=new URL(ts.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Jl(s){return ts.API_URL_REGEX.test(s)}function Gu(s){return ts.API_SPRITE_REGEX.test(s)}let Hu,Is,Ho,vt,se,me;function be(){return Hu==null&&(Hu=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Hu}const Fe={now:()=>vt!==void 0?vt:performance.now(),setNow(s){vt=s},restoreNow(){vt=void 0},frame(s){const e=requestAnimationFrame(s);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(s,e=0){const{width:i,height:o}=s;se||(se=document.createElement("canvas"));const p=se.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(i>se.width||o>se.height)&&(se.width=i,se.height=o),p.clearRect(-e,-e,i+2*e,o+2*e),p.drawImage(s,0,0,i,o),p.getImageData(-e,-e,i+2*e,o+2*e)},resolveURL:s=>(Is||(Is=document.createElement("a")),Is.href=s,Is.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ho==null&&(Ho=window.matchMedia("(prefers-reduced-motion: reduce)")),Ho.matches)},hasCanvasFingerprintNoise(){if(me!==void 0)return me;if(!be())return me=!1,!1;const s=new OffscreenCanvas(85,1),e=s.getContext("2d",{willReadFrequently:!0});let i=0;for(let p=0;p<s.width;++p)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(p,0,1,1);const o=e.getImageData(0,0,s.width,s.height);i=0;for(let p=0;p<o.data.length;++p)if(p%4!=3&&i++!==o.data[p])return me=!0,!0;return me=!1,!1}};function je(s,e){const i=s.indexOf("?");if(i<0)return`${s}?${new URLSearchParams(e).toString()}`;const o=new URLSearchParams(s.slice(i));for(const p in e)o.set(p,e[p]);return`${s.slice(0,i)}?${o.toString()}`}function Ze(s,e={persistentParams:[]}){const i=s.indexOf("?");if(i<0)return s;const o=new URLSearchParams,p=new URLSearchParams(s.slice(i));for(const f of e.persistentParams){const w=p.get(f);w&&o.set(f,w)}const a=o.toString();return`${s.slice(0,i)}${a.length>0?`?${a}`:""}`}const lt="mapbox-tiles";let Je=500,mt=50;const pt=["language","worldview","jobid"];let yt,Lt;function Zt(){try{return caches}catch{}}function Jt(){const s=Zt();s&&yt==null&&(yt=s.open(lt))}let pi=1/0;const Di={supported:!1,testSupport:function(s){!dr&&Pi&&(br?wr(s):ki=s)}};let ki,Pi,dr=!1,br=!1;const sr=typeof self<"u"?self:{};function wr(s){const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Pi),s.isContextLost())return;Di.supported=!0}catch{}s.deleteTexture(e),dr=!0}sr.document&&(Pi=sr.document.createElement("img"),Pi.onload=function(){ki&&wr(ki),ki=null,br=!0},Pi.onerror=function(){dr=!0,ki=null},Pi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Pr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Pr);class Bn extends Error{constructor(e,i,o){i===401&&Jl(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ia=Pa()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,is=function(s,e){if(!(/^file:/.test(i=s.url)||/^file:/.test(Ia())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,p){const a=new AbortController,f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Ia(),referrerPolicy:o.referrerPolicy,signal:a.signal});let w=!1,E=!1;const O=(x=f.url).indexOf("sku=")>0&&Jl(x);var x;o.type==="json"&&f.headers.set("Accept","application/json");const C=(M,P,R)=>{if(E)return;if(M&&M.message!=="SecurityError"&&qi(M.toString()),P&&R)return k(P);const $=Date.now();fetch(f).then(G=>{if(G.ok){const J=O?G.clone():null;return k(G,J,$)}return p(new Bn(G.statusText,G.status,o.url))}).catch(G=>{G.name!=="AbortError"&&p(new Error(`${G.message} ${o.url}`))})},k=(M,P,R)=>{(o.type==="arrayBuffer"?M.arrayBuffer():o.type==="json"?M.json():M.text()).then($=>{E||(P&&R&&function(G,J,ee){if(Jt(),yt==null)return;const Z=Uc(J.headers.get("Cache-Control")||"");if(Z["no-store"])return;const ne={status:J.status,statusText:J.statusText,headers:new Headers};J.headers.forEach((Ce,Ee)=>ne.headers.set(Ee,Ce)),Z["max-age"]&&ne.headers.set("Expires",new Date(ee+1e3*Z["max-age"]).toUTCString());const le=ne.headers.get("Expires");if(!le||new Date(le).getTime()-ee<42e4)return;let fe=Ze(G.url,{persistentParams:pt});if(J.status===206){const Ce=G.headers.get("Range");if(!Ce)return;ne.status=200,fe=je(fe,{range:Ce})}(function(Ce,Ee){if(Lt===void 0)try{new Response(new ReadableStream),Lt=!0}catch{Lt=!1}Lt?Ee(Ce.body):Ce.blob().then(Ee)})(J,Ce=>{const Ee=new Response((Me=J.status)!==200&&Me!==404&&[101,103,204,205,304].includes(Me)?null:Ce,ne);var Me;Jt(),yt!=null&&yt.then($e=>$e.put(fe,Ee)).catch($e=>qi($e.message))})}(f,P,R),w=!0,p(null,$,M.headers.get("Cache-Control"),M.headers.get("Expires")))}).catch($=>{E||p(new Error($.message))})};return O?function(M,P){if(Jt(),yt==null)return P(null);yt.then(R=>{let $=Ze(M.url,{persistentParams:pt});const G=M.headers.get("Range");G&&($=je($,{range:G})),R.match($).then(J=>{const ee=function(Z){if(!Z)return!1;const ne=new Date(Z.headers.get("Expires")||0),le=Uc(Z.headers.get("Cache-Control")||"");return ne>Date.now()&&!le["no-cache"]}(J);R.delete($),ee&&R.put($,J.clone()),P(null,J,ee)}).catch(P)}).catch(P)}(f,C):C(null,null),{cancel:()=>{E=!0,w||a.abort()}}}(s,e);if(Pa()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,e,void 0,!0)}var i;return function(o,p){const a=new XMLHttpRequest;a.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(a.responseType="arraybuffer");for(const f in o.headers)a.setRequestHeader(f,o.headers[f]);return o.type==="json"&&(a.responseType="text",a.setRequestHeader("Accept","application/json")),a.withCredentials=o.credentials==="include",a.onerror=()=>{p(new Error(a.statusText))},a.onload=()=>{if((a.status>=200&&a.status<300||a.status===0)&&a.response!==null){let f=a.response;if(o.type==="json")try{f=JSON.parse(a.response)}catch(w){return p(w)}p(null,f,a.getResponseHeader("Cache-Control"),a.getResponseHeader("Expires"))}else p(new Bn(a.statusText,a.status,o.url))},a.send(o.body),{cancel:()=>a.abort()}}(s,e)},Nn=function(s,e){return is(Zs(s,{type:"arrayBuffer"}),e)};function $s(s){const e=document.createElement("a");return e.href=s,e.protocol===location.protocol&&e.host===location.host}const Gc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Wo,Hc;Wo=[],Hc=0;const Po=function(s,e){if(Di.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),Hc>=ts.MAX_PARALLEL_IMAGE_REQUESTS){const a={requestParameters:s,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Wo.push(a),a}Hc++;let i=!1;const o=()=>{if(!i)for(i=!0,Hc--;Wo.length&&Hc<ts.MAX_PARALLEL_IMAGE_REQUESTS;){const a=Wo.shift(),{requestParameters:f,callback:w,cancelled:E}=a;E||(a.cancel=Po(f,w).cancel)}},p=Nn(s,(a,f,w,E)=>{o(),a?e(a):f&&(self.createImageBitmap?function(O,x){const C=new Blob([new Uint8Array(O)],{type:"image/png"});createImageBitmap(C).then(k=>{x(null,k)}).catch(k=>{x(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(O,x)=>e(O,x,w,E)):function(O,x){const C=new Image;C.onload=()=>{x(null,C),URL.revokeObjectURL(C.src),C.onload=null,requestAnimationFrame(()=>{C.src=Gc})},C.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const k=new Blob([new Uint8Array(O)],{type:"image/png"});C.src=O.byteLength?URL.createObjectURL(k):Gc}(f,(O,x)=>e(O,x,w,E)))});return{cancel:()=>{p.cancel(),o()}}};var Wc,Hd,Wd,Ks={exports:{}},Io={exports:{}},qo={exports:{}},Da=function(){if(Wd)return Ks.exports;Wd=1;var s=(Wc||(Wc=1,Io.exports=function(i,o){var p,a,f,w,E,O,x,C;for(a=i.length-(p=3&i.length),f=o,E=3432918353,O=461845907,C=0;C<a;)x=255&i.charCodeAt(C)|(255&i.charCodeAt(++C))<<8|(255&i.charCodeAt(++C))<<16|(255&i.charCodeAt(++C))<<24,++C,f=27492+(65535&(w=5*(65535&(f=(f^=x=(65535&(x=(x=(65535&x)*E+(((x>>>16)*E&65535)<<16)&4294967295)<<15|x>>>17))*O+(((x>>>16)*O&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(x=0,p){case 3:x^=(255&i.charCodeAt(C+2))<<16;case 2:x^=(255&i.charCodeAt(C+1))<<8;case 1:f^=x=(65535&(x=(x=(65535&(x^=255&i.charCodeAt(C)))*E+(((x>>>16)*E&65535)<<16)&4294967295)<<15|x>>>17))*O+(((x>>>16)*O&65535)<<16)&4294967295}return f^=i.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),Io.exports),e=(Hd||(Hd=1,qo.exports=function(i,o){for(var p,a=i.length,f=o^a,w=0;a>=4;)p=1540483477*(65535&(p=255&i.charCodeAt(w)|(255&i.charCodeAt(++w))<<8|(255&i.charCodeAt(++w))<<16|(255&i.charCodeAt(++w))<<24))+((1540483477*(p>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),a-=4,++w;switch(a){case 3:f^=(255&i.charCodeAt(w+2))<<16;case 2:f^=(255&i.charCodeAt(w+1))<<8;case 1:f=1540483477*(65535&(f^=255&i.charCodeAt(w)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),qo.exports);return Ks.exports=s,Ks.exports.murmur3=s,Ks.exports.murmur2=e,Ks.exports}(),sa=q(Da);class oa{constructor(e,...i){Zs(this,i[0]||{}),this.type=e}}class Wu extends oa{constructor(e,i={}){super("error",Zs({error:e},i))}}function ml(s,e,i){i[s]&&i[s].indexOf(e)!==-1||(i[s]=i[s]||[],i[s].push(e))}function gl(s,e,i){if(i&&i[s]){const o=i[s].indexOf(e);o!==-1&&i[s].splice(o,1)}}class aa{on(e,i){return this._listeners=this._listeners||{},ml(e,i,this._listeners),this}off(e,i){return gl(e,i,this._listeners),gl(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},ml(e,i,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,i){const o=typeof e=="string"?new oa(e,i):e,p=o.type;if(this.listens(p)){o.target=this;const a=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const E of a)E.call(this,o);const f=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const E of f)gl(p,E,this._oneTimeListeners),E.call(this,o);const w=this._eventedParent;w&&(Zs(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(o))}else o instanceof Wu&&console.error(o.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var gf,qd={},Yo=function(){if(gf)return qd;gf=1;var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(a){return(a=Math.round(a))<0?0:a>255?255:a}function i(a){return e(a[a.length-1]==="%"?parseFloat(a)/100*255:parseInt(a))}function o(a){return(f=a[a.length-1]==="%"?parseFloat(a)/100:parseFloat(a))<0?0:f>1?1:f;var f}function p(a,f,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?a+(f-a)*w*6:2*w<1?f:3*w<2?a+(f-a)*(2/3-w)*6:a}try{qd.parseCSSColor=function(a){var f,w=a.replace(/ /g,"").toLowerCase();if(w in s)return s[w].slice();if(w[0]==="#")return w.length===4?(f=parseInt(w.substr(1),16))>=0&&f<=4095?[(3840&f)>>4|(3840&f)>>8,240&f|(240&f)>>4,15&f|(15&f)<<4,1]:null:w.length===7&&(f=parseInt(w.substr(1),16))>=0&&f<=16777215?[(16711680&f)>>16,(65280&f)>>8,255&f,1]:null;var E=w.indexOf("("),O=w.indexOf(")");if(E!==-1&&O+1===w.length){var x=w.substr(0,E),C=w.substr(E+1,O-(E+1)).split(","),k=1;switch(x){case"rgba":if(C.length!==4)return null;k=o(C.pop());case"rgb":return C.length!==3?null:[i(C[0]),i(C[1]),i(C[2]),k];case"hsla":if(C.length!==4)return null;k=o(C.pop());case"hsl":if(C.length!==3)return null;var M=(parseFloat(C[0])%360+360)%360/360,P=o(C[1]),R=o(C[2]),$=R<=.5?R*(P+1):R+P-R*P,G=2*R-$;return[e(255*p(G,$,M+1/3)),e(255*p(G,$,M)),e(255*p(G,$,M-1/3)),k];default:return null}}return null}}catch{}return qd}();class Ar{constructor(e,i,o,p=1){this.r=e,this.g=i,this.b=o,this.a=p}static parse(e){if(!e)return;if(e instanceof Ar)return e;if(typeof e!="string")return;const i=Yo.parseCSSColor(e);return i?new Ar(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toStringPremultipliedAlpha(){const[e,i,o,p]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(o)},${p})`}toString(){const[e,i,o,p]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*o)},${p})`}toRenderColor(e){const{r:i,g:o,b:p,a}=this;return new Yd(e,i,o,p,a)}clone(){return new Ar(this.r,this.g,this.b,this.a)}}class Yd{constructor(e,i,o,p,a){if(e){const f=e.image.height,w=f*f;i=a===0?0:i/a*(f-1),o=a===0?0:o/a*(f-1),p=a===0?0:p/a*(f-1);const E=Math.floor(i),O=Math.floor(o),x=Math.floor(p),C=Math.ceil(i),k=Math.ceil(o),M=Math.ceil(p),P=i-E,R=o-O,$=p-x,G=e.image.data,J=4*(E+O*w+x*f),ee=4*(E+O*w+M*f),Z=4*(E+k*w+x*f),ne=4*(E+k*w+M*f),le=4*(C+O*w+x*f),fe=4*(C+O*w+M*f),Ce=4*(C+k*w+x*f),Ee=4*(C+k*w+M*f);if(J<0||Ee>=G.length)throw new Error("out of range");this.r=Ii(Ii(Ii(G[J],G[ee],$),Ii(G[Z],G[ne],$),R),Ii(Ii(G[le],G[fe],$),Ii(G[Ce],G[Ee],$),R),P)/255*a,this.g=Ii(Ii(Ii(G[J+1],G[ee+1],$),Ii(G[Z+1],G[ne+1],$),R),Ii(Ii(G[le+1],G[fe+1],$),Ii(G[Ce+1],G[Ee+1],$),R),P)/255*a,this.b=Ii(Ii(Ii(G[J+2],G[ee+2],$),Ii(G[Z+2],G[ne+2],$),R),Ii(Ii(G[le+2],G[fe+2],$),Ii(G[Ce+2],G[Ee+2],$),R),P)/255*a,this.a=a}else this.r=i,this.g=o,this.b=p,this.a=a}toArray(){const{r:e,g:i,b:o,a:p}=this;return p===0?[0,0,0,0]:[255*e/p,255*i/p,255*o/p,p]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:i,b:o,a:p}=this,a=Math.min(Math.max(e/p,0),1),f=Math.min(Math.max(i/p,0),1),w=Math.min(Math.max(o/p,0),1),E=Math.min(a,f,w),O=Math.max(a,f,w),x=(E+O)/2;if(E===O)return[0,0,100*x,p];const C=O-E,k=x>.5?C/(2-O-E):C/(O+E);let M=0;return O===a?M=(f-w)/C+(f<w?6:0):O===f?M=(w-a)/C+2:O===w&&(M=(a-f)/C+4),M*=60,[Math.min(Math.max(M,0),360),Math.min(Math.max(100*k,0),100),Math.min(Math.max(100*x,0),100),p]}toArray01(){const{r:e,g:i,b:o,a:p}=this;return p===0?[0,0,0,0]:[e/p,i/p,o/p,p]}toArray01Scaled(e){const{r:i,g:o,b:p,a}=this;return a===0?[0,0,0]:[i/a*e,o/a*e,p/a*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:o,a:p}=this;return[e,i,o,p]}toArray01Linear(){const{r:e,g:i,b:o,a:p}=this;return p===0?[0,0,0,0]:[Math.pow(e/p,2.2),Math.pow(i/p,2.2),Math.pow(o/p,2.2),p]}}function Ii(s,e,i){return s*(1-i)+e*i}function Xd(s,e,i){return s.map((o,p)=>Ii(o,e[p],i))}Ar.black=new Ar(0,0,0,1),Ar.white=new Ar(1,1,1,1),Ar.transparent=new Ar(0,0,0,0),Ar.red=new Ar(1,0,0,1),Ar.blue=new Ar(0,0,1,1);var Do=Object.freeze({__proto__:null,array:Xd,color:function(s,e,i){return new Ar(Ii(s.r,e.r,i),Ii(s.g,e.g,i),Ii(s.b,e.b,i),Ii(s.a,e.a,i))},number:Ii});function Bh(s,...e){for(const i of e)for(const o in i)s[o]=i[o];return s}class Ji extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class qc{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,p]of i)this.bindings[o]=p}concat(e){return new qc(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Ga={kind:"null"},yi={kind:"number"},Lr={kind:"string"},Sr={kind:"boolean"},Gs={kind:"color"},ka={kind:"object"},Tr={kind:"value"},Oa={kind:"collator"},ps={kind:"formatted"},_l={kind:"resolvedImage"};function bs(s,e){return{kind:"array",itemType:s,N:e}}function wn(s){if(s.kind==="array"){const e=wn(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}return s.kind}const Zd=[Ga,yi,Lr,Sr,Gs,ps,ka,bs(Tr),_l];function Js(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Js(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(const i of Zd)if(!Js(i,e))return null}}return`Expected ${wn(s)} but found ${wn(e)} instead.`}function rs(s,e){return e.some(i=>i.kind===s.kind)}function _o(s,e){return e.some(i=>i==="null"?s===null:i==="array"?Array.isArray(s):i==="object"?s&&!Array.isArray(s)&&typeof s=="object":i===typeof s)}class qu{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Yu{constructor(e,i,o,p,a){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=p,this.textColor=a}}class Ds{constructor(e){this.sections=e}static fromString(e){return new Ds([new Yu(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary)}static factory(e){return e instanceof Ds?e:Ds.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);const o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(o)}return e}}class yo{constructor(e,i){if(this.id=e,this.options=i||{params:{}},this.options.transform){const{a:o,b:p,c:a,d:f,e:w,f:E}=this.options.transform;this.options.transform=new DOMMatrix([o,p,a,f,w,E])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}static deserializeId(e){return JSON.parse(e).id}static deserializeFromString(e){const i=JSON.parse(e),{a:o,b:p,c:a,d:f,e:w,f:E}=i.options.transform;return new DOMMatrix([o,p,a,f,w,E]),new yo(i.id,i.options)}scaleSelf(e){return this.options.transform=this.options.transform.scale(e),this}serialize(){const e={id:this.id};this.options&&(e.options=this.options);const{a:i,b:o,c:p,d:a,e:f,f:w}=this.options.transform;return e.options.transform={a:i,b:o,c:p,d:a,e:f,f:w},JSON.stringify(e)}}class ks{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),e.optionsPrimary&&(this.optionsPrimary=e.optionsPrimary),e.optionsSecondary&&(this.optionsSecondary=e.optionsSecondary),this.available=e.available}toString(){return this.namePrimary&&this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}getPrimary(){return new yo(this.namePrimary,{params:this.optionsPrimary&&this.optionsPrimary.params||{}})}getSerializedPrimary(){return this.getPrimary().serialize()}getSecondary(){return this.nameSecondary?new yo(this.nameSecondary,{params:this.optionsSecondary&&this.optionsSecondary.params||{}}):null}static from(e){return typeof e=="string"?ks.build(e):e}static build(e,i,o,p){return e?new ks({namePrimary:e,nameSecondary:i,optionsPrimary:o,optionsSecondary:p,available:!1}):null}}function Yc(s,e,i,o){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[s,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[s,e,i,o]:[s,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function La(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Ar||s instanceof qu||s instanceof Ds||s instanceof ks)return!0;if(Array.isArray(s)){for(const e of s)if(!La(e))return!1;return!0}if(typeof s=="object"){for(const e in s)if(!La(s[e]))return!1;return!0}return!1}function Qr(s){if(s===null)return Ga;if(typeof s=="string")return Lr;if(typeof s=="boolean")return Sr;if(typeof s=="number")return yi;if(s instanceof Ar)return Gs;if(s instanceof qu)return Oa;if(s instanceof Ds)return ps;if(s instanceof ks)return _l;if(Array.isArray(s)){const e=s.length;let i;for(const o of s){const p=Qr(o);if(i){if(i===p)continue;i=Tr;break}i=p}return bs(i||Tr,e)}return ka}function ko(s){const e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof Ar?s.toStringPremultipliedAlpha():s instanceof Ds||s instanceof ks?s.toString():JSON.stringify(s)}class ws{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!La(e[1]))return i.error("invalid value");const o=e[1];let p=Qr(o);const a=i.expectedType;return p.kind!=="array"||p.N!==0||!a||a.kind!=="array"||typeof a.N=="number"&&a.N!==0||(p=a),new ws(p,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ar?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Ds?this.value.serialize():this.value}}class yn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Xc={string:Lr,number:yi,boolean:Sr,object:ka};class Xo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,p=1;const a=e[0];if(a==="array"){let w,E;if(e.length>2){const O=e[1];if(typeof O!="string"||!(O in Xc)||O==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);w=Xc[O],p++}else w=Tr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);E=e[2],p++}o=bs(w,E)}else o=Xc[a];const f=[];for(;p<e.length;p++){const w=i.parse(e[p],p,Tr);if(!w)return null;f.push(w)}return new Xo(o,f)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!Js(this.type,Qr(o)))return o;if(i===this.args.length-1)throw new yn(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${wn(Qr(o))} but was expected to be of type ${wn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);const p=e.N;(typeof p=="number"||this.args.length>1)&&i.push(p)}}return i.concat(this.args.map(o=>o.serialize()))}}class Ha{constructor(e){this.type=ps,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const p=[];let a=!1;for(let f=1;f<=e.length-1;++f){const w=e[f];if(a&&typeof w=="object"&&!Array.isArray(w)){a=!1;let E=null;if(w["font-scale"]&&(E=i.parseObjectValue(w["font-scale"],f,"font-scale",yi),!E))return null;let O=null;if(w["text-font"]&&(O=i.parseObjectValue(w["text-font"],f,"text-font",bs(Lr)),!O))return null;let x=null;if(w["text-color"]&&(x=i.parseObjectValue(w["text-color"],f,"text-color",Gs),!x))return null;const C=p[p.length-1];C.scale=E,C.font=O,C.textColor=x}else{const E=i.parse(e[f],f,Tr);if(!E)return null;const O=E.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");a=!0,p.push({content:E,scale:null,font:null,textColor:null})}}return new Ha(p)}evaluate(e){return new Ds(this.sections.map(i=>{const o=i.content.evaluate(e);return Qr(o)===_l?new Yu("",o,null,null,null):new Yu(ko(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class Zc{constructor(e,i,o,p){this._imageWarnHistory={},this.type=_l,this.inputPrimary=e,this.inputSecondary=i,this.inputPrimaryParams=o,this.inputSecondaryParams=p}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let o=1;const p=[];function a(){if(o<e.length){const w=i.parse(e[o],o++,Lr);return w?(p.push({image:w,options:void 0}),!0):(i.error(p.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function f(){if(o<e.length){if((w=e[o])===null||typeof w!="object"||Array.isArray(w))return!0;const E=e[o].params,O=i.concat(o);if(!E)return o++,!0;if(typeof E!="object"||E.constructor!==Object)return O.error('Image options "params" should be an object'),!1;const x={},C=O.concat(void 0,"params");for(const k in E){if(!k)return C.error("Image parameter name should be non-empty"),!1;const M=C.concat(void 0,k).parse(E[k],void 0,Gs,void 0,{typeAnnotation:"coerce"});if(!M)return!1;x[k]=M}return p[p.length-1].options=x,o++,!0}var w;return!0}for(let w=0;w<2;w++)if(!a()||!f())return;return new Zc(p[0].image,p[1]?p[1].image:void 0,p[0].options,p[1]?p[1].options:void 0)}evaluateParams(e,i){const o={};if(i){for(const p in i)if(i[p])try{const a=i[p].evaluate(e),f=`Ignoring image parameter "${p}" with semi-transparent color ${a.toString()}`;if(a.a!==1){this._imageWarnHistory[f]||(console.warn(f),this._imageWarnHistory[f]=!0);continue}o[p]=a}catch{continue}if(Object.keys(o).length!==0)return{params:o}}}evaluate(e){const i=ks.build(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0,this.inputPrimaryParams?this.evaluateParams(e,this.inputPrimaryParams):void 0,this.inputSecondaryParams?this.evaluateParams(e,this.inputSecondaryParams):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){if(e(this.inputPrimary),this.inputPrimaryParams)for(const i in this.inputPrimaryParams)this.inputPrimaryParams[i]&&e(this.inputPrimaryParams[i]);if(this.inputSecondary&&(e(this.inputSecondary),this.inputSecondaryParams))for(const i in this.inputSecondaryParams)this.inputSecondaryParams[i]&&e(this.inputSecondaryParams[i])}outputDefined(){return!1}serializeParams(e){const i={};if(e){for(const o in e)e[o]&&(i[o]=e[o].serialize());return{params:i}}}serialize(){const e=["image",this.inputPrimary.serialize()];return this.inputPrimaryParams&&e.push(this.serializeParams(this.inputPrimaryParams)),this.inputSecondary&&(e.push(this.inputSecondary.serialize()),this.inputSecondaryParams&&e.push(this.serializeParams(this.inputSecondaryParams))),e}}function Oo(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}const Kd={"to-boolean":Sr,"to-color":Gs,"to-number":yi,"to-string":Lr};class Ra{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0],p=[];let a=Ga;if(o==="to-array"){if(!Array.isArray(e[1]))return null;const f=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);a=bs(i.expectedType.itemType,f)}else{if(!(f>0&&La(e[1][0])))return null;a=bs(Qr(e[1][0]),f)}for(let w=0;w<f;w++){const E=e[1][w];let O;if(Oo(E)==="array")O=i.parse(E,void 0,a.itemType);else{const x=Oo(E);if(x!==a.itemType.kind)return i.error(`Expected ${a.itemType.kind} but found ${x}.`);O=i.registry.literal.parse(["literal",E===void 0?null:E],i)}if(!O)return null;p.push(O)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");a=Kd[o];for(let f=1;f<e.length;f++){const w=i.parse(e[f],f,Tr);if(!w)return null;p.push(w)}}return new Ra(a,p)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,o;for(const p of this.args){if(i=p.evaluate(e),o=null,i instanceof Ar)return i;if(typeof i=="string"){const a=e.parseColor(i);if(a)return a}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Yc(i[0],i[1],i[2],i[3]),!o))return new Ar(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new yn(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const p=Number(i);if(!isNaN(p))return p}throw new yn(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Ds.fromString(ko(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ks.build(ko(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):ko(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ha([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Zc(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Jd=["Unknown","Point","LineString","Polygon"];class Qd{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Jd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:o,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*i-e[0])+this.featureDistanceData.bearing[1]*(p*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Ar.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class no{constructor(e,i,o,p,a){this.name=e,this.type=i,this._evaluate=o,this.args=p,this._overloadIndex=a}evaluate(e){if(!this._evaluate){const i=no.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const o=e[0],p=no.definitions[o];if(!p)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const a=Array.isArray(p)?p[0]:p.type,f=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=[];let E=null,O=-1;for(const[x,C]of f){if(Array.isArray(x)&&x.length!==e.length-1)continue;w.push(x),O++,E=new su(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const k=[];let M=!1;for(let P=1;P<e.length;P++){const R=e[P],$=Array.isArray(x)?x[P-1]:x.type,G=E.parse(R,1+k.length,$);if(!G){M=!0;break}k.push(G)}if(!M)if(Array.isArray(x)&&x.length!==k.length)E.error(`Expected ${x.length} arguments, but found ${k.length} instead.`);else{for(let P=0;P<k.length;P++){const R=Array.isArray(x)?x[P]:x.type,$=k[P];E.concat(P+1).checkSubtype(R,$.type)}if(E.errors.length===0)return new no(o,a,C,k,O)}}if(w.length===1)i.errors.push(...E.errors);else{const x=(w.length?w:f.map(([k])=>k)).map(ep).join(" | "),C=[];for(let k=1;k<e.length;k++){const M=i.parse(e[k],1+C.length);if(!M)return null;C.push(wn(M.type))}i.error(`Expected arguments of type ${x}, but found (${C.join(", ")}) instead.`)}return null}static register(e,i){no.definitions=i;for(const o in i)e[o]=no}}function ep(s){return Array.isArray(s)?`(${s.map(wn).join(", ")})`:`(${wn(s.type)}...)`}class Nh{constructor(e,i,o){this.type=Oa,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const p=o["case-sensitive"]===void 0?i.parse(!1,1,Sr):i.parseObjectValue(o["case-sensitive"],1,"case-sensitive",Sr);if(!p)return null;const a=o["diacritic-sensitive"]===void 0?i.parse(!1,1,Sr):i.parseObjectValue(o["diacritic-sensitive"],1,"diacritic-sensitive",Sr);if(!a)return null;let f=null;return o.locale&&(f=i.parseObjectValue(o.locale,1,"locale",Lr),!f)?null:new Nh(p,a,f)}evaluate(e){return new qu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Xu(s,e,i=0,o=s.length-1,p=Vm){for(;o>i;){if(o-i>600){const E=o-i+1,O=e-i+1,x=Math.log(E),C=.5*Math.exp(2*x/3),k=.5*Math.sqrt(x*C*(E-C)/E)*(O-E/2<0?-1:1);Xu(s,e,Math.max(i,Math.floor(e-O*C/E+k)),Math.min(o,Math.floor(e+(E-O)*C/E+k)),p)}const a=s[e];let f=i,w=o;for(Ql(s,i,e),p(s[o],a)>0&&Ql(s,i,o);f<w;){for(Ql(s,f,w),f++,w--;p(s[f],a)<0;)f++;for(;p(s[w],a)>0;)w--}p(s[i],a)===0?Ql(s,i,w):(w++,Ql(s,w,o)),w<=e&&(i=w+1),e<=w&&(o=w-1)}}function Ql(s,e,i){const o=s[e];s[e]=s[i],s[i]=o}function Vm(s,e){return s<e?-1:s>e?1:0}function Um(s){let e=0;for(let i,o,p=0,a=s.length,f=a-1;p<a;f=p++)i=s[p],o=s[f],e+=(o.x-i.x)*(i.y+o.y);return e}function Zu(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function Kc(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function Jc(s,e,i){const o=s[0]-e[0],p=s[1]-e[1],a=s[0]-i[0],f=s[1]-i[1];return o*f-a*p==0&&o*a<=0&&p*f<=0}function ec(s,e,i=!1){let o=!1;for(let w=0,E=e.length;w<E;w++){const O=e[w];for(let x=0,C=O.length,k=C-1;x<C;k=x++){const M=O[k],P=O[x];if(Jc(s,M,P))return i;(a=M)[1]>(p=s)[1]!=(f=P)[1]>p[1]&&p[0]<(f[0]-a[0])*(p[1]-a[1])/(f[1]-a[1])+a[0]&&(o=!o)}}var p,a,f;return o}function Vh(s,e,i,o){const p=o[0]-i[0],a=o[1]-i[1],f=(s[0]-i[0])*a-p*(s[1]-i[1]),w=(e[0]-i[0])*a-p*(e[1]-i[1]);return f>0&&w<0||f<0&&w>0}function Wa(s,e,i,o){return(p=[o[0]-i[0],o[1]-i[1]])[0]*(a=[e[0]-s[0],e[1]-s[1]])[1]-p[1]*a[0]!=0&&!(!Vh(s,e,i,o)||!Vh(i,o,s,e));var p,a}const yl=8192;function jm(s,e){const i=(180+s[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,p=Math.pow(2,e.z);return[Math.round(i*p*yl),Math.round(o*p*yl)]}function tc(s,e){for(let i=0;i<e.length;i++)if(ec(s,e[i]))return!0;return!1}function tp(s,e,i){for(const o of i)for(let p=0,a=o.length,f=a-1;p<a;f=p++)if(Wa(s,e,o[f],o[p]))return!0;return!1}function Ku(s,e){for(let i=0;i<s.length;++i)if(!ec(s[i],e))return!1;for(let i=0;i<s.length-1;++i)if(tp(s[i],s[i+1],e))return!1;return!0}function Uh(s,e){for(let i=0;i<e.length;i++)if(Ku(s,e[i]))return!0;return!1}function ip(s,e,i){const o=[];for(let p=0;p<s.length;p++){const a=[];for(let f=0;f<s[p].length;f++){const w=jm(s[p][f],i);Zu(e,w),a.push(w)}o.push(a)}return o}function vl(s,e,i){const o=[];for(let p=0;p<s.length;p++){const a=ip(s[p],e,i);o.push(a)}return o}function Xi(s,e,i,o){if(s[0]<i[0]||s[0]>i[2]){const p=.5*o;let a=s[0]-i[0]>p?-o:i[0]-s[0]>p?o:0;a===0&&(a=s[0]-i[2]>p?-o:i[2]-s[0]>p?o:0),s[0]+=a}Zu(e,s)}function Si(s,e,i,o){const p=Math.pow(2,o.z)*yl,a=[o.x*yl,o.y*yl],f=[];if(!s)return f;for(const w of s)for(const E of w){const O=[E.x+a[0],E.y+a[1]];Xi(O,e,i,p),f.push(O)}return f}function jh(s,e,i,o){const p=Math.pow(2,o.z)*yl,a=[o.x*yl,o.y*yl],f=[];if(!s)return f;for(const E of s){const O=[];for(const x of E){const C=[x.x+a[0],x.y+a[1]];Zu(e,C),O.push(C)}f.push(O)}if(e[2]-e[0]<=p/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const E of f)for(const O of E)Xi(O,e,i,p)}var w;return f}class Oi{constructor(e,i){this.type=Sr,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(La(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let p=0;p<o.features.length;++p){const a=o.features[p].geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new Oi(o,o.features[p].geometry)}else if(o.type==="Feature"){const p=o.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Oi(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Oi(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){const p=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const w=ip(o.coordinates,a,f),E=Si(i.geometry(),p,a,f);if(!Kc(p,a))return!1;for(const O of E)if(!ec(O,w))return!1}if(o.type==="MultiPolygon"){const w=vl(o.coordinates,a,f),E=Si(i.geometry(),p,a,f);if(!Kc(p,a))return!1;for(const O of E)if(!tc(O,w))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){const p=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const w=ip(o.coordinates,a,f),E=jh(i.geometry(),p,a,f);if(!Kc(p,a))return!1;for(const O of E)if(!Ku(O,w))return!1}if(o.type==="MultiPolygon"){const w=vl(o.coordinates,a,f),E=jh(i.geometry(),p,a,f);if(!Kc(p,a))return!1;for(const O of E)if(!Uh(O,w))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Qc={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},xl=1/298.257223563,zi=xl*(2-xl),eu=Math.PI/180;class qa{static fromTile(e,i,o){const p=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),a=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/eu;return new qa(a,o)}static get units(){return Qc}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!Qc[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(Qc).join(", ")}`);const o=6378.137*eu*(i?Qc[i]:1),p=Math.cos(e*eu),a=1/(1-zi*(1-p*p)),f=Math.sqrt(a);this.kx=o*f*p,this.ky=o*f*a*(1-zi)}distance(e,i){const o=so(e[0]-i[0])*this.kx,p=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+p*p)}bearing(e,i){const o=so(i[0]-e[0])*this.kx;return Math.atan2(o,(i[1]-e[1])*this.ky)/eu}destination(e,i,o){const p=o*eu;return this.offset(e,Math.sin(p)*i,Math.cos(p)*i)}offset(e,i,o){return[e[0]+i/this.kx,e[1]+o/this.ky]}lineDistance(e){let i=0;for(let o=0;o<e.length-1;o++)i+=this.distance(e[o],e[o+1]);return i}area(e){let i=0;for(let o=0;o<e.length;o++){const p=e[o];for(let a=0,f=p.length,w=f-1;a<f;w=a++)i+=so(p[a][0]-p[w][0])*(p[a][1]+p[w][1])*(o?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let o=0;if(i<=0)return e[0];for(let p=0;p<e.length-1;p++){const a=e[p],f=e[p+1],w=this.distance(a,f);if(o+=w,o>i)return $h(a,f,(i-(o-w))/w)}return e[e.length-1]}pointToSegmentDistance(e,i,o){let[p,a]=i,f=so(o[0]-p)*this.kx,w=(o[1]-a)*this.ky;if(f!==0||w!==0){const E=(so(e[0]-p)*this.kx*f+(e[1]-a)*this.ky*w)/(f*f+w*w);E>1?(p=o[0],a=o[1]):E>0&&(p+=f/this.kx*E,a+=w/this.ky*E)}return f=so(e[0]-p)*this.kx,w=(e[1]-a)*this.ky,Math.sqrt(f*f+w*w)}pointOnLine(e,i){let o=1/0,p=e[0][0],a=e[0][1],f=0,w=0;for(let E=0;E<e.length-1;E++){let O=e[E][0],x=e[E][1],C=so(e[E+1][0]-O)*this.kx,k=(e[E+1][1]-x)*this.ky,M=0;C===0&&k===0||(M=(so(i[0]-O)*this.kx*C+(i[1]-x)*this.ky*k)/(C*C+k*k),M>1?(O=e[E+1][0],x=e[E+1][1]):M>0&&(O+=C/this.kx*M,x+=k/this.ky*M)),C=so(i[0]-O)*this.kx,k=(i[1]-x)*this.ky;const P=C*C+k*k;P<o&&(o=P,p=O,a=x,f=E,w=M)}return{point:[p,a],index:f,t:Math.max(0,Math.min(1,w))}}lineSlice(e,i,o){let p=this.pointOnLine(o,e),a=this.pointOnLine(o,i);if(p.index>a.index||p.index===a.index&&p.t>a.t){const O=p;p=a,a=O}const f=[p.point],w=p.index+1,E=a.index;!Ju(o[w],f[0])&&w<=E&&f.push(o[w]);for(let O=w+1;O<=E;O++)f.push(o[O]);return Ju(o[E],a.point)||f.push(a.point),f}lineSliceAlong(e,i,o){let p=0;const a=[];for(let f=0;f<o.length-1;f++){const w=o[f],E=o[f+1],O=this.distance(w,E);if(p+=O,p>e&&a.length===0&&a.push($h(w,E,(e-(p-O))/O)),p>=i)return a.push($h(w,E,(i-(p-O))/O)),a;p>e&&a.push(E)}return a}bufferPoint(e,i){const o=i/this.ky,p=i/this.kx;return[e[0]-p,e[1]-o,e[0]+p,e[1]+o]}bufferBBox(e,i){const o=i/this.ky,p=i/this.kx;return[e[0]-p,e[1]-o,e[2]+p,e[3]+o]}insideBBox(e,i){return so(e[0]-i[0])>=0&&so(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function Ju(s,e){return s[0]===e[0]&&s[1]===e[1]}function $h(s,e,i){const o=so(e[0]-s[0]);return[s[0]+o*i,s[1]+(e[1]-s[1])*i]}function so(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}class Os{constructor(e=[],i=(o,p)=>o<p?-1:o>p?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,p=i[e];for(;e>0;){const a=e-1>>1,f=i[a];if(o(p,f)>=0)break;i[e]=f,e=a}i[e]=p}_down(e){const{data:i,compare:o}=this,p=this.length>>1,a=i[e];for(;e<p;){let f=1+(e<<1);const w=f+1;if(w<this.length&&o(i[w],i[f])<0&&(f=w),o(i[f],a)>=0)break;i[e]=i[f],e=f}i[e]=a}}var ei=8192;function rp(s,e){return e.dist-s.dist}const Gh=100,za=50;function bl(s){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==s.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==s[i])return!1;return!0}function fs(s){return s[1]-s[0]+1}function Ya(s,e){const i=s[1]>=s[0]&&s[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function np(s,e){if(s[0]>s[1])return[null,null];const i=fs(s);if(e){if(i===2)return[s,null];const o=Math.floor(i/2);return[[s[0],s[0]+o],[s[0]+o,s[1]]]}{if(i===1)return[s,null];const o=Math.floor(i/2)-1;return[[s[0],s[0]+o],[s[0]+o+1,s[1]]]}}function ic(s,e){const i=[1/0,1/0,-1/0,-1/0];if(!Ya(e,s.length))return i;for(let o=e[0];o<=e[1];++o)Zu(i,s[o]);return i}function rc(s){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<s.length;++i)for(let o=0;o<s[i].length;++o)Zu(e,s[i][o]);return e}function nc(s,e,i){if(bl(s)||bl(e))return NaN;let o=0,p=0;return s[2]<e[0]&&(o=e[0]-s[2]),s[0]>e[2]&&(o=s[0]-e[2]),s[1]>e[3]&&(p=s[1]-e[3]),s[3]<e[1]&&(p=e[1]-s[3]),i.distance([0,0],[o,p])}function Hh(s){return 360*s-180}function $m(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function sc(s,e){const i=Math.pow(2,e.z),o=(s.y/ei+e.y)/i;return[Hh((s.x/ei+e.x)/i),$m(o)]}function oc(s,e){const i=[];for(let o=0;o<s.length;++o)i.push(sc(s[o],e));return i}function _f(s,e,i){const o=i.pointOnLine(e,s).point;return i.distance(s,o)}function sp(s,e,i,o,p){const a=i.slice(o[0],o[1]+1);let f=1/0;for(let w=e[0];w<=e[1];++w)if((f=Math.min(f,_f(s[w],a,p)))===0)return 0;return f}function op(s,e,i,o,p){const a=Math.min(p.pointToSegmentDistance(s,i,o),p.pointToSegmentDistance(e,i,o)),f=Math.min(p.pointToSegmentDistance(i,s,e),p.pointToSegmentDistance(o,s,e));return Math.min(a,f)}function Gm(s,e,i,o,p){if(!Ya(e,s.length)||!Ya(o,i.length))return NaN;let a=1/0;for(let f=e[0];f<e[1];++f)for(let w=o[0];w<o[1];++w){if(Wa(s[f],s[f+1],i[w],i[w+1]))return 0;a=Math.min(a,op(s[f],s[f+1],i[w],i[w+1],p))}return a}function yf(s,e,i,o,p){if(!Ya(e,s.length)||!Ya(o,i.length))return NaN;let a=1/0;for(let f=e[0];f<=e[1];++f)for(let w=o[0];w<=o[1];++w)if((a=Math.min(a,p.distance(s[f],i[w])))===0)return a;return a}function Fa(s,e,i){if(ec(s,e,!0))return 0;let o=1/0;for(const p of e){const a=p.length;if(a<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[a-1]&&(o=Math.min(o,i.pointToSegmentDistance(s,p[a-1],p[0])))===0||(o=Math.min(o,_f(s,p,i)))===0)return o}return o}function ap(s,e,i,o){if(!Ya(e,s.length))return NaN;for(let a=e[0];a<=e[1];++a)if(ec(s[a],i,!0))return 0;let p=1/0;for(let a=e[0];a<e[1];++a)for(const f of i)for(let w=0,E=f.length,O=E-1;w<E;O=w++){if(Wa(s[a],s[a+1],f[O],f[w]))return 0;p=Math.min(p,op(s[a],s[a+1],f[O],f[w],o))}return p}function vf(s,e){for(const i of s)for(let o=0;o<=i.length-1;++o)if(ec(i[o],e,!0))return!0;return!1}function tu(s,e,i,o=1/0){const p=rc(s),a=rc(e);if(o!==1/0&&nc(p,a,i)>=o)return o;if(Kc(p,a)){if(vf(s,e))return 0}else if(vf(e,s))return 0;let f=o;for(const w of s)for(let E=0,O=w.length,x=O-1;E<O;x=E++)for(const C of e)for(let k=0,M=C.length,P=M-1;k<M;P=k++){if(Wa(w[x],w[E],C[P],C[k]))return 0;f=Math.min(f,op(w[x],w[E],C[P],C[k],i))}return f}function ac(s,e,i,o,p,a,f){if(a===null||f===null)return;const w=nc(ic(o,a),ic(p,f),i);w<e&&s.push({dist:w,range1:a,range2:f})}function xf(s,e,i,o,p=1/0){let a=Math.min(o.distance(s[0],i[0][0]),p);if(a===0)return a;const f=new Os([{dist:0,range1:[0,s.length-1],range2:[0,0]}],rp),w=e?za:Gh,E=rc(i);for(;f.length;){const O=f.pop();if(O.dist>=a)continue;const x=O.range1;if(fs(x)<=w){if(!Ya(x,s.length))return NaN;if(e){const C=ap(s,x,i,o);if((a=Math.min(a,C))===0)return a}else for(let C=x[0];C<=x[1];++C){const k=Fa(s[C],i,o);if((a=Math.min(a,k))===0)return a}}else{const C=np(x,e);if(C[0]!==null){const k=nc(ic(s,C[0]),E,o);k<a&&f.push({dist:k,range1:C[0],range2:[0,0]})}if(C[1]!==null){const k=nc(ic(s,C[1]),E,o);k<a&&f.push({dist:k,range1:C[1],range2:[0,0]})}}}return a}function Lo(s,e,i,o,p,a=1/0){let f=Math.min(a,p.distance(s[0],i[0]));if(f===0)return f;const w=new Os([{dist:0,range1:[0,s.length-1],range2:[0,i.length-1]}],rp),E=e?za:Gh,O=o?za:Gh;for(;w.length;){const x=w.pop();if(x.dist>=f)continue;const C=x.range1,k=x.range2;if(fs(C)<=E&&fs(k)<=O){if(!Ya(C,s.length)||!Ya(k,i.length))return NaN;if(e&&o?f=Math.min(f,Gm(s,C,i,k,p)):e||o?e&&!o?f=Math.min(f,sp(i,k,s,C,p)):!e&&o&&(f=Math.min(f,sp(s,C,i,k,p))):f=Math.min(f,yf(s,C,i,k,p)),f===0)return f}else{const M=np(C,e),P=np(k,o);ac(w,f,p,s,i,M[0],P[0]),ac(w,f,p,s,i,M[0],P[1]),ac(w,f,p,s,i,M[1],P[0]),ac(w,f,p,s,i,M[1],P[1])}}return f}function wl(s,e,i,o,p=1/0){let a=p;const f=ic(s,[0,s.length-1]);for(const w of i)if(!(a!==1/0&&nc(f,ic(w,[0,w.length-1]),o)>=a)&&(a=Math.min(a,Lo(s,e,w,!0,o,a)),a===0))return a;return a}function Qu(s,e,i,o,p=1/0){let a=p;const f=ic(s,[0,s.length-1]);for(const w of i){if(a!==1/0&&nc(f,rc(w),o)>=a)continue;const E=xf(s,e,w,o,a);if(isNaN(E))return E;if((a=Math.min(a,E))===0)return a}return a}function lc(s){return s==="Point"||s==="MultiPoint"||s==="LineString"||s==="MultiLineString"||s==="Polygon"||s==="MultiPolygon"}class Sl{constructor(e,i){this.type=yi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(La(e[1])){const o=e[1];if(o.type==="FeatureCollection"){for(let p=0;p<o.features.length;++p)if(lc(o.features[p].geometry.type))return new Sl(o,o.features[p].geometry)}else if(o.type==="Feature"){if(lc(o.geometry.type))return new Sl(o,o.geometry)}else if(lc(o.type))return new Sl(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),o=e.canonicalID();if(i!=null&&o!=null){if(e.geometryType()==="Point")return function(p,a,f){const w=[];for(const O of p)for(const x of O)w.push(sc(x,a));const E=new qa(w[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?Lo(w,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",E):f.type==="MultiLineString"?wl(w,!1,f.coordinates,E):f.type==="Polygon"||f.type==="MultiPolygon"?Qu(w,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,E):null}(i,o,this.geometries);if(e.geometryType()==="LineString")return function(p,a,f){const w=[];for(const O of p){const x=[];for(const C of O)x.push(sc(C,a));w.push(x)}const E=new qa(w[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return wl(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",w,E);if(f.type==="MultiLineString"){let O=1/0;for(let x=0;x<f.coordinates.length;x++){const C=wl(f.coordinates[x],!0,w,E,O);if(isNaN(C))return C;if((O=Math.min(O,C))===0)return O}return O}if(f.type==="Polygon"||f.type==="MultiPolygon"){let O=1/0;for(let x=0;x<w.length;x++){const C=Qu(w[x],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,E,O);if(isNaN(C))return C;if((O=Math.min(O,C))===0)return O}return O}return null}(i,o,this.geometries);if(e.geometryType()==="Polygon")return function(p,a,f){const w=[];for(const O of function(x,C){const k=x.length;if(k<=1)return[x];const M=[];let P,R;for(let $=0;$<k;$++){const G=Um(x[$]);G!==0&&(x[$].area=Math.abs(G),R===void 0&&(R=G<0),R===G<0?(P&&M.push(P),P=[x[$]]):P.push(x[$]))}return P&&M.push(P),M}(p)){const x=[];for(let C=0;C<O.length;++C)x.push(oc(O[C],a));w.push(x)}const E=new qa(w[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return Qu(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",w,E);if(f.type==="MultiLineString"){let O=1/0;for(let x=0;x<f.coordinates.length;x++){const C=Qu(f.coordinates[x],!0,w,E,O);if(isNaN(C))return C;if((O=Math.min(O,C))===0)return O}return O}return f.type==="Polygon"||f.type==="MultiPolygon"?function(O,x,C){let k=1/0;for(const M of O)for(const P of x){const R=tu(M,P,C,k);if(isNaN(R))return R;if((k=Math.min(k,R))===0)return k}return k}(f.type==="Polygon"?[f.coordinates]:f.coordinates,w,E):null}(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Wh(s,e){switch(s){case"string":return ko(e);case"number":return+e;case"boolean":return!!e;case"color":return Ar.parse(e);case"formatted":return Ds.fromString(ko(e));case"resolvedImage":return ks.build(ko(e))}return e}function Ro(s,e,i,o){return o!==void 0&&(s=o*Math.round(s/o)),e!==void 0&&s<e&&(s=e),i!==void 0&&s>i&&(s=i),s}class Zo{constructor(e,i,o){this.type=e,this.key=i,this.scope=o}static parse(e,i){let o=i.expectedType;if(o==null&&(o=Tr),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const p=i.parse(e[1],1);if(!(p instanceof ws))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const a=i.parse(e[2],2);return a instanceof ws?new Zo(o,ko(p.value),ko(a.value)):i.error("Scope of 'config' expression must be a string literal.")}return new Zo(o,ko(p.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),o=e.getConfig(i);if(!o)return null;const{type:p,value:a,values:f,minValue:w,maxValue:E,stepValue:O}=o,x=o.default.evaluate(e);let C=x;if(a){const k=e.scope;e.scope=(k||"").split("").slice(1).join(""),C=a.evaluate(e),e.scope=k}return p&&(C=Wh(p,C)),C===void 0||w===void 0&&E===void 0&&O===void 0||(typeof C=="number"?C=Ro(C,w,E,O):Array.isArray(C)&&(C=C.map(k=>typeof k=="number"?Ro(k,w,E,O):k))),a!==void 0&&C!==void 0&&f&&!f.includes(C)&&(C=x,p&&(C=Wh(p,C))),(p&&p!==this.type||C!==void 0&&Qr(C)!==this.type)&&(C=Wh(this.type.kind,C)),C}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function iu(s){if(s instanceof no&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Oi||s instanceof Sl)return!1;let e=!0;return s.eachChild(i=>{e&&!iu(i)&&(e=!1)}),e}function ru(s){if(s instanceof no&&s.name==="feature-state")return!1;let e=!0;return s.eachChild(i=>{e&&!ru(i)&&(e=!1)}),e}function eh(s){if(s instanceof Zo)return new Set([s.key]);let e=new Set;return s.eachChild(i=>{e=new Set([...e,...eh(i)])}),e}function Xa(s,e){if(s instanceof no&&e.indexOf(s.name)>=0)return!1;let i=!0;return s.eachChild(o=>{i&&!Xa(o,e)&&(i=!1)}),i}class cc{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new cc(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class nu{constructor(e,i=[],o,p=new qc,a=[],f,w){this.registry=e,this.path=i,this.key=i.map(E=>typeof E=="string"?`['${E}']`:`[${E}]`).join(""),this.scope=p,this.errors=a,this.expectedType=o,this._scope=f,this.options=w}parse(e,i,o,p,a={}){return i||o?this.concat(i,null,o,p)._parse(e,a):this._parse(e,a)}parseObjectValue(e,i,o,p,a,f={}){return this.concat(i,o,p,a)._parse(e,f)}_parse(e,i){function o(p,a,f){return f==="assert"?new Xo(a,[p]):f==="coerce"?new Ra(a,[p]):p}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(p){let a=p.parse(e,this);if(!a)return null;if(this.expectedType){const f=this.expectedType,w=a.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||w.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(f,w))return null}else a=o(a,f,i.typeAnnotation||"coerce");else a=o(a,f,i.typeAnnotation||"assert")}if(!(a instanceof ws)&&a.type.kind!=="resolvedImage"&&qh(a)){const f=new Qd(this._scope,this.options);try{a=new ws(a.type,a.evaluate(f))}catch(w){return this.error(w.message),null}}return a}return Ra.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o,p){let a=typeof e=="number"?this.path.concat(e):this.path;a=typeof i=="string"?a.concat(i):a;const f=p?this.scope.concat(p):this.scope;return new nu(this.registry,a,o||null,f,this.errors,this._scope,this.options)}error(e,...i){const o=`${this.key}${i.map(p=>`[${p}]`).join("")}`;this.errors.push(new Ji(o,e))}checkSubtype(e,i){const o=Js(e,i);return o&&this.error(o),o}}var su=nu;function qh(s){if(s instanceof cc)return qh(s.boundExpression);if(s instanceof no&&s.name==="error"||s instanceof Nh||s instanceof Oi||s instanceof Sl||s instanceof Zo)return!1;const e=s instanceof Ra||s instanceof Xo;let i=!0;return s.eachChild(o=>{i=e?i&&qh(o):i&&o instanceof ws}),!!i&&iu(s)&&Xa(s,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function uc(s,e){const i=s.length-1;let o,p,a=0,f=i,w=0;for(;a<=f;)if(w=Math.floor((a+f)/2),o=s[w],p=s[w+1],o<=e){if(w===i||e<p)return w;a=w+1}else{if(!(o>e))throw new yn("Input is not a number.");f=w-1}return 0}class Ls{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[p,a]of o)this.labels.push(p),this.outputs.push(a)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,yi);if(!o)return null;const p=[];let a=null;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);for(let f=1;f<e.length;f+=2){const w=f===1?-1/0:e[f],E=e[f+1],O=f,x=f+1;if(typeof w!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(p.length&&p[p.length-1][0]>=w)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const C=i.parse(E,x,a);if(!C)return null;a=a||C.type,p.push([w,C])}return new Ls(a,o,p)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const p=this.input.evaluate(e);if(p<=i[0])return o[0].evaluate(e);const a=i.length;return p>=i[a-1]?o[a-1].evaluate(e):o[uc(i,p)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Yr=.95047,fr=1.08883,lp=4/29,Tl=6/29,th=3*Tl*Tl,An=Tl*Tl*Tl,bf=Math.PI/180,sn=180/Math.PI;function Yh(s){return s>An?Math.pow(s,1/3):s/th+lp}function ir(s){return s>Tl?s*s*s:th*(s-lp)}function Xh(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function ou(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function wf(s){const e=ou(s.r),i=ou(s.g),o=ou(s.b),p=Yh((.4124564*e+.3575761*i+.1804375*o)/Yr),a=Yh((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*a-16,a:500*(p-a),b:200*(a-Yh((.0193339*e+.119192*i+.9503041*o)/fr)),alpha:s.a}}function ih(s){let e=(s.l+16)/116,i=isNaN(s.a)?e:e+s.a/500,o=isNaN(s.b)?e:e-s.b/200;return e=1*ir(e),i=Yr*ir(i),o=fr*ir(o),new Ar(Xh(3.2404542*i-1.5371385*e-.4985314*o),Xh(-.969266*i+1.8760108*e+.041556*o),Xh(.0556434*i-.2040259*e+1.0572252*o),s.alpha)}function Or(s,e,i){const o=e-s;return s+i*(o>180||o<-180?o-360*Math.round(o/360):o)}const Ml={forward:wf,reverse:ih,interpolate:function(s,e,i){return{l:Ii(s.l,e.l,i),a:Ii(s.a,e.a,i),b:Ii(s.b,e.b,i),alpha:Ii(s.alpha,e.alpha,i)}}},rh={forward:function(s){const{l:e,a:i,b:o}=wf(s),p=Math.atan2(o,i)*sn;return{h:p<0?p+360:p,c:Math.sqrt(i*i+o*o),l:e,alpha:s.a}},reverse:function(s){const e=s.h*bf,i=s.c;return ih({l:s.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:s.alpha})},interpolate:function(s,e,i){return{h:Or(s.h,e.h,i),c:Ii(s.c,e.c,i),l:Ii(s.l,e.l,i),alpha:Ii(s.alpha,e.alpha,i)}}};var Sf=Object.freeze({__proto__:null,hcl:rh,lab:Ml});class vo{constructor(e,i,o,p,a,f){this.type=e,this.operator=i,this.interpolation=o,this.input=p,this.dynamicStops=a,this.labels=[],this.outputs=[];for(const[w,E]of f)this.labels.push(w),this.outputs.push(E)}static interpolationFactor(e,i,o,p){let a=0;if(e.name==="exponential")a=Zh(i,e.base,o,p);else if(e.name==="linear")a=Zh(i,1,o,p);else if(e.name==="cubic-bezier"){const f=e.controlPoints;a=new Bi(f[0],f[1],f[2],f[3]).solve(Zh(i,1,o,p))}return a}static parse(e,i){let[o,p,a,...f]=e;if(!Array.isArray(p)||p.length===0)return i.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const O=p[1];if(typeof O!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:O}}else{if(p[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const O=p.slice(1);if(O.length!==4||O.some(x=>typeof x!="number"||x<0||x>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:O}}}if(e.length-1<3)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(a=i.parse(a,2,yi),!a)return null;const w=[];let E=null;if(o==="interpolate-hcl"||o==="interpolate-lab"?E=Gs:i.expectedType&&i.expectedType.kind!=="value"&&(E=i.expectedType),e.length-1==3){const O=i.parse(f[0],3,Tr);return O?new vo(E,o,p,a,O,w):null}for(let O=0;O<f.length;O+=2){const x=f[O],C=f[O+1],k=O+3,M=O+4;if(typeof x!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(w.length&&w[w.length-1][0]>=x)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const P=i.parse(C,M,E);if(!P)return null;E=E||P.type,w.push([x,P])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new vo(E,o,p,a,null,w):i.error(`Type ${wn(E)} is not interpolatable.`)}evaluate(e){let i=this.labels,o=this.outputs;if(this.dynamicStops){const x=this.dynamicStops.evaluate(e);if(x.length%2!=0)throw new yn("Expected an even number of arguments.");i=[],o=[];for(let C=0;C<x.length;C+=2){const k=x[C],M=new ws(yi,x[C+1]);if(typeof k!="number")throw new yn('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.');if(i.length&&i[i.length-1]>=k)throw new yn('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.');i.push(k),o.push(M)}if(i.length===0)throw new yn("Expected at least one input/output pair.")}if(i.length===1)return o[0].evaluate(e);const p=this.input.evaluate(e);if(p<=i[0])return o[0].evaluate(e);const a=i.length;if(p>=i[a-1])return o[a-1].evaluate(e);const f=uc(i,p),w=vo.interpolationFactor(this.interpolation,p,i[f],i[f+1]),E=o[f].evaluate(e),O=o[f+1].evaluate(e);return this.operator==="interpolate"?Do[this.type.kind.toLowerCase()](E,O,w):this.operator==="interpolate-hcl"?rh.reverse(rh.interpolate(rh.forward(E),rh.forward(O),w)):Ml.reverse(Ml.interpolate(Ml.forward(E),Ml.forward(O),w))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];if(this.dynamicStops)i.push(this.dynamicStops.serialize());else for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function Zh(s,e,i,o){const p=o-i,a=s-i;return p===0?0:e===1?a/p:(Math.pow(e,a)-1)/(Math.pow(e,p)-1)}class Za{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const p=i.expectedType;p&&p.kind!=="value"&&(o=p);const a=[];for(const w of e.slice(1)){const E=i.parse(w,1+a.length,o,void 0,{typeAnnotation:"omit"});if(!E)return null;o=o||E.type,a.push(E)}const f=p&&a.some(w=>Js(p,w.type));return new Za(f?Tr:o,a)}evaluate(e){let i,o=null,p=0;for(const a of this.args){if(p++,o=a.evaluate(e),o&&o instanceof ks&&!o.available&&(i||(i=o),o=null,p===this.args.length))return i;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Kh{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let a=1;a<e.length-1;a+=2){const f=e[a];if(typeof f!="string")return i.error(`Expected string, but found ${typeof f} instead.`,a);if(/[^a-zA-Z0-9_]/.test(f))return i.error("Variable names must contain only alphanumeric characters or '_'.",a);const w=i.parse(e[a+1],a+1);if(!w)return null;o.push([f,w])}const p=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return p?new Kh(o,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}class cp{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,yi),p=i.parse(e[2],2,bs(i.expectedType||Tr));return o&&p?new cp(p.type.itemType,o,p):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new yn(`Array index out of bounds: ${i} < 0.`);if(i>o.length-1)throw new yn(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i===Math.floor(i))return o[i];const p=Math.floor(i),a=Math.ceil(i),f=o[p],w=o[a];if(typeof f!="number"||typeof w!="number")throw new yn(`Cannot interpolate between non-number values at index ${i}.`);const E=i-p;return f*(1-E)+w*E}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class up{constructor(e,i){this.type=Sr,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Tr),p=i.parse(e[2],2,Tr);return o&&p?rs(o.type,[Sr,Lr,yi,Ga,Tr])?new up(o,p):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${wn(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!_o(i,["boolean","string","number","null"]))throw new yn(`Expected first argument to be of type boolean, string, number or null, but found ${wn(Qr(i))} instead.`);if(!_o(o,["string","array"]))throw new yn(`Expected second argument to be of type array or string, but found ${wn(Qr(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class hc{constructor(e,i,o){this.type=yi,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Tr),p=i.parse(e[2],2,Tr);if(!o||!p)return null;if(!rs(o.type,[Sr,Lr,yi,Ga,Tr]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${wn(o.type)} instead`);if(e.length===4){const a=i.parse(e[3],3,yi);return a?new hc(o,p,a):null}return new hc(o,p)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!_o(i,["boolean","string","number","null"]))throw new yn(`Expected first argument to be of type boolean, string, number or null, but found ${wn(Qr(i))} instead.`);if(!_o(o,["string","array"]))throw new yn(`Expected second argument to be of type array or string, but found ${wn(Qr(o))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(e);return o.indexOf(i,p)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class hp{constructor(e,i,o,p,a,f){this.inputType=e,this.type=i,this.input=o,this.cases=p,this.outputs=a,this.otherwise=f}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,p;i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);const a={},f=[];for(let O=2;O<e.length-1;O+=2){let x=e[O];const C=e[O+1];Array.isArray(x)||(x=[x]);const k=i.concat(O);if(x.length===0)return k.error("Expected at least one branch label.");for(const P of x){if(typeof P!="number"&&typeof P!="string")return k.error("Branch labels must be numbers or strings.");if(typeof P=="number"&&Math.abs(P)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof P=="number"&&Math.floor(P)!==P)return k.error("Numeric branch labels must be integer values.");if(o){if(k.checkSubtype(o,Qr(P)))return null}else o=Qr(P);if(a[String(P)]!==void 0)return k.error("Branch labels must be unique.");a[String(P)]=f.length}const M=i.parse(C,O,p);if(!M)return null;p=p||M.type,f.push(M)}const w=i.parse(e[1],1,Tr);if(!w)return null;const E=i.parse(e[e.length-1],e.length-1,p);return E?w.type.kind!=="value"&&i.concat(1).checkSubtype(o,w.type)?null:new hp(o,p,w,a,f,E):null}evaluate(e){const i=this.input.evaluate(e);return(Qr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],p={};for(const f of i){const w=p[this.cases[f]];w===void 0?(p[this.cases[f]]=o.length,o.push([this.cases[f],[f]])):o[w][1].push(f)}const a=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,w]of o)e.push(w.length===1?a(w[0]):w.map(a)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class Jh{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const p=[];for(let f=1;f<e.length-1;f+=2){const w=i.parse(e[f],f,Sr);if(!w)return null;const E=i.parse(e[f+1],f+1,o);if(!E)return null;p.push([w,E]),o=o||E.type}const a=i.parse(e[e.length-1],e.length-1,o);return a?new Jh(o,p,a):null}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Qh{constructor(e,i,o,p){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=p}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Tr),p=i.parse(e[2],2,yi);if(!o||!p)return null;if(!rs(o.type,[bs(Tr),Lr,Tr]))return i.error(`Expected first argument to be of type array or string, but found ${wn(o.type)} instead`);if(e.length===4){const a=i.parse(e[3],3,yi);return a?new Qh(o.type,o,p,a):null}return new Qh(o.type,o,p)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!_o(i,["string","array"]))throw new yn(`Expected first argument to be of type array or string, but found ${wn(Qr(i))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(e);return i.slice(o,p)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Tf(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Mf(s,e,i,o){return o.compare(e,i)===0}function au(s,e,i){const o=s!=="=="&&s!=="!=";return class fM{constructor(a,f,w){this.type=Sr,this.lhs=a,this.rhs=f,this.collator=w,this.hasUntypedArgument=a.type.kind==="value"||f.type.kind==="value"}static parse(a,f){if(a.length!==3&&a.length!==4)return f.error("Expected two or three arguments.");const w=a[0];let E=f.parse(a[1],1,Tr);if(!E)return null;if(!Tf(w,E.type))return f.concat(1).error(`"${w}" comparisons are not supported for type '${wn(E.type)}'.`);let O=f.parse(a[2],2,Tr);if(!O)return null;if(!Tf(w,O.type))return f.concat(2).error(`"${w}" comparisons are not supported for type '${wn(O.type)}'.`);if(E.type.kind!==O.type.kind&&E.type.kind!=="value"&&O.type.kind!=="value")return f.error(`Cannot compare types '${wn(E.type)}' and '${wn(O.type)}'.`);o&&(E.type.kind==="value"&&O.type.kind!=="value"?E=new Xo(O.type,[E]):E.type.kind!=="value"&&O.type.kind==="value"&&(O=new Xo(E.type,[O])));let x=null;if(a.length===4){if(E.type.kind!=="string"&&O.type.kind!=="string"&&E.type.kind!=="value"&&O.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(x=f.parse(a[3],3,Oa),!x)return null}return new fM(E,O,x)}evaluate(a){const f=this.lhs.evaluate(a),w=this.rhs.evaluate(a);if(o&&this.hasUntypedArgument){const E=Qr(f),O=Qr(w);if(E.kind!==O.kind||E.kind!=="string"&&E.kind!=="number")throw new yn(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${E.kind}, ${O.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const E=Qr(f),O=Qr(w);if(E.kind!=="string"||O.kind!=="string")return e(a,f,w)}return this.collator?i(a,f,w,this.collator.evaluate(a)):e(a,f,w)}eachChild(a){a(this.lhs),a(this.rhs),this.collator&&a(this.collator)}outputDefined(){return!0}serialize(){const a=[s];return this.eachChild(f=>{a.push(f.serialize())}),a}}}const Hm=au("==",function(s,e,i){return e===i},Mf),Ef=au("!=",function(s,e,i){return e!==i},function(s,e,i,o){return!Mf(0,e,i,o)}),Wm=au("<",function(s,e,i){return e<i},function(s,e,i,o){return o.compare(e,i)<0}),qm=au(">",function(s,e,i){return e>i},function(s,e,i,o){return o.compare(e,i)>0}),Cf=au("<=",function(s,e,i){return e<=i},function(s,e,i,o){return o.compare(e,i)<=0}),Af=au(">=",function(s,e,i){return e>=i},function(s,e,i,o){return o.compare(e,i)>=0});class Ko{constructor(e,i,o,p,a,f){this.type=Lr,this.number=e,this.locale=i,this.currency=o,this.unit=p,this.minFractionDigits=a,this.maxFractionDigits=f}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,yi);if(!o)return null;const p=e[2];if(typeof p!="object"||Array.isArray(p))return i.error("NumberFormat options argument must be an object.");let a=null;if(p.locale&&(a=i.parseObjectValue(p.locale,2,"locale",Lr),!a))return null;let f=null;if(p.currency&&(f=i.parseObjectValue(p.currency,2,"currency",Lr),!f))return null;let w=null;if(p.unit&&(w=i.parseObjectValue(p.unit,2,"unit",Lr),!w))return null;let E=null;if(p["min-fraction-digits"]&&(E=i.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",yi),!E))return null;let O=null;return p["max-fraction-digits"]&&(O=i.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",yi),!O)?null:new Ko(o,a,f,w,E,O)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class dp{constructor(e){this.type=yi,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${wn(o.type)} instead.`):new dp(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new yn(`Expected value to be of type string or array, but found ${wn(Qr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function ed(s){return function(){s=1831565813+(s|=0)|0;let e=Math.imul(s^s>>>15,1|s);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const lu={"==":Hm,"!=":Ef,">":qm,"<":Wm,">=":Af,"<=":Cf,array:Xo,at:cp,boolean:Xo,case:Jh,coalesce:Za,collator:Nh,format:Ha,image:Zc,in:up,"index-of":hc,interpolate:vo,"interpolate-hcl":vo,"interpolate-lab":vo,length:dp,let:Kh,literal:ws,match:hp,number:Xo,"number-format":Ko,object:Xo,slice:Qh,step:Ls,string:Xo,"to-boolean":Ra,"to-color":Ra,"to-number":Ra,"to-string":Ra,var:cc,within:Oi,distance:Sl,config:Zo};function td(s,[e,i,o,p]){e=e.evaluate(s),i=i.evaluate(s),o=o.evaluate(s);const a=p?p.evaluate(s):1,f=Yc(e,i,o,a);if(f)throw new yn(f);return new Ar(e/255*a,i/255*a,o/255*a,a)}function Pf(s,[e,i,o,p]){e=e.evaluate(s),i=i.evaluate(s),o=o.evaluate(s);const a=p?p.evaluate(s):1,f=function(O,x,C,k){return typeof O=="number"&&O>=0&&O<=360?typeof x=="number"&&x>=0&&x<=100&&typeof C=="number"&&C>=0&&C<=100?k===void 0||typeof k=="number"&&k>=0&&k<=1?null:`Invalid hsla value [${[O,x,C,k].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof k=="number"?[O,x,C,k]:[O,x,C]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof k=="number"?[O,x,C,k]:[O,x,C]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,o,a);if(f)throw new yn(f);const w=`hsla(${e}, ${i}%, ${o}%, ${a})`,E=Ar.parse(w);if(!E)throw new yn(`Failed to parse HSLA color: ${w}`);return E}function If(s,e){return s in e}function cu(s,e){const i=e[s];return i===void 0?null:i}function El(s){return{type:s}}function id(s){return{result:"success",value:s}}function zo(s){return{result:"error",value:s}}function rd(s,e){return!!s&&!!s.parameters&&s.parameters.indexOf(e)>-1}function uu(s){return s["property-type"]==="data-driven"}function Df(s){return rd(s.expression,"measure-light")}function nd(s){return rd(s.expression,"zoom")}function nh(s){return!!s.expression&&s.expression.interpolated}function Cl(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function kf(s){return s}function pp(s,e){const i=e.type==="color",o=s.stops&&typeof s.stops[0][0]=="object",p=o||!(o||s.property!==void 0),a=s.type||(nh(e)?"exponential":"interval");if(i&&((s=Bh({},s)).stops&&(s.stops=s.stops.map(O=>[O[0],Ar.parse(O[1])])),s.default=Ar.parse(s.default?s.default:e.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!Sf[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let f,w,E;if(a==="exponential")f=Lf;else if(a==="interval")f=Ym;else if(a==="categorical"){f=Of,w=Object.create(null);for(const O of s.stops)w[O[0]]=O[1];E=typeof s.stops[0][0]}else{if(a!=="identity")throw new Error(`Unknown function type "${a}"`);f=Rf}if(o){const O={},x=[];for(let M=0;M<s.stops.length;M++){const P=s.stops[M],R=P[0].zoom;O[R]===void 0&&(O[R]={zoom:R,type:s.type,property:s.property,default:s.default,stops:[]},x.push(R)),O[R].stops.push([P[0].value,P[1]])}const C=[];for(const M of x)C.push([O[M].zoom,pp(O[M],e)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:vo.interpolationFactor.bind(void 0,k),zoomStops:C.map(M=>M[0]),evaluate:({zoom:M},P)=>Lf({stops:C,base:s.base},e,M).evaluate(M,P)}}if(p){const O=a==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:O,interpolationFactor:vo.interpolationFactor.bind(void 0,O),zoomStops:s.stops.map(x=>x[0]),evaluate:({zoom:x})=>f(s,e,x,w,E)}}return{kind:"source",evaluate(O,x){const C=x&&x.properties?x.properties[s.property]:void 0;return C===void 0?hu(s.default,e.default):f(s,e,C,w,E)}}}function hu(s,e,i){return s!==void 0?s:e!==void 0?e:i!==void 0?i:void 0}function Of(s,e,i,o,p){return hu(typeof i===p?o[i]:void 0,s.default,e.default)}function Ym(s,e,i){if(Oo(i)!=="number")return hu(s.default,e.default);const o=s.stops.length;if(o===1||i<=s.stops[0][0])return s.stops[0][1];if(i>=s.stops[o-1][0])return s.stops[o-1][1];const p=uc(s.stops.map(a=>a[0]),i);return s.stops[p][1]}function Lf(s,e,i){const o=s.base!==void 0?s.base:1;if(Oo(i)!=="number")return hu(s.default,e.default);const p=s.stops.length;if(p===1||i<=s.stops[0][0])return s.stops[0][1];if(i>=s.stops[p-1][0])return s.stops[p-1][1];const a=uc(s.stops.map(x=>x[0]),i),f=function(x,C,k,M){const P=M-k,R=x-k;return P===0?0:C===1?R/P:(Math.pow(C,R)-1)/(Math.pow(C,P)-1)}(i,o,s.stops[a][0],s.stops[a+1][0]),w=s.stops[a][1],E=s.stops[a+1][1];let O=Do[e.type]||kf;if(s.colorSpace&&s.colorSpace!=="rgb"){const x=Sf[s.colorSpace];O=(C,k)=>x.reverse(x.interpolate(x.forward(C),x.forward(k),f))}return typeof w.evaluate=="function"?{evaluate(...x){const C=w.evaluate.apply(void 0,x),k=E.evaluate.apply(void 0,x);if(C!==void 0&&k!==void 0)return O(C,k,f)}}:O(w,E,f)}function Rf(s,e,i){return e.type==="color"?i=Ar.parse(i):e.type==="formatted"?i=Ds.fromString(i.toString()):e.type==="resolvedImage"?i=ks.build(i.toString()):Oo(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),hu(i,s.default,e.default)}no.register(lu,{error:[{kind:"error"},[Lr],(s,[e])=>{throw new yn(e.evaluate(s))}],typeof:[Lr,[Tr],(s,[e])=>wn(Qr(e.evaluate(s)))],"to-rgba":[bs(yi,4),[Gs],(s,[e])=>e.evaluate(s).toRenderColor(null).toArray()],"to-hsla":[bs(yi,4),[Gs],(s,[e])=>e.evaluate(s).toRenderColor(null).toHslaArray()],rgb:[Gs,[yi,yi,yi],td],rgba:[Gs,[yi,yi,yi,yi],td],hsl:[Gs,[yi,yi,yi],Pf],hsla:[Gs,[yi,yi,yi,yi],Pf],has:{type:Sr,overloads:[[[Lr],(s,[e])=>If(e.evaluate(s),s.properties())],[[Lr,ka],(s,[e,i])=>If(e.evaluate(s),i.evaluate(s))]]},get:{type:Tr,overloads:[[[Lr],(s,[e])=>cu(e.evaluate(s),s.properties())],[[Lr,ka],(s,[e,i])=>cu(e.evaluate(s),i.evaluate(s))]]},"feature-state":[Tr,[Lr],(s,[e])=>cu(e.evaluate(s),s.featureState||{})],properties:[ka,[],s=>s.properties()],"geometry-type":[Lr,[],s=>s.geometryType()],id:[Tr,[],s=>s.id()],zoom:[yi,[],s=>s.globals.zoom],pitch:[yi,[],s=>s.globals.pitch||0],"distance-from-center":[yi,[],s=>s.distanceFromCenter()],"measure-light":[yi,[Lr],(s,[e])=>s.measureLight(e.evaluate(s))],"heatmap-density":[yi,[],s=>s.globals.heatmapDensity||0],"line-progress":[yi,[],s=>s.globals.lineProgress||0],"raster-value":[yi,[],s=>s.globals.rasterValue||0],"raster-particle-speed":[yi,[],s=>s.globals.rasterParticleSpeed||0],"sky-radial-progress":[yi,[],s=>s.globals.skyRadialProgress||0],accumulated:[Tr,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[yi,El(yi),(s,e)=>{let i=0;for(const o of e)i+=o.evaluate(s);return i}],"*":[yi,El(yi),(s,e)=>{let i=1;for(const o of e)i*=o.evaluate(s);return i}],"-":{type:yi,overloads:[[[yi,yi],(s,[e,i])=>e.evaluate(s)-i.evaluate(s)],[[yi],(s,[e])=>-e.evaluate(s)]]},"/":[yi,[yi,yi],(s,[e,i])=>e.evaluate(s)/i.evaluate(s)],"%":[yi,[yi,yi],(s,[e,i])=>e.evaluate(s)%i.evaluate(s)],ln2:[yi,[],()=>Math.LN2],pi:[yi,[],()=>Math.PI],e:[yi,[],()=>Math.E],"^":[yi,[yi,yi],(s,[e,i])=>Math.pow(e.evaluate(s),i.evaluate(s))],sqrt:[yi,[yi],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[yi,[yi],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[yi,[yi],(s,[e])=>Math.log(e.evaluate(s))],log2:[yi,[yi],(s,[e])=>Math.log(e.evaluate(s))/Math.LN2],sin:[yi,[yi],(s,[e])=>Math.sin(e.evaluate(s))],cos:[yi,[yi],(s,[e])=>Math.cos(e.evaluate(s))],tan:[yi,[yi],(s,[e])=>Math.tan(e.evaluate(s))],asin:[yi,[yi],(s,[e])=>Math.asin(e.evaluate(s))],acos:[yi,[yi],(s,[e])=>Math.acos(e.evaluate(s))],atan:[yi,[yi],(s,[e])=>Math.atan(e.evaluate(s))],min:[yi,El(yi),(s,e)=>Math.min(...e.map(i=>i.evaluate(s)))],max:[yi,El(yi),(s,e)=>Math.max(...e.map(i=>i.evaluate(s)))],abs:[yi,[yi],(s,[e])=>Math.abs(e.evaluate(s))],round:[yi,[yi],(s,[e])=>{const i=e.evaluate(s);return i<0?-Math.round(-i):Math.round(i)}],floor:[yi,[yi],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[yi,[yi],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[Sr,[Lr,Tr],(s,[e,i])=>s.properties()[e.value]===i.value],"filter-id-==":[Sr,[Tr],(s,[e])=>s.id()===e.value],"filter-type-==":[Sr,[Lr],(s,[e])=>s.geometryType()===e.value],"filter-<":[Sr,[Lr,Tr],(s,[e,i])=>{const o=s.properties()[e.value],p=i.value;return typeof o==typeof p&&o<p}],"filter-id-<":[Sr,[Tr],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[Sr,[Lr,Tr],(s,[e,i])=>{const o=s.properties()[e.value],p=i.value;return typeof o==typeof p&&o>p}],"filter-id->":[Sr,[Tr],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[Sr,[Lr,Tr],(s,[e,i])=>{const o=s.properties()[e.value],p=i.value;return typeof o==typeof p&&o<=p}],"filter-id-<=":[Sr,[Tr],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[Sr,[Lr,Tr],(s,[e,i])=>{const o=s.properties()[e.value],p=i.value;return typeof o==typeof p&&o>=p}],"filter-id->=":[Sr,[Tr],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[Sr,[Tr],(s,[e])=>e.value in s.properties()],"filter-has-id":[Sr,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Sr,[bs(Lr)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[Sr,[bs(Tr)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[Sr,[Lr,bs(Tr)],(s,[e,i])=>i.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[Sr,[Lr,bs(Tr)],(s,[e,i])=>function(o,p,a,f){for(;a<=f;){const w=a+f>>1;if(p[w]===o)return!0;p[w]>o?f=w-1:a=w+1}return!1}(s.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Sr,overloads:[[[Sr,Sr],(s,[e,i])=>e.evaluate(s)&&i.evaluate(s)],[El(Sr),(s,e)=>{for(const i of e)if(!i.evaluate(s))return!1;return!0}]]},any:{type:Sr,overloads:[[[Sr,Sr],(s,[e,i])=>e.evaluate(s)||i.evaluate(s)],[El(Sr),(s,e)=>{for(const i of e)if(i.evaluate(s))return!0;return!1}]]},"!":[Sr,[Sr],(s,[e])=>!e.evaluate(s)],"is-supported-script":[Sr,[Lr],(s,[e])=>{const i=s.globals&&s.globals.isSupportedScript;return!i||i(e.evaluate(s))}],upcase:[Lr,[Lr],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[Lr,[Lr],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[Lr,El(Tr),(s,e)=>e.map(i=>ko(i.evaluate(s))).join("")],"resolved-locale":[Lr,[Oa],(s,[e])=>e.evaluate(s).resolvedLocale()],random:[yi,[yi,yi,Tr],(s,e)=>{const[i,o,p]=e.map(f=>f.evaluate(s));if(i>o||i===o)return i;let a;if(typeof p=="string")a=function(f){let w=0;if(f.length===0)return w;for(let E=0;E<f.length;E++)w=(w<<5)-w+f.charCodeAt(E),w|=0;return w}(p);else{if(typeof p!="number")throw new yn(`Invalid seed input: ${p}`);a=p}return i+ed(a)()*(o-i)}]});class du{constructor(e,i,o,p){this.expression=e,this._warningHistory={},this._evaluator=new Qd(o,p),this._defaultValue=i?function(a){return a.type==="color"&&(Cl(a.default)||Array.isArray(a.default))?new Ar(0,0,0,0):a.type==="color"?Ar.parse(a.default)||null:a.default===void 0?null:a.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=eh(e)}evaluateWithoutErrorHandling(e,i,o,p,a,f,w,E){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=p||null,this._evaluator.availableImages=a||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,p,a,f,w,E){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=a||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=E||null;try{const O=this.expression.evaluate(this._evaluator);if(O==null||typeof O=="number"&&O!=O)return this._defaultValue;if(this._enumValues&&!(O in this._enumValues))throw new yn(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(O)} instead.`);return O}catch(O){return this._warningHistory[O.message]||(this._warningHistory[O.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${O.message}`)),this._defaultValue}}}function pu(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in lu}function la(s,e,i,o){const p=new su(lu,[],e?function(f){const w={color:Gs,string:Lr,number:yi,enum:Lr,boolean:Sr,formatted:ps,resolvedImage:_l};return f.type==="array"?bs(w[f.value]||Tr,f.length):w[f.type]}(e):void 0,void 0,void 0,i,o),a=p.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?id(new du(a,e,i,o)):zo(p.errors)}class sd{constructor(e,i,o,p){this.kind=e,this._styleExpression=i,this.isLightConstant=o,this.isLineProgressConstant=p,this.isStateDependent=e!=="constant"&&!ru(i.expression),this.configDependencies=eh(i.expression)}evaluateWithoutErrorHandling(e,i,o,p,a,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,p,a,f)}evaluate(e,i,o,p,a,f){return this._styleExpression.evaluate(e,i,o,p,a,f)}}class dc{constructor(e,i,o,p,a,f){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!ru(i.expression),this.isLightConstant=a,this.isLineProgressConstant=f,this.configDependencies=eh(i.expression),this.interpolationType=p}evaluateWithoutErrorHandling(e,i,o,p,a,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,p,a,f)}evaluate(e,i,o,p,a,f){return this._styleExpression.evaluate(e,i,o,p,a,f)}interpolationFactor(e,i,o){return this.interpolationType?vo.interpolationFactor(this.interpolationType,e,i,o):0}}function zf(s,e,i,o){if((s=la(s,e,i,o)).result==="error")return s;const p=s.value.expression,a=iu(p);if(!a&&!uu(e))return zo([new Ji("","data expressions not supported")]);const f=Xa(p,["zoom","pitch","distance-from-center"]);if(!f&&!nd(e))return zo([new Ji("","zoom expressions not supported")]);const w=Xa(p,["measure-light"]);if(!w&&!Df(e))return zo([new Ji("","measure-light expression not supported")]);const E=Xa(p,["line-progress"]);if(!E&&!function(C){return rd(C.expression,"line-progress")}(e))return zo([new Ji("","line-progress expression not supported")]);const O=e.expression&&e.expression.relaxZoomRestriction,x=fu(p);return x||f||O?x instanceof Ji?zo([x]):x instanceof vo&&!nh(e)?zo([new Ji("",'"interpolate" expressions cannot be used with this property')]):id(x?new dc(a&&E?"camera":"composite",s.value,x.labels,x instanceof vo?x.interpolation:void 0,w,E):new sd(a&&E?"constant":"source",s.value,w,E)):zo([new Ji("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class pc{constructor(e,i){this._parameters=e,this._specification=i,Bh(this,pp(this._parameters,this._specification))}static deserialize(e){return new pc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function fu(s){let e=null;if(s instanceof Kh)e=fu(s.result);else if(s instanceof Za){for(const i of s.args)if(e=fu(i),e)break}else(s instanceof Ls||s instanceof vo)&&s.input instanceof no&&s.input.name==="zoom"&&(e=s);return e instanceof Ji||s.eachChild(i=>{const o=fu(i);o instanceof Ji?e=o:e&&o&&e!==o&&(e=new Ji("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var fp,Ff,Xm=function(){if(Ff)return fp;Ff=1,fp=e;var s=3;function e(i,o,p){var a=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var f=new Int32Array(this.arrayBuffer);i=f[0],this.d=(o=f[1])+2*(p=f[2]);for(var w=0;w<this.d*this.d;w++){var E=f[s+w],O=f[s+w+1];a.push(E===O?null:f.subarray(E,O))}var x=f[s+a.length+1];this.keys=f.subarray(f[s+a.length],x),this.bboxes=f.subarray(x),this.insert=this._insertReadonly}else{this.d=o+2*p;for(var C=0;C<this.d*this.d;C++)a.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=i,this.padding=p,this.scale=o/i,this.uid=0;var k=p/o*i;this.min=-k,this.max=i+k}return e.prototype.insert=function(i,o,p,a,f){this._forEachCell(o,p,a,f,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(o),this.bboxes.push(p),this.bboxes.push(a),this.bboxes.push(f)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,o,p,a,f,w){this.cells[f].push(w)},e.prototype.query=function(i,o,p,a,f){var w=this.min,E=this.max;if(i<=w&&o<=w&&E<=p&&E<=a&&!f)return Array.prototype.slice.call(this.keys);var O=[];return this._forEachCell(i,o,p,a,this._queryCell,O,{},f),O},e.prototype._queryCell=function(i,o,p,a,f,w,E,O){var x=this.cells[f];if(x!==null)for(var C=this.keys,k=this.bboxes,M=0;M<x.length;M++){var P=x[M];if(E[P]===void 0){var R=4*P;(O?O(k[R+0],k[R+1],k[R+2],k[R+3]):i<=k[R+2]&&o<=k[R+3]&&p>=k[R+0]&&a>=k[R+1])?(E[P]=!0,w.push(C[P])):E[P]=!1}}},e.prototype._forEachCell=function(i,o,p,a,f,w,E,O){for(var x=this._convertToCellCoord(i),C=this._convertToCellCoord(o),k=this._convertToCellCoord(p),M=this._convertToCellCoord(a),P=x;P<=k;P++)for(var R=C;R<=M;R++){var $=this.d*R+P;if((!O||O(this._convertFromCellCoord(P),this._convertFromCellCoord(R),this._convertFromCellCoord(P+1),this._convertFromCellCoord(R+1)))&&f.call(this,i,o,p,a,$,w,E,O))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,o=s+this.cells.length+1+1,p=0,a=0;a<this.cells.length;a++)p+=this.cells[a].length;var f=new Int32Array(o+p+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var w=o,E=0;E<i.length;E++){var O=i[E];f[s+E]=w,f.set(O,w),w+=O.length}return f[s+i.length]=w,f.set(this.keys,w),f[s+i.length+1]=w+=this.keys.length,f.set(this.bboxes,w),w+=this.bboxes.length,f.buffer},fp}(),fc=q(Xm);const od={};function _i(s,e,i={}){Object.defineProperty(s,"_classRegistryKey",{value:e,writable:!1}),od[e]={klass:s,omit:i.omit||[]}}_i(Object,"Object"),fc.serialize=function(s,e){const i=s.toArrayBuffer();return e&&e.add(i),{buffer:i}},fc.deserialize=function(s){return new fc(s.buffer)},Object.defineProperty(fc,"name",{value:"Grid"}),_i(fc,"Grid"),typeof DOMMatrix<"u"&&_i(DOMMatrix,"DOMMatrix"),_i(Ar,"Color"),_i(Error,"Error"),_i(Ds,"Formatted"),_i(Yu,"FormattedSection"),_i(Bn,"AJAXError"),_i(ks,"ResolvedImage"),_i(pc,"StylePropertyFunction"),_i(du,"StyleExpression",{omit:["_evaluator"]}),_i(yo,"ImageIdWithOptions"),_i(dc,"ZoomDependentExpression"),_i(sd,"ZoomConstantExpression"),_i(no,"CompoundExpression",{omit:["_evaluate"]});for(const s in lu)od[lu[s]._classRegistryKey]||_i(lu[s],`Expression${s}`);function mu(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function sh(s){return self.ImageBitmap&&s instanceof ImageBitmap}function Al(s,e){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(mu(s)||sh(s))return e&&e.add(s),s;if(ArrayBuffer.isView(s))return e&&e.add(s.buffer),s;if(s instanceof ImageData)return e&&e.add(s.data.buffer),s;if(Array.isArray(s)){const i=[];for(const o of s)i.push(Al(o,e));return i}if(s instanceof Map){const i={$name:"Map"};for(const[o,p]of s.entries())i[o]=Al(p);return i}if(s instanceof Set){const i={$name:"Set"};let o=0;for(const p of s.values())i[++o]=Al(p);return i}if(typeof s=="object"){const i=s.constructor,o=i._classRegistryKey;if(!o)throw new Error(`Can't serialize object of unregistered class "${o}".`);const p=i.serialize?i.serialize(s,e):{};if(!i.serialize){for(const a in s)s.hasOwnProperty(a)&&(od[o].omit.indexOf(a)>=0||(p[a]=Al(s[a],e)));s instanceof Error&&(p.message=s.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(p.$name=o),p}throw new Error("can't serialize object of type "+typeof s)}function mc(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||mu(s)||sh(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(mc);if(typeof s=="object"){const e=s.$name||"Object";if(e==="Map"){const p=new Map;for(const a of Object.keys(s))a!=="$name"&&p.set(a,mc(s[a]));return p}if(e==="Set"){const p=new Set;for(const a of Object.keys(s))a!=="$name"&&p.add(mc(s[a]));return p}const{klass:i}=od[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(s);const o=Object.create(i.prototype);for(const p of Object.keys(s))p!=="$name"&&(o[p]=mc(s[p]));return o}throw new Error("can't deserialize object of type "+typeof s)}const wi={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519,Osage:s=>s>=66736&&s<=66815,"CJK Unified Ideographs Extension B":s=>s>=131072&&s<=173791};function Ba(s){for(const e of s)if(ca(e.charCodeAt(0)))return!0;return!1}function ad(s){for(const e of s)if(!Bf(e.charCodeAt(0)))return!1;return!0}function Bf(s){return!(wi.Arabic(s)||wi["Arabic Supplement"](s)||wi["Arabic Extended-A"](s)||wi["Arabic Presentation Forms-A"](s)||wi["Arabic Presentation Forms-B"](s))}function ca(s){return!(s!==746&&s!==747&&(s<4352||!(wi["Bopomofo Extended"](s)||wi.Bopomofo(s)||wi["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||wi["CJK Compatibility Ideographs"](s)||wi["CJK Compatibility"](s)||wi["CJK Radicals Supplement"](s)||wi["CJK Strokes"](s)||!(!wi["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||wi["CJK Unified Ideographs Extension A"](s)||wi["CJK Unified Ideographs"](s)||wi["Enclosed CJK Letters and Months"](s)||wi["Hangul Compatibility Jamo"](s)||wi["Hangul Jamo Extended-A"](s)||wi["Hangul Jamo Extended-B"](s)||wi["Hangul Jamo"](s)||wi["Hangul Syllables"](s)||wi.Hiragana(s)||wi["Ideographic Description Characters"](s)||wi.Kanbun(s)||wi["Kangxi Radicals"](s)||wi["Katakana Phonetic Extensions"](s)||wi.Katakana(s)&&s!==12540||!(!wi["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!wi["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||wi["Unified Canadian Aboriginal Syllabics"](s)||wi["Unified Canadian Aboriginal Syllabics Extended"](s)||wi["Vertical Forms"](s)||wi["Yijing Hexagram Symbols"](s)||wi["Yi Syllables"](s)||wi["Yi Radicals"](s))))}function mp(s){return!(ca(s)||function(e){return!!(wi["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||wi["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||wi["Letterlike Symbols"](e)||wi["Number Forms"](e)||wi["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||wi["Control Pictures"](e)&&e!==9251||wi["Optical Character Recognition"](e)||wi["Enclosed Alphanumerics"](e)||wi["Geometric Shapes"](e)||wi["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||wi["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||wi["CJK Symbols and Punctuation"](e)||wi.Katakana(e)||wi["Private Use Area"](e)||wi["CJK Compatibility Forms"](e)||wi["Small Form Variants"](e)||wi["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(s))}function ld(s){return s>=1424&&s<=2303||wi["Arabic Presentation Forms-A"](s)||wi["Arabic Presentation Forms-B"](s)}function Nf(s,e){return!(!e&&ld(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||wi.Khmer(s))}function gc(s){for(const e of s)if(ld(e.charCodeAt(0)))return!0;return!1}const Jo="deferred",cd="loading",oh="loaded";let Na=null,xo="unavailable",Ss=null;const gp=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(xo="error"),Na&&Na(s)};function ah(){Pl.fire(new oa("pluginStateChange",{pluginStatus:xo,pluginURL:Ss}))}const Pl=new aa,lh=function(){return xo},Qo=function(){if(xo!==Jo||!Ss)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");xo=cd,ah(),Ss&&Nn({url:Ss},s=>{s?gp(s):(xo=oh,ah())})},Qs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>xo===oh||Qs.applyArabicShaping!=null,isLoading:()=>xo===cd,setState(s){xo=s.pluginStatus,Ss=s.pluginURL},isParsed:()=>Qs.applyArabicShaping!=null&&Qs.processBidirectionalText!=null&&Qs.processStyledBidirectionalText!=null,getPluginURL:()=>Ss};class Vr{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,o){for(const p of i)if(!Nf(p.charCodeAt(0),o))return!1;return!0}(e,Qs.isLoaded())}}class ud{constructor(e,i,o,p){this.property=e,this.value=i,this.expression=function(a,f,w,E){if(Cl(a))return new pc(a,f);if(pu(a)||Array.isArray(a)&&a.length>0){const O=zf(a,f,w,E);if(O.result==="error")throw new Error(O.value.map(x=>`${x.key}: ${x.message}`).join(", "));return O.value}{let O=a;return typeof a=="string"&&f.type==="color"&&(O=Ar.parse(a)),{kind:"constant",configDependencies:new Set,evaluate:()=>O}}}(i===void 0?e.specification.default:i,e.specification,o,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class ch{constructor(e,i,o){this.property=e,this.value=new ud(e,void 0,i,o)}transitioned(e,i){return new _p(this.property,this.value,i,Zs({},e.transition,this.transition),e.now)}untransitioned(){return new _p(this.property,this.value,null,{},0)}}class bo{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return zn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ch(this._values[e].property,this._scope,this._options)),this._values[e].value=new ud(this._values[e].property,i===null?void 0:zn(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const o=this._properties.properties;if(e)for(const p in e){const a=e[p];if(ro(p,"-transition")){const f=p.slice(0,-11);o[f]&&this.setTransition(f,a)}else o.hasOwnProperty(p)&&this.setValue(p,a)}}getTransition(e){return zn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ch(this._values[e].property)),this._values[e].transition=zn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const p=this.getTransition(i);p!==void 0&&(e[`${i}-transition`]=p)}return e}transitioned(e,i){const o=new gu(this._properties);for(const p of Object.keys(this._values))o._values[p]=this._values[p].transitioned(e,i._values[p]);return o}untransitioned(){const e=new gu(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class _p{constructor(e,i,o,p,a){const f=p.delay||0,w=p.duration||0;a=a||0,this.property=e,this.value=i,this.begin=a+f,this.end=this.begin+w,e.specification.transition&&(p.delay||p.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const p=e.now||0,a=this.value.possiblyEvaluate(e,i,o),f=this.prior;if(f){if(p>this.end)return this.prior=null,a;if(this.value.isDataDriven())return this.prior=null,a;if(p<this.begin)return f.possiblyEvaluate(e,i,o);{const w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,i,o),a,Ea(w))}}return a}}class gu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const p=new yc(this._properties);for(const a of Object.keys(this._values))p._values[a]=this._values[a].possiblyEvaluate(e,i,o);return p}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Vn{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return zn(this._values[e].value)}setValue(e,i){this._values[e]=new ud(this._values[e].property,i===null?void 0:zn(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const p=new yc(this._properties);for(const a of Object.keys(this._values))p._values[a]=this._values[a].possiblyEvaluate(e,i,o);return p}}class _c{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,p){return this.property.evaluate(this.value,this.parameters,e,i,o,p)}}class yc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ht{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){const p=Do[this.specification.type];return p?p(e,i,o):e}}class li{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,p){return new _c(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,p)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new _c(this,{kind:"constant",value:void 0},e.parameters);const p=Do[this.specification.type];return p?new _c(this,{kind:"constant",value:p(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,p,a,f){return e.kind==="constant"?e.value:e.evaluate(i,o,p,a,f)}}class Ka{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,p){return!!e.expression.evaluate(i,null,{},o,p)}interpolate(){return!1}}class on{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Vr(0,{});for(const o in e){const p=e[o];p.specification.overridable&&this.overridableProperties.push(o);const a=this.defaultPropertyValues[o]=new ud(p,void 0),f=this.defaultTransitionablePropertyValues[o]=new ch(p);this.defaultTransitioningPropertyValues[o]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=a.possiblyEvaluate(i)}}}_i(li,"DataDrivenProperty"),_i(Ht,"DataConstantProperty"),_i(Ka,"ColorRampProperty");var dt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function Vf(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function uh(s){if(Array.isArray(s))return s.map(uh);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const e={};for(const i in s)e[i]=uh(s[i]);return e}return Vf(s)}function hd(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!hd(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function yp(s,e="",i=null,o="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};hd(s)||(s=vc(s));const p=s;let a=!0;try{a=function(x){if(!_u(x))return x;let C=uh(x);return jf(C),C=Uf(C),C}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let f=null,w=null;if(o!=="background"&&o!=="sky"&&o!=="slot"){w=dt[`filter_${o}`];const x=la(a,w,e,i);if(x.result==="error")throw new Error(x.value.map(C=>`${C.key}: ${C.message}`).join(", "));f=(C,k,M)=>x.value.evaluate(C,k,{},M)}let E=null,O=null;if(a!==p){const x=la(p,w,e,i);if(x.result==="error")throw new Error(x.value.map(C=>`${C.key}: ${C.message}`).join(", "));E=(C,k,M,P,R)=>x.value.evaluate(C,k,{},M,void 0,void 0,P,R),O=!iu(x.value.expression)}return{filter:f,dynamicFilter:E||void 0,needGeometry:Gf(a),needFeature:!!O}}function Uf(s){if(!Array.isArray(s))return s;const e=function(i){if(Gn.has(i[0])){for(let o=1;o<i.length;o++)if(_u(i[o]))return!0}return i}(s);return e===!0?e:e.map(i=>Uf(i))}function jf(s){let e=!1;const i=[];if(s[0]==="case"){for(let o=1;o<s.length-1;o+=2)e=e||_u(s[o]),i.push(s[o+1]);i.push(s[s.length-1])}else if(s[0]==="match"){e=e||_u(s[1]);for(let o=2;o<s.length-1;o+=2)i.push(s[o+1]);i.push(s[s.length-1])}else if(s[0]==="step"){e=e||_u(s[1]);for(let o=1;o<s.length-1;o+=2)i.push(s[o+1])}e&&(s.length=0,s.push("any",...i));for(let o=1;o<s.length;o++)jf(s[o])}function _u(s){if(!Array.isArray(s))return!1;if((e=s[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<s.length;i++)if(_u(s[i]))return!0;return!1}const Gn=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function $f(s,e){return s<e?-1:s>e?1:0}function Gf(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let e=1;e<s.length;e++)if(Gf(s[e]))return!0;return!1}function vc(s){if(!s)return!0;const e=s[0];return s.length<=1?e!=="any":e==="=="?Il(s[1],s[2],"=="):e==="!="?ea(Il(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Il(s[1],s[2],e):e==="any"?(i=s.slice(1),["any"].concat(i.map(vc))):e==="all"?["all"].concat(s.slice(1).map(vc)):e==="none"?["all"].concat(s.slice(1).map(vc).map(ea)):e==="in"?vp(s[1],s.slice(2)):e==="!in"?ea(vp(s[1],s.slice(2))):e==="has"?xp(s[1]):e!=="!has"||ea(xp(s[1]));var i}function Il(s,e,i){switch(s){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,s,e]}}function vp(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",s,["literal",e.sort($f)]]:["filter-in-small",s,["literal",e]]}}function xp(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function ea(s){return["!",s]}const yu="";function ua(s,e){return e?`${s}${yu}${e}`:s}const Va="-transition",bp=new Set(["fill","line","background","hillshade","raster"]);class ms extends aa{constructor(e,i,o,p,a){if(super(),this.id=e.id,this.fqid=ua(this.id,o),this.type=e.type,this.scope=o,this.lut=p,this.options=a,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const f=la(this.filter,dt[`filter_${e.type}`]);f.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...f.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new Vn(i.layout,this.scope,a),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new bo(i.paint,this.scope,a);for(const f in e.paint)this.setPaintProperty(f,e.paint[f]);for(const f in e.layout)this.setLayoutProperty(f,e.layout[f]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new yc(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D()&&bp.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return ro(e,Va)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const o=this._transitionablePaint,p=o._properties.properties;if(ro(e,Va)){const C=e.slice(0,-11);return p[C]&&o.setTransition(C,i||void 0),!1}if(!p[e])return!1;const a=o._values[e],f=a.value.isDataDriven(),w=a.value;o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const E=o._values[e].value,O=E.isDataDriven(),x=ro(e,"pattern")||e==="line-dasharray";return O||f||x||this._handleOverridablePaintPropertyUpdate(e,w,E)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,o){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return pl({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof _c&&uu(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=yp(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,o,p,a,f,w,E,O){}}const Ts={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class hh{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class en{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ir(s,e=1){let i=0,o=0;return{members:s.map(p=>{const a=Ts[p.type].BYTES_PER_ELEMENT,f=i=dh(i,Math.max(e,a)),w=p.components||1;return o=Math.max(o,a),i+=a*w,{name:p.name,type:p.type,components:w,offset:f}}),size:dh(i,Math.max(o,e)),alignment:e}}function dh(s,e){return Math.ceil(s/e)*e}class wo extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const p=2*e;return this.int16[p+0]=i,this.int16[p+1]=o,e}}wo.prototype.bytesPerElement=4,_i(wo,"StructArrayLayout2i4");class vu extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o)}emplace(e,i,o,p){const a=3*e;return this.int16[a+0]=i,this.int16[a+1]=o,this.int16[a+2]=p,e}}vu.prototype.bytesPerElement=6,_i(vu,"StructArrayLayout3i6");class tn extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,p){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o,p)}emplace(e,i,o,p,a){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=p,this.int16[f+3]=a,e}}tn.prototype.bytesPerElement=8,_i(tn,"StructArrayLayout4i8");class dd extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,p,a){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,p,a)}emplace(e,i,o,p,a,f){const w=5*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.int16[w+2]=p,this.int16[w+3]=a,this.int16[w+4]=f,e}}dd.prototype.bytesPerElement=10,_i(dd,"StructArrayLayout5i10");class xu extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,a,f,w){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,o,p,a,f,w)}emplace(e,i,o,p,a,f,w,E){const O=6*e,x=12*e,C=3*e;return this.int16[O+0]=i,this.int16[O+1]=o,this.uint8[x+4]=p,this.uint8[x+5]=a,this.uint8[x+6]=f,this.uint8[x+7]=w,this.float32[C+2]=E,e}}xu.prototype.bytesPerElement=12,_i(xu,"StructArrayLayout2i4ub1f12");class ha extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o)}emplace(e,i,o,p){const a=3*e;return this.float32[a+0]=i,this.float32[a+1]=o,this.float32[a+2]=p,e}}ha.prototype.bytesPerElement=12,_i(ha,"StructArrayLayout3f12");class Rs extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,a){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,p,a)}emplace(e,i,o,p,a,f){const w=6*e,E=3*e;return this.uint16[w+0]=i,this.uint16[w+1]=o,this.uint16[w+2]=p,this.uint16[w+3]=a,this.float32[E+2]=f,e}}Rs.prototype.bytesPerElement=12,_i(Rs,"StructArrayLayout4ui1f12");class ls extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,p){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o,p)}emplace(e,i,o,p,a){const f=4*e;return this.uint16[f+0]=i,this.uint16[f+1]=o,this.uint16[f+2]=p,this.uint16[f+3]=a,e}}ls.prototype.bytesPerElement=8,_i(ls,"StructArrayLayout4ui8");class ph extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,p,a,f){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,p,a,f)}emplace(e,i,o,p,a,f,w){const E=6*e;return this.int16[E+0]=i,this.int16[E+1]=o,this.int16[E+2]=p,this.int16[E+3]=a,this.int16[E+4]=f,this.int16[E+5]=w,e}}ph.prototype.bytesPerElement=12,_i(ph,"StructArrayLayout6i12");class Dl extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,p,a,f,w,E,O,x,C,k){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,o,p,a,f,w,E,O,x,C,k)}emplace(e,i,o,p,a,f,w,E,O,x,C,k,M){const P=12*e;return this.int16[P+0]=i,this.int16[P+1]=o,this.int16[P+2]=p,this.int16[P+3]=a,this.uint16[P+4]=f,this.uint16[P+5]=w,this.uint16[P+6]=E,this.uint16[P+7]=O,this.int16[P+8]=x,this.int16[P+9]=C,this.int16[P+10]=k,this.int16[P+11]=M,e}}Dl.prototype.bytesPerElement=24,_i(Dl,"StructArrayLayout4i4ui4i24");class fh extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,a,f){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,p,a,f)}emplace(e,i,o,p,a,f,w){const E=10*e,O=5*e;return this.int16[E+0]=i,this.int16[E+1]=o,this.int16[E+2]=p,this.float32[O+2]=a,this.float32[O+3]=f,this.float32[O+4]=w,e}}fh.prototype.bytesPerElement=20,_i(fh,"StructArrayLayout3i3f20");class ln extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o,p)}emplace(e,i,o,p,a){const f=4*e;return this.float32[f+0]=i,this.float32[f+1]=o,this.float32[f+2]=p,this.float32[f+3]=a,e}}ln.prototype.bytesPerElement=16,_i(ln,"StructArrayLayout4f16");class wp extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}wp.prototype.bytesPerElement=4,_i(wp,"StructArrayLayout1ul4");class Ja extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const p=2*e;return this.uint16[p+0]=i,this.uint16[p+1]=o,e}}Ja.prototype.bytesPerElement=4,_i(Ja,"StructArrayLayout2ui4");class kl extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,p,a,f,w,E,O,x,C,k,M){const P=this.length;return this.resize(P+1),this.emplace(P,e,i,o,p,a,f,w,E,O,x,C,k,M)}emplace(e,i,o,p,a,f,w,E,O,x,C,k,M,P){const R=20*e,$=10*e;return this.int16[R+0]=i,this.int16[R+1]=o,this.int16[R+2]=p,this.int16[R+3]=a,this.int16[R+4]=f,this.float32[$+3]=w,this.float32[$+4]=E,this.float32[$+5]=O,this.float32[$+6]=x,this.int16[R+14]=C,this.uint32[$+8]=k,this.uint16[R+18]=M,this.uint16[R+19]=P,e}}kl.prototype.bytesPerElement=40,_i(kl,"StructArrayLayout5i4f1i1ul2ui40");class eo extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,p,a,f,w){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,o,p,a,f,w)}emplace(e,i,o,p,a,f,w,E){const O=8*e;return this.int16[O+0]=i,this.int16[O+1]=o,this.int16[O+2]=p,this.int16[O+4]=a,this.int16[O+5]=f,this.int16[O+6]=w,this.int16[O+7]=E,e}}eo.prototype.bytesPerElement=16,_i(eo,"StructArrayLayout3i2i2i16");class Sp extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,p,a){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,p,a)}emplace(e,i,o,p,a,f){const w=4*e,E=8*e;return this.float32[w+0]=i,this.float32[w+1]=o,this.float32[w+2]=p,this.int16[E+6]=a,this.int16[E+7]=f,e}}Sp.prototype.bytesPerElement=16,_i(Sp,"StructArrayLayout2f1f2i16");class Tp extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,a,f){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,p,a,f)}emplace(e,i,o,p,a,f,w){const E=20*e,O=5*e;return this.uint8[E+0]=i,this.uint8[E+1]=o,this.float32[O+1]=p,this.float32[O+2]=a,this.float32[O+3]=f,this.float32[O+4]=w,e}}Tp.prototype.bytesPerElement=20,_i(Tp,"StructArrayLayout2ub4f20");class gs extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o)}emplace(e,i,o,p){const a=3*e;return this.uint16[a+0]=i,this.uint16[a+1]=o,this.uint16[a+2]=p,e}}gs.prototype.bytesPerElement=6,_i(gs,"StructArrayLayout3ui6");class Mp extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,a,f,w,E,O,x,C,k,M,P,R,$,G,J,ee,Z,ne){const le=this.length;return this.resize(le+1),this.emplace(le,e,i,o,p,a,f,w,E,O,x,C,k,M,P,R,$,G,J,ee,Z,ne)}emplace(e,i,o,p,a,f,w,E,O,x,C,k,M,P,R,$,G,J,ee,Z,ne,le){const fe=30*e,Ce=15*e,Ee=60*e;return this.int16[fe+0]=i,this.int16[fe+1]=o,this.int16[fe+2]=p,this.float32[Ce+2]=a,this.float32[Ce+3]=f,this.uint16[fe+8]=w,this.uint16[fe+9]=E,this.uint32[Ce+5]=O,this.uint32[Ce+6]=x,this.uint32[Ce+7]=C,this.uint16[fe+16]=k,this.uint16[fe+17]=M,this.uint16[fe+18]=P,this.float32[Ce+10]=R,this.float32[Ce+11]=$,this.uint8[Ee+48]=G,this.uint8[Ee+49]=J,this.uint8[Ee+50]=ee,this.uint32[Ce+13]=Z,this.int16[fe+28]=ne,this.uint8[Ee+58]=le,e}}Mp.prototype.bytesPerElement=60,_i(Mp,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class pd extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,a,f,w,E,O,x,C,k,M,P,R,$,G,J,ee,Z,ne,le,fe,Ce,Ee,Me,$e,De,Ge,Xe,qe,et){const nt=this.length;return this.resize(nt+1),this.emplace(nt,e,i,o,p,a,f,w,E,O,x,C,k,M,P,R,$,G,J,ee,Z,ne,le,fe,Ce,Ee,Me,$e,De,Ge,Xe,qe,et)}emplace(e,i,o,p,a,f,w,E,O,x,C,k,M,P,R,$,G,J,ee,Z,ne,le,fe,Ce,Ee,Me,$e,De,Ge,Xe,qe,et,nt){const ct=20*e,it=40*e,Ct=80*e;return this.float32[ct+0]=i,this.float32[ct+1]=o,this.int16[it+4]=p,this.int16[it+5]=a,this.int16[it+6]=f,this.int16[it+7]=w,this.int16[it+8]=E,this.int16[it+9]=O,this.int16[it+10]=x,this.int16[it+11]=C,this.int16[it+12]=k,this.uint16[it+13]=M,this.uint16[it+14]=P,this.uint16[it+15]=R,this.uint16[it+16]=$,this.uint16[it+17]=G,this.uint16[it+18]=J,this.uint16[it+19]=ee,this.uint16[it+20]=Z,this.uint16[it+21]=ne,this.uint16[it+22]=le,this.uint16[it+23]=fe,this.uint16[it+24]=Ce,this.uint16[it+25]=Ee,this.uint16[it+26]=Me,this.uint16[it+27]=$e,this.uint32[ct+14]=De,this.float32[ct+15]=Ge,this.float32[ct+16]=Xe,this.float32[ct+17]=qe,this.float32[ct+18]=et,this.uint8[Ct+76]=nt,e}}pd.prototype.bytesPerElement=80,_i(pd,"StructArrayLayout2f9i15ui1ul4f1ub80");class mh extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}mh.prototype.bytesPerElement=4,_i(mh,"StructArrayLayout1f4");class Ol extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,a){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,p,a)}emplace(e,i,o,p,a,f){const w=5*e;return this.float32[w+0]=i,this.float32[w+1]=o,this.float32[w+2]=p,this.float32[w+3]=a,this.float32[w+4]=f,e}}Ol.prototype.bytesPerElement=20,_i(Ol,"StructArrayLayout5f20");class xc extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,a,f,w){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,o,p,a,f,w)}emplace(e,i,o,p,a,f,w,E){const O=7*e;return this.float32[O+0]=i,this.float32[O+1]=o,this.float32[O+2]=p,this.float32[O+3]=a,this.float32[O+4]=f,this.float32[O+5]=w,this.float32[O+6]=E,e}}xc.prototype.bytesPerElement=28,_i(xc,"StructArrayLayout7f28");class Ua extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,a,f,w,E,O,x,C){const k=this.length;return this.resize(k+1),this.emplace(k,e,i,o,p,a,f,w,E,O,x,C)}emplace(e,i,o,p,a,f,w,E,O,x,C,k){const M=11*e;return this.float32[M+0]=i,this.float32[M+1]=o,this.float32[M+2]=p,this.float32[M+3]=a,this.float32[M+4]=f,this.float32[M+5]=w,this.float32[M+6]=E,this.float32[M+7]=O,this.float32[M+8]=x,this.float32[M+9]=C,this.float32[M+10]=k,e}}Ua.prototype.bytesPerElement=44,_i(Ua,"StructArrayLayout11f44");class fd extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,a,f,w,E,O){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,p,a,f,w,E,O)}emplace(e,i,o,p,a,f,w,E,O,x){const C=9*e;return this.float32[C+0]=i,this.float32[C+1]=o,this.float32[C+2]=p,this.float32[C+3]=a,this.float32[C+4]=f,this.float32[C+5]=w,this.float32[C+6]=E,this.float32[C+7]=O,this.float32[C+8]=x,e}}fd.prototype.bytesPerElement=36,_i(fd,"StructArrayLayout9f36");class Ll extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const p=2*e;return this.float32[p+0]=i,this.float32[p+1]=o,e}}Ll.prototype.bytesPerElement=8,_i(Ll,"StructArrayLayout2f8");class Ep extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,p){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o,p)}emplace(e,i,o,p,a){const f=6*e;return this.uint32[3*e+0]=i,this.uint16[f+2]=o,this.uint16[f+3]=p,this.uint16[f+4]=a,e}}Ep.prototype.bytesPerElement=12,_i(Ep,"StructArrayLayout1ul3ui12");class Cp extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Cp.prototype.bytesPerElement=2,_i(Cp,"StructArrayLayout1ui2");class Fo extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,a,f,w,E,O,x,C,k,M,P,R,$){const G=this.length;return this.resize(G+1),this.emplace(G,e,i,o,p,a,f,w,E,O,x,C,k,M,P,R,$)}emplace(e,i,o,p,a,f,w,E,O,x,C,k,M,P,R,$,G){const J=16*e;return this.float32[J+0]=i,this.float32[J+1]=o,this.float32[J+2]=p,this.float32[J+3]=a,this.float32[J+4]=f,this.float32[J+5]=w,this.float32[J+6]=E,this.float32[J+7]=O,this.float32[J+8]=x,this.float32[J+9]=C,this.float32[J+10]=k,this.float32[J+11]=M,this.float32[J+12]=P,this.float32[J+13]=R,this.float32[J+14]=$,this.float32[J+15]=G,e}}Fo.prototype.bytesPerElement=64,_i(Fo,"StructArrayLayout16f64");class bu extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,a,f,w){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,o,p,a,f,w)}emplace(e,i,o,p,a,f,w,E){const O=10*e,x=5*e;return this.uint16[O+0]=i,this.uint16[O+1]=o,this.uint16[O+2]=p,this.uint16[O+3]=a,this.float32[x+2]=f,this.float32[x+3]=w,this.float32[x+4]=E,e}}bu.prototype.bytesPerElement=20,_i(bu,"StructArrayLayout4ui3f20");class Qa extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Qa.prototype.bytesPerElement=2,_i(Qa,"StructArrayLayout1i2");class oo extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}oo.prototype.bytesPerElement=1,_i(oo,"StructArrayLayout1ub1");class Hf extends hh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Hf.prototype.size=40;class Ap extends kl{get(e){return new Hf(this,e)}}_i(Ap,"CollisionBoxArray");class gh extends hh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}gh.prototype.size=60;class Wf extends Mp{get(e){return new gh(this,e)}}_i(Wf,"PlacedSymbolArray");class md extends hh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}md.prototype.size=80;class Pp extends pd{get(e){return new md(this,e)}}_i(Pp,"SymbolInstanceArray");class gd extends mh{getoffsetX(e){return this.float32[1*e+0]}}_i(gd,"GlyphOffsetArray");class qf extends wo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}_i(qf,"SymbolLineVertexArray");class bc extends hh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}bc.prototype.size=12;class wc extends Ep{get(e){return new bc(this,e)}}_i(wc,"FeatureIndexArray");class So extends Ja{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}_i(So,"FillExtrusionCentroidArray");class wu extends hh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}wu.prototype.size=6;class Rl extends vu{get(e){return new wu(this,e)}}_i(Rl,"FillExtrusionWallArray");const _h=Ir([{name:"a_pos",components:2,type:"Int16"}],4),Yf=Ir([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Sn{constructor(e=[]){this.segments=e}_prepareSegment(e,i,o,p){let a=this.segments[this.segments.length-1];return e>Sn.MAX_VERTEX_ARRAY_LENGTH&&qi(`Max vertices per segment is ${Sn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!a||a.vertexLength+e>Sn.MAX_VERTEX_ARRAY_LENGTH||a.sortKey!==p)&&(a={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},p!==void 0&&(a.sortKey=p),this.segments.push(a)),a}prepareSegment(e,i,o,p){return this._prepareSegment(e,i.length,o.length,p)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,p){return new Sn([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:p,vaos:{},sortKey:0}])}}function yh(s,e){return 256*(s=nr(Math.floor(s),0,255))+nr(Math.floor(e),0,255)}Sn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_i(Sn,"SegmentVector");const Ip=Ir([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),vh=Ir([{name:"a_dash",components:4,type:"Uint16"}]);class Su{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,o,p){this.ids.push(_d(e)),this.positions.push(i,o,p)}eachPosition(e,i){const o=_d(e);let p=0,a=this.ids.length-1;for(;p<a;){const f=p+a>>1;this.ids[f]>=o?a=f:p=f+1}for(;this.ids[p]===o;)i(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(e,i){const o=new Float64Array(e.ids),p=new Uint32Array(e.positions);return ao(o,p,0,o.length-1),i&&(i.add(o.buffer),i.add(p.buffer)),{ids:o,positions:p}}static deserialize(e){const i=new Su;let o;i.ids=e.ids,i.positions=e.positions;for(const p of i.ids)p!==o&&i.uniqueIds.push(p),o=p;return i.indexed=!0,i}}function _d(s){const e=+s;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:sa(String(s))}function ao(s,e,i,o){for(;i<o;){const p=s[i+o>>1];let a=i-1,f=o+1;for(;;){do a++;while(s[a]<p);do f--;while(s[f]>p);if(a>=f)break;da(s,a,f),da(e,3*a,3*f),da(e,3*a+1,3*f+1),da(e,3*a+2,3*f+2)}f-i<o-f?(ao(s,e,i,f),i=f+1):(ao(s,e,f+1,o),o=f)}}function da(s,e,i){const o=s[e];s[e]=s[i],s[i]=o}_i(Su,"FeaturePositionMap");class pa{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class xh extends pa{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class Pn extends pa{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class To extends pa{constructor(e){super(e),this.current=[0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class Bo extends pa{constructor(e){super(e),this.current=[0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class Sc extends pa{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class Ur extends pa{constructor(e){super(e),this.current=Ar.transparent.toRenderColor(null)}set(e,i,o){this.fetchUniformLocation(e,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const Xf=new Float32Array(16);class Tc extends pa{constructor(e){super(e),this.current=Xf}set(e,i,o){if(this.fetchUniformLocation(e,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let p=1;p<16;p++)if(o[p]!==this.current[p]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}const Dp=new Float32Array(9),Tu=new Float32Array(4);class kp extends pa{constructor(e){super(e),this.current=Tu}set(e,i,o){if(this.fetchUniformLocation(e,i)){for(let p=0;p<4;p++)if(o[p]!==this.current[p]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function Mu(s){return[yh(255*s.r,255*s.g),yh(255*s.b,255*s.a)]}class lo{constructor(e,i,o,p){this.value=e,this.uniformNames=i.map(a=>`u_${a}`),this.type=o,this.context=p}setUniform(e,i,o,p,a){const f=p.constantOr(this.value);i.set(e,a,f instanceof Ar?f.toRenderColor(this.ignoreLut?null:this.context.lut):f)}getBinding(e,i){return this.type==="color"?new Ur(e):new Pn(e)}}class el{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,o,p,a){const f=a==="u_pattern"||a==="u_dash"?this.pattern:a==="u_pixel_ratio"?this.pixelRatio:null;f&&i.set(e,a,f)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new Sc(e):new Pn(e)}}class In{constructor(e,i,o,p){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(a=>({name:`a_${a}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,i,o,p,a,f,w){const E=this.paintVertexArray.length,O=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Vr(0,{brightness:f}),i,{},a,p,w):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new Vr(0,{brightness:f}),i,{},a,p,w)==="none"),this.paintVertexArray.resize(e),this._setPaintValue(E,e,O,this.context)}updatePaintArray(e,i,o,p,a,f,w){const E=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:w},o,p,void 0,a):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:0,brightness:w},o,p,void 0,a)==="none"),this._setPaintValue(e,i,E,this.context)}_setPaintValue(e,i,o,p){if(this.type==="color"){const a=Mu(o.toRenderColor(this.ignoreLut?null:p.lut));for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,a[0],a[1])}else{for(let a=e;a<i;a++)this.paintVertexArray.emplace(a,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fa{constructor(e,i,o,p,a,f){this.expression=e,this.uniformNames=i.map(w=>`u_${w}_t`),this.type=o,this.useIntegerZoom=p,this.context=a,this.maxValue=0,this.paintVertexAttributes=i.map(w=>({name:`a_${w}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,i,o,p,a,f,w){const E=this.expression.evaluate(new Vr(this.context.zoom,{brightness:f}),i,{},a,p,w),O=this.expression.evaluate(new Vr(this.context.zoom+1,{brightness:f}),i,{},a,p,w);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new Vr(this.context.zoom,{brightness:f}),i,{},a,p,w)==="none");const x=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(x,e,E,O,this.context)}updatePaintArray(e,i,o,p,a,f,w){const E=this.expression.evaluate({zoom:this.context.zoom,brightness:w},o,p,void 0,a),O=this.expression.evaluate({zoom:this.context.zoom+1,brightness:w},o,p,void 0,a);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:this.context.zoom,brightness:w},o,p,void 0,a)==="none"),this._setPaintValue(e,i,E,O,this.context)}_setPaintValue(e,i,o,p,a){if(this.type==="color"){const f=Mu(o.toRenderColor(this.ignoreLut?null:a.lut)),w=Mu(o.toRenderColor(this.ignoreLut?null:a.lut));for(let E=e;E<i;E++)this.paintVertexArray.emplace(E,f[0],f[1],w[0],w[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,o,p);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(p))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,o,p,a){const f=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,w=nr(this.expression.interpolationFactor(f,this.context.zoom,this.context.zoom+1),0,1);i.set(e,a,w)}getBinding(e,i){return new Pn(e)}}class tl{constructor(e,i,o,p,a){this.expression=e,this.layerId=a,this.paintVertexAttributes=(o==="array"?vh:Ip).members;for(let f=0;f<i.length;++f);this.paintVertexArray=new p}populatePaintArray(e,i,o,p){const a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(a,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,p,a,f,w){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],f)}_setPaintValues(e,i,o,p){if(!p||!o)return;const a=p[o];if(!a)return;const{tl:f,br:w,pixelRatio:E}=a;for(let O=e;O<i;O++)this.paintVertexArray.emplace(O,f[0],f[1],w[0],w[1],E)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class zl{constructor(e,i,o=()=>!0){this.binders={},this._buffers=[],this.context=i;const p=[];for(const a in e.paint._values){const f=e.paint.get(a),w=e.paint.get(`${a}-use-theme`);if(a.endsWith("-use-theme")||!o(a)||!(f instanceof _c&&uu(f.property.specification)))continue;const E=Km(a,e.type),O=f.value,x=f.property.specification.type,C=!!f.property.useIntegerZoom,k=a==="line-dasharray"||a.endsWith("pattern"),M=a==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||w&&w.value.kind!=="constant";if(O.kind!=="constant"||M)if(O.kind==="source"||M||k){const P=Zf(a,x,"source");this.binders[a]=k?new tl(O,E,x,P,e.id):new In(O,E,x,P),p.push(`/a_${a}`)}else{const P=Zf(a,x,"composite");this.binders[a]=new fa(O,E,x,C,i,P),p.push(`/z_${a}`)}else this.binders[a]=k?new el(O.value,E):new lo(O.value,E,x,i),p.push(`/u_${a}`);w&&(this.binders[a].ignoreLut=w.constantOr("default")==="none",this.binders[a].lutExpression=w.value,this.binders[a].checkUseTheme=!0)}this.cacheKey=p.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof In||i instanceof fa?i.maxValue:0}populatePaintArrays(e,i,o,p,a,f,w){for(const E in this.binders){const O=this.binders[E];O.context=this.context,O instanceof In||O instanceof fa||O instanceof tl?O.populatePaintArray(e,i,o,p,a,f,w):O.lutExpression&&O instanceof lo&&O.lutExpression&&(O.lutExpression.kind==="composite"||O.lutExpression.kind==="source")&&(O.ignoreLut=O.lutExpression.evaluate(new Vr(0,{brightness:f}),i,{},a,p,w)==="none")}}setConstantPatternPositions(e){for(const i in this.binders){const o=this.binders[i];o instanceof el&&o.setConstantPatternPositions(e)}}updatePaintArrays(e,i,o,p,a,f,w,E,O){let x=!1;const C=Object.keys(e),k=C.length!==0&&!E,M=k?C:i.uniqueIds;this.context.lut=a.lut;for(const P in this.binders){const R=this.binders[P];if(R.context=this.context,(R instanceof In||R instanceof fa||R instanceof tl)&&R.expression&&R.expression.kind&&R.expression.kind!=="constant"&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){const $=a.paint.get(P);R.expression=$.value;for(const G of M){const J=e[G.toString()];i.eachPosition(G,(ee,Z,ne)=>{const le=p.feature(ee);R.updatePaintArray(Z,ne,le,J,f,w,O)})}if(!k)for(const G of o.uniqueIds){const J=e[G.toString()];o.eachPosition(G,(ee,Z,ne)=>{const le=p.feature(ee);R.updatePaintArray(Z,ne,le,J,f,w,O)})}x=!0}}return x}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof lo||o instanceof el)&&e.push(...o.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof In||o instanceof fa||o instanceof tl)for(let p=0;p<o.paintVertexAttributes.length;p++)e.push(o.paintVertexAttributes[p].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof lo||o instanceof el||o instanceof fa)for(const p of o.uniformNames)e.push(p)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const o in this.binders){const p=this.binders[o];if(p instanceof lo||p instanceof el||p instanceof fa)for(const a of p.uniformNames)i.push({name:a,property:o,binding:p.getBinding(e,a)})}return i}setUniforms(e,i,o,p,a){for(const{name:f,property:w,binding:E}of o){if(this.binders[w].checkUseTheme&&this.binders[w]instanceof lo){const O=p.get(`${w}-use-theme`);O.isConstant()&&(this.binders[w].ignoreLut=O.constantOr("default")==="none")}this.binders[w].setUniform(e,E,a,p.get(w),f)}}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof In||i instanceof fa||i instanceof tl)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof In||o instanceof fa||o instanceof tl)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof In||i instanceof fa||i instanceof tl)&&i.destroy()}}}class ma{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const p of e)this.programConfigurations[p.id]=new zl(p,i,o);this.needsUpload=!1,this._featureMap=new Su,this._featureMapWithoutIds=new Su,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,o,p,a,f,w,E){for(const O in this.programConfigurations)this.programConfigurations[O].populatePaintArrays(e,i,p,a,f,w,E);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,p,a,f,w){for(const E of o)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,E,p,a,f,w||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Zm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Km(s,e){return Zm[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}const Fl={"line-pattern":{source:Rs,composite:Rs},"fill-pattern":{source:Rs,composite:Rs},"fill-extrusion-pattern":{source:Rs,composite:Rs},"line-dasharray":{source:ls,composite:ls}},yd={color:{source:Ll,composite:ln},number:{source:mh,composite:Ll}};function Zf(s,e,i){const o=Fl[s];return o&&o[i]||yd[e][i]}_i(lo,"ConstantBinder"),_i(el,"PatternConstantBinder"),_i(In,"SourceExpressionBinder"),_i(tl,"PatternCompositeBinder"),_i(fa,"CompositeExpressionBinder"),_i(zl,"ProgramConfiguration",{omit:["_buffers"]}),_i(ma,"ProgramConfigurationSet");const Hn=ei/Math.PI/2,il=5,vd=6,xd=16383,Eu=64,bh=[Eu,32,16],Mo=-Hn,No=Hn;function Mc(s,e,i,o=Hn){return i=rr(i),[s*Math.sin(i)*o,-e*o,s*Math.cos(i)*o]}function ga(s,e,i){return Mc(Math.cos(rr(s)),Math.sin(rr(s)),e,i)}const Ec=63710088e-1,Op=2*Math.PI*Ec;class Er{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Er(ra(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,p=e.lat*i,a=Math.sin(o)*Math.sin(p)+Math.cos(o)*Math.cos(p)*Math.cos((e.lng-this.lng)*i);return Ec*Math.acos(Math.min(a,1))}toBounds(e=0){const i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new rl({lng:this.lng-o,lat:this.lat-i},{lng:this.lng+o,lat:this.lat+i})}toEcef(e){return ga(this.lat,this.lng,Hn+e*Hn/Ec)}static convert(e){if(e instanceof Er)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Er(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Er(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class rl{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const o=e;this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]])}else{const o=e;this.setSouthWest(o[0]).setNorthEast(o[1])}}setNorthEast(e){return this._ne=e instanceof Er?new Er(e.lng,e.lat):Er.convert(e),this}setSouthWest(e){return this._sw=e instanceof Er?new Er(e.lng,e.lat):Er.convert(e),this}extend(e){const i=this._sw,o=this._ne;let p,a;if(e instanceof Er)p=e,a=e;else{if(!(e instanceof rl))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(rl.convert(e)):this.extend(Er.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Er.convert(e)):this;if(p=e._sw,a=e._ne,!p||!a)return this}return i||o?(i.lng=Math.min(p.lng,i.lng),i.lat=Math.min(p.lat,i.lat),o.lng=Math.max(a.lng,o.lng),o.lat=Math.max(a.lat,o.lat)):(this._sw=new Er(p.lng,p.lat),this._ne=new Er(a.lng,a.lat)),this}getCenter(){return new Er((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Er(this.getWest(),this.getNorth())}getSouthEast(){return new Er(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:o}=Er.convert(e);let p=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&p}static convert(e){if(e)return e instanceof rl?e:new rl(e)}}const Lp=0,Rp=25.5;function Bl(s){return Op*Math.cos(s*Math.PI/180)}function _a(s){return(180+s)/360}function ya(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function to(s,e){return s/Bl(e)}function co(s){return 360*s-180}function Wn(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function zp(s,e){return s*Bl(Wn(e))}const uo=85.051129;function Fp(s){return Math.cos(rr(nr(s,-85.051129,uo)))}function Nl(s,e){const i=nr(e,Lp,Rp),o=Math.pow(2,i);return Fp(s)*Op/(512*o)}function u(s){return 1/Math.cos(s*Math.PI/180)}function t(s,e=0){const i=Math.exp(Math.PI*(1-(s.y+e/ei)/(1<<s.z)*2));return 80150034*i/(i*i+1)/ei/(1<<s.z)}class n{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=Er.convert(e);return new n(_a(o.lng),ya(o.lat),to(i,o.lat))}toLngLat(){return new Er(co(this.x),Wn(this.y))}toAltitude(){return zp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Op*u(Wn(this.y))}}function d(s,e,i,o,p,a,f,w,E){const O=(e+o)/2,x=(i+p)/2,C=new Wt(O,x);w(C),function(k,M,P,R,$,G){const J=P-$,ee=R-G;return Math.abs((R-M)*J-(P-k)*ee)/Math.hypot(J,ee)}(C.x,C.y,a.x,a.y,f.x,f.y)>=E?(d(s,e,i,O,x,a,C,w,E),d(s,O,x,o,p,C,f,w,E)):s.push(f)}function y(s,e,i){let o=s[0],p=o.x,a=o.y;e(o);const f=[o];for(let w=1;w<s.length;w++){const E=s[w],{x:O,y:x}=E;e(E),d(f,p,a,O,x,o,E,e,i),p=O,a=x,o=E}return f}function b(s,e,i,o){if(o(e,i)){const p=e.add(i)._mult(.5);b(s,e,p,o),b(s,p,i,o)}else s.push(i)}function T(s,e){let i=s[0];const o=[i];for(let p=1;p<s.length;p++){const a=s[p];b(o,i,a,e),i=a}return o}const D=Math.pow(2,14)-1,F=-D-1;function V(s,e){const i=Math.round(s.x*e),o=Math.round(s.y*e);return s.x=nr(i,F,D),s.y=nr(o,F,D),(i<s.x||i>s.x+1||o<s.y||o>s.y+1)&&qi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function j(s,e,i){const o=s.loadGeometry(),p=s.extent,a=ei/p;if(e&&i&&i.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:w,x:E,y:O,projection:x}=i,C=k=>{const M=co((e.x+k.x/p)/f),P=Wn((e.y+k.y/p)/f),R=x.project(M,P);k.x=(R.x*w-E)*p,k.y=(R.y*w-O)*p};for(let k=0;k<o.length;k++)if(s.type!==1)o[k]=y(o[k],C,1);else{const M=[];for(const P of o[k])P.x<0||P.x>=p||P.y<0||P.y>=p||(C(P),M.push(P));o[k]=M}}for(const f of o)for(const w of f)V(w,a);return o}function H(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?j(s):[]}}function W(s,e,i,o,p){s.emplaceBack(2*e+(o+1)/2,2*i+(p+1)/2)}function Q(s,e,i){s.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class ce{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new wo,this.indexArray=new gs,this.segments=new Sn,this.programConfigurations=new ma(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(e,i){}populate(e,i,o,p){const a=this.layers[0],f=[];let w=null;a.type==="circle"&&(w=a.layout.get("circle-sort-key"));for(const{feature:O,id:x,index:C,sourceLayerIndex:k}of e){const M=this.layers[0]._featureFilter.needGeometry,P=H(O,M);if(!this.layers[0]._featureFilter.filter(new Vr(this.zoom),P,o))continue;const R=w?w.evaluate(P,{},o):void 0,$={id:x,properties:O.properties,type:O.type,sourceLayerIndex:k,index:C,geometry:M?P.geometry:j(O,o,p),patterns:{},sortKey:R};f.push($)}w&&f.sort((O,x)=>O.sortKey-x.sortKey);let E=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new ph,E=p.projection);for(const O of f){const{geometry:x,index:C,sourceLayerIndex:k}=O,M=e[C].feature;this.addFeature(O,x,C,i.availableImages,o,E,i.brightness),i.featureIndex.insert(M,x,C,k,this.index)}}update(e,i,o,p,a,f,w){this.programConfigurations.updatePaintArrays(e,i,a,o,p,f,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_h.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Yf.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,o,p,a,f,w){for(const E of i)for(const O of E){const x=O.x,C=O.y;if(x<0||x>=ei||C<0||C>=ei)continue;if(f){const P=f.projectTilePoint(x,C,a),R=f.upVector(a,x,C),$=this.globeExtVertexArray;Q($,P,R),Q($,P,R),Q($,P,R),Q($,P,R)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),M=k.vertexLength;W(this.layoutVertexArray,x,C,-1,-1),W(this.layoutVertexArray,x,C,1,-1),W(this.layoutVertexArray,x,C,1,1),W(this.layoutVertexArray,x,C,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+2,M+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},p,a,w)}}function oe(s,e){for(let i=0;i<s.length;i++)if(Oe(e,s[i]))return!0;for(let i=0;i<e.length;i++)if(Oe(s,e[i]))return!0;return!!ke(s,e)}function de(s,e,i){return!!Oe(s,e)||!!Ue(e,s,i)}function pe(s,e){if(s.length===1)return Be(e,s[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let p=0;p<o.length;p++)if(Oe(s,o[p]))return!0}for(let i=0;i<s.length;i++)if(Be(e,s[i]))return!0;for(let i=0;i<e.length;i++)if(ke(s,e[i]))return!0;return!1}function Se(s,e,i){if(s.length>1){if(ke(s,e))return!0;for(let o=0;o<e.length;o++)if(Ue(e[o],s,i))return!0}for(let o=0;o<s.length;o++)if(Ue(s[o],e,i))return!0;return!1}function ke(s,e){if(s.length===0||e.length===0)return!1;for(let i=0;i<s.length-1;i++){const o=s[i],p=s[i+1];for(let a=0;a<e.length-1;a++)if(Ie(o,p,e[a],e[a+1]))return!0}return!1}function Ie(s,e,i,o){return Fn(s,i,o)!==Fn(e,i,o)&&Fn(s,e,i)!==Fn(s,e,o)}function Ue(s,e,i){const o=i*i;if(e.length===1)return s.distSqr(e[0])<o;for(let p=1;p<e.length;p++)if(Le(s,e[p-1],e[p])<o)return!0;return!1}function Le(s,e,i){const o=e.distSqr(i);if(o===0)return s.distSqr(e);const p=((s.x-e.x)*(i.x-e.x)+(s.y-e.y)*(i.y-e.y))/o;return s.distSqr(p<0?e:p>1?i:i.sub(e)._mult(p)._add(e))}function Be(s,e){let i,o,p,a=!1;for(let f=0;f<s.length;f++){i=s[f];for(let w=0,E=i.length-1;w<i.length;E=w++)o=i[w],p=i[E],o.y>e.y!=p.y>e.y&&e.x<(p.x-o.x)*(e.y-o.y)/(p.y-o.y)+o.x&&(a=!a)}return a}function Oe(s,e){let i=!1;for(let o=0,p=s.length-1;o<s.length;p=o++){const a=s[o],f=s[p];a.y>e.y!=f.y>e.y&&e.x<(f.x-a.x)*(e.y-a.y)/(f.y-a.y)+a.x&&(i=!i)}return i}function He(s,e,i,o,p){for(const f of s)if(e<=f.x&&i<=f.y&&o>=f.x&&p>=f.y)return!0;const a=[new Wt(e,i),new Wt(e,p),new Wt(o,p),new Wt(o,i)];if(s.length>2){for(const f of a)if(Oe(s,f))return!0}for(let f=0;f<s.length-1;f++)if(Qe(s[f],s[f+1],a))return!0;return!1}function Qe(s,e,i){const o=i[0],p=i[2];if(s.x<o.x&&e.x<o.x||s.x>p.x&&e.x>p.x||s.y<o.y&&e.y<o.y||s.y>p.y&&e.y>p.y)return!1;const a=Fn(s,e,i[0]);return a!==Fn(s,e,i[1])||a!==Fn(s,e,i[2])||a!==Fn(s,e,i[3])}function xt(s,e,i,o,p,a){let f=e.y-s.y,w=s.x-e.x;if(a=a||0){const E=f*f+w*w;if(E===0)return!0;const O=Math.sqrt(E);f/=O,w/=O}return!((i.x-s.x)*f+(i.y-s.y)*w-a<0||(o.x-s.x)*f+(o.y-s.y)*w-a<0||(p.x-s.x)*f+(p.y-s.y)*w-a<0)}function ut(s,e,i,o,p,a,f){return!(xt(s,e,o,p,a,f)||xt(e,i,o,p,a,f)||xt(i,s,o,p,a,f)||xt(o,p,s,e,i,f)||xt(p,a,s,e,i,f)||xt(a,o,s,e,i,f))}function It(s,e,i){const o=e.paint.get(s).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(s)}function At(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function ot(s,e,i,o,p){if(!e[0]&&!e[1])return s;const a=Wt.convert(e)._mult(p);i==="viewport"&&a._rotate(-o);const f=[];for(let w=0;w<s.length;w++)f.push(s[w].sub(a));return f}function wt(s,e,i,o){const p=Wt.convert(s)._mult(o);return e==="viewport"&&p._rotate(-i),p}let Vt,st;_i(ce,"CircleBucket",{omit:["layers"]});var Dt,bt={exports:{}},Kt=(Dt||(Dt=1,function(s,e){(function(i){function o(a,f,w){var E=p(256*a,256*(f=Math.pow(2,w)-f-1),w),O=p(256*(a+1),256*(f+1),w);return E[0]+","+E[1]+","+O[0]+","+O[1]}function p(a,f,w){var E=2*Math.PI*6378137/256/Math.pow(2,w);return[a*E-2*Math.PI*6378137/2,f*E-2*Math.PI*6378137/2]}i.getURL=function(a,f,w,E,O,x){return x=x||{},a+"?"+["bbox="+o(w,E,O),"format="+(x.format||"image/png"),"service="+(x.service||"WMS"),"version="+(x.version||"1.1.1"),"request="+(x.request||"GetMap"),"srs="+(x.srs||"EPSG:3857"),"width="+(x.width||256),"height="+(x.height||256),"layers="+f].join("&")},i.getTileBBox=o,i.getMercCoords=p,Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,bt.exports)),bt.exports);class Bt{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=Xt(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const o=Kt.getTileBBox(this.x,this.y,this.z),p=function(a,f,w){let E,O="";for(let x=a;x>0;x--)E=1<<x-1,O+=(f&E?1:0)+(w&E?2:0);return O}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class kt{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Xt(e,i.z,i.z,i.x,i.y)}}class $t{constructor(e,i,o,p,a){this.overscaledZ=e,this.wrap=i,this.canonical=new Bt(o,+p,+a),this.key=i===0&&e===o?this.canonical.key:Xt(i,e,o,p,a)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new $t(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $t(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Xt(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return Xt(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new $t(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,p=2*this.canonical.y;return[new $t(i,this.wrap,i,o,p),new $t(i,this.wrap,i,o+1,p),new $t(i,this.wrap,i,o,p+1),new $t(i,this.wrap,i,o+1,p+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new $t(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new $t(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new kt(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Xt(s,e,i,o,p){const a=1<<Math.min(i,22);let f=a*(p%a)+o%a;return s&&i<22&&(f+=a*a*((s<0?-2*s-1:2*s)%(1<<2*(22-i)))),16*(32*f+i)+(e-i)}const ci=[s=>{let e=s.canonical.x-1,i=s.wrap;return e<0&&(e=(1<<s.canonical.z)-1,i--),new $t(s.overscaledZ,i,s.canonical.z,e,s.canonical.y)},s=>{let e=s.canonical.x+1,i=s.wrap;return e===1<<s.canonical.z&&(e=0,i++),new $t(s.overscaledZ,i,s.canonical.z,e,s.canonical.y)},s=>new $t(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,(s.canonical.y===0?1<<s.canonical.z:s.canonical.y)-1),s=>new $t(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y===(1<<s.canonical.z)-1?0:s.canonical.y+1)];_i(Bt,"CanonicalTileID"),_i($t,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const di=Ir([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Fi}=di,Mi=Ir([{name:"a_pos_3",components:3,type:"Int16"}]);var Ei=Ir([{name:"a_pos",type:"Int16",components:2}]);class ji{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const p=Ye.vec3.dot(i,this.dir);if(Math.abs(p)<1e-6)return!1;const a=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/p;return o[0]=this.pos[0]+this.dir[0]*a,o[1]=this.pos[1]+this.dir[1]*a,o[2]=this.pos[2]+this.dir[2]*a,!0}closestPointOnSphere(e,i,o){if(Ye.vec3.equals(this.pos,e)||i===0)return o[0]=o[1]=o[2]=0,!1;const[p,a,f]=this.dir,w=this.pos[0]-e[0],E=this.pos[1]-e[1],O=this.pos[2]-e[2],x=p*p+a*a+f*f,C=2*(w*p+E*a+O*f),k=C*C-4*x*(w*w+E*E+O*O-i*i);if(k<0){const M=Math.max(-C/2,0),P=w+p*M,R=E+a*M,$=O+f*M,G=Math.hypot(P,R,$);return o[0]=P*i/G,o[1]=R*i/G,o[2]=$*i/G,!1}{const M=(-C-Math.sqrt(k))/(2*x);if(M<0){const P=Math.hypot(w,E,O);return o[0]=w*i/P,o[1]=E*i/P,o[2]=O*i/P,!1}return o[0]=w+p*M,o[1]=E+a*M,o[2]=O+f*M,!0}}}class pr{constructor(e,i,o,p,a){this.TL=e,this.TR=i,this.BR=o,this.BL=p,this.horizon=a}static fromInvProjectionMatrix(e,i,o){const p=[-1,1,1],a=[1,1,1],f=[1,-1,1],w=[-1,-1,1],E=Ye.vec3.transformMat4(p,p,e),O=Ye.vec3.transformMat4(a,a,e),x=Ye.vec3.transformMat4(f,f,e),C=Ye.vec3.transformMat4(w,w,e);return new pr(E,O,x,C,i/o)}}function Cr(s,e,i){let o=1/0,p=-1/0;const a=[];for(const f of s){Ye.vec3.sub(a,f,e);const w=Ye.vec3.dot(a,i);o=Math.min(o,w),p=Math.max(p,w)}return[o,p]}function dn(s,e){let i=!0;for(let o=0;o<s.planes.length;o++){const p=s.planes[o];let a=0;for(let f=0;f<e.length;f++)a+=Ye.vec3.dot(p,e[f])+p[3]>=0;if(a===0)return 0;a!==e.length&&(i=!1)}return i?2:1}function $r(s,e){for(const i of s.projections){const o=Cr(e,s.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function $i(s,e){let i=0;const o=[0,0,0,0];for(let p=0;p<s.length;p++)o[0]=s[p][0],o[1]=s[p][1],o[2]=s[p][2],o[3]=1,Ye.vec4.dot(o,e)>=0&&i++;return i}class lr{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=bi.fromPoints(this.points),this.projections=[],this.frustumEdges=[Ye.vec3.sub([],this.points[2],this.points[3]),Ye.vec3.sub([],this.points[0],this.points[3]),Ye.vec3.sub([],this.points[4],this.points[0]),Ye.vec3.sub([],this.points[5],this.points[1]),Ye.vec3.sub([],this.points[6],this.points[2]),Ye.vec3.sub([],this.points[7],this.points[3])];for(const o of this.frustumEdges){const p=[0,-o[2],o[1]],a=[o[2],0,-o[0]];this.projections.push({axis:p,projection:Cr(this.points,this.points[0],p)}),this.projections.push({axis:a,projection:Cr(this.points,this.points[0],a)})}}static fromInvProjectionMatrix(e,i,o,p){const a=Math.pow(2,o),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(O=>{const x=Ye.vec4.transformMat4([],O,e),C=1/x[3]/i*a;return Ye.vec4.mul(x,x,[C,C,p?1/x[3]:C,C])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(O=>{const x=Ye.vec3.sub([],f[O[0]],f[O[1]]),C=Ye.vec3.sub([],f[O[2]],f[O[1]]),k=Ye.vec3.normalize([],Ye.vec3.cross([],x,C)),M=-Ye.vec3.dot(k,f[O[1]]);return k.concat(M)}),E=[];for(let O=0;O<f.length;O++)E.push([f[O][0],f[O][1],f[O][2]]);return new lr(E,w)}intersectsPrecise(e,i,o){for(let p=0;p<i.length;p++)if(!$i(e,i[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!$i(e,this.planes[p]))return 0;for(const p of o)for(const a of this.frustumEdges){const f=Ye.vec3.cross([],p,a),w=Ye.vec3.length(f);if(w===0)continue;Ye.vec3.scale(f,f,1/w);const E=Cr(this.points,this.points[0],f),O=Cr(e,this.points[0],f);if(E[0]>O[1]||O[0]>E[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const o=i[3];if(Ye.vec3.dot([i[0],i[1],i[2]],e)+o<0)return!1}return!0}}class bi{static fromPoints(e){const i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const p of e)Ye.vec3.min(i,i,p),Ye.vec3.max(o,o,p);return new bi(i,o)}static fromTileIdAndHeight(e,i,o){const p=1<<e.canonical.z,a=e.canonical.x,f=e.canonical.y;return new bi([a/p,f/p,i],[(a+1)/p,(f+1)/p,o])}static applyTransform(e,i){const o=e.getCorners();for(let p=0;p<o.length;++p)Ye.vec3.transformMat4(o[p],o[p],i);return bi.fromPoints(o)}static applyTransformFast(e,i){const o=[i[12],i[13],i[14]],p=[...o];for(let a=0;a<3;a++)for(let f=0;f<3;f++){const w=i[4*f+a],E=w*e.min[f],O=w*e.max[f];o[a]+=Math.min(E,O),p[a]+=Math.max(E,O)}return new bi(o,p)}static projectAabbCorners(e,i){const o=e.getCorners();for(let p=0;p<o.length;++p)Ye.vec3.transformMat4(o[p],o[p],i);return o}constructor(e,i){this.min=e,this.max=i,this.center=Ye.vec3.scale([],Ye.vec3.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],o=Ye.vec3.clone(this.min),p=Ye.vec3.clone(this.max);for(let a=0;a<i.length;a++)o[a]=i[a]?this.min[a]:this.center[a],p[a]=i[a]?this.center[a]:this.max[a];return p[2]=this.max[2],new bi(o,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?dn(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?dn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?$r(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?$r(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function or(s){return s*Hn/Ec}_i(bi,"Aabb");const Dr=[new bi([Mo,Mo,Mo],[No,No,No]),new bi([Mo,Mo,Mo],[0,0,No]),new bi([0,Mo,Mo],[No,0,No]),new bi([Mo,0,Mo],[0,No,No]),new bi([0,0,Mo],[No,No,No])];function Mr(s,e,i,o=!0){const p=Ye.vec3.scale([],s._camera.position,s.worldSize),a=[e,i,1,1];Ye.vec4.transformMat4(a,a,s.pixelMatrixInverse),Ye.vec4.scale(a,a,1/a[3]);const f=Ye.vec3.sub([],a,p),w=Ye.vec3.normalize([],f),E=s.globeMatrix,O=[E[12],E[13],E[14]],x=Ye.vec3.sub([],O,p),C=Ye.vec3.length(x),k=Ye.vec3.normalize([],x),M=s.worldSize/(2*Math.PI),P=Ye.vec3.dot(k,w),R=Math.asin(M/C);if(R<Math.acos(P)){if(!o)return null;const $e=[],De=[];Ye.vec3.scale($e,w,C/P),Ye.vec3.normalize(De,Ye.vec3.sub(De,$e,x)),Ye.vec3.normalize(w,Ye.vec3.add(w,x,Ye.vec3.scale(w,De,Math.tan(R)*C)))}const $=[];new ji(p,w).closestPointOnSphere(O,M,$);const G=Ye.vec3.normalize([],jc(E,0)),J=Ye.vec3.normalize([],jc(E,1)),ee=Ye.vec3.normalize([],jc(E,2)),Z=Ye.vec3.dot(G,$),ne=Ye.vec3.dot(J,$),le=Ye.vec3.dot(ee,$),fe=$n(Math.asin(-ne/M));let Ce=$n(Math.atan2(Z,le));Ce=s.center.lng+function($e,De){const Ge=(De-$e+180)%360-180;return Ge<-180?Ge+360:Ge}(s.center.lng,Ce);const Ee=_a(Ce),Me=nr(ya(fe),0,1);return new n(Ee,Me)}class pn{constructor(e,i,o){this.a=Ye.vec3.sub([],e,o),this.b=Ye.vec3.sub([],i,o),this.center=o;const p=Ye.vec3.normalize([],this.a),a=Ye.vec3.normalize([],this.b);this.angle=Math.acos(Ye.vec3.dot(p,a))}}function ns(s,e){if(s.angle===0)return null;let i;return i=s.a[e]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[e]/s.a[e]/Math.sin(s.angle)-1/Math.tan(s.angle)),i<0||i>1?null:function(o,p,a,f){const w=Math.sin(a);return o*(Math.sin((1-f)*a)/w)+p*(Math.sin(f*a)/w)}(s.a[e],s.b[e],s.angle,nr(i,0,1))+s.center[e]}function Tn(s){if(s.z<=1)return Dr[s.z+2*s.y+s.x];const e=Gr(rn(s));return bi.fromPoints(e)}function qn(s,e,i){return Ye.vec3.scale(s,s,1-i),Ye.vec3.scaleAndAdd(s,s,e,i)}function Eo(s,e,i){for(const o of s)Ye.vec3.transformMat4(o,o,e),Ye.vec3.scale(o,o,i)}function Hs(s,e,i,o){const p=e/s.worldSize,a=s.globeMatrix;if(i.z<=1){const Ee=Tn(i).getCorners();return Eo(Ee,a,p),bi.fromPoints(Ee)}const f=rn(i,o),w=Gr(f,Hn+or(s._tileCoverLift));Eo(w,a,p);const E=Number.MAX_VALUE,O=[-E,-E,-E],x=[E,E,E];if(f.contains(s.center)){for(const $e of w)Ye.vec3.min(x,x,$e),Ye.vec3.max(O,O,$e);O[2]=0;const Ee=s.point,Me=[Ee.x*p,Ee.y*p,0];return Ye.vec3.min(x,x,Me),Ye.vec3.max(O,O,Me),new bi(x,O)}if(s._tileCoverLift>0){for(const Ee of w)Ye.vec3.min(x,x,Ee),Ye.vec3.max(O,O,Ee);return new bi(x,O)}const C=[a[12]*p,a[13]*p,a[14]*p],k=f.getCenter(),M=nr(s.center.lat,-85.051129,uo),P=nr(k.lat,-85.051129,uo),R=_a(s.center.lng),$=ya(M);let G=R-_a(k.lng);const J=$-ya(P);G>.5?G-=1:G<-.5&&(G+=1);let ee=0;if(Math.abs(G)>Math.abs(J))ee=G>=0?1:3;else{ee=J>=0?0:2;const Ee=[a[4]*p,a[5]*p,a[6]*p],Me=-Math.sin(rr(J>=0?f.getSouth():f.getNorth()))*Hn;Ye.vec3.scaleAndAdd(C,C,Ee,Me)}const Z=w[ee],ne=w[(ee+1)%4],le=new pn(Z,ne,C),fe=[ns(le,0)||Z[0],ns(le,1)||Z[1],ns(le,2)||Z[2]],Ce=ho(s.zoom);if(Ce>0){const Ee=function({x:$e,y:De,z:Ge},Xe,qe,et,nt){const ct=1/(1<<Ge);let it=$e*ct,Ct=it+ct,Nt=De*ct,Et=Nt+ct,si=0;const ti=(it+Ct)/2-et;return ti>.5?si=-1:ti<-.5&&(si=1),it=((it+si)*Xe-(et*=Xe))*qe+et,Ct=((Ct+si)*Xe-et)*qe+et,Nt=(Nt*Xe-(nt*=Xe))*qe+nt,Et=(Et*Xe-nt)*qe+nt,[[it,Et,0],[Ct,Et,0],[Ct,Nt,0],[it,Nt,0]]}(i,e,s._pixelsPerMercatorPixel,R,$);for(let $e=0;$e<w.length;$e++)qn(w[$e],Ee[$e],Ce);const Me=Ye.vec3.add([],Ee[ee],Ee[(ee+1)%4]);Ye.vec3.scale(Me,Me,.5),qn(fe,Me,Ce)}for(const Ee of w)Ye.vec3.min(x,x,Ee),Ye.vec3.max(O,O,Ee);return x[2]=Math.min(Z[2],ne[2]),Ye.vec3.min(x,x,fe),Ye.vec3.max(O,O,fe),new bi(x,O)}function rn({x:s,y:e,z:i},o=!1){const p=1/(1<<i),a=new Er(co(s*p),e===(1<<i)-1&&o?-90:Wn((e+1)*p)),f=new Er(co((s+1)*p),e===0&&o?90:Wn(e*p));return new rl(a,f)}function Gr(s,e=Hn){const i=rr(s.getNorth()),o=rr(s.getSouth()),p=Math.cos(i),a=Math.cos(o),f=Math.sin(i),w=Math.sin(o),E=s.getWest(),O=s.getEast();return[Mc(a,w,E,e),Mc(a,w,O,e),Mc(p,f,O,e),Mc(p,f,E,e)]}function Br(s,e,i,o){const p=1<<i.z,a=(s/ei+i.x)/p;return ga(Wn((e/ei+i.y)/p),co(a),o)}function mr({min:s,max:e}){return xd/Math.max(e[0]-s[0],e[1]-s[1],e[2]-s[2])}const Dn=new Float64Array(16);function Yn(s){const e=mr(s),i=Ye.mat4.fromScaling(Dn,[e,e,e]);return Ye.mat4.translate(i,i,Ye.vec3.negate([],s.min))}function jr(s){const e=Ye.mat4.fromTranslation(Dn,s.min),i=1/mr(s);return Ye.mat4.scale(e,e,[i,i,i])}function zs(s){const e=ei/(2*Math.PI);return s/(2*Math.PI)/e}function ta(s,e){return ei/(512*Math.pow(2,s))*mr(Tn(e))}function Co(s,e,i,o,p){const a=zs(i),f=[s,e,-i/(2*Math.PI)],w=Ye.mat4.identity(new Float64Array(16));return Ye.mat4.translate(w,w,f),Ye.mat4.scale(w,w,[a,a,a]),Ye.mat4.rotateX(w,w,rr(-p)),Ye.mat4.rotateY(w,w,rr(-o)),w}function ho(s){return Kr(il,vd,s)}function Vo(s,e){const i=ga(e.lat,e.lng),o=function(a){const f=ga(a._center.lat,a._center.lng),w=Ye.vec3.fromValues(0,1,0);let E=Ye.vec3.cross([],w,f);const O=Ye.mat4.fromRotation([],-a.angle,f);E=Ye.vec3.transformMat4(E,E,O),Ye.mat4.fromRotation(O,-a._pitch,E);const x=Ye.vec3.normalize([],f);return Ye.vec3.scale(x,x,or(a.cameraToCenterDistance/a.pixelsPerMeter)),Ye.vec3.transformMat4(x,x,O),Ye.vec3.add([],f,x)}(s),p=Ye.vec3.subtract([],o,i);return Ye.vec3.angle(p,i)}function Uo(s,e){return Vo(s,e)>Math.PI/2*1.01}const jo=rr(85),nl=Math.cos(jo),$o=Math.sin(jo),Cc=Ye.mat4.create(),Ac=s=>{const e=[];return s.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),s.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function bd(s,e,i,o,p,a,f,w,E){if(a&&s.queryGeometry.isAboveHorizon)return!1;a&&(E*=s.pixelToTileUnitsFactor);const O=s.tileID.canonical,x=i.projection.upVectorScale(O,i.center.lat,i.worldSize).metersToTile;for(const C of e)for(const k of C){const M=k.add(w),P=p&&i.elevation?i.elevation.exaggeration()*p.getElevationAt(M.x,M.y,!0):0,R=i.projection.projectTilePoint(M.x,M.y,O);if(P>0){const ee=i.projection.upVector(O,M.x,M.y);R.x+=ee[0]*x*P,R.y+=ee[1]*x*P,R.z+=ee[2]*x*P}const $=a?M:wd(R.x,R.y,R.z,o),G=a?s.tilespaceRays.map(ee=>O0(ee,P)):s.queryGeometry.screenGeometry,J=Ye.vec4.transformMat4([],[R.x,R.y,R.z,1],o);if(!f&&a?E*=J[3]/i.cameraToCenterDistance:f&&!a&&(E*=i.cameraToCenterDistance/J[3]),a){const ee=Wn((k.y/ei+O.y)/(1<<O.z));E/=i.projection.pixelsPerMeter(ee,1)/to(1,ee)}if(de(G,$,E))return!0}return!1}function wd(s,e,i,o){const p=Ye.vec4.transformMat4([],[s,e,i,1],o);return new Wt(p[0]/p[3],p[1]/p[3])}const h_=Ye.vec3.fromValues(0,0,0),k0=Ye.vec3.fromValues(0,0,1);function O0(s,e){const i=Ye.vec3.create();return h_[2]=e,s.intersectsPlane(h_,k0,i),new Wt(i[0],i[1])}class d_ extends ce{}let p_,Jm,f_,Qm;function m_(s,{width:e,height:i},o,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==e*i*o)throw new RangeError("mismatched image size")}else p=new Uint8Array(e*i*o);return s.width=e,s.height=i,s.data=p,s}function g_(s,e,i){const{width:o,height:p}=e;o===s.width&&p===s.height||(Kf(s,e,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,o),height:Math.min(s.height,p)},i,null),s.width=o,s.height=p,s.data=e.data)}function Kf(s,e,i,o,p,a,f,w){if(p.width===0||p.height===0)return e;if(p.width>s.width||p.height>s.height||i.x>s.width-p.width||i.y>s.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>e.width||p.height>e.height||o.x>e.width-p.width||o.y>e.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const E=s.data,O=e.data,x=a===4&&w;for(let C=0;C<p.height;C++){const k=((i.y+C)*s.width+i.x)*a,M=((o.y+C)*e.width+o.x)*a;if(x)for(let P=0;P<p.width;P++){const R=k+P*a+3,$=M+P*a;O[$+0]=255,O[$+1]=255,O[$+2]=255,O[$+3]=E[R]}else if(f)for(let P=0;P<p.width;P++){const R=k+P*a,$=M+P*a,G=E[R+3],J=new Ar(E[R+0]/255*G,E[R+1]/255*G,E[R+2]/255*G,G).toRenderColor(f).toArray();O[$+0]=J[0],O[$+1]=J[1],O[$+2]=J[2],O[$+3]=J[3]}else for(let P=0;P<p.width*a;P++)O[M+P]=E[k+P]}return e}_i(d_,"HeatmapBucket",{omit:["layers"]});class Vl{constructor(e,i){m_(this,e,1,i)}resize(e){g_(this,new Vl(e),1)}clone(){return new Vl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,p,a){Kf(e,i,o,p,a,1,null)}}class Fs{constructor(e,i){m_(this,e,4,i)}resize(e){g_(this,new Fs(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Fs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,p,a,f,w){Kf(e,i,o,p,a,4,f,w)}}class Jf{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Bp(s){const e={},i=s.resolution||256,o=s.clips?s.clips.length:1,p=s.image||new Fs({width:i,height:o}),a=(f,w,E)=>{e[s.evaluationKey]=E;const O=s.expression.evaluate(e);O&&(p.data[f+w+0]=Math.floor(255*O.r/O.a),p.data[f+w+1]=Math.floor(255*O.g/O.a),p.data[f+w+2]=Math.floor(255*O.b/O.a),p.data[f+w+3]=Math.floor(255*O.a))};if(s.clips)for(let f=0,w=0;f<o;++f,w+=4*i)for(let E=0,O=0;E<i;E++,O+=4){const x=E/(i-1),{start:C,end:k}=s.clips[f];a(w,O,C*(1-x)+k*x)}else for(let f=0,w=0;f<i;f++,w+=4)a(0,w,f/(i-1));return p}_i(Vl,"AlphaImage"),_i(Fs,"RGBAImage");const L0=Ir([{name:"a_pos",components:2,type:"Int16"}],4),{members:R0}=L0;function Sd(s,e,i=2){const o=e&&e.length,p=o?e[0]*i:s.length;let a=__(s,0,p,i,!0);const f=[];if(!a||a.next===a.prev)return f;let w,E,O;if(o&&(a=function(x,C,k,M){const P=[];for(let R=0,$=C.length;R<$;R++){const G=__(x,C[R]*M,R<$-1?C[R+1]*M:x.length,M,!1);G===G.next&&(G.steiner=!0),P.push(U0(G))}P.sort(N0);for(let R=0;R<P.length;R++)k=V0(P[R],k);return k}(s,e,a,i)),s.length>80*i){w=1/0,E=1/0;let x=-1/0,C=-1/0;for(let k=i;k<p;k+=i){const M=s[k],P=s[k+1];M<w&&(w=M),P<E&&(E=P),M>x&&(x=M),P>C&&(C=P)}O=Math.max(x-w,C-E),O=O!==0?32767/O:0}return Td(a,f,i,w,E,O,0),f}function __(s,e,i,o,p){let a;if(p===function(f,w,E,O){let x=0;for(let C=w,k=E-O;C<E;C+=O)x+=(f[k]-f[C])*(f[C+1]+f[k+1]),k=C;return x}(s,e,i,o)>0)for(let f=e;f<i;f+=o)a=w_(f/o|0,s[f],s[f+1],a);else for(let f=i-o;f>=e;f-=o)a=w_(f/o|0,s[f],s[f+1],a);return a&&Np(a,a.next)&&(wh(a),a=a.next),a}function Cu(s,e){if(!s)return s;e||(e=s);let i,o=s;do if(i=!1,o.steiner||!Np(o,o.next)&&cs(o.prev,o,o.next)!==0)o=o.next;else{if(wh(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function Td(s,e,i,o,p,a,f){if(!s)return;!f&&a&&function(E,O,x,C){let k=E;do k.z===0&&(k.z=Qf(k.x,k.y,O,x,C)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==E);k.prevZ.nextZ=null,k.prevZ=null,function(M){let P,R=1;do{let $,G=M;M=null;let J=null;for(P=0;G;){P++;let ee=G,Z=0;for(let le=0;le<R&&(Z++,ee=ee.nextZ,ee);le++);let ne=R;for(;Z>0||ne>0&&ee;)Z!==0&&(ne===0||!ee||G.z<=ee.z)?($=G,G=G.nextZ,Z--):($=ee,ee=ee.nextZ,ne--),J?J.nextZ=$:M=$,$.prevZ=J,J=$;G=ee}J.nextZ=null,R*=2}while(P>1)}(k)}(s,o,p,a);let w=s;for(;s.prev!==s.next;){const E=s.prev,O=s.next;if(a?F0(s,o,p,a):z0(s))e.push(E.i,s.i,O.i),wh(s),s=O.next,w=O.next;else if((s=O)===w){f?f===1?Td(s=y_(Cu(s),e),e,i,o,p,a,2):f===2&&B0(s,e,i,o,p,a):Td(Cu(s),e,i,o,p,a,1);break}}}function z0(s){const e=s.prev,i=s,o=s.next;if(cs(e,i,o)>=0)return!1;const p=e.x,a=i.x,f=o.x,w=e.y,E=i.y,O=o.y,x=p<a?p<f?p:f:a<f?a:f,C=w<E?w<O?w:O:E<O?E:O,k=p>a?p>f?p:f:a>f?a:f,M=w>E?w>O?w:O:E>O?E:O;let P=o.next;for(;P!==e;){if(P.x>=x&&P.x<=k&&P.y>=C&&P.y<=M&&Md(p,w,a,E,f,O,P.x,P.y)&&cs(P.prev,P,P.next)>=0)return!1;P=P.next}return!0}function F0(s,e,i,o){const p=s.prev,a=s,f=s.next;if(cs(p,a,f)>=0)return!1;const w=p.x,E=a.x,O=f.x,x=p.y,C=a.y,k=f.y,M=w<E?w<O?w:O:E<O?E:O,P=x<C?x<k?x:k:C<k?C:k,R=w>E?w>O?w:O:E>O?E:O,$=x>C?x>k?x:k:C>k?C:k,G=Qf(M,P,e,i,o),J=Qf(R,$,e,i,o);let ee=s.prevZ,Z=s.nextZ;for(;ee&&ee.z>=G&&Z&&Z.z<=J;){if(ee.x>=M&&ee.x<=R&&ee.y>=P&&ee.y<=$&&ee!==p&&ee!==f&&Md(w,x,E,C,O,k,ee.x,ee.y)&&cs(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,Z.x>=M&&Z.x<=R&&Z.y>=P&&Z.y<=$&&Z!==p&&Z!==f&&Md(w,x,E,C,O,k,Z.x,Z.y)&&cs(Z.prev,Z,Z.next)>=0))return!1;Z=Z.nextZ}for(;ee&&ee.z>=G;){if(ee.x>=M&&ee.x<=R&&ee.y>=P&&ee.y<=$&&ee!==p&&ee!==f&&Md(w,x,E,C,O,k,ee.x,ee.y)&&cs(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;Z&&Z.z<=J;){if(Z.x>=M&&Z.x<=R&&Z.y>=P&&Z.y<=$&&Z!==p&&Z!==f&&Md(w,x,E,C,O,k,Z.x,Z.y)&&cs(Z.prev,Z,Z.next)>=0)return!1;Z=Z.nextZ}return!0}function y_(s,e){let i=s;do{const o=i.prev,p=i.next.next;!Np(o,p)&&b_(o,i,i.next,p)&&jp(o,p)&&jp(p,o)&&(e.push(o.i,i.i,p.i),wh(i),wh(i.next),i=s=p),i=i.next}while(i!==s);return Cu(i)}function B0(s,e,i,o,p,a){let f=s;do{let w=f.next.next;for(;w!==f.prev;){if(f.i!==w.i&&x_(f,w)){let E=eg(f,w);return f=Cu(f,f.next),E=Cu(E,E.next),Td(f,e,i,o,p,a,0),void Td(E,e,i,o,p,a,0)}w=w.next}f=f.next}while(f!==s)}function N0(s,e){return s.x-e.x}function V0(s,e){const i=function(p,a){let f=a;const w=p.x,E=p.y;let O,x=-1/0;do{if(E<=f.y&&E>=f.next.y&&f.next.y!==f.y){const R=f.x+(E-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(R<=w&&R>x&&(x=R,O=f.x<f.next.x?f:f.next,R===w))return O}f=f.next}while(f!==a);if(!O)return null;const C=O,k=O.x,M=O.y;let P=1/0;f=O;do{if(w>=f.x&&f.x>=k&&w!==f.x&&Md(E<M?w:x,E,k,M,E<M?x:w,E,f.x,f.y)){const R=Math.abs(E-f.y)/(w-f.x);jp(f,p)&&(R<P||R===P&&(f.x>O.x||f.x===O.x&&v_(O,f)))&&(O=f,P=R)}f=f.next}while(f!==C);return O}(s,e);if(!i)return e;const o=eg(i,s);return Cu(o,o.next),Cu(i,i.next)}function v_(s,e){return cs(s.prev,s,e.prev)<0&&cs(e.next,s,s.next)<0}function Qf(s,e,i,o,p){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-i)*p|0)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*p|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function U0(s){let e=s,i=s;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==s);return i}function Md(s,e,i,o,p,a,f,w){return(p-f)*(e-w)>=(s-f)*(a-w)&&(s-f)*(o-w)>=(i-f)*(e-w)&&(i-f)*(a-w)>=(p-f)*(o-w)}function x_(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function(i,o){let p=i;do{if(p.i!==i.i&&p.next.i!==i.i&&p.i!==o.i&&p.next.i!==o.i&&b_(p,p.next,i,o))return!0;p=p.next}while(p!==i);return!1}(s,e)&&(jp(s,e)&&jp(e,s)&&function(i,o){let p=i,a=!1;const f=(i.x+o.x)/2,w=(i.y+o.y)/2;do p.y>w!=p.next.y>w&&p.next.y!==p.y&&f<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(a=!a),p=p.next;while(p!==i);return a}(s,e)&&(cs(s.prev,s,e.prev)||cs(s,e.prev,e))||Np(s,e)&&cs(s.prev,s,s.next)>0&&cs(e.prev,e,e.next)>0)}function cs(s,e,i){return(e.y-s.y)*(i.x-e.x)-(e.x-s.x)*(i.y-e.y)}function Np(s,e){return s.x===e.x&&s.y===e.y}function b_(s,e,i,o){const p=Up(cs(s,e,i)),a=Up(cs(s,e,o)),f=Up(cs(i,o,s)),w=Up(cs(i,o,e));return p!==a&&f!==w||!(p!==0||!Vp(s,i,e))||!(a!==0||!Vp(s,o,e))||!(f!==0||!Vp(i,s,o))||!(w!==0||!Vp(i,e,o))}function Vp(s,e,i){return e.x<=Math.max(s.x,i.x)&&e.x>=Math.min(s.x,i.x)&&e.y<=Math.max(s.y,i.y)&&e.y>=Math.min(s.y,i.y)}function Up(s){return s>0?1:s<0?-1:0}function jp(s,e){return cs(s.prev,s,s.next)<0?cs(s,e,s.next)>=0&&cs(s,s.prev,e)>=0:cs(s,e,s.prev)<0||cs(s,s.next,e)<0}function eg(s,e){const i=tg(s.i,s.x,s.y),o=tg(e.i,e.x,e.y),p=s.next,a=e.prev;return s.next=e,e.prev=s,i.next=p,p.prev=i,o.next=i,i.prev=o,a.next=o,o.prev=a,o}function w_(s,e,i,o){const p=tg(s,e,i);return o?(p.next=o.next,p.prev=o,o.next.prev=p,o.next=p):(p.prev=p,p.next=p),p}function wh(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function tg(s,e,i){return{i:s,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function $p(s,e){const i=s.length;if(i<=1)return[s];const o=[];let p,a;for(let f=0;f<i;f++){const w=$u(s[f]);w!==0&&(s[f].area=Math.abs(w),a===void 0&&(a=w<0),a===w<0?(p&&o.push(p),p=[s[f]]):p.push(s[f]))}if(p&&o.push(p),e>1)for(let f=0;f<o.length;f++)o[f].length<=e||(Xu(o[f],e,1,o[f].length-1,S_),o[f]=o[f].slice(0,e));return o}function S_(s,e){return e.area-s.area}function T_(s,e,i=1){if(!s)return null;const o=typeof s=="string"?s:s.getPrimary().id;e[o]||(e[o]=[]);const p=ks.from(o).getPrimary().scaleSelf(i);return e[o].push(p),p.serialize()}function ig(s,e,i,o){const p=o.patternDependencies;let a=!1;for(const f of e){const w=f.paint.get(`${s}-pattern`);w.isConstant()||(a=!0),T_(w.constantOr(null),p,i)&&(a=!0)}return a}function Gp(s,e,i,o,p,a){const f=a.patternDependencies;for(const w of e){const E=w.paint.get(`${s}-pattern`).value;if(E.kind!=="constant"){let O=E.evaluate({zoom:o},i,{},a.availableImages);O=O&&O.name?O.name:O;const x=T_(O,f,p);x&&(i.patterns[w.id]=x)}}return i}class rg{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new wo,this.indexArray=new gs,this.indexArray2=new Ja,this.programConfigurations=new ma(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Sn,this.segments2=new Sn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}updateFootprints(e,i){}populate(e,i,o,p){this.hasPattern=ig("fill",this.layers,this.pixelRatio,i);const a=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:w,id:E,index:O,sourceLayerIndex:x}of e){const C=this.layers[0]._featureFilter.needGeometry,k=H(w,C);if(!this.layers[0]._featureFilter.filter(new Vr(this.zoom),k,o))continue;const M=a?a.evaluate(k,{},o,i.availableImages):void 0,P={id:E,properties:w.properties,type:w.type,sourceLayerIndex:x,index:O,geometry:C?k.geometry:j(w,o,p),patterns:{},sortKey:M};f.push(P)}a&&f.sort((w,E)=>w.sortKey-E.sortKey);for(const w of f){const{geometry:E,index:O,sourceLayerIndex:x}=w;if(this.hasPattern){const C=Gp("fill",this.layers,w,this.zoom,this.pixelRatio,i);this.patternFeatures.push(C)}else this.addFeature(w,E,O,o,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[O].feature,E,O,x,this.index)}}update(e,i,o,p,a,f,w){this.programConfigurations.updatePaintArrays(e,i,a,o,p,f,w)}addFeatures(e,i,o,p,a,f){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,i,o,p,f,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,R0),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,p,a,f=[],w,E){for(const O of $p(i,500)){let x=0;for(const $ of O)x+=$.length;const C=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),k=C.vertexLength,M=[],P=[];for(const $ of O){if($.length===0)continue;$!==O[0]&&P.push(M.length/2);const G=this.segments2.prepareSegment($.length,this.layoutVertexArray,this.indexArray2),J=G.vertexLength;this.layoutVertexArray.emplaceBack($[0].x,$[0].y),this.indexArray2.emplaceBack(J+$.length-1,J),M.push($[0].x),M.push($[0].y);for(let ee=1;ee<$.length;ee++)this.layoutVertexArray.emplaceBack($[ee].x,$[ee].y),this.indexArray2.emplaceBack(J+ee-1,J+ee),M.push($[ee].x),M.push($[ee].y);G.vertexLength+=$.length,G.primitiveLength+=$.length}const R=Sd(M,P);for(let $=0;$<R.length;$+=3)this.indexArray.emplaceBack(k+R[$],k+R[$+1],k+R[$+2]);C.vertexLength+=x,C.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,a,f,p,w)}}let M_,E_,C_,A_;_i(rg,"FillBucket",{omit:["layers","patternFeatures"]});class ng{constructor(e,i,o,p){if(this.triangleCount=i.length/3,this.min=new Wt(0,0),this.max=new Wt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[a,f]=[e[0].clone(),e[0].clone()];for(let C=1;C<e.length;++C){const k=e[C];a.x=Math.min(a.x,k.x),a.y=Math.min(a.y,k.y),f.x=Math.max(f.x,k.x),f.y=Math.max(f.y,k.y)}if(p){const C=Math.ceil(Math.max(f.x-a.x,f.y-a.y)/p);o=Math.max(o,C)}if(o===0)return;this.min=a,this.max=f;const w=this.max.sub(this.min);w.x=Math.max(w.x,1),w.y=Math.max(w.y,1);const E=Math.max(w.x,w.y)/o;this.cellsX=Math.max(1,Math.ceil(w.x/E)),this.cellsY=Math.max(1,Math.ceil(w.y/E)),this.xScale=1/E,this.yScale=1/E;const O=[];for(let C=0;C<this.triangleCount;C++){const k=e[i[3*C+0]].sub(this.min),M=e[i[3*C+1]].sub(this.min),P=e[i[3*C+2]].sub(this.min),R=va(Math.floor(Math.min(k.x,M.x,P.x)),this.xScale,this.cellsX),$=va(Math.floor(Math.max(k.x,M.x,P.x)),this.xScale,this.cellsX),G=va(Math.floor(Math.min(k.y,M.y,P.y)),this.yScale,this.cellsY),J=va(Math.floor(Math.max(k.y,M.y,P.y)),this.yScale,this.cellsY),ee=new Wt(0,0),Z=new Wt(0,0),ne=new Wt(0,0),le=new Wt(0,0);for(let fe=G;fe<=J;++fe){ee.y=Z.y=fe*E,ne.y=le.y=(fe+1)*E;for(let Ce=R;Ce<=$;++Ce)ee.x=ne.x=Ce*E,Z.x=le.x=(Ce+1)*E,(ut(k,M,P,ee,Z,le)||ut(k,M,P,ee,le,ne))&&O.push({cellIdx:fe*this.cellsX+Ce,triIdx:C})}}if(O.length===0)return;O.sort((C,k)=>C.cellIdx-k.cellIdx||C.triIdx-k.triIdx);let x=0;for(;x<O.length;){const C=O[x].cellIdx,k={start:this.payload.length,len:0};for(;x<O.length&&O[x].cellIdx===C;)++k.len,this.payload.push(O[x++].triIdx);this.cells[C]=k}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const o=va(e.x-this.min.x,this.xScale,this.cellsX),p=va(e.y-this.min.y,this.yScale,this.cellsY),a=this.cells[p*this.cellsX+o];if(a){this._lazyInitLookup();for(let f=0;f<a.len;f++){const w=this.payload[a.start+f],E=Math.floor(w/8),O=1<<w%8;if(!(this.lookup[E]&O)&&(this.lookup[E]|=O,i.push(w),i.length===this.triangleCount))return}}}query(e,i,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const p=va(e.x-this.min.x,this.xScale,this.cellsX),a=va(i.x-this.min.x,this.xScale,this.cellsX),f=va(e.y-this.min.y,this.yScale,this.cellsY),w=va(i.y-this.min.y,this.yScale,this.cellsY);for(let E=f;E<=w;E++)for(let O=p;O<=a;O++){const x=this.cells[E*this.cellsX+O];if(x)for(let C=0;C<x.len;C++){const k=this.payload[x.start+C],M=Math.floor(k/8),P=1<<k%8;if(!(this.lookup[M]&P)&&(this.lookup[M]|=P,o.push(k),o.length===this.triangleCount))return}}}}function va(s,e,i){return Math.max(0,Math.min(i-1,Math.floor(s*e)))}_i(ng,"TriangleGridIndex");class P_{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(e,i){for(const o of this.footprints)i.push({footprint:o,id:e})}populate(e,i,o,p){const a=[];for(const{feature:f,id:w,index:E,sourceLayerIndex:O}of e){const x=this.layers[0]._featureFilter.needGeometry,C=H(f,x);if(!this.layers[0]._featureFilter.filter(new Vr(this.zoom),C,o))continue;const k={id:w,properties:f.properties,type:f.type,sourceLayerIndex:O,index:E,geometry:x?C.geometry:j(f,o,p),patterns:{}};a.push(k)}for(const f of a){const{geometry:w,index:E,sourceLayerIndex:O}=f;this.addFeature(f,w,E,o,{},i.availableImages,i.brightness),i.featureIndex.insert(e[E].feature,w,E,O,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,o,p,a,f,w){}destroy(){}addFeature(e,i,o,p,a,f=[],w){for(const E of $p(i,2)){const O=[],x=[],C=[],k=new Wt(1/0,1/0),M=new Wt(-1/0,-1/0);for(const $ of E)if($.length!==0){$!==E[0]&&C.push(x.length/2);for(let G=0;G<$.length;G++)x.push($[G].x),x.push($[G].y),O.push($[G]),k.x=Math.min(k.x,$[G].x),k.y=Math.min(k.y,$[G].y),M.x=Math.max(M.x,$[G].x),M.y=Math.max(M.y,$[G].y)}const P=Sd(x,C),R=new ng(O,P,8,256);this.footprints.push({vertices:O,indices:P,grid:R,min:k,max:M})}}}_i(P_,"ClipBucket",{omit:["layers"]});const j0=Ir([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),$0=Ir([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Y=Ir([{name:"a_centroid_pos",components:2,type:"Uint16"}]),h=Ir([{name:"a_join_normal_inside",components:3,type:"Int16"}]),v=Ir([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),S=Ir([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:I}=j0;var L,z,B,U,X,te,K,re={};function ue(){if(z)return L;z=1;var s=Xs();function e(p,a,f,w,E){this.properties={},this.extent=f,this.type=0,this._pbf=p,this._geometry=-1,this._keys=w,this._values=E,p.readFields(i,this,a)}function i(p,a,f){p==1?a.id=f.readVarint():p==2?function(w,E){for(var O=w.readVarint()+w.pos;w.pos<O;){var x=E._keys[w.readVarint()],C=E._values[w.readVarint()];E.properties[x]=C}}(f,a):p==3?a.type=f.readVarint():p==4&&(a._geometry=f.pos)}function o(p){for(var a,f,w=0,E=0,O=p.length,x=O-1;E<O;x=E++)w+=((f=p[x]).x-(a=p[E]).x)*(a.y+f.y);return w}return L=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var a,f=p.readVarint()+p.pos,w=1,E=0,O=0,x=0,C=[];p.pos<f;){if(E<=0){var k=p.readVarint();w=7&k,E=k>>3}if(E--,w===1||w===2)O+=p.readSVarint(),x+=p.readSVarint(),w===1&&(a&&C.push(a),a=[]),a.push(new s(O,x));else{if(w!==7)throw new Error("unknown command "+w);a&&a.push(a[0].clone())}}return a&&C.push(a),C},e.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var a=p.readVarint()+p.pos,f=1,w=0,E=0,O=0,x=1/0,C=-1/0,k=1/0,M=-1/0;p.pos<a;){if(w<=0){var P=p.readVarint();f=7&P,w=P>>3}if(w--,f===1||f===2)(E+=p.readSVarint())<x&&(x=E),E>C&&(C=E),(O+=p.readSVarint())<k&&(k=O),O>M&&(M=O);else if(f!==7)throw new Error("unknown command "+f)}return[x,k,C,M]},e.prototype.toGeoJSON=function(p,a,f){var w,E,O=this.extent*Math.pow(2,f),x=this.extent*p,C=this.extent*a,k=this.loadGeometry(),M=e.types[this.type];function P(G){for(var J=0;J<G.length;J++){var ee=G[J];G[J]=[360*(ee.x+x)/O-180,360/Math.PI*Math.atan(Math.exp((180-360*(ee.y+C)/O)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(w=0;w<k.length;w++)R[w]=k[w][0];P(k=R);break;case 2:for(w=0;w<k.length;w++)P(k[w]);break;case 3:for(k=function(G){var J=G.length;if(J<=1)return[G];for(var ee,Z,ne=[],le=0;le<J;le++){var fe=o(G[le]);fe!==0&&(Z===void 0&&(Z=fe<0),Z===fe<0?(ee&&ne.push(ee),ee=[G[le]]):ee.push(G[le]))}return ee&&ne.push(ee),ne}(k),w=0;w<k.length;w++)for(E=0;E<k[w].length;E++)P(k[w][E])}k.length===1?k=k[0]:M="Multi"+M;var $={type:"Feature",geometry:{type:M,coordinates:k},properties:this.properties};return"id"in this&&($.id=this.id),$},L}function ge(){if(U)return B;U=1;var s=ue();function e(o,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(i,this,p),this.length=this._features.length}function i(o,p,a){o===15?p.version=a.readVarint():o===1?p.name=a.readString():o===5?p.extent=a.readVarint():o===2?p._features.push(a.pos):o===3?p._keys.push(a.readString()):o===4&&p._values.push(function(f){for(var w=null,E=f.readVarint()+f.pos;f.pos<E;){var O=f.readVarint()>>3;w=O===1?f.readString():O===2?f.readFloat():O===3?f.readDouble():O===4?f.readVarint64():O===5?f.readVarint():O===6?f.readSVarint():O===7?f.readBoolean():null}return w}(a))}return B=e,e.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var p=this._pbf.readVarint()+this._pbf.pos;return new s(this._pbf,p,this.extent,this._keys,this._values)},B}function ye(){return K||(K=1,re.VectorTile=function(){if(te)return X;te=1;var s=ge();function e(i,o,p){if(i===3){var a=new s(p,p.readVarint()+p.pos);a.length&&(o[a.name]=a)}}return X=function(i,o){this.layers=i.readFields(e,{},o)},X}(),re.VectorTileFeature=ue(),re.VectorTileLayer=ge()),re}var xe=ye();class _e extends Wt{constructor(e,i,o){super(e,i),this.z=o}}class ze extends _e{constructor(e,i,o,p){super(e,i,o),this.w=p}}function Re(s,e,i,o){const p=[],a=o===0?(f,w,E,O,x,C)=>{f.push(new Wt(C,E+(C-w)/(O-w)*(x-E)))}:(f,w,E,O,x,C)=>{f.push(new Wt(w+(C-E)/(x-E)*(O-w),C))};for(const f of s){const w=[];for(const E of f){if(E.length<=2)continue;const O=[];for(let k=0;k<E.length-1;k++){const M=E[k].x,P=E[k].y,R=E[k+1].x,$=E[k+1].y,G=o===0?M:P,J=o===0?R:$;G<e?J>e&&a(O,M,P,R,$,e):G>i?J<i&&a(O,M,P,R,$,i):O.push(E[k]),J<e&&G>=e&&a(O,M,P,R,$,e),J>i&&G<=i&&a(O,M,P,R,$,i)}let x=E[E.length-1];const C=o===0?x.x:x.y;C>=e&&C<=i&&O.push(x),O.length&&(x=O[O.length-1],O[0].x===x.x&&O[0].y===x.y||O.push(O[0]),w.push(O))}w.length&&p.push(w)}return p}function ft(s,e,i,o){const p=i==="x"?"y":"x",a=(o-s[i])/(e[i]-s[i]);s[p]=s[p]+(e[p]-s[p])*a,s[i]=o,s.hasOwnProperty("z")&&(s.z=Ii(s.z,e.z,a)),s.hasOwnProperty("w")&&(s.w=Ii(s.w,e.w,a))}function St(s,e,i,o){const p=i,a=o;for(const f of["x","y"]){let w=s,E=e;w[f]>=E[f]&&(w=e,E=s),w[f]<p&&E[f]>p&&ft(w,E,f,p),w[f]<a&&E[f]>a&&ft(E,w,f,a)}}const _t=Number.MAX_SAFE_INTEGER;function Ot(s,e,i,o){return s.order<e||s.order===_t||!(s.clipMask&i)||function(p,a){return a.length!==0&&a.find(f=>f===p)===void 0}(o,s.clipScope)}function Pt(s,e){return s.x-e.x||s.y-e.y}function Ft(s,e){return Pt(s.min,e.min)===0&&Pt(s.max,e.max)===0}function hi(s,e){return!(s.min.x>e.max.x||s.max.x<e.min.x||s.min.y>e.max.y||s.max.y<e.min.y)}function mi(s,e){if(s.length!==e.length)return!1;for(let i=0;i<s.length;i++)if(s[i].sourceId!==e[i].sourceId||!Ft(s[i],e[i])||s[i].order!==e[i].order||s[i].clipMask!==e[i].clipMask||!jn(s[i].clipScope,e[i].clipScope))return!1;return!0}function Ai(s,e,i){const o=1/ei,p=1/(1<<i.canonical.z),a=(e.x*o+i.canonical.x)*p+i.wrap,f=(e.y*o+i.canonical.y)*p;return{min:new Wt((s.x*o+i.canonical.x)*p+i.wrap,(s.y*o+i.canonical.y)*p),max:new Wt(a,f)}}function ai(s,e,i){const o=1<<i.canonical.z,p=((e.x-i.wrap)*o-i.canonical.x)*ei,a=(e.y*o-i.canonical.y)*ei;return{min:new Wt(((s.x-i.wrap)*o-i.canonical.x)*ei,(s.y*o-i.canonical.y)*ei),max:new Wt(p,a)}}function Ci(s,e,i,o,p,a,f){const w=s.indices,E=s.vertices,O=[];for(let x=o;x<o+p;x+=3){const C=e[i[x+0]+a],k=e[i[x+1]+a],M=e[i[x+2]+a],P=Math.min(C.x,k.x,M.x),R=Math.max(C.x,k.x,M.x),$=Math.min(C.y,k.y,M.y),G=Math.max(C.y,k.y,M.y);O.length=0,s.grid.query(new Wt(P,$),new Wt(R,G),O);for(let J=0;J<O.length;J++){const ee=O[J];if(ut(E[w[3*ee+0]],E[w[3*ee+1]],E[w[3*ee+2]],C,k,M,f))return!0}}return!1}function Zi(s,e,i,o){if(!s||!i)return!1;let p=s.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(i.vertices.length<s.vertices.length)return Zi(i,o,s,e);const a=e.canonical,f=o.canonical,w=Math.pow(2,f.z-a.z);p=s.vertices.map(E=>new Wt((E.x+a.x*ei)*w-f.x*ei,(E.y+a.y*ei)*w-f.y*ei))}return Ci(i,p,s.indices,0,s.indices.length,0,0)}function kr(s,e,i,o){const p=Math.pow(2,o.z-i.z);return new Wt((s+i.x*ei)*p-o.x*ei,(e+i.y*ei)*p-o.y*ei)}function Hi(s,e){const i=[];e.grid.queryPoint(s,i);const o=e.indices,p=e.vertices;for(let a=0;a<i.length;a++){const f=i[a];if(Oe([p[o[3*f+0]],p[o[3*f+1]],p[o[3*f+2]]],s))return!0}return!1}const gr=[new Wt(0,0),new Wt(ei,0),new Wt(ei,ei),new Wt(0,ei)];function Vi(s,e){const i=[];let o=[];if(!e||s.length<2)return[s];if(s.length===2)return Qe(s[0],s[1],gr)?[s]:[];for(let p=0;p<s.length+2;p++){const a=s[p%s.length],f=s[(p+1)%s.length],w=Qe(p===0?s[s.length-1]:s[(p-1)%s.length],a,gr),E=Qe(a,f,gr),O=w||E;O&&o.push(a),O&&E||o.length>0&&(o.length>1&&i.push(o),o=[])}return o.length>1&&i.push(o),i}const Qi=xe.VectorTileFeature.types,_r=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],un=["fill-extrusion-flood-light-ground-radius"],kn=Math.pow(2,13),zr=Math.pow(2,15)-1,Hr=new Wt(0,1),Xr=2147483648;function Ms(s,e,i,o,p,a,f,w){s.emplaceBack((e<<1)+f,(i<<1)+a,(Math.floor(o*kn)<<1)+p,Math.round(w))}function ss(s,e,i){s.emplaceBack(e.x*ei,e.y*ei,i?1:0)}function Es(s,e,i,o,p,a){s.emplaceBack(e.x,e.y,(i.x<<1)+o,(i.y<<1)+p,a)}function os(s,e,i){s.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Xn{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Bs{constructor(){this.centroidXY=new Wt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Wt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Wt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Wt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Pc{constructor(){this.acc=new Wt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,o){this.accCount++,this.acc._add(i);let p=!!this.borders;i.x<e.min.x?(e.min.x=i.x,p=!0):i.x>e.max.x&&(e.max.x=i.x,p=!0),i.y<e.min.y?(e.min.y=i.y,p=!0):i.y>e.max.y&&(e.max.y=i.y,p=!0),((i.x===0||i.x===ei)&&i.x===o.x)!=((i.y===0||i.y===ei)&&i.y===o.y)&&this.processBorderOverlap(i,o),p&&this.checkBorderIntersection(i,o)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Ii(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>ei!=e.x>ei&&this.addBorderIntersection(1,Ii(i.y,e.y,(ei-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Ii(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>ei!=e.y>ei&&this.addBorderIntersection(3,Ii(i.x,e.x,(ei-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new Wt(0,0):new Wt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function Ed(s,e){const i=s.add(e)._unit(),o=nr(s.x*i.x+s.y*i.y,-1,1);var p,a,f;return f=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(f)))/4*zr*((p=s).x*(a=e).y-p.y*a.x<0?-1:1)}const em=[s=>s.x<0,s=>s.x>ei,s=>s.y<0,s=>s.y>ei];function Cd(s,e,i,o){const p=[4];if(o===0)return p;i._mult(o);const a=s.sub(i),f=e.sub(i),w=[s,e,a,f];for(let E=0;E<4;E++)for(const O of w)if(em[E](O)){p.push(E);break}return p}class sg{constructor(e){this.vertexArray=new dd,this.indexArray=new gs,this.programConfigurations=new ma(e.layers,{zoom:e.zoom,lut:e.lut},i=>un.includes(i)),this._segments=new Sn,this.hiddenByLandmarkVertexArray=new oo,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Sn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,o,p=!1){const a=e.length;if(a>2){let f=Math.max(0,this._segments.get().length-1);const w=this._segments._prepareSegment(4*a,this.vertexArray.length,2*this._segmentToGroundQuads[f].length);let E;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{const O=e[0],x=e[1];E=Ed(O.sub(e[a-1])._perp()._unit(),x.sub(O)._perp()._unit())}for(let O=0;O<a;O++){const x=O===a-1?0:O+1,C=e[O],k=e[x],M=e[x===a-1?0:x+1],P=k.sub(C)._perp()._unit(),R=Ed(P,M.sub(k)._perp()._unit()),$=E,G=R;if(G0(C,k,i)||p&&mb(C,i)&&mb(k,i)){E=R;continue}const J=w.vertexLength;Es(this.vertexArray,C,k,1,1,$),Es(this.vertexArray,C,k,1,0,$),Es(this.vertexArray,C,k,0,1,G),Es(this.vertexArray,C,k,0,0,G),w.vertexLength+=4;const ee=Cd(C,k,P,o);for(const Z of ee)this._segmentToGroundQuads[f].push({id:J,region:Z}),this._segmentToRegionTriCounts[f][Z]+=2,w.primitiveLength+=2;E=R}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort((p,a)=>p.region-a.region);for(let o=0;o<i;o++){const p=this._segmentToGroundQuads[o],a=e[o],f=this._segmentToRegionTriCounts[o];f.reduce((E,O)=>E+O,0);let w=0;for(let E=0;E<=4;E++){const O=f[E];if(O!==0){let x=this.regionSegments[E];x||(x=this.regionSegments[E]=new Sn);const C={vertexOffset:a.vertexOffset,primitiveOffset:a.primitiveOffset+w,vertexLength:a.vertexLength,primitiveLength:O};x.get().push(C)}w+=O}for(let E=0;E<p.length;E++){const O=p[E].id;this.indexArray.emplaceBack(O,O+1,O+3),this.indexArray.emplaceBack(O,O+3,O+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,o,p,a,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,o,p,a,f)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,$0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,o,p,a,f,w){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,o,p,a,f,w)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const o=e.flags&Xr?1:0;for(let p=e.groundVertexArrayOffset;p<i;++p)this.hiddenByLandmarkVertexArray.emplace(p,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,v.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Hp{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new gs,this.footprintVertices=new wo,this.footprintSegments=[],this.layoutVertexArray=new tn,this.centroidVertexArray=new So,this.wallVertexArray=new Rl,this.indexArray=new gs,this.programConfigurations=new ma(e.layers,{zoom:e.zoom,lut:e.lut},i=>_r.includes(i)),this.segments=new Sn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new sg(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,o,p){this.features=[],this.hasPattern=ig("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=t(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:a,id:f,index:w,sourceLayerIndex:E}of e){const O=this.layers[0]._featureFilter.needGeometry,x=H(a,O);if(!this.layers[0]._featureFilter.filter(new Vr(this.zoom),x,o))continue;const C={id:f,sourceLayerIndex:E,index:w,geometry:O?x.geometry:j(a,o,p),properties:a.properties,type:a.type,patterns:{}},k=this.layoutVertexArray.length,M=Qi[C.type]==="Polygon";if(this.hasPattern)this.features.push(Gp("fill-extrusion",this.layers,C,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const P of C.geometry)for(const R of Vi(P,M))this.addFeature(C,[R],w,o,{},i.availableImages,p,i.brightness);else this.addFeature(C,C.geometry,w,o,{},i.availableImages,p,i.brightness);i.featureIndex.insert(a,C.geometry,w,E,this.index,k)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,o,p,a,f){for(const w of this.features){const E=Qi[w.type]==="Polygon",{geometry:O}=w;if(this.wallMode)for(const x of O)for(const C of Vi(x,E))this.addFeature(w,[C],w.index,i,o,p,a,f);else this.addFeature(w,O,w.index,i,o,p,a,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,o,p,a,f,w){this.programConfigurations.updatePaintArrays(e,i,a,o,p,f,w),this.groundEffect.update(e,i,a,o,p,f,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,I),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,h.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,S.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Y.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,p,a,f,w,E){const O=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,x=[new Wt(0,0),new Wt(ei,ei)],C=w.projection,k=C.name==="globe",M=this.wallMode||Qi[e.type]==="Polygon",P=new Pc;P.centroidDataIndex=this.centroidData.length;const R=new Bs,$=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},p)<=0,G=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},p);let J;if(R.height=G,R.vertexArrayOffset=this.layoutVertexArray.length,R.groundVertexArrayOffset=this.groundEffect.vertexArray.length,k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ph),this.wallMode){if(k)return void qi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;J=function(Me){const $e=Me[0].x===Me[Me.length-1].x&&Me[0].y===Me[Me.length-1].y;(function(Gt){let Ut=0;const xi=Gt.length;for(let ui=0;ui<xi;ui++)Ut+=(Gt[(ui+1)%xi].x-Gt[ui].x)*(Gt[(ui+1)%xi].y+Gt[ui].y);return Ut>=0})(Me)||(Me=Me.reverse());const Ge={geometry:[],joinNormals:[],indices:[]},Xe=[],qe=[],et=[];let nt=Me.length;for(;nt>=2&&Me[nt-1].equals(Me[nt-2]);)nt--;if(nt<($e?3:2))return Ge;let ct,it,Ct,Nt,Et,si=0;for(;si<nt-1&&Me[si].equals(Me[si+1]);)si++;$e&&(ct=Me[nt-2],Et=Me[si].sub(ct)._unit()._perp());for(let Gt=si;Gt<nt;Gt++){if(Ct=Gt===nt-1?$e?Me[si+1]:void 0:Me[Gt+1],Ct&&Me[Gt].equals(Ct))continue;Et&&(Nt=Et),ct&&(it=ct),ct=Me[Gt],Et=Ct?Ct.sub(ct)._unit()._perp():Nt,Nt=Nt||Et;let Ut=Nt.add(Et);Ut.x===0&&Ut.y===0||Ut._unit();const xi=Ut.x*Et.x+Ut.y*Et.y,ui=xi!==0?1/xi:1/0,fi=Nt.x*Et.y-Nt.y*Et.x>0;let Ni="miter";const Ki=2;Ni==="miter"&&ui>Ki&&(Ni="bevel"),Ni==="bevel"&&(ui>100&&(Ni="flipbevel"),ui<Ki&&(Ni="miter"));const er=(tr,cr,ur,nn)=>{const Nr=new Wt(tr.x,tr.y),Gi=new Wt(tr.x,tr.y);Nr.x+=cr.x*nn,Nr.y+=cr.y*nn,Gi.x-=cr.x*Math.max(ur,1),Gi.y-=cr.y*Math.max(ur,1),et.push(cr),Xe.push(Nr),qe.push(Gi)};if(Ni==="miter")Ut._mult(ui),er(ct,Ut,0,0);else if(Ni==="flipbevel")Ut=Et.mult(-1),er(ct,Ut,0,0),er(ct,Ut.mult(-1),0,0);else{const tr=-Math.sqrt(ui*ui-1),cr=fi?tr:0,ur=fi?0:tr;it&&er(ct,Nt,cr,ur),Ct&&er(ct,Et,cr,ur)}}Ge.geometry=[...Xe,...qe.reverse(),Xe[0]],Ge.joinNormals=[...et,...et.reverse(),et[et.length-1]];const ti=Ge.geometry.length-1;for(let Gt=0;Gt<ti/2;Gt++)if(Gt+1<ti/2){let Ut=Gt,xi=Gt+1,ui=ti-1-Gt,fi=ti-2-Gt;Ut=Ut===0?ti-1:Ut-1,xi=xi===0?ti-1:xi-1,ui=ui===0?ti-1:ui-1,fi=fi===0?ti-1:fi-1,Ge.indices.push(ui),Ge.indices.push(xi),Ge.indices.push(Ut),Ge.indices.push(ui),Ge.indices.push(fi),Ge.indices.push(xi)}return Ge}(i[0]),i=[J.geometry]}const ee=(Me,$e)=>Me<($e.length-1)/2||Me===$e.length-1,Z=this.wallMode?[i]:$p(i,500);for(let Me=Z.length-1;Me>=0;Me--){const $e=Z[Me];($e.length===0||(ne=$e[0]).every(De=>De.x<=0)||ne.every(De=>De.x>=ei)||ne.every(De=>De.y<=0)||ne.every(De=>De.y>=ei))&&Z.splice(Me,1)}var ne;let le;if(k)le=vb(Z,x,p);else{le=[];for(const Me of Z)le.push({polygon:Me,bounds:x})}const fe=M?this.edgeRadius:0,Ce=fe>0&&this.zoom<17,Ee=(Me,$e)=>{if(Me.length===0)return!1;const De=Me[Me.length-1];return $e.x===De.x&&$e.y===De.y};for(const{polygon:Me,bounds:$e}of le){let De=0,Ge=0;for(const nt of Me)M&&!nt[0].equals(nt[nt.length-1])&&nt.push(nt[0]),Ge+=M?nt.length-1:nt.length;const Xe=this.segments.prepareSegment((M?5:4)*Ge,this.layoutVertexArray,this.indexArray);R.footprintSegIdx<0&&(R.footprintSegIdx=this.footprintSegments.length),R.polygonSegIdx<0&&(R.polygonSegIdx=this.polygonSegments.length);const qe={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},et=new Xn;if(et.vertexOffset=this.footprintVertices.length,et.indexOffset=3*this.footprintIndices.length,et.ringIndices=[],M){const nt=[],ct=[];De=Xe.vertexLength;for(let Ct=0;Ct<Me.length;Ct++){const Nt=Me[Ct];Nt.length&&Ct!==0&&ct.push(nt.length/2);const Et=[];let si,ti;si=Nt[1].sub(Nt[0])._perp()._unit(),et.ringIndices.push(Nt.length-1);for(let Gt=1;Gt<Nt.length;Gt++){const Ut=Nt[Gt],xi=Nt[Gt===Nt.length-1?1:Gt+1],ui=Ut.clone();if(fe){ti=xi.sub(Ut)._perp()._unit();const fi=si.add(ti)._unit(),Ni=fe*Math.min(4,1/(si.x*fi.x+si.y*fi.y));ui.x+=Ni*fi.x,ui.y+=Ni*fi.y,ui.x=Math.round(ui.x),ui.y=Math.round(ui.y),si=ti}if(!$||fe!==0&&!Ce||Ee(Et,ui)||Et.push(ui),Ms(this.layoutVertexArray,ui.x,ui.y,0,0,1,1,0),this.wallMode){const fi=ee(Gt,Nt);ss(this.wallVertexArray,J.joinNormals[Gt],!fi)}Xe.vertexLength++,this.footprintVertices.emplaceBack(Ut.x,Ut.y),nt.push(Ut.x,Ut.y),k&&os(this.layoutVertexExtArray,C.projectTilePoint(ui.x,ui.y,p),C.upVector(p,ui.x,ui.y))}$&&(fe===0||Ce)&&(Et.length!==0&&Ee(Et,Et[0])&&Et.pop(),this.groundEffect.addData(Et,$e,O))}const it=this.wallMode?J.indices:Sd(nt,ct);for(let Ct=0;Ct<it.length;Ct+=3)this.footprintIndices.emplaceBack(et.vertexOffset+it[Ct+0],et.vertexOffset+it[Ct+1],et.vertexOffset+it[Ct+2]),this.indexArray.emplaceBack(De+it[Ct],De+it[Ct+2],De+it[Ct+1]),Xe.primitiveLength++;et.indexCount+=it.length,et.vertexCount+=this.footprintVertices.length-et.vertexOffset}for(let nt=0;nt<Me.length;nt++){const ct=Me[nt];P.startRing(R,ct[0]);let it=ct.length>4&&gb(ct[ct.length-2],ct[0],ct[1]),Ct=fe?OM(ct[ct.length-2],ct[0],ct[1],fe):0;const Nt=[];let Et,si,ti;si=ct[1].sub(ct[0])._perp()._unit();let Gt=!0;for(let Ut=1,xi=0;Ut<ct.length;Ut++){let ui=ct[Ut-1],fi=ct[Ut];const Ni=ct[Ut===ct.length-1?1:Ut+1];if(P.appendEdge(R,fi,ui),G0(fi,ui,$e)){fe&&(si=Ni.sub(fi)._perp()._unit(),Gt=!Gt);continue}const Ki=fi.sub(ui)._perp(),er=Ki.x/(Math.abs(Ki.x)+Math.abs(Ki.y)),tr=Ki.y>0?1:0,cr=ui.dist(fi);if(xi+cr>32768&&(xi=0),fe){ti=Ni.sub(fi)._perp()._unit();let Gi=fb(ui,fi,Ni,pb(si,ti),fe);isNaN(Gi)&&(Gi=0);const Rr=fi.sub(ui)._unit();ui=ui.add(Rr.mult(Ct))._round(),fi=fi.add(Rr.mult(-Gi))._round(),Ct=Gi,si=ti,$&&this.zoom>=17&&(Ee(Nt,ui)||Nt.push(ui),Ee(Nt,fi)||Nt.push(fi))}const ur=Xe.vertexLength,nn=ct.length>4&&gb(ui,fi,Ni);let Nr=_b(xi,it,Gt);if(Ms(this.layoutVertexArray,ui.x,ui.y,er,tr,0,0,Nr),Ms(this.layoutVertexArray,ui.x,ui.y,er,tr,0,1,Nr),this.wallMode){const Gi=ee(Ut-1,ct),Rr=J.joinNormals[Ut-1];ss(this.wallVertexArray,Rr,Gi),ss(this.wallVertexArray,Rr,Gi)}if(xi+=cr,Nr=_b(xi,nn,!Gt),it=nn,Ms(this.layoutVertexArray,fi.x,fi.y,er,tr,0,0,Nr),Ms(this.layoutVertexArray,fi.x,fi.y,er,tr,0,1,Nr),this.wallMode){const Gi=ee(Ut,ct),Rr=J.joinNormals[Ut];ss(this.wallVertexArray,Rr,Gi),ss(this.wallVertexArray,Rr,Gi)}if(Xe.vertexLength+=4,this.indexArray.emplaceBack(ur+0,ur+1,ur+2),this.indexArray.emplaceBack(ur+1,ur+3,ur+2),Xe.primitiveLength+=2,fe){const Gi=De+(Ut===1?ct.length-2:Ut-2),Rr=Ut===1?De:Gi+1;if(this.indexArray.emplaceBack(ur+1,Gi,ur+3),this.indexArray.emplaceBack(Gi,Rr,ur+3),Xe.primitiveLength+=2,Et===void 0&&(Et=ur),!G0(Ni,ct[Ut],$e)){const Fr=Ut===ct.length-1?Et:Xe.vertexLength;this.indexArray.emplaceBack(ur+2,ur+3,Fr),this.indexArray.emplaceBack(ur+3,Fr+1,Fr),this.indexArray.emplaceBack(ur+3,Rr,Fr+1),Xe.primitiveLength+=3}Gt=!Gt}if(k){const Gi=this.layoutVertexExtArray,Rr=C.projectTilePoint(ui.x,ui.y,p),Fr=C.projectTilePoint(fi.x,fi.y,p),hn=C.upVector(p,ui.x,ui.y),Zn=C.upVector(p,fi.x,fi.y);os(Gi,Rr,hn),os(Gi,Rr,hn),os(Gi,Fr,Zn),os(Gi,Fr,Zn)}}M&&(De+=ct.length-1),$&&fe&&this.zoom>=17&&(Nt.length!==0&&Ee(Nt,Nt[0])&&Nt.pop(),this.groundEffect.addData(Nt,$e,O,fe>0))}this.footprintSegments.push(et),qe.triangleCount=this.indexArray.length-qe.triangleArrayOffset,this.polygonSegments.push(qe),++R.footprintSegLen,++R.polygonSegLen}if(R.vertexCount=this.layoutVertexArray.length-R.vertexArrayOffset,R.groundVertexCount=this.groundEffect.vertexArray.length-R.groundVertexArrayOffset,R.vertexCount!==0){if(R.centroidXY=P.borders?Hr:this.encodeCentroid(P,R),this.centroidData.push(R),P.borders){this.featuresOnBorder.push(P);const Me=this.featuresOnBorder.length-1;for(let $e=0;$e<P.borders.length;$e++)P.borders[$e][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[$e].push(Me)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,a,f,p,E),this.groundEffect.addPaintPropertiesData(e,o,a,f,p,E),this.maxHeight=Math.max(this.maxHeight,G)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){const e=[];for(let w=0;w<this.centroidData.length;w++){const E=this.centroidData[w],O=+(E.min.y+E.max.y>ei),x=2*O+(+(E.min.x+E.max.x>ei)^O);for(let C=0;C<E.polygonSegLen;C++){const k=E.polygonSegIdx+C;e.push({centroidIdx:w,subtile:x,polygonSegmentIdx:k,triangleSegmentIdx:this.polygonSegments[k].triangleSegIdx})}}const i=new gs;e.sort((w,E)=>w.triangleSegmentIdx===E.triangleSegmentIdx?w.subtile-E.subtile:w.triangleSegmentIdx-E.triangleSegmentIdx);let o=0,p=0,a=0;for(const w of e){if(w.triangleSegmentIdx!==o)break;a++}const f=e.length;for(;p!==e.length;){o=e[p].triangleSegmentIdx;let w=0,E=p,O=p;for(let x=E;x<a&&e[x].subtile===w;x++)O++;for(;E!==a;){const x=e[E];w=x.subtile;const C=this.centroidData[x.centroidIdx].min.clone(),k=this.centroidData[x.centroidIdx].max.clone(),M={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let P=E;P<O;P++){const R=e[P],$=this.polygonSegments[R.polygonSegmentIdx],G=this.centroidData[R.centroidIdx].min,J=this.centroidData[R.centroidIdx].max,ee=this.indexArray.uint16;for(let Z=$.triangleArrayOffset;Z<$.triangleArrayOffset+$.triangleCount;Z++)i.emplaceBack(ee[3*Z],ee[3*Z+1],ee[3*Z+2]);M.primitiveLength+=$.triangleCount,C.x=Math.min(C.x,G.x),C.y=Math.min(C.y,G.y),k.x=Math.max(k.x,J.x),k.y=Math.max(k.y,J.y)}M.primitiveLength>0&&this.triangleSubSegments.push({segment:M,min:C,max:k}),E=O;for(let P=E;P<a&&e[P].subtile===e[E].subtile;P++)O++}p=a;for(let x=p;x<f&&e[x].triangleSegmentIdx===e[p].triangleSegmentIdx;x++)a++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,o){const p=new Sn;if(this.wallMode){for(const R of this.triangleSubSegments)p.segments.push(R.segment);return p}let a=0,f=0;const w=1<<e.canonical.z;if(i){const R=i.getMinMaxForTile(e);R&&(a=R.min,f=R.max)}f+=this.maxHeight;const E=e.toUnwrapped();let O;const x=[E.canonical.x/w+E.wrap,E.canonical.y/w],C=[(E.canonical.x+1)/w+E.wrap,(E.canonical.y+1)/w],k=(R,$,G)=>[R[0]*(1-G[0])+$[0]*G[0],R[1]*(1-G[1])+$[1]*G[1]],M=[],P=[];for(const R of this.triangleSubSegments){M[0]=R.min.x/ei,M[1]=R.min.y/ei,P[0]=R.max.x/ei,P[1]=R.max.y/ei;const $=k(x,C,M),G=k(x,C,P);if(new bi([$[0],$[1],a],[G[0],G[1],f]).intersectsPrecise(o)===0){O&&(p.segments.push(O),O=void 0);continue}const J=R.segment;O&&O.vertexOffset!==J.vertexOffset&&(p.segments.push(O),O=void 0),O?(O.vertexLength+=J.vertexLength,O.primitiveLength+=J.primitiveLength):O={vertexOffset:J.vertexOffset,primitiveLength:J.primitiveLength,vertexLength:J.vertexLength,primitiveOffset:J.primitiveOffset,sortKey:void 0,vaos:{}}}return O&&p.segments.push(O),p}encodeCentroid(e,i){const o=e.centroid(),p=i.span(),a=Math.min(7,Math.round(p.x*this.tileToMeter/10)),f=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new Wt(nr(o.x,1,ei-1)<<3|a,nr(o.y,1,ei-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new Wt(0,0);const i=e.borders,o=Number.MAX_VALUE;if(i[0][0]!==o||i[1][0]!==o){const p=i[0][0]!==o?0:1;return new Wt(6|(i[0][0]!==o?0:65528),(i[p][0]+i[p][1])/2<<3|6)}{const p=i[2][0]!==o?2:3;return new Wt((i[p][0]+i[p][1])/2<<3|6,6|(i[2][0]!==o?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=Xr,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,p=e.flags&Xr?Hr:e.centroidXY,a=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==p.y||a!==p.x){for(let f=i;f<o;++f)this.centroidVertexArray.emplace(f,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,o){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const p=i.getReplacementRegionsForTile(e.toUnwrapped());if(mi(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const a=[];for(const f of this.activeReplacements){if(f.order<o)continue;const w=Math.max(1,Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z));for(const E of this.centroidData)if(!(E.flags&Xr||f.min.x>E.max.x||E.min.x>f.max.x||f.min.y>E.max.y||E.min.y>f.max.y))for(let O=0;O<E.footprintSegLen;O++){const x=this.footprintSegments[E.footprintSegIdx+O];if(a.length=0,LM(this.footprintVertices,x.vertexOffset,x.vertexCount,f.footprintTileId.canonical,e.canonical,a),Ci(f.footprint,a,this.footprintIndices.uint16,x.indexOffset,x.indexCount,-x.vertexOffset,-w)){E.flags|=Xr;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,o){let p=!1;for(let a=0;a<o.footprintSegLen;a++){const f=this.footprintSegments[o.footprintSegIdx+a];let w=0;for(const E of f.ringIndices){for(let O=w,x=E+w-1;O<E+w;x=O++){const C=this.footprintVertices.int16[2*(O+f.vertexOffset)+0],k=this.footprintVertices.int16[2*(O+f.vertexOffset)+1],M=this.footprintVertices.int16[2*(x+f.vertexOffset)+1];k>i!=M>i&&e<(this.footprintVertices.int16[2*(x+f.vertexOffset)+0]-C)*(i-k)/(M-k)+C&&(p=!p)}w=E}}return p}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,p=!0;const a=4*(e+ei)*ei+(i+ei);if(this.partLookup.hasOwnProperty(a)){const f=this.partLookup[a];return f?{height:f.height,hidden:!!(f.flags&Xr)}:void 0}for(const f of this.centroidData)e>f.max.x||f.min.x>e||i>f.max.y||f.min.y>i||this.footprintContainsPoint(e,i,f)&&f&&f.height>o&&(o=f.height,this.partLookup[a]=f,p=!!(f.flags&Xr));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:p};this.partLookup[a]=void 0}}function pb(s,e){const i=s.add(e)._unit();return s.x*i.x+s.y*i.y}function OM(s,e,i,o){const p=e.sub(s)._perp()._unit(),a=i.sub(e)._perp()._unit();return fb(s,e,i,pb(p,a),o)}function fb(s,e,i,o,p){const a=Math.sqrt(1-o*o);return Math.min(s.dist(e)/3,e.dist(i)/3,p*a/o)}function G0(s,e,i){return s.x<i[0].x&&e.x<i[0].x||s.x>i[1].x&&e.x>i[1].x||s.y<i[0].y&&e.y<i[0].y||s.y>i[1].y&&e.y>i[1].y}function mb(s,e){return s.x<e[0].x||s.x>e[1].x||s.y<e[0].y||s.y>e[1].y}function gb(s,e,i){if(s.x<0||s.x>=ei||e.x<0||e.x>=ei||i.x<0||i.x>=ei)return!1;const o=i.sub(e),p=o.perp(),a=s.sub(e);return(o.x*a.x+o.y*a.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(a.x*a.x+a.y*a.y))>-.866&&p.x*a.x+p.y*a.y<0}function _b(s,e,i){const o=e?2|s:-3&s;return i?1|o:-2&o}function yb(){const s=Math.PI/32,e=Math.tan(s),i=Ec;return i*Math.sqrt(1+2*e*e)-i}function vb(s,e,i){const o=1<<i.z,p=co(i.x/o),a=co((i.x+1)/o),f=Wn(i.y/o),w=Wn((i.y+1)/o);return function(E,O,x,C,k=0,M){const P=[];if(!E.length||!x||!C)return P;const R=(le,fe)=>{for(const Ce of le)P.push({polygon:Ce,bounds:fe})},$=Math.ceil(Math.log2(x)),G=Math.ceil(Math.log2(C)),J=$-G,ee=[];for(let le=0;le<Math.abs(J);le++)ee.push(J>0?0:1);for(let le=0;le<Math.min($,G);le++)ee.push(0),ee.push(1);let Z=E;if(Z=Re(Z,O[0].y-k,O[1].y+k,1),Z=Re(Z,O[0].x-k,O[1].x+k,0),!Z.length)return P;const ne=[];for(ee.length?ne.push({polygons:Z,bounds:O,depth:0}):R(Z,O);ne.length;){const le=ne.pop(),fe=le.depth,Ce=ee[fe],Ee=le.bounds[0],Me=le.bounds[1],$e=Ce===0?Ee.x:Ee.y,De=Ce===0?Me.x:Me.y,Ge=M?M(Ce,$e,De):.5*($e+De),Xe=Re(le.polygons,$e-k,Ge+k,Ce),qe=Re(le.polygons,Ge-k,De+k,Ce);if(Xe.length){const et=[Ee,new Wt(Ce===0?Ge:Me.x,Ce===1?Ge:Me.y)];ee.length>fe+1?ne.push({polygons:Xe,bounds:et,depth:fe+1}):R(Xe,et)}if(qe.length){const et=[new Wt(Ce===0?Ge:Ee.x,Ce===1?Ge:Ee.y),Me];ee.length>fe+1?ne.push({polygons:qe,bounds:et,depth:fe+1}):R(qe,et)}}return P}(s,e,Math.ceil((a-p)/11.25),Math.ceil((f-w)/11.25),1,(E,O,x)=>{if(E===0)return .5*(O+x);{const C=Wn((i.y+O/ei)/o);return(ya(.5*(Wn((i.y+x/ei)/o)+C))*o-i.y)*ei}})}function LM(s,e,i,o,p,a){const f=Math.pow(2,o.z-p.z);for(let w=0;w<i;w++){let E=s.int16[2*(w+e)+0],O=s.int16[2*(w+e)+1];E=(E+p.x*ei)*f-o.x*ei,O=(O+p.y*ei)*f-o.y*ei,a.push(new Wt(E,O))}}let xb,bb;function og(s,e){return s.x*e.x+s.y*e.y}function wb(s,e){if(s.length===1){let i=0;const o=e[i++];let p;for(;!p||o.equals(p);)if(p=e[i++],!p)return 1/0;for(;i<e.length;i++){const a=e[i],f=s[0],w=p.sub(o),E=a.sub(o),O=f.sub(o),x=og(w,w),C=og(w,E),k=og(E,E),M=og(O,w),P=og(O,E),R=x*k-C*C,$=(k*M-C*P)/R,G=(x*P-C*M)/R,J=o.z*(1-$-G)+p.z*$+a.z*G;if(isFinite(J))return J}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}function Sb(s,e,i,o,p,a,f,w){const E=f*p.getElevationAt(s,e,!0,!0),O=a[0]!==0,x=O?a[1]===0?f*(a[0]/7-450):f*function(C,k,M){const P=Math.floor(k[0]/8),R=Math.floor(k[1]/8),$=10*(k[0]-8*P),G=10*(k[1]-8*R),J=C.getElevationAt(P,R,!0,!0),ee=C.getMeterToDEM(M),Z=Math.floor(.5*($*ee-1)),ne=Math.floor(.5*(G*ee-1)),le=C.tileCoordToPixel(P,R),fe=2*Z+1,Ce=2*ne+1,Ee=function(qe,et,nt,ct,it){return[qe.getElevationAtPixel(et,nt,!0),qe.getElevationAtPixel(et+it,nt,!0),qe.getElevationAtPixel(et,nt+it,!0),qe.getElevationAtPixel(et+ct,nt+it,!0)]}(C,le.x-Z,le.y-ne,fe,Ce),Me=Math.abs(Ee[0]-Ee[1]),$e=Math.abs(Ee[2]-Ee[3]),De=Math.abs(Ee[0]-Ee[2])+Math.abs(Ee[1]-Ee[3]),Ge=Math.min(.25,.5*ee*(Me+$e)/fe),Xe=Math.min(.25,.5*ee*De/Ce);return J+Math.max(Ge*$,Xe*G)}(p,a,w):E;return{base:E+(i===0?-1:i),top:O?Math.max(x+o,E+i+2):E+o}}_i(Hp,"FillExtrusionBucket",{omit:["layers","features"]}),_i(Bs,"PartData"),_i(Xn,"FootprintSegment"),_i(Pc,"BorderCentroidData"),_i(sg,"GroundEffect");const RM=Ir([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),zM=Ir([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:FM}=RM,BM=Ir([{name:"a_packed",components:3,type:"Float32"}]),{members:NM}=BM,VM=Ir([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:UM}=VM;class Tb{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Vl({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const o=this.getKey(e,i);return this.positions[o]}trim(){const e=this.width,i=this.height=Nc(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){const p=[];let a=e.length%2==1?-e[e.length-1]*o:0,f=e[0]*o,w=!0;p.push({left:a,right:f,isDash:w,zeroLength:e[0]===0});let E=e[0];for(let O=1;O<e.length;O++){w=!w;const x=e[O];a=E*o,E+=x,f=E*o,p.push({left:a,right:f,isDash:w,zeroLength:x===0})}return p}addRoundDash(e,i,o){const p=i/2;for(let a=-o;a<=o;a++){const f=this.width*(this.nextRow+o+a);let w=0,E=e[w];for(let O=0;O<this.width;O++){O/E.right>1&&(E=e[++w]);const x=Math.abs(O-E.left),C=Math.abs(O-E.right),k=Math.min(x,C);let M;const P=a/o*(p+1);if(E.isDash){const R=p-Math.abs(P);M=Math.sqrt(k*k+R*R)}else M=p-Math.sqrt(k*k+P*P);this.image.data[f+O]=Math.max(0,Math.min(255,M+128))}}}addRegularDash(e,i){for(let E=e.length-1;E>=0;--E){const O=e[E],x=e[E+1];O.zeroLength?e.splice(E,1):x&&x.isDash===O.isDash&&(x.left=O.left,e.splice(E,1))}const o=e[0],p=e[e.length-1];o.isDash===p.isDash&&(o.left=p.left-this.width,p.right=o.right+this.width);const a=this.width*this.nextRow;let f=0,w=e[f];for(let E=0;E<this.width;E++){E/w.right>1&&(w=e[++f]);const O=Math.abs(E-w.left),x=Math.abs(E-w.right),C=Math.min(O,x);this.image.data[a+E]=Math.max(0,Math.min(255,(w.isDash?C:-C)+i+128))}}addDash(e,i){const o=this.getKey(e,i);if(this.positions[o])return this.positions[o];const p=i==="round",a=p?7:0,f=2*a+1;if(this.nextRow+f>this.height)return qi("LineAtlas out of space"),null;e.length===0&&e.push(1);let w=0;for(let x=0;x<e.length;x++)e[x]<0&&(qi("Negative value is found in line dasharray, replacing values with 0"),e[x]=0),w+=e[x];if(w!==0){const x=this.width/w,C=this.getDashRanges(e,this.width,x);p?this.addRoundDash(C,x,a):this.addRegularDash(C,i==="square"?.5*x:0)}const E=this.nextRow+a;this.nextRow+=f;const O={tl:[E,a],br:[w,0]};return this.positions[o]=O,O}}_i(Tb,"LineAtlas");const jM=xe.VectorTileFeature.types,$M=Math.cos(Math.PI/180*37.5),GM=Math.cos(Math.PI/180*5);class H0{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new xu,this.layoutVertexArray2=new ha,this.patternVertexArray=new ha,this.indexArray=new gs,this.programConfigurations=new ma(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Sn,this.maxLineLength=0,this.zOffsetVertexArray=new ha,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:ei/64}updateFootprints(e,i){}populate(e,i,o,p){this.hasPattern=ig("line",this.layers,this.pixelRatio,i);const a=this.layers[0].layout.get("line-sort-key");this.tileToMeter=t(o);const f=this.layers[0].layout.get("line-z-offset"),w=f.isConstant()&&!f.constantOr(0),E=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=E==="sea"||E==="ground"||!w&&E==="none",this.hasZOffset&&E==="none"&&qi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const O=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&O!==void 0;const x=[];for(const{feature:P,id:R,index:$,sourceLayerIndex:G}of e){const J=this.layers[0]._featureFilter.needGeometry,ee=H(P,J);if(!this.layers[0]._featureFilter.filter(new Vr(this.zoom),ee,o))continue;const Z=a?a.evaluate(ee,{},o):void 0,ne={id:R,properties:P.properties,type:P.type,sourceLayerIndex:G,index:$,geometry:J?ee.geometry:j(P,o,p),patterns:{},sortKey:Z};x.push(ne)}a&&x.sort((P,R)=>P.sortKey-R.sortKey);const{lineAtlas:C,featureIndex:k}=i,M=this.addConstantDashes(C);for(const P of x){const{geometry:R,index:$,sourceLayerIndex:G}=P;if(M&&this.addFeatureDashes(P,C),this.hasPattern){const J=Gp("line",this.layers,P,this.zoom,this.pixelRatio,i);this.patternFeatures.push(J)}else this.addFeature(P,R,$,o,C.positions,i.availableImages,i.brightness);k.insert(e[$].feature,R,$,G,this.index)}}addConstantDashes(e){let i=!1;for(const o of this.layers){const p=o.paint.get("line-dasharray").value,a=o.layout.get("line-cap").value;if(p.kind!=="constant"||a.kind!=="constant")i=!0;else{const f=a.value,w=p.value;if(!w)continue;e.addDash(w,f)}}return i}addFeatureDashes(e,i){const o=this.zoom;for(const p of this.layers){const a=p.paint.get("line-dasharray").value,f=p.layout.get("line-cap").value;if(a.kind==="constant"&&f.kind==="constant")continue;let w,E;if(a.kind==="constant"){if(w=a.value,!w)continue}else w=a.evaluate({zoom:o},e);E=f.kind==="constant"?f.value:f.evaluate({zoom:o},e),i.addDash(w,E),e.patterns[p.id]=i.getKey(w,E)}}update(e,i,o,p,a,f,w){this.programConfigurations.updatePaintArrays(e,i,a,o,p,f,w)}addFeatures(e,i,o,p,a,f){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,i,o,p,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,NM)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,UM)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,zM.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,FM),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,p,a,f,w){const E=this.layers[0].layout,O=E.get("line-join").evaluate(e,{}),x=E.get("line-cap").evaluate(e,{}),C=E.get("line-miter-limit"),k=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=E.get("line-z-offset").value;const M=this.layers[0].paint.get("line-width").value;M.kind!=="constant"&&M.isLineProgressConstant===!1&&(this.variableWidthValue=M);for(const P of i)this.addLine(P,e,p,O,x,C,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,a,f,p,w)}addLine(e,i,o,p,a,f,w){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const E=p==="none";if(this.patternJoinNone=this.hasPattern&&E,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<e.length-1;ee++)this.totalDistance+=e[ee].dist(e[ee+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const O=jM[i.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let C=0;for(;C<x-1&&e[C].equals(e[C+1]);)C++;if(x<(O?3:2))return;p==="bevel"&&(f=1.05);const k=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let M,P,R,$,G,J;this.e1=this.e2=-1,O&&(M=e[x-2],G=e[C].sub(M)._unit()._perp());for(let ee=C;ee<x;ee++){if(R=ee===x-1?O?e[C+1]:void 0:e[ee+1],R&&e[ee].equals(R))continue;G&&($=G),M&&(P=M),M=e[ee],J=this.evaluateLineProgressFeatures(P?P.dist(M):0),G=R?R.sub(M)._unit()._perp():$,$=$||G;const Z=P&&R;let ne=Z?p:O||E?"butt":a;const le=$.x*G.x+$.y*G.y;if(E){const Xe=function(qe){if(qe.patternJoinNone){const et=qe.segmentPoints.length/2,nt=qe.lineSoFar-qe.segmentStart;for(let ct=0;ct<et;++ct){const it=qe.segmentPoints[2*ct+1],Ct=Math.round(qe.segmentPoints[2*ct])+.5+.25*it;qe.patternVertexArray.emplaceBack(Ct,nt,qe.segmentStart),qe.patternVertexArray.emplaceBack(Ct,nt,qe.segmentStart)}qe.segmentPoints.length=0}qe.e1=qe.e2=-1};if(Z&&le<GM){this.updateDistance(P,M),this.addCurrentVertex(M,$,1,1,k,J),Xe(this),this.addCurrentVertex(M,G,-1,-1,k,J);continue}if(P){if(!R){this.updateDistance(P,M),this.addCurrentVertex(M,$,1,1,k,J),Xe(this);continue}ne="miter"}}let fe=$.add(G);fe.x===0&&fe.y===0||fe._unit();const Ce=fe.x*G.x+fe.y*G.y,Ee=Ce!==0?1/Ce:1/0,Me=2*Math.sqrt(2-2*Ce),$e=Ce<$M&&P&&R,De=$.x*G.y-$.y*G.x>0,Ge=this.overscaling<=16?15*ei/(512*this.overscaling):0;if(Z&&ne==="round"){if(Ee<w)ne="miter";else if(Ee<=2){const Xe=W0(M,-10,ei+10);ne=this.hasZOffset&&(Xe||this.hasCrossSlope)?"miter":"fakeround"}}if(ne==="miter"&&Ee>f&&(ne="bevel"),ne==="bevel"&&(Ee>2&&(ne="flipbevel"),Ee<f&&(ne="miter")),P&&!(ne==="miter"&&$e)&&this.updateDistance(P,M),ne==="miter")if($e){const Xe=M.dist(P);if(Xe>2*Ge){const et=M.sub(M.sub(P)._mult(Ge/Xe)._round());this.updateDistance(P,et),this.addCurrentVertex(et,$,0,0,k,J),P=et}this.updateDistance(P,M),fe._mult(Ee),this.addCurrentVertex(M,fe,0,0,k,J);const qe=M.dist(R);if(qe>2*Ge){const et=M.add(R.sub(M)._mult(Ge/qe)._round());this.updateDistance(M,et),this.addCurrentVertex(et,G,0,0,k,J),M=et}}else fe._mult(Ee),this.addCurrentVertex(M,fe,0,0,k,J);else if(ne==="flipbevel"){if(Ee>100)fe=G.mult(-1);else{const Xe=Ee*$.add(G).mag()/$.sub(G).mag();fe._perp()._mult(Xe*(De?-1:1))}this.addCurrentVertex(M,fe,0,0,k,J),this.addCurrentVertex(M,fe.mult(-1),0,0,k,J)}else if(ne==="bevel"||ne==="fakeround"){J!=null&&P&&this.addCurrentVertex(M,$,-1,-1,k,J);const Xe=M.dist(P)<=2*Ge&&ne!=="bevel",qe=fe.mult(De?1:-1);qe._mult(Ee);const et=G.mult(De?-1:1),nt=$.mult(De?-1:1),ct=this.evaluateLineProgressFeatures(this.distance);if(J==null&&(this.addHalfVertex(M,qe.x,qe.y,!1,!De,0,k,ct),Xe||this.addHalfVertex(M,qe.x+2*nt.x,qe.y+2*nt.y,!1,De,0,k,ct)),ne==="fakeround"){const it=Math.round(180*Me/Math.PI/20);this.addHalfVertex(M,nt.x,nt.y,!1,De,0,k,ct);for(let Ct=0;Ct<it;Ct++){let Nt=Ct/it;if(Nt!==.5){const si=Nt-.5;Nt+=Nt*si*(Nt-1)*((1.0904+le*(le*(3.55645-1.43519*le)-3.2452))*si*si+(.848013+le*(.215638*le-1.06021)))}const Et=et.sub(nt)._mult(Nt)._add(nt)._unit();this.addHalfVertex(M,Et.x,Et.y,!1,De,0,k,ct)}this.addHalfVertex(M,et.x,et.y,!1,De,0,k,ct)}Xe||J!=null||this.addHalfVertex(M,qe.x+2*et.x,qe.y+2*et.y,!1,De,0,k,ct),J!=null&&R&&this.addCurrentVertex(M,G,1,1,k,J)}else ne==="butt"?this.addCurrentVertex(M,fe,0,0,k,J):ne==="square"?(P||this.addCurrentVertex(M,fe,-1,-1,k,J),this.addCurrentVertex(M,fe,0,0,k,J),P&&this.addCurrentVertex(M,fe,1,1,k,J)):ne==="round"&&(P&&(this.addCurrentVertex(M,$,0,0,k,J),this.addCurrentVertex(M,$,1,1,k,J,!0)),R&&(this.addCurrentVertex(M,G,-1,-1,k,J,!0),this.addCurrentVertex(M,G,0,0,k,J)))}}addVerticesTo(e,i,o,p,a,f,w,E,O,x){const C=(i.w-e.w)/this.tessellationStep|0;let k=0;const M=this.scaledDistance;if(C>1){this.lineSoFar=e.w;const R=(i.x-e.x)/C,$=(i.y-e.y)/C,G=(i.z-e.z)/C,J=(i.w-e.w)/C;for(let ee=1;ee<C;++ee){e.x+=R,e.y+=$,e.z+=G,this.lineSoFar+=J,k+=J;const Z=this.evaluateLineProgressFeatures(this.prevDistance+k);this.scaledDistance=(this.prevDistance+k)/this.totalDistance,this.addHalfVertex(e,o,p,x,!1,w,O,Z),this.addHalfVertex(e,a,f,x,!0,-E,O,Z)}}this.lineSoFar=i.w,this.scaledDistance=M;const P=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,o,p,x,!1,w,O,P),this.addHalfVertex(i,a,f,x,!0,-E,O,P)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):qi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}:{zOffset:0,variableWidth:i}}addCurrentVertex(e,i,o,p,a,f,w=!1){const E=i.x+i.y*o,O=i.y-i.x*o,x=i.y*p-i.x,C=-i.y-i.x*p;if(f!=null){const k=this.hasZOffset,M=-10,P=ei+10,R=f.zOffset,$=new ze(e.x,e.y,R,this.lineSoFar),G=!!k&&W0(e,M,P),J=this.lineSoFar,ee=this.distance;if(this.currentVertex)if(G){const Z=this.currentVertexIsOutside,ne=this.currentVertex,le=new ze(e.x,e.y,R,this.lineSoFar);if(St(ne,le,M,P),!W0(le,M,P)){if(Z){this.e1=this.e2=-1,this.distance-=ne.dist($),this.lineSoFar=ne.w;const fe=this.evaluateLineProgressFeatures(ne.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ne,E,O,w,!1,o,a,fe),this.addHalfVertex(ne,x,C,w,!0,-p,a,fe),this.prevDistance=this.distance}this.distance=this.prevDistance+ne.dist(le),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ne,le,E,O,x,C,o,p,a,w),this.distance=ee,this.scaledDistance=this.distance/this.totalDistance}}else{const Z=this.currentVertex;if(this.currentVertexIsOutside){St(Z,$,M,P),this.e1=this.e2=-1,this.distance-=Z.dist($),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Z.w;const ne=this.evaluateLineProgressFeatures(Z.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Z,E,O,w,!1,o,a,ne),this.addHalfVertex(Z,x,C,w,!0,-p,a,ne),this.prevDistance=this.distance,this.distance=ee,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Z,$,E,O,x,C,o,p,a,w)}else G||(this.addHalfVertex(e,E,O,w,!1,o,a,f),this.addHalfVertex(e,x,C,w,!0,-p,a,f));this.currentVertex=$,this.currentVertexIsOutside=G,this.lineSoFar=J}else this.addHalfVertex(e,E,O,w,!1,o,a,f),this.addHalfVertex(e,x,C,w,!0,-p,a,f)}addHalfVertex({x:e,y:i},o,p,a,f,w,E,O){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),f||this.segmentPoints.push(this.lineSoFar-this.segmentStart,w)),this.layoutVertexArray.emplaceBack((e<<1)+(a?1:0),(i<<1)+(f?1:0),Math.round(63*o)+128,Math.round(63*p)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const C=Ii(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,C)}const x=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),E.primitiveLength++),f?this.e2=x:this.e1=x,O!=null&&this.zOffsetVertexArray.emplaceBack(O.zOffset,O.variableWidth,O.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function W0(s,e,i){return s.x<e||s.x>i||s.y<e||s.y>i}let Mb,Eb;function Cb(s,e,i){return e*(ei/(s.tileSize*Math.pow(2,i-s.tileID.overscaledZ)))}_i(H0,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Ab=(s,e,i)=>(1-i)*s+i*e;function Pb(s,e){return 1/Cb(s,1,e.tileZoom)}function Ib(s,e,i,o){return s.translatePosMatrix(o||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Db=s=>{const e=[];kb(s)&&e.push("RENDER_LINE_DASH"),s.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=s.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),s.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const o=s.layout.get("line-join").constantOr("miter")==="none",p=!!s.paint.get("line-pattern").constantOr(1);return o&&p&&e.push("LINE_JOIN_NONE"),e};function kb(s){const e=s.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let q0;const Ob=()=>q0||(q0={layout:Mb||(Mb=new on({"line-cap":new li(dt.layout_line["line-cap"]),"line-join":new li(dt.layout_line["line-join"]),"line-miter-limit":new Ht(dt.layout_line["line-miter-limit"]),"line-round-limit":new Ht(dt.layout_line["line-round-limit"]),"line-sort-key":new li(dt.layout_line["line-sort-key"]),"line-z-offset":new li(dt.layout_line["line-z-offset"]),"line-elevation-reference":new Ht(dt.layout_line["line-elevation-reference"]),"line-cross-slope":new Ht(dt.layout_line["line-cross-slope"]),visibility:new Ht(dt.layout_line.visibility),"line-width-unit":new Ht(dt.layout_line["line-width-unit"])})),paint:Eb||(Eb=new on({"line-opacity":new li(dt.paint_line["line-opacity"]),"line-color":new li(dt.paint_line["line-color"]),"line-translate":new Ht(dt.paint_line["line-translate"]),"line-translate-anchor":new Ht(dt.paint_line["line-translate-anchor"]),"line-width":new li(dt.paint_line["line-width"]),"line-gap-width":new li(dt.paint_line["line-gap-width"]),"line-offset":new li(dt.paint_line["line-offset"]),"line-blur":new li(dt.paint_line["line-blur"]),"line-dasharray":new li(dt.paint_line["line-dasharray"]),"line-pattern":new li(dt.paint_line["line-pattern"]),"line-gradient":new Ka(dt.paint_line["line-gradient"]),"line-trim-offset":new Ht(dt.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ht(dt.paint_line["line-trim-fade-range"]),"line-trim-color":new Ht(dt.paint_line["line-trim-color"]),"line-emissive-strength":new Ht(dt.paint_line["line-emissive-strength"]),"line-border-width":new li(dt.paint_line["line-border-width"]),"line-border-color":new li(dt.paint_line["line-border-color"]),"line-occlusion-opacity":new Ht(dt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},q0);class HM extends li{possiblyEvaluate(e,i){return i=new Vr(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,p){return i=Zs({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,p)}}let ag;function Lb(s,e){return e>0?e+2*s:s}const WM=Ir([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),qM=Ir([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),YM=Ir([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ir([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const XM=Ir([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),ZM=Ir([{name:"a_texb",components:2,type:"Uint16"}]),KM=Ir([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),JM=Ir([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Ir([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Rb=Ir([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),QM=Ir([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ir([{name:"triangle",components:3,type:"Uint16"}]),Ir([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ir([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Ir([{type:"Float32",name:"offsetX"}]),Ir([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var po=24;const Ic=128;function Y0(s,e,i,o,p){if(s.kind==="camera")return s.maxSize;if(s.kind==="composite"){const a=e.possiblyEvaluate(new Vr(s.maxZoom),i).evaluate(p,{},i),f=e.possiblyEvaluate(new Vr(s.minZoom),i).evaluate(p,{},i);return Math.max(a,f)}return e.possiblyEvaluate(new Vr(o)).evaluate(p,{},i)}function X0(s,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Vr(s+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:p}=i;let a=0;for(;a<o.length&&o[a]<=s;)a++;a=Math.max(0,a-1);let f=a;for(;f<o.length&&o[f]<s+1;)f++;f=Math.min(o.length-1,f);const w=o[a],E=o[f];return i.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:E,interpolationType:p}:{kind:"camera",minZoom:w,maxZoom:E,minSize:i.evaluate(new Vr(w)),maxSize:i.evaluate(new Vr(E)),interpolationType:p}}}function I_(s,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:p}){return s.kind==="source"?o/Ic:s.kind==="composite"?Ii(o/Ic,p/Ic,i):e}function tm(s,e,i=1){let o=0,p=0;if(s.kind==="constant")p=s.layoutSize*i;else if(s.kind!=="source"){const{interpolationType:a,minZoom:f,maxZoom:w}=s,E=a?nr(vo.interpolationFactor(a,e,f,w),0,1):0;s.kind==="camera"?p=Ii(s.minSize,s.maxSize,E)*i:o=E*i}return{uSizeT:o,uSize:p}}var eE=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ic,evaluateSizeForFeature:I_,evaluateSizeForZoom:tm,getRasterizedIconSize:Y0,getSizeData:X0});function tE(s,e,i){return s.sections.forEach(o=>{o.text=function(p,a,f){const w=a.layout.get("text-transform").evaluate(f,{});return w==="uppercase"?p=p.toLocaleUpperCase():w==="lowercase"&&(p=p.toLocaleLowerCase()),Qs.applyArabicShaping&&(p=Qs.applyArabicShaping(p)),p}(o.text,e,i)}),s}const lg={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function iE(s){return s==="︶"||s==="﹈"||s==="︸"||s==="﹄"||s==="﹂"||s==="︾"||s==="︼"||s==="︺"||s==="︘"||s==="﹀"||s==="︐"||s==="︓"||s==="︔"||s==="｀"||s==="￣"||s==="︑"||s==="︒"}function rE(s){return s==="︵"||s==="﹇"||s==="︷"||s==="﹃"||s==="﹁"||s==="︽"||s==="︻"||s==="︹"||s==="︗"||s==="︿"}var zb,Z0,Fb,K0={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function nE(){return zb||(zb=1,K0.read=function(s,e,i,o,p){var a,f,w=8*p-o-1,E=(1<<w)-1,O=E>>1,x=-7,C=i?p-1:0,k=i?-1:1,M=s[e+C];for(C+=k,a=M&(1<<-x)-1,M>>=-x,x+=w;x>0;a=256*a+s[e+C],C+=k,x-=8);for(f=a&(1<<-x)-1,a>>=-x,x+=o;x>0;f=256*f+s[e+C],C+=k,x-=8);if(a===0)a=1-O;else{if(a===E)return f?NaN:1/0*(M?-1:1);f+=Math.pow(2,o),a-=O}return(M?-1:1)*f*Math.pow(2,a-o)},K0.write=function(s,e,i,o,p,a){var f,w,E,O=8*a-p-1,x=(1<<O)-1,C=x>>1,k=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,M=o?0:a-1,P=o?1:-1,R=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(w=isNaN(e)?1:0,f=x):(f=Math.floor(Math.log(e)/Math.LN2),e*(E=Math.pow(2,-f))<1&&(f--,E*=2),(e+=f+C>=1?k/E:k*Math.pow(2,1-C))*E>=2&&(f++,E/=2),f+C>=x?(w=0,f=x):f+C>=1?(w=(e*E-1)*Math.pow(2,p),f+=C):(w=e*Math.pow(2,C-1)*Math.pow(2,p),f=0));p>=8;s[i+M]=255&w,M+=P,w/=256,p-=8);for(f=f<<p|w,O+=p;O>0;s[i+M]=255&f,M+=P,f/=256,O-=8);s[i+M-P]|=128*R}),K0}function Bb(){if(Fb)return Z0;Fb=1,Z0=e;var s=nE();function e(Z){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(Z)?Z:new Uint8Array(Z||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,o=1/i,p=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function a(Z){return Z.type===e.Bytes?Z.readVarint()+Z.pos:Z.pos+1}function f(Z,ne,le){return le?4294967296*ne+(Z>>>0):4294967296*(ne>>>0)+(Z>>>0)}function w(Z,ne,le){var fe=ne<=16383?1:ne<=2097151?2:ne<=268435455?3:Math.floor(Math.log(ne)/(7*Math.LN2));le.realloc(fe);for(var Ce=le.pos-1;Ce>=Z;Ce--)le.buf[Ce+fe]=le.buf[Ce]}function E(Z,ne){for(var le=0;le<Z.length;le++)ne.writeVarint(Z[le])}function O(Z,ne){for(var le=0;le<Z.length;le++)ne.writeSVarint(Z[le])}function x(Z,ne){for(var le=0;le<Z.length;le++)ne.writeFloat(Z[le])}function C(Z,ne){for(var le=0;le<Z.length;le++)ne.writeDouble(Z[le])}function k(Z,ne){for(var le=0;le<Z.length;le++)ne.writeBoolean(Z[le])}function M(Z,ne){for(var le=0;le<Z.length;le++)ne.writeFixed32(Z[le])}function P(Z,ne){for(var le=0;le<Z.length;le++)ne.writeSFixed32(Z[le])}function R(Z,ne){for(var le=0;le<Z.length;le++)ne.writeFixed64(Z[le])}function $(Z,ne){for(var le=0;le<Z.length;le++)ne.writeSFixed64(Z[le])}function G(Z,ne){return(Z[ne]|Z[ne+1]<<8|Z[ne+2]<<16)+16777216*Z[ne+3]}function J(Z,ne,le){Z[le]=ne,Z[le+1]=ne>>>8,Z[le+2]=ne>>>16,Z[le+3]=ne>>>24}function ee(Z,ne){return(Z[ne]|Z[ne+1]<<8|Z[ne+2]<<16)+(Z[ne+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(Z,ne,le){for(le=le||this.length;this.pos<le;){var fe=this.readVarint(),Ce=fe>>3,Ee=this.pos;this.type=7&fe,Z(Ce,ne,this),this.pos===Ee&&this.skip(fe)}return ne},readMessage:function(Z,ne){return this.readFields(Z,ne,this.readVarint()+this.pos)},readFixed32:function(){var Z=G(this.buf,this.pos);return this.pos+=4,Z},readSFixed32:function(){var Z=ee(this.buf,this.pos);return this.pos+=4,Z},readFixed64:function(){var Z=G(this.buf,this.pos)+G(this.buf,this.pos+4)*i;return this.pos+=8,Z},readSFixed64:function(){var Z=G(this.buf,this.pos)+ee(this.buf,this.pos+4)*i;return this.pos+=8,Z},readFloat:function(){var Z=s.read(this.buf,this.pos,!0,23,4);return this.pos+=4,Z},readDouble:function(){var Z=s.read(this.buf,this.pos,!0,52,8);return this.pos+=8,Z},readVarint:function(Z){var ne,le,fe=this.buf;return ne=127&(le=fe[this.pos++]),le<128?ne:(ne|=(127&(le=fe[this.pos++]))<<7,le<128?ne:(ne|=(127&(le=fe[this.pos++]))<<14,le<128?ne:(ne|=(127&(le=fe[this.pos++]))<<21,le<128?ne:function(Ce,Ee,Me){var $e,De,Ge=Me.buf;if($e=(112&(De=Ge[Me.pos++]))>>4,De<128||($e|=(127&(De=Ge[Me.pos++]))<<3,De<128)||($e|=(127&(De=Ge[Me.pos++]))<<10,De<128)||($e|=(127&(De=Ge[Me.pos++]))<<17,De<128)||($e|=(127&(De=Ge[Me.pos++]))<<24,De<128)||($e|=(1&(De=Ge[Me.pos++]))<<31,De<128))return f(Ce,$e,Ee);throw new Error("Expected varint not more than 10 bytes")}(ne|=(15&(le=fe[this.pos]))<<28,Z,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var Z=this.readVarint();return Z%2==1?(Z+1)/-2:Z/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var Z=this.readVarint()+this.pos,ne=this.pos;return this.pos=Z,Z-ne>=12&&p?function(le,fe,Ce){return p.decode(le.subarray(fe,Ce))}(this.buf,ne,Z):function(le,fe,Ce){for(var Ee="",Me=fe;Me<Ce;){var $e,De,Ge,Xe=le[Me],qe=null,et=Xe>239?4:Xe>223?3:Xe>191?2:1;if(Me+et>Ce)break;et===1?Xe<128&&(qe=Xe):et===2?(192&($e=le[Me+1]))==128&&(qe=(31&Xe)<<6|63&$e)<=127&&(qe=null):et===3?(De=le[Me+2],(192&($e=le[Me+1]))==128&&(192&De)==128&&((qe=(15&Xe)<<12|(63&$e)<<6|63&De)<=2047||qe>=55296&&qe<=57343)&&(qe=null)):et===4&&(De=le[Me+2],Ge=le[Me+3],(192&($e=le[Me+1]))==128&&(192&De)==128&&(192&Ge)==128&&((qe=(15&Xe)<<18|(63&$e)<<12|(63&De)<<6|63&Ge)<=65535||qe>=1114112)&&(qe=null)),qe===null?(qe=65533,et=1):qe>65535&&(qe-=65536,Ee+=String.fromCharCode(qe>>>10&1023|55296),qe=56320|1023&qe),Ee+=String.fromCharCode(qe),Me+=et}return Ee}(this.buf,ne,Z)},readBytes:function(){var Z=this.readVarint()+this.pos,ne=this.buf.subarray(this.pos,Z);return this.pos=Z,ne},readPackedVarint:function(Z,ne){if(this.type!==e.Bytes)return Z.push(this.readVarint(ne));var le=a(this);for(Z=Z||[];this.pos<le;)Z.push(this.readVarint(ne));return Z},readPackedSVarint:function(Z){if(this.type!==e.Bytes)return Z.push(this.readSVarint());var ne=a(this);for(Z=Z||[];this.pos<ne;)Z.push(this.readSVarint());return Z},readPackedBoolean:function(Z){if(this.type!==e.Bytes)return Z.push(this.readBoolean());var ne=a(this);for(Z=Z||[];this.pos<ne;)Z.push(this.readBoolean());return Z},readPackedFloat:function(Z){if(this.type!==e.Bytes)return Z.push(this.readFloat());var ne=a(this);for(Z=Z||[];this.pos<ne;)Z.push(this.readFloat());return Z},readPackedDouble:function(Z){if(this.type!==e.Bytes)return Z.push(this.readDouble());var ne=a(this);for(Z=Z||[];this.pos<ne;)Z.push(this.readDouble());return Z},readPackedFixed32:function(Z){if(this.type!==e.Bytes)return Z.push(this.readFixed32());var ne=a(this);for(Z=Z||[];this.pos<ne;)Z.push(this.readFixed32());return Z},readPackedSFixed32:function(Z){if(this.type!==e.Bytes)return Z.push(this.readSFixed32());var ne=a(this);for(Z=Z||[];this.pos<ne;)Z.push(this.readSFixed32());return Z},readPackedFixed64:function(Z){if(this.type!==e.Bytes)return Z.push(this.readFixed64());var ne=a(this);for(Z=Z||[];this.pos<ne;)Z.push(this.readFixed64());return Z},readPackedSFixed64:function(Z){if(this.type!==e.Bytes)return Z.push(this.readSFixed64());var ne=a(this);for(Z=Z||[];this.pos<ne;)Z.push(this.readSFixed64());return Z},skip:function(Z){var ne=7&Z;if(ne===e.Varint)for(;this.buf[this.pos++]>127;);else if(ne===e.Bytes)this.pos=this.readVarint()+this.pos;else if(ne===e.Fixed32)this.pos+=4;else{if(ne!==e.Fixed64)throw new Error("Unimplemented type: "+ne);this.pos+=8}},writeTag:function(Z,ne){this.writeVarint(Z<<3|ne)},realloc:function(Z){for(var ne=this.length||16;ne<this.pos+Z;)ne*=2;if(ne!==this.length){var le=new Uint8Array(ne);le.set(this.buf),this.buf=le,this.length=ne}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(Z){this.realloc(4),J(this.buf,Z,this.pos),this.pos+=4},writeSFixed32:function(Z){this.realloc(4),J(this.buf,Z,this.pos),this.pos+=4},writeFixed64:function(Z){this.realloc(8),J(this.buf,-1&Z,this.pos),J(this.buf,Math.floor(Z*o),this.pos+4),this.pos+=8},writeSFixed64:function(Z){this.realloc(8),J(this.buf,-1&Z,this.pos),J(this.buf,Math.floor(Z*o),this.pos+4),this.pos+=8},writeVarint:function(Z){(Z=+Z||0)>268435455||Z<0?function(ne,le){var fe,Ce;if(ne>=0?(fe=ne%4294967296|0,Ce=ne/4294967296|0):(Ce=~(-ne/4294967296),4294967295^(fe=~(-ne%4294967296))?fe=fe+1|0:(fe=0,Ce=Ce+1|0)),ne>=18446744073709552e3||ne<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");le.realloc(10),function(Ee,Me,$e){$e.buf[$e.pos++]=127&Ee|128,Ee>>>=7,$e.buf[$e.pos++]=127&Ee|128,Ee>>>=7,$e.buf[$e.pos++]=127&Ee|128,Ee>>>=7,$e.buf[$e.pos++]=127&Ee|128,$e.buf[$e.pos]=127&(Ee>>>=7)}(fe,0,le),function(Ee,Me){var $e=(7&Ee)<<4;Me.buf[Me.pos++]|=$e|((Ee>>>=3)?128:0),Ee&&(Me.buf[Me.pos++]=127&Ee|((Ee>>>=7)?128:0),Ee&&(Me.buf[Me.pos++]=127&Ee|((Ee>>>=7)?128:0),Ee&&(Me.buf[Me.pos++]=127&Ee|((Ee>>>=7)?128:0),Ee&&(Me.buf[Me.pos++]=127&Ee|((Ee>>>=7)?128:0),Ee&&(Me.buf[Me.pos++]=127&Ee)))))}(Ce,le)}(Z,this):(this.realloc(4),this.buf[this.pos++]=127&Z|(Z>127?128:0),Z<=127||(this.buf[this.pos++]=127&(Z>>>=7)|(Z>127?128:0),Z<=127||(this.buf[this.pos++]=127&(Z>>>=7)|(Z>127?128:0),Z<=127||(this.buf[this.pos++]=Z>>>7&127))))},writeSVarint:function(Z){this.writeVarint(Z<0?2*-Z-1:2*Z)},writeBoolean:function(Z){this.writeVarint(!!Z)},writeString:function(Z){Z=String(Z),this.realloc(4*Z.length),this.pos++;var ne=this.pos;this.pos=function(fe,Ce,Ee){for(var Me,$e,De=0;De<Ce.length;De++){if((Me=Ce.charCodeAt(De))>55295&&Me<57344){if(!$e){Me>56319||De+1===Ce.length?(fe[Ee++]=239,fe[Ee++]=191,fe[Ee++]=189):$e=Me;continue}if(Me<56320){fe[Ee++]=239,fe[Ee++]=191,fe[Ee++]=189,$e=Me;continue}Me=$e-55296<<10|Me-56320|65536,$e=null}else $e&&(fe[Ee++]=239,fe[Ee++]=191,fe[Ee++]=189,$e=null);Me<128?fe[Ee++]=Me:(Me<2048?fe[Ee++]=Me>>6|192:(Me<65536?fe[Ee++]=Me>>12|224:(fe[Ee++]=Me>>18|240,fe[Ee++]=Me>>12&63|128),fe[Ee++]=Me>>6&63|128),fe[Ee++]=63&Me|128)}return Ee}(this.buf,Z,this.pos);var le=this.pos-ne;le>=128&&w(ne,le,this),this.pos=ne-1,this.writeVarint(le),this.pos+=le},writeFloat:function(Z){this.realloc(4),s.write(this.buf,Z,this.pos,!0,23,4),this.pos+=4},writeDouble:function(Z){this.realloc(8),s.write(this.buf,Z,this.pos,!0,52,8),this.pos+=8},writeBytes:function(Z){var ne=Z.length;this.writeVarint(ne),this.realloc(ne);for(var le=0;le<ne;le++)this.buf[this.pos++]=Z[le]},writeRawMessage:function(Z,ne){this.pos++;var le=this.pos;Z(ne,this);var fe=this.pos-le;fe>=128&&w(le,fe,this),this.pos=le-1,this.writeVarint(fe),this.pos+=fe},writeMessage:function(Z,ne,le){this.writeTag(Z,e.Bytes),this.writeRawMessage(ne,le)},writePackedVarint:function(Z,ne){ne.length&&this.writeMessage(Z,E,ne)},writePackedSVarint:function(Z,ne){ne.length&&this.writeMessage(Z,O,ne)},writePackedBoolean:function(Z,ne){ne.length&&this.writeMessage(Z,k,ne)},writePackedFloat:function(Z,ne){ne.length&&this.writeMessage(Z,x,ne)},writePackedDouble:function(Z,ne){ne.length&&this.writeMessage(Z,C,ne)},writePackedFixed32:function(Z,ne){ne.length&&this.writeMessage(Z,M,ne)},writePackedSFixed32:function(Z,ne){ne.length&&this.writeMessage(Z,P,ne)},writePackedFixed64:function(Z,ne){ne.length&&this.writeMessage(Z,R,ne)},writePackedSFixed64:function(Z,ne){ne.length&&this.writeMessage(Z,$,ne)},writeBytesField:function(Z,ne){this.writeTag(Z,e.Bytes),this.writeBytes(ne)},writeFixed32Field:function(Z,ne){this.writeTag(Z,e.Fixed32),this.writeFixed32(ne)},writeSFixed32Field:function(Z,ne){this.writeTag(Z,e.Fixed32),this.writeSFixed32(ne)},writeFixed64Field:function(Z,ne){this.writeTag(Z,e.Fixed64),this.writeFixed64(ne)},writeSFixed64Field:function(Z,ne){this.writeTag(Z,e.Fixed64),this.writeSFixed64(ne)},writeVarintField:function(Z,ne){this.writeTag(Z,e.Varint),this.writeVarint(ne)},writeSVarintField:function(Z,ne){this.writeTag(Z,e.Varint),this.writeSVarint(ne)},writeStringField:function(Z,ne){this.writeTag(Z,e.Bytes),this.writeString(ne)},writeFloatField:function(Z,ne){this.writeTag(Z,e.Fixed32),this.writeFloat(ne)},writeDoubleField:function(Z,ne){this.writeTag(Z,e.Fixed64),this.writeDouble(ne)},writeBooleanField:function(Z,ne){this.writeVarintField(Z,!!ne)}},Z0}var D_=q(Bb());const J0=3;function sE(s,e,i){e.glyphs=[],s===1&&i.readMessage(oE,e)}function oE(s,e,i){if(s===3){const{id:o,bitmap:p,width:a,height:f,left:w,top:E,advance:O}=i.readMessage(aE,{});e.glyphs.push({id:o,bitmap:new Vl({width:a+2*J0,height:f+2*J0},p),metrics:{width:a,height:f,left:w,top:E,advance:O}})}else s===4?e.ascender=i.readSVarint():s===5&&(e.descender=i.readSVarint())}function aE(s,e,i){s===1?e.id=i.readVarint():s===2?e.bitmap=i.readBytes():s===3?e.width=i.readVarint():s===4?e.height=i.readVarint():s===5?e.left=i.readSVarint():s===6?e.top=i.readSVarint():s===7&&(e.advance=i.readVarint())}const lE=J0,sl={horizontal:1,vertical:2,horizontalOnly:3};class cg{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const o=new cg;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new cg;return i.image=e,i}}class im{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const o=new im;for(let p=0;p<e.sections.length;p++){const a=e.sections[p];a.image?o.addImageSection(a):o.addTextSection(a,i)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,o){let p="";for(let a=0;a<i.length;a++){const f=i.charCodeAt(a+1)||null,w=i.charCodeAt(a-1)||null;p+=!o&&(f&&mp(f)&&!lg[i[a+1]]||w&&mp(w)&&!lg[i[a-1]])||!lg[i[a]]?i[a]:lg[i[a]]}return p}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&k_[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&k_[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new im;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(cg.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let p=0;p<e.text.length;++p)this.sectionIndex.push(o)}addImageSection(e){const i=e.image&&e.image.namePrimary?e.image.getPrimary():null;if(!i)return void qi("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push(cg.forImage(i)),this.sectionIndex.push(this.sections.length-1)):qi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Q0(s,e,i,o,p,a,f,w,E,O,x,C,k,M,P){const R=im.fromFeature(s,p);C===sl.vertical&&R.verticalizePunctuation(k);let $=[];const G=function(le,fe,Ce,Ee,Me,$e){if(!le)return[];const De=[],Ge=function(nt,ct,it,Ct,Nt,Et){let si=0;for(let ti=0;ti<nt.length();ti++){const Gt=nt.getSection(ti);si+=Nb(nt.getCodePoint(ti),Gt,Ct,Nt,ct,Et)}return si/Math.max(1,Math.ceil(si/it))}(le,fe,Ce,Ee,Me,$e),Xe=le.text.indexOf("​")>=0;let qe=0;for(let nt=0;nt<le.length();nt++){const ct=le.getSection(nt),it=le.getCodePoint(nt);if(k_[it]||(qe+=Nb(it,ct,Ee,Me,fe,$e)),nt<le.length()-1){const Ct=!((et=it)<11904||!(wi["Bopomofo Extended"](et)||wi.Bopomofo(et)||wi["CJK Compatibility Forms"](et)||wi["CJK Compatibility Ideographs"](et)||wi["CJK Compatibility"](et)||wi["CJK Radicals Supplement"](et)||wi["CJK Strokes"](et)||wi["CJK Symbols and Punctuation"](et)||wi["CJK Unified Ideographs Extension A"](et)||wi["CJK Unified Ideographs"](et)||wi["Enclosed CJK Letters and Months"](et)||wi["Halfwidth and Fullwidth Forms"](et)||wi.Hiragana(et)||wi["Ideographic Description Characters"](et)||wi["Kangxi Radicals"](et)||wi["Katakana Phonetic Extensions"](et)||wi.Katakana(et)||wi["Vertical Forms"](et)||wi["Yi Radicals"](et)||wi["Yi Syllables"](et)));(cE[it]||Ct||ct.image)&&De.push(Ub(nt+1,qe,Ge,De,uE(it,le.getCodePoint(nt+1),Ct&&Xe),!1))}}var et;return jb(Ub(le.length(),qe,Ge,De,0,!0))}(R,O,a,e,o,M),{processBidirectionalText:J,processStyledBidirectionalText:ee}=Qs;if(J&&R.sections.length===1){const le=J(R.toString(),G);for(const fe of le){const Ce=new im;Ce.text=fe,Ce.sections=R.sections;for(let Ee=0;Ee<fe.length;Ee++)Ce.sectionIndex.push(0);$.push(Ce)}}else if(ee){const le=ee(R.text,R.sectionIndex,G);for(const fe of le){const Ce=new im;Ce.text=fe[0],Ce.sectionIndex=fe[1],Ce.sections=R.sections,$.push(Ce)}}else $=function(le,fe){const Ce=[],Ee=le.text;let Me=0;for(const $e of fe)Ce.push(le.substring(Me,$e)),Me=$e;return Me<Ee.length&&Ce.push(le.substring(Me,Ee.length)),Ce}(R,G);const Z=[],ne={positionedLines:Z,text:R.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(le,fe,Ce,Ee,Me,$e,De,Ge,Xe,qe,et,nt){let ct=0,it=0,Ct=0;const Nt=Ge==="right"?1:Ge==="left"?0:.5;let Et=!1;for(const ui of Me){const fi=ui.getSections();for(const Ni of fi){if(Ni.image)continue;const Ki=fe[Ni.fontStack];if(Ki&&(Et=Ki.ascender!==void 0&&Ki.descender!==void 0,!Et))break}if(!Et)break}let si=0;for(const ui of Me){ui.trim();const fi=ui.getMaxScale(),Ni=(fi-1)*po,Ki={positionedGlyphs:[],lineOffset:0};le.positionedLines[si]=Ki;const er=Ki.positionedGlyphs;let tr=0;if(!ui.length()){it+=$e,++si;continue}let cr=0,ur=0;for(let Nr=0;Nr<ui.length();Nr++){const Gi=ui.getSection(Nr),Rr=ui.getSectionIndex(Nr),Fr=ui.getCodePoint(Nr);let hn=Gi.scale,Zn=null,hs=null,Kn=null,On=po,as=0;const _s=!(Xe===sl.horizontal||!et&&!ca(Fr)||et&&(k_[Fr]||(ti=Fr,wi.Arabic(ti)||wi["Arabic Supplement"](ti)||wi["Arabic Extended-A"](ti)||wi["Arabic Presentation Forms-A"](ti)||wi["Arabic Presentation Forms-B"](ti))));if(Gi.image){const fo=Ee[Gi.image.serialize()];if(!fo)continue;Kn=Gi.image.id,le.iconsInText=le.iconsInText||!0,hs=fo.paddedRect;const cn=fo.displaySize;hn=hn*po/nt,Zn={width:cn[0],height:cn[1],left:0,top:-3,advance:_s?cn[1]:cn[0],localGlyph:!1},as=Et?-Zn.height*hn:fi*po-17-cn[1]*hn,On=Zn.advance;const xa=(_s?cn[0]:cn[1])*hn-po*fi;xa>0&&xa>tr&&(tr=xa)}else{const fo=Ce[Gi.fontStack];if(!fo)continue;fo[Fr]&&(hs=fo[Fr]);const cn=fe[Gi.fontStack];if(!cn)continue;const xa=cn.glyphs[Fr];if(!xa)continue;if(Zn=xa.metrics,On=Fr!==8203?po:0,Et){const Rc=cn.ascender!==void 0?Math.abs(cn.ascender):0,jl=cn.descender!==void 0?Math.abs(cn.descender):0,$l=(Rc+jl)*hn;cr<$l&&(cr=$l,ur=(Rc-jl)/2*hn),as=-Rc*hn}else as=(fi-hn)*po-17}_s?(le.verticalizable=!0,er.push({glyph:Fr,imageName:Kn,x:ct,y:it+as,vertical:_s,scale:hn,localGlyph:Zn.localGlyph,fontStack:Gi.fontStack,sectionIndex:Rr,metrics:Zn,rect:hs}),ct+=On*hn+qe):(er.push({glyph:Fr,imageName:Kn,x:ct,y:it+as,vertical:_s,scale:hn,localGlyph:Zn.localGlyph,fontStack:Gi.fontStack,sectionIndex:Rr,metrics:Zn,rect:hs}),ct+=Zn.advance*hn+qe)}er.length!==0&&(Ct=Math.max(ct-qe,Ct),Et?$b(er,Nt,tr,ur,$e*fi/2):$b(er,Nt,tr,0,$e/2)),ct=0;const nn=$e*fi+tr;Ki.lineOffset=Math.max(tr,Ni),it+=nn,++si}var ti;const Gt=it,{horizontalAlign:Ut,verticalAlign:xi}=ev(De);(function(ui,fi,Ni,Ki,er,tr){const cr=(fi-Ni)*er,ur=-tr*Ki;for(const nn of ui)for(const Nr of nn.positionedGlyphs)Nr.x+=cr,Nr.y+=ur})(le.positionedLines,Nt,Ut,xi,Ct,Gt),le.top+=-xi*Gt,le.bottom=le.top+Gt,le.left+=-Ut*Ct,le.right=le.left+Ct,le.hasBaseline=Et}(ne,e,i,o,$,f,w,E,C,O,k,P),!function(le){for(const fe of le)if(fe.positionedGlyphs.length!==0)return!1;return!0}(Z)&&ne}const k_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},cE={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Nb(s,e,i,o,p,a){if(e.image){const f=o[e.image.serialize()];return f?f.displaySize[0]*e.scale*po/a+p:0}{const f=i[e.fontStack],w=f&&f.glyphs[s];return w?w.metrics.advance*e.scale+p:0}}function Vb(s,e,i,o){const p=Math.pow(s-e,2);return o?s<e?p/2:2*p:p+Math.abs(i)*i}function uE(s,e,i){let o=0;return s===10&&(o-=1e4),i&&(o+=150),s!==40&&s!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Ub(s,e,i,o,p,a){let f=null,w=Vb(e,i,p,a);for(const E of o){const O=Vb(e-E.x,i,p,a)+E.badness;O<=w&&(f=E,w=O)}return{index:s,x:e,priorBreak:f,badness:w}}function jb(s){return s?jb(s.priorBreak).concat(s.index):[]}function ev(s){let e=.5,i=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function $b(s,e,i,o,p){if(!(e||i||o||p))return;const a=s.length-1,f=s[a],w=(f.x+f.metrics.advance*f.scale)*e;for(let E=0;E<=a;E++)s[E].x-=w,s[E].y+=i+o+p}function hE(s,e,i,o){const{horizontalAlign:p,verticalAlign:a}=ev(o),f=i[0]-s.displaySize[0]*p,w=i[1]-s.displaySize[1]*a;return{imagePrimary:s,imageSecondary:e,top:w,bottom:w+s.displaySize[1],left:f,right:f+s.displaySize[0]}}function Gb(s,e,i,o,p,a){const f=s.imagePrimary;let w;if(f.content){const $=f.content,G=f.pixelRatio||1;w=[$[0]/G,$[1]/G,f.displaySize[0]-$[2]/G,f.displaySize[1]-$[3]/G]}const E=e.left*a,O=e.right*a;let x,C,k,M;i==="width"||i==="both"?(M=p[0]+E-o[3],C=p[0]+O+o[1]):(M=p[0]+(E+O-f.displaySize[0])/2,C=M+f.displaySize[0]);const P=e.top*a,R=e.bottom*a;return i==="height"||i==="both"?(x=p[1]+P-o[0],k=p[1]+R+o[2]):(x=p[1]+(P+R-f.displaySize[1])/2,k=x+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:x,right:C,bottom:k,left:M,collisionPadding:w}}class Sh extends Wt{constructor(e,i,o,p,a){super(e,i),this.angle=p,this.z=o,a!==void 0&&(this.segment=a)}clone(){return new Sh(this.x,this.y,this.z,this.angle,this.segment)}}function Hb(s,e,i,o,p){if(e.segment===void 0)return!0;let a=e,f=e.segment+1,w=0;for(;w>-i/2;){if(f--,f<0)return!1;w-=s[f].dist(a),a=s[f]}w+=s[f].dist(s[f+1]),f++;const E=[];let O=0;for(;w<i/2;){const x=s[f],C=s[f+1];if(!C)return!1;let k=s[f-1].angleTo(x)-x.angleTo(C);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:w,angleDelta:k}),O+=k;w-E[0].distance>o;)O-=E.shift().angleDelta;if(O>p)return!1;f++,w+=x.dist(C)}return!0}function Wb(s){let e=0;for(let i=0;i<s.length-1;i++)e+=s[i].dist(s[i+1]);return e}function qb(s,e,i){return s?.6*e*i:0}function Yb(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function dE(s,e,i,o,p,a){const f=qb(i,p,a),w=Yb(i,o)*a;let E=0;const O=Wb(s)/2;for(let x=0;x<s.length-1;x++){const C=s[x],k=s[x+1],M=C.dist(k);if(E+M>O){const P=(O-E)/M,R=Ii(C.x,k.x,P),$=Ii(C.y,k.y,P),G=new Sh(R,$,0,k.angleTo(C),x);return!f||Hb(s,G,w,f,e)?G:void 0}E+=M}}function pE(s,e,i,o,p,a,f,w,E){const O=qb(o,a,f),x=Yb(o,p),C=x*f,k=s[0].x===0||s[0].x===E||s[0].y===0||s[0].y===E;return e-C<e/4&&(e=C+e/4),Xb(s,k?e/2*w%e:(x/2+2*a)*f*w%e,e,O,i,C,k,!1,E)}function Xb(s,e,i,o,p,a,f,w,E){const O=a/2,x=Wb(s);let C=0,k=e-i,M=[];for(let P=0;P<s.length-1;P++){const R=s[P],$=s[P+1],G=R.dist($),J=$.angleTo(R);for(;k+i<C+G;){k+=i;const ee=(k-C)/G,Z=Ii(R.x,$.x,ee),ne=Ii(R.y,$.y,ee);if(Z>=0&&Z<E&&ne>=0&&ne<E&&k-O>=0&&k+O<=x){const le=new Sh(Z,ne,0,J,P);o&&!Hb(s,le,a,o,p)||M.push(le)}}C+=G}return w||M.length||f||(M=Xb(s,C/2,i,o,p,a,f,!0,E)),M}function Zb(s,e,i,o,p){const a=[];for(let f=0;f<s.length;f++){const w=s[f];let E;for(let O=0;O<w.length-1;O++){let x=w[O],C=w[O+1];x.x<e&&C.x<e||(x.x<e?x=new Wt(e,x.y+(e-x.x)/(C.x-x.x)*(C.y-x.y))._round():C.x<e&&(C=new Wt(e,x.y+(e-x.x)/(C.x-x.x)*(C.y-x.y))._round()),x.y<i&&C.y<i||(x.y<i?x=new Wt(x.x+(i-x.y)/(C.y-x.y)*(C.x-x.x),i)._round():C.y<i&&(C=new Wt(x.x+(i-x.y)/(C.y-x.y)*(C.x-x.x),i)._round()),x.x>=o&&C.x>=o||(x.x>=o?x=new Wt(o,x.y+(o-x.x)/(C.x-x.x)*(C.y-x.y))._round():C.x>=o&&(C=new Wt(o,x.y+(o-x.x)/(C.x-x.x)*(C.y-x.y))._round()),x.y>=p&&C.y>=p||(x.y>=p?x=new Wt(x.x+(p-x.y)/(C.y-x.y)*(C.x-x.x),p)._round():C.y>=p&&(C=new Wt(x.x+(p-x.y)/(C.y-x.y)*(C.x-x.x),p)._round()),E&&x.equals(E[E.length-1])||(E=[x],a.push(E)),E.push(C)))))}}return a}function Kb(s){let e=0,i=0;for(const f of s)e+=f.w*f.h,i=Math.max(i,f.w);s.sort((f,w)=>w.h-f.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let p=0,a=0;for(const f of s)for(let w=o.length-1;w>=0;w--){const E=o[w];if(!(f.w>E.w||f.h>E.h)){if(f.x=E.x,f.y=E.y,a=Math.max(a,f.y+f.h),p=Math.max(p,f.x+f.w),f.w===E.w&&f.h===E.h){const O=o.pop();w<o.length&&(o[w]=O)}else f.h===E.h?(E.x+=f.w,E.w-=f.w):f.w===E.w?(E.y+=f.h,E.h-=f.h):(o.push({x:E.x+f.w,y:E.y,w:E.w-f.w,h:f.h}),E.y+=f.h,E.h-=f.h);break}}return{w:p,h:a,fill:e/(p*a)||0}}_i(Sh,"Anchor");const ug=1;class hg{static getImagePositionScale(e,i,o){return i&&e&&e.options&&e.options.transform?{x:e.options.transform.a,y:e.options.transform.d}:{x:o,y:o}}constructor(e,{pixelRatio:i,version:o,stretchX:p,stretchY:a,content:f,sdf:w,usvg:E},O,x){this.paddedRect=e,this.pixelRatio=i,this.stretchX=p,this.stretchY=a,this.content=f,this.version=o,this.padding=O,this.sdf=w,this.scale=hg.getImagePositionScale(x,E,i)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}class Jb{constructor(e,i,o){const p={},a={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,p,ug,f),this.addImages(i,a,2,f);const{w,h:E}=Kb(f),O=new Fs({width:w||1,height:E||1});for(const x in e){const C=e[x],k=p[x].paddedRect;Fs.copy(C.data,O,{x:0,y:0},{x:k.x+ug,y:k.y+ug},C.data,o,C.sdf)}for(const x in i){const C=i[x],k=a[x].paddedRect;let M=a[x].padding;const P=k.x+M,R=k.y+M,$=C.data.width,G=C.data.height;M=M>1?M-1:M,Fs.copy(C.data,O,{x:0,y:0},{x:P,y:R},C.data,o),Fs.copy(C.data,O,{x:0,y:G-M},{x:P,y:R-M},{width:$,height:M},o),Fs.copy(C.data,O,{x:0,y:0},{x:P,y:R+G},{width:$,height:M},o),Fs.copy(C.data,O,{x:$-M,y:0},{x:P-M,y:R},{width:M,height:G},o),Fs.copy(C.data,O,{x:0,y:0},{x:P+$,y:R},{width:M,height:G},o),Fs.copy(C.data,O,{x:$-M,y:G-M},{x:P-M,y:R-M},{width:M,height:M},o),Fs.copy(C.data,O,{x:0,y:G-M},{x:P+$,y:R-M},{width:M,height:M},o),Fs.copy(C.data,O,{x:0,y:0},{x:P+$,y:R+G},{width:M,height:M},o),Fs.copy(C.data,O,{x:$-M,y:0},{x:P-M,y:R+G},{width:M,height:M},o)}this.lut=o,this.image=O,this.iconPositions=p,this.patternPositions=a}addImages(e,i,o,p){for(const a in e){const f=e[a],w={x:0,y:0,w:f.data.width+2*o,h:f.data.height+2*o};p.push(w);const E=yo.deserializeFromString(a);i[a]=new hg(w,f,o,E),f.hasRenderCallback&&this.haveRenderCallbacks.push(E.id)}}patchUpdatedImages(e,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>e.hasImage(p,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(const p in e.getUpdatedImages(o)){for(const a of Object.keys(this.iconPositions))yo.deserializeId(a)===p&&this.patchUpdatedImage(this.iconPositions[a],e.getImage(p,o),i);for(const a of Object.keys(this.patternPositions))yo.deserializeId(a)===p&&this.patchUpdatedImage(this.patternPositions[a],e.getImage(p,o),i)}}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[p,a]=e.tl,f=e.sdf;if(this.lut||f){const w={width:i.data.width,height:i.data.height},E=new Fs(w);Fs.copy(i.data,E,{x:0,y:0},{x:0,y:0},w,this.lut,f),o.update(E,{position:{x:p,y:a}})}else o.update(i.data,{position:{x:p,y:a}})}}_i(hg,"ImagePosition"),_i(Jb,"ImageAtlas");const O_=1e20;function Qb(s,e,i,o,p,a,f,w,E){for(let O=e;O<e+o;O++)e1(s,i*a+O,a,p,f,w,E);for(let O=i;O<i+p;O++)e1(s,O*a+e,1,o,f,w,E)}function e1(s,e,i,o,p,a,f){a[0]=0,f[0]=-1e20,f[1]=O_,p[0]=s[e];for(let w=1,E=0,O=0;w<o;w++){p[w]=s[e+w*i];const x=w*w;do{const C=a[E];O=(p[w]-p[C]+x-C*C)/(w-C)/2}while(O<=f[E]&&--E>-1);E++,a[E]=w,f[E]=O,f[E+1]=O_}for(let w=0,E=0;w<o;w++){for(;f[E+1]<w;)E++;const O=a[E],x=w-O;s[e+w*i]=p[O]+x*x}}const Dc=2,tv={none:0,ideographs:1,all:2};class rm{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,o){const p=[],a=this.urls[i]||ts.GLYPHS_URL;for(const f in e)for(const w of e[f])p.push({stack:f,id:w});dl(p,({stack:f,id:w},E)=>{let O=this.entries[f];O||(O=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=O.glyphs[w];if(x!==void 0)return void E(null,{stack:f,id:w,glyph:x});if(x=this._tinySDF(O,f,w),x)return O.glyphs[w]=x,void E(null,{stack:f,id:w,glyph:x});const C=Math.floor(w/256);if(256*C>65535)return qi("glyphs > 65535 not supported"),void E(null,{stack:f,id:w,glyph:x});if(O.ranges[C])return void E(null,{stack:f,id:w,glyph:x});let k=O.requests[C];k||(k=O.requests[C]=[],rm.loadGlyphRange(f,C,a,this.requestManager,(M,P)=>{if(P){O.ascender=P.ascender,O.descender=P.descender;for(const R in P.glyphs)this._doesCharSupportLocalGlyph(+R)||(O.glyphs[+R]=P.glyphs[+R]);O.ranges[C]=!0}for(const R of k)R(M,P);delete O.requests[C]})),k.push((M,P)=>{M?E(M):P&&E(null,{stack:f,id:w,glyph:P.glyphs[w]||null})})},(f,w)=>{if(f)o(f);else if(w){const E={};for(const{stack:O,id:x,glyph:C}of w)E[O]===void 0&&(E[O]={}),E[O].glyphs===void 0&&(E[O].glyphs={}),E[O].glyphs[x]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics},E[O].ascender=this.entries[O].ascender,E[O].descender=this.entries[O].descender;o(null,E)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==tv.none&&(this.localGlyphMode===tv.all?!!this.localFontFamily:!!this.localFontFamily&&(wi["CJK Unified Ideographs"](e)||wi["Hangul Syllables"](e)||wi.Hiragana(e)||wi.Katakana(e)||wi["CJK Symbols and Punctuation"](e)||wi["CJK Unified Ideographs Extension A"](e)||wi["CJK Unified Ideographs Extension B"](e)||wi.Osage(e)))}_tinySDF(e,i,o){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(o))return;let a=e.tinySDF;if(!a){let R="400";/bold/i.test(i)?R="900":/medium/i.test(i)?R="500":/light/i.test(i)&&(R="200"),a=e.tinySDF=new rm.TinySDF({fontFamily:p,fontWeight:R,fontSize:24*Dc,buffer:3*Dc,radius:8*Dc}),a.fontWeight=R}if(this.localGlyphs[a.fontWeight][o])return this.localGlyphs[a.fontWeight][o];const f=String.fromCodePoint(o),{data:w,width:E,height:O,glyphWidth:x,glyphHeight:C,glyphLeft:k,glyphTop:M,glyphAdvance:P}=a.draw(f);return this.localGlyphs[a.fontWeight][o]={id:o,bitmap:new Vl({width:E,height:O},w),metrics:{width:x/Dc,height:C/Dc,left:k/Dc,top:M/Dc-27,advance:P/Dc,localGlyph:!0}}}}rm.loadGlyphRange=function(s,e,i,o,p){const a=256*e,f=a+255,w=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",s).replace("{range}",`${a}-${f}`),Pr.Glyphs);Nn(w,(E,O)=>{if(E)p(E);else if(O){const x={},C=function(k){return new D_(k).readFields(sE,{})}(O);for(const k of C.glyphs)x[k.id]=k;p(null,{glyphs:x,ascender:C.ascender,descender:C.descender})}})},rm.TinySDF=class{constructor({fontSize:s=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:p="sans-serif",fontWeight:a="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=i;const w=this.size=s+4*e,E=this._createCanvas(w),O=this.ctx=E.getContext("2d",{willReadFrequently:!0});O.font=`${f} ${a} ${s}px ${p}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(s){const e=document.createElement("canvas");return e.width=e.height=s,e}draw(s){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:p,actualBoundingBoxRight:a}=this.ctx.measureText(s),f=Math.ceil(i),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-p))),E=Math.min(this.size-this.buffer,f+Math.ceil(o)),O=w+2*this.buffer,x=E+2*this.buffer,C=Math.max(O*x,0),k=new Uint8ClampedArray(C),M={data:k,width:O,height:x,glyphWidth:w,glyphHeight:E,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(w===0||E===0)return M;const{ctx:P,buffer:R,gridInner:$,gridOuter:G}=this;P.clearRect(R,R,w,E),P.fillText(s,R,R+f);const J=P.getImageData(R,R,w,E);G.fill(O_,0,C),$.fill(0,0,C);for(let ee=0;ee<E;ee++)for(let Z=0;Z<w;Z++){const ne=J.data[4*(ee*w+Z)+3]/255;if(ne===0)continue;const le=(ee+R)*O+Z+R;if(ne===1)G[le]=0,$[le]=O_;else{const fe=.5-ne;G[le]=fe>0?fe*fe:0,$[le]=fe<0?fe*fe:0}}Qb(G,0,0,O,x,O,this.f,this.v,this.z),Qb($,R,R,w,E,O,this.f,this.v,this.z);for(let ee=0;ee<C;ee++){const Z=Math.sqrt(G[ee])-Math.sqrt($[ee]);k[ee]=Math.round(255-255*(Z/this.radius+this.cutoff))}return M}};const Wp=ug;function t1(s,e){return s+e[1]-e[0]}function i1(s,e,i,o,p=1){const a=[],f=s.imagePrimary,w=f.pixelRatio,E=f.paddedRect.w-2*Wp,O=f.paddedRect.h-2*Wp,x=(s.right-s.left)*p,C=(s.bottom-s.top)*p,k=f.stretchX||[[0,E]],M=f.stretchY||[[0,O]],P=k.reduce(t1,0),R=M.reduce(t1,0),$=E-P,G=O-R;let J=0,ee=P,Z=0,ne=R,le=0,fe=$,Ce=0,Ee=G;if(f.content&&o){const $e=f.content;J=L_(k,0,$e[0]),Z=L_(M,0,$e[1]),ee=L_(k,$e[0],$e[2]),ne=L_(M,$e[1],$e[3]),le=$e[0]-J,Ce=$e[1]-Z,fe=$e[2]-$e[0]-ee,Ee=$e[3]-$e[1]-ne}const Me=($e,De,Ge,Xe)=>{const qe=R_($e.stretch-J,ee,x,s.left*p),et=z_($e.fixed-le,fe,$e.stretch,P),nt=R_(De.stretch-Z,ne,C,s.top*p),ct=z_(De.fixed-Ce,Ee,De.stretch,R),it=R_(Ge.stretch-J,ee,x,s.left*p),Ct=z_(Ge.fixed-le,fe,Ge.stretch,P),Nt=R_(Xe.stretch-Z,ne,C,s.top*p),Et=z_(Xe.fixed-Ce,Ee,Xe.stretch,R),si=new Wt(qe,nt),ti=new Wt(it,nt),Gt=new Wt(it,Nt),Ut=new Wt(qe,Nt),xi=new Wt(et/w,ct/w),ui=new Wt(Ct/w,Et/w),fi=e*Math.PI/180;if(fi){const ur=Math.sin(fi),nn=Math.cos(fi),Nr=[nn,-ur,ur,nn];si._matMult(Nr),ti._matMult(Nr),Ut._matMult(Nr),Gt._matMult(Nr)}const Ni=$e.stretch+$e.fixed,Ki=Ge.stretch+Ge.fixed,er=De.stretch+De.fixed,tr=Xe.stretch+Xe.fixed,cr=s.imageSecondary;return{tl:si,tr:ti,bl:Ut,br:Gt,texPrimary:{x:f.paddedRect.x+Wp+Ni,y:f.paddedRect.y+Wp+er,w:Ki-Ni,h:tr-er},texSecondary:cr?{x:cr.paddedRect.x+Wp+Ni,y:cr.paddedRect.y+Wp+er,w:Ki-Ni,h:tr-er}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xi,pixelOffsetBR:ui,minFontScaleX:fe/w/x,minFontScaleY:Ee/w/C,isSDF:i}};if(o&&(f.stretchX||f.stretchY)){const $e=r1(k,$,P),De=r1(M,G,R);for(let Ge=0;Ge<$e.length-1;Ge++){const Xe=$e[Ge],qe=$e[Ge+1];for(let et=0;et<De.length-1;et++)a.push(Me(Xe,De[et],qe,De[et+1]))}}else a.push(Me({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:O+1}));return a}function L_(s,e,i){let o=0;for(const p of s)o+=Math.max(e,Math.min(i,p[1]))-Math.max(e,Math.min(i,p[0]));return o}function r1(s,e,i){const o=[{fixed:-1,stretch:0}];for(const[p,a]of s){const f=o[o.length-1];o.push({fixed:p-f.stretch,stretch:f.stretch}),o.push({fixed:p-f.stretch,stretch:f.stretch+(a-p)})}return o.push({fixed:e+Wp,stretch:i}),o}function R_(s,e,i,o){return s/e*i+o}function z_(s,e,i,o){return s-e*i/o}function fE(s,e,i,o){const p=e+s.positionedLines[o].lineOffset;return o===0?i+p/2:i+(p+(e+s.positionedLines[o-1].lineOffset))/2}function mE(s,e=1,i=!1){let o=1/0,p=1/0,a=-1/0,f=-1/0;const w=s[0];for(let M=0;M<w.length;M++){const P=w[M];(!M||P.x<o)&&(o=P.x),(!M||P.y<p)&&(p=P.y),(!M||P.x>a)&&(a=P.x),(!M||P.y>f)&&(f=P.y)}const E=Math.min(a-o,f-p);let O=E/2;const x=new Os([],gE);if(E===0)return new Wt(o,p);for(let M=o;M<a;M+=E)for(let P=p;P<f;P+=E)x.push(new nm(M+O,P+O,O,s));let C=function(M){let P=0,R=0,$=0;const G=M[0];for(let J=0,ee=G.length,Z=ee-1;J<ee;Z=J++){const ne=G[J],le=G[Z],fe=ne.x*le.y-le.x*ne.y;R+=(ne.x+le.x)*fe,$+=(ne.y+le.y)*fe,P+=3*fe}return new nm(R/P,$/P,0,M)}(s),k=x.length;for(;x.length;){const M=x.pop();(M.d>C.d||!C.d)&&(C=M,i&&console.log("found best %d after %d probes",Math.round(1e4*M.d)/1e4,k)),M.max-C.d<=e||(O=M.h/2,x.push(new nm(M.p.x-O,M.p.y-O,O,s)),x.push(new nm(M.p.x+O,M.p.y-O,O,s)),x.push(new nm(M.p.x-O,M.p.y+O,O,s)),x.push(new nm(M.p.x+O,M.p.y+O,O,s)),k+=4)}return i&&(console.log(`num probes: ${k}`),console.log(`best distance: ${C.d}`)),C.p}function gE(s,e){return e.max-s.max}class nm{constructor(e,i,o,p){this.p=new Wt(e,i),this.h=o,this.d=function(a,f){let w=!1,E=1/0;for(let O=0;O<f.length;O++){const x=f[O];for(let C=0,k=x.length,M=k-1;C<k;M=C++){const P=x[C],R=x[M];P.y>a.y!=R.y>a.y&&a.x<(R.x-P.x)*(a.y-P.y)/(R.y-P.y)+P.x&&(w=!w),E=Math.min(E,Le(a,P,R))}}return(w?1:-1)*Math.sqrt(E)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const iv=Number.POSITIVE_INFINITY,_E=Math.sqrt(2);function n1(s,[e,i]){let o=0,p=0;if(i===iv){e<0&&(e=0);const a=e/_E;switch(s){case"top-right":case"top-left":p=a-7;break;case"bottom-right":case"bottom-left":p=7-a;break;case"bottom":p=7-e;break;case"top":p=e-7}switch(s){case"top-right":case"bottom-right":o=-a;break;case"top-left":case"bottom-left":o=a;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),s){case"top-right":case"top-left":case"top":p=i-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-i}switch(s){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,p]}function rv(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function yE(s,e,i,o,p,a,f,w,E,O,x,C,k,M,P){let R=a.textMaxSize.evaluate(e,{},C);R===void 0?R=f*a.textScaleFactor:R*=a.textScaleFactor;const $=s.layers[0].layout,G=$.get("icon-offset").evaluate(e,{},C),J=o1(i.horizontal)||i.vertical,ee=k.name==="globe",Z=po,ne=f*a.textScaleFactor/Z,le=s.tilePixelRatio*R/Z,fe=(qe=s.overscaling,s.zoom>18&&qe>2&&(qe>>=1),Math.max(ei/(512*qe),1)*$.get("symbol-spacing")),Ce=$.get("text-padding")*s.tilePixelRatio,Ee=$.get("icon-padding")*s.tilePixelRatio,Me=rr($.get("text-max-angle")),$e=$.get("text-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",De=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",Ge=$.get("symbol-placement"),Xe=fe/2;var qe;const et=$.get("icon-text-fit").evaluate(e,{},C),nt=$.get("icon-text-fit-padding").evaluate(e,{},C),ct=et!=="none";let it;s.hasAnyIconTextFit===!1&&ct&&(s.hasAnyIconTextFit=!0),o&&ct&&(s.allowVerticalPlacement&&i.vertical&&(it=Gb(o,i.vertical,et,nt,G,ne)),J&&(o=Gb(o,J,et,nt,G,ne)));const Ct=(Nt,Et,si)=>{if(Et.x<0||Et.x>=ei||Et.y<0||Et.y>=ei)return;let ti=null;if(ee){const{x:Gt,y:Ut,z:xi}=k.projectTilePoint(Et.x,Et.y,si);ti={anchor:new Sh(Gt,Ut,xi,0,void 0),up:k.upVector(si,Et.x,Et.y)}}(function(Gt,Ut,xi,ui,fi,Ni,Ki,er,tr,cr,ur,nn,Nr,Gi,Rr,Fr,hn,Zn,hs,Kn,On,as,_s,fo,cn,xa,Rc){const jl=Gt.addToLineVertexArray(Ut,ui);let $l,Kp,kd,Jp,Ig,Vw,Uw,jw=0,$w=0,Gw=0,Hw=0,Bv=-1,Nv=-1;const Au={};let Ww=sa("");const Qp=xi?xi.anchor:Ut,Vv=tr.layout.get("icon-text-fit").evaluate(On,{},cn)!=="none";let Uv=0,jv=0;if(tr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Uv,jv]=tr.layout.get("text-offset").evaluate(On,{},cn).map(al=>al*po):(Uv=tr.layout.get("text-radial-offset").evaluate(On,{},cn)*po,jv=iv),Gt.allowVerticalPlacement&&fi.vertical){const al=fi.vertical;if(Rr)Vw=nv(al),er&&(Uw=nv(er));else{const ba=tr.layout.get("text-rotate").evaluate(On,{},cn)+90;kd=F_(cr,Qp,Ut,ur,nn,Nr,al,Gi,ba,Fr),er&&(Jp=F_(cr,Qp,Ut,ur,nn,Nr,er,Zn,ba))}}if(Ni){const al=Gt.iconSizeData,ba=tr.layout.get("icon-rotate").evaluate(On,{},cn),Dg=i1(Ni,ba,_s,Vv,as.iconScaleFactor),Gv=er?i1(er,ba,_s,Vv,as.iconScaleFactor):void 0;Kp=F_(cr,Qp,Ut,ur,nn,Nr,Ni,Zn,ba,null),jw=4*Dg.length;let ef=null;al.kind==="source"?(ef=[Ic*tr.layout.get("icon-size").evaluate(On,{},cn)*as.iconScaleFactor],ef[0]>Ad&&qi(`${Gt.layerIds[0]}: Value for "icon-size" is >= ${dg}. Reduce your "icon-size".`)):al.kind==="composite"&&(ef=[Ic*as.compositeIconSizes[0].evaluate(On,{},cn)*as.iconScaleFactor,Ic*as.compositeIconSizes[1].evaluate(On,{},cn)*as.iconScaleFactor],(ef[0]>Ad||ef[1]>Ad)&&qi(`${Gt.layerIds[0]}: Value for "icon-size" is >= ${dg}. Reduce your "icon-size".`)),Gt.addSymbols(Gt.icon,Dg,ef,Kn,hs,On,!1,xi,Ut,jl.lineStartIndex,jl.lineLength,-1,fo,cn,xa,Rc),Bv=Gt.icon.placedSymbolArray.length-1,Gv&&($w=4*Gv.length,Gt.addSymbols(Gt.icon,Gv,ef,Kn,hs,On,sl.vertical,xi,Ut,jl.lineStartIndex,jl.lineLength,-1,fo,cn,xa,Rc),Nv=Gt.icon.placedSymbolArray.length-1)}for(const al in fi.horizontal){const ba=fi.horizontal[al];$l||(Ww=sa(ba.text),Rr?Ig=nv(ba):$l=F_(cr,Qp,Ut,ur,nn,Nr,ba,Gi,tr.layout.get("text-rotate").evaluate(On,{},cn),Fr));const Dg=ba.positionedLines.length===1;if(Gw+=s1(Gt,xi,Ut,ba,Ki,tr,Rr,On,Fr,jl,fi.vertical?sl.horizontal:sl.horizontalOnly,Dg?Object.keys(fi.horizontal):[al],Au,Bv,as,fo,cn,xa),Dg)break}fi.vertical&&(Hw+=s1(Gt,xi,Ut,fi.vertical,Ki,tr,Rr,On,Fr,jl,sl.vertical,["vertical"],Au,Nv,as,fo,cn,xa));let Od=-1;const $v=(al,ba)=>al?Math.max(al,ba):ba;Od=$v(Ig,Od),Od=$v(Vw,Od),Od=$v(Uw,Od);const KC=Od>-1?1:0;Gt.glyphOffsetArray.length>=65535&&qi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),On.sortKey!==void 0&&Gt.addToSortKeyRanges(Gt.symbolInstances.length,On.sortKey),Gt.symbolInstances.emplaceBack(Ut.x,Ut.y,Qp.x,Qp.y,Qp.z,Au.right>=0?Au.right:-1,Au.center>=0?Au.center:-1,Au.left>=0?Au.left:-1,Au.vertical>=0?Au.vertical:-1,Bv,Nv,Ww,$l!==void 0?$l:Gt.collisionBoxArray.length,$l!==void 0?$l+1:Gt.collisionBoxArray.length,kd!==void 0?kd:Gt.collisionBoxArray.length,kd!==void 0?kd+1:Gt.collisionBoxArray.length,Kp!==void 0?Kp:Gt.collisionBoxArray.length,Kp!==void 0?Kp+1:Gt.collisionBoxArray.length,Jp||Gt.collisionBoxArray.length,Jp?Jp+1:Gt.collisionBoxArray.length,ur,Gw,Hw,jw,$w,KC,0,Uv,jv,Od,0,Vv?1:0)})(s,Et,ti,Nt,i,o,p,it,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,Ce,$e,E,0,Ee,De,G,e,a,O,x,C,M,P)};if(Ge==="line")for(const Nt of Zb(e.geometry,0,0,ei,ei)){const Et=pE(Nt,fe,Me,i.vertical||J,o,Z,le,s.overscaling,ei);for(const si of Et)J&&vE(s,J.text,Xe,si)||Ct(Nt,si,C)}else if(Ge==="line-center"){for(const Nt of e.geometry)if(Nt.length>1){const Et=dE(Nt,Me,i.vertical||J,o,Z,le);Et&&Ct(Nt,Et,C)}}else if(e.type==="Polygon")for(const Nt of $p(e.geometry,0)){const Et=mE(Nt,16);Ct(Nt[0],new Sh(Et.x,Et.y,0,0,void 0),C)}else if(e.type==="LineString")for(const Nt of e.geometry)Ct(Nt,new Sh(Nt[0].x,Nt[0].y,0,0,void 0),C);else if(e.type==="Point")for(const Nt of e.geometry)for(const Et of Nt)Ct([Et],new Sh(Et.x,Et.y,0,0,void 0),C)}const dg=255,Ad=dg*Ic;function s1(s,e,i,o,p,a,f,w,E,O,x,C,k,M,P,R,$,G){const J=function(ne,le,fe,Ce,Ee,Me,$e,De){const Ge=[];if(le.positionedLines.length===0)return Ge;const Xe=Ce.layout.get("text-rotate").evaluate(Me,{})*Math.PI/180,qe=function(Ct){const Nt=Ct[0],Et=Ct[1],si=Nt*Et;return si>0?[Nt,-Et]:si<0?[-Nt,Et]:Nt===0?[Et,Nt]:[Et,-Nt]}(fe);let et=Math.abs(le.top-le.bottom);for(const Ct of le.positionedLines)et-=Ct.lineOffset;const nt=le.positionedLines.length,ct=et/nt;let it=le.top-fe[1];for(let Ct=0;Ct<nt;++Ct){const Nt=le.positionedLines[Ct];it=fE(le,ct,it,Ct);for(const Et of Nt.positionedGlyphs){if(!Et.rect)continue;const si=Et.rect||{};let ti=lE+1,Gt=!0,Ut=1,xi=0;if(Et.imageName){const Kn=$e[ks.build(Et.imageName).getSerializedPrimary()];if(!Kn)continue;if(Kn.sdf){qi("SDF images are not supported in formatted text and will be ignored.");continue}Gt=!1,Ut=Kn.pixelRatio,ti=ug/Ut}const ui=(Ee||De)&&Et.vertical,fi=Et.metrics.advance*Et.scale/2,Ni=Et.metrics,Ki=Et.rect;if(Ki===null)continue;De&&le.verticalizable&&(xi=Et.imageName?fi-Et.metrics.width*Et.scale/2:0);const er=Ee?[Et.x+fi,Et.y]:[0,0];let tr=[0,0],cr=[0,0],ur=!1;Ee||(ui?(cr=[Et.x+fi+qe[0],Et.y+qe[1]-xi],ur=!0):tr=[Et.x+fi+fe[0],Et.y+fe[1]-xi]);const nn=Ki.w*Et.scale/(Ut*(Et.localGlyph?Dc:1)),Nr=Ki.h*Et.scale/(Ut*(Et.localGlyph?Dc:1));let Gi,Rr,Fr,hn;if(ui){const Kn=Et.y-it,On=new Wt(-fi,fi-Kn),as=-Math.PI/2,_s=new Wt(...cr);Gi=new Wt(-fi+tr[0],tr[1]),Gi._rotateAround(as,On)._add(_s),Gi.x+=-Kn+fi,Gi.y-=(Ni.left-ti)*Et.scale;const fo=Et.imageName?Ni.advance*Et.scale:po*Et.scale,cn=String.fromCodePoint(Et.glyph);iE(cn)?Gi.x+=(1-ti)*Et.scale:rE(cn)?Gi.x+=fo-Ni.height*Et.scale+(-ti-1)*Et.scale:Gi.x+=Et.imageName||Ni.width+2*ti===Ki.w&&Ni.height+2*ti===Ki.h?(fo-Nr)/2:(fo-(Ni.height+2*ti)*Et.scale)/2,Rr=new Wt(Gi.x,Gi.y-nn),Fr=new Wt(Gi.x+Nr,Gi.y),hn=new Wt(Gi.x+Nr,Gi.y-nn)}else{const Kn=(Ni.left-ti)*Et.scale-fi+tr[0],On=(-Ni.top-ti)*Et.scale+tr[1],as=Kn+nn,_s=On+Nr;Gi=new Wt(Kn,On),Rr=new Wt(as,On),Fr=new Wt(Kn,_s),hn=new Wt(as,_s)}if(Xe){let Kn;Kn=Ee?new Wt(0,0):ur?new Wt(qe[0],qe[1]):new Wt(fe[0],fe[1]),Gi._rotateAround(Xe,Kn),Rr._rotateAround(Xe,Kn),Fr._rotateAround(Xe,Kn),hn._rotateAround(Xe,Kn)}const Zn=new Wt(0,0),hs=new Wt(0,0);Ge.push({tl:Gi,tr:Rr,bl:Fr,br:hn,texPrimary:si,texSecondary:void 0,writingMode:le.writingMode,glyphOffset:er,sectionIndex:Et.sectionIndex,isSDF:Gt,pixelOffsetTL:Zn,pixelOffsetBR:hs,minFontScaleX:0,minFontScaleY:0})}}return Ge}(0,o,E,a,f,w,p,s.allowVerticalPlacement),ee=s.textSizeData;let Z=null;ee.kind==="source"?(Z=[Ic*a.layout.get("text-size").evaluate(w,{},$)*P.textScaleFactor],Z[0]>Ad&&qi(`${s.layerIds[0]}: Value for "text-size" is >= ${dg}. Reduce your "text-size".`)):ee.kind==="composite"&&(Z=[Ic*P.compositeTextSizes[0].evaluate(w,{},$)*P.textScaleFactor,Ic*P.compositeTextSizes[1].evaluate(w,{},$)*P.textScaleFactor],(Z[0]>Ad||Z[1]>Ad)&&qi(`${s.layerIds[0]}: Value for "text-size" is >= ${dg}. Reduce your "text-size".`)),s.addSymbols(s.text,J,Z,E,f,w,x,e,i,O.lineStartIndex,O.lineLength,M,R,$,G,!1);for(const ne of C)k[ne]=s.text.placedSymbolArray.length-1;return 4*J.length}function o1(s){for(const e in s)return s[e];return null}function F_(s,e,i,o,p,a,f,w,E,O){let x=f.top,C=f.bottom,k=f.left,M=f.right;const P=f.collisionPadding;if(P&&(k-=P[0],x-=P[1],M+=P[2],C+=P[3]),E){const R=new Wt(k,x),$=new Wt(M,x),G=new Wt(k,C),J=new Wt(M,C),ee=rr(E);let Z=new Wt(0,0);O&&(Z=new Wt(O[0],O[1])),R._rotateAround(ee,Z),$._rotateAround(ee,Z),G._rotateAround(ee,Z),J._rotateAround(ee,Z),k=Math.min(R.x,$.x,G.x,J.x),M=Math.max(R.x,$.x,G.x,J.x),x=Math.min(R.y,$.y,G.y,J.y),C=Math.max(R.y,$.y,G.y,J.y)}return s.emplaceBack(e.x,e.y,e.z,i.x,i.y,k,x,M,C,w,o,p,a),s.length-1}function nv(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const e=s.bottom-s.top;return e>0?Math.max(10,e):null}function vE(s,e,i,o){const p=s.compareText;if(e in p){const a=p[e];for(let f=a.length-1;f>=0;f--)if(o.dist(a[f])<i)return!0}else p[e]=[];return p[e].push(o),!1}function a1(s,e){const i=s.fovAboveCenter,o=s.elevation?s.elevation.getMinElevationBelowMSL()*e:0,p=(s._camera.position[2]*s.worldSize-o)/Math.cos(s._pitch),a=Math.sin(i)*p/Math.sin(Math.max(Math.PI/2-s._pitch-i,.01));let f=Math.sin(s._pitch)*a+p;const w=p*(1/s._horizonShift);if(!s.elevation||s.elevation.exaggeration()===0){let E=Math.max(s.zoom-17,0);s.isOrthographic&&(E/=10),f*=1+E}return Math.min(1.01*f,w)}function pg(s,e){if(!e.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:e};const i=Math.pow(2,-s.z),o=s.x*i,p=(s.x+1)*i,a=s.y*i,f=(s.y+1)*i,w=co(o),E=co(p),O=Wn(a),x=Wn(f),C=e.project(w,O),k=e.project(E,O),M=e.project(E,x),P=e.project(w,x);let R=Math.min(C.x,k.x,M.x,P.x),$=Math.min(C.y,k.y,M.y,P.y),G=Math.max(C.x,k.x,M.x,P.x),J=Math.max(C.y,k.y,M.y,P.y);const ee=i/16;function Z(le,fe,Ce,Ee,Me,$e){const De=(Ce+Me)/2,Ge=(Ee+$e)/2,Xe=e.project(co(De),Wn(Ge)),qe=Math.max(0,R-Xe.x,$-Xe.y,Xe.x-G,Xe.y-J);R=Math.min(R,Xe.x),G=Math.max(G,Xe.x),$=Math.min($,Xe.y),J=Math.max(J,Xe.y),qe>ee&&(Z(le,Xe,Ce,Ee,De,Ge),Z(Xe,fe,De,Ge,Me,$e))}Z(C,k,o,a,p,a),Z(k,M,p,a,p,f),Z(M,P,p,f,o,f),Z(P,C,o,f,o,a),R-=ee,$-=ee,G+=ee,J+=ee;const ne=1/Math.max(G-R,J-$);return{scale:ne,x:R*ne,y:$*ne,x2:G*ne,y2:J*ne,projection:e}}function l1(s,{x:e,y:i},o=0){return new Wt(((e-o)*s.scale-s.x)*ei,(i*s.scale-s.y)*ei)}const xE=Ye.mat4.identity(new Float32Array(16));class Pd{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Er(0,0)}projectTilePoint(e,i,o){return{x:e,y:i,z:0}}locationPoint(e,i,o=!0){return e._coordinatePoint(e.locationCoordinate(i),o)}pixelsPerMeter(e,i){return to(1,e)*i}pixelSpaceConversion(e,i,o){return 1}farthestPixelDistance(e){return a1(e,e.pixelsPerMeter)}pointCoordinate(e,i,o,p){const a=e.horizonLineFromTop(!1),f=new Wt(i,Math.max(a,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,p))}pointCoordinate3D(e,i,o){const p=new Wt(i,o);if(e.elevation)return e.elevation.pointCoordinate(p);{const a=this.pointCoordinate(e,p.x,p.y,0);return[a.x,a.y,a.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const o=e.horizonLineFromTop();return i.y<o}createInversionMatrix(e,i){return xE}createTileMatrix(e,i,o){let p,a,f;const w=o.canonical,E=Ye.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const O=pg(w,this);p=1,a=O.x+o.wrap*O.scale,f=O.y,Ye.mat4.scale(E,E,[p/O.scale,p/O.scale,e.pixelsPerMeter/i])}else p=i/e.zoomScale(w.z),a=(w.x+Math.pow(2,w.z)*o.wrap)*p,f=w.y*p;return Ye.mat4.translate(E,E,[a,f,0]),Ye.mat4.scale(E,E,[p/ei,p/ei,1]),E}upVector(e,i,o){return[0,0,1]}upVectorScale(e,i,o){return{metersToTile:1}}}class bE extends Pd{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,o]=this.parallels=e.parallels||[29.5,45.5],p=Math.sin(rr(i));this.n=(p+Math.sin(rr(o)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:o,c:p,r0:a}=this,f=rr(e-this.center[0]),w=rr(i),E=Math.sqrt(p-2*o*Math.sin(w))/o;return{x:E*Math.sin(f*o),y:E*Math.cos(f*o)-a,z:0}}unproject(e,i){const{n:o,c:p,r0:a}=this,f=a+i;let w=Math.atan2(e,Math.abs(f))*Math.sign(f);f*o<0&&(w-=Math.PI*Math.sign(e)*Math.sign(f));const E=rr(this.center[0])*o;w=ra(w,-Math.PI-E,Math.PI-E);const O=nr($n(w/o)+this.center[0],-180,180),x=Math.asin(nr((p-(e*e+f*f)*o*o)/(2*o),-1,1)),C=nr($n(x),-85.051129,uo);return new Er(O,C)}}const fg=1.340264,mg=-.081106,gg=893e-6,_g=.003796,B_=Math.sqrt(3)/2;class wE extends Pd{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(B_*Math.sin(i)),p=o*o,a=p*p*p;return{x:.5*(e*Math.cos(o)/(B_*(fg+3*mg*p+a*(7*gg+9*_g*p)))/Math.PI+.5),y:1-.5*(o*(fg+mg*p+a*(gg+_g*p))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,p=o*o,a=p*p*p;for(let x,C,k,M=0;M<12&&(C=o*(fg+mg*p+a*(gg+_g*p))-i,k=fg+3*mg*p+a*(7*gg+9*_g*p),x=C/k,o=nr(o-x,-Math.PI/3,Math.PI/3),p=o*o,a=p*p*p,!(Math.abs(x)<1e-12));++M);const f=B_*e*(fg+3*mg*p+a*(7*gg+9*_g*p))/Math.cos(o),w=Math.asin(Math.sin(o)/B_),E=nr(180*f/Math.PI,-180,180),O=nr(180*w/Math.PI,-85.051129,uo);return new Er(E,O)}}class SE extends Pd{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const o=360*(e-.5),p=nr(360*(.5-i),-85.051129,uo);return new Er(o,p)}}const sm=Math.PI/2;function N_(s){return Math.tan((sm+s)/2)}class TE extends Pd{constructor(e){super(e),this.center=e.center||[0,30];const[i,o]=this.parallels=e.parallels||[30,30];let p=rr(i),a=rr(o);this.southernCenter=p+a<0,this.southernCenter&&(p=-p,a=-a);const f=Math.cos(p),w=N_(p);this.n=p===a?Math.sin(p):Math.log(f/Math.cos(a))/Math.log(N_(a)/w),this.f=f*Math.pow(N_(p),this.n)/this.n}project(e,i){i=rr(i),this.southernCenter&&(i=-i),e=rr(e-this.center[0]);const o=1e-6,{n:p,f:a}=this;a>0?i<-sm+o&&(i=-sm+o):i>sm-o&&(i=sm-o);const f=a/Math.pow(N_(i),p);let w=f*Math.sin(p*e),E=a-f*Math.cos(p*e);return w=.5*(w/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:w,y:this.southernCenter?E:1-E,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:o,f:p}=this,a=p-i,f=Math.sign(a),w=Math.sign(o)*Math.sqrt(e*e+a*a);let E=Math.atan2(e,Math.abs(a))*f;a*o<0&&(E-=Math.PI*Math.sign(e)*f);const O=nr($n(E/o)+this.center[0],-180,180),x=nr($n(2*Math.atan(Math.pow(p/w,1/o))-sm),-85.051129,uo);return new Er(O,this.southernCenter?-x:x)}}class c1 extends Pd{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:_a(e),y:ya(i),z:0}}unproject(e,i){const o=co(e),p=Wn(i);return new Er(o,p)}}const u1=rr(uo);class ME extends Pd{project(e,i){const o=(i=rr(i))*i,p=o*o;return{x:.5*((e=rr(e))*(.8707-.131979*o+p*(p*(.003971*o-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+p*(.028874*o-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,p=25,a=0,f=o*o;do{f=o*o;const O=f*f;a=(o*(1.007226+f*(.015085+O*(.028874*f-.044475-.005916*O)))-i)/(1.007226+f*(.045255+O*(.259866*f-.311325-.005916*11*O))),o=nr(o-a,-u1,u1)}while(Math.abs(a)>1e-6&&--p>0);f=o*o;const w=nr($n(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),E=$n(o);return new Er(w,E)}}const h1=rr(uo);class EE extends Pd{project(e,i){i=rr(i),e=rr(e);const o=Math.cos(i),p=2/Math.PI,a=Math.acos(o*Math.cos(e/2)),f=Math.sin(a)/a,w=.5*(e*p+2*o*Math.sin(e/2)/f)||0,E=.5*(i+Math.sin(i)/f)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(e,i){let o=e=(2*e-.5)*Math.PI,p=i=(2*(1-i)-1)*Math.PI,a=25;const f=1e-6;let w=0,E=0;do{const O=Math.cos(p),x=Math.sin(p),C=2*x*O,k=x*x,M=O*O,P=Math.cos(o/2),R=Math.sin(o/2),$=2*P*R,G=R*R,J=1-M*P*P,ee=J?1/J:0,Z=J?Math.acos(O*P)*Math.sqrt(1/J):0,ne=.5*(2*Z*O*R+2*o/Math.PI)-e,le=.5*(Z*x+p)-i,fe=.5*ee*(M*G+Z*O*P*k)+1/Math.PI,Ce=ee*($*C/4-Z*x*R),Ee=.125*ee*(C*R-Z*x*M*$),Me=.5*ee*(k*P+Z*G*O)+.5,$e=Ce*Ee-Me*fe;w=(le*Ce-ne*Me)/$e,E=(ne*Ee-le*fe)/$e,o=nr(o-w,-Math.PI,Math.PI),p=nr(p-E,-h1,h1)}while((Math.abs(w)>f||Math.abs(E)>f)&&--a>0);return new Er($n(o),$n(p))}}class d1 extends Pd{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(rr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:o,cosPhi:p}=this;return{x:rr(e)*p*o+.5,y:-Math.sin(rr(i))/p*o+.5,z:0}}unproject(e,i){const{scale:o,cosPhi:p}=this,a=-(i-.5)/o,f=nr($n((e-.5)/o)/p,-180,180),w=Math.asin(nr(a*p,-1,1)),E=nr($n(w),-85.051129,uo);return new Er(f,E)}}class CE extends c1{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,o){const p=Br(e,i,o),a=Yn(Tn(o));return Ye.vec3.transformMat4(p,p,a),{x:p[0],y:p[1],z:p[2]}}locationPoint(e,i){const o=ga(i.lat,i.lng),p=Ye.vec3.normalize([],o),a=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,f=to(1,0)*ei*a;Ye.vec3.scaleAndAdd(o,o,p,f);const w=Ye.mat4.identity(new Float64Array(16));return Ye.mat4.multiply(w,e.pixelMatrix,e.globeMatrix),Ye.vec3.transformMat4(o,o,w),new Wt(o[0],o[1])}pixelsPerMeter(e,i){return to(1,0)*i}pixelSpaceConversion(e,i,o){const p=to(1,e)*i,a=Ii(to(1,45)*i,p,o);return this.pixelsPerMeter(e,i)/a}createTileMatrix(e,i,o){const p=jr(Tn(o.canonical));return Ye.mat4.multiply(new Float64Array(16),e.globeMatrix,p)}createInversionMatrix(e,i){const{center:o}=e,p=Yn(Tn(i));return Ye.mat4.rotateY(p,p,rr(o.lng)),Ye.mat4.rotateX(p,p,rr(o.lat)),Ye.mat4.scale(p,p,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(e,i,o,p){return Mr(e,i,o,!0)||new n(0,0)}pointCoordinate3D(e,i,o){const p=this.pointCoordinate(e,i,o,0);return[p.x,p.y,p.z]}isPointAboveHorizon(e,i){return!Mr(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(p,a){const f=p.cameraToCenterDistance,w=p._centerAltitude*a,E=p._camera,O=p._camera.forward(),x=Ye.vec3.add([],Ye.vec3.scale([],O,-f),[0,0,w]),C=p.worldSize/(2*Math.PI),k=[0,0,-C],M=p.width/p.height,P=Math.tan(p.fovAboveCenter),R=Ye.vec3.scale([],E.up(),P),$=Ye.vec3.scale([],E.right(),P*M),G=Ye.vec3.normalize([],Ye.vec3.add([],Ye.vec3.add([],O,R),$)),J=[];let ee;if(new ji(x,G).closestPointOnSphere(k,C,J)){const Z=Ye.vec3.add([],J,k),ne=Ye.vec3.sub([],Z,x);ee=Math.cos(p.fovAboveCenter)*Ye.vec3.length(ne)}else{const Z=Ye.vec3.sub([],x,k),ne=Ye.vec3.sub([],k,x);Ye.vec3.normalize(ne,ne);const le=Ye.vec3.length(Z)-C;ee=Math.sqrt(le*(le+2*C));const fe=Math.acos(ee/(C+le))-Math.acos(Ye.vec3.dot(O,ne));ee*=Math.cos(fe)}return 1.01*ee}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=ho(e.zoom);if(o>0){const p=a1(e,to(1,e.center.lat)*e.worldSize),a=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ii(i,p+a*(1-Math.cos(f)),Math.pow(o,10))}return i}upVector(e,i,o){return Br(i,o,e,1)}upVectorScale(e){return{metersToTile:or(mr(Tn(e)))}}}function p1(s){const e=s.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(s.name){case"mercator":return new c1(s);case"equirectangular":return new SE(s);case"naturalEarth":return new ME(s);case"equalEarth":return new wE(s);case"winkelTripel":return new EE(s);case"albers":return i?new d1(s):new bE(s);case"lambertConformalConic":return i?new d1(s):new TE(s);case"globe":return new CE(s)}throw new Error(`Invalid projection name: ${s.name}`)}const AE=xe.VectorTileFeature.types,PE=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function V_(s,e,i,o,p,a,f,w,E,O,x,C,k){const M=w?Math.min(Ad,Math.round(w[0])):0,P=w?Math.min(Ad,Math.round(w[1])):0;s.emplaceBack(e,i,Math.round(32*o),Math.round(32*p),a,f,(M<<1)+(E?1:0),P,16*O,16*x,256*C,256*k)}function U_(s,e,i){s.emplaceBack(e,i)}function j_(s,e,i,o,p,a,f){s.emplaceBack(e,i,o,p,a,f)}function $_(s,e,i,o,p){s.emplaceBack(e,i,o,p),s.emplaceBack(e,i,o,p),s.emplaceBack(e,i,o,p),s.emplaceBack(e,i,o,p)}function IE(s){for(const e of s.sections)if(gc(e.text))return!0;return!1}class sv{constructor(e){this.layoutVertexArray=new Dl,this.indexArray=new gs,this.programConfigurations=e,this.segments=new Sn,this.dynamicLayoutVertexArray=new ln,this.opacityVertexArray=new wp,this.placedSymbolArray=new Wf,this.iconTransitioningVertexArray=new Ja,this.globeExtVertexArray=new fh,this.zOffsetVertexArray=new mh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,o,p,a){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,WM.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,YM.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,PE,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,ZM.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,qM.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||a)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,XM.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||p)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}_i(sv,"SymbolBuffers");class ov{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new Sn,this.collisionVertexArray=new Tp,this.collisionVertexArrayExt=new ln}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,KM.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,JM.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}_i(ov,"CollisionBuffers");class G_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ye.mat4.identity([]),this.placementViewportMatrix=Ye.mat4.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=X0(this.zoom,i["text-size"]),this.iconSizeData=X0(this.zoom,i["icon-size"]);const o=this.layers[0].layout,p=o.get("symbol-sort-key"),a=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=a!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(a==="viewport-y"||a==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(f=>sl[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=o.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new sv(new ma(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new sv(new ma(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new gd,this.lineVertexArray=new qf,this.symbolInstances=new Pp}calculateGlyphDependencies(e,i,o,p,a){for(const f of e){const w=f.codePointAt(0);if(w===void 0)break;if(i[w]=!0,p&&a&&w<=65535){const E=lg[f];E&&(i[E.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!mi(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}populate(e,i,o,p){const a=this.layers[0],f=a.layout,w=this.projection.name==="globe",E=f.get("text-font"),O=f.get("text-field"),x=f.get("icon-image"),[C,k]=f.get("icon-size-scale-range"),M=nr(i.scaleFactor||1,C,k),P=(O.value.kind!=="constant"||O.value.value instanceof Ds&&!O.value.value.isEmpty()||O.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),R=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,$=f.get("symbol-sort-key");if(this.features=[],!P&&!R)return;const G=i.iconDependencies,J=i.glyphDependencies,ee=i.availableImages,Z=new Vr(this.zoom);for(const{feature:ne,id:le,index:fe,sourceLayerIndex:Ce}of e){const Ee=a._featureFilter.needGeometry,Me=H(ne,Ee);if(!a._featureFilter.filter(Z,Me,o))continue;if(Ee||(Me.geometry=j(ne,o,p)),w&&ne.type!==1&&o.z<=5){const qe=Me.geometry,et=.98078528056,nt=(ct,it)=>{const Ct=Br(ct.x,ct.y,o,1),Nt=Br(it.x,it.y,o,1);return Ye.vec3.dot(Ct,Nt)<et};for(let ct=0;ct<qe.length;ct++)qe[ct]=T(qe[ct],nt)}let $e,De;if(P){const qe=a.getValueAndResolveTokens("text-field",Me,o,ee),et=Ds.factory(qe);IE(et)&&(this.hasRTLText=!0),(!this.hasRTLText||lh()==="unavailable"||this.hasRTLText&&Qs.isParsed())&&($e=tE(et,a,Me))}if(R){const qe=a.getValueAndResolveTokens("icon-image",Me,o,ee);De=qe instanceof ks?qe:ks.build(qe)}if(!$e&&!De)continue;const Ge=this.sortFeaturesByKey?$.evaluate(Me,{},o):void 0,Xe={id:le,text:$e,icon:De,index:fe,sourceLayerIndex:Ce,geometry:Me.geometry,properties:ne.properties,type:AE[ne.type],sortKey:Ge};if(this.features.push(Xe),De){const qe=Y0(this.iconSizeData,this.layers[0]._unevaluatedLayout._values["icon-size"],o,this.zoom,Xe)*M*this.pixelRatio,et=De.getPrimary().scaleSelf(qe);if(G[et.id]=G[et.id]||[],G[et.id].push(et),De.nameSecondary){const nt=De.getSecondary().scaleSelf(qe);G[nt.id]=G[nt.id]||[],G[nt.id].push(nt)}}if($e){const qe=E.evaluate(Me,{},o).join(","),et=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(sl.vertical)>=0;for(const nt of $e.sections)if(nt.image){const ct=nt.image.getPrimary().scaleSelf(this.pixelRatio);G[ct.id]=G[ct.id]||[],G[ct.id].push(ct)}else{const ct=Ba($e.toString()),it=nt.fontStack||qe,Ct=J[it]=J[it]||{};this.calculateGlyphDependencies(nt.text,Ct,et,this.allowVerticalPlacement,ct)}}}f.get("symbol-placement")==="line"&&(this.features=function(ne){const le={},fe={},Ce=[];let Ee=0;function Me(Xe){Ce.push(ne[Xe]),Ee++}function $e(Xe,qe,et){const nt=fe[Xe];return delete fe[Xe],fe[qe]=nt,Ce[nt].geometry[0].pop(),Ce[nt].geometry[0]=Ce[nt].geometry[0].concat(et[0]),nt}function De(Xe,qe,et){const nt=le[qe];return delete le[qe],le[Xe]=nt,Ce[nt].geometry[0].shift(),Ce[nt].geometry[0]=et[0].concat(Ce[nt].geometry[0]),nt}function Ge(Xe,qe,et){const nt=et?qe[0][qe[0].length-1]:qe[0][0];return`${Xe}:${nt.x}:${nt.y}`}for(let Xe=0;Xe<ne.length;Xe++){const qe=ne[Xe],et=qe.geometry,nt=qe.text?qe.text.toString():null;if(!nt){Me(Xe);continue}const ct=Ge(nt,et),it=Ge(nt,et,!0);if(ct in fe&&it in le&&fe[ct]!==le[it]){const Ct=De(ct,it,et),Nt=$e(ct,it,Ce[Ct].geometry);delete le[ct],delete fe[it],fe[Ge(nt,Ce[Nt].geometry,!0)]=Nt,Ce[Ct].geometry=null}else ct in fe?$e(ct,it,et):it in le?De(ct,it,et):(Me(Xe),le[ct]=Ee-1,fe[it]=Ee-1)}return Ce.filter(Xe=>Xe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ne,le)=>ne.sortKey-le.sortKey)}update(e,i,o,p,a,f,w){this.text.programConfigurations.updatePaintArrays(e,i,a,o,p,f,w),this.icon.programConfigurations.updatePaintArrays(e,i,a,o,p,f,w)}updateZOffset(){const e=(a,f,w)=>{o+=f,o>a.length&&a.resize(o);for(let E=-f;E<0;E++)a.emplace(E+o,w)},i=(a,f,w)=>{p+=f,p>a.length&&a.resize(p);for(let E=-f;E<0;E++)a.emplace(E+p,w)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,p=0;for(let a=0;a<this.symbolInstances.length;a++){const f=this.symbolInstances.get(a),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:E,numIconVertices:O}=f,x=f.zOffset,C=O>0;if((w>0||E>0)&&(e(this.text.zOffsetVertexArray,w,x),e(this.text.zOffsetVertexArray,E,x)),C){const{placedIconSymbolIndex:k,verticalPlacedIconSymbolIndex:M}=f;k>=0&&i(this.icon.zOffsetVertexArray,O,x),M>=0&&i(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,x)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=p1(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:p,y:a}of i)this.lineVertexArray.emplaceBack(p,a);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,p,a,f,w,E,O,x,C,k,M,P,R,$){const G=e.indexArray,J=e.layoutVertexArray,ee=e.globeExtVertexArray,Z=e.segments.prepareSegment(4*i.length,J,G,this.canOverlap?f.sortKey:void 0),ne=this.glyphOffsetArray.length,le=Z.vertexLength,fe=this.allowVerticalPlacement&&w===sl.vertical?Math.PI/2:0,Ce=f.text&&f.text.sections;for(let Me=0;Me<i.length;Me++){const{tl:$e,tr:De,bl:Ge,br:Xe,texPrimary:qe,texSecondary:et,pixelOffsetTL:nt,pixelOffsetBR:ct,minFontScaleX:it,minFontScaleY:Ct,glyphOffset:Nt,isSDF:Et,sectionIndex:si}=i[Me],ti=Z.vertexLength,Gt=Nt[1];if(V_(J,O.x,O.y,$e.x,Gt+$e.y,qe.x,qe.y,o,Et,nt.x,nt.y,it,Ct),V_(J,O.x,O.y,De.x,Gt+De.y,qe.x+qe.w,qe.y,o,Et,ct.x,nt.y,it,Ct),V_(J,O.x,O.y,Ge.x,Gt+Ge.y,qe.x,qe.y+qe.h,o,Et,nt.x,ct.y,it,Ct),V_(J,O.x,O.y,Xe.x,Gt+Xe.y,qe.x+qe.w,qe.y+qe.h,o,Et,ct.x,ct.y,it,Ct),E){const{x:Ut,y:xi,z:ui}=E.anchor,[fi,Ni,Ki]=E.up;j_(ee,Ut,xi,ui,fi,Ni,Ki),j_(ee,Ut,xi,ui,fi,Ni,Ki),j_(ee,Ut,xi,ui,fi,Ni,Ki),j_(ee,Ut,xi,ui,fi,Ni,Ki),$_(e.dynamicLayoutVertexArray,Ut,xi,ui,fe)}else $_(e.dynamicLayoutVertexArray,O.x,O.y,O.z,fe);if($){const Ut=et||qe;U_(e.iconTransitioningVertexArray,Ut.x,Ut.y),U_(e.iconTransitioningVertexArray,Ut.x+Ut.w,Ut.y),U_(e.iconTransitioningVertexArray,Ut.x,Ut.y+Ut.h),U_(e.iconTransitioningVertexArray,Ut.x+Ut.w,Ut.y+Ut.h)}G.emplaceBack(ti,ti+1,ti+2),G.emplaceBack(ti+1,ti+2,ti+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Nt[0]),Me!==i.length-1&&si===i[Me+1].sectionIndex||e.programConfigurations.populatePaintArrays(J.length,f,f.index,{},M,P,R,Ce&&Ce[si])}const Ee=E?E.anchor:O;e.placedSymbolArray.emplaceBack(Ee.x,Ee.y,Ee.z,O.x,O.y,ne,this.glyphOffsetArray.length-ne,le,x,C,O.segment,o?o[0]:0,o?o[1]:0,p[0],p[1],w,0,!1,0,k,0)}_commitLayoutVertex(e,i,o,p,a,f,w){e.emplaceBack(i,o,p,a,f,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(e,i,o,p,a,f,w){const E=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),O=E.vertexLength,x=w.tileAnchorX,C=w.tileAnchorY;for(let M=0;M<4;M++)o.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,e.padding,w.zOffset),this._commitLayoutVertex(o.layoutVertexArray,p,a,f,x,C,new Wt(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,p,a,f,x,C,new Wt(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,p,a,f,x,C,new Wt(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,p,a,f,x,C,new Wt(e.x1,e.y2)),E.vertexLength+=4;const k=o.indexArray;k.emplaceBack(O,O+1),k.emplaceBack(O+1,O+2),k.emplaceBack(O+2,O+3),k.emplaceBack(O+3,O),E.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,p,a,f){for(let w=p;w<a;w++){const E=o.get(w),O=this.getSymbolInstanceTextSize(e,f,i,w);this._addCollisionDebugVertices(E,O,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,i,o,p,a,f){for(let w=p;w<a;w++){const E=o.get(w),O=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._addCollisionDebugVertices(E,O,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,i,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ov(eo,Rb.members,Ja),this.iconCollisionBox=new ov(eo,Rb.members,Ja);const p=tm(this.iconSizeData,e),a=tm(this.textSizeData,e,o);for(let f=0;f<this.symbolInstances.length;f++){const w=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(a,e,i,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(a,e,i,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(p,e,i,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(p,e,i,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(e,i,o,p){const a=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:p),f=I_(this.textSizeData,e,a)/po;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,i,o){const p=this.icon.placedSymbolArray.get(o),a=I_(this.iconSizeData,e,p);return this.tilePixelRatio*a}_commitDebugCollisionVertexUpdate(e,i,o,p){e.emplaceBack(i,-o,-o,p),e.emplaceBack(i,o,-o,p),e.emplaceBack(i,o,o,p),e.emplaceBack(i,-o,o,p)}_updateTextDebugCollisionBoxes(e,i,o,p,a,f,w){for(let E=p;E<a;E++){const O=o.get(E),x=this.getSymbolInstanceTextSize(e,f,i,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,O.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,i,o,p,a,f,w){for(let E=p;E<a;E++){const O=o.get(E),x=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,O.padding,f.zOffset)}}updateCollisionDebugBuffers(e,i,o,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=tm(this.iconSizeData,e,p),f=tm(this.textSizeData,e,o);for(let w=0;w<this.symbolInstances.length;w++){const E=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(f,e,i,E.textBoxStartIndex,E.textBoxEndIndex,E,o),this._updateTextDebugCollisionBoxes(f,e,i,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,o),this._updateIconDebugCollisionBoxes(a,e,i,E.iconBoxStartIndex,E.iconBoxEndIndex,E,p),this._updateIconDebugCollisionBoxes(a,e,i,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,p,a,f,w,E,O){const x={};if(i<o){const{x1:C,y1:k,x2:M,y2:P,padding:R,projectedAnchorX:$,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:Z,featureIndex:ne}=e.get(i);x.textBox={x1:C,y1:k,x2:M,y2:P,padding:R,projectedAnchorX:$,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:Z},x.textFeatureIndex=ne}if(p<a){const{x1:C,y1:k,x2:M,y2:P,padding:R,projectedAnchorX:$,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:Z,featureIndex:ne}=e.get(p);x.verticalTextBox={x1:C,y1:k,x2:M,y2:P,padding:R,projectedAnchorX:$,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:Z},x.verticalTextFeatureIndex=ne}if(f<w){const{x1:C,y1:k,x2:M,y2:P,padding:R,projectedAnchorX:$,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:Z,featureIndex:ne}=e.get(f);x.iconBox={x1:C,y1:k,x2:M,y2:P,padding:R,projectedAnchorX:$,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:Z},x.iconFeatureIndex=ne}if(E<O){const{x1:C,y1:k,x2:M,y2:P,padding:R,projectedAnchorX:$,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:Z,featureIndex:ne}=e.get(E);x.verticalIconBox={x1:C,y1:k,x2:M,y2:P,padding:R,projectedAnchorX:$,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:Z},x.verticalIconFeatureIndex=ne}return x}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),p=o.vertexStartIndex+4*o.numGlyphs;for(let a=o.vertexStartIndex;a<p;a+=4)e.indexArray.emplaceBack(a,a+1,a+2),e.indexArray.emplaceBack(a+1,a+2,a+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),p=[],a=[],f=[];for(let w=0;w<this.symbolInstances.length;++w){f.push(w);const E=this.symbolInstances.get(w);p.push(0|Math.round(i*E.tileAnchorX+o*E.tileAnchorY)),a.push(E.featureIndex)}return f.sort((w,E)=>p[w]-p[E]||a[E]-a[w]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:a,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:O}=o;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),a>=0&&a!==p&&this.addIndicesForPlacedSymbol(this.text,a),f>=0&&f!==a&&f!==p&&this.addIndicesForPlacedSymbol(this.text,f),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),O>=0&&this.addIndicesForPlacedSymbol(this.icon,O)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let f1,m1,av;_i(G_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),G_.addDynamicAttributes=$_;class g1{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ga,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}_i(g1,"FormatSectionOverride",{omit:["defaultValue"]});const lv=()=>av||(av={layout:f1||(f1=new on({"symbol-placement":new Ht(dt.layout_symbol["symbol-placement"]),"symbol-spacing":new Ht(dt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ht(dt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new li(dt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ht(dt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ht(dt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Ht(dt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Ht(dt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ht(dt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ht(dt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ht(dt.layout_symbol["icon-rotation-alignment"]),"icon-size":new li(dt.layout_symbol["icon-size"]),"icon-size-scale-range":new Ht(dt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new li(dt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new li(dt.layout_symbol["icon-text-fit-padding"]),"icon-image":new li(dt.layout_symbol["icon-image"]),"icon-rotate":new li(dt.layout_symbol["icon-rotate"]),"icon-padding":new Ht(dt.layout_symbol["icon-padding"]),"icon-keep-upright":new Ht(dt.layout_symbol["icon-keep-upright"]),"icon-offset":new li(dt.layout_symbol["icon-offset"]),"icon-anchor":new li(dt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ht(dt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ht(dt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ht(dt.layout_symbol["text-rotation-alignment"]),"text-field":new li(dt.layout_symbol["text-field"]),"text-font":new li(dt.layout_symbol["text-font"]),"text-size":new li(dt.layout_symbol["text-size"]),"text-size-scale-range":new Ht(dt.layout_symbol["text-size-scale-range"]),"text-max-width":new li(dt.layout_symbol["text-max-width"]),"text-line-height":new li(dt.layout_symbol["text-line-height"]),"text-letter-spacing":new li(dt.layout_symbol["text-letter-spacing"]),"text-justify":new li(dt.layout_symbol["text-justify"]),"text-radial-offset":new li(dt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ht(dt.layout_symbol["text-variable-anchor"]),"text-anchor":new li(dt.layout_symbol["text-anchor"]),"text-max-angle":new Ht(dt.layout_symbol["text-max-angle"]),"text-writing-mode":new Ht(dt.layout_symbol["text-writing-mode"]),"text-rotate":new li(dt.layout_symbol["text-rotate"]),"text-padding":new Ht(dt.layout_symbol["text-padding"]),"text-keep-upright":new Ht(dt.layout_symbol["text-keep-upright"]),"text-transform":new li(dt.layout_symbol["text-transform"]),"text-offset":new li(dt.layout_symbol["text-offset"]),"text-allow-overlap":new Ht(dt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ht(dt.layout_symbol["text-ignore-placement"]),"text-optional":new Ht(dt.layout_symbol["text-optional"]),visibility:new Ht(dt.layout_symbol.visibility)})),paint:m1||(m1=new on({"icon-opacity":new li(dt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new li(dt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new li(dt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new li(dt.paint_symbol["text-emissive-strength"]),"icon-color":new li(dt.paint_symbol["icon-color"]),"icon-halo-color":new li(dt.paint_symbol["icon-halo-color"]),"icon-halo-width":new li(dt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new li(dt.paint_symbol["icon-halo-blur"]),"icon-translate":new Ht(dt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ht(dt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new li(dt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new li(dt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new li(dt.paint_symbol["text-occlusion-opacity"]),"text-color":new li(dt.paint_symbol["text-color"],{runtimeType:Gs,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new li(dt.paint_symbol["text-halo-color"]),"text-halo-width":new li(dt.paint_symbol["text-halo-width"]),"text-halo-blur":new li(dt.paint_symbol["text-halo-blur"]),"text-translate":new Ht(dt.paint_symbol["text-translate"]),"text-translate-anchor":new Ht(dt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ht(dt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ht(dt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ht(dt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ht(dt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new li(dt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},av);class H_ extends ms{constructor(e,i,o,p){super(e,lv(),i,o,p),this._colorAdjustmentMatrix=Ye.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const p=[];for(const a of o)p.indexOf(a)<0&&p.push(a);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,o,p){return this._saturation===e&&this._contrast===i&&this._brightnessMin===o&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(a,f,w,E){a=Fh(a),f=zh(f);const O=Ye.mat4.create(),x=a/3,C=1-2*x,k=[C,x,x,0,x,C,x,0,x,x,C,0,0,0,0,1],M=.5-.5*f,P=E-w;return Ye.mat4.multiply(O,[P,0,0,0,0,P,0,0,0,0,P,0,w,w,w,1],[f,0,0,0,0,f,0,0,0,0,f,0,M,M,M,1]),Ye.mat4.multiply(O,O,k),O}(e,i,o,p),this._saturation=e,this._contrast=i,this._brightnessMin=o,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,o,p){const a=this.layout.get(e).evaluate(i,{},o,p),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||pu(f.value)||!a?a:function(w,E){return E.replace(/{([^{}]+)}/g,(O,x)=>x in w?String(w[x]):"")}(i.properties,a)}createBucket(e){return new G_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of lv().paint.overridableProperties){if(!H_.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new g1(i),p=new du(o,i.property.specification,this.scope,this.options);let a=null;a=i.value.kind==="constant"||i.value.kind==="source"?new sd("source",p):new dc("composite",p,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new _c(i.property,a,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&H_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),p=lv().paint.properties[i];let a=!1;const f=w=>{for(const E of w)if(p.overrides&&p.overrides.hasOverride(E))return void(a=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Ds)f(o.value.value.sections);else if(o.value.kind==="source"){const w=O=>{a||(O instanceof ws&&Qr(O.value)===ps?f(O.value.sections):O instanceof Ha?f(O.sections):O.eachChild(w))},E=o.value;E._styleExpression&&w(E._styleExpression.expression)}return a}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,o){return{config:new zl(this,{zoom:i,lut:o}),overrideFog:!1}}}let _1,y1,v1,x1;var cv=Ir([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function uv(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function hv(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class dv{constructor(e,i,o,p){this.context=e,this.format=o,this.useMipmap=p&&p.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:p&&p.premultiply})}update(e,i){const o=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,p=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:a}=this,{gl:f}=a,{x:w,y:E}=i&&i.position?i.position:{x:0,y:0},O=w+o,x=E+p;!this.size||this.size[0]===O&&this.size[1]===x||(f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(this.texture),this.texture=f.createTexture(),this.size=null),f.bindTexture(f.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA8&&(!i||i.premultiply!==!1));const C=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&O>0&&x>0){const k=this.useMipmap?Math.floor(Math.log2(Math.max(O,x)))+1:1;f.texStorage2D(f.TEXTURE_2D,k,this.format,O,x),this.size=[O,x]}if(this.size)if(C)f.texSubImage2D(f.TEXTURE_2D,0,w,E,uv(this.format),hv(this.format),e);else{const k=e.data;k&&f.texSubImage2D(f.TEXTURE_2D,0,w,E,o,p,uv(this.format),hv(this.format),k)}this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,i,o=!1){const{context:p}=this,{gl:a}=p;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,o,p){const{context:a}=this,{gl:f}=a;f.bindTexture(f.TEXTURE_2D,this.texture),i!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),this.wrapS=o),p!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,p),this.wrapT=p)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class W_{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:o}=this,{gl:p}=o;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,i),this.wrapS=i)}}function q_(s,e,i,o,p,a,f,w){const E=[s,e,1,i,o,1,p,a,1],O=[f,w,1],x=Ye.mat3.adjoint([],E),[C,k,M]=Ye.vec3.transformMat3(O,O,x);return Ye.mat3.multiply(E,E,[C,0,0,0,k,0,0,0,M])}function b1(s,e,i,o,p,a,f,w){const E=function(O,x,C,k,M,P,R,$){const G=q_(0,0,1,0,1,1,0,1),J=q_(O,x,C,k,M,P,R,$),ee=Ye.mat3.adjoint([],G);return Ye.mat3.multiply(J,J,ee)}(s,e,i,o,p,a,f,w);return[E[2]/E[8]/ei,E[5]/E[8]/ei]}function Y_(s){return[s[0],Math.min(Math.max(s[1],-85.051129),uo)]}class w1 extends aa{constructor(e,i,o,p){super(),this.id=e,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new oa("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Po(this.map._requestManager.transformRequest(this.url,Pr.Image),(o,p)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new Wu(o)):p&&(this.image=p instanceof HTMLImageElement?Fe.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new W_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new oa("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof W_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],o=e[0][1];for(const a of e)a[1]>o&&(o=a[1]),a[1]<i&&(i=a[1]);const p=(o+i)/2;if(p>uo?this.onNorthPole=!0:p<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const a=e.map(n.fromLngLat);this.tileID=function(f){let w=1/0,E=1/0,O=-1/0,x=-1/0;for(const R of f)w=Math.min(w,R.x),E=Math.min(E,R.y),O=Math.max(O,R.x),x=Math.max(x,R.y);const C=Math.max(O-w,x-E),k=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),M=Math.pow(2,k);let P=Math.floor((w+O)/2*M);return P>1&&(P-=1),new Bt(k,P,Math.floor((E+x)/2*M))}(a),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new oa("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const G in this.tiles){const J=this.tiles[G];J.state!=="loaded"&&(J.state="loaded",J.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=pg(new Bt(0,0,0),this.map.transform.projection),o=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(G){const J=G[1].x-G[0].x,ee=G[1].y-G[0].y,Z=G[2].x-G[1].x,ne=G[2].y-G[1].y,le=G[3].x-G[2].x,fe=G[3].y-G[2].y,Ce=G[0].x-G[3].x,Ee=G[0].y-G[3].y,Me=J*ne-Z*ee,$e=Z*fe-le*ne,De=le*Ee-Ce*fe,Ge=Ce*ee-J*Ee;return Me>0&&$e>0&&De>0&&Ge>0||Me<0&&$e<0&&De<0&&Ge<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const p=pg(this.tileID,this.map.transform.projection),[a,f,w,E]=this.coordinates.map(G=>{const J=p.projection.project(G[0],G[1]);return l1(p,J)._round()});this.perspectiveTransform=b1(a.x,a.y,f.x,f.y,w.x,w.y,E.x,E.y);const O=this._boundsArray=new tn;O.emplaceBack(a.x,a.y,0,0),O.emplaceBack(f.x,f.y,ei,0),O.emplaceBack(E.x,E.y,0,ei),O.emplaceBack(w.x,w.y,ei,ei),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(O,cv.members),this.boundsSegments=Sn.simpleSegment(0,0,4,2);const x=[],C=[Y_((k=this.coordinates)[0]),Y_(k[1]),Y_(k[2]),Y_(k[3])];var k;const[M,P,R,$]=function(G){let J=G[0][0],ee=J,Z=G[0][1],ne=Z;for(let le=1;le<G.length;le++)G[le][0]<J?J=G[le][0]:G[le][0]>ee&&(ee=G[le][0]),G[le][1]<Z?Z=G[le][1]:G[le][1]>ne&&(ne=G[le][1]);return[J,Z,ee-J,ne-Z]}(C);{const G=new tn,[J,ee,Z,ne]=function(nt){let ct=nt[0].x,it=ct,Ct=nt[0].y,Nt=Ct;for(let Et=1;Et<nt.length;Et++)nt[Et].x<ct?ct=nt[Et].x:nt[Et].x>it&&(it=nt[Et].x),nt[Et].y<Ct?Ct=nt[Et].y:nt[Et].y>Nt&&(Nt=nt[Et].y);return[ct,Ct,it-ct,Nt-Ct]}(o),le=nt=>[(nt.x-J)/Z,(nt.y-ee)/ne],[fe,Ce,Ee,Me]=o.map(le),$e=function(nt,ct,it,Ct,Nt,Et,si,ti){const Gt=q_(0,0,1,0,1,1,0,1),Ut=q_(nt,ct,it,Ct,Nt,Et,si,ti),xi=Ye.mat3.adjoint([],Ut);return Ye.mat3.multiply(Gt,Gt,xi)}(fe[0],fe[1],Ce[0],Ce[1],Ee[0],Ee[1],Me[0],Me[1]);this.elevatedGlobePerspectiveTransform=b1(fe[0],fe[1],Ce[0],Ce[1],Ee[0],Ee[1],Me[0],Me[1]);const De=(nt,ct)=>{x.push(nt.lng);const it=Math.round((nt.lng-M)/R*ei),Ct=Math.round((nt.lat-P)/$*ei),Nt=le(ct),Et=Ye.vec3.transformMat3([],[Nt[0],Nt[1],1],$e),si=Math.round(Et[0]/Et[2]*ei),ti=Math.round(Et[1]/Et[2]*ei);G.emplaceBack(it,Ct,si,ti)},Ge=o[3].x-o[0].x,Xe=o[3].y-o[0].y,qe=o[2].x-o[1].x,et=o[2].y-o[1].y;for(let nt=0;nt<65;nt++){const ct=nt/64,it=[o[0].x+ct*Ge,o[0].y+ct*Xe],Ct=[o[1].x+ct*qe,o[1].y+ct*et],Nt=Ct[0]-it[0],Et=Ct[1]-it[1];for(let si=0;si<65;si++){const ti=si/64,Gt={x:it[0]+Nt*ti,y:it[1]+Et*ti};De(i.projection.unproject(Gt.x,Gt.y),Gt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(G,cv.members)}{this.maxLongitudeTriangleSize=0;let G=[],J=new gs;const ee=(Z,ne,le)=>{J.emplaceBack(Z,ne,le);const fe=x[Z],Ce=x[ne],Ee=x[le],Me=Math.min(Math.min(fe,Ce),Ee),$e=Math.max(Math.max(fe,Ce),Ee)-Me;$e>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=$e),G.push(Me+$e/2)};for(let Z=0;Z<64;Z++)for(let ne=0;ne<64;ne++){const le=65*Z+ne,fe=le+1,Ce=le+65,Ee=Ce+1;ee(le,Ce,fe),ee(fe,Ce,Ee)}[G,J]=function(Z,ne){const le=Array.from({length:Z.length},(Ee,Me)=>Me);le.sort((Ee,Me)=>Z[Ee]-Z[Me]);const fe=[],Ce=new gs;for(let Ee=0;Ee<le.length;Ee++){const Me=le[Ee];fe.push(Z[Me]);const $e=3*Me,De=$e+1;Ce.emplaceBack(ne.uint16[$e],ne.uint16[De],ne.uint16[De+1])}return[fe,Ce]}(G,J),this.elevatedGlobeTrianglesCenterLongitudes=G,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(J)}this.elevatedGlobeSegments=Sn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/ei,0,$/ei,0,0,P,M,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof W_||(this.texture?this.texture.update(this.image):(this.texture=new dv(i,this.image,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const o=this.elevatedGlobeTrianglesCenterLongitudes;let p=(a=e+180)+360*Math.round((o[0]-a)/360);var a;const f=new Sn,w=(C,k)=>{f.segments.push({vertexOffset:0,primitiveOffset:C,vertexLength:i.segments[0].vertexLength,primitiveLength:k,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-p)<=E){const C=$c(o,0,o.length,p+E);return C===o.length||w(C,Ps(o,C+1,o.length,p+360-E)-C),f}p<o[0]&&(p+=360);const O=Ps(o,0,o.length,p-E);if(O===o.length)return w(0,o.length),f;w(0,O-0);const x=$c(o,O+1,o.length,p+E);return x!==o.length&&w(x,o.length-x),f}}const DE=(Math.pow(256,2)-1)/16907520;class S1 extends ms{constructor(e,i,o,p){super(e,{layout:v1||(v1=new on({visibility:new Ht(dt.layout_raster.visibility)})),paint:x1||(x1=new on({"raster-opacity":new Ht(dt.paint_raster["raster-opacity"]),"raster-color":new Ka(dt.paint_raster["raster-color"]),"raster-color-mix":new Ht(dt.paint_raster["raster-color-mix"]),"raster-color-range":new Ht(dt.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ht(dt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ht(dt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ht(dt.paint_raster["raster-brightness-max"]),"raster-saturation":new Ht(dt.paint_raster["raster-saturation"]),"raster-contrast":new Ht(dt.paint_raster["raster-contrast"]),"raster-resampling":new Ht(dt.paint_raster["raster-resampling"]),"raster-fade-duration":new Ht(dt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ht(dt.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ht(dt.paint_raster["raster-array-band"]),"raster-elevation":new Ht(dt.paint_raster["raster-elevation"]),"raster-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},i,o,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof w1&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[o,p]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(p)||o===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=Bp({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,p])}}let T1,M1,E1,C1,A1;class P1 extends ms{constructor(e,i,o,p){super(e,{layout:T1||(T1=new on({visibility:new Ht(dt["layout_raster-particle"].visibility)})),paint:M1||(M1=new on({"raster-particle-array-band":new Ht(dt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ht(dt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ka(dt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ht(dt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ht(dt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ht(dt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ht(dt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Ht(dt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},i,o,p),this._updateColorRamp(),this.lastInvalidatedAt=Fe.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Bp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Fe.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class kE extends ms{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function pv(s,e,i){const o=[0,0,1],p=Ye.quat.identity([]);return Ye.quat.rotateY(p,p,i?-rr(s)+Math.PI:rr(s)),Ye.quat.rotateX(p,p,-rr(e)),Ye.vec3.transformQuat(o,o,p),Ye.vec3.normalize(o,o)}function I1(s,e){const i=X_(s.projection,s.zoom,s.width,s.height),o=function(a,f,w,E,O){const x=new Er(w.lng-180*Id,w.lat),C=new Er(w.lng+180*Id,w.lat),k=a.project(x.lng,x.lat),M=a.project(C.lng,C.lat),P=-Math.atan2(M.y-k.y,M.x-k.x),R=n.fromLngLat(w);R.y=nr(R.y,-1+Id,1-Id);const $=R.toLngLat(),G=a.project($.lng,$.lat),J=n.fromLngLat($);J.x+=Id;const ee=J.toLngLat(),Z=a.project(ee.lng,ee.lat),ne=k1(Z.x-G.x,Z.y-G.y,P),le=n.fromLngLat($);le.y+=Id;const fe=le.toLngLat(),Ce=a.project(fe.lng,fe.lat),Ee=k1(Ce.x-G.x,Ce.y-G.y,P),Me=Math.abs(ne.x)/Math.abs(Ee.y),$e=Ye.mat4.identity([]);Ye.mat4.rotateZ($e,$e,-P*(1-(O?0:E)));const De=Ye.mat4.identity([]);return Ye.mat4.scale(De,De,[1,1-(1-Me)*E,1]),De[4]=-Ee.x/Ee.y*E,Ye.mat4.rotateZ(De,De,P),Ye.mat4.multiply(De,$e,De),De}(s.projection,0,s.center,i,e),p=D1(s);return Ye.mat4.scale(o,o,[p,p,1]),o}function D1(s){const e=s.projection,i=X_(s.projection,s.zoom,s.width,s.height),o=fv(e,s.center),p=fv(e,Er.convert(e.center));return Math.pow(2,o*i+(1-i)*p)}function X_(s,e,i,o,p=1/0){const a=s.range;if(!a)return 0;const f=Math.min(p,Math.max(i,o)),w=Math.log(f/1024)/Math.LN2;return Kr(a[0]+w,a[1]+w,e)}const Id=1/4e4;function fv(s,e){const i=nr(e.lat,-85.051129,uo),o=new Er(e.lng-180*Id,i),p=new Er(e.lng+180*Id,i),a=s.project(o.lng,i),f=s.project(p.lng,i),w=n.fromLngLat(o),E=n.fromLngLat(p),O=f.x-a.x,x=f.y-a.y,C=E.x-w.x,k=E.y-w.y,M=Math.sqrt((C*C+k*k)/(O*O+x*x));return Math.log(M)/Math.LN2}function k1(s,e,i){const o=Math.cos(i),p=Math.sin(i);return{x:s*o-e*p,y:s*p+e*o}}function O1(s,e,i){Ye.mat4.identity(s),Ye.mat4.rotateZ(s,s,rr(e[2])),Ye.mat4.rotateX(s,s,rr(e[0])),Ye.mat4.rotateY(s,s,rr(e[1])),Ye.mat4.scale(s,s,i),Ye.mat4.multiply(s,s,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Z_(s,e,i,o,p,a,f,w){const E=[i[0]-e[0],i[1]-e[1],0],O=[o[0]-e[0],o[1]-e[1],0];if(Ye.vec3.length(E)<1e-12||Ye.vec3.length(O)<1e-12)return Ye.quat.identity(s);const x=Ye.vec3.cross([],E,O);Ye.vec3.normalize(x,x),Ye.vec3.subtract(O,o,e),E[2]=(a-p)*w,O[2]=(f-p)*w;const C=E;return Ye.vec3.cross(C,E,O),Ye.vec3.normalize(C,C),Ye.quat.rotationTo(s,x,C)}function mv(s,e,i=!1){const o=ho(e.zoom),p=function(a,f,w){const E=f.worldSize,O=[a[12],a[13],a[14]],x=Wn(O[1]/E),C=co(O[0]/E),k=Ye.mat4.identity([]),M=to(1,x)*E,P=to(1,0)*E*Nl(x,f.zoom),R=1/zs(E);let $=P*R;if(w){const Z=X_(f.projection,f.zoom,f.width,f.height,1024);$=R*f.projection.pixelSpaceConversion(f.center.lat,E,Z)}const G=ga(x,C);Ye.vec3.add(G,G,Ye.vec3.scale([],Ye.vec3.normalize([],G),M*$*O[2]));const J=function(Z){const ne=[Z[0],Z[1],Z[2]];let le=[0,1,0];const fe=Ye.vec3.cross([],le,ne);return Ye.vec3.cross(le,ne,fe),Ye.vec3.squaredLength(le)===0&&(le=[0,1,0],Ye.vec3.cross(fe,ne,le)),Ye.vec3.normalize(fe,fe),Ye.vec3.normalize(le,le),Ye.vec3.normalize(ne,ne),[fe[0],fe[1],fe[2],0,le[0],le[1],le[2],0,ne[0],ne[1],ne[2],0,Z[0],Z[1],Z[2],1]}(G);Ye.mat4.scale(k,k,[$,$,$*M]),Ye.mat4.translate(k,k,[-O[0],-O[1],-O[2]]);const ee=Ye.mat4.multiply([],f.globeMatrix,J);return Ye.mat4.multiply(ee,ee,k),Ye.mat4.multiply(ee,ee,a),ee}(s,e,i);if(o>0){const a=function(f,w){const E=w.worldSize,O=to(1,0)*E*Nl(w.center.lat,w.zoom)/zs(E),x=to(1,w.center.lat)*E,C=Ye.mat4.identity([]);return Ye.mat4.rotateY(C,C,rr(w.center.lng)),Ye.mat4.rotateX(C,C,rr(w.center.lat)),Ye.mat4.translate(C,C,[0,0,Hn]),Ye.mat4.scale(C,C,[O,O,O*x]),Ye.mat4.translate(C,C,[w.point.x-.5*E,w.point.y-.5*E,0]),Ye.mat4.multiply(C,C,f),Ye.mat4.multiply(C,w.globeMatrix,C)}(s,e);return function(f,w,E){const O=(P,R,$)=>{const G=Ye.vec3.length(P),J=Ye.vec3.length(R),ee=qn(P,R,$);return Ye.vec3.scale(ee,ee,1/Ye.vec3.length(ee)*Ii(G,J,$))},x=O([f[0],f[1],f[2]],[w[0],w[1],w[2]],E),C=O([f[4],f[5],f[6]],[w[4],w[5],w[6]],E),k=O([f[8],f[9],f[10]],[w[8],w[9],w[10]],E),M=qn([f[12],f[13],f[14]],[w[12],w[13],w[14]],E);return[x[0],x[1],x[2],0,C[0],C[1],C[2],0,k[0],k[1],k[2],0,M[0],M[1],M[2],1]}(p,a,o)}return p}function L1(s,e,i,o){const p=bi.projectAabbCorners(o,i);let a=Number.MAX_VALUE,f=-1;for(let O=0;O<p.length;++O){const x=p[O];x[0]=(.5*x[0]+.5)*e.width,x[1]=(.5-.5*x[1])*e.height,x[2]<a&&(f=O,a=x[2])}const w=O=>new Wt(p[O][0],p[O][1]);let E;switch(f){case 0:case 6:E=[w(1),w(5),w(4),w(7),w(3),w(2),w(1)];break;case 1:case 7:E=[w(0),w(4),w(5),w(6),w(2),w(3),w(0)];break;case 3:case 5:E=[w(1),w(0),w(4),w(7),w(6),w(2),w(1)];break;default:E=[w(1),w(5),w(6),w(7),w(3),w(0),w(1)]}if(oe(s,E))return a}const OE=Ir([{name:"a_pos_3f",components:3,type:"Float32"}]),LE=Ir([{name:"a_color_3f",components:3,type:"Float32"}]),RE=Ir([{name:"a_color_4f",components:4,type:"Float32"}]),zE=Ir([{name:"a_uv_2f",components:2,type:"Float32"}]),FE=Ir([{name:"a_normal_3f",components:3,type:"Float32"}]),BE=Ir([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),NE=Ir([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),R1={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class K_{constructor(e,i,o,p){this.message=(e?`${e}: `:"")+o,p&&(this.identifier=p),i!=null&&i.__line__&&(this.line=i.__line__)}}function z1(s,e){const i=s.indexOf("://")===-1;try{return new URL(s,i&&e?"http://example.com":void 0),!0}catch{return!1}}class F1{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class B1{constructor(){this.instancedDataArray=new Fo,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class gv{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,i){}populate(e,i,o,p){this.tileToMeter=t(o);const a=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:f,id:w,index:E,sourceLayerIndex:O}of e){const x=w??(f.properties&&f.properties.hasOwnProperty("id")?f.properties.id:void 0),C=H(f,a);if(!this.layers[0]._featureFilter.filter(new Vr(this.zoom),C,o))continue;const k={id:x,sourceLayerIndex:O,index:E,geometry:a?C.geometry:j(f,o,p),properties:f.properties,type:f.type,patterns:{}},M=this.addFeature(k,k.geometry,C);M&&i.featureIndex.insert(f,k.geometry,E,O,this.index,this.instancesPerModel[M].instancedDataArray.length,ei/32)}this.lookup=null}update(e,i,o,p){for(const a in this.instancesPerModel){const f=this.instancesPerModel[a];for(const w in e)f.idToFeaturesIndex.hasOwnProperty(w)&&(this.evaluate(f.features[f.idToFeaturesIndex[w]],e[w],f,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];for(const p of o.features){const a=this.layers[0],f=p.feature,w=this.canonical,E=a.paint.get("model-rotation").evaluate(f,{},w),O=a.paint.get("model-scale").evaluate(f,{},w),x=a.paint.get("model-translation").evaluate(f,{},w);Ye.vec3.exactEquals(p.rotation,E)&&Ye.vec3.exactEquals(p.scale,O)&&Ye.vec3.exactEquals(p.translation,x)||(this.evaluate(p,p.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,i,o,p){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(mi(this.activeReplacements,a))return!1;this.activeReplacements=a;let f=!1;for(const w in this.instancesPerModel){const E=this.instancesPerModel[w],O=E.instancedDataArray;for(const x of E.features){const C=x.instancedDataOffset,k=x.instancedDataCount;for(let M=0;M<k;M++){const P=16*(M+C);let R=O.float32[P+0];const $=R>ei;R=$?R-ei:R;const G=Math.floor(R),J=O.float32[P+1];let ee=!1;for(const Z of this.activeReplacements)if(!Ot(Z,o,R1.Model,p)&&!(Z.min.x>G||G>Z.max.x||Z.min.y>J||J>Z.max.y)&&(ee=Hi(kr(G,J,e.canonical,Z.footprintTileId.canonical),Z.footprint),ee))break;O.float32[P]=ee?R+ei:R,f=f||ee!==$}}}return f}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,BE.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const i of this.modelUris)e.removeModel(i,"")}addFeature(e,i,o){const p=this.layers[0],a=p.layout.get("model-id").evaluate(o,{},this.canonical);if(!a)return qi(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),a;z1(a,!1)&&(this.modelUris.includes(a)||this.modelUris.push(a)),this.instancesPerModel[a]||(this.instancesPerModel[a]=new B1);const f=this.instancesPerModel[a],w=f.instancedDataArray,E=new F1(o,w.length);for(const O of i)for(const x of O){if(x.x<0||x.x>=ei||x.y<0||x.y>=ei)continue;const C=(this.lookupDim-1)/ei,k=this.lookupDim*(x.y*C|0)+x.x*C|0;if(this.lookup){if(this.lookup[k]!==0)continue;this.lookup[k]=1}this.instanceCount++;const M=w.length;w.resize(M+1),f.instancesEvaluatedElevation.push(0),w.float32[16*M]=x.x,w.float32[16*M+1]=x.y}return E.instancedDataCount=f.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(E),this.evaluate(E,{},f,!1)),a}getModelUris(){return this.modelUris}evaluate(e,i,o,p){const a=this.layers[0],f=e.feature,w=this.canonical,E=e.rotation=a.paint.get("model-rotation").evaluate(f,i,w),O=e.scale=a.paint.get("model-scale").evaluate(f,i,w),x=e.translation=a.paint.get("model-translation").evaluate(f,i,w),C=a.paint.get("model-color").evaluate(f,i,w);C.a=a.paint.get("model-color-mix-intensity").evaluate(f,i,w);const k=[];this.maxVerticalOffset<x[2]&&(this.maxVerticalOffset=x[2]),this.maxScale=Math.max(Math.max(this.maxScale,O[0]),Math.max(O[1],O[2])),O1(k,E,O);const M=Math.round(100*C.a)+C.b/1.05;for(let P=0;P<e.instancedDataCount;++P){const R=e.instancedDataOffset+P,$=16*R,G=o.instancedDataArray.float32;let J=0;p&&(J=G[$+6]-o.instancesEvaluatedElevation[R]);const ee=0|G[$+1];G[$]=(0|G[$])+C.r/1.05,G[$+1]=ee+C.g/1.05,G[$+2]=M,G[$+3]=1/(w.z>10?this.tileToMeter:t(w,ee)),G[$+4]=x[0],G[$+5]=x[1],G[$+6]=x[2]+J,G[$+7]=k[0],G[$+8]=k[1],G[$+9]=k[2],G[$+10]=k[4],G[$+11]=k[5],G[$+12]=k[6],G[$+13]=k[8],G[$+14]=k[9],G[$+15]=k[10],o.instancesEvaluatedElevation[R]=x[2]}}}let N1,V1;_i(gv,"ModelBucket",{omit:["layers"]}),_i(B1,"PerModelAttributes"),_i(F1,"ModelFeature");const qp=64,om={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function U1(s,e,i,o,p,a,f,w,E,O=!1){const x=i.zoom,C=i.project(o),k=Nl(o.lat,x),M=1/k;Ye.mat4.identity(s),Ye.mat4.translate(s,s,[C.x+f[0]*M,C.y+f[1]*M,f[2]]);let P=1,R=1;const $=i.worldSize;if(O){if(i.projection.name==="mercator"){let Z=0;i.elevation&&(Z=i.elevation.getAtPointOrZero(new n(C.x/$,C.y/$),0));const ne=Ye.vec4.transformMat4([],[C.x,C.y,Z,1],i.projMatrix)[3]/i.cameraToCenterDistance;P=ne,R=ne*Nl(i.center.lat,x)}else if(i.projection.name==="globe"){const Z=mv(s,i),ne=Ye.mat4.multiply([],i.projMatrix,Z),le=[0,0,0,1];Ye.vec4.transformMat4(le,le,ne);const fe=le[3]/i.cameraToCenterDistance,Ce=ho(x),Ee=i.projection.pixelsPerMeter(o.lat,$)*Nl(o.lat,x),Me=i.projection.pixelsPerMeter(i.center.lat,$)*Nl(i.center.lat,x);P=fe/Ii(Ee,Fp(i.center.lat),Ce),R=fe*k/Ee,P*=Me,R*=Me}}else P=M;Ye.mat4.scale(s,s,[P,P,R]);const G=[...s],J=e.orientation,ee=[];if(O1(ee,[J[0]+p[0],J[1]+p[1],J[2]+p[2]],a),Ye.mat4.multiply(s,G,ee),w&&i.elevation){let Z=0;const ne=[];if(E&&i.elevation){Z=function(Ce,Ee,Me,$e,De){const Ge=Ee.elevation;if(!Ge)return 0;const Xe=bi.projectAabbCorners(Me,$e),qe=to(1,De.lat)*Ee.worldSize,et=function(xi,ui){const fi=[0,0,1],Ni=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ki of Ni){const er=xi[Ki.corners[0]],tr=xi[Ki.corners[1]],cr=xi[Ki.corners[2]],ur=[tr[0]-er[0],tr[1]-er[1],ui*(tr[2]-er[2])],nn=Ye.vec3.cross(ur,ur,[cr[0]-er[0],cr[1]-er[1],ui*(cr[2]-er[2])]);Ye.vec3.normalize(nn,nn),Ki.dotProductWithUp=Ye.vec3.dot(nn,fi)}return Ni.sort((Ki,er)=>Ki.dotProductWithUp-er.dotProductWithUp),Ni[0].corners}(Xe,qe),nt=Xe[et[0]],ct=Xe[et[1]],it=Xe[et[2]],Ct=Xe[et[3]],Nt=Ge.getAtPointOrZero(new n(nt[0]/Ee.worldSize,nt[1]/Ee.worldSize),0),Et=Ge.getAtPointOrZero(new n(ct[0]/Ee.worldSize,ct[1]/Ee.worldSize),0),si=Ge.getAtPointOrZero(new n(it[0]/Ee.worldSize,it[1]/Ee.worldSize),0),ti=Ge.getAtPointOrZero(new n(Ct[0]/Ee.worldSize,Ct[1]/Ee.worldSize),0),Gt=(Nt+ti)/2,Ut=(Et+si)/2;return Gt>Ut?Et<si?Z_(Ce,ct,Ct,nt,Et,ti,Nt,qe):Z_(Ce,it,nt,Ct,si,Nt,ti,qe):Nt<ti?Z_(Ce,nt,ct,it,Nt,Et,si,qe):Z_(Ce,Ct,it,ct,ti,si,Et,qe),Math.max(Gt,Ut)}(ne,i,e.aabb,s,o);const le=Ye.mat4.fromQuat([],ne),fe=Ye.mat4.multiply([],le,ee);Ye.mat4.multiply(s,G,fe)}else Z=i.elevation.getAtPointOrZero(new n(C.x/$,C.y/$),0);Z!==0&&(s[14]+=Z)}}function yg(s,e,i=!1){s.uploaded||(s.gfxTexture=new dv(e,s.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:s.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),s.uploaded=!0,s.image=null)}function VE(s,e,i){s.indexBuffer=e.createIndexBuffer(s.indexArray,!1,!0),s.vertexBuffer=e.createVertexBuffer(s.vertexArray,OE.members,!1,!0),s.normalArray&&(s.normalBuffer=e.createVertexBuffer(s.normalArray,FE.members,!1,!0)),s.texcoordArray&&(s.texcoordBuffer=e.createVertexBuffer(s.texcoordArray,zE.members,!1,!0)),s.colorArray&&(s.colorBuffer=e.createVertexBuffer(s.colorArray,(s.colorArray.bytesPerElement===12?LE:RE).members,!1,!0)),s.featureArray&&(s.pbrBuffer=e.createVertexBuffer(s.featureArray,NE.members,!0)),s.segments=Sn.simpleSegment(0,0,s.vertexArray.length,s.indexArray.length);const o=s.material;o.pbrMetallicRoughness.baseColorTexture&&yg(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&yg(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&yg(o.normalTexture,e),o.occlusionTexture&&yg(o.occlusionTexture,e,i),o.emissionTexture&&yg(o.emissionTexture,e)}function _v(s,e,i){if(s.meshes)for(const o of s.meshes)VE(o,e,i);if(s.children)for(const o of s.children)_v(o,e,i)}function J_(s){if(s.meshes)for(const e of s.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(s.children)for(const e of s.children)J_(e)}function yv(s){if(s.meshes)for(const i of s.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(s.children)for(const i of s.children)yv(i)}class am{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){const p=o||e.findDEMTileFor(i);if(!p||!p.dem)return;const a=p.dem,f=p.tileID,w=1<<i.canonical.z-f.canonical.z;return new am(p,a.dim/ei/w,[(i.canonical.x/w-f.canonical.x)*a.dim,(i.canonical.y/w-f.canonical.y)*a.dim])}tileCoordToPixel(e,i){const o=i*this._scale+this._offset[1],p=Math.floor(e*this._scale+this._offset[0]),a=Math.floor(o);return new Wt(p,a)}getElevationAt(e,i,o,p){const a=e*this._scale+this._offset[0],f=i*this._scale+this._offset[1],w=Math.floor(a),E=Math.floor(f),O=this._dem;return p=!!p,o?Ii(Ii(O.get(w,E,p),O.get(w,E+1,p),f-E),Ii(O.get(w+1,E,p),O.get(w+1,E+1,p),f-E),a-w):O.get(w,E,p)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*to(1,e)*this._dem.stride}}const vv=new Float32Array(262144),Yp=new Uint8Array(262144);function j1(s){let e=0;if(s.meshes)for(const i of s.meshes)e=Math.max(e,i.aabb.max[2]);if(s.children)for(const i of s.children)e=Math.max(e,j1(i));return e}function $1(s,e,i){if(s.meshes)for(const o of s.meshes){if(o.aabb.min[0]===1/0)continue;const p=bi.applyTransform(o.aabb,s.matrix);i.insert(e,p.min[0],p.min[1],p.max[0],p.max[1])}if(s.children)for(const o of s.children)$1(o,e,i)}const G1=["","wall","door","roof","window","lamp","logo"];class H1{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:j1(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new bi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new bi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=bi.applyTransformFast(o.aabb,this.node.matrix),i.encapsulate(o.transformedAabb)),e++;this.aabb=i}return this.aabb}}class Q_{constructor(e,i,o,p,a,f,w){this.id=o,this.layers=e,this.layerIds=this.layers.map(E=>E.fqid),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.modelTraits|=om.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=om.HasMapboxMeshFeatures),a&&(this.modelTraits|=om.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=f,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const E of i)this.nodesInfo.push(new H1(E)),$1(E,w.featureIndexArray.length,w.grid),w.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,w.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const o of this.getNodesInfo()){const p=o.node;p.footprint&&i.push({footprint:p.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const o=i?this.stateDependentLayers:this.layers;if(!jn(e,this.states))for(const p of o)this.evaluate(p,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const o of i){const p=o.node;this.uploaded?this.updatePbrBuffer(p):_v(p,e,!0)}for(const o of i)J_(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(e,i,o){const p=e.transform.projectionOptions,a=e.style.getBrightness(),f=this.brightness!==a;if(!this.uploaded||this.dirty||p.name!==this.projection.name||vg(o.paint.get("model-color").value,f)||vg(o.paint.get("model-color-mix-intensity").value,f)||vg(o.paint.get("model-roughness").value,f)||vg(o.paint.get("model-emissive-strength").value,f)||vg(o.paint.get("model-height-based-emissive-strength-multiplier").value,f)){this.projection=p,this.brightness=a;const w=this.getNodesInfo();for(const E of w)E.state=null;return!0}return!1}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const o=this.getNodesInfo(),p=this.id.canonical;for(const a of o){const f=a.feature;a.evaluatedScale=i.paint.get("model-scale").evaluate(f,{},p)}}evaluate(e,i){const o=this.getNodesInfo();for(const p of o){if(!p.node.meshes)continue;const a=p.feature,f=i&&i[a.id];if(jn(f,p.state))continue;p.state=structuredClone(f);const w=p.node.meshes&&p.node.meshes[0].featureData,E=p.evaluatedColor[2],O=p.evaluatedRMEA[2],x=this.id.canonical;if(p.hasTranslucentParts=!1,w){for(let C=0;C<G1.length;C++){const k=G1[C];k.length&&(a.properties.part=k);const M=e.paint.get("model-color").evaluate(a,f,x).toRenderColor(null),P=e.paint.get("model-color-mix-intensity").evaluate(a,f,x);p.evaluatedColor[C]=[M.r,M.g,M.b,P],p.evaluatedRMEA[C][0]=e.paint.get("model-roughness").evaluate(a,f,x),p.evaluatedRMEA[C][2]=e.paint.get("model-emissive-strength").evaluate(a,f,x),p.evaluatedRMEA[C][3]=M.a,p.emissionHeightBasedParams[C]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(a,f,x),!p.hasTranslucentParts&&M.a<1&&(p.hasTranslucentParts=!0)}delete a.properties.part,jE(p,E!==p.evaluatedColor[2]||O!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(a,f,x);p.evaluatedScale=e.paint.get("model-scale").evaluate(a,f,x),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,o,p){const a=e.findDEMTileFor(o);if(a&&(a.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(a.dem&&a.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=a.tileID.overscaledZ;const f=am.create(e,o,a);if(!f)return;this.modelTraits&om.HasMapboxMeshFeatures&&this.updateDEM(e,f,o,p);for(const w of this.getNodesInfo()){const E=w.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const O=E.footprint.vertices;let x=f.getElevationAt(O[0].x,O[0].y,!0,!0);for(let C=1;C<O.length;C++)x=Math.min(x,f.getElevationAt(O[C].x,O[C].y,!0,!0));E.elevation=x}}this.terrainTile=a.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,o,p){let a=i._dem._modifiedForSources[p];if(a===void 0&&(i._dem._modifiedForSources[p]=[],a=i._dem._modifiedForSources[p]),a.includes(o.canonical))return;const f=i._dem.dim;a.push(o.canonical);let w=!1;for(const E of this.getNodesInfo()){const O=E.node;if(!O.footprint||!O.footprint.grid)continue;const x=O.footprint.grid,C=i.tileCoordToPixel(x.min.x,x.min.y),k=i.tileCoordToPixel(x.max.x,x.max.y),M=Math.min(Math.min(f-k.y,C.x),Math.min(C.y,f-k.x));if(M<0)continue;const P=nr(M,2,5);let R=Math.max(0,C.x-P),$=Math.max(0,C.y-P),G=Math.min(k.x+P,f-1),J=Math.min(k.y+P,f-1);for(let le=$;le<=J;++le)for(let fe=R;fe<=G;++fe)Yp[le*f+fe]=255;let ee=0,Z=0;for(let le=0;le<x.cellsY;++le)for(let fe=0;fe<x.cellsX;++fe){if(!x.cells[le*x.cellsX+fe])continue;const Ce=i.tileCoordToPixel(x.min.x+fe/x.xScale,x.min.y+le/x.yScale),Ee=i.tileCoordToPixel(x.min.x+(fe+1)/x.xScale,x.min.y+(le+1)/x.yScale);for(let Me=Ce.y;Me<=Math.min(Ee.y+1,f-1);++Me)for(let $e=Ce.x;$e<=Math.min(Ee.x+1,f-1);++$e)Yp[Me*f+$e]===255&&(Yp[Me*f+$e]=0,ee+=i.getElevationAtPixel($e,Me),Z++)}const ne=ee/Z;R=Math.max(1,C.x-P),$=Math.max(1,C.y-P),G=Math.min(k.x+P,f-2),J=Math.min(k.y+P,f-2),w=!0;for(let le=$;le<=J;++le)for(let fe=R;fe<=G;++fe)Yp[le*f+fe]===0&&(vv[le*f+fe]=i._dem.set(fe,le,ne));for(let le=1;le<P;++le){R=Math.max(1,C.x-le),$=Math.max(1,C.y-le),G=Math.min(k.x+le,f-2),J=Math.min(k.y+le,f-2);for(let fe=$;fe<=J;++fe)for(let Ce=R;Ce<=G;++Ce){const Ee=fe*f+Ce;if(Yp[Ee]===255){let Me=0,$e=0,De=-1,Ge=-1;for(let Xe=-1;Xe<=1;++Xe)for(let qe=-1;qe<=1;++qe){const et=(fe+Xe)*f+Ce+qe;if(Yp[et]>=le)continue;const nt=vv[et],ct=Math.abs(nt);ct>$e&&(Me=nt,$e=ct,De=qe,Ge=Xe)}if($e>.1){const Xe=1-(le+.5*Math.abs(De*Ge))/P;let qe=i._dem.get(Ce,fe)+Me*Xe;const et=i._dem.get(Ce+De,fe+Ge),nt=i._dem.get(Ce-De,fe-Ge,!0);(qe-et)*(qe-nt)>0&&(qe=(et+nt)/2),vv[Ee]=i._dem.set(Ce,fe,qe),Yp[Ee]=le}}}}}w&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Fe.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)J_(i.node),yv(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped()),p=this.getNodesInfo();for(let a=0;a<this.nodesInfo.length;a++){const f=p[a].node;p[a].hiddenByReplacement=!!f.footprint&&!o.find(w=>w.footprint===f.footprint)}}getHeightAtTileCoord(e,i){const o=this.getNodesInfo(),p=[],a=[0,0,0],f=Ye.mat4.identity([]);for(let w=0;w<this.nodesInfo.length;w++){const E=o[w],O=E.node.meshes[0],x=O.transformedAabb;if(e<x.min[0]||i<x.min[1]||e>x.max[0]||i>x.max[1])continue;if(E.node.hidden===!0)return{height:1/0,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};Ye.mat4.invert(f,E.node.matrix),a[0]=e,a[1]=i,Ye.vec3.transformMat4(a,a,f);const C=(a[0]-O.aabb.min[0])/(O.aabb.max[0]-O.aabb.min[0])*qp|0,k=Math.min(63,(a[1]-O.aabb.min[1])/(O.aabb.max[1]-O.aabb.min[1])*qp|0)*qp+Math.min(63,C),M=O.heightmap[k];if(!(M<0&&E.node.footprint))return E.hiddenByReplacement?void 0:{height:M,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};if(E.node.footprint.grid.query(new Wt(e,i),new Wt(e,i),p),p.length>0)return{height:void 0,maxHeight:E.feature.properties.height,hidden:E.hiddenByReplacement,verticalScale:E.evaluatedScale[2]}}}}function vg(s,e){return!s.isLightConstant&&e}function UE(s,e,i,o,p,a,f,w){let E=(61440&e|(61440&e)>>4)>>8,O=(3840&e|(3840&e)>>4)>>4,x=240&e|(240&e)>>4;i[3]>0&&(E=Ii(E,255*i[0],i[3]),O=Ii(O,255*i[1],i[3]),x=Ii(x,255*i[2],i[3]));const C=E<<8|O,k=x<<8|Math.floor(255*o[3]),M=function(le){const fe=nr(le,0,2);return Math.min(Math.round(.5*fe*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],P=nr(p[0],0,1),R=nr(p[1],0,1),$=nr(p[2],0,1),G=nr(p[3],0,1);let J,ee,Z,ne;if(P!==R&&f!==a&&R!==P){const le=f-a;ee=1/(le*(R-P)),Z=-(a+le*P)/(le*(R-P));const fe=nr(p[4],-1,1);ne=Math.pow(10,fe),J=255*$<<8|255*G}else J=65535,ee=0,Z=1,ne=1;if(s.emplaceBack(C,k,M,J,ee,Z,ne),w){const le=w.length;w.clear();for(let fe=0;fe<le;fe++)w.emplaceBack(C,k,M,J,ee,Z,ne)}}function jE(s,e,i){const o=s.node;let p=0;const a=i&om.HasMeshoptCompression;for(const f of o.meshes){if(o.lights&&o.lightMeshIndex===p||!f.featureData)continue;f.featureArray=new bu,f.featureArray.reserve(f.featureData.length);let w=e;for(const E of f.featureData){const O=a?65535&E:E>>16&65535,x=a?E>>16&65535:65535&E,C=(15&x)<8?15&x:0,k=s.evaluatedRMEA[C],M=s.evaluatedColor[C],P=s.emissionHeightBasedParams[C];let R;if(w&&C===2&&o.lights&&(R=new bu,R.resize(10*o.lights.length)),UE(f.featureArray,O,M,k,P,f.aabb.min[2],f.aabb.max[2],R),R&&w){w=!1;const $=o.meshes[o.lightMeshIndex];$.featureArray=R,$.featureArray._trim()}}f.featureArray._trim(),p++}}function W1(s,e,i,o){const p=1<<s.z;e.lat=Wn((o/ei+s.y)/p),e.lng=co((i/ei+s.x)/p)}_i(Q_,"Tiled3dModelBucket",{omit:["layers"]}),_i(H1,"Tiled3dModelFeature");const $E={circle:class extends ms{constructor(s,e,i,o){super(s,{layout:Vt||(Vt=new on({"circle-sort-key":new li(dt.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Ht(dt.layout_circle["circle-elevation-reference"]),visibility:new Ht(dt.layout_circle.visibility)})),paint:st||(st=new on({"circle-radius":new li(dt.paint_circle["circle-radius"]),"circle-color":new li(dt.paint_circle["circle-color"]),"circle-blur":new li(dt.paint_circle["circle-blur"]),"circle-opacity":new li(dt.paint_circle["circle-opacity"]),"circle-translate":new Ht(dt.paint_circle["circle-translate"]),"circle-translate-anchor":new Ht(dt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ht(dt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ht(dt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new li(dt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new li(dt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new li(dt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ht(dt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}createBucket(s){return new ce(s)}queryRadius(s){const e=s;return It("circle-radius",this,e)+It("circle-stroke-width",this,e)+At(this.paint.get("circle-translate"))}queryIntersectsFeature(s,e,i,o,p,a,f,w){const E=wt(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,s.pixelToTileUnitsFactor),O=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return bd(s,o,a,f,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,O)}getProgramIds(){return["circle"]}getDefaultProgramParams(s,e,i){const o=Ac(this);return{config:new zl(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}},heatmap:class extends ms{createBucket(s){return new d_(s)}constructor(s,e,i,o){super(s,{layout:p_||(p_=new on({visibility:new Ht(dt.layout_heatmap.visibility)})),paint:Jm||(Jm=new on({"heatmap-radius":new li(dt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new li(dt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ht(dt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ka(dt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ht(dt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Bp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return It("heatmap-radius",this,s)}queryIntersectsFeature(s,e,i,o,p,a,f,w){const E=this.paint.get("heatmap-radius").evaluate(e,i);return bd(s,o,a,f,w,!0,!0,new Wt(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(s,e,i){return s==="heatmap"?{config:new zl(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends ms{constructor(s,e,i,o){super(s,{layout:f_||(f_=new on({visibility:new Ht(dt.layout_hillshade.visibility)})),paint:Qm||(Qm=new on({"hillshade-illumination-direction":new Ht(dt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ht(dt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ht(dt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ht(dt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ht(dt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ht(dt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ht(dt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(s,e,i){return{overrideFog:!1}}},fill:class extends ms{constructor(s,e,i,o){super(s,{layout:M_||(M_=new on({"fill-sort-key":new li(dt.layout_fill["fill-sort-key"]),visibility:new Ht(dt.layout_fill.visibility),"fill-elevation-reference":new Ht(dt.layout_fill["fill-elevation-reference"])})),paint:E_||(E_=new on({"fill-antialias":new Ht(dt.paint_fill["fill-antialias"]),"fill-opacity":new li(dt.paint_fill["fill-opacity"]),"fill-color":new li(dt.paint_fill["fill-color"]),"fill-outline-color":new li(dt.paint_fill["fill-outline-color"]),"fill-translate":new Ht(dt.paint_fill["fill-translate"]),"fill-translate-anchor":new Ht(dt.paint_fill["fill-translate-anchor"]),"fill-pattern":new li(dt.paint_fill["fill-pattern"]),"fill-emissive-strength":new Ht(dt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new li(dt.paint_fill["fill-z-offset"]),"fill-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){const s=this.paint.get("fill-pattern"),e=s&&s.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(s,e,i){return{config:new zl(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(s,e){super.recalculate(s,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new rg(s)}queryRadius(){return At(this.paint.get("fill-translate"))}queryIntersectsFeature(s,e,i,o,p,a){return!s.queryGeometry.isAboveHorizon&&pe(ot(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,s.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends ms{constructor(s,e,i,o){super(s,{layout:xb||(xb=new on({visibility:new Ht(dt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ht(dt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:bb||(bb=new on({"fill-extrusion-opacity":new Ht(dt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new li(dt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ht(dt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ht(dt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new li(dt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new li(dt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new li(dt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Ht(dt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Ht(dt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Ht(dt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ht(dt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ht(dt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ht(dt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ht(dt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ht(dt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ht(dt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ht(dt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new li(dt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new li(dt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ht(dt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ht(dt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ht(dt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ht(dt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new li(dt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new li(dt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Ht(dt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new Hp(s)}queryRadius(){return At(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(s,e,i,o,p,a,f,w,E){const O=wt(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,s.pixelToTileUnitsFactor),x=this.paint.get("fill-extrusion-height").evaluate(e,i),C=this.paint.get("fill-extrusion-base").evaluate(e,i),k=[0,0],M=w&&a.elevation,P=a.elevation?a.elevation.exaggeration():1,R=s.tile.getBucket(this);if(M&&R instanceof Hp){const Z=R.centroidVertexArray,ne=E+1;ne<Z.length&&(k[0]=Z.geta_centroid_pos0(ne),k[1]=Z.geta_centroid_pos1(ne))}if(k[0]===0&&k[1]===1)return!1;a.projection.name==="globe"&&(o=vb([o],[new Wt(0,0),new Wt(ei,ei)],s.tileID.canonical).map(Z=>Z.polygon).flat());const $=M?w:null,[G,J]=function(Z,ne,le,fe,Ce,Ee,Me,$e,De,Ge,Xe){return Z.projection.name==="globe"?function(qe,et,nt,ct,it,Ct,Nt,Et,si,ti,Gt){const Ut=[],xi=[],ui=qe.projection.upVectorScale(Gt,qe.center.lat,qe.worldSize).metersToTile,fi=[0,0,0,1],Ni=[0,0,0,1],Ki=(tr,cr,ur,nn)=>{tr[0]=cr,tr[1]=ur,tr[2]=nn,tr[3]=1},er=yb();nt>0&&(nt+=er),ct+=er;for(const tr of et){const cr=[],ur=[];for(const nn of tr){const Nr=nn.x+it.x,Gi=nn.y+it.y,Rr=qe.projection.projectTilePoint(Nr,Gi,Gt),Fr=qe.projection.upVector(Gt,nn.x,nn.y);let hn=nt,Zn=ct;if(Nt){const hs=Sb(Nr,Gi,nt,ct,Nt,Et,si,ti);hn+=hs.base,Zn+=hs.top}nt!==0?Ki(fi,Rr.x+Fr[0]*ui*hn,Rr.y+Fr[1]*ui*hn,Rr.z+Fr[2]*ui*hn):Ki(fi,Rr.x,Rr.y,Rr.z),Ki(Ni,Rr.x+Fr[0]*ui*Zn,Rr.y+Fr[1]*ui*Zn,Rr.z+Fr[2]*ui*Zn),Ye.vec3.transformMat4(fi,fi,Ct),Ye.vec3.transformMat4(Ni,Ni,Ct),cr.push(new _e(fi[0],fi[1],fi[2])),ur.push(new _e(Ni[0],Ni[1],Ni[2]))}Ut.push(cr),xi.push(ur)}return[Ut,xi]}(Z,ne,le,fe,Ce,Ee,Me,$e,De,Ge,Xe):Me?function(qe,et,nt,ct,it,Ct,Nt,Et,si){const ti=[],Gt=[],Ut=[0,0,0,1];for(const xi of qe){const ui=[],fi=[];for(const Ni of xi){const Ki=Ni.x+ct.x,er=Ni.y+ct.y,tr=Sb(Ki,er,et,nt,Ct,Nt,Et,si);Ut[0]=Ki,Ut[1]=er,Ut[2]=tr.base,Ut[3]=1,Ye.vec4.transformMat4(Ut,Ut,it),Ut[3]=Math.max(Ut[3],1e-5);const cr=new _e(Ut[0]/Ut[3],Ut[1]/Ut[3],Ut[2]/Ut[3]);Ut[0]=Ki,Ut[1]=er,Ut[2]=tr.top,Ut[3]=1,Ye.vec4.transformMat4(Ut,Ut,it),Ut[3]=Math.max(Ut[3],1e-5);const ur=new _e(Ut[0]/Ut[3],Ut[1]/Ut[3],Ut[2]/Ut[3]);ui.push(cr),fi.push(ur)}ti.push(ui),Gt.push(fi)}return[ti,Gt]}(ne,le,fe,Ce,Ee,Me,$e,De,Ge):function(qe,et,nt,ct,it){const Ct=[],Nt=[],Et=it[8]*et,si=it[9]*et,ti=it[10]*et,Gt=it[11]*et,Ut=it[8]*nt,xi=it[9]*nt,ui=it[10]*nt,fi=it[11]*nt;for(const Ni of qe){const Ki=[],er=[];for(const tr of Ni){const cr=tr.x+ct.x,ur=tr.y+ct.y,nn=it[0]*cr+it[4]*ur+it[12],Nr=it[1]*cr+it[5]*ur+it[13],Gi=it[2]*cr+it[6]*ur+it[14],Rr=it[3]*cr+it[7]*ur+it[15],Fr=nn+Et,hn=Nr+si,Zn=Gi+ti,hs=Math.max(Rr+Gt,1e-5),Kn=nn+Ut,On=Nr+xi,as=Gi+ui,_s=Math.max(Rr+fi,1e-5);Ki.push(new _e(Fr/hs,hn/hs,Zn/hs)),er.push(new _e(Kn/_s,On/_s,as/_s))}Ct.push(Ki),Nt.push(er)}return[Ct,Nt]}(ne,le,fe,Ce,Ee)}(a,o,C,x,O,f,$,k,P,a.center.lat,s.tileID.canonical),ee=s.queryGeometry;return function(Z,ne,le){let fe=1/0;pe(le,ne)&&(fe=wb(le,ne[0]));for(let Ce=0;Ce<ne.length;Ce++){const Ee=ne[Ce],Me=Z[Ce];for(let $e=0;$e<Ee.length-1;$e++){const De=Ee[$e],Ge=[De,Ee[$e+1],Me[$e+1],Me[$e],De];oe(le,Ge)&&(fe=Math.min(fe,wb(le,Ge)))}}return fe!==1/0&&fe}(G,J,ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},line:class extends ms{constructor(s,e,i,o){const p=Ob();super(s,p,e,i,o),p.layout&&(this.layout=new yc(p.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ls,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,e){super.recalculate(s,e),this.paint._values["line-floorwidth"]=(()=>{if(ag)return ag;const i=Ob();return ag=new HM(i.paint.properties["line-width"].specification),ag.useIntegerZoom=!0,ag})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new H0(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(s,e,i){const o=Db(this);return{config:new zl(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}queryRadius(s){const e=s,i=Lb(It("line-width",this,e),It("line-gap-width",this,e)),o=It("line-offset",this,e);return i/2+Math.abs(o)+At(this.paint.get("line-translate"))}queryIntersectsFeature(s,e,i,o,p,a){if(s.queryGeometry.isAboveHorizon)return!1;const f=ot(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,s.pixelToTileUnitsFactor),w=s.pixelToTileUnitsFactor/2*Lb(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),E=this.paint.get("line-offset").evaluate(e,i);return E&&(o=function(O,x){const C=[],k=new Wt(0,0);for(let M=0;M<O.length;M++){const P=O[M],R=[];for(let $=0;$<P.length;$++){const G=P[$],J=P[$+1],ee=$===0?k:G.sub(P[$-1])._unit()._perp(),Z=$===P.length-1?k:J.sub(G)._unit()._perp(),ne=ee._add(Z)._unit();ne._mult(1/(ne.x*Z.x+ne.y*Z.y)),R.push(ne._mult(x)._add(G))}C.push(R)}return C}(o,E*s.pixelToTileUnitsFactor)),function(O,x,C){for(let k=0;k<x.length;k++){const M=x[k];if(O.length>=3){for(let P=0;P<M.length;P++)if(Oe(O,M[P]))return!0}if(Se(O,M,C))return!0}return!1}(f,o,w)}isTileClipped(){return!0}isDraped(s){return!this.hasElevatedBuckets}},symbol:H_,background:class extends ms{constructor(s,e,i,o){super(s,{layout:_1||(_1=new on({visibility:new Ht(dt.layout_background.visibility)})),paint:y1||(y1=new on({"background-pitch-alignment":new Ht(dt.paint_background["background-pitch-alignment"]),"background-color":new Ht(dt.paint_background["background-color"]),"background-pattern":new Ht(dt.paint_background["background-pattern"]),"background-opacity":new Ht(dt.paint_background["background-opacity"]),"background-emissive-strength":new Ht(dt.paint_background["background-emissive-strength"]),"background-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(s,e,i){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:S1,"raster-particle":P1,sky:class extends ms{constructor(s,e,i,o){super(s,{layout:E1||(E1=new on({visibility:new Ht(dt.layout_sky.visibility)})),paint:C1||(C1=new on({"sky-type":new Ht(dt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ht(dt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ht(dt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ht(dt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ht(dt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ka(dt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ht(dt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ht(dt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ht(dt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Bp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(s,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),p=!o,a=s.style.light,f=a.properties.get("position");return p&&a.properties.get("anchor")==="viewport"&&qi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?pv(f.azimuthal,90-f.polar,e):pv(o[0],90-o[1],e)}const i=this.paint.get("sky-gradient-center");return pv(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}},slot:class extends ms{constructor(s,e,i,o){super(s,{paint:A1||(A1=new on({}))},e,null)}},model:class extends ms{constructor(s,e,i,o){super(s,{layout:N1||(N1=new on({visibility:new Ht(dt.layout_model.visibility),"model-id":new li(dt.layout_model["model-id"])})),paint:V1||(V1=new on({"model-opacity":new li(dt.paint_model["model-opacity"]),"model-rotation":new li(dt.paint_model["model-rotation"]),"model-scale":new li(dt.paint_model["model-scale"]),"model-translation":new li(dt.paint_model["model-translation"]),"model-color":new li(dt.paint_model["model-color"]),"model-color-mix-intensity":new li(dt.paint_model["model-color-mix-intensity"]),"model-type":new Ht(dt.paint_model["model-type"]),"model-cast-shadows":new Ht(dt.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ht(dt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ht(dt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new li(dt.paint_model["model-emissive-strength"]),"model-roughness":new li(dt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new li(dt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ht(dt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ht(dt.paint_model["model-front-cutoff"]),"model-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new gv(s)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(s){return s instanceof Q_?ei-1:0}queryIntersectsFeature(s,e,i,o,p,a){if(!this.modelManager)return!1;const f=this.modelManager,w=s.tile.getBucket(this);if(!(w&&w instanceof gv))return!1;for(const E in w.instancesPerModel){const O=w.instancesPerModel[E],x=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(O.idToFeaturesIndex.hasOwnProperty(x)){const C=O.features[O.idToFeaturesIndex[x]],k=f.getModel(E,this.scope);if(!k)return!1;let M=Ye.mat4.create();const P=new Er(0,0),R=w.canonical;let $=Number.MAX_VALUE;for(let G=0;G<C.instancedDataCount;++G){const J=16*(C.instancedDataOffset+G),ee=O.instancedDataArray.float32,Z=[ee[J+4],ee[J+5],ee[J+6]];W1(R,P,ee[J],0|ee[J+1]),U1(M,k,a,P,C.rotation,C.scale,Z,!1,!1,!1),a.projection.name==="globe"&&(M=mv(M,a));const ne=Ye.mat4.multiply([],a.projMatrix,M),le=s.queryGeometry,fe=L1(le.isPointQuery()?le.screenBounds:le.screenGeometry,a,ne,k.aabb);fe!=null&&($=Math.min(fe,$))}return $!==Number.MAX_VALUE&&$}}return!1}_handleOverridablePaintPropertyUpdate(s,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||s!=="model-color"&&s!=="model-color-mix-intensity"&&s!=="model-rotation"&&s!=="model-scale"&&s!=="model-translation"&&s!=="model-emissive-strength")}_isPropertyZoomDependent(s){const e=this._transitionablePaint._values[s];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof dc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends ms{constructor(s,e,i,o){super(s,{layout:C_||(C_=new on({"clip-layer-types":new Ht(dt.layout_clip["clip-layer-types"]),"clip-layer-scope":new Ht(dt.layout_clip["clip-layer-scope"])})),paint:A_||(A_=new on({}))},e,i,o)}recalculate(s,e){super.recalculate(s,e)}createBucket(s){return new P_(s)}isTileClipped(){return!0}is3D(){return!0}}};class GE{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class HE{constructor(){this.tasks={},this.taskQueue=[],Vc(["process"],this),this.invoker=new GE(this.process),this.nextId=0}add(e,i){const o=this.nextId++,p=function({type:a,isSymbolTile:f,zoom:w}){return w=w||0,a==="message"?0:a!=="maybePrepare"||f?a!=="parseTile"||f?a==="parseTile"&&f?300-w:a==="maybePrepare"&&f?400-w:500:200-w:100-w}(i);if(p===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:i,priority:p,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let p=0;p<this.taskQueue.length;p++){const a=this.tasks[this.taskQueue[p]];a.priority<i&&(i=a.priority,e=p)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class q1{constructor(e,i,o){this.target=e,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},Vc(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new HE}send(e,i,o,p,a=!1,f){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=f,this.callbacks[w]=o);const E=new Set;return this.target.postMessage({id:w,type:e,hasCallback:!!o,targetMapId:p,mustQueue:a,sourceMapId:this.mapId,data:Al(i,E)},E),{cancel:()=>{o&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(e){const i=e.data,o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const p=this.cancelCallbacks[o];delete this.cancelCallbacks[o],p&&p.cancel()}else if(i.mustQueue||Pa()){const p=this.callbacks[o],a=this.scheduler.add(()=>this.processTask(o,i),p&&p.metadata||{type:"message"});a&&(this.cancelCallbacks[o]=a)}else this.processTask(o,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const o=this.callbacks[e];delete this.callbacks[e],o&&(i.error?o(mc(i.error)):o(null,mc(i.data)))}else{const o=new Set,p=i.hasCallback?(f,w)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?Al(f):null,data:Al(w,o)},o)}:()=>{},a=mc(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,a,p);else if(this.parent.getWorkerSource){const f=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,f[0],a.source,a.scope)[f[1]](a,p)}else p(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var xg={workerUrl:"",workerClass:null,workerParams:void 0};const xv="mapboxgl_preloaded_worker_pool";class Xp{constructor(){this.active={}}acquire(e,i=Xp.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(xg.workerClass!=null?new xg.workerClass:new self.Worker(xg.workerUrl,xg.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[xv]}numActive(){return Object.keys(this.active).length}}Xp.workerCount=2;class lm{constructor(e,i,o="Worker",p=Xp.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=$a();const a=this.workerPool.acquire(this.id,p);for(let f=0;f<a.length;f++){const w=new lm.Actor(a[f],i,this.id);w.name=`${o} ${f}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,o){dl(this.actors,(p,a)=>{p.send(e,i,a)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let bg,bv;function ey(){return bg||(bg=new Xp),bg}lm.Actor=q1;const wv=new Ar(0,0,0);var Sv=(s=>(s[s.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",s[s.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",s[s.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",s))(Sv||{}),ty=(s=>(s[s.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",s[s.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",s[s.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",s[s.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",s))(ty||{}),wg=(s=>(s[s.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",s[s.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",s[s.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",s[s.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",s[s.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",s))(wg||{}),Y1=(s=>(s[s.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",s[s.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",s[s.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",s))(Y1||{}),cm=(s=>(s[s.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",s[s.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",s[s.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",s[s.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",s[s.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",s[s.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",s))(cm||{}),X1=(s=>(s[s.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",s[s.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",s[s.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",s))(X1||{});function WE(s,e,i){s===1&&e.icons.push(function(o,p){return function(a){if(a.usvg_tree.height||(a.usvg_tree.height=a.usvg_tree.width),!a.metadata)return a;const{metadata:f}=a;if(f.content_area){const{content_area:w}=f;w.top==null&&(w.top=w.left),w.width==null&&(w.width=a.usvg_tree.width),w.height==null&&(w.height=w.width)}return f.stretch_x&&f.stretch_x.length&&Z1(f,"x"),f.stretch_y&&f.stretch_y.length&&Z1(f,"y"),a}(o.readFields(qE,{name:void 0},p))}(i,i.readVarint()+i.pos))}function Z1(s,e){const i=[],o=s[`stretch_${e}`];let p=null;for(let a=0;a<o.length;a++)p===null?p=i.length===0?o[0]:i[i.length-1][1]+o[a]:(i.push([p,p+o[a]]),p=null);s[`stretch_${e}_areas`]=i}function qE(s,e,i){s===1?e.name=i.readString():s===2?e.metadata=function(o,p){return o.readFields(YE,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},p)}(i,i.readVarint()+i.pos):s===3&&(e.usvg_tree=function(o,p){return o.readFields(KE,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},p)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function YE(s,e,i){s===1?e.stretch_x=i.readPackedVarint():s===2?e.stretch_y=i.readPackedVarint():s===3?e.content_area=function(o,p){return o.readFields(XE,{left:0},p)}(i,i.readVarint()+i.pos):s===4&&e.variables.push(function(o,p){return o.readFields(ZE,{name:void 0},p)}(i,i.readVarint()+i.pos))}function XE(s,e,i){s===1?e.left=i.readVarint():s===2?e.width=i.readVarint():s===3?e.top=i.readVarint():s===4&&(e.height=i.readVarint())}function ZE(s,e,i){s===1?e.name=i.readString():s===2&&(e.rgb_color=ny(i.readVarint()),e.value="rgb_color")}function KE(s,e,i){s===1?e.width=e.height=i.readVarint():s===2?e.height=i.readVarint():s===3?e.children.push(iy(i,i.readVarint()+i.pos)):s===4?e.linear_gradients.push(function(o,p){return o.readFields(nC,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},p)}(i,i.readVarint()+i.pos)):s===5?e.radial_gradients.push(function(o,p){return o.readFields(oC,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},p)}(i,i.readVarint()+i.pos)):s===7?e.clip_paths.push(function(o,p){return o.readFields(aC,{children:[]},p)}(i,i.readVarint()+i.pos)):s===8&&e.masks.push(function(o,p){const a=o.readFields(lC,{left:0,width:20,mask_type:1,children:[]},p);return a.height==null&&(a.height=a.width),a.top==null&&(a.top=a.left),a}(i,i.readVarint()+i.pos))}function iy(s,e){return s.readFields(JE,{},e)}function JE(s,e,i){s===1?(e.group=function(o,p){return o.readFields(QE,{opacity:255,children:[]},p)}(i,i.readVarint()+i.pos),e.node="group"):s===2&&(e.path=function(o,p){return o.readFields(tC,{paint_order:1,commands:[],step:1,diffs:[],rule:1},p)}(i,i.readVarint()+i.pos),e.node="path")}function QE(s,e,i){s===1?e.transform=ry(i,i.readVarint()+i.pos):s===2?e.opacity=i.readVarint():s===5?e.clip_path_idx=i.readVarint():s===6?e.mask_idx=i.readVarint():s===7&&e.children.push(iy(i,i.readVarint()+i.pos))}function ry(s,e){return s.readFields(eC,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function eC(s,e,i){s===1?e.sx=i.readFloat():s===2?e.ky=i.readFloat():s===3?e.kx=i.readFloat():s===4?e.sy=i.readFloat():s===5?e.tx=i.readFloat():s===6&&(e.ty=i.readFloat())}function tC(s,e,i){s===1?e.fill=function(o,p){return o.readFields(iC,{rgb_color:wv,paint:"rgb_color",opacity:255},p)}(i,i.readVarint()+i.pos):s===2?e.stroke=function(o,p){return o.readFields(rC,{rgb_color:wv,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},p)}(i,i.readVarint()+i.pos):s===3?e.paint_order=i.readVarint():s===5?i.readPackedVarint(e.commands):s===6?e.step=i.readFloat():s===7?i.readPackedSVarint(e.diffs):s===8&&(e.rule=i.readVarint())}function iC(s,e,i){s===1?(e.rgb_color=ny(i.readVarint()),e.paint="rgb_color"):s===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):s===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):s===5&&(e.opacity=i.readVarint())}function ny(s){return new Ar((s>>16&255)/255,(s>>8&255)/255,(255&s)/255,1)}function rC(s,e,i){s===1?(e.rgb_color=ny(i.readVarint()),e.paint="rgb_color"):s===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):s===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):s===5?i.readPackedFloat(e.dasharray):s===6?e.dashoffset=i.readFloat():s===7?e.miterlimit=i.readFloat():s===8?e.opacity=i.readVarint():s===9?e.width=i.readFloat():s===10?e.linecap=i.readVarint():s===11&&(e.linejoin=i.readVarint())}function nC(s,e,i){s===1?e.transform=ry(i,i.readVarint()+i.pos):s===2?e.spread_method=i.readVarint():s===3?e.stops.push(K1(i,i.readVarint()+i.pos)):s===4?e.x1=i.readFloat():s===5?e.y1=i.readFloat():s===6?e.x2=i.readFloat():s===7&&(e.y2=i.readFloat())}function K1(s,e){return s.readFields(sC,{offset:0,opacity:255,rgb_color:wv},e)}function sC(s,e,i){s===1?e.offset=i.readFloat():s===2?e.opacity=i.readVarint():s===3&&(e.rgb_color=ny(i.readVarint()))}function oC(s,e,i){s===1?e.transform=ry(i,i.readVarint()+i.pos):s===2?e.spread_method=i.readVarint():s===3?e.stops.push(K1(i,i.readVarint()+i.pos)):s===4?e.cx=i.readFloat():s===5?e.cy=i.readFloat():s===6?e.r=i.readFloat():s===7?e.fx=i.readFloat():s===8?e.fy=i.readFloat():s===9&&(e.fr=i.readFloat())}function aC(s,e,i){s===1?e.transform=ry(i,i.readVarint()+i.pos):s===2?e.clip_path_idx=i.readVarint():s===3&&e.children.push(iy(i,i.readVarint()+i.pos))}function lC(s,e,i){s===1?e.left=e.top=i.readFloat():s===2?e.width=e.height=i.readFloat():s===3?e.top=i.readFloat():s===4?e.height=i.readFloat():s===5?e.mask_type=i.readVarint():s===6?e.mask_idx=i.readVarint():s===7&&e.children.push(iy(i,i.readVarint()+i.pos))}class cC{static calculate(e,i){const o=new Map,p=new Map;if(Object.keys(e).length===0)return o;i.forEach(a=>{p.set(a.name,a.rgb_color||new Ar(0,0,0))});for(const[a,f]of Object.entries(e))p.has(a)?o.set(p.get(a).toStringPremultipliedAlpha(),f):console.warn(`Ignoring unknown image variable "${a}"`);return o}}function um(s,e=255,i){const o=e/255,p=s.toStringPremultipliedAlpha(),a=i.has(p)?i.get(p).clone():s.clone();return a.a=o,a.toString()}function Sg(s,e){if(!be()){const i=document.createElement("canvas");return i.width=s,i.height=e,i}return new OffscreenCanvas(s,e)}function uC(s,e){const i=cC.calculate(e.params,s.metadata?s.metadata.variables:[]),o=s.usvg_tree,p=o.width,a=o.height,f=e.transform?e.transform:new DOMMatrix,w=Math.max(1,Math.round(p*f.a)),E=Math.max(1,Math.round(a*f.d)),O=new DOMMatrix([w/p,0,0,E/a,0,0]),x=Sg(w,E).getContext("2d");return Tv(x,O,o,o,i),x.getImageData(0,0,w,E)}function Tv(s,e,i,o,p){for(const a of o.children)J1(s,e,i,a,p)}function J1(s,e,i,o,p){o.group?(s.save(),function(a,f,w,E,O){const x=E.mask_idx!=null?w.masks[E.mask_idx]:null,C=E.clip_path_idx!=null?w.clip_paths[E.clip_path_idx]:null;if(E.transform&&(f=sy(E.transform).preMultiplySelf(f)),!function(P,R,$){return P.opacity!==255||R||$}(E,C!=null,x!=null))return void Tv(a,f,w,E,O);const k=Sg(a.canvas.width,a.canvas.height),M=k.getContext("2d");Tv(M,f,w,E,O),C&&sw(M,f,w,C),x&&ow(M,f,w,x,O),a.globalAlpha=E.opacity/255,a.drawImage(k,0,0)}(s,e,i,o.group,p),s.restore()):o.path&&(s.save(),function(a,f,w,E,O){const x=aw(E);a.setTransform(f),E.paint_order===Y1.PAINT_ORDER_FILL_AND_STROKE?(Q1(a,w,E,x,O),tw(a,w,E,x,O)):(tw(a,w,E,x,O),Q1(a,w,E,x,O))}(s,e,i,o.path,p),s.restore())}function Q1(s,e,i,o,p){const a=i.fill;if(!a)return;const f=a.opacity/255;switch(a.paint){case"rgb_color":s.fillStyle=um(a.rgb_color,a.opacity,p);break;case"linear_gradient_idx":s.fillStyle=iw(s,e.linear_gradients[a.linear_gradient_idx],f,p);break;case"radial_gradient_idx":s.fillStyle=rw(s,e.radial_gradients[a.radial_gradient_idx],f,p)}s.fill(o,ew(i))}function ew(s){return s.rule===Sv.PATH_RULE_NON_ZERO?"nonzero":s.rule===Sv.PATH_RULE_EVEN_ODD?"evenodd":void 0}function tw(s,e,i,o,p){const a=i.stroke;if(!a)return;s.lineWidth=a.width,s.miterLimit=a.miterlimit,s.setLineDash(a.dasharray),s.lineDashOffset=a.dashoffset;const f=a.opacity/255;switch(a.paint){case"rgb_color":s.strokeStyle=um(a.rgb_color,a.opacity,p);break;case"linear_gradient_idx":s.strokeStyle=iw(s,e.linear_gradients[a.linear_gradient_idx],f,p);break;case"radial_gradient_idx":s.strokeStyle=rw(s,e.radial_gradients[a.radial_gradient_idx],f,p)}switch(a.linejoin){case wg.LINE_JOIN_MITER_CLIP:case wg.LINE_JOIN_MITER:s.lineJoin="miter";break;case wg.LINE_JOIN_ROUND:s.lineJoin="round";break;case wg.LINE_JOIN_BEVEL:s.lineJoin="bevel"}switch(a.linecap){case ty.LINE_CAP_BUTT:s.lineCap="butt";break;case ty.LINE_CAP_ROUND:s.lineCap="round";break;case ty.LINE_CAP_SQUARE:s.lineCap="square"}s.stroke(o)}function iw(s,e,i,o){if(e.stops.length===1){const k=e.stops[0];return um(k.rgb_color,k.opacity*i,o)}const p=sy(e.transform),{x1:a,y1:f,x2:w,y2:E}=e,O=p.transformPoint(new DOMPoint(a,f)),x=p.transformPoint(new DOMPoint(w,E)),C=s.createLinearGradient(O.x,O.y,x.x,x.y);for(const k of e.stops)C.addColorStop(k.offset,um(k.rgb_color,k.opacity*i,o));return C}function rw(s,e,i,o){if(e.stops.length===1){const k=e.stops[0];return um(k.rgb_color,k.opacity*i,o)}const p=sy(e.transform),{fx:a,fy:f,cx:w,cy:E}=e,O=p.transformPoint(new DOMPoint(a,f)),x=p.transformPoint(new DOMPoint(w,E)),C=s.createRadialGradient(O.x,O.y,0,x.x,x.y,e.r*((p.a+p.d)/2));for(const k of e.stops)C.addColorStop(k.offset,um(k.rgb_color,k.opacity*i,o));return C}function nw(s,e,i,o){const p=o.transform?sy(o.transform).preMultiplySelf(e):e,a=Sg(s.canvas.width,s.canvas.height),f=a.getContext("2d");for(const E of o.children)if(E.group)nw(f,p,i,E.group);else if(E.path){const O=E.path,x=new Path2D;x.addPath(aw(O),p),f.fill(x,ew(O))}const w=o.clip_path_idx!=null?i.clip_paths[o.clip_path_idx]:null;w&&sw(f,p,i,w),s.globalCompositeOperation="source-over",s.drawImage(a,0,0)}function sw(s,e,i,o){const p=Sg(s.canvas.width,s.canvas.height);nw(p.getContext("2d"),e,i,o),s.globalCompositeOperation="destination-in",s.drawImage(p,0,0)}function ow(s,e,i,o,p){if(o.children.length===0)return;const a=o.mask_idx!=null?i.masks[o.mask_idx]:null;a&&ow(s,e,i,a,p);const f=s.canvas.width,w=s.canvas.height,E=Sg(f,w),O=E.getContext("2d"),x=o.width,C=o.height,k=o.left,M=o.top,P=new Path2D,R=new Path2D;R.rect(k,M,x,C),P.addPath(R,e),O.clip(P);for(const J of o.children)J1(O,e,i,J,p);const $=O.getImageData(0,0,f,w),G=$.data;if(o.mask_type===X1.MASK_TYPE_LUMINANCE)for(let J=0;J<G.length;J+=4)G[J+3]=G[J+3]/255*(.2126*G[J]+.7152*G[J+1]+.0722*G[J+2]);O.putImageData($,0,0),s.globalCompositeOperation="destination-in",s.drawImage(E,0,0)}function sy(s){return s?new DOMMatrix([s.sx,s.ky,s.kx,s.sy,s.tx,s.ty]):new DOMMatrix}function aw(s){const e=new Path2D,i=s.step;let o=s.diffs[0]*i,p=s.diffs[1]*i;e.moveTo(o,p);for(let a=0,f=2;a<s.commands.length;a++)switch(s.commands[a]){case cm.PATH_COMMAND_MOVE:o+=s.diffs[f++]*i,p+=s.diffs[f++]*i,e.moveTo(o,p);break;case cm.PATH_COMMAND_LINE:o+=s.diffs[f++]*i,p+=s.diffs[f++]*i,e.lineTo(o,p);break;case cm.PATH_COMMAND_QUAD:{const w=o+s.diffs[f++]*i,E=p+s.diffs[f++]*i;o=w+s.diffs[f++]*i,p=E+s.diffs[f++]*i,e.quadraticCurveTo(w,E,o,p);break}case cm.PATH_COMMAND_CUBIC:{const w=o+s.diffs[f++]*i,E=p+s.diffs[f++]*i,O=w+s.diffs[f++]*i,x=E+s.diffs[f++]*i;o=O+s.diffs[f++]*i,p=x+s.diffs[f++]*i,e.bezierCurveTo(w,E,O,x,o,p);break}case cm.PATH_COMMAND_CLOSE:e.closePath()}return e}class Mv{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}class Ev{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Fs(e,e.data)}getFromCache(e,i,o){return this.cacheMap.has(o)||this.cacheMap.set(o,new Mv(150)),this.cacheMap.get(o).get(ua(e.serialize(),i))}setInCache(e,i,o,p){this.cacheDependenciesMap.has(p)||this.cacheDependenciesMap.set(p,new Map),this.cacheMap.has(p)||this.cacheMap.set(p,new Mv(150));const a=this.cacheDependenciesMap.get(p);a.get(ua(e.id,o))||a.set(ua(e.id,o),new Set);const f=this.cacheMap.get(p),w=e.serialize();a.get(ua(e.id,o)).add(w),f.put(ua(e.serialize(),o),i)}removeImagesFromCacheByIds(e,i,o=""){if(!this.cacheMap.has(o)||!this.cacheDependenciesMap.has(o))return;const p=this.cacheMap.get(o),a=this.cacheDependenciesMap.get(o);for(const f of e)if(a.has(ua(f,i))){for(const w of a.get(ua(f,i)))p.delete(w);a.delete(ua(f,i))}}rasterize(e,i,o,p,a=uC){const f=this.getFromCache(e,o,p);if(f)return f.clone();const w=a(i.icon,e.options),E=Ev._getImage(w);return this.setInCache(e,E,o,p),E.clone()}}class lw{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function cw(s,e,i,o){let p=0,a=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(o[f])<1e-15){if(i[f]<s[f]||i[f]>e[f])return null}else{const w=1/o[f];let E=(s[f]-i[f])*w,O=(e[f]-i[f])*w;if(E>O){const x=E;E=O,O=x}if(E>p&&(p=E),O<a&&(a=O),p>a)return null}return p}function uw(s,e,i,o,p,a,f,w,E,O,x){const C=o-s,k=p-e,M=a-i,P=f-s,R=w-e,$=E-i,G=x[1]*$-x[2]*R,J=x[2]*P-x[0]*$,ee=x[0]*R-x[1]*P,Z=C*G+k*J+M*ee;if(Math.abs(Z)<1e-15)return null;const ne=1/Z,le=O[0]-s,fe=O[1]-e,Ce=O[2]-i,Ee=(le*G+fe*J+Ce*ee)*ne;if(Ee<0||Ee>1)return null;const Me=fe*M-Ce*k,$e=Ce*C-le*M,De=le*k-fe*C,Ge=(x[0]*Me+x[1]*$e+x[2]*De)*ne;return Ge<0||Ee+Ge>1?null:(P*Me+R*$e+$*De)*ne}function hw(s,e,i){return(s-e)/(i-e)}function dw(s,e,i,o,p,a,f,w,E){const O=1<<i,x=a-o,C=f-p,k=(s+1)/O*x+o,M=(e+0)/O*C+p,P=(e+1)/O*C+p;w[0]=(s+0)/O*x+o,w[1]=M,E[0]=k,E[1]=P}class pw{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(a){const f=Math.ceil(Math.log2(a.dim/8)),w=[];let E=Math.ceil(Math.pow(2,f));const O=1/E,x=(M,P,R,$,G)=>{const J=$?1:0,ee=(M+1)*R-J,Z=P*R,ne=(P+1)*R-J;G[0]=M*R,G[1]=Z,G[2]=ee,G[3]=ne};let C=new lw(E);const k=[];for(let M=0;M<E*E;M++){x(M%E,Math.floor(M/E),O,!1,k);const P=Dd(k[0],k[1],a),R=Dd(k[2],k[1],a),$=Dd(k[2],k[3],a),G=Dd(k[0],k[3],a);C.minimums.push(Math.min(P,R,$,G)),C.maximums.push(Math.max(P,R,$,G)),C.leaves.push(1)}for(w.push(C),E/=2;E>=1;E/=2){const M=w[w.length-1];C=new lw(E);for(let P=0;P<E*E;P++){x(P%E,Math.floor(P/E),2,!0,k);const R=M.getElevation(k[0],k[1]),$=M.getElevation(k[2],k[1]),G=M.getElevation(k[2],k[3]),J=M.getElevation(k[0],k[3]),ee=M.isLeaf(k[0],k[1]),Z=M.isLeaf(k[2],k[1]),ne=M.isLeaf(k[2],k[3]),le=M.isLeaf(k[0],k[3]),fe=Math.min(R.min,$.min,G.min,J.min),Ce=Math.max(R.max,$.max,G.max,J.max),Ee=ee&&Z&&ne&&le;C.maximums.push(Ce),C.minimums.push(fe),C.leaves.push(Ce-fe<=5&&Ee?1:0)}w.push(C)}return w}(this.dem),o=i.length-1,p=i[o];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,p,a,f,w=1){return cw([e,i,-100],[o,p,this.maximums[0]*w],a,f)}raycast(e,i,o,p,a,f,w=1){if(!this.nodeCount)return null;const E=this.raycastRoot(e,i,o,p,a,f,w);if(E==null)return null;const O=[],x=[],C=[],k=[],M=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;M.length>0;){const{idx:P,t:R,nodex:$,nodey:G,depth:J}=M.pop();if(this.leaves[P]){dw($,G,J,e,i,o,p,C,k);const Z=1<<J,ne=($+0)/Z,le=($+1)/Z,fe=(G+0)/Z,Ce=(G+1)/Z,Ee=Dd(ne,fe,this.dem)*w,Me=Dd(le,fe,this.dem)*w,$e=Dd(le,Ce,this.dem)*w,De=Dd(ne,Ce,this.dem)*w,Ge=uw(C[0],C[1],Ee,k[0],C[1],Me,k[0],k[1],$e,a,f),Xe=uw(k[0],k[1],$e,C[0],k[1],De,C[0],C[1],Ee,a,f),qe=Math.min(Ge!==null?Ge:Number.MAX_VALUE,Xe!==null?Xe:Number.MAX_VALUE);if(qe!==Number.MAX_VALUE)return qe;{const et=Ye.vec3.scaleAndAdd([],a,f,R);if(fw(Ee,Me,De,$e,hw(et[0],C[0],k[0]),hw(et[1],C[1],k[1]))>=et[2])return R}continue}let ee=0;for(let Z=0;Z<this._siblingOffset.length;Z++){dw(($<<1)+this._siblingOffset[Z][0],(G<<1)+this._siblingOffset[Z][1],J+1,e,i,o,p,C,k),C[2]=-100,k[2]=this.maximums[this.childOffsets[P]+Z]*w;const ne=cw(C,k,a,f);if(ne!=null){const le=ne;O[Z]=le;let fe=!1;for(let Ce=0;Ce<ee&&!fe;Ce++)le>=O[x[Ce]]&&(x.splice(Ce,0,Z),fe=!0);fe||(x[ee]=Z),ee++}}for(let Z=0;Z<ee;Z++){const ne=x[Z];M.push({idx:this.childOffsets[P]+ne,t:O[ne],nodex:($<<1)+this._siblingOffset[ne][0],nodey:(G<<1)+this._siblingOffset[ne][1],depth:J+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,p,a){if(e[p].isLeaf(i,o)===1)return;this.childOffsets[a]||(this.childOffsets[a]=this.nodeCount);const f=p-1,w=e[f];let E=0,O=0;for(let x=0;x<this._siblingOffset.length;x++){const C=2*i+this._siblingOffset[x][0],k=2*o+this._siblingOffset[x][1],M=w.getElevation(C,k),P=w.isLeaf(C,k),R=this._addNode(M.min,M.max,P);P&&(E|=1<<x),O||(O=R)}for(let x=0;x<this._siblingOffset.length;x++)E&1<<x||this._construct(e,2*i+this._siblingOffset[x][0],2*o+this._siblingOffset[x][1],f,O+x)}}function fw(s,e,i,o,p,a){return Ii(Ii(s,i,a),Ii(e,o,a),p)}function Dd(s,e,i){const o=i.dim,p=nr(s*o-.5,0,o-1),a=nr(e*o-.5,0,o-1),f=Math.floor(p),w=Math.floor(a),E=Math.min(f+1,o-1),O=Math.min(w+1,o-1);return fw(i.get(f,w),i.get(E,w),i.get(f,O),i.get(E,O),p-f,a-w)}const hC={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function dC(s,e,i){return(256*s*256+256*e+i)/10-1e4}function pC(s,e,i){return 256*s+e+i/256-32768}class oy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,p=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void qi(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const a=this.dim=i.height-2,f=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let E=0;E<a;E++)f[this._idx(-1,E)]=f[this._idx(0,E)],f[this._idx(a,E)]=f[this._idx(a-1,E)],f[this._idx(E,-1)]=f[this._idx(E,0)],f[this._idx(E,a)]=f[this._idx(E,a-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(a,-1)]=f[this._idx(a-1,0)],f[this._idx(-1,a)]=f[this._idx(0,a-1)],f[this._idx(a,a)]=f[this._idx(a-1,a-1)]}const w=o==="terrarium"?pC:dC;for(let E=0;E<f.length;++E){const O=4*E;this.floatView[E]=w(this.pixels[O],this.pixels[O+1],this.pixels[O+2])}this._timestamp=Fe.now()}_buildQuadTree(){this._tree=new pw(this)}get(e,i,o=!1){o&&(e=nr(e,-1,this.dim),i=nr(i,-1,this.dim));const p=this._idx(e,i);return this.floatView[p]}set(e,i,o){const p=this._idx(e,i),a=this.floatView[p];return this.floatView[p]=o,o-a}static getUnpackVector(e){return hC[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const o=[0,0,0,0],p=oy.getUnpackVector(i);let a=Math.floor((e+p[3])/p[2]);return o[2]=a%256,a=Math.floor(a/256),o[1]=a%256,a=Math.floor(a/256),o[0]=a,o}getPixels(){return new Jf({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let p=i*this.dim,a=i*this.dim+this.dim,f=o*this.dim,w=o*this.dim+this.dim;switch(i){case-1:p=a-1;break;case 1:a=p+1}switch(o){case-1:f=w-1;break;case 1:w=f+1}const E=-i*this.dim,O=-o*this.dim;for(let x=f;x<w;x++)for(let C=p;C<a;C++){const k=4*this._idx(C,x),M=4*this._idx(C+E,x+O);this.pixels[k+0]=e.pixels[M+0],this.pixels[k+1]=e.pixels[M+1],this.pixels[k+2]=e.pixels[M+2],this.pixels[k+3]=e.pixels[M+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function fC(s,e,i){s===1?e.headerLength=i.readFixed32():s===2?e.x=i.readVarint():s===3?e.y=i.readVarint():s===4?e.z=i.readVarint():s===5&&e.layers.push(function(o,p){return o.readFields(vC,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)}(i,i.readVarint()+i.pos))}function mC(s,e,i){s===1?(e.delta_filter=function(o,p){return o.readFields(gC,{blockSize:0},p)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):s===2?(i.readVarint(),e.filter="zigzag_filter"):s===3?(i.readVarint(),e.filter="bitshuffle_filter"):s===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function gC(s,e,i){s===1&&(e.blockSize=i.readVarint())}function _C(s,e,i){s===1?(i.readVarint(),e.codec="gzip_data"):s===2?(i.readVarint(),e.codec="jpeg_image"):s===3?(i.readVarint(),e.codec="webp_image"):s===4&&(i.readVarint(),e.codec="png_image")}function yC(s,e,i){let o=0,p=0;s===1?e.firstByte=i.readFixed64():s===2?e.lastByte=i.readFixed64():s===3?e.filters.push(function(a,f){return a.readFields(mC,{},f)}(i,i.readVarint()+i.pos)):s===4?e.codec=function(a,f){return a.readFields(_C,{},f)}(i,i.readVarint()+i.pos):s===5?p=i.readFloat():s===6?o=i.readFloat():s===7?e.bands.push(i.readString()):s===8?e.offset=i.readDouble():s===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=p),e.scale===0&&(e.scale=o)}function vC(s,e,i){s===1?e.version=i.readVarint():s===2?e.name=i.readString():s===3?e.units=i.readString():s===4?e.tileSize=i.readVarint():s===5?e.buffer=i.readVarint():s===6?e.pixelFormat=i.readVarint():s===7&&e.dataIndex.push(function(o,p){return o.readFields(yC,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)}(i,i.readVarint()+i.pos))}function xC(s,e,i){if(s===2)(function(o,p,a){o.readFields(bC,a,p)})(i,i.readVarint()+i.pos,e);else if(s===3)throw new Error("Not implemented")}function bC(s,e,i){if(s===1){let o=0;const p=i.readVarint()+i.pos;for(;i.pos<p;)e[o++]=i.readVarint()}}function wC(s,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let o=2;o>=1;o--){const p=o===1?1:0,a=o===2?1:0;for(let f=0;f<e[0];f++){const w=e[1]*f;for(let E=p;E<e[1];E++){const O=e[2]*(E+w);for(let x=a;x<e[2];x++){const C=e[3]*(x+O);for(let k=0;k<e[3];k++){const M=C+k;s[M]+=s[M-i]}}}}i*=e[o]}return s}function SC(s){for(let e=0,i=s.length;e<i;e++)s[e]=s[e]>>>1^-(1&s[e]);return s}function TC(s,e){switch(e){case"uint32":return s;case"uint16":for(let i=0;i<s.length;i+=2){const o=s[i],p=s[i+1];s[i]=(240&o)>>4|(61440&o)>>8|(240&p)<<4|61440&p,s[i+1]=15&o|(3840&o)>>4|(15&p)<<8|(3840&p)<<4}return s;case"uint8":for(let i=0;i<s.length;i+=4){const o=s[i],p=s[i+1],a=s[i+2],f=s[i+3];s[i+0]=(192&o)>>6|(192&p)>>4|(192&a)>>2|192&f,s[i+1]=(48&o)>>4|(48&p)>>2|48&a|(48&f)<<2,s[i+2]=(12&o)>>2|12&p|(12&a)<<2|(12&f)<<4,s[i+3]=3&o|(3&p)<<2|(3&a)<<4|(3&f)<<6}return s;default:throw new Error(`Invalid pixel format, "${e}"`)}}_i(oy,"DEMData"),_i(pw,"DemMinMaxQuadTree",{omit:["dem"]});var ol=Uint8Array,Tg=Uint16Array,MC=Int32Array,mw=new ol([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),gw=new ol([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),EC=new ol([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_w=function(s,e){for(var i=new Tg(31),o=0;o<31;++o)i[o]=e+=1<<s[o-1];var p=new MC(i[30]);for(o=1;o<30;++o)for(var a=i[o];a<i[o+1];++a)p[a]=a-i[o]<<5|o;return{b:i,r:p}},yw=_w(mw,2),vw=yw.b,CC=yw.r;vw[28]=258,CC[258]=28;for(var AC=_w(gw,0).b,xw=new Tg(32768),us=0;us<32768;++us){var hm=(43690&us)>>1|(21845&us)<<1;xw[us]=((65280&(hm=(61680&(hm=(52428&hm)>>2|(13107&hm)<<2))>>4|(3855&hm)<<4))>>8|(255&hm)<<8)>>1}var Mg=function(s,e,i){for(var o=s.length,p=0,a=new Tg(e);p<o;++p)s[p]&&++a[s[p]-1];var f,w=new Tg(e);for(p=1;p<e;++p)w[p]=w[p-1]+a[p-1]<<1;f=new Tg(1<<e);var E=15-e;for(p=0;p<o;++p)if(s[p])for(var O=p<<4|s[p],x=e-s[p],C=w[s[p]-1]++<<x,k=C|(1<<x)-1;C<=k;++C)f[xw[C]>>E]=O;return f},Eg=new ol(288);for(us=0;us<144;++us)Eg[us]=8;for(us=144;us<256;++us)Eg[us]=9;for(us=256;us<280;++us)Eg[us]=7;for(us=280;us<288;++us)Eg[us]=8;var bw=new ol(32);for(us=0;us<32;++us)bw[us]=5;var PC=Mg(Eg,9),IC=Mg(bw,5),Cv=function(s){for(var e=s[0],i=1;i<s.length;++i)s[i]>e&&(e=s[i]);return e},kc=function(s,e,i){var o=e/8|0;return(s[o]|s[o+1]<<8)>>(7&e)&i},Av=function(s,e){var i=e/8|0;return(s[i]|s[i+1]<<8|s[i+2]<<16)>>(7&e)},DC=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Oc=function(s,e,i){var o=new Error(e||DC[s]);if(o.code=s,Error.captureStackTrace&&Error.captureStackTrace(o,Oc),!i)throw o;return o},kC=new ol(0),OC=typeof TextDecoder<"u"&&new TextDecoder;try{OC.decode(kC,{stream:!0})}catch{}const LC={gzip_data:"gzip"};class Ul extends Error{constructor(e){super(e),this.name="MRTError"}}const RC={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},ww={uint32:1,uint16:2,uint8:4},zC={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Pv;class Iv{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new Ul(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),o=new DataView(e);if(i[0]!==13)throw new Ul("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),o=this.getHeaderLength(e);if(i.length<o)throw new Ul(`Expected header with length >= ${o} but got buffer of length ${i.length}`);const p=function(a,f){return a.readFields(fC,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new Pv(i.subarray(0,o)));if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new Ul(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const a of p.layers)this.layers[a.name]=new FC(a,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],o=this.getLayer(e.layerName);for(let p of e.blockIndices){const a=o.dataIndex[p],f=a.firstByte-e.firstByte,w=a.lastByte-e.firstByte;if(o._blocksInProgress.has(p))continue;const E={layerName:o.name,firstByte:f,lastByte:w,pixelFormat:o.pixelFormat,blockIndex:p,blockShape:[a.bands.length].concat(o.bandShape),buffer:o.buffer,codec:a.codec.codec,filters:a.filters.map(O=>O.filter)};o._blocksInProgress.add(p),i.push(E)}return new Sw(i,()=>{i.forEach(p=>o._blocksInProgress.delete(p.blockIndex))},(p,a)=>{if(i.forEach(f=>o._blocksInProgress.delete(f.blockIndex)),p)throw p;a.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class FC{constructor({version:e,name:i,units:o,tileSize:p,pixelFormat:a,buffer:f,dataIndex:w},E){if(this.version=e,this.version!==1)throw new Ul(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=o,this.tileSize=p,this.buffer=f,this.pixelFormat=RC[a],this.dataIndex=w,this.bandShape=[p+2*f,p+2*f,ww[this.pixelFormat]],this._decodedBlocks=new Mv(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return ww[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[o,p]of this.dataIndex.entries()){for(const[a,f]of p.bands.entries())if(f===e)return{bandIndex:i+a,blockIndex:o,blockBandIndex:a};i+=p.bands.length}break;case"number":for(const[o,p]of this.dataIndex.entries()){if(e>=i&&e<i+p.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-i};i+=p.bands.length}break;default:throw new Ul(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Ul(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,o=-1/0;const p=[],a=new Set;for(const f of e){const{blockIndex:w}=this.getBlockForBand(f);if(w<0)throw new Ul(`Invalid band: ${JSON.stringify(f)}`);const E=this.dataIndex[w];p.includes(w)||p.push(w),a.add(w),i=Math.min(i,E.firstByte),o=Math.max(o,E.lastByte)}if(a.size>this.cacheSize)throw new Ul(`Number of blocks to decode (${a.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:o,blockIndices:p}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:o}=this.getBlockForBand(e),p=this._decodedBlocks.get(i.toString());if(!p)throw new Ul(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const a=this.dataIndex[i],f=this.bandShape.reduce((O,x)=>O*x,1),w=o*f,E=p.subarray(w,w+f);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:a.offset,scale:a.scale}}}Iv.setPbf=function(s){Pv=s};class Sw{constructor(e,i,o){this.tasks=e,this._onCancel=i,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}Iv.performDecoding=function(s,e){const i=new Uint8Array(s);return Promise.all(e.tasks.map(o=>{const{layerName:p,firstByte:a,lastByte:f,pixelFormat:w,blockShape:E,blockIndex:O,filters:x,codec:C}=o,k=i.subarray(a,f+1),M=new Uint32Array(E[0]*E[1]*E[2]);let P;if(C!=="gzip_data")throw new Ul(`Unhandled codec: ${C}`);return P=function(R,$){if(!globalThis.DecompressionStream&&$==="gzip_data")return Promise.resolve(((Z=function(fe){fe[0]==31&&fe[1]==139&&fe[2]==8||Oc(6,"invalid gzip data");var Ce=fe[3],Ee=10;4&Ce&&(Ee+=2+(fe[10]|fe[11]<<8));for(var Me=(Ce>>3&1)+(Ce>>4&1);Me>0;Me-=!fe[Ee++]);return Ee+(2&Ce)}(ee=R))+8>ee.length&&Oc(6,"invalid gzip data"),function(fe,Ce,Ee,Me){var $e=fe.length;if(!$e||Ce.f&&!Ce.l)return Ee||new ol(0);var De=!Ee,Ge=De||Ce.i!=2,Xe=Ce.i;De&&(Ee=new ol(3*$e));var qe,et,nt=function(kd){var Jp=Ee.length;if(kd>Jp){var Ig=new ol(Math.max(2*Jp,kd));Ig.set(Ee),Ee=Ig}},ct=Ce.f||0,it=Ce.p||0,Ct=Ce.b||0,Nt=Ce.l,Et=Ce.d,si=Ce.m,ti=Ce.n,Gt=8*$e;do{if(!Nt){ct=kc(fe,it,1);var Ut=kc(fe,it+1,3);if(it+=3,!Ut){var xi=fe[(Gi=4+((it+7)/8|0))-4]|fe[Gi-3]<<8,ui=Gi+xi;if(ui>$e){Xe&&Oc(0);break}Ge&&nt(Ct+xi),Ee.set(fe.subarray(Gi,ui),Ct),Ce.b=Ct+=xi,Ce.p=it=8*ui,Ce.f=ct;continue}if(Ut==1)Nt=PC,Et=IC,si=9,ti=5;else if(Ut==2){var fi=kc(fe,it,31)+257,Ni=kc(fe,it+10,15)+4,Ki=fi+kc(fe,it+5,31)+1;it+=14;for(var er=new ol(Ki),tr=new ol(19),cr=0;cr<Ni;++cr)tr[EC[cr]]=kc(fe,it+3*cr,7);it+=3*Ni;var ur=Cv(tr),nn=(1<<ur)-1,Nr=Mg(tr,ur);for(cr=0;cr<Ki;){var Gi,Rr=Nr[kc(fe,it,nn)];if(it+=15&Rr,(Gi=Rr>>4)<16)er[cr++]=Gi;else{var Fr=0,hn=0;for(Gi==16?(hn=3+kc(fe,it,3),it+=2,Fr=er[cr-1]):Gi==17?(hn=3+kc(fe,it,7),it+=3):Gi==18&&(hn=11+kc(fe,it,127),it+=7);hn--;)er[cr++]=Fr}}var Zn=er.subarray(0,fi),hs=er.subarray(fi);si=Cv(Zn),ti=Cv(hs),Nt=Mg(Zn,si),Et=Mg(hs,ti)}else Oc(1);if(it>Gt){Xe&&Oc(0);break}}Ge&&nt(Ct+131072);for(var Kn=(1<<si)-1,On=(1<<ti)-1,as=it;;as=it){var _s=(Fr=Nt[Av(fe,it)&Kn])>>4;if((it+=15&Fr)>Gt){Xe&&Oc(0);break}if(Fr||Oc(2),_s<256)Ee[Ct++]=_s;else{if(_s==256){as=it,Nt=null;break}var fo=_s-254;_s>264&&(fo=kc(fe,it,(1<<(Rc=mw[cr=_s-257]))-1)+vw[cr],it+=Rc);var cn=Et[Av(fe,it)&On],xa=cn>>4;if(cn||Oc(3),it+=15&cn,hs=AC[xa],xa>3){var Rc=gw[xa];hs+=Av(fe,it)&(1<<Rc)-1,it+=Rc}if(it>Gt){Xe&&Oc(0);break}Ge&&nt(Ct+131072);var jl=Ct+fo;if(Ct<hs){var $l=0-hs,Kp=Math.min(hs,jl);for($l+Ct<0&&Oc(3);Ct<Kp;++Ct)Ee[Ct]=(void 0)[$l+Ct]}for(;Ct<jl;++Ct)Ee[Ct]=Ee[Ct-hs]}}Ce.l=Nt,Ce.p=as,Ce.b=Ct,Ce.f=ct,Nt&&(ct=1,Ce.m=si,Ce.d=Et,Ce.n=ti)}while(!ct);return Ct!=Ee.length&&De?(qe=Ee,((et=Ct)==null||et>qe.length)&&(et=qe.length),new ol(qe.subarray(0,et))):Ee.subarray(0,Ct)}(ee.subarray(Z,-8),{i:2},new ol(((G=ee)[(J=G.length)-4]|G[J-3]<<8|G[J-2]<<16|G[J-1]<<24)>>>0))));var G,J,ee,Z;const ne=LC[$];if(!ne)throw new Error(`Unhandled codec: ${$}`);const le=new globalThis.DecompressionStream(ne);return new Response(new Blob([R]).stream().pipeThrough(le)).arrayBuffer().then(fe=>new Uint8Array(fe))}(k,C).then(R=>(function($,G){$.readFields(xC,G)}(new Pv(R),M),new zC[w](M.buffer))),P.then(R=>{for(let $=x.length-1;$>=0;$--)switch(x[$]){case"delta_filter":wC(R,E);break;case"zigzag_filter":SC(R);break;case"bitshuffle_filter":TC(R,w);break;default:throw new Ul(`Unhandled filter "${x[$]}"`)}return{layerName:p,blockIndex:O,data:R}}).catch(R=>{throw R})}))},_i(Sw,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let Cg,Dv,Lc,dm,kv,pm=null;function Tw(){return Pa()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Dv||ts.DRACO_URL}function Mw(){if(Pa()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(dm)return dm;const s=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return dm=WebAssembly.validate(s)?ts.MESHOPT_SIMD_URL:ts.MESHOPT_URL,dm}const ay={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},BC={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Ag={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Ew(s,e,i){const o=i.json.bufferViews.length,p=i.buffers.length;e.bufferView=o,i.json.bufferViews[o]={buffer:p,byteLength:s.byteLength},i.buffers[p]=s}const Ov="KHR_draco_mesh_compression";function NC(s,e){const i=s.extensions&&s.extensions[Ov];if(!i)return;const o=new Lc.Decoder,p=Iw(e,i.bufferView),a=new Lc.Mesh;if(!o.DecodeArrayToMesh(p,p.byteLength,a))throw new Error("Failed to decode Draco mesh");const f=e.json.accessors[s.indices],w=ay[f.componentType],E=f.count*w.BYTES_PER_ELEMENT,O=Lc._malloc(E);w===Uint16Array?o.GetTrianglesUInt16Array(a,E,O):o.GetTrianglesUInt32Array(a,E,O),Ew(Lc.memory.buffer.slice(O,O+E),f,e),Lc._free(O);for(const x of Object.keys(i.attributes)){const C=o.GetAttributeByUniqueId(a,i.attributes[x]),k=e.json.accessors[s.attributes[x]],M=BC[k.componentType],P=k.count*Ag[k.type]*ay[k.componentType].BYTES_PER_ELEMENT,R=Lc._malloc(P);o.GetAttributeDataArrayForAllPoints(a,C,Lc[M],P,R),Ew(Lc.memory.buffer.slice(R,R+P),k,e),Lc._free(R)}o.destroy(),a.destroy(),delete s.extensions[Ov]}const ly="EXT_meshopt_compression";function VC(s,e){if(!s.extensions||!s.extensions[ly])return;const i=s.extensions[ly],o=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),p=new Uint8Array(i.count*i.byteStride);kv.decodeGltfBuffer(p,i.count,i.byteStride,o,i.mode,i.filter),s.buffer=e.buffers.length,s.byteOffset=0,e.buffers[s.buffer]=p.buffer,delete s.extensions[ly]}const Cw=1179937895,Aw=new TextDecoder("utf8");function Pw(s,e){return new URL(s,e).href}function UC(s,e,i,o){return fetch(Pw(s.uri,o)).then(p=>p.arrayBuffer()).then(p=>{e.buffers[i]=p})}function Iw(s,e){const i=s.json.bufferViews[e];return new Uint8Array(s.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function jC(s,e,i,o){if(s.uri){const p=Pw(s.uri,o);return fetch(p).then(a=>a.blob()).then(a=>createImageBitmap(a)).then(a=>{e.images[i]=a})}if(s.bufferView!==void 0){const p=Iw(e,s.bufferView),a=new Blob([p],{type:s.mimeType});return createImageBitmap(a).then(f=>{e.images[i]=f})}}function Dw(s,e=0,i){const o={json:null,images:[],buffers:[]};if(new Uint32Array(s,e,1)[0]===Cw){const x=new Uint32Array(s,e);let C=2;const k=(x[C++]>>2)-3,M=x[C++]>>2;if(C++,o.json=JSON.parse(Aw.decode(x.subarray(C,C+M))),C+=M,C<k){const P=x[C++];C++;const R=e+(C<<2);o.buffers[0]=s.slice(R,R+P)}}else o.json=JSON.parse(Aw.decode(new Uint8Array(s,e)));const{buffers:p,images:a,meshes:f,extensionsUsed:w,bufferViews:E}=o.json;let O=Promise.resolve();if(p){const x=[];for(let C=0;C<p.length;C++){const k=p[C];k.uri?x.push(UC(k,o,C,i)):o.buffers[C]||(o.buffers[C]=null)}O=Promise.all(x)}return O.then(()=>{const x=[],C=w&&w.includes(Ov),k=w&&w.includes(ly);if(C&&x.push(function(){if(!Lc)return Cg??(Cg=function(M){let P,R=null;function $(){P=new Uint8Array(R.buffer)}function G(){throw new Error("Unexpected Draco error.")}const J={a:{a:G,d:function(ee,Z,ne){return P.copyWithin(ee,Z,Z+ne)},c:function(ee){const Z=P.length,ne=Math.max(ee>>>0,Math.ceil(1.2*Z)),le=Math.ceil((ne-Z)/65536);try{return R.grow(le),$(),!0}catch{return!1}},b:G}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(M,J):M.then(ee=>ee.arrayBuffer()).then(ee=>WebAssembly.instantiate(ee,J))).then(ee=>{const{Rb:Z,Qb:ne,P:le,T:fe,X:Ce,Ja:Ee,La:Me,Qa:$e,Va:De,Wa:Ge,eb:Xe,jb:qe,f:et,e:nt,yb:ct,zb:it,Ab:Ct,Bb:Nt,Db:Et,Gb:si}=ee.instance.exports;R=nt;const ti=(()=>{let Gt=0,Ut=0,xi=0,ui=0;return fi=>{xi&&(Z(ui),Z(Gt),Ut+=xi,xi=Gt=0),Gt||(Ut+=128,Gt=ne(Ut));const Ni=fi.length+7&-8;let Ki=Gt;Ni>=Ut&&(xi=Ni,Ki=ui=ne(Ni));for(let er=0;er<fi.length;er++)P[Ki+er]=fi[er];return Ki}})();return $(),et(),{memory:nt,_free:Z,_malloc:ne,Mesh:class{constructor(){this.ptr=le()}destroy(){fe(this.ptr)}},Decoder:class{constructor(){this.ptr=Ee()}destroy(){qe(this.ptr)}DecodeArrayToMesh(Gt,Ut,xi){const ui=ti(Gt),fi=Me(this.ptr,ui,Ut,xi.ptr);return!!Ce(fi)}GetAttributeByUniqueId(Gt,Ut){return{ptr:$e(this.ptr,Gt.ptr,Ut)}}GetTrianglesUInt16Array(Gt,Ut,xi){De(this.ptr,Gt.ptr,Ut,xi)}GetTrianglesUInt32Array(Gt,Ut,xi){Ge(this.ptr,Gt.ptr,Ut,xi)}GetAttributeDataArrayForAllPoints(Gt,Ut,xi,ui,fi){Xe(this.ptr,Gt.ptr,Ut.ptr,xi,ui,fi)}},DT_INT8:ct(),DT_UINT8:it(),DT_INT16:Ct(),DT_UINT16:Nt(),DT_UINT32:Et(),DT_FLOAT32:si()}})}(fetch(Tw())),Cg.then(M=>{Lc=M,Cg=void 0}))}()),k&&x.push(function(){if(kv)return;const M=function(P){let R;const $=WebAssembly.instantiateStreaming(P,{}).then(ee=>{R=ee.instance,R.exports.__wasm_call_ctors()}),G={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},J={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:$,supported:!0,decodeGltfBuffer(ee,Z,ne,le,fe,Ce){(function(Ee,Me,$e,De,Ge,Xe,qe){const et=Ee.exports.sbrk,nt=De+3&-4,ct=et(nt*Ge),it=et(Xe.length),Ct=new Uint8Array(Ee.exports.memory.buffer);Ct.set(Xe,it);const Nt=Me(ct,De,Ge,it,Xe.length);if(Nt===0&&qe&&qe(ct,nt,Ge),$e.set(Ct.subarray(ct,ct+De*Ge)),et(ct-et(0)),Nt!==0)throw new Error(`Malformed buffer data: ${Nt}`)})(R,R.exports[J[fe]],ee,Z,ne,le,R.exports[G[Ce]])}}}(fetch(Mw()));return M.ready.then(()=>{kv=M})}()),a)for(let M=0;M<a.length;M++)x.push(jC(a[M],o,M,i));return(x.length?Promise.all(x):Promise.resolve()).then(()=>{if(C&&f)for(const{primitives:M}of f)for(const P of M)NC(P,o);if(k&&f&&E)for(const M of E)VC(M,o);return o})})}function Zp(s,e){const i=s.json.bufferViews[e.bufferView],o=ay[e.componentType];return new o(s.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Ag[e.type]*o.BYTES_PER_ELEMENT?i.byteStride/o.BYTES_PER_ELEMENT:Ag[e.type]))}function Lv(s,e,i,o){const p=ay[e.componentType],a=function(x){switch(x){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),f=s.json.bufferViews[e.bufferView],w=f.byteStride?f.byteStride/p.BYTES_PER_ELEMENT:Ag[e.type],E=i.float32,O=E.length/i.capacity;for(let x=0,C=0;x<e.count*w;x+=w,C+=O)for(let k=0;k<O;k++)E[C+k]=o[x+k]*a;i._trim()}function $C(s,e,i){const o=s.indices,p=s.attributes,a={};a.indexArray=new gs;const f=e.json.accessors[o],w=f.count/3;a.indexArray.reserve(w);const E=Zp(e,f);for(let k=0;k<w;k++)a.indexArray.emplaceBack(E[3*k],E[3*k+1],E[3*k+2]);a.indexArray._trim(),a.vertexArray=new ha;const O=e.json.accessors[p.POSITION];a.vertexArray.reserve(O.count);const x=Zp(e,O);for(let k=0;k<O.count;k++)a.vertexArray.emplaceBack(x[3*k],x[3*k+1],x[3*k+2]);if(a.vertexArray._trim(),a.aabb=new bi(O.min,O.max),a.centroid=function(k,M){const P=[0,0,0],R=k.length;if(R>0){for(let $=0;$<R;$++){const G=3*k[$];P[0]+=M[G],P[1]+=M[G+1],P[2]+=M[G+2]}P[0]/=R,P[1]/=R,P[2]/=R}return P}(E,x),p.COLOR_0!==void 0){const k=e.json.accessors[p.COLOR_0],M=Ag[k.type],P=Zp(e,k);a.colorArray=M===3?new ha:new ln,a.colorArray.resize(k.count),Lv(e,k,a.colorArray,P)}if(p.NORMAL!==void 0){a.normalArray=new ha;const k=e.json.accessors[p.NORMAL];a.normalArray.resize(k.count);const M=Zp(e,k);Lv(e,k,a.normalArray,M)}if(p.TEXCOORD_0!==void 0&&i.length>0){a.texcoordArray=new Ll;const k=e.json.accessors[p.TEXCOORD_0];a.texcoordArray.resize(k.count);const M=Zp(e,k);Lv(e,k,a.texcoordArray,M)}if(p._FEATURE_ID_RGBA4444!==void 0){const k=e.json.accessors[p._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(a.featureData=Zp(e,k))}p._FEATURE_RGBA4444!==void 0&&(a.featureData=new Uint32Array(Zp(e,e.json.accessors[p._FEATURE_RGBA4444]).buffer));const C=s.material;return a.material=function(k,M){const{emissiveFactor:P=[0,0,0],alphaMode:R="OPAQUE",alphaCutoff:$=.5,normalTexture:G,occlusionTexture:J,emissiveTexture:ee,doubleSided:Z}=k,{baseColorFactor:ne=[1,1,1,1],metallicFactor:le=1,roughnessFactor:fe=1,baseColorTexture:Ce,metallicRoughnessTexture:Ee}=k.pbrMetallicRoughness||{},Me=J?M[J.index]:void 0;if(J&&J.extensions&&J.extensions.KHR_texture_transform&&Me){const $e=J.extensions.KHR_texture_transform;Me.offsetScale=[$e.offset[0],$e.offset[1],$e.scale[0],$e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Ar(...ne),metallicFactor:le,roughnessFactor:fe,baseColorTexture:Ce?M[Ce.index]:void 0,metallicRoughnessTexture:Ee?M[Ee.index]:void 0},doubleSided:Z,emissiveFactor:P,alphaMode:R,alphaCutoff:$,normalTexture:G?M[G.index]:void 0,occlusionTexture:Me,emissionTexture:ee?M[ee.index]:void 0,defined:k.defined===void 0}}(C!==void 0?e.json.materials[C]:{defined:!1},i),a}function kw(s,e,i){const{matrix:o,rotation:p,translation:a,scale:f,mesh:w,extras:E,children:O}=s,x={};if(x.matrix=o||Ye.mat4.fromRotationTranslationScale([],p||[0,0,0,1],a||[0,0,0],f||[1,1,1]),w!==void 0){x.meshes=i[w];const C=x.anchor=[0,0];for(const k of x.meshes){const{min:M,max:P}=k.aabb;C[0]+=M[0]+P[0],C[1]+=M[1]+P[1]}C[0]=Math.floor(C[0]/x.meshes.length/2),C[1]=Math.floor(C[1]/x.meshes.length/2)}if(E&&(E.id&&(x.id=E.id),E.lights&&(x.lights=function(C){if(!C.length)return[];const k=function(G){const J=atob(G),ee=new Uint8Array(J.length);for(let Z=0;Z<J.length;Z++)ee[Z]=J.codePointAt(Z);return ee}(C),M=[],P=k.length/24,R=new Uint16Array(k.buffer),$=new Float32Array(k.buffer);for(let G=0;G<P;G++){const J=R[2*G*6]/30,ee=R[2*G*6+1]/30,Z=R[2*G*6+10]/100,ne=$[6*G+1],le=$[6*G+2],fe=$[6*G+3],Ce=$[6*G+4],Ee=fe-ne,Me=Ce-le,$e=Math.hypot(Ee,Me);M.push({pos:[ne+.5*Ee,le+.5*Me,ee],normal:[Me/$e,-Ee/$e,0],width:$e,height:J,depth:Z,points:[ne,le,fe,Ce]})}return M}(E.lights))),O){const C=[];for(const k of O)C.push(kw(e.json.nodes[k],e,i));x.children=C}return x}function GC(s){if(s.vertices.length===0||s.indices.length===0)return null;const e=new ng(s.vertices,s.indices,8,256),[i,o]=[e.min.clone(),e.max.clone()];return{vertices:s.vertices,indices:s.indices,grid:e,min:i,max:o}}function HC(s){if(!s.extras||!s.extras.ground)return null;const e=s.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const o=[];for(const f of i){if(!Array.isArray(f)||f.length!==2)continue;const w=f[0],E=f[1];typeof w=="number"&&typeof E=="number"&&o.push(new Wt(w,E))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let p=0;for(let f=0;f<o.length;f++){const w=o[f],E=o[(f+1)%o.length],O=o[(f+2)%o.length];p+=(w.x-E.x)*(O.y-E.y)-(O.x-E.x)*(w.y-E.y)}p>0&&o.reverse();const a=Sd(o.flatMap(f=>[f.x,f.y]),[]);return a.length===0?null:{vertices:o,indices:a}}function WC(s,e){const i=[],o=[];let p=0;const a=[];for(const f of s){p=i.length;const w=f.vertexArray.float32,E=f.indexArray.uint16;for(let O=0;O<f.vertexArray.length;O++)a[0]=w[3*O+0],a[1]=w[3*O+1],a[2]=w[3*O+2],Ye.vec3.transformMat4(a,a,e),i.push(new Wt(a[0],a[1]));for(let O=0;O<3*f.indexArray.length;O++)o.push(E[O]+p)}if(o.length%3!=0)return null;for(let f=0;f<o.length;f+=3){const w=i[o[f+0]],E=i[o[f+1]],O=i[o[f+2]];(w.x-E.x)*(O.y-E.y)-(O.x-E.x)*(w.y-E.y)>0&&([o[f+1],o[f+2]]=[o[f+2],o[f+1]])}return{vertices:i,indices:o}}function Ow(s){const e=function(E,O){const x=[],C=WebGL2RenderingContext;if(E.json.textures)for(const k of E.json.textures){const M={magFilter:C.LINEAR,minFilter:C.NEAREST,wrapS:C.REPEAT,wrapT:C.REPEAT};k.sampler!==void 0&&Object.assign(M,E.json.samplers[k.sampler]),x.push({image:O[k.source],sampler:M,uploaded:!1})}return x}(s,s.images),i=function(E,O){const x=[];for(const C of E.json.meshes){const k=[];for(const M of C.primitives)k.push($C(M,E,O));x.push(k)}return x}(s,e),{scenes:o,scene:p,nodes:a}=s.json,f=o?o[p||0].nodes:a,w=[];for(const E of f)w.push(kw(a[E],s,i));return function(E,O,x){const C={},k=new Set;for(let M=0;M<E.length;M++){const P=x[O[M]];if(!P.extras)continue;const R=P.extras["mapbox:footprint:version"],$=P.extras["mapbox:footprint:id"];(R||$)&&k.add(M),R==="1.0.0"&&$&&(C[$]=M)}for(let M=0;M<E.length;M++){if(k.has(M))continue;const P=E[M],R=x[O[M]];if(!R.extras)continue;let $=null;P.id in C&&($=WC(E[C[P.id]].meshes,P.matrix)),$||($=HC(R)),$&&(P.footprint=GC($))}if(k.size>0){const M=Array.from(k.values()).sort((P,R)=>P-R);for(let P=M.length-1;P>=0;P--)E.splice(M[P],1)}}(w,f,s.json.nodes),w}function qC(s){s.heightmap=new Float32Array(4096),s.heightmap.fill(-1);const e=s.vertexArray.float32,i=s.aabb.min[0]-1,o=s.aabb.min[1]-1,p=qp/(s.aabb.max[0]-i+2),a=qp/(s.aabb.max[1]-o+2);for(let f=0;f<e.length;f+=3){const w=e[f+2],E=(e[f+0]-i)*p|0,O=(e[f+1]-o)*a|0;w>s.heightmap[O*qp+E]&&(s.heightmap[O*qp+E]=w)}}function YC(s,e){const i={};i.indexArray=new gs,i.indexArray.reserve(4*s.length),i.vertexArray=new ha,i.vertexArray.reserve(10*s.length),i.colorArray=new ln,i.vertexArray.reserve(10*s.length);let o=0;for(const f of s){const w=Math.min(10,Math.max(4,1.3*f.height))*e,E=[-f.normal[1],f.normal[0],0],O=Math.min(.29,.1*f.width/f.depth),x=f.width-2*f.depth*e*(O+.01),C=Ye.vec3.scaleAndAdd([],f.pos,E,x/2),k=Ye.vec3.scaleAndAdd([],f.pos,E,-x/2),M=[C[0],C[1],C[2]+f.height],P=[k[0],k[1],k[2]+f.height],R=Ye.vec3.scaleAndAdd([],f.normal,E,O);Ye.vec3.scale(R,R,w);const $=Ye.vec3.scaleAndAdd([],f.normal,E,-O);Ye.vec3.scale($,$,w),Ye.vec3.add(R,C,R),Ye.vec3.add($,k,$),C[2]+=.1,k[2]+=.1,i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack($[0],$[1],$[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(k[0],k[1],k[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(k[0],k[1],k[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack($[0],$[1],$[2]);const G=x/w/2;i.colorArray.emplaceBack(-G-O,-1,G,.8),i.colorArray.emplaceBack(G+O,-1,G,.8),i.colorArray.emplaceBack(-G,0,G,1.3),i.colorArray.emplaceBack(G,0,G,1.3),i.colorArray.emplaceBack(G+O,-.8,G,.7),i.colorArray.emplaceBack(G+O,-.8,G,.7),i.colorArray.emplaceBack(0,0,G,1.3),i.colorArray.emplaceBack(0,0,G,1.3),i.colorArray.emplaceBack(G+O,-1.2,G,.8),i.colorArray.emplaceBack(G+O,-1.2,G,.8),i.indexArray.emplaceBack(6+o,4+o,8+o),i.indexArray.emplaceBack(7+o,9+o,5+o),i.indexArray.emplaceBack(0+o,1+o,2+o),i.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}const p={defined:!0,emissiveFactor:[0,0,0]},a={};return a.baseColorFactor=Ar.white,p.pbrMetallicRoughness=a,i.material=p,i.aabb=new bi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class Lw{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const XC=["id","tile","layer","source","sourceLayer","state"];class fm{constructor(e,i,o,p,a){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=o,this._y=p,this.properties=e.properties,this.id=a}clone(){const e=new fm(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of XC)this[i]!==void 0&&(e[i]=this[i]);return e}}class Rw{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new fc(ei,16,0),this.featureIndexArray=new wc,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,o,p,a,f=0,w=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,p,a,f);const O=this.grid;for(let x=0;x<i.length;x++){const C=i[x],k=[1/0,1/0,-1/0,-1/0];for(let M=0;M<C.length;M++){const P=C[M];k[0]=Math.min(k[0],P.x),k[1]=Math.min(k[1],P.y),k[2]=Math.max(k[2],P.x),k[3]=Math.max(k[3],P.y)}w!==0&&(k[0]-=w,k[1]-=w,k[2]+=w,k[3]+=w),k[0]<ei&&k[1]<ei&&k[2]>=0&&k[3]>=0&&O.insert(E,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new xe.VectorTile(new D_(this.rawTileData)).layers,this.sourceLayerCoder=new Lw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:o,transform:p,tileTransform:a,pixelPosMatrix:f,availableImages:w}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const E=o.bufferedTilespaceBounds,O=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(M,P,R,$)=>He(o.bufferedTilespaceGeometry,M,P,R,$));O.sort(ZC);let x=null;p.elevation&&O.length>0&&(x=am.create(p.elevation,this.tileID));const C={};let k;for(let M=0;M<O.length;M++){const P=O[M];if(P===k)continue;k=P;const R=this.featureIndexArray.get(P);let $=null;this.is3DTile?this.loadMatchingModelFeature(C,R,e,o,p):this.loadMatchingFeature(C,R,e,w,(G,J,ee,Z=0)=>($||($=j(G,this.tileID.canonical,a)),J.queryIntersectsFeature(o,G,ee,$,this.z,p,f,x,Z)))}return C}loadMatchingFeature(e,i,o,p,a){const{featureIndex:f,bucketIndex:w,sourceLayerIndex:E,layoutVertexArrayOffset:O}=i,x=this.bucketLayerIDs[w],C=o.layers,k=Object.keys(C);if(k.length&&!function(G,J){for(let ee=0;ee<G.length;ee++)if(J.indexOf(G[ee])>=0)return!0;return!1}(k,x))return;const M=o.sourceCache,P=this.sourceLayerCoder.decode(E),R=this.vtLayers[P].feature(f),$=this.getId(R,P);for(let G=0;G<x.length;G++){const J=x[G];if(!C[J])continue;const{styleLayer:ee,targets:Z}=C[J];let ne={};$!==void 0&&(ne=M.getFeatureState(ee.sourceLayer,$));const le=!a||a(R,ee,ne,O);if(!le)continue;const fe=new fm(R,this.z,this.x,this.y,$);fe.tile=this.tileID.canonical,fe.state=ne;let Ce=this.serializedLayersCache.get(J);Ce||(Ce=ee.serialize(),Ce.id=J,this.serializedLayersCache.set(J,Ce)),fe.source=Ce.source,fe.sourceLayer=Ce["source-layer"],fe.layer=Zs({},Ce),fe.layer.paint=zw(Ce.paint,ee.paint,R,ne,p),fe.layer.layout=zw(Ce.layout,ee.layout,R,ne,p);let Ee=!1;for(const Me of Z){this.updateFeatureProperties(fe,Me);const{filter:$e}=Me;if($e){if(R.properties=fe.properties,$e.needGeometry){const De=H(R,!0);if(!$e.filter(new Vr(this.tileID.overscaledZ),De,this.tileID.canonical))continue}else if(!$e.filter(new Vr(this.tileID.overscaledZ),R))continue}Ee=!0,Me.targetId&&this.addFeatureVariant(fe,Me)}Ee&&this.appendToResult(e,J,f,fe,le)}}loadMatchingModelFeature(e,i,o,p,a){const f=this.bucketLayerIDs[0][0],w=o.layers;if(!w[f])return;const{styleLayer:E,targets:O}=w[f];if(E.type!=="model")return;const x=p.tile,C=i.featureIndex,k=x.getBucket(E);if(!(k&&k instanceof Q_))return;const M=function(Ce,Ee,Me,$e){const De=Ce.getNodesInfo()[Ee];if(De.hiddenByReplacement||!De.node.meshes)return;let Ge=Number.MAX_VALUE;const Xe=De.node,qe=Me.tile,et=$e.calculatePosMatrix(qe.tileID.toUnwrapped(),$e.worldSize),nt=De.evaluatedScale;let ct=0;$e.elevation&&Xe.elevation&&(ct=Xe.elevation*$e.elevation.exaggeration()),Ye.mat4.translate(et,et,[(Xe.anchor?Xe.anchor[0]:0)*(nt[0]-1),(Xe.anchor?Xe.anchor[1]:0)*(nt[1]-1),ct]),Ye.mat4.scale(et,et,nt);const it=Me.queryGeometry,Ct=it.isPointQuery()?it.screenBounds:it.screenGeometry,Nt=function(si){const ti=Ye.mat4.multiply([],et,si.matrix);Ye.mat4.multiply(ti,$e.expandedFarZProjMatrix,ti);for(let Gt=0;Gt<si.meshes.length;++Gt){const Ut=si.meshes[Gt];if(Gt===si.lightMeshIndex)continue;const xi=L1(Ct,$e,ti,Ut.aabb);xi!=null&&(Ge=Math.min(xi,Ge))}if(si.children)for(const Gt of si.children)Nt(Gt)};if(Nt(Xe),Ge===Number.MAX_VALUE)return;const Et=new Er(0,0);return W1(qe.tileID.canonical,Et,De.node.anchor[0],De.node.anchor[1]),{intersectionZ:Ge,position:Et,feature:De.feature}}(k,C,p,a);if(!M)return;const{z:P,x:R,y:$}=x.tileID.canonical,{feature:G,intersectionZ:J,position:ee}=M;let Z={};G.id!==void 0&&(Z=o.sourceCache.getFeatureState(E.sourceLayer,G.id));const ne=new fm({},P,R,$,G.id);ne.tile=this.tileID.canonical,ne.state=Z,ne.properties=G.properties,ne.geometry={type:"Point",coordinates:[ee.lng,ee.lat]};let le=this.serializedLayersCache.get(f);le||(le=E.serialize(),le.id=f,this.serializedLayersCache.set(f,le)),ne.source=le.source,ne.sourceLayer=le["source-layer"],ne.layer=Zs({},le);let fe=!1;for(const Ce of O){this.updateFeatureProperties(ne,Ce);const{filter:Ee}=Ce;if(Ee){if(G.properties=ne.properties,Ee.needGeometry){if(!Ee.filter(new Vr(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!Ee.filter(new Vr(this.tileID.overscaledZ),G))continue}fe=!0,Ce.targetId&&this.addFeatureVariant(ne,Ce)}fe&&this.appendToResult(e,f,C,ne,J)}updateFeatureProperties(e,i,o){if(i.properties){const p={};for(const a in i.properties){const f=i.properties[a].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,o);f!=null&&(p[a]=f)}e.properties=p}}addFeatureVariant(e,i,o){const p={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(p.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(p)}appendToResult(e,i,o,p,a){let f=e[i];f===void 0&&(f=e[i]=[]),f.push({featureIndex:o,feature:p,intersectionZ:a})}lookupSymbolFeatures(e,i,o,p,a){const f={};this.loadVTLayers();for(const w of e)this.loadMatchingFeature(f,{bucketIndex:i,sourceLayerIndex:o,featureIndex:w,layoutVertexArrayOffset:0},p,a);return f}loadFeature(e){const{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();const p=this.sourceLayerCoder.decode(o),a=this.vtFeatures[p];if(a[i])return a[i];const f=this.vtLayers[p].feature(i);return a[i]=f,f}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;if(this.promoteId){const p=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(p!=null)if(Array.isArray(p)){if(!this.promoteIdExpression){const a=la(p);if(a.result!=="success"){const f=a.value.map(w=>`${w.key}: ${w.message}`).join(", ");return void qi(`Failed to create expression for promoteId: ${f}`)}this.promoteIdExpression=a.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Qd),o=this.promoteIdExpression.evaluate({zoom:0},e)}else o=e.properties[p];typeof o=="boolean"&&(o=Number(o))}return o}}function zw(s,e,i,o,p){return na(s,(a,f)=>{const w=e instanceof yc?e.get(f):null;return w&&w.evaluate?w.evaluate(i,o,p):w})}function ZC(s,e){return e-s}_i(Rw,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Fw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Rv{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=o>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const a=Fw[15&o];if(!a)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[w]=new Uint32Array(e,4,1);return new Rv(w,f,a,e)}constructor(e,i=64,o=Float64Array,p){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const a=Fw.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,w=e*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-w%8)%8;if(a<0)throw new Error(`Unexpected typed array class: ${o}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+E,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+w+E),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+E,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+a]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return zv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:f,nodeSize:w}=this,E=[0,a.length-1,0],O=[];for(;E.length;){const x=E.pop()||0,C=E.pop()||0,k=E.pop()||0;if(C-k<=w){for(let $=k;$<=C;$++){const G=f[2*$],J=f[2*$+1];G>=e&&G<=o&&J>=i&&J<=p&&O.push(a[$])}continue}const M=k+C>>1,P=f[2*M],R=f[2*M+1];P>=e&&P<=o&&R>=i&&R<=p&&O.push(a[M]),(x===0?e<=P:i<=R)&&(E.push(k),E.push(M-1),E.push(1-x)),(x===0?o>=P:p>=R)&&(E.push(M+1),E.push(C),E.push(1-x))}return O}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:a,nodeSize:f}=this,w=[0,p.length-1,0],E=[],O=o*o;for(;w.length;){const x=w.pop()||0,C=w.pop()||0,k=w.pop()||0;if(C-k<=f){for(let $=k;$<=C;$++)Nw(a[2*$],a[2*$+1],e,i)<=O&&E.push(p[$]);continue}const M=k+C>>1,P=a[2*M],R=a[2*M+1];Nw(P,R,e,i)<=O&&E.push(p[M]),(x===0?e-o<=P:i-o<=R)&&(w.push(k),w.push(M-1),w.push(1-x)),(x===0?e+o>=P:i+o>=R)&&(w.push(M+1),w.push(C),w.push(1-x))}return E}}function zv(s,e,i,o,p,a){if(p-o<=i)return;const f=o+p>>1;Bw(s,e,f,o,p,a),zv(s,e,i,o,f-1,1-a),zv(s,e,i,f+1,p,1-a)}function Bw(s,e,i,o,p,a){for(;p>o;){if(p-o>600){const O=p-o+1,x=i-o+1,C=Math.log(O),k=.5*Math.exp(2*C/3),M=.5*Math.sqrt(C*k*(O-k)/O)*(x-O/2<0?-1:1);Bw(s,e,i,Math.max(o,Math.floor(i-x*k/O+M)),Math.min(p,Math.floor(i+(O-x)*k/O+M)),a)}const f=e[2*i+a];let w=o,E=p;for(Pg(s,e,o,i),e[2*p+a]>f&&Pg(s,e,o,p);w<E;){for(Pg(s,e,w,E),w++,E--;e[2*w+a]<f;)w++;for(;e[2*E+a]>f;)E--}e[2*o+a]===f?Pg(s,e,o,E):(E++,Pg(s,e,E,p)),E<=i&&(o=E+1),i<=E&&(p=E-1)}}function Pg(s,e,i,o){Fv(s,i,o),Fv(e,2*i,2*o),Fv(e,2*i+1,2*o+1)}function Fv(s,e,i){const o=s[e];s[e]=s[i],s[i]=o}function Nw(s,e,i,o){const p=s-i,a=e-o;return p*p+a*a}r.$=hd,r.A=ks,r.B=2,r.C=hg,r.D=lm,r.E=aa,r.F=Kb,r.G=class extends K_{},r.H=Oo,r.I=Ev,r.J=Bh,r.K=Vf,r.L=nh,r.M=uu,r.N=nd,r.O=pu,r.P=Wt,r.Q=uh,r.R=Pr,r.S=zf,r.T=dv,r.U=la,r.V=K_,r.W=ru,r.X=Xa,r.Y=iu,r.Z=no,r._=Yo,r.a=function(s){return ts.API_CDN_URL_REGEX.test(s)},r.a$=fm,r.a0=Cl,r.a1=Df,r.a2=function(s){const e=s.value;let i=[];if(!e)return i;const o=Oo(e);return o!=="string"?(i=i.concat([new K_(s.key,e,`string expected, "${o}" found`)]),i):(z1(e,!0)||(i=i.concat([new K_(s.key,e,`invalid url "${e}"`)])),i)},r.a3=dt,r.a4=bo,r.a5=on,r.a6=Ht,r.a7=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return Jr(s.expression.evaluate(e))}interpolate(s,e,i){return{x:Ii(s.x,e.x,i),y:Ii(s.y,e.y,i),z:Ii(s.z,e.z,i),azimuthal:Ii(s.azimuthal,e.azimuthal,i),polar:Ii(s.polar,e.polar,i)}}},r.a8=Vr,r.a9=dc,r.aA=ya,r.aB=class{constructor(s){this.entries={},this.scheduler=s}request(s,e,i,o){const p=this.entries[s]=this.entries[s]||{callbacks:[]};if(p.result){const[a,f]=p.result;return this.scheduler?this.scheduler.add(()=>{o(a,f)},e):o(a,f),()=>{}}return p.callbacks.push(o),p.cancel||(p.cancel=i((a,f)=>{p.result=[a,f];for(const w of p.callbacks)this.scheduler?this.scheduler.add(()=>{w(a,f)},e):w(a,f);setTimeout(()=>delete this.entries[s],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(a=>a!==o),p.callbacks.length||(p.cancel(),delete this.entries[s]))}}},r.aC=ua,r.aD=function(s,e,i){const o=JSON.stringify(s.request);return s.data&&(this.deduped.entries[o]={result:[null,s.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},p=>{const a=Nn(s.request,(f,w,E,O)=>{f?p(f):w&&p(null,{vectorTile:i?void 0:new xe.VectorTile(new D_(w)),rawData:w,cacheControl:E,expires:O})});return()=>{a.cancel(),p()}},e)},r.aE=function(s){pi++,pi>mt&&(s.getActor().send("enforceCacheSizeLimit",Je),pi=0)},r.aF=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},r.aG=$t,r.aH=S1,r.aI=P1,r.aJ=w1,r.aK=function(s,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<s.length;o++){const p=document.createElement("source");$s(s[o])||(i.crossOrigin="Anonymous"),p.src=s[o],i.appendChild(p)}return{cancel:()=>{}}},r.aL=W_,r.aM=function(s){return fetch(s).then(e=>e.arrayBuffer()).then(e=>Dw(e,0,s))},r.aN=Ow,r.aO=class{constructor(s,e,i,o){this.id=s,this.position=e!=null?new Er(e[0],e[1]):new Er(0,0),this.orientation=i??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new bi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(s,e){if(Ye.mat4.multiply(s.matrix,e,s.matrix),s.meshes)for(const i of s.meshes){const o=bi.applyTransformFast(i.aabb,s.matrix);this.aabb.encapsulate(o)}if(s.children)for(const i of s.children)this._applyTransformations(i,s.matrix)}computeBoundsAndApplyParent(){const s=Ye.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,s)}computeModelMatrix(s,e,i,o,p,a,f=!1){U1(this.matrix,this,s.transform,this.position,e,i,o,p,a,f)}upload(s){if(!this.uploaded){for(const e of this.nodes)_v(e,s);for(const e of this.nodes)J_(e);this.uploaded=!0}}destroy(){for(const s of this.nodes)yv(s)}},r.aP=Vc,r.aQ=pg,r.aR=co,r.aS=Wn,r.aT=tn,r.aU=gs,r.aV=$a,r.aW=Ap,r.aX=G_,r.aY=function(){Qs.isLoading()||Qs.isLoaded()||lh()!=="deferred"||Qo()},r.aZ=yp,r.a_=H,r.aa=n,r.ab=Ye,r.ac=Kr,r.ad=yc,r.ae=ho,r.af=Ii,r.ag=ei,r.ah=Xd,r.ai=rr,r.aj=Ar,r.ak=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return function([i,o]){const p=Jr([1,i,o]);return{x:p.x,y:p.y,z:p.z}}(s.expression.evaluate(e))}interpolate(s,e,i){return{x:Ii(s.x,e.x,i),y:Ii(s.y,e.y,i),z:Ii(s.z,e.z,i)}}},r.al=function(s,e,i=0,o=!0){const p=new Wt(i,i),a=s.sub(p),f=e.add(p),w=[a,new Wt(f.x,a.y),f,new Wt(a.x,f.y)];return o&&w.push(a.clone()),w},r.am=function(s,e){const i=[];for(let o=0;o<s.length;o++){const p=ra(o-1,-1,s.length-1),a=ra(o+1,-1,s.length-1),f=s[o],w=s[a],E=s[p].sub(f).unit(),O=w.sub(f).unit(),x=O.angleWithSep(E.x,E.y),C=E.add(O).unit().mult(-1*e/Math.sin(x/2));i.push(f.add(C))}return i},r.an=l1,r.ao=He,r.ap=function(s,e,i=0){return Ye.vec3.fromValues(((e.x-i)*s.scale-s.x)*ei,(e.y*s.scale-s.y)*ei,zp(e.z,e.y))},r.aq=ji,r.ar=Cb,r.as=function(s){let e=1/0,i=1/0,o=-1/0,p=-1/0;for(const a of s)e=Math.min(e,a.x),i=Math.min(i,a.y),o=Math.max(o,a.x),p=Math.max(p,a.y);return{min:new Wt(e,i),max:new Wt(o,p)}},r.at=_a,r.au=Oe,r.av=y,r.aw=nr,r.ax=Hn,r.ay=function(s,e){const i={};for(let o=0;o<e.length;o++){const p=e[o];p in s&&(i[p]=s[p])}return i},r.az=rl,r.b=function(s){return ts.API_FONTS_REGEX.test(s)},r.b$=X_,r.b0=Uc,r.b1=H0,r.b2=rg,r.b3=j,r.b4=wo,r.b5=Cp,r.b6=Ei,r.b7=Sn,r.b8=Sd,r.b9=cv,r.bA=Hi,r.bB=rv,r.bC=n1,r.bD=ev,r.bE=Rv,r.bF=ra,r.bG=jc,r.bH=to,r.bI=function(s,e,i){s[4*e+0]=i[0],s[4*e+1]=i[1],s[4*e+2]=i[2],s[4*e+3]=i[3]},r.bJ=Tc,r.bK=To,r.bL=Bo,r.bM=Pn,r.bN=xh,r.bO=Er,r.bP=p1,r.bQ=kt,r.bR=lr,r.bS=D1,r.bT=Bt,r.bU=Hs,r.bV=function(s,e,i,o,p,a,f,w,E){if(E.name==="globe")return Hs(s,e,new Bt(i,o,p),!1);const O=pg({z:i,x:o,y:p},E);return new bi([(a+O.x/O.scale)*e,e*(O.y/O.scale),f],[(a+O.x2/O.scale)*e,e*(O.y2/O.scale),w])},r.bW=function(s,e,i){let o=0;for(let p=0;p<2;++p)s[p]>0&&(o+=(s[p]-0)*(s[p]-0)),e[p]<0&&(o+=(0-e[p])*(0-e[p]));return o},r.bX=uo,r.bY=vd,r.bZ=function(s){const e=Ye.mat4.identity(new Float64Array(16));Ye.mat4.multiply(e,s.pixelMatrix,s.globeMatrix);const i=[0,Mo,0],o=[0,No,0];return Ye.vec3.transformMat4(i,i,e),Ye.vec3.transformMat4(o,o,e),[i[0]>0&&i[0]<=s.width&&i[1]>0&&i[1]<=s.height&&!Uo(s,new Er(s.center.lat,90)),o[0]>0&&o[0]<=s.width&&o[1]>0&&o[1]<=s.height&&!Uo(s,new Er(s.center.lat,-90))]},r.b_=function(s,e){const{scale:i}=s.tileTransform,o=i*ei/(s.tileSize*Math.pow(2,e.zoom-s.tileID.overscaledZ+s.tileID.canonical.z));return Ye.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},r.ba=function(s,e){const i=ho(e.zoom);if(i===0)return Tn(s);const o=rn(s),p=Gr(o),a=_a(o.getWest())*e.worldSize,f=_a(o.getEast())*e.worldSize,w=ya(o.getNorth())*e.worldSize,E=ya(o.getSouth())*e.worldSize,O=[a,w,0],x=[f,w,0],C=[a,E,0],k=[f,E,0],M=Ye.mat4.invert([],e.globeMatrix);return Ye.vec3.transformMat4(O,O,M),Ye.vec3.transformMat4(x,x,M),Ye.vec3.transformMat4(C,C,M),Ye.vec3.transformMat4(k,k,M),p[0]=qn(p[0],C,i),p[1]=qn(p[1],k,i),p[2]=qn(p[2],x,i),p[3]=qn(p[3],O,i),bi.fromPoints(p)},r.bb=Yn,r.bc=Br,r.bd=qn,r.be=vu,r.bf=Mi,r.bg=Iv,r.bh=D_,r.bi=Nn,r.bj=function(s){const e=[];for(const i in s)e.push(s[i]);return e},r.bk=function(s,e){const i=[];for(const o in s)o in e||i.push(o);return i},r.bl=dl,r.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.bn=jn,r.bo=function(s,e){const{x:i,y:o}=s.point,p=Co(i,o,s.worldSize/s._pixelsPerMercatorPixel,0,0);return Ye.mat4.multiply(p,p,jr(Tn(e)))},r.bp=tm,r.bq=sl,r.br=I_,r.bs=function(s,e,i,o,p){const a=5*e+2;s.float32[a+0]=i,s.float32[a+1]=o,s.float32[a+2]=p},r.bt=$_,r.bu=Zb,r.bv=oe,r.bw=po,r.bx=Ot,r.by=R1,r.bz=kr,r.c=Gu,r.c$=(s,e,i,o,p,a,f,w)=>{const E=s.transform,O=E.pitch<15?Ab(.07,.7,nr((14-E.zoom)/5,0,1)):.07,x=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Ib(s,e,i,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:p,u_width_scale:a,u_floor_width_scale:f,u_image:0,u_tile_units_to_pixels:Pb(e,E),u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(x?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:O,u_tile_to_meter:t(e.tileID.canonical,0)}},r.c0=I1,r.c1=function(s){const e=I1(s,!0);return Ye.mat2.invert([],[e[0],e[1],e[4],e[5]])},r.c2=pr,r.c3=function(s){const{x:e,y:i}=s.point,{lng:o,lat:p}=s._center;return Co(e,i,s.worldSize,o,p)},r.c4=$n,r.c5=Xt,r.c6=il,r.c7=function(s){const e=Math.round((s+45+360)%360/90)%4;return xs[e]},r.c8=45,r.c9=Bl,r.cA=class extends pa{constructor(s){super(s),this.current=Dp}set(s,e,i){if(this.fetchUniformLocation(s,e)){for(let o=0;o<9;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.cB=Ea,r.cC=function(s,e,i){const o=ho(i.zoom),p=s.style.map._antialias,a=s.terrain&&s.terrain.exaggeration()>0;return o===0&&!p&&!a},r.cD=function(s){const e=s.pixelsPerMeter,i=e/to(1,s.center.lat),o=Ye.mat4.identity(new Float64Array(16));return Ye.mat4.translate(o,o,[s.point.x,s.point.y,0]),Ye.mat4.scale(o,o,[i,i,e]),Float32Array.from(o)},r.cE=rn,r.cF=function(s){const e=uo-5;s=nr(s,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(rr(s))),3);return Math.round(i*(bh.length-1))},r.cG=function(s,e,i,o){const p=e.getNorth(),a=e.getSouth(),f=e.getWest(),w=e.getEast(),E=1<<s.z,O=w-f,x=p-a,C=O/Eu,k=-x/bh[i],M=[0,C,0,k,0,0,p,f,0];if(s.z>0){const P=180/o;Ye.mat3.multiply(M,M,[P/O+1,0,0,0,P/x+1,0,-.5*P/C,.5*P/k,1])}return M[2]=E,M[5]=s.x,M[8]=s.y,M},r.cH=Tn,r.cI=function(s,e,i){const o=Ye.mat4.identity(new Float64Array(16)),p=(e/(1<<s)-.5)*Math.PI*2;return Ye.mat4.rotateY(o,i.globeMatrix,p),Float32Array.from(o)},r.cJ=class{isDataAvailableAtPoint(s){const e=this._source();if(this.isUsingMockSource()||!e||s.y<0||s.y>1)return!1;const i=e.getSource().maxzoom,o=1<<i,p=Math.floor(s.x),a=Math.floor((s.x-p)*o),f=Math.floor(s.y*o),w=this.findDEMTileFor(new $t(i,p,i,a,f));return!(!w||!w.dem)}getAtPointOrZero(s,e=0){return this.getAtPoint(s,e)||0}getAtPoint(s,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||s.y<0||s.y>1)return e;const p=o.getSource().maxzoom,a=1<<p,f=Math.floor(s.x),w=s.x-f,E=new $t(p,f,p,Math.floor(w*a),Math.floor(s.y*a)),O=this.findDEMTileFor(E);if(!O||!O.dem)return e;const x=O.dem,C=1<<O.tileID.canonical.z,k=(w*C-O.tileID.canonical.x)*x.dim,M=(s.y*C-O.tileID.canonical.y)*x.dim,P=Math.floor(k),R=Math.floor(M);return(i?this.exaggeration():1)*Ii(Ii(x.get(P,R),x.get(P,R+1),M-R),Ii(x.get(P+1,R),x.get(P+1,R+1),M-R),k-P)}getAtTileOffset(s,e,i){const o=1<<s.canonical.z;return this.getAtPointOrZero(new n(s.wrap+(s.canonical.x+e/ei)/o,(s.canonical.y+i/ei)/o))}getAtTileOffsetFunc(s,e,i,o){return p=>{const a=this.getAtTileOffset(s,p.x,p.y),f=o.upVector(s.canonical,p.x,p.y),w=o.upVectorScale(s.canonical,e,i).metersToTile;return Ye.vec3.scale(f,f,a*w),f}}getForTilePoints(s,e,i,o){if(this.isUsingMockSource())return!1;const p=am.create(this,s,o);return!!p&&(e.forEach(a=>{a[2]=this.exaggeration()*p.getElevationAt(a[0],a[1],i)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(s);if(!e||!e.dem)return null;const i=e.dem.tree,o=e.tileID,p=1<<s.canonical.z-o.canonical.z;let a=s.canonical.x/p-o.canonical.x,f=s.canonical.y/p-o.canonical.y,w=0;for(let E=0;E<s.canonical.z-o.canonical.z&&!i.leaves[w];E++){a*=2,f*=2;const O=2*Math.floor(f)+Math.floor(a);w=i.childOffsets[w]+O,a%=1,f%=1}return{min:this.exaggeration()*i.minimums[w],max:this.exaggeration()*i.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const s=this.visibleDemTiles;if(s.length===0)return null;let e=!1,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const p of s){const a=this.getMinMaxForTile(p.tileID);a&&(i=Math.min(i,a.min),o=Math.max(o,a.max),e=!0)}return e?{min:i,max:o}:null}},r.cK=Jf,r.cL=or,r.cM=function(s,e){return[Math.pow(s[0],2.2)*e,Math.pow(s[1],2.2)*e,Math.pow(s[2],2.2)*e]},r.cN=ta,r.cO=Fh,r.cP=zh,r.cQ=256,r.cR=function(s,e){const i=[0,0,0],o=Yn(Tn(e.canonical));return Ye.vec3.transformMat4(i,i,o),Ye.vec3.transformMat4(i,i,s),i},r.cS=s=>({u_camera_to_center_distance:new Pn(s),u_extrude_scale:new kp(s),u_device_pixel_ratio:new Pn(s),u_matrix:new Tc(s),u_inv_rot_matrix:new Tc(s),u_merc_center:new To(s),u_tile_id:new Bo(s),u_zoom_transition:new Pn(s),u_up_dir:new Bo(s),u_emissive_strength:new Pn(s)}),r.cT=s=>({u_matrix:new Tc(s),u_pixels_to_tile_units:new kp(s),u_device_pixel_ratio:new Pn(s),u_width_scale:new Pn(s),u_floor_width_scale:new Pn(s),u_units_to_pixels:new To(s),u_dash_image:new xh(s),u_gradient_image:new xh(s),u_image_height:new Pn(s),u_texsize:new To(s),u_tile_units_to_pixels:new Pn(s),u_alpha_discard_threshold:new Pn(s),u_trim_offset:new To(s),u_trim_fade_range:new To(s),u_trim_color:new Sc(s),u_emissive_strength:new Pn(s),u_zbias_factor:new Pn(s),u_tile_to_meter:new Pn(s)}),r.cU=s=>({u_matrix:new Tc(s),u_texsize:new To(s),u_pixels_to_tile_units:new kp(s),u_device_pixel_ratio:new Pn(s),u_width_scale:new Pn(s),u_floor_width_scale:new Pn(s),u_image:new xh(s),u_units_to_pixels:new To(s),u_tile_units_to_pixels:new Pn(s),u_alpha_discard_threshold:new Pn(s),u_trim_offset:new To(s),u_trim_fade_range:new To(s),u_trim_color:new Sc(s),u_emissive_strength:new Pn(s),u_zbias_factor:new Pn(s),u_tile_to_meter:new Pn(s)}),r.cV=Sp,r.cW=QM,r.cX=eE,r.cY=Ac,r.cZ=(s,e,i,o,p,a)=>{const f=s.transform,w=f.projection.name==="globe";let E;if(a.paint.get("circle-pitch-alignment")==="map")if(w){const x=ta(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;E=Float32Array.from([x,0,0,x])}else E=f.calculatePixelsToTileUnitsMatrix(i);else E=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const O={u_camera_to_center_distance:s.transform.getCameraToCenterDistance(f.projection),u_matrix:s.translatePosMatrix(e.projMatrix,i,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Fe.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:Cc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:a.paint.get("circle-emissive-strength")};if(w){O.u_inv_rot_matrix=o,O.u_merc_center=p,O.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],O.u_zoom_transition=ho(f.zoom);const x=p[0]*ei,C=p[1]*ei;O.u_up_dir=f.projection.upVector(new Bt(0,0,0),x,C)}return O},r.c_=Db,r.ca=Sc,r.cb=function(s,e,i){const o=Math.sqrt(s*s+e*e+i*i),p=o>0?Math.acos(i/o)*mo:0;let a=s!==0||e!==0?Math.atan2(-e,-s)*mo+90:0;return a<0&&(a+=360),[o,a,p]},r.cc=t,r.cd=bi,r.ce=Jr,r.cf=function(s){return[Math.pow(s[0],1/2.2),Math.pow(s[1],1/2.2),Math.pow(s[2],1/2.2)]},r.cg=function(s,e){return s.readFields(WE,{icons:[]},e)},r.ch=function(s){return s({pluginStatus:xo,pluginURL:Ss}),Pl.on("pluginStateChange",s),s},r.ci=ey,r.cj=rm,r.ck=tv,r.cl=Ia,r.cm=gp,r.cn=Ze,r.co=sa,r.cp=zn,r.cq=function(s){const e=s.indexOf(yu);return e>=0?s.slice(0,e):s},r.cr=function(s){return s.indexOf(yu)>=0},r.cs=function(s){const e=s.indexOf(yu);return e>=0?s.slice(e+1):""},r.ct=function(s){const e=[],i=s.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),s.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.cu=function(s,e,i,o){return s.type==="custom"?new kE(s,e):new $E[s.type](s,e,i,o)},r.cv=pl,r.cw=class extends fm{constructor(s,e){super(s._vectorTileFeature,s._z,s._x,s._y,s.id),s.state&&(this.state=Object.assign({},s.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=s.source,this.sourceLayer=s.sourceLayer,this.layer=s.layer)}toJSON(){const s=super.toJSON();return s.target=this.target,s.namespace=this.namespace,s}},r.cx=Pl,r.cy=is,r.cz=Ur,r.d=function(s){return ts.API_TILEJSON_REGEX.test(s)},r.d$=Rw,r.d0=(s,e,i,o,p,a,f,w,E)=>{const O=s.transform,x=O.calculatePixelsToTileUnitsMatrix(e),C=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",k=O.pitch<15?Ab(.07,.7,nr((14-O.zoom)/5,0,1)):.07;return{u_matrix:Ib(s,e,i,o),u_pixels_to_tile_units:x,u_device_pixel_ratio:a,u_width_scale:f,u_floor_width_scale:w,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:kb(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Pb(e,s.transform),u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(C?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:k,u_tile_to_meter:t(e.tileID.canonical,0)}},r.d1=Nc,r.d2=Bp,r.d3=yb,r.d4=ci,r.d5=Hp,r.d6=Xr,r.d7=450,r.d8=7,r.d9=DE,r.dA=go,r.dB=u,r.dC=ga,r.dD=function([s,e,i]){const o=Math.hypot(s,e,i),p=Math.atan2(s,i),a=.5*Math.PI-Math.acos(-e/o);return new Er($n(p),$n(a))},r.dE=fv,r.dF=function(s){const e=s.navigator?s.navigator.userAgent:null;return!!function(i){if(fl==null){const o=i.navigator?i.navigator.userAgent:null;fl=!!i.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return fl}(s)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.dG=function(s,e){Je=s,mt=e},r.dH=Uo,r.dI=Vo,r.dJ=function(s){const e=[0,0,0],i=Ye.mat4.identity(new Float64Array(16));return Ye.mat4.multiply(i,s.pixelMatrix,s.globeMatrix),Ye.vec3.transformMat4(e,e,i),new Wt(e[0],e[1])},r.dK=function(s,e,i=!1){if(xo===Jo||xo===cd||xo===oh)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ss=Fe.resolveURL(s),xo=Jo,Na=e,ah(),i||Qo()},r.dL=lh,r.dM=function(){ey().acquire(xv)},r.dN=function(){const s=bg;s&&(s.isPreloaded()&&s.numActive()===1?(s.release(xv),bg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dO=Xp,r.dP=function(s){const e=Zt();if(!e)return;const i=e.delete(lt);s&&i.catch(s).then(()=>s())},r.dQ=xg,r.dR=Tw,r.dS=function(s){Dv=Fe.resolveURL(s),pm||(pm=new lm(ey(),new aa)),pm.broadcast("setDracoUrl",Dv)},r.dT=Mw,r.dU=function(s){dm=Fe.resolveURL(s),pm||(pm=new lm(ey(),new aa)),pm.broadcast("setMeshoptUrl",dm)},r.dV=_i,r.dW=Vl,r.dX=Dc,r.dY=xe,r.dZ=class{constructor(s,e){this.pos=s,this.dir=e}intersectsPlane(s,e,i){const o=Ye.vec2.dot(e,this.dir);if(Math.abs(o)<1e-6)return!1;const p=((s[0]-this.pos[0])*e[0]+(s[1]-this.pos[1])*e[1])/o;return i[0]=this.pos[0]+this.dir[0]*p,i[1]=this.pos[1]+this.dir[1]*p,!0}},r.d_=Lw,r.da=Ir,r.db=Qa,r.dc=256,r.dd=jr,r.de=ha,r.df=Ol,r.dg=xc,r.dh=function(s,e,i,o,p){return nr((s-e)/(i-e)*(p-o)+o,o,p)},r.di=ed,r.dj=Nl,r.dk=class{constructor(s,e,i,o){this.context=s,this.format=o,this.size=i,this.texture=s.gl.createTexture();const[p,a,f]=this.size,{gl:w}=s;w.bindTexture(w.TEXTURE_3D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),w.texImage3D(w.TEXTURE_3D,0,this.format,p,a,f,0,uv(this.format),hv(this.format),e.data)}bind(s,e){const{context:i}=this,{gl:o}=i;o.bindTexture(o.TEXTURE_3D,this.texture),s!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,s),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,s),this.minFilter=s),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}},r.dl=mv,r.dm=[1,1,1],r.dn=am,r.dp=om,r.dq=Ja,r.dr=Ll,r.ds=Ec,r.dt=fd,r.du=Ua,r.dv=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Wt(1/0,1/0),max:new Wt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(s,e=!1){const i=Ai(new Wt(0,0),new Wt(ei,ei),s),o=[];if(e&&!hi(i,this._globalClipBounds))return o;for(const p of this._activeRegions){if(p.hiddenByOverlap||!hi(i,p))continue;const a=ai(p.min,p.max,s);o.push({min:a.min,max:a.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return o}setSources(s){this._setSources(s.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const o of e.cache.getVisibleCoordinates()){const p=e.cache.getTile(o).buckets[e.layer];p&&p.updateFootprints(o.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(s){const e=s.getFootprints();if(e.length===0)return;const i=s.getOrder(),o=s.getClipMask(),p=s.getClipScope();for(const a of e){if(!a.footprint)continue;const f=Ai(a.footprint.min,a.footprint.max,a.id);this._activeRegions.push({min:f.min,max:f.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:a.id,footprint:a.footprint,order:i,clipMask:o,clipScope:p})}this._sourceIds.push(s.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||Pt(e.min,i.min)||Pt(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(o,p){const a=(f,w)=>f+w;return o.length-p.length||o.reduce(a,"").localeCompare(p.reduce(a,""))}(e.clipScope,i.clipScope));let s=this._activeRegions.length!==this._prevRegions.length;if(!s){let e=0;for(;!s&&e!==this._activeRegions.length;){const i=this._activeRegions[e],o=this._prevRegions[e];s=i.priority!==o.priority||!Ft(i,o)||i.order!==o.order||i.clipMask!==o.clipMask||!jn(i.clipScope,o.clipScope),++e}}if(s){++this._updateTime;for(const i of this._activeRegions)i.order!==_t&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const o=this._activeRegions;if(i>=o.length)return i;const p=o[i].priority;for(;i<o.length&&o[i].priority===p;)++i;return i};if(this._sourceIds.length>1){let i=0,o=e(i);for(;i!==o;){let p=i;const a=i;for(;p!==o;){const f=this._activeRegions[p];f.hiddenByOverlap=!1;for(let w=0;w<a;w++){const E=this._activeRegions[w];if(!E.hiddenByOverlap&&f.order===_t&&hi(f,E)&&(f.hiddenByOverlap=Zi(f.footprint,f.tileId,E.footprint,E.tileId),f.hiddenByOverlap))break}++p}i=o,o=e(i)}}}}_setSources(s){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=s.length-1;e>=0;e--)this._addSource(s[e]);this._computeReplacement()}},r.dw=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy()}_fillGridMeshWithLods(s,e){const i=new wo,o=new gs,p=[],a=s+1+2,f=e[0]+1,w=e[0]+1+(1+e.length),E=(O,x,C)=>{let k=O===a-1?O-2:O===0?O:O-1;return k+=C?24575:0,[k,x]};for(let O=0;O<a;++O)i.emplaceBack(...E(O,0,!0));for(let O=0;O<f;++O)for(let x=0;x<a;++x)i.emplaceBack(...E(x,O,(x===0||x===a-1)&&!0));for(let O=0;O<e.length;++O){const x=e[O];for(let C=0;C<a;++C)i.emplaceBack(...E(C,x,!0))}for(let O=0;O<e.length;++O){const x=o.length,C=e[O]+1+2,k=new gs;for(let R=0;R<C-1;R++){const $=R===C-2,G=$?a*(w-e.length+O-R):a;for(let J=0;J<a-1;J++){const ee=R*a+J;R===0||$||J===0||J===a-2?(k.emplaceBack(ee+1,ee,ee+G),k.emplaceBack(ee+G,ee+G+1,ee+1)):(o.emplaceBack(ee+1,ee,ee+G),o.emplaceBack(ee+G,ee+G+1,ee+1))}}const M=Sn.simpleSegment(0,x,i.length,o.length-x);for(let R=0;R<k.uint16.length;R+=3)o.emplaceBack(k.uint16[R],k.uint16[R+1],k.uint16[R+2]);const P=Sn.simpleSegment(0,x,i.length,o.length-x);p.push({withoutSkirts:M,withSkirts:P})}return{vertices:i,indices:o,segments:p}}_createGrid(s){const e=this._fillGridMeshWithLods(Eu,bh);this._gridSegments=e.segments,this._gridBuffer=s.createVertexBuffer(e.vertices,Ei.members),this._gridIndexBuffer=s.createIndexBuffer(e.indices,!0)}_createPoles(s){const e=new gs;for(let f=0;f<=Eu;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=s.createIndexBuffer(e,!0);const i=new Ol,o=new Ol,p=new Ol,a=new Ol;this._poleSegments=[];for(let f=0,w=0;f<il;f++){const E=360/(1<<f);i.emplaceBack(0,-Hn,0,.5,0),o.emplaceBack(0,-Hn,0,.5,1),p.emplaceBack(0,-Hn,0,.5,.5),a.emplaceBack(0,-Hn,0,.5,.5);for(let O=0;O<=Eu;O++){let x=O/Eu,C=0;const k=Ii(0,E,x),[M,P,R]=Mc(nl,$o,k,Hn);i.emplaceBack(M,P,R,x,C),o.emplaceBack(M,P,R,x,1-C);const $=rr(k);x=.5+.5*Math.sin($),C=.5+.5*Math.cos($),p.emplaceBack(M,P,R,x,C),a.emplaceBack(M,P,R,x,1-C)}this._poleSegments.push(Sn.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(i,Fi,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(o,Fi,!1),this._texturedPoleNorthVertexBuffer=s.createVertexBuffer(p,Fi,!1),this._texturedPoleSouthVertexBuffer=s.createVertexBuffer(a,Fi,!1)}getGridBuffers(s,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}},r.dx=_t,r.dy=xr,r.dz=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.e=ts,r.e0=Tb,r.e1=na,r.e2=yo,r.e3=Jb,r.e4=function(s,e,i,o,p,a,f,w,E,O,x=1,C,k){s.createArrays(),s.tilePixelRatio=ei/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const M=s.layers[0].layout,P=s.layers[0]._unevaluatedLayout._values,R={};R.scaleFactor=x,R.textSizeScaleRange=M.get("text-size-scale-range"),R.iconSizeScaleRange=M.get("icon-size-scale-range");const[$,G]=R.textSizeScaleRange,[J,ee]=R.iconSizeScaleRange;if(R.textScaleFactor=nr(R.scaleFactor,$,G),R.iconScaleFactor=nr(R.scaleFactor,J,ee),s.textSizeData.kind==="composite"){const{minZoom:fe,maxZoom:Ce}=s.textSizeData;R.compositeTextSizes=[P["text-size"].possiblyEvaluate(new Vr(fe),w),P["text-size"].possiblyEvaluate(new Vr(Ce),w)]}if(s.iconSizeData.kind==="composite"){const{minZoom:fe,maxZoom:Ce}=s.iconSizeData;R.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new Vr(fe),w),P["icon-size"].possiblyEvaluate(new Vr(Ce),w)]}R.layoutTextSize=P["text-size"].possiblyEvaluate(new Vr(E+1),w),R.layoutIconSize=P["icon-size"].possiblyEvaluate(new Vr(E+1),w),R.textMaxSize=P["text-size"].possiblyEvaluate(new Vr(18),w);const Z=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",ne=M.get("text-size");let le=!1;for(const fe of s.features)if(fe.icon&&fe.icon.nameSecondary){le=!0;break}for(const fe of s.features){const Ce=M.get("text-font").evaluate(fe,{},w).join(","),Ee=ne.evaluate(fe,{},w)*R.textScaleFactor,Me=R.layoutTextSize.evaluate(fe,{},w)*R.textScaleFactor,$e=(R.layoutIconSize.evaluate(fe,{},w),{horizontal:{},vertical:void 0}),De=fe.text;let Ge,Xe=[0,0];if(De){const nt=De.toString(),ct=M.get("text-letter-spacing").evaluate(fe,{},w)*po,it=M.get("text-line-height").evaluate(fe,{},w)*po,Ct=ad(nt)?ct:0,Nt=M.get("text-anchor").evaluate(fe,{},w),Et=M.get("text-variable-anchor");if(!Et){const xi=M.get("text-radial-offset").evaluate(fe,{},w);Xe=xi?n1(Nt,[xi*po,iv]):M.get("text-offset").evaluate(fe,{},w).map(ui=>ui*po)}let si=Z?"center":M.get("text-justify").evaluate(fe,{},w);const ti=M.get("symbol-placement")==="point",Gt=ti?M.get("text-max-width").evaluate(fe,{},w)*po:1/0,Ut=xi=>{s.allowVerticalPlacement&&Ba(nt)&&($e.vertical=Q0(De,e,i,p,Ce,Gt,it,Nt,xi,Ct,Xe,sl.vertical,!0,Me,Ee))};if(!Z&&Et){const xi=si==="auto"?Et.map(fi=>rv(fi)):[si];let ui=!1;for(let fi=0;fi<xi.length;fi++){const Ni=xi[fi];if(!$e.horizontal[Ni])if(ui)$e.horizontal[Ni]=$e.horizontal[0];else{const Ki=Q0(De,e,i,p,Ce,Gt,it,"center",Ni,Ct,Xe,sl.horizontal,!1,Me,Ee);Ki&&($e.horizontal[Ni]=Ki,ui=Ki.positionedLines.length===1)}}Ut("left")}else{if(si==="auto"&&(si=rv(Nt)),ti||M.get("text-writing-mode").indexOf("horizontal")>=0||!Ba(nt)){const xi=Q0(De,e,i,p,Ce,Gt,it,Nt,si,Ct,Xe,sl.horizontal,!1,Me,Ee);xi&&($e.horizontal[si]=xi)}Ut(ti?"left":si)}}let qe=!1;if(fe.icon&&fe.icon.namePrimary){const nt=Y0(s.iconSizeData,P["icon-size"],w,s.zoom,fe)*R.iconScaleFactor*C,ct=fe.icon.getPrimary().scaleSelf(nt).serialize(),it=o[ct];it&&(Ge=hE(p[ct],fe.icon.nameSecondary?p[fe.icon.getSecondary().scaleSelf(nt).serialize()]:void 0,M.get("icon-offset").evaluate(fe,{},w),M.get("icon-anchor").evaluate(fe,{},w)),qe=it.sdf,s.sdfIcons===void 0?s.sdfIcons=it.sdf:s.sdfIcons!==it.sdf&&qi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(it.pixelRatio!==s.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}const et=o1($e.horizontal)||$e.vertical;s.iconsInText||(s.iconsInText=!!et&&et.iconsInText),(et||Ge)&&yE(s,fe,$e,Ge,o,R,Me,0,Xe,qe,f,w,O,k,le)}a&&s.generateCollisionDebugBuffers(E,s.collisionBoxArray,R.textScaleFactor)},r.e5=oy,r.e6=Xs,r.e7=ye,r.e8=Bb,r.e9=q,r.ea=function(s){let e=0;if(new Uint32Array(s,0,1)[0]!==Cw){const i=new Uint32Array(s,0,7),[,,o,p,a,f]=i;e=i.byteLength+p+a+f+a,(o!==s.byteLength||e>=s.byteLength)&&qi("Invalid b3dm header information.")}return Dw(s,e)},r.eb=function(s,e){const i=Ow(s);for(const o of i){for(const p of o.meshes)qC(p);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(YC(o.lights,e)))}return i},r.ec=Q_,r.ed=q1,r.ee=Qs,r.ef=function(s){Jt(),yt!=null&&yt.then(e=>{e.keys().then(i=>{for(let o=0;o<i.length-s;o++)e.delete(i[o])})})},r.f=function(s){return s.indexOf("mapbox:")===0},r.g=function(s,e){return is(Zs(s,{method:"GET"}),e)},r.h=Jl,r.i=function(s){return ts.API_STYLE_REGEX.test(s)&&!Gu(s)},r.j=function(s){return decodeURIComponent(atob(s).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.k=function(s){return btoa(encodeURIComponent(s).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},r.l=Zs,r.m=Di,r.n=function(s,e){return is(Zs(s,{type:"json"}),e)},r.o=Po,r.p=function(s,e){return is(Zs(s,{method:"POST"}),e)},r.q=Fe,r.r=Fs,r.s=function(s){try{const e=self[s];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=be,r.u=function(){return function s(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()},r.v=function(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)},r.w=qi,r.x=function(){return bv||(bv=new Xp),bv},r.y=Wu,r.z=oa}),A(["./shared"],function(r){function q(vt){const se=vt?vt.url.toString():void 0;return se?performance.getEntriesByName(se):[]}function ie(vt){if(typeof vt=="number"||typeof vt=="boolean"||typeof vt=="string"||vt==null)return JSON.stringify(vt);if(Array.isArray(vt)){let me="[";for(const be of vt)me+=`${ie(be)},`;return`${me}]`}let se="{";for(const me of Object.keys(vt).sort())se+=`${me}:${ie(vt[me])},`;return`${se}}`}function ae(vt){let se="";for(const me of r.bm)(vt.type!=="model"||me!=="minzoom"&&me!=="maxzoom")&&(se+=`/${ie(vt[me])}`);return se}class he{constructor(se){this.keyCache={},this._layers={},this._layerConfigs={},se&&this.replace(se)}replace(se,me){this._layerConfigs={},this._layers={},this.update(se,[],me)}update(se,me,be){this._options=be;for(const je of se)this._layerConfigs[je.id]=je,(this._layers[je.id]=r.cu(je,this.scope,null,this._options)).compileFilter(be),this.keyCache[je.id]&&delete this.keyCache[je.id];for(const je of me)delete this.keyCache[je],delete this._layerConfigs[je],delete this._layers[je];this.familiesBySource={};const Fe=function(je,Ze){const lt={};for(let mt=0;mt<je.length;mt++){const pt=je[mt];let yt=Ze&&Ze[pt.id];!yt&&(yt=ae(pt),pt.type==="line"&&pt.paint)&&function Zt(Jt){return typeof Jt=="string"&&Jt==="line-progress"||(Array.isArray(Jt)?Jt.some(Zt):!(!Jt||typeof Jt!="object")&&Object.values(Jt).some(Zt))}(pt.paint["line-width"])&&(yt+=`/${ie(pt.paint["line-width"])}`),Ze&&(Ze[pt.id]=yt);let Lt=lt[yt];Lt||(Lt=lt[yt]=[]),Lt.push(pt)}const Je=[];for(const mt in lt)Je.push(lt[mt]);return Je}(r.bj(this._layerConfigs),this.keyCache);for(const je of Fe){const Ze=je.map(Lt=>this._layers[Lt.id]),lt=Ze[0];if(lt.visibility==="none")continue;const Je=lt.source||"";let mt=this.familiesBySource[Je];mt||(mt=this.familiesBySource[Je]={});const pt=lt.sourceLayer||"_geojsonTileLayer";let yt=mt[pt];yt||(yt=mt[pt]=[]),yt.push(Ze)}}}const ve=1*r.dX;class Ae{constructor(se){const me={},be=[];for(const lt in se){const Je=se[lt],mt=me[lt]={};for(const pt in Je.glyphs){const yt=Je.glyphs[+pt];if(!yt||yt.bitmap.width===0||yt.bitmap.height===0)continue;const Lt=yt.metrics.localGlyph?ve:1,Zt={x:0,y:0,w:yt.bitmap.width+2*Lt,h:yt.bitmap.height+2*Lt};be.push(Zt),mt[pt]=Zt}}const{w:Fe,h:je}=r.F(be),Ze=new r.dW({width:Fe||1,height:je||1});for(const lt in se){const Je=se[lt];for(const mt in Je.glyphs){const pt=Je.glyphs[+mt];if(!pt||pt.bitmap.width===0||pt.bitmap.height===0)continue;const yt=me[lt][mt],Lt=pt.metrics.localGlyph?ve:1;r.dW.copy(pt.bitmap,Ze,{x:0,y:0},{x:yt.x+Lt,y:yt.y+Lt},pt.bitmap)}}this.image=Ze,this.positions=me}}r.dV(Ae,"GlyphAtlas");const we="3d_elevation_id",Pe="hd_road_elevation";class Ve{constructor(){this._valid=!1}reset(se){return this.feature=se,this._valid=!0,this._geometry=se.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(se,me){return this._valid&&se(me(this._geometry)),this}require(se,me,be){return this.get(se,!0,me,be)}optional(se,me,be){return this.get(se,!1,me,be)}success(){return this._valid}get(se,me,be,Fe){const je=this.feature.properties.hasOwnProperty(se)?+this.feature.properties[se]:void 0;return this._valid&&je!==void 0?be(Fe?Fe(je):je):me&&(this._valid=!1),this}}class We{constructor(se,me){this.featureFunc=se,this.vertexFunc=me}parseFeature(se,me,be){return this.featureFunc(se,me,be)}parseVertex(se,me,be){return this.vertexFunc(se,me,be)}}const rt=new We((vt,se,me)=>vt.reset(se).require(we,be=>{me.id=be}).optional("fixed_height_relative",be=>{me.constantHeight=be},tt.decodeRelativeHeight).geometry(be=>{me.bounds=be},tt.computeBounds).success(),(vt,se,me)=>vt.reset(se).require(we,be=>{me.id=be}).require("elevation_idx",be=>{me.idx=be}).require("extent",be=>{me.extent=be}).require("height_relative",be=>{me.height=be},tt.decodeRelativeHeight).geometry(be=>{me.position=be},tt.getPoint).success()),ht=new We((vt,se,me)=>vt.reset(se).require(we,be=>{me.id=be}).optional("fixed_height",be=>{me.constantHeight=be},tt.decodeMetricHeight).geometry(be=>{me.bounds=be},tt.computeBounds).success(),(vt,se,me)=>vt.reset(se).require(we,be=>{me.id=be}).require("elevation_idx",be=>{me.idx=be}).require("extent",be=>{me.extent=be}).require("height",be=>{me.height=be},tt.decodeMetricHeight).geometry(be=>{me.position=be},tt.getPoint).success());class tt{static computeBounds(se){const me=new r.P(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),be=new r.P(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const Fe of se[0])me.x>Fe.x&&(me.x=Fe.x),me.y>Fe.y&&(me.y=Fe.y),be.x<Fe.x&&(be.x=Fe.x),be.y<Fe.y&&(be.y=Fe.y);return{min:me,max:be}}static getPoint(se){return r.ab.vec2.fromValues(se[0][0].x,se[0][0].y)}static decodeRelativeHeight(se){return 1e-4*se*5}static decodeMetricHeight(se){return 1e-4*se}static parse(se){const me=[],be=[],Fe=se.length,je=new Ve;for(let lt=0;lt<Fe;lt++){const Je=se.feature(lt),mt=Je.properties.hasOwnProperty("version")?String(Je.properties.version):void 0,pt=(Ze=mt)?Ze==="1.0.1"?ht:void 0:rt;if(pt===void 0){r.w(`Unknown elevation feature version number ${mt||"(unknown)"}`);continue}const yt=Je.properties.hasOwnProperty("type")?Je.properties.type:void 0;if(yt){if(r.dY.VectorTileFeature.types[Je.type]==="Point"&&yt==="curve_point"){const Lt={};pt.parseVertex(je,Je,Lt)&&me.push(Lt)}else if(r.dY.VectorTileFeature.types[Je.type]==="Polygon"&&yt==="curve_meta"){const Lt={};pt.parseFeature(je,Je,Lt)&&be.push(Lt)}}}var Ze;return{vertices:me,features:be}}}class at{constructor(se,me,be,Fe,je,Ze){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=se,this.heightRange={min:be,max:be},this.safeArea=me,this.constantHeight=be,this.constantHeight==null&&(this.constantHeight!=null||Fe.length!==0)){this.vertices=Fe,this.edges=je,this.edges=this.edges.filter(lt=>lt.a<this.vertices.length&&lt.b<this.vertices.length&&!r.ab.vec2.exactEquals(this.vertices[lt.a].position,this.vertices[lt.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const lt of this.vertices)this.vertexProps.push({dir:r.ab.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,lt.height),this.heightRange.max=Math.max(this.heightRange.max,lt.height);for(const lt of this.edges){const Je=this.vertices[lt.a].position,mt=this.vertices[lt.b].position,pt=r.ab.vec2.subtract(r.ab.vec2.create(),mt,Je),yt=r.ab.vec2.length(pt),Lt=r.ab.vec2.scale(r.ab.vec2.create(),pt,1/yt);this.edgeProps.push({vec:pt,dir:Lt,len:yt});const Zt=this.vertexProps[lt.a].dir,Jt=this.vertexProps[lt.b].dir;r.ab.vec2.add(Zt,Zt,Lt),r.ab.vec2.add(Jt,Jt,Lt)}for(const lt of this.vertexProps)lt.dir[0]===0&&lt.dir[1]===0||r.ab.vec2.normalize(lt.dir,lt.dir);this.tessellate(Ze)}}pointElevation(se){if(this.constantHeight!=null)return this.constantHeight;const me=this.getClosestEdge(se);if(me==null)return 0;const[be,Fe]=me;return(1-(je=Fe))*this.vertices[this.edges[be].a].height+je*this.vertices[this.edges[be].b].height;var je}getClosestEdge(se){if(this.edges.length===0)return;let me=0,be=Number.POSITIVE_INFINITY,Fe=0;const je=r.ab.vec2.fromValues(se.x,se.y);for(let Ze=0;Ze<this.edges.length;Ze++){const lt=this.edges[Ze],Je=this.edgeProps[Ze].dir,mt=new r.dZ(je,this.edgeProps[Ze].dir),pt=this.vertices[lt.a].position,yt=this.vertices[lt.b].position,Lt=r.ab.vec2.create(),Zt=r.ab.vec2.create(),Jt=mt.intersectsPlane(pt,this.vertexProps[lt.a].dir,Lt),pi=mt.intersectsPlane(yt,this.vertexProps[lt.b].dir,Zt);if(!Jt||!pi)continue;const Di=r.ab.vec2.subtract(r.ab.vec2.create(),Zt,Lt),ki=r.ab.vec2.subtract(r.ab.vec2.create(),je,Lt),Pi=r.ab.vec2.dot(Di,Di),dr=Pi>0?r.ab.vec2.dot(ki,Di)/Pi:0,br=r.aw(dr,0,1),sr=Math.abs((dr-br)*this.edgeProps[Ze].len),wr=r.ab.vec2.subtract(r.ab.vec2.create(),je,pt),Pr=sr+Math.abs(r.ab.vec2.dot(wr,r.ab.vec2.fromValues(Je[1],-Je[0])));Pr<be&&(me=Ze,be=Pr,Fe=br)}return[me,Fe]}tessellate(se){for(let me=this.edges.length-1;me>=0;--me){const be=this.edges[me].a,Fe=this.edges[me].b,{position:je,height:Ze,extent:lt}=this.vertices[be],{position:Je,height:mt,extent:pt}=this.vertices[Fe],yt=this.vertexProps[be].dir,Lt=this.vertexProps[Fe].dir,Zt=r.ab.vec3.fromValues(je[0]/se,je[1]/se,Ze),Jt=r.ab.vec3.fromValues(Je[0]/se,Je[1]/se,mt),pi=r.ab.vec3.fromValues(yt[1],-yt[0],0);r.ab.vec3.scale(pi,pi,lt);const Di=r.ab.vec3.fromValues(Lt[1],-Lt[0],0);if(r.ab.vec3.scale(Di,Di,pt),this.distSqLines(r.ab.vec3.fromValues(Zt[0]+.5*pi[0],Zt[1]+.5*pi[1],Zt[2]+.5*pi[2]),r.ab.vec3.fromValues(Jt[0]-.5*Di[0],Jt[1]-.5*Di[1],Jt[2]-.5*Di[2]),r.ab.vec3.fromValues(Zt[0]-.5*pi[0],Zt[1]-.5*pi[1],Zt[2]-.5*pi[2]),r.ab.vec3.fromValues(Jt[0]+.5*Di[0],Jt[1]+.5*Di[1],Jt[2]+.5*Di[2]))<=.05*.05)continue;const ki=this.vertices.length,Pi=r.ab.vec2.add(r.ab.vec2.create(),je,Je);this.vertices.push({position:r.ab.vec2.scale(Pi,Pi,.5),height:.5*(Ze+mt),extent:.5*(lt+pt)});const dr=r.ab.vec2.add(r.ab.vec2.create(),yt,Lt);this.vertexProps.push({dir:r.ab.vec2.normalize(dr,dr)}),this.edges.splice(me,1),this.edgeProps.splice(me,1),this.edges.push({a:be,b:ki}),this.edges.push({a:ki,b:Fe});const br=r.ab.vec2.subtract(r.ab.vec2.create(),this.vertices[ki].position,je),sr=r.ab.vec2.length(br),wr={vec:br,dir:r.ab.vec2.scale(r.ab.vec2.create(),br,1/sr),len:sr};this.edgeProps.push(wr),this.edgeProps.push(wr)}}distSqLines(se,me,be,Fe){const je=r.ab.vec3.subtract(r.ab.vec3.create(),me,se),Ze=r.ab.vec3.subtract(r.ab.vec3.create(),Fe,be),lt=r.ab.vec3.subtract(r.ab.vec3.create(),se,be),Je=r.ab.vec3.dot(je,je),mt=r.ab.vec3.dot(je,Ze),pt=r.ab.vec3.dot(je,lt),yt=r.ab.vec3.dot(Ze,Ze),Lt=r.ab.vec3.dot(Ze,lt),Zt=Je*yt-mt*mt;if(Zt===0){const Pi=r.ab.vec3.dot(lt,Ze)/r.ab.vec3.dot(Ze,Ze),dr=r.ab.vec3.lerp(r.ab.vec3.create(),be,Fe,Pi);return r.ab.vec3.squaredDistance(dr,se)}const Jt=(mt*Lt-pt*yt)/Zt,pi=(Je*Lt-mt*pt)/Zt,Di=r.ab.vec3.lerp(r.ab.vec3.create(),se,me,Jt),ki=r.ab.vec3.lerp(r.ab.vec3.create(),be,Fe,pi);return r.ab.vec3.squaredDistance(Di,ki)}}class Rt{static parseFrom(se,me){const be=tt.parse(se);if(!be)return[];let{vertices:Fe,features:je}=be;const Ze=1/r.cc(me);je.sort((pt,yt)=>pt.id-yt.id),Fe.sort((pt,yt)=>pt.id-yt.id||pt.idx-yt.idx),Fe=Fe.filter((pt,yt,Lt)=>yt===Lt.findIndex(Zt=>Zt.id===pt.id&&Zt.idx===pt.idx));const lt=new Array;let Je=0;const mt=Fe.length;for(const pt of je){if(pt.constantHeight){lt.push(new at(pt.id,pt.bounds,pt.constantHeight));continue}for(;Je!==mt&&Fe[Je].id<pt.id;)Je++;if(Je===mt||Fe[Je].id!==pt.id)continue;const yt=new Array,Lt=new Array,Zt=Je;for(;Je!==mt&&Fe[Je].id===pt.id;){const Jt=Fe[Je];if(yt.push({position:Jt.position,height:Jt.height,extent:Jt.extent}),Je!==Zt&&Fe[Je-1].idx===Jt.idx-1){const pi=Je-Zt;Lt.push({a:pi-1,b:pi})}Je++}lt.push(new at(pt.id,pt.bounds,void 0,yt,Lt,Ze))}return lt}}r.dV(at,"ElevationFeature");class Ne{constructor(se){this.tileID=new r.aG(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),this.tileZoom=se.tileZoom,this.uid=se.uid,this.zoom=se.zoom,this.lut=se.lut,this.canonical=se.tileID.canonical,this.pixelRatio=se.pixelRatio,this.tileSize=se.tileSize,this.source=se.source,this.scope=se.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=se.showCollisionBoxes,this.collectResourceTiming=!!se.request&&se.request.collectResourceTiming,this.promoteId=se.promoteId,this.isSymbolTile=se.isSymbolTile,this.tileTransform=r.aQ(se.tileID.canonical,se.projection),this.projection=se.projection,this.worldview=se.worldview,this.localizableLayerIds=se.localizableLayerIds,this.brightness=se.brightness,this.extraShadowCaster=!!se.extraShadowCaster,this.tessellationStep=se.tessellationStep,this.scaleFactor=se.scaleFactor}parse(se,me,be,Fe,je){this.status="parsing",this.data=se,this.collisionBoxArray=new r.aW;const Ze=new r.d_(Object.keys(se.layers).sort()),lt=new r.d$(this.tileID,this.promoteId);lt.bucketLayerIDs=[];const Je={},mt=new r.e0(256,256),pt={featureIndex:lt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:mt,availableImages:be,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},yt=me.familiesBySource[this.source];for(const Pi in yt){const dr=se.layers[Pi];if(!dr)continue;let br=!1,sr=!1,wr=!1;for(const is of yt[Pi])is[0].type==="symbol"?br=!0:sr=!0,is[0].is3D()&&is[0].type!=="model"&&(wr=!0);if(this.extraShadowCaster&&!wr||this.isSymbolTile===!0&&!br||this.isSymbolTile===!1&&!sr)continue;dr.version===1&&r.w(`Vector tile source "${this.source}" layer "${Pi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Pr=Ze.encode(Pi),Bn=[];let Ia=!1;for(let is=0,Nn=0;is<dr.length;is++){const $s=dr.feature(is),Gc=lt.getId($s,Pi);if(this.localizableLayerIds&&this.localizableLayerIds.has(Pi)){const Wo=$s.properties?$s.properties.worldview:null;if(this.worldview&&typeof Wo=="string")if(Wo==="all")$s.properties.$localized=!0;else{if(!Wo.split(",").includes(this.worldview))continue;$s.properties.$localized=!0,$s.properties.worldview=this.worldview}}!Ia&&$s.properties&&$s.properties.hasOwnProperty(we)&&(Ia=!0),Bn.push({feature:$s,id:Gc,index:Nn,sourceLayerIndex:Pr}),Nn++}Ia&&se.layers.hasOwnProperty(Pe)&&(pt.elevationFeatures=Rt.parseFrom(se.layers[Pe],this.canonical));for(const is of yt[Pi]){const Nn=is[0];(!this.extraShadowCaster||Nn.is3D()&&Nn.type!=="model")&&(this.isSymbolTile!==void 0&&Nn.type==="symbol"!==this.isSymbolTile||Nn.minzoom&&this.zoom<Math.floor(Nn.minzoom)||Nn.maxzoom&&this.zoom>=Nn.maxzoom||Nn.visibility!=="none"&&(Tt(is,this.zoom,pt.brightness,be),(Je[Nn.id]=Nn.createBucket({index:lt.bucketLayerIDs.length,layers:is,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Pr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Bn,pt,this.tileID.canonical,this.tileTransform),lt.bucketLayerIDs.push(is.map($s=>r.aC($s.id,$s.scope)))))}}let Lt,Zt,Jt,pi;mt.trim();const Di={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ki=()=>{if(Lt)return this.status="done",je(Lt);if(this.extraShadowCaster)this.status="done",je(null,{buckets:r.bj(Je).filter(Pi=>!Pi.isEmpty()),featureIndex:lt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:pt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Zt&&Jt&&pi){const Pi=new Ae(Zt),dr=new r.e3(Jt,pi,this.lut);for(const br in Je){const sr=Je[br];sr instanceof r.aX?(Tt(sr.layers,this.zoom,pt.brightness,be),r.e4(sr,Zt,Pi.positions,Jt,dr.iconPositions,this.showCollisionBoxes,be,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.pixelRatio,this.brightness)):sr.hasPattern&&(sr instanceof r.b1||sr instanceof r.b2||sr instanceof r.d5)&&(Tt(sr.layers,this.zoom,pt.brightness,be),sr.addFeatures(pt,this.tileID.canonical,dr.patternPositions,be,this.tileTransform,this.brightness))}this.status="done",je(null,{buckets:r.bj(Je).filter(br=>!br.isEmpty()),featureIndex:lt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Pi.image,lineAtlas:mt,imageAtlas:dr,brightness:pt.brightness})}};if(!this.extraShadowCaster){const Pi=r.e1(pt.glyphDependencies,sr=>Object.keys(sr).map(Number));Object.keys(Pi).length?Fe.send("getGlyphs",{uid:this.uid,stacks:Pi,scope:this.scope},(sr,wr)=>{Lt||(Lt=sr,Zt=wr,ki())},void 0,!1,Di):Zt={};const dr=Object.keys(pt.iconDependencies);dr.length?Fe.send("getImages",{icons:dr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(sr,wr)=>{if(Lt)return;Lt=sr;const Pr={};Object.values(wr).some(Bn=>Bn.usvg)?this.rasterize(Fe,Pr,wr,pt.iconDependencies,()=>{Jt=Pr,ki()}):(this.fillImageMap(Pr,pt.iconDependencies,wr),Jt=Pr,ki())},void 0,!1,Di):Jt={};const br=Object.keys(pt.patternDependencies);br.length?Fe.send("getImages",{icons:br,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(sr,wr)=>{if(!Lt){Lt=sr;const Pr={};Object.values(wr).some(Bn=>Bn.usvg)?this.rasterize(Fe,Pr,wr,pt.patternDependencies,()=>{pi=Pr,ki()}):(this.fillImageMap(Pr,pt.patternDependencies,wr),pi=Pr,ki())}},void 0,!1,Di):pi={}}ki()}fillImageMap(se,me,be){for(const Fe in be){const je=me[Fe]||[];for(const Ze of je)be[Ze.id].usvg||(se[Ze.serialize()]=be[Ze.id])}}getImageTaskQueue(se,me,be){const Fe={};for(const je in me){const Ze=be[je]||[];for(const lt of Ze){const Je=lt.serialize();me[lt.id].usvg?Fe[Je]||(Fe[Je]=lt):se[Je]=me[lt.id]}}return Fe}rasterize(se,me,be,Fe,je){const Ze=this.getImageTaskQueue(me,be,Fe);this.rasterizeTask=se.send("rasterizeImages",{scope:this.scope,imageTasks:Ze},(lt,Je)=>{if(!lt)for(const mt in Je){const{id:pt}=r.e2.deserializeFromString(mt);me[mt]=Object.assign({},be[pt],{data:Je[mt]})}je()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Tt(vt,se,me,be){const Fe=new r.a8(se,{brightness:me});for(const je of vt)je.recalculate(Fe,be)}class qt extends r.E{constructor(se,me,be,Fe,je,Ze){super(),this.actor=se,this.layerIndex=me,this.availableImages=be,this.loadVectorData=je||r.aD,this.loading={},this.loaded={},this.deduped=new r.aB(se.scheduler),this.isSpriteLoaded=Fe,this.scheduler=se.scheduler,this.brightness=Ze}loadTile(se,me){const be=se.uid,Fe=se&&se.request,je=Fe&&Fe.collectResourceTiming,Ze=this.loading[be]=new Ne(se);Ze.abort=this.loadVectorData(se,(lt,Je)=>{const mt=!this.loading[be];if(delete this.loading[be],Ze.cancelRasterize(),mt||lt||!Je)return Ze.status="done",mt||(this.loaded[be]=Ze),me(lt);const pt=Je.rawData,yt={};Je.expires&&(yt.expires=Je.expires),Je.cacheControl&&(yt.cacheControl=Je.cacheControl),Ze.vectorTile=Je.vectorTile||new r.dY.VectorTile(new r.bh(pt));const Lt=()=>{Ze.parse(Ze.vectorTile,this.layerIndex,this.availableImages,this.actor,(Zt,Jt)=>{if(Zt||!Jt)return me(Zt);const pi={};if(je){const Di=q(Fe);Di.length>0&&(pi.resourceTiming=JSON.parse(JSON.stringify(Di)))}me(null,r.l({rawTileData:pt.slice(0)},Jt,yt,pi))})};this.isSpriteLoaded?Lt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Lt,{type:"parseTile",isSymbolTile:se.isSymbolTile,zoom:se.tileZoom}):Lt()}),this.loaded=this.loaded||{},this.loaded[be]=Ze})}reloadTile(se,me){const be=this.loaded,Fe=se.uid;if(be&&be[Fe]){const je=be[Fe];je.scaleFactor=se.scaleFactor,je.showCollisionBoxes=se.showCollisionBoxes,je.projection=se.projection,je.brightness=se.brightness,je.tileTransform=r.aQ(se.tileID.canonical,se.projection),je.extraShadowCaster=se.extraShadowCaster,je.lut=se.lut;const Ze=(lt,Je)=>{const mt=je.reloadCallback;mt&&(delete je.reloadCallback,je.parse(je.vectorTile,this.layerIndex,this.availableImages,this.actor,mt)),me(lt,Je)};je.status==="parsing"?je.reloadCallback=Ze:je.status==="done"&&(je.vectorTile?je.parse(je.vectorTile,this.layerIndex,this.availableImages,this.actor,Ze):Ze())}else me(null,void 0)}abortTile(se,me){const be=se.uid,Fe=this.loading[be];Fe&&(Fe.abort&&Fe.abort(),delete this.loading[be]),me()}removeTile(se,me){const be=this.loaded,Fe=se.uid;be&&be[Fe]&&delete be[Fe],me()}}class Te{loadTile(se,me){const{uid:be,encoding:Fe,rawImageData:je,padding:Ze}=se,lt=ImageBitmap&&je instanceof ImageBitmap?this.getImageData(je,Ze):je;me(null,new r.e5(be,lt,Fe,Ze<1))}getImageData(se,me){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(se.width,se.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=se.width,this.offscreenCanvas.height=se.height,this.offscreenCanvasContext.drawImage(se,0,0,se.width,se.height);const be=this.offscreenCanvasContext.getImageData(-me,-me,se.width+2*me,se.height+2*me);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),be}}r.bg.setPbf(r.bh);class gt{decodeRasterArray({task:se,buffer:me},be){r.bg.performDecoding(me,se).then(Fe=>{be(null,Fe)},Fe=>{be(Fe)})}}const oi=r.dY.VectorTileFeature.prototype.toGeoJSON;class Ti{constructor(se){this._feature=se,this.extent=r.ag,this.type=se.type,this.properties=se.tags,"id"in se&&!isNaN(se.id)&&(this.id=parseInt(se.id,10))}loadGeometry(){if(this._feature.type===1){const se=[];for(const me of this._feature.geometry)se.push([new r.P(me[0],me[1])]);return se}{const se=[];for(const me of this._feature.geometry){const be=[];for(const Fe of me)be.push(new r.P(Fe[0],Fe[1]));se.push(be)}return se}}toGeoJSON(se,me,be){return oi.call(this,se,me,be)}}class ni{constructor(se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.ag,this.length=se.length,this._features=se}feature(se){return new Ti(this._features[se])}}const Mt=64/4096,zt=128;class ii{constructor(){this.features=new Map}clear(){this.features.clear()}load(se=[],me){for(const be of se){const Fe=be.id;if(Fe==null)continue;let je=this.features.get(Fe);je&&this.updateCache(je,me),be.geometry?(je=jt(be),this.updateCache(je,me),this.features.set(Fe,je)):this.features.delete(Fe),this.updateCache(je,me)}}updateCache(se,me){for(const{canonical:be,uid:Fe}of Object.values(me)){const{z:je,x:Ze,y:lt}=be;Yt(se,Math.pow(2,je),Ze,lt)&&delete me[Fe]}}getTile(se,me,be){const Fe=Math.pow(2,se),je=[];for(const Ze of this.features.values())Yt(Ze,Fe,me,be)&&je.push(vi(Ze,Fe,me,be));return{features:je}}getFeatures(){return[...this.features.values()]}}function Yt({minX:vt,minY:se,maxX:me,maxY:be},Fe,je,Ze){return vt<(je+1+Mt)/Fe&&se<(Ze+1+Mt)/Fe&&me>(je-Mt)/Fe&&be>(Ze-Mt)/Fe}function jt(vt){const{id:se,geometry:me,properties:be}=vt;if(!me)return;if(me.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Fe,coordinates:je}=me,Ze={id:se,type:1,geometry:[],tags:be,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},lt=Ze.geometry;if(Fe==="Point")Ri(je,lt,Ze);else if(Fe==="MultiPoint")for(const Je of je)Ri(Je,lt,Ze);else if(Fe==="LineString")Ze.type=2,Yi(je,lt,Ze);else if(Fe==="MultiLineString")Ze.type=2,Wi(je,lt,Ze);else if(Fe==="Polygon")Ze.type=3,Wi(je,lt,Ze,!0);else{if(Fe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ze.type=3;for(const Je of je)Wi(Je,lt,Ze,!0)}return Ze}function Ri([vt,se],me,be){const Fe=r.at(vt);let je=r.aA(se);je=je<0?0:je>1?1:je,me.push(Fe,je),be.minX=Math.min(be.minX,Fe),be.minY=Math.min(be.minY,je),be.maxX=Math.max(be.maxX,Fe),be.maxY=Math.max(be.maxY,je)}function Yi(vt,se,me,be=!1,Fe=!1){const je=[];for(const Ze of vt)Ri(Ze,je,me);se.push(je),be&&function(Ze,lt){let Je=0;for(let mt=0,pt=Ze.length,yt=pt-2;mt<pt;yt=mt,mt+=2)Je+=(Ze[mt]-Ze[yt])*(Ze[mt+1]+Ze[yt+1]);if(Je>0===lt)for(let mt=0,pt=Ze.length;mt<pt/2;mt+=2){const yt=Ze[mt],Lt=Ze[mt+1];Ze[mt]=Ze[pt-2-mt],Ze[mt+1]=Ze[pt-1-mt],Ze[pt-2-mt]=yt,Ze[pt-1-mt]=Lt}}(je,Fe)}function Wi(vt,se,me,be=!1){for(let Fe=0;Fe<vt.length;Fe++)Yi(vt[Fe],se,me,be,Fe===0)}function vi(vt,se,me,be){const{id:Fe,type:je,geometry:Ze,tags:lt}=vt,Je=[];if(je===1)(function(mt,pt,yt,Lt,Zt){for(let Jt=0;Jt<mt.length;Jt+=2){const pi=Math.round(r.ag*(mt[Jt+0]*pt-yt)),Di=Math.round(r.ag*(mt[Jt+1]*pt-Lt));Zt.push([pi,Di])}})(Ze,se,me,be,Je);else for(const mt of Ze)Wr(mt,se,me,be,Je);return{id:Fe,type:je,geometry:Je,tags:lt}}function Wr(vt,se,me,be,Fe){const Ze=r.ag+zt;let lt;for(let Je=0;Je<vt.length-2;Je+=2){let mt=Math.round(r.ag*(vt[Je+0]*se-me)),pt=Math.round(r.ag*(vt[Je+1]*se-be)),yt=Math.round(r.ag*(vt[Je+2]*se-me)),Lt=Math.round(r.ag*(vt[Je+3]*se-be));const Zt=yt-mt,Jt=Lt-pt;mt<-128&&yt<-128||(mt<-128?(pt+=Math.round(Jt*((-128-mt)/Zt)),mt=-128):yt<-128&&(Lt=pt+Math.round(Jt*((-128-mt)/Zt)),yt=-128),pt<-128&&Lt<-128||(pt<-128?(mt+=Math.round(Zt*((-128-pt)/Jt)),pt=-128):Lt<-128&&(yt=mt+Math.round(Zt*((-128-pt)/Jt)),Lt=-128),mt>=Ze&&yt>=Ze||(mt>=Ze?(pt+=Math.round(Jt*((Ze-mt)/Zt)),mt=Ze):yt>=Ze&&(Lt=pt+Math.round(Jt*((Ze-mt)/Zt)),yt=Ze),pt>=Ze&&Lt>=Ze||(pt>=Ze?(mt+=Math.round(Zt*((Ze-pt)/Jt)),pt=Ze):Lt>=Ze&&(yt=mt+Math.round(Zt*((Ze-pt)/Jt)),Lt=Ze),lt&&mt===lt[lt.length-1][0]&&pt===lt[lt.length-1][1]||(lt=[[mt,pt]],Fe.push(lt)),lt.push([yt,Lt])))))}}var an,_n,Cn,qr={exports:{}},es=function(){if(Cn)return qr.exports;Cn=1;var vt=r.e8(),se=function(){if(_n)return an;_n=1;var pt=r.e6(),yt=r.e7().VectorTileFeature;function Lt(Jt,pi){this.options=pi||{},this.features=Jt,this.length=Jt.length}function Zt(Jt,pi){this.id=typeof Jt.id=="number"?Jt.id:void 0,this.type=Jt.type,this.rawGeometry=Jt.type===1?[Jt.geometry]:Jt.geometry,this.properties=Jt.tags,this.extent=pi||4096}return an=Lt,Lt.prototype.feature=function(Jt){return new Zt(this.features[Jt],this.options.extent)},Zt.prototype.loadGeometry=function(){var Jt=this.rawGeometry;this.geometry=[];for(var pi=0;pi<Jt.length;pi++){for(var Di=Jt[pi],ki=[],Pi=0;Pi<Di.length;Pi++)ki.push(new pt(Di[Pi][0],Di[Pi][1]));this.geometry.push(ki)}return this.geometry},Zt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Jt=this.geometry,pi=1/0,Di=-1/0,ki=1/0,Pi=-1/0,dr=0;dr<Jt.length;dr++)for(var br=Jt[dr],sr=0;sr<br.length;sr++){var wr=br[sr];pi=Math.min(pi,wr.x),Di=Math.max(Di,wr.x),ki=Math.min(ki,wr.y),Pi=Math.max(Pi,wr.y)}return[pi,ki,Di,Pi]},Zt.prototype.toGeoJSON=yt.prototype.toGeoJSON,an}();function me(pt){var yt=new vt;return function(Lt,Zt){for(var Jt in Lt.layers)Zt.writeMessage(3,be,Lt.layers[Jt])}(pt,yt),yt.finish()}function be(pt,yt){var Lt;yt.writeVarintField(15,pt.version||1),yt.writeStringField(1,pt.name||""),yt.writeVarintField(5,pt.extent||4096);var Zt={keys:[],values:[],keycache:{},valuecache:{}};for(Lt=0;Lt<pt.length;Lt++)Zt.feature=pt.feature(Lt),yt.writeMessage(2,Fe,Zt);var Jt=Zt.keys;for(Lt=0;Lt<Jt.length;Lt++)yt.writeStringField(3,Jt[Lt]);var pi=Zt.values;for(Lt=0;Lt<pi.length;Lt++)yt.writeMessage(4,mt,pi[Lt])}function Fe(pt,yt){var Lt=pt.feature;Lt.id!==void 0&&yt.writeVarintField(1,Lt.id),yt.writeMessage(2,je,pt),yt.writeVarintField(3,Lt.type),yt.writeMessage(4,Je,Lt)}function je(pt,yt){var Lt=pt.feature,Zt=pt.keys,Jt=pt.values,pi=pt.keycache,Di=pt.valuecache;for(var ki in Lt.properties){var Pi=Lt.properties[ki],dr=pi[ki];if(Pi!==null){dr===void 0&&(Zt.push(ki),pi[ki]=dr=Zt.length-1),yt.writeVarint(dr);var br=typeof Pi;br!=="string"&&br!=="boolean"&&br!=="number"&&(Pi=JSON.stringify(Pi));var sr=br+":"+Pi,wr=Di[sr];wr===void 0&&(Jt.push(Pi),Di[sr]=wr=Jt.length-1),yt.writeVarint(wr)}}}function Ze(pt,yt){return(yt<<3)+(7&pt)}function lt(pt){return pt<<1^pt>>31}function Je(pt,yt){for(var Lt=pt.loadGeometry(),Zt=pt.type,Jt=0,pi=0,Di=Lt.length,ki=0;ki<Di;ki++){var Pi=Lt[ki],dr=1;Zt===1&&(dr=Pi.length),yt.writeVarint(Ze(1,dr));for(var br=Zt===3?Pi.length-1:Pi.length,sr=0;sr<br;sr++){sr===1&&Zt!==1&&yt.writeVarint(Ze(2,br-1));var wr=Pi[sr].x-Jt,Pr=Pi[sr].y-pi;yt.writeVarint(lt(wr)),yt.writeVarint(lt(Pr)),Jt+=wr,pi+=Pr}Zt===3&&yt.writeVarint(Ze(7,1))}}function mt(pt,yt){var Lt=typeof pt;Lt==="string"?yt.writeStringField(1,pt):Lt==="boolean"?yt.writeBooleanField(7,pt):Lt==="number"&&(pt%1!=0?yt.writeDoubleField(3,pt):pt<0?yt.writeSVarintField(6,pt):yt.writeVarintField(5,pt))}return qr.exports=me,qr.exports.fromVectorTileJs=me,qr.exports.fromGeojsonVt=function(pt,yt){yt=yt||{};var Lt={};for(var Zt in pt)Lt[Zt]=new se(pt[Zt].features,yt),Lt[Zt].name=Zt,Lt[Zt].version=yt.version,Lt[Zt].extent=yt.extent;return me({layers:Lt})},qr.exports.GeoJSONWrapper=se,qr.exports}(),Ye=r.e9(es);const ds={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:vt=>vt},Bi=Math.fround||(Xs=new Float32Array(1),vt=>(Xs[0]=+vt,Xs[0]));var Xs;const Wt=3,jn=5,As=6;class mo{constructor(se){this.options=Object.assign(Object.create(ds),se),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(se){const{log:me,minZoom:be,maxZoom:Fe}=this.options;me&&console.time("total time");const je=`prepare ${se.length} points`;me&&console.time(je),this.points=se;const Ze=[];for(let Je=0;Je<se.length;Je++){const mt=se[Je];if(!mt.geometry)continue;const[pt,yt]=mt.geometry.coordinates,Lt=Bi(xs(pt)),Zt=Bi(Ea(yt));Ze.push(Lt,Zt,1/0,Je,-1,1),this.options.reduce&&Ze.push(0)}let lt=this.trees[Fe+1]=this._createTree(Ze);me&&console.timeEnd(je);for(let Je=Fe;Je>=be;Je--){const mt=+Date.now();lt=this.trees[Je]=this._createTree(this._cluster(lt,Je)),me&&console.log("z%d: %d clusters in %dms",Je,lt.numItems,+Date.now()-mt)}return me&&console.timeEnd("total time"),this}getClusters(se,me){let be=((se[0]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,se[1]));let je=se[2]===180?180:((se[2]+180)%360+360)%360-180;const Ze=Math.max(-90,Math.min(90,se[3]));if(se[2]-se[0]>=360)be=-180,je=180;else if(be>je){const yt=this.getClusters([be,Fe,180,Ze],me),Lt=this.getClusters([-180,Fe,je,Ze],me);return yt.concat(Lt)}const lt=this.trees[this._limitZoom(me)],Je=lt.range(xs(be),Ea(Ze),xs(je),Ea(Fe)),mt=lt.data,pt=[];for(const yt of Je){const Lt=this.stride*yt;pt.push(mt[Lt+jn]>1?rr(mt,Lt,this.clusterProps):this.points[mt[Lt+Wt]])}return pt}getChildren(se){const me=this._getOriginId(se),be=this._getOriginZoom(se),Fe="No cluster with the specified id.",je=this.trees[be];if(!je)throw new Error(Fe);const Ze=je.data;if(me*this.stride>=Ze.length)throw new Error(Fe);const lt=this.options.radius/(this.options.extent*Math.pow(2,be-1)),Je=je.within(Ze[me*this.stride],Ze[me*this.stride+1],lt),mt=[];for(const pt of Je){const yt=pt*this.stride;Ze[yt+4]===se&&mt.push(Ze[yt+jn]>1?rr(Ze,yt,this.clusterProps):this.points[Ze[yt+Wt]])}if(mt.length===0)throw new Error(Fe);return mt}getLeaves(se,me,be){const Fe=[];return this._appendLeaves(Fe,se,me=me||10,be=be||0,0),Fe}getTile(se,me,be){const Fe=this.trees[this._limitZoom(se)],je=Math.pow(2,se),{extent:Ze,radius:lt}=this.options,Je=lt/Ze,mt=(be-Je)/je,pt=(be+1+Je)/je,yt={features:[]};return this._addTileFeatures(Fe.range((me-Je)/je,mt,(me+1+Je)/je,pt),Fe.data,me,be,je,yt),me===0&&this._addTileFeatures(Fe.range(1-Je/je,mt,1,pt),Fe.data,je,be,je,yt),me===je-1&&this._addTileFeatures(Fe.range(0,mt,Je/je,pt),Fe.data,-1,be,je,yt),yt.features.length?yt:null}getClusterExpansionZoom(se){let me=this._getOriginZoom(se)-1;for(;me<=this.options.maxZoom;){const be=this.getChildren(se);if(me++,be.length!==1)break;se=be[0].properties.cluster_id}return me}_appendLeaves(se,me,be,Fe,je){const Ze=this.getChildren(me);for(const lt of Ze){const Je=lt.properties;if(Je&&Je.cluster?je+Je.point_count<=Fe?je+=Je.point_count:je=this._appendLeaves(se,Je.cluster_id,be,Fe,je):je<Fe?je++:se.push(lt),se.length===be)break}return je}_createTree(se){const me=new r.bE(se.length/this.stride|0,this.options.nodeSize,Float32Array);for(let be=0;be<se.length;be+=this.stride)me.add(se[be],se[be+1]);return me.finish(),me.data=se,me}_addTileFeatures(se,me,be,Fe,je,Ze){for(const lt of se){const Je=lt*this.stride,mt=me[Je+jn]>1;let pt,yt,Lt;if(mt)pt=$n(me,Je,this.clusterProps),yt=me[Je],Lt=me[Je+1];else{const pi=this.points[me[Je+Wt]];pt=pi.properties;const[Di,ki]=pi.geometry.coordinates;yt=xs(Di),Lt=Ea(ki)}const Zt={type:1,geometry:[[Math.round(this.options.extent*(yt*je-be)),Math.round(this.options.extent*(Lt*je-Fe))]],tags:pt};let Jt;Jt=mt||this.options.generateId?me[Je+Wt]:this.points[me[Je+Wt]].id,Jt!==void 0&&(Zt.id=Jt),Ze.features.push(Zt)}}_limitZoom(se){return Math.max(this.options.minZoom,Math.min(Math.floor(+se),this.options.maxZoom+1))}_cluster(se,me){const{radius:be,extent:Fe,reduce:je,minPoints:Ze}=this.options,lt=be/(Fe*Math.pow(2,me)),Je=se.data,mt=[],pt=this.stride;for(let yt=0;yt<Je.length;yt+=pt){if(Je[yt+2]<=me)continue;Je[yt+2]=me;const Lt=Je[yt],Zt=Je[yt+1],Jt=se.within(Je[yt],Je[yt+1],lt),pi=Je[yt+jn];let Di=pi;for(const ki of Jt){const Pi=ki*pt;Je[Pi+2]>me&&(Di+=Je[Pi+jn])}if(Di>pi&&Di>=Ze){let ki,Pi=Lt*pi,dr=Zt*pi,br=-1;const sr=(yt/pt<<5)+(me+1)+this.points.length;for(const wr of Jt){const Pr=wr*pt;if(Je[Pr+2]<=me)continue;Je[Pr+2]=me;const Bn=Je[Pr+jn];Pi+=Je[Pr]*Bn,dr+=Je[Pr+1]*Bn,Je[Pr+4]=sr,je&&(ki||(ki=this._map(Je,yt,!0),br=this.clusterProps.length,this.clusterProps.push(ki)),je(ki,this._map(Je,Pr)))}Je[yt+4]=sr,mt.push(Pi/Di,dr/Di,1/0,sr,-1,Di),je&&mt.push(br)}else{for(let ki=0;ki<pt;ki++)mt.push(Je[yt+ki]);if(Di>1)for(const ki of Jt){const Pi=ki*pt;if(!(Je[Pi+2]<=me)){Je[Pi+2]=me;for(let dr=0;dr<pt;dr++)mt.push(Je[Pi+dr])}}}}return mt}_getOriginId(se){return se-this.points.length>>5}_getOriginZoom(se){return(se-this.points.length)%32}_map(se,me,be){if(se[me+jn]>1){const Ze=this.clusterProps[se[me+As]];return be?Object.assign({},Ze):Ze}const Fe=this.points[se[me+Wt]].properties,je=this.options.map(Fe);return be&&je===Fe?Object.assign({},je):je}}function rr(vt,se,me){return{type:"Feature",id:vt[se+Wt],properties:$n(vt,se,me),geometry:{type:"Point",coordinates:[(be=vt[se],360*(be-.5)),xr(vt[se+1])]}};var be}function $n(vt,se,me){const be=vt[se+jn],Fe=be>=1e4?`${Math.round(be/1e3)}k`:be>=1e3?Math.round(be/100)/10+"k":be,je=vt[se+As],Ze=je===-1?{}:Object.assign({},me[je]);return Object.assign(Ze,{cluster:!0,cluster_id:vt[se+Wt],point_count:be,point_count_abbreviated:Fe})}function xs(vt){return vt/360+.5}function Ea(vt){const se=Math.sin(vt*Math.PI/180),me=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return me<0?0:me>1?1:me}function xr(vt){const se=(180-360*vt)*Math.PI/180;return 360*Math.atan(Math.exp(se))/Math.PI-90}function go(vt,se,me,be){let Fe=be;const je=se+(me-se>>1);let Ze,lt=me-se;const Je=vt[se],mt=vt[se+1],pt=vt[me],yt=vt[me+1];for(let Lt=se+3;Lt<me;Lt+=3){const Zt=nr(vt[Lt],vt[Lt+1],Je,mt,pt,yt);if(Zt>Fe)Ze=Lt,Fe=Zt;else if(Zt===Fe){const Jt=Math.abs(Lt-je);Jt<lt&&(Ze=Lt,lt=Jt)}}Fe>be&&(Ze-se>3&&go(vt,se,Ze,be),vt[Ze+2]=Fe,me-Ze>3&&go(vt,Ze,me,be))}function nr(vt,se,me,be,Fe,je){let Ze=Fe-me,lt=je-be;if(Ze!==0||lt!==0){const Je=((vt-me)*Ze+(se-be)*lt)/(Ze*Ze+lt*lt);Je>1?(me=Fe,be=je):Je>0&&(me+=Ze*Je,be+=lt*Je)}return Ze=vt-me,lt=se-be,Ze*Ze+lt*lt}function Kr(vt,se,me,be){const Fe={id:vt??null,type:se,geometry:me,tags:be,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(se==="Point"||se==="MultiPoint"||se==="LineString")ra(Fe,me);else if(se==="Polygon")ra(Fe,me[0]);else if(se==="MultiLineString")for(const je of me)ra(Fe,je);else if(se==="MultiPolygon")for(const je of me)ra(Fe,je[0]);return Fe}function ra(vt,se){for(let me=0;me<se.length;me+=3)vt.minX=Math.min(vt.minX,se[me]),vt.minY=Math.min(vt.minY,se[me+1]),vt.maxX=Math.max(vt.maxX,se[me]),vt.maxY=Math.max(vt.maxY,se[me+1])}function dl(vt,se,me,be){if(!se.geometry)return;const Fe=se.geometry.coordinates;if(Fe&&Fe.length===0)return;const je=se.geometry.type,Ze=Math.pow(me.tolerance/((1<<me.maxZoom)*me.extent),2);let lt=[],Je=se.id;if(me.promoteId?Je=se.properties[me.promoteId]:me.generateId&&(Je=be||0),je==="Point")Zs(Fe,lt);else if(je==="MultiPoint")for(const mt of Fe)Zs(mt,lt);else if(je==="LineString")Ca(Fe,lt,Ze,!1);else if(je==="MultiLineString"){if(me.lineMetrics){for(const mt of Fe)lt=[],Ca(mt,lt,Ze,!1),vt.push(Kr(Je,"LineString",lt,se.properties));return}$a(Fe,lt,Ze,!1)}else if(je==="Polygon")$a(Fe,lt,Ze,!0);else{if(je!=="MultiPolygon"){if(je==="GeometryCollection"){for(const mt of se.geometry.geometries)dl(vt,{id:Je,geometry:mt,properties:se.properties},me,be);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const mt of Fe){const pt=[];$a(mt,pt,Ze,!0),lt.push(pt)}}vt.push(Kr(Je,je,lt,se.properties))}function Zs(vt,se){se.push(Nc(vt[0]),Vc(vt[1]),0)}function Ca(vt,se,me,be){let Fe,je,Ze=0;for(let Je=0;Je<vt.length;Je++){const mt=Nc(vt[Je][0]),pt=Vc(vt[Je][1]);se.push(mt,pt,0),Je>0&&(Ze+=be?(Fe*pt-mt*je)/2:Math.sqrt(Math.pow(mt-Fe,2)+Math.pow(pt-je,2))),Fe=mt,je=pt}const lt=se.length-3;se[2]=1,go(se,0,lt,me),se[lt+2]=1,se.size=Math.abs(Ze),se.start=0,se.end=se.size}function $a(vt,se,me,be){for(let Fe=0;Fe<vt.length;Fe++){const je=[];Ca(vt[Fe],je,me,be),se.push(je)}}function Nc(vt){return vt/360+.5}function Vc(vt){const se=Math.sin(vt*Math.PI/180),me=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return me<0?0:me>1?1:me}function ro(vt,se,me,be,Fe,je,Ze,lt){if(be/=se,je>=(me/=se)&&Ze<be)return vt;if(Ze<me||je>=be)return null;const Je=[];for(const mt of vt){const pt=mt.geometry;let yt=mt.type;const Lt=Fe===0?mt.minX:mt.minY,Zt=Fe===0?mt.maxX:mt.maxY;if(Lt>=me&&Zt<be){Je.push(mt);continue}if(Zt<me||Lt>=be)continue;let Jt=[];if(yt==="Point"||yt==="MultiPoint")na(pt,Jt,me,be,Fe);else if(yt==="LineString")pl(pt,Jt,me,be,Fe,!1,lt.lineMetrics);else if(yt==="MultiLineString")Aa(pt,Jt,me,be,Fe,!1);else if(yt==="Polygon")Aa(pt,Jt,me,be,Fe,!0);else if(yt==="MultiPolygon")for(const pi of pt){const Di=[];Aa(pi,Di,me,be,Fe,!0),Di.length&&Jt.push(Di)}if(Jt.length){if(lt.lineMetrics&&yt==="LineString"){for(const pi of Jt)Je.push(Kr(mt.id,yt,pi,mt.tags));continue}yt!=="LineString"&&yt!=="MultiLineString"||(Jt.length===1?(yt="LineString",Jt=Jt[0]):yt="MultiLineString"),yt!=="Point"&&yt!=="MultiPoint"||(yt=Jt.length===3?"Point":"MultiPoint"),Je.push(Kr(mt.id,yt,Jt,mt.tags))}}return Je.length?Je:null}function na(vt,se,me,be,Fe){for(let je=0;je<vt.length;je+=3){const Ze=vt[je+Fe];Ze>=me&&Ze<=be&&qi(se,vt[je],vt[je+1],vt[je+2])}}function pl(vt,se,me,be,Fe,je,Ze){let lt=zn(vt);const Je=Fe===0?Fn:$u;let mt,pt,yt=vt.start;for(let Di=0;Di<vt.length-3;Di+=3){const ki=vt[Di],Pi=vt[Di+1],dr=vt[Di+2],br=vt[Di+3],sr=vt[Di+4],wr=Fe===0?ki:Pi,Pr=Fe===0?br:sr;let Bn=!1;Ze&&(mt=Math.sqrt(Math.pow(ki-br,2)+Math.pow(Pi-sr,2))),wr<me?Pr>me&&(pt=Je(lt,ki,Pi,br,sr,me),Ze&&(lt.start=yt+mt*pt)):wr>be?Pr<be&&(pt=Je(lt,ki,Pi,br,sr,be),Ze&&(lt.start=yt+mt*pt)):qi(lt,ki,Pi,dr),Pr<me&&wr>=me&&(pt=Je(lt,ki,Pi,br,sr,me),Bn=!0),Pr>be&&wr<=be&&(pt=Je(lt,ki,Pi,br,sr,be),Bn=!0),!je&&Bn&&(Ze&&(lt.end=yt+mt*pt),se.push(lt),lt=zn(vt)),Ze&&(yt+=mt)}let Lt=vt.length-3;const Zt=vt[Lt],Jt=vt[Lt+1],pi=Fe===0?Zt:Jt;pi>=me&&pi<=be&&qi(lt,Zt,Jt,vt[Lt+2]),Lt=lt.length-3,je&&Lt>=3&&(lt[Lt]!==lt[0]||lt[Lt+1]!==lt[1])&&qi(lt,lt[0],lt[1],lt[2]),lt.length&&se.push(lt)}function zn(vt){const se=[];return se.size=vt.size,se.start=vt.start,se.end=vt.end,se}function Aa(vt,se,me,be,Fe,je){for(const Ze of vt)pl(Ze,se,me,be,Fe,je,!1)}function qi(vt,se,me,be){vt.push(se,me,be)}function Fn(vt,se,me,be,Fe,je){const Ze=(je-se)/(be-se);return qi(vt,je,me+(Fe-me)*Ze,1),Ze}function $u(vt,se,me,be,Fe,je){const Ze=(je-me)/(Fe-me);return qi(vt,se+(be-se)*Ze,je,1),Ze}function Jr(vt,se){const me=[];for(let be=0;be<vt.length;be++){const Fe=vt[be],je=Fe.type;let Ze;if(je==="Point"||je==="MultiPoint"||je==="LineString")Ze=Pa(Fe.geometry,se);else if(je==="MultiLineString"||je==="Polygon"){Ze=[];for(const lt of Fe.geometry)Ze.push(Pa(lt,se))}else if(je==="MultiPolygon"){Ze=[];for(const lt of Fe.geometry){const Je=[];for(const mt of lt)Je.push(Pa(mt,se));Ze.push(Je)}}me.push(Kr(Fe.id,je,Ze,Fe.tags))}return me}function Pa(vt,se){const me=[];me.size=vt.size,vt.start!==void 0&&(me.start=vt.start,me.end=vt.end);for(let be=0;be<vt.length;be+=3)me.push(vt[be]+se,vt[be+1],vt[be+2]);return me}function Uc(vt,se){if(vt.transformed)return vt;const me=1<<vt.z,be=vt.x,Fe=vt.y;for(const je of vt.features){const Ze=je.geometry,lt=je.type;if(je.geometry=[],lt===1)for(let Je=0;Je<Ze.length;Je+=2)je.geometry.push(fl(Ze[Je],Ze[Je+1],se,me,be,Fe));else for(let Je=0;Je<Ze.length;Je++){const mt=[];for(let pt=0;pt<Ze[Je].length;pt+=2)mt.push(fl(Ze[Je][pt],Ze[Je][pt+1],se,me,be,Fe));je.geometry.push(mt)}}return vt.transformed=!0,vt}function fl(vt,se,me,be,Fe,je){return[Math.round(me*(vt*be-Fe)),Math.round(me*(se*be-je))]}function jc(vt,se,me,be,Fe){const je=se===Fe.maxZoom?0:Fe.tolerance/((1<<se)*Fe.extent),Ze={features:[],numPoints:0,numSimplified:0,numFeatures:vt.length,source:null,x:me,y:be,z:se,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const lt of vt)Ps(Ze,lt,je,Fe);return Ze}function Ps(vt,se,me,be){const Fe=se.geometry,je=se.type,Ze=[];if(vt.minX=Math.min(vt.minX,se.minX),vt.minY=Math.min(vt.minY,se.minY),vt.maxX=Math.max(vt.maxX,se.maxX),vt.maxY=Math.max(vt.maxY,se.maxY),je==="Point"||je==="MultiPoint")for(let lt=0;lt<Fe.length;lt+=3)Ze.push(Fe[lt],Fe[lt+1]),vt.numPoints++,vt.numSimplified++;else if(je==="LineString")$c(Ze,Fe,vt,me,!1,!1);else if(je==="MultiLineString"||je==="Polygon")for(let lt=0;lt<Fe.length;lt++)$c(Ze,Fe[lt],vt,me,je==="Polygon",lt===0);else if(je==="MultiPolygon")for(let lt=0;lt<Fe.length;lt++){const Je=Fe[lt];for(let mt=0;mt<Je.length;mt++)$c(Ze,Je[mt],vt,me,!0,mt===0)}if(Ze.length){let lt=se.tags||null;if(je==="LineString"&&be.lineMetrics){lt={};for(const mt in se.tags)lt[mt]=se.tags[mt];lt.mapbox_clip_start=Fe.start/Fe.size,lt.mapbox_clip_end=Fe.end/Fe.size}const Je={geometry:Ze,type:je==="Polygon"||je==="MultiPolygon"?3:je==="LineString"||je==="MultiLineString"?2:1,tags:lt};se.id!==null&&(Je.id=se.id),vt.features.push(Je)}}function $c(vt,se,me,be,Fe,je){const Ze=be*be;if(be>0&&se.size<(Fe?Ze:be))return void(me.numPoints+=se.length/3);const lt=[];for(let Je=0;Je<se.length;Je+=3)(be===0||se[Je+2]>Ze)&&(me.numSimplified++,lt.push(se[Je],se[Je+1])),me.numPoints++;Fe&&function(Je,mt){let pt=0;for(let yt=0,Lt=Je.length,Zt=Lt-2;yt<Lt;Zt=yt,yt+=2)pt+=(Je[yt]-Je[Zt])*(Je[yt+1]+Je[Zt+1]);if(pt>0===mt)for(let yt=0,Lt=Je.length;yt<Lt/2;yt+=2){const Zt=Je[yt],Jt=Je[yt+1];Je[yt]=Je[Lt-2-yt],Je[yt+1]=Je[Lt-1-yt],Je[Lt-2-yt]=Zt,Je[Lt-1-yt]=Jt}}(lt,je),vt.push(lt)}const zh={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Fh{constructor(se,me){const be=(me=this.options=function(je,Ze){for(const lt in Ze)je[lt]=Ze[lt];return je}(Object.create(zh),me)).debug;if(be&&console.time("preprocess data"),me.maxZoom<0||me.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(me.promoteId&&me.generateId)throw new Error("promoteId and generateId cannot be used together.");let Fe=function(je,Ze){const lt=[];if(je.type==="FeatureCollection")for(let Je=0;Je<je.features.length;Je++)dl(lt,je.features[Je],Ze,Je);else dl(lt,je.type==="Feature"?je:{geometry:je},Ze);return lt}(se,me);this.tiles={},this.tileCoords=[],be&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",me.indexMaxZoom,me.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Fe=function(je,Ze){const lt=Ze.buffer/Ze.extent;let Je=je;const mt=ro(je,1,-1-lt,lt,0,-1,2,Ze),pt=ro(je,1,1-lt,2+lt,0,-1,2,Ze);return(mt||pt)&&(Je=ro(je,1,-lt,1+lt,0,-1,2,Ze)||[],mt&&(Je=Jr(mt,1).concat(Je)),pt&&(Je=Je.concat(Jr(pt,-1)))),Je}(Fe,me),Fe.length&&this.splitTile(Fe,0,0,0),be&&(Fe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(se,me,be,Fe,je,Ze,lt){const Je=[se,me,be,Fe],mt=this.options,pt=mt.debug;for(;Je.length;){Fe=Je.pop(),be=Je.pop(),me=Je.pop(),se=Je.pop();const yt=1<<me,Lt=ts(me,be,Fe);let Zt=this.tiles[Lt];if(!Zt&&(pt>1&&console.time("creation"),Zt=this.tiles[Lt]=jc(se,me,be,Fe,mt),this.tileCoords.push({z:me,x:be,y:Fe}),pt)){pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",me,be,Fe,Zt.numFeatures,Zt.numPoints,Zt.numSimplified),console.timeEnd("creation"));const Bn=`z${me}`;this.stats[Bn]=(this.stats[Bn]||0)+1,this.total++}if(Zt.source=se,je==null){if(me===mt.indexMaxZoom||Zt.numPoints<=mt.indexMaxPoints)continue}else{if(me===mt.maxZoom||me===je)continue;if(je!=null){const Bn=je-me;if(be!==Ze>>Bn||Fe!==lt>>Bn)continue}}if(Zt.source=null,se.length===0)continue;pt>1&&console.time("clipping");const Jt=.5*mt.buffer/mt.extent,pi=.5-Jt,Di=.5+Jt,ki=1+Jt;let Pi=null,dr=null,br=null,sr=null,wr=ro(se,yt,be-Jt,be+Di,0,Zt.minX,Zt.maxX,mt),Pr=ro(se,yt,be+pi,be+ki,0,Zt.minX,Zt.maxX,mt);se=null,wr&&(Pi=ro(wr,yt,Fe-Jt,Fe+Di,1,Zt.minY,Zt.maxY,mt),dr=ro(wr,yt,Fe+pi,Fe+ki,1,Zt.minY,Zt.maxY,mt),wr=null),Pr&&(br=ro(Pr,yt,Fe-Jt,Fe+Di,1,Zt.minY,Zt.maxY,mt),sr=ro(Pr,yt,Fe+pi,Fe+ki,1,Zt.minY,Zt.maxY,mt),Pr=null),pt>1&&console.timeEnd("clipping"),Je.push(Pi||[],me+1,2*be,2*Fe),Je.push(dr||[],me+1,2*be,2*Fe+1),Je.push(br||[],me+1,2*be+1,2*Fe),Je.push(sr||[],me+1,2*be+1,2*Fe+1)}}getTile(se,me,be){se=+se,me=+me,be=+be;const Fe=this.options,{extent:je,debug:Ze}=Fe;if(se<0||se>24)return null;const lt=1<<se,Je=ts(se,me=me+lt&lt-1,be);if(this.tiles[Je])return Uc(this.tiles[Je],je);Ze>1&&console.log("drilling down to z%d-%d-%d",se,me,be);let mt,pt=se,yt=me,Lt=be;for(;!mt&&pt>0;)pt--,yt>>=1,Lt>>=1,mt=this.tiles[ts(pt,yt,Lt)];return mt&&mt.source?(Ze>1&&(console.log("found parent tile z%d-%d-%d",pt,yt,Lt),console.time("drilling down")),this.splitTile(mt.source,pt,yt,Lt,se,me,be),Ze>1&&console.timeEnd("drilling down"),this.tiles[Je]?Uc(this.tiles[Je],je):null):null}}function ts(vt,se,me){return 32*((1<<vt)*me+se)+vt}function Jl(vt,se){const me=vt.tileID.canonical;if(!this._geoJSONIndex)return void se(null,null);const be=this._geoJSONIndex.getTile(me.z,me.x,me.y);if(!be)return void se(null,null);const Fe=new ni(be.features);let je=Ye(Fe);je.byteOffset===0&&je.byteLength===je.buffer.byteLength||(je=new Uint8Array(je)),se(null,{vectorTile:Fe,rawData:je.buffer})}class Gu extends qt{constructor(se,me,be,Fe,je,Ze){super(se,me,be,Fe,Jl,Ze),je&&(this.loadGeoJSON=je),this._dynamicIndex=new ii}loadData(se,me){const be=se&&se.request,Fe=be&&be.collectResourceTiming;this.loadGeoJSON(se,(je,Ze)=>{if(je||!Ze)return me(je);if(typeof Ze!="object")return me(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));{try{if(se.filter){const Je=r.U(se.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Je.result==="error")throw new Error(Je.value.map(mt=>`${mt.key}: ${mt.message}`).join(", "));Ze.features=Ze.features.filter(mt=>Je.value.evaluate({zoom:0},mt))}se.dynamic?(Ze.type==="Feature"&&(Ze={type:"FeatureCollection",features:[Ze]}),se.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ze.features,this.loaded),se.cluster&&(Ze.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=se.cluster?new mo(function({superclusterOptions:Je,clusterProperties:mt}){if(!mt||!Je)return Je;const pt={},yt={},Lt={accumulated:null,zoom:0},Zt={properties:null},Jt=Object.keys(mt);for(const pi of Jt){const[Di,ki]=mt[pi],Pi=r.U(ki),dr=r.U(typeof Di=="string"?[Di,["accumulated"],["get",pi]]:Di);pt[pi]=Pi.value,yt[pi]=dr.value}return Je.map=pi=>{Zt.properties=pi;const Di={};for(const ki of Jt)Di[ki]=pt[ki].evaluate(Lt,Zt);return Di},Je.reduce=(pi,Di)=>{Zt.properties=Di;for(const ki of Jt)Lt.accumulated=pi[ki],pi[ki]=yt[ki].evaluate(Lt,Zt)},Je}(se)).load(Ze.features):se.dynamic?this._dynamicIndex:function(Je,mt){return new Fh(Je,mt)}(Ze,se.geojsonVtOptions)}catch(Je){return me(Je)}const lt={};if(Fe){const Je=q(be);Je&&(lt.resourceTiming={},lt.resourceTiming[se.source]=JSON.parse(JSON.stringify(Je)))}me(null,lt)}})}reloadTile(se,me){const be=this.loaded;return be&&be[se.uid]?se.partial?me(null,void 0):super.reloadTile(se,me):this.loadTile(se,me)}loadGeoJSON(se,me){if(se.request)r.n(se.request,me);else{if(typeof se.data!="string")return me(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));try{return me(null,JSON.parse(se.data))}catch{return me(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(se,me){try{me(null,this._geoJSONIndex.getClusterExpansionZoom(se.clusterId))}catch(be){me(be)}}getClusterChildren(se,me){try{me(null,this._geoJSONIndex.getChildren(se.clusterId))}catch(be){me(be)}}getClusterLeaves(se,me){try{me(null,this._geoJSONIndex.getLeaves(se.clusterId,se.limit,se.offset))}catch(be){me(be)}}}class Hu{constructor(se,me){this.tileID=new r.aG(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),this.tileZoom=se.tileZoom,this.uid=se.uid,this.zoom=se.zoom,this.canonical=se.tileID.canonical,this.pixelRatio=se.pixelRatio,this.tileSize=se.tileSize,this.source=se.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=se.projection,this.brightness=me}parse(se,me,be,Fe){this.status="parsing";const je=new r.aG(be.tileID.overscaledZ,be.tileID.wrap,be.tileID.canonical.z,be.tileID.canonical.x,be.tileID.canonical.y),Ze=[],lt=me.familiesBySource[be.source],Je=new r.d$(je,be.promoteId);return Je.bucketLayerIDs=[],Je.is3DTile=!0,r.ea(se).then(mt=>{if(!mt)return Fe(new Error("Could not parse tile"));const pt=r.eb(mt,1/r.cc(be.tileID.canonical)),yt=mt.json.extensionsUsed&&mt.json.extensionsUsed.includes("MAPBOX_mesh_features")||mt.json.asset.extras&&mt.json.asset.extras.MAPBOX_mesh_features,Lt=mt.json.extensionsUsed&&mt.json.extensionsUsed.includes("EXT_meshopt_compression"),Zt=new r.a8(this.zoom,{brightness:this.brightness});for(const Jt in lt)for(const pi of lt[Jt]){const Di=pi[0];Je.bucketLayerIDs.push(pi.map(Pi=>r.aC(Pi.id,Pi.scope))),Di.recalculate(Zt,[]);const ki=new r.ec(pi,pt,je,yt,Lt,this.brightness,Je);yt||(ki.needsUpload=!0),Ze.push(ki),ki.evaluate(Di)}this.status="done",Fe(null,{buckets:Ze,featureIndex:Je,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(mt=>Fe(new Error(mt.message)))}}class Is{constructor(se,me,be,Fe,je,Ze){this.actor=se,this.layerIndex=me,this.availableImages=be,this.brightness=Ze,this.loading={},this.loaded={}}loadTile(se,me){const be=se.uid,Fe=this.loading[be]=new Hu(se,this.brightness);r.bi(se.request,(je,Ze)=>{const lt=!this.loading[be];return delete this.loading[be],lt||je?(Fe.status="done",lt||(this.loaded[be]=Fe),me(je)):Ze&&Ze.byteLength!==0?void Fe.parse(Ze,this.layerIndex,se,(Je,mt)=>{Fe.status="done",this.loaded=this.loaded||{},this.loaded[be]=Fe,Je||!mt?me(Je):me(null,mt)}):(Fe.status="done",this.loaded[be]=Fe,me())})}reloadTile(se,me){const be=this.loaded,Fe=se.uid;if(be&&be[Fe]){const je=be[Fe];je.projection=se.projection,je.brightness=se.brightness;const Ze=(lt,Je)=>{je.reloadCallback&&(delete je.reloadCallback,this.loadTile(se,me)),me(lt,Je)};je.status==="parsing"?je.reloadCallback=Ze:je.status==="done"&&this.loadTile(se,me)}}abortTile(se,me){const be=se.uid;this.loading[be]&&delete this.loading[be],me()}removeTile(se,me){const be=this.loaded,Fe=se.uid;be&&be[Fe]&&delete be[Fe],me()}}class Ho{constructor(se){this.self=se,this.actor=new r.ed(se,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new r.I,this.projections={},this.defaultProjection=r.bP({name:"mercator"}),this.workerSourceTypes={vector:qt,geojson:Gu,"batched-model":Is},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(me,be)=>{if(this.workerSourceTypes[me])throw new Error(`Worker source with name "${me}" already registered.`);this.workerSourceTypes[me]=be},this.self.registerRTLTextPlugin=me=>{if(r.ee.isParsed())throw new Error("RTL text plugin already registered.");r.ee.applyArabicShaping=me.applyArabicShaping,r.ee.processBidirectionalText=me.processBidirectionalText,r.ee.processStyledBidirectionalText=me.processStyledBidirectionalText}}clearCaches(se,me,be){delete this.layerIndexes[se],delete this.availableImages[se],delete this.workerSources[se],delete this.demWorkerSources[se],delete this.rasterArrayWorkerSource,be()}checkIfReady(se,me,be){be()}setReferrer(se,me){this.referrer=me}spriteLoaded(se,{scope:me,isLoaded:be}){if(this.isSpriteLoaded[se]||(this.isSpriteLoaded[se]={}),this.isSpriteLoaded[se][me]=be,this.workerSources[se]&&this.workerSources[se][me])for(const Fe in this.workerSources[se][me]){const je=this.workerSources[se][me][Fe];for(const Ze in je){const lt=je[Ze];lt instanceof qt&&(lt.isSpriteLoaded=be,lt.fire(new r.z("isSpriteLoaded")))}}}setImages(se,{scope:me,images:be},Fe){if(this.availableImages[se]||(this.availableImages[se]={}),this.availableImages[se][me]=be,this.workerSources[se]&&this.workerSources[se][me]){for(const je in this.workerSources[se][me]){const Ze=this.workerSources[se][me][je];for(const lt in Ze)Ze[lt].availableImages=be}Fe()}else Fe()}setProjection(se,me){this.projections[se]=r.bP(me)}setBrightness(se,me,be){this.brightness=me,be()}setLayers(se,me,be){this.getLayerIndex(se,me.scope).replace(me.layers,me.options),be()}updateLayers(se,me,be){this.getLayerIndex(se,me.scope).update(me.layers,me.removedIds,me.options),be()}loadTile(se,me,be){me.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,me.type,me.source,me.scope).loadTile(me,be)}loadDEMTile(se,me,be){this.getDEMWorkerSource(se,me.source,me.scope).loadTile(me,be)}decodeRasterArray(se,me,be){this.getRasterArrayWorkerSource().decodeRasterArray(me,be)}reloadTile(se,me,be){me.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,me.type,me.source,me.scope).reloadTile(me,be)}abortTile(se,me,be){this.getWorkerSource(se,me.type,me.source,me.scope).abortTile(me,be)}removeTile(se,me,be){this.getWorkerSource(se,me.type,me.source,me.scope).removeTile(me,be)}removeSource(se,me,be){if(!(this.workerSources[se]&&this.workerSources[se][me.scope]&&this.workerSources[se][me.scope][me.type]&&this.workerSources[se][me.scope][me.type][me.source]))return;const Fe=this.workerSources[se][me.scope][me.type][me.source];delete this.workerSources[se][me.scope][me.type][me.source],Fe.removeSource!==void 0?Fe.removeSource(me,be):be()}loadWorkerSource(se,me,be){try{this.self.importScripts(me.url),be()}catch(Fe){be(Fe.toString())}}syncRTLPluginState(se,me,be){try{r.ee.setState(me);const Fe=r.ee.getPluginURL();if(r.ee.isLoaded()&&!r.ee.isParsed()&&Fe!=null){this.self.importScripts(Fe);const je=r.ee.isParsed();be(je?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Fe}`),je)}}catch(Fe){be(Fe.toString())}}setDracoUrl(se,me){this.dracoUrl=me}getAvailableImages(se,me){this.availableImages[se]||(this.availableImages[se]={});let be=this.availableImages[se][me];return be||(be=[]),be}getLayerIndex(se,me){this.layerIndexes[se]||(this.layerIndexes[se]={});let be=this.layerIndexes[se][me];return be||(be=this.layerIndexes[se][me]=new he,be.scope=me),be}getWorkerSource(se,me,be,Fe){return this.workerSources[se]||(this.workerSources[se]={}),this.workerSources[se][Fe]||(this.workerSources[se][Fe]={}),this.workerSources[se][Fe][me]||(this.workerSources[se][Fe][me]={}),this.isSpriteLoaded[se]||(this.isSpriteLoaded[se]={}),this.workerSources[se][Fe][me][be]||(this.workerSources[se][Fe][me][be]=new this.workerSourceTypes[me]({send:(je,Ze,lt,Je,mt,pt)=>{this.actor.send(je,Ze,lt,se,mt,pt)},scheduler:this.actor.scheduler},this.getLayerIndex(se,Fe),this.getAvailableImages(se,Fe),this.isSpriteLoaded[se][Fe],void 0,this.brightness)),this.workerSources[se][Fe][me][be]}rasterizeImages(se,me,be){const{imageTasks:Fe,scope:je}=me,Ze={};for(const lt in Fe){const{image:Je,imageIdWithOptions:mt}=Fe[lt];Ze[lt]=this.imageRasterizer.rasterize(mt,Je,je,se)}be(void 0,Ze)}removeRasterizedImages(se,me,be){const{imageIds:Fe,scope:je}=me;this.imageRasterizer.removeImagesFromCacheByIds(Fe,je,se),be()}getDEMWorkerSource(se,me,be){return this.demWorkerSources[se]||(this.demWorkerSources[se]={}),this.demWorkerSources[se][be]||(this.demWorkerSources[se][be]={}),this.demWorkerSources[se][be][me]||(this.demWorkerSources[se][be][me]=new Te),this.demWorkerSources[se][be][me]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new gt),this.rasterArrayWorkerSource}enforceCacheSizeLimit(se,me){r.ef(me)}getWorkerPerformanceMetrics(se,me,be){be(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ho(self)),Ho}),A(["./shared"],function(r){var q="3.10.0";const ie={create:"create",load:"load",fullLoad:"fullLoad"},ae={mark(u){performance.mark(u)},measure(u,t,n){performance.measure(u,t,n)}};function he(u){const t=u.name.split("?")[0];return r.a(t)&&t.includes("mapbox-gl.js")?"javascript":r.a(t)&&t.includes("mapbox-gl.css")?"css":r.b(t)?"fontRange":r.c(t)?"sprite":r.i(t)?"style":r.d(t)?"tilejson":"other"}var ve,Ae={},we=function(){if(ve)return Ae;function u(d){return!t(d)}function t(d){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,T,D=new Blob([""],{type:"text/javascript"}),F=URL.createObjectURL(D);try{T=new Worker(F),b=!0}catch{b=!1}return T&&T.terminate(),URL.revokeObjectURL(F),b}()?function(){var b=document.createElement("canvas");b.width=b.height=1;var T=b.getContext("2d");if(!T)return!1;var D=T.getImageData(0,0,1,1);return D&&D.width===b.width}()?(n[y=d&&d.failIfMajorPerformanceCaveat]===void 0&&(n[y]=function(b){var T,D=function(F){var V=document.createElement("canvas"),j=Object.create(u.webGLContextAttributes);return j.failIfMajorPerformanceCaveat=F,V.getContext("webgl2",j)}(b);if(!D)return!1;try{T=D.createShader(D.VERTEX_SHADER)}catch{return!1}return!(!T||D.isContextLost())&&(D.shaderSource(T,"void main() {}"),D.compileShader(T),D.getShaderParameter(T,D.COMPILE_STATUS)===!0)}(y)),n[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}ve=1,Ae.supported=u,Ae.notSupportedReason=t;var n={};return u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Ae}();function Pe(u,t,n){const d=document.createElement(u);return t!=null&&(d.className=t),n&&n.appendChild(d),d}function Ve(u,t,n){const d=document.createElementNS("http://www.w3.org/2000/svg",u);for(const y of Object.keys(t))d.setAttributeNS(null,y,String(t[y]));return n&&n.appendChild(d),d}const We=typeof document<"u"?document.documentElement&&document.documentElement.style:null,rt=We&&We.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ht;function tt(){We&&rt&&(ht=We[rt],We[rt]="none")}function at(){We&&rt&&(We[rt]=ht)}function Rt(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",Rt,!0)}function Ne(){window.addEventListener("click",Rt,!0),window.setTimeout(()=>{window.removeEventListener("click",Rt,!0)},0)}function Tt(u,t){const n=u.getBoundingClientRect();return gt(u,n,t)}function qt(u,t){const n=u.getBoundingClientRect(),d=[];for(let y=0;y<t.length;y++)d.push(gt(u,n,t[y]));return d}function Te(u){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&u.button===2&&u.ctrlKey?0:u.button}function gt(u,t,n){const d=u.offsetWidth===t.width?1:u.offsetWidth/t.width;return new r.P((n.clientX-t.left)*d,(n.clientY-t.top)*d)}const oi="01",Ti="NO_ACCESS_TOKEN";class ni{constructor(t,n,d){this._transformRequestFn=t,this._customAccessToken=n,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const t=function(){let n="";for(let d=0;d<10;d++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",oi,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeStyleURL(t,n){if(!r.f(t))return t;const d=zt(t);return d.params.push(`sdk=js-${q}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||n)}normalizeGlyphsURL(t,n){if(!r.f(t))return t;const d=zt(t);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||n)}normalizeModelURL(t,n){if(!r.f(t))return t;const d=zt(t);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||n)}normalizeSourceURL(t,n,d,y){if(!r.f(t))return t;const b=zt(t);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),d&&b.params.push(`language=${d}`),y&&b.params.push(`worldview=${y}`),this._makeAPIURL(b,this._customAccessToken||n)}normalizeIconsetURL(t,n){const d=zt(t);return r.f(t)?(d.path=`/styles/v1${d.path}/iconset.pbf`,this._makeAPIURL(d,this._customAccessToken||n)):ii(d)}normalizeSpriteURL(t,n,d,y){const b=zt(t);return r.f(t)?(b.path=`/styles/v1${b.path}/sprite${n}${d}`,this._makeAPIURL(b,this._customAccessToken||y)):(b.path+=`${n}${d}`,ii(b))}normalizeTileURL(t,n,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!r.f(t))return t;const y=zt(t);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||d&&y.authority!=="raster"&&d===512?"@2x":""}${r.m.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${r.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${r.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${r.e.TILE_URL_VERSION}${y.path}`);const b=this._customAccessToken||function(T){for(const D of T){const F=D.match(/^access_token=(.*)$/);if(F)return F[1]}return null}(y.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,b)}canonicalizeTileURL(t,n){const d=zt(t);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return t;let y="mapbox://";d.path.match(/^\/raster\/v1\//)?y+=`raster/${d.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${d.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${d.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let b=d.params;return n&&(b=b.filter(T=>!T.match(/^access_token=/))),b.length&&(y+=`?${b.join("&")}`),y}canonicalizeTileset(t,n){const d=!!n&&r.f(n),y=[];for(const b of t.tiles||[])r.h(b)?y.push(this.canonicalizeTileURL(b,d)):y.push(b);return y}_makeAPIURL(t,n){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=zt(r.e.API_URL);if(t.protocol=y.protocol,t.authority=y.authority,t.protocol==="http"){const b=t.params.indexOf("secure");b>=0&&t.params.splice(b,1)}if(y.path!=="/"&&(t.path=`${y.path}${t.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return ii(t);if(n=n||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return t.params=t.params.filter(b=>b.indexOf("access_token")===-1),t.params.push(`access_token=${n||""}`),ii(t)}}const Mt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function zt(u){const t=u.match(Mt);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ii(u){const t=u.params.length?`?${u.params.join("&")}`:"";return`${u.protocol}://${u.authority}${u.path}${t}`}const Yt="mapbox.eventData";function jt(u){if(!u)return null;const t=u.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(r.j(t[1]))}catch{return null}}class Ri{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=jt(r.e.ACCESS_TOKEN);let d="";return d=n&&n.u?r.k(n.u):r.e.ACCESS_TOKEN||"",t?`${Yt}.${t}:${d}`:`${Yt}:${d}`}fetchEventData(){const t=r.s("localStorage"),n=this.getStorageKey(),d=this.getStorageKey("uuid");if(t)try{const y=localStorage.getItem(n);y&&(this.eventData=JSON.parse(y));const b=localStorage.getItem(d);b&&(this.anonId=b)}catch{r.w("Unable to read from LocalStorage")}}saveEventData(){const t=r.s("localStorage"),n=this.getStorageKey(),d=this.getStorageKey("uuid"),y=this.anonId;if(t&&y)try{localStorage.setItem(d,y),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{r.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,d,y){if(!r.e.EVENTS_URL)return;const b=zt(r.e.EVENTS_URL);b.params.push(`access_token=${y||r.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(t).toISOString()},D=n?r.l(T,n):T,F={url:ii(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([D])};this.pendingRequest=r.p(F,V=>{this.pendingRequest=null,d(V),this.saveEventData(),this.processRequests(y)})}queueRequest(t,n){this.queue.push(t),this.processRequests(n)}}const Yi=new class extends Ri{constructor(u){super("appUserTurnstile"),this._customAccessToken=u}postTurnstileEvent(u,t){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(u)&&u.some(n=>r.f(n)||r.h(n))&&this.queueRequest(Date.now(),t)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=jt(r.e.ACCESS_TOKEN),n=t?t.u:r.e.ACCESS_TOKEN;let d=n!==this.eventData.tokenU;r.v(this.anonId)||(this.anonId=r.u(),d=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),T=new Date(y),D=(y-this.eventData.lastSuccess)/864e5;d=d||D>=1||D<-1||b.getDate()!==T.getDate()}else d=!0;d?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:q,skuId:oi,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=y,this.eventData.tokenU=n)},u):this.processRequests()}},Wi=Yi.postTurnstileEvent.bind(Yi),vi=new class extends Ri{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(u,t,n,d){this.skuToken=t,this.errorCb=d,r.e.EVENTS_URL&&(n||r.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},n):this.errorCb(new Error(Ti)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),r.v(this.anonId)||(this.anonId=r.u()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:q,skuId:oi,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},u))}remove(){this.errorCb=null}},Wr=vi.postMapLoadEvent.bind(vi),an=new class extends Ri{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(u){let t=this.mapInstanceIdMap.get(u);return t||(t=r.u(),this.mapInstanceIdMap.set(u,t)),t}getEventId(u){const t=this.eventIdPerMapInstanceMap.get(u)||0;return this.eventIdPerMapInstanceMap.set(u,t+1),t}postStyleLoadEvent(u,t){const{map:n,style:d,importedStyles:y}=t;if(!r.e.EVENTS_URL||!u&&!r.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(n),T={mapInstanceId:b,eventId:this.getEventId(b),style:d};y.length&&(T.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:T},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:n}=this.queue.shift();this.postEvent(t,n,()=>{},u)}},_n=an.postStyleLoadEvent.bind(an),Cn=new class extends Ri{constructor(){super("gljs.performance")}postPerformanceEvent(u,t){r.e.EVENTS_URL&&(u||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:n}=this.queue.shift(),d=function(y){const b=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),D=function(Q){const ce={};if(Q){for(const oe in Q)if(oe!=="other")for(const de of Q[oe]){const pe=`${oe}ResolveRangeMin`,Se=`${oe}ResolveRangeMax`,ke=`${oe}RequestCount`,Ie=`${oe}RequestCachedCount`;ce[pe]=Math.min(ce[pe]||1/0,de.startTime),ce[Se]=Math.max(ce[Se]||-1/0,de.responseEnd);const Ue=Le=>{ce[Le]===void 0&&(ce[Le]=0),++ce[Le]};de.transferSize!==void 0&&de.transferSize===0&&Ue(Ie),Ue(ke)}}return ce}(function(Q,ce){const oe={};if(Q)for(const de of Q){const pe=ce(de);oe[pe]===void 0&&(oe[pe]=[]),oe[pe].push(de)}return oe}(b,he)),F=window.devicePixelRatio,V=navigator.connection||navigator.mozConnection||navigator.webkitConnection,j=V?V.effectiveType:void 0,H={counters:[],metadata:[],attributes:[]},W=(Q,ce,oe)=>{oe!=null&&Q.push({name:ce,value:oe.toString()})};for(const Q in D)W(H.counters,Q,D[Q]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(W(H.counters,"interactionRangeMin",y.interactionRange[0]),W(H.counters,"interactionRangeMax",y.interactionRange[1])),T)for(const Q of Object.keys(ie)){const ce=ie[Q],oe=T.find(de=>de.name===ce);oe&&W(H.counters,ce,oe.startTime)}return W(H.counters,"visibilityHidden",y.visibilityHidden),W(H.attributes,"style",function(Q){if(Q)for(const ce of Q){const oe=ce.name.split("?")[0];if(r.i(oe)){const de=oe.split("/").slice(-2);if(de.length===2)return`mapbox://styles/${de[0]}/${de[1]}`}}}(b)),W(H.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),W(H.attributes,"fogEnabled",y.fogEnabled?"true":"false"),W(H.attributes,"projection",y.projection),W(H.attributes,"zoom",y.zoom),W(H.metadata,"devicePixelRatio",F),W(H.metadata,"connectionEffectiveType",j),W(H.metadata,"navigatorUserAgent",navigator.userAgent),W(H.metadata,"screenWidth",window.screen.width),W(H.metadata,"screenHeight",window.screen.height),W(H.metadata,"windowWidth",window.innerWidth),W(H.metadata,"windowHeight",window.innerHeight),W(H.metadata,"mapWidth",y.width/F),W(H.metadata,"mapHeight",y.height/F),W(H.metadata,"webglRenderer",y.renderer),W(H.metadata,"webglVendor",y.vendor),W(H.metadata,"sdkVersion",q),W(H.metadata,"sdkIdentifier","mapbox-gl-js"),H}(n);for(const y of d.metadata);for(const y of d.counters);for(const y of d.attributes);this.postEvent(t,d,()=>{},u)}},qr=Cn.postPerformanceEvent.bind(Cn),es=new class extends Ri{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(u,t,n,d){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const y=zt(r.e.API_URL+r.e.SESSION_PATH);y.params.push(`sku=${t||""}`),y.params.push(`access_token=${d||r.e.ACCESS_TOKEN||""}`);const b={url:ii(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(b,T=>{this.pendingRequest=null,n(T),this.saveEventData(),this.processRequests(d)})}getSessionAPI(u,t,n,d){this.skuToken=t,this.errorCb=d,r.e.SESSION_PATH&&r.e.API_URL&&(n||r.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},n):this.errorCb(new Error(Ti)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},u)}remove(){this.errorCb=null}},Ye=es.getSessionAPI.bind(es),ds=new Set;function Bi(u,t){t?ds.add(u):ds.delete(u)}class Xs{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,n){this._updatedSourceCaches[t]=n,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const n=t.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(t.id),this.setDirty()}removeLayer(t){const n=t.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][t.id]=t,this._updatedLayers[n].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const n in this._updatedLayers)t[n]=t[n]||{},t[n].updatedIds=Array.from(this._updatedLayers[n].values());for(const n in this._removedLayers)t[n]=t[n]||{},t[n].removedIds=Object.keys(this._removedLayers[n]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Wt(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class jn extends r.E{constructor(t){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=t,t!=="raster"&&r.t()&&(this.imageRasterizerDispatcher=new r.D(r.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.I),this._imageRasterizer}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new r.r({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,n){if(this.loaded[n]!==t&&(this.loaded[n]=t,t)){for(const{ids:d,callback:y}of this.requestors)this._notify(d,n,y);this.requestors=[]}}hasImage(t,n){return!!this.getImage(t,n)}getImage(t,n){return this.images[n][t]}addImage(t,n,d){this._validate(t,d)&&(this.images[n][t]=d)}_validate(t,n){let d=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new r.y(new Error(`Image "${t}" has invalid "stretchX" value`))),d=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new r.y(new Error(`Image "${t}" has invalid "stretchY" value`))),d=!1),this._validateContent(n.content,n)||(this.fire(new r.y(new Error(`Image "${t}" has invalid "content" value`))),d=!1),d}_validateStretch(t,n){if(!t)return!0;let d=0;for(const y of t){if(y[0]<d||y[1]<y[0]||n<y[1])return!1;d=y[1]}return!0}_validateContent(t,n){return t?t.length!==4||!n.usvg&&(t[0]<0||n.data.width<t[0]||t[1]<0||n.data.height<t[1]||t[2]<0||n.data.width<t[2]||t[3]<0||n.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,n,d){d.version=this.images[n][t].version+1,this.images[n][t]=d,this.updatedImages[n][t]=!0,this.removeFromImageRasterizerCache(t,n)}removeFromImageRasterizerCache(t,n){this.spriteFormat!=="raster"&&(r.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:n}):this.imageRasterizer.removeImagesFromCacheByIds([t],n))}removeImage(t,n){const d=this.images[n][t];delete this.images[n][t],delete this.patterns[n][t],this.removeFromImageRasterizerCache(t,n),d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,n,d){let y=!0;const b=!!this.loaded[n];if(!b)for(const T of t)this.images[n][T]||(y=!1);b||y?this._notify(t,n,d):this.requestors.push({ids:t,scope:n,callback:d})}rasterizeImages({scope:t,imageTasks:n},d){const y={};for(const b in n){const T=n[b],D=this.getImage(T.id,t);D&&(y[b]={image:D,imageIdWithOptions:T})}r.t()?this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{imageTasks:y,scope:t},d):this.rasterizeImagesInMainThread({imageTasks:y,scope:t},d)}rasterizeImagesInMainThread(t,n){const{imageTasks:d,scope:y}=t,b={};for(const T in d){const{image:D,imageIdWithOptions:F}=d[T];b[T]=this.imageRasterizer.rasterize(F,D,y,"")}n(void 0,b)}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,n,d){const y={};for(const b of t){this.images[n][b]||this.fire(new r.z("styleimagemissing",{id:b}));const T=this.images[n][b];T?y[b]={data:T.usvg?null:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,usvg:T.usvg,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)}:r.w(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,y)}getPixelSize(t){const{width:n,height:d}=this.atlasImage[t];return{width:n,height:d}}getPattern(t,n,d){const y=this.patterns[n][t],b=this.getImage(t,n);if(!b)return null;if(y&&y.position.version===b.version)return y.position;if(y)y.position.version=b.version;else{b.usvg&&!b.data&&(b.data=this.imageRasterizer.rasterize(r.A.from(t).getPrimary(),b,n,""));const T={w:b.data.width+2*r.B,h:b.data.height+2*r.B,x:0,y:0},D=new r.C(T,b,r.B);this.patterns[n][t]={bin:T,position:D}}return this._updatePatternAtlas(n,d),this.patterns[n][t].position}bind(t,n){const d=t.gl;let y=this.atlasTexture[n];y?this.dirty&&(y.update(this.atlasImage[n]),this.dirty=!1):(y=new r.T(t,this.atlasImage[n],d.RGBA8),this.atlasTexture[n]=y),y.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(t,n){const d=[];for(const D in this.patterns[t])d.push(this.patterns[t][D].bin);const{w:y,h:b}=r.F(d),T=this.atlasImage[t];T.resize({width:y||1,height:b||1});for(const D in this.patterns[t]){const{bin:F,position:V}=this.patterns[t][D];let j=V.padding;const H=F.x+j,W=F.y+j,Q=this.images[t][D].data,ce=Q.width,oe=Q.height;j=j>1?j-1:j,r.r.copy(Q,T,{x:0,y:0},{x:H,y:W},{width:ce,height:oe},n),r.r.copy(Q,T,{x:0,y:oe-j},{x:H,y:W-j},{width:ce,height:j},n),r.r.copy(Q,T,{x:0,y:0},{x:H,y:W+oe},{width:ce,height:j},n),r.r.copy(Q,T,{x:ce-j,y:0},{x:H-j,y:W},{width:j,height:oe},n),r.r.copy(Q,T,{x:0,y:0},{x:H+ce,y:W},{width:j,height:oe},n),r.r.copy(Q,T,{x:ce-j,y:oe-j},{x:H-j,y:W-j},{width:j,height:j},n),r.r.copy(Q,T,{x:0,y:oe-j},{x:H+ce,y:W-j},{width:j,height:j},n),r.r.copy(Q,T,{x:0,y:0},{x:H+ce,y:W+oe},{width:j,height:j},n),r.r.copy(Q,T,{x:ce-j,y:0},{x:H-j,y:W+oe},{width:j,height:j},n)}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,n){for(const d of t){if(this.callbackDispatchedThisFrame[n][d])continue;this.callbackDispatchedThisFrame[n][d]=!0;const y=this.images[n][d];Wt(y)&&this.updateImage(d,n,y)}}}function As(u){const t=u.key,n=u.value,d=u.valueSpec||{},y=u.objectElementValidators||{},b=u.style,T=u.styleSpec;let D=[];const F=r.H(n);if(F!=="object")return[new r.V(t,n,`object expected, ${F} found`)];for(const V in n){const j=V.split(".")[0];let H;y[j]?H=y[j]:d[j]?H=qi:y["*"]?H=y["*"]:d["*"]&&(H=qi),H?D=D.concat(H({key:(t&&`${t}.`)+V,value:n[V],valueSpec:d[j]||d["*"],style:b,styleSpec:T,object:n,objectKey:V},n)):D.push(new r.G(t,n[V],`unknown property "${V}"`))}for(const V in d)y[V]||d[V].required&&d[V].default===void 0&&n[V]===void 0&&D.push(new r.V(t,n,`missing required property "${V}"`));return D}function mo(u){const t=u.value,n=u.valueSpec,d=u.style,y=u.styleSpec,b=u.key,T=u.arrayElementValidator||qi;if(r.H(t)!=="array")return[new r.V(b,t,`array expected, ${r.H(t)} found`)];if(n.length&&t.length!==n.length)return[new r.V(b,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new r.V(b,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let D={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};y.$version<7&&(D.function=n.function),r.H(n.value)==="object"&&(D=n.value);let F=[];for(let V=0;V<t.length;V++)F=F.concat(T({array:t,arrayIndex:V,value:t[V],valueSpec:D,style:d,styleSpec:y,key:`${b}[${V}]`},!0));return F}function rr(u){const t=u.key,n=u.value,d=u.valueSpec;let y=r.H(n);if(y==="number"&&n!=n&&(y="NaN"),y!=="number")return[new r.V(t,n,`number expected, ${y} found`)];if("minimum"in d){let b=d.minimum;if(r.H(d.minimum)==="array"&&(b=d.minimum[u.arrayIndex]),n<b)return[new r.V(t,n,`${n} is less than the minimum value ${b}`)]}if("maximum"in d){let b=d.maximum;if(r.H(d.maximum)==="array"&&(b=d.maximum[u.arrayIndex]),n>b)return[new r.V(t,n,`${n} is greater than the maximum value ${b}`)]}return[]}function $n(u){const t=u.valueSpec,n=r.K(u.value.type);let d,y,b,T={};const D=n!=="categorical"&&u.value.property===void 0,F=!D,V=r.H(u.value.stops)==="array"&&r.H(u.value.stops[0])==="array"&&r.H(u.value.stops[0][0])==="object",j=As({key:u.key,value:u.value,valueSpec:u.styleSpec.function,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(Q){if(n==="identity")return[new r.V(Q.key,Q.value,'identity function may not have a "stops" property')];let ce=[];const oe=Q.value;return ce=ce.concat(mo({key:Q.key,value:oe,valueSpec:Q.valueSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:H})),r.H(oe)==="array"&&oe.length===0&&ce.push(new r.V(Q.key,oe,"array must have at least one stop")),ce},default:function(Q){return qi({key:Q.key,value:Q.value,valueSpec:t,style:Q.style,styleSpec:Q.styleSpec})}}});return n==="identity"&&D&&j.push(new r.V(u.key,u.value,'missing required property "property"')),n==="identity"||u.value.stops||j.push(new r.V(u.key,u.value,'missing required property "stops"')),n==="exponential"&&u.valueSpec.expression&&!r.L(u.valueSpec)&&j.push(new r.V(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(F&&!r.M(u.valueSpec)?j.push(new r.V(u.key,u.value,"property functions not supported")):D&&!r.N(u.valueSpec)&&j.push(new r.V(u.key,u.value,"zoom functions not supported"))),n!=="categorical"&&!V||u.value.property!==void 0||j.push(new r.V(u.key,u.value,'"property" property is required')),j;function H(Q){let ce=[];const oe=Q.value,de=Q.key;if(r.H(oe)!=="array")return[new r.V(de,oe,`array expected, ${r.H(oe)} found`)];if(oe.length!==2)return[new r.V(de,oe,`array length 2 expected, length ${oe.length} found`)];if(V){if(r.H(oe[0])!=="object")return[new r.V(de,oe,`object expected, ${r.H(oe[0])} found`)];if(oe[0].zoom===void 0)return[new r.V(de,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new r.V(de,oe,"object stop key must have value")];const pe=r.K(oe[0].zoom);if(typeof pe!="number")return[new r.V(de,oe[0].zoom,"stop zoom values must be numbers")];if(b&&b>pe)return[new r.V(de,oe[0].zoom,"stop zoom values must appear in ascending order")];pe!==b&&(b=pe,y=void 0,T={}),ce=ce.concat(As({key:`${de}[0]`,value:oe[0],valueSpec:{zoom:{}},style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:rr,value:W}}))}else ce=ce.concat(W({key:`${de}[0]`,value:oe[0],style:Q.style,styleSpec:Q.styleSpec},oe));return r.O(r.Q(oe[1]))?ce.concat([new r.V(`${de}[1]`,oe[1],"expressions are not allowed in function stops.")]):ce.concat(qi({key:`${de}[1]`,value:oe[1],valueSpec:t,style:Q.style,styleSpec:Q.styleSpec}))}function W(Q,ce){const oe=r.H(Q.value),de=r.K(Q.value),pe=Q.value!==null?Q.value:ce;if(d){if(oe!==d)return[new r.V(Q.key,pe,`${oe} stop domain type must match previous stop domain type ${d}`)]}else d=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean"&&typeof de!="number"&&typeof de!="string"&&typeof de!="boolean")return[new r.V(Q.key,pe,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&n!=="categorical"){let Se=`number expected, ${oe} found`;return r.M(t)&&n===void 0&&(Se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(Q.key,pe,Se)]}return n!=="categorical"||oe!=="number"||typeof de=="number"&&isFinite(de)&&Math.floor(de)===de?n!=="categorical"&&oe==="number"&&typeof de=="number"&&typeof y=="number"&&y!==void 0&&de<y?[new r.V(Q.key,pe,"stop domain values must appear in ascending order")]:(y=de,n==="categorical"&&de in T?[new r.V(Q.key,pe,"stop domain values must be unique")]:(T[de]=!0,[])):[new r.V(Q.key,pe,`integer expected, found ${String(de)}`)]}}function xs(u){const t=(u.expressionContext==="property"?r.S:r.U)(r.Q(u.value),u.valueSpec);if(t.result==="error")return t.value.map(d=>new r.V(`${u.key}${d.key}`,u.value,d.message));const n=t.value.expression||t.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!n.outputDefined())return[new r.V(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!r.W(n))return[new r.V(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter")return Ea(n,u);if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!r.X(n,["zoom","feature-state"]))return[new r.V(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!r.Y(n))return[new r.V(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ea(u,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const y of t.valueSpec.expression.parameters)n.delete(y);if(n.size===0)return[];const d=[];return u instanceof r.Z&&n.has(u.name)?[new r.V(t.key,t.value,`["${u.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(u.eachChild(y=>{d.push(...Ea(y,t))}),d)}function xr(u){const t=u.key,n=u.value,d=u.valueSpec,y=[];return Array.isArray(d.values)?d.values.indexOf(r.K(n))===-1&&y.push(new r.V(t,n,`expected one of [${d.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(d.values).indexOf(r.K(n))===-1&&y.push(new r.V(t,n,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(n)} found`)),y}function go(u){return r.$(r.Q(u.value))?xs(r.J({},u,{expressionContext:"filter",valueSpec:u.styleSpec[`filter_${u.layerType||"fill"}`]})):nr(u)}function nr(u){const t=u.value,n=u.key;if(r.H(t)!=="array")return[new r.V(n,t,`array expected, ${r.H(t)} found`)];const d=u.styleSpec;let y,b=[];if(t.length<1)return[new r.V(n,t,"filter array must have at least 1 element")];switch(b=b.concat(xr({key:`${n}[0]`,value:t[0],valueSpec:d.filter_operator,style:u.style,styleSpec:u.styleSpec})),r.K(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&r.K(t[1])==="$type"&&b.push(new r.V(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&b.push(new r.V(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(y=r.H(t[1]),y!=="string"&&b.push(new r.V(`${n}[1]`,t[1],`string expected, ${y} found`)));for(let T=2;T<t.length;T++)y=r.H(t[T]),r.K(t[1])==="$type"?b=b.concat(xr({key:`${n}[${T}]`,value:t[T],valueSpec:d.geometry_type,style:u.style,styleSpec:u.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&b.push(new r.V(`${n}[${T}]`,t[T],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let T=1;T<t.length;T++)b=b.concat(nr({key:`${n}[${T}]`,value:t[T],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":y=r.H(t[1]),t.length!==2?b.push(new r.V(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):y!=="string"&&b.push(new r.V(`${n}[1]`,t[1],`string expected, ${y} found`))}return b}function Kr(u,t){const n=u.key,d=u.style,y=u.layer,b=u.styleSpec,T=u.value,D=u.objectKey,F=b[`${t}_${u.layerType}`];if(!F)return[];const V=D.match(/^(.*)-use-theme$/);if(t==="paint"&&V&&F[V[1]])return r.O(T)?[].concat(qi({key:u.key,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:d,styleSpec:b,expressionContext:"property",propertyType:t,propertyKey:D})):qi({key:n,value:T,valueSpec:{type:"string"},style:d,styleSpec:b});const j=D.match(/^(.*)-transition$/);if(t==="paint"&&j&&F[j[1]]&&F[j[1]].transition)return qi({key:n,value:T,valueSpec:b.transition,style:d,styleSpec:b});const H=u.valueSpec||F[D];if(!H)return[new r.G(n,T,`unknown property "${D}"`)];let W;if(r.H(T)==="string"&&r.M(H)&&!H.tokens&&(W=/^{([^}]+)}$/.exec(T))){const ce=`\`{ "type": "identity", "property": ${W?JSON.stringify(W[1]):'"_"'} }\``;return[new r.V(n,T,`"${D}" does not support interpolation syntax
Use an identity property function instead: ${ce}.`)]}const Q=[];if(u.layerType==="symbol")D!=="text-field"||!d||d.glyphs||d.imports||Q.push(new r.V(n,T,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&r.a0(r.Q(T))&&r.K(T.type)==="identity"&&Q.push(new r.V(n,T,'"text-font" does not support identity functions'));else if(u.layerType==="model"&&t==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&r.M(H)&&(r.a1(H)||r.N(H))){const ce=r.S(r.Q(T),H),oe=ce.value.expression||ce.value._styleExpression.expression;oe&&!r.X(oe,["measure-light"])&&(D==="model-emissive-strength"&&r.Y(oe)&&r.W(oe)||Q.push(new r.V(n,T,`${D} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Q.concat(qi({key:u.key,value:T,valueSpec:H,style:d,styleSpec:b,expressionContext:"property",propertyType:t,propertyKey:D}))}function ra(u){return Kr(u,"paint")}function dl(u){return Kr(u,"layout")}function Zs(u){let t=[];const n=u.value,d=u.key,y=u.style,b=u.styleSpec;n.type||n.ref||t.push(new r.V(d,n,'either "type" or "ref" is required'));let T=r.K(n.type);const D=r.K(n.ref);if(n.id){const F=r.K(n.id);for(let V=0;V<u.arrayIndex;V++){const j=y.layers[V];r.K(j.id)===F&&t.push(new r.V(d,n.id,`duplicate layer id "${n.id}", previously used at line ${j.id.__line__}`))}}if("ref"in n){let F;["type","source","source-layer","filter","layout"].forEach(V=>{V in n&&t.push(new r.V(d,n[V],`"${V}" is prohibited for ref layers`))}),y.layers.forEach(V=>{r.K(V.id)===D&&(F=V)}),F?F.ref?t.push(new r.V(d,n.ref,"ref cannot reference another ref layer")):T=r.K(F.type):typeof D=="string"&&t.push(new r.V(d,n.ref,`ref layer "${D}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(n.source){const F=y.sources&&y.sources[n.source],V=F&&r.K(F.type);F?V==="vector"&&T==="raster"?t.push(new r.V(d,n.source,`layer "${n.id}" requires a raster source`)):V==="raster"&&T!=="raster"?t.push(new r.V(d,n.source,`layer "${n.id}" requires a vector source`)):V!=="vector"||n["source-layer"]?V==="raster-dem"&&T!=="hillshade"?t.push(new r.V(d,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):V!=="raster-array"||["raster","raster-particle"].includes(T)?T!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||V==="geojson"&&F.lineMetrics?T==="raster-particle"&&V!=="raster-array"&&t.push(new r.V(d,n.source,`layer "${n.id}" requires a 'raster-array' source.`)):t.push(new r.V(d,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new r.V(d,n.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new r.V(d,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new r.V(d,n.source,`source "${n.source}" not found`))}else t.push(new r.V(d,n,'missing required property "source"'));return t=t.concat(As({key:d,value:n,valueSpec:b.layer,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{"*":()=>[],type:()=>qi({key:`${d}.type`,value:n.type,valueSpec:b.layer.type,style:u.style,styleSpec:u.styleSpec,object:n,objectKey:"type"}),filter:F=>go(r.J({layerType:T},F)),layout:F=>As({layer:n,key:F.key,value:F.value,valueSpec:{},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{"*":V=>dl(r.J({layerType:T},V))}}),paint:F=>As({layer:n,key:F.key,value:F.value,valueSpec:{},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{"*":V=>ra(r.J({layerType:T,layer:n},V))}})}})),t}function Ca(u){const t=u.value,n=u.key,d=r.H(t);return d!=="string"?[new r.V(n,t,`string expected, ${d} found`)]:[]}const $a={promoteId:function u({key:t,value:n}){if(r.H(n)==="string")return Ca({key:t,value:n});if(Array.isArray(n)){const d=[],y=r.Q(n),b=r.U(y);return b.result==="error"&&b.value.forEach(T=>{d.push(new r.V(`${t}${T.key}`,null,`${T.message}`))}),r.X(b.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||d.push(new r.V(`${t}`,null,"promoteId expression should be only feature dependent")),d}{const d=[];for(const y in n)d.push(...u({key:`${t}.${y}`,value:n[y]}));return d}}};function Nc(u){const t=u.value,n=u.key,d=u.styleSpec,y=u.style;if(!t.type)return[new r.V(n,t,'"type" is required')];const b=r.K(t.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&(t.url||t.tiles||T.push(new r.G(n,t,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(As({key:n,value:t,valueSpec:d[`source_${b.replace("-","_")}`],style:u.style,styleSpec:d,objectElementValidators:$a})),T;case"geojson":if(T=As({key:n,value:t,valueSpec:d.source_geojson,style:y,styleSpec:d,objectElementValidators:$a}),t.cluster)for(const D in t.clusterProperties){const[F,V]=t.clusterProperties[D],j=typeof F=="string"?[F,["accumulated"],["get",D]]:F;T.push(...xs({key:`${n}.${D}.map`,value:V,expressionContext:"cluster-map"})),T.push(...xs({key:`${n}.${D}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return T;case"video":return As({key:n,value:t,valueSpec:d.source_video,style:y,styleSpec:d});case"image":return As({key:n,value:t,valueSpec:d.source_image,style:y,styleSpec:d});case"canvas":return[new r.V(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xr({key:`${n}.type`,value:t.type,valueSpec:{values:Vc(d)}})}}function Vc(u){return u.source.reduce((t,n)=>{const d=u[n];return d.type.type==="enum"&&(t=t.concat(Object.keys(d.type.values))),t},[])}function ro(u){const t=u.value,n=u.styleSpec,d=n.light,y=u.style;let b=[];const T=r.H(t);if(t===void 0)return b;if(T!=="object")return b=b.concat([new r.V("light",t,`object expected, ${T} found`)]),b;for(const D in t){const F=D.match(/^(.*)-transition$/),V=D.match(/^(.*)-use-theme$/);b=b.concat(V&&d[V[1]]?qi({key:D,value:t[D],valueSpec:{type:"string"},style:y,styleSpec:n}):F&&d[F[1]]&&d[F[1]].transition?qi({key:D,value:t[D],valueSpec:n.transition,style:y,styleSpec:n}):d[D]?qi({key:D,value:t[D],valueSpec:d[D],style:y,styleSpec:n}):[new r.V(D,t[D],`unknown property "${D}"`)])}return b}function na(u){const t=u.value;let n=[];if(!t)return n;const d=r.H(t);if(d!=="object")return n=n.concat([new r.V("light-3d",t,`object expected, ${d} found`)]),n;const y=u.styleSpec,b=y["light-3d"],T=u.key,D=u.style,F=u.style.lights;for(const H of["type","id"])if(!(H in t))return n=n.concat([new r.V("light-3d",t,`missing property ${H} on light`)]),n;if(t.type&&F)for(let H=0;H<u.arrayIndex;H++){const W=r.K(t.type),Q=F[H];r.K(Q.type)===W&&n.push(new r.V(T,t.id,`duplicate light type "${t.type}", previously defined at line ${Q.id.__line__}`))}const V=`properties_light_${t.type}`;if(!(V in y))return n=n.concat([new r.V("light-3d",t,`Invalid light type ${t.type}`)]),n;const j=y[V];for(const H in t)if(H==="properties"){const W=t[H],Q=r.H(W);if(Q!=="object")return n=n.concat([new r.V("properties",W,`object expected, ${Q} found`)]),n;for(const ce in W)n=n.concat(j[ce]?qi({key:ce,value:W[ce],valueSpec:j[ce],style:D,styleSpec:y}):[new r.G(u.key,W[ce],`unknown property "${ce}"`)])}else{const W=H.match(/^(.*)-transition$/),Q=H.match(/^(.*)-use-theme$/);n=n.concat(Q&&b[Q[1]]?qi({key:H,value:t[H],valueSpec:{type:"string"},style:D,styleSpec:y}):W&&b[W[1]]&&b[W[1]].transition?qi({key:H,value:t[H],valueSpec:y.transition,style:D,styleSpec:y}):b[H]?qi({key:H,value:t[H],valueSpec:b[H],style:D,styleSpec:y}):[new r.G(H,t[H],`unknown property "${H}"`)])}return n}function pl(u){const t=u.value,n=u.key,d=u.style,y=u.styleSpec,b=y.terrain;let T=[];const D=r.H(t);if(t===void 0||D==="null")return T;if(D!=="object")return T=T.concat([new r.V("terrain",t,`object expected, ${D} found`)]),T;for(const F in t){const V=F.match(/^(.*)-transition$/),j=F.match(/^(.*)-use-theme$/);T=T.concat(j&&b[j[1]]?qi({key:F,value:t[F],valueSpec:{type:"string"},style:d,styleSpec:y}):V&&b[V[1]]&&b[V[1]].transition?qi({key:F,value:t[F],valueSpec:y.transition,style:d,styleSpec:y}):b[F]?qi({key:F,value:t[F],valueSpec:b[F],style:d,styleSpec:y}):[new r.G(F,t[F],`unknown property "${F}"`)])}if(t.source){const F=d.sources&&d.sources[t.source],V=F&&r.K(F.type);F?V!=="raster-dem"&&T.push(new r.V(n,t.source,`terrain cannot be used with a source of type ${String(V)}, it only be used with a "raster-dem" source type`)):T.push(new r.V(n,t.source,`source "${t.source}" not found`))}else T.push(new r.V(n,t,'terrain is missing required property "source"'));return T}function zn(u){const t=u.value,n=u.style,d=u.styleSpec,y=d.fog;let b=[];const T=r.H(t);if(t===void 0)return b;if(T!=="object")return b=b.concat([new r.V("fog",t,`object expected, ${T} found`)]),b;for(const D in t){const F=D.match(/^(.*)-transition$/),V=D.match(/^(.*)-use-theme$/);b=b.concat(V&&y[V[1]]?qi({key:D,value:t[D],valueSpec:{type:"string"},style:n,styleSpec:d}):F&&y[F[1]]&&y[F[1]].transition?qi({key:D,value:t[D],valueSpec:d.transition,style:n,styleSpec:d}):y[D]?qi({key:D,value:t[D],valueSpec:y[D],style:n,styleSpec:d}):[new r.G(D,t[D],`unknown property "${D}"`)])}return b}const Aa={"*":()=>[],array:mo,boolean:function(u){const t=u.value,n=u.key,d=r.H(t);return d!=="boolean"?[new r.V(n,t,`boolean expected, ${d} found`)]:[]},number:rr,color:function(u){const t=u.key,n=u.value,d=r.H(n);return d!=="string"?[new r.V(t,n,`color expected, ${d} found`)]:r._.parseCSSColor(n)===null?[new r.V(t,n,`color expected, "${n}" found`)]:[]},enum:xr,filter:go,function:$n,layer:Zs,object:As,source:Nc,model:r.a2,light:ro,"light-3d":na,terrain:pl,fog:zn,string:Ca,formatted:function(u){return Ca(u).length===0?[]:xs(u)},resolvedImage:function(u){return Ca(u).length===0?[]:xs(u)},projection:function(u){const t=u.value,n=u.styleSpec,d=n.projection,y=u.style;let b=[];const T=r.H(t);if(T==="object")for(const D in t)b=b.concat(qi({key:D,value:t[D],valueSpec:d[D],style:y,styleSpec:n}));else T!=="string"&&(b=b.concat([new r.V("projection",t,`object or string expected, ${T} found`)]));return b},import:function(u){const{value:t,styleSpec:n}=u,{data:d,...y}=t;Object.defineProperty(y,"__line__",{value:t.__line__,enumerable:!1});let b=As(r.J({},u,{value:y,valueSpec:n.import}));return r.K(y.id)===""&&b.push(new r.V(`${u.key}.id`,y,"import id can't be an empty string")),d&&(b=b.concat($u(d,n,{key:`${u.key}.data`}))),b}};function qi(u,t=!1){const n=u.value,d=u.valueSpec,y=u.styleSpec;if(d.expression&&r.a0(r.K(n)))return $n(u);if(d.expression&&r.O(r.Q(n)))return xs(u);if(d.type&&Aa[d.type]){const b=Aa[d.type](u);return t===!0&&b.length>0&&r.H(u.value)==="array"?xs(u):b}return As(r.J({},u,{valueSpec:d.type?y[d.type]:d}))}function Fn(u){const t=u.value,n=u.key,d=Ca(u);return d.length||(t.indexOf("{fontstack}")===-1&&d.push(new r.V(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&d.push(new r.V(n,t,'"glyphs" url must include a "{range}" token'))),d}function $u(u,t=r.a3,n={}){return qi({key:n.key||"",value:u,valueSpec:t.$root,styleSpec:t,style:u,objectElementValidators:{glyphs:Fn,"*":()=>[]}})}function Jr(u,t=r.a3){return Is($u(u,t))}const Pa=u=>Is(Nc(u)),Uc=u=>Is(ro(u)),fl=u=>Is(na(u)),jc=u=>Is(pl(u)),Ps=u=>Is(zn(u)),$c=u=>Is(function(t){const n=t.value,d=t.style,y=t.styleSpec,b=y.snow;let T=[];const D=r.H(n);if(n===void 0)return T;if(D!=="object")return T=T.concat([new r.V("snow",n,`object expected, ${D} found`)]),T;for(const F in n){const V=F.match(/^(.*)-transition$/);T=T.concat(V&&b[V[1]]&&b[V[1]].transition?qi({key:F,value:n[F],valueSpec:y.transition,style:d,styleSpec:y}):b[F]?qi({key:F,value:n[F],valueSpec:b[F],style:d,styleSpec:y}):[new r.G(F,n[F],`unknown property "${F}"`)])}return T}(u)),zh=u=>Is(function(t){const n=t.value,d=t.style,y=t.styleSpec,b=y.rain;let T=[];const D=r.H(n);if(n===void 0)return T;if(D!=="object")return T=T.concat([new r.V("rain",n,`object expected, ${D} found`)]),T;for(const F in n){const V=F.match(/^(.*)-transition$/);T=T.concat(V&&b[V[1]]&&b[V[1]].transition?qi({key:F,value:n[F],valueSpec:y.transition,style:d,styleSpec:y}):b[F]?qi({key:F,value:n[F],valueSpec:b[F],style:d,styleSpec:y}):[new r.G(F,n[F],`unknown property "${F}"`)])}return T}(u)),Fh=u=>Is(Zs(u)),ts=u=>Is(go(u)),Jl=u=>Is(ra(u)),Gu=u=>Is(dl(u)),Hu=u=>Is(r.a2(u));function Is(u){return u.slice().sort((t,n)=>t.line&&n.line?t.line-n.line:0)}function Ho(u,t){let n=!1;if(t&&t.length)for(const d of t)d instanceof r.G?r.w(d.message):(u.fire(new r.y(new Error(d.message))),n=!0);return n}let vt;class se extends r.E{constructor(t,n="flat"){super(),this._transitionable=new r.a4(vt||(vt=new r.a5({anchor:new r.a6(r.a3.light.anchor),position:new r.a7(r.a3.light.position),color:new r.a6(r.a3.light.color),intensity:new r.a6(r.a3.light.intensity)}))),this.setLight(t,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n,d={}){this._validate(Uc,t,d)||(this._transitionable.setTransitionOrValue(t),this.id=n)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,d){return(!d||d.validate!==!1)&&Ho(this,t.call(Jr,r.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}}let me=class extends r.E{constructor(u,t,n,d){super(),this.scope=n,this._transitionable=new r.a4(new r.a5({source:new r.a6(r.a3.terrain.source),exaggeration:new r.a6(r.a3.terrain.exaggeration)}),n,d),this._transitionable.setTransitionOrValue(u,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(u,t){this._transitionable.setTransitionOrValue(u,t)}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}getExaggeration(u){return this._transitioning.possiblyEvaluate(new r.a8(u)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const u=this._transitionable._values.exaggeration;if(!u)return null;const t=u.value.expression;if(!t)return null;let n=-1,d=-1,y=1;for(const b of t.zoomStops)y=t.evaluate(new r.a8(b)),y>.01?(n=b,d=-1):d=b;return y<.01&&n>0&&d>n?[n,d]:null}isZoomDependent(){const u=this._transitionable._values.exaggeration;return u!=null&&u.value!=null&&u.value.expression!=null&&u.value.expression instanceof r.a9}};const be=45,Fe=65,je=.05;function Ze(u,t,n,d){const y=r.ac(be,Fe,n),[b,T]=lt(u,d);let D=1-Math.min(1,Math.exp((t-b)/(T-b)*-6));return D*=D*D,D=Math.min(1,1.00747*D),D*y*u.alpha}function lt(u,t){const n=.5/Math.tan(.5*t);return[u.range[0]+n,u.range[1]+n]}function Je(u,t,n,d,y){const b=r.ab.vec3.transformMat4([],[t,n,d],y.mercatorFogMatrix);return Ze(u,r.ab.vec3.length(b),y.pitch,y._fov)}function mt(u,t,n,d,y,b,T){const D=[[n,d,0],[y,d,0],[y,b,0],[n,b,0]];let F=Number.MAX_VALUE,V=-Number.MAX_VALUE;for(const j of D){const H=r.ab.vec3.transformMat4([],j,t),W=r.ab.vec3.length(H);F=Math.min(F,W),V=Math.max(V,W)}return[Ze(u,F,T.pitch,T._fov),Ze(u,V,T.pitch,T._fov)]}class pt extends r.E{constructor(t,n,d,y){super();const b=new r.a5({range:new r.a6(r.a3.fog.range),color:new r.a6(r.a3.fog.color),"color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.a6(r.a3.fog["high-color"]),"high-color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.a6(r.a3.fog["space-color"]),"space-color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.a6(r.a3.fog["horizon-blend"]),"star-intensity":new r.a6(r.a3.fog["star-intensity"]),"vertical-range":new r.a6(r.a3.fog["vertical-range"])});this._transitionable=new r.a4(b,d,new Map(y)),this.set(t,y),this._transitioning=this._transitionable.untransitioned(),this._transform=n,this.properties=new r.ad(b),this.scope=d}get state(){const t=this._transform,n=t.projection.name==="globe",d=r.ae(t.zoom),y=this.properties.get("range"),b=[.5,3];return{range:n?[r.af(b[0],y[0],d),r.af(b[1],y[1],d)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,n,d={}){if(this._validate(Ps,t,d))return;const y=r.l({},t);for(const b of Object.keys(r.a3.fog))y[b]===void 0&&(y[b]=r.a3.fog[b].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,n)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ac(be,Fe,t))*n.a}getOpacityAtLatLng(t,n){return this._transform.projection.supportsFog?function(d,y,b){const T=r.aa.fromLngLat(y),D=b.elevation?b.elevation.getAtPointOrZero(T):0;return Je(d,T.x,T.y,D,b)}(this.state,t,n):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(t.toUnwrapped());return mt(this.state,n,0,0,r.ag,r.ag,this._transform)}getOpacityForBounds(t,n,d,y,b){return this._transform.projection.supportsFog?mt(this.state,t,n,d,y,b,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?lt(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const d of n){const y=t.points[d];let b;if(y[2]>=0)b=y;else{const T=t.points[d-4];b=r.ah(T,y,T[2]/(T[2]-y[2]))}if(Je(this.state,b[0],b[1],0,this._transform)>=je)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,d){return(!d||d.validate!==!1)&&Ho(this,t.call(Jr,r.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}}let yt,Lt,Zt,Jt,pi=class extends r.E{constructor(u,t,n,d){super();const y=yt||(yt=new r.a5({density:new r.a6(r.a3.snow.density),intensity:new r.a6(r.a3.snow.intensity),color:new r.a6(r.a3.snow.color),opacity:new r.a6(r.a3.snow.opacity),vignette:new r.a6(r.a3.snow.vignette),"vignette-color":new r.a6(r.a3.snow["vignette-color"]),"center-thinning":new r.a6(r.a3.snow["center-thinning"]),direction:new r.a6(r.a3.snow.direction),"flake-size":new r.a6(r.a3.snow["flake-size"])}));this._transitionable=new r.a4(y,n,new Map(d)),this.set(u,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ad(y),this.scope=n}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),n=this.properties.get("direction"),d=r.ai(n[0]),y=-Math.max(r.ai(n[1]),.01),b=[Math.cos(d)*Math.cos(y),Math.sin(d)*Math.cos(y),Math.sin(y)],T=this.properties.get("vignette"),D=this.properties.get("vignette-color");return D.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.aj(t.r,t.g,t.b,t.a*u),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:D}}get(){return this._transitionable.serialize()}set(u,t,n={}){if(this._validate($c,u,n))return;const d=r.l({},u);for(const y of Object.keys(r.a3.snow))d[y]===void 0&&(d[y]=r.a3.snow[y].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,n){return(!n||n.validate!==!1)&&Ho(this,u.call(Jr,r.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}},Di=class extends r.E{constructor(u,t,n,d){super();const y=Lt||(Lt=new r.a5({density:new r.a6(r.a3.rain.density),intensity:new r.a6(r.a3.rain.intensity),color:new r.a6(r.a3.rain.color),opacity:new r.a6(r.a3.rain.opacity),vignette:new r.a6(r.a3.rain.vignette),"vignette-color":new r.a6(r.a3.rain["vignette-color"]),"center-thinning":new r.a6(r.a3.rain["center-thinning"]),direction:new r.a6(r.a3.rain.direction),"droplet-size":new r.a6(r.a3.rain["droplet-size"]),"distortion-strength":new r.a6(r.a3.rain["distortion-strength"])}));this._transitionable=new r.a4(y,n,new Map(d)),this.set(u,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ad(y),this.scope=n}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),n=this.properties.get("direction"),d=r.ai(n[0]),y=-Math.max(r.ai(n[1]),.01),b=[Math.cos(d)*Math.cos(y),Math.sin(d)*Math.cos(y),Math.sin(y)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.aj(t.r,t.g,t.b,t.a*u),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(u,t,n={}){if(this._validate(zh,u,n))return;const d=r.l({},u);for(const y of Object.keys(r.a3.rain))d[y]===void 0&&(d[y]=r.a3.rain[y].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,n){return(!n||n.validate!==!1)&&Ho(this,u.call(Jr,r.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}};class ki extends r.E{constructor(t,n,d,y){super(),this.scope=d,this._options=t,this.properties=new r.ad(n),this._transitionable=new r.a4(n,d,new Map(y)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,n){this._options=t,this._transitionable.setTransitionOrValue(t.properties,n)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Pi{constructor(t,n,d,y){this.screenBounds=t,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(t,n){let d,y;if(t instanceof r.P||typeof t[0]=="number"){const b=r.P.convert(t);d=[b],y=n.isPointAboveHorizon(b)}else{const b=r.P.convert(t[0]),T=r.P.convert(t[1]);d=[b,T],y=r.al(b,T).every(D=>n.isPointAboveHorizon(D))}return new Pi(d,n.getCameraPoint(),y,n)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return r.al(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],y=r.al(n,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<d.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?y[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(y[3]=this.cameraPoint)),r.am(y,t)}bufferedCameraGeometryGlobe(t){const n=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],y=r.al(n,d,t),b=this.cameraPoint.clone();switch(3*((b.y>n.y)+(b.y>d.y))+((b.x>n.x)+(b.x>d.x))){case 0:y[0]=b,y[4]=b.clone();break;case 1:y.splice(1,0,b);break;case 2:y[1]=b;break;case 3:y.splice(4,0,b);break;case 5:y.splice(2,0,b);break;case 6:y[3]=b;break;case 7:y.splice(3,0,b);break;case 8:y[2]=b}return y}containsTile(t,n,d,y=0){const b=t.queryPadding/n._pixelsPerMercatorPixel+1,T=d?this._bufferedCameraMercator(b,n):this._bufferedScreenMercator(b,n);let D=t.tileID.wrap+(T.unwrapped?y:0);const F=T.polygon.map(de=>r.an(t.tileTransform,de,D));if(!r.ao(F,0,0,r.ag,r.ag))return;D=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const V=this.screenGeometryMercator.polygon.map(de=>r.ap(t.tileTransform,de,D)),j=V.map(de=>new r.P(de[0],de[1])),H=n.getFreeCameraOptions().position||new r.aa(0,0,0),W=r.ap(t.tileTransform,H,D),Q=V.map(de=>{const pe=r.ab.vec3.sub(de,de,W);return r.ab.vec3.normalize(pe,pe),new r.aq(W,pe)}),ce=r.ar(t,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:j,tilespaceRays:Q,bufferedTilespaceGeometry:F,bufferedTilespaceBounds:(oe=r.as(F),oe.min.x=r.aw(oe.min.x,0,r.ag),oe.min.y=r.aw(oe.min.y,0,r.ag),oe.max.x=r.aw(oe.max.x,0,r.ag),oe.max.y=r.aw(oe.max.y,0,r.ag),oe),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:ce};var oe}_bufferedScreenMercator(t,n){const d=sr(t);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let y;return y=n.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),n):{polygon:this.bufferedScreenGeometry(t).map(b=>n.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[d]=y,y}}_bufferedCameraMercator(t,n){const d=sr(t);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let y;return y=n.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),n):{polygon:this.bufferedCameraGeometry(t).map(b=>n.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[d]=y,y}}_projectAndResample(t,n){const d=function(b,T){const D=r.ab.mat4.multiply([],T.pixelMatrix,T.globeMatrix),F=[0,-r.ax,0,1],V=[0,r.ax,0,1],j=[0,0,0,1];r.ab.vec4.transformMat4(F,F,D),r.ab.vec4.transformMat4(V,V,D),r.ab.vec4.transformMat4(j,j,D);const H=new r.P(F[0]/F[3],F[1]/F[3]),W=new r.P(V[0]/V[3],V[1]/V[3]),Q=r.au(b,H)&&F[3]<j[3],ce=r.au(b,W)&&V[3]<j[3];if(!Q&&!ce)return null;const oe=function(Be,Oe,He){for(let Qe=1;Qe<Be.length;Qe++){const xt=br(Oe.pointCoordinate3D(Be[Qe-1]).x),ut=br(Oe.pointCoordinate3D(Be[Qe]).x);if(He<0){if(xt<ut)return{idx:Qe,t:-xt/(ut-1-xt)}}else if(ut<xt)return{idx:Qe,t:(1-xt)/(ut+1-xt)}}return null}(b,T,Q?-1:1);if(!oe)return null;const{idx:de,t:pe}=oe;let Se=de>1?dr(b.slice(0,de),T):[],ke=de<b.length?dr(b.slice(de),T):[];Se=Se.map(Be=>new r.P(br(Be.x),Be.y)),ke=ke.map(Be=>new r.P(br(Be.x),Be.y));const Ie=[...Se];Ie.length===0&&Ie.push(ke[ke.length-1]);const Ue=r.af(Ie[Ie.length-1].y,(ke.length===0?Se[0]:ke[0]).y,pe);let Le;return Le=Q?[new r.P(0,Ue),new r.P(0,0),new r.P(1,0),new r.P(1,Ue)]:[new r.P(1,Ue),new r.P(1,1),new r.P(0,1),new r.P(0,Ue)],Ie.push(...Le),ke.length===0?Ie.push(Se[0]):Ie.push(...ke),{polygon:Ie.map(Be=>new r.aa(Be.x,Be.y)),unwrapped:!1}}(t,n);if(d)return d;const y=function(b,T){let D=!1,F=-1/0,V=0;for(let H=0;H<b.length-1;H++)b[H].x>F&&(F=b[H].x,V=H);for(let H=0;H<b.length-1;H++){const W=(V+H)%(b.length-1),Q=b[W],ce=b[W+1];Math.abs(Q.x-ce.x)>.5&&(Q.x<ce.x?(Q.x+=1,W===0&&(b[b.length-1].x+=1)):(ce.x+=1,W+1===b.length-1&&(b[0].x+=1)),D=!0)}const j=r.at(T.center.lng);return D&&j<Math.abs(j-1)&&b.forEach(H=>{H.x-=1}),{polygon:b,unwrapped:D}}(dr(t,n).map(b=>new r.P(br(b.x),b.y)),n);return{polygon:y.polygon.map(b=>new r.aa(b.x,b.y)),unwrapped:y.unwrapped}}}function dr(u,t){return r.av(u,n=>{const d=t.pointCoordinate3D(n);n.x=d.x,n.y=d.y},1/256)}function br(u){return u<0?1+u%1:u%1}function sr(u){return 100*u|0}function wr(u,t,n,d,y){const b=function(D,F){if(D)return y(D);if(F){if(u.url&&F.tiles&&u.tiles&&delete u.tiles,F.variants){if(!Array.isArray(F.variants))return y(new Error("variants must be an array"));for(const j of F.variants){if(j==null||typeof j!="object"||j.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(j.capabilities))return y(new Error("capabilities must be an array"));if(j.capabilities.length===1&&j.capabilities[0]==="meshopt"){F=r.l(F,j);break}}}const V=r.ay(r.l({},F,u),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);V.tiles=t.canonicalizeTileset(V,u.url),y(null,V)}},T=function(D,F,V){if(!D)return null;if(!F&&!V)return D;V=V||D.worldview_default;const j=Object.values(D.language||{});if(j.length===0)return null;const H=Object.values(D.worldview||{});if(H.length===0)return null;const W=j.every(ce=>ce===F),Q=H.every(ce=>ce===V);return W&&Q?D:F in(D.language_options||{})||V in(D.worldview_options||{})?null:D.language_options&&D.worldview_options?D:null}(u.data,n,d);return T?r.q.frame(()=>b(null,T)):u.url?r.n(t.transformRequest(t.normalizeSourceURL(u.url,null,n,d),r.R.Source),b):r.q.frame(()=>{const{data:D,...F}=u;b(null,F)})}class Pr{constructor(t,n,d){this.bounds=r.az.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),d=Math.floor(r.at(this.bounds.getWest())*n),y=Math.floor(r.aA(this.bounds.getNorth())*n),b=Math.ceil(r.at(this.bounds.getEast())*n),T=Math.ceil(r.aA(this.bounds.getSouth())*n);return t.x>=d&&t.x<b&&t.y>=y&&t.y<T}}class Bn extends r.E{constructor(t,n,d,y){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.l(this,r.ay(n,["url","scheme","tileSize","promoteId"])),this._options=r.l({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new r.aB}load(t){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=wr(this._options,this.map._requestManager,n,d,(y,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new r.y(y));else if(b){if(r.l(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of b.vector_layers)this.vectorLayerIds.push(T.id),b.worldview&&b.worldview[T.source]&&this.localizableLayerIds.add(T.id)}b.bounds&&(this.tileBounds=new Pr(b.bounds,this.minzoom,this.maxzoom)),Wi(b.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(y)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}loadTile(t,n){const d=t.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(d),b=this.map._requestManager.transformRequest(y,r.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,D=T?{image:T.image.clone()}:null,F={request:b,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:D,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&r.f(d)&&(F.worldview=this.map.getWorldview()||this.worldviewDefault,F.localizableLayerIds=this.localizableLayerIds),F.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",F,V.bind(this));else if(t.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",F,V.bind(this),void 0,!0);else{const j=r.aD.call({deduped:this._deduped},F,(H,W)=>{H||!W?V.call(this,H):(F.data={cacheControl:W.cacheControl,expires:W.expires,rawData:W.rawData.slice(0)},t.actor&&t.actor.send("loadTile",F,V.bind(this),void 0,!0))},!0);t.request={cancel:j}}function V(j,H){return delete t.request,t.aborted?n(null):j&&j.status!==404?n(j):(H&&H.resourceTiming&&(t.resourceTiming=H.resourceTiming),this.map._refreshExpiredTiles&&H&&t.setExpiryData(H),t.loadVectorData(H,this.map.painter),r.aE(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,n){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ia extends r.E{constructor(t,n,d,y){super(),this.id=t,this.dispatcher=d,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.l({type:"raster"},n),r.l(this,r.ay(n,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._tileJSONRequest=wr(this._options,this.map._requestManager,null,null,(n,d)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new r.y(n)):d&&(r.l(this,d),d.raster_layers&&(this.rasterLayers=d.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),d.bounds&&(this.tileBounds=new Pr(d.bounds,this.minzoom,this.maxzoom)),Wi(d.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const d=r.q.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);t.request=r.o(this.map._requestManager.transformRequest(y,r.R.Tile),(b,T,D,F)=>(delete t.request,t.aborted?(t.state="unloaded",n(null)):b?(t.state="errored",n(b)):T?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:D,expires:F}),t.setTexture(T,this.map.painter),t.state="loaded",r.aE(this.dispatcher),void n(null)):n(null)))}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n&&n()}unloadTile(t,n){t.texture&&t.texture instanceof r.T?(t.destroy(!0),t.texture&&t.texture instanceof r.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),n&&n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class is extends Ia{constructor(t,n,d,y){super(t,n,d,y),this.type="raster-array",this.maxzoom=22,this._options=r.l({type:"raster-array"},n)}triggerRepaint(t){const n=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);n&&n.enabled&&d&&n._clearRenderCacheForTile(d.id,t.tileID),this.map.triggerRepaint()}loadTile(t,n){const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(d,r.R.Tile);t.requestParams=y,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,(b,T,D,F)=>{if(delete t.request,t.aborted)return t.state="unloaded",n(null);if(b)return b.code===20?void 0:(t.state="errored",n(b));this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:D,expires:F}),t.state="empty",n(null)})}unloadTile(t,n){const d=t.texture;d&&d instanceof r.T?(t.destroy(!0),this.map.painter.saveTileTexture(d)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,n,d){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(n,d,(y,b)=>{if(y)return t.state="errored",this.fire(new r.y(y)),void this.triggerRepaint(t);b&&(t.setTexture(b,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const n=this.rasterLayers.find(({id:b})=>b===t),d=n&&n.fields,y=d&&d.bands&&d.bands;return y?y[0]:0}getTextureDescriptor(t,n,d){if(!t)return;const y=n.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let b=null;n instanceof r.aH?b=n.paint.get("raster-array-band"):n instanceof r.aI&&(b=n.paint.get("raster-particle-array-band"));const T=b||this.getInitialBand(y);if(T!=null)if(t.textureDescriptor){if(!t.updateNeeded(y,T)||d)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,y,T)}}const Nn={vector:Bn,raster:Ia,"raster-dem":class extends Ia{constructor(u,t,n,d){super(u,t,n,d),this.type="raster-dem",this.maxzoom=22,this._options=r.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(u,t){const n=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(y,b){y&&(u.state="errored",t(y)),b&&(u.dem=b,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",t(null))}u.request=r.o(this.map._requestManager.transformRequest(n,r.R.Tile),(function(y,b,T,D){if(delete u.request,u.aborted)u.state="unloaded",t(null);else if(y)u.state="errored",t(y);else if(b){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:T,expires:D});const F=ImageBitmap&&b instanceof ImageBitmap&&r.t(),V=1-(b.width-r.aF(b.width))/2;V<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const j=F?b:r.q.getImageData(b,V),H={uid:u.uid,coord:u.tileID,source:this.id,scope:this.scope,rawImageData:j,encoding:this.encoding,padding:V};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",H,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(u){const t=u.canonical,n=Math.pow(2,t.z),d=(t.x-1+n)%n,y=t.x===0?u.wrap-1:u.wrap,b=(t.x+1+n)%n,T=t.x+1===n?u.wrap+1:u.wrap,D={};return D[new r.aG(u.overscaledZ,y,t.z,d,t.y).key]={backfilled:!1},D[new r.aG(u.overscaledZ,T,t.z,b,t.y).key]={backfilled:!1},t.y>0&&(D[new r.aG(u.overscaledZ,y,t.z,d,t.y-1).key]={backfilled:!1},D[new r.aG(u.overscaledZ,u.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},D[new r.aG(u.overscaledZ,T,t.z,b,t.y-1).key]={backfilled:!1}),t.y+1<n&&(D[new r.aG(u.overscaledZ,y,t.z,d,t.y+1).key]={backfilled:!1},D[new r.aG(u.overscaledZ,u.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},D[new r.aG(u.overscaledZ,T,t.z,b,t.y+1).key]={backfilled:!1}),D}},"raster-array":is,geojson:class extends r.E{constructor(u,t,n,d){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(d),this._data=t.data,this._options=r.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const y=r.ag/this.tileSize;this.workerOptions=r.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*y,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*y,extent:r.ag,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:r.ag,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*y,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}updateData(u){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof u!="string"&&(u.type==="Feature"&&(u={type:"FeatureCollection",features:[u]}),u.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof u!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const n of this._data.features)t.set(n.id,n);for(const n of u.features)t.set(n.id,n);this._data.features=[...t.values()]}else this._data=u;return this._updateWorkerData(!0),this}getClusterExpansionZoom(u,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterChildren(u,t){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterLeaves(u,t,n,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:u,limit:t,offset:n},d),this}_updateWorkerData(u=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=r.l({append:u},this.workerOptions);t.scope=this.scope;const n=this._data;typeof n=="string"?(t.request=this.map._requestManager.transformRequest(r.q.resolveURL(n),r.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(d,y)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new r.y(d));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(b.resourceTiming=y.resourceTiming[this.id]),u&&(this._partialReload=!0),this.fire(new r.z("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(u),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const u=r.aC(this.id,this.scope);this.map.style.clearSource(u),this._updateWorkerData()}loadTile(u,t){const n=u.actor?"reloadTile":"loadTile";u.actor=this.actor;const d=this.map.style?this.map.style.getLut(this.scope):null,y=d?{image:d.image.clone()}:null,b=this._partialReload,T={type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:b};u.request=this.actor.send(n,T,(D,F)=>b&&!F?(u.state="loaded",t(null)):(delete u.request,u.destroy(),u.aborted?t(null):D?t(D):(u.loadVectorData(F,this.map.painter,n==="reloadTile"),t(null))),void 0,n==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u,t){this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope}),u.destroy()}onRemove(u){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aJ{constructor(u,t,n,d){super(u,t,n,d),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const t of u.urls)this.urls.push(this.map._requestManager.transformRequest(t,r.R.Source).url);r.aK(this.urls,(t,n)=>{this._loaded=!0,t?this.fire(new r.y(t)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const t=this.video.seekable;u<t.start(0)||u>t.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,t=u.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(u,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aJ,model:class extends r.E{constructor(u,t,n,d){super(),this.id=u,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const u=[];for(const t in this._options.models){const n=this._options.models[t],d=r.aM(this.map._requestManager.transformRequest(n.uri,r.R.Model).url).then(y=>{if(!y)return;const b=r.aN(y),T=new r.aO(t,n.position,n.orientation,b);T.computeBoundsAndApplyParent(),this.models.push(T)}).catch(y=>{this.fire(new r.y(new Error(`Could not load model ${t} from ${n.uri}: ${y.message}`)))});u.push(d)}return Promise.allSettled(u).then(()=>{this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new r.y(new Error(`Could not load models: ${t.message}`)))})}onAdd(u){this.map=u,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(u,t){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(u,t,n,d){super(),this.type="batched-model",this.id=u,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest();const u=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(u))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(u){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=wr(this._options,this.map._requestManager,t,n,(d,y)=>{this._tileJSONRequest=null,this._loaded=!0,d?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),n&&n.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new r.y(d))):y&&(r.l(this,y),y.bounds&&(this.tileBounds=new Pr(y.bounds,this.minzoom,this.maxzoom)),Wi(y.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),u&&u(d)})}hasTransition(){return!1}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loaded(){return this._loaded}loadTile(u,t){const n=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(n,r.R.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:u.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(u.actor&&u.state!=="expired")if(u.state==="loading")u.reloadCallback=t;else{if(u.buckets){const b=Object.values(u.buckets);for(const T of b)T.dirty=!0;return void(u.state="loaded")}u.request=u.actor.send("reloadTile",d,y.bind(this))}else u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",d,y.bind(this),void 0,!0);function y(b,T){return u.aborted?t(null):b&&b.status!==404?t(b):(this.map._refreshExpiredTiles&&T&&u.setExpiryData(T),u.loadModelData(T,this.map.painter),u.state="loaded",void t(null))}}serialize(){return r.l({},this._options)}},canvas:class extends r.aJ{constructor(u,t,n,d){super(u,t,n,d),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(b=>typeof b!="number"))||this.fire(new r.y(new r.V(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${u}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${u}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(u){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!u&&!this._playing||this.texture instanceof r.aL||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends r.E{constructor(u,t,n,d){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=t,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Pr(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),r.l(this,r.ay(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ay(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this.map=u,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:t,y:n,z:d}=u.canonical;return this._implementation.hasTile({x:t,y:n,z:d})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,t){const{x:n,y:d,z:y}=u.tileID.canonical,b=new AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:n,y:d,z:y},{signal:b.signal})).then((function(T){return delete u.request,u.aborted?(u.state="unloaded",t(null)):T===void 0?(u.state="errored",t(null)):T===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",t(null)):function(D){return D instanceof ImageData||D instanceof HTMLCanvasElement||D instanceof ImageBitmap||D instanceof HTMLImageElement}(T)?(this.loadTileData(u,T),u.state="loaded",void t(null)):(u.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.code!==20&&(u.state="errored",t(T))}),u.request.cancel=()=>b.abort()}loadTileData(u,t){u.setTexture(t,this.map.painter)}unloadTile(u,t){if(u.texture&&u.texture instanceof r.T?(u.destroy(!0),u.texture&&u.texture instanceof r.T&&this.map.painter.saveTileTexture(u.texture)):u.destroy(),this._implementation.unloadTile){const{x:n,y:d,z:y}=u.tileID.canonical;this._implementation.unloadTile({x:n,y:d,z:y})}t&&t()}abortTile(u,t){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){const u=r.aC(this.id,this.scope);this.map.style.clearSource(u)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},$s=function(u,t,n,d){const y=new Nn[t.type](u,t,n,d);if(y.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${y.id}`);return r.aP(["load","abort","unload","serialize","prepare"],y),y};function Gc(u,t,n=""){return`${n}:${t.id||""}:${t.layer.id}:${function(d){if("layerId"in d)return`layer:${d.layerId}`;{const{featuresetId:y,importId:b}=d;return`featureset:${y}${b?`:import:${b}`:""}`}}(u.target)}`}function Wo(u,t,n,d=""){if(u.uniqueFeatureID){const y=Gc(u,t,d);if(n.has(y))return!0;n.add(y)}return!1}function Hc(u,t,n,d,y=!1){const b=t.sourceCache.transform,T=t.sourceCache.tilesIn(u,t.has3DLayers,y);T.sort(Hd);const D=[];for(const F of T){const V=F.tile.queryRenderedFeatures(t,F,n,d,b,y);Object.keys(V).length&&D.push({wrappedTileID:F.tile.tileID.wrapped().key,queryResults:V})}return D.length===0?{}:function(F){const V={},j={};for(const H of F){const W=H.queryResults,Q=H.wrappedTileID,ce=j[Q]=j[Q]||{};for(const oe in W){const de=W[oe],pe=ce[oe]=ce[oe]||{},Se=V[oe]=V[oe]||[];for(const ke of de)pe[ke.featureIndex]||(pe[ke.featureIndex]=!0,Se.push(ke))}}return V}(D)}function Po(u,t,n,d,y){const b={},T=d.queryRenderedSymbols(u),D=[];for(const F of Object.keys(T).map(Number))D.push(y[F]);D.sort(Hd);for(const F of D){const V=F.featureIndex.lookupSymbolFeatures(T[F.bucketInstanceId],F.bucketIndex,F.sourceLayerIndex,t,n);for(const j in V){const H=b[j]=b[j]||[],W=V[j];W.sort((Q,ce)=>{const oe=F.featureSortOrder;if(oe){const de=oe.indexOf(Q.featureIndex);return oe.indexOf(ce.featureIndex)-de}return ce.featureIndex-Q.featureIndex});for(const Q of W)H.push(Q)}}return b}function Wc(u,t){const n=u.getRenderableIds().map(b=>u.getTileByID(b)),d=[],y={};for(let b=0;b<n.length;b++){const T=n[b],D=T.tileID.canonical.key;y[D]||(y[D]=!0,T.querySourceFeatures(d,t))}return d}function Hd(u,t){const n=u.tileID,d=t.tileID;return n.overscaledZ-d.overscaledZ||n.canonical.y-d.canonical.y||n.wrap-d.wrap||n.canonical.x-d.canonical.x}function Wd(u,t){const n={};if(!t)return n;for(const d of u){const y=d.layerIds.map(b=>t.getLayer(b)).filter(Boolean);if(y.length!==0){d.layers=y,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(b=>y.filter(T=>T.id===b)[0]));for(const b of y)n[b.fqid]=d}}return n}const Ks=32,Io=33,qo=new Uint16Array(8184);for(let u=0;u<2046;u++){let t=u+2,n=0,d=0,y=0,b=0,T=0,D=0;for(1&t?y=b=T=Ks:n=d=D=Ks;(t>>=1)>1;){const V=n+y>>1,j=d+b>>1;1&t?(y=n,b=d,n=T,d=D):(n=y,d=b,y=T,b=D),T=V,D=j}const F=4*u;qo[F+0]=n,qo[F+1]=d,qo[F+2]=y,qo[F+3]=b}const Da=new Uint16Array(2178),sa=new Uint8Array(1089),oa=new Uint16Array(1089);function Wu(u){return u===0?-.03125:u===32?.03125:0}const ml={type:2,extent:r.ag,loadGeometry:()=>[[new r.P(0,0),new r.P(r.ag+1,0),new r.P(r.ag+1,r.ag+1),new r.P(0,r.ag+1),new r.P(0,0)]]};class gl{constructor(t,n,d,y,b){this.tileID=t,this.uid=r.aV(),this.uses=0,this.tileSize=n,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection)}registerFadeDuration(t){const n=t+this.timeAdded;n<r.q.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aQ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,d){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Wd(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const b=this.buckets[y];if(b instanceof r.aX){if(this.hasSymbolBuckets=!0,!d)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const b=this.buckets[y];if(b instanceof r.aX&&b.hasRTLText){this.hasRTLText=!0,r.aY();break}}this.queryPadding=0;for(const y in this.buckets){const b=this.buckets[y],T=n.style.getOwnLayer(y);if(!T)continue;const D=T.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,D)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new r.aW}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,n,d){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Wd(t.buckets,n.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const y in this.buckets){const b=this.buckets[y];b.uploadPending()&&b.upload(t)}const n=t.gl,d=this.imageAtlas;if(d&&!d.uploaded){const y=!!Object.keys(d.patternPositions).length;this.imageAtlasTexture=new r.T(t,d.image,n.RGBA8,{useMipmap:y}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(t,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(t,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(t,n,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,d),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=n.style.getBrightness();(this._lastUpdatedBrightness||y)&&(this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(n,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}queryRenderedFeatures(t,n,d,y,b,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const D=function(F,V){const j=r.ab.mat4.fromScaling([],[.5*F.width,.5*-F.height,1]);return r.ab.mat4.translate(j,j,[1,-1,0]),r.ab.mat4.multiply(j,j,F.calculateProjMatrix(V.toUnwrapped())),Float32Array.from(j)}(b,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:n,pixelPosMatrix:D,transform:y,availableImages:d,tileTransform:this.tileTransform})}querySourceFeatures(t,n){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const y=d.loadVTLayers(),b=n?n.sourceLayer:"",T=y._geojsonTileLayer||y[b];if(!T)return;const D=r.aZ(n&&n.filter),{z:F,x:V,y:j}=this.tileID.canonical,H={z:F,x:V,y:j};for(let W=0;W<T.length;W++){const Q=T.feature(W);if(D.needGeometry){const de=r.a_(Q,!0);if(!D.filter(new r.a8(this.tileID.overscaledZ),de,this.tileID.canonical))continue}else if(!D.filter(new r.a8(this.tileID.overscaledZ),Q))continue;const ce=d.getId(Q,b),oe=new r.a$(Q,F,V,j,ce);oe.tile=H,t.push(oe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const d=r.b0(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const d=Date.now();let y=!1;if(this.expirationTime>d)y=!1;else if(n)if(this.expirationTime<n)y=!0;else{const b=this.expirationTime-n;b?this.expirationTime=d+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,n){if(!this.latestFeatureIndex||!t.style)return;const d=this.latestFeatureIndex.loadVTLayers(),y=t.style.listImages(),b=t.style.getBrightness();for(const T in this.buckets){if(!t.style.hasLayer(T))continue;const D=this.buckets[T],F=D.layers[0],V=F.sourceLayer||"_geojsonTileLayer",j=d[V],H=t.style.getLayerSourceCache(F);let W={};H&&(W=H._state.getState(V,void 0));const Q=this.imageAtlas&&this.imageAtlas.patternPositions||{},ce=Object.keys(W).length>0&&!n;ce&&!D.stateDependentLayers.length&&!n||D.update(W,j,y,Q,ce?D.stateDependentLayers:D.layers,n,b),(D instanceof r.b1||D instanceof r.b2)&&t._terrain&&t._terrain.enabled&&H&&D.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(H.id,this.tileID);const oe=t&&t.style&&t.style.getOwnLayer(T);oe&&(this.queryPadding=Math.max(this.queryPadding,oe.queryRadius(D)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=r.q.now()+t}setTexture(t,n){const d=n.context,y=d.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t):(this.texture=new r.T(d,t,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(t,n){const d={};for(const y of n)d[y]=!0;this.dependencies[t]=d}hasDependency(t,n){for(const d of t){const y=this.dependencies[d];if(y){for(const b of n)if(y[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const d=r.b3(ml,this.tileID.canonical,this.tileTransform)[0],y=new r.b4,b=new r.b5;for(let T=0;T<d.length;T++){const{x:D,y:F}=d[T];y.emplaceBack(D,F),b.emplaceBack(T)}b.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(b),this._tileDebugBuffer=t.createVertexBuffer(y,r.b6.members),this._tileDebugSegments=r.b7.simpleSegment(0,0,y.length,b.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const d=r.b3(ml,this.tileID.canonical,this.tileTransform)[0];let y,b;if(this.isRaster){const T=function(D,F){const V=r.aQ(D,F),j=Math.pow(2,D.z);for(let de=0;de<Io;de++)for(let pe=0;pe<Io;pe++){const Se=r.aR((D.x+(pe+Wu(pe))/Ks)/j),ke=r.aS((D.y+(de+Wu(de))/Ks)/j),Ie=F.project(Se,ke),Ue=de*Io+pe;Da[2*Ue+0]=Math.round((Ie.x*V.scale-V.x)*r.ag),Da[2*Ue+1]=Math.round((Ie.y*V.scale-V.y)*r.ag)}sa.fill(0),oa.fill(0);for(let de=2045;de>=0;de--){const pe=4*de,Se=qo[pe+0],ke=qo[pe+1],Ie=qo[pe+2],Ue=qo[pe+3],Le=Se+Ie>>1,Be=ke+Ue>>1,Oe=Le+Be-ke,He=Be+Se-Le,Qe=ke*Io+Se,xt=Ue*Io+Ie,ut=Be*Io+Le,It=Math.hypot((Da[2*Qe+0]+Da[2*xt+0])/2-Da[2*ut+0],(Da[2*Qe+1]+Da[2*xt+1])/2-Da[2*ut+1])>=16;sa[ut]=sa[ut]||(It?1:0),de<1022&&(sa[ut]=sa[ut]||sa[(ke+He>>1)*Io+(Se+Oe>>1)]||sa[(Ue+He>>1)*Io+(Ie+Oe>>1)])}const H=new r.aT,W=new r.aU;let Q=0;function ce(de,pe){const Se=pe*Io+de;return oa[Se]===0&&(H.emplaceBack(Da[2*Se+0],Da[2*Se+1],de*r.ag/Ks,pe*r.ag/Ks),oa[Se]=++Q),oa[Se]-1}function oe(de,pe,Se,ke,Ie,Ue){const Le=de+Se>>1,Be=pe+ke>>1;if(Math.abs(de-Ie)+Math.abs(pe-Ue)>1&&sa[Be*Io+Le])oe(Ie,Ue,de,pe,Le,Be),oe(Se,ke,Ie,Ue,Le,Be);else{const Oe=ce(de,pe),He=ce(Se,ke),Qe=ce(Ie,Ue);W.emplaceBack(Oe,He,Qe)}}return oe(0,0,Ks,Ks,Ks,0),oe(Ks,Ks,0,0,0,Ks),{vertices:H,indices:W}}(this.tileID.canonical,n);y=T.vertices,b=T.indices}else{y=new r.aT,b=new r.aU;for(const{x:D,y:F}of d)y.emplaceBack(D,F,0,0);const T=r.b8(y.int16,void 0,4);for(let D=0;D<T.length;D+=3)b.emplaceBack(T[D],T[D+1],T[D+2])}this._tileBoundsBuffer=t.createVertexBuffer(y,r.b9.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(b),this._tileBoundsSegments=r.b7.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugBuffers(t,n){const d=n.projection;if(!d||d.name!=="globe"||n.freezeTileCoverage)return;const y=this.tileID.canonical,b=r.ba(y,n),T=r.bb(b),D=r.ae(n.zoom);let F;D>0&&(F=r.ab.mat4.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,y,n,T,F,D),this._makeGlobeTileDebugTextBuffer(t,y,n,T,F,D)}_globePoint(t,n,d,y,b,T,D){let F=r.bc(t,n,d);if(T){const V=1<<d.z,j=r.at(y.center.lng),H=r.aA(y.center.lat),W=(d.x+.5)/V-j;let Q=0;W>.5?Q=-1:W<-.5&&(Q=1);let ce=(t/r.ag+d.x)/V+Q,oe=(n/r.ag+d.y)/V;ce=(ce-j)*y._pixelsPerMercatorPixel+j,oe=(oe-H)*y._pixelsPerMercatorPixel+H;const de=[ce*y.worldSize,oe*y.worldSize,0];r.ab.vec3.transformMat4(de,de,T),F=r.bd(F,de,D)}return r.ab.vec3.transformMat4(F,F,b)}_makeGlobeTileDebugBorderBuffer(t,n,d,y,b,T){const D=new r.b4,F=new r.b5,V=new r.be,j=(W,Q,ce,oe,de)=>{const pe=(ce-W)/(de-1),Se=(oe-Q)/(de-1),ke=D.length;for(let Ie=0;Ie<de;Ie++){const Ue=W+Ie*pe,Le=Q+Ie*Se;D.emplaceBack(Ue,Le);const Be=this._globePoint(Ue,Le,n,d,y,b,T);V.emplaceBack(Be[0],Be[1],Be[2]),F.emplaceBack(ke+Ie)}},H=r.ag;j(0,0,H,0,16),j(H,0,H,H,16),j(H,H,0,H,16),j(0,H,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(F),this._tileDebugBuffer=t.createVertexBuffer(D,r.b6.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(V,r.bf.members),this._tileDebugSegments=r.b7.simpleSegment(0,0,D.length,F.length)}_makeGlobeTileDebugTextBuffer(t,n,d,y,b,T){const D=r.ag/4,F=new r.b4,V=new r.aU,j=new r.be,H=25;V.reserve(32),F.reserve(H),j.reserve(H);const W=(Q,ce)=>H*Q+ce;for(let Q=0;Q<H;Q++){const ce=Q*D;for(let oe=0;oe<H;oe++){const de=oe*D;F.emplaceBack(de,ce);const pe=this._globePoint(de,ce,n,d,y,b,T);j.emplaceBack(pe[0],pe[1],pe[2])}}for(let Q=0;Q<4;Q++)for(let ce=0;ce<4;ce++){const oe=W(Q,ce),de=W(Q,ce+1),pe=W(Q+1,ce),Se=W(Q+1,ce+1);V.emplaceBack(oe,de,pe),V.emplaceBack(pe,de,Se)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(V),this._tileDebugTextBuffer=t.createVertexBuffer(F,r.b6.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(j,r.bf.members),this._tileDebugTextSegments=r.b7.simpleSegment(0,0,H,32)}destroy(t=!1){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bg.setPbf(r.bh);class aa extends gl{constructor(t,n,d,y,b){super(t,n,d,y,b),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,n){const d=n.context,y=d.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t,{premultiply:!1}):this.texture=new r.T(d,t,y.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,n){const d=this._mrt=new r.bg(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=r.bi(y,(b,T,D,F)=>{if(b)n(b);else try{const V=d.getHeaderLength(T);if(V>t)return void(this.request=this.fetchHeader(V,n));d.parseHeader(T),this._isHeaderLoaded=!0;let j=0;for(const H of Object.values(d.layers))j=Math.max(j,H.dataIndex[H.dataIndex.length-1].last_byte);T.byteLength>=j&&(this.entireBuffer=T),n(null,this.entireBuffer||T,D,F)}catch(V){n(V)}}),this.request}fetchBand(t,n,d){const y=this._mrt;if(!this._isHeaderLoaded||!y)return void d(new Error("Tile header is not ready"));const b=this.actor;if(!b)return void d(new Error("Can't fetch tile band without an actor"));let T;const D=(H,W)=>{T.complete(H,W),H?d(H):(this.updateTextureDescriptor(t,n),d(null,this.textureDescriptor&&this.textureDescriptor.img))},F=(H,W)=>{if(H)return d(H);const Q=b.send("decodeRasterArray",{buffer:W,task:T},D,void 0,!0);this._workQueue.push(()=>{Q&&Q.cancel(),T.cancel()})},V=y.getLayer(t);if(!V)return void d(new Error(`Unknown sourceLayer "${t}"`));if(V.hasDataForBand(n))return this.updateTextureDescriptor(t,n),void d(null,this.textureDescriptor?this.textureDescriptor.img:null);const j=V.getDataRange([n]);if(T=y.createDecodingTask(j),!T||T.tasks.length)if(this.flushQueues(),this.entireBuffer)F(null,this.entireBuffer.slice(j.firstByte,j.lastByte+1));else{const H=Object.assign({},this.requestParams,{headers:{Range:`bytes=${j.firstByte}-${j.lastByte}`}}),W=r.bi(H,F);this._fetchQueue.push(()=>{W.cancel(),T.cancel()})}else d(null)}updateNeeded(t,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,n){if(!this._mrt)return;const d=this._mrt.getLayer(t);if(!d||!d.hasBand(n)||!d.hasDataForBand(n))return;const{bytes:y,tileSize:b,buffer:T,offset:D,scale:F}=d.getBandView(n),V=b+2*T,j={data:y,width:V,height:V},H=this.texture;H&&H instanceof r.T&&H.update(j,{premultiply:!1}),this.textureDescriptor={layer:t,band:n,img:j,buffer:T,offset:D,tileSize:b,format:d.pixelFormat,mix:[F,256*F,65536*F,16777216*F]}}}class gf{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,d){const y=t.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const b={value:n,timeout:void 0};if(d!==void 0&&(b.timeout=setTimeout(()=>{this.remove(t,b)},d)),this.data[y].push(b),this.order.push(y),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const d=t.wrapped().key,y=n===void 0?0:this.data[d].indexOf(n),b=this.data[d][y];return this.data[d].splice(y,1),b.timeout&&clearTimeout(b.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(b.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const d in this.data)for(const y of this.data[d])t(y.value)||n.push(y);for(const d of n)this.remove(d.value.tileID,d)}}class qd{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,d){const y=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][y]=this.stateChanges[t][y]||{},r.l(this.stateChanges[t][y],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(const b in this.state[t])b!==y&&(this.deletedStates[t][b]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][y]===null){this.deletedStates[t][y]={};for(const b in this.state[t][y])d[b]||(this.deletedStates[t][y][b]=null)}else for(const b in d)this.deletedStates[t]&&this.deletedStates[t][y]&&this.deletedStates[t][y][b]===null&&delete this.deletedStates[t][y][b]}removeFeatureState(t,n,d){if(this.deletedStates[t]===null)return;const y=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&n!==void 0)this.deletedStates[t][y]!==null&&(this.deletedStates[t][y]=this.deletedStates[t][y]||{},this.deletedStates[t][y][d]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][y])for(d in this.deletedStates[t][y]={},this.stateChanges[t][y])this.deletedStates[t][y][d]=null;else this.deletedStates[t][y]=null;else this.deletedStates[t]=null}getState(t,n){const d=this.state[t]||{},y=this.stateChanges[t]||{},b=this.deletedStates[t];if(b===null)return{};if(n!==void 0){const D=String(n),F=r.l({},d[D],y[D]);if(b){const V=b[n];if(V===null)return{};for(const j in V)delete F[j]}return F}const T=r.l({},d,y);if(b)for(const D in b)delete T[D];return T}initializeTileState(t,n){t.refreshFeatureState(n)}coalesceChanges(t,n){const d={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const b={};for(const T in this.stateChanges[y])this.state[y][T]||(this.state[y][T]={}),r.l(this.state[y][T],this.stateChanges[y][T]),b[T]=this.state[y][T];d[y]=b}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const b={};if(this.deletedStates[y]===null)for(const T in this.state[y])b[T]={},this.state[y][T]={};else for(const T in this.deletedStates[y]){if(this.deletedStates[y][T]===null)this.state[y][T]={};else if(this.state[y][T])for(const D of Object.keys(this.deletedStates[y][T]))delete this.state[y][T][D];b[T]=this.state[y][T]}d[y]=d[y]||{},r.l(d[y],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const y in t)t[y].refreshFeatureState(n)}}class Yo extends r.E{constructor(t,n,d){super(),this.id=t,this._onlySymbols=d,n.on("data",y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new gf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new qd,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,n){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const d=this._tiles[n];d.upload(t),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return r.bj(this._tiles).map(t=>t.tileID).sort(Ar).map(t=>t.key)}getRenderableIds(t,n){const d=[];for(const y in this._tiles)this._isIdRenderable(+y,t,n)&&d.push(this._tiles[y]);return t?d.sort((y,b)=>{const T=y.tileID,D=b.tileID,F=new r.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),V=new r.P(D.canonical.x,D.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-D.overscaledZ||V.y-F.y||V.x-F.x}).map(y=>y.tileID.key):d.map(y=>y.tileID).sort(Ar).map(y=>y.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n,d){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())&&(d||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,n){const d=this._tiles[t];d&&(d.state!=="loading"&&(d.state=n),this._loadTile(d,this._tileLoaded.bind(this,d,t,n)))}_tileLoaded(t,n,d,y){if(y)if(t.state="errored",y.status!==404)this._source.fire(new r.y(y,{tile:t}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=r.q.now(),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new r.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const n=this.getRenderableIds();for(let y=0;y<n.length;y++){const b=n[y];if(t.neighboringTiles&&t.neighboringTiles[b]){const T=this.getTileByID(b);d(t,T),d(T,t)}}function d(y,b){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let T=b.tileID.canonical.x-y.tileID.canonical.x;const D=b.tileID.canonical.y-y.tileID.canonical.y,F=Math.pow(2,y.tileID.canonical.z),V=b.tileID.key;T===0&&D===0||Math.abs(D)>1||(Math.abs(T)>1&&(Math.abs(T+F)===1?T+=F:Math.abs(T-F)===1&&(T-=F)),b.dem&&y.dem&&(y.dem.backfillBorder(b.dem,T,D),y.neighboringTiles&&y.neighboringTiles[V]&&(y.neighboringTiles[V].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,d,y){for(const b in this._tiles){let T=this._tiles[b];if(y[b]||!T.hasData()||T.tileID.overscaledZ<=n||T.tileID.overscaledZ>d)continue;let D=T.tileID;for(;T&&T.tileID.overscaledZ>n+1;){const V=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[V.key],T&&T.hasData()&&(D=V)}let F=D;for(;F.overscaledZ>n;)if(F=F.scaledTo(F.overscaledZ-1),t[F.key]){y[D.key]=D;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const d=this._loadedParentTiles[t.key];return d&&d.tileID.overscaledZ>=n?d:null}for(let d=t.overscaledZ-1;d>=n;d--){const y=t.scaledTo(d),b=this._getLoadedTile(y);if(b)return b}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,n){n=n||this._source.tileSize;const d=Math.ceil(t.width/n)+1,y=Math.ceil(t.height/n)+1,b=Math.floor(d*y*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,D=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(D)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const d={};for(const y in this._tiles){const b=this._tiles[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+n),d[b.tileID.key]=b}this._tiles=d;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(t,n,d,y){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(t,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const b=this._source.type==="batched-model";let T,D=this._source.maxzoom;const F=this.map&&this.map.painter?this.map.painter._terrain:null;if(F&&F.sourceCache===this&&F.attenuationRange()){const H=F.attenuationRange()[0],W=Math.floor(H)-Math.log2(F.getDemUpscale());D>W&&(D=W)}if(this.used||this.usedForTerrain){if(this._source.tileID)T=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(H=>new r.aG(H.canonical.z,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y));else if(this.tileCoverLift!==0){const H=t.clone();H.tileCoverLift=this.tileCoverLift,T=H.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:D,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.minzoom<=1&&t.projection.name==="globe"&&(T.push(new r.aG(1,0,1,0,0)),T.push(new r.aG(1,0,1,1,0)),T.push(new r.aG(1,0,1,0,1)),T.push(new r.aG(1,0,1,1,1)))}else if(T=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:D,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.hasTile){const H=this._source.hasTile.bind(this._source);T=T.filter(W=>H(W))}}else T=[];if(T.length>0&&this.castsShadows&&y&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Yd(this._source.type)){const H=t.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),W=Math.min(H,this._source.maxzoom);if(b){const Q=t.extendTileCover(T,W);for(const ce of Q)T.push(ce)}else{const Q=t.extendTileCover(T,W,y);for(const ce of Q)this._shadowCasterTiles[ce.key]=!0,T.push(ce)}}const V=this._updateRetainedTiles(T);if(Yd(this._source.type)&&T.length!==0){const H={},W={},Q=Object.keys(V);for(const oe of Q){const de=V[oe],pe=this._tiles[oe];if(!pe||pe.fadeEndTime&&pe.fadeEndTime<=r.q.now())continue;const Se=this.findLoadedParent(de,Math.max(de.overscaledZ-Yo.maxOverzooming,this._source.minzoom));Se&&(this._addTile(Se.tileID),H[Se.tileID.key]=Se.tileID),W[oe]=de}const ce=T[T.length-1].overscaledZ;for(const oe in this._tiles){const de=this._tiles[oe];if(V[oe]||!de.hasData())continue;let pe=de.tileID;for(;pe.overscaledZ>ce;){pe=pe.scaledTo(pe.overscaledZ-1);const Se=this._tiles[pe.key];if(Se&&Se.hasData()&&W[pe.key]){V[oe]=de.tileID;break}}}for(const oe in H)V[oe]||(this._coveredTiles[oe]=!0,V[oe]=H[oe])}for(const H in V)this._tiles[H].clearFadeHold();const j=r.bk(this._tiles,V);for(const H of j){const W=this._tiles[H];W.hasSymbolBuckets&&!W.holdingForFade()?W.setHoldDuration(this.map._fadeDuration):W.hasSymbolBuckets&&!W.symbolFadeFinished()||this._removeTile(+H)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const n={};if(t.length===0)return n;const d={},y=t.reduce((V,j)=>Math.min(V,j.overscaledZ),1/0),b=t[0].overscaledZ,T=Math.max(b-Yo.maxOverzooming,this._source.minzoom),D=Math.max(b+Yo.maxUnderzooming,this._source.minzoom),F={};for(const V of t){const j=this._addTile(V);n[V.key]=V,j.hasData()||y<this._source.maxzoom&&(F[V.key]=V)}this._retainLoadedChildren(F,y,D,n);for(const V of t){let j=this._tiles[V.key];if(j.hasData())continue;if(V.canonical.z>=this._source.maxzoom){const W=V.children(this._source.maxzoom)[0],Q=this.getTile(W);if(Q&&Q.hasData()){n[W.key]=W;continue}}else{const W=V.children(this._source.maxzoom);if(n[W[0].key]&&n[W[1].key]&&n[W[2].key]&&n[W[3].key])continue}let H=j.wasRequested();for(let W=V.overscaledZ-1;W>=T;--W){const Q=V.scaledTo(W);if(d[Q.key]||(d[Q.key]=!0,j=this.getTile(Q),!j&&H&&(j=this._addTile(Q)),j&&(n[Q.key]=Q,H=j.wasRequested(),j.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let d,y=this._tiles[t].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){d=this._loadedParentTiles[y.key];break}n.push(y.key);const b=y.scaledTo(y.overscaledZ-1);if(d=this._getLoadedTile(b),d)break;y=b}for(const b of n)this._loadedParentTiles[b]=d}}_addTile(t){let n=this._tiles[t.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const d=!!n;if(!d){const y=this.map?this.map.painter:null,b=this._source.tileSize*t.overscaleFactor();n=this._source.type==="raster-array"?new aa(t,b,this.transform.tileZoom,y,this._isRaster):new gl(t,b,this.transform.tileZoom,y,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n?(n.uses++,this._tiles[t.key]=n,d||this._source.fire(new r.z("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const d=n.getExpiryTimeout();d&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},d))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,d){const y=[],b=this.transform;if(!b)return y;const T=b.projection.name==="globe",D=r.at(b.center.lng);for(const F in this._tiles){const V=this._tiles[F];if(d&&V.clearQueryDebugViz(),V.holdingForFade())continue;let j;if(T){const H=V.tileID.canonical;if(H.z===0){const W=[Math.abs(r.aw(D,...Ii(H,-1))-D),Math.abs(r.aw(D,...Ii(H,1))-D)];j=[0,2*W.indexOf(Math.min(...W))-1]}else{const W=[Math.abs(r.aw(D,...Ii(H,-1))-D),Math.abs(r.aw(D,...Ii(H,0))-D),Math.abs(r.aw(D,...Ii(H,1))-D)];j=[W.indexOf(Math.min(...W))-1]}}else j=[0];for(const H of j){const W=t.containsTile(V,b,n,H);W&&y.push(W)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,n){const d=this.getRenderableIds(t,n).map(b=>this._tiles[b].tileID),y=this.transform.projection.name==="globe";for(const b of d)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=y?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return d}sortCoordinatesByDistance(t){const n=t.slice(),d=this.transform._camera.position,y=this.transform._camera.forward(),b={};for(const T of n){const D=1/(1<<T.canonical.z);b[T.key]=((T.canonical.x+.5)*D+T.wrap-d[0])*y[0]+((T.canonical.y+.5)*D-d[1])*y[1]-d[2]*y[2]}return n.sort((T,D)=>b[T.key]-b[D.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(Yd(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=r.q.now())return!0}return!1}setFeatureState(t,n,d){this._state.updateState(t=t||"_geojsonTileLayer",n,d)}removeFeatureState(t,n,d){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,d)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,d){const y=this._tiles[t];y&&y.setDependencies(n,d)}reloadTilesForDependencies(t,n){for(const d in this._tiles)this._tiles[d].hasDependency(t,n)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(t,n))}_preloadTiles(t,n){if(!this._sourceLoaded){const F=()=>{this._sourceLoaded&&(this._source.off("data",F),this._preloadTiles(t,n))};return void this._source.on("data",F)}const d=new Map,y=Array.isArray(t)?t:[t],b=this.map.painter.terrain,T=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const F of y){const V=F.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const j of V)d.set(j.key,j);this.usedForTerrain&&F.updateElevation(!1)}const D=Array.from(d.values());r.bl(D,(F,V)=>{const j=new gl(F,this._source.tileSize*F.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(j,H=>{this._source.type==="raster-dem"&&j.dem&&this._backfillDEM(j),V(H,j)})},n)}}function Ar(u,t){const n=Math.abs(2*u.wrap)-+(u.wrap<0),d=Math.abs(2*t.wrap)-+(t.wrap<0);return u.overscaledZ-t.overscaledZ||d-n||t.canonical.y-u.canonical.y||t.canonical.x-u.canonical.x}function Yd(u){return u==="raster"||u==="image"||u==="video"||u==="custom"}function Ii(u,t){const n=1<<u.z;return[u.x/n+t,(u.x+1)/n+t]}Yo.maxOverzooming=10,Yo.maxUnderzooming=3;class Xd{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,n=!1;for(const d in this.style._mergedLayers){const y=this.style._mergedLayers[d];if(y.type==="fill-extrusion")this.layers.push({layer:y,visible:t,visibilityChanged:n});else if(y.type==="model"){const b=this.style.getLayerSource(y);b&&b.type==="batched-model"&&this.layers.push({layer:y,visible:t,visibilityChanged:n})}}}onNewFrame(t){this.layersGotHidden=!1;for(const n of this.layers){const d=n.layer;let y=!1;d.type==="fill-extrusion"?y=!d.isHidden(t)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="model"&&(y=!d.isHidden(t)&&d.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&n.visible,n.visible=y}}updateZOffset(t,n){this.currentBuildingBuckets=[];for(const y of this.layers){const b=y.layer,T=this.style.getLayerSourceCache(b);let D=1;b.type==="fill-extrusion"&&(D=y.visible?b.paint.get("fill-extrusion-vertical-scale"):0);let F=T?T.getTile(n):null;if(!F&&T&&n.canonical.z>T.getSource().minzoom){let V=n.scaledTo(Math.min(T.getSource().maxzoom,n.overscaledZ-1));for(;V.overscaledZ>=T.getSource().minzoom&&(F=T.getTile(V),!F&&V.overscaledZ!==0);)V=V.scaledTo(V.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:F?F.getBucket(b):null,tileID:F?F.tileID:n,verticalScale:D})}t.hasAnyZOffset=!1;let d=!1;for(let y=0;y<t.symbolInstances.length;y++){const b=t.symbolInstances.get(y),T=b.zOffset,D=this._getHeightAtTileOffset(n,b.tileAnchorX,b.tileAnchorY);b.zOffset=D!==Number.NEGATIVE_INFINITY?D:T,d||T===b.zOffset||(d=!0),t.hasAnyZOffset||b.zOffset===0||(t.hasAnyZOffset=!0)}d&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,n,d,y){let b=n,T=d;if(t.canonical.z!==y.canonical.z){const D=y.canonical,F=1/(1<<t.canonical.z-D.z);b=(n+t.canonical.x*r.ag)*F-D.x*r.ag|0,T=(d+t.canonical.y*r.ag)*F-D.y*r.ag|0}return{tileX:b,tileY:T}}_getHeightAtTileOffset(t,n,d){let y,b;for(let T=0;T<this.layers.length;++T){if(this.layers[T].layer.type!=="fill-extrusion")continue;const{bucket:D,tileID:F,verticalScale:V}=this.currentBuildingBuckets[T];if(!D)continue;const{tileX:j,tileY:H}=this._mapCoordToOverlappingTile(t,n,d,F),W=D.getHeightAtTileCoord(j,H);W&&W.height!==void 0&&(W.hidden?y=W.height:b=Math.max(W.height*V,b||0))}if(b!==void 0)return b;for(let T=0;T<this.layers.length;++T){const D=this.layers[T];if(D.layer.type!=="model"||!D.visible)continue;const{bucket:F,tileID:V}=this.currentBuildingBuckets[T];if(!F)continue;const{tileX:j,tileY:H}=this._mapCoordToOverlappingTile(t,n,d,V),W=F.getHeightAtTileCoord(j,H);if(W&&!W.hidden)return W.height===void 0&&y!==void 0?Math.min(W.maxHeight,y)*W.verticalScale:W.height?W.height*W.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Do(u,t){const n={};for(const d in u)d!=="ref"&&(n[d]=u[d]);return r.bm.forEach(d=>{d in t&&(n[d]=t[d])}),n}function Bh(u){u=u.slice();const t=Object.create(null);for(let n=0;n<u.length;n++)t[u[n].id]=u[n];for(let n=0;n<u.length;n++)"ref"in u[n]&&(u[n]=Do(u[n],t[u[n].ref]));return u}const Ji={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function qc(u,t,n){n.push({command:Ji.addSource,args:[u,t[u]]})}function Ga(u,t,n){t.push({command:Ji.removeSource,args:[u]}),n[u]=!0}function yi(u,t,n,d){Ga(u,n,d),qc(u,t,n)}function Lr(u,t,n){let d;for(d in u[n])if(u[n].hasOwnProperty(d)&&d!=="data"&&!r.bn(u[n][d],t[n][d]))return!1;for(d in t[n])if(t[n].hasOwnProperty(d)&&d!=="data"&&!r.bn(u[n][d],t[n][d]))return!1;return!0}function Sr(u,t,n,d,y,b){let T;for(T in t=t||{},u=u||{})u.hasOwnProperty(T)&&(r.bn(u[T],t[T])||n.push({command:b,args:[d,T,t[T],y]}));for(T in t)t.hasOwnProperty(T)&&!u.hasOwnProperty(T)&&(r.bn(u[T],t[T])||n.push({command:b,args:[d,T,t[T],y]}))}function Gs(u){return u.id}function ka(u,t){return u[t.id]=t,u}class Tr{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=r.aw(t,0,1);let n=1,d=this._distances[n];const y=t*this.paddedLength+this.padding;for(;d<y&&n<this._distances.length;)d=this._distances[++n];const b=n-1,T=this._distances[b],D=d-T,F=D>0?(y-T)/D:0;return this.points[b].mult(1-F).add(this.points[n].mult(F))}}class Oa{constructor(t,n,d){const y=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(n/d);for(let T=0;T<this.xCellCount*this.yCellCount;T++)y.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,d,y,b){this._forEachCell(n,d,y,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(b)}insertCircle(t,n,d,y){this._forEachCell(n-y,d-y,n+y,d+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(d),this.circles.push(y)}_insertBoxCell(t,n,d,y,b,T){this.boxCells[b].push(T)}_insertCircleCell(t,n,d,y,b,T){this.circleCells[b].push(T)}_query(t,n,d,y,b,T){if(d<0||t>this.width||y<0||n>this.height)return!b&&[];const D=[];if(t<=0&&n<=0&&this.width<=d&&this.height<=y){if(b)return!0;for(let F=0;F<this.boxKeys.length;F++)D.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const V=this.circles[3*F],j=this.circles[3*F+1],H=this.circles[3*F+2];D.push({key:this.circleKeys[F],x1:V-H,y1:j-H,x2:V+H,y2:j+H})}return T?D.filter(T):D}return this._forEachCell(t,n,d,y,this._queryCell,D,{hitTest:b,seenUids:{box:{},circle:{}}},T),b?D.length>0:D}_queryCircle(t,n,d,y,b){const T=t-d,D=t+d,F=n-d,V=n+d;if(D<0||T>this.width||V<0||F>this.height)return!y&&[];const j=[];return this._forEachCell(T,F,D,V,this._queryCellCircle,j,{hitTest:y,circle:{x:t,y:n,radius:d},seenUids:{box:{},circle:{}}},b),y?j.length>0:j}query(t,n,d,y,b){return this._query(t,n,d,y,!1,b)}hitTest(t,n,d,y,b){return this._query(t,n,d,y,!0,b)}hitTestCircle(t,n,d,y){return this._queryCircle(t,n,d,!0,y)}_queryCell(t,n,d,y,b,T,D,F){const V=D.seenUids,j=this.boxCells[b];if(j!==null){const W=this.bboxes;for(const Q of j)if(!V.box[Q]){V.box[Q]=!0;const ce=4*Q;if(t<=W[ce+2]&&n<=W[ce+3]&&d>=W[ce+0]&&y>=W[ce+1]&&(!F||F(this.boxKeys[Q]))){if(D.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Q],x1:W[ce],y1:W[ce+1],x2:W[ce+2],y2:W[ce+3]})}}}const H=this.circleCells[b];if(H!==null){const W=this.circles;for(const Q of H)if(!V.circle[Q]){V.circle[Q]=!0;const ce=3*Q;if(this._circleAndRectCollide(W[ce],W[ce+1],W[ce+2],t,n,d,y)&&(!F||F(this.circleKeys[Q]))){if(D.hitTest)return T.push(!0),!0;{const oe=W[ce],de=W[ce+1],pe=W[ce+2];T.push({key:this.circleKeys[Q],x1:oe-pe,y1:de-pe,x2:oe+pe,y2:de+pe})}}}}}_queryCellCircle(t,n,d,y,b,T,D,F){const V=D.circle,j=D.seenUids,H=this.boxCells[b];if(H!==null){const Q=this.bboxes;for(const ce of H)if(!j.box[ce]){j.box[ce]=!0;const oe=4*ce;if(this._circleAndRectCollide(V.x,V.y,V.radius,Q[oe+0],Q[oe+1],Q[oe+2],Q[oe+3])&&(!F||F(this.boxKeys[ce])))return T.push(!0),!0}}const W=this.circleCells[b];if(W!==null){const Q=this.circles;for(const ce of W)if(!j.circle[ce]){j.circle[ce]=!0;const oe=3*ce;if(this._circlesCollide(Q[oe],Q[oe+1],Q[oe+2],V.x,V.y,V.radius)&&(!F||F(this.circleKeys[ce])))return T.push(!0),!0}}}_forEachCell(t,n,d,y,b,T,D,F){const V=this._convertToXCellCoord(t),j=this._convertToYCellCoord(n),H=this._convertToXCellCoord(d),W=this._convertToYCellCoord(y);for(let Q=V;Q<=H;Q++)for(let ce=j;ce<=W;ce++)if(b.call(this,t,n,d,y,this.xCellCount*ce+Q,T,D,F))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,d,y,b,T){const D=y-t,F=b-n,V=d+T;return V*V>D*D+F*F}_circleAndRectCollide(t,n,d,y,b,T,D){const F=(T-y)/2,V=Math.abs(t-(y+F));if(V>F+d)return!1;const j=(D-b)/2,H=Math.abs(n-(b+j));if(H>j+d)return!1;if(V<=F||H<=j)return!0;const W=V-F,Q=H-j;return W*W+Q*Q<=d*d}}const ps={unknown:0,flipRequired:1,flipNotRequired:2},_l=Math.tan(85*Math.PI/180);function bs(u,t,n,d,y,b,T){const D=r.ab.mat4.create();if(n)if(b.name==="globe"){const F=r.bo(y,t);r.ab.mat4.multiply(D,D,F)}else{const F=r.ab.mat2.invert([],T);D[0]=F[0],D[1]=F[1],D[4]=F[2],D[5]=F[3],d||r.ab.mat4.rotateZ(D,D,y.angle)}else r.ab.mat4.multiply(D,y.labelPlaneMatrix,u);return D}function wn(u,t,n,d,y,b,T){const D=bs(u,t,n,d,y,b,T);return b.name==="globe"&&n||(D[2]=D[6]=D[10]=D[14]=0),D}function Zd(u,t,n,d,y,b,T){if(n){if(b.name==="globe"){const D=bs(u,t,n,d,y,b,T);return r.ab.mat4.invert(D,D),r.ab.mat4.multiply(D,u,D),D}{const D=r.ab.mat4.clone(u),F=r.ab.mat4.identity([]);return F[0]=T[0],F[1]=T[1],F[4]=T[2],F[5]=T[3],r.ab.mat4.multiply(D,D,F),d||r.ab.mat4.rotateZ(D,D,-y.angle),D}}return y.glCoordMatrix}function Js(u,t,n,d){const y=[u,t,n,1];n?r.ab.vec4.transformMat4(y,y,d):ko(y,y,d);const b=y[3];return y[0]/=b,y[1]/=b,y[2]/=b,y}function rs(u,t){return Math.min(.5+u/t*.5,1.5)}function _o(u,t){const n=u[0]/u[3],d=u[1]/u[3];return n>=-t[0]&&n<=t[0]&&d>=-t[1]&&d<=t[1]}function qu(u,t,n,d,y,b,T,D,F,V){const j=n.transform,H=d?u.textSizeData:u.iconSizeData,W=r.bp(H,n.transform.zoom),Q=j.projection.name==="globe",ce=[256/n.width*2+1,256/n.height*2+1],oe=d?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;oe.clear();let de=null;Q&&(de=d?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const pe=u.lineVertexArray,Se=d?u.text.placedSymbolArray:u.icon.placedSymbolArray,ke=n.transform.width/n.transform.height;let Ie,Ue=!1;for(let Le=0;Le<Se.length;Le++){const Be=Se.get(Le),{numGlyphs:Oe,writingMode:He}=Be;if(He!==r.bq.vertical||Ue||Ie===r.bq.horizontal||(Ue=!0),Ie=He,(Be.hidden||He===r.bq.vertical)&&!Ue){Qr(Oe,oe);continue}Ue=!1;const Qe=new r.P(Be.tileAnchorX,Be.tileAnchorY);let{x:xt,y:ut,z:It}=j.projection.projectTilePoint(Qe.x,Qe.y,V.canonical);if(F){const[kt,$t,Xt]=F(Qe);xt+=kt,ut+=$t,It+=Xt}const At=[xt,ut,It,1];if(r.ab.vec4.transformMat4(At,At,t),!_o(At,ce)){Qr(Oe,oe);continue}const ot=At[3],wt=rs(n.transform.getCameraToCenterDistance(j.projection),ot),Vt=r.br(H,W,Be),st=T?Vt/wt:Vt*wt,Dt=Js(xt,ut,It,y);if(Dt[3]<=0){Qr(Oe,oe);continue}let bt={};const Kt=T?null:F,Bt=yo(Be,st,!1,D,t,y,b,u.glyphOffsetArray,pe,oe,de,Dt,Qe,bt,ke,Kt,j.projection,V,T);Ue=Bt.useVertical,Kt&&Bt.needsFlipping&&(bt={}),(Bt.notEnoughRoom||Ue||Bt.needsFlipping&&yo(Be,st,!0,D,t,y,b,u.glyphOffsetArray,pe,oe,de,Dt,Qe,bt,ke,Kt,j.projection,V,T).notEnoughRoom)&&Qr(Oe,oe)}d?(u.text.dynamicLayoutVertexBuffer.updateData(oe),de&&u.text.globeExtVertexBuffer&&u.text.globeExtVertexBuffer.updateData(de)):(u.icon.dynamicLayoutVertexBuffer.updateData(oe),de&&u.icon.globeExtVertexBuffer&&u.icon.globeExtVertexBuffer.updateData(de))}function Yu(u,t,n,d,y,b,T,D,F,V,j,H,W,Q,ce,oe){const{lineStartIndex:de,glyphStartIndex:pe,segment:Se}=D,ke=pe+D.numGlyphs,Ie=de+D.lineLength,Ue=t.getoffsetX(pe),Le=t.getoffsetX(ke-1),Be=La(u*Ue,n,d,y,b,T,Se,de,Ie,F,V,j,H,W,!0,Q,ce,oe);if(!Be)return null;const Oe=La(u*Le,n,d,y,b,T,Se,de,Ie,F,V,j,H,W,!0,Q,ce,oe);return Oe?{first:Be,last:Oe}:null}function Ds(u,t,n,d){return u===r.bq.horizontal&&Math.abs(d)>Math.abs(n)?{useVertical:!0}:u===r.bq.vertical?d>0?{needsFlipping:!0}:null:t!==ps.unknown&&function(y,b){return y===0||Math.abs(b/y)>_l}(n,d)?t===ps.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function yo(u,t,n,d,y,b,T,D,F,V,j,H,W,Q,ce,oe,de,pe,Se){const ke=t/24,Ie=u.lineOffsetX*ke,Ue=u.lineOffsetY*ke,{lineStartIndex:Le,glyphStartIndex:Be,numGlyphs:Oe,segment:He,writingMode:Qe,flipState:xt}=u,ut=Le+u.lineLength,It=At=>{if(j){const[st,Dt,bt]=At.up,Kt=V.length;r.bs(j,Kt+0,st,Dt,bt),r.bs(j,Kt+1,st,Dt,bt),r.bs(j,Kt+2,st,Dt,bt),r.bs(j,Kt+3,st,Dt,bt)}const[ot,wt,Vt]=At.point;r.bt(V,ot,wt,Vt,At.angle)};if(Oe>1){const At=Yu(ke,D,Ie,Ue,n,H,W,u,F,b,Q,oe,!1,de,pe,Se);if(!At)return{notEnoughRoom:!0};if(d&&!n){let[ot,wt,Vt]=At.first.point,[st,Dt,bt]=At.last.point;[ot,wt]=Js(ot,wt,Vt,T),[st,Dt]=Js(st,Dt,bt,T);const Kt=Ds(Qe,xt,(st-ot)*ce,Dt-wt);if(u.flipState=Kt&&Kt.needsFlipping?ps.flipRequired:ps.flipNotRequired,Kt)return Kt}It(At.first);for(let ot=Be+1;ot<Be+Oe-1;ot++){const wt=La(ke*D.getoffsetX(ot),Ie,Ue,n,H,W,He,Le,ut,F,b,Q,oe,!1,!1,de,pe,Se);if(!wt)return V.length-=4*(ot-Be),{notEnoughRoom:!0};It(wt)}It(At.last)}else{if(d&&!n){const ot=Js(W.x,W.y,0,y),wt=Le+He+1,Vt=new r.P(F.getx(wt),F.gety(wt)),st=Js(Vt.x,Vt.y,0,y),Dt=st[3]>0?st:Yc(W,Vt,ot,1,y,void 0,de,pe.canonical),bt=Ds(Qe,xt,(Dt[0]-ot[0])*ce,Dt[1]-ot[1]);if(u.flipState=bt&&bt.needsFlipping?ps.flipRequired:ps.flipNotRequired,bt)return bt}const At=La(ke*D.getoffsetX(Be),Ie,Ue,n,H,W,He,Le,ut,F,b,Q,oe,!1,!1,de,pe,Se);if(!At)return{notEnoughRoom:!0};It(At)}return{}}function ks(u,t,n,d,y){const{x:b,y:T,z:D}=d.projectTilePoint(u.x,u.y,t);if(!y)return Js(b,T,D,n);const[F,V,j]=y(u);return Js(b+F,T+V,D+j,n)}function Yc(u,t,n,d,y,b,T,D){const F=ks(u.sub(t)._unit()._add(u),D,y,T,b);return r.ab.vec3.sub(F,n,F),r.ab.vec3.normalize(F,F),r.ab.vec3.scaleAndAdd(F,n,F,d)}function La(u,t,n,d,y,b,T,D,F,V,j,H,W,Q,ce,oe,de,pe){const Se=d?u-t:u+t;let ke=Se>0?1:-1,Ie=0;d&&(ke*=-1,Ie=Math.PI),ke<0&&(Ie+=Math.PI);let Ue=D+T+(ke>0?0:1)|0,Le=y,Be=y,Oe=0,He=0;const Qe=Math.abs(Se),xt=[],ut=[];let It=b,At=It;const ot=()=>Yc(At,It,Be,Qe-Oe+1,j,W,oe,de.canonical);for(;Oe+He<=Qe;){if(Ue+=ke,Ue<D||Ue>=F)return null;if(Be=Le,At=It,xt.push(Be),Q&&ut.push(At),It=new r.P(V.getx(Ue),V.gety(Ue)),Le=H[Ue],!Le){const $t=ks(It,de.canonical,j,oe,W);Le=$t[3]>0?H[Ue]=$t:ot()}Oe+=He,He=r.ab.vec3.distance(Be,Le)}ce&&W&&(H[Ue]&&(Le=ot(),He=r.ab.vec3.distance(Be,Le)),H[Ue]=Le);const wt=(Qe-Oe)/He,Vt=It.sub(At)._mult(wt)._add(At),st=r.ab.vec3.sub([],Le,Be),Dt=r.ab.vec3.scaleAndAdd([],Be,st,wt);let bt=[0,0,1],Kt=st[0],Bt=st[1];if(pe&&(bt=oe.upVector(de.canonical,Vt.x,Vt.y),bt[0]!==0||bt[1]!==0||bt[2]!==1)){const $t=[bt[2],0,-bt[0]],Xt=r.ab.vec3.cross([],bt,$t);r.ab.vec3.normalize($t,$t),r.ab.vec3.normalize(Xt,Xt),Kt=r.ab.vec3.dot(st,$t),Bt=r.ab.vec3.dot(st,Xt)}if(n){const $t=r.ab.vec3.cross([],bt,st);r.ab.vec3.normalize($t,$t),r.ab.vec3.scaleAndAdd(Dt,Dt,$t,n*ke)}const kt=Ie+Math.atan2(Bt,Kt);return xt.push(Dt),Q&&ut.push(Vt),{point:Dt,angle:kt,path:xt,tilePath:ut,up:bt}}function Qr(u,t){const n=t.length,d=n+4*u;t.resize(d),t.float32.fill(-1/0,4*n,4*d)}function ko(u,t,n){const d=t[0],y=t[1];return u[0]=n[0]*d+n[4]*y+n[12],u[1]=n[1]*d+n[5]*y+n[13],u[3]=n[3]*d+n[7]*y+n[15],u}const ws=100;class yn{constructor(t,n,d=new Oa(t.width+200,t.height+200,25),y=new Oa(t.width+200,t.height+200,25)){this.transform=t,this.grid=d,this.ignoredGrid=y,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ws,this.screenBottomBoundary=t.height+ws,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=n}placeCollisionBox(t,n,d,y,b,T,D,F){let V=d.projectedAnchorX,j=d.projectedAnchorY,H=d.projectedAnchorZ;const W=d.elevation,Q=d.tileID,ce=t.getProjection();if(W&&Q){const[Le,Be,Oe]=ce.upVector(Q.canonical,d.tileAnchorX,d.tileAnchorY),He=ce.upVectorScale(Q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;V+=Le*W*He,j+=Be*W*He,H+=Oe*W*He}const oe=this.projectAndGetPerspectiveRatio(D,V,j,H,d.tileID,ce.name==="globe"||!!W||this.transform.pitch>0,ce),de=T*oe.perspectiveRatio,pe=(d.x1*n+y.x-d.padding)*de+oe.point.x,Se=(d.y1*n+y.y-d.padding)*de+oe.point.y,ke=(d.x2*n+y.x+d.padding)*de+oe.point.x,Ie=(d.y2*n+y.y+d.padding)*de+oe.point.y,Ue=oe.perspectiveRatio<=.55||oe.occluded;return!this.isInsideGrid(pe,Se,ke,Ie)||!b&&this.grid.hitTest(pe,Se,ke,Ie,F)||Ue?{box:[],offscreen:!1,occluded:oe.occluded}:{box:[pe,Se,ke,Ie],offscreen:this.isOffscreen(pe,Se,ke,Ie),occluded:!1}}placeCollisionCircles(t,n,d,y,b,T,D,F,V,j,H,W,Q,ce,oe){const de=[],pe=this.transform.elevation,Se=t.getProjection(),ke=pe?pe.getAtTileOffsetFunc(oe,this.transform.center.lat,this.transform.worldSize,Se):null,Ie=new r.P(d.tileAnchorX,d.tileAnchorY);let{x:Ue,y:Le,z:Be}=Se.projectTilePoint(Ie.x,Ie.y,oe.canonical);if(ke){const[Vt,st,Dt]=ke(Ie);Ue+=Vt,Le+=st,Be+=Dt}const Oe=Se.name==="globe",He=this.projectAndGetPerspectiveRatio(D,Ue,Le,Be,oe,Oe||!!pe||this.transform.pitch>0,Se),{perspectiveRatio:Qe}=He,xt=(H?T/Qe:T*Qe)/r.bw,ut=Js(Ue,Le,Be,F),It=He.signedDistanceFromCamera>0?Yu(xt,b,d.lineOffsetX*xt,d.lineOffsetY*xt,!1,ut,Ie,d,y,F,{},pe&&!H?ke:null,H&&!!pe,Se,oe,H):null;let At=!1,ot=!1,wt=!0;if(It&&!He.occluded){const Vt=.5*Q*Qe+ce,st=new r.P(-100,-100),Dt=new r.P(this.screenRightBoundary,this.screenBottomBoundary),bt=new Tr,{first:Kt,last:Bt}=It,kt=Kt.path.length;let $t=[];for(let di=kt-1;di>=1;di--)$t.push(Kt.path[di]);for(let di=1;di<Bt.path.length;di++)$t.push(Bt.path[di]);const Xt=2.5*Vt;V&&($t=$t.map(([di,Fi,Mi],Ei)=>(ke&&!Oe&&(Mi=ke(Ei<kt-1?Kt.tilePath[kt-1-Ei]:Bt.tilePath[Ei-kt+2])[2]),Js(di,Fi,Mi,V))),$t.some(di=>di[3]<=0)&&($t=[]));let ci=[];if($t.length>0){let di=1/0,Fi=-1/0,Mi=1/0,Ei=-1/0;for(const ji of $t)di=Math.min(di,ji[0]),Mi=Math.min(Mi,ji[1]),Fi=Math.max(Fi,ji[0]),Ei=Math.max(Ei,ji[1]);Fi>=st.x&&di<=Dt.x&&Ei>=st.y&&Mi<=Dt.y&&(ci=[$t.map(ji=>new r.P(ji[0],ji[1]))],(di<st.x||Fi>Dt.x||Mi<st.y||Ei>Dt.y)&&(ci=r.bu(ci,st.x,st.y,Dt.x,Dt.y)))}for(const di of ci){bt.reset(di,.25*Vt);let Fi=0;Fi=bt.length<=.5*Vt?1:Math.ceil(bt.paddedLength/Xt)+1;for(let Mi=0;Mi<Fi;Mi++){const Ei=Mi/Math.max(Fi-1,1),ji=bt.lerp(Ei),pr=ji.x+ws,Cr=ji.y+ws;de.push(pr,Cr,Vt,0);const dn=pr-Vt,$r=Cr-Vt,$i=pr+Vt,lr=Cr+Vt;if(wt=wt&&this.isOffscreen(dn,$r,$i,lr),ot=ot||this.isInsideGrid(dn,$r,$i,lr),!n&&this.grid.hitTestCircle(pr,Cr,Vt,W)&&(At=!0,!j))return{circles:[],offscreen:!1,collisionDetected:At,occluded:!1}}}}return{circles:!j&&At||!ot?[]:de,offscreen:wt,collisionDetected:At,occluded:He.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let d=1/0,y=1/0,b=-1/0,T=-1/0;for(const j of t){const H=new r.P(j.x+ws,j.y+ws);d=Math.min(d,H.x),y=Math.min(y,H.y),b=Math.max(b,H.x),T=Math.max(T,H.y),n.push(H)}const D=this.grid.query(d,y,b,T).concat(this.ignoredGrid.query(d,y,b,T)),F={},V={};for(const j of D){const H=j.key;if(F[H.bucketInstanceId]===void 0&&(F[H.bucketInstanceId]={}),F[H.bucketInstanceId][H.featureIndex])continue;const W=[new r.P(j.x1,j.y1),new r.P(j.x2,j.y1),new r.P(j.x2,j.y2),new r.P(j.x1,j.y2)];r.bv(n,W)&&(F[H.bucketInstanceId][H.featureIndex]=!0,V[H.bucketInstanceId]===void 0&&(V[H.bucketInstanceId]=[]),V[H.bucketInstanceId].push(H.featureIndex))}return V}insertCollisionBox(t,n,d,y,b){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:y,collisionGroupID:b},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,d,y,b){const T=n?this.ignoredGrid:this.grid,D={bucketInstanceId:d,featureIndex:y,collisionGroupID:b};for(let F=0;F<t.length;F+=4)T.insertCircle(D,t[F],t[F+1],t[F+2])}projectAndGetPerspectiveRatio(t,n,d,y,b,T,D){const F=[n,d,y,1];let V=!1;y||this.transform.pitch>0?(r.ab.vec4.transformMat4(F,F,t),this.fogState&&b&&D.name!=="globe"&&(V=function(W,Q,ce,oe,de,pe){const Se=pe.calculateFogTileMatrix(de),ke=[Q,ce,oe];return r.ab.vec3.transformMat4(ke,ke,Se),Ze(W,r.ab.vec3.length(ke),pe.pitch,pe._fov)}(this.fogState,n,d,y,b.toUnwrapped(),this.transform)>.9)):ko(F,F,t);const j=F[3];return{point:new r.P((F[0]/j+1)/2*this.transform.width+ws,(-F[1]/j+1)/2*this.transform.height+ws),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(D)/j*.5,1.5),signedDistanceFromCamera:j,occluded:T&&F[2]>j||V}}isOffscreen(t,n,d,y){return d<ws||t>=this.screenRightBoundary||y<ws||n>this.screenBottomBoundary}isInsideGrid(t,n,d,y){return d>=0&&t<this.gridRightBoundary&&y>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=r.ab.mat4.identity([]);return r.ab.mat4.translate(t,t,[-100,-100,0]),t}}function Xc(u,t,n){const d=t.createTileMatrix(u,u.worldSize,n.toUnwrapped());return r.ab.mat4.multiply(new Float32Array(16),u.projMatrix,d)}function Xo(u,t,n){if(t.projection.name===n.projection.name)return u.projMatrix;const d=n.clone();return d.setProjection(t.projection),Xc(d,t.getProjection(),u)}function Ha(u,t,n){return t.name===n.projection.name?u.projMatrix:Xc(n,t,u)}class Zc{constructor(t,n,d,y){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):y&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Oo{constructor(t,n,d,y,b,T=!1){this.text=new Zc(t?t.text:null,n,d,b),this.icon=new Zc(t?t.icon:null,n,y,b),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Kd{constructor(t,n,d,y=!1){this.text=t,this.icon=n,this.skipFade=d,this.clipped=y}}class Ra{constructor(){this.invProjMatrix=r.ab.mat4.create(),this.viewportMatrix=r.ab.mat4.create(),this.circles=[]}}class Jd{constructor(t,n,d,y,b){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=d,this.bucketIndex=y,this.tileID=b}}class Qd{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:d=>d.collisionGroupID===n}}return this.collisionGroups[t]}}function no(u,t,n,d,y){const{horizontalAlign:b,verticalAlign:T}=r.bD(u),D=-(b-.5)*t,F=-(T-.5)*n,V=r.bC(u,d);return new r.P(D+V[0]*y,F+V[1]*y)}function ep(u,t,n,d,y){const b=new r.P(u,t);return n&&b._rotate(d?y:-y),b}class Nh{constructor(t,n,d,y,b,T){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new yn(this.transform,b),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new Qd(d),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,d,y,b=1){const T=d.getBucket(n),D=d.latestFeatureIndex;if(!T||!D||n.fqid!==T.layerIds[0])return;const F=T.layers[0].layout,V=T.layers[0].paint,j=d.collisionBoxArray,H=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),W=d.tileSize/r.ag,Q=d.tileID.toUnwrapped();this.transform.setProjection(T.projection);const ce=(oe=d.tileID,de=T.getProjection(),pe=this.transform,de.name===this.projection?pe.calculateProjMatrix(oe.toUnwrapped()):Xc(pe,de,oe));var oe,de,pe;const Se=F.get("text-pitch-alignment")==="map",ke=F.get("text-rotation-alignment")==="map";n.compileFilter(n.options);const Ie=n.dynamicFilter(),Ue=n.dynamicFilterNeedsFeature(),Le=this.transform.calculatePixelsToTileUnitsMatrix(d),Be=wn(ce,d.tileID.canonical,Se,ke,this.transform,T.getProjection(),Le);let Oe=null;if(Se){const Vt=Zd(ce,d.tileID.canonical,Se,ke,this.transform,T.getProjection(),Le);Oe=r.ab.mat4.multiply([],this.transform.labelPlaneMatrix,Vt)}let He=null;Ie&&d.latestFeatureIndex&&(He={unwrappedTileID:Q,dynamicFilter:Ie,dynamicFilterNeedsFeature:Ue}),this.retainedQueryData[T.bucketInstanceId]=new Jd(T.bucketInstanceId,D,T.sourceLayerIndex,T.index,d.tileID);const[Qe,xt]=T.layers[0].layout.get("text-size-scale-range"),ut=r.aw(b,Qe,xt),[It,At]=F.get("icon-size-scale-range"),ot=r.aw(b,It,At),wt={bucket:T,layout:F,paint:V,posMatrix:ce,textLabelPlaneMatrix:Be,labelToScreenMatrix:Oe,clippingData:He,scale:H,textPixelRatio:W,holdingForFade:d.holdingForFade(),collisionBoxArray:j,partiallyEvaluatedTextSize:r.bp(T.textSizeData,this.transform.zoom,ut),partiallyEvaluatedIconSize:r.bp(T.iconSizeData,this.transform.zoom,ot),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(y)for(const Vt of T.sortKeyRanges){const{sortKey:st,symbolInstanceStart:Dt,symbolInstanceEnd:bt}=Vt;t.push({sortKey:st,symbolInstanceStart:Dt,symbolInstanceEnd:bt,parameters:wt})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:wt})}attemptAnchorPlacement(t,n,d,y,b,T,D,F,V,j,H,W,Q,ce,oe,de,pe,Se){const{textOffset0:ke,textOffset1:Ie,crossTileID:Ue}=W,Le=[ke,Ie],Be=no(t,d,y,Le,b),Oe=this.collisionIndex.placeCollisionBox(ce,b,n,ep(Be.x,Be.y,T,D,this.transform.angle),H,F,V,j.predicate);if(de){const He=ce.getSymbolInstanceIconSize(Se,this.transform.zoom,W.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ce,He,de,ep(Be.x,Be.y,T,D,this.transform.angle),H,F,V,j.predicate).box.length===0)return}if(Oe.box.length>0){let He;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ue]&&this.prevPlacement.placements[Ue]&&this.prevPlacement.placements[Ue].text&&(He=this.prevPlacement.variableOffsets[Ue].anchor),this.variableOffsets[Ue]={textOffset:Le,width:d,height:y,anchor:t,textScale:b,prevAnchor:He},this.markUsedJustification(ce,t,W,oe),ce.allowVerticalPlacement&&(this.markUsedOrientation(ce,oe,W),this.placedOrientations[Ue]=oe),{shift:Be,placedGlyphBoxes:Oe}}}placeLayerBucketPart(t,n,d,y,b=1){const{bucket:T,layout:D,paint:F,posMatrix:V,textLabelPlaneMatrix:j,labelToScreenMatrix:H,clippingData:W,textPixelRatio:Q,holdingForFade:ce,collisionBoxArray:oe,partiallyEvaluatedTextSize:de,partiallyEvaluatedIconSize:pe,collisionGroup:Se,latestFeatureIndex:ke}=t.parameters,Ie=D.get("text-optional"),Ue=D.get("icon-optional"),Le=D.get("text-allow-overlap"),Be=D.get("icon-allow-overlap"),Oe=D.get("text-rotation-alignment")==="map",He=D.get("text-pitch-alignment")==="map",Qe=D.get("symbol-z-elevate"),xt=F.get("symbol-z-offset"),ut=D.get("symbol-elevation-reference")==="sea",[It,At]=D.get("text-size-scale-range"),[ot,wt]=D.get("icon-size-scale-range"),Vt=r.aw(b,It,At),st=r.aw(b,ot,wt);this.transform.setProjection(T.projection);let Dt=Le&&(Be||!T.hasIconData()||Ue),bt=Be&&(Le||!T.hasTextData()||Ie);const Kt=!xt.isConstant();!T.collisionArrays&&oe&&T.deserializeCollisionBoxes(oe),d&&y&&T.updateCollisionDebugBuffers(this.transform.zoom,oe,Vt,st);const Bt=(kt,$t,Xt)=>{const{crossTileID:ci,numVerticalGlyphVertices:di}=kt;let Fi=null;if(W&&W.dynamicFilterNeedsFeature||Kt){const Gr=this.retainedQueryData[T.bucketInstanceId];Fi=ke.loadFeature({featureIndex:kt.featureIndex,bucketIndex:Gr.bucketIndex,sourceLayerIndex:Gr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(W&&!(0,W.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Fi,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new r.P(kt.tileAnchorX,kt.tileAnchorY),this.transform.calculateDistanceTileData(W.unwrappedTileID)))return this.placements[ci]=new Kd(!1,!1,!1,!0),void n.add(ci);const Mi=xt.evaluate(Fi,{});if(n.has(ci))return;if(ce)return void(this.placements[ci]=new Kd(!1,!1,!1));let Ei=!1,ji=!1,pr=!0,Cr=!1,dn=!1,$r=null,$i={box:null,offscreen:null,occluded:null},lr={box:null},bi=null,or=null,Dr=null,Mr=0,pn=0,ns=0;Xt.textFeatureIndex?Mr=Xt.textFeatureIndex:kt.useRuntimeCollisionCircles&&(Mr=kt.featureIndex),Xt.verticalTextFeatureIndex&&(pn=Xt.verticalTextFeatureIndex);const Tn=Gr=>{Gr.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const Br=this.transform.elevation;Gr.elevation=ut?Mi:Mi+(Br?Br.getAtTileOffset(Gr.tileID,Gr.tileAnchorX,Gr.tileAnchorY):0),Gr.elevation+=kt.zOffset},qn=Xt.textBox;if(qn){Tn(qn);const Gr=mr=>{let Dn=r.bq.horizontal;if(T.allowVerticalPlacement&&!mr&&this.prevPlacement){const Yn=this.prevPlacement.placedOrientations[ci];Yn&&(this.placedOrientations[ci]=Yn,Dn=Yn,this.markUsedOrientation(T,Dn,kt))}return Dn},Br=(mr,Dn)=>{if(T.allowVerticalPlacement&&di>0&&Xt.verticalTextBox){for(const Yn of T.writingModes)if(Yn===r.bq.vertical?($i=Dn(),lr=$i):$i=mr(),$i&&$i.box&&$i.box.length)break}else $i=mr()};if(D.get("text-variable-anchor")){let mr=D.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ci]){const jr=this.prevPlacement.variableOffsets[ci];mr.indexOf(jr.anchor)>0&&(mr=mr.filter(zs=>zs!==jr.anchor),mr.unshift(jr.anchor))}const Dn=(jr,zs,ta)=>{const Co=T.getSymbolInstanceTextSize(de,kt,this.transform.zoom,$t),ho=(jr.x2-jr.x1)*Co+2*jr.padding,Vo=(jr.y2-jr.y1)*Co+2*jr.padding,Uo=kt.hasIconTextFit&&!Be?zs:null;Uo&&Tn(Uo);let jo={box:[],offscreen:!1,occluded:!1};const nl=Le?2*mr.length:mr.length;for(let $o=0;$o<nl;++$o){const Cc=this.attemptAnchorPlacement(mr[$o%mr.length],jr,ho,Vo,Co,Oe,He,Q,V,Se,$o>=mr.length,kt,$t,T,ta,Uo,de,pe);if(Cc&&(jo=Cc.placedGlyphBoxes,jo&&jo.box&&jo.box.length)){Ei=!0,$r=Cc.shift;break}}return jo};Br(()=>Dn(qn,Xt.iconBox,r.bq.horizontal),()=>{const jr=Xt.verticalTextBox;return jr&&Tn(jr),T.allowVerticalPlacement&&!($i&&$i.box&&$i.box.length)&&di>0&&jr?Dn(jr,Xt.verticalIconBox,r.bq.vertical):{box:null,offscreen:null,occluded:null}}),$i&&(Ei=$i.box,pr=$i.offscreen,Cr=$i.occluded);const Yn=Gr(!(!$i||!$i.box));if(!Ei&&this.prevPlacement){const jr=this.prevPlacement.variableOffsets[ci];jr&&(this.variableOffsets[ci]=jr,this.markUsedJustification(T,jr.anchor,kt,Yn))}}else{const mr=(Dn,Yn)=>{const jr=T.getSymbolInstanceTextSize(de,kt,this.transform.zoom,$t,b),zs=this.collisionIndex.placeCollisionBox(T,jr,Dn,new r.P(0,0),Le,Q,V,Se.predicate);return zs&&zs.box&&zs.box.length&&(this.markUsedOrientation(T,Yn,kt),this.placedOrientations[ci]=Yn),zs};Br(()=>mr(qn,r.bq.horizontal),()=>{const Dn=Xt.verticalTextBox;return T.allowVerticalPlacement&&di>0&&Dn?(Tn(Dn),mr(Dn,r.bq.vertical)):{box:null,offscreen:null,occluded:null}}),Gr(!!($i&&$i.box&&$i.box.length))}}if(bi=$i,Ei=bi&&bi.box&&bi.box.length>0,pr=bi&&bi.offscreen,Cr=bi&&bi.occluded,kt.useRuntimeCollisionCircles){const Gr=T.text.placedSymbolArray.get(kt.centerJustifiedTextSymbolIndex>=0?kt.centerJustifiedTextSymbolIndex:kt.verticalPlacedTextSymbolIndex),Br=r.br(T.textSizeData,de,Gr),mr=D.get("text-padding");or=this.collisionIndex.placeCollisionCircles(T,Le,Gr,T.lineVertexArray,T.glyphOffsetArray,Br,V,j,H,d,He,Se.predicate,kt.collisionCircleDiameter*Br/r.bw,mr,this.retainedQueryData[T.bucketInstanceId].tileID),Ei=Le||or.circles.length>0&&!or.collisionDetected,pr=pr&&or.offscreen,Cr=or.occluded}if(Xt.iconFeatureIndex&&(ns=Xt.iconFeatureIndex),Xt.iconBox){const Gr=Br=>{Tn(Br);const mr=kt.hasIconTextFit&&$r?ep($r.x,$r.y,Oe,He,this.transform.angle):new r.P(0,0),Dn=T.getSymbolInstanceIconSize(pe,this.transform.zoom,kt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,Dn,Br,mr,Be,Q,V,Se.predicate)};lr&&lr.box&&lr.box.length&&Xt.verticalIconBox?(Dr=Gr(Xt.verticalIconBox),ji=Dr.box.length>0):(Dr=Gr(Xt.iconBox),ji=Dr.box.length>0),pr=pr&&Dr.offscreen,dn=Dr.occluded}const Eo=Ie||kt.numHorizontalGlyphVertices===0&&di===0,Hs=Ue||kt.numIconVertices===0;if(Eo||Hs?Hs?Eo||(ji=ji&&Ei):Ei=ji&&Ei:ji=Ei=ji&&Ei,Ei&&bi&&bi.box&&this.collisionIndex.insertCollisionBox(bi.box,D.get("text-ignore-placement"),T.bucketInstanceId,lr&&lr.box&&pn?pn:Mr,Se.ID),ji&&Dr&&this.collisionIndex.insertCollisionBox(Dr.box,D.get("icon-ignore-placement"),T.bucketInstanceId,ns,Se.ID),or&&(Ei&&this.collisionIndex.insertCollisionCircles(or.circles,D.get("text-ignore-placement"),T.bucketInstanceId,Mr,Se.ID),d)){const Gr=T.bucketInstanceId;let Br=this.collisionCircleArrays[Gr];Br===void 0&&(Br=this.collisionCircleArrays[Gr]=new Ra);for(let mr=0;mr<or.circles.length;mr+=4)Br.circles.push(or.circles[mr+0]),Br.circles.push(or.circles[mr+1]),Br.circles.push(or.circles[mr+2]),Br.circles.push(or.collisionDetected?1:0)}const rn=T.projection.name!=="globe";Dt=Dt&&(rn||!Cr),bt=bt&&(rn||!dn),this.placements[ci]=new Kd(Ei||Dt,ji||bt,pr||T.justReloaded),n.add(ci)};if(Qe&&this.buildingIndex&&(this.buildingIndex.updateZOffset(T,this.retainedQueryData[T.bucketInstanceId].tileID),T.updateZOffset()),T.sortFeaturesByY){const kt=T.getSortedSymbolIndexes(this.transform.angle);for(let $t=kt.length-1;$t>=0;--$t){const Xt=kt[$t];Bt(T.symbolInstances.get(Xt),Xt,T.collisionArrays[Xt])}T.hasAnyZOffset&&r.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const kt=T.getSortedIndexesByZOffset();for(let $t=0;$t<kt.length;++$t){const Xt=kt[$t];Bt(T.symbolInstances.get(Xt),Xt,T.collisionArrays[Xt])}}else for(let kt=t.symbolInstanceStart;kt<t.symbolInstanceEnd;kt++)Bt(T.symbolInstances.get(kt),kt,T.collisionArrays[kt]);if(d&&T.bucketInstanceId in this.collisionCircleArrays){const kt=this.collisionCircleArrays[T.bucketInstanceId];r.ab.mat4.invert(kt.invProjMatrix,V),kt.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(t,n,d,y){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:F,crossTileID:V}=d,j=r.bB(n),H=y===r.bq.vertical?F:j==="left"?b:j==="center"?T:j==="right"?D:-1;b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=H>=0&&b!==H?0:V),T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=H>=0&&T!==H?0:V),D>=0&&(t.text.placedSymbolArray.get(D).crossTileID=H>=0&&D!==H?0:V),F>=0&&(t.text.placedSymbolArray.get(F).crossTileID=H>=0&&F!==H?0:V)}markUsedOrientation(t,n,d){const y=n===r.bq.horizontal||n===r.bq.horizontalOnly?n:0,b=n===r.bq.vertical?n:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:D,rightJustifiedTextSymbolIndex:F,verticalPlacedTextSymbolIndex:V}=d,j=t.text.placedSymbolArray;T>=0&&(j.get(T).placedOrientation=y),D>=0&&(j.get(D).placedOrientation=y),F>=0&&(j.get(F).placedOrientation=y),V>=0&&(j.get(V).placedOrientation=b)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let d=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const y=n?n.symbolFadeChange(t):1,b=n?n.opacities:{},T=n?n.variableOffsets:{},D=n?n.placedOrientations:{};for(const F in this.placements){const V=this.placements[F],j=b[F];j?(this.opacities[F]=new Oo(j,y,V.text,V.icon,null,V.clipped),d=d||V.text!==j.text.placed||V.icon!==j.icon.placed):(this.opacities[F]=new Oo(null,y,V.text,V.icon,V.skipFade,V.clipped),d=d||V.text||V.icon)}for(const F in b){const V=b[F];if(!this.opacities[F]){const j=new Oo(V,y,!1,!1);j.isHidden()||(this.opacities[F]=j,d=d||V.text.placed||V.icon.placed)}}for(const F in T)this.variableOffsets[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.variableOffsets[F]=T[F]);for(const F in D)this.placedOrientations[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.placedOrientations[F]=D[F]);d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n,d,y){const b=new Set;for(const T of n){const D=T.getBucket(t);D&&T.latestFeatureIndex&&t.fqid===D.layerIds[0]&&(this.updateBucketOpacities(D,b,T,T.collisionBoxArray,d,y,T.tileID,t.scope),D.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(D,T.tileID),D.updateZOffset()))}}updateBucketOpacities(t,n,d,y,b,T,D,F){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const V=t.layers[0].layout,j=t.layers[0].paint,H=!!t.layers[0].dynamicFilter(),W=new Oo(null,0,!1,!1,!0),Q=V.get("text-allow-overlap"),ce=V.get("icon-allow-overlap"),oe=V.get("text-variable-anchor"),de=V.get("text-rotation-alignment")==="map",pe=V.get("text-pitch-alignment")==="map",Se=j.get("symbol-z-offset"),ke=V.get("symbol-elevation-reference")==="sea",Ie=!Se.isConstant(),Ue=new Oo(null,0,Q&&(ce||!t.hasIconData()||V.get("icon-optional")),ce&&(Q||!t.hasTextData()||V.get("text-optional")),!0);!t.collisionArrays&&y&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(y);const Le=(Oe,He,Qe)=>{for(let xt=0;xt<He/4;xt++)Oe.opacityVertexArray.emplaceBack(Qe)};let Be=0;T&&t.updateReplacement(D,T);for(let Oe=0;Oe<t.symbolInstances.length;Oe++){const He=t.symbolInstances.get(Oe),{numHorizontalGlyphVertices:Qe,numVerticalGlyphVertices:xt,crossTileID:ut,numIconVertices:It,tileAnchorX:At,tileAnchorY:ot}=He;let wt=null;const Vt=this.retainedQueryData[t.bucketInstanceId];Ie&&He&&Vt&&(wt=d.latestFeatureIndex.loadFeature({featureIndex:He.featureIndex,bucketIndex:Vt.bucketIndex,sourceLayerIndex:Vt.sourceLayerIndex,layoutVertexArrayOffset:0}));const st=Se.evaluate(wt,{}),Dt=n.has(ut);let bt=this.opacities[ut];Dt?bt=W:bt||(bt=Ue,this.opacities[ut]=bt),n.add(ut);const Kt=Qe>0||xt>0,Bt=It>0,kt=this.placedOrientations[ut],$t=kt===r.bq.vertical,Xt=kt===r.bq.horizontal||kt===r.bq.horizontalOnly;!Kt&&!Bt||bt.isHidden()||Be++;let ci=!1;if((Kt||Bt)&&T)for(const di of t.activeReplacements){if(r.bx(di,b,r.by.Symbol,F)||di.min.x>At||At>di.max.x||di.min.y>ot||ot>di.max.y)continue;const Fi=r.bz(At,ot,D.canonical,di.footprintTileId.canonical);if(ci=r.bA(Fi,di.footprint),ci)break}if(Kt){const di=ci?Wa:Vh(bt.text);Le(t.text,Qe,$t?Wa:di),Le(t.text,xt,Xt?Wa:di);const Fi=bt.text.isHidden(),{leftJustifiedTextSymbolIndex:Mi,centerJustifiedTextSymbolIndex:Ei,rightJustifiedTextSymbolIndex:ji,verticalPlacedTextSymbolIndex:pr}=He,Cr=t.text.placedSymbolArray,dn=Fi||$t?1:0;Mi>=0&&(Cr.get(Mi).hidden=dn),Ei>=0&&(Cr.get(Ei).hidden=dn),ji>=0&&(Cr.get(ji).hidden=dn),pr>=0&&(Cr.get(pr).hidden=Fi||Xt?1:0);const $r=this.variableOffsets[ut];$r&&this.markUsedJustification(t,$r.anchor,He,kt);const $i=this.placedOrientations[ut];$i&&(this.markUsedJustification(t,"left",He,$i),this.markUsedOrientation(t,$i,He))}if(Bt){const di=ci?Wa:Vh(bt.icon),{placedIconSymbolIndex:Fi,verticalPlacedIconSymbolIndex:Mi}=He,Ei=t.icon.placedSymbolArray,ji=bt.icon.isHidden()?1:0;Fi>=0&&(Le(t.icon,It,$t?Wa:di),Ei.get(Fi).hidden=ji),Mi>=0&&(Le(t.icon,He.numVerticalIconVertices,Xt?Wa:di),Ei.get(Mi).hidden=ji)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const di=t.collisionArrays[Oe];if(di){let Fi=new r.P(0,0),Mi=!0;if(di.textBox||di.verticalTextBox){if(oe){const ji=this.variableOffsets[ut];ji?(Fi=no(ji.anchor,ji.width,ji.height,ji.textOffset,ji.textScale),de&&Fi._rotate(pe?this.transform.angle:-this.transform.angle)):Mi=!1}H&&(Mi=!bt.clipped),di.textBox&&Xu(t.textCollisionBox.collisionVertexArray,bt.text.placed,!Mi||$t,st,ke,Fi.x,Fi.y),di.verticalTextBox&&Xu(t.textCollisionBox.collisionVertexArray,bt.text.placed,!Mi||Xt,st,ke,Fi.x,Fi.y)}const Ei=Mi&&!!(!Xt&&di.verticalIconBox);di.iconBox&&Xu(t.iconCollisionBox.collisionVertexArray,bt.icon.placed,Ei,st,ke,He.hasIconTextFit?Fi.x:0,He.hasIconTextFit?Fi.y:0),di.verticalIconBox&&Xu(t.iconCollisionBox.collisionVertexArray,bt.icon.placed,!Ei,st,ke,He.hasIconTextFit?Fi.x:0,He.hasIconTextFit?Fi.y:0)}}}if(t.fullyClipped=Be===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const Oe=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Oe.invProjMatrix,t.placementViewportMatrix=Oe.viewportMatrix,t.collisionCircleArray=Oe.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const d=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*d>t}setStale(){this.stale=!0}}function Xu(u,t,n,d,y,b,T){u.emplaceBack(t?1:0,n?1:0,b||0,T||0,d,y?1:0),u.emplaceBack(t?1:0,n?1:0,b||0,T||0,d,y?1:0),u.emplaceBack(t?1:0,n?1:0,b||0,T||0,d,y?1:0),u.emplaceBack(t?1:0,n?1:0,b||0,T||0,d,y?1:0)}const Ql=Math.pow(2,25),Vm=Math.pow(2,24),Um=Math.pow(2,17),Zu=Math.pow(2,16),Kc=Math.pow(2,9),Jc=Math.pow(2,8),ec=Math.pow(2,1);function Vh(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,n=Math.floor(127*u.opacity);return n*Ql+t*Vm+n*Um+t*Zu+n*Kc+t*Jc+n*ec+t}const Wa=0;class yl{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,n,d,y,b,T){const D=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(D,y,t[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((F,V)=>F.sortKey-V.sortKey));this._currentPartIndex<D.length;){const F=D[this._currentPartIndex];if(n.placeLayerBucketPart(F,this._seenCrossTileIDs,d,F.symbolInstanceStart===0,T),this._currentPartIndex++,b())return!0}return!1}}class jm{constructor(t,n,d,y,b,T,D,F,V){this.placement=new Nh(t,b,T,D,F,V),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(t,n,d,y,b){const T=r.q.now(),D=()=>{const F=r.q.now()-T;return!this._forceFullPlacement&&F>2};for(;this._currentPlacementIndex>=0;){const F=n[t[this._currentPlacementIndex]],V=this.placement.collisionIndex.transform.zoom;if(F.type==="symbol"&&(!F.minzoom||F.minzoom<=V)&&(!F.maxzoom||F.maxzoom>V)){const j=F,H=j.layout.get("symbol-z-elevate"),W=j.layout.get("symbol-sort-key").constantOr(1)!==void 0,Q=j.layout.get("symbol-z-order"),ce=Q==="viewport-y"||Q==="auto"&&!(Q!=="viewport-y"&&W),oe=j.layout.get("text-allow-overlap")||j.layout.get("icon-allow-overlap")||j.layout.get("text-ignore-placement")||j.layout.get("icon-ignore-placement"),de=ce&&oe,pe=this._inProgressLayer=this._inProgressLayer||new yl(j),Se=r.aC(F.source,F.scope);if(pe.continuePlacement(H||de?y[Se]:d[Se],this.placement,this._showCollisionBoxes,F,D,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const tc=512/r.ag/2;class tp{constructor(t,n,d){this.tileID=t,this.bucketInstanceId=d,this.index=new r.bE(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=t.canonical.x*r.ag,b=t.canonical.y*r.ag;for(let T=0;T<n.length;T++){const{key:D,crossTileID:F,tileAnchorX:V,tileAnchorY:j}=n.get(T),H=Math.floor((y+V)*tc),W=Math.floor((b+j)*tc);this.index.add(H,W),this.keys.push(D),this.crossTileIDs.push(F)}this.index.finish()}findMatches(t,n,d){const y=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),b=tc/Math.pow(2,n.canonical.z-this.tileID.canonical.z),T=n.canonical.x*r.ag,D=n.canonical.y*r.ag;for(let F=0;F<t.length;F++){const V=t.get(F);if(V.crossTileID)continue;const{key:j,tileAnchorX:H,tileAnchorY:W}=V,Q=Math.floor((T+H)*b),ce=Math.floor((D+W)*b),oe=this.index.range(Q-y,ce-y,Q+y,ce+y);for(const de of oe){const pe=this.crossTileIDs[de];if(this.keys[de]===j&&!d.has(pe)){d.add(pe),V.crossTileID=pe;break}}}}}class Ku{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Uh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const d in this.indexes){const y=this.indexes[d],b={};for(const T in y){const D=y[T];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+n),b[D.tileID.key]=D}this.indexes[d]=b}this.lng=t}addBucket(t,n,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let b=0;b<n.symbolInstances.length;b++)n.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const y=this.usedCrossTileIDs[t.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>t.overscaledZ)for(const D in T){const F=T[D];F.tileID.isChildOf(t)&&F.findMatches(n.symbolInstances,t,y)}else{const D=T[t.scaledTo(Number(b)).key];D&&D.findMatches(n.symbolInstances,t,y)}}for(let b=0;b<n.symbolInstances.length;b++){const T=n.symbolInstances.get(b);T.crossTileID||(T.crossTileID=d.generate(),y.add(T.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new tp(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const d of n.crossTileIDs)this.usedCrossTileIDs[t].delete(d)}removeStaleBuckets(t){let n=!1;for(const d in this.indexes){const y=this.indexes[d];for(const b in y)t[y[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,y[b]),delete y[b],n=!0)}return n}}class ip{constructor(){this.layerIndexes={},this.crossTileIDs=new Ku,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,d,y){let b=this.layerIndexes[t.fqid];b===void 0&&(b=this.layerIndexes[t.fqid]=new Uh);let T=!1;const D={};y.name!=="globe"&&b.handleWrapJump(d);for(const F of n){const V=F.getBucket(t);V&&t.fqid===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(F.tileID,V,this.crossTileIDs)&&(T=!0),D[V.bucketInstanceId]=!0)}return b.removeStaleBuckets(D)&&(T=!0),T}pruneUnusedLayers(t){const n={};t.forEach(d=>{n[d]=!0});for(const d in this.layerIndexes)n[d]||delete this.layerIndexes[d]}}const vl=771;class Xi{constructor(t,n,d,y){this.blendFunction=t,this.blendColor=n,this.mask=d,this.blendEquation=y}}Xi.Replace=[1,0,1,0],Xi.disabled=new Xi(Xi.Replace,r.aj.transparent,[!1,!1,!1,!1]),Xi.unblended=new Xi(Xi.Replace,r.aj.transparent,[!0,!0,!0,!0]),Xi.alphaBlended=new Xi([1,vl,1,vl],r.aj.transparent,[!0,!0,!0,!0]),Xi.alphaBlendedNonPremultiplied=new Xi([770,vl,770,vl],r.aj.transparent,[!0,!0,!0,!0]),Xi.multiply=new Xi([774,0,774,0],r.aj.transparent,[!0,!0,!0,!0]);class Si{constructor(t,n,d){this.func=t,this.mask=n,this.range=d}}Si.ReadOnly=!1,Si.ReadWrite=!0,Si.disabled=new Si(519,Si.ReadOnly,[0,1]);const jh=7680;class Oi{constructor(t,n,d,y,b,T){this.test=t,this.ref=n,this.mask=d,this.fail=y,this.depthFail=b,this.pass=T}}Oi.disabled=new Oi({func:519,mask:0},0,0,jh,jh,jh);const Qc=1029,xl=2305;class zi{constructor(t,n,d){this.enable=t,this.mode=n,this.frontFace=d}}function eu(u,t){const n=r.bG(u,3);r.ab.mat4.fromQuat(u,t),r.bI(u,3,n)}function qa(u,t){const n=r.ab.quat.identity([]);return r.ab.quat.rotateZ(n,n,-t),r.ab.quat.rotateX(n,n,-u),n}function Ju(u,t){const n=[u[0],u[1],0],d=[t[0],t[1],0];if(r.ab.vec3.length(n)>=1e-15){const T=r.ab.vec3.normalize([],n);r.ab.vec3.scale(d,T,r.ab.vec3.dot(d,T)),t[0]=d[0],t[1]=d[1]}const y=r.ab.vec3.cross([],t,u);if(r.ab.vec3.len(y)<1e-15)return null;const b=Math.atan2(-y[1],y[0]);return qa(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),b)}zi.disabled=new zi(!1,Qc,xl),zi.backCCW=new zi(!0,Qc,xl),zi.backCW=new zi(!0,Qc,2304),zi.frontCW=new zi(!0,1028,2304),zi.frontCCW=new zi(!0,1028,xl);class $h{constructor(t,n){this.position=t,this.orientation=n}get position(){return this._position}set position(t){if(t){const n=t instanceof r.aa?t:new r.aa(t[0],t[1],t[2]);this._renderWorldCopies&&(n.x=r.bF(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(t,n){if(this.orientation=null,!this.position)return;const d=this.position,y=this._elevation?this._elevation.getAtPointOrZero(r.aa.fromLngLat(t)):0,b=r.aa.fromLngLat(t,y),T=[b.x-d.x,b.y-d.y,b.z-d.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=Ju(T,n)}setPitchBearing(t,n){this.orientation=qa(r.ai(t),r.ai(-n))}}class so{constructor(t,n){this._transform=r.ab.mat4.identity([]),this.orientation=n,this.position=t}get mercatorPosition(){const t=this.position;return new r.aa(t[0],t[1],t[2])}get position(){const t=r.bG(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var n;t&&r.bI(this._transform,3,[(n=t)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||r.ab.quat.identity([]),t&&eu(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,n){this._orientation=qa(t,n),eu(this._transform,this._orientation)}forward(){const t=r.bG(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=r.bG(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=r.bG(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,n){const d=new Float64Array(16);return r.ab.mat4.invert(d,this.getWorldToCamera(t,n)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,n,d){const y=this.position;r.ab.vec3.scale(y,y,-t);const b=new Float64Array(16);return r.ab.mat4.fromScaling(b,[d,d,d]),r.ab.mat4.translate(b,b,y),b[10]*=n,b}getWorldToCamera(t,n){const d=new Float64Array(16),y=new Float64Array(4),b=this.position;return r.ab.quat.conjugate(y,this._orientation),r.ab.vec3.scale(b,b,-t),r.ab.mat4.fromQuat(d,y),r.ab.mat4.translate(d,d,b),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=n,d[9]*=n,d[10]*=n,d[11]*=n,d}getCameraToClipPerspective(t,n,d,y){const b=new Float64Array(16);return r.ab.mat4.perspective(b,t,n,d,y),b}getCameraToClipOrthographic(t,n,d,y,b,T){const D=new Float64Array(16);return r.ab.mat4.ortho(D,t,n,d,y,b,T),D}getDistanceToElevation(t,n=!1){const d=t===0?0:r.bH(t,n?r.aS(this.position[1]):this.position[1]),y=this.forward();return(d-this.position[2])/y[2]}clone(){return new so([...this.position],[...this.orientation])}}const Os={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ei{constructor(t=0,n=0,d=0,y=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(d)||d<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=d,this.right=y}interpolate(t,n,d){return n.top!=null&&t.top!=null&&(this.top=r.af(t.top,n.top,d)),n.bottom!=null&&t.bottom!=null&&(this.bottom=r.af(t.bottom,n.bottom,d)),n.left!=null&&t.left!=null&&(this.left=r.af(t.left,n.left,d)),n.right!=null&&t.right!=null&&(this.right=r.af(t.right,n.right,d)),this}getCenter(t,n){const d=r.aw((this.left+t-this.right)/2,0,t),y=r.aw((this.top+n-this.bottom)/2,0,n);return new r.P(d,y)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ei(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const rp=(u,t,n)=>(1-n)*u+n*t,Gh=u=>u*u*u*u*u;class za{constructor(t,n,d,y,b,T,D){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=d??0,this._maxPitch=y??60,this.setProjection(T),this.setMaxBounds(D),this.width=0,this.height=0,this._center=new r.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ei,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new so,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new za(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,n=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(t||d)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return r.ay(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=r.bP(this.projectionOptions);const d=this.getProjection(),y=!r.bn(n,d);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.bP({name:"mercator"});const n=t!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bF(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const n=-t*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=r.ab.mat2.create(),r.ab.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=r.aw(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=r.ai(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let y=0,b=0;for(let T=0;T<n.length;T++){const D=new r.P(n[T][0]*this.width,d+n[T][1]*(this.height-d)),F=t.pointCoordinate(D);if(!F)continue;const V=1/Math.hypot(F[0]-this._camera.position[0],F[1]-this._camera.position[1]);y+=F[3]*V,b+=V}return b===0?NaN:y/b}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*n,y=this._mercatorZfromZoom(t),b=this._mercatorZfromZoom(this._maxZoom),T=Math.max(y-d,b);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let d;d=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const y=r.ab.vec3.length(r.ab.vec3.sub([],this._camera.position,d));return r.aw(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!r.ab.quat.exactEquals(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const d=[t.position.x,t.position.y,t.position.z];r.ab.vec3.exactEquals(d,this._camera.position)||(this._setCameraPosition(d),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new $h;return n.position=new r.aa(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(t){if(!r.ab.quat.length(t))return!1;r.ab.quat.normalize(t,t);const n=r.ab.vec3.transformQuat([],[0,0,-1],t),d=r.ab.vec3.transformQuat([],[0,-1,0],t);if(d[2]<0)return!1;const y=Ju(n,d);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;t[2]=r.aw(t[2],y/d,y/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,d){this._unmodified=!1,this._edgeInsets.interpolate(t,n,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new r.bQ(0,t)];if(this.renderWorldCopies){const d=this.pointCoordinate(new r.P(0,0)),y=this.pointCoordinate(new r.P(this.width,0)),b=this.pointCoordinate(new r.P(this.width,this.height)),T=this.pointCoordinate(new r.P(0,this.height)),D=Math.floor(Math.min(d.x,y.x,b.x,T.x)),F=Math.floor(Math.max(d.x,y.x,b.x,T.x)),V=1;for(let j=D-V;j<=F+V;j++)j!==0&&n.push(new r.bQ(j,t))}return n}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,n,d){let y=[];const b=d!==void 0,T=!b;if(T&&this.zoom<n||b&&d[0]===0&&d[1]===0)return y;const D=new Set,F=(j,H,W,Q,ce)=>{const oe=r.c5(H,j,W,Q,ce);D.has(oe)||(y.push(new r.aG(j,H,W,Q,ce)),D.add(oe))};for(let j=0;j<t.length;j++){const H=t[j];if(T&&H.canonical.z!==n)continue;const W=H.canonical,Q=H.overscaledZ,ce=H.wrap,oe=1<<W.z,de=W.x+1<oe,pe=W.x>0,Se=W.y+1<oe,ke=W.y>0,Ie=H.wrap-(pe?0:1),Ue=H.wrap+(de?0:1),Le=pe?W.x-1:oe-1,Be=de?W.x+1:0;if(b)d[0]<0?(F(Q,Ue,W.z,Be,W.y),d[1]<0&&Se&&(F(Q,ce,W.z,W.x,W.y+1),F(Q,Ue,W.z,Be,W.y+1)),d[1]>0&&ke&&(F(Q,ce,W.z,W.x,W.y-1),F(Q,Ue,W.z,Be,W.y-1))):d[0]>0?(F(Q,Ie,W.z,Le,W.y),d[1]<0&&Se&&(F(Q,ce,W.z,W.x,W.y+1),F(Q,Ie,W.z,Le,W.y+1)),d[1]>0&&ke&&(F(Q,ce,W.z,W.x,W.y-1),F(Q,Ie,W.z,Le,W.y-1))):d[1]<0&&Se?F(Q,ce,W.z,W.x,W.y+1):ke&&F(Q,ce,W.z,W.x,W.y-1);else{const Oe=H.visibleQuadrants;1&Oe&&(F(Q,Ie,W.z,Le,W.y),ke&&(F(Q,ce,W.z,W.x,W.y-1),F(Q,Ie,W.z,Le,W.y-1))),2&Oe&&(F(Q,Ue,W.z,Be,W.y),ke&&(F(Q,ce,W.z,W.x,W.y-1),F(Q,Ue,W.z,Be,W.y-1))),4&Oe&&(F(Q,Ie,W.z,Le,W.y),Se&&(F(Q,ce,W.z,W.x,W.y+1),F(Q,Ie,W.z,Le,W.y+1))),8&Oe&&(F(Q,Ue,W.z,Be,W.y),Se&&(F(Q,ce,W.z,W.x,W.y+1),F(Q,Ue,W.z,Be,W.y+1)))}}const V=[];for(const j of y)y.some(H=>j.isChildOf(H))||V.push(j);if(y=V.filter(j=>!t.some(H=>!!(j.overscaledZ<n&&H.isChildOf(j))||j.equals(H)||j.isChildOf(H))),T){const j=1<<n,H=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=[j*H.x,j*H.y],Q=4,ce=Q*Q;y=y.filter(oe=>{const de=oe.canonical.x+.5-W[0],pe=oe.canonical.y+.5-W[1];return de*de+pe*pe<ce})}return y}coveringTiles(t){let n=this.coveringZoomLevel(t);const d=n,y=this.elevation&&this.elevation.exaggeration(),b=y&&!t.isTerrainDEM,T=this.projection.name==="mercator";if(t.minzoom!==void 0&&n<t.minzoom)return[];t.maxzoom!==void 0&&n>t.maxzoom&&(n=t.maxzoom);const D=this.locationCoordinate(this.center),F=this.center.lat,V=1<<n,j=[V*D.x,V*D.y,0],H=this.projection.name==="globe",W=!H,Q=r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,W),ce=H?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),oe=V*r.bH(1,this.center.lat),de=this._camera.position[2]/r.bH(1,this.center.lat),pe=[V*ce.x,V*ce.y,de*(W?1:oe)],Se=H||y,ke=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),Ie=this.isLODDisabled(!0)?n:0;let Ue;if(this._elevation&&t.isTerrainDEM)Ue=1e4*this._elevation.exaggeration();else if(this._elevation){const st=this._elevation.getMinMaxForVisibleTiles();Ue=st?st.max:this._centerAltitude}else Ue=this._centerAltitude;const Le=t.isTerrainDEM?-Ue:this._elevation?this._elevation.getMinElevationBelowMSL():0,Be=this.projection.isReprojectedInTileSpace?r.bS(this):1,Oe=st=>{const bt=new r.aa(st.x+25e-6,st.y,st.z),Kt=new r.aa(st.x,st.y+25e-6,st.z),Bt=st.toLngLat(),kt=bt.toLngLat(),$t=Kt.toLngLat(),Xt=this.locationCoordinate(Bt),ci=this.locationCoordinate(kt),di=this.locationCoordinate($t),Fi=Math.hypot(ci.x-Xt.x,ci.y-Xt.y),Mi=Math.hypot(di.x-Xt.x,di.y-Xt.y);return Math.sqrt(Fi*Mi)*Be/25e-6},He=st=>{const Dt=Ue,bt=Le;return{aabb:r.bV(this,V,0,0,0,st,bt,Dt,this.projection),zoom:0,x:0,y:0,minZ:bt,maxZ:Dt,wrap:st,fullyVisible:!1}},Qe=[];let xt=[];const ut=n,It=t.reparseOverscaled?d:n,At=(de-this._centerAltitude)*oe,ot=st=>{if(!this._elevation||!st.tileID||!T)return;const Dt=this._elevation.getMinMaxForTile(st.tileID),bt=st.aabb;Dt?(bt.min[2]=Dt.min,bt.max[2]=Dt.max,bt.center[2]=(bt.min[2]+bt.max[2])/2):(st.shouldSplit=Vt(st),st.shouldSplit||(bt.min[2]=bt.max[2]=bt.center[2]=this._centerAltitude))},wt=(st,Dt)=>{if(.707*Dt<st)return 1;const bt=Dt/st;return bt/(1.4144271570014144+(Math.pow(1.1,bt-1.4144271570014144+1)-1)/(1.1-1)-1)},Vt=st=>{if(st.zoom<Ie)return!0;if(st.zoom===ut)return!1;if(st.shouldSplit!=null)return st.shouldSplit;const Dt=st.aabb.distanceX(pe),bt=st.aabb.distanceY(pe);let Kt=At,Bt=1;if(H){Kt=st.aabb.distanceZ(pe);const Mi=Math.pow(2,st.zoom),Ei=r.aS((st.y+1)/Mi),ji=r.aS(st.y/Mi),pr=Math.min(Math.max(F,Ei),ji),Cr=r.c9(pr)/r.c9(F);if(Bt=pr===F?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Cr/this._mercatorScaleRatio),this.zoom<=r.c6&&st.zoom===ut-1&&Cr>=.9)return!0}else if(b&&(Kt=st.aabb.distanceZ(pe)*oe),this.projection.isReprojectedInTileSpace&&d<=5){const Mi=Math.pow(2,st.zoom),Ei=Oe(new r.aa((st.x+.5)/Mi,(st.y+.5)/Mi));Bt=Ei>.85?1:Ei}if(!T){const Mi=Math.sqrt(Dt*Dt+bt*bt+Kt*Kt);let Ei=(1<<ut-st.zoom)*ke*Bt;return Ei*=wt(Math.max(Kt,At),Mi),Mi<Ei}let kt=Number.MAX_VALUE,$t=0;const Xt=st.aabb.getCorners(),ci=[];for(const Mi of Xt){r.ab.vec3.sub(ci,Mi,pe),H||(b?ci[2]*=oe:ci[2]=At);const Ei=r.ab.vec3.dot(ci,this._camera.forward());Ei<kt&&(kt=Ei,$t=Math.abs(ci[2]))}let di=(1<<ut-st.zoom)*ke*Bt;if(di*=wt(Math.max($t,At),kt),kt<di)return!0;const Fi=st.aabb.closestPoint(j);return Fi[0]===j[0]&&Fi[1]===j[1]};if(this.renderWorldCopies)for(let st=1;st<=3;st++)Qe.push(He(-st)),Qe.push(He(st));for(Qe.push(He(0));Qe.length>0;){const st=Qe.pop(),Dt=st.x,bt=st.y;let Kt=st.fullyVisible;const Bt=()=>this.projection.name==="globe"&&(st.y===0||st.y===(1<<st.zoom)-1);if(!Kt){let kt=Se?st.aabb.intersects(Q):st.aabb.intersectsFlat(Q);if(kt===0&&Bt()){const $t=new r.bT(st.zoom,Dt,bt);kt=r.bU(this,V,$t,!0).intersects(Q)}if(kt===0)continue;Kt=kt===2}if(st.zoom!==ut&&Vt(st))for(let kt=0;kt<4;kt++){const $t=(Dt<<1)+kt%2,Xt=(bt<<1)+(kt>>1),ci={aabb:T?st.aabb.quadrant(kt):r.bV(this,V,st.zoom+1,$t,Xt,st.wrap,st.minZ,st.maxZ,this.projection),zoom:st.zoom+1,x:$t,y:Xt,wrap:st.wrap,fullyVisible:Kt,tileID:void 0,shouldSplit:void 0,minZ:st.minZ,maxZ:st.maxZ};b&&!H&&(ci.tileID=new r.aG(st.zoom+1===ut?It:st.zoom+1,st.wrap,st.zoom+1,$t,Xt),ot(ci)),Qe.push(ci)}else{const kt=st.zoom===ut?It:st.zoom;if(t.minzoom&&t.minzoom>kt)continue;let $t=0;if(!Kt){let Fi=Se?st.aabb.intersectsPrecise(Q):st.aabb.intersectsPreciseFlat(Q);if(Fi===0&&Bt()){const Mi=new r.bT(st.zoom,Dt,bt);Fi=r.bU(this,V,Mi,!0).intersectsPrecise(Q)}if(Fi===0)continue;if(t.calculateQuadrantVisibility)if(Q.containsPoint(st.aabb.center))$t=15;else for(let Mi=0;Mi<4;Mi++)st.aabb.quadrant(Mi).intersects(Q)!==0&&($t|=1<<Mi)}const Xt=j[0]-(.5+Dt+(st.wrap<<st.zoom))*(1<<n-st.zoom),ci=j[1]-.5-bt,di=st.tileID?st.tileID:new r.aG(kt,st.wrap,st.zoom,Dt,bt);t.calculateQuadrantVisibility&&(di.visibleQuadrants=$t),xt.push({tileID:di,distanceSq:Xt*Xt+ci*ci})}}if(this.fogCullDistSq){const st=this.fogCullDistSq,Dt=this.horizonLineFromTop();xt=xt.filter(bt=>{const Kt=[0,0,0,1],Bt=[r.ag,r.ag,0,1],kt=this.calculateFogTileMatrix(bt.tileID.toUnwrapped());r.ab.vec4.transformMat4(Kt,Kt,kt),r.ab.vec4.transformMat4(Bt,Bt,kt);const $t=r.ab.vec4.min([],Kt,Bt),Xt=r.ab.vec4.max([],Kt,Bt),ci=r.bW($t,Xt);if(ci===0)return!0;let di=!1;const Fi=this._elevation;if(Fi&&ci>st&&Dt!==0){const Mi=this.calculateProjMatrix(bt.tileID.toUnwrapped());let Ei;t.isTerrainDEM||(Ei=Fi.getMinMaxForTile(bt.tileID)),Ei||(Ei={min:Le,max:Ue});const ji=r.c7(this.rotation),pr=[ji[0]*r.ag,ji[1]*r.ag,Ei.max];r.ab.vec3.transformMat4(pr,pr,Mi),di=(1-pr[1])*this.height*.5<Dt}return ci<st||di})}return xt.sort((st,Dt)=>st.distanceSq-Dt.distanceSq).map(st=>st.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=r.aw(t.lat,-r.bX,r.bX),d=this.projection.project(t.lng,n);return new r.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,n){let d,y;const b=this.centerPoint;if(this.projection.name==="globe"){const D=this.worldSize;d=(n.x-b.x)/D,y=(n.y-b.y)/D}else{const D=this.pointCoordinate(n),F=this.pointCoordinate(b);d=D.x-F.x,y=D.y-F.y}const T=this.locationCoordinate(t);this.setLocation(new r.aa(T.x-d,T.y-y))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,n){const d=n?r.bH(n,t.lat):void 0,y=this.projection.project(t.lng,t.lat);return new r.aa(y.x,y.y,d)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,n){const d=n??this._centerAltitude,y=[t.x,t.y,0,1],b=[t.x,t.y,1,1];r.ab.vec4.transformMat4(y,y,this.pixelMatrixInverse),r.ab.vec4.transformMat4(b,b,this.pixelMatrixInverse);const T=b[3];r.ab.vec4.scale(y,y,1/y[3]),r.ab.vec4.scale(b,b,1/T);const D=y[2],F=b[2];return{p0:y,p1:b,t:D===F?0:(d-D)/(F-D)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],d=[t.x,t.y,1,1];return r.ab.vec4.transformMat4(n,n,this.pixelMatrixInverse),r.ab.vec4.transformMat4(d,d,this.pixelMatrixInverse),r.ab.vec4.scale(n,n,1/n[3]),r.ab.vec4.scale(d,d,1/d[3]),n[2]=r.bH(n[2],this._center.lat)*this.worldSize,d[2]=r.bH(d[2],this._center.lat)*this.worldSize,r.ab.vec4.scale(n,n,1/this.worldSize),r.ab.vec4.scale(d,d,1/this.worldSize),new r.aq([n[0],n[1],n[2]],r.ab.vec3.normalize([],r.ab.vec3.sub([],d,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:d,t:y}=t,b=r.bH(n[2],this._center.lat),T=r.bH(d[2],this._center.lat);return new r.aa(r.af(n[0],d[0],y)/this.worldSize,r.af(n[1],d[1],y)/this.worldSize,r.af(b,T,y))}pointCoordinate(t,n=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,n)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let n=this.projection.pointCoordinate3D(this,t.x,t.y);if(n)return new r.aa(n[0],n[1],n[2]);let d=0,y=this.horizonLineFromTop();if(t.y>y)return this.pointCoordinate(t);const b=.02*y,T=t.clone();for(let D=0;D<10&&y-d>b;D++){T.y=r.af(d,y,.66);const F=this.projection.pointCoordinate3D(this,T.x,T.y);F?(y=T.y,n=F):d=T.y}return n?new r.aa(n[0],n[1],n[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=r.bY)return!this.isPointAboveHorizon(t);const n=this.pointCoordinate(t);return n.y>=0&&n.y<=1}_coordinatePoint(t,n){const d=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,y=[t.x*this.worldSize,t.y*this.worldSize,d+t.toAltitude(),1];return r.ab.vec4.transformMat4(y,y,this.pixelMatrix),y[3]>0?new r.P(y[0]/y[3],y[1]/y[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:n}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,b=this.pointLocation3D(new r.P(n,t)),T=this.pointLocation3D(new r.P(y,t)),D=this.pointLocation3D(new r.P(y,d)),F=this.pointLocation3D(new r.P(n,d));let V=Math.min(b.lng,T.lng,D.lng,F.lng),j=Math.max(b.lng,T.lng,D.lng,F.lng),H=Math.min(b.lat,T.lat,D.lat,F.lat),W=Math.max(b.lat,T.lat,D.lat,F.lat);const Q=Math.pow(2,-this.zoom)/16*270,ce=this.projection.name==="globe"?1:4,oe=(de,pe,Se,ke,Ie)=>{const Ue=(de+Se)/2,Le=(pe+ke)/2,Be=new r.P(Ue,Le),{lng:Oe,lat:He}=this.pointLocation3D(Be),Qe=Math.max(0,V-Oe,H-He,Oe-j,He-W);V=Math.min(V,Oe),j=Math.max(j,Oe),H=Math.min(H,He),W=Math.max(W,He),(Ie<ce||Qe>Q)&&(oe(de,pe,Ue,Le,Ie+1),oe(Ue,Le,Se,ke,Ie+1))};if(oe(n,t,y,t,1),oe(y,t,y,d,1),oe(y,d,n,d,1),oe(n,d,n,t,1),this.projection.name==="globe"){const[de,pe]=r.bZ(this);de?(W=90,j=180,V=-180):pe&&(H=-90,j=180,V=-180)}return new r.az(new r.bO(V,H),new r.bO(j,W))}_getBoundsRectangular(t,n){const{top:d,left:y}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,D=new r.P(y,d),F=new r.P(T,d),V=new r.P(T,b),j=new r.P(y,b);let H=this.pointCoordinate(D,t),W=this.pointCoordinate(F,t);const Q=this.pointCoordinate(V,n),ce=this.pointCoordinate(j,n),oe=(de,pe)=>(pe.y-de.y)/(pe.x-de.x);return H.y>1&&W.y>=0?H=new r.aa((1-ce.y)/oe(ce,H)+ce.x,1):H.y<0&&W.y<=1&&(H=new r.aa(-ce.y/oe(ce,H)+ce.x,0)),W.y>1&&H.y>=0?W=new r.aa((1-Q.y)/oe(Q,W)+Q.x,1):W.y<0&&H.y<=1&&(W=new r.aa(-Q.y/oe(Q,W)+Q.x,0)),new r.az().extend(this.coordinateLocation(H)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(ce)).extend(this.coordinateLocation(Q))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const n=t.visibleDemTiles.reduce((d,y)=>{if(y.dem){const b=y.dem.tree;d.min=Math.min(d.min,b.minimums[0]),d.max=Math.max(d.max,b.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*t.exaggeration(),n.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-n*(1-this._horizonShift);return t?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-r.bX,this.maxLat=r.bX,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.at(this.minLng)*this.tileSize,this.worldMaxX=r.at(this.maxLng)*this.tileSize,this.worldMinY=r.aA(this.maxLat)*this.tileSize,this.worldMaxY=r.aA(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,n){return this.projection.createTileMatrix(this,n,t)}calculateDistanceTileData(t){const n=t.key,d=this._distanceTileDataCache;if(d[n])return d[n];const y=t.canonical,b=1/this.height,T=this.cameraWorldSize,D=T/this.zoomScale(y.z),F=(y.x+Math.pow(2,y.z)*t.wrap)*D,V=y.y*D,j=this.point;j.x*=T/this.worldSize,j.y*=T/this.worldSize;const H=this.angle,W=Math.sin(-H),Q=-Math.cos(-H);return d[n]={bearing:[W,Q],center:[(j.x-F)*b,(j.y-V)*b],scale:D/r.ag*b},d[n]}calculateFogTileMatrix(t){const n=t.key,d=this._fogTileMatrixCache;if(d[n])return d[n];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return r.ab.mat4.multiply(y,this.worldToFogMatrix,y),d[n]=new Float32Array(y),d[n]}calculateProjMatrix(t,n=!1,d=!1){const y=t.key;let b;if(b=d?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,b[y])return b[y];const T=this.calculatePosMatrix(t,this.worldSize);let D;return D=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,r.ab.mat4.multiply(T,D,T),b[y]=new Float32Array(T),b[y]}calculatePixelsToTileUnitsMatrix(t){const n=t.tileID.key,d=this._pixelsToTileUnitsCache;if(d[n])return d[n];const y=r.b_(t,this);return d[n]=y,d[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,n=r.ab.mat4.fromScaling([],[t,t,t]);return r.ab.mat4.multiply(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const n=r.bH(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(n),y=this._camera.forward(),b=r.bH(1,this._center.lat);d[2]/=b,y[2]/=b,r.ab.vec3.normalize(y,y);const T=t.raycast(d,y,t.exaggeration());if(T){const D=r.ab.vec3.scaleAndAdd([],d,y,T),F=new r.aa(D[0],D[1],r.bH(D[2],r.aS(D[1]))),V=(F.z+r.ab.vec3.length([F.x-d[0],F.y-d[1],F.z-d[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(V),this._centerAltitude=F.toAltitude(),this._center=this.coordinateLocation(F),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const n=this._elevation,d=r.bH(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(d),b=n.getAtPointOrZero(new r.aa(...y)),T=this.pixelsPerMeter/this.worldSize*b,D=this._minimumHeightOverTerrain(),F=y[2]-T;if(F<=D)if(F<0||t){const V=this.locationCoordinate(this._center,this._centerAltitude),j=[y[0],y[1],V.z-y[2]],H=r.ab.vec3.length(j);j[2]-=(D-F)/this._pixelsPerMercatorPixel;const W=r.ab.vec3.length(j);if(W===0)return;r.ab.vec3.scale(j,j,H/W*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],V.z*this._pixelsPerMercatorPixel-j[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const W=this.center;return W.lat=r.aw(W.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(W.lng=r.aw(W.lng,this.minLng,this.maxLng)),this.center=W,void(this._constraining=!1)}const n=this._unmodified,{x:d,y}=this.point;let b=0,T=d,D=y;const F=this.width/2,V=this.height/2,j=this.worldMinY*this.scale,H=this.worldMaxY*this.scale;if(y-V<j&&(D=j+V),y+V>H&&(D=H-V),H-j<this.height&&(b=Math.max(b,this.height/(H-j)),D=(H+j)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const W=this.worldMinX*this.scale,Q=this.worldMaxX*this.scale,ce=this.worldSize/2-(W+Q)/2;T=(d+ce+this.worldSize)%this.worldSize-ce,T-F<W&&(T=W+F),T+F>Q&&(T=Q-F),Q-W<this.width&&(b=Math.max(b,this.width/(Q-W)),T=(Q+W)/2)}T===d&&D===y||(this.center=this.unproject(new r.P(T,D))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.bH(1,this.center.lat)/r.bH(1,r.c8));const y=r.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?d:1,T=this._camera.getWorldToCamera(this.worldSize,b);let D;const F=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(F[8]=2*-t.x/this.width,F[9]=2*t.y/this.height,this.isOrthographic){let He=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Qe=He*this.aspect,xt=-Qe,ut=-He;Qe-=t.x,xt-=t.x,He+=t.y,ut+=t.y,D=this._camera.getCameraToClipOrthographic(xt,Qe,ut,He,this._nearZ,this._farZ),((It,At,ot,wt)=>{for(let Vt=0;Vt<16;Vt++)It[Vt]=rp(At[Vt],ot[Vt],wt)})(D,D,F,Gh(this.pitch>=15?1:this.pitch/15))}else D=F;const V=r.ab.mat4.mul([],F,T);let j=r.ab.mat4.mul([],D,T);if(this.projection.isReprojectedInTileSpace){const He=this.locationCoordinate(this.center),Qe=r.ab.mat4.identity([]);r.ab.mat4.translate(Qe,Qe,[He.x*this.worldSize,He.y*this.worldSize,0]),r.ab.mat4.multiply(Qe,Qe,r.c0(this)),r.ab.mat4.translate(Qe,Qe,[-He.x*this.worldSize,-He.y*this.worldSize,0]),r.ab.mat4.multiply(j,j,Qe),r.ab.mat4.multiply(V,V,Qe),this.inverseAdjustmentMatrix=r.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.ab.mat4.scale([],j,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=j,this.invProjMatrix=r.ab.mat4.invert(new Float64Array(16),this.projMatrix),n){const He=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);He[8]=2*-t.x/this.width,He[9]=2*t.y/this.height,this.expandedFarZProjMatrix=r.ab.mat4.mul([],He,T)}else this.expandedFarZProjMatrix=this.projMatrix;const H=r.ab.mat4.invert([],D);this.frustumCorners=r.c2.fromInvProjectionMatrix(H,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const W=new Float32Array(16);r.ab.mat4.identity(W),r.ab.mat4.scale(W,W,[1,-1,1]),r.ab.mat4.rotateX(W,W,this._pitch),r.ab.mat4.rotateZ(W,W,this.angle);const Q=r.ab.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.ab.mat4.clone(Q);const ce=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Q[8]=2*-t.x/this.width,Q[9]=2*(t.y+ce)/this.height,this.skyboxMatrix=r.ab.mat4.multiply(W,Q,W);const oe=this.point,de=oe.x,pe=oe.y,Se=this.width%2/2,ke=this.height%2/2,Ie=Math.cos(this.angle),Ue=Math.sin(this.angle),Le=de-Math.round(de)+Ie*Se+Ue*ke,Be=pe-Math.round(pe)+Ie*ke+Ue*Se,Oe=new Float64Array(j);if(r.ab.mat4.translate(Oe,Oe,[Le>.5?Le-1:Le,Be>.5?Be-1:Be,0]),this.alignedProjMatrix=Oe,j=r.ab.mat4.create(),r.ab.mat4.scale(j,j,[this.width/2,-this.height/2,1]),r.ab.mat4.translate(j,j,[1,-1,0]),this.labelPlaneMatrix=j,j=r.ab.mat4.create(),r.ab.mat4.scale(j,j,[1,-1,1]),r.ab.mat4.translate(j,j,[-1,-1,0]),r.ab.mat4.scale(j,j,[2/this.width,2/this.height,1]),this.glCoordMatrix=j,this.pixelMatrix=r.ab.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,V),this._calcFogMatrices(),this._distanceTileDataCache={},j=r.ab.mat4.invert(new Float64Array(16),this.pixelMatrix),!j)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=j,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.c3(this);const He=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.ab.vec3.transformMat4(He,He,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=j;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,d=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,b=[t,t,n];r.ab.vec3.scale(b,b,y),r.ab.vec3.scale(d,d,-1),r.ab.vec3.multiply(d,d,b);const T=r.ab.mat4.create();r.ab.mat4.translate(T,T,d),r.ab.mat4.scale(T,T,b),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,y)}_computeCameraPosition(t){const n=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),y=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-t/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-d[0]*b,y.y/this.worldSize-d[1]*b,t/this.worldSize*this._centerAltitude-d[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],y=t[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(b=Math.min((n-d)/y,1)),this._camera.position=r.ab.vec3.scaleAndAdd([],this._camera.position,t,b),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:d,bearing:y}=this._camera.getPitchBearing(),b=r.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.ai(this._maxPitch)),D=Math.max((t[2]-b)/Math.cos(d),T),F=this._zoomFromMercatorZ(D);r.ab.vec3.scaleAndAdd(t,t,n,D),this._pitch=r.aw(d,r.ai(this.minPitch),r.ai(this.maxPitch)),this.angle=r.bF(y,-Math.PI,Math.PI),this._setZoom(r.aw(F,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.aa(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let n=0,d=r.bY,y=0,b=1/0;for(;d-n>1e-6&&d>n;){const T=n+.5*(d-n),D=this.tileSize*Math.pow(2,T),F=this.getCameraToCenterDistance(this.projection,T,D),V=this.scaleZoom(F/(t*this.tileSize)),j=Math.abs(T-V);j<b&&(b=j,y=T),T<V?n=T:d=T}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,n){const d=Math.min(t.x,n.x),y=Math.max(t.x,n.x),b=Math.min(t.y,n.y),T=Math.max(t.y,n.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const D=[new r.P(d,b),new r.P(y,T),new r.P(d,T),new r.P(y,b)],F=this.renderWorldCopies?-3:0,V=this.renderWorldCopies?4:1;for(const j of D){const H=this.pointRayIntersection(j);if(H.t<0)return!0;const W=this.rayIntersectionCoordinate(H);if(W.x<F||W.y<0||W.x>V||W.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(t,n){const d=r.ab.vec3.length(r.ab.vec3.sub([],this._camera.position,t)),y=this._zoomFromMercatorZ(d)+n;return d-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([n,d,y],b){const T=[n,d,y,1];r.ab.vec4.transformMat4(T,T,b);const D=T[3]=Math.max(T[3],1e-6);return T[0]/=D,T[1]/=D,T[2]/=D,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,t))}}getCameraToCenterDistance(t,n=this.zoom,d=this.worldSize){const y=r.b$(t,n,this.width,this.height,1024),b=t.pixelSpaceConversion(this.center.lat,d,y);let T=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(T=rp(1,T,Gh(this.pitch>=15?1:this.pitch/15))),T}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.ab.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const bl=(u,t)=>{if(t>0&&u.terrain&&r.w("Cutoff is currently disabled on terrain"),t<=0||u.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const n=u.transform,d=Math.max(Math.abs(n._zoom-(u.minCutoffZoom-1)),1),y=n.isLODDisabled(!1)?r.ac(60,45,n.pitch):r.ac(30,15,n.pitch),b=n._farZ-n._nearZ,T=t*n.height,D=((1-(F=y))*n.cameraToCenterDistance+F*(n._farZ+T))*d;var F;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(D-n._nearZ)/b,(D-T-n._nearZ)/b]}}},fs={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Ya{constructor(t,n){this.aabb=t,this.lastCascade=n}}class np{add(t,n){const d=this.receivers[t.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],n.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],n.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],n.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],n.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],n.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],n.max[2])):this.receivers[t.key]=new Ya(n,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,n,d){const y=r.cd.fromPoints(t.points);let b=0;for(const T in this.receivers){const D=this.receivers[T];if(!D||!y.intersectsAabb(D.aabb))continue;D.aabb.min=y.closestPoint(D.aabb.min),D.aabb.max=y.closestPoint(D.aabb.max);const F=D.aabb.getCorners();for(let V=0;V<d.length;V++){let j=!0;for(const H of F){const W=[H[0]*n,H[1]*n,H[2]];if(r.ab.vec3.transformMat4(W,W,d[V].matrix),W[0]<-1||W[0]>1||W[1]<-1||W[1]>1){j=!1;break}}if(D.lastCascade=V,b=Math.max(b,V),j)break}}return b+1}}class ic{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new np,this._depthMode=new Si(t.context.gl.LEQUAL,Si.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(fs,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(fs,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(fs,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,n){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const y=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||y<=0||(this._shadowLayerCount=d.style.order.reduce((ce,oe)=>{const de=d.style._mergedLayers[oe];return ce+(de.hasShadowPass()&&!de.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const b=d.context,T=fs.shadowMapResolution,D=fs.shadowMapResolution;if(this._cascades.length===0||fs.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ce=0;ce<fs.cascadeCount;++ce){const oe=d._shadowMapDebug,de=b.gl,pe=b.createFramebuffer(T,D,oe,"texture"),Se=new r.T(b,{width:T,height:D,data:null},de.DEPTH_COMPONENT16);if(pe.depthAttachment.set(Se.texture),oe){const ke=new r.T(b,{width:T,height:D,data:null},de.RGBA8);pe.colorAttachment.set(ke.texture)}this._cascades.push({framebuffer:pe,texture:Se,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.bR,scale:0})}}this.shadowDirection=nc(n);let F=0;if(t.elevation){const ce=t.elevation,oe=[1e4,-1e4];ce.visibleDemTiles.filter(de=>de.dem).forEach(de=>{const pe=de.dem.tree;oe[0]=Math.min(oe[0],pe.minimums[0]),oe[1]=Math.max(oe[1],pe.maximums[0])}),oe[0]!==1e4&&(F=(oe[1]-oe[0])*ce.exaggeration())}const V=1.5*t.cameraToCenterDistance,j=3*V,H=new Float64Array(16);for(let ce=0;ce<this._cascades.length;++ce){const oe=this._cascades[ce];let de=t.height/50,pe=1;fs.cascadeCount===1?pe=j:ce===0?pe=V:(de=V,pe=j);const[Se,ke]=$m(t,this.shadowDirection,de,pe,fs.shadowMapResolution,F);oe.scale=t.scale,oe.matrix=Se,oe.boundingSphereRadius=ke,r.ab.mat4.invert(H,oe.matrix),oe.frustum=r.bR.fromInvProjectionMatrix(H,1,0,!0),oe.far=pe}const W=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[W].far,this._cascades[W].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/fs.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=fs.shadowMapResolution,this._uniformValues.u_shadowmap_0=Os.ShadowMap0,this._uniformValues.u_shadowmap_1=Os.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Q=d.transform.elevation;for(const ce of this._groundShadowTiles){let oe={min:0,max:0};if(Q){const de=Q.getMinMaxForTile(ce);de&&(oe=de)}this.addShadowReceiver(ce.toUnwrapped(),oe.min,oe.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,n){if(!this.enabled)return;const d=this.painter,y=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),y.viewport.set([0,0,fs.shadowMapResolution,fs.shadowMapResolution]);for(let b=0;b<this._numCascadesToRender;++b){d.currentShadowCascade=b,y.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),y.clear({color:r.aj.white,depth:1});for(const T of t.order){const D=t._mergedLayers[T];if(!D.hasShadowPass()||D.isHidden(d.transform.zoom))continue;const F=t.getLayerSourceCache(D),V=F?n[F.id]:void 0;(D.type==="model"||V&&V.length)&&d.renderLayer(d,F,D,V)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,n=t.style,d=t.context,y=n.directionalLight,b=n.ambientLight;if(!y||!b)return;const T=[],D=bl(t,t.longestCutoffRange);D.shouldRenderCutoff&&T.push("RENDER_CUTOFF"),T.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&T.push("NORMAL_OFFSET");const F=Hh(n,y,b),V=new Si(d.gl.LEQUAL,Si.ReadOnly,t.depthRangeFor3D);for(const j of this._groundShadowTiles){const H=j.toUnwrapped(),W=t.isTileAffectedByFog(j),Q=t.getOrCreateProgram("groundShadow",{defines:T,overrideFog:W});this.setupShadows(H,Q),t.uploadCommonUniforms(d,Q,H,null,D);const ce={u_matrix:t.transform.calculateProjMatrix(H),u_ground_shadow_factor:F};Q.draw(t,d.gl.TRIANGLES,V,Oi.disabled,Xi.multiply,zi.disabled,ce,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Xi.unblended:Xi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const n=this.painter.transform,d=n.calculatePosMatrix(t,n.worldSize);return r.ab.mat4.multiply(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(t){return r.ab.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,n,d,y=0){if(!this.enabled)return;const b=this.painter.transform,T=this.painter.context,D=T.gl,F=this._uniformValues,V=new Float64Array(16),j=b.calculatePosMatrix(t,b.worldSize);for(let H=0;H<this._cascades.length;H++)r.ab.mat4.multiply(V,this._cascades[H].matrix,j),F[H===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(V),T.activeTexture.set(D.TEXTURE0+Os.ShadowMap0+H),this._cascades[H].texture.bind(D.NEAREST,D.CLAMP_TO_EDGE);if(this.useNormalOffset=!!d,this.useNormalOffset){const H=r.cc(t.canonical),W=2/b.tileSize*r.ag/fs.shadowMapResolution,Q=W*this._cascades[0].boundingSphereRadius,ce=W*this._cascades[this._cascades.length-1].boundingSphereRadius,oe=(d==="vector-tile"?1:3)/Math.pow(2,y-t.canonical.z-(1-b.zoom+Math.floor(b.zoom)));F.u_shadow_normal_offset=[H,Q*oe,ce*oe],F.u_shadow_bias=[6e-5,.0012,.012]}else F.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(T,F)}setupShadowsFromMatrix(t,n,d=!1){if(!this.enabled)return;const y=this.painter.context,b=y.gl,T=this._uniformValues,D=new Float64Array(16);for(let F=0;F<fs.cascadeCount;F++)r.ab.mat4.multiply(D,this._cascades[F].matrix,t),T[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),y.activeTexture.set(b.TEXTURE0+Os.ShadowMap0+F),this._cascades[F].texture.bind(b.NEAREST,b.CLAMP_TO_EDGE);if(this.useNormalOffset=d,d){const F=fs.normalOffset;T.u_shadow_normal_offset=[1,F,F],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(y,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,n,d,y){if(y[2]>=0)return{};const b=function(F,V,j){const H=j/(1<<F.canonical.z);return new r.cd([F.canonical.x*H+F.wrap*j,F.canonical.y*H+F.wrap*j,0],[(F.canonical.x+1)*H+F.wrap*j,(F.canonical.y+1)*H+F.wrap*j,V])}(t,n,d).getCorners(),T=n/-y[2];y[0]<0?(r.ab.vec3.add(b[0],b[0],[y[0]*T,0,0]),r.ab.vec3.add(b[3],b[3],[y[0]*T,0,0])):y[0]>0&&(r.ab.vec3.add(b[1],b[1],[y[0]*T,0,0]),r.ab.vec3.add(b[2],b[2],[y[0]*T,0,0])),y[1]<0?(r.ab.vec3.add(b[0],b[0],[0,y[1]*T,0]),r.ab.vec3.add(b[1],b[1],[0,y[1]*T,0])):y[1]>0&&(r.ab.vec3.add(b[2],b[2],[0,y[1]*T,0]),r.ab.vec3.add(b[3],b[3],[0,y[1]*T,0]));const D={};return D.vertices=b,D.planes=[rc(b[1],b[0],b[4]),rc(b[2],b[1],b[5]),rc(b[3],b[2],b[6]),rc(b[0],b[3],b[7])],D}addShadowReceiver(t,n,d){this._receivers.add(t,r.cd.fromTileIdAndHeight(t,n,d))}getMaxCascadeForTile(t){const n=this._receivers.get(t);return n&&n.lastCascade?n.lastCascade:0}}function rc(u,t,n){const d=r.ab.vec3.sub([],n,t),y=r.ab.vec3.sub([],u,t),b=r.ab.vec3.cross([],d,y),T=r.ab.vec3.length(b);return T===0?[0,0,1,0]:(r.ab.vec3.scale(b,b,1/T),[b[0],b[1],b[2],-r.ab.vec3.dot(b,t)])}function nc(u){const t=u.properties.get("direction"),n=r.cb(t.x,t.y,t.z);n[2]=r.aw(n[2],0,75);const d=r.ce([n[0],n[1],n[2]]);return r.ab.vec3.fromValues(d.x,d.y,d.z)}function Hh(u,t,n){const d=t.properties.get("color-use-theme")==="none",y=t.properties.get("color"),b=t.properties.get("intensity"),T=t.properties.get("direction"),D=[T.x,T.y,T.z],F=n.properties.get("color-use-theme")==="none",V=n.properties.get("color"),j=n.properties.get("intensity"),H=Math.max(r.ab.vec3.dot([0,0,1],D),0),W=[0,0,0];r.ab.vec3.scale(W,V.toRenderColor(F?null:u.getLut(t.scope)).toArray01Linear().slice(0,3),j);const Q=[0,0,0];return r.ab.vec3.scale(Q,y.toRenderColor(d?null:u.getLut(n.scope)).toArray01Linear().slice(0,3),H*b),r.cf([W[0]>0?W[0]/(W[0]+Q[0]):0,W[1]>0?W[1]/(W[1]+Q[1]):0,W[2]>0?W[2]/(W[2]+Q[2]):0])}function $m(u,t,n,d,y,b){const T=u.zoom,D=u.scale,F=u.worldSize,V=1/F,j=u.aspect,H=Math.sqrt(1+j*j)*Math.tan(.5*u.fovX),W=H*H,Q=d-n,ce=d+n;let oe,de;W>Q/ce?(oe=d,de=d*H):(oe=.5*ce*(1+W),de=.5*Math.sqrt(Q*Q+2*(d*d+n*n)*W+ce*ce*W*W));const pe=u.projection.pixelsPerMeter(u.center.lat,F),Se=u._camera.getCameraToWorldMercator(),ke=[0,0,-oe*V];r.ab.vec3.transformMat4(ke,ke,Se);let Ie=de*V;const Ue=u._edgeInsets;if(!(Ue.left===0&&Ue.top===0&&Ue.right===0&&Ue.bottom===0||Ue.left===Ue.right&&Ue.top===Ue.bottom)){const Kt=u._camera.getWorldToCamera(u.worldSize,u.projection.zAxisUnit==="meters"?pe:1),Bt=u._camera.getCameraToClipPerspective(u._fov,u.width/u.height,n,d);Bt[8]=2*-u.centerOffset.x/u.width,Bt[9]=2*u.centerOffset.y/u.height;const kt=new Float64Array(16);r.ab.mat4.mul(kt,Bt,Kt);const $t=new Float64Array(16);r.ab.mat4.invert($t,kt);const Xt=r.bR.fromInvProjectionMatrix($t,F,T,!0);for(const ci of Xt.points){const di=((Le=ci)[0]/=D,Le[1]/=D,Le[2]=r.bH(Le[2],u._center.lat),Le);Ie=Math.max(Ie,r.ab.vec3.len(r.ab.vec3.subtract([],ke,di)))}}var Le;Ie*=y/(y-1);const Be=Math.acos(t[2]),Oe=Math.atan2(-t[0],-t[1]),He=new so;He.position=ke,He.setPitchBearing(Be,Oe);const Qe=He.getWorldToCamera(F,pe),xt=Ie*F,ut=Math.min(u._mercatorZfromZoom(17)*F*-2,-2*xt),It=He.getCameraToClipOrthographic(-xt,xt,-xt,xt,ut,(xt+b*pe)/t[2]),At=new Float64Array(16);r.ab.mat4.multiply(At,It,Qe);const ot=r.ab.vec3.fromValues(Math.floor(1e6*ke[0])/1e6*F,Math.floor(1e6*ke[1])/1e6*F,0),wt=.5*y,Vt=[0,0,0];r.ab.vec3.transformMat4(Vt,ot,At),r.ab.vec3.scale(Vt,Vt,wt);const st=[Math.floor(Vt[0]),Math.floor(Vt[1]),Math.floor(Vt[2])],Dt=[0,0,0];r.ab.vec3.sub(Dt,Vt,st),r.ab.vec3.scale(Dt,Dt,-1/wt);const bt=new Float64Array(16);return r.ab.mat4.identity(bt),r.ab.mat4.translate(bt,bt,Dt),r.ab.mat4.multiply(At,bt,At),[At,xt]}class sc extends r.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(t,n){return r.aM(this.requestManager.transformRequest(n,r.R.Model).url).then(d=>{if(!d)return;const y=r.aN(d),b=new r.aO(t,void 0,void 0,y);return b.computeBoundsAndApplyParent(),b}).catch(d=>{if(d&&d.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${t} from ${n}: ${d.message}`)))})}load(t,n,d={keepNumReferences:!1}){this.models[n]||(this.models[n]={});const y=Object.keys(t);this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+y.length;const b=[];for(const T of y)b.push(this.loadModel(T,t[T]));Promise.allSettled(b).then(T=>{for(let D=0;D<T.length;D++){const{status:F,value:V}=T[D];if(F==="fulfilled"&&V){const j=this.models[n][y[D]];this.models[n][y[D]]={model:V,numReferences:d.keepNumReferences&&j?j.numReferences:1}}}this.numModelsLoading[n]-=y.length,this.fire(new r.z("data",{dataType:"style"}))}).catch(T=>{this.fire(new r.y(new Error(`Could not load models: ${T.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,n){return!!this.getModel(t,n)}getModel(t,n){return this.models[n]||(this.models[n]={}),this.models[n][t]?this.models[n][t].model:void 0}addModel(t,n,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={}),this.hasModel(t,d)&&this.models[d][t].numReferences++,this.modelUris[d][t]=this.requestManager.normalizeModelURL(n),this.load({[t]:this.modelUris[d][t]},d)}addModels(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const d=this.modelUris[n];for(const y in t)this.models[n][y]={},d[y]=this.requestManager.normalizeModelURL(t[y]);this.load(d,n,{keepNumReferences:!0})}reloadModels(t){this.load(this.modelUris[t],t)}addModelsFromBucket(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const d={};for(const y of t)this.hasModel(y,n)?this.models[n][y].numReferences++:(this.modelUris[n][y]=this.requestManager.normalizeModelURL(y),d[y]=this.modelUris[n][y]);this.load(d,n)}removeModel(t,n){if(this.models[n]&&this.models[n][t]&&(this.models[n][t].numReferences--,this.models[n][t].numReferences===0)){const d=this.models[n][t].model;delete this.models[n][t],delete this.modelUris[n][t],d.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,n){this.models[n]||(this.models[n]={});for(const d in this.models[n])this.models[n][d].model&&this.models[n][d].model.upload(t.context)}}const oc=new r.a5({data:new r.a6(r.a3.colorTheme.data)}),_f={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function sp(u){return u=u||{},Object.assign(u,_f)}class op extends r.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},r.aP(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new r.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(T,D){const[F,V]=T,{center:j,radius:H}=D,[W,Q]=j,ce=Math.abs(F-W);return Math.sqrt((ce>180?360-ce:ce)**2+(V-Q)**2)<=H}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new r.z("floorplangone")));const n={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},d=new r.P(this._map.transform.width/2,this._map.transform.height/2),y=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],b=this._map.queryRenderedFeatures(t?y:d,n);b.length>0&&(this._selectedFloorplan&&b[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=b[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(b){const[[T,D],[F,V]]=b,j=(F-T+360)%360,H=j>180?360-j:j;return{center:[(T+H/2+360)%360,(D+V)/2],radius:Math.sqrt(H**2+(V-D)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const n=this._floorplanStates[this._indoorData.id].selectedBuilding,d=this._floorplanStates[this._indoorData.id].selectedLevel;let y;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const b of this._indoorData.levels)b.id===this._selectedLevel.id&&(y=b.id);if(this.fire(new r.z("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:y})),n){const b=this._indoorData.buildings.find(T=>T.id===n);this._buildingSelected(b,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(d){const b=this._indoorData.levels.find(T=>T.id===d);this._updateLevels(b,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,n){n&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const d=this._indoorData.levels.filter(y=>t.levels.includes(y.id));this.fire(new r.z("buildingselected",{buildingId:t.id,levels:d}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{const n=this._indoorData.levels.find(d=>d.id===t);this._updateLevels(n,!0)}this.fire(new r.z("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,n){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(n&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function d(V){const j=V.indexOf("/floor/");if(j===-1)return V;const H=j+7,W=V.indexOf("/",H);return W===-1?V.slice(H):V.slice(H,W)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const y=[],b={},T={},D={},F={};for(const V of this._indoorData.levels)if(y.push(V.id),b[V.id]=V.height,T[V.id]=V.base,t){if(this.mergeFloors){const j=d(t.id),H=d(V.id);D[V.id]=H===j?"true":"false"}else D[V.id]=V.id===t.id?"true":"false";F[V.id]=V.base<t.base?"true":"false"}else F[V.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",y]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",b]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",T]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",D]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",F]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),n&&t.extent)){const V=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),j=this._map.getZoom(),H=V.zoom?Math.abs(j-V.zoom):0;this._map.fitBounds(t.extent,H>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:j})}}selectFloorplan(t){const n={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},d=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],y=this._map.queryRenderedFeatures(d,n);if(y.length>0){for(const b of y)if(JSON.parse(b.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=b,this._floorplanSelected(!0);break}}}selectBuilding(t){const n=this._indoorData.buildings.find(d=>d.id===t);this._buildingSelected(n,!0)}selectLevel(t){this._levelSelected(t)}}function Gm(u){if(!u.metadata||!u.metadata.content_area)return;const t=r.q.devicePixelRatio,{left:n,top:d,width:y,height:b}=u.metadata.content_area,T=n*t,D=d*t;return[T,D,T+y*t,D+b*t]}function yf(u){if(u)return u.map(([t,n])=>[t*r.q.devicePixelRatio,n*r.q.devicePixelRatio])}const Fa=(u,t)=>Ho(u,t&&t.filter(n=>n.identifier!=="source.canvas")),ap=r.ay(Ji,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),vf=r.ay(Ji,["setCenter","setZoom","setBearing","setPitch"]),tu=new Set(["background","sky","slot","custom"]),ac={version:8,layers:[],sources:{}},xf={duration:300,delay:0};class Lo extends r.E{constructor(t,n={}){super(),this.map=t,this.scope=n.scope||"",this.globalId=null,this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=r.l({},xf),this._buildingIndex=new Xd(this),this.crossTileSymbolIndex=new ip,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new Xs,this.dispatcher=n.dispatcher?n.dispatcher:new r.D(r.ci(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new jn(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new r.cj(t._requestManager,n.localFontFamily?r.ck.all:n.localIdeographFontFamily?r.ck.ideographs:r.ck.none,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new sc(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=n.configOptions?n.configOptions:new Map,this._configDependentLayers=n.configDependentLayers?n.configDependentLayers:new Set,this._config=n.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:n.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=n.initialConfig,this.dispatcher.broadcast("setReferrer",r.cl());const d=this;this._rtlTextPluginCallback=Lo.registerForPluginStateChange(y=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(b,T)=>{if(r.cm(b),T&&T.every(D=>D))for(const D in d._sourceCaches){const F=d._sourceCaches[D],V=F.getSource().type;V!=="vector"&&V!=="geojson"||F.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const b=this.getOwnSource(y.sourceId);if(b&&b.vectorLayerIds)for(const T in this._layers){const D=this._layers[T];D.source===b.id&&this._validateLayer(D)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(r.f(t))return t;const n=r.cn(t);if(!n.startsWith("http"))try{return new URL(n,location.href).toString()}catch{return n}return n}return`json://${r.co(JSON.stringify(t))}`}_diffStyle(t,n,d){this.globalId=this._getGlobalId(t);const y=(b,T)=>{try{T(null,this.setState(b,d))}catch(D){T(D,!1)}};if(typeof t=="string"){const b=this.map._requestManager.normalizeStyleURL(t),T=this.map._requestManager.transformRequest(b,r.R.Style);r.n(T,(D,F)=>{D?this.fire(new r.y(D)):F&&y(F,n)})}else typeof t=="object"&&y(t,n)}loadURL(t,n={}){this.fire(new r.z("dataloading",{dataType:"style"}));const d=typeof n.validate=="boolean"?n.validate:!r.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,n.accessToken),this.resolvedImports.add(t);const y=this.importsCache.get(t);if(y)return this._load(y,d);const b=this.map._requestManager.transformRequest(t,r.R.Style);this._request=r.n(b,(T,D)=>{if(this._request=null,T)this.fire(new r.y(T));else if(D)return this.importsCache.set(t,D),this._load(D,d)})}loadJSON(t,n={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=r.q.frame(()=>{this._request=null,this._load(t,n.validate!==!1)})}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(ac,!1)}_loadImports(t,n,d){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const b of t){const T=this._createFragmentStyle(b),D=new Promise(j=>{T.once("style.import.load",j),T.once("error",j)}).then(()=>this.mergeAll());if(y.push(D),this.resolvedImports.has(b.url)){T.loadEmpty();continue}const F=b.data||this.importsCache.get(b.url);F?(T.loadJSON(F,{validate:n}),this._isInternalStyle(F)&&(T.globalId=null)):b.url?T.loadURL(b.url,{validate:n}):T.loadEmpty();const V={style:T,id:b.id,config:b.config};if(d){const j=this.fragments.findIndex(({id:H})=>H===d);this.fragments=this.fragments.slice(0,j).concat(V).concat(this.fragments.slice(j))}else this.fragments.push(V)}return Promise.allSettled(y)}getImportGlobalIds(t=this,n=new Set){for(const d of t.fragments)d.style.globalId&&n.add(d.style.globalId),this.getImportGlobalIds(d.style,n);return[...n.values()]}_createFragmentStyle(t){const n=this.scope?r.aC(t.id,this.scope):t.id;let d;const y=this._initialConfig&&this._initialConfig[n];(t.config||y)&&(d=r.l({},t.config,y));const b=new Lo(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,n){const d=t.indoor?sp(t.schema):t.schema;if(this._isInternalStyle(t)){const T=r.l({},ac,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(T,n)}if(this.updateConfig(this._config,d),n&&Fa(this,Jr(t)))return;this._loaded=!0,this.stylesheet=r.cp(t);const y=()=>{for(const V in t.sources)this.addSource(V,t.sources[V],{validate:!1,isInitialLoad:!0});t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const T=Bh(this.stylesheet.layers);if(this._order=T.map(V=>V.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const V=this.stylesheet.lights[0];this.light=new se(V.properties,V.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new se(this.stylesheet.light)),this._layers={};for(const V of T){const j=r.cu(V,this.scope,this._styleColorTheme.lut,this.options);j.configDependencies.size!==0&&this._configDependentLayers.add(j.fqid),j.setEventedParent(this,{layer:{id:j.id}}),this._layers[j.id]=j;const H=this.getOwnLayerSourceCache(j),W=!!this.directionalLight&&this.directionalLight.shadowsEnabled();H&&j.canCastShadows()&&W&&(H.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const D=this.stylesheet.terrain;D&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(D,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));const F=this.isRootStyle();t.imports?this._loadImports(t.imports,n).then(()=>{this._reloadImports(),this.fire(new r.z(F?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.z(F?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const b=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(b){const T=this._evaluateColorThemeData(b);this._loadColorTheme(T).then(()=>{y()}).catch(D=>{r.w(`Couldn't load color theme from the stylesheet: ${D}`),y()})}else this._styleColorTheme.lut=null,y()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,n,d,y,b,T,D,F,V,j;const H={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(W=>{if(W.stylesheet){if(W.light!=null&&(t=W.light),W.stylesheet.lights)for(const Q of W.stylesheet.lights)Q.type==="ambient"&&W.ambientLight!=null&&(n=W.ambientLight),Q.type==="directional"&&W.directionalLight!=null&&(d=W.directionalLight);y=this._prioritizeTerrain(y,W.terrain,W.stylesheet.terrain),W.stylesheet.fog&&W.fog!=null&&(b=W.fog),W.stylesheet.snow&&W.snow!=null&&(T=W.snow),W.stylesheet.rain&&W.rain!=null&&(D=W.rain),W.stylesheet.camera!=null&&(j=W.stylesheet.camera),W.stylesheet.projection!=null&&(F=W.stylesheet.projection),W.stylesheet.transition!=null&&(V=W.stylesheet.transition),H[W.scope]=W._styleColorTheme}}),this.light=t,this.ambientLight=n,this.directionalLight=d,this.fog=b,this.snow=T,this.rain=D,this._styleColorThemeForScope=H,y===null?delete this.terrain:this.terrain=y,this.camera=j||{"camera-projection":"perspective"},this.projection=F||{name:"mercator"},this.transition=r.l({},xf,V),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const n=d=>{for(const y of d.fragments)n(y.style);t(d)};n(this)}_prioritizeTerrain(t,n,d){const y=t&&t.drapeRenderMode===0;return d===null?n&&n.drapeRenderMode===0?n:y?t:null:n!=null&&(!t||y||n&&n.drapeRenderMode===1)?n:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(n=>{t=this._prioritizeTerrain(t,n.terrain,n.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(n=>{n.stylesheet.projection!=null&&(t=n.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},n={},d={};this.forEachFragmentStyle(y=>{for(const b in y._sourceCaches){const T=r.aC(b,y.scope);t[T]=y._sourceCaches[b]}for(const b in y._otherSourceCaches){const T=r.aC(b,y.scope);n[T]=y._otherSourceCaches[b]}for(const b in y._symbolSourceCaches){const T=r.aC(b,y.scope);d[T]=y._symbolSourceCaches[b]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=d}mergeLayers(){const t={},n=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(b=>{for(const T of b._order){const D=b._layers[T];if(D.type==="slot"){const F=r.cq(T);if(t[F])continue;t[F]=[]}D.slot&&t[D.slot]?t[D.slot].push(D):n.push(D)}}),this._mergedOrder=[];const y=(b=[])=>{for(const T of b)if(T.type==="slot"){const D=r.cq(T.id);t[D]&&y(t[D]),this._mergedSlots.push(D)}else{const D=r.aC(T.id,T.scope);this._mergedOrder.push(D),d[D]=T,T.is3D()&&(this._has3DLayers=!0),T.type==="circle"&&(this._hasCircleLayers=!0),T.type==="symbol"&&(this._hasSymbolLayers=!0),T.type==="clip"&&(this._clipLayerPresent=!0)}};y(n),this._mergedOrder.sort((b,T)=>{const D=d[b],F=d[T];return D.hasInitialOcclusionOpacityProperties?F.is3D()?1:0:D.is3D()&&F.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=r.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(n,d,y){const b=r.l({},d);for(const D of Object.keys(r.a3.colorTheme))b[D]===void 0&&(b[D]=r.a3.colorTheme[D].default);const T=new r.a4(oc,n,new Map(y));return T.setTransitionOrValue(b,y),T.untransitioned().possiblyEvaluate(new r.a8(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const n=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((d,y)=>{const b="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let T=t;T.startsWith(b)||(T=b+T);const D="mapbox-reserved-lut",F=new Image;F.src=T,F.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},F.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==n)return void d();this._styleColorTheme.lutLoading=!1;const{width:V,height:j,data:H}=r.q.getImageData(F);if(j>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(V!==j*j)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(D)&&this.removeImage(D),this.addImage(D,{data:new r.r({width:V,height:j},H),pixelRatio:1,sdf:!1,usvg:!1,version:0});const W=this.imageManager.getImage(D,this.scope);W?(this._styleColorTheme.lut={image:W.data,data:t},d()):y(new Error("Missing LUT image."))}})}getLut(t){const n=this._styleColorThemeForScope[t];return n?n.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(n,d,y){let b,T,D;const F=r.q.devicePixelRatio>1?"@2x":"";let V=r.n(d.transformRequest(d.normalizeSpriteURL(n,F,".json"),r.R.SpriteJSON),(W,Q)=>{V=null,D||(D=W,b=Q,H())}),j=r.o(d.transformRequest(d.normalizeSpriteURL(n,F,".png"),r.R.SpriteImage),(W,Q)=>{j=null,D||(D=W,T=Q,H())});function H(){if(D)y(D);else if(b&&T){const W=r.q.getImageData(T),Q={};for(const ce in b){const{width:oe,height:de,x:pe,y:Se,sdf:ke,pixelRatio:Ie,stretchX:Ue,stretchY:Le,content:Be}=b[ce],Oe=new r.r({width:oe,height:de});r.r.copy(W,Oe,{x:pe,y:Se},{x:0,y:0},{width:oe,height:de},null),Q[ce]={data:Oe,pixelRatio:Ie,sdf:ke,stretchX:Ue,stretchY:Le,content:Be,usvg:!1}}y(null,Q)}}return{cancel(){V&&(V.cancel(),V=null),j&&(j.cancel(),j=null)}}}(t,this.map._requestManager,(n,d)=>{if(this._spriteRequest=null,n)this.fire(new r.y(n));else if(d)for(const y in d)this.imageManager.addImage(y,this.scope,d[y]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))})}_loadIconset(t){if(!r.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const n=this.map._spriteFormat==="auto";var d,y;this._spriteRequest=(y=(b,T)=>{if(this._spriteRequest=null,b)n?this._loadSprite(t):this.fire(new r.y(b));else if(T)for(const D in T)this.imageManager.addImage(D,this.scope,T[D]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bi((d=this.map._requestManager).transformRequest(d.normalizeIconsetURL(t),r.R.Iconset),(b,T)=>{if(b)return void y(b);const D={},F=r.cg(new r.bh(T));for(const V of F.icons){const j={version:1,pixelRatio:r.q.devicePixelRatio,content:Gm(V),stretchX:V.metadata?yf(V.metadata.stretch_x_areas):void 0,stretchY:V.metadata?yf(V.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:V};D[V.name]=j}y(null,D)}))}_validateLayer(t){const n=this.getOwnSource(t.source);if(!n)return;const d=t.sourceLayer;d&&(n.type==="geojson"||n.vectorLayerIds&&n.vectorLayerIds.indexOf(d)===-1)&&this.fire(new r.y(new Error(`Source layer "${d}" does not exist on source "${n.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,n)=>{const d=this.fragments[n];return d&&d.style&&(t.data=d.style.serialize()),t})}_serializeSources(){const t={};for(const n in this._sourceCaches){const d=this._sourceCaches[n].getSource();t[d.id]||(t[d.id]=d.serialize())}return t}_serializeLayers(t){const n=[];for(const d of t){const y=this._layers[d];y&&y.type!=="custom"&&n.push(y.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const n=this.getOwnLayer(t);if(n)return n;this.fire(new r.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const n=this.getOwnSource(t);if(n)return n;this.fire(new r.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,n){const d=this.map.painter;if(d)for(let y=t.minzoom||0;y<(t.maxzoom||25.5);y++){const b=t.getProgramIds();if(b)for(const T of b){const D=t.getDefaultProgramParams(T,n.zoom,this._styleColorTheme.lut);D&&(d.style=this,this.fog&&(d._fogVisible=!0,D.overrideFog=!0,d.getOrCreateProgram(T,D)),d._fogVisible=!1,D.overrideFog=!1,d.getOrCreateProgram(T,D),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(D.overrideRtt=!0,d.getOrCreateProgram(T,D)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const n=this.calculateLightsBrightness();t.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n));const d=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const T=this._changes.getLayerUpdatesByScope();for(const D in T){const{updatedIds:F,removedIds:V}=T[D];(F||V)&&(this._updateWorkerLayers(D,F,V),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const b={};for(const T in this._mergedSourceCaches){const D=this._mergedSourceCaches[T];b[T]=D.used,D.used=!1,D.tileCoverLift=0}for(const T of this._mergedOrder){const D=this._mergedLayers[T];if(D.recalculate(t,this._availableImages),!D.isHidden(t.zoom)){const F=this.getLayerSourceCache(D);F&&(F.used=!0,F.tileCoverLift=Math.max(F.tileCoverLift,D.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(D,t)}):this.precompilePrograms(D,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();for(const T in b){const D=this._mergedSourceCaches[T];b[T]!==D.used&&D.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:D.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new r.z("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const n in this._sourceCaches)this._sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,n,d){const y=this.getFragmentStyle(t);y&&this.dispatcher.broadcast("updateLayers",{layers:n?y._serializeLayers(n):[],scope:t,removedIds:d||[],options:y.options})}setState(t,n){if(this._checkLoaded(),Fa(this,Jr(t)))return!1;(t=r.cp(t)).layers=Bh(t.layers);const d=function(T,D){if(!T)return[{command:Ji.setStyle,args:[D]}];let F=[];try{if(!r.bn(T.version,D.version))return[{command:Ji.setStyle,args:[D]}];if(r.bn(T.center,D.center)||F.push({command:Ji.setCenter,args:[D.center]}),r.bn(T.zoom,D.zoom)||F.push({command:Ji.setZoom,args:[D.zoom]}),r.bn(T.bearing,D.bearing)||F.push({command:Ji.setBearing,args:[D.bearing]}),r.bn(T.pitch,D.pitch)||F.push({command:Ji.setPitch,args:[D.pitch]}),r.bn(T.sprite,D.sprite)||F.push({command:Ji.setSprite,args:[D.sprite]}),r.bn(T.glyphs,D.glyphs)||F.push({command:Ji.setGlyphs,args:[D.glyphs]}),r.bn(T.imports,D.imports)||function(Q=[],ce=[],oe){ce=ce||[];const de=(Q=Q||[]).map(Gs),pe=ce.map(Gs),Se=Q.reduce(ka,{}),ke=ce.reduce(ka,{}),Ie=de.slice();let Ue,Le,Be,Oe;for(Ue=0,Le=0;Ue<de.length;Ue++)Be=de[Ue],ke.hasOwnProperty(Be)?Le++:(oe.push({command:Ji.removeImport,args:[Be]}),Ie.splice(Ie.indexOf(Be,Le),1));for(Ue=0,Le=0;Ue<pe.length;Ue++)Be=pe[pe.length-1-Ue],Ie[Ie.length-1-Ue]!==Be&&(Se.hasOwnProperty(Be)?(oe.push({command:Ji.removeImport,args:[Be]}),Ie.splice(Ie.lastIndexOf(Be,Ie.length-Le),1)):Le++,Oe=Ie[Ie.length-Ue],oe.push({command:Ji.addImport,args:[ke[Be],Oe]}),Ie.splice(Ie.length-Ue,0,Be));for(const He of ce){const Qe=Se[He.id];Qe&&!r.bn(Qe,He)&&oe.push({command:Ji.updateImport,args:[He.id,He]})}}(T.imports,D.imports,F),r.bn(T.transition,D.transition)||F.push({command:Ji.setTransition,args:[D.transition]}),r.bn(T.light,D.light)||F.push({command:Ji.setLight,args:[D.light]}),r.bn(T.fog,D.fog)||F.push({command:Ji.setFog,args:[D.fog]}),r.bn(T.snow,D.snow)||F.push({command:Ji.setSnow,args:[D.snow]}),r.bn(T.rain,D.rain)||F.push({command:Ji.setRain,args:[D.rain]}),r.bn(T.projection,D.projection)||F.push({command:Ji.setProjection,args:[D.projection]}),r.bn(T.lights,D.lights)||F.push({command:Ji.setLights,args:[D.lights]}),r.bn(T.camera,D.camera)||F.push({command:Ji.setCamera,args:[D.camera]}),!r.bn(T["color-theme"],D["color-theme"]))return[{command:Ji.setStyle,args:[D]}];const V={},j=[];(function(Q,ce,oe,de){let pe;for(pe in ce=ce||{},Q=Q||{})Q.hasOwnProperty(pe)&&(ce.hasOwnProperty(pe)||Ga(pe,oe,de));for(pe in ce){if(!ce.hasOwnProperty(pe))continue;const Se=ce[pe];Q.hasOwnProperty(pe)?r.bn(Q[pe],Se)||(Q[pe].type==="geojson"&&Se.type==="geojson"&&Lr(Q,ce,pe)?oe.push({command:Ji.setGeoJSONSourceData,args:[pe,Se.data]}):yi(pe,ce,oe,de)):qc(pe,ce,oe)}})(T.sources,D.sources,j,V);const H=[];T.layers&&T.layers.forEach(Q=>{Q.source&&V[Q.source]?F.push({command:Ji.removeLayer,args:[Q.id]}):H.push(Q)});let W=T.terrain;W&&V[W.source]&&(F.push({command:Ji.setTerrain,args:[void 0]}),W=void 0),F=F.concat(j),r.bn(W,D.terrain)||F.push({command:Ji.setTerrain,args:[D.terrain]}),function(Q,ce,oe){ce=ce||[];const de=(Q=Q||[]).map(Gs),pe=ce.map(Gs),Se=Q.reduce(ka,{}),ke=ce.reduce(ka,{}),Ie=de.slice(),Ue=Object.create(null);let Le,Be,Oe,He,Qe,xt,ut;for(Le=0,Be=0;Le<de.length;Le++)Oe=de[Le],ke.hasOwnProperty(Oe)?Be++:(oe.push({command:Ji.removeLayer,args:[Oe]}),Ie.splice(Ie.indexOf(Oe,Be),1));for(Le=0,Be=0;Le<pe.length;Le++)Oe=pe[pe.length-1-Le],Ie[Ie.length-1-Le]!==Oe&&(Se.hasOwnProperty(Oe)?(oe.push({command:Ji.removeLayer,args:[Oe]}),Ie.splice(Ie.lastIndexOf(Oe,Ie.length-Be),1)):Be++,xt=Ie[Ie.length-Le],oe.push({command:Ji.addLayer,args:[ke[Oe],xt]}),Ie.splice(Ie.length-Le,0,Oe),Ue[Oe]=!0);for(Le=0;Le<pe.length;Le++)if(Oe=pe[Le],He=Se[Oe],Qe=ke[Oe],!Ue[Oe]&&!r.bn(He,Qe))if(r.bn(He.source,Qe.source)&&r.bn(He["source-layer"],Qe["source-layer"])&&r.bn(He.type,Qe.type)){for(ut in Sr(He.layout,Qe.layout,oe,Oe,null,Ji.setLayoutProperty),Sr(He.paint,Qe.paint,oe,Oe,null,Ji.setPaintProperty),r.bn(He.slot,Qe.slot)||oe.push({command:Ji.setSlot,args:[Oe,Qe.slot]}),r.bn(He.filter,Qe.filter)||oe.push({command:Ji.setFilter,args:[Oe,Qe.filter]}),r.bn(He.minzoom,Qe.minzoom)&&r.bn(He.maxzoom,Qe.maxzoom)||oe.push({command:Ji.setLayerZoomRange,args:[Oe,Qe.minzoom,Qe.maxzoom]}),He)He.hasOwnProperty(ut)&&ut!=="layout"&&ut!=="paint"&&ut!=="filter"&&ut!=="metadata"&&ut!=="minzoom"&&ut!=="maxzoom"&&ut!=="slot"&&(ut.indexOf("paint.")===0?Sr(He[ut],Qe[ut],oe,Oe,ut.slice(6),Ji.setPaintProperty):r.bn(He[ut],Qe[ut])||oe.push({command:Ji.setLayerProperty,args:[Oe,ut,Qe[ut]]}));for(ut in Qe)Qe.hasOwnProperty(ut)&&!He.hasOwnProperty(ut)&&ut!=="layout"&&ut!=="paint"&&ut!=="filter"&&ut!=="metadata"&&ut!=="minzoom"&&ut!=="maxzoom"&&ut!=="slot"&&(ut.indexOf("paint.")===0?Sr(He[ut],Qe[ut],oe,Oe,ut.slice(6),Ji.setPaintProperty):r.bn(He[ut],Qe[ut])||oe.push({command:Ji.setLayerProperty,args:[Oe,ut,Qe[ut]]}))}else oe.push({command:Ji.removeLayer,args:[Oe]}),xt=Ie[Ie.lastIndexOf(Oe)+1],oe.push({command:Ji.addLayer,args:[Qe,xt]})}(H,D.layers,F)}catch(V){console.warn("Unable to compute style diff:",V),F=[{command:Ji.setStyle,args:[D]}]}return F}(this.serialize(),t).filter(T=>!(T.command in vf));if(d.length===0)return!1;const y=d.filter(T=>!(T.command in ap));if(y.length>0)throw new Error(`Unimplemented: ${y.map(T=>T.command).join(", ")}.`);const b=[];return d.forEach(T=>{b.push(this[T.command].apply(this,T.args))}),n&&Promise.all(b).then(n),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,n){return this.getImage(t)?this.fire(new r.y(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,n),this._afterImageUpdated(t),this)}updateImage(t,n,d=!1){this.imageManager.updateImage(t,this.scope,n),d&&this._afterImageUpdated(t)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new r.y(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.z("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,n,d={}){return this._checkLoaded(),this._validate(Hu,`models.${t}`,n,null,d)||(this.modelManager.addModel(t,n,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,n,d={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(Pa,`sources.${t}`,n,null,d))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const y=$s(t,n,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id}));const b=T=>{const D=(T?"symbol:":"other:")+y.id,F=r.aC(D,this.scope),V=this._sourceCaches[D]=new Yo(F,y,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=V,V.onAdd(this.map)};b(!1),n.type!=="vector"&&n.type!=="geojson"||b(!0),y.onAdd&&y.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const n=this.getOwnSource(t);if(!n)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===t)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const d=this.getOwnSourceCaches(t);for(const y of d){const b=r.cq(y.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(y.id),y.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,n){this._checkLoaded(),this.getOwnSource(t).setData(n),this._changes.setDirty()}getOwnSource(t){const n=this.getOwnSourceCache(t);return n&&n.getSource()}getOwnSources(){const t=[];for(const n in this._otherSourceCaches){const d=this.getOwnSourceCache(n);d&&t.push(d.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const n in t){const d=t[n]._tiles;for(const y in d){const b=d[y];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const y of t){if(this._validate(fl,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){const b=this.ambientLight;b.set(y),b.updateTransitions(n)}else this.ambientLight=new ki(y,Zt||(Zt=new r.a5({color:new r.a6(r.a3.properties_light_ambient.color),"color-use-theme":new r.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a6(r.a3.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const b=this.directionalLight;b.set(y),b.updateTransitions(n)}else this.directionalLight=new ki(y,Jt||(Jt=new r.a5({direction:new r.ak(r.a3.properties_light_directional.direction),color:new r.a6(r.a3.properties_light_directional.color),"color-use-theme":new r.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a6(r.a3.properties_light_directional.intensity),"cast-shadows":new r.a6(r.a3.properties_light_directional["cast-shadows"]),"shadow-quality":new r.a6(r.a3.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.a6(r.a3.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const d=new r.a8(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(d),this.directionalLight&&this.directionalLight.recalculate(d),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,n=this.ambientLight;if(!t||!n)return;const d=W=>.2126*(W[0]<=.03928?W[0]/12.92:Math.pow((W[0]+.055)/1.055,2.4))+.7152*(W[1]<=.03928?W[1]/12.92:Math.pow((W[1]+.055)/1.055,2.4))+.0722*(W[2]<=.03928?W[2]/12.92:Math.pow((W[2]+.055)/1.055,2.4)),y=t.properties.get("color").toRenderColor(null).toArray01(),b=t.properties.get("intensity"),T=t.properties.get("direction"),D=1-r.cb(T.x,T.y,T.z)[2]/90,F=d(y)*b*D,V=n.properties.get("color").toRenderColor(null).toArray01(),j=n.properties.get("intensity"),H=d(V)*j;return Number(((F+H)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(r.cr(t)){const n=r.cs(t),d=this.fragments.find(({id:b})=>b===n);if(!d)throw new Error(`Style import '${t}' not found`);const y=r.cq(t);return d.style.getFragmentStyle(y)}{const n=this.fragments.find(({id:d})=>d===t);return n?n.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const n={},d=(y,b="")=>`${y}::${b}`;this._featuresetSelectors={};for(const y in t){const b=this._featuresetSelectors[y]=[];for(const T of t[y].selectors){if(T.featureNamespace){const F=this.getOwnLayer(T.layer);if(!F){r.w(`Layer is undefined for selector: ${T.layer}`);continue}const V=d(F.source,F.sourceLayer);if(V in n&&n[V]!==T.featureNamespace){r.w(`"featureNamespace ${T.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}n[V]=T.featureNamespace}let D;if(T.properties)for(const F in T.properties){const V=r.U(T.properties[F]);V.result==="success"&&(D=D||{},D[F]=V.value)}b.push({layerId:T.layer,namespace:T.featureNamespace,properties:D,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const n=this.getFragmentStyle(t);if(!n||!n.stylesheet.featuresets)return[];const d=[];for(const y in n.stylesheet.featuresets)d.push({featuresetId:y,importId:n.scope?n.scope:void 0});return d}getFeaturesetLayers(t,n){const d=this.getFragmentStyle(n),y=d.stylesheet.featuresets;if(!y||!y[t])return this.fire(new r.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const T of y[t].selectors){const D=d.getOwnLayer(T.layer);D&&b.push(D)}return b}getConfigProperty(t,n){const d=this.getFragmentStyle(t);if(!d)return null;const y=r.aC(n,d.scope),b=d.options.get(y),T=b?b.value||b.default:null;return T?T.serialize():null}setConfigProperty(t,n,d){const y=this.getFragmentStyle(t);if(!y)return;const b=y.stylesheet.indoor?sp(y.stylesheet.schema):y.stylesheet.schema;if(!b||!b[n])return;const T=r.U(d);if(T.result!=="success")return void Fa(this,T.value);const D=T.value.expression,F=r.aC(n,y.scope),V=y.options.get(F);if(!V)return;let j;const{minValue:H,maxValue:W,stepValue:Q,type:ce,values:oe}=b[n],de=r.U(b[n].default);de.result==="success"&&(j=de.value.expression),j?(this.options.set(F,Object.assign({},V,{value:D,default:j,minValue:H,maxValue:W,stepValue:Q,type:ce,values:oe})),this.updateConfigDependencies(n)):this.fire(new r.y(new Error(`No schema defined for the config option "${n}" in the "${t}" fragment.`)))}getConfig(t){const n=this.getFragmentStyle(t);if(!n)return null;const d=n.stylesheet.schema;if(!d)return null;const y={};for(const b in d){const T=r.aC(b,n.scope),D=n.options.get(T),F=D?D.value||D.default:null;y[b]=F?F.serialize():null}return y}setConfig(t,n){const d=this.getFragmentStyle(t);d&&(d.updateConfig(n,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const n=this.getFragmentStyle(t);return n?n.stylesheet.schema:null}setSchema(t,n){const d=this.getFragmentStyle(t);d&&(d.stylesheet.schema=n,d.updateConfig(d._config,n),this.updateConfigDependencies())}updateConfig(t,n){if(this._config=t,t||n)if(n)for(const d in n){let y,b;const T=r.U(n[d].default);if(T.result==="success"&&(y=T.value.expression),t&&t[d]!==void 0){const W=r.U(t[d]);W.result==="success"&&(b=W.value.expression)}const{minValue:D,maxValue:F,stepValue:V,type:j,values:H}=n[d];if(y){const W=r.aC(d,this.scope);this.options.set(W,{default:y,value:b,minValue:D,maxValue:F,stepValue:V,type:j,values:H})}else this.fire(new r.y(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const n of this._configDependentLayers){const d=this.getLayer(n);if(d){if(t&&!d.configDependencies.has(t))continue;d.possiblyEvaluateVisibility(),this._updateLayer(d)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(n=>{const d=n._styleColorTheme.colorThemeOverride?n._styleColorTheme.colorThemeOverride:n._styleColorTheme.colorTheme;if(d){const y=n._evaluateColorThemeData(d);(!n._styleColorTheme.lut&&y!==""||n._styleColorTheme.lut&&y!==n._styleColorTheme.lut.data)&&n.setColorTheme(d)}}),this._changes.setDirty()}addLayer(t,n,d={}){this._checkLoaded();const y=t.id;if(this._layers[y])return void this.fire(new r.y(new Error(`Layer with id "${y}" already exists on this map`)));let b;if(t.type==="custom"){if(Fa(this,r.ct(t)))return;b=r.cu(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(y,t.source),t=r.cp(t),t=r.l(t,{source:y})),this._validate(Fh,`layers.${y}`,t,{arrayIndex:-1},d))return;b=r.cu(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:y}})}b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid);let T=this._order.length;if(n){const j=this._order.indexOf(n);if(j===-1)return void this.fire(new r.y(new Error(`Layer with id "${n}" does not exist on this map.`)));b.slot===this._layers[n].slot?T=j:r.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,y),this._layerOrderChanged=!0,this._layers[y]=b;const D=this.getOwnLayerSourceCache(b),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();D&&b.canCastShadows()&&F&&(D.castsShadows=!0);const V=this._changes.getRemovedLayer(b);if(V&&b.source&&D&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const j=r.aC(b.source,b.scope);V.type!==b.type?this._changes.updateSourceCache(j,"clear"):(this._changes.updateSourceCache(j,"reload"),D.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(t,n){this._checkLoaded();const d=this._checkLayer(t);if(!d||t===n)return;const y=this._order.indexOf(t);this._order.splice(y,1);let b=this._order.length;if(n){const T=this._order.indexOf(n);if(T===-1)return void this.fire(new r.y(new Error(`Layer with id "${n}" does not exist on this map.`)));d.slot===this._layers[n].slot?b=T:r.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const n=this._checkLayer(t);if(!n)return;n.setEventedParent(null);const d=this._order.indexOf(t);this._order.splice(d,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._changes.removeLayer(n);const y=this.getOwnLayerSourceCache(n);if(y&&y.castsShadows){let b=!1;for(const T in this._layers)if(this._layers[T].source===n.source&&this._layers[T].canCastShadows()){b=!0;break}y.castsShadows=b}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const n in this._layers)if(this._layers[n].type===t)return!0;return!1}setLayerZoomRange(t,n,d){this._checkLoaded();const y=this._checkLayer(t);y&&(y.minzoom===n&&y.maxzoom===d||(n!=null&&(y.minzoom=n),d!=null&&(y.maxzoom=d),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,n){this._checkLoaded();const d=this._checkLayer(t);d&&d.slot!==n&&(d.slot=n,this._updateLayer(d))}setFilter(t,n,d={}){this._checkLoaded();const y=this._checkLayer(t);if(y&&!r.bn(y.filter,n))return n==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(ts,`layers.${y.id}.filter`,n,{layerType:y.type},d)||(y.filter=r.cp(n),this._updateLayer(y)))}getFilter(t){const n=this._checkLayer(t);if(n)return r.cp(n.filter)}setLayoutProperty(t,n,d,y={}){this._checkLoaded();const b=this._checkLayer(t);if(b&&!r.bn(b.getLayoutProperty(n),d)){if(d!=null&&(!y||y.validate!==!1)&&Fa(b,Gu.call(Jr,{key:`layers.${t}.layout.${n}`,layerType:b.type,objectKey:n,value:d,styleSpec:r.a3,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(n,d),b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),this._updateLayer(b)}}getLayoutProperty(t,n){const d=this._checkLayer(t);if(d)return d.getLayoutProperty(n)}setPaintProperty(t,n,d,y={}){this._checkLoaded();const b=this._checkLayer(t);if(!b||r.bn(b.getPaintProperty(n),d)||d!=null&&(!y||y.validate!==!1)&&Fa(b,Jl.call(Jr,{key:`layers.${t}.paint.${n}`,layerType:b.type,objectKey:n,value:d,styleSpec:r.a3})))return;const T=b.setPaintProperty(n,d);b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),T&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(t,n){const d=this._checkLayer(t);if(d)return d.getPaintProperty(n)}setFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:F,importId:V}=t.target,j=this.getFragmentStyle(V),H=j.getFeaturesetLayers(F);for(const{source:W,sourceLayer:Q}of H)j.setFeatureState({id:t.id,source:W,sourceLayer:Q},n)}else if("layerId"in t.target){const{layerId:F}=t.target,V=this.getLayer(F);this.setFeatureState({id:t.id,source:V.source,sourceLayer:V.sourceLayer},n)}return}const d=t.source,y=t.sourceLayer,b=this._checkSource(d);if(!b)return;const T=b.type;if(T==="geojson"&&y)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!y)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));const D=this.getOwnSourceCaches(d);for(const F of D)F.setFeatureState(y,t.id,n)}removeFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:F,importId:V}=t.target,j=this.getFragmentStyle(V),H=j.getFeaturesetLayers(F);for(const{source:W,sourceLayer:Q}of H)j.removeFeatureState({id:t.id,source:W,sourceLayer:Q},n)}else if("layerId"in t.target){const{layerId:F}=t.target,V=this.getLayer(F);this.removeFeatureState({id:t.id,source:V.source,sourceLayer:V.sourceLayer},n)}return}const d=t.source,y=this._checkSource(d);if(!y)return;const b=y.type,T=b==="vector"?t.sourceLayer:void 0;if(b==="vector"&&!T)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));const D=this.getOwnSourceCaches(d);for(const F of D)F.removeFeatureState(T,t.id,n)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let b;if("featuresetId"in t.target){const{featuresetId:T,importId:D}=t.target,F=this.getFragmentStyle(D),V=F.getFeaturesetLayers(T);for(const{source:j,sourceLayer:H}of V){const W=F.getFeatureState({id:t.id,source:j,sourceLayer:H});if(W&&!b)b=W;else if(!r.bn(b,W))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:T}=t.target,D=this.getLayer(T);b=this.getFeatureState({id:t.id,source:D.source,sourceLayer:D.sourceLayer})}return b}const n=t.source,d=t.sourceLayer,y=this._checkSource(n);if(y){if(y.type!=="vector"||d)return t.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(d,t.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=r.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return r.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),n=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return r.cv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateFilteredLayers(t){for(const n of Object.values(this._mergedLayers))t(n)&&this._updateLayer(n)}_updateLayer(t){this._changes.updateLayer(t);const n=this.getLayerSourceCache(t),d=r.aC(t.source,t.scope),y=this._changes.getUpdatedSourceCaches();t.source&&!y[d]&&n&&n.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),n.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const n=D=>this._mergedLayers[D].is3D(),d=this.order,y={},b=[];for(let D=d.length-1;D>=0;D--){const F=d[D];if(n(F)){y[F]=D;for(const V of t){const j=V[F];if(j)for(const H of j)b.push(H)}}}b.sort((D,F)=>F.intersectionZ-D.intersectionZ);const T=[];for(let D=d.length-1;D>=0;D--){const F=d[D];if(n(F))for(let V=b.length-1;V>=0;V--){const j=b[V].feature;if(j.layer&&y[j.layer.id]<D)break;T.push(j),b.pop()}else for(const V of t){const j=V[F];if(j)for(const H of j)T.push(H.feature)}}return T}queryRenderedFeatures(t,n,d){let y;n&&!Array.isArray(n)&&n.filter&&(this._validate(ts,"queryRenderedFeatures.filter",n.filter,null,n),y=r.aZ(n.filter));const b={},T=j=>{if(tu.has(j.type))return;const H=this.getOwnLayerSourceCache(j),W=b[H.id]=b[H.id]||{sourceCache:H,layers:{},has3DLayers:!1};j.is3D()&&(W.has3DLayers=!0),W.layers[j.fqid]=W.layers[j.fqid]||{styleLayer:j,targets:[]},W.layers[j.fqid].targets.push({filter:y})};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(const j of n.layers){const H=this._layers[j];if(!H)return this.fire(new r.y(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];T(H)}}else for(const j in this._layers)T(this._layers[j]);const D=this._queryRenderedFeatures(t,b,d),F=this._flattenAndSortRenderedFeatures(D),V=[];for(const j of F)r.cs(j.layer.id)===this.scope&&V.push(j);return V}queryRenderedFeatureset(t,n,d){let y;n&&!Array.isArray(n)&&n.filter&&(this._validate(ts,"queryRenderedFeatures.filter",n.filter,null,n),y=r.aZ(n.filter));const b="mock",T=[];if(n&&n.target)T.push(Object.assign({},n,{targetId:b,filter:y}));else{const j=this.getFeaturesetDescriptors();for(const H of j)T.push({targetId:b,filter:y,target:H});for(const{style:H}of this.fragments){const W=H.getFeaturesetDescriptors();for(const Q of W)T.push({targetId:b,filter:y,target:Q})}}const D=this.queryRenderedTargets(t,T,d),F=[],V=new Set;for(const j of D)for(const H of j.variants[b])Wo(H,j,V)||F.push(new r.cw(j,H));return F}queryRenderedTargets(t,n,d){const y={},b=(D,F,V,j)=>{const H=y[F.id]=y[F.id]||{sourceCache:F,layers:{},has3DLayers:!1};if(H.layers[D.fqid]=H.layers[D.fqid]||{styleLayer:D,targets:[]},D.is3D()&&(H.has3DLayers=!0),!j)return V.uniqueFeatureID=!1,void H.layers[D.fqid].targets.push(V);H.layers[D.fqid].targets.push(Object.assign({},V,{namespace:j.namespace,properties:j.properties,uniqueFeatureID:j.uniqueFeatureID}))};for(const D of n)if("featuresetId"in D.target){const{featuresetId:F,importId:V}=D.target,j=this.getFragmentStyle(V);if(!j||!j._featuresetSelectors)continue;const H=j._featuresetSelectors[F];if(!H){this.fire(new r.y(new Error(`The featureset '${F}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const W of H){const Q=j.getOwnLayer(W.layerId);Q&&!tu.has(Q.type)&&b(Q,j.getOwnLayerSourceCache(Q),D,W)}}else if("layerId"in D.target){const{layerId:F}=D.target,V=this.getLayer(F);if(!V||tu.has(V.type))continue;b(V,this.getLayerSourceCache(V),D)}const T=this._queryRenderedFeatures(t,y,d);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(t,n,d){const y=[],b=!!this.map._showQueryGeometry,T=Pi.createFromScreenPoints(t,d);for(const D in n){const F=Hc(T,n[D],this._availableImages,d,b);Object.keys(F).length&&y.push(F)}if(this.placement)for(const D in n){if(!n[D].sourceCache._onlySymbols)continue;const F=Po(T.screenGeometry,n[D],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(F).length&&y.push(F)}return y}querySourceFeatures(t,n){const d=n&&n.filter;d&&this._validate(ts,"querySourceFeatures.filter",d,null,n);let y=[];const b=this.getOwnSourceCaches(t);for(const T of b)y=y.concat(Wc(T,n));return y}addSourceType(t,n,d){return Lo.getSourceType(t)?d(new Error(`A source type called "${t}" already exists.`)):(Lo.setSourceType(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,n,d={}){this._checkLoaded();const y=this.light.getLight();let b=!1;for(const D in t)if(!r.bn(t[D],y[D])){b=!0;break}if(!b)return;const T=this._getTransitionParameters();this.light.setLight(t,n,d),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,n=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),n===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=t;const y=t.source==null;if(n===1){if(this.disableElevatedTerrain)return;if(typeof d.source=="object"){const D="terrain-dem-src";this.addSource(D,d.source),d=r.cp(d),d=r.l(d,{source:D})}const b=r.l({},d),T={};if(this.terrain&&y){b.source=this.terrain.get().source;const D=this.terrain?this.getFragmentStyle(this.terrain.scope):null;D&&(T.style=D.serialize())}if(this._validate(jc,"terrain",b,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&n!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,n),this.fire(new r.z("data",{dataType:"style"}))}else{const b=this.terrain,T=b.get();for(const D of Object.keys(r.a3.terrain))!d.hasOwnProperty(D)&&r.a3.terrain[D].default&&(d[D]=r.a3.terrain[D].default);for(const D in t)if(!r.bn(t[D],T[D])){b.set(t,this.options),this.stylesheet.terrain=t;const F=this._getTransitionParameters({duration:0});b.updateTransitions(F),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const n=this.fog=new pt(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=n.get();const d=this._getTransitionParameters({duration:0});n.updateTransitions(d)}_createSnow(t){const n=this.snow=new pi(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=n.get();const d=this._getTransitionParameters({duration:0});n.updateTransitions(d)}_createRain(t){const n=this.rain=new Di(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=n.get();const d=this._getTransitionParameters({duration:0});n.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!r.bn(n.get(),t)){n.set(t,this.options),this.stylesheet.fog=n.get();const d=this._getTransitionParameters({duration:0});n.updateTransitions(d)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const n=this.snow;if(!r.bn(n.get(),t)){n.set(t,this.options),this.stylesheet.snow=n.get();const d=this._getTransitionParameters({duration:0});n.updateTransitions(d)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const n=this.rain;if(!r.bn(n.get(),t)){n.set(t,this.options),this.stylesheet.rain=n.get();const d=this._getTransitionParameters({duration:0});n.updateTransitions(d)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},n=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!n)return this._styleColorTheme.lut=null,void t();const d=this._evaluateColorThemeData(n);this._loadColorTheme(d).then(()=>{this.fire(new r.z("colorthemeset")),t()}).catch(y=>{r.w(`Couldn't set color theme: ${y}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,n){const d=this.getFragmentStyle(t);d&&(d._styleColorTheme.colorThemeOverride=n,d._reloadColorTheme())}_getTransitionParameters(t){return{now:r.q.now(),transition:r.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],n=[];for(const d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?t.push(d):n.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...n)}_createTerrain(t,n){const d=this.terrain=new me(t,n,this.scope,this.options);n===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}_force3DLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="fill-extrusion"&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="symbol"&&this._updateLayer(n)}}_validate(t,n,d,y,b={}){if(b&&b.validate===!1)return!1;const T=r.l({},this.serialize());return Fa(this,t.call(Jr,r.l({key:n,style:T,value:d,styleSpec:r.a3},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.cx.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const n=this.getSourceCaches(t);for(const d of n)d.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const n=this.getSourceCaches(t);for(const d of n)d.resume(),d.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let n;this.directionalLight&&(n=nc(this.directionalLight));for(const d in this._mergedSourceCaches)this._mergedSourceCaches[d].update(t,void 0,void 0,n)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const n=this._sourceCaches[t];n.resume(),n.reload()}}_updatePlacement(t,n,d,y,b,T,D=!1){let F=!1,V=!1;const j={},H={};for(const W of this._mergedOrder){const Q=this._mergedLayers[W];if(Q.type!=="symbol")continue;const ce=r.aC(Q.source,Q.scope);let oe=j[ce];if(!oe){const pe=this.getLayerSourceCache(Q);if(!pe)continue;const Se=pe.getRenderableIds(!0).map(ke=>pe.getTileByID(ke));H[ce]=Se.slice(),oe=j[ce]=Se.sort((ke,Ie)=>Ie.tileID.overscaledZ-ke.tileID.overscaledZ||(ke.tileID.isLessThan(Ie.tileID)?-1:1))}const de=this.crossTileSymbolIndex.addLayer(Q,oe,n.center.lng,n.projection);F=F||de}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),D=D||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new r.z("neworder")),(D||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.q.now(),n.zoom))&&(this.pauseablePlacement=new jm(n,this._mergedOrder,D,d,y,b,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,j,H,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.q.now()),V=!0),F&&this.pauseablePlacement.placement.setStale()),V||F){this._buildingIndex.onNewFrame(n.zoom);for(let W=0;W<this._mergedOrder.length;W++){const Q=this._mergedLayers[this._mergedOrder[W]];if(Q.type!=="symbol")continue;const ce=this.isLayerClipped(Q);this.placement.updateLayerOpacities(Q,j[r.aC(Q.source,Q.scope)],W,ce?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,n){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex(({id:b})=>b===t.id)!==-1)return void this.fire(new r.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!n)return d.push(t),this._loadImports([t],!0);const y=d.findIndex(({id:b})=>b===n);return y===-1&&this.fire(new r.y(new Error(`Import with id "${n}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,y).concat(t).concat(d.slice(y)),this._loadImports([t],!0,n)}updateImport(t,n){this._checkLoaded();const d=this.stylesheet.imports||[],y=this.getImportIndex(t);return y===-1?this:typeof n=="string"?(this.setImportUrl(t,n),this):(n.url&&n.url!==d[y].url&&this.setImportUrl(t,n.url),r.bn(n.config,d[y].config)||this.setImportConfig(t,n.config,n.data.schema),r.bn(n.data,d[y].data)||this.setImportData(t,n.data),this)}moveImport(t,n){this._checkLoaded();let d=this.stylesheet.imports||[];const y=this.getImportIndex(t);if(y===-1)return this;const b=this.getImportIndex(n);if(b===-1)return this;const T=d[y],D=this.fragments[y];return d=d.filter(({id:F})=>F!==t),this.fragments=this.fragments.filter(({id:F})=>F!==t),this.stylesheet.imports=d.slice(0,b).concat(T).concat(d.slice(b)),this.fragments=this.fragments.slice(0,b).concat(D).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(t,n){this._checkLoaded();const d=this.stylesheet.imports||[],y=this.getImportIndex(t);if(y===-1)return this;d[y].url=n;const b=this.fragments[y];return b.style=this._createFragmentStyle(d[y]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(n),this}setImportData(t,n){this._checkLoaded();const d=this.getImportIndex(t),y=this.stylesheet.imports||[];return d===-1?this:n?(this.fragments[d].style.setState(n),this._reloadImports(),this):(delete y[d].data,this.setImportUrl(t,y[d].url))}setImportConfig(t,n,d){this._checkLoaded();const y=this.getImportIndex(t),b=this.stylesheet.imports||[];if(y===-1)return this;n?b[y].config=n:delete b[y].config;const T=this.fragments[y];d&&T.style.stylesheet&&(T.style.stylesheet.schema=d);const D=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=n,T.style.updateConfig(n,D),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const n=this.stylesheet.imports||[],d=this.getImportIndex(t);d!==-1&&(n.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(t){const n=(this.stylesheet.imports||[]).findIndex(d=>d.id===t);return n===-1&&this.fire(new r.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),n}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const n in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[n];d&&t.push(d.getSource())}return t}getSource(t,n){const d=this.getSourceCache(t,n);return d&&d.getSource()}getLayerSource(t){const n=this.getLayerSourceCache(t);return n&&n.getSource()}getSourceCache(t,n){const d=r.aC(t,n);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(t){const n=r.aC(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const n=[];return this._mergedOtherSourceCaches[t]&&n.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&n.push(this._mergedSymbolSourceCaches[t]),n}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const n in t){const d=t[n];d==="reload"?this.reloadSource(n):d==="clear"&&this.clearSource(n)}}updateLayers(t){const n=this._changes.getUpdatedPaintProperties();for(const d of n){const y=this.getLayer(d);y&&y.updateTransitions(t)}}getImages(t,n,d){this.imageManager.getImages(n.icons,n.scope,d),this._updateTilesForChangedImages();const y=b=>{b&&b.setDependencies(n.tileID.key,n.type,n.icons)};y(this._otherSourceCaches[n.source]),y(this._symbolSourceCaches[n.source])}rasterizeImages(t,n,d){this.imageManager.rasterizeImages(n,d)}getGlyphs(t,n,d){this.glyphManager.getGlyphs(n.stacks,n.scope,d)}getResource(t,n,d){return r.cy(n,d)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const n=[];return this._otherSourceCaches[t]&&n.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&n.push(this._symbolSourceCaches[t]),n}_isSourceCacheLoaded(t){const n=this.getOwnSourceCaches(t);return n.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${t}'`))),!1):n.every(d=>d.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,n){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const d=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D()){if(d||n&&n.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Lo.getSourceType=function(u){return Nn[u]},Lo.setSourceType=function(u,t){Nn[u]=t},Lo.registerForPluginStateChange=r.ch;var wl=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Qu=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,lc=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Sl="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Wh=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Ro=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Zo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,iu=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,ru=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,eh=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Xa=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const cc=[];Yr(wl,cc),Yr(lc,cc),Yr(Qu,cc);const nu={"_prelude_fog.vertex.glsl":Ro,"_prelude_terrain.vertex.glsl":Wh,"_prelude_shadow.vertex.glsl":eh,"_prelude_fog.fragment.glsl":Zo,"_prelude_shadow.fragment.glsl":Xa,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":iu,"_prelude_raster_particle.glsl":ru},su={};fr("",Wh),fr(Zo,Ro),fr(Xa,eh),fr(iu,""),fr(ru,"");const qh=fr(Qu,lc),uc=wl;var Ls={background:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:fr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:fr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:fr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:fr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:fr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:fr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:fr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:fr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:fr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:fr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:fr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:fr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:fr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:fr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:fr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:fr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Sl),skyboxGradient:fr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Sl),skyboxCapture:fr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:fr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:fr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:fr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:fr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:fr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:fr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:fr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Yr(u,t){const n=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of n)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=d.split(" ");for(const b of y)t.includes(b)||t.push(b)}}function fr(u,t){const n=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let y=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);y&&(y=y.map(V=>{const j=V.split(" ");return j[j.length-1]}),y=[...new Set(y)]);const b={},T=[],D=[];if(u=u.replace(n,(V,j)=>(D.push(j),"")),(t=t.replace(n,(V,j)=>(T.push(j),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let F=[...cc];Yr(u,F),Yr(t,F);for(const V of[...T,...D])nu[V]||console.error(`Undefined include: ${V}`),su[V]||(su[V]=[],Yr(nu[V],su[V])),F=[...F,...su[V]];return{fragmentSource:u=u.replace(d,(V,j,H,W,Q)=>(b[Q]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
in ${H} ${W} ${Q};
#else
uniform ${H} ${W} u_${Q};
#endif
`:j==="initialize"?`
#ifdef HAS_UNIFORM_u_${Q}
    ${H} ${W} ${Q} = u_${Q};
#endif
`:j==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    in ${H} ${W} ${Q};
#endif
`:j==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(d,(V,j,H,W,Q)=>{const ce=W==="float"?"vec2":W,oe=Q.match(/color/)?"color":ce;return j==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
in ${H} ${W} a_${Q};
#endif
`:b[Q]?j==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
in ${H} ${ce} a_${Q};
out ${H} ${W} ${Q};
#else
uniform ${H} ${W} u_${Q};
#endif
`:j==="initialize"?oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = a_${Q};
#else
    ${H} ${W} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = unpack_mix_${oe}(a_${Q}, u_${Q}_t);
#else
    ${H} ${W} ${Q} = u_${Q};
#endif
`:j==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    in ${H} ${W} a_${Q};
    out ${H} ${W} ${Q};
#endif
`:j==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    ${Q} = a_${Q};
#endif
`:void 0:j==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
in ${H} ${ce} a_${Q};
#else
uniform ${H} ${W} u_${Q};
#endif
`:j==="define-instanced"?oe==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Q}0;
in vec4 a_${Q}1;
in vec4 a_${Q}2;
in vec4 a_${Q}3;
#else
uniform ${H} ${W} u_${Q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${H} ${ce} a_${Q};
#else
uniform ${H} ${W} u_${Q};
#endif
`:j==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    ${H} ${W} ${Q} = a_${Q};
#endif
`:oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${H} ${W} ${Q} = a_${Q};
#else
    ${H} ${W} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${H} ${W} ${Q} = unpack_mix_${oe}(a_${Q}, u_${Q}_t);
#else
    ${H} ${W} ${Q} = u_${Q};
#endif
`}),staticAttributes:y,usedDefines:F,vertexIncludes:T,fragmentIncludes:D}}class lp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,n,d,y,b,T,D,F){this.context=t;let V=this.boundPaintVertexBuffers.length!==y.length;for(let H=0;!V&&H<y.length;H++)this.boundPaintVertexBuffers[H]!==y[H]&&(V=!0);let j=this.boundDynamicVertexBuffers.length!==D.length;for(let H=0;!j&&H<D.length;H++)this.boundDynamicVertexBuffers[H]!==D[H]&&(j=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==d||V||j||this.boundIndexBuffer!==b||this.boundVertexOffset!==T)this.freshBind(n,d,y,b,T,D,F);else{t.bindVertexArrayOES.set(this.vao);for(const H of D)H&&(H.bind(),F&&H.instanceCount&&H.setVertexAttribDivisor(t.gl,n,F));b&&b.dynamicDraw&&b.bind()}}freshBind(t,n,d,y,b,T,D){const F=t.numAttributes,V=this.context,j=V.gl;this.vao&&this.destroy(),this.vao=V.gl.createVertexArray(),V.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=y,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=T,n.enableAttributes(j,t),n.bind(),n.setVertexAttribPointers(j,t,b);for(const H of d)H.enableAttributes(j,t),H.bind(),H.setVertexAttribPointers(j,t,b);for(const H of T)H&&(H.enableAttributes(j,t),H.bind(),H.setVertexAttribPointers(j,t,b),D&&H.instanceCount&&H.setVertexAttribDivisor(j,t,D));y&&y.bind(),V.currentNumAttributes=F}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Tl(u,t){const n=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new r.aa(0,d/n).toLngLat().lat,new r.aa(0,(d+1)/n).toLngLat().lat]}function th(u,t,n,d,y,b,T){const D=u.context,F=D.gl,V=n.hillshadeFBO;if(!V)return;u.prepareDrawTile();const j=u.isTileAffectedByFog(t),H=u.getOrCreateProgram("hillshade",{overrideFog:j});D.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,V.colorAttachment.get());const W=((de,pe,Se,ke)=>{const Ie=Se.paint.get("hillshade-shadow-color"),Ue=Se.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Le=Se.paint.get("hillshade-highlight-color"),Be=Se.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Oe=Se.paint.get("hillshade-accent-color"),He=Se.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Qe=Se.paint.get("hillshade-emissive-strength");let xt=r.ai(Se.paint.get("hillshade-illumination-direction"));if(Se.paint.get("hillshade-illumination-anchor")==="viewport")xt-=de.transform.angle;else if(de.style&&de.style.enable3dLights()&&de.style.directionalLight){const It=de.style.directionalLight.properties.get("direction"),At=r.cb(It.x,It.y,It.z);xt=r.ai(At[1])}const ut=!de.options.moving;return{u_matrix:ke||de.transform.calculateProjMatrix(pe.tileID.toUnwrapped(),ut),u_image:0,u_latrange:Tl(0,pe.tileID),u_light:[Se.paint.get("hillshade-exaggeration"),xt],u_shadow:Ie.toRenderColor(Ue?null:Se.lut),u_highlight:Le.toRenderColor(Be?null:Se.lut),u_emissive_strength:Qe,u_accent:Oe.toRenderColor(He?null:Se.lut)}})(u,n,d,u.terrain?t.projMatrix:null);u.uploadCommonUniforms(D,H,t.toUnwrapped());const{tileBoundsBuffer:Q,tileBoundsIndexBuffer:ce,tileBoundsSegments:oe}=u.getTileBoundsBuffers(n);H.draw(u,F.TRIANGLES,y,b,T,zi.disabled,W,d.id,Q,ce,oe)}function An(u,t,n){if(!t.needsDEMTextureUpload)return;const d=u.context,y=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(n.stride);const b=n.getPixels();t.demTexture?t.demTexture.update(b,{premultiply:!1}):t.demTexture=new r.T(d,b,y.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function bf(u,t,n){const d=u.context,y=d.gl;if(!t.dem)return;const b=t.dem;if(d.activeTexture.set(y.TEXTURE1),An(u,t,b),!t.demTexture)return;t.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const T=b.dim;d.activeTexture.set(y.TEXTURE0);let D=t.hillshadeFBO;if(!D){const W=new r.T(d,{width:T,height:T,data:null},y.RGBA8);W.bind(y.LINEAR,y.CLAMP_TO_EDGE),D=t.hillshadeFBO=d.createFramebuffer(T,T,!0,"renderbuffer"),D.colorAttachment.set(W.texture)}d.bindFramebuffer.set(D.framebuffer),d.viewport.set([0,0,T,T]);const{tileBoundsBuffer:F,tileBoundsIndexBuffer:V,tileBoundsSegments:j}=u.getMercatorTileBoundsBuffers(),H=[];u.linearFloatFilteringSupported()&&H.push("TERRAIN_DEM_FLOAT_FORMAT"),u.getOrCreateProgram("hillshadePrepare",{defines:H}).draw(u,y.TRIANGLES,Si.disabled,Oi.disabled,Xi.unblended,zi.disabled,((W,Q)=>{const ce=Q.stride,oe=r.ab.mat4.create();return r.ab.mat4.ortho(oe,0,r.ag,-r.ag,0,0,1),r.ab.mat4.translate(oe,oe,[0,-r.ag,0]),{u_matrix:oe,u_image:1,u_dimension:[ce,ce],u_zoom:W.overscaledZ}})(t.tileID,b),n.id,F,V,j),t.needsHillshadePrepare=!1}class sn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Yh extends sn{getDefault(){return r.aj.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ir extends sn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Xh extends sn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class ou extends sn{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class wf extends sn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class ih extends sn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Or extends sn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ml extends sn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class rh extends sn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Sf extends sn{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class vo extends sn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class Zh extends sn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Za extends sn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class Kh extends sn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class cp extends sn{getDefault(){return r.aj.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class up extends sn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class hc extends sn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class hp extends sn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Jh extends sn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Qh=class extends sn{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class Tf extends sn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Mf extends sn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class au extends sn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Hm extends sn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ef extends sn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Wm extends sn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class qm extends sn{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Cf extends sn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Af extends sn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ko extends sn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class dp extends sn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ed extends sn{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class lu extends ed{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class td extends ed{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Pf extends ed{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class If extends td{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const cu=(u,t,n)=>({u_matrix:u,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),El=(u,t,n,d,y,b,T,D,F,V,j,H,W,Q,ce,oe)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:n,u_zoom_transition:y,u_merc_center:b,u_image0:0,u_frustum_tl:T,u_frustum_tr:D,u_frustum_br:F,u_frustum_bl:V,u_globe_pos:j,u_globe_radius:H,u_viewport:W,u_grid_matrix:oe?Float32Array.from(oe):new Float32Array(9),u_skirt_height:Q,u_far_z_cutoff:ce});function id(u,t){return u!=null&&t!=null&&!(!u.hasData()||!t.hasData())&&u.demTexture!=null&&t.demTexture!=null&&u.tileID.key!==t.tileID.key}const zo=new class{constructor(){this.operations={}}newMorphing(u,t,n,d,y){if(u in this.operations){const b=this.operations[u];b.to.tileID.key!==n.tileID.key&&(b.queued=n)}else this.operations[u]={startTime:d,phase:0,duration:y,from:t,to:n,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const t=this.operations[u];return{from:t.from,to:t.to,phase:t.phase}}update(u){for(const t in this.operations){const n=this.operations[t];for(n.phase=(u-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,u)){delete this.operations[t];break}}}_nextOp(u,t){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=t,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},rd={0:null,1:"TERRAIN_VERTEX_MORPHING"};function uu(u,t,n){if(t===0)return 0;const d=t<1&&n===514?.25/t:1;return 6*Math.pow(1.5,22-u)*Math.max(t,1)*d}function Df(u,t){const n=1<<u.z;return!t&&(u.x===0||u.x===n-1)||u.y===0||u.y===n-1}const nd=u=>({u_matrix:u});function nh(u,t,n,d,y){if(y>0){const b=r.q.now(),T=(b-u.timeAdded)/y,D=t?(b-t.timeAdded)/y:-1,F=n.getSource(),V=d.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),j=!t||Math.abs(t.tileID.overscaledZ-V)>Math.abs(u.tileID.overscaledZ-V),H=j&&u.refreshedUponExpiration?1:r.aw(j?T:1-D,0,1);return u.refreshedUponExpiration&&T>=1&&(u.refreshedUponExpiration=!1),t?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}class Cl extends Yo{constructor(t){const n={type:"raster-dem",maxzoom:t.transform.maxZoom},d=new r.D(r.ci(),null),y=$s("mock-dem",n,d,t.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,n){t.state="loaded",n(null)}}class kf extends Yo{constructor(t){const n=$s("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new r.D(r.ci(),null),t.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,n,d){if(t.freezeTileCoverage)return;this.transform=t;const y=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,T)=>{if(b[T.key]="",!this._tiles[T.key]){const D=new gl(T,this._source.tileSize*T.overscaleFactor(),t.tileZoom);D.state="loaded",this._tiles[T.key]=D}return b},{});for(const b in this._tiles)b in y||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(t){const n=this.proxyCachedFBO[t];if(n!==void 0){const d=Object.values(n);this.renderCachePool.push(...d),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class pp extends r.aG{constructor(t,n,d){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=n,this.projMatrix=d}}class hu extends r.cJ{constructor(t,n){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,y,b]=function(F){const V=new r.b4,j=new r.aU,H=131;V.reserve(17161),j.reserve(33800);const W=r.ag/128,Q=r.ag+W/2,ce=Q+W;for(let de=-W;de<ce;de+=W)for(let pe=-W;pe<ce;pe+=W){const Se=pe<0||pe>Q||de<0||de>Q?24575:0,ke=r.aw(Math.round(pe),0,r.ag),Ie=r.aw(Math.round(de),0,r.ag);V.emplaceBack(ke+Se,Ie)}const oe=(de,pe)=>{const Se=pe*H+de;j.emplaceBack(Se+1,Se,Se+H),j.emplaceBack(Se+H,Se+H+1,Se+1)};for(let de=1;de<129;de++)for(let pe=1;pe<129;pe++)oe(pe,de);return[0,129].forEach(de=>{for(let pe=0;pe<130;pe++)oe(pe,de),oe(de,pe)}),[V,j,32768]}(),T=t.context;this.gridBuffer=T.createVertexBuffer(d,r.b6.members),this.gridIndexBuffer=T.createIndexBuffer(y),this.gridSegments=r.b7.simpleSegment(0,0,d.length,y.length),this.gridNoSkirtSegments=r.b7.simpleSegment(0,0,d.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new kf(n.map),this.orthoMatrix=r.ab.mat4.create(),r.ab.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.ag,0,r.ag,0,1);const D=T.gl;this._overlapStencilMode=new Oi({func:D.GEQUAL,mask:255},0,255,D.KEEP,D.KEEP,D.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Cl(n.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,n,d){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const y=t.terrain.properties,b=t.terrain.drapeRenderMode===0,T=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.q.now();const D=t.terrain&&t.terrain.scope,F=y.get("source"),V=b?this._mockSourceCache:t.getSourceCache(F,D);if(!V)return void r.w(`Couldn't find terrain source "${F}".`);if(this.sourceCache=V,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(n):y.get("exaggeration"),!n.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const j=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const H=this.getScaledDemTileSize();this.sourceCache.update(n,H,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,j(),this._initializing=!0),j(),n.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const n=this._previousCameraAltitude,d=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=d;const y=n!=null?d-n:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const b=t.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(b);let D=b-this._previousZoom;const F=this._previousUpdateTimestamp;let V=b;this._evaluationZoom!=null&&(V=this._evaluationZoom,Math.abs(b-V)>.5&&(D=.5*(b-V+D)),D*y<0&&(V+=D)),this._evaluationZoom=V;const j=T.getExaggeration(V),H=j===T.getExaggeration(Math.max(0,V-.1));if(H&&Math.abs(j-this._exaggeration)<.01)return j;let W=Math.min(.1,.00375*(this._updateTimestamp-F));return(H||j<.1||Math.abs(D)<1e-4)&&(W=Math.min(.2,4*W)),r.af(this._exaggeration,j,W)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(r.aa.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=n.getIds().map(F=>{const V=n.getTileByID(F).tileID;return V.projMatrix=d.calculateProjMatrix(V.toUnwrapped()),V});(function(F,V){const j=V.transform.pointCoordinate(V.transform.getCameraPoint()),H=new r.P(j.x,j.y);F.sort((W,Q)=>{if(Q.overscaledZ-W.overscaledZ)return Q.overscaledZ-W.overscaledZ;const ce=new r.P(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),oe=new r.P(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),de=H.mult(1<<W.canonical.z);return de.x-=.5,de.y-=.5,de.distSqr(ce)-de.distSqr(oe)})})(y,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},y.forEach(F=>{this.proxyToSource[F.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const F in T){const V=T[F];if(!V.used||(V!==this.sourceCache&&this.resetTileLookupCache(V.id),this._setupProxiedCoordsForOrtho(V,t[F],b),V.usedForTerrain))continue;const j=t[F];V.getSource().reparseOverscaled&&this._assignTerrainTiles(j)}this.proxiedCoords[n.id]=y.map(F=>new pp(F,F.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const D={};this._visibleDemTiles=[];for(const F of this.proxyCoords){const V=this.terrainTileForTile[F.key];if(!V)continue;const j=V.tileID.key;j in D||(this._visibleDemTiles.push(V),D[j]=j)}}_assignTerrainTiles(t){this._initializing||t.forEach(n=>{if(this.terrainTileForTile[n.key])return;const d=this._findTileCoveringTileID(n,this.sourceCache);d&&(this.terrainTileForTile[n.key]=d)})}_prepareDEMTextures(){const t=this.painter.context,n=t.gl;for(const d in this.terrainTileForTile){const y=this.terrainTileForTile[d],b=y.dem;!b||y.demTexture&&!y.needsDEMTextureUpload||(t.activeTexture.set(n.TEXTURE1),An(this.painter,y,b))}}_prepareDemTileUniforms(t,n,d,y){if(!n||n.demTexture==null)return!1;const b=t.tileID.canonical,T=Math.pow(2,n.tileID.canonical.z-b.z),D=y||"";return d[`u_dem_tl${D}`]=[b.x*T%1,b.y*T%1],d[`u_dem_scale${D}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const n=this._visibleDemTiles.reduce((d,y)=>{if(!y.dem)return d;const b=y.dem.tree.minimums[0];return b>0&&t++,d+b},0);return t?n/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const d=this._getLoadedAreaMinimum(),y=new r.cK({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(y,{premultiply:!1}):b=this._emptyDEMTexture=new r.T(t,y,n.R32F,{premultiply:!1}),b}setupElevationDraw(t,n,d){const y=this.painter.context,b=y.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let D=null,F=null,V=1;if(d&&d.morphing&&this._useVertexMorphing){const Q=d.morphing.srcDemTile,ce=d.morphing.dstDemTile;V=d.morphing.phase,Q&&ce&&(this._prepareDemTileUniforms(t,Q,T,"_prev")&&(F=Q),this._prepareDemTileUniforms(t,ce,T)&&(D=ce))}const j=Q=>Q&&Q.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let H=null;var W;if(this.enabled?F&&D?(H=D.demTexture,y.activeTexture.set(b.TEXTURE4),F.demTexture.bind(j(F),b.CLAMP_TO_EDGE),T.u_dem_lerp=V):(D=this.terrainTileForTile[t.tileID.key],H=this._prepareDemTileUniforms(t,D,T)?D.demTexture:this.emptyDEMTexture):H=this.emptyDEMTexture,y.activeTexture.set(b.TEXTURE2),H&&(T.u_dem_size=(W=H).size[0]===1?1:W.size[0]-2,H.bind(j(D),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,n,T),d&&d.useMeterToDem&&D){const Q=(1<<D.tileID.canonical.z)*r.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=Q}if(d&&d.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),n.setTerrainUniformValues(y,T),this.painter.transform.projection.name==="globe"){const Q=this.globeUniformValues(this.painter.transform,t.tileID.canonical,d&&d.useDenormalizedUpVectorScale);n.setGlobeUniformValues(y,Q)}}globeUniformValues(t,n,d){const y=t.projection;return{u_tile_tl_up:y.upVector(n,0,0),u_tile_tr_up:y.upVector(n,r.ag,0),u_tile_br_up:y.upVector(n,r.ag,r.ag),u_tile_bl_up:y.upVector(n,0,r.ag),u_tile_up_scale:d?r.cL(1):y.upVectorScale(n,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const n=this.painter,d=this.painter.context;t.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,b,T,D,F){if(y.transform.projection.name==="globe")(function(V,j,H,W,Q){const ce=V.context,oe=ce.gl;let de,pe;const Se=V.transform,ke=r.cC(V,ce,Se),Ie=(It,At)=>{if(pe===At)return;const ot=[rd[At],"PROJECTION_GLOBE_VIEW"];ke&&ot.push("CUSTOM_ANTIALIASING");const wt=V.isTileAffectedByFog(It);de=V.getOrCreateProgram("globeRaster",{defines:ot,overrideFog:wt}),pe=At},Ue=V.colorModeForRenderPass(),Le=new Si(oe.LEQUAL,Si.ReadWrite,V.depthRangeFor3D);zo.update(Q);const Be=r.cD(Se),Oe=[r.at(Se.center.lng),r.aA(Se.center.lat)],He=V.globeSharedBuffers,Qe=[Se.width*r.q.devicePixelRatio,Se.height*r.q.devicePixelRatio],xt=Float32Array.from(Se.globeMatrix),ut={useDenormalizedUpVectorScale:!0};{const It=V.transform,At=uu(It.zoom,j.exaggeration(),j.sourceCache._source.tileSize);pe=-1;const ot=oe.TRIANGLES;for(const wt of W){const Vt=H.getTile(wt),st=Oi.disabled,Dt=j.prevTerrainTileForTile[wt.key],bt=j.terrainTileForTile[wt.key];id(Dt,bt)&&zo.newMorphing(wt.key,Dt,bt,Q,250),ce.activeTexture.set(oe.TEXTURE0),Vt.texture&&Vt.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const Kt=zo.getMorphValuesForProxy(wt.key),Bt=Kt?1:0;Kt&&r.J(ut,{morphing:{srcDemTile:Kt.from,dstDemTile:Kt.to,phase:r.cB(Kt.phase)}});const kt=r.cE(wt.canonical),$t=r.cF(kt.getCenter().lat),Xt=r.cG(wt.canonical,kt,$t,It.worldSize/It._pixelsPerMercatorPixel),ci=r.bb(r.cH(wt.canonical)),di=El(It.expandedFarZProjMatrix,xt,Be,ci,r.ae(It.zoom),Oe,It.frustumCorners.TL,It.frustumCorners.TR,It.frustumCorners.BR,It.frustumCorners.BL,It.globeCenterInViewSpace,It.globeRadius,Qe,At,It._farZ,Xt);if(Ie(wt,Bt),de&&(j.setupElevationDraw(Vt,de,ut),V.uploadCommonUniforms(ce,de,wt.toUnwrapped()),He)){const[Fi,Mi,Ei]=He.getGridBuffers($t,At!==0);de.draw(V,ot,Le,st,Ue,zi.backCCW,di,"globe_raster",Fi,Mi,Ei)}}}if(He&&(V.renderDefaultNorthPole||V.renderDefaultSouthPole)){const It=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ke&&It.push("CUSTOM_ANTIALIASING"),de=V.getOrCreateProgram("globeRaster",{defines:It});for(const At of W){const{x:ot,y:wt,z:Vt}=At.canonical,st=wt===0,Dt=wt===(1<<Vt)-1,[bt,Kt,Bt,kt]=He.getPoleBuffers(Vt,!1);if(kt&&(st||Dt)){const $t=H.getTile(At);ce.activeTexture.set(oe.TEXTURE0),$t.texture&&$t.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);let Xt=r.cI(Vt,ot,Se);const ci=r.bb(r.cH(At.canonical)),di=(Fi,Mi)=>Fi.draw(V,oe.TRIANGLES,Le,Oi.disabled,Ue,zi.disabled,El(Se.expandedFarZProjMatrix,Xt,Xt,ci,0,Oe,Se.frustumCorners.TL,Se.frustumCorners.TR,Se.frustumCorners.BR,Se.frustumCorners.BL,Se.globeCenterInViewSpace,Se.globeRadius,Qe,0,Se._farZ),"globe_pole_raster",Mi,Bt,kt);j.setupElevationDraw($t,de,ut),V.uploadCommonUniforms(ce,de,At.toUnwrapped()),st&&V.renderDefaultNorthPole&&di(de,bt),Dt&&V.renderDefaultSouthPole&&(Xt=r.ab.mat4.scale(r.ab.mat4.create(),Xt,[1,-1,1]),di(de,Kt))}}}})(y,b,T,D,F);else{const V=y.context,j=V.gl;let H,W;const Q=y.shadowRenderer,ce=bl(y,y.longestCutoffRange),oe=Ue=>{if(W===Ue)return;const Le=[];Le.push(rd[Ue]),ce.shouldRenderCutoff&&Le.push("RENDER_CUTOFF"),Q&&(Le.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Q.useNormalOffset&&Le.push("NORMAL_OFFSET")),H=y.getOrCreateProgram("terrainRaster",{defines:Le}),W=Ue},de=y.colorModeForRenderPass(),pe=new Si(j.LEQUAL,Si.ReadWrite,y.depthRangeFor3D);zo.update(F);const Se=y.transform,ke=uu(Se.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let Ie=[0,0,0];if(Q){const Ue=y.style.directionalLight,Le=y.style.ambientLight;Ue&&Le&&(Ie=Hh(y.style,Ue,Le))}{W=-1;const Ue=j.TRIANGLES,[Le,Be]=[b.gridIndexBuffer,b.gridSegments];for(const Oe of D){const He=T.getTile(Oe),Qe=Oi.disabled,xt=b.prevTerrainTileForTile[Oe.key],ut=b.terrainTileForTile[Oe.key];id(xt,ut)&&zo.newMorphing(Oe.key,xt,ut,F,250),V.activeTexture.set(j.TEXTURE0),He.texture&&He.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const It=zo.getMorphValuesForProxy(Oe.key),At=It?1:0;let ot;It&&(ot={morphing:{srcDemTile:It.from,dstDemTile:It.to,phase:r.cB(It.phase)}});const wt=cu(Oe.projMatrix,Df(Oe.canonical,Se.renderWorldCopies)?ke/10:ke,Ie);if(oe(At),!H)continue;b.setupElevationDraw(He,H,ot);const Vt=Oe.toUnwrapped();Q&&Q.setupShadows(Vt,H),y.uploadCommonUniforms(V,H,Vt,null,ce),H.draw(y,Ue,pe,Qe,de,zi.backCCW,wt,"terrain_raster",b.gridBuffer,Le,Be)}}}}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const n=this.painter,d=this.painter.context,y=this.proxySourceCache,b=this.proxiedCoords[y.id],T=this._drapedRenderBatches.shift(),D=n.style.order,F=[];let V=0;for(const j of b){const H=y.getTileByID(j.proxyTileKey),W=y.proxyCachedFBO[j.key]?y.proxyCachedFBO[j.key][t]:void 0,Q=W!==void 0?y.renderCache[W]:this.pool[V++],ce=W!==void 0;if(H.texture=Q.tex,ce&&!Q.dirty){F.push(H.tileID);continue}let oe;d.bindFramebuffer.set(Q.fb.framebuffer),this.renderedToTile=!1,Q.dirty&&(d.clear({color:r.aj.transparent,stencil:0}),Q.dirty=!1);for(let de=T.start;de<=T.end;++de){const pe=n.style._mergedLayers[D[de]];if(pe.isHidden(n.transform.zoom))continue;const Se=n.style.getLayerSourceCache(pe),ke=Se?this.proxyToSource[j.key][Se.id]:[j];if(!ke)continue;const Ie=ke;d.viewport.set([0,0,Q.fb.width,Q.fb.height]),oe!==(Se?Se.id:null)&&(this._setupStencil(Q,ke,pe,Se),oe=Se?Se.id:null),n.renderLayer(n,Se,pe,Ie)}if(this._drapedRenderBatches.length===0)for(const de of this._pendingGroundEffectLayers){const pe=n.style._mergedLayers[D[de]];if(pe.isHidden(n.transform.zoom))continue;const Se=n.style.getLayerSourceCache(pe),ke=Se?this.proxyToSource[j.key][Se.id]:[j];if(!ke)continue;const Ie=ke;d.viewport.set([0,0,Q.fb.width,Q.fb.height]),oe!==(Se?Se.id:null)&&(this._setupStencil(Q,ke,pe,Se),oe=Se?Se.id:null),n.renderLayer(n,Se,pe,Ie)}this.renderedToTile?(Q.dirty=!0,F.push(H.tileID)):ce||--V,V===5&&(V=0,this.renderToBackBuffer(F))}return this.renderToBackBuffer(F),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,n.width,n.height]),T.end+1}postRender(){}isLayerOrderingCorrect(t){const n=t.order.length;let d=-1,y=n;for(let b=0;b<n;++b)this._style.isLayerDraped(t._mergedLayers[t.order[b]])?d=Math.max(d,b):y=Math.min(y,b);return y>d}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{t=Math.min(t,n.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,n,d){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const T=b.tileID,D=1<<T.overscaledZ,{x:F,y:V}=T.canonical,j=F/D,H=(F+1)/D,W=V/D,Q=(V+1)/D;return{minx:j,miny:W,maxx:H,maxy:Q,t:b.dem.tree.raycastRoot(j,W,H,Q,t,n,d),tile:b}});y.sort((b,T)=>(b.t!==null?b.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const b of y){if(b.t==null)return null;const T=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,t,n,d);if(T!=null)return T}return null}_createFBO(){const t=this.painter.context,n=t.gl,d=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const y=new r.T(t,{width:d[0],height:d[1],data:null},n.RGBA8);y.bind(n.LINEAR,n.CLAMP_TO_EDGE);const b=t.createFramebuffer(d[0],d[1],!0,null);return b.colorAttachment.set(y.texture),b.depthAttachment=new If(t,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:b,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const n=this._style._mergedLayers[t],d=n.isHidden(this.painter.transform.zoom);return n.type==="hillshade"||n.type==="custom"?!d&&n.shouldRedrape():!d&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const d of this._style.getSources())if(d instanceof Bn){t=!0;break}if(!t)return;const n={};for(let d=0;d<this._style.order.length;++d){const y=this._style._mergedLayers[this._style.order[d]],b=this._style.getLayerSourceCache(y);if(b&&!n[b.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof r.a9){n[b.id]=!0;for(const T of this.proxyCoords){const D=this.proxyToSource[T.key][b.id];if(D)for(const F of D)this._clearRenderCacheForTile(b.id,F)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof Ia){t=!0;break}if(!t)return;const n={};for(let d=0;d<this._style.order.length;++d){const y=this._style._mergedLayers[this._style.order[d]],b=this._style.getLayerSourceCache(y);if(!b||n[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const T=y.paint.get("raster-fade-duration");for(const D of this.proxyCoords){const F=this.proxyToSource[D.key][b.id];if(F)for(const V of F){const j=nh(b.getTile(V),b.findLoadedParent(V,0),b,this.painter.transform,T);(j.opacity!==1||j.mix!==0)&&this._clearRenderCacheForTile(b.id,V)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,n=t.length;if(n===0)return;const d=[];this._pendingGroundEffectLayers=[];let y,b=0,T=this._style._mergedLayers[t[b]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++b<n;)T=this._style._mergedLayers[t[b]];for(;b<n;++b){const D=this._style._mergedLayers[t[b]];D.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(D)?y===void 0&&(y=b):(D.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),y!==void 0&&(d.push({start:y,end:b-1}),y=void 0)))}if(y!==void 0&&d.push({start:y,end:b-1}),d.length!==0){const D=d[d.length-1];this._pendingGroundEffectLayers.every(F=>F>D.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(t){const n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){const T=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let D=0;D<T.length;++D){const F=Object.values(T[D]);n.renderCachePool.push(...F)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,y=this._tilesDirty;for(let T=d.length-1;T>=0;T--){const D=d[T];if(n.getTileByID(D.key),n.proxyCachedFBO[D.key]!==void 0){const F=t[D.key],V=this.proxyToSource[D.key];let j=0;for(const H in V){const W=V[H],Q=F[H];if(!Q||Q.length!==W.length||W.some((ce,oe)=>ce!==Q[oe]||y[H]&&y[H].hasOwnProperty(ce.key))){j=-1;break}++j}for(const H in n.proxyCachedFBO[D.key])n.renderCache[n.proxyCachedFBO[D.key][H]].dirty=j<0||j!==Object.values(F).length}}const b=[...this._drapedRenderBatches];b.sort((T,D)=>D.end-D.start-(T.end-T.start));for(const T of b)for(const D of d){if(n.proxyCachedFBO[D.key])continue;let F=n.renderCachePool.pop();F===void 0&&n.renderCache.length<50&&(F=n.renderCache.length,n.renderCache.push(this._createFBO())),F!==void 0&&(n.proxyCachedFBO[D.key]={},n.proxyCachedFBO[D.key][T.start]=F,n.renderCache[F].dirty=!0)}this._tilesDirty={}}_setupStencil(t,n,d,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,T=b.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let D;if(d.isTileClipped())D=n.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);D=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+D>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=D,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Oi.disabled}_renderTileClippingMasks(t,n){const d=this.painter,y=this.painter.context,b=y.gl;d._tileClippingMaskIDs={},y.setColorMode(Xi.disabled),y.setDepthMode(Si.disabled);const T=d.getOrCreateProgram("clippingMask");for(const D of t){const F=d._tileClippingMaskIDs[D.key]=--n;T.draw(d,b.TRIANGLES,Si.disabled,new Oi({func:b.ALWAYS,mask:0},F,255,b.KEEP,b.KEEP,b.REPLACE),Xi.disabled,zi.disabled,nd(D.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const d=[t.x,t.y,1,1];r.ab.vec4.transformMat4(d,d,n.pixelMatrixInverse),r.ab.vec4.scale(d,d,1/d[3]),d[0]/=n.worldSize,d[1]/=n.worldSize;const y=n._camera.position,b=r.bH(1,n.center.lat),T=[y[0],y[1],y[2]/b,0],D=r.ab.vec3.subtract([],d.slice(0,3),T);r.ab.vec3.normalize(D,D);const F=this.raycast(T,D,this._exaggeration);return F!==null&&F?(r.ab.vec3.scaleAndAdd(T,T,D,F),T[3]=T[2],T[2]*=b,T):null}_setupProxiedCoordsForOrtho(t,n,d){if(t.getSource()instanceof r.aJ)return this._setupProxiedCoordsForImageSource(t,n,d);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const y=this.proxiedCoords[t.id]=[],b=this.proxyCoords;for(let F=0;F<b.length;F++){const V=b[F],j=this._findTileCoveringTileID(V,t);if(j){const H=this._createProxiedId(V,j,d[V.key]&&d[V.key][t.id]);y.push(H),this.proxyToSource[V.key][t.id]=[H]}}let T=!1;const D=new Set;for(let F=0;F<n.length;F++){const V=t.getTile(n[F]);if(!V||!V.hasData())continue;const j=this._findTileCoveringTileID(V.tileID,this.proxySourceCache);if(j&&j.tileID.canonical.z!==V.tileID.canonical.z){const H=this.proxyToSource[j.tileID.key][t.id],W=this._createProxiedId(j.tileID,V,d[j.tileID.key]&&d[j.tileID.key][t.id]);H?H.splice(H.length-1,0,W):this.proxyToSource[j.tileID.key][t.id]=[W];const Q=this.proxyToSource[j.tileID.key][t.id];D.has(Q)||D.add(Q),y.push(W),T=!0}}if(this._sourceTilesOverlap[t.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const F of D)F.sort((V,j)=>j.overscaledZ-V.overscaledZ)}_setupProxiedCoordsForImageSource(t,n,d){if(!t.getSource().loaded())return;const y=this.proxiedCoords[t.id]=[],b=this.proxyCoords,T=t.getSource(),D=T.tileID;if(!D)return;const F=new r.P(D.x,D.y)._div(1<<D.z),V=T.coordinates.map(r.aa.fromLngLat).reduce((H,W)=>(H.min.x=Math.min(H.min.x,W.x-F.x),H.min.y=Math.min(H.min.y,W.y-F.y),H.max.x=Math.max(H.max.x,W.x-F.x),H.max.y=Math.max(H.max.y,W.y-F.y),H),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),j=(H,W)=>{const Q=H.wrap+H.canonical.x/(1<<H.canonical.z),ce=H.canonical.y/(1<<H.canonical.z),oe=r.ag/(1<<H.canonical.z),de=W.wrap+W.canonical.x/(1<<W.canonical.z),pe=W.canonical.y/(1<<W.canonical.z);return Q+oe<de+V.min.x||Q>de+V.max.x||ce+oe<pe+V.min.y||ce>pe+V.max.y};for(let H=0;H<b.length;H++){const W=b[H];for(let Q=0;Q<n.length;Q++){const ce=t.getTile(n[Q]);if(!ce||!ce.hasData()||j(W,ce.tileID))continue;const oe=this._createProxiedId(W,ce,d[W.key]&&d[W.key][t.id]),de=this.proxyToSource[W.key][t.id];de?de.push(oe):this.proxyToSource[W.key][t.id]=[oe],y.push(oe)}}}_createProxiedId(t,n,d){let y=this.orthoMatrix;if(d){const b=d.find(T=>T.key===n.tileID.key);if(b)return b}if(n.tileID.key!==t.key){const b=t.canonical.z-n.tileID.canonical.z;let T,D,F;y=r.ab.mat4.create();const V=n.tileID.wrap-t.wrap<<t.overscaledZ;b>0?(T=r.ag>>b,D=T*((n.tileID.canonical.x<<b)-t.canonical.x+V),F=T*((n.tileID.canonical.y<<b)-t.canonical.y)):(T=r.ag<<-b,D=r.ag*(n.tileID.canonical.x-(t.canonical.x+V<<-b)),F=r.ag*(n.tileID.canonical.y-(t.canonical.y<<-b))),r.ab.mat4.ortho(y,0,T,0,T,0,1),r.ab.mat4.translate(y,y,[D,F,0])}return new pp(n.tileID,t.key,y)}_findTileCoveringTileID(t,n){let d=n.getTile(t);if(d&&d.hasData())return d;const y=this._findCoveringTileCache[n.id],b=y[t.key];if(d=b?n.getTileByID(b):null,d&&d.hasData()||b===null)return d;let T=d?d.tileID:t,D=T.overscaledZ;const F=n.getSource().minzoom,V=[];if(!b){const H=n.getSource().maxzoom;if(t.canonical.z>=H){const W=t.canonical.z-H;n.getSource().reparseOverscaled?(D=Math.max(t.canonical.z+2,n.transform.tileZoom),T=new r.aG(D,t.wrap,H,t.canonical.x>>W,t.canonical.y>>W)):W!==0&&(D=H,T=new r.aG(D,t.wrap,H,t.canonical.x>>W,t.canonical.y>>W))}T.key!==t.key&&(V.push(T.key),d=n.getTile(T))}const j=H=>{V.forEach(W=>{y[W]=H}),V.length=0};for(D-=1;D>=F&&(!d||!d.hasData());D--){d&&j(d.tileID.key);const H=T.calculateScaledKey(D);if(d=n.getTileByID(H),d&&d.hasData())break;const W=y[H];if(W===null)break;W===void 0?V.push(H):d=n.getTileByID(W)}return j(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,n){let d=this._tilesDirty[t];d||(d=this._tilesDirty[t]={}),d[n.key]=!0}}function Of(u,t,n){const d=function(D,F,V){const j=r.ab.vec3.dot(F,D),H=r.ab.vec3.dot(V,[.2126,.7152,.0722]),W=(ce,oe,de)=>(1-de)*ce+de*oe,Q=W(1-.3*Math.min(H,1),1,Math.min(j+1,1));return W(.92,1,Math.asin(r.aw(F[2],-1,1))/Math.PI+.5)*Q}(u,[0,0,1],t),y=[0,0,0];r.ab.vec3.scale(y,n.slice(0,3),d);const b=[0,0,0];r.ab.vec3.scale(b,t.slice(0,3),u[2]);const T=[0,0,0];return r.ab.vec3.add(T,y,b),r.cf(T)}const Ym=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Lf=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class Rf{static cacheKey(t,n,d,y){let b=`${n}${y?y.cacheKey:""}`;for(const T of d)t.usedDefines.includes(T)&&(b+=`/${T}`);return b}constructor(t,n,d,y,b,T){const D=t.gl;this.program=D.createProgram(),this.configuration=y,this.name=n,this.fixedDefines=[...T];const F=y?y.getBinderAttributes():[],V=(d.staticAttributes||[]).concat(F);let j=y?y.defines():[];j=j.concat(T.map(de=>`#define ${de}`));const H=`#version 300 es
`;let W=H+j.concat("precision mediump float;",uc,qh.fragmentSource).join(`
`);for(const de of d.fragmentIncludes)W+=`
${nu[de]}`;W+=`
${d.fragmentSource}`;let Q=H+j.concat("precision highp float;",uc,qh.vertexSource).join(`
`);for(const de of d.vertexIncludes)Q+=`
${nu[de]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&d.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(Q+=`
uniform int u_instanceID;
`),Q+=`
${d.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(Q=Q.replaceAll("gl_InstanceID","u_instanceID"));const ce=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(ce,W),D.compileShader(ce),D.attachShader(this.program,ce);const oe=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())this.failedToCreate=!0;else{D.shaderSource(oe,Q),D.compileShader(oe),D.attachShader(this.program,oe),this.attributes={},this.numAttributes=V.length;for(let de=0;de<this.numAttributes;de++)if(V[de]){const pe=V[de].startsWith("a_")?V[de]:`a_${V[de]}`;D.bindAttribLocation(this.program,de,pe),this.attributes[pe]=de}D.linkProgram(this.program),D.deleteShader(oe),D.deleteShader(ce),this.fixedUniforms=b(t),this.binderUniforms=y?y.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(de=>({u_instanceID:new r.bN(de)}))(t)),(T.includes("TERRAIN")||n.indexOf("symbol")!==-1||n.indexOf("circle")!==-1)&&(this.terrainUniforms=(de=>({u_dem:new r.bN(de),u_dem_prev:new r.bN(de),u_dem_tl:new r.bK(de),u_dem_scale:new r.bM(de),u_dem_tl_prev:new r.bK(de),u_dem_scale_prev:new r.bM(de),u_dem_size:new r.bM(de),u_dem_lerp:new r.bM(de),u_exaggeration:new r.bM(de),u_depth:new r.bN(de),u_depth_size_inv:new r.bK(de),u_depth_range_unpack:new r.bK(de),u_occluder_half_size:new r.bM(de),u_occlusion_depth_offset:new r.bM(de),u_meter_to_dem:new r.bM(de),u_label_plane_matrix_inv:new r.bJ(de)}))(t)),T.includes("GLOBE")&&(this.globeUniforms=(de=>({u_tile_tl_up:new r.bL(de),u_tile_tr_up:new r.bL(de),u_tile_br_up:new r.bL(de),u_tile_bl_up:new r.bL(de),u_tile_up_scale:new r.bM(de)}))(t)),T.includes("FOG")&&(this.fogUniforms=(de=>({u_fog_matrix:new r.bJ(de),u_fog_range:new r.bK(de),u_fog_color:new r.ca(de),u_fog_horizon_blend:new r.bM(de),u_fog_vertical_limit:new r.bK(de),u_fog_temporal_offset:new r.bM(de),u_frustum_tl:new r.bL(de),u_frustum_tr:new r.bL(de),u_frustum_br:new r.bL(de),u_frustum_bl:new r.bL(de),u_globe_pos:new r.bL(de),u_globe_radius:new r.bM(de),u_globe_transition:new r.bM(de),u_is_globe:new r.bN(de),u_viewport:new r.bK(de)}))(t)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(de=>({u_cutoff_params:new r.ca(de)}))(t)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(de=>({u_lighting_ambient_color:new r.bL(de),u_lighting_directional_dir:new r.bL(de),u_lighting_directional_color:new r.bL(de),u_ground_radiance:new r.bL(de)}))(t)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(de=>({u_light_matrix_0:new r.bJ(de),u_light_matrix_1:new r.bJ(de),u_fade_range:new r.bK(de),u_shadow_normal_offset:new r.bL(de),u_shadow_intensity:new r.bM(de),u_shadow_texel_size:new r.bM(de),u_shadow_map_resolution:new r.bM(de),u_shadow_direction:new r.bL(de),u_shadow_bias:new r.bL(de),u_shadowmap_0:new r.bN(de),u_shadowmap_1:new r.bN(de)}))(t))}}setTerrainUniformValues(t,n){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in n)d[y]&&d[y].set(this.program,y,n[y])}}setGlobeUniformValues(t,n){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in n)d[y]&&d[y].set(this.program,y,n[y])}}setFogUniformValues(t,n){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in n)d[y].set(this.program,y,n[y])}}setCutoffUniformValues(t,n){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in n)d[y].set(this.program,y,n[y])}}setLightsUniformValues(t,n){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in n)d[y].set(this.program,y,n[y])}}setShadowUniformValues(t,n){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;t.program.set(this.program);for(const y in n)d[y].set(this.program,y,n[y])}_drawDebugWireframe(t,n,d,y,b,T,D,F,V,j){const H=t.options.wireframe;if(H.terrain===!1&&H.layers2D===!1&&H.layers3D===!1)return;const W=t.context;if(!(!(!H.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!H.layers2D||t._terrain&&t._terrain.renderingToTexture||!Ym.includes(this.name))||!(!H.layers3D||!Lf.includes(this.name))))return;const Q=W.gl,ce=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,b,W);if(!ce)return;const oe=[...this.fixedDefines];oe.push("DEBUG_WIREFRAME");const de=t.getOrCreateProgram(this.name,{config:this.configuration,defines:oe});W.program.set(de.program);const pe=(Ie,Ue,Le)=>{if(Ue[Ie]&&Le[Ie])for(const Be in Ue[Ie])Le[Ie][Be]&&Le[Ie][Be].set(Le.program,Be,Ue[Ie][Be].current)};V&&V.setUniforms(de.program,W,de.binderUniforms,D,{zoom:F}),pe("fixedUniforms",this,de),pe("terrainUniforms",this,de),pe("globeUniforms",this,de),pe("fogUniforms",this,de),pe("lightsUniforms",this,de),pe("shadowUniforms",this,de),ce.bind(),W.setColorMode(new Xi([Q.ONE,Q.ONE_MINUS_SRC_ALPHA,Q.ZERO,Q.ONE],r.aj.transparent,[!0,!0,!0,!1])),W.setDepthMode(new Si(n.func===Q.LESS?Q.LEQUAL:n.func,Si.ReadOnly,n.range)),W.setStencilMode(Oi.disabled);const Se=3*T.primitiveLength*2,ke=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Ie=j||1;for(let Ue=0;Ue<Ie;++Ue)de.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ue),Q.drawElements(Q.LINES,Se,Q.UNSIGNED_SHORT,ke)}else j&&j>1?Q.drawElementsInstanced(Q.LINES,Se,Q.UNSIGNED_SHORT,ke,j):Q.drawElements(Q.LINES,Se,Q.UNSIGNED_SHORT,ke);b.bind(),W.program.set(this.program),W.setDepthMode(n),W.setStencilMode(d),W.setColorMode(y)}checkUniforms(t,n,d){if(this.fixedDefines.includes(n)){for(const y of Object.keys(d))if(!d[y].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${y} not set but required by ${n} being defined`)}}draw(t,n,d,y,b,T,D,F,V,j,H,W,Q,ce,oe,de){const pe=t.context,Se=pe.gl;if(this.failedToCreate)return;pe.program.set(this.program),pe.setDepthMode(d),pe.setStencilMode(y),pe.setColorMode(b),pe.setCullFace(T);for(const Ue of Object.keys(this.fixedUniforms))this.fixedUniforms[Ue].set(this.program,Ue,D[Ue]);ce&&ce.setUniforms(this.program,pe,this.binderUniforms,W,{zoom:Q});const ke={[Se.POINTS]:1,[Se.LINES]:2,[Se.TRIANGLES]:3,[Se.LINE_STRIP]:1}[n];this.checkUniforms(F,"RENDER_SHADOWS",this.shadowUniforms);const Ie=de&&de>0?1:void 0;for(const Ue of H.get()){const Le=Ue.vaos||(Ue.vaos={});if((Le[F]||(Le[F]=new lp)).bind(pe,this,V,ce?ce.getPaintVertexBuffers():[],j,Ue.vertexOffset,oe||[],Ie),this.forceManualRenderingForInstanceIDShaders){const Be=de||1;for(let Oe=0;Oe<Be;++Oe)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Oe),j?Se.drawElements(n,Ue.primitiveLength*ke,Se.UNSIGNED_SHORT,Ue.primitiveOffset*ke*2):Se.drawArrays(n,Ue.vertexOffset,Ue.vertexLength)}else de&&de>1?Se.drawElementsInstanced(n,Ue.primitiveLength*ke,Se.UNSIGNED_SHORT,Ue.primitiveOffset*ke*2,de):j?Se.drawElements(n,Ue.primitiveLength*ke,Se.UNSIGNED_SHORT,Ue.primitiveOffset*ke*2):Se.drawArrays(n,Ue.vertexOffset,Ue.vertexLength);n===Se.TRIANGLES&&j&&this._drawDebugWireframe(t,d,y,b,j,Ue,W,Q,ce,de)}}}function du(u,t){const n=Math.pow(2,t.tileID.overscaledZ),d=t.tileSize*Math.pow(2,u.transform.tileZoom)/n,y=d*(t.tileID.canonical.x+t.tileID.wrap*n),b=d*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ar(t,1,u.transform.tileZoom),u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b]}}const pu={terrain:0,flat:1},la=r.ab.mat4.create(),sd=(u,t,n,d,y,b,T,D,F,V,j,H,W,Q,ce,oe,de,pe)=>{const Se=t.style.light,ke=Se.properties.get("position"),Ie=[ke.x,ke.y,ke.z],Ue=r.ab.mat3.create();Se.properties.get("anchor")==="viewport"&&(r.ab.mat3.fromRotation(Ue,-t.transform.angle),r.ab.vec3.transformMat3(Ie,Ie,Ue));const Le=Se.properties.get("color"),Be=t.transform,Oe={u_matrix:u,u_lightpos:Ie,u_lightintensity:Se.properties.get("intensity"),u_lightcolor:[Le.r,Le.g,Le.b],u_vertical_gradient:+n,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:la,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:pu[V],u_base_type:pu[j],u_ao:y,u_edge_radius:b,u_width_scale:T,u_flood_light_color:ce,u_vertical_scale:oe,u_flood_light_intensity:de,u_ground_shadow_factor:pe};return Be.projection.name==="globe"&&(Oe.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],Oe.u_zoom_transition=H,Oe.u_inv_rot_matrix=Q,Oe.u_merc_center=W,Oe.u_up_dir=Be.projection.upVector(new r.bT(0,0,0),W[0]*r.ag,W[1]*r.ag),Oe.u_height_lift=F),Oe},dc=(u,t,n,d,y,b)=>({u_matrix:u,u_edge_radius:t,u_width_scale:n,u_vertical_scale:d,u_height_type:pu[y],u_base_type:pu[b]}),zf=(u,t,n,d,y,b,T,D,F,V,j,H,W,Q,ce,oe,de)=>{const pe=sd(u,t,n,d,y,b,T,D,V,j,H,W,Q,ce,oe,de,1,[0,0,0]),Se={u_height_factor:-Math.pow(2,D.overscaledZ)/F.tileSize/8};return r.l(pe,du(t,F),Se)},pc=(u,t)=>({u_matrix:u,u_emissive_strength:t}),fu=(u,t,n,d)=>r.l(pc(u,t),du(n,d)),fp=(u,t,n)=>({u_matrix:u,u_world:n,u_emissive_strength:t}),Ff=(u,t,n,d,y)=>r.l(fu(u,t,n,d),{u_world:y}),Xm=(u,t,n,d)=>{const y=r.ag/n.tileSize;return{u_matrix:u,u_camera_to_center_distance:t.getCameraToCenterDistance(d),u_extrude_scale:[t.pixelsToGLUnits[0]/y,t.pixelsToGLUnits[1]/y]}},fc=(u,t,n=1)=>({u_matrix:u,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:n}),od=r.ab.mat4.create(),_i=(u,t,n,d,y,b,T)=>{const D=u.transform,F=D.projection.name==="globe",V=F?r.cN(D.zoom,t.canonical)*D._pixelsPerMercatorPixel:r.ar(n,1,b),j={u_matrix:t.projMatrix,u_extrude_scale:V,u_intensity:T,u_inv_rot_matrix:od,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(F){j.u_inv_rot_matrix=d,j.u_merc_center=y,j.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],j.u_zoom_transition=r.ae(D.zoom);const H=y[0]*r.ag,W=y[1]*r.ag;j.u_up_dir=D.projection.upVector(new r.bT(0,0,0),H,W)}return j};function mu(u,[t,n,d,y],[b,T]){if(b===T)return[0,0,0,0];const D=255*(u-1)/(u*(T-b));return[t*D,n*D,d*D,y*D]}function sh(u,t,[n,d]){return n===d?0:.5/u+(t-n)*(u-1)/(u*(d-n))}const Al=(u,t,n,d,y,b,T,D,F,V,j,H,W,Q,ce,oe,de,pe,Se,ke,Ie)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:d,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:V,u_fade_t:j.mix,u_opacity:j.opacity*H.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:H.paint.get("raster-brightness-min"),u_brightness_high:H.paint.get("raster-brightness-max"),u_saturation_factor:r.cO(H.paint.get("raster-saturation")),u_contrast_factor:r.cP(H.paint.get("raster-contrast")),u_spin_weights:mc(H.paint.get("raster-hue-rotate")),u_perspective_transform:W,u_raster_elevation:Q,u_zoom_transition:T,u_merc_center:D,u_cutoff_params:F,u_colorization_mix:mu(r.cQ,oe,pe),u_colorization_offset:sh(r.cQ,de,pe),u_color_ramp:ce,u_texture_offset:[ke/(Se+2*ke),Se/(Se+2*ke)],u_texture_res:[Se+2*ke,Se+2*ke],u_emissive_strength:Ie});function mc(u){u*=Math.PI/180;const t=Math.sin(u),n=Math.cos(u);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const wi=.05,Ba=(u,t,n,d,y,b,T,D,F,V,j,H)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:d,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:V,u_fade_t:j.mix,u_opacity:j.opacity,u_image0:0,u_image1:1,u_raster_elevation:H,u_zoom_transition:T,u_merc_center:D,u_cutoff_params:F}),ad=(u,t,n,d,y,b,T,D,F,V)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_tile_offset:n,u_velocity:d,u_color_ramp:b,u_velocity_res:y,u_max_speed:T,u_uv_offset:D,u_data_scale:[255*F[0],255*F[1]],u_data_offset:V,u_particle_pos_scale:1.1,u_particle_pos_offset:[wi,wi]}),Bf=(u,t,n,d,y,b,T,D,F,V)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_velocity:n,u_velocity_res:d,u_max_speed:y,u_speed_factor:b,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:D,u_data_scale:[255*F[0],255*F[1]],u_data_offset:V,u_particle_pos_scale:1.1,u_particle_pos_offset:[wi,wi]}),ca=r.ab.mat4.create(),mp=(u,t,n,d,y,b,T,D,F,V,j,H,W,Q,ce,oe,de,pe,Se,ke,Ie,Ue)=>{const Le=y.transform,Be={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Le.getCameraToCenterDistance(Se),u_rotate_symbol:+n,u_aspect_ratio:Le.width/Le.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:D,u_is_text:+V,u_elevation_from_sea:F?1:0,u_pitch_with_map:+d,u_texsize:j,u_texsize_icon:H,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ca,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ca,u_up_vector:[0,-1,0],u_color_adj_mat:ke,u_icon_transition:Ie||0,u_gamma_scale:d?y.transform.getCameraToCenterDistance(Se)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:r.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Ue||1};return Se.name==="globe"&&(Be.u_tile_id=[Q.canonical.x,Q.canonical.y,1<<Q.canonical.z],Be.u_zoom_transition=ce,Be.u_inv_rot_matrix=de,Be.u_merc_center=oe,Be.u_camera_forward=Le._camera.forward(),Be.u_ecef_origin=r.cR(Le.globeMatrix,Q.toUnwrapped()),Be.u_tile_matrix=Float32Array.from(Le.globeMatrix),Be.u_up_vector=pe),Be},ld=(u,t,n,d)=>({u_matrix:u,u_emissive_strength:t,u_opacity:n,u_color:d}),Nf=(u,t,n,d,y,b,T,D,F)=>r.l(function(V,j,H,W,Q,ce){const{width:oe,height:de}=W.imageManager.getPixelSize(j),pe=Math.pow(2,ce.tileID.overscaledZ),Se=ce.tileSize*Math.pow(2,W.transform.tileZoom)/pe,ke=Se*(ce.tileID.canonical.x+ce.tileID.wrap*pe),Ie=Se*ce.tileID.canonical.y;return{u_image:0,u_pattern_tl:H.tl,u_pattern_br:H.br,u_texsize:[oe,de],u_pattern_size:H.displaySize,u_pattern_units_to_pixels:Q?[W.transform.width,-1*W.transform.height]:[1/r.ar(ce,1,W.transform.tileZoom),1/r.ar(ce,1,W.transform.tileZoom)],u_pixel_coord_upper:[ke>>16,Ie>>16],u_pixel_coord_lower:[65535&ke,65535&Ie]}}(0,b,T,d,D,F),{u_matrix:u,u_emissive_strength:t,u_opacity:n}),gc=new Float32Array(r.ab.mat4.identity([])),Jo=(u,t,n,d,y,b,T,D,F,V,j,H,W,Q=[0,0,0],ce)=>{const oe=y.style.light,de=oe.properties.get("position"),pe=[-de.x,-de.y,de.z],Se=r.ab.mat3.create();oe.properties.get("anchor")==="viewport"&&(r.ab.mat3.fromRotation(Se,-y.transform.angle),r.ab.vec3.transformMat3(pe,pe,Se));const ke=j.alphaMode==="MASK",Ie=oe.properties.get("color").toRenderColor(null),Ue=W.paint.get("model-ambient-occlusion-intensity"),Le=W.paint.get("model-color").constantOr(r.aj.white).toRenderColor(null),Be=W.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:u,u_lighting_matrix:t,u_normal_matrix:n,u_node_matrix:d||gc,u_lightpos:pe,u_lightintensity:oe.properties.get("intensity"),u_lightcolor:[Ie.r,Ie.g,Ie.b],u_camera_pos:Q,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+ke,u_alphaCutoff:j.alphaCutoff,u_baseColorFactor:[T.r,T.g,T.b,T.a],u_emissiveFactor:[D[0],D[1],D[2],1],u_metallicFactor:F,u_roughnessFactor:V,u_baseColorTexture:Os.BaseColor,u_metallicRoughnessTexture:Os.MetallicRoughness,u_normalTexture:Os.Normal,u_occlusionTexture:Os.Occlusion,u_emissionTexture:Os.Emission,u_lutTexture:Os.LUT,u_color_mix:[Le.r,Le.g,Le.b,Be],u_aoIntensity:Ue,u_emissive_strength:H,u_occlusionTextureTransform:ce||[0,0,0,0]}},cd=(u,t=gc,n=gc)=>({u_matrix:u,u_instance:t,u_node_matrix:n}),oh={fillExtrusion:u=>({u_matrix:new r.bJ(u),u_lightpos:new r.bL(u),u_lightintensity:new r.bM(u),u_lightcolor:new r.bL(u),u_vertical_gradient:new r.bM(u),u_opacity:new r.bM(u),u_edge_radius:new r.bM(u),u_width_scale:new r.bM(u),u_ao:new r.bK(u),u_height_type:new r.bN(u),u_base_type:new r.bN(u),u_tile_id:new r.bL(u),u_zoom_transition:new r.bM(u),u_inv_rot_matrix:new r.bJ(u),u_merc_center:new r.bK(u),u_up_dir:new r.bL(u),u_height_lift:new r.bM(u),u_flood_light_color:new r.bL(u),u_vertical_scale:new r.bM(u),u_flood_light_intensity:new r.bM(u),u_ground_shadow_factor:new r.bL(u)}),fillExtrusionDepth:u=>({u_matrix:new r.bJ(u),u_edge_radius:new r.bM(u),u_width_scale:new r.bM(u),u_vertical_scale:new r.bM(u),u_height_type:new r.bN(u),u_base_type:new r.bN(u)}),fillExtrusionPattern:u=>({u_matrix:new r.bJ(u),u_lightpos:new r.bL(u),u_lightintensity:new r.bM(u),u_lightcolor:new r.bL(u),u_vertical_gradient:new r.bM(u),u_height_factor:new r.bM(u),u_edge_radius:new r.bM(u),u_width_scale:new r.bM(u),u_ao:new r.bK(u),u_height_type:new r.bN(u),u_base_type:new r.bN(u),u_tile_id:new r.bL(u),u_zoom_transition:new r.bM(u),u_inv_rot_matrix:new r.bJ(u),u_merc_center:new r.bK(u),u_up_dir:new r.bL(u),u_height_lift:new r.bM(u),u_image:new r.bN(u),u_texsize:new r.bK(u),u_pixel_coord_upper:new r.bK(u),u_pixel_coord_lower:new r.bK(u),u_tile_units_to_pixels:new r.bM(u),u_opacity:new r.bM(u)}),fillExtrusionGroundEffect:u=>({u_matrix:new r.bJ(u),u_opacity:new r.bM(u),u_ao_pass:new r.bM(u),u_meter_to_tile:new r.bM(u),u_ao:new r.bK(u),u_flood_light_intensity:new r.bM(u),u_flood_light_color:new r.bL(u),u_attenuation:new r.bM(u),u_edge_radius:new r.bM(u),u_fb:new r.bN(u),u_fb_size:new r.bM(u),u_dynamic_offset:new r.bM(u)}),fill:u=>({u_matrix:new r.bJ(u),u_emissive_strength:new r.bM(u)}),fillPattern:u=>({u_matrix:new r.bJ(u),u_emissive_strength:new r.bM(u),u_image:new r.bN(u),u_texsize:new r.bK(u),u_pixel_coord_upper:new r.bK(u),u_pixel_coord_lower:new r.bK(u),u_tile_units_to_pixels:new r.bM(u)}),fillOutline:u=>({u_matrix:new r.bJ(u),u_emissive_strength:new r.bM(u),u_world:new r.bK(u)}),fillOutlinePattern:u=>({u_matrix:new r.bJ(u),u_emissive_strength:new r.bM(u),u_world:new r.bK(u),u_image:new r.bN(u),u_texsize:new r.bK(u),u_pixel_coord_upper:new r.bK(u),u_pixel_coord_lower:new r.bK(u),u_tile_units_to_pixels:new r.bM(u)}),circle:r.cS,collisionBox:u=>({u_matrix:new r.bJ(u),u_camera_to_center_distance:new r.bM(u),u_extrude_scale:new r.bK(u)}),collisionCircle:u=>({u_matrix:new r.bJ(u),u_inv_matrix:new r.bJ(u),u_camera_to_center_distance:new r.bM(u),u_viewport_size:new r.bK(u)}),debug:u=>({u_color:new r.cz(u),u_matrix:new r.bJ(u),u_overlay:new r.bN(u),u_overlay_scale:new r.bM(u)}),clippingMask:u=>({u_matrix:new r.bJ(u)}),heatmap:u=>({u_extrude_scale:new r.bM(u),u_intensity:new r.bM(u),u_matrix:new r.bJ(u),u_inv_rot_matrix:new r.bJ(u),u_merc_center:new r.bK(u),u_tile_id:new r.bL(u),u_zoom_transition:new r.bM(u),u_up_dir:new r.bL(u)}),heatmapTexture:u=>({u_image:new r.bN(u),u_color_ramp:new r.bN(u),u_opacity:new r.bM(u)}),hillshade:u=>({u_matrix:new r.bJ(u),u_image:new r.bN(u),u_latrange:new r.bK(u),u_light:new r.bK(u),u_shadow:new r.cz(u),u_highlight:new r.cz(u),u_emissive_strength:new r.bM(u),u_accent:new r.cz(u)}),hillshadePrepare:u=>({u_matrix:new r.bJ(u),u_image:new r.bN(u),u_dimension:new r.bK(u),u_zoom:new r.bM(u)}),line:r.cT,linePattern:r.cU,raster:u=>({u_matrix:new r.bJ(u),u_normalize_matrix:new r.bJ(u),u_globe_matrix:new r.bJ(u),u_merc_matrix:new r.bJ(u),u_grid_matrix:new r.cA(u),u_tl_parent:new r.bK(u),u_scale_parent:new r.bM(u),u_fade_t:new r.bM(u),u_opacity:new r.bM(u),u_image0:new r.bN(u),u_image1:new r.bN(u),u_brightness_low:new r.bM(u),u_brightness_high:new r.bM(u),u_saturation_factor:new r.bM(u),u_contrast_factor:new r.bM(u),u_spin_weights:new r.bL(u),u_perspective_transform:new r.bK(u),u_raster_elevation:new r.bM(u),u_zoom_transition:new r.bM(u),u_merc_center:new r.bK(u),u_cutoff_params:new r.ca(u),u_colorization_mix:new r.ca(u),u_colorization_offset:new r.bM(u),u_color_ramp:new r.bN(u),u_texture_offset:new r.bK(u),u_texture_res:new r.bK(u),u_emissive_strength:new r.bM(u)}),rasterParticle:u=>({u_matrix:new r.bJ(u),u_normalize_matrix:new r.bJ(u),u_globe_matrix:new r.bJ(u),u_merc_matrix:new r.bJ(u),u_grid_matrix:new r.cA(u),u_tl_parent:new r.bK(u),u_scale_parent:new r.bM(u),u_fade_t:new r.bM(u),u_opacity:new r.bM(u),u_image0:new r.bN(u),u_image1:new r.bN(u),u_raster_elevation:new r.bM(u),u_zoom_transition:new r.bM(u),u_merc_center:new r.bK(u),u_cutoff_params:new r.ca(u)}),rasterParticleTexture:u=>({u_texture:new r.bN(u),u_opacity:new r.bM(u)}),rasterParticleDraw:u=>({u_particle_texture:new r.bN(u),u_particle_texture_side_len:new r.bM(u),u_tile_offset:new r.bK(u),u_velocity:new r.bN(u),u_color_ramp:new r.bN(u),u_velocity_res:new r.bK(u),u_max_speed:new r.bM(u),u_uv_offset:new r.bK(u),u_data_scale:new r.bK(u),u_data_offset:new r.bM(u),u_particle_pos_scale:new r.bM(u),u_particle_pos_offset:new r.bK(u)}),rasterParticleUpdate:u=>({u_particle_texture:new r.bN(u),u_particle_texture_side_len:new r.bM(u),u_velocity:new r.bN(u),u_velocity_res:new r.bK(u),u_max_speed:new r.bM(u),u_speed_factor:new r.bM(u),u_reset_rate:new r.bM(u),u_rand_seed:new r.bM(u),u_uv_offset:new r.bK(u),u_data_scale:new r.bK(u),u_data_offset:new r.bM(u),u_particle_pos_scale:new r.bM(u),u_particle_pos_offset:new r.bK(u)}),symbol:u=>({u_is_size_zoom_constant:new r.bN(u),u_is_size_feature_constant:new r.bN(u),u_size_t:new r.bM(u),u_size:new r.bM(u),u_camera_to_center_distance:new r.bM(u),u_rotate_symbol:new r.bN(u),u_aspect_ratio:new r.bM(u),u_fade_change:new r.bM(u),u_matrix:new r.bJ(u),u_label_plane_matrix:new r.bJ(u),u_coord_matrix:new r.bJ(u),u_is_text:new r.bN(u),u_elevation_from_sea:new r.bN(u),u_pitch_with_map:new r.bN(u),u_texsize:new r.bK(u),u_texsize_icon:new r.bK(u),u_texture:new r.bN(u),u_texture_icon:new r.bN(u),u_gamma_scale:new r.bM(u),u_device_pixel_ratio:new r.bM(u),u_tile_id:new r.bL(u),u_zoom_transition:new r.bM(u),u_inv_rot_matrix:new r.bJ(u),u_merc_center:new r.bK(u),u_camera_forward:new r.bL(u),u_tile_matrix:new r.bJ(u),u_up_vector:new r.bL(u),u_ecef_origin:new r.bL(u),u_is_halo:new r.bN(u),u_icon_transition:new r.bM(u),u_color_adj_mat:new r.bJ(u),u_scale_factor:new r.bM(u)}),background:u=>({u_matrix:new r.bJ(u),u_emissive_strength:new r.bM(u),u_opacity:new r.bM(u),u_color:new r.cz(u)}),backgroundPattern:u=>({u_matrix:new r.bJ(u),u_emissive_strength:new r.bM(u),u_opacity:new r.bM(u),u_image:new r.bN(u),u_pattern_tl:new r.bK(u),u_pattern_br:new r.bK(u),u_texsize:new r.bK(u),u_pattern_size:new r.bK(u),u_pixel_coord_upper:new r.bK(u),u_pixel_coord_lower:new r.bK(u),u_pattern_units_to_pixels:new r.bK(u)}),terrainRaster:u=>({u_matrix:new r.bJ(u),u_image0:new r.bN(u),u_skirt_height:new r.bM(u),u_ground_shadow_factor:new r.bL(u)}),skybox:u=>({u_matrix:new r.bJ(u),u_sun_direction:new r.bL(u),u_cubemap:new r.bN(u),u_opacity:new r.bM(u),u_temporal_offset:new r.bM(u)}),skyboxGradient:u=>({u_matrix:new r.bJ(u),u_color_ramp:new r.bN(u),u_center_direction:new r.bL(u),u_radius:new r.bM(u),u_opacity:new r.bM(u),u_temporal_offset:new r.bM(u)}),skyboxCapture:u=>({u_matrix_3f:new r.cA(u),u_sun_direction:new r.bL(u),u_sun_intensity:new r.bM(u),u_color_tint_r:new r.ca(u),u_color_tint_m:new r.ca(u),u_luminance:new r.bM(u)}),globeRaster:u=>({u_proj_matrix:new r.bJ(u),u_globe_matrix:new r.bJ(u),u_normalize_matrix:new r.bJ(u),u_merc_matrix:new r.bJ(u),u_zoom_transition:new r.bM(u),u_merc_center:new r.bK(u),u_image0:new r.bN(u),u_grid_matrix:new r.cA(u),u_skirt_height:new r.bM(u),u_far_z_cutoff:new r.bM(u),u_frustum_tl:new r.bL(u),u_frustum_tr:new r.bL(u),u_frustum_br:new r.bL(u),u_frustum_bl:new r.bL(u),u_globe_pos:new r.bL(u),u_globe_radius:new r.bM(u),u_viewport:new r.bK(u)}),globeAtmosphere:u=>({u_frustum_tl:new r.bL(u),u_frustum_tr:new r.bL(u),u_frustum_br:new r.bL(u),u_frustum_bl:new r.bL(u),u_horizon:new r.bM(u),u_transition:new r.bM(u),u_fadeout_range:new r.bM(u),u_color:new r.ca(u),u_high_color:new r.ca(u),u_space_color:new r.ca(u),u_temporal_offset:new r.bM(u),u_horizon_angle:new r.bM(u)}),model:u=>({u_matrix:new r.bJ(u),u_lighting_matrix:new r.bJ(u),u_normal_matrix:new r.bJ(u),u_node_matrix:new r.bJ(u),u_lightpos:new r.bL(u),u_lightintensity:new r.bM(u),u_lightcolor:new r.bL(u),u_camera_pos:new r.bL(u),u_opacity:new r.bM(u),u_baseColorFactor:new r.ca(u),u_emissiveFactor:new r.ca(u),u_metallicFactor:new r.bM(u),u_roughnessFactor:new r.bM(u),u_baseTextureIsAlpha:new r.bN(u),u_alphaMask:new r.bN(u),u_alphaCutoff:new r.bM(u),u_baseColorTexture:new r.bN(u),u_metallicRoughnessTexture:new r.bN(u),u_normalTexture:new r.bN(u),u_occlusionTexture:new r.bN(u),u_emissionTexture:new r.bN(u),u_lutTexture:new r.bN(u),u_color_mix:new r.ca(u),u_aoIntensity:new r.bM(u),u_emissive_strength:new r.bM(u),u_occlusionTextureTransform:new r.ca(u)}),modelDepth:u=>({u_matrix:new r.bJ(u),u_instance:new r.bJ(u),u_node_matrix:new r.bJ(u)}),groundShadow:u=>({u_matrix:new r.bJ(u),u_ground_shadow_factor:new r.bL(u)}),stars:u=>({u_matrix:new r.bJ(u),u_up:new r.bL(u),u_right:new r.bL(u),u_intensity_multiplier:new r.bM(u)}),snowParticle:u=>({u_modelview:new r.bJ(u),u_projection:new r.bJ(u),u_time:new r.bM(u),u_cam_pos:new r.bL(u),u_velocityConeAperture:new r.bM(u),u_velocity:new r.bM(u),u_horizontalOscillationRadius:new r.bM(u),u_horizontalOscillationRate:new r.bM(u),u_boxSize:new r.bM(u),u_billboardSize:new r.bM(u),u_simpleShapeParameters:new r.bK(u),u_screenSize:new r.bK(u),u_thinningCenterPos:new r.bK(u),u_thinningShape:new r.bL(u),u_thinningAffectedRatio:new r.bM(u),u_thinningParticleOffset:new r.bM(u),u_particleColor:new r.ca(u),u_direction:new r.bL(u)}),rainParticle:u=>({u_modelview:new r.bJ(u),u_projection:new r.bJ(u),u_time:new r.bM(u),u_cam_pos:new r.bL(u),u_texScreen:new r.bN(u),u_velocityConeAperture:new r.bM(u),u_velocity:new r.bM(u),u_boxSize:new r.bM(u),u_rainDropletSize:new r.bK(u),u_distortionStrength:new r.bM(u),u_rainDirection:new r.bL(u),u_color:new r.ca(u),u_screenSize:new r.bK(u),u_thinningCenterPos:new r.bK(u),u_thinningShape:new r.bL(u),u_thinningAffectedRatio:new r.bM(u),u_thinningParticleOffset:new r.bM(u),u_shapeDirectionalPower:new r.bM(u),u_shapeNormalPower:new r.bM(u),u_mode:new r.bM(u)}),vignette:u=>({u_vignetteShape:new r.bL(u),u_vignetteColor:new r.ca(u)}),occlusion:u=>({u_matrix:new r.bJ(u),u_anchorPos:new r.bL(u),u_screenSizePx:new r.bK(u),u_occluderSizePx:new r.bK(u),u_color:new r.ca(u)})};class Na{constructor(t,n,d,y){this.id=Na.uniqueIdxCounter,Na.uniqueIdxCounter++,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||y||n.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Na.uniqueIdxCounter,Na.uniqueIdxCounter++;const n=this.context.gl;this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Na.uniqueIdxCounter=0;const xo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ss{constructor(t,n,d,y,b,T){this.length=n.length,this.attributes=d,this.itemSize=n.bytesPerElement,this.dynamicDraw=y,this.instanceCount=T,this.context=t;const D=t.gl;this.buffer=D.createBuffer(),t.bindVertexBuffer.set(this.buffer),D.bufferData(D.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?D.DYNAMIC_DRAW:D.STATIC_DRAW),this.dynamicDraw||b||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let d=0;d<this.attributes.length;d++){const y=n.attributes[this.attributes[d].name];y!==void 0&&t.enableVertexAttribArray(y)}}setVertexAttribPointers(t,n,d){for(let y=0;y<this.attributes.length;y++){const b=this.attributes[y],T=n.attributes[b.name];T!==void 0&&t.vertexAttribPointer(T,b.components,t[xo[b.type]],!1,this.itemSize,b.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(t,n,d){for(let y=0;y<this.attributes.length;y++){const b=n.attributes[this.attributes[y].name];b!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(b,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class gp{constructor(t,n,d,y,b){this.context=t,this.width=n,this.height=d;const T=this.framebuffer=t.gl.createFramebuffer();y&&(this.colorAttachment=new lu(t,T)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new td(t,T):new Pf(t,T))}destroy(){const t=this.context.gl;if(this.colorAttachment){const n=this.colorAttachment.get();n&&t.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}else{const n=this.depthAttachment.get();n&&t.deleteTexture(n)}t.deleteFramebuffer(this.framebuffer)}}class ah{constructor(t,n){this.gl=t,this.clearColor=new Yh(this),this.clearDepth=new ir(this),this.clearStencil=new Xh(this),this.colorMask=new ou(this),this.depthMask=new wf(this),this.stencilMask=new ih(this),this.stencilFunc=new Or(this),this.stencilOp=new Ml(this),this.stencilTest=new rh(this),this.depthRange=new Sf(this),this.depthTest=new vo(this),this.depthFunc=new Zh(this),this.blend=new Za(this),this.blendFunc=new Kh(this),this.blendColor=new cp(this),this.blendEquation=new up(this),this.cullFace=new hc(this),this.cullFaceSide=new hp(this),this.frontFace=new Jh(this),this.program=new Qh(this),this.activeTexture=new Tf(this),this.viewport=new Mf(this),this.bindFramebuffer=new au(this),this.bindRenderbuffer=new Hm(this),this.bindTexture=new Ef(this),this.bindVertexBuffer=new Wm(this),this.bindElementBuffer=new qm(this),this.bindVertexArrayOES=new Cf(this),this.pixelStoreUnpack=new Af(this),this.pixelStoreUnpackPremultiplyAlpha=new Ko(this),this.pixelStoreUnpackFlipY=new dp(this),this.options=n?Object.assign({},n):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=n&&!!n.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n,d){return new Na(this,t,n,d)}createVertexBuffer(t,n,d,y,b){return new Ss(this,t,n,d,y,b)}createRenderbuffer(t,n,d){const y=this.gl,b=y.createRenderbuffer();return this.bindRenderbuffer.set(b),y.renderbufferStorage(y.RENDERBUFFER,t,n,d),this.bindRenderbuffer.set(null),b}createFramebuffer(t,n,d,y){return new gp(this,t,n,d,y)}clear({color:t,depth:n,stencil:d,colorMask:y}){const b=this.gl;let T=0;t&&(T|=b.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(y||[!0,!0,!0,!0])),n!==void 0&&(T|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),d!==void 0&&(T|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),b.clear(T)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){r.bn(t.blendFunction,Xi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Pl;function lh(u,t,n,d,y,b,T){const D=u.context,F=D.gl,V=u.transform,j=u.getOrCreateProgram("collisionBox"),H=[];let W=0,Q=0;for(let Ie=0;Ie<d.length;Ie++){const Ue=d[Ie],Le=t.getTile(Ue),Be=Le.getBucket(n);if(!Be)continue;const Oe=Xo(Ue,Be,V);let He=Oe;y[0]===0&&y[1]===0||(He=u.translatePosMatrix(Oe,Le,y,b));const Qe=T?Be.textCollisionBox:Be.iconCollisionBox,xt=Be.collisionCircleArray;if(xt.length>0){const ut=r.ab.mat4.create(),It=He;r.ab.mat4.mul(ut,Be.placementInvProjMatrix,V.glCoordMatrix),r.ab.mat4.mul(ut,ut,Be.placementViewportMatrix),H.push({circleArray:xt,circleOffset:Q,transform:It,invTransform:ut,projection:Be.getProjection()}),W+=xt.length/4,Q=W}Qe&&(u.terrain&&u.terrain.setupElevationDraw(Le,j),j.draw(u,F.LINES,Si.disabled,Oi.disabled,u.colorModeForRenderPass(),zi.disabled,Xm(He,V,Le,Be.getProjection()),n.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,null,V.zoom,null,[Qe.collisionVertexBuffer,Qe.collisionVertexBufferExt]))}if(!T||!H.length)return;const ce=u.getOrCreateProgram("collisionCircle"),oe=new r.cV;oe.resize(4*W),oe._trim();let de=0;for(const Ie of H)for(let Ue=0;Ue<Ie.circleArray.length/4;Ue++){const Le=4*Ue,Be=Ie.circleArray[Le+0],Oe=Ie.circleArray[Le+1],He=Ie.circleArray[Le+2],Qe=Ie.circleArray[Le+3];oe.emplace(de++,Be,Oe,He,Qe,0),oe.emplace(de++,Be,Oe,He,Qe,1),oe.emplace(de++,Be,Oe,He,Qe,2),oe.emplace(de++,Be,Oe,He,Qe,3)}(!Pl||Pl.length<2*W)&&(Pl=function(Ie){const Ue=2*Ie,Le=new r.aU;Le.resize(Ue),Le._trim();for(let Be=0;Be<Ue;Be++){const Oe=6*Be;Le.uint16[Oe+0]=4*Be+0,Le.uint16[Oe+1]=4*Be+1,Le.uint16[Oe+2]=4*Be+2,Le.uint16[Oe+3]=4*Be+2,Le.uint16[Oe+4]=4*Be+3,Le.uint16[Oe+5]=4*Be+0}return Le}(W));const pe=D.createIndexBuffer(Pl,!0),Se=D.createVertexBuffer(oe,r.cW.members,!0);for(const Ie of H){const Ue={u_matrix:Ie.transform,u_inv_matrix:Ie.invTransform,u_camera_to_center_distance:(ke=V).getCameraToCenterDistance(Ie.projection),u_viewport_size:[ke.width,ke.height]};ce.draw(u,F.TRIANGLES,Si.disabled,Oi.disabled,u.colorModeForRenderPass(),zi.disabled,Ue,n.id,Se,pe,r.b7.simpleSegment(0,2*Ie.circleOffset,Ie.circleArray.length,Ie.circleArray.length/2),null,V.zoom)}var ke;Se.destroy(),pe.destroy()}const Qo=r.ab.mat4.create();function Qs(u){const t=u._camera.getWorldToCamera(u.worldSize,1),n=r.ab.mat4.multiply([],t,u.globeMatrix);r.ab.mat4.invert(n,n);const d=[0,0,0],y=[0,1,0,0];return r.ab.vec4.transformMat4(y,y,n),d[0]=y[0],d[1]=y[1],d[2]=y[2],r.ab.vec3.normalize(d,d),d}function Vr({width:u,height:t,anchor:n,textOffset:d,textScale:y},b){const{horizontalAlign:T,verticalAlign:D}=r.bD(n),F=-(T-.5)*u,V=-(D-.5)*t,j=r.bC(n,d);return new r.P((F/y+j[0])*b,(V/y+j[1])*b)}function ud(u,t,n,d,y,b,T,D,F,V,j){const H=u.text.placedSymbolArray,W=u.text.dynamicLayoutVertexArray,Q=u.icon.dynamicLayoutVertexArray,ce={},oe=u.getProjection(),de=Ha(D,oe,b),pe=b.elevation,Se=oe.upVectorScale(D.canonical,b.center.lat,b.worldSize).metersToTile;W.clear();for(let ke=0;ke<H.length;ke++){const Ie=H.get(ke),{tileAnchorX:Ue,tileAnchorY:Le,numGlyphs:Be}=Ie,Oe=Ie.hidden||!Ie.crossTileID||u.allowVerticalPlacement&&!Ie.placedOrientation?null:d[Ie.crossTileID];if(Oe){let He=0,Qe=0,xt=0;if(pe){const bt=pe?pe.getAtTileOffset(D,Ue,Le):0,[Kt,Bt,kt]=oe.upVector(D.canonical,Ue,Le);He=bt*Kt*Se,Qe=bt*Bt*Se,xt=bt*kt*Se}let[ut,It,At,ot]=Js(Ie.projectedAnchorX+He,Ie.projectedAnchorY+Qe,Ie.projectedAnchorZ+xt,n?de:T);const wt=rs(b.getCameraToCenterDistance(oe),ot);let Vt=y.evaluateSizeForFeature(u.textSizeData,V,Ie)*wt/r.bw;n&&(Vt*=u.tilePixelRatio/F);const st=Vr(Oe,Vt);n?({x:ut,y:It,z:At}=oe.projectTilePoint(Ue+st.x,Le+st.y,D.canonical),[ut,It,At]=Js(ut+He,It+Qe,At+xt,T)):(t&&st._rotate(-b.angle),ut+=st.x,It+=st.y,At=0);const Dt=u.allowVerticalPlacement&&Ie.placedOrientation===r.bq.vertical?Math.PI/2:0;for(let bt=0;bt<Be;bt++)r.bt(W,ut,It,At,Dt);j&&Ie.associatedIconIndex>=0&&(ce[Ie.associatedIconIndex]={x:ut,y:It,z:At,angle:Dt})}else Qr(Be,W)}if(j){Q.clear();const ke=u.icon.placedSymbolArray;for(let Ie=0;Ie<ke.length;Ie++){const Ue=ke.get(Ie),{numGlyphs:Le}=Ue,Be=ce[Ie];if(Ue.hidden||!Be)Qr(Le,Q);else{const{x:Oe,y:He,z:Qe,angle:xt}=Be;for(let ut=0;ut<Le;ut++)r.bt(Q,Oe,He,Qe,xt)}}u.icon.dynamicLayoutVertexBuffer.updateData(Q)}u.text.dynamicLayoutVertexBuffer.updateData(W)}function ch(u,t,n,d,y,b,T={}){const D=n.paint.get("icon-translate"),F=n.paint.get("text-translate"),V=n.paint.get("icon-translate-anchor"),j=n.paint.get("text-translate-anchor"),H=n.layout.get("icon-rotation-alignment"),W=n.layout.get("text-rotation-alignment"),Q=n.layout.get("icon-pitch-alignment"),ce=n.layout.get("text-pitch-alignment"),oe=n.layout.get("icon-keep-upright"),de=n.layout.get("text-keep-upright"),pe=n.paint.get("icon-color-saturation"),Se=n.paint.get("icon-color-contrast"),ke=n.paint.get("icon-color-brightness-min"),Ie=n.paint.get("icon-color-brightness-max"),Ue=n.layout.get("symbol-elevation-reference")==="sea",Le=u.context,Be=Le.gl,Oe=u.transform,He=H==="map",Qe=W==="map",xt=Q==="map",ut=ce==="map",It=n.layout.get("symbol-sort-key").constantOr(1)!==void 0;let At=!1;const ot=u.depthModeForSublayer(0,Si.ReadOnly),wt=[r.at(Oe.center.lng),r.aA(Oe.center.lat)],Vt=n.layout.get("text-variable-anchor"),st=Oe.projection.name==="globe",Dt=[],bt=[0,-1,0];for(const Kt of d){const Bt=t.getTile(Kt),kt=Bt.getBucket(n);if(!kt||kt.projection.name==="mercator"&&st||kt.fullyClipped)continue;const $t=kt.projection.name==="globe",Xt=$t?r.ae(Oe.zoom):0,ci=Ha(Kt,kt.getProjection(),Oe),di=Oe.calculatePixelsToTileUnitsMatrix(Bt),Fi=Vt&&kt.hasTextData(),Mi=kt.hasIconTextFit()&&Fi&&kt.hasIconData(),Ei=kt.getProjection().createInversionMatrix(Oe,Kt.canonical),ji=Dr=>{Oe.depthOcclusionForSymbolsAndCircles&&(n.hasInitialOcclusionOpacityProperties||u.terrain)&&(Dr.push("DEPTH_D24"),Dr.push("DEPTH_OCCLUSION"))},pr=()=>{const Dr=He&&n.layout.get("symbol-placement")!=="point",Mr=[];ji(Mr);const pn=Dr||Mi,ns=n.paint.get("icon-image-cross-fade").constantOr(0);u.terrainRenderModeElevated()&&xt&&Mr.push("PITCH_WITH_MAP_TERRAIN"),$t&&(Mr.push("PROJECTION_GLOBE_VIEW"),pn&&Mr.push("PROJECTED_POS_ON_VIEWPORT")),ns>0&&Mr.push("ICON_TRANSITION"),kt.icon.zOffsetVertexBuffer&&Mr.push("Z_OFFSET"),pe===0&&Se===0&&ke===0&&Ie===1||Mr.push("COLOR_ADJUSTMENT"),kt.sdfIcons&&Mr.push("RENDER_SDF");const Tn=kt.icon.programConfigurations.get(n.id),qn=u.getOrCreateProgram("symbol",{config:Tn,defines:Mr}),Eo=Bt.imageAtlasTexture?Bt.imageAtlasTexture.size:[0,0],Hs=kt.iconSizeData,rn=r.bp(Hs,Oe.zoom),Gr=xt||Oe.pitch!==0,Br=bs(ci,Bt.tileID.canonical,xt,He,Oe,kt.getProjection(),di),mr=Zd(ci,Bt.tileID.canonical,xt,He,Oe,kt.getProjection(),di),Dn=u.translatePosMatrix(mr,Bt,D,V,!0),Yn=u.translatePosMatrix(ci,Bt,D,V),jr=pn?Qo:Br,zs=He&&!xt&&!Dr;let ta=bt;!st&&!Oe.mercatorFromTransition||He||(ta=Qs(Oe));const Co=$t?ta:bt,ho=n.getColorAdjustmentMatrix(pe,Se,ke,Ie),Vo=mp(Hs.kind,rn,zs,xt,u,Yn,jr,Dn,Ue,!1,Eo,[0,0],!0,Kt,Xt,wt,Ei,Co,kt.getProjection(),ho,ns),Uo=Bt.imageAtlasTexture?Bt.imageAtlasTexture:null,jo=n.layout.get("icon-size").constantOr(0)!==1||kt.iconsNeedLinear,nl=kt.sdfIcons||u.options.rotating||u.options.zooming||jo||Gr?Be.LINEAR:Be.NEAREST,$o=kt.sdfIcons&&n.paint.get("icon-halo-width").constantOr(1)!==0,Cc=u.terrain&&xt&&Dr?r.ab.mat4.invert(r.ab.mat4.create(),Br):Qo;if(Dr&&kt.icon){const Ac=Oe.elevation,bd=Ac?Ac.getAtTileOffsetFunc(Kt,Oe.center.lat,Oe.worldSize,kt.getProjection()):null,wd=wn(ci,Bt.tileID.canonical,xt,He,Oe,kt.getProjection(),di);qu(kt,ci,u,!1,wd,mr,xt,oe,bd,Kt)}return{program:qn,buffers:kt.icon,uniformValues:Vo,atlasTexture:Uo,atlasTextureIcon:null,atlasInterpolation:nl,atlasInterpolationIcon:null,isSDF:kt.sdfIcons,hasHalo:$o,tile:Bt,labelPlaneMatrixInv:Cc}},Cr=()=>{const Dr=Qe&&n.layout.get("symbol-placement")!=="point",Mr=[],pn=Dr||Vt||Mi;u.terrainRenderModeElevated()&&ut&&Mr.push("PITCH_WITH_MAP_TERRAIN"),$t&&(Mr.push("PROJECTION_GLOBE_VIEW"),pn&&Mr.push("PROJECTED_POS_ON_VIEWPORT")),kt.text.zOffsetVertexBuffer&&Mr.push("Z_OFFSET"),kt.iconsInText&&Mr.push("RENDER_TEXT_AND_SYMBOL"),Mr.push("RENDER_SDF"),ji(Mr);const ns=kt.text.programConfigurations.get(n.id),Tn=u.getOrCreateProgram("symbol",{config:ns,defines:Mr});let qn,Eo=[0,0],Hs=null;const rn=kt.textSizeData;kt.iconsInText&&(Eo=Bt.imageAtlasTexture?Bt.imageAtlasTexture.size:[0,0],Hs=Bt.imageAtlasTexture?Bt.imageAtlasTexture:null,qn=ut||Oe.pitch!==0||u.options.rotating||u.options.zooming||rn.kind==="composite"||rn.kind==="camera"?Be.LINEAR:Be.NEAREST);const Gr=Bt.glyphAtlasTexture?Bt.glyphAtlasTexture.size:[0,0],Br=n.layout.get("text-size-scale-range"),mr=r.aw(u.scaleFactor,Br[0],Br[1]),Dn=r.bp(rn,Oe.zoom,mr),Yn=bs(ci,Bt.tileID.canonical,ut,Qe,Oe,kt.getProjection(),di),jr=Zd(ci,Bt.tileID.canonical,ut,Qe,Oe,kt.getProjection(),di),zs=u.translatePosMatrix(jr,Bt,F,j,!0),ta=u.translatePosMatrix(ci,Bt,F,j),Co=pn?Qo:Yn,ho=Qe&&!ut&&!Dr;let Vo=bt;!st&&!Oe.mercatorFromTransition||Qe||(Vo=Qs(Oe));const Uo=mp(rn.kind,Dn,ho,ut,u,ta,Co,zs,Ue,!0,Gr,Eo,!0,Kt,Xt,wt,Ei,$t?Vo:bt,kt.getProjection(),null,null,mr),jo=Bt.glyphAtlasTexture?Bt.glyphAtlasTexture:null,nl=Be.LINEAR,$o=n.paint.get("text-halo-width").constantOr(1)!==0,Cc=u.terrain&&ut&&Dr?r.ab.mat4.invert(r.ab.mat4.create(),Yn):Qo;if(Dr&&kt.text){const Ac=Oe.elevation,bd=Ac?Ac.getAtTileOffsetFunc(Kt,Oe.center.lat,Oe.worldSize,kt.getProjection()):null,wd=wn(ci,Bt.tileID.canonical,ut,Qe,Oe,kt.getProjection(),di);qu(kt,ci,u,!0,wd,jr,ut,de,bd,Kt)}return{program:Tn,buffers:kt.text,uniformValues:Uo,atlasTexture:jo,atlasTextureIcon:Hs,atlasInterpolation:nl,atlasInterpolationIcon:qn,isSDF:!0,hasHalo:$o,tile:Bt,labelPlaneMatrixInv:Cc}},dn=kt.icon.segments.get().length,$r=kt.text.segments.get().length,$i=dn&&!T.onlyText?pr():null,lr=$r&&!T.onlyIcons?Cr():null,bi=n.paint.get("icon-opacity").constantOr(1),or=n.paint.get("text-opacity").constantOr(1);if(It&&kt.canOverlap){At=!0;const Dr=bi&&!T.onlyText?kt.icon.segments.get():[],Mr=or&&!T.onlyIcons?kt.text.segments.get():[];for(const pn of Dr)Dt.push({segments:new r.b7([pn]),sortKey:pn.sortKey,state:$i});for(const pn of Mr)Dt.push({segments:new r.b7([pn]),sortKey:pn.sortKey,state:lr})}else T.onlyText||Dt.push({segments:bi?kt.icon.segments:new r.b7([]),sortKey:0,state:$i}),T.onlyIcons||Dt.push({segments:or?kt.text.segments:new r.b7([]),sortKey:0,state:lr})}At&&Dt.sort((Kt,Bt)=>Kt.sortKey-Bt.sortKey);for(const Kt of Dt){const Bt=Kt.state;if(Bt)if(u.terrain?u.terrain.setupElevationDraw(Bt.tile,Bt.program,{useDepthForOcclusion:Oe.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Bt.labelPlaneMatrixInv}):u.setupDepthForOcclusion(Oe.depthOcclusionForSymbolsAndCircles,Bt.program),Le.activeTexture.set(Be.TEXTURE0),Bt.atlasTexture&&Bt.atlasTexture.bind(Bt.atlasInterpolation,Be.CLAMP_TO_EDGE,!0),Bt.atlasTextureIcon&&(Le.activeTexture.set(Be.TEXTURE1),Bt.atlasTextureIcon&&Bt.atlasTextureIcon.bind(Bt.atlasInterpolationIcon,Be.CLAMP_TO_EDGE,!0)),u.uploadCommonLightUniforms(u.context,Bt.program),Bt.hasHalo){const kt=Bt.uniformValues;kt.u_is_halo=1,bo(Bt.buffers,Kt.segments,n,u,Bt.program,ot,y,b,kt,2),kt.u_is_halo=0}else{if(Bt.isSDF){const kt=Bt.uniformValues;Bt.hasHalo&&(kt.u_is_halo=1,bo(Bt.buffers,Kt.segments,n,u,Bt.program,ot,y,b,kt,1)),kt.u_is_halo=0}bo(Bt.buffers,Kt.segments,n,u,Bt.program,ot,y,b,Bt.uniformValues,1)}}}function bo(u,t,n,d,y,b,T,D,F,V){const j=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.iconTransitioningVertexBuffer,u.globeExtVertexBuffer,u.zOffsetVertexBuffer];y.draw(d,d.context.gl.TRIANGLES,b,T,D,zi.disabled,F,n.id,u.layoutVertexBuffer,u.indexBuffer,t,n.paint,d.transform.zoom,u.programConfigurations.get(n.id),j,V)}function _p(u,t,n,d,y,b,T){const D=u.context.gl,F=n.paint.get("fill-pattern"),V=n.is3D(),j=V?u.stencilModeFor3D():Oi.disabled,H=F&&F.constantOr(1);let W,Q,ce,oe,de;T?(Q=H&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",W=D.LINES):(Q=H?"fillPattern":"fill",W=D.TRIANGLES);for(const pe of d){const Se=t.getTile(pe);if(H&&!Se.patternsLoaded())continue;const ke=Se.getBucket(n);if(!ke)continue;u.prepareDrawTile();const Ie=ke.programConfigurations.get(n.id),Ue=u.isTileAffectedByFog(pe),Le=u.getOrCreateProgram(Q,{config:Ie,overrideFog:Ue});H&&(u.context.activeTexture.set(D.TEXTURE0),Se.imageAtlasTexture&&Se.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Ie.updatePaintBuffers());const Be=F.constantOr(null);if(Be&&Se.imageAtlas){const Qe=Se.imageAtlas,xt=r.A.from(Be).getPrimary().scaleSelf(r.q.devicePixelRatio).serialize(),ut=Qe.patternPositions[xt];ut&&Ie.setConstantPatternPositions(ut)}const Oe=u.translatePosMatrix(pe.projMatrix,Se,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),He=n.paint.get("fill-emissive-strength");if(T){oe=ke.indexBuffer2,de=ke.segments2;const Qe=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[D.drawingBufferWidth,D.drawingBufferHeight];ce=Q==="fillOutlinePattern"&&H?Ff(Oe,He,u,Se,Qe):fp(Oe,He,Qe)}else oe=ke.indexBuffer,de=ke.segments,ce=H?fu(Oe,He,u,Se):pc(Oe,He);u.uploadCommonUniforms(u.context,Le,pe.toUnwrapped()),Le.draw(u,W,y,V?j:u.stencilModeForClipping(pe),b,zi.disabled,ce,n.id,ke.layoutVertexBuffer,oe,de,n.paint,u.transform.zoom,Ie,void 0)}}function gu(u,t,n,d,y,b,T,D){n.resetLayerRenderingStats(u);const F=u.context,V=F.gl,j=u.transform,H=n.paint.get("fill-extrusion-pattern"),W=H.constantOr(1),Q=n.paint.get("fill-extrusion-opacity"),ce=u.style.enable3dLights(),oe=n.paint.get(ce&&!W?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),de=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe],pe=n.layout.get("fill-extrusion-edge-radius"),Se=pe>0&&!n.paint.get("fill-extrusion-rounded-roof"),ke=Se?0:pe,Ie=j.projection.name==="globe"?r.d3():0,Ue=j.projection.name==="globe",Le=Ue?r.ae(j.zoom):0,Be=[r.at(j.center.lng),r.aA(j.center.lat)],Oe=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",He=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(Oe?null:n.lut).toArray01().slice(0,3),Qe=n.paint.get("fill-extrusion-flood-light-intensity"),xt=n.paint.get("fill-extrusion-vertical-scale"),ut=n.paint.get("fill-extrusion-line-width").constantOr(1)!==0,It=n.paint.get("fill-extrusion-height-alignment"),At=n.paint.get("fill-extrusion-base-alignment"),ot=bl(u,n.paint.get("fill-extrusion-cutoff-fade-range")),wt=[];let Vt;Ue&&wt.push("PROJECTION_GLOBE_VIEW"),de[0]>0&&wt.push("FAUX_AO"),Se&&wt.push("ZERO_ROOF_RADIUS"),D&&wt.push("HAS_CENTROID"),Qe>0&&wt.push("FLOOD_LIGHT"),ot.shouldRenderCutoff&&wt.push("RENDER_CUTOFF"),ut&&wt.push("RENDER_WALL_MODE");const st=u.renderPass==="shadow",Dt=u.shadowRenderer,bt=st&&!!Dt;u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0);let Kt=[0,0,0];if(Dt){const $t=u.style.directionalLight,Xt=u.style.ambientLight;$t&&Xt&&(Kt=Hh(u.style,$t,Xt)),st||(wt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Dt.useNormalOffset&&wt.push("NORMAL_OFFSET")),Vt=wt.concat(["SHADOWS_SINGLE_CASCADE"])}const Bt=bt?"fillExtrusionDepth":W?"fillExtrusionPattern":"fillExtrusion",kt=n.getLayerRenderingStats();for(const $t of d){const Xt=t.getTile($t),ci=Xt.getBucket(n);if(!ci||ci.projection.name!==j.projection.name)continue;let di=!1;Dt&&(di=Dt.getMaxCascadeForTile($t.toUnwrapped())===0);const Fi=u.isTileAffectedByFog($t),Mi=ci.programConfigurations.get(n.id),Ei=u.getOrCreateProgram(Bt,{config:Mi,defines:di?Vt:wt,overrideFog:Fi});if(u.terrain&&u.terrain.setupElevationDraw(Xt,Ei,{useMeterToDem:!0}),!ci.centroidVertexBuffer){const lr=Ei.attributes.a_centroid_pos;lr!==void 0&&V.vertexAttrib2f(lr,0,0)}!st&&Dt&&Dt.setupShadows(Xt.tileID.toUnwrapped(),Ei,"vector-tile",Xt.tileID.overscaledZ),W&&(u.context.activeTexture.set(V.TEXTURE0),Xt.imageAtlasTexture&&Xt.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Mi.updatePaintBuffers());const ji=H.constantOr(null);if(ji&&Xt.imageAtlas){const lr=Xt.imageAtlas,bi=r.A.from(ji).getPrimary().scaleSelf(r.q.devicePixelRatio),or=lr.patternPositions[bi.serialize()];or&&Mi.setConstantPatternPositions(or)}const pr=n.paint.get("fill-extrusion-vertical-gradient"),Cr=1/ci.tileToMeter;let dn;if(st&&Dt){if(Ka(Xt.tileID,ci,u))continue;const lr=Dt.calculateShadowPassMatrixFromTile(Xt.tileID.toUnwrapped());dn=dc(lr,ke,Cr,xt,It,At)}else{const lr=u.translatePosMatrix($t.expandedProjMatrix,Xt,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),bi=j.projection.createInversionMatrix(j,$t.canonical);dn=W?zf(lr,u,pr,Q,de,ke,Cr,$t,Xt,Ie,It,At,Le,Be,bi,He,xt):sd(lr,u,pr,Q,de,ke,Cr,$t,Ie,It,At,Le,Be,bi,He,xt,Qe,Kt)}u.uploadCommonUniforms(F,Ei,$t.toUnwrapped(),null,ot);let $r=ci.segments;if(j.projection.name==="mercator"&&!st&&($r=ci.getVisibleSegments(Xt.tileID,u.terrain,u.transform.getFrustum(0)),!$r.get().length))continue;if(kt)if(st)for(const lr of $r.get())kt.numRenderedVerticesInShadowPass+=lr.primitiveLength;else for(const lr of $r.get())kt.numRenderedVerticesInTransparentPass+=lr.primitiveLength;const $i=[];(u.terrain||D)&&$i.push(ci.centroidVertexBuffer),Ue&&$i.push(ci.layoutVertexExtBuffer),ut&&$i.push(ci.wallVertexBuffer),Ei.draw(u,F.gl.TRIANGLES,y,b,T,zi.backCCW,dn,n.id,ci.layoutVertexBuffer,ci.indexBuffer,$r,n.paint,u.transform.zoom,Mi,$i)}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1)}function Vn(u,t,n,d,y,b,T,D,F,V,j,H,W,Q,ce,oe,de,pe,Se){const ke=u.context,Ie=ke.gl,Ue=u.transform,Le=u.transform.zoom,Be=[],Oe=bl(u,n.paint.get("fill-extrusion-cutoff-fade-range"));V==="clear"?(Be.push("CLEAR_SUBPASS"),Se&&(Be.push("CLEAR_FROM_TEXTURE"),ke.activeTexture.set(Ie.TEXTURE0),Se.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE))):V==="sdf"&&Be.push("SDF_SUBPASS"),de&&Be.push("HAS_CENTROID"),Oe.shouldRenderCutoff&&Be.push("RENDER_CUTOFF");const He=n.layout.get("fill-extrusion-edge-radius"),Qe=(xt,ut,It,At,ot)=>{const wt=ut.programConfigurations.get(n.id),Vt=u.isTileAffectedByFog(xt),st=u.getOrCreateProgram("fillExtrusionGroundEffect",{config:wt,defines:Be,overrideFog:Vt}),Dt=((Kt,Bt,kt,$t,Xt,ci,di,Fi,Mi,Ei,ji)=>({u_matrix:Bt,u_opacity:kt,u_ao_pass:$t?1:0,u_meter_to_tile:Xt,u_ao:ci,u_flood_light_intensity:di,u_flood_light_color:Fi,u_attenuation:Mi,u_edge_radius:Ei,u_fb:0,u_fb_size:ji,u_dynamic_offset:1}))(0,At,j,F,ot,[H,W*ot],Q,ce,oe,Le>=17?0:He*ot,Se?Se.size[0]:0),bt=[];de&&bt.push(ut.hiddenByLandmarkVertexBuffer),u.uploadCommonUniforms(ke,st,xt.toUnwrapped(),null,Oe),st.draw(u,ke.gl.TRIANGLES,y,b,T,D,Dt,n.id,ut.vertexBuffer,ut.indexBuffer,It,n.paint,Le,wt,bt)};for(const xt of d){const ut=t.getTile(xt),It=ut.getBucket(n);if(!It||It.projection.name!==Ue.projection.name||!It.groundEffect||It.groundEffect&&!It.groundEffect.hasData())continue;const At=It.groundEffect,ot=1/It.tileToMeter;{const wt=u.translatePosMatrix(xt.projMatrix,ut,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Vt=At.getDefaultSegment();Qe(xt,At,Vt,wt,ot)}if(pe)for(let wt=0;wt<4;wt++){const Vt=r.d4[wt](xt),st=t.getTile(Vt);if(!st)continue;const Dt=st.getBucket(n);if(!Dt||Dt.projection.name!==Ue.projection.name||!Dt.groundEffect||Dt.groundEffect&&!Dt.groundEffect.hasData())continue;const bt=Dt.groundEffect;let Kt,Bt;wt===0?(Kt=[-r.ag,0,0],Bt=1):wt===1?(Kt=[r.ag,0,0],Bt=0):wt===2?(Kt=[0,-r.ag,0],Bt=3):(Kt=[0,r.ag,0],Bt=2);const kt=bt.regionSegments[Bt];if(!kt)continue;const $t=new Float32Array(16);r.ab.mat4.translate($t,xt.projMatrix,Kt),Qe(xt,bt,kt,u.translatePosMatrix($t,ut,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),ot)}}}function _c(u,t,n,d,y,b,T){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const D=b?b.findDEMTileFor(n):null;if(!(D&&D.dem||T))return;b&&D&&D.dem&&d.selfDEMTileTimestamp!==D.dem._timestamp&&(d.borderDoneWithNeighborZ=[-1,-1,-1,-1],d.selfDEMTileTimestamp=D.dem._timestamp);const F=pe=>new r.P(Math.ceil((pe+r.d7)*r.d8),0),V=pe=>{const Se=t.getSource().minzoom,ke=Ue=>{const Le=t.getTileByID(Ue);if(Le&&Le.hasData())return Le.getBucket(y)},Ie=[0,-1,1];for(const Ue of Ie){if(pe.overscaledZ+Ue<Se)continue;const Le=ke(pe.calculateScaledKey(pe.overscaledZ+Ue));if(Le)return Le}},j=[0,0,0],H=(pe,Se)=>(j[0]=Math.min(pe.min.y,Se.min.y),j[1]=Math.max(pe.max.y,Se.max.y),j[2]=r.ag-Se.min.x>pe.max.x?Se.min.x-r.ag:pe.max.x,j),W=(pe,Se)=>(j[0]=Math.min(pe.min.x,Se.min.x),j[1]=Math.max(pe.max.x,Se.max.x),j[2]=r.ag-Se.min.y>pe.max.y?Se.min.y-r.ag:pe.max.y,j),Q=[(pe,Se)=>H(pe,Se),(pe,Se)=>H(Se,pe),(pe,Se)=>W(pe,Se),(pe,Se)=>W(Se,pe)],ce=(pe,Se,ke,Ie,Ue,Le,Be)=>{if(!b)return 0;const Oe=[[Le?ke:pe,Le?pe:ke,0],[Le?ke:Se,Le?Se:ke,0]],He=Be<0?r.ag+Be:Be,Qe=[Le?He:(pe+Se)/2,Le?(pe+Se)/2:He,0];return ke===0&&Be<0||ke!==0&&Be>0?b.getForTilePoints(Ue,[Qe],!0,Ie):Oe.push(Qe),b.getForTilePoints(n,Oe,!0,D),Math.max(Oe[0][2],Oe[1][2],Qe[2])/b.exaggeration()};for(let pe=0;pe<4;pe++){const Se=d.borderFeatureIndices[pe];if(Se.length===0)continue;const ke=r.d4[pe](n),Ie=V(ke);if(!(Ie&&Ie instanceof r.d5))continue;const Ue=b?b.findDEMTileFor(ke):null;if(!(Ue&&Ue.dem||T)||(b&&Ue&&Ue.dem&&d.borderDEMTileTimestamp[pe]!==Ue.dem._timestamp&&(d.borderDoneWithNeighborZ[pe]=-1,d.borderDEMTileTimestamp[pe]=Ue.dem._timestamp),d.borderDoneWithNeighborZ[pe]===Ie.canonical.z))continue;Ie.centroidVertexArray.length===0&&Ie.createCentroidsBuffer();const Le=(pe<2?1:5)-pe,Be=Ie.borderDoneWithNeighborZ[Le]!==d.canonical.z,Oe=Ie.borderFeatureIndices[Le];let He=0;if(d.canonical.z!==Ie.canonical.z){for(const Qe of Se)d.showCentroid(d.featuresOnBorder[Qe]);if(Be)for(const Qe of Oe)Ie.showCentroid(Ie.featuresOnBorder[Qe]);d.borderDoneWithNeighborZ[pe]=Ie.canonical.z,Ie.borderDoneWithNeighborZ[Le]=d.canonical.z}for(const Qe of Se){const xt=d.featuresOnBorder[Qe],ut=d.centroidData[xt.centroidDataIndex],It=xt.borders[pe];let At;for(;He<Oe.length;){At=Ie.featuresOnBorder[Oe[He]];const ot=At.borders[Le];if(ot[1]>It[0]+3||ot[0]>It[0]-3)break;Ie.showCentroid(At),He++}if(At&&He<Oe.length){const ot=He;let wt=0;for(;!(At.borders[Le][0]>It[1]-3)&&(wt++,++He!==Oe.length);)At=Ie.featuresOnBorder[Oe[He]];At=Ie.featuresOnBorder[Oe[ot]];let Vt=!1;if(wt>=1){const bt=At.borders[Le];Math.abs(It[0]-bt[0])<3&&Math.abs(It[1]-bt[1])<3&&(wt=1,Vt=!0,He=ot+1)}else if(wt===0){d.showCentroid(xt);continue}const st=Ie.centroidData[At.centroidDataIndex];T&&Vt&&(((oe=ut).flags|(de=st).flags)&r.d6?(oe.flags|=r.d6,de.flags|=r.d6):(oe.flags&=~r.d6,de.flags&=~r.d6));const Dt=xt.intersectsCount()>1||At.intersectsCount()>1;if(wt>1)He=ot,ut.centroidXY=st.centroidXY=new r.P(0,0);else if(Ue&&Ue.dem&&!Dt){const bt=Q[pe](ut,st),Kt=pe%2?r.ag-1:0,Bt=ce(bt[0],Math.min(r.ag-1,bt[1]),Kt,Ue,ke,pe<2,bt[2]);ut.centroidXY=st.centroidXY=F(Bt)}else Dt?ut.centroidXY=st.centroidXY=new r.P(0,0):(ut.centroidXY=d.encodeBorderCentroid(xt),st.centroidXY=Ie.encodeBorderCentroid(At));d.writeCentroidToBuffer(ut),Ie.writeCentroidToBuffer(st)}else d.showCentroid(xt)}d.borderDoneWithNeighborZ[pe]=Ie.canonical.z,Ie.borderDoneWithNeighborZ[Le]=d.canonical.z}var oe,de;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(u)}const yc=[1,0,0],Ht=[0,1,0],li=[0,0,1];function Ka(u,t,n){const d=n.transform,y=n.shadowRenderer;if(!y)return!0;const b=u.toUnwrapped(),T=d.tileSize*y._cascades[n.currentShadowCascade].scale;let D=t.maxHeight;if(d.elevation){const oe=d.elevation.getMinMaxForTile(u);oe&&(D+=oe.max)}const F=[...y.shadowDirection];F[2]=-F[2];const V=y.computeSimplifiedTileShadowVolume(b,D,T,F);if(!V)return!1;const j=[yc,Ht,li,F,[F[0],0,F[2]],[0,F[1],F[2]]],H=d.projection.name==="globe",W=d.scaleZoom(T),Q=r.bR.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,W,!H),ce=y.getCurrentCascadeFrustum();return Q.intersectsPrecise(V.vertices,V.planes,j)===0||ce.intersectsPrecise(V.vertices,V.planes,j)===0}function on(u){return[u[0]*r.d9,u[1]*r.d9,u[2]*r.d9,0]}function dt(u,t,n,d,y,b,T,D,F){const V=d.getSource(),j=n.globeSharedBuffers;if(!j)return;let H,W,Q;if(t&&(H=d.getTile(t)),V instanceof r.aJ?(W=V.texture,Q=r.cI(0,0,n.transform)):H&&t&&(W=H.texture,Q=r.cI(t.canonical.z,t.canonical.x,n.transform)),!W||!Q)return;u||(Q=r.ab.mat4.scale(r.ab.mat4.create(),Q,[1,-1,1]));const ce=n.context,oe=ce.gl,de=y.paint.get("raster-resampling")==="nearest"?oe.NEAREST:oe.LINEAR,pe=n.colorModeForDrapableLayerRenderPass(b),Se=T.defines;Se.push("GLOBE_POLES");const ke=new Si(oe.LEQUAL,Si.ReadWrite,n.depthRangeFor3D),Ie=Float32Array.from(n.transform.expandedFarZProjMatrix),Ue=Float32Array.from(r.bb(r.cH(new r.bT(0,0,0))));n.terrain&&n.terrain.prepareDrawTile(),ce.activeTexture.set(oe.TEXTURE0),W.bind(de,oe.CLAMP_TO_EDGE),ce.activeTexture.set(oe.TEXTURE1),W.bind(de,oe.CLAMP_TO_EDGE),W.useMipmap&&ce.extTextureFilterAnisotropic&&n.transform.pitch>20&&oe.texParameterf(oe.TEXTURE_2D,ce.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ce.extTextureFilterAnisotropicMax);const[Le,Be,Oe,He]=t?j.getPoleBuffers(t.canonical.z,!1):j.getPoleBuffers(0,!0),Qe=y.paint.get("raster-elevation");let xt;u?(xt=Le,n.renderDefaultNorthPole=Qe!==0):(xt=Be,n.renderDefaultSouthPole=Qe!==0);const ut=on(T.mix),It=((ot,wt,Vt,st,Dt,bt,Kt,Bt,kt,$t,Xt,ci,di)=>Al(ot,wt,Vt,new Float32Array(16),new Float32Array(9),[0,0],st,[0,0],[0,0,0,0],1,{opacity:1,mix:0},bt,[0,0],Bt,2,$t,Xt,ci,1,0,di))(Ie,Ue,Q,r.ae(n.transform.zoom),0,y,0,Qe,0,ut,T.offset,T.range,b),At=n.getOrCreateProgram("raster",{defines:Se});n.uploadCommonUniforms(ce,At,null),At.draw(n,oe.TRIANGLES,ke,F,pe,D,It,y.id,xt,Oe,He)}function Vf(u){const t=u._nearZ,n=u.projection.farthestPixelDistance(u),d=n-t,y=.2*u.height,b=t+y;return[t,n,(b-y-t)/d,(b-t)/d]}function uh(u,t,n,d){if(u)return t instanceof is&&u instanceof aa?t.getTextureDescriptor(u,n,!0):{texture:u.texture,mix:on(d.mix),offset:d.offset,buffer:0,tileSize:1}}var hd=r.da([{name:"a_index",type:"Int16",components:1}]);class yp{constructor(t,n,d,y){const b={width:d[0],height:d[1],data:null},T=t.gl;this.targetColorTexture=new r.T(t,b,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(t,b,T.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(n,y),this.lastInvalidatedAt=0}updateParticleTexture(t,n){if(this.particleTextureDimension===n.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const d=this.context.gl,y=n.width*n.height;this.particleTexture0=new r.T(this.context,n,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,n,d.RGBA8,{premultiply:!1,useMipmap:!1});const b=new r.db;b.reserve(y);for(let T=0;T<y;T++)b.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(b,hd.members,!0),this.particleSegment=r.b7.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=n.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=r.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Uf(u,t,n){if(!u)return null;const d=t.getTextureDescriptor(u,n,!0);if(!d)return null;let{texture:y,mix:b,offset:T,tileSize:D,buffer:F,format:V}=d;if(!y||!V)return null;let j=!1;return V==="uint32"&&(j=!0,b[3]=0,b=mu(r.dc,b,[0,n.paint.get("raster-particle-max-speed")]),T=sh(r.dc,T,[0,n.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[F/(D+2*F),D/(D+2*F)],tileSize:D,scalarData:j,scale:b,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[V]]}}function jf(u){const t=u._nearZ,n=u.projection.farthestPixelDistance(u),d=n-t,y=.2*u.height,b=t+y;return[t,n,(b-y-t)/d,(b-t)/d]}const _u=new r.aj(1,0,0,1),Gn=new r.aj(0,1,0,1),$f=new r.aj(0,0,1,1),Gf=new r.aj(1,0,1,1),vc=new r.aj(0,1,1,1);function Il(u,t,n,d,y,b,T){const D=u.context,F=u.transform,V=D.gl,j=F.projection.name==="globe",H=j?["PROJECTION_GLOBE_VIEW"]:[];let W=r.ab.mat4.clone(n.projMatrix);if(j&&r.ae(F.zoom)>0){const ut=r.ba(n.canonical,F),It=r.dd(ut);W=r.ab.mat4.multiply(new Float32Array(16),F.globeMatrix,It),r.ab.mat4.multiply(W,F.projMatrix,W)}const Q=r.ab.mat4.create();Q[12]+=2*y/(r.q.devicePixelRatio*F.width),Q[13]+=2*b/(r.q.devicePixelRatio*F.height),r.ab.mat4.multiply(W,Q,W);const ce=u.getOrCreateProgram("debug",{defines:H}),oe=t.getTileByID(n.key);u.terrain&&u.terrain.setupElevationDraw(oe,ce);const de=Si.disabled,pe=Oi.disabled,Se=u.colorModeForRenderPass(),ke="$debug";D.activeTexture.set(V.TEXTURE0),u.emptyTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),j?oe._makeGlobeTileDebugBuffers(u.context,F):oe._makeDebugTileBoundsBuffers(u.context,F.projection);const Ie=oe._tileDebugBuffer||u.debugBuffer,Ue=oe._tileDebugIndexBuffer||u.debugIndexBuffer,Le=oe._tileDebugSegments||u.debugSegments;if(ce.draw(u,V.LINE_STRIP,de,pe,Se,zi.disabled,fc(W,d),ke,Ie,Ue,Le,null,null,null,[oe._globeTileDebugBorderBuffer]),T){const ut=oe.latestRawTileData,It=Math.floor((ut&&ut.byteLength||0)/1024);let At=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(At+=` => ${n.overscaledZ}`),At+=` ${oe.state}`,At+=` ${It}kb`,function(ot,wt){ot.initDebugOverlayCanvas();const Vt=ot.debugOverlayCanvas,st=ot.context.gl,Dt=ot.debugOverlayCanvas.getContext("2d");Dt.clearRect(0,0,Vt.width,Vt.height),Dt.shadowColor="white",Dt.shadowBlur=2,Dt.lineWidth=1.5,Dt.strokeStyle="white",Dt.textBaseline="top",Dt.font="bold 36px Open Sans, sans-serif",Dt.fillText(wt,5,5),Dt.strokeText(wt,5,5),ot.debugOverlayTexture.update(Vt),ot.debugOverlayTexture.bind(st.LINEAR,st.CLAMP_TO_EDGE)}(u,At)}const Be=t.getTile(n).tileSize,Oe=512/Math.min(Be,512)*(n.overscaledZ/F.zoom)*.5,He=oe._tileDebugTextBuffer||u.debugBuffer,Qe=oe._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,xt=oe._tileDebugTextSegments||u.debugSegments;ce.draw(u,V.TRIANGLES,de,pe,Xi.alphaBlended,zi.disabled,fc(W,r.aj.transparent,Oe),ke,He,Qe,xt,null,null,null,[oe._globeTileDebugTextBuffer])}function vp(u,t,n,d){ea(u,0,t+n/2,u.transform.width,n,d)}function xp(u,t,n,d){ea(u,t-n/2,0,n,u.transform.height,d)}function ea(u,t,n,d,y,b){const T=u.context,D=T.gl;D.enable(D.SCISSOR_TEST),D.scissor(t*r.q.devicePixelRatio,n*r.q.devicePixelRatio,d*r.q.devicePixelRatio,y*r.q.devicePixelRatio),T.clear({color:b}),D.disable(D.SCISSOR_TEST)}const yu=r.da([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ua}=yu;function Va(u,t,n,d){u.emplaceBack(t,n,d)}class bp{constructor(t){this.vertexArray=new r.de,this.indices=new r.aU,Va(this.vertexArray,-1,-1,1),Va(this.vertexArray,1,-1,1),Va(this.vertexArray,-1,1,1),Va(this.vertexArray,1,1,1),Va(this.vertexArray,-1,-1,-1),Va(this.vertexArray,1,-1,-1),Va(this.vertexArray,-1,1,-1),Va(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,ua),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=r.b7.simpleSegment(0,0,36,12)}}function ms(u,t,n,d,y,b){const T=u.context.gl,D=t.paint.get("sky-atmosphere-color"),F=t.paint.get("sky-atmosphere-halo-color"),V=t.paint.get("sky-atmosphere-sun-intensity"),j=((H,W,Q,ce,oe)=>({u_matrix_3f:H,u_sun_direction:W,u_sun_intensity:Q,u_color_tint_r:[ce.r,ce.g,ce.b,ce.a],u_color_tint_m:[oe.r,oe.g,oe.b,oe.a],u_luminance:5e-5}))(r.ab.mat3.fromMat4(r.ab.mat3.create(),d),y,V,D,F);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+b,t.skyboxTexture,0),n.draw(u,T.TRIANGLES,Si.disabled,Oi.disabled,Xi.unblended,zi.frontCW,j,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Ts=r.da([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class hh{constructor(t){const n=new r.df;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const d=new r.aU;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(n,Ts.members),this.indexBuffer=t.createIndexBuffer(d),this.segments=r.b7.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const en=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ir{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class dh{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Xi([1,vl,1,vl],r.aj.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Xi([1,0,1,0],r.aj.transparent,[!1,!1,!1,!0]),this.params=new Ir,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const n=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new hh(n);const d=this.params.sizeRange,y=this.params.intensityRange,b=function(j){const H=r.di(30),W=[];for(let Q=0;Q<j;++Q){const ce=2*Math.PI*H(),oe=Math.acos(1-2*H())-.5*Math.PI;W.push(r.ab.vec3.fromValues(Math.cos(oe)*Math.cos(ce),Math.cos(oe)*Math.sin(ce),Math.sin(oe)))}return W}(this.params.starsCount),T=r.di(300),D=new r.dg,F=new r.aU;let V=0;for(let j=0;j<b.length;++j){const H=r.ab.vec3.scale([],b[j],200),W=Math.max(0,1+.01*d*(1*T()-.5)),Q=Math.max(0,1+.01*y*(1*T()-.5));D.emplaceBack(H[0],H[1],H[2],-1,-1,W,Q),D.emplaceBack(H[0],H[1],H[2],1,-1,W,Q),D.emplaceBack(H[0],H[1],H[2],1,1,W,Q),D.emplaceBack(H[0],H[1],H[2],-1,1,W,Q),F.emplaceBack(V+0,V+1,V+2),F.emplaceBack(V+0,V+2,V+3),V+=4}this.starsVx=n.createVertexBuffer(D,en.members),this.starsIdx=n.createIndexBuffer(F),this.starsSegments=r.b7.simpleSegment(0,0,D.length,F.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,n){const d=t.context,y=d.gl,b=t.transform,T=new Si(y.LEQUAL,Si.ReadOnly,[0,1]),D=r.ae(b.zoom),F=t.style.getLut(n.scope),V=n.properties.get("color-use-theme")==="none",j=n.properties.get("color").toRenderColor(V?null:F).toArray01(),H=n.properties.get("high-color-use-theme")==="none",W=n.properties.get("high-color").toRenderColor(H?null:F).toArray01(),Q=n.properties.get("space-color-use-theme")==="none",ce=n.properties.get("space-color").toRenderColor(Q?null:F).toArray01PremultipliedAlpha(),oe=5e-4,de=r.dh(n.properties.get("horizon-blend"),0,1,oe,.25),pe=r.cC(t,d,b)&&de===oe?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,Se=t.frameCounter/1e3%1,ke=r.ab.vec3.length(b.globeCenterInViewSpace),Ie=Math.sqrt(Math.pow(ke,2)-Math.pow(pe,2)),Ue=Math.acos(Ie/ke),Le=Be=>{const Oe=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Be&&Oe.push("ALPHA_PASS");const He=t.getOrCreateProgram("globeAtmosphere",{defines:Oe}),Qe=((ut,It,At,ot,wt,Vt,st,Dt,bt,Kt,Bt,kt)=>({u_frustum_tl:ut,u_frustum_tr:It,u_frustum_br:At,u_frustum_bl:ot,u_horizon:wt,u_transition:Vt,u_fadeout_range:st,u_color:Dt,u_high_color:bt,u_space_color:Kt,u_temporal_offset:Bt,u_horizon_angle:kt}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,D,de,j,W,ce,Se,Ue);t.uploadCommonUniforms(d,He);const xt=this.atmosphereBuffer;xt&&He.draw(t,y.TRIANGLES,T,Oi.disabled,Be?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,zi.backCW,Qe,Be?"atmosphere_glow_alpha":"atmosphere_glow",xt.vertexBuffer,xt.indexBuffer,xt.segments)};Le(!1),Le(!0)}drawStars(t,n){const d=r.aw(n.properties.get("star-intensity"),0,1);if(d===0)return;const y=t.context,b=y.gl,T=t.transform,D=t.getOrCreateProgram("stars"),F=r.ab.quat.identity([]);r.ab.quat.rotateX(F,F,-T._pitch),r.ab.quat.rotateZ(F,F,-T.angle),r.ab.quat.rotateX(F,F,r.ai(T._center.lat)),r.ab.quat.rotateY(F,F,-r.ai(T._center.lng));const V=r.ab.mat4.fromQuat(new Float32Array(16),F),j=r.ab.mat4.multiply([],T.starsProjMatrix,V),H=r.ab.mat3.fromMat4([],V),W=r.ab.mat3.invert([],H),Q=[0,1,0];r.ab.vec3.transformMat3(Q,Q,W),r.ab.vec3.scale(Q,Q,this.params.sizeMultiplier);const ce=[1,0,0];r.ab.vec3.transformMat3(ce,ce,W),r.ab.vec3.scale(ce,ce,this.params.sizeMultiplier);const oe=(de=Q,pe=ce,Se=d,{u_matrix:Float32Array.from(j),u_up:de,u_right:pe,u_intensity_multiplier:Se});var de,pe,Se;t.uploadCommonUniforms(y,D),this.starsVx&&this.starsIdx&&D.draw(t,b.TRIANGLES,Si.disabled,Oi.disabled,this.colorModeAlphaBlendedWriteRGB,zi.disabled,oe,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function wo(u,t){const n=[...u],d=t.cameraWorldSizeForFog/t.worldSize,y=r.ab.mat4.identity([]);return r.ab.mat4.scale(y,y,[d,d,1]),r.ab.mat4.multiply(n,y,n),r.ab.mat4.multiply(n,t.worldToFogMatrix,n),n}function vu(u,t,n,d,y){const b=n.material,T=d.context,{baseColorTexture:D,metallicRoughnessTexture:F}=b.pbrMetallicRoughness,{normalTexture:V,occlusionTexture:j,emissionTexture:H}=b;function W(ce,oe,de){if(ce&&(u.push(oe),T.activeTexture.set(T.gl.TEXTURE0+de),ce.gfxTexture)){const{minFilter:pe,magFilter:Se,wrapS:ke,wrapT:Ie}=ce.sampler;ce.gfxTexture.bindExtraParam(pe,Se,ke,Ie)}}W(D,"HAS_TEXTURE_u_baseColorTexture",Os.BaseColor),W(F,"HAS_TEXTURE_u_metallicRoughnessTexture",Os.MetallicRoughness),W(V,"HAS_TEXTURE_u_normalTexture",Os.Normal),W(j,"HAS_TEXTURE_u_occlusionTexture",Os.Occlusion),W(H,"HAS_TEXTURE_u_emissionTexture",Os.Emission),y&&(y.texture||(y.texture=new r.dk(d.context,y.image,[y.image.height,y.image.height,y.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+Os.LUT),y.texture&&y.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),u.push("APPLY_LUT_ON_GPU")),n.texcoordBuffer&&(u.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(n.texcoordBuffer)),n.colorBuffer&&(u.push(n.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(n.colorBuffer)),n.normalBuffer&&(u.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(n.normalBuffer)),n.pbrBuffer&&(u.push("HAS_ATTRIBUTE_a_pbr"),u.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(n.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||u.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||u.push("DIFFUSE_SHADED");const Q=d.shadowRenderer;Q&&(u.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Q.useNormalOffset&&u.push("NORMAL_OFFSET"))}function tn(u,t,n,d,y,b){const T=n.paint.get("model-opacity").constantOr(1),D=t.context,F=new Si(t.context.gl.LEQUAL,Si.ReadWrite,t.depthRangeFor3D),V=t.transform,j=u.mesh,H=j.material,W=H.pbrMetallicRoughness,Q=t.style.fog;let ce;ce=t.transform.projection.zAxisUnit==="pixels"?[...u.nodeModelMatrix]:r.ab.mat4.multiply([],d.zScaleMatrix,u.nodeModelMatrix),r.ab.mat4.multiply(ce,d.negCameraPosMatrix,ce);const oe=r.ab.mat4.invert([],ce);r.ab.mat4.transpose(oe,oe);const de=n.paint.get("model-color-use-theme").constantOr("default")==="none",pe=n.paint.get("model-emissive-strength").constantOr(0),Se=Jo(new Float32Array(u.worldViewProjection),new Float32Array(ce),new Float32Array(oe),null,t,T,W.baseColorFactor.toRenderColor(null),H.emissiveFactor,W.metallicFactor,W.roughnessFactor,H,pe,n),ke={defines:[]},Ie=[],Ue=t.shadowRenderer;Ue&&(Ue.useNormalOffset=!1),vu(ke.defines,Ie,j,t,de?null:n.lut);let Le=null;if(Q){const He=wo(u.nodeModelMatrix,t.transform);if(Le=new Float32Array(He),V.projection.name!=="globe"){const Qe=j.aabb.min,xt=j.aabb.max,[ut,It]=Q.getOpacityForBounds(He,Qe[0],Qe[1],xt[0],xt[1]);ke.overrideFog=ut>=je||It>=je}}const Be=bl(t,n.paint.get("model-cutoff-fade-range"));Be.shouldRenderCutoff&&ke.defines.push("RENDER_CUTOFF");const Oe=t.getOrCreateProgram("model",ke);t.uploadCommonUniforms(D,Oe,null,Le,Be),t.renderPass!=="shadow"&&Ue&&Ue.setupShadowsFromMatrix(u.nodeModelMatrix,Oe),Oe.draw(t,D.gl.TRIANGLES,F,y,b,j.material.doubleSided?zi.disabled:zi.backCCW,Se,n.id,j.vertexBuffer,j.indexBuffer,j.segments,n.paint,t.transform.zoom,void 0,Ie)}function dd(u,t,n,d,y,b,T){let D;D=u.projection.name==="globe"?r.dl(n,u):[...n],r.ab.mat4.multiply(D,D,t.matrix);const F=r.ab.mat4.multiply([],d,D);if(t.meshes)for(const V of t.meshes){if(V.material.alphaMode!=="BLEND"){T.push({mesh:V,depth:0,modelIndex:y,worldViewProjection:F,nodeModelMatrix:D});continue}const j=r.ab.vec3.transformMat4([],V.centroid,F);!u.isOrthographic&&j[2]<=0||b.push({mesh:V,depth:j[2],modelIndex:y,worldViewProjection:F,nodeModelMatrix:D})}if(t.children)for(const V of t.children)dd(u,V,n,d,y,b,T)}function xu(u,t,n,d){const y=n.shadowRenderer;if(!y)return;const b=y.getShadowPassDepthMode(),T=y.getShadowPassColorMode(),D=y.calculateShadowPassMatrixFromMatrix(t),F=cd(D);n.getOrCreateProgram("modelDepth",{defines:n._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,b,Oi.disabled,T,zi.backCCW,F,d.id,u.vertexBuffer,u.indexBuffer,u.segments,d.paint,n.transform.zoom,void 0,void 0)}function ha(u,t,n){const d=t.updateZoomBasedPaintProperties(),y=function(b,T,D){let F,V,j,H=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&H>0){const W=b.terrain,Q=W.findDEMTileFor(D);Q&&Q.dem?F=r.dn.create(W,D,Q):H=0}if(H===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),H===T.validForExaggeration&&(H===0||F&&F._demTile&&F._demTile.tileID===T.validForDEMTile.id&&F._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const W in T.instancesPerModel){const Q=T.instancesPerModel[W];for(let ce=0;ce<Q.instancedDataArray.length;++ce){const oe=(F?H*F.getElevationAt(0|Q.instancedDataArray.float32[16*ce],0|Q.instancedDataArray.float32[16*ce+1],!0,!0):0)+Q.instancesEvaluatedElevation[ce];Q.instancedDataArray.float32[16*ce+6]=oe,V=V?Math.min(T.terrainElevationMin,oe):oe,j=j?Math.max(T.terrainElevationMax,oe):oe}}return T.terrainElevationMin=V||0,T.terrainElevationMax=j||0,T.validForExaggeration=H,T.validForDEMTile=F&&F._demTile?{id:F._demTile.tileID,timestamp:F._dem._timestamp}:{id:void 0,timestamp:0},!0}(u,t,n);(d||y)&&(t.uploaded=!1,t.upload(u.context))}const Rs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.cd([0,0,0],[r.ag,r.ag,0])};function ls(u,t){const n=1<<u.canonical.z,d=t.getFreeCameraOptions().position,y=t.elevation,b=u.canonical.x/n,T=(u.canonical.x+1)/n,D=u.canonical.y/n,F=(u.canonical.y+1)/n;let V=t._centerAltitude;if(y){const Q=y.getMinMaxForTile(u);Q&&Q.max>V&&(V=Q.max)}const j=r.aw(d.x,b,T)-d.x,H=r.aw(d.y,D,F)-d.y,W=r.bH(V,t.center.lat)-d.z;return t._zoomFromMercatorZ(Math.sqrt(j*j+H*H+W*W))}function ph(u,t,n,d,y,b,T){const D=u.context,F=u.renderPass==="shadow",V=u.shadowRenderer,j=F&&V?V.getShadowPassDepthMode():new Si(D.gl.LEQUAL,Si.ReadWrite,u.depthRangeFor3D),H=u.isTileAffectedByFog(b);if(n.meshes)for(const W of n.meshes){const Q=["MODEL_POSITION_ON_GPU"],ce=[];let oe,de,pe;d.instancedDataArray.length>20&&Q.push("INSTANCED_ARRAYS");const Se=bl(u,t.paint.get("model-cutoff-fade-range"));if(Se.shouldRenderCutoff&&Q.push("RENDER_CUTOFF"),F&&V)oe=u.getOrCreateProgram("modelDepth",{defines:Q}),de=cd(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(n.matrix)),pe=V.getShadowPassColorMode();else{vu(Q,ce,W,u,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),oe=u.getOrCreateProgram("model",{defines:Q,overrideFog:H});const Ie=W.material,Ue=Ie.pbrMetallicRoughness,Le=t.paint.get("model-opacity").constantOr(1),Be=t.paint.get("model-emissive-strength").constantOr(0);de=Jo(b.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),null,u,Le,Ue.baseColorFactor.toRenderColor(null),Ie.emissiveFactor,Ue.metallicFactor,Ue.roughnessFactor,Ie,Be,t,y),V&&(T.shadowUniformsInitialized?oe.setShadowUniformValues(D,V.getShadowUniformValues()):(V.setupShadows(b.toUnwrapped(),oe,"model-tile",b.overscaledZ),T.shadowUniformsInitialized=!0)),pe=Se.shouldRenderCutoff||Le<1||Ie.alphaMode!=="OPAQUE"?Xi.alphaBlended:Xi.unblended}u.uploadCommonUniforms(D,oe,b.toUnwrapped(),null,Se);const ke=W.material.doubleSided?zi.disabled:zi.backCCW;if(d.instancedDataArray.length>20)ce.push(d.instancedDataBuffer),oe.draw(u,D.gl.TRIANGLES,j,Oi.disabled,pe,ke,de,t.id,W.vertexBuffer,W.indexBuffer,W.segments,t.paint,u.transform.zoom,void 0,ce,d.instancedDataArray.length);else{const Ie=F?"u_instance":"u_normal_matrix";for(let Ue=0;Ue<d.instancedDataArray.length;++Ue)de[Ie]=new Float32Array(d.instancedDataArray.arrayBuffer,64*Ue,16),oe.draw(u,D.gl.TRIANGLES,j,Oi.disabled,pe,ke,de,t.id,W.vertexBuffer,W.indexBuffer,W.segments,t.paint,u.transform.zoom,void 0,ce)}}if(n.children)for(const W of n.children)ph(u,t,W,d,y,b,T)}const Dl=[1,-1,1];function fh(u,t,n,d){if(!n.modelManager)return!0;const y=n.modelManager;if(!n.shadowRenderer)return!0;const b=n.shadowRenderer,T=t.aabb;let D=!0,F=u.maxHeight;if(F===0){let j=0;for(const H in u.instancesPerModel){const W=y.getModel(H,d);W?j=Math.max(j,Math.max(Math.max(W.aabb.max[0],W.aabb.max[1]),W.aabb.max[2])):D=!1}F=u.maxScale*j*1.41+u.maxVerticalOffset,D&&(u.maxHeight=F)}T.max[2]=F,T.min[2]+=u.terrainElevationMin,T.max[2]+=u.terrainElevationMax,r.ab.vec3.transformMat4(T.min,T.min,t.tileMatrix),r.ab.vec3.transformMat4(T.max,T.max,t.tileMatrix);const V=T.intersects(b.getCurrentCascadeFrustum());return n.currentShadowCascade===0&&(u.isInsideFirstShadowMapFrustum=V===2),V===0}function ln(u,t){const n=u.uniformValues.u_cutoff_params[0],d=u.uniformValues.u_cutoff_params[1],y=u.uniformValues.u_cutoff_params[2],b=u.uniformValues.u_cutoff_params[3];return d===n||b===y?1:r.aw(((t-n)/(d-n)-y)/(b-y),0,1)}function wp(u,t,n,d){if(t.pitch<20)return 1;const y=t.getWorldToCameraMatrix();r.ab.mat4.multiply(y,y,u);const b=r.ab.vec4.fromValues(n.min[0],n.min[1],n.min[2],1);let T=r.ab.vec4.transformMat4(r.ab.vec4.create(),b,y),D=T,F=T;b[1]=n.max[1],T=r.ab.vec4.transformMat4(r.ab.vec4.create(),b,y),D=T[1]<D[1]?T:D,F=T[1]>F[1]?T:F,b[0]=n.max[0],T=r.ab.vec4.transformMat4(r.ab.vec4.create(),b,y),D=T[1]<D[1]?T:D,F=T[1]>F[1]?T:F,b[1]=n.min[1],T=r.ab.vec4.transformMat4(r.ab.vec4.create(),b,y),D=T[1]<D[1]?T:D,F=T[1]>F[1]?T:F;const V=r.aw(d[0],0,1),j=100*t.pixelsPerMeter*r.aw(d[1],0,1),H=r.aw(d[2],0,1),W=r.ab.vec4.lerp(r.ab.vec4.create(),D,F,V),Q=Math.tan(.5*t.fovX),ce=-W[2]*Q;if(j===0)return W[1]<-Math.abs(ce)?H:1;const oe=(-Math.abs(ce)-W[1])/j,de=(Se,ke,Ie)=>(1-Ie)*Se+Ie*ke,pe=r.aw(de(1,H,oe),H,1);return de(1,pe,r.aw((t.pitch-20)/20,0,1))}class Ja{}class kl{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,n,d){{const H=this._storage.get(n.id);if(H)return H.lastUsedFrameIdx=t,H.buf}const y=d.gl,b=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),T=new ArrayBuffer(b),D=new Int16Array(T);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const F=new r.dq;for(let H=0;H<b/2;H+=3){const W=D[H],Q=D[H+1],ce=D[H+2];F.emplaceBack(W,Q),F.emplaceBack(Q,ce),F.emplaceBack(ce,W)}const V=d.bindVertexArrayOES.current,j=new Ja;return j.buf=new Na(d,F),j.lastUsedFrameIdx=t,this._storage.set(n.id,j),d.bindVertexArrayOES.set(V),j.buf}update(t){for(const[n,d]of this._storage)t-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(n))}destroy(){for(const[t,n]of this._storage)n.buf.destroy(),this._storage.delete(t)}}class eo{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Sp=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Tp{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class gs{constructor(t,n){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...n,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...n,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Mp=r.da([{type:"Float32",name:"a_pos_2f",components:2}]);class pd{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,n){const d=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new r.dr,D=new r.aU;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),D.emplaceBack(0,1,2),D.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(T,Mp.members),this.vignetteIdx=t.context.createIndexBuffer(D)}const y=r.b7.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,d);const T={u_vignetteShape:(b={vignetteShape:[n.start,n.range,Math.pow(10,n.fadePower)],vignetteColor:[n.color.r,n.color.g,n.color.b,n.color.a*n.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};d.draw(t,t.context.gl.TRIANGLES,Si.disabled,Oi.disabled,Xi.alphaBlended,zi.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,y,{})}var b}}class mh{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,n){const d=t.getFreeCameraOptions().position,y=d.toAltitude(),b=d.toLngLat(),T=r.ai(b.lng),D=r.ai(b.lat),F=t.pixelsPerMeter/n,V=T*r.ds,j=r.ds*Math.log(Math.tan(Math.PI/4+D/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const H=-this._offsetYPrev+j,W=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+V)*F,this._accumulatedOffsetY+=H*F,this._accumulatedElevation+=W*F,this._offsetXPrev=V,this._offsetYPrev=j,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Ol(u,t){return[-(u[0]-Math.floor(u[0]/t)*t),-(u[1]-Math.floor(u[1]/t)*t),-(u[2]-Math.floor(u[2]/t)*t)]}function xc(u){const t=r.di(1323123451230),n=[];for(let d=0;d<u;++d){const y=2*t()-1,b=2*t()-1,T=2*t()-1;n.push(r.ab.vec3.fromValues(y,b,T))}return n}function Ua(u,t,n,d,y){const b=r.aw((y-n)/(d-n),0,1);return(1-b)*u+b*t}class fd{constructor(t){this._movement=new mh,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new pd,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,n){const d=t.transform;this._movement.update(d,this._ppmScaleFactor);const y=d.starsProjMatrix,b=r.ab.quat.identity([]);r.ab.quat.rotateX(b,b,r.ai(90)-d._pitch),r.ab.quat.rotateZ(b,b,-d.angle);const T=r.ab.mat4.fromQuat(new Float32Array(16),b),D=r.ab.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),F=r.ab.mat4.transpose([],D),V=r.ab.mat4.multiply([],F,T),j=Date.now()/1e3;return this._accumulatedTimeFromStart+=(j-this._prevTime)*n,this._prevTime=j,{projectionMatrix:y,modelviewMatrix:V}}}class Ll extends fd{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new gs(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const d=xc(this.particlesCount),y=new r.dt,b=new r.aU;let T=0;const D=r.di(1323123451230);for(let F=0;F<d.length;++F){const V=d[F],j=[2*D()-1,D(),D(),D()];y.emplaceBack(V[0],V[1],V[2],-1,-1,...j),y.emplaceBack(V[0],V[1],V[2],1,-1,...j),y.emplaceBack(V[0],V[1],V[2],1,1,...j),y.emplaceBack(V[0],V[1],V[2],-1,1,...j),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=n.createVertexBuffer(y,Sp.members),this.particlesIdx=n.createIndexBuffer(b)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const n=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},d=t.transform.zoom;if(n.revealStart>d)return;const y=Ua(0,1,n.revealStart,n.revealStart+n.revealRange,d);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let T=[-b.direction.x,b.direction.y,-100];r.ab.vec3.normalize(T,T);const D=structuredClone(this._vignetteParams);D.strength*=y,b.overrideStyleParameters||(b.intensity=t.style.rain.state.density,b.timeFactor=t.style.rain.state.intensity,b.color=structuredClone(t.style.rain.state.color),T=structuredClone(t.style.rain.state.direction),b.screenThinning.intensity=t.style.rain.state.centerThinning,b.dropletSizeX=t.style.rain.state.dropletSize[0],b.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],b.distortionStrength=100*t.style.rain.state.distortionStrength,D.strength=1,D.color=structuredClone(t.style.rain.state.vignetteColor));const F=this.updateOnRender(t,b.timeFactor),V=t.context,j=V.gl,H=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new r.T(V,{width:t.width,height:t.height,data:null},j.RGBA8)),b.distortionStrength>0&&(V.activeTexture.set(j.TEXTURE0),this.screenTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),j.copyTexSubImage2D(j.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const W=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(V,W),V.activeTexture.set(j.TEXTURE0),this.screenTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const Q=[b.color.r,b.color.g,b.color.b,b.color.a],ce=(oe,de)=>{const pe=Ol(this._movement.getPosition(),oe),Se=b.dropletSizeX,ke=b.dropletSizeX*b.dropletSizeYScale,Ie=t.width/2,Ue=t.height/2,Le=Ua(0,b.screenThinning.start,0,1,b.screenThinning.intensity),Be=Ua(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),Oe=Ua(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),He=(Qe={modelview:F.modelviewMatrix,projection:F.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:pe,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:oe,rainDropletSize:[Se,ke],distortionStrength:b.distortionStrength,rainDirection:T,color:Q,screenSize:[H.width,H.height],thinningCenterPos:[Ie,Ue],thinningShape:[Le,Be,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:Oe,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:de?0:1},{u_modelview:Float32Array.from(Qe.modelview),u_projection:Float32Array.from(Qe.projection),u_time:Qe.time,u_cam_pos:Qe.camPos,u_texScreen:0,u_velocityConeAperture:Qe.velocityConeAperture,u_velocity:Qe.velocity,u_boxSize:Qe.boxSize,u_rainDropletSize:Qe.rainDropletSize,u_distortionStrength:Qe.distortionStrength,u_rainDirection:Qe.rainDirection,u_color:Qe.color,u_screenSize:Qe.screenSize,u_thinningCenterPos:Qe.thinningCenterPos,u_thinningShape:Qe.thinningShape,u_thinningAffectedRatio:Qe.thinningAffectedRatio,u_thinningParticleOffset:Qe.thinningParticleOffset,u_shapeDirectionalPower:Qe.shapeDirectionalPower,u_shapeNormalPower:Qe.shapeNormalPower,u_mode:Qe.mode});var Qe;const xt=Math.round(b.intensity*this.particlesCount),ut=r.b7.simpleSegment(0,0,4*xt,2*xt);W.draw(t,j.TRIANGLES,Si.disabled,Oi.disabled,Xi.alphaBlended,zi.disabled,He,"rain_particles",this.particlesVx,this.particlesIdx,ut,{})};b.distortionStrength>0&&ce(b.boxSize,!0),ce(b.boxSize,!1),this._vignette.draw(t,D)}}const Ep=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Cp extends fd{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new gs(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const d=xc(this.particlesCount),y=new r.du,b=new r.aU;let T=0;const D=r.di(1323123451230);for(let F=0;F<d.length;++F){const V=d[F],j=D(),H=D(),W=D(),Q=[F/d.length,j,H,W],ce=[D(),D()];y.emplaceBack(V[0],V[1],V[2],-1,-1,...Q,...ce),y.emplaceBack(V[0],V[1],V[2],1,-1,...Q,...ce),y.emplaceBack(V[0],V[1],V[2],1,1,...Q,...ce),y.emplaceBack(V[0],V[1],V[2],-1,1,...Q,...ce),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=n.createVertexBuffer(y,Ep.members),this.particlesIdx=n.createIndexBuffer(b)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const n=structuredClone(this._params);let d=[-n.direction.x,n.direction.y,-100];r.ab.vec3.normalize(d,d);const y=structuredClone(this._vignetteParams),b=n.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=t.transform.zoom;if(b.revealStart>T)return;const D=Ua(0,1,b.revealStart,b.revealStart+b.revealRange,T);y.strength*=D,n.overrideStyleParameters||(n.intensity=t.style.snow.state.density,n.timeFactor=t.style.snow.state.intensity,n.color=structuredClone(t.style.snow.state.color),d=structuredClone(t.style.snow.state.direction),n.screenThinning.intensity=t.style.snow.state.centerThinning,n.billboardSize=2.79*t.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(t.style.snow.state.vignetteColor));const F=this.updateOnRender(t,n.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const V=t.context,j=V.gl,H=t.transform,W=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(V,W),((Q,ce,oe)=>{const de=Ol(this._movement.getPosition(),Q),pe=H.width/2,Se=H.height/2,ke=Ua(0,oe.screenThinning.start,0,1,oe.screenThinning.intensity),Ie=Ua(.001,oe.screenThinning.range,0,1,oe.screenThinning.intensity),Ue=Ua(0,oe.screenThinning.particleOffset,0,1,oe.screenThinning.intensity),Le=(Be={modelview:F.modelviewMatrix,projection:F.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:de,velocityConeAperture:oe.velocityConeAperture,velocity:oe.velocity,horizontalOscillationRadius:oe.horizontalOscillationRadius,horizontalOscillationRate:oe.horizontalOscillationRate,boxSize:Q,billboardSize:1*oe.billboardSize,simpleShapeParameters:[oe.shapeFadeStart,oe.shapeFadePower],screenSize:[H.width,H.height],thinningCenterPos:[pe,Se],thinningShape:[ke,Ie,Math.pow(10,oe.screenThinning.fadePower)],thinningAffectedRatio:oe.screenThinning.affectedRatio,thinningParticleOffset:Ue,color:[oe.color.r,oe.color.g,oe.color.b,oe.color.a],direction:d},{u_modelview:Float32Array.from(Be.modelview),u_projection:Float32Array.from(Be.projection),u_time:Be.time,u_cam_pos:Be.camPos,u_velocityConeAperture:Be.velocityConeAperture,u_velocity:Be.velocity,u_horizontalOscillationRadius:Be.horizontalOscillationRadius,u_horizontalOscillationRate:Be.horizontalOscillationRate,u_boxSize:Be.boxSize,u_billboardSize:Be.billboardSize,u_simpleShapeParameters:Be.simpleShapeParameters,u_screenSize:Be.screenSize,u_thinningCenterPos:Be.thinningCenterPos,u_thinningShape:Be.thinningShape,u_thinningAffectedRatio:Be.thinningAffectedRatio,u_thinningParticleOffset:Be.thinningParticleOffset,u_particleColor:Be.color,u_direction:Be.direction});var Be;const Oe=Math.round(oe.intensity*this.particlesCount),He=r.b7.simpleSegment(0,0,4*Oe,2*Oe);this.particlesVx&&this.particlesIdx&&W.draw(t,j.TRIANGLES,Si.disabled,Oi.disabled,Xi.alphaBlended,zi.disabled,Le,"snow_particles",this.particlesVx,this.particlesIdx,He,{})})(n.boxSize,0,n),this._vignette.draw(t,y)}}const Fo={symbol:function(u,t,n,d,y){if(u.renderPass!=="translucent")return;const b=Oi.disabled,T=u.colorModeForRenderPass(),D=n.layout.get("text-variable-anchor"),F=n.layout.get("text-size-scale-range"),V=r.aw(u.scaleFactor,F[0],F[1]);D&&function(W,Q,ce,oe,de,pe,Se,ke){const Ie=Q.transform,Ue=de==="map",Le=pe==="map";for(const Be of W){const Oe=oe.getTile(Be),He=Oe.getBucket(ce);if(!He||!He.text||!He.text.segments.get().length)continue;const Qe=r.bp(He.textSizeData,Ie.zoom,ke),xt=Ha(Be,He.getProjection(),Ie),ut=Ie.calculatePixelsToTileUnitsMatrix(Oe),It=bs(xt,Oe.tileID.canonical,Le,Ue,Ie,He.getProjection(),ut),At=He.hasIconTextFit()&&He.hasIconData();if(Qe){const ot=Math.pow(2,Ie.zoom-Oe.tileID.overscaledZ);ud(He,Ue,Le,Se,r.cX,Ie,It,Be,ot,Qe,At)}}}(d,u,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),y,V);const j=n.paint.get("icon-opacity").constantOr(1)!==0,H=n.paint.get("text-opacity").constantOr(1)!==0;n.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(j||H)?ch(u,t,n,d,b,T):(j&&ch(u,t,n,d,b,T,{onlyIcons:!0}),H&&ch(u,t,n,d,b,T,{onlyText:!0})),t.map.showCollisionBoxes&&(lh(u,t,n,d,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),lh(u,t,n,d,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(u,t,n,d){if(u.renderPass!=="translucent")return;const y=n.paint.get("circle-opacity"),b=n.paint.get("circle-stroke-width"),T=n.paint.get("circle-stroke-opacity"),D=n.layout.get("circle-sort-key").constantOr(1)!==void 0,F=n.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(b.constantOr(1)===0||T.constantOr(1)===0))return;const V=u.context,j=V.gl,H=u.transform,W=u.depthModeForSublayer(0,Si.ReadOnly),Q=Oi.disabled,ce=u.colorModeForDrapableLayerRenderPass(F),oe=H.projection.name==="globe",de=[r.at(H.center.lng),r.aA(H.center.lat)],pe=[];for(let ke=0;ke<d.length;ke++){const Ie=d[ke],Ue=t.getTile(Ie),Le=Ue.getBucket(n);if(!Le||Le.projection.name!==H.projection.name)continue;const Be=Le.programConfigurations.get(n.id),Oe=r.cY(n),He=u.isTileAffectedByFog(Ie);oe&&Oe.push("PROJECTION_GLOBE_VIEW"),Oe.push("DEPTH_D24"),u.terrain&&H.depthOcclusionForSymbolsAndCircles&&Oe.push("DEPTH_OCCLUSION");const Qe=u.getOrCreateProgram("circle",{config:Be,defines:Oe,overrideFog:He}),xt=Le.layoutVertexBuffer,ut=Le.globeExtVertexBuffer,It=Le.indexBuffer,At=H.projection.createInversionMatrix(H,Ie.canonical),ot={programConfiguration:Be,program:Qe,layoutVertexBuffer:xt,globeExtVertexBuffer:ut,indexBuffer:It,uniformValues:r.cZ(u,Ie,Ue,At,de,n),tile:Ue};if(D){const wt=Le.segments.get();for(const Vt of wt)pe.push({segments:new r.b7([Vt]),sortKey:Vt.sortKey,state:ot})}else pe.push({segments:Le.segments,sortKey:0,state:ot})}D&&pe.sort((ke,Ie)=>ke.sortKey-Ie.sortKey);const Se={useDepthForOcclusion:H.depthOcclusionForSymbolsAndCircles};for(const ke of pe){const{programConfiguration:Ie,program:Ue,layoutVertexBuffer:Le,globeExtVertexBuffer:Be,indexBuffer:Oe,uniformValues:He,tile:Qe}=ke.state,xt=ke.segments;u.terrain&&u.terrain.setupElevationDraw(Qe,Ue,Se),u.uploadCommonUniforms(V,Ue,Qe.tileID.toUnwrapped()),Ue.draw(u,j.TRIANGLES,W,Q,ce,zi.disabled,He,n.id,Le,Oe,xt,n.paint,H.zoom,Ie,[Be])}},heatmap:function(u,t,n,d){if(n.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const y=u.context,b=y.gl,T=Oi.disabled,D=new Xi([b.ONE,b.ONE,b.ONE,b.ONE],r.aj.transparent,[!0,!0,!0,!0]);(function(Q,ce,oe,de){const pe=Q.gl,Se=ce.width*de,ke=ce.height*de;Q.activeTexture.set(pe.TEXTURE1),Q.viewport.set([0,0,Se,ke]);let Ie=oe.heatmapFbo;if(!Ie||Ie&&(Ie.width!==Se||Ie.height!==ke)){Ie&&Ie.destroy();const Ue=pe.createTexture();pe.bindTexture(pe.TEXTURE_2D,Ue),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_WRAP_S,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_WRAP_T,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_MIN_FILTER,pe.LINEAR),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_MAG_FILTER,pe.LINEAR),Ie=oe.heatmapFbo=Q.createFramebuffer(Se,ke,!0,null),function(Le,Be,Oe,He,Qe,xt){const ut=Le.gl;ut.texImage2D(ut.TEXTURE_2D,0,Le.extRenderToTextureHalfFloat?ut.RGBA16F:ut.RGBA,Qe,xt,0,ut.RGBA,Le.extRenderToTextureHalfFloat?ut.HALF_FLOAT:ut.UNSIGNED_BYTE,null),He.colorAttachment.set(Oe)}(Q,0,Ue,Ie,Se,ke)}else pe.bindTexture(pe.TEXTURE_2D,Ie.colorAttachment.get()),Q.bindFramebuffer.set(Ie.framebuffer)})(y,u,n,u.transform.projection.name==="globe"?.5:.25),y.clear({color:r.aj.transparent});const F=u.transform,V=F.projection.name==="globe",j=V?["PROJECTION_GLOBE_VIEW"]:[],H=V?zi.frontCCW:zi.disabled,W=[r.at(F.center.lng),r.aA(F.center.lat)];for(let Q=0;Q<d.length;Q++){const ce=d[Q];if(t.hasRenderableParent(ce))continue;const oe=t.getTile(ce),de=oe.getBucket(n);if(!de||de.projection.name!==F.projection.name)continue;const pe=u.isTileAffectedByFog(ce),Se=de.programConfigurations.get(n.id),ke=u.getOrCreateProgram("heatmap",{config:Se,defines:j,overrideFog:pe}),{zoom:Ie}=u.transform;u.terrain&&u.terrain.setupElevationDraw(oe,ke),u.uploadCommonUniforms(y,ke,ce.toUnwrapped());const Ue=F.projection.createInversionMatrix(F,ce.canonical);ke.draw(u,b.TRIANGLES,Si.disabled,T,D,H,_i(u,ce,oe,Ue,W,Ie,n.paint.get("heatmap-intensity")),n.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,n.paint,u.transform.zoom,Se,V?[de.globeExtVertexBuffer]:null)}y.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(y,b){const T=y.context,D=T.gl,F=b.heatmapFbo;if(!F)return;T.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,F.colorAttachment.get()),T.activeTexture.set(D.TEXTURE1);let V=b.colorRampTexture;V||(V=b.colorRampTexture=new r.T(T,b.colorRamp,D.RGBA8)),V.bind(D.LINEAR,D.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,D.TRIANGLES,Si.disabled,Oi.disabled,y.colorModeForRenderPass(),zi.disabled,((j,H,W,Q)=>({u_image:0,u_color_ramp:1,u_opacity:H.paint.get("heatmap-opacity")}))(0,b),b.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,b.paint,y.transform.zoom)}(u,n))},line:function(u,t,n,d){if(u.renderPass!=="translucent")return;const y=n.paint.get("line-opacity"),b=n.paint.get("line-width");if(y.constantOr(1)===0||b.constantOr(1)===0)return;const T=n.paint.get("line-emissive-strength"),D=n.paint.get("line-occlusion-opacity"),F=n.layout.get("line-elevation-reference"),V=n.layout.get("line-width-unit")==="meters",j=F==="sea",H=u.context,W=H.gl;if(n.hasElevatedBuckets&&u.transform.projection.name==="globe")return;const Q=n.layout.get("line-cross-slope"),ce=Q!==void 0,oe=Q<1,de=u.colorModeForDrapableLayerRenderPass(T),pe=u.terrain&&u.terrain.renderingToTexture,Se=pe?1:r.q.devicePixelRatio,ke=n.paint.get("line-dasharray"),Ie=ke.constantOr(1),Ue=n.layout.get("line-cap"),Le=ke.constantOr(null),Be=Ue.constantOr(null),Oe=n.paint.get("line-pattern"),He=Oe.constantOr(1),Qe=Oe.constantOr(null),xt=n.paint.get("line-opacity").constantOr(1);let ut=!He&&xt!==1||u.depthOcclusion&&D>0&&D<1;const It=n.paint.get("line-gradient"),At=He?"linePattern":"line",ot=r.c_(n);let wt;if(pe&&u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(ut=!1),D!==0&&u.depthOcclusion){const st=n.paint._values["line-opacity"];st&&st.value&&st.value.kind==="constant"?wt=st.value:r.w(`Occlusion opacity for layer ${n.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&ot.push("VARIABLE_LINE_WIDTH");const Vt=(st,Dt,bt,Kt,Bt)=>{for(const kt of st){const $t=t.getTile(kt);if(He&&!$t.patternsLoaded())continue;const Xt=$t.getBucket(n);if(!Xt||Xt.hasZOffset&&!Bt||!Xt.hasZOffset&&Bt)continue;u.prepareDrawTile();const ci=Xt.programConfigurations.get(n.id),di=u.isTileAffectedByFog(kt),Fi=u.getOrCreateProgram(At,{config:ci,defines:Dt,overrideFog:di,overrideRtt:!Bt&&void 0});if(Qe&&$t.imageAtlas){const $i=r.A.from(Qe).getPrimary().scaleSelf(Se).serialize(),lr=$t.imageAtlas.patternPositions[$i];lr&&ci.setConstantPatternPositions(lr)}if(!He&&Le&&Be&&$t.lineAtlas){const $i=$t.lineAtlas.getDash(Le,Be);$i&&ci.setConstantPatternPositions($i)}let[Mi,Ei]=n.paint.get("line-trim-offset");(Be==="round"||Be==="square")&&Mi!==Ei&&(Mi===0&&(Mi-=1),Ei===1&&(Ei+=1));const ji=pe?kt.projMatrix:null,pr=V?1/Xt.tileToMeter/r.ar($t,1,u.transform.zoom):1,Cr=V?1/Xt.tileToMeter/r.ar($t,1,Math.floor(u.transform.zoom)):1,dn=He?r.c$(u,$t,n,ji,Se,pr,Cr,[Mi,Ei]):r.d0(u,$t,n,ji,Xt.lineClipsArray.length,Se,pr,Cr,[Mi,Ei]);if(It){const $i=Xt.gradients[n.id];let lr=$i.texture;if(n.gradientVersion!==$i.version){let bi=256;if(n.stepInterpolant){const or=t.getSource().maxzoom,Dr=kt.canonical.z===or?Math.ceil(1<<u.transform.maxZoom-kt.canonical.z):1;bi=r.aw(r.d1(Xt.maxLineLength/r.ag*1024*Dr),256,H.maxTextureSize)}$i.gradient=r.d2({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:bi,image:$i.gradient||void 0,clips:Xt.lineClipsArray}),$i.texture?$i.texture.update($i.gradient):$i.texture=new r.T(H,$i.gradient,W.RGBA8),$i.version=n.gradientVersion,lr=$i.texture}H.activeTexture.set(W.TEXTURE1),lr.bind(n.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}Ie&&(H.activeTexture.set(W.TEXTURE0),$t.lineAtlasTexture&&$t.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),ci.updatePaintBuffers()),He&&(H.activeTexture.set(W.TEXTURE0),$t.imageAtlasTexture&&$t.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),ci.updatePaintBuffers()),Bt&&!j&&u.terrain.setupElevationDraw($t,Fi),u.uploadCommonUniforms(H,Fi,kt.toUnwrapped());const $r=$i=>{wt!=null&&(wt.value=xt*D),Fi.draw(u,W.TRIANGLES,bt,$i,de,zi.disabled,dn,n.id,Xt.layoutVertexBuffer,Xt.indexBuffer,Xt.segments,n.paint,u.transform.zoom,ci,[Xt.layoutVertexBuffer2,Xt.patternVertexBuffer,Xt.zOffsetVertexBuffer]),wt!=null&&(wt.value=xt)};if(ut&&!Bt){const $i=u.stencilModeForClipping(kt).ref;$i===0&&pe&&H.clear({stencil:0});const lr={func:W.EQUAL,mask:255};dn.u_alpha_discard_threshold=.8,$r(new Oi(lr,$i,255,W.KEEP,W.KEEP,W.INVERT)),dn.u_alpha_discard_threshold=0,$r(new Oi(lr,$i,255,W.KEEP,W.KEEP,W.KEEP))}else ut&&Bt&&(dn.u_alpha_discard_threshold=.001),$r(Bt?Kt:u.stencilModeForClipping(kt))}};if(n.hasNonElevatedBuckets){const st=!pe&&u.terrain;D!==0&&st?r.w(`Occlusion opacity for layer ${n.id} is supported on terrain only if the layer has line-z-offset enabled.`):st?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${n.id}.`):Vt(d,ot,u.depthModeForSublayer(0,Si.ReadOnly),Oi.disabled,!1)}if(n.hasElevatedBuckets){ot.push("ELEVATED"),ce&&ot.push(oe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),j&&ot.push("ELEVATION_REFERENCE_SEA");const st=ut?u.stencilModeFor3D():Oi.disabled,Dt=new Si(u.depthOcclusion?W.GREATER:W.LEQUAL,Si.ReadOnly,u.depthRangeFor3D);u.forceTerrainMode=!0,Vt(d,ot,Dt,st,!0),u.forceTerrainMode=!1}ut&&(u.resetStencilClippingMasks(),pe&&H.clear({stencil:0})),D===0||u.depthOcclusion||pe||u.layersWithOcclusionOpacity.push(u.currentLayer)},fill:function(u,t,n,d){const y=n.paint.get("fill-color"),b=n.paint.get("fill-opacity"),T=n.is3D(),D=new Si(u.context.gl.LEQUAL,Si.ReadWrite,u.depthRangeFor3D);if(b.constantOr(1)===0)return;const F=n.paint.get("fill-emissive-strength"),V=u.colorModeForDrapableLayerRenderPass(F),j=n.paint.get("fill-pattern"),H=u.opaquePassEnabledForLayer()&&!j.constantOr(1)&&y.constantOr(r.aj.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===H){const W=T?D:u.depthModeForSublayer(1,u.renderPass==="opaque"?Si.ReadWrite:Si.ReadOnly);_p(u,t,n,d,W,V,!1)}if(!T&&u.renderPass==="translucent"&&n.paint.get("fill-antialias")){const W=T?D:u.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,Si.ReadOnly);_p(u,t,n,d,W,V,!0)}},"fill-extrusion":function(u,t,n,d){const y=n.paint.get("fill-extrusion-opacity"),b=u.context,T=b.gl,D=u.terrain,F=D&&D.renderingToTexture;if(y===0)return;const V=u.conflationActive&&u.style.isLayerClipped(n,t.getSource()),j=u.style.order.indexOf(n.fqid);if(V&&function(H,W,Q,ce,oe){for(const de of ce){const pe=W.getTile(de).getBucket(Q);pe&&(pe.updateReplacement(de,H.replacementSource,oe),pe.uploadCentroid(H.context))}}(u,t,n,d,j),D||V)for(const H of d){const W=t.getTile(H).getBucket(n);W&&_c(u.context,t,H,W,n,D,V)}if(u.renderPass==="shadow"&&u.shadowRenderer){const H=u.shadowRenderer;if(D&&y<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.a9)return;const W=H.getShadowPassDepthMode(),Q=H.getShadowPassColorMode();gu(u,t,n,d,W,Oi.disabled,Q,V)}else if(u.renderPass==="translucent"){const H=!n.paint.get("fill-extrusion-pattern").constantOr(1),W=n.paint.get("fill-extrusion-color").constantOr(r.aj.white);if(!F&&W.a!==0){const Q=new Si(u.context.gl.LEQUAL,Si.ReadWrite,u.depthRangeFor3D);y===1&&H?gu(u,t,n,d,Q,Oi.disabled,Xi.unblended,V):(gu(u,t,n,d,Q,Oi.disabled,Xi.disabled,V),gu(u,t,n,d,Q,u.stencilModeFor3D(),u.colorModeForRenderPass(),V),u.resetStencilClippingMasks())}if(u.style.enable3dLights()&&H&&(!D&&u.transform.projection.name!=="globe"||F)){const Q=n.paint.get("fill-extrusion-opacity"),ce=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),de=n.paint.get("fill-extrusion-flood-light-intensity"),pe=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Se=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(pe?null:n.lut).toArray01().slice(0,3),ke=ce>0&&oe>0,Ie=de>0,Ue=(Be,Oe,He)=>(1-He)*Be+He*Oe,Le=Be=>{const Oe=u.depthModeForSublayer(1,Si.ReadOnly,T.LEQUAL,!0),He=n.paint.get(Be?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Qe=Ue(.1,3,He),xt=u._showOverdrawInspector;if(!xt){const ut=new Oi({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),It=new Xi([T.ONE,T.ONE,T.ONE,T.ONE],r.aj.transparent,[!1,!1,!1,!0],T.MIN);Vn(u,t,n,d,Oe,ut,It,zi.disabled,Be,"sdf",Q,ce,oe,de,Se,Qe,V,!1)}{const ut=xt?Oi.disabled:new Oi({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),It=xt?u.colorModeForRenderPass():new Xi([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],r.aj.transparent,[!0,!0,!0,!0]);Vn(u,t,n,d,Oe,ut,It,zi.disabled,Be,"color",Q,ce,oe,de,Se,Qe,V,!1)}};if(F){const Be=(Oe,He,Qe)=>{const xt=u.depthModeForSublayer(1,Si.ReadOnly,T.LEQUAL,!1),ut=n.paint.get(Oe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),It=Ue(.1,3,ut);{const At=new Xi([T.ONE,T.ONE,T.ONE,T.ONE],r.aj.transparent,[!1,!1,!1,!0]);Vn(u,t,n,d,xt,Oi.disabled,At,zi.disabled,Oe,"clear",Q,ce,oe,de,Se,It,V,He)}{const At=new Oi({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),ot=new Xi([T.ONE,T.ONE,T.ONE,T.ONE],r.aj.transparent,[!1,!1,!1,!0],T.MIN);Vn(u,t,n,d,xt,At,ot,zi.disabled,Oe,"sdf",Q,ce,oe,de,Se,It,V,He)}{const At=Oe?T.ZERO:T.ONE_MINUS_DST_ALPHA,ot=new Oi({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),wt=new Xi([At,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],r.aj.transparent,[!0,!0,!0,!0]);Vn(u,t,n,d,xt,ot,wt,zi.disabled,Oe,"color",Q,ce,oe,de,Se,It,V,He)}{const At=new Xi([T.ONE,T.ONE,T.ONE,Oe?T.ZERO:T.ONE],r.aj.transparent,[!1,!1,!1,!0],Oe?T.FUNC_ADD:T.MAX);Vn(u,t,n,d,xt,Oi.disabled,At,zi.disabled,Oe,"clear",Q,ce,oe,de,Se,It,V,He,Qe)}};if(ke||Ie){let Oe;if(u.prepareDrawTile(),D){const He=D.drapeBufferSize[0],Qe=D.drapeBufferSize[1];Oe=D.framebufferCopyTexture,Oe&&(!Oe||Oe.size[0]===He&&Oe.size[1]===Qe)||(Oe&&Oe.destroy(),Oe=D.framebufferCopyTexture=new r.T(b,new r.r({width:He,height:Qe}),T.RGBA8)),Oe.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,He,Qe)}ke&&Be(!0,!1,Oe),Ie&&Be(!1,!0,Oe)}}else ke&&Le(!0),Ie&&Le(!1),(ke||Ie)&&u.resetStencilClippingMasks()}}},hillshade:function(u,t,n,d){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent"||u.style.disableElevatedTerrain)return;const y=u.context,b=u.terrain&&u.terrain.renderingToTexture,[T,D]=u.renderPass!=="translucent"||b?[{},d]:u.stencilConfigForOverlap(d);for(const F of D){const V=t.getTile(F);if(V.needsHillshadePrepare&&u.renderPass==="offscreen")bf(u,V,n);else if(u.renderPass==="translucent"){const j=u.depthModeForSublayer(0,Si.ReadOnly),H=n.paint.get("hillshade-emissive-strength"),W=u.colorModeForDrapableLayerRenderPass(H),Q=b&&u.terrain?u.terrain.stencilModeForRTTOverlap(F):T[F.overscaledZ];th(u,F,V,n,j,Q,W)}}y.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,t,n,d,y,b){if(u.renderPass!=="translucent"||n.paint.get("raster-opacity")===0)return;const T=u.transform.projection.name==="globe",D=n.paint.get("raster-elevation")!==0,F=D&&T;if(u.renderElevatedRasterBackface&&!F)return;const V=u.context,j=V.gl,H=t.getSource(),W=function(Le,Be,Oe,He){const Qe=Be.paint.get("raster-color"),xt=Le.type==="raster-array",ut=[],It=Be.paint.get("raster-resampling"),At=Be.paint.get("raster-color-mix");let ot=Be.paint.get("raster-color-range");const wt=[At[0],At[1],At[2],0],Vt=At[3];let st=It==="nearest"?He.NEAREST:He.LINEAR;if(xt&&(ut.push("RASTER_ARRAY"),Qe||ut.push("RASTER_COLOR"),It==="linear"&&ut.push("RASTER_ARRAY_LINEAR"),st=He.NEAREST,!ot&&Le.rasterLayers)){const Dt=Le.rasterLayers.find(({id:bt})=>bt===Be.sourceLayer);Dt&&Dt.fields&&Dt.fields.range&&(ot=Dt.fields.range)}if(ot=ot||[0,1],Qe){ut.push("RASTER_COLOR"),Oe.activeTexture.set(He.TEXTURE2),Be.updateColorRamp(ot);let Dt=Be.colorRampTexture;Dt||(Dt=Be.colorRampTexture=new r.T(Oe,Be.colorRamp,He.RGBA8)),Dt.bind(He.LINEAR,He.CLAMP_TO_EDGE)}return{mix:wt,range:ot,offset:Vt,defines:ut,resampling:st}}(H,n,V,j);if(H instanceof r.aJ&&!d.length&&!T)return;const Q=n.paint.get("raster-emissive-strength"),ce=u.colorModeForDrapableLayerRenderPass(Q),oe=u.terrain&&u.terrain.renderingToTexture,de=!u.options.moving,pe=n.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR;if(H instanceof r.aJ&&!d.length&&(H.onNorthPole||H.onSouthPole)){const Le=D?u.stencilModeFor3D():Oi.disabled;return void dt(!!H.onNorthPole,null,u,t,n,Q,W,zi.disabled,Le)}if(!d.length)return;const[Se,ke]=H instanceof r.aJ||oe?[{},d]:u.stencilConfigForOverlap(d),Ie=ke[ke.length-1].overscaledZ;F&&W.defines.push("PROJECTION_GLOBE_VIEW"),D&&W.defines.push("RENDER_CUTOFF");const Ue=(Le,Be,Oe)=>{for(const He of Le){const Qe=He.toUnwrapped(),xt=t.getTile(He);if(oe&&(!xt||!xt.hasData()))continue;V.activeTexture.set(j.TEXTURE0);const ut=uh(xt,H,n,W);if(!ut||!ut.texture)continue;const{texture:It,mix:At,offset:ot,tileSize:wt,buffer:Vt}=ut;let st,Dt;oe?(st=Si.disabled,Dt=He.projMatrix):D?(st=new Si(j.LEQUAL,Si.ReadWrite,u.depthRangeFor3D),Dt=T?Float32Array.from(u.transform.expandedFarZProjMatrix):u.transform.calculateProjMatrix(Qe,de)):(st=u.depthModeForSublayer(He.overscaledZ-Ie,n.paint.get("raster-opacity")===1?Si.ReadWrite:Si.ReadOnly,j.LESS),Dt=u.transform.calculateProjMatrix(Qe,de));const bt=u.terrain&&oe?u.terrain.stencilModeForRTTOverlap(He):Se[He.overscaledZ],Kt=b?0:n.paint.get("raster-fade-duration");xt.registerFadeDuration(Kt);const Bt=t.findLoadedParent(He,0),kt=nh(xt,Bt,t,u.transform,Kt);let $t,Xt;u.terrain&&u.terrain.prepareDrawTile(),V.activeTexture.set(j.TEXTURE0),It.bind(pe,j.CLAMP_TO_EDGE),V.activeTexture.set(j.TEXTURE1),Bt?(Bt.texture&&Bt.texture.bind(pe,j.CLAMP_TO_EDGE),$t=Math.pow(2,Bt.tileID.overscaledZ-xt.tileID.overscaledZ),Xt=[xt.tileID.canonical.x*$t%1,xt.tileID.canonical.y*$t%1]):It.bind(pe,j.CLAMP_TO_EDGE),It.useMipmap&&V.extTextureFilterAnisotropic&&u.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);const ci=u.transform;let di;const Fi=D?Vf(ci):[0,0,0,0];let Mi,Ei,ji,pr,Cr,dn=0;if(F&&H instanceof r.aJ&&H.coordinates.length>3)Mi=Float32Array.from(r.bb(r.cH(new r.bT(0,0,0)))),Ei=Float32Array.from(ci.globeMatrix),ji=Float32Array.from(r.cD(ci)),pr=[r.at(ci.center.lng),r.aA(ci.center.lat)],di=H.elevatedGlobePerspectiveTransform,Cr=H.elevatedGlobeGridMatrix||new Float32Array(9);else if(F){const bi=r.cE(He.canonical);dn=r.cF(bi.getCenter().lat),Mi=Float32Array.from(r.bb(r.cH(He.canonical))),Ei=Float32Array.from(ci.globeMatrix),ji=Float32Array.from(r.cD(ci)),pr=[r.at(ci.center.lng),r.aA(ci.center.lat)],di=[0,0],Cr=Float32Array.from(r.cG(He.canonical,bi,dn,ci.worldSize/ci._pixelsPerMercatorPixel))}else di=H instanceof r.aJ?H.perspectiveTransform:[0,0],Mi=new Float32Array(16),Ei=new Float32Array(9),ji=new Float32Array(16),pr=[0,0],Cr=new Float32Array(9);const $r=Al(Dt,Mi,Ei,ji,Cr,Xt||[0,0],r.ae(u.transform.zoom),pr,Fi,$t||1,kt,n,di,D?n.paint.get("raster-elevation"):0,2,At,ot,W.range,wt,Vt,Q),$i=u.isTileAffectedByFog(He),lr=u.getOrCreateProgram("raster",{defines:W.defines,overrideFog:$i});if(u.uploadCommonUniforms(V,lr,Qe),H instanceof r.aJ){const bi=H.elevatedGlobeVertexBuffer,or=H.elevatedGlobeIndexBuffer;if(oe||!T)H.boundsBuffer&&H.boundsSegments&&lr.draw(u,j.TRIANGLES,st,Oi.disabled,ce,zi.disabled,$r,n.id,H.boundsBuffer,u.quadTriangleIndexBuffer,H.boundsSegments);else if(bi&&or){const Dr=ci.zoom<=r.c6?H.elevatedGlobeSegments:H.getSegmentsForLongitude(ci.center.lng);Dr&&lr.draw(u,j.TRIANGLES,st,Oi.disabled,ce,Be,$r,n.id,bi,or,Dr)}}else if(F){st=new Si(j.LEQUAL,Si.ReadOnly,u.depthRangeFor3D);const bi=u.globeSharedBuffers;if(bi){const[or,Dr,Mr]=bi.getGridBuffers(dn,!1);lr.draw(u,j.TRIANGLES,st,Oe||bt,u.colorModeForRenderPass(),Be,$r,n.id,or,Dr,Mr)}}else{const{tileBoundsBuffer:bi,tileBoundsIndexBuffer:or,tileBoundsSegments:Dr}=u.getTileBoundsBuffers(xt);lr.draw(u,j.TRIANGLES,st,bt,ce,zi.disabled,$r,n.id,bi,or,Dr)}}if(!(H instanceof r.aJ)&&F)for(const He of Le){const Qe=He.canonical.y===(1<<He.canonical.z)-1;He.canonical.y===0&&dt(!0,He,u,t,n,Q,W,Be,Oe||Oi.disabled),Qe&&dt(!1,He,u,t,n,Q,W,Be===zi.frontCW?zi.backCW:zi.frontCW,Oe||Oi.disabled)}};F?Ue(ke,u.renderElevatedRasterBackface?zi.backCW:zi.frontCW,u.stencilModeFor3D()):Ue(ke,zi.disabled,void 0),u.resetStencilClippingMasks()},"raster-particle":function(u,t,n,d,y,b){u.renderPass==="offscreen"&&function(T,D,F,V){if(!V.length)return;const j=T.context,H=j.gl,W=D.getSource();if(!(W instanceof is))return;const Q=Math.ceil(Math.sqrt(F.paint.get("raster-particle-count")));let ce=F.particlePositionRGBAImage;if(!ce||ce.width!==Q){const ke=function(Ie){const Ue=Ie*Ie,Le=new Uint8Array(4*Ue),Be=function(He){return He|=0,He=Math.imul(2747636419^He,2654435769),He=Math.imul(He^He>>>16,2654435769),((He=Math.imul(He^He>>>16,2654435769))>>>0)/4294967296},Oe=1/1.1;for(let He=0;He<Ue;He++){const Qe=Oe*(Be(2*He+0)+wi),xt=Oe*(Be(2*He+1)+wi),ut=255*Qe%1,It=255*xt%1,At=ut,ot=xt-It/255,wt=It;Le[4*He+0]=255*(Qe-ut/255),Le[4*He+1]=255*At,Le[4*He+2]=255*ot,Le[4*He+3]=255*wt}return Le}(Q);ce=F.particlePositionRGBAImage=new r.r({width:Q,height:Q},ke)}let oe=F.particleFramebuffer;oe?oe.width!==Q&&(oe.destroy(),oe=F.particleFramebuffer=j.createFramebuffer(Q,Q,!0,null)):oe=F.particleFramebuffer=j.createFramebuffer(Q,Q,!0,null);const de=[];for(const ke of V){const Ie=D.getTile(ke);if(!(Ie instanceof aa))continue;const Ue=Uf(Ie,W,F);if(!Ue)continue;const Le=[Ie.tileSize,Ie.tileSize];let Be=F.tileFramebuffer;Be||(Be=F.tileFramebuffer=j.createFramebuffer(Le[0],Le[1],!0,null));let Oe=Ie.rasterParticleState;Oe||(Oe=Ie.rasterParticleState=new yp(j,ke,Le,ce));const He=Oe.update(F.lastInvalidatedAt);Oe.particleTextureDimension!==Q&&Oe.updateParticleTexture(ke,ce);const Qe=Oe.targetColorTexture;Oe.targetColorTexture=Oe.backgroundColorTexture,Oe.backgroundColorTexture=Qe;const xt=Oe.particleTexture0;Oe.particleTexture0=Oe.particleTexture1,Oe.particleTexture1=xt,de.push([ke,Ue,Oe,He])}if(de.length===0)return;const pe=r.q.now(),Se=F.previousDrawTimestamp?.001*(pe-F.previousDrawTimestamp):.0167;if(F.previousDrawTimestamp=pe,F.hasColorMap()){j.activeTexture.set(H.TEXTURE0+2);let ke=F.colorRampTexture;ke||(ke=F.colorRampTexture=new r.T(j,F.colorRamp,H.RGBA8)),ke.bind(H.LINEAR,H.CLAMP_TO_EDGE)}j.bindFramebuffer.set(F.tileFramebuffer.framebuffer),function(ke,Ie,Ue){const Le=ke.context,Be=Le.gl,Oe=Ie.tileFramebuffer;Le.activeTexture.set(Be.TEXTURE0);const He={u_texture:0,u_opacity:1.05*(xt=Ie.paint.get("raster-particle-fade-opacity-factor"))/(xt+.05)},Qe=ke.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var xt;for(const ut of Ue){const[,,It,At]=ut;Oe.colorAttachment.set(It.targetColorTexture.texture),Le.viewport.set([0,0,Oe.width,Oe.height]),Le.clear({color:r.aj.transparent}),At&&(It.backgroundColorTexture.bind(Be.NEAREST,Be.CLAMP_TO_EDGE),Qe.draw(ke,Be.TRIANGLES,Si.disabled,Oi.disabled,Xi.alphaBlended,zi.disabled,He,Ie.id,ke.viewportBuffer,ke.quadTriangleIndexBuffer,ke.viewportSegments))}}(T,F,de),function(ke,Ie,Ue,Le){const Be=ke.context,Oe=Be.gl,He=Ue.tileFramebuffer,Qe=ke.transform.projection.name==="globe",xt=Ue.paint.get("raster-particle-max-speed");for(const ut of Le){const[It,At,ot]=ut;Be.activeTexture.set(Oe.TEXTURE0+0),At.texture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE),He.colorAttachment.set(ot.targetColorTexture.texture);const wt=ke.getOrCreateProgram("rasterParticleDraw",{defines:At.defines,overrideFog:!1});Be.activeTexture.set(Oe.TEXTURE0+1);const Vt=At.scalarData?[]:[0,1,2,3].map(bt=>r.d4[bt](It));Vt.push(It);const st=It.canonical.x,Dt=It.canonical.y;for(const bt of Vt){const Kt=Ie.getTile(Qe?bt.wrapped():bt);if(!Kt)continue;const Bt=Kt.rasterParticleState;if(!Bt)continue;const kt=bt.canonical.x+(1<<bt.canonical.z)*(bt.wrap-It.wrap),$t=bt.canonical.y;Bt.particleTexture0.bind(Oe.NEAREST,Oe.CLAMP_TO_EDGE);const Xt=ad(1,Bt.particleTexture0.size[0],[kt-st,$t-Dt],0,At.texture.size,2,xt,At.textureOffset,At.scale,At.offset);wt.draw(ke,Oe.POINTS,Si.disabled,Oi.disabled,Xi.alphaBlended,zi.disabled,Xt,Ue.id,Bt.particleIndexBuffer,void 0,Bt.particleSegment)}}}(T,D,F,de),j.bindFramebuffer.set(F.particleFramebuffer.framebuffer),function(ke,Ie,Ue,Le){const Be=ke.context,Oe=Be.gl,He=Ie.paint.get("raster-particle-max-speed"),Qe=Le*Ie.paint.get("raster-particle-speed-factor")*.15,xt=function(It){return Math.pow(It,6)}(.01+1*Ie.paint.get("raster-particle-reset-rate-factor")),ut=Ie.particleFramebuffer;Be.viewport.set([0,0,ut.width,ut.height]);for(const It of Ue){const[,At,ot]=It;Be.activeTexture.set(Oe.TEXTURE0+0),At.texture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE),Be.activeTexture.set(Oe.TEXTURE0+1);const wt=ot.particleTexture0;wt.bind(Oe.NEAREST,Oe.CLAMP_TO_EDGE);const Vt=Bf(1,wt.size[0],0,At.texture.size,He,Qe,xt,At.textureOffset,At.scale,At.offset);ut.colorAttachment.set(ot.particleTexture1.texture),Be.clear({color:r.aj.transparent}),ke.getOrCreateProgram("rasterParticleUpdate",{defines:At.defines}).draw(ke,Oe.TRIANGLES,Si.disabled,Oi.disabled,Xi.unblended,zi.disabled,Vt,Ie.id,ke.viewportBuffer,ke.quadTriangleIndexBuffer,ke.viewportSegments)}}(T,F,de,Se)}(u,t,n,d),u.renderPass==="translucent"&&(function(T,D,F,V,j){const H=T.context,W=H.gl,Q=D.getSource().tileSize,ce=5*(1-r.ac(r.bY,r.bY+1,T.transform.zoom))*Q+F.paint.get("raster-particle-elevation"),oe=!T.options.moving,de=T.transform.projection.name==="globe";if(!V.length)return;const[pe,Se]=T.stencilConfigForOverlap(V),ke=[];de&&ke.push("PROJECTION_GLOBE_VIEW");const Ie=T.stencilModeFor3D();for(const Ue of Se){const Le=Ue.toUnwrapped(),Be=D.getTile(Ue);if(!Be.rasterParticleState)continue;const Oe=Be.rasterParticleState,He=100;Be.registerFadeDuration(He);const Qe=D.findLoadedParent(Ue,0),xt=nh(Be,Qe,D,T.transform,He);let ut,It;T.terrain&&T.terrain.prepareDrawTile(),H.activeTexture.set(W.TEXTURE0),Oe.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),H.activeTexture.set(W.TEXTURE1),Qe&&Qe.rasterParticleState?(Qe.rasterParticleState.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),ut=Math.pow(2,Qe.tileID.overscaledZ-Be.tileID.overscaledZ),It=[Be.tileID.canonical.x*ut%1,Be.tileID.canonical.y*ut%1]):Oe.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const At=de?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(Le,oe),ot=T.transform,wt=jf(ot),Vt=r.cE(Ue.canonical),st=r.cF(Vt.getCenter().lat);let Dt,bt,Kt,Bt,kt;de?(Dt=Float32Array.from(r.bb(r.cH(Ue.canonical))),bt=Float32Array.from(ot.globeMatrix),Kt=Float32Array.from(r.cD(ot)),Bt=[r.at(ot.center.lng),r.aA(ot.center.lat)],kt=Float32Array.from(r.cG(Ue.canonical,Vt,st,ot.worldSize/ot._pixelsPerMercatorPixel))):(Dt=new Float32Array(16),bt=new Float32Array(9),Kt=new Float32Array(16),Bt=[0,0],kt=new Float32Array(9));const $t=Ba(At,Dt,bt,Kt,kt,It||[0,0],r.ae(T.transform.zoom),Bt,wt,ut||1,xt,ce),Xt=T.isTileAffectedByFog(Ue),ci=T.getOrCreateProgram("rasterParticle",{defines:ke,overrideFog:Xt});if(T.uploadCommonUniforms(H,ci,Le),de){const di=new Si(W.LEQUAL,Si.ReadOnly,T.depthRangeFor3D),Fi=0,Mi=T.globeSharedBuffers;if(Mi){const[Ei,ji,pr]=Mi.getGridBuffers(st,Fi!==0);ci.draw(T,W.TRIANGLES,di,Ie,Xi.alphaBlended,T.renderElevatedRasterBackface?zi.frontCCW:zi.backCCW,$t,F.id,Ei,ji,pr)}}else{const di=T.depthModeForSublayer(0,Si.ReadOnly),Fi=pe[Ue.overscaledZ],{tileBoundsBuffer:Mi,tileBoundsIndexBuffer:Ei,tileBoundsSegments:ji}=T.getTileBoundsBuffers(Be);ci.draw(T,W.TRIANGLES,di,Fi,Xi.alphaBlended,zi.disabled,$t,F.id,Mi,Ei,ji)}}T.resetStencilClippingMasks()}(u,t,n,d),u.style.map.triggerRepaint())},background:function(u,t,n,d){const y=n.paint.get("background-color"),b=n.paint.get("background-color-use-theme").constantOr("default")==="none",T=n.paint.get("background-opacity"),D=n.paint.get("background-emissive-strength"),F=n.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const V=u.context,j=V.gl,H=u.transform,W=H.tileSize,Q=n.paint.get("background-pattern");let ce;if(Q!==void 0&&(Q===null||(ce=u.imageManager.getPattern(Q.toString(),n.scope,u.style.getLut(n.scope)),!ce)))return;const oe=!Q&&y.a===1&&T===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==oe)return;const de=Oi.disabled,pe=u.depthModeForSublayer(0,oe==="opaque"?Si.ReadWrite:Si.ReadOnly),Se=u.colorModeForDrapableLayerRenderPass(D),ke=Q?"backgroundPattern":"background";let Ie,Ue=d;if(Ue||(Ie=u.getBackgroundTiles(),Ue=Object.values(Ie).map(Le=>Le.tileID)),Q&&(V.activeTexture.set(j.TEXTURE0),u.imageManager.bind(u.context,n.scope)),F){const Le=u.getOrCreateProgram(ke,{overrideFog:!1,overrideRtt:!0}),Be=new Float32Array(r.ab.mat4.identity([])),Oe=new r.aG(0,0,0,0,0),He=Q?Nf(Be,D,T,u,0,n.scope,ce,F,{tileID:Oe,tileSize:W}):ld(Be,D,T,y.toRenderColor(b?null:n.lut));Le.draw(u,j.TRIANGLES,pe,de,Se,zi.disabled,He,n.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments)}else for(const Le of Ue){const Be=u.isTileAffectedByFog(Le),Oe=u.getOrCreateProgram(ke,{overrideFog:Be}),He=Le.toUnwrapped(),Qe=d?Le.projMatrix:u.transform.calculateProjMatrix(He);u.prepareDrawTile();const xt=t?t.getTile(Le):Ie?Ie[Le.key]:new gl(Le,W,H.zoom,u),ut=Q?Nf(Qe,D,T,u,0,n.scope,ce,F,{tileID:Le,tileSize:W}):ld(Qe,D,T,y.toRenderColor(b?null:n.lut));u.uploadCommonUniforms(V,Oe,He);const{tileBoundsBuffer:It,tileBoundsIndexBuffer:At,tileBoundsSegments:ot}=u.getTileBoundsBuffers(xt);Oe.draw(u,j.TRIANGLES,pe,de,Se,zi.disabled,ut,n.id,It,At,ot)}},sky:function(u,t,n){const d=u._atmosphere?r.ae(u.transform.zoom):1,y=n.paint.get("sky-opacity")*d;if(y===0)return;const b=u.context,T=n.paint.get("sky-type"),D=new Si(b.gl.LEQUAL,Si.ReadOnly,[0,1]),F=u.frameCounter/1e3%1;T==="atmosphere"?u.renderPass==="offscreen"?n.needsSkyboxCapture(u)&&(function(V,j,H,W){const Q=V.context,ce=Q.gl;let oe=j.skyboxFbo;if(!oe){oe=j.skyboxFbo=Q.createFramebuffer(32,32,!0,null),j.skyboxGeometry=new bp(Q),j.skyboxTexture=Q.gl.createTexture(),ce.bindTexture(ce.TEXTURE_CUBE_MAP,j.skyboxTexture),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_WRAP_S,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_WRAP_T,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_MIN_FILTER,ce.LINEAR),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_MAG_FILTER,ce.LINEAR);for(let ke=0;ke<6;++ke)ce.texImage2D(ce.TEXTURE_CUBE_MAP_POSITIVE_X+ke,0,ce.RGBA,32,32,0,ce.RGBA,ce.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(oe.framebuffer),Q.viewport.set([0,0,32,32]);const de=j.getCenter(V,!0),pe=V.getOrCreateProgram("skyboxCapture"),Se=new Float64Array(16);r.ab.mat4.identity(Se),r.ab.mat4.rotateY(Se,Se,.5*-Math.PI),ms(V,j,pe,Se,de,0),r.ab.mat4.identity(Se),r.ab.mat4.rotateY(Se,Se,.5*Math.PI),ms(V,j,pe,Se,de,1),r.ab.mat4.identity(Se),r.ab.mat4.rotateX(Se,Se,.5*-Math.PI),ms(V,j,pe,Se,de,2),r.ab.mat4.identity(Se),r.ab.mat4.rotateX(Se,Se,.5*Math.PI),ms(V,j,pe,Se,de,3),r.ab.mat4.identity(Se),ms(V,j,pe,Se,de,4),r.ab.mat4.identity(Se),r.ab.mat4.rotateY(Se,Se,Math.PI),ms(V,j,pe,Se,de,5),Q.viewport.set([0,0,V.width,V.height])}(u,n),n.markSkyboxValid(u)):u.renderPass==="sky"&&function(V,j,H,W,Q){const ce=V.context,oe=ce.gl,de=V.transform,pe=V.getOrCreateProgram("skybox");ce.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_CUBE_MAP,j.skyboxTexture);const Se=((ke,Ie,Ue,Le,Be)=>({u_matrix:ke,u_sun_direction:Ie,u_cubemap:0,u_opacity:Le,u_temporal_offset:Be}))(de.skyboxMatrix,j.getCenter(V,!1),0,W,Q);V.uploadCommonUniforms(ce,pe),pe.draw(V,oe.TRIANGLES,H,Oi.disabled,V.colorModeForRenderPass(),zi.backCW,Se,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(u,n,D,y,F):T==="gradient"&&u.renderPass==="sky"&&function(V,j,H,W,Q){const ce=V.context,oe=ce.gl,de=V.transform,pe=V.getOrCreateProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new bp(ce)),ce.activeTexture.set(oe.TEXTURE0);let Se=j.colorRampTexture;Se||(Se=j.colorRampTexture=new r.T(ce,j.colorRamp,oe.RGBA8)),Se.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const ke=((Ie,Ue,Le,Be,Oe)=>({u_matrix:Ie,u_color_ramp:0,u_center_direction:Ue,u_radius:r.ai(Le),u_opacity:Be,u_temporal_offset:Oe}))(de.skyboxMatrix,j.getCenter(V,!1),j.paint.get("sky-gradient-radius"),W,Q);V.uploadCommonUniforms(ce,pe),pe.draw(V,oe.TRIANGLES,H,Oi.disabled,V.colorModeForRenderPass(),zi.backCW,ke,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(u,n,D,y,F)},debug:function(u,t,n,d,y,b){for(let T=0;T<n.length;T++)if(y){const V=new r.aj(d.r*.8,d.g*.8,d.b*.8,1);Il(u,t,n[T],d,-1,-1,b),Il(u,t,n[T],d,-1,1,b),Il(u,t,n[T],d,1,1,b),Il(u,t,n[T],d,1,-1,b),Il(u,t,n[T],V,0,0,b)}else Il(u,t,n[T],d,0,0,b)},custom:function(u,t,n,d){const y=u.context,b=n.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&n.isDraped(t)){if(u.renderPass==="offscreen"){const T=b.prerender;if(T){if(u.setCustomLayerDefaults(),y.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){const D=u.transform.pointMerc;T.call(b,y.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),r.ae(u.transform.zoom),[D.x,D.y],u.transform.pixelsPerMeterRatio)}else T.call(b,y.gl,u.transform.customLayerMatrix());y.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){const D=b.renderToTile;if(D){const F=d[0].canonical,V=new r.aa(F.x+d[0].wrap*(1<<F.z),F.y,F.z);y.setDepthMode(Si.disabled),y.setStencilMode(Oi.disabled),y.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),D.call(b,y.gl,V),y.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),y.setColorMode(u.colorModeForRenderPass()),y.setStencilMode(Oi.disabled);const T=b.renderingMode==="3d"?new Si(u.context.gl.LEQUAL,Si.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,Si.ReadOnly);if(y.setDepthMode(T),u.transform.projection.name==="globe"){const D=u.transform.pointMerc;b.render(y.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),r.ae(u.transform.zoom),[D.x,D.y],u.transform.pixelsPerMeterRatio)}else b.render(y.gl,u.transform.customLayerMatrix());y.setDirty(),u.setBaseState(),y.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(u,t,n,d){if(u.renderPass==="opaque")return;const y=n.paint.get("model-opacity").constantOr(1);if(y===0)return;const b=n.paint.get("model-cast-shadows");if(u.renderPass==="shadow"&&(!b||u.terrain&&y<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof r.a9))return;const T=u.shadowRenderer,D=n.paint.get("model-receive-shadows");T&&(T.useNormalOffset=!0,D||(T.enabled=!1));const F=()=>{T&&(T.useNormalOffset=!0,D||(T.enabled=!0))},V=t.getSource();if(u.renderPass==="light-beam"&&V.type!=="batched-model")return;if(V.type==="vector"||V.type==="geojson")return function(pe,Se,ke,Ie,Ue){const Le=pe.transform;if(Le.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${Le.projection.name} projection is not yet implemented`);const Be=Le.getFreeCameraOptions().position;if(!pe.modelManager)return;const Oe=pe.modelManager;ke.modelManager=Oe;const He=pe.shadowRenderer;if(!ke._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Qe=ke._unevaluatedLayout._values["model-id"],xt=Object.assign({},ke.layout.get("model-id").parameters),ut=pe.style.order.indexOf(ke.fqid);for(const It of Ie){const At=Se.getTile(It).getBucket(ke);if(!At||At.projection.name!==Le.projection.name)continue;const ot=At.getModelUris();ot&&!At.modelsRequested&&(Oe.addModelsFromBucket(ot,Ue),At.modelsRequested=!0);const wt=ls(It,Le);xt.zoom=wt;const Vt=Qe.possiblyEvaluate(xt);if(ha(pe,At,It),Rs.shadowUniformsInitialized=!1,Rs.useSingleShadowCascade=!!He&&He.getMaxCascadeForTile(It.toUnwrapped())===0,pe.renderPass==="shadow"&&He){if(pe.currentShadowCascade===1&&At.isInsideFirstShadowMapFrustum)continue;const bt=Le.calculatePosMatrix(It.toUnwrapped(),Le.worldSize);if(Rs.tileMatrix.set(bt),Rs.shadowTileMatrix=Float32Array.from(He.calculateShadowPassMatrixFromMatrix(bt)),Rs.aabb.min.fill(0),Rs.aabb.max[0]=Rs.aabb.max[1]=r.ag,Rs.aabb.max[2]=0,fh(At,Rs,pe,ke.scope))continue}const st=1<<It.canonical.z,Dt=[((Be.x-It.wrap)*st-It.canonical.x)*r.ag,(Be.y*st-It.canonical.y)*r.ag,Be.z*st*r.ag];pe.conflationActive&&Object.keys(At.instancesPerModel).length>0&&pe.style.isLayerClipped(ke,Se.getSource())&&At.updateReplacement(It,pe.replacementSource,ut,Ue)&&(At.uploaded=!1,At.upload(pe.context));for(let bt in At.instancesPerModel){const Kt=At.instancesPerModel[bt];Kt.features.length>0&&(bt=Vt.evaluate(Kt.features[0].feature,{}));const Bt=Oe.getModel(bt,Ue);if(Bt&&Bt.uploaded)for(const kt of Bt.nodes)ph(pe,ke,kt,Kt,Dt,It,Rs)}}}(u,t,n,d,V.type==="vector"?n.scope:""),void F();if(!V.loaded())return;if(V.type==="batched-model")return function(pe,Se,ke,Ie){ke.resetLayerRenderingStats(pe);const Ue=pe.context,Le=pe.transform,Be=pe.style.fog,Oe=pe.shadowRenderer;if(Le.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${Le.projection.name} projection is not yet implemented`);const He=pe.transform.getFreeCameraOptions().position,Qe=r.ab.vec3.scale([],[He.x,He.y,He.z],pe.transform.worldSize),xt=r.ab.vec3.negate([],Qe),ut=r.ab.mat4.identity([]),It=r.dj(Le.center.lat,Le.zoom),At=r.ab.mat4.fromScaling([],[1,1,1/It]);r.ab.mat4.translate(ut,ut,xt);const ot=ke.paint.get("model-opacity").constantOr(1),wt=new Si(Ue.gl.LEQUAL,Si.ReadWrite,pe.depthRangeFor3D),Vt=new Si(Ue.gl.LEQUAL,Si.ReadOnly,pe.depthRangeFor3D),st=new r.cd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Dt=pe.renderPass==="shadow",bt=Dt&&Oe?Oe.getCurrentCascadeFrustum():Le.getFrustum(Le.scaleZoom(Le.worldSize)),Kt=ke.paint.get("model-front-cutoff"),Bt=Kt[2]<1,kt=bl(pe,ke.paint.get("model-cutoff-fade-range")),$t=ke.getLayerRenderingStats();(function(Xt,ci,di,Fi){const Mi=Xt.terrain?Xt.terrain.exaggeration():0,Ei=Xt.transform.zoom;for(const ji of Fi){const pr=ci.getTile(ji).getBucket(di);pr&&(Xt.conflationActive&&pr.updateReplacement(ji,Xt.replacementSource),pr.evaluateScale(Xt,di),Xt.terrain&&Mi>0&&pr.elevationUpdate(Xt.terrain,Mi,ji,di.source),pr.needsReEvaluation(Xt,Ei,di)&&pr.evaluate(di))}})(pe,Se,ke,Ie),function(){let Xt,ci,di;Bt?(Xt=Ie.length-1,ci=-1,di=-1):(Xt=0,ci=Ie.length,di=1);const Fi=new Float64Array(16),Mi=r.ab.vec3.create(),Ei=new r.P(0,0);for(let ji=Xt;ji!==ci;ji+=di){const pr=Ie[ji],Cr=Se.getTile(pr).getBucket(ke);if(!Cr||!Cr.uploaded)continue;let dn=!1;Oe&&(dn=Oe.getMaxCascadeForTile(pr.toUnwrapped())===0);const $r=Le.calculatePosMatrix(pr.toUnwrapped(),Le.worldSize),$i=Cr.modelTraits;!Dt&&Bt&&(r.ab.mat4.invert(Fi,$r),r.ab.vec3.transformMat4(Mi,Qe,Fi),Ei.x=Mi[0],Ei.y=Mi[1]);const lr=[];for(const bi of Cr.getNodesInfo()){if(bi.hiddenByReplacement||!bi.node.meshes)continue;const or=bi.node;let Dr=0;pe.terrain&&or.elevation&&(Dr=or.elevation*pe.terrain.exaggeration());const Mr=(()=>{const mr=bi.aabb;return st.min=[...mr.min],st.max=[...mr.max],st.min[2]+=Dr,st.max[2]+=Dr,r.ab.vec3.transformMat4(st.min,st.min,$r),r.ab.vec3.transformMat4(st.max,st.max,$r),st})(),pn=bi.evaluatedScale;if(pn[0]<=1&&pn[1]<=1&&pn[2]<=1&&Mr.intersects(bt)===0)continue;if(!Dt&&Bt){const mr=.16666666666666666;bi.cameraCollisionOpacity=Qe[0]>Mr.min[0]&&Qe[0]<Mr.max[0]&&Qe[1]>Mr.min[1]&&Qe[1]<Mr.max[1]&&Qe[2]*It<Mr.max[2]&&or.footprint&&r.bA(Ei,or.footprint)?Math.max(bi.cameraCollisionOpacity-mr,0):Math.min(1,bi.cameraCollisionOpacity+mr)}const ns=[...$r],Tn=or.anchor?or.anchor[0]:0,qn=or.anchor?or.anchor[1]:0;r.ab.mat4.translate(ns,ns,[Tn*(pn[0]-1),qn*(pn[1]-1),Dr]),r.ab.vec3.exactEquals(pn,r.dm)||r.ab.mat4.scale(ns,ns,pn);const Eo=r.ab.mat4.multiply([],ns,or.matrix),Hs=r.ab.mat4.multiply([],Le.expandedFarZProjMatrix,Eo),rn=r.ab.mat4.multiply([],Le.expandedFarZProjMatrix,ns),Gr=r.ab.vec4.transformMat4([],[Tn,qn,Dr,1],Hs)[2];or.hidden=!1;let Br=ot;Dt||(Bt&&(Br*=bi.cameraCollisionOpacity,Br*=wp(ns,Le,bi.aabb,Kt)),Br*=ln(kt,Gr)),Br!==0?lr.push({nodeInfo:bi,depth:Gr,opacity:Br,wvpForNode:Hs,wvpForTile:rn,nodeModelMatrix:Eo,tileModelMatrix:ns}):or.hidden=!0}Dt||lr.sort((bi,or)=>!Bt||bi.opacity===1&&or.opacity===1?bi.depth<or.depth?-1:1:bi.opacity===1?-1:or.opacity===1?1:bi.depth>or.depth?-1:1);for(const bi of lr){const or=bi.nodeInfo,Dr=or.node;let Mr=r.ab.mat4.multiply([],At,bi.tileModelMatrix);r.ab.mat4.multiply(Mr,ut,Mr);const pn=r.ab.mat4.invert([],Mr);r.ab.mat4.transpose(pn,pn),r.ab.mat4.scale(pn,pn,Dl),Mr=r.ab.mat4.multiply(Mr,Mr,Dr.matrix);const ns=pe.renderPass==="light-beam",Tn=ke.paint.get("model-color-use-theme").constantOr("default")==="none",qn=$i&r.dp.HasMapboxMeshFeatures,Eo=qn?0:or.evaluatedRMEA[0][2];for(let Hs=0;Hs<Dr.meshes.length;++Hs){const rn=Dr.meshes[Hs],Gr=Hs===Dr.lightMeshIndex;let Br=bi.wvpForNode;if(Gr){if(!ns&&!pe.terrain&&pe.shadowRenderer){pe.currentLayer<pe.firstLightBeamLayer&&(pe.firstLightBeamLayer=pe.currentLayer);continue}Br=bi.wvpForTile}else if(ns)continue;const mr={defines:[]},Dn=[];if(!Dt&&Oe&&(Oe.useNormalOffset=!!rn.normalBuffer),vu(mr.defines,Dn,rn,pe,Tn?null:ke.lut),qn||mr.defines.push("DIFFUSE_SHADED"),dn&&mr.defines.push("SHADOWS_SINGLE_CASCADE"),$t&&(Dt?$t.numRenderedVerticesInShadowPass+=rn.vertexArray.length:$t.numRenderedVerticesInTransparentPass+=rn.vertexArray.length),Dt){xu(rn,bi.nodeModelMatrix,pe,ke);continue}let Yn=null;if(Be){const Vo=wo(bi.nodeModelMatrix,pe.transform);if(Yn=new Float32Array(Vo),Le.projection.name!=="globe"){const Uo=rn.aabb.min,jo=rn.aabb.max,[nl,$o]=Be.getOpacityForBounds(Vo,Uo[0],Uo[1],jo[0],jo[1]);mr.overrideFog=nl>=je||$o>=je}}const jr=rn.material;let zs;jr.occlusionTexture&&jr.occlusionTexture.offsetScale&&(zs=jr.occlusionTexture.offsetScale,mr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const ta=pe.getOrCreateProgram("model",mr);!Dt&&Oe&&Oe.setupShadowsFromMatrix(bi.tileModelMatrix,ta,Oe.useNormalOffset),pe.uploadCommonUniforms(Ue,ta,null,Yn);const Co=jr.pbrMetallicRoughness;Co.metallicFactor=.9,Co.roughnessFactor=.5;const ho=Jo(new Float32Array(Br),new Float32Array(Mr),new Float32Array(pn),new Float32Array(Dr.matrix),pe,bi.opacity,Co.baseColorFactor.toRenderColor(null),jr.emissiveFactor,Co.metallicFactor,Co.roughnessFactor,jr,Eo,ke,[0,0,0],zs);!Gr&&(or.hasTranslucentParts||bi.opacity<1)&&ta.draw(pe,Ue.gl.TRIANGLES,wt,Oi.disabled,Xi.disabled,zi.backCCW,ho,ke.id,rn.vertexBuffer,rn.indexBuffer,rn.segments,ke.paint,pe.transform.zoom,void 0,Dn),ta.draw(pe,Ue.gl.TRIANGLES,Gr?Vt:wt,Oi.disabled,Gr||bi.opacity<1||or.hasTranslucentParts?Xi.alphaBlended:Xi.unblended,zi.backCCW,ho,ke.id,rn.vertexBuffer,rn.indexBuffer,rn.segments,ke.paint,pe.transform.zoom,void 0,Dn)}}}}()}(u,t,n,d),void F();if(V.type!=="model")return;const j=V.getModels(),H=[],W=u.transform.getFreeCameraOptions().position,Q=r.ab.vec3.scale([],[W.x,W.y,W.z],u.transform.worldSize);r.ab.vec3.negate(Q,Q);const ce=[],oe=[];let de=0;for(const pe of j){const Se=n.paint.get("model-rotation").constantOr(null),ke=n.paint.get("model-scale").constantOr(null),Ie=n.paint.get("model-translation").constantOr(null);pe.computeModelMatrix(u,Se,ke,Ie,!0,!0,!1);const Ue=r.ab.mat4.identity([]),Le=r.dj(pe.position.lat,u.transform.zoom),Be=r.ab.mat4.fromScaling([],[1,1,1/Le]);r.ab.mat4.translate(Ue,Ue,Q),H.push({zScaleMatrix:Be,negCameraPosMatrix:Ue});for(const Oe of pe.nodes)dd(u.transform,Oe,pe.matrix,u.transform.expandedFarZProjMatrix,de,ce,oe);de++}if(ce.sort((pe,Se)=>Se.depth-pe.depth),u.renderPass!=="shadow"){if(y===1)for(const pe of oe)tn(pe,u,n,H[pe.modelIndex],Oi.disabled,u.colorModeForRenderPass());else{for(const pe of oe)tn(pe,u,n,H[pe.modelIndex],Oi.disabled,Xi.disabled);for(const pe of oe)tn(pe,u,n,H[pe.modelIndex],u.stencilModeFor3D(),u.colorModeForRenderPass());u.resetStencilClippingMasks()}for(const pe of ce)tn(pe,u,n,H[pe.modelIndex],Oi.disabled,u.colorModeForRenderPass());F()}else{for(const pe of oe)xu(pe.mesh,pe.nodeModelMatrix,u,n);for(const pe of ce)xu(pe.mesh,pe.nodeModelMatrix,u,n);F()}}},bu={line:function(u,t,n){if(u.hasElevatedBuckets=!1,u.hasNonElevatedBuckets=!1,u._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||u._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const d=t.getVisibleCoordinates();for(const y of d){const b=t.getTile(y).getBucket(u);if(b&&(b.hasZOffset?u.hasElevatedBuckets=!0:u.hasNonElevatedBuckets=!0,u.hasElevatedBuckets&&u.hasNonElevatedBuckets))break}}}else u.hasNonElevatedBuckets=!0},model:function(u,t,n){const d=t.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(n.modelManager&&n.modelManager.upload(n,d.type==="vector"?u.scope:""));if(d.type==="batched-model"||d.type!=="model")return;const y=d.getModels();for(const b of y)b.upload(n.context)},raster:function(u,t,n){const d=t.getSource();if(!(d instanceof is&&d.loaded()))return;const y=u.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!y)return;const b=u.paint.get("raster-array-band")||d.getInitialBand(y);if(b==null)return;const T=t.getIds().map(D=>t.getTileByID(D));for(const D of T)D.updateNeeded(y,b)&&d.prepareTile(D,y,b)},"raster-particle":function(u,t,n){const d=t.getSource();if(!(d instanceof is&&d.loaded()))return;const y=u.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!y)return;const b=u.paint.get("raster-particle-array-band")||d.getInitialBand(y);if(b==null)return;const T=t.getIds().map(D=>t.getTileByID(D));for(const D of T)D.updateNeeded(y,b)&&d.prepareTile(D,y,b)}};class Qa{constructor(t,n,d,y,b){this.context=new ah(t,n),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=r.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const F of T)this._debugParams.enabledLayers[F]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const F of T)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],F);this.occlusionParams=new eo(b),this.setup(),this.numSublayers=Yo.maxUnderzooming+Yo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.dv,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ic(this),this._wireframeDebugCache=new kl,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const D=new r.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,D,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y}updateTerrain(t,n){const d=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new hu(this,t));const y=this._terrain;this.transform.elevation=d?y:null,y.update(t,this.transform,n),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(t){const n=t.fog;if(!n||this.transform.projection.name==="globe"||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,y]=n.getFovAdjustedRange(this.transform._fov);if(d>y)return void(this.transform.fogCullDistSq=null);const b=d+.78*(y-d);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new hu(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,n){if(this.width=t*r.q.devicePixelRatio,this.height=n*r.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const t=this.context,n=new r.b4;n.emplaceBack(0,0),n.emplaceBack(r.ag,0),n.emplaceBack(0,r.ag),n.emplaceBack(r.ag,r.ag),this.tileExtentBuffer=t.createVertexBuffer(n,r.b6.members),this.tileExtentSegments=r.b7.simpleSegment(0,0,4,2);const d=new r.b4;d.emplaceBack(0,0),d.emplaceBack(r.ag,0),d.emplaceBack(0,r.ag),d.emplaceBack(r.ag,r.ag),this.debugBuffer=t.createVertexBuffer(d,r.b6.members),this.debugSegments=r.b7.simpleSegment(0,0,4,5);const y=new r.b4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(y,r.b6.members),this.viewportSegments=r.b7.simpleSegment(0,0,4,2);const b=new r.aT;b.emplaceBack(0,0,0,0),b.emplaceBack(r.ag,0,r.ag,0),b.emplaceBack(0,r.ag,0,r.ag),b.emplaceBack(r.ag,r.ag,r.ag,r.ag),this.mercatorBoundsBuffer=t.createVertexBuffer(b,r.b9.members),this.mercatorBoundsSegments=r.b7.simpleSegment(0,0,4,2);const T=new r.aU;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(T);const D=new r.b5;for(const V of[0,1,3,2,0])D.emplaceBack(V);this.debugIndexBuffer=t.createIndexBuffer(D),this.emptyTexture=new r.T(t,new r.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=r.ab.mat4.create();const F=this.context.gl;this.stencilClearMode=new Oi({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Si.disabled,this.stencilClearMode,Xi.disabled,zi.disabled,nd(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,n,d){if(!n||this.currentStencilSource===n.id||!t.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let D=!1;for(const F of d)if(this._tileClippingMaskIDs[F.key]===void 0){D=!0;break}if(!D)return}this.currentStencilSource=n.id;const y=this.context,b=y.gl;this.nextStencilID+d.length>256&&this.clearStencil(),y.setColorMode(Xi.disabled),y.setDepthMode(Si.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const D of d){const F=n.getTile(D),V=this._tileClippingMaskIDs[D.key]=this.nextStencilID++,{tileBoundsBuffer:j,tileBoundsIndexBuffer:H,tileBoundsSegments:W}=this.getTileBoundsBuffers(F);T.draw(this,b.TRIANGLES,Si.disabled,new Oi({func:b.ALWAYS,mask:0},V,255,b.KEEP,b.KEEP,b.REPLACE),Xi.disabled,zi.disabled,nd(D.projMatrix),"$clipping",j,H,W)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Oi({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const n=this.context.gl;return new Oi({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,d=t.sort((T,D)=>D.overscaledZ-T.overscaledZ),y=d[d.length-1].overscaledZ,b=d[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let D=0;D<b;D++)T[D+y]=new Oi({func:n.GEQUAL,mask:255},D+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=b,[T,d]}return[{[y]:Oi.disabled},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Xi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new r.aj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Xi.unblended:Xi.alphaBlended}colorModeForDrapableLayerRenderPass(t){const n=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Xi([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new r.aj(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,n,d,y=!1){if(this.depthOcclusion)return new Si(this.context.gl.GREATER,Si.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return Si.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Si(d||this.context.gl.LEQUAL,n,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,n=Math.ceil(this.width),d=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),b=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===n&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),n!==0&&d!==0&&(this.depthFBO=new gp(this.context,n,d,!1,"texture"),this.depthTexture=new r.T(this.context,{width:n,height:d,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),t.bindTexture(t.TEXTURE_2D,b),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,n,d,0,0,n,d,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,n)=>t+n/this._fpsHistory.length,0))}render(t,n){const d=r.q.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=n;const y=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(b).filter(ot=>{const wt=y[ot];return!(wt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[wt.type]});let D=T(),F=!1,V=!1;for(const ot of D){const wt=y[ot];wt.type==="circle"&&(F=!0),wt.type==="symbol"&&(wt.hasInitialOcclusionOpacityProperties?V=!0:F=!0)}let j=D.map(ot=>y[ot]);const H=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(r.q.now()),this.imageManager.beginFrame();let W=0,Q=!1;for(const ot in H){const wt=H[ot];wt.used&&(wt.prepare(this.context),wt.getSource().usedInConflation&&++W)}let ce=!1;for(const ot of j)ot.isHidden(this.transform.zoom)||(ot.type==="clip"&&(ce=!0),this.prepareLayer(ot));const oe={},de={},pe={},Se={},ke={};for(const ot in H){const wt=H[ot];oe[ot]=wt.getVisibleCoordinates(),de[ot]=oe[ot].slice().reverse(),pe[ot]=wt.getVisibleCoordinates(!0).reverse(),Se[ot]=wt.getShadowCasterCoordinates(),ke[ot]=wt.sortCoordinatesByDistance(oe[ot])}const Ie=ot=>{const wt=this.style.getLayerSourceCache(ot);return wt&&wt.used?wt.getSource():null};if(W||ce||this._clippingActiveLastFrame){const ot=[],wt=[];let Vt=0;for(const st of j)this.isSourceForClippingOrConflation(st,Ie(st))&&(ot.push(st),wt.push(Vt)),Vt++;if(ot&&(ce||ot.length>1)||this._clippingActiveLastFrame){ce=!1;const st=[];for(let Dt=0;Dt<ot.length;Dt++){const bt=ot[Dt],Kt=wt[Dt],Bt=this.style.getLayerSourceCache(bt);if(!Bt||!Bt.used||!Bt.getSource().usedInConflation&&bt.type!=="clip")continue;let kt=r.dx,$t=r.by.None;const Xt=[];let ci=!0;if(bt.type==="clip"){kt=Kt;for(const di of bt.layout.get("clip-layer-types"))$t|=di==="model"?r.by.Model:di==="symbol"?r.by.Symbol:r.by.FillExtrusion;for(const di of bt.layout.get("clip-layer-scope"))Xt.push(di);bt.isHidden(this.transform.zoom)?ci=!1:ce=!0}ci&&st.push({layer:bt.fqid,cache:Bt,order:kt,clipMask:$t,clipScope:Xt})}this.replacementSource.setSources(st),Q=!0}}this._clippingActiveLastFrame=ce,Q||this.replacementSource.clear(),this.conflationActive=Q,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ot=0;ot<j.length;ot++){const wt=j[ot],Vt=wt.cutoffRange();if(this.longestCutoffRange=Math.max(Vt,this.longestCutoffRange),Vt>0){const st=Ie(wt);st&&(this.minCutoffZoom=Math.max(st.minzoom,this.minCutoffZoom)),wt.minzoom&&(this.minCutoffZoom=Math.max(wt.minzoom,this.minCutoffZoom))}wt.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ot),this._lastOcclusionLayer=ot)}const Ue=this.style&&this.style.fog;Ue?(this._fogVisible=Ue.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ue.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(pe),this.opaquePassCutoff=0,D=T(),j=D.map(ot=>y[ot]));const Le=this._shadowRenderer;if(Le){Le.updateShadowParameters(this.transform,this.style.directionalLight);for(const ot in H)for(const wt of oe[ot]){let Vt={min:0,max:0};this.terrain&&(Vt=this.terrain.getMinMaxForTile(wt)||Vt),Le.addShadowReceiver(wt.toUnwrapped(),Vt.min,Vt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.dw(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new dh(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Be=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Oe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Be&&!this._snow&&(this._snow=new Cp(this)),!Be&&this._snow&&(this._snow.destroy(),delete this._snow),Oe&&!this._rain&&(this._rain=new Ll(this)),!Oe&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!ds.has(this.context.gl))return;this.renderPass="offscreen";for(const ot of j){const wt=t.getLayerSourceCache(ot);if(!ot.hasOffscreenPass()||ot.isHidden(this.transform.zoom))continue;const Vt=wt?de[wt.id]:void 0;(ot.type==="custom"||ot.type==="raster"||ot.type==="raster-particle"||ot.isSky()||Vt&&Vt.length)&&this.renderLayer(this,wt,ot,Vt)}this.depthRangeFor3D=[0,1-(j.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Se)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const He=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Qe=(()=>{if(n.showOverdrawInspector)return r.aj.black;const ot=this.style.fog;if(ot&&this.transform.projection.supportsFog){const wt=this.style.getLut(ot.scope);if(!He){const Vt=ot.properties.get("color-use-theme")==="none",st=ot.properties.get("color").toRenderColor(Vt?null:wt).toArray01();return new r.aj(...st)}if(He){const Vt=ot.properties.get("space-color-use-theme")==="none",st=ot.properties.get("space-color").toRenderColor(Vt?null:wt).toArray01();return new r.aj(...st)}}return r.aj.transparent})();if(this.context.clear({color:Qe,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&He&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=D.length-1;this.currentLayer>=0;this.currentLayer--){const ot=j[this.currentLayer],wt=t.getLayerSourceCache(ot);if(ot.isSky())continue;const Vt=wt?(ot.is3D()?ke:de)[wt.id]:void 0;this._renderTileClippingMasks(ot,wt,Vt),this.renderLayer(this,wt,ot,Vt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&He&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.ae(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<D.length;this.currentLayer++){const ot=j[this.currentLayer],wt=t.getLayerSourceCache(ot);ot.isSky()&&this.renderLayer(this,wt,ot,wt?de[wt.id]:void 0)}function xt(ot,wt){let Vt;return wt&&(Vt=(ot.type==="symbol"?pe:ot.is3D()?ke:de)[wt.id]),Vt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<D.length;){const ot=j[this.currentLayer];if(ot.type==="raster"||ot.type==="raster-particle"){const wt=t.getLayerSourceCache(ot);this.renderLayer(this,wt,ot,xt(ot,wt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ut=0;Le&&(ut=Le.getShadowCastingLayerCount());let It=!1,At=-1;for(let ot=0;ot<D.length;++ot){const wt=j[ot];wt.isHidden(this.transform.zoom)||wt.is3D()&&(At=ot)}for(V&&At===-1&&(F=!0);this.currentLayer<D.length;){const ot=j[this.currentLayer],wt=t.getLayerSourceCache(ot);if(ot.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ot)){if(ot.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(F&&!It&&this.terrain&&!this.transform.isOrthographic&&(It=!0,this.blitDepth()),V&&At!==-1&&this.currentLayer===At+1&&!this.transform.isOrthographic&&this.blitDepth(),ot.is3D()||this.terrain||this._renderTileClippingMasks(ot,wt,wt?oe[wt.id]:void 0),this.renderLayer(this,wt,ot,xt(ot,wt)),!this.terrain&&Le&&ut>0&&ot.hasShadowPass()&&--ut==0&&(Le.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Vt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Vt;this.currentLayer++){const st=j[this.currentLayer];if(!st.hasLightBeamPass())continue;const Dt=t.getLayerSourceCache(st);this.renderLayer(this,Dt,st,Dt?de[Dt.id]:void 0)}this.currentLayer=Vt,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Vt=this.currentLayer;this.depthOcclusion=!0;for(const st of this.layersWithOcclusionOpacity){this.currentLayer=st;const Dt=j[this.currentLayer],bt=t.getLayerSourceCache(Dt),Kt=bt?de[bt.id]:void 0;Dt.is3D()||this.terrain||this._renderTileClippingMasks(Dt,bt,bt?oe[bt.id]:void 0),this.renderLayer(this,bt,Dt,Kt)}this.depthOcclusion=!1,this.currentLayer=Vt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ot=null;j.forEach(wt=>{const Vt=t.getLayerSourceCache(wt);Vt&&!wt.isHidden(this.transform.zoom)&&Vt.getVisibleCoordinates().length&&(!ot||ot.getSource().maxzoom<Vt.getSource().maxzoom)&&(ot=Vt)}),ot&&this.options.showTileBoundaries&&Fo.debug(this,ot,ot.getVisibleCoordinates(),r.aj.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Fo.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.aj(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ot){const wt=ot.transform.padding;vp(ot,ot.transform.height-(wt.top||0),3,_u),vp(ot,wt.bottom||0,3,Gn),xp(ot,wt.left||0,3,$f),xp(ot,ot.transform.width-(wt.right||0),3,Gf);const Vt=ot.transform.centerPoint;(function(st,Dt,bt,Kt){ea(st,Dt-1,bt-10,2,20,Kt),ea(st,Dt-10,bt-1,20,2,Kt)})(ot,Vt.x,ot.transform.height-Vt.y,vc)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Q||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:n}=this.transform.projection,d=!n||!n.includes(t.type);if(bu[t.type]&&(d||this.terrain&&t.type==="custom")){const y=this.style.getLayerSourceCache(t);bu[t.type](t,y,this)}this.gpuTimingEnd()}renderLayer(t,n,d,y){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||y&&y.length)&&(this.id=d.id,this.gpuTimingStart(d),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(d.type)&&(!t.terrain||d.type!=="custom")||d.type==="clip"||Fo[d.type](t,n,d,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery,d=this.context.gl;let y=this.gpuTimers[t.id];y||(y=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:d.createQuery()}),y.calls++,d.beginQuery(n.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,n=this.context.gl,d=n.createQuery();this.deferredRenderGpuTimeQueries.push(d),n.beginQuery(t.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const n={};for(const d in t){const y=t[d],b=this.context.extTimerQuery,T=b.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(y.query),n[d]=T}return n}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const n=this.context.gl;let d=0;for(const y of t)d+=n.getQueryParameter(y,n.QUERY_RESULT)/1e6,n.deleteQuery(y);return d}translatePosMatrix(t,n,d,y,b){if(!d[0]&&!d[1])return t;const T=b?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(T){const V=Math.sin(T),j=Math.cos(T);d=[d[0]*j-d[1]*V,d[0]*V+d[1]*j]}const D=[b?d[0]:r.ar(n,d[0],this.transform.zoom),b?d[1]:r.ar(n,d[1],this.transform.zoom),0],F=new Float32Array(16);return r.ab.mat4.translate(F,t,D),F}saveTileTexture(t){const n=t.size[0],d=this._tileTextures[n];d?d.push(t):this._tileTextures[n]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,n,d){const y=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,b=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||y||n!==void 0&&!n||b.push("FOG","FOG_DITHERING"),y&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(t,n){this.cache=this.cache||{};const d=n&&n.defines||[],y=n&&n.config,b=this.currentGlobalDefines(t,n&&n.overrideFog,n&&n.overrideRtt).concat(d),T=Rf.cacheKey(Ls[t],t,b,y);return this.cache[T]||(this.cache[T]=new Rf(this.context,t,Ls[t],y,oh[t],b)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,n){if(this.style.enable3dLights()){const d=this.style.directionalLight,y=this.style.ambientLight;if(d&&y){const b=((T,D,F)=>{const V=T.properties.get("direction"),j=T.properties.get("color-use-theme")==="none",H=T.properties.get("color").toRenderColor(j?null:F.getLut(T.scope)).toArray01(),W=T.properties.get("intensity"),Q=D.properties.get("color-use-theme")==="none",ce=D.properties.get("color").toRenderColor(Q?null:F.getLut(D.scope)).toArray01(),oe=D.properties.get("intensity"),de=[V.x,V.y,V.z],pe=r.cM(ce,oe),Se=r.cM(H,W);return{u_lighting_ambient_color:pe,u_lighting_directional_dir:de,u_lighting_directional_color:Se,u_ground_radiance:Of(de,Se,pe)}})(d,y,this.style);n.setLightsUniformValues(t,b)}}}uploadCommonUniforms(t,n,d,y,b){if(this.uploadCommonLightUniforms(t,n),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const D=T.getOpacity(this.transform.pitch),F=((V,j,H,W,Q,ce,oe,de,pe,Se,ke,Ie)=>{const Ue=V.transform,Le=j.properties.get("color-use-theme")==="none",Be=j.properties.get("color").toRenderColor(Le?null:V.style.getLut(j.scope)).toArray01();Be[3]=W;const Oe=V.frameCounter/1e3%1,[He,Qe]=j.properties.get("vertical-range");return{u_fog_matrix:H?Ue.calculateFogTileMatrix(H):Ie||V.identityMat,u_fog_range:j.getFovAdjustedRange(Ue._fov),u_fog_color:Be,u_fog_horizon_blend:j.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(He,Qe),Qe],u_fog_temporal_offset:Oe,u_frustum_tl:Q,u_frustum_tr:ce,u_frustum_br:oe,u_frustum_bl:de,u_globe_pos:pe,u_globe_radius:Se,u_viewport:ke,u_globe_transition:r.ae(Ue.zoom),u_is_globe:+(Ue.projection.name==="globe")}})(this,T,d,D,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.q.devicePixelRatio,this.transform.height*r.q.devicePixelRatio],y);n.setFogUniformValues(t,F)}b&&n.setCutoffUniformValues(t,b.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,n=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const y of d)n[y.key]=t[y.key]||new gl(y,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,n){return!(!t.is3D()||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!n||n.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let n=this._cachedTileFogOpacities[t.key];return n||(this._cachedTileFogOpacities[t.key]=n=this.style.fog.getOpacityForTile(t)),n[0]>=je||n[1]>=je}setupDepthForOcclusion(t,n,d){const y=this.context,b=y.gl,T=!!d;var D;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(b.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((D=this.depthRangeFor3D)[1]-D[0]),-1-2*D[0]/(D[1]-D[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),y.activeTexture.set(b.TEXTURE0),T||n.setTerrainUniformValues(y,d)}}function oo(u,t){let n=!1,d=null;const y=()=>{d=null,n&&(u(),d=setTimeout(y,t),n=!1)};return()=>(n=!0,d||y(),d)}class Hf{constructor(t){this._hashName=t&&encodeURIComponent(t),r.aP(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=oo(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const n=Ap(t);if(this._hashName){const d=this._hashName;let y=!1;const b=location.hash.slice(1).split("&").map(T=>{const D=T.split("=")[0];return D===d?(y=!0,`${D}=${n}`):T}).filter(T=>T);return y||b.push(`${d}=${n}`),`#${b.join("&")}`}return`#${n}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let n;return t.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(n=d)}),(n&&n[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const n=this._getCurrentHash();if(n.length>=3&&!n.some(d=>isNaN(d))){const d=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(n[3]||0):t.getBearing();return t.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:d,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ap(u,t){const n=u.getCenter(),d=Math.round(100*u.getZoom())/100,y=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,y),T=Math.round(n.lng*b)/b,D=Math.round(n.lat*b)/b,F=u.getBearing(),V=u.getPitch();let j=t?`/${T}/${D}/${d}`:`${d}/${D}/${T}`;return(F||V)&&(j+="/"+Math.round(10*F)/10),V&&(j+=`/${Math.round(V)}`),j}const gh={linearity:.3,easing:r.dy(0,0,.3,1)},Wf=r.l({deceleration:2500,maxSpeed:1400},gh),md=r.l({deceleration:20,maxSpeed:1400},gh),Pp=r.l({deceleration:1e3,maxSpeed:360},gh),gd=r.l({deceleration:1e3,maxSpeed:90},gh);class qf{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=r.q.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const n={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)n.zoom+=b.zoomDelta||0,n.bearing+=b.bearingDelta||0,n.pitch+=b.pitchDelta||0,b.panDelta&&n.pan._add(b.panDelta),b.around&&(n.around=b.around),b.pinchAround&&(n.pinchAround=b.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(n.pan.mag()){const b=wc(n.pan.mag(),d,r.l({},Wf,t||{}));y.offset=n.pan.mult(b.amount/n.pan.mag()),y.center=this._map.transform.center,bc(y,b)}if(n.zoom){const b=wc(n.zoom,d,md);y.zoom=this._map.transform.zoom+b.amount,bc(y,b)}if(n.bearing){const b=wc(n.bearing,d,Pp);y.bearing=this._map.transform.bearing+r.aw(b.amount,-179,179),bc(y,b)}if(n.pitch){const b=wc(n.pitch,d,gd);y.pitch=this._map.transform.pitch+b.amount,bc(y,b)}if(y.zoom||y.bearing){const b=n.pinchAround===void 0?n.around:n.pinchAround;y.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function bc(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function wc(u,t,n){const{maxSpeed:d,linearity:y,deceleration:b}=n,T=r.aw(u*y/(t/1e3),-d,d),D=Math.abs(T)/(b*y);return{easing:n.easing,duration:1e3*D,amount:T*(D/2)}}class So extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,d,y={}){const b=Tt(n.getCanvasContainer(),d),T=n.unproject(b);super(t,r.l({point:b,lngLat:T,originalEvent:d},y)),this._defaultPrevented=!1,this.target=n}}class wu extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,d){const y=t==="touchend"?d.changedTouches:d.touches,b=qt(n.getCanvasContainer(),y),T=b.map(F=>n.unproject(F)),D=b.reduce((F,V,j,H)=>F.add(V.div(H.length)),new r.P(0,0));super(t,{points:b,point:D,lngLats:T,lngLat:n.unproject(D),originalEvent:d}),this._defaultPrevented=!1}}class Rl extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n){super("wheel",{originalEvent:n}),this._defaultPrevented=!1}}class _h{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Rl(this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new So(t.type,this._map,t))}mouseup(t){this._map.fire(new So(t.type,this._map,t))}preclick(t){const n=r.l({},t);n.type="preclick",this._map.fire(new So(n.type,this._map,n))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(t),this._map.fire(new So(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new So(t.type,this._map,t))}mouseover(t){this._map.fire(new So(t.type,this._map,t))}mouseout(t){this._map.fire(new So(t.type,this._map,t))}touchstart(t){return this._firePreventable(new wu(t.type,this._map,t))}touchmove(t){this._map.fire(new wu(t.type,this._map,t))}touchend(t){this._map.fire(new wu(t.type,this._map,t))}touchcancel(t){this._map.fire(new wu(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yf{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new So(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new So("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new So(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sn{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(tt(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const d=n,y=this._startPos,b=this._lastPos;if(!y||!b||b.equals(d)||!this._box&&d.dist(y)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=Pe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const T=Math.min(y.x,d.x),D=Math.max(y.x,d.x),F=Math.min(y.y,d.y),V=Math.max(y.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${F}px)`,this._box.style.width=D-T+"px",this._box.style.height=V-F+"px")})}mouseupWindow(t,n){if(!this._active)return;const d=this._startPos,y=n;if(d&&t.button===0){if(this.reset(),Ne(),d.x!==y.x||d.y!==y.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:t})),{cameraAnimation:b=>b.fitScreenCoordinates(d,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),at(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new r.z(t,{originalEvent:n}))}}function yh(u,t){const n={};for(let d=0;d<u.length;d++)n[u[d].identifier]=t[d];return n}class Ip{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,n,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=function(y){const b=new r.P(0,0);for(const T of y)b._add(T);return b.div(y.length)}(n),this.touches=yh(d,n)))}touchmove(t,n,d){if(this.aborted||!this.centroid)return;const y=yh(d,n);for(const b in this.touches){const T=y[b];(!T||T.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(t,n,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class vh{constructor(t){this.singleTap=new Ip(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,n,d){this.singleTap.touchstart(t,n,d)}touchmove(t,n,d){this.singleTap.touchmove(t,n,d)}touchend(t,n,d){const y=this.singleTap.touchend(t,n,d);if(y){const b=t.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(y)<30;if(b&&T||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Su{constructor(){this._zoomIn=new vh({numTouches:1,numTaps:2}),this._zoomOut=new vh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,d){this._zoomIn.touchstart(t,n,d),this._zoomOut.touchstart(t,n,d)}touchmove(t,n,d){this._zoomIn.touchmove(t,n,d),this._zoomOut.touchmove(t,n,d)}touchend(t,n,d){const y=this._zoomIn.touchend(t,n,d),b=this._zoomOut.touchend(t,n,d);return y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(y)},{originalEvent:t})}):b?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const _d={0:1,2:2};class ao{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,n){return!1}_move(t,n){return{}}mousedown(t,n){if(this._lastPoint)return;const d=Te(t);this._correctButton(t,d)&&(this._lastPoint=n,this._eventButton=d)}mousemoveWindow(t,n){const d=this._lastPoint;if(d){if(t.preventDefault(),this._eventButton!=null&&function(y,b){const T=_d[b];return y.buttons===void 0||(y.buttons&T)!==T}(t,this._eventButton))this.reset();else if(this._moved||!(n.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(d,n)}}mouseupWindow(t){this._lastPoint&&Te(t)===this._eventButton&&(this._moved&&Ne(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class da extends ao{mousedown(t,n){super.mousedown(t,n),this._lastPoint&&(this._active=!0)}_correctButton(t,n){return n===0&&!t.ctrlKey}_move(t,n){return{around:n,panDelta:n.sub(t)}}}class pa extends ao{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const d=.8*(n.x-t.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(t){t.preventDefault()}}class xh extends ao{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const d=-.5*(n.y-t.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(t){t.preventDefault()}}class Pn{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),r.aP(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(t,n,d){return this._calculateTransform(t,n,d)}touchmove(t,n,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!r.dz())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,n,d)}}touchend(t,n,d){this._calculateTransform(t,n,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,d){d.length>0&&(this._active=!0);const y=yh(d,n),b=new r.P(0,0),T=new r.P(0,0);let D=0;for(const V in y){const j=y[V],H=this._touches[V];H&&(b._add(j),T._add(j.sub(H)),D++,y[V]=j)}if(this._touches=y,D<this._minTouches||!T.mag())return;const F=T.div(D);return this._sum._add(F),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(D),panDelta:F}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Pe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class To{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,n,d){return{}}touchstart(t,n,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,d){const y=this._firstTwoTouches;if(!y)return;t.preventDefault();const[b,T]=y,D=Bo(d,n,b),F=Bo(d,n,T);if(!D||!F)return;const V=this._aroundCenter?null:D.add(F).div(2);return this._move([D,F],V,t)}touchend(t,n,d){if(!this._firstTwoTouches)return;const[y,b]=this._firstTwoTouches,T=Bo(d,n,y),D=Bo(d,n,b);T&&D||(this._active&&Ne(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Bo(u,t,n){for(let d=0;d<u.length;d++)if(u[d].identifier===n)return t[d]}function Sc(u,t){return Math.log(u/t)/Math.LN2}class Ur extends To{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Sc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Sc(this._distance,d),pinchAround:n}}}function Xf(u,t){return 180*u.angleWith(t)/Math.PI}class Tc extends To{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const d=this._vector;if(this._vector=t[0].sub(t[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Xf(this._vector,d),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const y=Xf(t,d);return Math.abs(y)<n}}function Dp(u){return Math.abs(u.y)>Math.abs(u.x)}class Tu extends To{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Dp(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,d){const y=this._lastPoints;if(!y)return;const b=t[0].sub(y[0]),T=t[1].sub(y[1]);return this._map._cooperativeGestures&&!r.dz()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(b,T,d.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(b.y+T.y)/2*-.5})}gestureBeginsVertically(t,n,d){if(this._valid!==void 0)return this._valid;const y=t.mag()>=2,b=n.mag()>=2;if(!y&&!b)return;if(!y||!b)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const T=t.y>0==n.y>0;return Dp(t)&&Dp(n)&&T}}const kp={panStep:100,bearingStep:15,pitchStep:10};class Mu{constructor(){const t=kp;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,d=0,y=0,b=0,T=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),b=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),b=1);break;case 38:t.shiftKey?y=1:(t.preventDefault(),T=-1);break;case 40:t.shiftKey?y=-1:(t.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(d=0,y=0),{cameraAnimation:D=>{const F=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:lo,zoom:n?Math.round(F)+n*(t.shiftKey?2:1):F,bearing:D.getBearing()+d*this._bearingStep,pitch:D.getPitch()+y*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:D.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function lo(u){return u*(2-u)}const el=4.000244140625,In=1/450;class fa{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=In,r.aP(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||r.dz()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=r.q.now(),y=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,n!==0&&n%el==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=n,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(y*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=Tt(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const V=this._type==="wheel"&&Math.abs(this._delta)>el?this._wheelZoomRate:this._defaultZoomRate;let j=2/(1+Math.exp(-Math.abs(this._delta*V)));this._delta<0&&j!==0&&(j=1/j);const H=n(),W=Math.pow(2,H),Q=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):W;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(Q*j))),this._type==="wheel"&&(this._startZoom=H,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:n(),y=this._startZoom,b=this._easing;let T,D=!1;if(this._type==="wheel"&&y&&b){const V=Math.min((r.q.now()-this._lastWheelEventTime)/200,1),j=b(V);T=r.af(y,d,j),V<1?this._frameId||(this._frameId=!0):D=!0}else T=d,D=!0;this._active=!0,D&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let F=T-n();return F*this._lastDelta<0&&(F=0),{noInertia:!0,needsRenderFrame:!D,zoomDelta:F,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=r.dA;if(this._prevEase){const d=this._prevEase,y=(r.q.now()-d.start)/d.duration,b=d.easing(y+.01)-d.easing(y),T=.27/Math.sqrt(b*b+1e-4)*.01,D=Math.sqrt(.0729-T*T);n=r.dy(T,D,.25,1)}return this._prevEase={start:r.q.now(),duration:t,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Pe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class tl{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class zl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,n){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(t.shiftKey?-1:1),around:d.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ma{constructor(){this._tap=new vh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,n,d){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=n[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(t,n,d))}touchmove(t,n,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const y=n[0],b=y.y-this._swipePoint.y;return this._swipePoint=y,t.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(t,n,d)}touchend(t,n,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(t,n,d)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zm{constructor(t,n,d){this._el=t,this._mousePan=n,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Km{constructor(t,n,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Fl{constructor(t,n,d,y){this._el=t,this._touchZoom=n,this._touchRotate=d,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const yd=u=>u.zoom||u.drag||u.pitch||u.rotate;class Zf extends r.z{}class Hn{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const d=r.ab.vec3.sub([],n,t);this.radius=r.ab.vec3.length(d[2]<0?r.ab.vec3.div([],d,this.constants):[d[0],d[1],0])}projectRay(t){r.ab.vec3.div(t,t,this.constants),r.ab.vec3.normalize(t,t),r.ab.vec3.mul(t,t,this.constants);const n=r.ab.vec3.scale([],t,this.radius);if(n[2]>0){const d=r.ab.vec3.scale([],[0,0,1],r.ab.vec3.dot(n,[0,0,1])),y=r.ab.vec3.scale([],r.ab.vec3.normalize([],[n[0],n[1],0]),this.radius),b=r.ab.vec3.add([],n,r.ab.vec3.scale([],r.ab.vec3.sub([],r.ab.vec3.add([],y,d),n),2));n[0]=b[0],n[1]=b[1]}return n}}function il(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class vd{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qf(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Hn,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),r.aP(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,b,T]of this._listeners){const D=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(b,D,T)}}destroy(){for(const[t,n,d]of this._listeners){const y=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(n,y,d)}}_addDefaultHandlers(t){const n=this._map,d=n.getCanvasContainer();this._add("mapEvent",new _h(n,t));const y=n.boxZoom=new Sn(n,t);this._add("boxZoom",y);const b=new Su,T=new zl;n.doubleClickZoom=new tl(T,b),this._add("tapZoom",b),this._add("clickZoom",T);const D=new ma;this._add("tapDragZoom",D);const F=n.touchPitch=new Tu(n);this._add("touchPitch",F);const V=new pa(t),j=new xh(t);n.dragRotate=new Km(t,V,j),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);const H=new da(t),W=new Pn(n,t);n.dragPan=new Zm(d,H,W),this._add("mousePan",H),this._add("touchPan",W,["touchZoom","touchRotate"]);const Q=new Tc,ce=new Ur;n.touchZoomRotate=new Fl(d,ce,Q,D),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",ce,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Yf(n));const oe=n.scrollZoom=new fa(n,this);this._add("scrollZoom",oe,["mousePan"]);const de=n.keyboard=new Mu;this._add("keyboard",de);for(const pe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[pe]&&n[pe].enable(t[pe])}_add(t,n,d){this._handlers.push({handlerName:t,handler:n,allowed:d}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!yd(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,n,d){for(const y in t)if(y!==d&&(!n||n.indexOf(y)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const n=[];for(const d of t)this._el.contains(d.target)&&n.push(d);return n}handleEvent(t,n){this._updatingCamera=!0;const d=t.type==="renderFrame",y=d?void 0:t,b={needsRenderFrame:!1},T={},D={},F=t.touches?this._getMapTouches(t.touches):void 0,V=F?qt(this._el,F):d?void 0:Tt(this._el,t);for(const{handlerName:W,handler:Q,allowed:ce}of this._handlers){if(!Q.isEnabled())continue;let oe;this._blockedByActive(D,ce,W)?Q.reset():Q[n||t.type]&&(oe=Q[n||t.type](t,V,F),this.mergeHandlerResult(b,T,oe,W,y),oe&&oe.needsRenderFrame&&this._triggerRenderFrame()),(oe||Q.isActive())&&(D[W]=Q)}const j={};for(const W in this._previousActiveHandlers)D[W]||(j[W]=y);this._previousActiveHandlers=D,(Object.keys(j).length||il(b))&&(this._changes.push([b,T,j]),this._triggerRenderFrame()),(Object.keys(D).length||il(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=b;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(t,n,d,y,b){if(!d)return;r.l(t,d);const T={handlerName:y,originalEvent:d.originalEvent||b};d.zoomDelta!==void 0&&(n.zoom=T),d.panDelta!==void 0&&(n.drag=T),d.pitchDelta!==void 0&&(n.pitch=T),d.bearingDelta!==void 0&&(n.rotate=T)}_applyChanges(){const t={},n={},d={};for(const[y,b,T]of this._changes)y.panDelta&&(t.panDelta=(t.panDelta||new r.P(0,0))._add(y.panDelta)),y.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(t.around=y.around),y.aroundCoord!==void 0&&(t.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(t.pinchAround=y.pinchAround),y.noInertia&&(t.noInertia=y.noInertia),r.l(n,b),r.l(d,T);this._updateMapTransform(t,n,d),this._changes=[]}_updateMapTransform(t,n,d){const y=this._map,b=y.transform,T=Se=>[Se.x,Se.y,Se.z];if((Se=>{const ke=this._eventsInProgress.drag;return ke&&!this._handlersById[ke.handlerName].isActive()})()&&!il(t)){const Se=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),Se!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&y._stop(!0),!il(t))return void this._fireEvents(n,d,!0);let{panDelta:D,zoomDelta:F,bearingDelta:V,pitchDelta:j,around:H,aroundCoord:W,pinchAround:Q}=t;b._isCameraConstrained&&(F>0&&(F=0),b._isCameraConstrained=!1),Q!==void 0&&(H=Q),(F||(Se=>n[Se]&&!this._eventsInProgress[Se])("drag"))&&H&&(this._dragOrigin=T(b.pointCoordinate3D(H)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",y._stop(!0),H=H||y.transform.centerPoint,V&&(b.bearing+=V),j&&(b.pitch+=j),b._updateCameraState();const ce=[0,0,0];if(D)if(b.projection.name==="mercator"){const Se=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(H).dir),ke=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(H.sub(D)).dir);ce[0]=ke[0]-Se[0],ce[1]=ke[1]-Se[1]}else{const Se=b.pointCoordinate(H);if(b.projection.name==="globe"){D=D.rotate(-b.angle);const ke=b._pixelsPerMercatorPixel/b.worldSize;ce[0]=-D.x*r.dB(r.aS(Se.y))*ke,ce[1]=-D.y*r.dB(b.center.lat)*ke}else{const ke=b.pointCoordinate(H.sub(D));Se&&ke&&(ce[0]=ke.x-Se.x,ce[1]=ke.y-Se.y)}}const oe=b.zoom,de=[0,0,0];if(F){const Se=T(W||b.pointCoordinate3D(H)),ke={dir:r.ab.vec3.normalize([],r.ab.vec3.sub([],Se,b._camera.position))};if(ke.dir[2]<0){const Ie=b.zoomDeltaToMovement(Se,F);r.ab.vec3.scale(de,ke.dir,Ie)}}const pe=r.ab.vec3.add(ce,ce,de);b._translateCameraConstrained(pe),F&&Math.abs(b.zoom-oe)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,d,!0)}_fireEvents(t,n,d){const y=yd(this._eventsInProgress),b=yd(t),T={};for(const j in t){const{originalEvent:H}=t[j];this._eventsInProgress[j]||(T[`${j}start`]=H),this._eventsInProgress[j]=t[j]}!y&&b&&this._fireEvent("movestart",b.originalEvent);for(const j in T)this._fireEvent(j,T[j]);b&&this._fireEvent("move",b.originalEvent);for(const j in t){const{originalEvent:H}=t[j];this._fireEvent(j,H)}const D={};let F;for(const j in this._eventsInProgress){const{handlerName:H,originalEvent:W}=this._eventsInProgress[j];this._handlersById[H].isActive()||(delete this._eventsInProgress[j],F=n[H]||W,D[`${j}end`]=F)}for(const j in D)this._fireEvent(j,D[j]);const V=yd(this._eventsInProgress);if(d&&(y||b)&&!V){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=W=>W!==0&&-this._bearingSnap<W&&W<this._bearingSnap;j?(H(j.bearing||this._map.getBearing())&&(j.bearing=0),this._map.easeTo(j,{originalEvent:F})):(this._map.fire(new r.z("moveend",{originalEvent:F})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new r.z(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Zf("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const xd="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Eu extends r.E{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=n.respectPrefersReducedMotion!==!1,r.aP(["_renderFrameCallback"],this)}getCenter(){return new r.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,d){return t=r.P.convert(t).mult(-1),this.panTo(this.transform.center,r.l({offset:t},n),d)}panTo(t,n,d){return this.easeTo(r.l({center:t},n),d)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,d){return this.easeTo(r.l({zoom:t},n),d)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,d){return this.easeTo(r.l({bearing:t},n),d)}resetNorth(t,n){return this.rotateTo(0,r.l({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(r.l({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=r.az.convert(t);const d=n&&n.bearing||0,y=n&&n.pitch||0,b=t.getNorthWest(),T=t.getSouthEast();return this._cameraForBounds(this.transform,b,T,d,y,n)}_extendPadding(t){const n={top:0,right:0,bottom:0,left:0};return t==null?r.l({},n,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:r.l({},n,t)}_extendCameraOptions(t){return(t=r.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,n){const d=n.max[0]-n.min[0],y=n.max[1]-n.min[1];return d/y>t.aspect?d/(2*Math.tan(.5*t.fovX)*t.aspect):y/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,n,d,y,b,T){const D=t.clone(),F=this._extendCameraOptions(T);D.bearing=y,D.pitch=b;const V=r.bO.convert(n),j=r.bO.convert(d),H=.5*(V.lat+j.lat),W=.5*(V.lng+j.lng),Q=r.dC(H,W),ce=r.ab.vec3.normalize([],Q),oe=r.ab.vec3.normalize([],r.ab.vec3.cross([],ce,[0,1,0])),de=r.ab.vec3.cross([],oe,ce),pe=[oe[0],oe[1],oe[2],0,de[0],de[1],de[2],0,ce[0],ce[1],ce[2],0,0,0,0,1],Se=[Q,r.dC(V.lat,V.lng),r.dC(j.lat,V.lng),r.dC(j.lat,j.lng),r.dC(V.lat,j.lng),r.dC(H,V.lng),r.dC(H,j.lng),r.dC(V.lat,W),r.dC(j.lat,W)];let ke=r.cd.fromPoints(Se.map(bt=>[r.ab.vec3.dot(oe,bt),r.ab.vec3.dot(de,bt),r.ab.vec3.dot(ce,bt)]));const Ie=r.ab.vec3.transformMat4([],ke.center,pe);r.ab.vec3.squaredLength(Ie)===0&&r.ab.vec3.set(Ie,0,0,1),r.ab.vec3.normalize(Ie,Ie),r.ab.vec3.scale(Ie,Ie,r.ax),D.center=r.dD(Ie);const Ue=D.getWorldToCameraMatrix(),Le=r.ab.mat4.invert(new Float64Array(16),Ue);ke=r.cd.applyTransform(ke,r.ab.mat4.multiply([],Ue,pe));const Be=this._extendAABB(ke,D,F,y);if(!Be)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ke=Be,r.ab.vec3.transformMat4(Ie,Ie,Ue);const Oe=.5*(ke.max[2]-ke.min[2]),He=this._minimumAABBFrustumDistance(D,ke),Qe=r.ab.vec3.scale([],[0,0,1],Oe),xt=r.ab.vec3.add(Qe,Ie,Qe),ut=He+(D.pitch===0?0:r.ab.vec3.distance(Ie,xt)),It=D.globeCenterInViewSpace,At=r.ab.vec3.sub([],Ie,[It[0],It[1],It[2]]);r.ab.vec3.normalize(At,At),r.ab.vec3.scale(At,At,ut);const ot=r.ab.vec3.add([],Ie,At);r.ab.vec3.transformMat4(ot,ot,Le);const wt=r.ds/r.ax,Vt=r.ab.vec3.length(ot),st=r.bH(Math.max(Vt*wt-r.ds,Number.EPSILON),0),Dt=Math.min(D.zoomFromMercatorZAdjusted(st),F.maxZoom);return Dt>.5*(r.c6+r.bY)?(D.setProjection({name:"mercator"}),D.zoom=Dt,this._cameraForBounds(D,n,d,y,b,T)):{center:D.center,zoom:Dt,bearing:y,pitch:b}}_extendAABB(t,n,d,y){const b=.5*((d.padding.left||0)+(d.padding.right||0)),T=.5*((d.padding.top||0)+(d.padding.bottom||0)),D=T,F=b,V=b,j=T,H=n.width-(F+V),W=n.height-(D+j),Q=r.ab.vec3.sub([],t.max,t.min),ce=Math.min(H/Q[0],W/Q[1]),oe=Math.min(n.scaleZoom(n.scale*ce),d.maxZoom);if(isNaN(oe))return null;const de=n.scale/n.zoomScale(oe),pe=new r.cd([t.min[0]-F*de,t.min[1]-j*de,t.min[2]],[t.max[0]+V*de,t.max[1]+D*de,t.max[2]]),Se=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new r.P(d.offset.x,d.offset.y):r.P.convert(d.offset)).rotate(-r.ai(y));return pe.center[0]-=Se.x*de,pe.center[1]+=Se.y*de,pe}queryTerrainElevation(t,n){const d=this.transform.elevation;return d?(n=r.l({},{exaggerated:!0},n),d.getAtPoint(r.aa.fromLngLat(t),null,n.exaggerated)):null}_cameraForBounds(t,n,d,y,b,T){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,n,d,y,b,T);const D=t.clone(),F=this._extendCameraOptions(T);D.bearing=y,D.pitch=b;const V=r.bO.convert(n),j=r.bO.convert(d),H=new r.bO(V.lng,j.lat),W=new r.bO(j.lng,V.lat),Q=D.project(V),ce=D.project(j),oe=this.queryTerrainElevation(V),de=this.queryTerrainElevation(j),pe=this.queryTerrainElevation(H),Se=this.queryTerrainElevation(W),ke=[[Q.x,Q.y,Math.min(oe||0,de||0,pe||0,Se||0)],[ce.x,ce.y,Math.max(oe||0,de||0,pe||0,Se||0)]];let Ie=r.cd.fromPoints(ke);const Ue=D.getWorldToCameraMatrix(),Le=r.ab.mat4.invert(new Float64Array(16),Ue);Ie=r.cd.applyTransform(Ie,Ue);const Be=this._extendAABB(Ie,D,F,y);if(!Be)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ie=Be;const Oe=.5*r.ab.vec3.sub([],Ie.max,Ie.min)[2],He=this._minimumAABBFrustumDistance(D,Ie),Qe=[0,0,1,0];r.ab.vec4.transformMat4(Qe,Qe,Ue),r.ab.vec4.normalize(Qe,Qe);const xt=r.ab.vec3.scale([],Qe,He+Oe),ut=r.ab.vec3.add([],Ie.center,xt);r.ab.vec3.transformMat4(Ie.center,Ie.center,Le),r.ab.vec3.transformMat4(ut,ut,Le);const It=D.unproject(new r.P(Ie.center[0],Ie.center[1])),At=r.dE(D.projection,It),ot=Math.pow(2,At),wt=Math.min(D._zoomFromMercatorZ(ut[2]*D.pixelsPerMeter*ot/D.worldSize),F.maxZoom);return D.mercatorFromTransition&&wt<.5*(r.c6+r.bY)?(D.setProjection({name:"globe"}),D.zoom=wt,this._cameraForBounds(D,n,d,y,b,T)):{center:It,zoom:wt,bearing:y,pitch:b}}fitBounds(t,n,d){const y=this.cameraForBounds(t,n);return this._fitInternal(y,n,d)}fitScreenCoordinates(t,n,d,y,b){const T=r.P.convert(t),D=r.P.convert(n),F=new r.P(Math.min(T.x,D.x),Math.min(T.y,D.y)),V=new r.P(Math.max(T.x,D.x),Math.max(T.y,D.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,D))return this;const j=this.transform.pointLocation3D(F),H=this.transform.pointLocation3D(V),W=this.transform.pointLocation3D(new r.P(F.x,V.y)),Q=this.transform.pointLocation3D(new r.P(V.x,F.y)),ce=[Math.min(j.lng,H.lng,W.lng,Q.lng),Math.min(j.lat,H.lat,W.lat,Q.lat)],oe=[Math.max(j.lng,H.lng,W.lng,Q.lng),Math.max(j.lat,H.lat,W.lat,Q.lat)],de=y&&y.pitch?y.pitch:this.getPitch(),pe=this._cameraForBounds(this.transform,ce,oe,d,de,y);return this._fitInternal(pe,y,b)}_fitInternal(t,n,d){return t?(n=r.l(t,n)).linear?this.easeTo(n,d):this.flyTo(n,d):this}jumpTo(t,n){this.stop();const d=t.preloadOnly?this.transform.clone():this.transform;let y=!1,b=!1,T=!1;"zoom"in t&&d.zoom!==+t.zoom&&(y=!0,d.zoom=+t.zoom),t.center!==void 0&&(d.center=r.bO.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(b=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(T=!0,d.pitch=+t.pitch);const D=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!d.isPaddingEqual(D))if(t.retainPadding===!1){const F=d.clone();F.padding=D,d.setLocationAtPoint(d.center,F.centerPoint)}else d.padding=D;return t.preloadOnly?(this._preloadTiles(d),this):(this.fire(new r.z("movestart",n)).fire(new r.z("move",n)),y&&this.fire(new r.z("zoomstart",n)).fire(new r.z("zoom",n)).fire(new r.z("zoomend",n)),b&&this.fire(new r.z("rotatestart",n)).fire(new r.z("rotate",n)).fire(new r.z("rotateend",n)),T&&this.fire(new r.z("pitchstart",n)).fire(new r.z("pitch",n)).fire(new r.z("pitchend",n)),this.fire(new r.z("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(xd),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){const d=this.transform;if(!d.projection.supportsFreeCamera)return r.w(xd),this;this.stop();const y=d.zoom,b=d.pitch,T=d.bearing;d.setFreeCameraOptions(t);const D=y!==d.zoom,F=b!==d.pitch,V=T!==d.bearing;return this.fire(new r.z("movestart",n)).fire(new r.z("move",n)),D&&this.fire(new r.z("zoomstart",n)).fire(new r.z("zoom",n)).fire(new r.z("zoomend",n)),V&&this.fire(new r.z("rotatestart",n)).fire(new r.z("rotate",n)).fire(new r.z("rotateend",n)),F&&this.fire(new r.z("pitchstart",n)).fire(new r.z("pitch",n)).fire(new r.z("pitchend",n)),this.fire(new r.z("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),((t=r.l({offset:[0,0],duration:500,easing:r.dA},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const d=this.transform,y=this.getZoom(),b=this.getBearing(),T=this.getPitch(),D=this.getPadding(),F="zoom"in t?+t.zoom:y,V="bearing"in t?this._normalizeBearing(t.bearing,b):b,j="pitch"in t?+t.pitch:T,H=this._extendPadding(t.padding),W=r.P.convert(t.offset);let Q,ce,oe;if(d.projection.name==="globe"){const Qe=r.aa.fromLngLat(d.center),xt=W.rotate(-d.angle);Qe.x+=xt.x/d.worldSize,Qe.y+=xt.y/d.worldSize;const ut=Qe.toLngLat(),It=r.bO.convert(t.center||ut);this._normalizeCenter(It),Q=d.centerPoint.add(xt),ce=new r.P(Qe.x,Qe.y).mult(d.worldSize),oe=new r.P(r.at(It.lng),r.aA(It.lat)).mult(d.worldSize).sub(ce)}else{Q=d.centerPoint.add(W);const Qe=d.pointLocation(Q),xt=r.bO.convert(t.center||Qe);this._normalizeCenter(xt),ce=d.project(Qe),oe=d.project(xt).sub(ce)}const de=d.zoomScale(F-y);let pe,Se;t.around&&(pe=r.bO.convert(t.around),Se=d.locationPoint(pe));const ke=this._zooming||F!==y,Ie=this._rotating||b!==V,Ue=this._pitching||j!==T,Le=!d.isPaddingEqual(H),Be=t.retainPadding===!1?d.clone():d,Oe=Qe=>xt=>{if(ke&&(Qe.zoom=r.af(y,F,xt)),Ie&&(Qe.bearing=r.af(b,V,xt)),Ue&&(Qe.pitch=r.af(T,j,xt)),Le&&(Be.interpolatePadding(D,H,xt),Q=Be.centerPoint.add(W)),pe)Qe.setLocationAtPoint(pe,Se);else{const ut=Qe.zoomScale(Qe.zoom-y),It=F>y?Math.min(2,de):Math.max(.5,de),At=Math.pow(It,1-xt),ot=Qe.unproject(ce.add(oe.mult(xt*At)).mult(ut));Qe.setLocationAtPoint(Qe.renderWorldCopies?ot.wrap():ot,Q)}return t.preloadOnly||this._fireMoveEvents(n),Qe};if(t.preloadOnly){const Qe=this._emulate(Oe,t.duration,d);return this._preloadTiles(Qe),this}const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ke,this._rotating=Ie,this._pitching=Ue,this._padding=Le,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,He),this._ease(Oe(d),Qe=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(n,Qe)},t),this}_prepareEase(t,n,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),n||d.moving||this.fire(new r.z("movestart",t)),this._zooming&&!d.zooming&&this.fire(new r.z("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new r.z("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new r.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new r.z("move",t)),this._zooming&&this.fire(new r.z("zoom",t)),this._rotating&&this.fire(new r.z("rotate",t)),this._pitching&&this.fire(new r.z("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,y=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new r.z("zoomend",t)),y&&this.fire(new r.z("rotateend",t)),b&&this.fire(new r.z("pitchend",t)),this.fire(new r.z("moveend",t))}flyTo(t,n){if(this._prefersReducedMotion(t)){const bt=r.ay(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(bt,n)}this.stop(),t=r.l({offset:[0,0],speed:1.2,curve:1.42,easing:r.dA},t);const d=this.transform,y=this.getZoom(),b=this.getBearing(),T=this.getPitch(),D=this.getPadding(),F="zoom"in t?r.aw(+t.zoom,d.minZoom,d.maxZoom):y,V="bearing"in t?this._normalizeBearing(t.bearing,b):b,j="pitch"in t?+t.pitch:T,H=this._extendPadding(t.padding),W=d.zoomScale(F-y),Q=r.P.convert(t.offset);let ce=d.centerPoint.add(Q);const oe=d.pointLocation(ce),de=r.bO.convert(t.center||oe);this._normalizeCenter(de);const pe=d.project(oe),Se=d.project(de).sub(pe);let ke=t.curve;const Ie=Math.max(d.width,d.height),Ue=Ie/W,Le=Se.mag();if("minZoom"in t){const bt=r.aw(Math.min(t.minZoom,y,F),d.minZoom,d.maxZoom),Kt=Ie/d.zoomScale(bt-y);ke=Math.sqrt(Kt/Le*2)}const Be=ke*ke;function Oe(bt){const Kt=(Ue*Ue-Ie*Ie+(bt?-1:1)*Be*Be*Le*Le)/(2*(bt?Ue:Ie)*Be*Le);return Math.log(Math.sqrt(Kt*Kt+1)-Kt)}function He(bt){return(Math.exp(bt)-Math.exp(-bt))/2}function Qe(bt){return(Math.exp(bt)+Math.exp(-bt))/2}const xt=Oe(0);let ut=function(bt){return Qe(xt)/Qe(xt+ke*bt)},It=function(bt){return Ie*((Qe(xt)*(He(Kt=xt+ke*bt)/Qe(Kt))-He(xt))/Be)/Le;var Kt},At=(Oe(1)-xt)/ke;if(Math.abs(Le)<1e-6||!isFinite(At)){if(Math.abs(Ie-Ue)<1e-6)return this.easeTo(t,n);const bt=Ue<Ie?-1:1;At=Math.abs(Math.log(Ue/Ie))/ke,It=function(){return 0},ut=function(Kt){return Math.exp(bt*ke*Kt)}}t.duration="duration"in t?+t.duration:1e3*At/("screenSpeed"in t?+t.screenSpeed/ke:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const ot=b!==V,wt=j!==T,Vt=!d.isPaddingEqual(H),st=t.retainPadding===!1?d.clone():d,Dt=bt=>Kt=>{const Bt=Kt*At,kt=1/ut(Bt);bt.zoom=Kt===1?F:y+bt.scaleZoom(kt),ot&&(bt.bearing=r.af(b,V,Kt)),wt&&(bt.pitch=r.af(T,j,Kt)),Vt&&(st.interpolatePadding(D,H,Kt),ce=st.centerPoint.add(Q));const $t=Kt===1?de:bt.unproject(pe.add(Se.mult(It(Bt))).mult(kt));return bt.setLocationAtPoint(bt.renderWorldCopies?$t.wrap():$t,ce),bt._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(n),bt};if(t.preloadOnly){const bt=this._emulate(Dt,t.duration,d);return this._preloadTiles(bt),this}return this._zooming=!0,this._rotating=ot,this._pitching=wt,this._padding=Vt,this._prepareEase(n,!1),this._ease(Dt(d),()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,n)}if(!t){const d=this.handlers;d&&d.stop(!1)}return this}_ease(t,n,d){d.animate===!1||d.duration===0?(t(1),n()):(this._easeStart=r.q.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((r.q.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=r.bF(t,-180,180);const d=Math.abs(t-n);return Math.abs(t-360-n)<d&&(t-=360),Math.abs(t+360-n)<d&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(n.maxBounds||n.projection.name!=="globe"&&!n.renderWorldCopies)return;const d=t.lng-n.center.lng;t.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&r.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,n,d){const y=Math.ceil(15*n/1e3),b=[],T=t(d.clone());for(let D=0;D<=y;D++){const F=T(D/y);b.push(F.clone())}return b}_preloadTiles(t,n){}}class bh{constructor(t={}){this.options=t,r.aP(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const n=this.options&&this.options.compact,d=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Pe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Pe("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);const y=Pe("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",d),this._innerContainer=Pe("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),n===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(t){const d=n.reduce((y,b,T)=>(b.value&&(y+=`${b.key}=${b.value}${T<n.length-1?"&":""}`),y),"?");t.href=`${r.e.FEEDBACK_URL}/${d}#${Ap(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const n=this._map.style._mergedSourceCaches;for(const y in n){const b=n[y];if(b.used){const T=b.getSource();T.attribution&&t.indexOf(T.attribution)<0&&t.push(T.attribution)}}t.sort((y,b)=>y.length-b.length),t=t.filter((y,b)=>{for(let T=b+1;T<t.length;T++)if(t[T].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const d=t.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Mo{constructor(){r.aP(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Pe("div","mapboxgl-ctrl");const n=Pe("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const n in t){const d=t[n].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const n=t[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class No{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,d=n?this._queue.concat(n):this._queue;for(const y of d)if(y.id===t)return void(y.cancelled=!0)}run(t=0){const n=this._currentlyRunning=this._queue;this._queue=[];for(const d of n)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Mc{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=r.cB((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,n,d){this._start=this.getValue(n),this._end=t,this._startTime=n,this._endTime=n+d}}const ga={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Ec extends r.z{constructor(t,n,d,y){const{point:b,lngLat:T,originalEvent:D,target:F}=t;super(t.type,{point:b,lngLat:T,originalEvent:D,target:F}),this.preventDefault=()=>{t.preventDefault()},this.id=n,this.interaction=d,this.feature=y}}class Op{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,n){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const d=n.filter;let y=n.type;d&&this.filters.set(t,r.aZ(d)),y==="mouseover"&&(y="mouseenter"),y==="mouseout"&&(y="mouseleave");const b=this.interactionsByType.get(y)||new Map;y==="mouseenter"||y==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,n)):b.size===0&&this.map.on(y,this.handleType),b.size===0&&this.interactionsByType.set(y,b),b.set(t,n),this.typeById.set(t,y)}get(t){const n=this.typeById.get(t);if(!n)return;const d=this.interactionsByType.get(n);return d?d.get(t):void 0}remove(t){const n=this.typeById.get(t);if(!n)return;this.typeById.delete(t),this.filters.delete(t);const d=this.interactionsByType.get(n);d&&(d.delete(t),n==="mouseenter"||n==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):d.size===0&&this.map.off(n,this.handleType))}queryTargets(t,n){const d=[];for(const[y,b]of n)b.target&&d.push({targetId:y,target:b.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(t,d,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const n=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());n.length&&(t.type="mouseenter",this.handleType(t,n));const d=new Map;for(const[y,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(y)||d.set(b.id,b);d.size&&(t.type="mouseleave",this.handleType(t,Array.from(d.values())))}handleOut(t){const n=Array.from(this.hoveredFeatures.values()).map(({feature:d})=>d);n.length&&(t.type="mouseleave",this.handleType(t,n)),this.hoveredFeatures.clear()}handleType(t,n){const d=Array.from(this.interactionsByType.get(t.type)).reverse(),y=!!n;n=n||this.queryTargets(t.point,d);const b=t.type==="mouseenter";let T=!1;const D=new Set;for(const F of n){for(const[V,j]of d){if(!j.target)continue;const H=F.variants?F.variants[V]:null;if(H){for(const W of H){if(Wo(W,F,D,V))continue;const Q=new r.cw(F,W),ce=Gc(W,F,V);y&&(Q.state=this.map.getFeatureState(Q));const oe=b?this.prevHoveredFeatures.get(ce):null,de=new Ec(t,V,j,Q),pe=oe?oe.stop:j.handler(de);if(b&&this.hoveredFeatures.set(ce,{feature:F,stop:pe}),pe!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[F,V]of d){const{handler:j,target:H}=V;if(!H&&j(new Ec(t,F,V,null))!==!1)break}}}function Er(u,t){if(Array.isArray(u)&&Array.isArray(t)){const n=new Set(u),d=new Set(t);return n.size===d.size&&u.every(y=>d.has(y))}return r.bn(u,t)}const rl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Lp={showCompass:!0,showZoom:!0,visualizePitch:!1};class Rp{constructor(t,n,d=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new pa({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,d&&(this.mousePitch=new xh({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),r.aP(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(t,n){this.mouseRotate.mousedown(t,n),this.mousePitch&&this.mousePitch.mousedown(t,n),tt()}move(t,n){const d=this.map,y=this.mouseRotate.mousemoveWindow(t,n),b=y&&y.bearingDelta;if(b&&d.setBearing(d.getBearing()+b),this.mousePitch){const T=this.mousePitch.mousemoveWindow(t,n),D=T&&T.pitchDelta;D&&d.setPitch(d.getPitch()+D)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){at(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(r.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Tt(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Tt(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=qt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=qt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Bl(u,t,n){if(u=new r.bO(u.lng,u.lat),t){const d=new r.bO(u.lng-360,u.lat),y=new r.bO(u.lng+360,u.lat),b=360*Math.ceil(Math.abs(u.lng-n.center.lng)/360),T=n.locationPoint(u).distSqr(t),D=t.x<0||t.y<0||t.x>n.width||t.y>n.height;n.locationPoint(d).distSqr(t)<T&&(D||Math.abs(d.lng-n.center.lng)<b)?u=d:n.locationPoint(y).distSqr(t)<T&&(D||Math.abs(y.lng-n.center.lng)<b)&&(u=y)}for(;Math.abs(u.lng-n.center.lng)>180;){const d=n.locationPoint(u);if(d.x>=0&&d.y>=0&&d.x<=n.width&&d.y<=n.height)break;u.lng>n.center.lng?u.lng-=360:u.lng+=360}return u}const _a={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ya extends r.E{constructor(t,n){if(super(),(t instanceof HTMLElement||n)&&(t=r.l({element:t},n)),r.aP(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=r.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Pe("div");const b=41,T=27,D=Ve("svg",{display:"block",height:b*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${b}`},this._element),F=Ve("radialGradient",{id:"shadowGradient"},Ve("defs",{},D));Ve("stop",{offset:"10%","stop-opacity":.4},F),Ve("stop",{offset:"100%","stop-opacity":.05},F),Ve("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},D),Ve("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},D),Ve("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},D),Ve("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},D),this._offset=r.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const d=this._element.classList;for(const b in _a)d.remove(`mapboxgl-marker-anchor-${b}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`);const y=t&&t.className?t.className.trim().split(/\s+/):[];d.add(...y),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=r.bO.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const n=t.code,d=t.charCode||t.keyCode;n!=="Space"&&n!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(t){const n=t.originalEvent.target,d=this._element;this._popup&&(n===d||d.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,n=this._pos;if(!t||!n)return!1;const d=t.unproject(n),y=t.getFreeCameraOptions();if(!y.position)return!1;const b=y.position.toLngLat();return b.distanceTo(d)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const n=this._pos;if(!n||n.x<0||n.x>t.transform.width||n.y<0||n.y>t.transform.height)return void this._clearFadeTimer();const d=t.unproject(n);let y;t._showingGlobe()&&r.dH(t.transform,this._lngLat)?y=0:(y=1-t._queryFogOpacity(d),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const n=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${_a[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${n.x}px,${n.y}px)
        `}_calculateXYTransform(){const t=this._pos,n=this._map,d=this.getPitchAlignment();if(!n||!t||d!=="map")return"";if(!n._showingGlobe()){const F=n.getPitch();return F?`rotateX(${F}deg)`:""}const y=r.c4(r.dI(n.transform,this._lngLat)),b=t.sub(r.dJ(n.transform)),T=Math.abs(b.x)+Math.abs(b.y);if(T===0)return"";const D=y/T;return`rotateX(${-b.y*D}deg) rotateY(${b.x*D}deg)`}_calculateZTransform(){const t=this._pos,n=this._map;if(!n||!t)return"";let d=0;const y=this.getRotationAlignment();if(y==="map")if(n._showingGlobe()){const b=n.project(new r.bO(this._lngLat.lng,this._lngLat.lat+.001)),T=n.project(new r.bO(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);d=r.c4(Math.atan2(T.y,T.x))-90}else d=-n.getBearing();else if(y==="horizon"){const b=r.ac(4,6,n.getZoom()),T=r.dJ(n.transform);T.y+=b*n.transform.height;const D=t.sub(T),F=r.c4(Math.atan2(D.y,D.x));d=(F>90?F-270:F+90)*(1-b)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=Bl(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=r.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const n=this._map;if(!n)return;const d=this._pointerdownPos,y=this._positionDelta;if(d&&y){if(!this._isDragging){const b=this._clickTolerance||n._clickTolerance;if(t.point.dist(d)<b)return;this._isDragging=!0}this._pos=t.point.sub(y),this._lngLat=n.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(t){const n=this._map,d=this._pos;n&&d&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(d),this._pointerdownPos=t.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const n=this._map;return n&&(t?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const to={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},co={maxWidth:100,unit:"metric"},Wn={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},zp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},uo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Fp(u=new r.P(0,0),t="bottom"){if(typeof u=="number"){const n=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(t){case"top":return new r.P(0,u);case"top-left":return new r.P(n,n);case"top-right":return new r.P(-n,n);case"bottom":return new r.P(0,-u);case"bottom-left":return new r.P(n,-n);case"bottom-right":return new r.P(-n,-n);case"left":return new r.P(u,0);case"right":return new r.P(-u,0)}return new r.P(0,0)}return u instanceof r.P||Array.isArray(u)?r.P.convert(u):r.P.convert(u[t]||[0,0])}return{version:q,supported:we.supported,setRTLTextPlugin:r.dK,getRTLTextPluginStatus:r.dL,Map:class extends Eu{constructor(u){ae.mark(ie.create);const t=u;if((u=r.l({},rl,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&r.dF(window)&&(u.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new za(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),u),this._repaint=!!u.repaint,this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new No,this._domRenderTaskQueue=new No,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.aV(),this._locale=r.l({},ga,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._tessellationStep=u.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=u.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Mc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=u.scaleFactor,this._requestManager=new ni(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,this._contextCreateOptions=u.contextCreateOptions?Object.assign({},u.contextCreateOptions):{},typeof u.container=="string"){const n=document.getElementById(u.container);if(!n)throw new Error(`Container '${u.container.toString()}' not found.`);this._container=n}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),this._spriteFormat=u.spriteFormat,r.aP(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Tp),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new vd(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,(u.style||!u.testMode)&&this.setStyle(u.style||r.e.DEFAULT_STYLE,{config:u.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),this.indoor=new op(this),u.hash&&(this._hash=new Hf(typeof u.hash=="string"&&u.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch});const n=u.bounds;n&&(this.resize(),this.fitBounds(n,r.l({},u.fitBoundsOptions,{duration:0})))}this.resize(),u.attributionControl&&this.addControl(new bh({customAttribution:u.customAttribution})),this._logoControl=new Mo,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new r.z(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new r.z(`${n.dataType}dataloading`,n))}),this._interactions=new Op(this)}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=u.onAdd(this);this._controls.push(u);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(n,d.firstChild):d.appendChild(n),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new r.z("movestart",u)).fire(new r.z("move",u)),this.fire(new r.z("resize",u)),t&&this.fire(new r.z("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(r.az.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(u){return this._scaleFactor=u,this.painter.scaleFactor=u,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(t=>t==="auto"?navigator.language:t):u}setLanguage(u){const t=this._parseLanguage(u);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const u=this.transform,t=u.projection.name;let n;t==="globe"&&u.zoom>=r.bY?(u.setMercatorFromTransition(),n=!0):t==="mercator"&&u.zoom<r.bY&&(u.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(u,t){return this._updateProjection(u||t||{name:"mercator"})}_updateProjection(u){let t;return t=u.name==="globe"&&this.transform.zoom>=r.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(u){return this.transform.locationPoint3D(r.bO.convert(u))}unproject(u){return this.transform.pointLocation3D(r.P.convert(u))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,t,n){const d=y=>{let b=[];if(Array.isArray(t)){const T=t.filter(D=>this.getLayer(D));b=T.length?this.queryRenderedFeatures(y,{layers:T}):[]}else b=this.queryRenderedFeatures(y,{target:t});return b};if(u==="mouseenter"||u==="mouseover"){let y=!1;return{listener:n,targets:t,delegates:{mousemove:T=>{const D=d(T.point);D.length?y||(y=!0,n.call(this,new So(u,this,T.originalEvent,{features:D}))):y=!1},mouseout:()=>{y=!1}}}}if(u==="mouseleave"||u==="mouseout"){let y=!1;return{listener:n,targets:t,delegates:{mousemove:D=>{d(D.point).length?y=!0:y&&(y=!1,n.call(this,new So(u,this,D.originalEvent)))},mouseout:D=>{y&&(y=!1,n.call(this,new So(u,this,D.originalEvent)))}}}}{const y=b=>{const T=d(b.point);T.length&&(b.features=T,n.call(this,b),delete b.features)};return{listener:n,targets:t,delegates:{[u]:y}}}}on(u,t,n){if(typeof t=="function"||n===void 0)return super.on(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(u,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(d);for(const y in d.delegates)this.on(y,d.delegates[y]);return this}once(u,t,n){if(typeof t=="function"||n===void 0)return super.once(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(u,t,n);for(const y in d.delegates)this.once(y,d.delegates[y]);return this}off(u,t,n){if(typeof t=="function"||n===void 0)return super.off(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._delegatedListeners?this._delegatedListeners[u]:void 0;return d&&(y=>{for(let b=0;b<y.length;b++){const T=y[b];if(T.listener===n&&Er(T.targets,t)){for(const D in T.delegates)this.off(D,T.delegates[D]);return y.splice(b,1),this}}})(d),this}queryRenderedFeatures(u,t){if(!this.style)return[];if(u===void 0||u instanceof r.P||Array.isArray(u)||t!==void 0||(t=u,u=void 0),u=u||[[0,0],[this.transform.width,this.transform.height]],!t){const b=this.style.queryRenderedFeatures(u,void 0,this.transform),T=this.style.queryRenderedFeatureset(u,void 0,this.transform);return b.concat(T)}let n=!0;if(t.target&&(n=this._isTargetValid(t.target),n&&!t.layers))return this.style.queryRenderedFeatureset(u,t,this.transform);let d=!0;if(t.layers&&Array.isArray(t.layers)){for(const b of t.layers)if(!this._isValidId(b)){d=!1;break}if(d&&!t.target)return this.style.queryRenderedFeatures(u,t,this.transform)}let y=[];return d&&(y=y.concat(this.style.queryRenderedFeatures(u,t,this.transform))),n&&(y=y.concat(this.style.queryRenderedFeatureset(u,t,this.transform))),y}querySourceFeatures(u,t){return!u||typeof u=="string"&&!this._isValidId(u)?[]:this.style.querySourceFeatures(u,t)}isPointOnSurface(u){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&r.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(u))}addInteraction(u,t){return this._interactions.add(u,t),this}removeInteraction(u){return this._interactions.remove(u),this}setStyle(u,t){return t=r.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&u&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(u,(n,d)=>{n?(r.w(`Unable to perform style diff: ${String(n.message||n.error||n)}. Rebuilding the style from scratch.`),this._updateStyle(u,t)):d&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(u,t))}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u){const n=r.l({},t);t&&t.config&&(n.initialConfig=t.config,delete n.config),this.style=new Lo(this,n).load(u),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Lo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(u){return u==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.cr(u)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${u}".`))),!1)}_isTargetValid(u){return"featuresetId"in u?this._isValidId("importId"in u?u.importId:u.featuresetId):"layerId"in u&&this._isValidId(u.layerId)}_areTargetsValid(u){if(Array.isArray(u)){for(const t of u)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(u)}addSource(u,t){return this._isValidId(u)?(this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)):this}isSourceLoaded(u){return!!this._isValidId(u)&&!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(u,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,n)}removeSource(u){return this._isValidId(u)?(this.style.removeSource(u),this._updateTerrain(),this._update(!0)):this}getSource(u){return this._isValidId(u)?this.style.getOwnSource(u):null}addImage(u,t,{pixelRatio:n=1,sdf:d=!1,stretchX:y,stretchY:b,content:T}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:D,height:F,data:V}=r.q.getImageData(t);this.style.addImage(u,{data:new r.r({width:D,height:F},V),pixelRatio:n,stretchX:y,stretchY:b,content:T,sdf:d,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:D,height:F}=t,V=t;this.style.addImage(u,{data:new r.r({width:D,height:F},new Uint8Array(V.data)),pixelRatio:n,stretchX:y,stretchY:b,content:T,sdf:d,usvg:!1,version:0,userImage:V}),V.onAdd&&V.onAdd(this,u)}}updateImage(u,t){this._lazyInitEmptyStyle();const n=this.style.getImage(u);if(!n)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?r.q.getImageData(t):t,{width:y,height:b,data:T}=d;if(y===void 0||b===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(n.usvg?n.icon.usvg_tree.width:n.data.width)||b!==(n.usvg?n.icon.usvg_tree.height:n.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${y}, ${b})
                must be that same as the previous version of the image
                (${n.data.width}, ${n.data.height})`)));const D=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let F=!1;n.usvg?(n.data=new r.r({width:y,height:b},new Uint8Array(T)),n.usvg=!1,n.icon=void 0,F=!0):n.data.replace(T,D),this.style.updateImage(u,n,F)}hasImage(u){return u?!!this.style&&!!this.style.getImage(u):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,t){r.o(this._requestManager.transformRequest(u,r.R.Image),(n,d)=>{t(n,d instanceof HTMLImageElement?r.q.getImageData(d):d)})}listImages(){return this.style.listImages()}addModel(u,t){this._lazyInitEmptyStyle(),this.style.addModel(u,t)}hasModel(u){return u?this.style.hasModel(u):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(u){this.style.removeModel(u)}listModels(){return this.style.listModels()}addLayer(u,t){return this._isValidId(u.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)):this}getSlot(u){const t=this.getLayer(u);return t&&t.slot||null}setSlot(u,t){return this.style.setSlot(u,t),this.style.mergeLayers(),this._update(!0)}addImport(u,t){return this.style.addImport(u,t),this}updateImport(u,t){return typeof t!="string"&&t.id!==u?(this.removeImport(u),this.addImport(t)):(this.style.updateImport(u,t),this._update(!0))}removeImport(u){return this.style.removeImport(u),this}moveImport(u,t){return this.style.moveImport(u,t),this._update(!0)}moveLayer(u,t){return this._isValidId(u)?(this.style.moveLayer(u,t),this._update(!0)):this}removeLayer(u){return this._isValidId(u)?(this.style.removeLayer(u),this._update(!0)):this}getLayer(u){if(!this._isValidId(u))return null;const t=this.style.getOwnLayer(u);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(u,t,n){return this._isValidId(u)?(this.style.setLayerZoomRange(u,t,n),this._update(!0)):this}setFilter(u,t,n={}){return this._isValidId(u)?(this.style.setFilter(u,t,n),this._update(!0)):this}getFilter(u){return this._isValidId(u)?this.style.getFilter(u):null}setPaintProperty(u,t,n,d={}){return this._isValidId(u)?(this.style.setPaintProperty(u,t,n,d),this._update(!0)):this}getPaintProperty(u,t){return this._isValidId(u)?this.style.getPaintProperty(u,t):null}setLayoutProperty(u,t,n,d={}){return this._isValidId(u)?(this.style.setLayoutProperty(u,t,n,d),this._update(!0)):this}getLayoutProperty(u,t){return this._isValidId(u)?this.style.getLayoutProperty(u,t):null}getSchema(u){return this.style.getSchema(u)}setSchema(u,t){return this.style.setSchema(u,t),this._update(!0)}getConfig(u){return this.style.getConfig(u)}setConfig(u,t){return this.style.setConfig(u,t),this._update(!0)}getConfigProperty(u,t){return this.style.getConfigProperty(u,t)}setConfigProperty(u,t,n){return this.style.setConfigProperty(u,t,n),this._update(!0)}getFeaturesetDescriptors(u){return this.style.getFeaturesetDescriptors(u)}setLights(u){if(this._lazyInitEmptyStyle(),u&&u.length===1&&u[0].type==="flat"){const t=u[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(u),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const u=this.style.getLights()||[];return u.length===0&&u.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),u}setLight(u,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:u}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(u){return this._lazyInitEmptyStyle(),this.style.setSnow(u),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(u){return this._lazyInitEmptyStyle(),this.style.setRain(u),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(u){return this._lazyInitEmptyStyle(),this.style.setColorTheme(u),this._update(!0)}setImportColorTheme(u,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(u,t),this._update(!0)}setCamera(u){return this.style.setCamera(u),this._triggerCameraUpdate(u)}_triggerCameraUpdate(u){return this._update(this.transform.setOrthographicProjectionAtLowPitch(u["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.bO.convert(u),this.transform):0}setFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.setFeatureState(u,t),this._update())}removeFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.removeFeatureState(u,t),this._update())}getFeatureState(u){return u.source&&!this._isValidId(u.source)?null:this.style.getFeatureState(u)}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let n,d,y,b=this._container;for(;b&&(!d||!y);){const T=window.getComputedStyle(b).transform;T&&T!=="none"&&(n=T.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&n[0]!=="0"&&n[0]!=="1"&&(d=n[0]),n[3]&&n[3]!=="0"&&n[3]!=="1"&&(y=n[3])),b=b.parentElement}this._containerWidth=d?Math.abs(u/d):u,this._containerHeight=y?Math.abs(t/y):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=Pe("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Pe("div","mapboxgl-canvas-container",u);this._canvas=Pe("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=Pe("div","mapboxgl-control-container",u),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(y=>{d[y]=Pe("div",`mapboxgl-ctrl-${y}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,t){const n=r.q.devicePixelRatio||1;this._canvas.width=n*Math.ceil(u),this._canvas.height=n*Math.ceil(t),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const t=this._markers.indexOf(u);t!==-1&&this._markers.splice(t,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){const t=this._popups.indexOf(u);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const u=r.l({},we.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",u);t?(Bi(t,!0),this.painter=new Qa(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",n=>{n.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.m.testSupport(t)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let t;this.fire(new r.z("renderstart")),++this._frameId;const n=this.painter.context.extTimerQuery,d=r.q.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=y.createQuery(),y.beginQuery(n.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const V=this.transform.zoom,j=this.transform.pitch,H=r.q.now(),W=new r.a8(V,{now:H,fadeDuration:b,pitch:j,transition:this.style.transition});this.style.update(W)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(d),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(d);const D=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),D&&(this._placementDirty=D.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,ae.mark(ie.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const V=r.q.now()-d;y.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{const j=y.getQueryParameter(t,y.QUERY_RESULT)/1e6;y.deleteQuery(t),this.fire(new r.z("gpu-timing-frame",{cpuTime:V,gpuTime:j}))},50)}if(this.listens("gpu-timing-layer")){const V=this.painter.collectGpuTimers();setTimeout(()=>{const j=this.painter.queryGpuTimers(V);this.fire(new r.z("gpu-timing-layer",{layerTimes:j}))},50)}if(this.listens("gpu-timing-deferred-render")){const V=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const j=this.painter.queryGpuTimeDeferredRender(V);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:j}))},50)}const F=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(F||this._repaint)this.triggerRepaint();else{const V=this.idle();if(V&&(T=this._updateAverageElevation(d,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),V&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const j=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:j})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||F||(this._fullyLoaded=!0,ae.mark(ie.fullLoad),this._performanceMetricsCollection&&qr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(const t of this._markers)u&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!u||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(u,t=!1){const n=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&n(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(t||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const y=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=u;const T=Math.abs(y-b);if(T>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(b),n(b);this._averageElevation.easeTo(b,u,300)}else if(T>1e-4)return this._averageElevation.jumpTo(b),n(b)}return!!this._averageElevation.isEasing(u)&&n(this._averageElevation.getValue(u))}_authenticate(){Ye(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===Ti||u.status===401)){const t=this.painter.context.gl;Bi(t,!1),this._logoControl instanceof Mo&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Wr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&_n(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,d=n.createFramebuffer();function y(b){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,b,0);const T=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,T),T}return n.bindFramebuffer(n.FRAMEBUFFER,d),this._canvasPixelComparison(y(u),t.canvasCopies.map(y),t.timeStamps)}_canvasPixelComparison(u,t,n){let d=n[1]-n[0];const y=u.length/4;for(let b=0;b<t.length;b++){const T=t[b];let D=0;for(let F=0;F<T.length;F+=4)T[F]===u[F]&&T[F+1]===u[F+1]&&T[F+2]===u[F+2]&&T[F+3]===u[F+3]&&(D+=1);d+=(n[b+2]-n[b+1])*(1-D/y)}return d}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),ds.delete(this.painter.context.gl),es.remove(),vi.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=r.q.frame(t=>{const n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(t)}))}_preloadTiles(u){const t=this.style?this.style.getSourceCaches():[];return r.bl(t,(n,d)=>n._preloadTiles(u,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(u){this._showParseStatus!==u&&(this._showParseStatus=u,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(u){this._showLayers2DWireframe!==u&&(this._showLayers2DWireframe=u,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(u){this._showLayers3DWireframe!==u&&(this._showLayers3DWireframe=u,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,this._tp.refreshUI(),u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,this._tp.refreshUI(),u&&this._update())}_setCacheLimits(u,t){r.dG(u,t)}get version(){return q}},NavigationControl:class{constructor(u={}){this.options=r.l({},Lp,u),this._container=Pe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(r.aP(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Pe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Pe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aP(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:t}):n.resetNorth({},{originalEvent:t}))}),this._compassIcon=Pe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const t=u.getZoom(),n=t===u.getMaxZoom(),d=t===u.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Rp(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,t){const n=Pe("button",u,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(u,t){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${t}`);u.setAttribute("aria-label",n),u.firstElementChild&&u.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends r.E{constructor(u={}){super();const t=navigator.geolocation;this.options=r.l({geolocation:t},to,u),r.aP(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=oo(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=Pe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){const t=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,u(n)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(n=>t(n.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),n=u.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",u)),this._finish()}}_updateCamera(u){const t=new r.bO(u.coords.longitude,u.coords.latitude),n=u.coords.accuracy,d=this._map.getBearing(),y=r.l({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),y,{geolocateSource:!0})}_updateMarker(u){if(u){const t=new r.bO(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map.transform,t=r.bH(1,u._center.lat)*u.worldSize,n=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Pe("button","mapboxgl-ctrl-geolocate",this._container),Pe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Pe("div","mapboxgl-user-location"),this._dotElement.appendChild(Pe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Pe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ya({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Pe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ya({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:bh,ScaleControl:class{constructor(u={}){this.options=r.l({},co,u),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aP(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const u=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,d=t._containerWidth/2-u/2,y=t.unproject([d,n]),b=t.unproject([d+u,n]),T=y.distanceTo(b);if(this.options.unit==="imperial"){const D=3.2808*T;D>5280?this._setScale(u,D/5280,"mile"):this._setScale(u,D,"foot")}else this.options.unit==="nautical"?this._setScale(u,T/1852,"nautical-mile"):T>=1e3?this._setScale(u,T/1e3,"kilometer"):this._setScale(u,T,"meter")}_setScale(u,t,n){this._map._requestDomTask(()=>{const d=function(b){const T=Math.pow(10,`${Math.floor(b)}`.length-1);let D=b/T;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function(F){const V=Math.pow(10,Math.ceil(-Math.log(F)/Math.LN10));return Math.round(F*V)/V}(D),T*D}(t),y=d/t;this._container.innerHTML=this._isNumberFormatSupported&&n!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(d):`${d}&nbsp;${Wn[n]}`,this._container.style.width=u*y+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=Pe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u={}){this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:r.w("Full screen control 'container' must be a DOM element.")),r.aP(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=Pe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=Pe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Pe("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(u){super(),this.options=r.l(Object.create(zp),u),r.aP(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=r.bO.convert(u),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const t=document.createDocumentFragment(),n=document.createElement("body");let d;for(n.innerHTML=u;d=n.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Pe("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(u),this.options.closeButton){const n=this._closeButton=Pe("button","mapboxgl-popup-close-button",t);n.type="button",n.setAttribute("aria-label","Close popup"),n.innerHTML='<span aria-hidden="true">&#215;</span>',n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let t;return this._classList.delete(u)?t=!1:(this._classList.add(u),t=!0),this._updateClassList(),t}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,d=this._pos;if(!t||!n||!d)return"bottom";const y=n.offsetWidth,b=n.offsetHeight,T=d.x<y/2,D=d.x>t.transform.width-y/2;if(d.y+u<b)return T?"top-left":D?"top-right":"top";if(d.y>t.transform.height-b){if(T)return"bottom-left";if(D)return"bottom-right"}return T?"left":D?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),u.className=t.join(" ")}_update(u){const t=this._map,n=this._content;if(!t||!this._lngLat&&!this._trackPointer||!n)return;let d=this._container;if(d||(d=this._container=Pe("div","mapboxgl-popup",t.getContainer()),this._tip=Pe("div","mapboxgl-popup-tip",d),d.appendChild(n)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Bl(this._lngLat,this._pos,t.transform)),!this._trackPointer||u){const y=this._pos=this._trackPointer&&u instanceof r.P?u:t.project(this._lngLat),b=Fp(this.options.offset),T=this._anchor=this._getAnchor(b.y),D=Fp(this.options.offset,T),F=y.add(D).round();t._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${_a[T]} translate(${F.x}px,${F.y}px)`)})}if(!this._marker&&t._showingGlobe()){const y=r.dH(t.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(uo);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:ya,Style:Lo,LngLat:r.bO,LngLatBounds:r.az,Point:r.P,MercatorCoordinate:r.aa,FreeCameraOptions:$h,Evented:r.E,config:r.e,prewarm:r.dM,clearPrewarmedResources:r.dN,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(u){r.e.ACCESS_TOKEN=u},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(u){r.e.API_URL=u},get workerCount(){return r.dO.workerCount},set workerCount(u){r.dO.workerCount=u},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){r.e.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){r.dP(u)},get workerUrl(){return r.dQ.workerUrl},set workerUrl(u){r.dQ.workerUrl=u},get workerClass(){return r.dQ.workerClass},set workerClass(u){r.dQ.workerClass=u},get workerParams(){return r.dQ.workerParams},set workerParams(u){r.dQ.workerParams=u},get dracoUrl(){return r.dR()},set dracoUrl(u){r.dS(u)},get meshoptUrl(){return r.dT()},set meshoptUrl(u){r.dU(u)},setNow:r.q.setNow,restoreNow:r.q.restoreNow}});var N=_;return N})}(Ly)),Ly.exports}var a3=o3();const cT=t_(a3),l3=["Austria","Belgium","Bulgaria","Croatia","Cyprus","Czech Republic","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Ireland","Italy","Latvia","Lithuania","Luxembourg","Malta","Netherlands","Poland","Portugal","Romania","Slovakia","Slovenia","Spain","Sweden"],c3=({vesselId:m,fromDate:g,toDate:l})=>{const[c,_]=Ke.useState([]),A=Ke.useRef(null),N=Ke.useRef({}),r=(Ae,we)=>Ae.reduce((Pe,Ve)=>((Pe[Ve[we]]=Pe[Ve[we]]||[]).push(Ve),Pe),{}),q=(Ae=[])=>Ae.map(we=>[we.long,we.lat]),ie=async(Ae,we)=>{try{const We=(await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${we},${Ae}.json?access_token=pk.eyJ1IjoiaXRlY2hkZXNrIiwiYSI6ImNsbzB2Ym90ZzAyOHkycG1wbGdzbDkwdHYifQ.m9ESpZNzQefxh1rRRs4tXA`)).json()).features.find(ht=>ht.place_type.includes("country")),rt=We==null?void 0:We.text;return console.log("country",rt),l3.includes(rt)}catch(Pe){return console.error("Error checking EU country:",Pe),!1}},ae=async()=>{try{const Ae=await dA({vesselId:m||"",fromDate:g,toDate:l});if(Ae.length){const we=r(Ae,"voyageNo"),Pe=await Promise.all(Object.keys(we).map(async Ve=>{const We=we[Ve][0],rt=await ie(We.lat,We.long);return{coordinates:q(we[Ve]),color:rt?"#36AB2F":"#2b7fff"}}));_(Pe)}else console.warn("No voyage routes data received.")}catch(Ae){console.error("Error fetching vessel voyage routes:",Ae)}};Ke.useEffect(()=>(A.current||(cT.accessToken="pk.eyJ1IjoiaXRlY2hkZXNrIiwiYSI6ImNsbzB2Ym90ZzAyOHkycG1wbGdzbDkwdHYifQ.m9ESpZNzQefxh1rRRs4tXA",A.current=new cT.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[37.551544,19.412756],zoom:1,preserveDrawingBuffer:!0,attributionControl:!1,scrollZoom:!0}),A.current.on("load",()=>{console.log("Map loaded")})),()=>{var Ae;(Ae=A.current)==null||Ae.remove(),A.current=null}),[]),Ke.useEffect(()=>{m&&g&&l&&ae()},[m,g,l]);const he=()=>{A.current&&(Object.keys(N.current).forEach(Ae=>{var Pe,Ve;(Pe=A.current)!=null&&Pe.getLayer(Ae)&&A.current.removeLayer(Ae);const we=Ae.replace("Layer","Source");(Ve=A.current)!=null&&Ve.getSource(we)&&A.current.removeSource(we)}),N.current={})};Ke.useEffect(()=>{A.current&&c.length>0&&(A.current.isStyleLoaded()?(he(),ve(c)):A.current.once("styledata",()=>{he(),ve(c)}))},[c]);const ve=Ae=>{Ae.forEach((we,Pe)=>{var rt,ht;const Ve=`multilineStringSource${Pe}`,We=`multilineStringLayer${Pe}`;(rt=A.current)==null||rt.addSource(Ve,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"MultiPoint",coordinates:we.coordinates}}}),(ht=A.current)==null||ht.addLayer({id:We,type:"circle",source:Ve,paint:{"circle-color":we.color,"circle-radius":2}}),N.current[We]=!0})};return gi.jsx("div",{id:"map",style:{width:"100%",height:"350px"}})},Qg={black:"#000",white:"#fff"},_m={300:"#e57373",400:"#ef5350",500:"#f44336",700:"#d32f2f",800:"#c62828"},ym={50:"#f3e5f5",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",700:"#7b1fa2"},vm={50:"#e3f2fd",200:"#90caf9",400:"#42a5f5",700:"#1976d2",800:"#1565c0"},xm={300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",700:"#0288d1",900:"#01579b"},bm={300:"#81c784",400:"#66bb6a",500:"#4caf50",700:"#388e3c",800:"#2e7d32",900:"#1b5e20"},Bg={300:"#ffb74d",400:"#ffa726",500:"#ff9800",700:"#f57c00",900:"#e65100"},u3={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"};function pf(m,...g){const l=new URL(`https://mui.com/production-error/?code=${m}`);return g.forEach(c=>l.searchParams.append("args[]",c)),`Minified MUI error #${m}; visit ${l} for the full message.`}const h3="$$material";var d3=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,p3=QT(function(m){return d3.test(m)||m.charCodeAt(0)===111&&m.charCodeAt(1)===110&&m.charCodeAt(2)<91}),f3=p3,m3=function(g){return g!=="theme"},uT=function(g){return typeof g=="string"&&g.charCodeAt(0)>96?f3:m3},hT=function(g,l,c){var _;if(l){var A=l.shouldForwardProp;_=g.__emotion_forwardProp&&A?function(N){return g.__emotion_forwardProp(N)&&A(N)}:A}return typeof _!="function"&&c&&(_=g.__emotion_forwardProp),_},g3=function(g){var l=g.cache,c=g.serialized,_=g.isStringTag;return Nx(l,c,_),n2(function(){return i2(l,c,_)}),null},_3=function m(g,l){var c=g.__emotion_real===g,_=c&&g.__emotion_base||g,A,N;l!==void 0&&(A=l.label,N=l.target);var r=hT(g,l,c),q=r||uT(_),ie=!q("as");return function(){var ae=arguments,he=c&&g.__emotion_styles!==void 0?g.__emotion_styles.slice(0):[];if(A!==void 0&&he.push("label:"+A+";"),ae[0]==null||ae[0].raw===void 0)he.push.apply(he,ae);else{var ve=ae[0];he.push(ve[0]);for(var Ae=ae.length,we=1;we<Ae;we++)he.push(ae[we],ve[we])}var Pe=o2(function(Ve,We,rt){var ht=ie&&Ve.as||_,tt="",at=[],Rt=Ve;if(Ve.theme==null){Rt={};for(var Ne in Ve)Rt[Ne]=Ve[Ne];Rt.theme=Ke.useContext(a2)}typeof Ve.className=="string"?tt=t2(We.registered,at,Ve.className):Ve.className!=null&&(tt=Ve.className+" ");var Tt=h0(he.concat(at),We.registered,Rt);tt+=We.key+"-"+Tt.name,N!==void 0&&(tt+=" "+N);var qt=ie&&r===void 0?uT(ht):q,Te={};for(var gt in Ve)ie&&gt==="as"||qt(gt)&&(Te[gt]=Ve[gt]);return Te.className=tt,rt&&(Te.ref=rt),Ke.createElement(Ke.Fragment,null,Ke.createElement(g3,{cache:We,serialized:Tt,isStringTag:typeof ht=="string"}),Ke.createElement(ht,Te))});return Pe.displayName=A!==void 0?A:"Styled("+(typeof _=="string"?_:_.displayName||_.name||"Component")+")",Pe.defaultProps=g.defaultProps,Pe.__emotion_real=Pe,Pe.__emotion_base=_,Pe.__emotion_styles=he,Pe.__emotion_forwardProp=r,Object.defineProperty(Pe,"toString",{value:function(){return"."+N}}),Pe.withComponent=function(Ve,We){var rt=m(Ve,yr({},l,We,{shouldForwardProp:hT(Pe,We,!0)}));return rt.apply(void 0,he)},Pe}},y3=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],Cx=_3.bind(null);y3.forEach(function(m){Cx[m]=Cx(m)});function v3(m,g){return Cx(m,g)}function x3(m,g){Array.isArray(m.__emotion_styles)&&(m.__emotion_styles=g(m.__emotion_styles))}const dT=[];function pT(m){return dT[0]=m,h0(dT)}var cx={exports:{}},Un={};/**
 * @license React
 * react-is.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fT;function b3(){if(fT)return Un;fT=1;var m=Symbol.for("react.transitional.element"),g=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),A=Symbol.for("react.consumer"),N=Symbol.for("react.context"),r=Symbol.for("react.forward_ref"),q=Symbol.for("react.suspense"),ie=Symbol.for("react.suspense_list"),ae=Symbol.for("react.memo"),he=Symbol.for("react.lazy"),ve=Symbol.for("react.view_transition"),Ae=Symbol.for("react.client.reference");function we(Pe){if(typeof Pe=="object"&&Pe!==null){var Ve=Pe.$$typeof;switch(Ve){case m:switch(Pe=Pe.type,Pe){case l:case _:case c:case q:case ie:case ve:return Pe;default:switch(Pe=Pe&&Pe.$$typeof,Pe){case N:case r:case he:case ae:return Pe;case A:return Pe;default:return Ve}}case g:return Ve}}}return Un.ContextConsumer=A,Un.ContextProvider=N,Un.Element=m,Un.ForwardRef=r,Un.Fragment=l,Un.Lazy=he,Un.Memo=ae,Un.Portal=g,Un.Profiler=_,Un.StrictMode=c,Un.Suspense=q,Un.SuspenseList=ie,Un.isContextConsumer=function(Pe){return we(Pe)===A},Un.isContextProvider=function(Pe){return we(Pe)===N},Un.isElement=function(Pe){return typeof Pe=="object"&&Pe!==null&&Pe.$$typeof===m},Un.isForwardRef=function(Pe){return we(Pe)===r},Un.isFragment=function(Pe){return we(Pe)===l},Un.isLazy=function(Pe){return we(Pe)===he},Un.isMemo=function(Pe){return we(Pe)===ae},Un.isPortal=function(Pe){return we(Pe)===g},Un.isProfiler=function(Pe){return we(Pe)===_},Un.isStrictMode=function(Pe){return we(Pe)===c},Un.isSuspense=function(Pe){return we(Pe)===q},Un.isSuspenseList=function(Pe){return we(Pe)===ie},Un.isValidElementType=function(Pe){return typeof Pe=="string"||typeof Pe=="function"||Pe===l||Pe===_||Pe===c||Pe===q||Pe===ie||typeof Pe=="object"&&Pe!==null&&(Pe.$$typeof===he||Pe.$$typeof===ae||Pe.$$typeof===N||Pe.$$typeof===A||Pe.$$typeof===r||Pe.$$typeof===Ae||Pe.getModuleId!==void 0)},Un.typeOf=we,Un}var mT;function w3(){return mT||(mT=1,cx.exports=b3()),cx.exports}var mM=w3();function Fu(m){if(typeof m!="object"||m===null)return!1;const g=Object.getPrototypeOf(m);return(g===null||g===Object.prototype||Object.getPrototypeOf(g)===null)&&!(Symbol.toStringTag in m)&&!(Symbol.iterator in m)}function gM(m){if(Ke.isValidElement(m)||mM.isValidElementType(m)||!Fu(m))return m;const g={};return Object.keys(m).forEach(l=>{g[l]=gM(m[l])}),g}function hl(m,g,l={clone:!0}){const c=l.clone?{...m}:m;return Fu(m)&&Fu(g)&&Object.keys(g).forEach(_=>{Ke.isValidElement(g[_])||mM.isValidElementType(g[_])?c[_]=g[_]:Fu(g[_])&&Object.prototype.hasOwnProperty.call(m,_)&&Fu(m[_])?c[_]=hl(m[_],g[_],l):l.clone?c[_]=Fu(g[_])?gM(g[_]):g[_]:c[_]=g[_]}),c}const S3=m=>{const g=Object.keys(m).map(l=>({key:l,val:m[l]}))||[];return g.sort((l,c)=>l.val-c.val),g.reduce((l,c)=>({...l,[c.key]:c.val}),{})};function T3(m){const{values:g={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:l="px",step:c=5,..._}=m,A=S3(g),N=Object.keys(A);function r(ve){return`@media (min-width:${typeof g[ve]=="number"?g[ve]:ve}${l})`}function q(ve){return`@media (max-width:${(typeof g[ve]=="number"?g[ve]:ve)-c/100}${l})`}function ie(ve,Ae){const we=N.indexOf(Ae);return`@media (min-width:${typeof g[ve]=="number"?g[ve]:ve}${l}) and (max-width:${(we!==-1&&typeof g[N[we]]=="number"?g[N[we]]:Ae)-c/100}${l})`}function ae(ve){return N.indexOf(ve)+1<N.length?ie(ve,N[N.indexOf(ve)+1]):r(ve)}function he(ve){const Ae=N.indexOf(ve);return Ae===0?r(N[1]):Ae===N.length-1?q(N[Ae]):ie(ve,N[N.indexOf(ve)+1]).replace("@media","@media not all and")}return{keys:N,values:A,up:r,down:q,between:ie,only:ae,not:he,unit:l,..._}}function M3(m,g){if(!m.containerQueries)return g;const l=Object.keys(g).filter(c=>c.startsWith("@container")).sort((c,_)=>{var N,r;const A=/min-width:\s*([0-9.]+)/;return+(((N=c.match(A))==null?void 0:N[1])||0)-+(((r=_.match(A))==null?void 0:r[1])||0)});return l.length?l.reduce((c,_)=>{const A=g[_];return delete c[_],c[_]=A,c},{...g}):g}function E3(m,g){return g==="@"||g.startsWith("@")&&(m.some(l=>g.startsWith(`@${l}`))||!!g.match(/^@\d/))}function C3(m,g){const l=g.match(/^@([^/]+)?\/?(.+)?$/);if(!l)return null;const[,c,_]=l,A=Number.isNaN(+c)?c||0:+c;return m.containerQueries(_).up(A)}function A3(m){const g=(A,N)=>A.replace("@media",N?`@container ${N}`:"@container");function l(A,N){A.up=(...r)=>g(m.breakpoints.up(...r),N),A.down=(...r)=>g(m.breakpoints.down(...r),N),A.between=(...r)=>g(m.breakpoints.between(...r),N),A.only=(...r)=>g(m.breakpoints.only(...r),N),A.not=(...r)=>{const q=g(m.breakpoints.not(...r),N);return q.includes("not all and")?q.replace("not all and ","").replace("min-width:","width<").replace("max-width:","width>").replace("and","or"):q}}const c={},_=A=>(l(c,A),c);return l(_),{...m,containerQueries:_}}const P3={borderRadius:4};function Hg(m,g){return g?hl(m,g,{clone:!1}):m}const w0={xs:0,sm:600,md:900,lg:1200,xl:1536},gT={keys:["xs","sm","md","lg","xl"],up:m=>`@media (min-width:${w0[m]}px)`},I3={containerQueries:m=>({up:g=>{let l=typeof g=="number"?g:w0[g]||g;return typeof l=="number"&&(l=`${l}px`),m?`@container ${m} (min-width:${l})`:`@container (min-width:${l})`}})};function Oh(m,g,l){const c=m.theme||{};if(Array.isArray(g)){const A=c.breakpoints||gT;return g.reduce((N,r,q)=>(N[A.up(A.keys[q])]=l(g[q]),N),{})}if(typeof g=="object"){const A=c.breakpoints||gT;return Object.keys(g).reduce((N,r)=>{if(E3(A.keys,r)){const q=C3(c.containerQueries?c:I3,r);q&&(N[q]=l(g[r],r))}else if(Object.keys(A.values||w0).includes(r)){const q=A.up(r);N[q]=l(g[r],r)}else{const q=r;N[q]=g[q]}return N},{})}return l(g)}function D3(m={}){var l;return((l=m.keys)==null?void 0:l.reduce((c,_)=>{const A=m.up(_);return c[A]={},c},{}))||{}}function k3(m,g){return m.reduce((l,c)=>{const _=l[c];return(!_||Object.keys(_).length===0)&&delete l[c],l},g)}function Ma(m){if(typeof m!="string")throw new Error(pf(7));return m.charAt(0).toUpperCase()+m.slice(1)}function S0(m,g,l=!0){if(!g||typeof g!="string")return null;if(m&&m.vars&&l){const c=`vars.${g}`.split(".").reduce((_,A)=>_&&_[A]?_[A]:null,m);if(c!=null)return c}return g.split(".").reduce((c,_)=>c&&c[_]!=null?c[_]:null,m)}function n0(m,g,l,c=l){let _;return typeof m=="function"?_=m(l):Array.isArray(m)?_=m[l]||c:_=S0(m,l)||c,g&&(_=g(_,c,m)),_}function Ys(m){const{prop:g,cssProperty:l=m.prop,themeKey:c,transform:_}=m,A=N=>{if(N[g]==null)return null;const r=N[g],q=N.theme,ie=S0(q,c)||{};return Oh(N,r,he=>{let ve=n0(ie,_,he);return he===ve&&typeof he=="string"&&(ve=n0(ie,_,`${g}${he==="default"?"":Ma(he)}`,he)),l===!1?ve:{[l]:ve}})};return A.propTypes={},A.filterProps=[g],A}function O3(m){const g={};return l=>(g[l]===void 0&&(g[l]=m(l)),g[l])}const L3={m:"margin",p:"padding"},R3={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},_T={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},z3=O3(m=>{if(m.length>2)if(_T[m])m=_T[m];else return[m];const[g,l]=m.split(""),c=L3[g],_=R3[l]||"";return Array.isArray(_)?_.map(A=>c+A):[c+_]}),rb=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],nb=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...rb,...nb];function l_(m,g,l,c){const _=S0(m,g,!0)??l;return typeof _=="number"||typeof _=="string"?A=>typeof A=="string"?A:typeof _=="string"?_.startsWith("var(")&&A===0?0:_.startsWith("var(")&&A===1?_:`calc(${A} * ${_})`:_*A:Array.isArray(_)?A=>{if(typeof A=="string")return A;const N=Math.abs(A),r=_[N];return A>=0?r:typeof r=="number"?-r:typeof r=="string"&&r.startsWith("var(")?`calc(-1 * ${r})`:`-${r}`}:typeof _=="function"?_:()=>{}}function sb(m){return l_(m,"spacing",8)}function c_(m,g){return typeof g=="string"||g==null?g:m(g)}function F3(m,g){return l=>m.reduce((c,_)=>(c[_]=c_(g,l),c),{})}function B3(m,g,l,c){if(!g.includes(l))return null;const _=z3(l),A=F3(_,c),N=m[l];return Oh(m,N,A)}function _M(m,g){const l=sb(m.theme);return Object.keys(m).map(c=>B3(m,g,c,l)).reduce(Hg,{})}function Ns(m){return _M(m,rb)}Ns.propTypes={};Ns.filterProps=rb;function Vs(m){return _M(m,nb)}Vs.propTypes={};Vs.filterProps=nb;function yM(m=8,g=sb({spacing:m})){if(m.mui)return m;const l=(...c)=>(c.length===0?[1]:c).map(A=>{const N=g(A);return typeof N=="number"?`${N}px`:N}).join(" ");return l.mui=!0,l}function T0(...m){const g=m.reduce((c,_)=>(_.filterProps.forEach(A=>{c[A]=_}),c),{}),l=c=>Object.keys(c).reduce((_,A)=>g[A]?Hg(_,g[A](c)):_,{});return l.propTypes={},l.filterProps=m.reduce((c,_)=>c.concat(_.filterProps),[]),l}function Xl(m){return typeof m!="number"?m:`${m}px solid`}function Kl(m,g){return Ys({prop:m,themeKey:"borders",transform:g})}const N3=Kl("border",Xl),V3=Kl("borderTop",Xl),U3=Kl("borderRight",Xl),j3=Kl("borderBottom",Xl),$3=Kl("borderLeft",Xl),G3=Kl("borderColor"),H3=Kl("borderTopColor"),W3=Kl("borderRightColor"),q3=Kl("borderBottomColor"),Y3=Kl("borderLeftColor"),X3=Kl("outline",Xl),Z3=Kl("outlineColor"),M0=m=>{if(m.borderRadius!==void 0&&m.borderRadius!==null){const g=l_(m.theme,"shape.borderRadius",4),l=c=>({borderRadius:c_(g,c)});return Oh(m,m.borderRadius,l)}return null};M0.propTypes={};M0.filterProps=["borderRadius"];T0(N3,V3,U3,j3,$3,G3,H3,W3,q3,Y3,M0,X3,Z3);const E0=m=>{if(m.gap!==void 0&&m.gap!==null){const g=l_(m.theme,"spacing",8),l=c=>({gap:c_(g,c)});return Oh(m,m.gap,l)}return null};E0.propTypes={};E0.filterProps=["gap"];const C0=m=>{if(m.columnGap!==void 0&&m.columnGap!==null){const g=l_(m.theme,"spacing",8),l=c=>({columnGap:c_(g,c)});return Oh(m,m.columnGap,l)}return null};C0.propTypes={};C0.filterProps=["columnGap"];const A0=m=>{if(m.rowGap!==void 0&&m.rowGap!==null){const g=l_(m.theme,"spacing",8),l=c=>({rowGap:c_(g,c)});return Oh(m,m.rowGap,l)}return null};A0.propTypes={};A0.filterProps=["rowGap"];const K3=Ys({prop:"gridColumn"}),J3=Ys({prop:"gridRow"}),Q3=Ys({prop:"gridAutoFlow"}),ez=Ys({prop:"gridAutoColumns"}),tz=Ys({prop:"gridAutoRows"}),iz=Ys({prop:"gridTemplateColumns"}),rz=Ys({prop:"gridTemplateRows"}),nz=Ys({prop:"gridTemplateAreas"}),sz=Ys({prop:"gridArea"});T0(E0,C0,A0,K3,J3,Q3,ez,tz,iz,rz,nz,sz);function Em(m,g){return g==="grey"?g:m}const oz=Ys({prop:"color",themeKey:"palette",transform:Em}),az=Ys({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:Em}),lz=Ys({prop:"backgroundColor",themeKey:"palette",transform:Em});T0(oz,az,lz);function ll(m){return m<=1&&m!==0?`${m*100}%`:m}const cz=Ys({prop:"width",transform:ll}),ob=m=>{if(m.maxWidth!==void 0&&m.maxWidth!==null){const g=l=>{var _,A,N,r,q;const c=((N=(A=(_=m.theme)==null?void 0:_.breakpoints)==null?void 0:A.values)==null?void 0:N[l])||w0[l];return c?((q=(r=m.theme)==null?void 0:r.breakpoints)==null?void 0:q.unit)!=="px"?{maxWidth:`${c}${m.theme.breakpoints.unit}`}:{maxWidth:c}:{maxWidth:ll(l)}};return Oh(m,m.maxWidth,g)}return null};ob.filterProps=["maxWidth"];const uz=Ys({prop:"minWidth",transform:ll}),hz=Ys({prop:"height",transform:ll}),dz=Ys({prop:"maxHeight",transform:ll}),pz=Ys({prop:"minHeight",transform:ll});Ys({prop:"size",cssProperty:"width",transform:ll});Ys({prop:"size",cssProperty:"height",transform:ll});const fz=Ys({prop:"boxSizing"});T0(cz,ob,uz,hz,dz,pz,fz);const u_={border:{themeKey:"borders",transform:Xl},borderTop:{themeKey:"borders",transform:Xl},borderRight:{themeKey:"borders",transform:Xl},borderBottom:{themeKey:"borders",transform:Xl},borderLeft:{themeKey:"borders",transform:Xl},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:Xl},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:M0},color:{themeKey:"palette",transform:Em},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:Em},backgroundColor:{themeKey:"palette",transform:Em},p:{style:Vs},pt:{style:Vs},pr:{style:Vs},pb:{style:Vs},pl:{style:Vs},px:{style:Vs},py:{style:Vs},padding:{style:Vs},paddingTop:{style:Vs},paddingRight:{style:Vs},paddingBottom:{style:Vs},paddingLeft:{style:Vs},paddingX:{style:Vs},paddingY:{style:Vs},paddingInline:{style:Vs},paddingInlineStart:{style:Vs},paddingInlineEnd:{style:Vs},paddingBlock:{style:Vs},paddingBlockStart:{style:Vs},paddingBlockEnd:{style:Vs},m:{style:Ns},mt:{style:Ns},mr:{style:Ns},mb:{style:Ns},ml:{style:Ns},mx:{style:Ns},my:{style:Ns},margin:{style:Ns},marginTop:{style:Ns},marginRight:{style:Ns},marginBottom:{style:Ns},marginLeft:{style:Ns},marginX:{style:Ns},marginY:{style:Ns},marginInline:{style:Ns},marginInlineStart:{style:Ns},marginInlineEnd:{style:Ns},marginBlock:{style:Ns},marginBlockStart:{style:Ns},marginBlockEnd:{style:Ns},displayPrint:{cssProperty:!1,transform:m=>({"@media print":{display:m}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:E0},rowGap:{style:A0},columnGap:{style:C0},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:ll},maxWidth:{style:ob},minWidth:{transform:ll},height:{transform:ll},maxHeight:{transform:ll},minHeight:{transform:ll},boxSizing:{},font:{themeKey:"font"},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}};function mz(...m){const g=m.reduce((c,_)=>c.concat(Object.keys(_)),[]),l=new Set(g);return m.every(c=>l.size===Object.keys(c).length)}function gz(m,g){return typeof m=="function"?m(g):m}function _z(){function m(l,c,_,A){const N={[l]:c,theme:_},r=A[l];if(!r)return{[l]:c};const{cssProperty:q=l,themeKey:ie,transform:ae,style:he}=r;if(c==null)return null;if(ie==="typography"&&c==="inherit")return{[l]:c};const ve=S0(_,ie)||{};return he?he(N):Oh(N,c,we=>{let Pe=n0(ve,ae,we);return we===Pe&&typeof we=="string"&&(Pe=n0(ve,ae,`${l}${we==="default"?"":Ma(we)}`,we)),q===!1?Pe:{[q]:Pe}})}function g(l){const{sx:c,theme:_={}}=l||{};if(!c)return null;const A=_.unstable_sxConfig??u_;function N(r){let q=r;if(typeof r=="function")q=r(_);else if(typeof r!="object")return r;if(!q)return null;const ie=D3(_.breakpoints),ae=Object.keys(ie);let he=ie;return Object.keys(q).forEach(ve=>{const Ae=gz(q[ve],_);if(Ae!=null)if(typeof Ae=="object")if(A[ve])he=Hg(he,m(ve,Ae,_,A));else{const we=Oh({theme:_},Ae,Pe=>({[ve]:Pe}));mz(we,Ae)?he[ve]=g({sx:Ae,theme:_}):he=Hg(he,we)}else he=Hg(he,m(ve,Ae,_,A))}),M3(_,k3(ae,he))}return Array.isArray(c)?c.map(N):N(c)}return g}const Rm=_z();Rm.filterProps=["sx"];function yz(m,g){var c;const l=this;if(l.vars){if(!((c=l.colorSchemes)!=null&&c[m])||typeof l.getColorSchemeSelector!="function")return{};let _=l.getColorSchemeSelector(m);return _==="&"?g:((_.includes("data-")||_.includes("."))&&(_=`*:where(${_.replace(/\s*&$/,"")}) &`),{[_]:g})}return l.palette.mode===m?g:{}}function vM(m={},...g){const{breakpoints:l={},palette:c={},spacing:_,shape:A={},...N}=m,r=T3(l),q=yM(_);let ie=hl({breakpoints:r,direction:"ltr",components:{},palette:{mode:"light",...c},spacing:q,shape:{...P3,...A}},N);return ie=A3(ie),ie.applyStyles=yz,ie=g.reduce((ae,he)=>hl(ae,he),ie),ie.unstable_sxConfig={...u_,...N==null?void 0:N.unstable_sxConfig},ie.unstable_sx=function(he){return Rm({sx:he,theme:this})},ie}const vz=m=>{var c;const g={systemProps:{},otherProps:{}},l=((c=m==null?void 0:m.theme)==null?void 0:c.unstable_sxConfig)??u_;return Object.keys(m).forEach(_=>{l[_]?g.systemProps[_]=m[_]:g.otherProps[_]=m[_]}),g};function xz(m){const{sx:g,...l}=m,{systemProps:c,otherProps:_}=vz(l);let A;return Array.isArray(g)?A=[c,...g]:typeof g=="function"?A=(...N)=>{const r=g(...N);return Fu(r)?{...c,...r}:c}:A={...c,...g},{..._,sx:A}}const yT=m=>m,bz=()=>{let m=yT;return{configure(g){m=g},generate(g){return m(g)},reset(){m=yT}}},wz=bz(),Sz={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function jd(m,g,l="Mui"){const c=Sz[g];return c?`${l}-${c}`:`${wz.generate(m)}-${g}`}function $d(m,g,l="Mui"){const c={};return g.forEach(_=>{c[_]=jd(m,_,l)}),c}function xM(m){const{variants:g,...l}=m,c={variants:g,style:pT(l),isProcessed:!0};return c.style===l||g&&g.forEach(_=>{typeof _.style!="function"&&(_.style=pT(_.style))}),c}const Tz=vM();function ux(m){return m!=="ownerState"&&m!=="theme"&&m!=="sx"&&m!=="as"}function Mz(m){return m?(g,l)=>l[m]:null}function Ez(m,g,l){m.theme=Pz(m.theme)?l:m.theme[g]||m.theme}function Ry(m,g){const l=typeof g=="function"?g(m):g;if(Array.isArray(l))return l.flatMap(c=>Ry(m,c));if(Array.isArray(l==null?void 0:l.variants)){let c;if(l.isProcessed)c=l.style;else{const{variants:_,...A}=l;c=A}return bM(m,l.variants,[c])}return l!=null&&l.isProcessed?l.style:l}function bM(m,g,l=[]){var _;let c;e:for(let A=0;A<g.length;A+=1){const N=g[A];if(typeof N.props=="function"){if(c??(c={...m,...m.ownerState,ownerState:m.ownerState}),!N.props(c))continue}else for(const r in N.props)if(m[r]!==N.props[r]&&((_=m.ownerState)==null?void 0:_[r])!==N.props[r])continue e;typeof N.style=="function"?(c??(c={...m,...m.ownerState,ownerState:m.ownerState}),l.push(N.style(c))):l.push(N.style)}return l}function Cz(m={}){const{themeId:g,defaultTheme:l=Tz,rootShouldForwardProp:c=ux,slotShouldForwardProp:_=ux}=m;function A(r){Ez(r,g,l)}return(r,q={})=>{x3(r,at=>at.filter(Rt=>Rt!==Rm));const{name:ie,slot:ae,skipVariantsResolver:he,skipSx:ve,overridesResolver:Ae=Mz(Dz(ae)),...we}=q,Pe=he!==void 0?he:ae&&ae!=="Root"&&ae!=="root"||!1,Ve=ve||!1;let We=ux;ae==="Root"||ae==="root"?We=c:ae?We=_:Iz(r)&&(We=void 0);const rt=v3(r,{shouldForwardProp:We,label:Az(),...we}),ht=at=>{if(typeof at=="function"&&at.__emotion_real!==at)return function(Ne){return Ry(Ne,at)};if(Fu(at)){const Rt=xM(at);return Rt.variants?function(Tt){return Ry(Tt,Rt)}:Rt.style}return at},tt=(...at)=>{const Rt=[],Ne=at.map(ht),Tt=[];if(Rt.push(A),ie&&Ae&&Tt.push(function(oi){var zt,ii;const ni=(ii=(zt=oi.theme.components)==null?void 0:zt[ie])==null?void 0:ii.styleOverrides;if(!ni)return null;const Mt={};for(const Yt in ni)Mt[Yt]=Ry(oi,ni[Yt]);return Ae(oi,Mt)}),ie&&!Pe&&Tt.push(function(oi){var Mt,zt;const Ti=oi.theme,ni=(zt=(Mt=Ti==null?void 0:Ti.components)==null?void 0:Mt[ie])==null?void 0:zt.variants;return ni?bM(oi,ni):null}),Ve||Tt.push(Rm),Array.isArray(Ne[0])){const gt=Ne.shift(),oi=new Array(Rt.length).fill(""),Ti=new Array(Tt.length).fill("");let ni;ni=[...oi,...gt,...Ti],ni.raw=[...oi,...gt.raw,...Ti],Rt.unshift(ni)}const qt=[...Rt,...Ne,...Tt],Te=rt(...qt);return r.muiName&&(Te.muiName=r.muiName),Te};return rt.withConfig&&(tt.withConfig=rt.withConfig),tt}}function Az(m,g){return void 0}function Pz(m){for(const g in m)return!1;return!0}function Iz(m){return typeof m=="string"&&m.charCodeAt(0)>96}function Dz(m){return m&&m.charAt(0).toLowerCase()+m.slice(1)}function Ax(m,g){const l={...g};for(const c in m)if(Object.prototype.hasOwnProperty.call(m,c)){const _=c;if(_==="components"||_==="slots")l[_]={...m[_],...l[_]};else if(_==="componentsProps"||_==="slotProps"){const A=m[_],N=g[_];if(!N)l[_]=A||{};else if(!A)l[_]=N;else{l[_]={...N};for(const r in A)if(Object.prototype.hasOwnProperty.call(A,r)){const q=r;l[_][q]=Ax(A[q],N[q])}}}else l[_]===void 0&&(l[_]=m[_])}return l}const kz=typeof window<"u"?Ke.useLayoutEffect:Ke.useEffect;function Oz(m,g=Number.MIN_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER){return Math.max(g,Math.min(m,l))}function ab(m,g=0,l=1){return Oz(m,g,l)}function Lz(m){m=m.slice(1);const g=new RegExp(`.{1,${m.length>=6?2:1}}`,"g");let l=m.match(g);return l&&l[0].length===1&&(l=l.map(c=>c+c)),l?`rgb${l.length===4?"a":""}(${l.map((c,_)=>_<3?parseInt(c,16):Math.round(parseInt(c,16)/255*1e3)/1e3).join(", ")})`:""}function Ud(m){if(m.type)return m;if(m.charAt(0)==="#")return Ud(Lz(m));const g=m.indexOf("("),l=m.substring(0,g);if(!["rgb","rgba","hsl","hsla","color"].includes(l))throw new Error(pf(9,m));let c=m.substring(g+1,m.length-1),_;if(l==="color"){if(c=c.split(" "),_=c.shift(),c.length===4&&c[3].charAt(0)==="/"&&(c[3]=c[3].slice(1)),!["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].includes(_))throw new Error(pf(10,_))}else c=c.split(",");return c=c.map(A=>parseFloat(A)),{type:l,values:c,colorSpace:_}}const Rz=m=>{const g=Ud(m);return g.values.slice(0,3).map((l,c)=>g.type.includes("hsl")&&c!==0?`${l}%`:l).join(" ")},$g=(m,g)=>{try{return Rz(m)}catch{return m}};function P0(m){const{type:g,colorSpace:l}=m;let{values:c}=m;return g.includes("rgb")?c=c.map((_,A)=>A<3?parseInt(_,10):_):g.includes("hsl")&&(c[1]=`${c[1]}%`,c[2]=`${c[2]}%`),g.includes("color")?c=`${l} ${c.join(" ")}`:c=`${c.join(", ")}`,`${g}(${c})`}function wM(m){m=Ud(m);const{values:g}=m,l=g[0],c=g[1]/100,_=g[2]/100,A=c*Math.min(_,1-_),N=(ie,ae=(ie+l/30)%12)=>_-A*Math.max(Math.min(ae-3,9-ae,1),-1);let r="rgb";const q=[Math.round(N(0)*255),Math.round(N(8)*255),Math.round(N(4)*255)];return m.type==="hsla"&&(r+="a",q.push(g[3])),P0({type:r,values:q})}function Px(m){m=Ud(m);let g=m.type==="hsl"||m.type==="hsla"?Ud(wM(m)).values:m.values;return g=g.map(l=>(m.type!=="color"&&(l/=255),l<=.03928?l/12.92:((l+.055)/1.055)**2.4)),Number((.2126*g[0]+.7152*g[1]+.0722*g[2]).toFixed(3))}function zz(m,g){const l=Px(m),c=Px(g);return(Math.max(l,c)+.05)/(Math.min(l,c)+.05)}function e_(m,g){return m=Ud(m),g=ab(g),(m.type==="rgb"||m.type==="hsl")&&(m.type+="a"),m.type==="color"?m.values[3]=`/${g}`:m.values[3]=g,P0(m)}function xy(m,g,l){try{return e_(m,g)}catch{return m}}function I0(m,g){if(m=Ud(m),g=ab(g),m.type.includes("hsl"))m.values[2]*=1-g;else if(m.type.includes("rgb")||m.type.includes("color"))for(let l=0;l<3;l+=1)m.values[l]*=1-g;return P0(m)}function Jn(m,g,l){try{return I0(m,g)}catch{return m}}function D0(m,g){if(m=Ud(m),g=ab(g),m.type.includes("hsl"))m.values[2]+=(100-m.values[2])*g;else if(m.type.includes("rgb"))for(let l=0;l<3;l+=1)m.values[l]+=(255-m.values[l])*g;else if(m.type.includes("color"))for(let l=0;l<3;l+=1)m.values[l]+=(1-m.values[l])*g;return P0(m)}function Qn(m,g,l){try{return D0(m,g)}catch{return m}}function Fz(m,g=.15){return Px(m)>.5?I0(m,g):D0(m,g)}function by(m,g,l){try{return Fz(m,g)}catch{return m}}function Bz(m,g){typeof m=="function"?m(g):m&&(m.current=g)}function zy(m){const g=Ke.useRef(m);return kz(()=>{g.current=m}),Ke.useRef((...l)=>(0,g.current)(...l)).current}function vT(...m){return Ke.useMemo(()=>m.every(g=>g==null)?null:g=>{m.forEach(l=>{Bz(l,g)})},m)}const xT={};function SM(m,g){const l=Ke.useRef(xT);return l.current===xT&&(l.current=m(g)),l}const Nz=[];function Vz(m){Ke.useEffect(m,Nz)}class lb{constructor(){Li(this,"currentId",null);Li(this,"clear",()=>{this.currentId!==null&&(clearTimeout(this.currentId),this.currentId=null)});Li(this,"disposeEffect",()=>this.clear)}static create(){return new lb}start(g,l){this.clear(),this.currentId=setTimeout(()=>{this.currentId=null,l()},g)}}function Uz(){const m=SM(lb.create).current;return Vz(m.disposeEffect),m}function bT(m){try{return m.matches(":focus-visible")}catch{}return!1}function mf(m,g,l=void 0){const c={};for(const _ in m){const A=m[_];let N="",r=!0;for(let q=0;q<A.length;q+=1){const ie=A[q];ie&&(N+=(r===!0?"":" ")+g(ie),r=!1,l&&l[ie]&&(N+=" "+l[ie]))}c[_]=N}return c}const jz=Ke.createContext(void 0);function $z(m){const{theme:g,name:l,props:c}=m;if(!g||!g.components||!g.components[l])return c;const _=g.components[l];return _.defaultProps?Ax(_.defaultProps,c):!_.styleOverrides&&!_.variants?Ax(_,c):c}function Gz({props:m,name:g}){const l=Ke.useContext(jz);return $z({props:m,name:g,theme:{components:l}})}const wT={theme:void 0};function Hz(m){let g,l;return function(_){let A=g;return(A===void 0||_.theme!==l)&&(wT.theme=_.theme,A=xM(m(wT)),g=A,l=_.theme),A}}function Wz(m=""){function g(...c){if(!c.length)return"";const _=c[0];return typeof _=="string"&&!_.match(/(#|\(|\)|(-?(\d*\.)?\d+)(px|em|%|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc))|^(-?(\d*\.)?\d+)$|(\d+ \d+ \d+)/)?`, var(--${m?`${m}-`:""}${_}${g(...c.slice(1))})`:`, ${_}`}return(c,..._)=>`var(--${m?`${m}-`:""}${c}${g(..._)})`}const ST=(m,g,l,c=[])=>{let _=m;g.forEach((A,N)=>{N===g.length-1?Array.isArray(_)?_[Number(A)]=l:_&&typeof _=="object"&&(_[A]=l):_&&typeof _=="object"&&(_[A]||(_[A]=c.includes(A)?[]:{}),_=_[A])})},qz=(m,g,l)=>{function c(_,A=[],N=[]){Object.entries(_).forEach(([r,q])=>{(!l||l&&!l([...A,r]))&&q!=null&&(typeof q=="object"&&Object.keys(q).length>0?c(q,[...A,r],Array.isArray(q)?[...N,r]:N):g([...A,r],q,N))})}c(m)},Yz=(m,g)=>typeof g=="number"?["lineHeight","fontWeight","opacity","zIndex"].some(c=>m.includes(c))||m[m.length-1].toLowerCase().includes("opacity")?g:`${g}px`:g;function hx(m,g){const{prefix:l,shouldSkipGeneratingVar:c}=g||{},_={},A={},N={};return qz(m,(r,q,ie)=>{if((typeof q=="string"||typeof q=="number")&&(!c||!c(r,q))){const ae=`--${l?`${l}-`:""}${r.join("-")}`,he=Yz(r,q);Object.assign(_,{[ae]:he}),ST(A,r,`var(${ae})`,ie),ST(N,r,`var(${ae}, ${he})`,ie)}},r=>r[0]==="vars"),{css:_,vars:A,varsWithDefaults:N}}function Xz(m,g={}){const{getSelector:l=Ve,disableCssColorScheme:c,colorSchemeSelector:_}=g,{colorSchemes:A={},components:N,defaultColorScheme:r="light",...q}=m,{vars:ie,css:ae,varsWithDefaults:he}=hx(q,g);let ve=he;const Ae={},{[r]:we,...Pe}=A;if(Object.entries(Pe||{}).forEach(([ht,tt])=>{const{vars:at,css:Rt,varsWithDefaults:Ne}=hx(tt,g);ve=hl(ve,Ne),Ae[ht]={css:Rt,vars:at}}),we){const{css:ht,vars:tt,varsWithDefaults:at}=hx(we,g);ve=hl(ve,at),Ae[r]={css:ht,vars:tt}}function Ve(ht,tt){var Rt,Ne;let at=_;if(_==="class"&&(at=".%s"),_==="data"&&(at="[data-%s]"),_!=null&&_.startsWith("data-")&&!_.includes("%s")&&(at=`[${_}="%s"]`),ht){if(at==="media")return m.defaultColorScheme===ht?":root":{[`@media (prefers-color-scheme: ${((Ne=(Rt=A[ht])==null?void 0:Rt.palette)==null?void 0:Ne.mode)||ht})`]:{":root":tt}};if(at)return m.defaultColorScheme===ht?`:root, ${at.replace("%s",String(ht))}`:at.replace("%s",String(ht))}return":root"}return{vars:ve,generateThemeVars:()=>{let ht={...ie};return Object.entries(Ae).forEach(([,{vars:tt}])=>{ht=hl(ht,tt)}),ht},generateStyleSheets:()=>{var Tt,qt;const ht=[],tt=m.defaultColorScheme||"light";function at(Te,gt){Object.keys(gt).length&&ht.push(typeof Te=="string"?{[Te]:{...gt}}:Te)}at(l(void 0,{...ae}),ae);const{[tt]:Rt,...Ne}=Ae;if(Rt){const{css:Te}=Rt,gt=(qt=(Tt=A[tt])==null?void 0:Tt.palette)==null?void 0:qt.mode,oi=!c&&gt?{colorScheme:gt,...Te}:{...Te};at(l(tt,{...oi}),oi)}return Object.entries(Ne).forEach(([Te,{css:gt}])=>{var ni,Mt;const oi=(Mt=(ni=A[Te])==null?void 0:ni.palette)==null?void 0:Mt.mode,Ti=!c&&oi?{colorScheme:oi,...gt}:{...gt};at(l(Te,{...Ti}),Ti)}),ht}}}function Zz(m){return function(l){return m==="media"?`@media (prefers-color-scheme: ${l})`:m?m.startsWith("data-")&&!m.includes("%s")?`[${m}="${l}"] &`:m==="class"?`.${l} &`:m==="data"?`[data-${l}] &`:`${m.replace("%s",l)} &`:"&"}}function TM(){return{text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:Qg.white,default:Qg.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}}}const Kz=TM();function MM(){return{text:{primary:Qg.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:Qg.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}}}const TT=MM();function MT(m,g,l,c){const _=c.light||c,A=c.dark||c*1.5;m[g]||(m.hasOwnProperty(l)?m[g]=m[l]:g==="light"?m.light=D0(m.main,_):g==="dark"&&(m.dark=I0(m.main,A)))}function Jz(m="light"){return m==="dark"?{main:vm[200],light:vm[50],dark:vm[400]}:{main:vm[700],light:vm[400],dark:vm[800]}}function Qz(m="light"){return m==="dark"?{main:ym[200],light:ym[50],dark:ym[400]}:{main:ym[500],light:ym[300],dark:ym[700]}}function eF(m="light"){return m==="dark"?{main:_m[500],light:_m[300],dark:_m[700]}:{main:_m[700],light:_m[400],dark:_m[800]}}function tF(m="light"){return m==="dark"?{main:xm[400],light:xm[300],dark:xm[700]}:{main:xm[700],light:xm[500],dark:xm[900]}}function iF(m="light"){return m==="dark"?{main:bm[400],light:bm[300],dark:bm[700]}:{main:bm[800],light:bm[500],dark:bm[900]}}function rF(m="light"){return m==="dark"?{main:Bg[400],light:Bg[300],dark:Bg[700]}:{main:"#ed6c02",light:Bg[500],dark:Bg[900]}}function cb(m){const{mode:g="light",contrastThreshold:l=3,tonalOffset:c=.2,..._}=m,A=m.primary||Jz(g),N=m.secondary||Qz(g),r=m.error||eF(g),q=m.info||tF(g),ie=m.success||iF(g),ae=m.warning||rF(g);function he(Pe){return zz(Pe,TT.text.primary)>=l?TT.text.primary:Kz.text.primary}const ve=({color:Pe,name:Ve,mainShade:We=500,lightShade:rt=300,darkShade:ht=700})=>{if(Pe={...Pe},!Pe.main&&Pe[We]&&(Pe.main=Pe[We]),!Pe.hasOwnProperty("main"))throw new Error(pf(11,Ve?` (${Ve})`:"",We));if(typeof Pe.main!="string")throw new Error(pf(12,Ve?` (${Ve})`:"",JSON.stringify(Pe.main)));return MT(Pe,"light",rt,c),MT(Pe,"dark",ht,c),Pe.contrastText||(Pe.contrastText=he(Pe.main)),Pe};let Ae;return g==="light"?Ae=TM():g==="dark"&&(Ae=MM()),hl({common:{...Qg},mode:g,primary:ve({color:A,name:"primary"}),secondary:ve({color:N,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:ve({color:r,name:"error"}),warning:ve({color:ae,name:"warning"}),info:ve({color:q,name:"info"}),success:ve({color:ie,name:"success"}),grey:u3,contrastThreshold:l,getContrastText:he,augmentColor:ve,tonalOffset:c,...Ae},_)}function nF(m){const g={};return Object.entries(m).forEach(c=>{const[_,A]=c;typeof A=="object"&&(g[_]=`${A.fontStyle?`${A.fontStyle} `:""}${A.fontVariant?`${A.fontVariant} `:""}${A.fontWeight?`${A.fontWeight} `:""}${A.fontStretch?`${A.fontStretch} `:""}${A.fontSize||""}${A.lineHeight?`/${A.lineHeight} `:""}${A.fontFamily||""}`)}),g}function sF(m,g){return{toolbar:{minHeight:56,[m.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[m.up("sm")]:{minHeight:64}},...g}}function oF(m){return Math.round(m*1e5)/1e5}const ET={textTransform:"uppercase"},CT='"Roboto", "Helvetica", "Arial", sans-serif';function aF(m,g){const{fontFamily:l=CT,fontSize:c=14,fontWeightLight:_=300,fontWeightRegular:A=400,fontWeightMedium:N=500,fontWeightBold:r=700,htmlFontSize:q=16,allVariants:ie,pxToRem:ae,...he}=typeof g=="function"?g(m):g,ve=c/14,Ae=ae||(Ve=>`${Ve/q*ve}rem`),we=(Ve,We,rt,ht,tt)=>({fontFamily:l,fontWeight:Ve,fontSize:Ae(We),lineHeight:rt,...l===CT?{letterSpacing:`${oF(ht/We)}em`}:{},...tt,...ie}),Pe={h1:we(_,96,1.167,-1.5),h2:we(_,60,1.2,-.5),h3:we(A,48,1.167,0),h4:we(A,34,1.235,.25),h5:we(A,24,1.334,0),h6:we(N,20,1.6,.15),subtitle1:we(A,16,1.75,.15),subtitle2:we(N,14,1.57,.1),body1:we(A,16,1.5,.15),body2:we(A,14,1.43,.15),button:we(N,14,1.75,.4,ET),caption:we(A,12,1.66,.4),overline:we(A,12,2.66,1,ET),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return hl({htmlFontSize:q,pxToRem:Ae,fontFamily:l,fontSize:c,fontWeightLight:_,fontWeightRegular:A,fontWeightMedium:N,fontWeightBold:r,...Pe},he,{clone:!1})}const lF=.2,cF=.14,uF=.12;function ys(...m){return[`${m[0]}px ${m[1]}px ${m[2]}px ${m[3]}px rgba(0,0,0,${lF})`,`${m[4]}px ${m[5]}px ${m[6]}px ${m[7]}px rgba(0,0,0,${cF})`,`${m[8]}px ${m[9]}px ${m[10]}px ${m[11]}px rgba(0,0,0,${uF})`].join(",")}const hF=["none",ys(0,2,1,-1,0,1,1,0,0,1,3,0),ys(0,3,1,-2,0,2,2,0,0,1,5,0),ys(0,3,3,-2,0,3,4,0,0,1,8,0),ys(0,2,4,-1,0,4,5,0,0,1,10,0),ys(0,3,5,-1,0,5,8,0,0,1,14,0),ys(0,3,5,-1,0,6,10,0,0,1,18,0),ys(0,4,5,-2,0,7,10,1,0,2,16,1),ys(0,5,5,-3,0,8,10,1,0,3,14,2),ys(0,5,6,-3,0,9,12,1,0,3,16,2),ys(0,6,6,-3,0,10,14,1,0,4,18,3),ys(0,6,7,-4,0,11,15,1,0,4,20,3),ys(0,7,8,-4,0,12,17,2,0,5,22,4),ys(0,7,8,-4,0,13,19,2,0,5,24,4),ys(0,7,9,-4,0,14,21,2,0,5,26,4),ys(0,8,9,-5,0,15,22,2,0,6,28,5),ys(0,8,10,-5,0,16,24,2,0,6,30,5),ys(0,8,11,-5,0,17,26,2,0,6,32,5),ys(0,9,11,-5,0,18,28,2,0,7,34,6),ys(0,9,12,-6,0,19,29,2,0,7,36,6),ys(0,10,13,-6,0,20,31,3,0,8,38,7),ys(0,10,13,-6,0,21,33,3,0,8,40,7),ys(0,10,14,-6,0,22,35,3,0,8,42,7),ys(0,11,14,-7,0,23,36,3,0,9,44,8),ys(0,11,15,-7,0,24,38,3,0,9,46,8)],dF={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},pF={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function AT(m){return`${Math.round(m)}ms`}function fF(m){if(!m)return 0;const g=m/36;return Math.min(Math.round((4+15*g**.25+g/5)*10),3e3)}function mF(m){const g={...dF,...m.easing},l={...pF,...m.duration};return{getAutoHeightDuration:fF,create:(_=["all"],A={})=>{const{duration:N=l.standard,easing:r=g.easeInOut,delay:q=0,...ie}=A;return(Array.isArray(_)?_:[_]).map(ae=>`${ae} ${typeof N=="string"?N:AT(N)} ${r} ${typeof q=="string"?q:AT(q)}`).join(",")},...m,easing:g,duration:l}}const gF={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};function _F(m){return Fu(m)||typeof m>"u"||typeof m=="string"||typeof m=="boolean"||typeof m=="number"||Array.isArray(m)}function EM(m={}){const g={...m};function l(c){const _=Object.entries(c);for(let A=0;A<_.length;A++){const[N,r]=_[A];!_F(r)||N.startsWith("unstable_")?delete c[N]:Fu(r)&&(c[N]={...r},l(c[N]))}}return l(g),`import { unstable_createBreakpoints as createBreakpoints, createTransitions } from '@mui/material/styles';

const theme = ${JSON.stringify(g,null,2)};

theme.breakpoints = createBreakpoints(theme.breakpoints || {});
theme.transitions = createTransitions(theme.transitions || {});

export default theme;`}function Ix(m={},...g){const{breakpoints:l,mixins:c={},spacing:_,palette:A={},transitions:N={},typography:r={},shape:q,...ie}=m;if(m.vars&&m.generateThemeVars===void 0)throw new Error(pf(20));const ae=cb(A),he=vM(m);let ve=hl(he,{mixins:sF(he.breakpoints,c),palette:ae,shadows:hF.slice(),typography:aF(ae,r),transitions:mF(N),zIndex:{...gF}});return ve=hl(ve,ie),ve=g.reduce((Ae,we)=>hl(Ae,we),ve),ve.unstable_sxConfig={...u_,...ie==null?void 0:ie.unstable_sxConfig},ve.unstable_sx=function(we){return Rm({sx:we,theme:this})},ve.toRuntimeSource=EM,ve}function yF(m){let g;return m<1?g=5.11916*m**2:g=4.5*Math.log(m+1)+2,Math.round(g*10)/1e3}const vF=[...Array(25)].map((m,g)=>{if(g===0)return"none";const l=yF(g);return`linear-gradient(rgba(255 255 255 / ${l}), rgba(255 255 255 / ${l}))`});function CM(m){return{inputPlaceholder:m==="dark"?.5:.42,inputUnderline:m==="dark"?.7:.42,switchTrackDisabled:m==="dark"?.2:.12,switchTrack:m==="dark"?.3:.38}}function AM(m){return m==="dark"?vF:[]}function xF(m){const{palette:g={mode:"light"},opacity:l,overlays:c,..._}=m,A=cb(g);return{palette:A,opacity:{...CM(A.mode),...l},overlays:c||AM(A.mode),..._}}function bF(m){var g;return!!m[0].match(/(cssVarPrefix|colorSchemeSelector|rootSelector|typography|mixins|breakpoints|direction|transitions)/)||!!m[0].match(/sxConfig$/)||m[0]==="palette"&&!!((g=m[1])!=null&&g.match(/(mode|contrastThreshold|tonalOffset)/))}const wF=m=>[...[...Array(25)].map((g,l)=>`--${m?`${m}-`:""}overlays-${l}`),`--${m?`${m}-`:""}palette-AppBar-darkBg`,`--${m?`${m}-`:""}palette-AppBar-darkColor`],SF=m=>(g,l)=>{const c=m.rootSelector||":root",_=m.colorSchemeSelector;let A=_;if(_==="class"&&(A=".%s"),_==="data"&&(A="[data-%s]"),_!=null&&_.startsWith("data-")&&!_.includes("%s")&&(A=`[${_}="%s"]`),m.defaultColorScheme===g){if(g==="dark"){const N={};return wF(m.cssVarPrefix).forEach(r=>{N[r]=l[r],delete l[r]}),A==="media"?{[c]:l,"@media (prefers-color-scheme: dark)":{[c]:N}}:A?{[A.replace("%s",g)]:N,[`${c}, ${A.replace("%s",g)}`]:l}:{[c]:{...l,...N}}}if(A&&A!=="media")return`${c}, ${A.replace("%s",String(g))}`}else if(g){if(A==="media")return{[`@media (prefers-color-scheme: ${String(g)})`]:{[c]:l}};if(A)return A.replace("%s",String(g))}return c};function TF(m,g){g.forEach(l=>{m[l]||(m[l]={})})}function ri(m,g,l){!m[g]&&l&&(m[g]=l)}function Gg(m){return typeof m!="string"||!m.startsWith("hsl")?m:wM(m)}function Th(m,g){`${g}Channel`in m||(m[`${g}Channel`]=$g(Gg(m[g])))}function MF(m){return typeof m=="number"?`${m}px`:typeof m=="string"||typeof m=="function"||Array.isArray(m)?m:"8px"}const Pu=m=>{try{return m()}catch{}},EF=(m="mui")=>Wz(m);function dx(m,g,l,c){if(!g)return;g=g===!0?{}:g;const _=c==="dark"?"dark":"light";if(!l){m[c]=xF({...g,palette:{mode:_,...g==null?void 0:g.palette}});return}const{palette:A,...N}=Ix({...l,palette:{mode:_,...g==null?void 0:g.palette}});return m[c]={...g,palette:A,opacity:{...CM(_),...g==null?void 0:g.opacity},overlays:(g==null?void 0:g.overlays)||AM(_)},N}function CF(m={},...g){const{colorSchemes:l={light:!0},defaultColorScheme:c,disableCssColorScheme:_=!1,cssVarPrefix:A="mui",shouldSkipGeneratingVar:N=bF,colorSchemeSelector:r=l.light&&l.dark?"media":void 0,rootSelector:q=":root",...ie}=m,ae=Object.keys(l)[0],he=c||(l.light&&ae!=="light"?"light":ae),ve=EF(A),{[he]:Ae,light:we,dark:Pe,...Ve}=l,We={...Ve};let rt=Ae;if((he==="dark"&&!("dark"in l)||he==="light"&&!("light"in l))&&(rt=!0),!rt)throw new Error(pf(21,he));const ht=dx(We,rt,ie,he);we&&!We.light&&dx(We,we,void 0,"light"),Pe&&!We.dark&&dx(We,Pe,void 0,"dark");let tt={defaultColorScheme:he,...ht,cssVarPrefix:A,colorSchemeSelector:r,rootSelector:q,getCssVar:ve,colorSchemes:We,font:{...nF(ht.typography),...ht.font},spacing:MF(ie.spacing)};Object.keys(tt.colorSchemes).forEach(qt=>{const Te=tt.colorSchemes[qt].palette,gt=oi=>{const Ti=oi.split("-"),ni=Ti[1],Mt=Ti[2];return ve(oi,Te[ni][Mt])};if(Te.mode==="light"&&(ri(Te.common,"background","#fff"),ri(Te.common,"onBackground","#000")),Te.mode==="dark"&&(ri(Te.common,"background","#000"),ri(Te.common,"onBackground","#fff")),TF(Te,["Alert","AppBar","Avatar","Button","Chip","FilledInput","LinearProgress","Skeleton","Slider","SnackbarContent","SpeedDialAction","StepConnector","StepContent","Switch","TableCell","Tooltip"]),Te.mode==="light"){ri(Te.Alert,"errorColor",Jn(Te.error.light,.6)),ri(Te.Alert,"infoColor",Jn(Te.info.light,.6)),ri(Te.Alert,"successColor",Jn(Te.success.light,.6)),ri(Te.Alert,"warningColor",Jn(Te.warning.light,.6)),ri(Te.Alert,"errorFilledBg",gt("palette-error-main")),ri(Te.Alert,"infoFilledBg",gt("palette-info-main")),ri(Te.Alert,"successFilledBg",gt("palette-success-main")),ri(Te.Alert,"warningFilledBg",gt("palette-warning-main")),ri(Te.Alert,"errorFilledColor",Pu(()=>Te.getContrastText(Te.error.main))),ri(Te.Alert,"infoFilledColor",Pu(()=>Te.getContrastText(Te.info.main))),ri(Te.Alert,"successFilledColor",Pu(()=>Te.getContrastText(Te.success.main))),ri(Te.Alert,"warningFilledColor",Pu(()=>Te.getContrastText(Te.warning.main))),ri(Te.Alert,"errorStandardBg",Qn(Te.error.light,.9)),ri(Te.Alert,"infoStandardBg",Qn(Te.info.light,.9)),ri(Te.Alert,"successStandardBg",Qn(Te.success.light,.9)),ri(Te.Alert,"warningStandardBg",Qn(Te.warning.light,.9)),ri(Te.Alert,"errorIconColor",gt("palette-error-main")),ri(Te.Alert,"infoIconColor",gt("palette-info-main")),ri(Te.Alert,"successIconColor",gt("palette-success-main")),ri(Te.Alert,"warningIconColor",gt("palette-warning-main")),ri(Te.AppBar,"defaultBg",gt("palette-grey-100")),ri(Te.Avatar,"defaultBg",gt("palette-grey-400")),ri(Te.Button,"inheritContainedBg",gt("palette-grey-300")),ri(Te.Button,"inheritContainedHoverBg",gt("palette-grey-A100")),ri(Te.Chip,"defaultBorder",gt("palette-grey-400")),ri(Te.Chip,"defaultAvatarColor",gt("palette-grey-700")),ri(Te.Chip,"defaultIconColor",gt("palette-grey-700")),ri(Te.FilledInput,"bg","rgba(0, 0, 0, 0.06)"),ri(Te.FilledInput,"hoverBg","rgba(0, 0, 0, 0.09)"),ri(Te.FilledInput,"disabledBg","rgba(0, 0, 0, 0.12)"),ri(Te.LinearProgress,"primaryBg",Qn(Te.primary.main,.62)),ri(Te.LinearProgress,"secondaryBg",Qn(Te.secondary.main,.62)),ri(Te.LinearProgress,"errorBg",Qn(Te.error.main,.62)),ri(Te.LinearProgress,"infoBg",Qn(Te.info.main,.62)),ri(Te.LinearProgress,"successBg",Qn(Te.success.main,.62)),ri(Te.LinearProgress,"warningBg",Qn(Te.warning.main,.62)),ri(Te.Skeleton,"bg",`rgba(${gt("palette-text-primaryChannel")} / 0.11)`),ri(Te.Slider,"primaryTrack",Qn(Te.primary.main,.62)),ri(Te.Slider,"secondaryTrack",Qn(Te.secondary.main,.62)),ri(Te.Slider,"errorTrack",Qn(Te.error.main,.62)),ri(Te.Slider,"infoTrack",Qn(Te.info.main,.62)),ri(Te.Slider,"successTrack",Qn(Te.success.main,.62)),ri(Te.Slider,"warningTrack",Qn(Te.warning.main,.62));const oi=by(Te.background.default,.8);ri(Te.SnackbarContent,"bg",oi),ri(Te.SnackbarContent,"color",Pu(()=>Te.getContrastText(oi))),ri(Te.SpeedDialAction,"fabHoverBg",by(Te.background.paper,.15)),ri(Te.StepConnector,"border",gt("palette-grey-400")),ri(Te.StepContent,"border",gt("palette-grey-400")),ri(Te.Switch,"defaultColor",gt("palette-common-white")),ri(Te.Switch,"defaultDisabledColor",gt("palette-grey-100")),ri(Te.Switch,"primaryDisabledColor",Qn(Te.primary.main,.62)),ri(Te.Switch,"secondaryDisabledColor",Qn(Te.secondary.main,.62)),ri(Te.Switch,"errorDisabledColor",Qn(Te.error.main,.62)),ri(Te.Switch,"infoDisabledColor",Qn(Te.info.main,.62)),ri(Te.Switch,"successDisabledColor",Qn(Te.success.main,.62)),ri(Te.Switch,"warningDisabledColor",Qn(Te.warning.main,.62)),ri(Te.TableCell,"border",Qn(xy(Te.divider,1),.88)),ri(Te.Tooltip,"bg",xy(Te.grey[700],.92))}if(Te.mode==="dark"){ri(Te.Alert,"errorColor",Qn(Te.error.light,.6)),ri(Te.Alert,"infoColor",Qn(Te.info.light,.6)),ri(Te.Alert,"successColor",Qn(Te.success.light,.6)),ri(Te.Alert,"warningColor",Qn(Te.warning.light,.6)),ri(Te.Alert,"errorFilledBg",gt("palette-error-dark")),ri(Te.Alert,"infoFilledBg",gt("palette-info-dark")),ri(Te.Alert,"successFilledBg",gt("palette-success-dark")),ri(Te.Alert,"warningFilledBg",gt("palette-warning-dark")),ri(Te.Alert,"errorFilledColor",Pu(()=>Te.getContrastText(Te.error.dark))),ri(Te.Alert,"infoFilledColor",Pu(()=>Te.getContrastText(Te.info.dark))),ri(Te.Alert,"successFilledColor",Pu(()=>Te.getContrastText(Te.success.dark))),ri(Te.Alert,"warningFilledColor",Pu(()=>Te.getContrastText(Te.warning.dark))),ri(Te.Alert,"errorStandardBg",Jn(Te.error.light,.9)),ri(Te.Alert,"infoStandardBg",Jn(Te.info.light,.9)),ri(Te.Alert,"successStandardBg",Jn(Te.success.light,.9)),ri(Te.Alert,"warningStandardBg",Jn(Te.warning.light,.9)),ri(Te.Alert,"errorIconColor",gt("palette-error-main")),ri(Te.Alert,"infoIconColor",gt("palette-info-main")),ri(Te.Alert,"successIconColor",gt("palette-success-main")),ri(Te.Alert,"warningIconColor",gt("palette-warning-main")),ri(Te.AppBar,"defaultBg",gt("palette-grey-900")),ri(Te.AppBar,"darkBg",gt("palette-background-paper")),ri(Te.AppBar,"darkColor",gt("palette-text-primary")),ri(Te.Avatar,"defaultBg",gt("palette-grey-600")),ri(Te.Button,"inheritContainedBg",gt("palette-grey-800")),ri(Te.Button,"inheritContainedHoverBg",gt("palette-grey-700")),ri(Te.Chip,"defaultBorder",gt("palette-grey-700")),ri(Te.Chip,"defaultAvatarColor",gt("palette-grey-300")),ri(Te.Chip,"defaultIconColor",gt("palette-grey-300")),ri(Te.FilledInput,"bg","rgba(255, 255, 255, 0.09)"),ri(Te.FilledInput,"hoverBg","rgba(255, 255, 255, 0.13)"),ri(Te.FilledInput,"disabledBg","rgba(255, 255, 255, 0.12)"),ri(Te.LinearProgress,"primaryBg",Jn(Te.primary.main,.5)),ri(Te.LinearProgress,"secondaryBg",Jn(Te.secondary.main,.5)),ri(Te.LinearProgress,"errorBg",Jn(Te.error.main,.5)),ri(Te.LinearProgress,"infoBg",Jn(Te.info.main,.5)),ri(Te.LinearProgress,"successBg",Jn(Te.success.main,.5)),ri(Te.LinearProgress,"warningBg",Jn(Te.warning.main,.5)),ri(Te.Skeleton,"bg",`rgba(${gt("palette-text-primaryChannel")} / 0.13)`),ri(Te.Slider,"primaryTrack",Jn(Te.primary.main,.5)),ri(Te.Slider,"secondaryTrack",Jn(Te.secondary.main,.5)),ri(Te.Slider,"errorTrack",Jn(Te.error.main,.5)),ri(Te.Slider,"infoTrack",Jn(Te.info.main,.5)),ri(Te.Slider,"successTrack",Jn(Te.success.main,.5)),ri(Te.Slider,"warningTrack",Jn(Te.warning.main,.5));const oi=by(Te.background.default,.98);ri(Te.SnackbarContent,"bg",oi),ri(Te.SnackbarContent,"color",Pu(()=>Te.getContrastText(oi))),ri(Te.SpeedDialAction,"fabHoverBg",by(Te.background.paper,.15)),ri(Te.StepConnector,"border",gt("palette-grey-600")),ri(Te.StepContent,"border",gt("palette-grey-600")),ri(Te.Switch,"defaultColor",gt("palette-grey-300")),ri(Te.Switch,"defaultDisabledColor",gt("palette-grey-600")),ri(Te.Switch,"primaryDisabledColor",Jn(Te.primary.main,.55)),ri(Te.Switch,"secondaryDisabledColor",Jn(Te.secondary.main,.55)),ri(Te.Switch,"errorDisabledColor",Jn(Te.error.main,.55)),ri(Te.Switch,"infoDisabledColor",Jn(Te.info.main,.55)),ri(Te.Switch,"successDisabledColor",Jn(Te.success.main,.55)),ri(Te.Switch,"warningDisabledColor",Jn(Te.warning.main,.55)),ri(Te.TableCell,"border",Jn(xy(Te.divider,1),.68)),ri(Te.Tooltip,"bg",xy(Te.grey[700],.92))}Th(Te.background,"default"),Th(Te.background,"paper"),Th(Te.common,"background"),Th(Te.common,"onBackground"),Th(Te,"divider"),Object.keys(Te).forEach(oi=>{const Ti=Te[oi];oi!=="tonalOffset"&&Ti&&typeof Ti=="object"&&(Ti.main&&ri(Te[oi],"mainChannel",$g(Gg(Ti.main))),Ti.light&&ri(Te[oi],"lightChannel",$g(Gg(Ti.light))),Ti.dark&&ri(Te[oi],"darkChannel",$g(Gg(Ti.dark))),Ti.contrastText&&ri(Te[oi],"contrastTextChannel",$g(Gg(Ti.contrastText))),oi==="text"&&(Th(Te[oi],"primary"),Th(Te[oi],"secondary")),oi==="action"&&(Ti.active&&Th(Te[oi],"active"),Ti.selected&&Th(Te[oi],"selected")))})}),tt=g.reduce((qt,Te)=>hl(qt,Te),tt);const at={prefix:A,disableCssColorScheme:_,shouldSkipGeneratingVar:N,getSelector:SF(tt)},{vars:Rt,generateThemeVars:Ne,generateStyleSheets:Tt}=Xz(tt,at);return tt.vars=Rt,Object.entries(tt.colorSchemes[tt.defaultColorScheme]).forEach(([qt,Te])=>{tt[qt]=Te}),tt.generateThemeVars=Ne,tt.generateStyleSheets=Tt,tt.generateSpacing=function(){return yM(ie.spacing,sb(this))},tt.getColorSchemeSelector=Zz(r),tt.spacing=tt.generateSpacing(),tt.shouldSkipGeneratingVar=N,tt.unstable_sxConfig={...u_,...ie==null?void 0:ie.unstable_sxConfig},tt.unstable_sx=function(Te){return Rm({sx:Te,theme:this})},tt.toRuntimeSource=EM,tt}function PT(m,g,l){m.colorSchemes&&l&&(m.colorSchemes[g]={...l!==!0&&l,palette:cb({...l===!0?{}:l.palette,mode:g})})}function AF(m={},...g){const{palette:l,cssVariables:c=!1,colorSchemes:_=l?void 0:{light:!0},defaultColorScheme:A=l==null?void 0:l.mode,...N}=m,r=A||"light",q=_==null?void 0:_[r],ie={..._,...l?{[r]:{...typeof q!="boolean"&&q,palette:l}}:void 0};if(c===!1){if(!("colorSchemes"in m))return Ix(m,...g);let ae=l;"palette"in m||ie[r]&&(ie[r]!==!0?ae=ie[r].palette:r==="dark"&&(ae={mode:"dark"}));const he=Ix({...m,palette:ae},...g);return he.defaultColorScheme=r,he.colorSchemes=ie,he.palette.mode==="light"&&(he.colorSchemes.light={...ie.light!==!0&&ie.light,palette:he.palette},PT(he,"dark",ie.dark)),he.palette.mode==="dark"&&(he.colorSchemes.dark={...ie.dark!==!0&&ie.dark,palette:he.palette},PT(he,"light",ie.light)),he}return!l&&!("light"in ie)&&r==="light"&&(ie.light=!0),CF({...N,colorSchemes:ie,defaultColorScheme:r,...typeof c!="boolean"&&c},...g)}const PF=AF();function IF(m){return m!=="ownerState"&&m!=="theme"&&m!=="sx"&&m!=="as"}const DF=m=>IF(m)&&m!=="classes",Bc=Cz({themeId:h3,defaultTheme:PF,rootShouldForwardProp:DF});function kF(){return xz}const Nm=Hz;function Gd(m){return Gz(m)}function OF(m,g){m.prototype=Object.create(g.prototype),m.prototype.constructor=m,Ny(m,g)}const IT=Qt.createContext(null);function ub(m,g){var l=function(A){return g&&Ke.isValidElement(A)?g(A):A},c=Object.create(null);return m&&Ke.Children.map(m,function(_){return _}).forEach(function(_){c[_.key]=l(_)}),c}function LF(m,g){m=m||{},g=g||{};function l(ae){return ae in g?g[ae]:m[ae]}var c=Object.create(null),_=[];for(var A in m)A in g?_.length&&(c[A]=_,_=[]):_.push(A);var N,r={};for(var q in g){if(c[q])for(N=0;N<c[q].length;N++){var ie=c[q][N];r[c[q][N]]=l(ie)}r[q]=l(q)}for(N=0;N<_.length;N++)r[_[N]]=l(_[N]);return r}function sf(m,g,l){return l[g]!=null?l[g]:m.props[g]}function RF(m,g){return ub(m.children,function(l){return Ke.cloneElement(l,{onExited:g.bind(null,l),in:!0,appear:sf(l,"appear",m),enter:sf(l,"enter",m),exit:sf(l,"exit",m)})})}function zF(m,g,l){var c=ub(m.children),_=LF(g,c);return Object.keys(_).forEach(function(A){var N=_[A];if(Ke.isValidElement(N)){var r=A in g,q=A in c,ie=g[A],ae=Ke.isValidElement(ie)&&!ie.props.in;q&&(!r||ae)?_[A]=Ke.cloneElement(N,{onExited:l.bind(null,N),in:!0,exit:sf(N,"exit",m),enter:sf(N,"enter",m)}):!q&&r&&!ae?_[A]=Ke.cloneElement(N,{in:!1}):q&&r&&Ke.isValidElement(ie)&&(_[A]=Ke.cloneElement(N,{onExited:l.bind(null,N),in:ie.props.in,exit:sf(N,"exit",m),enter:sf(N,"enter",m)}))}}),_}var FF=Object.values||function(m){return Object.keys(m).map(function(g){return m[g]})},BF={component:"div",childFactory:function(g){return g}},hb=function(m){OF(g,m);function g(c,_){var A;A=m.call(this,c,_)||this;var N=A.handleExited.bind(WT(A));return A.state={contextValue:{isMounting:!0},handleExited:N,firstRender:!0},A}var l=g.prototype;return l.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},l.componentWillUnmount=function(){this.mounted=!1},g.getDerivedStateFromProps=function(_,A){var N=A.children,r=A.handleExited,q=A.firstRender;return{children:q?RF(_,r):zF(_,N,r),firstRender:!1}},l.handleExited=function(_,A){var N=ub(this.props.children);_.key in N||(_.props.onExited&&_.props.onExited(A),this.mounted&&this.setState(function(r){var q=yr({},r.children);return delete q[_.key],{children:q}}))},l.render=function(){var _=this.props,A=_.component,N=_.childFactory,r=GT(_,["component","childFactory"]),q=this.state.contextValue,ie=FF(this.state.children).map(N);return delete r.appear,delete r.enter,delete r.exit,A===null?Qt.createElement(IT.Provider,{value:q},ie):Qt.createElement(IT.Provider,{value:q},Qt.createElement(A,r,ie))},g}(Qt.Component);hb.propTypes={};hb.defaultProps=BF;class s0{constructor(){Li(this,"mountEffect",()=>{this.shouldMount&&!this.didMount&&this.ref.current!==null&&(this.didMount=!0,this.mounted.resolve())});this.ref={current:null},this.mounted=null,this.didMount=!1,this.shouldMount=!1,this.setShouldMount=null}static create(){return new s0}static use(){const g=SM(s0.create).current,[l,c]=Ke.useState(!1);return g.shouldMount=l,g.setShouldMount=c,Ke.useEffect(g.mountEffect,[l]),g}mount(){return this.mounted||(this.mounted=VF(),this.shouldMount=!0,this.setShouldMount(this.shouldMount)),this.mounted}start(...g){this.mount().then(()=>{var l;return(l=this.ref.current)==null?void 0:l.start(...g)})}stop(...g){this.mount().then(()=>{var l;return(l=this.ref.current)==null?void 0:l.stop(...g)})}pulsate(...g){this.mount().then(()=>{var l;return(l=this.ref.current)==null?void 0:l.pulsate(...g)})}}function NF(){return s0.use()}function VF(){let m,g;const l=new Promise((c,_)=>{m=c,g=_});return l.resolve=m,l.reject=g,l}function UF(m){const{className:g,classes:l,pulsate:c=!1,rippleX:_,rippleY:A,rippleSize:N,in:r,onExited:q,timeout:ie}=m,[ae,he]=Ke.useState(!1),ve=gn(g,l.ripple,l.rippleVisible,c&&l.ripplePulsate),Ae={width:N,height:N,top:-(N/2)+A,left:-(N/2)+_},we=gn(l.child,ae&&l.childLeaving,c&&l.childPulsate);return!r&&!ae&&he(!0),Ke.useEffect(()=>{if(!r&&q!=null){const Pe=setTimeout(q,ie);return()=>{clearTimeout(Pe)}}},[q,r,ie]),gi.jsx("span",{className:ve,style:Ae,children:gi.jsx("span",{className:we})})}const ql=$d("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),Dx=550,jF=80,$F=Fm`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`,GF=Fm`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`,HF=Fm`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`,WF=Bc("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),qF=Bc(UF,{name:"MuiTouchRipple",slot:"Ripple"})`
  opacity: 0;
  position: absolute;

  &.${ql.rippleVisible} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${$F};
    animation-duration: ${Dx}ms;
    animation-timing-function: ${({theme:m})=>m.transitions.easing.easeInOut};
  }

  &.${ql.ripplePulsate} {
    animation-duration: ${({theme:m})=>m.transitions.duration.shorter}ms;
  }

  & .${ql.child} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${ql.childLeaving} {
    opacity: 0;
    animation-name: ${GF};
    animation-duration: ${Dx}ms;
    animation-timing-function: ${({theme:m})=>m.transitions.easing.easeInOut};
  }

  & .${ql.childPulsate} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${HF};
    animation-duration: 2500ms;
    animation-timing-function: ${({theme:m})=>m.transitions.easing.easeInOut};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`,YF=Ke.forwardRef(function(g,l){const c=Gd({props:g,name:"MuiTouchRipple"}),{center:_=!1,classes:A={},className:N,...r}=c,[q,ie]=Ke.useState([]),ae=Ke.useRef(0),he=Ke.useRef(null);Ke.useEffect(()=>{he.current&&(he.current(),he.current=null)},[q]);const ve=Ke.useRef(!1),Ae=Uz(),we=Ke.useRef(null),Pe=Ke.useRef(null),Ve=Ke.useCallback(tt=>{const{pulsate:at,rippleX:Rt,rippleY:Ne,rippleSize:Tt,cb:qt}=tt;ie(Te=>[...Te,gi.jsx(qF,{classes:{ripple:gn(A.ripple,ql.ripple),rippleVisible:gn(A.rippleVisible,ql.rippleVisible),ripplePulsate:gn(A.ripplePulsate,ql.ripplePulsate),child:gn(A.child,ql.child),childLeaving:gn(A.childLeaving,ql.childLeaving),childPulsate:gn(A.childPulsate,ql.childPulsate)},timeout:Dx,pulsate:at,rippleX:Rt,rippleY:Ne,rippleSize:Tt},ae.current)]),ae.current+=1,he.current=qt},[A]),We=Ke.useCallback((tt={},at={},Rt=()=>{})=>{const{pulsate:Ne=!1,center:Tt=_||at.pulsate,fakeElement:qt=!1}=at;if((tt==null?void 0:tt.type)==="mousedown"&&ve.current){ve.current=!1;return}(tt==null?void 0:tt.type)==="touchstart"&&(ve.current=!0);const Te=qt?null:Pe.current,gt=Te?Te.getBoundingClientRect():{width:0,height:0,left:0,top:0};let oi,Ti,ni;if(Tt||tt===void 0||tt.clientX===0&&tt.clientY===0||!tt.clientX&&!tt.touches)oi=Math.round(gt.width/2),Ti=Math.round(gt.height/2);else{const{clientX:Mt,clientY:zt}=tt.touches&&tt.touches.length>0?tt.touches[0]:tt;oi=Math.round(Mt-gt.left),Ti=Math.round(zt-gt.top)}if(Tt)ni=Math.sqrt((2*gt.width**2+gt.height**2)/3),ni%2===0&&(ni+=1);else{const Mt=Math.max(Math.abs((Te?Te.clientWidth:0)-oi),oi)*2+2,zt=Math.max(Math.abs((Te?Te.clientHeight:0)-Ti),Ti)*2+2;ni=Math.sqrt(Mt**2+zt**2)}tt!=null&&tt.touches?we.current===null&&(we.current=()=>{Ve({pulsate:Ne,rippleX:oi,rippleY:Ti,rippleSize:ni,cb:Rt})},Ae.start(jF,()=>{we.current&&(we.current(),we.current=null)})):Ve({pulsate:Ne,rippleX:oi,rippleY:Ti,rippleSize:ni,cb:Rt})},[_,Ve,Ae]),rt=Ke.useCallback(()=>{We({},{pulsate:!0})},[We]),ht=Ke.useCallback((tt,at)=>{if(Ae.clear(),(tt==null?void 0:tt.type)==="touchend"&&we.current){we.current(),we.current=null,Ae.start(0,()=>{ht(tt,at)});return}we.current=null,ie(Rt=>Rt.length>0?Rt.slice(1):Rt),he.current=at},[Ae]);return Ke.useImperativeHandle(l,()=>({pulsate:rt,start:We,stop:ht}),[rt,We,ht]),gi.jsx(WF,{className:gn(ql.root,A.root,N),ref:Pe,...r,children:gi.jsx(hb,{component:null,exit:!0,children:q})})});function XF(m){return jd("MuiButtonBase",m)}const ZF=$d("MuiButtonBase",["root","disabled","focusVisible"]),KF=m=>{const{disabled:g,focusVisible:l,focusVisibleClassName:c,classes:_}=m,N=mf({root:["root",g&&"disabled",l&&"focusVisible"]},XF,_);return l&&c&&(N.root+=` ${c}`),N},JF=Bc("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(m,g)=>g.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${ZF.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),QF=Ke.forwardRef(function(g,l){const c=Gd({props:g,name:"MuiButtonBase"}),{action:_,centerRipple:A=!1,children:N,className:r,component:q="button",disabled:ie=!1,disableRipple:ae=!1,disableTouchRipple:he=!1,focusRipple:ve=!1,focusVisibleClassName:Ae,LinkComponent:we="a",onBlur:Pe,onClick:Ve,onContextMenu:We,onDragLeave:rt,onFocus:ht,onFocusVisible:tt,onKeyDown:at,onKeyUp:Rt,onMouseDown:Ne,onMouseLeave:Tt,onMouseUp:qt,onTouchEnd:Te,onTouchMove:gt,onTouchStart:oi,tabIndex:Ti=0,TouchRippleProps:ni,touchRippleRef:Mt,type:zt,...ii}=c,Yt=Ke.useRef(null),jt=NF(),Ri=vT(jt.ref,Mt),[Yi,Wi]=Ke.useState(!1);ie&&Yi&&Wi(!1),Ke.useImperativeHandle(_,()=>({focusVisible:()=>{Wi(!0),Yt.current.focus()}}),[]);const vi=jt.shouldMount&&!ae&&!ie;Ke.useEffect(()=>{Yi&&ve&&!ae&&jt.pulsate()},[ae,ve,Yi,jt]);const Wr=Mh(jt,"start",Ne,he),an=Mh(jt,"stop",We,he),_n=Mh(jt,"stop",rt,he),Cn=Mh(jt,"stop",qt,he),qr=Mh(jt,"stop",xr=>{Yi&&xr.preventDefault(),Tt&&Tt(xr)},he),es=Mh(jt,"start",oi,he),Ye=Mh(jt,"stop",Te,he),ds=Mh(jt,"stop",gt,he),Bi=Mh(jt,"stop",xr=>{bT(xr.target)||Wi(!1),Pe&&Pe(xr)},!1),Xs=zy(xr=>{Yt.current||(Yt.current=xr.currentTarget),bT(xr.target)&&(Wi(!0),tt&&tt(xr)),ht&&ht(xr)}),Wt=()=>{const xr=Yt.current;return q&&q!=="button"&&!(xr.tagName==="A"&&xr.href)},jn=zy(xr=>{ve&&!xr.repeat&&Yi&&xr.key===" "&&jt.stop(xr,()=>{jt.start(xr)}),xr.target===xr.currentTarget&&Wt()&&xr.key===" "&&xr.preventDefault(),at&&at(xr),xr.target===xr.currentTarget&&Wt()&&xr.key==="Enter"&&!ie&&(xr.preventDefault(),Ve&&Ve(xr))}),As=zy(xr=>{ve&&xr.key===" "&&Yi&&!xr.defaultPrevented&&jt.stop(xr,()=>{jt.pulsate(xr)}),Rt&&Rt(xr),Ve&&xr.target===xr.currentTarget&&Wt()&&xr.key===" "&&!xr.defaultPrevented&&Ve(xr)});let mo=q;mo==="button"&&(ii.href||ii.to)&&(mo=we);const rr={};mo==="button"?(rr.type=zt===void 0?"button":zt,rr.disabled=ie):(!ii.href&&!ii.to&&(rr.role="button"),ie&&(rr["aria-disabled"]=ie));const $n=vT(l,Yt),xs={...c,centerRipple:A,component:q,disabled:ie,disableRipple:ae,disableTouchRipple:he,focusRipple:ve,tabIndex:Ti,focusVisible:Yi},Ea=KF(xs);return gi.jsxs(JF,{as:mo,className:gn(Ea.root,r),ownerState:xs,onBlur:Bi,onClick:Ve,onContextMenu:an,onFocus:Xs,onKeyDown:jn,onKeyUp:As,onMouseDown:Wr,onMouseLeave:qr,onMouseUp:Cn,onDragLeave:_n,onTouchEnd:Ye,onTouchMove:ds,onTouchStart:es,ref:$n,tabIndex:ie?-1:Ti,type:zt,...rr,...ii,children:[N,vi?gi.jsx(YF,{ref:Ri,center:A,...ni}):null]})});function Mh(m,g,l,c=!1){return zy(_=>(l&&l(_),c||m[g](_),!0))}function eB(m){return typeof m.main=="string"}function tB(m,g=[]){if(!eB(m))return!1;for(const l of g)if(!m.hasOwnProperty(l)||typeof m[l]!="string")return!1;return!0}function PM(m=[]){return([,g])=>g&&tB(g,m)}function iB(m){return jd("MuiCircularProgress",m)}$d("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);const Rd=44,kx=Fm`
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
`,Ox=Fm`
  0% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: 0;
  }

  50% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -15px;
  }

  100% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: -126px;
  }
`,rB=typeof kx!="string"?r_`
        animation: ${kx} 1.4s linear infinite;
      `:null,nB=typeof Ox!="string"?r_`
        animation: ${Ox} 1.4s ease-in-out infinite;
      `:null,sB=m=>{const{classes:g,variant:l,color:c,disableShrink:_}=m,A={root:["root",l,`color${Ma(c)}`],svg:["svg"],circle:["circle",`circle${Ma(l)}`,_&&"circleDisableShrink"]};return mf(A,iB,g)},oB=Bc("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(m,g)=>{const{ownerState:l}=m;return[g.root,g[l.variant],g[`color${Ma(l.color)}`]]}})(Nm(({theme:m})=>({display:"inline-block",variants:[{props:{variant:"determinate"},style:{transition:m.transitions.create("transform")}},{props:{variant:"indeterminate"},style:rB||{animation:`${kx} 1.4s linear infinite`}},...Object.entries(m.palette).filter(PM()).map(([g])=>({props:{color:g},style:{color:(m.vars||m).palette[g].main}}))]}))),aB=Bc("svg",{name:"MuiCircularProgress",slot:"Svg",overridesResolver:(m,g)=>g.svg})({display:"block"}),lB=Bc("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(m,g)=>{const{ownerState:l}=m;return[g.circle,g[`circle${Ma(l.variant)}`],l.disableShrink&&g.circleDisableShrink]}})(Nm(({theme:m})=>({stroke:"currentColor",variants:[{props:{variant:"determinate"},style:{transition:m.transitions.create("stroke-dashoffset")}},{props:{variant:"indeterminate"},style:{strokeDasharray:"80px, 200px",strokeDashoffset:0}},{props:({ownerState:g})=>g.variant==="indeterminate"&&!g.disableShrink,style:nB||{animation:`${Ox} 1.4s ease-in-out infinite`}}]}))),cB=Ke.forwardRef(function(g,l){const c=Gd({props:g,name:"MuiCircularProgress"}),{className:_,color:A="primary",disableShrink:N=!1,size:r=40,style:q,thickness:ie=3.6,value:ae=0,variant:he="indeterminate",...ve}=c,Ae={...c,color:A,disableShrink:N,size:r,thickness:ie,value:ae,variant:he},we=sB(Ae),Pe={},Ve={},We={};if(he==="determinate"){const rt=2*Math.PI*((Rd-ie)/2);Pe.strokeDasharray=rt.toFixed(3),We["aria-valuenow"]=Math.round(ae),Pe.strokeDashoffset=`${((100-ae)/100*rt).toFixed(3)}px`,Ve.transform="rotate(-90deg)"}return gi.jsx(oB,{className:gn(we.root,_),style:{width:r,height:r,...Ve,...q},ownerState:Ae,ref:l,role:"progressbar",...We,...ve,children:gi.jsx(aB,{className:we.svg,ownerState:Ae,viewBox:`${Rd/2} ${Rd/2} ${Rd} ${Rd}`,children:gi.jsx(lB,{className:we.circle,style:Pe,ownerState:Ae,cx:Rd,cy:Rd,r:(Rd-ie)/2,fill:"none",strokeWidth:ie})})})});function uB(m){return jd("MuiTypography",m)}$d("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const hB={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},dB=kF(),pB=m=>{const{align:g,gutterBottom:l,noWrap:c,paragraph:_,variant:A,classes:N}=m,r={root:["root",A,m.align!=="inherit"&&`align${Ma(g)}`,l&&"gutterBottom",c&&"noWrap",_&&"paragraph"]};return mf(r,uB,N)},fB=Bc("span",{name:"MuiTypography",slot:"Root",overridesResolver:(m,g)=>{const{ownerState:l}=m;return[g.root,l.variant&&g[l.variant],l.align!=="inherit"&&g[`align${Ma(l.align)}`],l.noWrap&&g.noWrap,l.gutterBottom&&g.gutterBottom,l.paragraph&&g.paragraph]}})(Nm(({theme:m})=>{var g;return{margin:0,variants:[{props:{variant:"inherit"},style:{font:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}},...Object.entries(m.typography).filter(([l,c])=>l!=="inherit"&&c&&typeof c=="object").map(([l,c])=>({props:{variant:l},style:c})),...Object.entries(m.palette).filter(PM()).map(([l])=>({props:{color:l},style:{color:(m.vars||m).palette[l].main}})),...Object.entries(((g=m.palette)==null?void 0:g.text)||{}).filter(([,l])=>typeof l=="string").map(([l])=>({props:{color:`text${Ma(l)}`},style:{color:(m.vars||m).palette.text[l]}})),{props:({ownerState:l})=>l.align!=="inherit",style:{textAlign:"var(--Typography-textAlign)"}},{props:({ownerState:l})=>l.noWrap,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},{props:({ownerState:l})=>l.gutterBottom,style:{marginBottom:"0.35em"}},{props:({ownerState:l})=>l.paragraph,style:{marginBottom:16}}]}})),DT={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},mB=Ke.forwardRef(function(g,l){const{color:c,..._}=Gd({props:g,name:"MuiTypography"}),A=!hB[c],N=dB({..._,...A&&{color:c}}),{align:r="inherit",className:q,component:ie,gutterBottom:ae=!1,noWrap:he=!1,paragraph:ve=!1,variant:Ae="body1",variantMapping:we=DT,...Pe}=N,Ve={...N,align:r,color:c,className:q,component:ie,gutterBottom:ae,noWrap:he,paragraph:ve,variant:Ae,variantMapping:we},We=ie||(ve?"p":we[Ae]||DT[Ae])||"span",rt=pB(Ve);return gi.jsx(fB,{as:We,ref:l,className:gn(rt.root,q),...Pe,ownerState:Ve,style:{...r!=="inherit"&&{"--Typography-textAlign":r},...Pe.style}})}),IM=Ke.createContext();function gB(m){return jd("MuiTable",m)}$d("MuiTable",["root","stickyHeader"]);const _B=m=>{const{classes:g,stickyHeader:l}=m;return mf({root:["root",l&&"stickyHeader"]},gB,g)},yB=Bc("table",{name:"MuiTable",slot:"Root",overridesResolver:(m,g)=>{const{ownerState:l}=m;return[g.root,l.stickyHeader&&g.stickyHeader]}})(Nm(({theme:m})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...m.typography.body2,padding:m.spacing(2),color:(m.vars||m).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:g})=>g.stickyHeader,style:{borderCollapse:"separate"}}]}))),kT="table",vB=Ke.forwardRef(function(g,l){const c=Gd({props:g,name:"MuiTable"}),{className:_,component:A=kT,padding:N="normal",size:r="medium",stickyHeader:q=!1,...ie}=c,ae={...c,component:A,padding:N,size:r,stickyHeader:q},he=_B(ae),ve=Ke.useMemo(()=>({padding:N,size:r,stickyHeader:q}),[N,r,q]);return gi.jsx(IM.Provider,{value:ve,children:gi.jsx(yB,{as:A,role:A===kT?null:"table",ref:l,className:gn(he.root,_),ownerState:ae,...ie})})}),db=Ke.createContext();function xB(m){return jd("MuiTableBody",m)}$d("MuiTableBody",["root"]);const bB=m=>{const{classes:g}=m;return mf({root:["root"]},xB,g)},wB=Bc("tbody",{name:"MuiTableBody",slot:"Root",overridesResolver:(m,g)=>g.root})({display:"table-row-group"}),SB={variant:"body"},OT="tbody",TB=Ke.forwardRef(function(g,l){const c=Gd({props:g,name:"MuiTableBody"}),{className:_,component:A=OT,...N}=c,r={...c,component:A},q=bB(r);return gi.jsx(db.Provider,{value:SB,children:gi.jsx(wB,{className:gn(q.root,_),as:A,ref:l,role:A===OT?null:"rowgroup",ownerState:r,...N})})});function MB(m){return jd("MuiTableCell",m)}const EB=$d("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),CB=m=>{const{classes:g,variant:l,align:c,padding:_,size:A,stickyHeader:N}=m,r={root:["root",l,N&&"stickyHeader",c!=="inherit"&&`align${Ma(c)}`,_!=="normal"&&`padding${Ma(_)}`,`size${Ma(A)}`]};return mf(r,MB,g)},AB=Bc("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(m,g)=>{const{ownerState:l}=m;return[g.root,g[l.variant],g[`size${Ma(l.size)}`],l.padding!=="normal"&&g[`padding${Ma(l.padding)}`],l.align!=="inherit"&&g[`align${Ma(l.align)}`],l.stickyHeader&&g.stickyHeader]}})(Nm(({theme:m})=>({...m.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:m.vars?`1px solid ${m.vars.palette.TableCell.border}`:`1px solid
    ${m.palette.mode==="light"?D0(e_(m.palette.divider,1),.88):I0(e_(m.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(m.vars||m).palette.text.primary,lineHeight:m.typography.pxToRem(24),fontWeight:m.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(m.vars||m).palette.text.primary}},{props:{variant:"footer"},style:{color:(m.vars||m).palette.text.secondary,lineHeight:m.typography.pxToRem(21),fontSize:m.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${EB.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:g})=>g.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(m.vars||m).palette.background.default}}]}))),wy=Ke.forwardRef(function(g,l){const c=Gd({props:g,name:"MuiTableCell"}),{align:_="inherit",className:A,component:N,padding:r,scope:q,size:ie,sortDirection:ae,variant:he,...ve}=c,Ae=Ke.useContext(IM),we=Ke.useContext(db),Pe=we&&we.variant==="head";let Ve;N?Ve=N:Ve=Pe?"th":"td";let We=q;Ve==="td"?We=void 0:!We&&Pe&&(We="col");const rt=he||we&&we.variant,ht={...c,align:_,component:Ve,padding:r||(Ae&&Ae.padding?Ae.padding:"normal"),size:ie||(Ae&&Ae.size?Ae.size:"medium"),sortDirection:ae,stickyHeader:rt==="head"&&Ae&&Ae.stickyHeader,variant:rt},tt=CB(ht);let at=null;return ae&&(at=ae==="asc"?"ascending":"descending"),gi.jsx(AB,{as:Ve,ref:l,className:gn(tt.root,A),"aria-sort":at,scope:We,ownerState:ht,...ve})});function PB(m){return jd("MuiTableRow",m)}const LT=$d("MuiTableRow",["root","selected","hover","head","footer"]),IB=m=>{const{classes:g,selected:l,hover:c,head:_,footer:A}=m;return mf({root:["root",l&&"selected",c&&"hover",_&&"head",A&&"footer"]},PB,g)},DB=Bc("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(m,g)=>{const{ownerState:l}=m;return[g.root,l.head&&g.head,l.footer&&g.footer]}})(Nm(({theme:m})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${LT.hover}:hover`]:{backgroundColor:(m.vars||m).palette.action.hover},[`&.${LT.selected}`]:{backgroundColor:m.vars?`rgba(${m.vars.palette.primary.mainChannel} / ${m.vars.palette.action.selectedOpacity})`:e_(m.palette.primary.main,m.palette.action.selectedOpacity),"&:hover":{backgroundColor:m.vars?`rgba(${m.vars.palette.primary.mainChannel} / calc(${m.vars.palette.action.selectedOpacity} + ${m.vars.palette.action.hoverOpacity}))`:e_(m.palette.primary.main,m.palette.action.selectedOpacity+m.palette.action.hoverOpacity)}}}))),RT="tr",zT=Ke.forwardRef(function(g,l){const c=Gd({props:g,name:"MuiTableRow"}),{className:_,component:A=RT,hover:N=!1,selected:r=!1,...q}=c,ie=Ke.useContext(db),ae={...c,component:A,hover:N,selected:r,head:ie&&ie.variant==="head",footer:ie&&ie.variant==="footer"},he=IB(ae);return gi.jsx(DB,{as:A,ref:l,className:gn(he.root,_),role:A===RT?null:"row",ownerState:ae,...q})});function kB({tabs:m,activeTab:g,onTabChange:l}){return gi.jsx("div",{className:"tab_Sec_box",children:gi.jsx("div",{className:"tab_Sec flex gap-[0_30px]",children:m.map((c,_)=>gi.jsx(QF,{children:gi.jsx("div",{className:`tab_menu ${g===(c==null?void 0:c.id)||c!=null&&c.value?"active":""}`,onClick:()=>l(_,c),children:(c==null?void 0:c.name)!==void 0?c==null?void 0:c.name:c==null?void 0:c.label})},_))})})}const Ng=({label:m,count:g})=>gi.jsxs("div",{className:"p-4 rounded shadow border border-borderColor bg-white",children:[gi.jsx("h3",{className:"text-sm text-gray-500 mb-1",children:m}),gi.jsx("h5",{className:"text-lg font-semibold",children:g})]});var Fy={exports:{}},OB=Fy.exports,FT;function LB(){return FT||(FT=1,function(m,g){(function(l,c){m.exports=c(iA())})(typeof self<"u"?self:OB,function(l){return function(c){function _(N){if(A[N])return A[N].exports;var r=A[N]={i:N,l:!1,exports:{}};return c[N].call(r.exports,r,r.exports,_),r.l=!0,r.exports}var A={};return _.m=c,_.c=A,_.d=function(N,r,q){_.o(N,r)||Object.defineProperty(N,r,{configurable:!1,enumerable:!0,get:q})},_.n=function(N){var r=N&&N.__esModule?function(){return N.default}:function(){return N};return _.d(r,"a",r),r},_.o=function(N,r){return Object.prototype.hasOwnProperty.call(N,r)},_.p="",_(_.s=0)}([function(c,_,A){function N(){return N=Object.assign?Object.assign.bind():function(rt){for(var ht=1;ht<arguments.length;ht++){var tt=arguments[ht];for(var at in tt)Object.prototype.hasOwnProperty.call(tt,at)&&(rt[at]=tt[at])}return rt},N.apply(this,arguments)}function r(rt){return he(rt)||ae(rt)||ie(rt)||q()}function q(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ie(rt,ht){if(rt){if(typeof rt=="string")return ve(rt,ht);var tt=Object.prototype.toString.call(rt).slice(8,-1);return tt==="Object"&&rt.constructor&&(tt=rt.constructor.name),tt==="Map"||tt==="Set"?Array.from(rt):tt==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(tt)?ve(rt,ht):void 0}}function ae(rt){if(typeof Symbol<"u"&&rt[Symbol.iterator]!=null||rt["@@iterator"]!=null)return Array.from(rt)}function he(rt){if(Array.isArray(rt))return ve(rt)}function ve(rt,ht){(ht==null||ht>rt.length)&&(ht=rt.length);for(var tt=0,at=new Array(ht);tt<ht;tt++)at[tt]=rt[tt];return at}function Ae(rt){"@babel/helpers - typeof";return(Ae=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ht){return typeof ht}:function(ht){return ht&&typeof Symbol=="function"&&ht.constructor===Symbol&&ht!==Symbol.prototype?"symbol":typeof ht})(rt)}Object.defineProperty(_,"__esModule",{value:!0}),A.d(_,"HighchartsReact",function(){return We});var we=A(1),Pe=A.n(we),Ve=typeof window<"u"?we.useLayoutEffect:we.useEffect,We=Object(we.memo)(Object(we.forwardRef)(function(rt,ht){var tt=Object(we.useRef)(),at=Object(we.useRef)(),Rt=Object(we.useRef)(rt.constructorType),Ne=Object(we.useRef)(rt.highcharts);return Ve(function(){function Tt(){var Te=rt.highcharts||(typeof window>"u"?"undefined":Ae(window))==="object"&&window.Highcharts,gt=rt.constructorType||"chart";Te?Te[gt]?rt.options?at.current=Te[gt](tt.current,rt.options,rt.callback):console.warn('The "options" property was not passed.'):console.warn('The "constructorType" property is incorrect or some required module is not imported.'):console.warn('The "highcharts" property was not passed.')}if(at.current){if(rt.allowChartUpdate!==!1)if(rt.constructorType!==Rt.current||rt.highcharts!==Ne.current)Rt.current=rt.constructorType,Ne.current=rt.highcharts,Tt();else if(!rt.immutable&&at.current){var qt;(qt=at.current).update.apply(qt,[rt.options].concat(r(rt.updateArgs||[!0,!0])))}else Tt()}else Tt()},[rt.options,rt.allowChartUpdate,rt.updateArgs,rt.containerProps,rt.highcharts,rt.constructorType]),Ve(function(){return function(){at.current&&(at.current.destroy(),at.current=null)}},[]),Object(we.useImperativeHandle)(ht,function(){return{get chart(){return at.current},container:tt}},[]),Pe.a.createElement("div",N({},rt.containerProps,{ref:tt}))}));_.default=We},function(c,_){c.exports=l}])})}(Fy)),Fy.exports}var RB=LB();const zB=t_(RB);var By={exports:{}},FB=By.exports,BT;function BB(){return BT||(BT=1,function(m,g){(function(l,c){l._Highcharts=c(),m.exports=l._Highcharts})(typeof window>"u"?FB:window,()=>(()=>{let l,c;var _,A,N,r,q,ie,ae,he,ve,Ae,we,Pe,Ve,We,rt,ht,tt,at={};at.d=(Y,h)=>{for(var v in h)at.o(h,v)&&!at.o(Y,v)&&Object.defineProperty(Y,v,{enumerable:!0,get:h[v]})},at.o=(Y,h)=>Object.prototype.hasOwnProperty.call(Y,h);var Rt={};at.d(Rt,{default:()=>$0}),function(Y){var h,v,S;Y.SVG_NS="http://www.w3.org/2000/svg",Y.product="Highcharts",Y.version="12.1.2",Y.win=typeof window<"u"?window:{},Y.doc=Y.win.document,Y.svg=Y.doc&&Y.doc.createElementNS&&!!Y.doc.createElementNS(Y.SVG_NS,"svg").createSVGRect,Y.pageLang=(S=(v=(h=Y.doc)==null?void 0:h.documentElement)==null?void 0:v.closest("[lang]"))==null?void 0:S.lang,Y.userAgent=Y.win.navigator&&Y.win.navigator.userAgent||"",Y.isChrome=Y.win.chrome,Y.isFirefox=Y.userAgent.indexOf("Firefox")!==-1,Y.isMS=/(edge|msie|trident)/i.test(Y.userAgent)&&!Y.win.opera,Y.isSafari=!Y.isChrome&&Y.userAgent.indexOf("Safari")!==-1,Y.isTouchDevice=/(Mobile|Android|Windows Phone)/.test(Y.userAgent),Y.isWebKit=Y.userAgent.indexOf("AppleWebKit")!==-1,Y.deg2rad=2*Math.PI/360,Y.marginNames=["plotTop","marginRight","marginBottom","plotLeft"],Y.noop=function(){},Y.supportsPassiveEvents=function(){let I=!1;if(!Y.isMS){let L=Object.defineProperty({},"passive",{get:function(){I=!0}});Y.win.addEventListener&&Y.win.removeEventListener&&(Y.win.addEventListener("testPassive",Y.noop,L),Y.win.removeEventListener("testPassive",Y.noop,L))}return I}(),Y.charts=[],Y.composed=[],Y.dateFormats={},Y.seriesTypes={},Y.symbolSizes={},Y.chartCount=0}(_||(_={}));let Ne=_,{charts:Tt,doc:qt,win:Te}=Ne;function gt(Y,h,v,S){let I=h?"Highcharts error":"Highcharts warning";Y===32&&(Y=`${I}: Deprecated member`);let L=Yt(Y),z=L?`${I} #${Y}: www.highcharts.com/errors/${Y}/`:Y.toString();if(S!==void 0){let B="";L&&(z+="?"),qr(S,function(U,X){B+=`
 - ${X}: ${U}`,L&&(z+=encodeURI(X)+"="+encodeURI(U))}),z+=B}Ye(Ne,"displayError",{chart:v,code:Y,message:z,params:S},function(){if(h)throw Error(z);Te.console&&gt.messages.indexOf(z)===-1&&console.warn(z)}),gt.messages.push(z)}function oi(Y,h){return parseInt(Y,h||10)}function Ti(Y){return typeof Y=="string"}function ni(Y){let h=Object.prototype.toString.call(Y);return h==="[object Array]"||h==="[object Array Iterator]"}function Mt(Y,h){return!!Y&&typeof Y=="object"&&(!h||!ni(Y))}function zt(Y){return Mt(Y)&&typeof Y.nodeType=="number"}function ii(Y){let h=Y&&Y.constructor;return!!(Mt(Y,!0)&&!zt(Y)&&h&&h.name&&h.name!=="Object")}function Yt(Y){return typeof Y=="number"&&!isNaN(Y)&&Y<1/0&&Y>-1/0}function jt(Y){return Y!=null}function Ri(Y,h,v){let S,I=Ti(h)&&!jt(v),L=(z,B)=>{jt(z)?Y.setAttribute(B,z):I?(S=Y.getAttribute(B))||B!=="class"||(S=Y.getAttribute(B+"Name")):Y.removeAttribute(B)};return Ti(h)?L(v,h):qr(h,L),S}function Yi(Y){return ni(Y)?Y:[Y]}function Wi(Y,h){let v;for(v in Y||(Y={}),h)Y[v]=h[v];return Y}function vi(){let Y=arguments,h=Y.length;for(let v=0;v<h;v++){let S=Y[v];if(S!=null)return S}}function Wr(Y,h){Wi(Y.style,h)}function an(Y){return Math.pow(10,Math.floor(Math.log(Y)/Math.LN10))}function _n(Y,h){return Y>1e14?Y:parseFloat(Y.toPrecision(h||14))}(gt||(gt={})).messages=[],Math.easeInOutSine=function(Y){return-.5*(Math.cos(Math.PI*Y)-1)};let Cn=Array.prototype.find?function(Y,h){return Y.find(h)}:function(Y,h){let v,S=Y.length;for(v=0;v<S;v++)if(h(Y[v],v))return Y[v]};function qr(Y,h,v){for(let S in Y)Object.hasOwnProperty.call(Y,S)&&h.call(v||Y[S],Y[S],S,Y)}function es(Y,h,v){function S(z,B){let U=Y.removeEventListener;U&&U.call(Y,z,B,!1)}function I(z){let B,U;Y.nodeName&&(h?(B={})[h]=!0:B=z,qr(B,function(X,te){if(z[te])for(U=z[te].length;U--;)S(te,z[te][U].fn)}))}let L=typeof Y=="function"&&Y.prototype||Y;if(Object.hasOwnProperty.call(L,"hcEvents")){let z=L.hcEvents;if(h){let B=z[h]||[];v?(z[h]=B.filter(function(U){return v!==U.fn}),S(h,v)):(I(z),z[h]=[])}else I(z),delete L.hcEvents}}function Ye(Y,h,v,S){if(v=v||{},qt.createEvent&&(Y.dispatchEvent||Y.fireEvent&&Y!==Ne)){let I=qt.createEvent("Events");I.initEvent(h,!0,!0),v=Wi(I,v),Y.dispatchEvent?Y.dispatchEvent(v):Y.fireEvent(h,v)}else if(Y.hcEvents){v.target||Wi(v,{preventDefault:function(){v.defaultPrevented=!0},target:Y,type:h});let I=[],L=Y,z=!1;for(;L.hcEvents;)Object.hasOwnProperty.call(L,"hcEvents")&&L.hcEvents[h]&&(I.length&&(z=!0),I.unshift.apply(I,L.hcEvents[h])),L=Object.getPrototypeOf(L);z&&I.sort((B,U)=>B.order-U.order),I.forEach(B=>{B.fn.call(Y,v)===!1&&v.preventDefault()})}S&&!v.defaultPrevented&&S.call(Y,v)}let ds=function(){let Y=Math.random().toString(36).substring(2,9)+"-",h=0;return function(){return"highcharts-"+(l?"":Y)+h++}}();Te.jQuery&&(Te.jQuery.fn.highcharts=function(){let Y=[].slice.call(arguments);if(this[0])return Y[0]?(new Ne[Ti(Y[0])?Y.shift():"Chart"](this[0],Y[0],Y[1]),this):Tt[Ri(this[0],"data-highcharts-chart")]});let Bi={addEvent:function(Y,h,v,S={}){let I=typeof Y=="function"&&Y.prototype||Y;Object.hasOwnProperty.call(I,"hcEvents")||(I.hcEvents={});let L=I.hcEvents;Ne.Point&&Y instanceof Ne.Point&&Y.series&&Y.series.chart&&(Y.series.chart.runTrackerClick=!0);let z=Y.addEventListener;z&&z.call(Y,h,v,!!Ne.supportsPassiveEvents&&{passive:S.passive===void 0?h.indexOf("touch")!==-1:S.passive,capture:!1}),L[h]||(L[h]=[]);let B={fn:v,order:typeof S.order=="number"?S.order:1/0};return L[h].push(B),L[h].sort((U,X)=>U.order-X.order),function(){es(Y,h,v)}},arrayMax:function(Y){let h=Y.length,v=Y[0];for(;h--;)Y[h]>v&&(v=Y[h]);return v},arrayMin:function(Y){let h=Y.length,v=Y[0];for(;h--;)Y[h]<v&&(v=Y[h]);return v},attr:Ri,clamp:function(Y,h,v){return Y>h?Y<v?Y:v:h},clearTimeout:function(Y){jt(Y)&&clearTimeout(Y)},correctFloat:_n,createElement:function(Y,h,v,S,I){let L=qt.createElement(Y);return h&&Wi(L,h),I&&Wr(L,{padding:"0",border:"none",margin:"0"}),v&&Wr(L,v),S&&S.appendChild(L),L},crisp:function(Y,h=0,v){let S=h%2/2,I=v?-1:1;return(Math.round(Y*I-S)+S)*I},css:Wr,defined:jt,destroyObjectProperties:function(Y,h,v){qr(Y,function(S,I){S!==h&&(S!=null&&S.destroy)&&S.destroy(),(S!=null&&S.destroy||!v)&&delete Y[I]})},diffObjects:function(Y,h,v,S){let I={};return function L(z,B,U,X){let te=v?B:z;qr(z,function(K,re){if(!X&&S&&S.indexOf(re)>-1&&B[re]){K=Yi(K),U[re]=[];for(let ue=0;ue<Math.max(K.length,B[re].length);ue++)B[re][ue]&&(K[ue]===void 0?U[re][ue]=B[re][ue]:(U[re][ue]={},L(K[ue],B[re][ue],U[re][ue],X+1)))}else Mt(K,!0)&&!K.nodeType?(U[re]=ni(K)?[]:{},L(K,B[re]||{},U[re],X+1),Object.keys(U[re]).length!==0||re==="colorAxis"&&X===0||delete U[re]):(z[re]!==B[re]||re in z&&!(re in B))&&re!=="__proto__"&&re!=="constructor"&&(U[re]=te[re])})}(Y,h,I,0),I},discardElement:function(Y){Y&&Y.parentElement&&Y.parentElement.removeChild(Y)},erase:function(Y,h){let v=Y.length;for(;v--;)if(Y[v]===h){Y.splice(v,1);break}},error:gt,extend:Wi,extendClass:function(Y,h){let v=function(){};return v.prototype=new Y,Wi(v.prototype,h),v},find:Cn,fireEvent:Ye,getAlignFactor:(Y="")=>({center:.5,right:1,middle:.5,bottom:1})[Y]||0,getClosestDistance:function(Y,h){let v,S,I,L=!h;return Y.forEach(z=>{if(z.length>1)for(I=z.length-1;I>0;I--)(S=z[I]-z[I-1])<0&&!L?(h==null||h(),h=void 0):S&&(v===void 0||S<v)&&(v=S)}),v},getMagnitude:an,getNestedProperty:function(Y,h){let v=Y.split(".");for(;v.length&&jt(h);){let S=v.shift();if(S===void 0||S==="__proto__")return;if(S==="this"){let L;return Mt(h)&&(L=h["@this"]),L??h}let I=h[S.replace(/[\\'"]/g,"")];if(!jt(I)||typeof I=="function"||typeof I.nodeType=="number"||I===Te)return;h=I}return h},getStyle:function Y(h,v,S){let I;if(v==="width"){let z=Math.min(h.offsetWidth,h.scrollWidth),B=h.getBoundingClientRect&&h.getBoundingClientRect().width;return B<z&&B>=z-1&&(z=Math.floor(B)),Math.max(0,z-(Y(h,"padding-left",!0)||0)-(Y(h,"padding-right",!0)||0))}if(v==="height")return Math.max(0,Math.min(h.offsetHeight,h.scrollHeight)-(Y(h,"padding-top",!0)||0)-(Y(h,"padding-bottom",!0)||0));let L=Te.getComputedStyle(h,void 0);return L&&(I=L.getPropertyValue(v),vi(S,v!=="opacity")&&(I=oi(I))),I},insertItem:function(Y,h){let v,S=Y.options.index,I=h.length;for(v=Y.options.isInternal?I:0;v<I+1;v++)if(!h[v]||Yt(S)&&S<vi(h[v].options.index,h[v]._i)||h[v].options.isInternal){h.splice(v,0,Y);break}return v},isArray:ni,isClass:ii,isDOMElement:zt,isFunction:function(Y){return typeof Y=="function"},isNumber:Yt,isObject:Mt,isString:Ti,merge:function(Y,...h){let v,S=[Y,...h],I={},L=function(B,U){return typeof B!="object"&&(B={}),qr(U,function(X,te){te!=="__proto__"&&te!=="constructor"&&(!Mt(X,!0)||ii(X)||zt(X)?B[te]=U[te]:B[te]=L(B[te]||{},X))}),B};Y===!0&&(I=S[1],S=Array.prototype.slice.call(S,2));let z=S.length;for(v=0;v<z;v++)I=L(I,S[v]);return I},normalizeTickInterval:function(Y,h,v,S,I){let L,z=Y;v=vi(v,an(Y));let B=Y/v;for(!h&&(h=I?[1,1.2,1.5,2,2.5,3,4,5,6,8,10]:[1,2,2.5,5,10],S===!1&&(v===1?h=h.filter(function(U){return U%1==0}):v<=.1&&(h=[1/v]))),L=0;L<h.length&&(z=h[L],(!I||!(z*v>=Y))&&(I||!(B<=(h[L]+(h[L+1]||h[L]))/2)));L++);return _n(z*v,-Math.round(Math.log(.001)/Math.LN10))},objectEach:qr,offset:function(Y){let h=qt.documentElement,v=Y.parentElement||Y.parentNode?Y.getBoundingClientRect():{top:0,left:0,width:0,height:0};return{top:v.top+(Te.pageYOffset||h.scrollTop)-(h.clientTop||0),left:v.left+(Te.pageXOffset||h.scrollLeft)-(h.clientLeft||0),width:v.width,height:v.height}},pad:function(Y,h,v){return Array((h||2)+1-String(Y).replace("-","").length).join(v||"0")+Y},pick:vi,pInt:oi,pushUnique:function(Y,h){return 0>Y.indexOf(h)&&!!Y.push(h)},relativeLength:function(Y,h,v){return/%$/.test(Y)?h*parseFloat(Y)/100+(v||0):parseFloat(Y)},removeEvent:es,replaceNested:function(Y,...h){let v,S;do for(S of(v=Y,h))Y=Y.replace(S[0],S[1]);while(Y!==v);return Y},splat:Yi,stableSort:function(Y,h){let v,S,I=Y.length;for(S=0;S<I;S++)Y[S].safeI=S;for(Y.sort(function(L,z){return(v=h(L,z))===0?L.safeI-z.safeI:v}),S=0;S<I;S++)delete Y[S].safeI},syncTimeout:function(Y,h,v){return h>0?setTimeout(Y,h,v):(Y.call(0,v),-1)},timeUnits:{millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:24192e5,year:314496e5},ucfirst:function(Y){return Ti(Y)?Y.substring(0,1).toUpperCase()+Y.substring(1):String(Y)},uniqueKey:ds,useSerialIds:function(Y){return l=vi(Y,l)},wrap:function(Y,h,v){let S=Y[h];Y[h]=function(){let I=arguments,L=this;return v.apply(this,[function(){return S.apply(L,arguments.length?arguments:I)}].concat([].slice.call(arguments)))}}},{pageLang:Xs,win:Wt}=Ne,{defined:jn,error:As,extend:mo,isNumber:rr,isObject:$n,isString:xs,merge:Ea,objectEach:xr,pad:go,splat:nr,timeUnits:Kr,ucfirst:ra}=Bi,dl=Ne.isSafari&&Wt.Intl&&!Wt.Intl.DateTimeFormat.prototype.formatRange,Zs=Y=>Y.main===void 0,Ca=Y=>["D","L","M","X","J","V","S"].indexOf(Y),$a=class{constructor(Y){this.options={timezone:"UTC"},this.variableTimezone=!1,this.Date=Wt.Date,this.update(Y)}update(Y={}){this.dTLCache={},this.options=Y=Ea(!0,this.options,Y);let{timezoneOffset:h,useUTC:v}=Y;this.Date=Y.Date||Wt.Date||Date;let S=Y.timezone;jn(v)&&(S=v?"UTC":void 0),h&&h%60==0&&(S="Etc/GMT"+(h>0?"+":"")+h/60),this.variableTimezone=S!=="UTC"&&(S==null?void 0:S.indexOf("Etc/GMT"))!==0,this.timezone=S,["months","shortMonths","weekdays","shortWeekdays"].forEach(I=>{let L=/months/i.test(I),z=/short/.test(I),B={timeZone:"UTC"};B[L?"month":"weekday"]=z?"short":"long",this[I]=(L?[0,1,2,3,4,5,6,7,8,9,10,11]:[3,4,5,6,7,8,9]).map(U=>this.dateFormat(B,(L?31:1)*24*36e5*U))})}toParts(Y){let[h,v,S,I,L,z,B]=this.dateTimeFormat({weekday:"narrow",day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},Y,"es").split(/(?:, |\/|:)/g);return[I,+S-1,v,L,z,B,Math.floor(Number(Y)||0)%1e3,Ca(h)].map(Number)}dateTimeFormat(Y,h,v=this.options.locale||Xs){let S=JSON.stringify(Y)+v;xs(Y)&&(Y=this.str2dtf(Y));let I=this.dTLCache[S];if(!I){Y.timeZone??(Y.timeZone=this.timezone);try{I=new Intl.DateTimeFormat(v,Y)}catch(L){/Invalid time zone/i.test(L.message)?(As(34),Y.timeZone="UTC",I=new Intl.DateTimeFormat(v,Y)):As(L.message,!1)}}return this.dTLCache[S]=I,(I==null?void 0:I.format(h))||""}str2dtf(Y,h={}){let v={L:{fractionalSecondDigits:3},S:{second:"2-digit"},M:{minute:"numeric"},H:{hour:"2-digit"},k:{hour:"numeric"},E:{weekday:"narrow"},a:{weekday:"short"},A:{weekday:"long"},d:{day:"2-digit"},e:{day:"numeric"},b:{month:"short"},B:{month:"long"},m:{month:"2-digit"},o:{month:"numeric"},y:{year:"2-digit"},Y:{year:"numeric"}};return Object.keys(v).forEach(S=>{Y.indexOf(S)!==-1&&mo(h,v[S])}),h}makeTime(Y,h,v=1,S=0,I,L,z){let B=this.Date.UTC(Y,h,v,S,I||0,L||0,z||0);if(this.timezone!=="UTC"){let U=this.getTimezoneOffset(B);if(B+=U,[2,3,8,9,10,11].indexOf(h)!==-1&&(S<5||S>20)){let X=this.getTimezoneOffset(B);U!==X?B+=X-U:U-36e5!==this.getTimezoneOffset(B-36e5)||dl||(B-=36e5)}}return B}parse(Y){if(!xs(Y))return Y??void 0;let h=(Y=Y.replace(/\//g,"-").replace(/(GMT|UTC)/,"")).indexOf("Z")>-1||/([+-][0-9]{2}):?[0-9]{2}$/.test(Y),v=/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/.test(Y);h||v||(Y+="Z");let S=Date.parse(Y);if(rr(S))return S+(!h||v?this.getTimezoneOffset(S):0)}getTimezoneOffset(Y){if(this.timezone!=="UTC"){let[h,v,S,I,L=0]=this.dateTimeFormat({timeZoneName:"shortOffset"},Y,"en").split(/(GMT|:)/).map(Number),z=-(36e5*(S+L/60));if(rr(z))return z}return 0}dateFormat(Y,h,v){var I;let S=(I=Ne.defaultOptions)==null?void 0:I.lang;if(!jn(h)||isNaN(h))return(S==null?void 0:S.invalidDate)||"";if(xs(Y=Y??"%Y-%m-%d %H:%M:%S")){let L,z=/%\[([a-zA-Z]+)\]/g;for(;L=z.exec(Y);)Y=Y.replace(L[0],this.dateTimeFormat(L[1],h))}if(xs(Y)&&Y.indexOf("%")!==-1){let L=this,[z,B,U,X,te,K,re,ue]=this.toParts(h),ge=(S==null?void 0:S.weekdays)||this.weekdays,ye=(S==null?void 0:S.shortWeekdays)||this.shortWeekdays,xe=(S==null?void 0:S.months)||this.months,_e=(S==null?void 0:S.shortMonths)||this.shortMonths;xr(mo({a:ye?ye[ue]:ge[ue].substr(0,3),A:ge[ue],d:go(U),e:go(U,2," "),w:ue,b:_e[B],B:xe[B],m:go(B+1),o:B+1,y:z.toString().substr(2,2),Y:z,H:go(X),k:X,I:go(X%12||12),l:X%12||12,M:go(te),p:X<12?"AM":"PM",P:X<12?"am":"pm",S:go(K),L:go(re,3)},Ne.dateFormats),function(ze,Re){if(xs(Y))for(;Y.indexOf("%"+Re)!==-1;)Y=Y.replace("%"+Re,typeof ze=="function"?ze.call(L,h):ze)})}else if($n(Y)){let L=(this.getTimezoneOffset(h)||0)/36e5,z=this.timezone||"Etc/GMT"+(L>=0?"+":"")+L,{prefix:B="",suffix:U=""}=Y;Y=B+this.dateTimeFormat(mo({timeZone:z},Y),h)+U}return v?ra(Y):Y}resolveDTLFormat(Y){return $n(Y,!0)?$n(Y,!0)&&Zs(Y)?{main:Y}:Y:{main:(Y=nr(Y))[0],from:Y[1],to:Y[2]}}getTimeTicks(Y,h,v,S){let I=this,L=[],z={},{count:B=1,unitRange:U}=Y,[X,te,K,re,ue,ge]=I.toParts(h),ye=(h||0)%1e3,xe;if(S??(S=1),jn(h)){if(ye=U>=Kr.second?0:B*Math.floor(ye/B),U>=Kr.second&&(ge=U>=Kr.minute?0:B*Math.floor(ge/B)),U>=Kr.minute&&(ue=U>=Kr.hour?0:B*Math.floor(ue/B)),U>=Kr.hour&&(re=U>=Kr.day?0:B*Math.floor(re/B)),U>=Kr.day&&(K=U>=Kr.month?1:Math.max(1,B*Math.floor(K/B))),U>=Kr.month&&(te=U>=Kr.year?0:B*Math.floor(te/B)),U>=Kr.year&&(X-=X%B),U===Kr.week){B&&(h=I.makeTime(X,te,K,re,ue,ge,ye));let Re=Ca(this.dateTimeFormat({timeZone:this.timezone,weekday:"narrow"},h,"es"));K+=-Re+S+(Re<S?-7:0)}h=I.makeTime(X,te,K,re,ue,ge,ye),I.variableTimezone&&jn(v)&&(xe=v-h>4*Kr.month||I.getTimezoneOffset(h)!==I.getTimezoneOffset(v));let _e=h,ze=1;for(;_e<v;)L.push(_e),U===Kr.year?_e=I.makeTime(X+ze*B,0):U===Kr.month?_e=I.makeTime(X,te+ze*B):xe&&(U===Kr.day||U===Kr.week)?_e=I.makeTime(X,te,K+ze*B*(U===Kr.day?1:7)):xe&&U===Kr.hour&&B>1?_e=I.makeTime(X,te,K,re+ze*B):_e+=U*B,ze++;L.push(_e),U<=Kr.hour&&L.length<1e4&&L.forEach(Re=>{Re%18e5==0&&I.dateFormat("%H%M%S%L",Re)==="000000000"&&(z[Re]="day")})}return L.info=mo(Y,{higherRanks:z,totalRange:U*B}),L}getDateFormat(Y,h,v,S){let I=this.dateFormat("%m-%d %H:%M:%S.%L",h),L="01-01 00:00:00.000",z={millisecond:15,second:12,minute:9,hour:6,day:3},B="millisecond",U=B;for(B in Kr){if(Y===Kr.week&&+this.dateFormat("%w",h)===v&&I.substr(6)===L.substr(6)){B="week";break}if(Kr[B]>Y){B=U;break}if(z[B]&&I.substr(z[B])!==L.substr(z[B]))break;B!=="week"&&(U=B)}return this.resolveDTLFormat(S[B]).main}},{isTouchDevice:Nc}=Ne,{fireEvent:Vc,merge:ro}=Bi,na={colors:["#2caffe","#544fc5","#00e272","#fe6a35","#6b8abc","#d568fb","#2ee0ca","#fa4b42","#feb56a","#91e8e1"],symbols:["circle","diamond","square","triangle","triangle-down"],lang:{locale:void 0,loading:"Loading...",months:void 0,shortMonths:void 0,weekdays:void 0,numericSymbols:["k","M","G","T","P","E"],resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1"},global:{buttonTheme:{fill:"#f7f7f7",padding:8,r:2,stroke:"#cccccc","stroke-width":1,style:{color:"#333333",cursor:"pointer",fontSize:"0.8em",fontWeight:"normal"},states:{hover:{fill:"#e6e6e6"},select:{fill:"#e6e9ff",style:{color:"#000000",fontWeight:"bold"}},disabled:{style:{color:"#cccccc"}}}}},time:{Date:void 0,timezone:"UTC",timezoneOffset:0,useUTC:void 0},chart:{alignThresholds:!1,panning:{enabled:!1,type:"x"},styledMode:!1,borderRadius:0,colorCount:10,allowMutatingData:!0,ignoreHiddenSeries:!0,spacing:[10,10,15,10],resetZoomButton:{theme:{},position:{}},reflow:!0,type:"line",zooming:{singleTouch:!1,resetButton:{theme:{zIndex:6},position:{align:"right",x:-10,y:10}}},width:null,height:null,borderColor:"#334eff",backgroundColor:"#ffffff",plotBorderColor:"#cccccc"},title:{style:{color:"#333333",fontWeight:"bold"},text:"Chart title",margin:15,minScale:.67},subtitle:{style:{color:"#666666",fontSize:"0.8em"},text:""},caption:{margin:15,style:{color:"#666666",fontSize:"0.8em"},text:"",align:"left",verticalAlign:"bottom"},plotOptions:{},legend:{enabled:!0,align:"center",alignColumns:!0,className:"highcharts-no-tooltip",events:{},layout:"horizontal",itemMarginBottom:2,itemMarginTop:2,labelFormatter:function(){return this.name},borderColor:"#999999",borderRadius:0,navigation:{style:{fontSize:"0.8em"},activeColor:"#0022ff",inactiveColor:"#cccccc"},itemStyle:{color:"#333333",cursor:"pointer",fontSize:"0.8em",textDecoration:"none",textOverflow:"ellipsis"},itemHoverStyle:{color:"#000000"},itemHiddenStyle:{color:"#666666",textDecoration:"line-through"},shadow:!1,itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},squareSymbol:!0,symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{fontSize:"0.8em",fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"45%"},style:{position:"absolute",backgroundColor:"#ffffff",opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:{duration:300,easing:Y=>Math.sqrt(1-Math.pow(Y-1,2))},borderRadius:3,dateTimeLabelFormats:{millisecond:"%[AebHMSL]",second:"%[AebHMS]",minute:"%[AebHM]",hour:"%[AebHM]",day:"%[AebY]",week:"Week from %[AebY]",month:"%[BY]",year:"%Y"},footerFormat:"",headerShape:"callout",hideDelay:500,padding:8,shape:"callout",shared:!1,snap:Nc?25:10,headerFormat:'<span style="font-size: 0.8em">{ucfirst point.key}</span><br/>',pointFormat:'<span style="color:{point.color}">●</span> {series.name}: <b>{point.y}</b><br/>',backgroundColor:"#ffffff",borderWidth:void 0,shadow:!0,stickOnContact:!1,style:{color:"#333333",cursor:"default",fontSize:"0.8em"},useHTML:!1},credits:{enabled:!0,href:"https://www.highcharts.com?credits",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#999999",fontSize:"0.6em"},text:"Highcharts.com"}},pl=new $a(na.time),zn={defaultOptions:na,defaultTime:pl,getOptions:function(){return na},setOptions:function(Y){return Vc(Ne,"setOptions",{options:Y}),ro(!0,na,Y),Y.time&&pl.update(na.time),Y.lang&&"locale"in Y.lang&&pl.update({locale:Y.lang.locale}),na}},{isNumber:Aa,merge:qi,pInt:Fn,defined:$u}=Bi;class Jr{static parse(h){return h?new Jr(h):Jr.None}constructor(h){let v,S,I,L;this.rgba=[NaN,NaN,NaN,NaN],this.input=h;let z=Ne.Color;if(z&&z!==Jr)return new z(h);if(typeof h=="object"&&h.stops!==void 0)this.stops=h.stops.map(B=>new Jr(B[1]));else if(typeof h=="string")for(this.input=h=Jr.names[h.toLowerCase()]||h,I=Jr.parsers.length;I--&&!S;)(v=(L=Jr.parsers[I]).regex.exec(h))&&(S=L.parse(v));S&&(this.rgba=S)}get(h){let v=this.input,S=this.rgba;if(typeof v=="object"&&this.stops!==void 0){let I=qi(v);return I.stops=[].slice.call(I.stops),this.stops.forEach((L,z)=>{I.stops[z]=[I.stops[z][0],L.get(h)]}),I}return S&&Aa(S[0])?h!=="rgb"&&(h||S[3]!==1)?h==="a"?`${S[3]}`:"rgba("+S.join(",")+")":"rgb("+S[0]+","+S[1]+","+S[2]+")":v}brighten(h){let v=this.rgba;if(this.stops)this.stops.forEach(function(S){S.brighten(h)});else if(Aa(h)&&h!==0)for(let S=0;S<3;S++)v[S]+=Fn(255*h),v[S]<0&&(v[S]=0),v[S]>255&&(v[S]=255);return this}setOpacity(h){return this.rgba[3]=h,this}tweenTo(h,v){let S=this.rgba,I=h.rgba;if(!Aa(S[0])||!Aa(I[0]))return h.input||"none";let L=I[3]!==1||S[3]!==1,z=(U,X)=>U+(S[X]-U)*(1-v),B=I.slice(0,3).map(z).map(Math.round);return L&&B.push(z(I[3],3)),(L?"rgba(":"rgb(")+B.join(",")+")"}}Jr.names={white:"#ffffff",black:"#000000"},Jr.parsers=[{regex:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d?(?:\.\d+)?)\s*\)/,parse:function(Y){return[Fn(Y[1]),Fn(Y[2]),Fn(Y[3]),parseFloat(Y[4],10)]}},{regex:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/,parse:function(Y){return[Fn(Y[1]),Fn(Y[2]),Fn(Y[3]),1]}},{regex:/^#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])?$/i,parse:function(Y){return[Fn(Y[1]+Y[1],16),Fn(Y[2]+Y[2],16),Fn(Y[3]+Y[3],16),$u(Y[4])?Fn(Y[4]+Y[4],16)/255:1]}},{regex:/^#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})?$/i,parse:function(Y){return[Fn(Y[1],16),Fn(Y[2],16),Fn(Y[3],16),$u(Y[4])?Fn(Y[4],16)/255:1]}}],Jr.None=new Jr("");let{parse:Pa}=Jr,{win:Uc}=Ne,{isNumber:fl,objectEach:jc}=Bi;class Ps{constructor(h,v,S){this.pos=NaN,this.options=v,this.elem=h,this.prop=S}dSetter(){let h=this.paths,v=h&&h[0],S=h&&h[1],I=this.now||0,L=[];if(I!==1&&v&&S)if(v.length===S.length&&I<1)for(let z=0;z<S.length;z++){let B=v[z],U=S[z],X=[];for(let te=0;te<U.length;te++){let K=B[te],re=U[te];fl(K)&&fl(re)&&!(U[0]==="A"&&(te===4||te===5))?X[te]=K+I*(re-K):X[te]=re}L.push(X)}else L=S;else L=this.toD||[];this.elem.attr("d",L,void 0,!0)}update(){let h=this.elem,v=this.prop,S=this.now,I=this.options.step;this[v+"Setter"]?this[v+"Setter"]():h.attr?h.element&&h.attr(v,S,null,!0):h.style[v]=S+this.unit,I&&I.call(h,S,this)}run(h,v,S){let I=this,L=I.options,z=function(X){return!z.stopped&&I.step(X)},B=Uc.requestAnimationFrame||function(X){setTimeout(X,13)},U=function(){for(let X=0;X<Ps.timers.length;X++)Ps.timers[X]()||Ps.timers.splice(X--,1);Ps.timers.length&&B(U)};h!==v||this.elem["forceAnimate:"+this.prop]?(this.startTime=+new Date,this.start=h,this.end=v,this.unit=S,this.now=this.start,this.pos=0,z.elem=this.elem,z.prop=this.prop,z()&&Ps.timers.push(z)===1&&B(U)):(delete L.curAnim[this.prop],L.complete&&Object.keys(L.curAnim).length===0&&L.complete.call(this.elem))}step(h){let v,S,I=+new Date,L=this.options,z=this.elem,B=L.complete,U=L.duration,X=L.curAnim;return z.attr&&!z.element?v=!1:h||I>=U+this.startTime?(this.now=this.end,this.pos=1,this.update(),X[this.prop]=!0,S=!0,jc(X,function(te){te!==!0&&(S=!1)}),S&&B&&B.call(z),v=!1):(this.pos=L.easing((I-this.startTime)/U),this.now=this.start+(this.end-this.start)*this.pos,this.update(),v=!0),v}initPath(h,v,S){let I=h.startX,L=h.endX,z=S.slice(),B=h.isArea,U=B?2:1,X=v&&S.length>v.length&&S.hasStackedCliffs,te,K,re,ue,ge=v&&v.slice();if(!ge||X)return[z,z];function ye(_e,ze){for(;_e.length<K;){let Re=_e[0],ft=ze[K-_e.length];if(ft&&Re[0]==="M"&&(ft[0]==="C"?_e[0]=["C",Re[1],Re[2],Re[1],Re[2],Re[1],Re[2]]:_e[0]=["L",Re[1],Re[2]]),_e.unshift(Re),B){let St=_e.pop();_e.push(_e[_e.length-1],St)}}}function xe(_e){for(;_e.length<K;){let ze=_e[Math.floor(_e.length/U)-1].slice();if(ze[0]==="C"&&(ze[1]=ze[5],ze[2]=ze[6]),B){let Re=_e[Math.floor(_e.length/U)].slice();_e.splice(_e.length/2,0,ze,Re)}else _e.push(ze)}}if(I&&L&&L.length){for(re=0;re<I.length;re++){if(I[re]===L[0]){te=re;break}if(I[0]===L[L.length-I.length+re]){te=re,ue=!0;break}if(I[I.length-1]===L[L.length-I.length+re]){te=I.length-re;break}}te===void 0&&(ge=[])}return ge.length&&fl(te)&&(K=z.length+te*U,ue?(ye(ge,z),xe(z)):(ye(z,ge),xe(ge))),[ge,z]}fillSetter(){Ps.prototype.strokeSetter.apply(this,arguments)}strokeSetter(){this.elem.attr(this.prop,Pa(this.start).tweenTo(Pa(this.end),this.pos),void 0,!0)}}Ps.timers=[];let{defined:$c,getStyle:zh,isArray:Fh,isNumber:ts,isObject:Jl,merge:Gu,objectEach:Hu,pick:Is}=Bi;function Ho(Y){return Jl(Y)?Gu({duration:500,defer:0},Y):{duration:Y?500:0,defer:0}}function vt(Y,h){let v=Ps.timers.length;for(;v--;)Ps.timers[v].elem!==Y||h&&h!==Ps.timers[v].prop||(Ps.timers[v].stopped=!0)}let se={animate:function(Y,h,v){let S,I="",L,z,B;Jl(v)||(B=arguments,v={duration:B[2],easing:B[3],complete:B[4]}),ts(v.duration)||(v.duration=400),v.easing=typeof v.easing=="function"?v.easing:Math[v.easing]||Math.easeInOutSine,v.curAnim=Gu(h),Hu(h,function(U,X){vt(Y,X),z=new Ps(Y,v,X),L=void 0,X==="d"&&Fh(h.d)?(z.paths=z.initPath(Y,Y.pathArray,h.d),z.toD=h.d,S=0,L=1):Y.attr?S=Y.attr(X):(S=parseFloat(zh(Y,X))||0,X!=="opacity"&&(I="px")),L||(L=U),typeof L=="string"&&L.match("px")&&(L=L.replace(/px/g,"")),z.run(S,L,I)})},animObject:Ho,getDeferredAnimation:function(Y,h,v){let S=Ho(h),I=v?[v]:Y.series,L=0,z=0;return I.forEach(B=>{let U=Ho(B.options.animation);L=Jl(h)&&$c(h.defer)?S.defer:Math.max(L,U.duration+U.defer),z=Math.min(S.duration,U.duration)}),Y.renderer.forExport&&(L=0),{defer:Math.max(0,L-z),duration:Math.min(L,z)}},setAnimation:function(Y,h){h.renderer.globalAnimation=Is(Y,h.options.chart.animation,!0)},stop:vt},{SVG_NS:me,win:be}=Ne,{attr:Fe,createElement:je,css:Ze,error:lt,isFunction:Je,isString:mt,objectEach:pt,splat:yt}=Bi,{trustedTypes:Lt}=be,Zt=Lt&&Je(Lt.createPolicy)&&Lt.createPolicy("highcharts",{createHTML:Y=>Y}),Jt=Zt?Zt.createHTML(""):"";class pi{static filterUserAttributes(h){return pt(h,(v,S)=>{let I=!0;pi.allowedAttributes.indexOf(S)===-1&&(I=!1),["background","dynsrc","href","lowsrc","src"].indexOf(S)!==-1&&(I=mt(v)&&pi.allowedReferences.some(L=>v.indexOf(L)===0)),I||(lt(33,!1,void 0,{"Invalid attribute in config":`${S}`}),delete h[S]),mt(v)&&h[S]&&(h[S]=v.replace(/</g,"&lt;"))}),h}static parseStyle(h){return h.split(";").reduce((v,S)=>{let I=S.split(":").map(z=>z.trim()),L=I.shift();return L&&I.length&&(v[L.replace(/-([a-z])/g,z=>z[1].toUpperCase())]=I.join(":")),v},{})}static setElementHTML(h,v){h.innerHTML=pi.emptyHTML,v&&new pi(v).addToDOM(h)}constructor(h){this.nodes=typeof h=="string"?this.parseMarkup(h):h}addToDOM(h){return function v(S,I){let L;return yt(S).forEach(function(z){let B,U=z.tagName,X=z.textContent?Ne.doc.createTextNode(z.textContent):void 0,te=pi.bypassHTMLFiltering;if(U)if(U==="#text")B=X;else if(pi.allowedTags.indexOf(U)!==-1||te){let K=U==="svg"?me:I.namespaceURI||me,re=Ne.doc.createElementNS(K,U),ue=z.attributes||{};pt(z,function(ge,ye){ye!=="tagName"&&ye!=="attributes"&&ye!=="children"&&ye!=="style"&&ye!=="textContent"&&(ue[ye]=ge)}),Fe(re,te?ue:pi.filterUserAttributes(ue)),z.style&&Ze(re,z.style),X&&re.appendChild(X),v(z.children||[],re),B=re}else lt(33,!1,void 0,{"Invalid tagName in config":U});B&&I.appendChild(B),L=B}),L}(this.nodes,h)}parseMarkup(h){let v,S=[];h=h.trim().replace(/ style=(["'])/g," data-style=$1");try{v=new DOMParser().parseFromString(Zt?Zt.createHTML(h):h,"text/html")}catch{}if(!v){let L=je("div");L.innerHTML=h,v={body:L}}let I=(L,z)=>{let B=L.nodeName.toLowerCase(),U={tagName:B};B==="#text"&&(U.textContent=L.textContent||"");let X=L.attributes;if(X){let te={};[].forEach.call(X,K=>{K.name==="data-style"?U.style=pi.parseStyle(K.value):te[K.name]=K.value}),U.attributes=te}if(L.childNodes.length){let te=[];[].forEach.call(L.childNodes,K=>{I(K,te)}),te.length&&(U.children=te)}z.push(U)};return[].forEach.call(v.body.childNodes,L=>I(L,S)),S}}pi.allowedAttributes=["alt","aria-controls","aria-describedby","aria-expanded","aria-haspopup","aria-hidden","aria-label","aria-labelledby","aria-live","aria-pressed","aria-readonly","aria-roledescription","aria-selected","class","clip-path","color","colspan","cx","cy","d","dx","dy","disabled","fill","filterUnits","flood-color","flood-opacity","height","href","id","in","in2","markerHeight","markerWidth","offset","opacity","operator","orient","padding","paddingLeft","paddingRight","patternUnits","r","radius","refX","refY","role","scope","slope","src","startOffset","stdDeviation","stroke","stroke-linecap","stroke-width","style","tableValues","result","rowspan","summary","target","tabindex","text-align","text-anchor","textAnchor","textLength","title","type","valign","width","x","x1","x2","xlink:href","y","y1","y2","zIndex"],pi.allowedReferences=["https://","http://","mailto:","/","../","./","#"],pi.allowedTags=["a","abbr","b","br","button","caption","circle","clipPath","code","dd","defs","div","dl","dt","em","feComponentTransfer","feComposite","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMorphology","feOffset","feMerge","feMergeNode","filter","h1","h2","h3","h4","h5","h6","hr","i","img","li","linearGradient","marker","ol","p","path","pattern","pre","rect","small","span","stop","strong","style","sub","sup","svg","table","text","textPath","thead","title","tbody","tspan","td","th","tr","u","ul","#text"],pi.emptyHTML=Jt,pi.bypassHTMLFiltering=!1;let{defaultOptions:Di,defaultTime:ki}=zn,{pageLang:Pi}=Ne,{extend:dr,getNestedProperty:br,isArray:sr,isNumber:wr,isObject:Pr,isString:Bn,pick:Ia,ucfirst:is}=Bi,Nn={add:(Y,h)=>Y+h,divide:(Y,h)=>h!==0?Y/h:"",eq:(Y,h)=>Y==h,each:function(Y){let h=arguments[arguments.length-1];return!!sr(Y)&&Y.map((v,S)=>Wo(h.body,dr(Pr(v)?v:{"@this":v},{"@index":S,"@first":S===0,"@last":S===Y.length-1}))).join("")},ge:(Y,h)=>Y>=h,gt:(Y,h)=>Y>h,if:Y=>!!Y,le:(Y,h)=>Y<=h,lt:(Y,h)=>Y<h,multiply:(Y,h)=>Y*h,ne:(Y,h)=>Y!=h,subtract:(Y,h)=>Y-h,ucfirst:is,unless:Y=>!Y},$s={},Gc=Y=>/^["'].+["']$/.test(Y);function Wo(Y="",h,v){let S=/\{([\p{L}\d:\.,;\-\/<>\[\]%_@+"'’= #\(\)]+)\}/gu,I=/\(([\p{L}\d:\.,;\-\/<>\[\]%_@+"'= ]+)\)/gu,L=[],z=/f$/,B=/\.(\d)/,U=(v==null?void 0:v.options.lang)||Di.lang,X=v&&v.time||ki,te=v&&v.numberFormatter||Hc,K=(xe="")=>{let _e;return xe==="true"||xe!=="false"&&((_e=Number(xe)).toString()===xe?_e:Gc(xe)?xe.slice(1,-1):br(xe,h))},re,ue,ge=0,ye;for(;(re=S.exec(Y))!==null;){let xe=re,_e=I.exec(re[1]);_e&&(re=_e,ye=!0),ue&&ue.isBlock||(ue={ctx:h,expression:re[1],find:re[0],isBlock:re[1].charAt(0)==="#",start:re.index,startInner:re.index+re[0].length,length:re[0].length});let ze=(ue.isBlock?xe:re)[1].split(" ")[0].replace("#","");Nn[ze]&&(ue.isBlock&&ze===ue.fn&&ge++,ue.fn||(ue.fn=ze));let Re=re[1]==="else";if(ue.isBlock&&ue.fn&&(re[1]===`/${ue.fn}`||Re))if(ge)!Re&&ge--;else{let ft=ue.startInner,St=Y.substr(ft,re.index-ft);ue.body===void 0?(ue.body=St,ue.startInner=re.index+re[0].length):ue.elseBody=St,ue.find+=St+re[0],Re||(L.push(ue),ue=void 0)}else ue.isBlock||L.push(ue);if(_e&&!(ue!=null&&ue.isBlock))break}return L.forEach(xe=>{let _e,ze,{body:Re,elseBody:ft,expression:St,fn:_t}=xe;if(_t){let Ot=[xe],Pt=[],Ft=St.length,hi=0,mi;for(ze=0;ze<=Ft;ze++){let Ai=St.charAt(ze);mi||Ai!=='"'&&Ai!=="'"?mi===Ai&&(mi=""):mi=Ai,mi||Ai!==" "&&ze!==Ft||(Pt.push(St.substr(hi,ze-hi)),hi=ze+1)}for(ze=Nn[_t].length;ze--;)Ot.unshift(K(Pt[ze+1]));_e=Nn[_t].apply(h,Ot),xe.isBlock&&typeof _e=="boolean"&&(_e=Wo(_e?Re:ft,h,v))}else{let Ot=Gc(St)?[St]:St.split(":");if(_e=K(Ot.shift()||""),Ot.length&&typeof _e=="number"){let Pt=Ot.join(":");if(z.test(Pt)){let Ft=parseInt((Pt.match(B)||["","-1"])[1],10);_e!==null&&(_e=te(_e,Ft,U.decimalPoint,Pt.indexOf(",")>-1?U.thousandsSep:""))}else _e=X.dateFormat(Pt,_e)}I.lastIndex=0,I.test(xe.find)&&Bn(_e)&&(_e=`"${_e}"`)}Y=Y.replace(xe.find,Ia(_e,""))}),ye?Wo(Y,h,v):Y}function Hc(Y,h,v,S){var ye;h=+h;let I,L,[z,B]=(Y=+Y||0).toString().split("e").map(Number),U=((ye=this==null?void 0:this.options)==null?void 0:ye.lang)||Di.lang,X=(Y.toString().split(".")[1]||"").split("e")[0].length,te=h,K={};v??(v=U.decimalPoint),S??(S=U.thousandsSep),h===-1?h=Math.min(X,20):wr(h)?h&&B<0&&((L=h+B)>=0?(z=+z.toExponential(L).split("e")[0],h=L):(z=Math.floor(z),Y=h<20?+(z*Math.pow(10,B)).toFixed(h):0,B=0)):h=2,B&&(h??(h=2),Y=z),wr(h)&&h>=0&&(K.minimumFractionDigits=h,K.maximumFractionDigits=h),S===""&&(K.useGrouping=!1);let re=S||v,ue=re?"en":(this==null?void 0:this.locale)||U.locale||Pi,ge=JSON.stringify(K)+ue;return I=($s[ge]??($s[ge]=new Intl.NumberFormat(ue,K))).format(Y),re&&(I=I.replace(/([,\.])/g,"_$1").replace(/_\,/g,S??",").replace("_.",v??".")),(h||+I!=0)&&(!(B<0)||te)||(I="0"),B&&+I!=0&&(I+="e"+(B<0?"":"+")+B),I}let Po={dateFormat:function(Y,h,v){return ki.dateFormat(Y,h,v)},format:Wo,helpers:Nn,numberFormat:Hc};(function(Y){let h;Y.rendererTypes={},Y.getRendererType=function(v=h){return Y.rendererTypes[v]||Y.rendererTypes[h]},Y.registerRendererType=function(v,S,I){Y.rendererTypes[v]=S,(!h||I)&&(h=v,Ne.Renderer=S)}})(A||(A={}));let Wc=A,{clamp:Hd,pick:Wd,pushUnique:Ks,stableSort:Io}=Bi;(N||(N={})).distribute=function Y(h,v,S){let I=h,L=I.reducedLen||v,z=(Re,ft)=>Re.target-ft.target,B=[],U=h.length,X=[],te=B.push,K,re,ue,ge=!0,ye,xe,_e=0,ze;for(K=U;K--;)_e+=h[K].size;if(_e>L){for(Io(h,(Re,ft)=>(ft.rank||0)-(Re.rank||0)),ue=(ze=h[0].rank===h[h.length-1].rank)?U/2:-1,re=ze?ue:U-1;ue&&_e>L;)ye=h[K=Math.floor(re)],Ks(X,K)&&(_e-=ye.size),re+=ue,ze&&re>=h.length&&(ue/=2,re=ue);X.sort((Re,ft)=>ft-Re).forEach(Re=>te.apply(B,h.splice(Re,1)))}for(Io(h,z),h=h.map(Re=>({size:Re.size,targets:[Re.target],align:Wd(Re.align,.5)}));ge;){for(K=h.length;K--;)ye=h[K],xe=(Math.min.apply(0,ye.targets)+Math.max.apply(0,ye.targets))/2,ye.pos=Hd(xe-ye.size*ye.align,0,v-ye.size);for(K=h.length,ge=!1;K--;)K>0&&h[K-1].pos+h[K-1].size>h[K].pos&&(h[K-1].size+=h[K].size,h[K-1].targets=h[K-1].targets.concat(h[K].targets),h[K-1].align=.5,h[K-1].pos+h[K-1].size>v&&(h[K-1].pos=v-h[K-1].size),h.splice(K,1),ge=!0)}return te.apply(I,B),K=0,h.some(Re=>{let ft=0;return(Re.targets||[]).some(()=>(I[K].pos=Re.pos+ft,S!==void 0&&Math.abs(I[K].pos-I[K].target)>S?(I.slice(0,K+1).forEach(St=>delete St.pos),I.reducedLen=(I.reducedLen||v)-.1*v,I.reducedLen>.1*v&&Y(I,v,S),!0):(ft+=I[K].size,K++,!1)))}),Io(I,z),I};let qo=N,{animate:Da,animObject:sa,stop:oa}=se,{deg2rad:Wu,doc:ml,svg:gl,SVG_NS:aa,win:gf,isFirefox:qd}=Ne,{addEvent:Yo,attr:Ar,createElement:Yd,crisp:Ii,css:Xd,defined:Do,erase:Bh,extend:Ji,fireEvent:qc,getAlignFactor:Ga,isArray:yi,isFunction:Lr,isNumber:Sr,isObject:Gs,isString:ka,merge:Tr,objectEach:Oa,pick:ps,pInt:_l,pushUnique:bs,replaceNested:wn,syncTimeout:Zd,uniqueKey:Js}=Bi;class rs{_defaultGetter(h){let v=ps(this[h+"Value"],this[h],this.element?this.element.getAttribute(h):null,0);return/^-?[\d\.]+$/.test(v)&&(v=parseFloat(v)),v}_defaultSetter(h,v,S){S.setAttribute(v,h)}add(h){let v,S=this.renderer,I=this.element;return h&&(this.parentGroup=h),this.textStr!==void 0&&this.element.nodeName==="text"&&S.buildText(this),this.added=!0,(!h||h.handleZ||this.zIndex)&&(v=this.zIndexSetter()),v||(h?h.element:S.box).appendChild(I),this.onAdd&&this.onAdd(),this}addClass(h,v){let S=v?"":this.attr("class")||"";return(h=(h||"").split(/ /g).reduce(function(I,L){return S.indexOf(L)===-1&&I.push(L),I},S?[S]:[]).join(" "))!==S&&this.attr("class",h),this}afterSetters(){this.doTransform&&(this.updateTransform(),this.doTransform=!1)}align(h,v,S,I=!0){let L=this.renderer,z=L.alignedObjects,B=!!h;h?(this.alignOptions=h,this.alignByTranslate=v,this.alignTo=S):(h=this.alignOptions||{},v=this.alignByTranslate,S=this.alignTo);let U=!S||ka(S)?S||"renderer":void 0;U&&(B&&bs(z,this),S=void 0);let X=ps(S,L[U],L),te=(X.x||0)+(h.x||0)+((X.width||0)-(h.width||0))*Ga(h.align),K=(X.y||0)+(h.y||0)+((X.height||0)-(h.height||0))*Ga(h.verticalAlign),re={"text-align":h==null?void 0:h.align};return re[v?"translateX":"x"]=Math.round(te),re[v?"translateY":"y"]=Math.round(K),I&&(this[this.placed?"animate":"attr"](re),this.placed=!0),this.alignAttr=re,this}alignSetter(h){let v={left:"start",center:"middle",right:"end"};v[h]&&(this.alignValue=h,this.element.setAttribute("text-anchor",v[h]))}animate(h,v,S){let I=sa(ps(v,this.renderer.globalAnimation,!0)),L=I.defer;return ml.hidden&&(I.duration=0),I.duration!==0?(S&&(I.complete=S),Zd(()=>{this.element&&Da(this,h,I)},L)):(this.attr(h,void 0,S||I.complete),Oa(h,function(z,B){I.step&&I.step.call(this,z,{prop:B,pos:1,elem:this})},this)),this}applyTextOutline(h){let v=this.element;h.indexOf("contrast")!==-1&&(h=h.replace(/contrast/g,this.renderer.getContrast(v.style.fill)));let S=h.split(" "),I=S[S.length-1],L=S[0];if(L&&L!=="none"&&Ne.svg){this.fakeTS=!0,L=L.replace(/(^[\d\.]+)(.*?)$/g,function(te,K,re){return 2*Number(K)+re}),this.removeTextOutline();let z=ml.createElementNS(aa,"tspan");Ar(z,{class:"highcharts-text-outline",fill:I,stroke:I,"stroke-width":L,"stroke-linejoin":"round"});let B=v.querySelector("textPath")||v;[].forEach.call(B.childNodes,te=>{let K=te.cloneNode(!0);K.removeAttribute&&["fill","stroke","stroke-width","stroke"].forEach(re=>K.removeAttribute(re)),z.appendChild(K)});let U=0;[].forEach.call(B.querySelectorAll("text tspan"),te=>{U+=Number(te.getAttribute("dy"))});let X=ml.createElementNS(aa,"tspan");X.textContent="​",Ar(X,{x:Number(v.getAttribute("x")),dy:-U}),z.appendChild(X),B.insertBefore(z,B.firstChild)}}attr(h,v,S,I){let{element:L}=this,z=rs.symbolCustomAttribs,B,U,X=this,te;return typeof h=="string"&&v!==void 0&&(B=h,(h={})[B]=v),typeof h=="string"?X=(this[h+"Getter"]||this._defaultGetter).call(this,h,L):(Oa(h,function(K,re){te=!1,I||oa(this,re),this.symbolName&&z.indexOf(re)!==-1&&(U||(this.symbolAttr(h),U=!0),te=!0),this.rotation&&(re==="x"||re==="y")&&(this.doTransform=!0),te||(this[re+"Setter"]||this._defaultSetter).call(this,K,re,L)},this),this.afterSetters()),S&&S.call(this),X}clip(h){if(h&&!h.clipPath){let v=Js()+"-",S=this.renderer.createElement("clipPath").attr({id:v}).add(this.renderer.defs);Ji(h,{clipPath:S,id:v,count:0}),h.add(S)}return this.attr("clip-path",h?`url(${this.renderer.url}#${h.id})`:"none")}crisp(h,v){v=Math.round(v||h.strokeWidth||0);let S=h.x||this.x||0,I=h.y||this.y||0,L=(h.width||this.width||0)+S,z=(h.height||this.height||0)+I,B=Ii(S,v),U=Ii(I,v);return Ji(h,{x:B,y:U,width:Ii(L,v)-B,height:Ii(z,v)-U}),Do(h.strokeWidth)&&(h.strokeWidth=v),h}complexColor(h,v,S){let I=this.renderer,L,z,B,U,X,te,K,re,ue,ge,ye=[],xe;qc(this.renderer,"complexColor",{args:arguments},function(){if(h.radialGradient?z="radialGradient":h.linearGradient&&(z="linearGradient"),z){if(B=h[z],X=I.gradients,te=h.stops,ue=S.radialReference,yi(B)&&(h[z]=B={x1:B[0],y1:B[1],x2:B[2],y2:B[3],gradientUnits:"userSpaceOnUse"}),z==="radialGradient"&&ue&&!Do(B.gradientUnits)&&(U=B,B=Tr(B,I.getRadialAttr(ue,U),{gradientUnits:"userSpaceOnUse"})),Oa(B,function(_e,ze){ze!=="id"&&ye.push(ze,_e)}),Oa(te,function(_e){ye.push(_e)}),X[ye=ye.join(",")])ge=X[ye].attr("id");else{B.id=ge=Js();let _e=X[ye]=I.createElement(z).attr(B).add(I.defs);_e.radAttr=U,_e.stops=[],te.forEach(function(ze){ze[1].indexOf("rgba")===0?(K=(L=Jr.parse(ze[1])).get("rgb"),re=L.get("a")):(K=ze[1],re=1);let Re=I.createElement("stop").attr({offset:ze[0],"stop-color":K,"stop-opacity":re}).add(_e);_e.stops.push(Re)})}xe="url("+I.url+"#"+ge+")",S.setAttribute(v,xe),S.gradient=ye,h.toString=function(){return xe}}})}css(h){let v=this.styles,S={},I=this.element,L,z=!v;if(v&&Oa(h,function(B,U){v&&v[U]!==B&&(S[U]=B,z=!0)}),z){v&&(h=Ji(v,S)),h.width===null||h.width==="auto"?delete this.textWidth:I.nodeName.toLowerCase()==="text"&&h.width&&(L=this.textWidth=_l(h.width)),Ji(this.styles,h),L&&!gl&&this.renderer.forExport&&delete h.width;let B=qd&&h.fontSize||null;B&&(Sr(B)||/^\d+$/.test(B))&&(h.fontSize+="px");let U=Tr(h);I.namespaceURI===this.SVG_NS&&(["textOutline","textOverflow","whiteSpace","width"].forEach(X=>U&&delete U[X]),U.color&&(U.fill=U.color)),Xd(I,U)}return this.added&&(this.element.nodeName==="text"&&this.renderer.buildText(this),h.textOutline&&this.applyTextOutline(h.textOutline)),this}dashstyleSetter(h){let v,S=this["stroke-width"];if(S==="inherit"&&(S=1),h=h&&h.toLowerCase()){let I=h.replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(",");for(v=I.length;v--;)I[v]=""+_l(I[v])*ps(S,NaN);h=I.join(",").replace(/NaN/g,"none"),this.element.setAttribute("stroke-dasharray",h)}}destroy(){var U;let h=this,v=h.element||{},S=h.renderer,I=v.ownerSVGElement,L=v.nodeName==="SPAN"&&h.parentGroup||void 0,z,B;if(v.onclick=v.onmouseout=v.onmouseover=v.onmousemove=v.point=null,oa(h),h.clipPath&&I){let X=h.clipPath;[].forEach.call(I.querySelectorAll("[clip-path],[CLIP-PATH]"),function(te){te.getAttribute("clip-path").indexOf(X.element.id)>-1&&te.removeAttribute("clip-path")}),h.clipPath=X.destroy()}if(h.connector=(U=h.connector)==null?void 0:U.destroy(),h.stops){for(B=0;B<h.stops.length;B++)h.stops[B].destroy();h.stops.length=0,h.stops=void 0}for(h.safeRemoveChild(v);L&&L.div&&L.div.childNodes.length===0;)z=L.parentGroup,h.safeRemoveChild(L.div),delete L.div,L=z;h.alignOptions&&Bh(S.alignedObjects,h),Oa(h,function(X,te){h[te]&&h[te].parentGroup===h&&h[te].destroy&&h[te].destroy(),delete h[te]})}dSetter(h,v,S){yi(h)&&(typeof h[0]=="string"&&(h=this.renderer.pathToSegments(h)),this.pathArray=h,h=h.reduce((I,L,z)=>L&&L.join?(z?I+" ":"")+L.join(" "):(L||"").toString(),"")),/(NaN| {2}|^$)/.test(h)&&(h="M 0 0"),this[v]!==h&&(S.setAttribute(v,h),this[v]=h)}fillSetter(h,v,S){typeof h=="string"?S.setAttribute(v,h):h&&this.complexColor(h,v,S)}hrefSetter(h,v,S){S.setAttributeNS("http://www.w3.org/1999/xlink",v,h)}getBBox(h,v){let S,I,L,z,{alignValue:B,element:U,renderer:X,styles:te,textStr:K}=this,{cache:re,cacheKeys:ue}=X,ge=U.namespaceURI===this.SVG_NS,ye=ps(v,this.rotation,0),xe=X.styledMode?U&&rs.prototype.getStyle.call(U,"font-size"):te.fontSize;if(Do(K)&&((z=K.toString()).indexOf("<")===-1&&(z=z.replace(/\d/g,"0")),z+=["",X.rootFontSize,xe,ye,this.textWidth,B,te.lineClamp,te.textOverflow,te.fontWeight].join(",")),z&&!h&&(S=re[z]),!S||S.polygon){if(ge||X.forExport){try{L=this.fakeTS&&function(ze){let Re=U.querySelector(".highcharts-text-outline");Re&&Xd(Re,{display:ze})},Lr(L)&&L("none"),S=U.getBBox?Ji({},U.getBBox()):{width:U.offsetWidth,height:U.offsetHeight,x:0,y:0},Lr(L)&&L("")}catch{}(!S||S.width<0)&&(S={x:0,y:0,width:0,height:0})}else S=this.htmlGetBBox();I=S.height,ge&&(S.height=I={"11px,17":14,"13px,20":16}[`${xe||""},${Math.round(I)}`]||I),ye&&(S=this.getRotatedBox(S,ye));let _e={bBox:S};qc(this,"afterGetBBox",_e),S=_e.bBox}if(z&&(K===""||S.height>0)){for(;ue.length>250;)delete re[ue.shift()];re[z]||ue.push(z),re[z]=S}return S}getRotatedBox(h,v){let{x:S,y:I,width:L,height:z}=h,{alignValue:B,translateY:U,rotationOriginX:X=0,rotationOriginY:te=0}=this,K=Ga(B),re=Number(this.element.getAttribute("y")||0)-(U?0:I),ue=v*Wu,ge=(v-90)*Wu,ye=Math.cos(ue),xe=Math.sin(ue),_e=L*ye,ze=L*xe,Re=Math.cos(ge),ft=Math.sin(ge),[[St,_t],[Ot,Pt]]=[X,te].map(_r=>[_r-_r*ye,_r*xe]),Ft=S+K*(L-_e)+St+Pt+re*Re,hi=Ft+_e,mi=hi-z*Re,Ai=mi-_e,ai=I+re-K*ze-_t+Ot+re*ft,Ci=ai+ze,Zi=Ci-z*ft,kr=Zi-ze,Hi=Math.min(Ft,hi,mi,Ai),gr=Math.min(ai,Ci,Zi,kr),Vi=Math.max(Ft,hi,mi,Ai)-Hi,Qi=Math.max(ai,Ci,Zi,kr)-gr;return{x:Hi,y:gr,width:Vi,height:Qi,polygon:[[Ft,ai],[hi,Ci],[mi,Zi],[Ai,kr]]}}getStyle(h){return gf.getComputedStyle(this.element||this,"").getPropertyValue(h)}hasClass(h){return(""+this.attr("class")).split(" ").indexOf(h)!==-1}hide(){return this.attr({visibility:"hidden"})}htmlGetBBox(){return{height:0,width:0,x:0,y:0}}constructor(h,v){this.onEvents={},this.opacity=1,this.SVG_NS=aa,this.element=v==="span"||v==="body"?Yd(v):ml.createElementNS(this.SVG_NS,v),this.renderer=h,this.styles={},qc(this,"afterInit")}on(h,v){let{onEvents:S}=this;return S[h]&&S[h](),S[h]=Yo(this.element,h,v),this}opacitySetter(h,v,S){let I=Number(Number(h).toFixed(3));this.opacity=I,S.setAttribute(v,I)}reAlign(){var h;(h=this.alignOptions)!=null&&h.width&&this.alignOptions.align!=="left"&&(this.alignOptions.width=this.getBBox().width,this.placed=!1,this.align())}removeClass(h){return this.attr("class",(""+this.attr("class")).replace(ka(h)?RegExp(`(^| )${h}( |$)`):h," ").replace(/ +/g," ").trim())}removeTextOutline(){let h=this.element.querySelector("tspan.highcharts-text-outline");h&&this.safeRemoveChild(h)}safeRemoveChild(h){let v=h.parentNode;v&&v.removeChild(h)}setRadialReference(h){let v=this.element.gradient&&this.renderer.gradients[this.element.gradient];return this.element.radialReference=h,v&&v.radAttr&&v.animate(this.renderer.getRadialAttr(h,v.radAttr)),this}shadow(h){var L;let{renderer:v}=this,S=Tr(((L=this.parentGroup)==null?void 0:L.rotation)===90?{offsetX:-1,offsetY:-1}:{},Gs(h)?h:{}),I=v.shadowDefinition(S);return this.attr({filter:h?`url(${v.url}#${I})`:"none"})}show(h=!0){return this.attr({visibility:h?"inherit":"visible"})}"stroke-widthSetter"(h,v,S){this[v]=h,S.setAttribute(v,h)}strokeWidth(){if(!this.renderer.styledMode)return this["stroke-width"]||0;let h=this.getStyle("stroke-width"),v=0,S;return/px$/.test(h)?v=_l(h):h!==""&&(Ar(S=ml.createElementNS(aa,"rect"),{width:h,"stroke-width":0}),this.element.parentNode.appendChild(S),v=S.getBBox().width,S.parentNode.removeChild(S)),v}symbolAttr(h){let v=this;rs.symbolCustomAttribs.forEach(function(S){v[S]=ps(h[S],v[S])}),v.attr({d:v.renderer.symbols[v.symbolName](v.x,v.y,v.width,v.height,v)})}textSetter(h){h!==this.textStr&&(delete this.textPxLength,this.textStr=h,this.added&&this.renderer.buildText(this),this.reAlign())}titleSetter(h){let v=this.element,S=v.getElementsByTagName("title")[0]||ml.createElementNS(this.SVG_NS,"title");v.insertBefore?v.insertBefore(S,v.firstChild):v.appendChild(S),S.textContent=wn(ps(h,""),[/<[^>]*>/g,""]).replace(/&lt;/g,"<").replace(/&gt;/g,">")}toFront(){let h=this.element;return h.parentNode.appendChild(h),this}translate(h,v){return this.attr({translateX:h,translateY:v})}updateTransform(h="transform"){var re;let{element:v,matrix:S,rotation:I=0,rotationOriginX:L,rotationOriginY:z,scaleX:B,scaleY:U,translateX:X=0,translateY:te=0}=this,K=["translate("+X+","+te+")"];Do(S)&&K.push("matrix("+S.join(",")+")"),I&&(K.push("rotate("+I+" "+ps(L,v.getAttribute("x"),0)+" "+ps(z,v.getAttribute("y")||0)+")"),((re=this.text)==null?void 0:re.element.tagName)==="SPAN"&&this.text.attr({rotation:I,rotationOriginX:(L||0)-this.padding,rotationOriginY:(z||0)-this.padding})),(Do(B)||Do(U))&&K.push("scale("+ps(B,1)+" "+ps(U,1)+")"),K.length&&!(this.text||this).textPath&&v.setAttribute(h,K.join(" "))}visibilitySetter(h,v,S){h==="inherit"?S.removeAttribute(v):this[v]!==h&&S.setAttribute(v,h),this[v]=h}xGetter(h){return this.element.nodeName==="circle"&&(h==="x"?h="cx":h==="y"&&(h="cy")),this._defaultGetter(h)}zIndexSetter(h,v){let S=this.renderer,I=this.parentGroup,L=(I||S).element||S.box,z=this.element,B=L===S.box,U,X,te,K=!1,re,ue=this.added,ge;if(Do(h)?(z.setAttribute("data-z-index",h),h=+h,this[v]===h&&(ue=!1)):Do(this[v])&&z.removeAttribute("data-z-index"),this[v]=h,ue){for((h=this.zIndex)&&I&&(I.handleZ=!0),ge=(U=L.childNodes).length-1;ge>=0&&!K;ge--)re=!Do(te=(X=U[ge]).getAttribute("data-z-index")),X!==z&&(h<0&&re&&!B&&!ge?(L.insertBefore(z,U[ge]),K=!0):(_l(te)<=h||re&&(!Do(h)||h>=0))&&(L.insertBefore(z,U[ge+1]),K=!0));K||(L.insertBefore(z,U[B?3:0]),K=!0)}return K}}rs.symbolCustomAttribs=["anchorX","anchorY","clockwise","end","height","innerR","r","start","width","x","y"],rs.prototype.strokeSetter=rs.prototype.fillSetter,rs.prototype.yGetter=rs.prototype.xGetter,rs.prototype.matrixSetter=rs.prototype.rotationOriginXSetter=rs.prototype.rotationOriginYSetter=rs.prototype.rotationSetter=rs.prototype.scaleXSetter=rs.prototype.scaleYSetter=rs.prototype.translateXSetter=rs.prototype.translateYSetter=rs.prototype.verticalAlignSetter=function(Y,h){this[h]=Y,this.doTransform=!0};let _o=rs,{defined:qu,extend:Yu,getAlignFactor:Ds,isNumber:yo,merge:ks,pick:Yc,removeEvent:La}=Bi;class Qr extends _o{constructor(h,v,S,I,L,z,B,U,X,te){let K;super(h,"g"),this.paddingLeftSetter=this.paddingSetter,this.paddingRightSetter=this.paddingSetter,this.doUpdate=!1,this.textStr=v,this.x=S,this.y=I,this.anchorX=z,this.anchorY=B,this.baseline=X,this.className=te,this.addClass(te==="button"?"highcharts-no-tooltip":"highcharts-label"),te&&this.addClass("highcharts-"+te),this.text=h.text(void 0,0,0,U).attr({zIndex:1}),typeof L=="string"&&((K=/^url\((.*?)\)$/.test(L))||this.renderer.symbols[L])&&(this.symbolKey=L),this.bBox=Qr.emptyBBox,this.padding=3,this.baselineOffset=0,this.needsBox=h.styledMode||K,this.deferredAttr={},this.alignFactor=0}alignSetter(h){let v=Ds(h);this.textAlign=h,v!==this.alignFactor&&(this.alignFactor=v,this.bBox&&yo(this.xSetting)&&this.attr({x:this.xSetting}))}anchorXSetter(h,v){this.anchorX=h,this.boxAttr(v,Math.round(h)-this.getCrispAdjust()-this.xSetting)}anchorYSetter(h,v){this.anchorY=h,this.boxAttr(v,h-this.ySetting)}boxAttr(h,v){this.box?this.box.attr(h,v):this.deferredAttr[h]=v}css(h){if(h){let v={};h=ks(h),Qr.textProps.forEach(S=>{h[S]!==void 0&&(v[S]=h[S],delete h[S])}),this.text.css(v),"fontSize"in v||"fontWeight"in v?this.updateTextPadding():("width"in v||"textOverflow"in v)&&this.updateBoxSize()}return _o.prototype.css.call(this,h)}destroy(){La(this.element,"mouseenter"),La(this.element,"mouseleave"),this.text&&this.text.destroy(),this.box&&(this.box=this.box.destroy()),_o.prototype.destroy.call(this)}fillSetter(h,v){h&&(this.needsBox=!0),this.fill=h,this.boxAttr(v,h)}getBBox(h,v){this.textStr&&this.bBox.width===0&&this.bBox.height===0&&this.updateBoxSize();let{padding:S,height:I=0,translateX:L=0,translateY:z=0,width:B=0}=this,U=Yc(this.paddingLeft,S),X=v??(this.rotation||0),te={width:B,height:I,x:L+this.bBox.x-U,y:z+this.bBox.y-S+this.baselineOffset};return X&&(te=this.getRotatedBox(te,X)),te}getCrispAdjust(){return(this.renderer.styledMode&&this.box?this.box.strokeWidth():this["stroke-width"]?parseInt(this["stroke-width"],10):0)%2/2}heightSetter(h){this.heightSetting=h,this.doUpdate=!0}afterSetters(){super.afterSetters(),this.doUpdate&&(this.updateBoxSize(),this.doUpdate=!1)}onAdd(){this.text.add(this),this.attr({text:Yc(this.textStr,""),x:this.x||0,y:this.y||0}),this.box&&qu(this.anchorX)&&this.attr({anchorX:this.anchorX,anchorY:this.anchorY})}paddingSetter(h,v){yo(h)?h!==this[v]&&(this[v]=h,this.updateTextPadding()):this[v]=void 0}rSetter(h,v){this.boxAttr(v,h)}strokeSetter(h,v){this.stroke=h,this.boxAttr(v,h)}"stroke-widthSetter"(h,v){h&&(this.needsBox=!0),this["stroke-width"]=h,this.boxAttr(v,h)}"text-alignSetter"(h){this.textAlign=this["text-align"]=h,this.updateTextPadding()}textSetter(h){h!==void 0&&this.text.attr({text:h}),this.updateTextPadding(),this.reAlign()}updateBoxSize(){let h,v=this.text,S={},I=this.padding,L=this.bBox=(!yo(this.widthSetting)||!yo(this.heightSetting)||this.textAlign)&&qu(v.textStr)?v.getBBox(void 0,0):Qr.emptyBBox;this.width=this.getPaddedWidth(),this.height=(this.heightSetting||L.height||0)+2*I;let z=this.renderer.fontMetrics(v);if(this.baselineOffset=I+Math.min((this.text.firstLineMetrics||z).b,L.height||1/0),this.heightSetting&&(this.baselineOffset+=(this.heightSetting-z.h)/2),this.needsBox&&!v.textPath){if(!this.box){let B=this.box=this.symbolKey?this.renderer.symbol(this.symbolKey):this.renderer.rect();B.addClass((this.className==="button"?"":"highcharts-label-box")+(this.className?" highcharts-"+this.className+"-box":"")),B.add(this)}h=this.getCrispAdjust(),S.x=h,S.y=(this.baseline?-this.baselineOffset:0)+h,S.width=Math.round(this.width),S.height=Math.round(this.height),this.box.attr(Yu(S,this.deferredAttr)),this.deferredAttr={}}}updateTextPadding(){let h=this.text,v=h.styles.textAlign||this.textAlign;if(!h.textPath){this.updateBoxSize();let S=this.baseline?0:this.baselineOffset,I=(this.paddingLeft??this.padding)+Ds(v)*(this.widthSetting??this.bBox.width);(I!==h.x||S!==h.y)&&(h.attr({align:v,x:I}),S!==void 0&&h.attr("y",S)),h.x=I,h.y=S}}widthSetter(h){this.widthSetting=yo(h)?h:void 0,this.doUpdate=!0}getPaddedWidth(){let h=this.padding,v=Yc(this.paddingLeft,h),S=Yc(this.paddingRight,h);return(this.widthSetting||this.bBox.width||0)+v+S}xSetter(h){this.x=h,this.alignFactor&&(h-=this.alignFactor*this.getPaddedWidth(),this["forceAnimate:x"]=!0),this.xSetting=Math.round(h),this.attr("translateX",this.xSetting)}ySetter(h){this.ySetting=this.y=Math.round(h),this.attr("translateY",this.ySetting)}}Qr.emptyBBox={width:0,height:0,x:0,y:0},Qr.textProps=["color","direction","fontFamily","fontSize","fontStyle","fontWeight","lineClamp","lineHeight","textAlign","textDecoration","textOutline","textOverflow","whiteSpace","width"];let{defined:ko,isNumber:ws,pick:yn}=Bi;function Xc(Y,h,v,S,I){let L=[];if(I){let z=I.start||0,B=yn(I.r,v),U=yn(I.r,S||v),X=2e-4/(I.borderRadius?1:Math.max(B,1)),te=Math.abs((I.end||0)-z-2*Math.PI)<X,K=(I.end||0)-(te?X:0),re=I.innerR,ue=yn(I.open,te),ge=Math.cos(z),ye=Math.sin(z),xe=Math.cos(K),_e=Math.sin(K),ze=yn(I.longArc,K-z-Math.PI<X?0:1),Re=["A",B,U,0,ze,yn(I.clockwise,1),Y+B*xe,h+U*_e];Re.params={start:z,end:K,cx:Y,cy:h},L.push(["M",Y+B*ge,h+U*ye],Re),ko(re)&&((Re=["A",re,re,0,ze,ko(I.clockwise)?1-I.clockwise:0,Y+re*ge,h+re*ye]).params={start:K,end:z,cx:Y,cy:h},L.push(ue?["M",Y+re*xe,h+re*_e]:["L",Y+re*xe,h+re*_e],Re)),ue||L.push(["Z"])}return L}function Xo(Y,h,v,S,I){return I&&I.r?Ha(Y,h,v,S,I):[["M",Y,h],["L",Y+v,h],["L",Y+v,h+S],["L",Y,h+S],["Z"]]}function Ha(Y,h,v,S,I){let L=(I==null?void 0:I.r)||0;return[["M",Y+L,h],["L",Y+v-L,h],["A",L,L,0,0,1,Y+v,h+L],["L",Y+v,h+S-L],["A",L,L,0,0,1,Y+v-L,h+S],["L",Y+L,h+S],["A",L,L,0,0,1,Y,h+S-L],["L",Y,h+L],["A",L,L,0,0,1,Y+L,h],["Z"]]}let Zc={arc:Xc,callout:function(Y,h,v,S,I){let L=Math.min(I&&I.r||0,v,S),z=L+6,B=I&&I.anchorX,U=I&&I.anchorY||0,X=Ha(Y,h,v,S,{r:L});if(!ws(B)||B<v&&B>0&&U<S&&U>0)return X;if(Y+B>v-z)if(U>h+z&&U<h+S-z)X.splice(3,1,["L",Y+v,U-6],["L",Y+v+6,U],["L",Y+v,U+6],["L",Y+v,h+S-L]);else if(B<v){let te=U<h+z,K=te?h:h+S;X.splice(te?2:5,0,["L",B,U],["L",Y+v-L,K])}else X.splice(3,1,["L",Y+v,S/2],["L",B,U],["L",Y+v,S/2],["L",Y+v,h+S-L]);else if(Y+B<z)if(U>h+z&&U<h+S-z)X.splice(7,1,["L",Y,U+6],["L",Y-6,U],["L",Y,U-6],["L",Y,h+L]);else if(B>0){let te=U<h+z,K=te?h:h+S;X.splice(te?1:6,0,["L",B,U],["L",Y+L,K])}else X.splice(7,1,["L",Y,S/2],["L",B,U],["L",Y,S/2],["L",Y,h+L]);else U>S&&B<v-z?X.splice(5,1,["L",B+6,h+S],["L",B,h+S+6],["L",B-6,h+S],["L",Y+L,h+S]):U<0&&B>z&&X.splice(1,1,["L",B-6,h],["L",B,h-6],["L",B+6,h],["L",v-L,h]);return X},circle:function(Y,h,v,S){return Xc(Y+v/2,h+S/2,v/2,S/2,{start:.5*Math.PI,end:2.5*Math.PI,open:!1})},diamond:function(Y,h,v,S){return[["M",Y+v/2,h],["L",Y+v,h+S/2],["L",Y+v/2,h+S],["L",Y,h+S/2],["Z"]]},rect:Xo,roundedRect:Ha,square:Xo,triangle:function(Y,h,v,S){return[["M",Y+v/2,h],["L",Y+v,h+S],["L",Y,h+S],["Z"]]},"triangle-down":function(Y,h,v,S){return[["M",Y,h],["L",Y+v,h],["L",Y+v/2,h+S],["Z"]]}},{doc:Oo,SVG_NS:Kd,win:Ra}=Ne,{attr:Jd,extend:Qd,fireEvent:no,isString:ep,objectEach:Nh,pick:Xu}=Bi,Ql=(Y,h)=>Y.substring(0,h)+"…",Vm=class{constructor(Y){let h=Y.styles;this.renderer=Y.renderer,this.svgElement=Y,this.width=Y.textWidth,this.textLineHeight=h&&h.lineHeight,this.textOutline=h&&h.textOutline,this.ellipsis=!!(h&&h.textOverflow==="ellipsis"),this.lineClamp=h==null?void 0:h.lineClamp,this.noWrap=!!(h&&h.whiteSpace==="nowrap")}buildSVG(){let Y=this.svgElement,h=Y.element,v=Y.renderer,S=Xu(Y.textStr,"").toString(),I=S.indexOf("<")!==-1,L=h.childNodes,z=!Y.added&&v.box,B=[S,this.ellipsis,this.noWrap,this.textLineHeight,this.textOutline,Y.getStyle("font-size"),Y.styles.lineClamp,this.width].join(",");if(B!==Y.textCache){Y.textCache=B,delete Y.actualWidth;for(let U=L.length;U--;)h.removeChild(L[U]);if(I||this.ellipsis||this.width||Y.textPath||S.indexOf(" ")!==-1&&(!this.noWrap||/<br.*?>/g.test(S))){if(S!==""){z&&z.appendChild(h);let U=new pi(S);this.modifyTree(U.nodes),U.addToDOM(h),this.modifyDOM(),this.ellipsis&&(h.textContent||"").indexOf("…")!==-1&&Y.attr("title",this.unescapeEntities(Y.textStr||"",["&lt;","&gt;"])),z&&z.removeChild(h)}}else h.appendChild(Oo.createTextNode(this.unescapeEntities(S)));ep(this.textOutline)&&Y.applyTextOutline&&Y.applyTextOutline(this.textOutline)}}modifyDOM(){let Y,h=this.svgElement,v=Jd(h.element,"x");for(h.firstLineMetrics=void 0;(Y=h.element.firstChild)&&/^[\s\u200B]*$/.test(Y.textContent||" ");)h.element.removeChild(Y);[].forEach.call(h.element.querySelectorAll("tspan.highcharts-br"),(z,B)=>{z.nextSibling&&z.previousSibling&&(B===0&&z.previousSibling.nodeType===1&&(h.firstLineMetrics=h.renderer.fontMetrics(z.previousSibling)),Jd(z,{dy:this.getLineHeight(z.nextSibling),x:v}))});let S=this.width||0;if(!S)return;let I=(z,B)=>{var ye;let U=z.textContent||"",X=U.replace(/([^\^])-/g,"$1- ").split(" "),te=!this.noWrap&&(X.length>1||h.element.childNodes.length>1),K=this.getLineHeight(B),re=Math.max(0,S-.8*K),ue=0,ge=h.actualWidth;if(te){let xe=[],_e=[];for(;B.firstChild&&B.firstChild!==z;)_e.push(B.firstChild),B.removeChild(B.firstChild);for(;X.length;)if(X.length&&!this.noWrap&&ue>0&&(xe.push(z.textContent||""),z.textContent=X.join(" ").replace(/- /g,"-")),this.truncate(z,void 0,X,ue===0&&ge||0,S,re,(ze,Re)=>X.slice(0,Re).join(" ").replace(/- /g,"-")),ge=h.actualWidth,ue++,this.lineClamp&&ue>=this.lineClamp){X.length&&(this.truncate(z,z.textContent||"",void 0,0,S,re,Ql),z.textContent=((ye=z.textContent)==null?void 0:ye.replace("…",""))+"…");break}_e.forEach(ze=>{B.insertBefore(ze,z)}),xe.forEach(ze=>{B.insertBefore(Oo.createTextNode(ze),z);let Re=Oo.createElementNS(Kd,"tspan");Re.textContent="​",Jd(Re,{dy:K,x:v}),B.insertBefore(Re,z)})}else this.ellipsis&&U&&this.truncate(z,U,void 0,0,S,re,Ql)},L=z=>{[].slice.call(z.childNodes).forEach(B=>{B.nodeType===Ra.Node.TEXT_NODE?I(B,z):(B.className.baseVal.indexOf("highcharts-br")!==-1&&(h.actualWidth=0),L(B))})};L(h.element)}getLineHeight(Y){let h=Y.nodeType===Ra.Node.TEXT_NODE?Y.parentElement:Y;return this.textLineHeight?parseInt(this.textLineHeight.toString(),10):this.renderer.fontMetrics(h||this.svgElement.element).h}modifyTree(Y){let h=(v,S)=>{let{attributes:I={},children:L,style:z={},tagName:B}=v,U=this.renderer.styledMode;if(B==="b"||B==="strong"?U?I.class="highcharts-strong":z.fontWeight="bold":(B==="i"||B==="em")&&(U?I.class="highcharts-emphasized":z.fontStyle="italic"),z&&z.color&&(z.fill=z.color),B==="br"){I.class="highcharts-br",v.textContent="​";let X=Y[S+1];X&&X.textContent&&(X.textContent=X.textContent.replace(/^ +/gm,""))}else B==="a"&&L&&L.some(X=>X.tagName==="#text")&&(v.children=[{children:L,tagName:"tspan"}]);B!=="#text"&&B!=="a"&&(v.tagName="tspan"),Qd(v,{attributes:I,style:z}),L&&L.filter(X=>X.tagName!=="#text").forEach(h)};Y.forEach(h),no(this.svgElement,"afterModifyTree",{nodes:Y})}truncate(Y,h,v,S,I,L,z){let B,U,X=this.svgElement,{rotation:te}=X,K=[],re=v&&!S?1:0,ue=(h||v||"").length,ge=ue;v||(I=L);let ye=function(xe,_e){let ze=_e||xe,Re=Y.parentNode;if(Re&&K[ze]===void 0&&Re.getSubStringLength)try{K[ze]=S+Re.getSubStringLength(0,v?ze+1:ze)}catch{}return K[ze]};if(X.rotation=0,S+(U=ye(Y.textContent.length))>I){for(;re<=ue;)ge=Math.ceil((re+ue)/2),v&&(B=z(v,ge)),U=ye(ge,B&&B.length-1),re===ue?re=ue+1:U>I?ue=ge-1:re=ge;ue===0?Y.textContent="":h&&ue===h.length-1||(Y.textContent=B||z(h||v,ge)),this.ellipsis&&U>I&&this.truncate(Y,Y.textContent||"",void 0,0,I,L,Ql)}v&&v.splice(0,ge),X.actualWidth=U,X.rotation=te}unescapeEntities(Y,h){return Nh(this.renderer.escapes,function(v,S){h&&h.indexOf(v)!==-1||(Y=Y.toString().replace(RegExp(v,"g"),S))}),Y}},{defaultOptions:Um}=zn,{charts:Zu,deg2rad:Kc,doc:Jc,isFirefox:ec,isMS:Vh,isWebKit:Wa,noop:yl,SVG_NS:jm,symbolSizes:tc,win:tp}=Ne,{addEvent:Ku,attr:Uh,createElement:ip,crisp:vl,css:Xi,defined:Si,destroyObjectProperties:jh,extend:Oi,isArray:Qc,isNumber:xl,isObject:zi,isString:eu,merge:qa,pick:Ju,pInt:$h,replaceNested:so,uniqueKey:Os}=Bi;class ei{constructor(h,v,S,I,L,z,B){let U,X,te=this.createElement("svg").attr({version:"1.1",class:"highcharts-root"}),K=te.element;B||te.css(this.getStyle(I||{})),h.appendChild(K),Uh(h,"dir","ltr"),h.innerHTML.indexOf("xmlns")===-1&&Uh(K,"xmlns",this.SVG_NS),this.box=K,this.boxWrapper=te,this.alignedObjects=[],this.url=this.getReferenceURL(),this.createElement("desc").add().element.appendChild(Jc.createTextNode("Created with Highcharts 12.1.2")),this.defs=this.createElement("defs").add(),this.allowHTML=z,this.forExport=L,this.styledMode=B,this.gradients={},this.cache={},this.cacheKeys=[],this.imgCount=0,this.rootFontSize=te.getStyle("font-size"),this.setSize(v,S,!1),ec&&h.getBoundingClientRect&&((U=function(){Xi(h,{left:0,top:0}),X=h.getBoundingClientRect(),Xi(h,{left:Math.ceil(X.left)-X.left+"px",top:Math.ceil(X.top)-X.top+"px"})})(),this.unSubPixelFix=Ku(tp,"resize",U))}definition(h){return new pi([h]).addToDOM(this.defs.element)}getReferenceURL(){if((ec||Wa)&&Jc.getElementsByTagName("base").length){if(!Si(c)){let h=Os(),v=new pi([{tagName:"svg",attributes:{width:8,height:8},children:[{tagName:"defs",children:[{tagName:"clipPath",attributes:{id:h},children:[{tagName:"rect",attributes:{width:4,height:4}}]}]},{tagName:"rect",attributes:{id:"hitme",width:8,height:8,"clip-path":`url(#${h})`,fill:"rgba(0,0,0,0.001)"}}]}]).addToDOM(Jc.body);Xi(v,{position:"fixed",top:0,left:0,zIndex:9e5});let S=Jc.elementFromPoint(6,6);c=(S&&S.id)==="hitme",Jc.body.removeChild(v)}if(c)return so(tp.location.href.split("#")[0],[/<[^>]*>/g,""],[/([\('\)])/g,"\\$1"],[/ /g,"%20"])}return""}getStyle(h){return this.style=Oi({fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif',fontSize:"1rem"},h),this.style}setStyle(h){this.boxWrapper.css(this.getStyle(h))}isHidden(){return!this.boxWrapper.getBBox().width}destroy(){let h=this.defs;return this.box=null,this.boxWrapper=this.boxWrapper.destroy(),jh(this.gradients||{}),this.gradients=null,this.defs=h.destroy(),this.unSubPixelFix&&this.unSubPixelFix(),this.alignedObjects=null,null}createElement(h){return new this.Element(this,h)}getRadialAttr(h,v){return{cx:h[0]-h[2]/2+(v.cx||0)*h[2],cy:h[1]-h[2]/2+(v.cy||0)*h[2],r:(v.r||0)*h[2]}}shadowDefinition(h){let v=[`highcharts-drop-shadow-${this.chartIndex}`,...Object.keys(h).map(I=>`${I}-${h[I]}`)].join("-").toLowerCase().replace(/[^a-z\d\-]/g,""),S=qa({color:"#000000",offsetX:1,offsetY:1,opacity:.15,width:5},h);return this.defs.element.querySelector(`#${v}`)||this.definition({tagName:"filter",attributes:{id:v,filterUnits:S.filterUnits},children:this.getShadowFilterContent(S)}),v}getShadowFilterContent(h){return[{tagName:"feDropShadow",attributes:{dx:h.offsetX,dy:h.offsetY,"flood-color":h.color,"flood-opacity":Math.min(5*h.opacity,1),stdDeviation:h.width/2}}]}buildText(h){new Vm(h).buildSVG()}getContrast(h){let v=Jr.parse(h).rgba.map(I=>{let L=I/255;return L<=.03928?L/12.92:Math.pow((L+.055)/1.055,2.4)}),S=.2126*v[0]+.7152*v[1]+.0722*v[2];return 1.05/(S+.05)>(S+.05)/.05?"#FFFFFF":"#000000"}button(h,v,S,I,L={},z,B,U,X,te){let K=this.label(h,v,S,X,void 0,void 0,te,void 0,"button"),re=this.styledMode,ue=arguments,ge=0;L=qa(Um.global.buttonTheme,L),re&&(delete L.fill,delete L.stroke,delete L["stroke-width"]);let ye=L.states||{},xe=L.style||{};delete L.states,delete L.style;let _e=[pi.filterUserAttributes(L)],ze=[xe];return re||["hover","select","disabled"].forEach((Re,ft)=>{_e.push(qa(_e[0],pi.filterUserAttributes(ue[ft+5]||ye[Re]||{}))),ze.push(_e[ft+1].style),delete _e[ft+1].style}),Ku(K.element,Vh?"mouseover":"mouseenter",function(){ge!==3&&K.setState(1)}),Ku(K.element,Vh?"mouseout":"mouseleave",function(){ge!==3&&K.setState(ge)}),K.setState=(Re=0)=>{if(Re!==1&&(K.state=ge=Re),K.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][Re]),!re){K.attr(_e[Re]);let ft=ze[Re];zi(ft)&&K.css(ft)}},K.attr(_e[0]),!re&&(K.css(Oi({cursor:"default"},xe)),te&&K.text.css({pointerEvents:"none"})),K.on("touchstart",Re=>Re.stopPropagation()).on("click",function(Re){ge!==3&&I.call(K,Re)})}crispLine(h,v){let[S,I]=h;return Si(S[1])&&S[1]===I[1]&&(S[1]=I[1]=vl(S[1],v)),Si(S[2])&&S[2]===I[2]&&(S[2]=I[2]=vl(S[2],v)),h}path(h){let v=this.styledMode?{}:{fill:"none"};return Qc(h)?v.d=h:zi(h)&&Oi(v,h),this.createElement("path").attr(v)}circle(h,v,S){let I=zi(h)?h:h===void 0?{}:{x:h,y:v,r:S},L=this.createElement("circle");return L.xSetter=L.ySetter=function(z,B,U){U.setAttribute("c"+B,z)},L.attr(I)}arc(h,v,S,I,L,z){let B;zi(h)?(v=(B=h).y,S=B.r,I=B.innerR,L=B.start,z=B.end,h=B.x):B={innerR:I,start:L,end:z};let U=this.symbol("arc",h,v,S,S,B);return U.r=S,U}rect(h,v,S,I,L,z){let B=zi(h)?h:h===void 0?{}:{x:h,y:v,r:L,width:Math.max(S||0,0),height:Math.max(I||0,0)},U=this.createElement("rect");return this.styledMode||(z!==void 0&&(B["stroke-width"]=z,Oi(B,U.crisp(B))),B.fill="none"),U.rSetter=function(X,te,K){U.r=X,Uh(K,{rx:X,ry:X})},U.rGetter=function(){return U.r||0},U.attr(B)}roundedRect(h){return this.symbol("roundedRect").attr(h)}setSize(h,v,S){this.width=h,this.height=v,this.boxWrapper.animate({width:h,height:v},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:Ju(S,!0)?void 0:0}),this.alignElements()}g(h){let v=this.createElement("g");return h?v.attr({class:"highcharts-"+h}):v}image(h,v,S,I,L,z){let B={preserveAspectRatio:"none"};xl(v)&&(B.x=v),xl(S)&&(B.y=S),xl(I)&&(B.width=I),xl(L)&&(B.height=L);let U=this.createElement("image").attr(B),X=function(te){U.attr({href:h}),z.call(U,te)};if(z){U.attr({href:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="});let te=new tp.Image;Ku(te,"load",X),te.src=h,te.complete&&X({})}else U.attr({href:h});return U}symbol(h,v,S,I,L,z){let B,U,X,te,K=this,re=/^url\((.*?)\)$/,ue=re.test(h),ge=!ue&&(this.symbols[h]?h:"circle"),ye=ge&&this.symbols[ge];if(ye)typeof v=="number"&&(U=ye.call(this.symbols,v||0,S||0,I||0,L||0,z)),B=this.path(U),K.styledMode||B.attr("fill","none"),Oi(B,{symbolName:ge||void 0,x:v,y:S,width:I,height:L}),z&&Oi(B,z);else if(ue){X=h.match(re)[1];let xe=B=this.image(X);xe.imgwidth=Ju(z&&z.width,tc[X]&&tc[X].width),xe.imgheight=Ju(z&&z.height,tc[X]&&tc[X].height),te=_e=>_e.attr({width:_e.width,height:_e.height}),["width","height"].forEach(_e=>{xe[`${_e}Setter`]=function(ze,Re){this[Re]=ze;let{alignByTranslate:ft,element:St,width:_t,height:Ot,imgwidth:Pt,imgheight:Ft}=this,hi=Re==="width"?Pt:Ft,mi=1;z&&z.backgroundSize==="within"&&_t&&Ot&&Pt&&Ft?(mi=Math.min(_t/Pt,Ot/Ft),Uh(St,{width:Math.round(Pt*mi),height:Math.round(Ft*mi)})):St&&hi&&St.setAttribute(Re,hi),!ft&&Pt&&Ft&&this.translate(((_t||0)-Pt*mi)/2,((Ot||0)-Ft*mi)/2)}}),Si(v)&&xe.attr({x:v,y:S}),xe.isImg=!0,xe.symbolUrl=h,Si(xe.imgwidth)&&Si(xe.imgheight)?te(xe):(xe.attr({width:0,height:0}),ip("img",{onload:function(){let _e=Zu[K.chartIndex];this.width===0&&(Xi(this,{position:"absolute",top:"-999em"}),Jc.body.appendChild(this)),tc[X]={width:this.width,height:this.height},xe.imgwidth=this.width,xe.imgheight=this.height,xe.element&&te(xe),this.parentNode&&this.parentNode.removeChild(this),K.imgCount--,K.imgCount||!_e||_e.hasLoaded||_e.onload()},src:X}),this.imgCount++)}return B}clipRect(h,v,S,I){return this.rect(h,v,S,I,0)}text(h,v,S,I){let L={};if(I&&(this.allowHTML||!this.forExport))return this.html(h,v,S);L.x=Math.round(v||0),S&&(L.y=Math.round(S)),Si(h)&&(L.text=h);let z=this.createElement("text").attr(L);return I&&(!this.forExport||this.allowHTML)||(z.xSetter=function(B,U,X){let te=X.getElementsByTagName("tspan"),K=X.getAttribute(U);for(let re=0,ue;re<te.length;re++)(ue=te[re]).getAttribute(U)===K&&ue.setAttribute(U,B);X.setAttribute(U,B)}),z}fontMetrics(h){let v=$h(_o.prototype.getStyle.call(h,"font-size")||0),S=v<24?v+3:Math.round(1.2*v),I=Math.round(.8*S);return{h:S,b:I,f:v}}rotCorr(h,v,S){let I=h;return v&&S&&(I=Math.max(I*Math.cos(v*Kc),4)),{x:-h/3*Math.sin(v*Kc),y:I}}pathToSegments(h){let v=[],S=[],I={A:8,C:7,H:2,L:3,M:3,Q:5,S:5,T:3,V:2};for(let L=0;L<h.length;L++)eu(S[0])&&xl(h[L])&&S.length===I[S[0].toUpperCase()]&&h.splice(L,0,S[0].replace("M","L").replace("m","l")),typeof h[L]=="string"&&(S.length&&v.push(S.slice(0)),S.length=0),S.push(h[L]);return v.push(S.slice(0)),v}label(h,v,S,I,L,z,B,U,X){return new Qr(this,h,v,S,I,L,z,B,U,X)}alignElements(){this.alignedObjects.forEach(h=>h.align())}}Oi(ei.prototype,{Element:_o,SVG_NS:jm,escapes:{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},symbols:Zc,draw:yl}),Wc.registerRendererType("svg",ei,!0);let{composed:rp}=Ne,{attr:Gh,css:za,createElement:bl,defined:fs,extend:Ya,getAlignFactor:np,isNumber:ic,pInt:rc,pushUnique:nc}=Bi;function Hh(Y,h,v){var I;let S=((I=this.div)==null?void 0:I.style)||v.style;_o.prototype[`${h}Setter`].call(this,Y,h,v),S&&(S[h]=Y)}let $m=(Y,h)=>{var v;if(!Y.div){let S=Gh(Y.element,"class"),I=Y.css,L=bl("div",S?{className:S}:void 0,{position:"absolute",left:`${Y.translateX||0}px`,top:`${Y.translateY||0}px`,...Y.styles,display:Y.display,opacity:Y.opacity,visibility:Y.visibility},((v=Y.parentGroup)==null?void 0:v.div)||h);Y.classSetter=(z,B,U)=>{U.setAttribute("class",z),L.className=z},Y.translateXSetter=Y.translateYSetter=(z,B)=>{Y[B]=z,L.style[B==="translateX"?"left":"top"]=`${z}px`,Y.doTransform=!0},Y.opacitySetter=Y.visibilitySetter=Hh,Y.css=z=>(I.call(Y,z),z.cursor&&(L.style.cursor=z.cursor),z.pointerEvents&&(L.style.pointerEvents=z.pointerEvents),Y),Y.on=function(){return _o.prototype.on.apply({element:L,onEvents:Y.onEvents},arguments),Y},Y.div=L}return Y.div};class sc extends _o{static compose(h){nc(rp,this.compose)&&(h.prototype.html=function(v,S,I){return new sc(this,"span").attr({text:v,x:Math.round(S),y:Math.round(I)})})}constructor(h,v){super(h,v),this.css({position:"absolute",...h.styledMode?{}:{fontFamily:h.style.fontFamily,fontSize:h.style.fontSize}})}getSpanCorrection(h,v,S){this.xCorr=-h*S,this.yCorr=-v}css(h){let v,{element:S}=this,I=S.tagName==="SPAN"&&h&&"width"in h,L=I&&h.width;return I&&(delete h.width,this.textWidth=rc(L)||void 0,v=!0),(h==null?void 0:h.textOverflow)==="ellipsis"&&(h.overflow="hidden"),h!=null&&h.lineClamp&&(h.display="-webkit-box",h.WebkitLineClamp=h.lineClamp,h.WebkitBoxOrient="vertical",h.overflow="hidden"),ic(Number(h==null?void 0:h.fontSize))&&(h.fontSize=h.fontSize+"px"),Ya(this.styles,h),za(S,h),v&&this.updateTransform(),this}htmlGetBBox(){let{element:h}=this;return{x:h.offsetLeft,y:h.offsetTop,width:h.offsetWidth,height:h.offsetHeight}}updateTransform(){var _e;if(!this.added){this.alignOnAdd=!0;return}let{element:h,renderer:v,rotation:S,rotationOriginX:I,rotationOriginY:L,scaleX:z,scaleY:B,styles:U,textAlign:X="left",textWidth:te,translateX:K=0,translateY:re=0,x:ue=0,y:ge=0}=this,{display:ye="block",whiteSpace:xe}=U;if(za(h,{marginLeft:`${K}px`,marginTop:`${re}px`}),h.tagName==="SPAN"){let ze,Re=[S,X,h.innerHTML,te,this.textAlign].join(","),ft=-(((_e=this.parentGroup)==null?void 0:_e.padding)*1)||0;if(te!==this.oldTextWidth){let Pt=this.textPxLength?this.textPxLength:(za(h,{width:"",whiteSpace:xe||"nowrap"}),h.offsetWidth),Ft=te||0;(Ft>this.oldTextWidth||Pt>Ft)&&(/[ \-]/.test(h.textContent||h.innerText)||h.style.textOverflow==="ellipsis")&&(za(h,{width:Pt>Ft||S||z?te+"px":"auto",display:ye,whiteSpace:xe||"normal"}),this.oldTextWidth=te)}Re!==this.cTT&&(ze=v.fontMetrics(h).b,fs(S)&&(S!==(this.oldRotation||0)||X!==this.oldAlign)&&this.setSpanRotation(S,ft,ft),this.getSpanCorrection(!fs(S)&&!this.textWidth&&this.textPxLength||h.offsetWidth,ze,np(X)));let{xCorr:St=0,yCorr:_t=0}=this,Ot={left:`${ue+St}px`,top:`${ge+_t}px`,textAlign:X,transformOrigin:`${(I??ue)-St-ue-ft}px ${(L??ge)-_t-ge-ft}px`};(z||B)&&(Ot.transform=`scale(${z??1},${B??1})`),za(h,Ot),this.cTT=Re,this.oldRotation=S,this.oldAlign=X}}setSpanRotation(h,v,S){za(this.element,{transform:`rotate(${h}deg)`,transformOrigin:`${v}% ${S}px`})}add(h){let v,S=this.renderer.box.parentNode,I=[];if(this.parentGroup=h,h&&!(v=h.div)){let L=h;for(;L;)I.push(L),L=L.parentGroup;for(let z of I.reverse())v=$m(z,S)}return(v||S).appendChild(this.element),this.added=!0,this.alignOnAdd&&this.updateTransform(),this}textSetter(h){h!==this.textStr&&(delete this.bBox,delete this.oldTextWidth,pi.setElementHTML(this.element,h??""),this.textStr=h,this.doTransform=!0)}alignSetter(h){this.alignValue=this.textAlign=h,this.doTransform=!0}xSetter(h,v){this[v]=h,this.doTransform=!0}}let oc=sc.prototype;oc.visibilitySetter=oc.opacitySetter=Hh,oc.ySetter=oc.rotationSetter=oc.rotationOriginXSetter=oc.rotationOriginYSetter=oc.xSetter,function(Y){Y.xAxis={alignTicks:!0,allowDecimals:void 0,panningEnabled:!0,zIndex:2,zoomEnabled:!0,dateTimeLabelFormats:{millisecond:{main:"%[HMSL]",range:!1},second:{main:"%[HMS]",range:!1},minute:{main:"%[HM]",range:!1},hour:{main:"%[HM]",range:!1},day:{main:"%[eb]"},week:{main:"%[eb]"},month:{main:"%[bY]"},year:{main:"%Y"}},endOnTick:!1,gridLineDashStyle:"Solid",gridZIndex:1,labels:{autoRotationLimit:80,distance:15,enabled:!0,indentation:10,overflow:"justify",reserveSpace:void 0,rotation:void 0,staggerLines:0,step:0,useHTML:!1,zIndex:7,style:{color:"#333333",cursor:"default",fontSize:"0.8em",textOverflow:"ellipsis"}},maxPadding:.01,minorGridLineDashStyle:"Solid",minorTickLength:2,minorTickPosition:"outside",minorTicksPerMajor:5,minPadding:.01,offset:void 0,reversed:void 0,reversedStacks:!1,showEmpty:!0,showFirstLabel:!0,showLastLabel:!0,startOfWeek:1,startOnTick:!1,tickLength:10,tickPixelInterval:100,tickmarkPlacement:"between",tickPosition:"outside",title:{align:"middle",useHTML:!1,x:0,y:0,style:{color:"#666666",fontSize:"0.8em"}},visible:!0,minorGridLineColor:"#f2f2f2",minorGridLineWidth:1,minorTickColor:"#999999",lineColor:"#333333",lineWidth:1,gridLineColor:"#e6e6e6",gridLineWidth:void 0,tickColor:"#333333"},Y.yAxis={reversedStacks:!0,endOnTick:!0,maxPadding:.05,minPadding:.05,tickPixelInterval:72,showLastLabel:!0,labels:{x:void 0},startOnTick:!0,title:{text:"Values"},stackLabels:{animation:{},allowOverlap:!1,enabled:!1,crop:!0,overflow:"justify",formatter:function(){let{numberFormatter:h}=this.axis.chart;return h(this.total||0,-1)},style:{color:"#000000",fontSize:"0.7em",fontWeight:"bold",textOutline:"1px contrast"}},gridLineWidth:1,lineWidth:0}}(r||(r={}));let _f=r,{addEvent:sp,isFunction:op,objectEach:Gm,removeEvent:yf}=Bi;(q||(q={})).registerEventOptions=function(Y,h){Y.eventOptions=Y.eventOptions||{},Gm(h.events,function(v,S){Y.eventOptions[S]!==v&&(Y.eventOptions[S]&&(yf(Y,S,Y.eventOptions[S]),delete Y.eventOptions[S]),op(v)&&(Y.eventOptions[S]=v,sp(Y,S,v,{order:0})))})};let Fa=q,{deg2rad:ap}=Ne,{clamp:vf,correctFloat:tu,defined:ac,destroyObjectProperties:xf,extend:Lo,fireEvent:wl,getAlignFactor:Qu,isNumber:lc,merge:Sl,objectEach:Wh,pick:Ro}=Bi,Zo=class{constructor(Y,h,v,S,I){this.isNew=!0,this.isNewLabel=!0,this.axis=Y,this.pos=h,this.type=v||"",this.parameters=I||{},this.tickmarkOffset=this.parameters.tickmarkOffset,this.options=this.parameters.options,wl(this,"init"),v||S||this.addLabel()}addLabel(){let Y=this,h=Y.axis,v=h.options,S=h.chart,I=h.categories,L=h.logarithmic,z=h.names,B=Y.pos,U=Ro(Y.options&&Y.options.labels,v.labels),X=h.tickPositions,te=B===X[0],K=B===X[X.length-1],re=(!U.step||U.step===1)&&h.tickInterval===1,ue=X.info,ge=Y.label,ye,xe,_e,ze=this.parameters.category||(I?Ro(I[B],z[B],B):B);L&&lc(ze)&&(ze=tu(L.lin2log(ze))),h.dateTime&&(ue?ye=(xe=S.time.resolveDTLFormat(v.dateTimeLabelFormats[!v.grid&&ue.higherRanks[B]||ue.unitName])).main:lc(ze)&&(ye=h.dateTime.getXDateFormat(ze,v.dateTimeLabelFormats||{}))),Y.isFirst=te,Y.isLast=K;let Re={axis:h,chart:S,dateTimeLabelFormat:ye,isFirst:te,isLast:K,pos:B,tick:Y,tickPositionInfo:ue,value:ze};wl(this,"labelFormat",Re);let ft=Ot=>U.formatter?U.formatter.call(Ot,Ot):U.format?(Ot.text=h.defaultLabelFormatter.call(Ot),Po.format(U.format,Ot,S)):h.defaultLabelFormatter.call(Ot),St=ft.call(Re,Re),_t=xe&&xe.list;_t?Y.shortenLabel=function(){for(_e=0;_e<_t.length;_e++)if(Lo(Re,{dateTimeLabelFormat:_t[_e]}),ge.attr({text:ft.call(Re,Re)}),ge.getBBox().width<h.getSlotWidth(Y)-2*(U.padding||0))return;ge.attr({text:""})}:Y.shortenLabel=void 0,re&&h._addedPlotLB&&Y.moveLabel(St,U),ac(ge)||Y.movedLabel?ge&&ge.textStr!==St&&!re&&(!ge.textWidth||U.style.width||ge.styles.width||ge.css({width:null}),ge.attr({text:St}),ge.textPxLength=ge.getBBox().width):(Y.label=ge=Y.createLabel(St,U),Y.rotation=0)}createLabel(Y,h,v){let S=this.axis,{renderer:I,styledMode:L}=S.chart,z=ac(Y)&&h.enabled?I.text(Y,v==null?void 0:v.x,v==null?void 0:v.y,h.useHTML).add(S.labelGroup):void 0;if(z){let B=h.style.whiteSpace||"normal";L||z.css(Sl(h.style,{whiteSpace:"nowrap"})),z.textPxLength=z.getBBox().width,L||z.css({whiteSpace:B})}return z}destroy(){xf(this,this.axis)}getPosition(Y,h,v,S){let I=this.axis,L=I.chart,z=S&&L.oldChartHeight||L.chartHeight,B={x:Y?tu(I.translate(h+v,void 0,void 0,S)+I.transB):I.left+I.offset+(I.opposite?(S&&L.oldChartWidth||L.chartWidth)-I.right-I.left:0),y:Y?z-I.bottom+I.offset-(I.opposite?I.height:0):tu(z-I.translate(h+v,void 0,void 0,S)-I.transB)};return B.y=vf(B.y,-1e9,1e9),wl(this,"afterGetPosition",{pos:B}),B}getLabelPosition(Y,h,v,S,I,L,z,B){let U,X,te=this.axis,K=te.transA,re=te.isLinked&&te.linkedParent?te.linkedParent.reversed:te.reversed,ue=te.staggerLines,ge=te.tickRotCorr||{x:0,y:0},ye=S||te.reserveSpaceDefault?0:-te.labelOffset*(te.labelAlign==="center"?.5:1),xe=I.distance,_e={};return U=te.side===0?v.rotation?-xe:-v.getBBox().height:te.side===2?ge.y+xe:Math.cos(v.rotation*ap)*(ge.y-v.getBBox(!1,0).height/2),ac(I.y)&&(U=te.side===0&&te.horiz?I.y+U:I.y),Y=Y+Ro(I.x,[0,1,0,-1][te.side]*xe)+ye+ge.x-(L&&S?L*K*(re?-1:1):0),h=h+U-(L&&!S?L*K*(re?1:-1):0),ue&&(X=z/(B||1)%ue,te.opposite&&(X=ue-X-1),h+=X*(te.labelOffset/ue)),_e.x=Y,_e.y=Math.round(h),wl(this,"afterGetLabelPosition",{pos:_e,tickmarkOffset:L,index:z}),_e}getLabelSize(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0}getMarkPath(Y,h,v,S,I=!1,L){return L.crispLine([["M",Y,h],["L",Y+(I?0:-v),h+(I?v:0)]],S)}handleOverflow(Y){let h=this.axis,v=h.options.labels,S=Y.x,I=h.chart.chartWidth,L=h.chart.spacing,z=Ro(h.labelLeft,Math.min(h.pos,L[3])),B=Ro(h.labelRight,Math.max(h.isRadial?0:h.pos+h.len,I-L[1])),U=this.label,X=this.rotation,te=Qu(h.labelAlign||U.attr("align")),K=U.getBBox().width,re=h.getSlotWidth(this),ue=re,ge=1,ye,xe,_e;X||v.overflow!=="justify"?X<0&&S-te*K<z?_e=Math.round(S/Math.cos(X*ap)-z):X>0&&S+te*K>B&&(_e=Math.round((I-S)/Math.cos(X*ap))):(ye=S-te*K,xe=S+(1-te)*K,ye<z?ue=Y.x+ue*(1-te)-z:xe>B&&(ue=B-Y.x+ue*te,ge=-1),(ue=Math.min(re,ue))<re&&h.labelAlign==="center"&&(Y.x+=ge*(re-ue-te*(re-Math.min(K,ue)))),(K>ue||h.autoRotation&&(U.styles||{}).width)&&(_e=ue)),_e&&U&&(this.shortenLabel?this.shortenLabel():U.css(Lo({},{width:Math.floor(_e)+"px",lineClamp:h.isRadial?0:1})))}moveLabel(Y,h){let v=this,S=v.label,I=v.axis,L=!1,z;S&&S.textStr===Y?(v.movedLabel=S,L=!0,delete v.label):Wh(I.ticks,function(B){L||B.isNew||B===v||!B.label||B.label.textStr!==Y||(v.movedLabel=B.label,L=!0,B.labelPos=v.movedLabel.xy,delete B.label)}),!L&&(v.labelPos||S)&&(z=v.labelPos||S.xy,v.movedLabel=v.createLabel(Y,h,z),v.movedLabel&&v.movedLabel.attr({opacity:0}))}render(Y,h,v){let S=this.axis,I=S.horiz,L=this.pos,z=Ro(this.tickmarkOffset,S.tickmarkOffset),B=this.getPosition(I,L,z,h),U=B.x,X=B.y,te=S.pos,K=te+S.len,re=I?U:X;!S.chart.polar&&this.isNew&&(tu(re)<te||re>K)&&(v=0);let ue=Ro(v,this.label&&this.label.newOpacity,1);v=Ro(v,1),this.isActive=!0,this.renderGridLine(h,v),this.renderMark(B,v),this.renderLabel(B,h,ue,Y),this.isNew=!1,wl(this,"afterRender")}renderGridLine(Y,h){let v=this.axis,S=v.options,I={},L=this.pos,z=this.type,B=Ro(this.tickmarkOffset,v.tickmarkOffset),U=v.chart.renderer,X=this.gridLine,te,K=S.gridLineWidth,re=S.gridLineColor,ue=S.gridLineDashStyle;this.type==="minor"&&(K=S.minorGridLineWidth,re=S.minorGridLineColor,ue=S.minorGridLineDashStyle),X||(v.chart.styledMode||(I.stroke=re,I["stroke-width"]=K||0,I.dashstyle=ue),z||(I.zIndex=1),Y&&(h=0),this.gridLine=X=U.path().attr(I).addClass("highcharts-"+(z?z+"-":"")+"grid-line").add(v.gridGroup)),X&&(te=v.getPlotLinePath({value:L+B,lineWidth:X.strokeWidth(),force:"pass",old:Y,acrossPanes:!1}))&&X[Y||this.isNew?"attr":"animate"]({d:te,opacity:h})}renderMark(Y,h){let v=this.axis,S=v.options,I=v.chart.renderer,L=this.type,z=v.tickSize(L?L+"Tick":"tick"),B=Y.x,U=Y.y,X=Ro(S[L!=="minor"?"tickWidth":"minorTickWidth"],!L&&v.isXAxis?1:0),te=S[L!=="minor"?"tickColor":"minorTickColor"],K=this.mark,re=!K;z&&(v.opposite&&(z[0]=-z[0]),K||(this.mark=K=I.path().addClass("highcharts-"+(L?L+"-":"")+"tick").add(v.axisGroup),v.chart.styledMode||K.attr({stroke:te,"stroke-width":X})),K[re?"attr":"animate"]({d:this.getMarkPath(B,U,z[0],K.strokeWidth(),v.horiz,I),opacity:h}))}renderLabel(Y,h,v,S){let I=this.axis,L=I.horiz,z=I.options,B=this.label,U=z.labels,X=U.step,te=Ro(this.tickmarkOffset,I.tickmarkOffset),K=Y.x,re=Y.y,ue=!0;B&&lc(K)&&(B.xy=Y=this.getLabelPosition(K,re,B,L,U,te,S,X),(!this.isFirst||this.isLast||z.showFirstLabel)&&(!this.isLast||this.isFirst||z.showLastLabel)?!L||U.step||U.rotation||h||v===0||this.handleOverflow(Y):ue=!1,X&&S%X&&(ue=!1),ue&&lc(Y.y)?(Y.opacity=v,B[this.isNewLabel?"attr":"animate"](Y).show(!0),this.isNewLabel=!1):(B.hide(),this.isNewLabel=!0))}replaceMovedLabel(){let Y=this.label,h=this.axis;Y&&!this.isNew&&(Y.animate({opacity:0},void 0,Y.destroy),delete this.label),h.isDirty=!0,this.label=this.movedLabel,delete this.movedLabel}},{animObject:iu}=se,{xAxis:ru,yAxis:eh}=_f,{defaultOptions:Xa}=zn,{registerEventOptions:cc}=Fa,{deg2rad:nu}=Ne,{arrayMax:su,arrayMin:qh,clamp:uc,correctFloat:Ls,defined:Yr,destroyObjectProperties:fr,erase:lp,error:Tl,extend:th,fireEvent:An,getClosestDistance:bf,insertItem:sn,isArray:Yh,isNumber:ir,isString:Xh,merge:ou,normalizeTickInterval:wf,objectEach:ih,pick:Or,relativeLength:Ml,removeEvent:rh,splat:Sf,syncTimeout:vo}=Bi,Zh=(Y,h)=>wf(h,void 0,void 0,Or(Y.options.allowDecimals,h<.5||Y.tickAmount!==void 0),!!Y.tickAmount);th(Xa,{xAxis:ru,yAxis:ou(ru,eh)});class Za{constructor(h,v,S){this.init(h,v,S)}init(h,v,S=this.coll){let I=S==="xAxis",L=this.isZAxis||(h.inverted?!I:I);this.chart=h,this.horiz=L,this.isXAxis=I,this.coll=S,An(this,"init",{userOptions:v}),this.opposite=Or(v.opposite,this.opposite),this.side=Or(v.side,this.side,L?this.opposite?0:2:this.opposite?1:3),this.setOptions(v);let z=this.options,B=z.labels;this.type??(this.type=z.type||"linear"),this.uniqueNames??(this.uniqueNames=z.uniqueNames??!0),An(this,"afterSetType"),this.userOptions=v,this.minPixelPadding=0,this.reversed=Or(z.reversed,this.reversed),this.visible=z.visible,this.zoomEnabled=z.zoomEnabled,this.hasNames=this.type==="category"||z.categories===!0,this.categories=Yh(z.categories)&&z.categories||(this.hasNames?[]:void 0),this.names||(this.names=[],this.names.keys={}),this.plotLinesAndBandsGroups={},this.positiveValuesOnly=!!this.logarithmic,this.isLinked=Yr(z.linkedTo),this.ticks={},this.labelEdge=[],this.minorTicks={},this.plotLinesAndBands=[],this.alternateBands={},this.len??(this.len=0),this.minRange=this.userMinRange=z.minRange||z.maxZoom,this.range=z.range,this.offset=z.offset||0,this.max=void 0,this.min=void 0;let U=Or(z.crosshair,Sf(h.options.tooltip.crosshairs)[I?0:1]);this.crosshair=U===!0?{}:U,h.axes.indexOf(this)===-1&&(I?h.axes.splice(h.xAxis.length,0,this):h.axes.push(this),sn(this,h[this.coll])),h.orderItems(this.coll),this.series=this.series||[],h.inverted&&!this.isZAxis&&I&&!Yr(this.reversed)&&(this.reversed=!0),this.labelRotation=ir(B.rotation)?B.rotation:void 0,cc(this,z),An(this,"afterInit")}setOptions(h){let v=this.horiz?{labels:{autoRotation:[-45],padding:3},margin:15}:{labels:{padding:1},title:{rotation:90*this.side}};this.options=ou(v,Xa[this.coll],h),An(this,"afterSetOptions",{userOptions:h})}defaultLabelFormatter(){let h=this.axis,{numberFormatter:v}=this.chart,S=ir(this.value)?this.value:NaN,I=h.chart.time,L=h.categories,z=this.dateTimeLabelFormat,B=Xa.lang,U=B.numericSymbols,X=B.numericSymbolMagnitude||1e3,te=h.logarithmic?Math.abs(S):h.tickInterval,K=U&&U.length,re,ue;if(L)ue=`${this.value}`;else if(z)ue=I.dateFormat(z,S,!0);else if(K&&U&&te>=1e3)for(;K--&&ue===void 0;)te>=(re=Math.pow(X,K+1))&&10*S%re==0&&U[K]!==null&&S!==0&&(ue=v(S/re,-1)+U[K]);return ue===void 0&&(ue=Math.abs(S)>=1e4?v(S,-1):v(S,-1,void 0,"")),ue}getSeriesExtremes(){let h,v=this;An(this,"getSeriesExtremes",null,function(){v.hasVisibleSeries=!1,v.dataMin=v.dataMax=v.threshold=void 0,v.softThreshold=!v.isXAxis,v.series.forEach(S=>{if(S.reserveSpace()){let I=S.options,L,z=I.threshold,B,U;if(v.hasVisibleSeries=!0,v.positiveValuesOnly&&0>=(z||0)&&(z=void 0),v.isXAxis)(L=S.getColumn("x")).length&&(L=v.logarithmic?L.filter(X=>X>0):L,B=(h=S.getXExtremes(L)).min,U=h.max,ir(B)||B instanceof Date||(L=L.filter(ir),B=(h=S.getXExtremes(L)).min,U=h.max),L.length&&(v.dataMin=Math.min(Or(v.dataMin,B),B),v.dataMax=Math.max(Or(v.dataMax,U),U)));else{let X=S.applyExtremes();ir(X.dataMin)&&(B=X.dataMin,v.dataMin=Math.min(Or(v.dataMin,B),B)),ir(X.dataMax)&&(U=X.dataMax,v.dataMax=Math.max(Or(v.dataMax,U),U)),Yr(z)&&(v.threshold=z),(!I.softThreshold||v.positiveValuesOnly)&&(v.softThreshold=!1)}}})}),An(this,"afterGetSeriesExtremes")}translate(h,v,S,I,L,z){var ye;let B=this.linkedParent||this,U=I&&B.old?B.old.min:B.min;if(!ir(U))return NaN;let X=B.minPixelPadding,te=(B.isOrdinal||((ye=B.brokenAxis)==null?void 0:ye.hasBreaks)||B.logarithmic&&L)&&B.lin2val,K=1,re=0,ue=I&&B.old?B.old.transA:B.transA,ge=0;return ue||(ue=B.transA),S&&(K*=-1,re=B.len),B.reversed&&(K*=-1,re-=K*(B.sector||B.len)),v?(ge=(h=h*K+re-X)/ue+U,te&&(ge=B.lin2val(ge))):(te&&(h=B.val2lin(h)),ge=K*(h-U)*ue+re+K*X+(ir(z)?ue*z:0),B.isRadial||(ge=Ls(ge))),ge}toPixels(h,v){var S;return this.translate(((S=this.chart)==null?void 0:S.time.parse(h))??NaN,!1,!this.horiz,void 0,!0)+(v?0:this.pos)}toValue(h,v){return this.translate(h-(v?0:this.pos),!0,!this.horiz,void 0,!0)}getPlotLinePath(h){let v=this,S=v.chart,I=v.left,L=v.top,z=h.old,B=h.value,U=h.lineWidth,X=z&&S.oldChartHeight||S.chartHeight,te=z&&S.oldChartWidth||S.chartWidth,K=v.transB,re=h.translatedValue,ue=h.force,ge,ye,xe,_e,ze;function Re(St,_t,Ot){return ue!=="pass"&&(St<_t||St>Ot)&&(ue?St=uc(St,_t,Ot):ze=!0),St}let ft={value:B,lineWidth:U,old:z,force:ue,acrossPanes:h.acrossPanes,translatedValue:re};return An(this,"getPlotLinePath",ft,function(St){ge=xe=(re=uc(re=Or(re,v.translate(B,void 0,void 0,z)),-1e9,1e9))+K,ye=_e=X-re-K,ir(re)?v.horiz?(ye=L,_e=X-v.bottom+(v.options.isInternal?0:S.scrollablePixelsY||0),ge=xe=Re(ge,I,I+v.width)):(ge=I,xe=te-v.right+(S.scrollablePixelsX||0),ye=_e=Re(ye,L,L+v.height)):(ze=!0,ue=!1),St.path=ze&&!ue?void 0:S.renderer.crispLine([["M",ge,ye],["L",xe,_e]],U||1)}),ft.path}getLinearTickPositions(h,v,S){let I,L,z,B=Ls(Math.floor(v/h)*h),U=Ls(Math.ceil(S/h)*h),X=[];if(Ls(B+h)===B&&(z=20),this.single)return[v];for(I=B;I<=U&&(X.push(I),(I=Ls(I+h,z))!==L);)L=I;return X}getMinorTickInterval(){let{minorTicks:h,minorTickInterval:v}=this.options;return h===!0?Or(v,"auto"):h!==!1?v:void 0}getMinorTickPositions(){var te;let h=this.options,v=this.tickPositions,S=this.minorTickInterval,I=this.pointRangePadding||0,L=(this.min||0)-I,z=(this.max||0)+I,B=(te=this.brokenAxis)!=null&&te.hasBreaks?this.brokenAxis.unitLength:z-L,U=[],X;if(B&&B/S<this.len/3){let K=this.logarithmic;if(K)this.paddedTicks.forEach(function(re,ue,ge){ue&&U.push.apply(U,K.getLogTickPositions(S,ge[ue-1],ge[ue],!0))});else if(this.dateTime&&this.getMinorTickInterval()==="auto")U=U.concat(this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(S),L,z,h.startOfWeek));else for(X=L+(v[0]-L)%S;X<=z&&X!==U[0];X+=S)U.push(X)}return U.length!==0&&this.trimTicks(U),U}adjustForMinRange(){let h=this.options,v=this.logarithmic,S=this.chart.time,{max:I,min:L,minRange:z}=this,B,U,X,te;this.isXAxis&&z===void 0&&!v&&(z=Yr(h.min)||Yr(h.max)||Yr(h.floor)||Yr(h.ceiling)?null:Math.min(5*(bf(this.series.map(K=>{let re=K.getColumn("x");return K.xIncrement?re.slice(0,2):re}))||0),this.dataMax-this.dataMin)),ir(I)&&ir(L)&&ir(z)&&I-L<z&&(U=this.dataMax-this.dataMin>=z,B=(z-I+L)/2,X=[L-B,S.parse(h.min)??L-B],U&&(X[2]=v?v.log2lin(this.dataMin):this.dataMin),te=[(L=su(X))+z,S.parse(h.max)??L+z],U&&(te[2]=v?v.log2lin(this.dataMax):this.dataMax),(I=qh(te))-L<z&&(X[0]=I-z,X[1]=S.parse(h.min)??I-z,L=su(X))),this.minRange=z,this.min=L,this.max=I}getClosest(){let h,v;if(this.categories)v=1;else{let S=[];this.series.forEach(function(I){let L=I.closestPointRange,z=I.getColumn("x");z.length===1?S.push(z[0]):I.sorted&&Yr(L)&&I.reserveSpace()&&(v=Yr(v)?Math.min(v,L):L)}),S.length&&(S.sort((I,L)=>I-L),h=bf([S]))}return h&&v?Math.min(h,v):h||v}nameToX(h){let v=Yh(this.options.categories),S=v?this.categories:this.names,I=h.options.x,L;return h.series.requireSorting=!1,Yr(I)||(I=this.uniqueNames&&S?v?S.indexOf(h.name):Or(S.keys[h.name],-1):h.series.autoIncrement()),I===-1?!v&&S&&(L=S.length):ir(I)&&(L=I),L!==void 0?(this.names[L]=h.name,this.names.keys[h.name]=L):h.x&&(L=h.x),L}updateNames(){let h=this,v=this.names;v.length>0&&(Object.keys(v.keys).forEach(function(S){delete v.keys[S]}),v.length=0,this.minRange=this.userMinRange,(this.series||[]).forEach(S=>{S.xIncrement=null,(!S.points||S.isDirtyData)&&(h.max=Math.max(h.max||0,S.dataTable.rowCount-1),S.processData(),S.generatePoints());let I=S.getColumn("x").slice();S.data.forEach((L,z)=>{let B=I[z];L!=null&&L.options&&L.name!==void 0&&(B=h.nameToX(L))!==void 0&&B!==L.x&&(I[z]=L.x=B)}),S.dataTable.setColumn("x",I)}))}setAxisTranslation(){let h=this,v=h.max-h.min,S=h.linkedParent,I=!!h.categories,L=h.isXAxis,z=h.axisPointRange||0,B,U=0,X=0,te,K=h.transA;(L||I||z)&&(B=h.getClosest(),S?(U=S.minPointOffset,X=S.pointRangePadding):h.series.forEach(function(re){let ue=I?1:L?Or(re.options.pointRange,B,0):h.axisPointRange||0,ge=re.options.pointPlacement;if(z=Math.max(z,ue),!h.single||I){let ye=re.is("xrange")?!L:L;U=Math.max(U,ye&&Xh(ge)?0:ue/2),X=Math.max(X,ye&&ge==="on"?0:ue)}}),te=h.ordinal&&h.ordinal.slope&&B?h.ordinal.slope/B:1,h.minPointOffset=U*=te,h.pointRangePadding=X*=te,h.pointRange=Math.min(z,h.single&&I?1:v),L&&B&&(h.closestPointRange=B)),h.translationSlope=h.transA=K=h.staticScale||h.len/(v+X||1),h.transB=h.horiz?h.left:h.bottom,h.minPixelPadding=K*U,An(this,"afterSetAxisTranslation")}minFromRange(){let{max:h,min:v}=this;return ir(h)&&ir(v)&&h-v||void 0}setTickInterval(h){var Zi,kr,Hi,gr;let{categories:v,chart:S,dataMax:I,dataMin:L,dateTime:z,isXAxis:B,logarithmic:U,options:X,softThreshold:te}=this,K=S.time,re=ir(this.threshold)?this.threshold:void 0,ue=this.minRange||0,{ceiling:ge,floor:ye,linkedTo:xe,softMax:_e,softMin:ze}=X,Re=ir(xe)&&((Zi=S[this.coll])==null?void 0:Zi[xe]),ft=X.tickPixelInterval,St=X.maxPadding,_t=X.minPadding,Ot=0,Pt,Ft=ir(X.tickInterval)&&X.tickInterval>=0?X.tickInterval:void 0,hi,mi,Ai,ai;if(z||v||Re||this.getTickAmount(),Ai=Or(this.userMin,K.parse(X.min)),ai=Or(this.userMax,K.parse(X.max)),Re?(this.linkedParent=Re,Pt=Re.getExtremes(),this.min=Or(Pt.min,Pt.dataMin),this.max=Or(Pt.max,Pt.dataMax),this.type!==Re.type&&Tl(11,!0,S)):(te&&Yr(re)&&ir(I)&&ir(L)&&(L>=re?(hi=re,_t=0):I<=re&&(mi=re,St=0)),this.min=Or(Ai,hi,L),this.max=Or(ai,mi,I)),ir(this.max)&&ir(this.min)&&(U&&(this.positiveValuesOnly&&!h&&0>=Math.min(this.min,Or(L,this.min))&&Tl(10,!0,S),this.min=Ls(U.log2lin(this.min),16),this.max=Ls(U.log2lin(this.max),16)),this.range&&ir(L)&&(this.userMin=this.min=Ai=Math.max(L,this.minFromRange()||0),this.userMax=ai=this.max,this.range=void 0)),An(this,"foundExtremes"),this.adjustForMinRange(),ir(this.min)&&ir(this.max)){if(!ir(this.userMin)&&ir(ze)&&ze<this.min&&(this.min=Ai=ze),!ir(this.userMax)&&ir(_e)&&_e>this.max&&(this.max=ai=_e),v||this.axisPointRange||(kr=this.stacking)!=null&&kr.usePercentage||Re||!(Ot=this.max-this.min)||(!Yr(Ai)&&_t&&(this.min-=Ot*_t),Yr(ai)||!St||(this.max+=Ot*St)),!ir(this.userMin)&&ir(ye)&&(this.min=Math.max(this.min,ye)),!ir(this.userMax)&&ir(ge)&&(this.max=Math.min(this.max,ge)),te&&ir(L)&&ir(I)){let Vi=re||0;!Yr(Ai)&&this.min<Vi&&L>=Vi?this.min=X.minRange?Math.min(Vi,this.max-ue):Vi:!Yr(ai)&&this.max>Vi&&I<=Vi&&(this.max=X.minRange?Math.max(Vi,this.min+ue):Vi)}!S.polar&&this.min>this.max&&(Yr(X.min)?this.max=this.min:Yr(X.max)&&(this.min=this.max)),Ot=this.max-this.min}if(this.min!==this.max&&ir(this.min)&&ir(this.max)?Re&&!Ft&&ft===Re.options.tickPixelInterval?this.tickInterval=Ft=Re.tickInterval:this.tickInterval=Or(Ft,this.tickAmount?Ot/Math.max(this.tickAmount-1,1):void 0,v?1:Ot*ft/Math.max(this.len,ft)):this.tickInterval=1,B&&!h){let Vi=this.min!==((Hi=this.old)==null?void 0:Hi.min)||this.max!==((gr=this.old)==null?void 0:gr.max);this.series.forEach(function(Qi){var _r;Qi.forceCrop=(_r=Qi.forceCropping)==null?void 0:_r.call(Qi),Qi.processData(Vi)}),An(this,"postProcessData",{hasExtremesChanged:Vi})}this.setAxisTranslation(),An(this,"initialAxisTranslation"),this.pointRange&&!Ft&&(this.tickInterval=Math.max(this.pointRange,this.tickInterval));let Ci=Or(X.minTickInterval,z&&!this.series.some(Vi=>!Vi.sorted)?this.closestPointRange:0);!Ft&&this.tickInterval<Ci&&(this.tickInterval=Ci),z||U||Ft||(this.tickInterval=Zh(this,this.tickInterval)),this.tickAmount||(this.tickInterval=this.unsquish()),this.setTickPositions()}setTickPositions(){var te,K;let h=this.options,v=h.tickPositions,S=h.tickPositioner,I=this.getMinorTickInterval(),L=!this.isPanning,z=L&&h.startOnTick,B=L&&h.endOnTick,U=[],X;if(this.tickmarkOffset=this.categories&&h.tickmarkPlacement==="between"&&this.tickInterval===1?.5:0,this.single=this.min===this.max&&Yr(this.min)&&!this.tickAmount&&(this.min%1==0||h.allowDecimals!==!1),v)U=v.slice();else if(ir(this.min)&&ir(this.max)){if(!((te=this.ordinal)!=null&&te.positions)&&(this.max-this.min)/this.tickInterval>Math.max(2*this.len,200))U=[this.min,this.max],Tl(19,!1,this.chart);else if(this.dateTime)U=this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(this.tickInterval,h.units),this.min,this.max,h.startOfWeek,(K=this.ordinal)==null?void 0:K.positions,this.closestPointRange,!0);else if(this.logarithmic)U=this.logarithmic.getLogTickPositions(this.tickInterval,this.min,this.max);else{let re=this.tickInterval,ue=re;for(;ue<=2*re&&(U=this.getLinearTickPositions(this.tickInterval,this.min,this.max),this.tickAmount&&U.length>this.tickAmount);)this.tickInterval=Zh(this,ue*=1.1)}U.length>this.len&&(U=[U[0],U[U.length-1]])[0]===U[1]&&(U.length=1),S&&(this.tickPositions=U,(X=S.apply(this,[this.min,this.max]))&&(U=X))}this.tickPositions=U,this.minorTickInterval=I==="auto"&&this.tickInterval?this.tickInterval/h.minorTicksPerMajor:I,this.paddedTicks=U.slice(0),this.trimTicks(U,z,B),!this.isLinked&&ir(this.min)&&ir(this.max)&&(this.single&&U.length<2&&!this.categories&&!this.series.some(re=>re.is("heatmap")&&re.options.pointPlacement==="between")&&(this.min-=.5,this.max+=.5),v||X||this.adjustTickAmount()),An(this,"afterSetTickPositions")}trimTicks(h,v,S){let I=h[0],L=h[h.length-1],z=!this.isOrdinal&&this.minPointOffset||0;if(An(this,"trimTicks"),!this.isLinked){if(v&&I!==-1/0)this.min=I;else for(;this.min-z>h[0];)h.shift();if(S)this.max=L;else for(;this.max+z<h[h.length-1];)h.pop();h.length===0&&Yr(I)&&!this.options.tickPositions&&h.push((L+I)/2)}}alignToOthers(){let h,v=this,S=v.chart,I=[this],L=v.options,z=S.options.chart,B=this.coll==="yAxis"&&z.alignThresholds,U=[];if(v.thresholdAlignment=void 0,(z.alignTicks!==!1&&L.alignTicks||B)&&L.startOnTick!==!1&&L.endOnTick!==!1&&!v.logarithmic){let X=K=>{let{horiz:re,options:ue}=K;return[re?ue.left:ue.top,ue.width,ue.height,ue.pane].join(",")},te=X(this);S[this.coll].forEach(function(K){let{series:re}=K;re.length&&re.some(ue=>ue.visible)&&K!==v&&X(K)===te&&(h=!0,I.push(K))})}if(h&&B){I.forEach(te=>{let K=te.getThresholdAlignment(v);ir(K)&&U.push(K)});let X=U.length>1?U.reduce((te,K)=>te+=K,0)/U.length:void 0;I.forEach(te=>{te.thresholdAlignment=X})}return h}getThresholdAlignment(h){if((!ir(this.dataMin)||this!==h&&this.series.some(v=>v.isDirty||v.isDirtyData))&&this.getSeriesExtremes(),ir(this.threshold)){let v=uc((this.threshold-(this.dataMin||0))/((this.dataMax||0)-(this.dataMin||0)),0,1);return this.options.reversed&&(v=1-v),v}}getTickAmount(){let h=this.options,v=h.tickPixelInterval,S=h.tickAmount;Yr(h.tickInterval)||S||!(this.len<v)||this.isRadial||this.logarithmic||!h.startOnTick||!h.endOnTick||(S=2),!S&&this.alignToOthers()&&(S=Math.ceil(this.len/v)+1),S<4&&(this.finalTickAmt=S,S=5),this.tickAmount=S}adjustTickAmount(){let h=this,{finalTickAmt:v,max:S,min:I,options:L,tickPositions:z,tickAmount:B,thresholdAlignment:U}=h,X=z==null?void 0:z.length,te=Or(h.threshold,h.softThreshold?0:null),K,re,ue=h.tickInterval,ge,ye=()=>z.push(Ls(z[z.length-1]+ue)),xe=()=>z.unshift(Ls(z[0]-ue));if(ir(U)&&(ge=U<.5?Math.ceil(U*(B-1)):Math.floor(U*(B-1)),L.reversed&&(ge=B-1-ge)),h.hasData()&&ir(I)&&ir(S)){let _e=()=>{h.transA*=(X-1)/(B-1),h.min=L.startOnTick?z[0]:Math.min(I,z[0]),h.max=L.endOnTick?z[z.length-1]:Math.max(S,z[z.length-1])};if(ir(ge)&&ir(h.threshold)){for(;z[ge]!==te||z.length!==B||z[0]>I||z[z.length-1]<S;){for(z.length=0,z.push(h.threshold);z.length<B;)z[ge]===void 0||z[ge]>h.threshold?xe():ye();if(ue>8*h.tickInterval)break;ue*=2}_e()}else if(X<B){for(;z.length<B;)z.length%2||I===te?ye():xe();_e()}if(Yr(v)){for(re=K=z.length;re--;)(v===3&&re%2==1||v<=2&&re>0&&re<K-1)&&z.splice(re,1);h.finalTickAmt=void 0}}}setScale(){var z,B;let{coll:h,stacking:v}=this,S=!1,I=!1;this.series.forEach(U=>{S=S||U.isDirtyData||U.isDirty,I=I||U.xAxis&&U.xAxis.isDirty||!1}),this.setAxisSize();let L=this.len!==(this.old&&this.old.len);L||S||I||this.isLinked||this.forceRedraw||this.userMin!==(this.old&&this.old.userMin)||this.userMax!==(this.old&&this.old.userMax)||this.alignToOthers()?(v&&h==="yAxis"&&v.buildStacks(),this.forceRedraw=!1,this.userMinRange||(this.minRange=void 0),this.getSeriesExtremes(),this.setTickInterval(),v&&h==="xAxis"&&v.buildStacks(),this.isDirty||(this.isDirty=L||this.min!==((z=this.old)==null?void 0:z.min)||this.max!==((B=this.old)==null?void 0:B.max))):v&&v.cleanStacks(),S&&delete this.allExtremes,An(this,"afterSetScale")}setExtremes(h,v,S=!0,I,L){let z=this.chart;this.series.forEach(B=>{delete B.kdTree}),h=z.time.parse(h),v=z.time.parse(v),An(this,"setExtremes",L=th(L,{min:h,max:v}),B=>{this.userMin=B.min,this.userMax=B.max,this.eventArgs=B,S&&z.redraw(I)})}setAxisSize(){let h=this.chart,v=this.options,S=v.offsets||[0,0,0,0],I=this.horiz,L=this.width=Math.round(Ml(Or(v.width,h.plotWidth-S[3]+S[1]),h.plotWidth)),z=this.height=Math.round(Ml(Or(v.height,h.plotHeight-S[0]+S[2]),h.plotHeight)),B=this.top=Math.round(Ml(Or(v.top,h.plotTop+S[0]),h.plotHeight,h.plotTop)),U=this.left=Math.round(Ml(Or(v.left,h.plotLeft+S[3]),h.plotWidth,h.plotLeft));this.bottom=h.chartHeight-z-B,this.right=h.chartWidth-L-U,this.len=Math.max(I?L:z,0),this.pos=I?U:B}getExtremes(){let h=this.logarithmic;return{min:h?Ls(h.lin2log(this.min)):this.min,max:h?Ls(h.lin2log(this.max)):this.max,dataMin:this.dataMin,dataMax:this.dataMax,userMin:this.userMin,userMax:this.userMax}}getThreshold(h){let v=this.logarithmic,S=v?v.lin2log(this.min):this.min,I=v?v.lin2log(this.max):this.max;return h===null||h===-1/0?h=S:h===1/0?h=I:S>h?h=S:I<h&&(h=I),this.translate(h,0,1,0,1)}autoLabelAlign(h){let v=(Or(h,0)-90*this.side+720)%360,S={align:"center"};return An(this,"autoLabelAlign",S,function(I){v>15&&v<165?I.align="right":v>195&&v<345&&(I.align="left")}),S.align}tickSize(h){let v=this.options,S=Or(v[h==="tick"?"tickWidth":"minorTickWidth"],h==="tick"&&this.isXAxis&&!this.categories?1:0),I=v[h==="tick"?"tickLength":"minorTickLength"],L;S&&I&&(v[h+"Position"]==="inside"&&(I=-I),L=[I,S]);let z={tickSize:L};return An(this,"afterTickSize",z),z.tickSize}labelMetrics(){let h=this.chart.renderer,v=this.ticks,S=v[Object.keys(v)[0]]||{};return this.chart.renderer.fontMetrics(S.label||S.movedLabel||h.box)}unsquish(){let h=this.options.labels,v=h.padding||0,S=this.horiz,I=this.tickInterval,L=this.len/(((this.categories?1:0)+this.max-this.min)/I),z=h.rotation,B=Ls(.8*this.labelMetrics().h),U=Math.max(this.max-this.min,0),X=function(ge){let ye=(ge+2*v)/(L||1);return(ye=ye>1?Math.ceil(ye):1)*I>U&&ge!==1/0&&L!==1/0&&U&&(ye=Math.ceil(U/I)),Ls(ye*I)},te=I,K,re=Number.MAX_VALUE,ue;if(S){if(!h.staggerLines&&(ir(z)?ue=[z]:L<h.autoRotationLimit&&(ue=h.autoRotation)),ue){let ge,ye;for(let xe of ue)(xe===z||xe&&xe>=-90&&xe<=90)&&(ye=(ge=X(Math.abs(B/Math.sin(nu*xe))))+Math.abs(xe/360))<re&&(re=ye,K=xe,te=ge)}}else te=X(.75*B);return this.autoRotation=ue,this.labelRotation=Or(K,ir(z)?z:0),h.step?I:te}getSlotWidth(h){let v=this.chart,S=this.horiz,I=this.options.labels,L=Math.max(this.tickPositions.length-(this.categories?0:1),1),z=v.margin[3];if(h&&ir(h.slotWidth))return h.slotWidth;if(S&&I.step<2&&!this.isRadial)return I.rotation?0:(this.staggerLines||1)*this.len/L;if(!S){let B=I.style.width;if(B!==void 0)return parseInt(String(B),10);if(z)return z-v.spacing[3]}return .33*v.chartWidth}renderUnsquish(){let h=this.chart,v=h.renderer,S=this.tickPositions,I=this.ticks,L=this.options.labels,z=L.style,B=this.horiz,U=this.getSlotWidth(),X=Math.max(1,Math.round(U-(B?2*(L.padding||0):L.distance||0))),te={},K=this.labelMetrics(),re=z.lineClamp,ue,ge=re??(Math.floor(this.len/(S.length*K.h))||1),ye=0;Xh(L.rotation)||(te.rotation=L.rotation||0),S.forEach(function(xe){var Re;let _e=I[xe];_e.movedLabel&&_e.replaceMovedLabel();let ze=((Re=_e.label)==null?void 0:Re.textPxLength)||0;ze>ye&&(ye=ze)}),this.maxLabelLength=ye,this.autoRotation?ye>X&&ye>K.h?te.rotation=this.labelRotation:this.labelRotation=0:U&&(ue=X),te.rotation&&(ue=ye>.5*h.chartHeight?.33*h.chartHeight:ye,re||(ge=1)),this.labelAlign=L.align||this.autoLabelAlign(this.labelRotation),this.labelAlign&&(te.align=this.labelAlign),S.forEach(function(xe){let _e=I[xe],ze=_e&&_e.label,Re=z.width,ft={};ze&&(ze.attr(te),_e.shortenLabel?_e.shortenLabel():ue&&!Re&&z.whiteSpace!=="nowrap"&&(ue<(ze.textPxLength||0)||ze.element.tagName==="SPAN")?ze.css(th(ft,{width:`${ue}px`,lineClamp:ge})):!ze.styles.width||ft.width||Re||ze.css({width:"auto"}),_e.rotation=te.rotation)},this),this.tickRotCorr=v.rotCorr(K.b,this.labelRotation||0,this.side!==0)}hasData(){return this.series.some(function(h){return h.hasData()})||this.options.showEmpty&&Yr(this.min)&&Yr(this.max)}addTitle(h){let v,S=this.chart.renderer,I=this.horiz,L=this.opposite,z=this.options.title,B=this.chart.styledMode;this.axisTitle||((v=z.textAlign)||(v=(I?{low:"left",middle:"center",high:"right"}:{low:L?"right":"left",middle:"center",high:L?"left":"right"})[z.align]),this.axisTitle=S.text(z.text||"",0,0,z.useHTML).attr({zIndex:7,rotation:z.rotation||0,align:v}).addClass("highcharts-axis-title"),B||this.axisTitle.css(ou(z.style)),this.axisTitle.add(this.axisGroup),this.axisTitle.isNew=!0),B||z.style.width||this.isRadial||this.axisTitle.css({width:this.len+"px"}),this.axisTitle[h?"show":"hide"](h)}generateTick(h){let v=this.ticks;v[h]?v[h].addLabel():v[h]=new Zo(this,h)}createGroups(){let{axisParent:h,chart:v,coll:S,options:I}=this,L=v.renderer,z=(B,U,X)=>L.g(B).attr({zIndex:X}).addClass(`highcharts-${S.toLowerCase()}${U} `+(this.isRadial?`highcharts-radial-axis${U} `:"")+(I.className||"")).add(h);this.axisGroup||(this.gridGroup=z("grid","-grid",I.gridZIndex),this.axisGroup=z("axis","",I.zIndex),this.labelGroup=z("axis-labels","-labels",I.labels.zIndex))}getOffset(){let h=this,{chart:v,horiz:S,options:I,side:L,ticks:z,tickPositions:B,coll:U}=h,X=v.inverted&&!h.isZAxis?[1,0,3,2][L]:L,te=h.hasData(),K=I.title,re=I.labels,ue=ir(I.crossing),ge=v.axisOffset,ye=v.clipOffset,xe=[-1,1,1,-1][L],_e,ze=0,Re,ft=0,St=0,_t,Ot;if(h.showAxis=_e=te||I.showEmpty,h.staggerLines=h.horiz&&re.staggerLines||void 0,h.createGroups(),te||h.isLinked?(B.forEach(function(Pt){h.generateTick(Pt)}),h.renderUnsquish(),h.reserveSpaceDefault=L===0||L===2||{1:"left",3:"right"}[L]===h.labelAlign,Or(re.reserveSpace,!ue&&null,h.labelAlign==="center"||null,h.reserveSpaceDefault)&&B.forEach(function(Pt){St=Math.max(z[Pt].getLabelSize(),St)}),h.staggerLines&&(St*=h.staggerLines),h.labelOffset=St*(h.opposite?-1:1)):ih(z,function(Pt,Ft){Pt.destroy(),delete z[Ft]}),K!=null&&K.text&&K.enabled!==!1&&(h.addTitle(_e),_e&&!ue&&K.reserveSpace!==!1&&(h.titleOffset=ze=h.axisTitle.getBBox()[S?"height":"width"],ft=Yr(Re=K.offset)?0:Or(K.margin,S?5:10))),h.renderLine(),h.offset=xe*Or(I.offset,ge[L]?ge[L]+(I.margin||0):0),h.tickRotCorr=h.tickRotCorr||{x:0,y:0},Ot=L===0?-h.labelMetrics().h:L===2?h.tickRotCorr.y:0,_t=Math.abs(St)+ft,St&&(_t-=Ot,_t+=xe*(S?Or(re.y,h.tickRotCorr.y+xe*re.distance):Or(re.x,xe*re.distance))),h.axisTitleMargin=Or(Re,_t),h.getMaxLabelDimensions&&(h.maxLabelDimensions=h.getMaxLabelDimensions(z,B)),U!=="colorAxis"&&ye){let Pt=this.tickSize("tick");ge[L]=Math.max(ge[L],(h.axisTitleMargin||0)+ze+xe*h.offset,_t,B&&B.length&&Pt?Pt[0]+xe*h.offset:0);let Ft=!h.axisLine||I.offset?0:h.axisLine.strokeWidth()/2;ye[X]=Math.max(ye[X],Ft)}An(this,"afterGetOffset")}getLinePath(h){let v=this.chart,S=this.opposite,I=this.offset,L=this.horiz,z=this.left+(S?this.width:0)+I,B=v.chartHeight-this.bottom-(S?this.height:0)+I;return S&&(h*=-1),v.renderer.crispLine([["M",L?this.left:z,L?B:this.top],["L",L?v.chartWidth-this.right:z,L?B:v.chartHeight-this.bottom]],h)}renderLine(){this.axisLine||(this.axisLine=this.chart.renderer.path().addClass("highcharts-axis-line").add(this.axisGroup),this.chart.styledMode||this.axisLine.attr({stroke:this.options.lineColor,"stroke-width":this.options.lineWidth,zIndex:7}))}getTitlePosition(h){let v=this.horiz,S=this.left,I=this.top,L=this.len,z=this.options.title,B=v?S:I,U=this.opposite,X=this.offset,te=z.x,K=z.y,re=this.chart.renderer.fontMetrics(h),ue=h?Math.max(h.getBBox(!1,0).height-re.h-1,0):0,ge={low:B+(v?0:L),middle:B+L/2,high:B+(v?L:0)}[z.align],ye=(v?I+this.height:S)+(v?1:-1)*(U?-1:1)*(this.axisTitleMargin||0)+[-ue,ue,re.f,-ue][this.side],xe={x:v?ge+te:ye+(U?this.width:0)+X+te,y:v?ye+K-(U?this.height:0)+X:ge+K};return An(this,"afterGetTitlePosition",{titlePosition:xe}),xe}renderMinorTick(h,v){let S=this.minorTicks;S[h]||(S[h]=new Zo(this,h,"minor")),v&&S[h].isNew&&S[h].render(null,!0),S[h].render(null,!1,1)}renderTick(h,v,S){let I=this.isLinked,L=this.ticks;(!I||h>=this.min&&h<=this.max||this.grid&&this.grid.isColumn)&&(L[h]||(L[h]=new Zo(this,h)),S&&L[h].isNew&&L[h].render(v,!0,-1),L[h].render(v))}render(){let h,v,S=this,I=S.chart,L=S.logarithmic,z=I.renderer,B=S.options,U=S.isLinked,X=S.tickPositions,te=S.axisTitle,K=S.ticks,re=S.minorTicks,ue=S.alternateBands,ge=B.stackLabels,ye=B.alternateGridColor,xe=B.crossing,_e=S.tickmarkOffset,ze=S.axisLine,Re=S.showAxis,ft=iu(z.globalAnimation);if(S.labelEdge.length=0,S.overlap=!1,[K,re,ue].forEach(function(St){ih(St,function(_t){_t.isActive=!1})}),ir(xe)){let St=this.isXAxis?I.yAxis[0]:I.xAxis[0],_t=[1,-1,-1,1][this.side];if(St){let Ot=St.toPixels(xe,!0);S.horiz&&(Ot=St.len-Ot),S.offset=_t*Ot}}if(S.hasData()||U){let St=S.chart.hasRendered&&S.old&&ir(S.old.min);S.minorTickInterval&&!S.categories&&S.getMinorTickPositions().forEach(function(_t){S.renderMinorTick(_t,St)}),X.length&&(X.forEach(function(_t,Ot){S.renderTick(_t,Ot,St)}),_e&&(S.min===0||S.single)&&(K[-1]||(K[-1]=new Zo(S,-1,null,!0)),K[-1].render(-1))),ye&&X.forEach(function(_t,Ot){v=X[Ot+1]!==void 0?X[Ot+1]+_e:S.max-_e,Ot%2==0&&_t<S.max&&v<=S.max+(I.polar?-_e:_e)&&(ue[_t]||(ue[_t]=new Ne.PlotLineOrBand(S,{})),h=_t+_e,ue[_t].options={from:L?L.lin2log(h):h,to:L?L.lin2log(v):v,color:ye,className:"highcharts-alternate-grid"},ue[_t].render(),ue[_t].isActive=!0)}),S._addedPlotLB||(S._addedPlotLB=!0,(B.plotLines||[]).concat(B.plotBands||[]).forEach(function(_t){S.addPlotBandOrLine(_t)}))}[K,re,ue].forEach(function(St){let _t=[],Ot=ft.duration;ih(St,function(Pt,Ft){Pt.isActive||(Pt.render(Ft,!1,0),Pt.isActive=!1,_t.push(Ft))}),vo(function(){let Pt=_t.length;for(;Pt--;)St[_t[Pt]]&&!St[_t[Pt]].isActive&&(St[_t[Pt]].destroy(),delete St[_t[Pt]])},St!==ue&&I.hasRendered&&Ot?Ot:0)}),ze&&(ze[ze.isPlaced?"animate":"attr"]({d:this.getLinePath(ze.strokeWidth())}),ze.isPlaced=!0,ze[Re?"show":"hide"](Re)),te&&Re&&(te[te.isNew?"attr":"animate"](S.getTitlePosition(te)),te.isNew=!1),ge&&ge.enabled&&S.stacking&&S.stacking.renderStackTotals(),S.old={len:S.len,max:S.max,min:S.min,transA:S.transA,userMax:S.userMax,userMin:S.userMin},S.isDirty=!1,An(this,"afterRender")}redraw(){this.visible&&(this.render(),this.plotLinesAndBands.forEach(function(h){h.render()})),this.series.forEach(function(h){h.isDirty=!0})}getKeepProps(){return this.keepProps||Za.keepProps}destroy(h){let v=this,S=v.plotLinesAndBands,I=this.eventOptions;if(An(this,"destroy",{keepEvents:h}),h||rh(v),[v.ticks,v.minorTicks,v.alternateBands].forEach(function(L){fr(L)}),S){let L=S.length;for(;L--;)S[L].destroy()}for(let L in["axisLine","axisTitle","axisGroup","gridGroup","labelGroup","cross","scrollbar"].forEach(function(z){v[z]&&(v[z]=v[z].destroy())}),v.plotLinesAndBandsGroups)v.plotLinesAndBandsGroups[L]=v.plotLinesAndBandsGroups[L].destroy();ih(v,function(L,z){v.getKeepProps().indexOf(z)===-1&&delete v[z]}),this.eventOptions=I}drawCrosshair(h,v){let S=this.crosshair,I=Or(S&&S.snap,!0),L=this.chart,z,B,U,X=this.cross,te;if(An(this,"drawCrosshair",{e:h,point:v}),h||(h=this.cross&&this.cross.e),S&&(Yr(v)||!I)!==!1){if(I?Yr(v)&&(B=Or(this.coll!=="colorAxis"?v.crosshairPos:null,this.isXAxis?v.plotX:this.len-v.plotY)):B=h&&(this.horiz?h.chartX-this.pos:this.len-h.chartY+this.pos),Yr(B)&&(te={value:v&&(this.isXAxis?v.x:Or(v.stackY,v.y)),translatedValue:B},L.polar&&th(te,{isCrosshair:!0,chartX:h&&h.chartX,chartY:h&&h.chartY,point:v}),z=this.getPlotLinePath(te)||null),!Yr(z)){this.hideCrosshair();return}U=this.categories&&!this.isRadial,X||(this.cross=X=L.renderer.path().addClass("highcharts-crosshair highcharts-crosshair-"+(U?"category ":"thin ")+(S.className||"")).attr({zIndex:Or(S.zIndex,2)}).add(),!L.styledMode&&(X.attr({stroke:S.color||(U?Jr.parse("#ccd3ff").setOpacity(.25).get():"#cccccc"),"stroke-width":Or(S.width,1)}).css({"pointer-events":"none"}),S.dashStyle&&X.attr({dashstyle:S.dashStyle}))),X.show().attr({d:z}),U&&!S.width&&X.attr({"stroke-width":this.transA}),this.cross.e=h}else this.hideCrosshair();An(this,"afterDrawCrosshair",{e:h,point:v})}hideCrosshair(){this.cross&&this.cross.hide(),An(this,"afterHideCrosshair")}update(h,v){let S=this.chart;h=ou(this.userOptions,h),this.destroy(!0),this.init(S,h),S.isDirtyBox=!0,Or(v,!0)&&S.redraw()}remove(h){let v=this.chart,S=this.coll,I=this.series,L=I.length;for(;L--;)I[L]&&I[L].remove(!1);lp(v.axes,this),lp(v[S]||[],this),v.orderItems(S),this.destroy(),v.isDirtyBox=!0,Or(h,!0)&&v.redraw()}setTitle(h,v){this.update({title:h},v)}setCategories(h,v){this.update({categories:h},v)}}Za.keepProps=["coll","extKey","hcEvents","len","names","series","userMax","userMin"];let{addEvent:Kh,getMagnitude:cp,normalizeTickInterval:up,timeUnits:hc}=Bi;(function(Y){function h(){return this.chart.time.getTimeTicks.apply(this.chart.time,arguments)}function v(){if(this.type!=="datetime"){this.dateTime=void 0;return}this.dateTime||(this.dateTime=new S(this))}Y.compose=function(I){return I.keepProps.includes("dateTime")||(I.keepProps.push("dateTime"),I.prototype.getTimeTicks=h,Kh(I,"afterSetType",v)),I};class S{constructor(L){this.axis=L}normalizeTimeTickInterval(L,z){let B=z||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]],U=B[B.length-1],X=hc[U[0]],te=U[1],K;for(K=0;K<B.length&&(X=hc[(U=B[K])[0]],te=U[1],!B[K+1]||!(L<=(X*te[te.length-1]+hc[B[K+1][0]])/2));K++);X===hc.year&&L<5*X&&(te=[1,2,5]);let re=up(L/X,te,U[0]==="year"?Math.max(cp(L/X),1):1);return{unitRange:X,count:re,unitName:U[0]}}getXDateFormat(L,z){let{axis:B}=this,U=B.chart.time;return B.closestPointRange?U.getDateFormat(B.closestPointRange,L,B.options.startOfWeek,z)||U.resolveDTLFormat(z.year).main:U.resolveDTLFormat(z.day).main}}Y.Additions=S})(ie||(ie={}));let hp=ie,{addEvent:Jh,normalizeTickInterval:Qh,pick:Tf}=Bi;(function(Y){function h(){this.type!=="logarithmic"?this.logarithmic=void 0:this.logarithmic??(this.logarithmic=new S(this))}function v(){let I=this.logarithmic;I&&(this.lin2val=function(L){return I.lin2log(L)},this.val2lin=function(L){return I.log2lin(L)})}Y.compose=function(I){return I.keepProps.includes("logarithmic")||(I.keepProps.push("logarithmic"),Jh(I,"afterSetType",h),Jh(I,"afterInit",v)),I};class S{constructor(L){this.axis=L}getLogTickPositions(L,z,B,U){let X=this.axis,te=X.len,K=X.options,re=[];if(U||(this.minorAutoInterval=void 0),L>=.5)L=Math.round(L),re=X.getLinearTickPositions(L,z,B);else if(L>=.08){let ue,ge,ye,xe,_e,ze,Re,ft=Math.floor(z);for(ue=L>.3?[1,2,4]:L>.15?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9],ge=ft;ge<B+1&&!Re;ge++)for(ye=0,xe=ue.length;ye<xe&&!Re;ye++)(_e=this.log2lin(this.lin2log(ge)*ue[ye]))>z&&(!U||ze<=B)&&ze!==void 0&&re.push(ze),ze>B&&(Re=!0),ze=_e}else{let ue=this.lin2log(z),ge=this.lin2log(B),ye=U?X.getMinorTickInterval():K.tickInterval,xe=K.tickPixelInterval/(U?5:1),_e=U?te/X.tickPositions.length:te;L=Qh(L=Tf(ye==="auto"?null:ye,this.minorAutoInterval,(ge-ue)*xe/(_e||1))),re=X.getLinearTickPositions(L,ue,ge).map(this.log2lin),U||(this.minorAutoInterval=L/5)}return U||(X.tickInterval=L),re}lin2log(L){return Math.pow(10,L)}log2lin(L){return Math.log(L)/Math.LN10}}Y.Additions=S})(ae||(ae={}));let Mf=ae,{erase:au,extend:Hm,isNumber:Ef}=Bi;(function(Y){let h;function v(X){return this.addPlotBandOrLine(X,"plotBands")}function S(X,te){let K=this.userOptions,re=new h(this,X);if(this.visible&&(re=re.render()),re){if(this._addedPlotLB||(this._addedPlotLB=!0,(K.plotLines||[]).concat(K.plotBands||[]).forEach(ue=>{this.addPlotBandOrLine(ue)})),te){let ue=K[te]||[];ue.push(X),K[te]=ue}this.plotLinesAndBands.push(re)}return re}function I(X){return this.addPlotBandOrLine(X,"plotLines")}function L(X,te,K){K=K||this.options;let re=this.getPlotLinePath({value:te,force:!0,acrossPanes:K.acrossPanes}),ue=[],ge=this.horiz,ye=!Ef(this.min)||!Ef(this.max)||X<this.min&&te<this.min||X>this.max&&te>this.max,xe=this.getPlotLinePath({value:X,force:!0,acrossPanes:K.acrossPanes}),_e,ze=1,Re;if(xe&&re)for(ye&&(Re=xe.toString()===re.toString(),ze=0),_e=0;_e<xe.length;_e+=2){let ft=xe[_e],St=xe[_e+1],_t=re[_e],Ot=re[_e+1];(ft[0]==="M"||ft[0]==="L")&&(St[0]==="M"||St[0]==="L")&&(_t[0]==="M"||_t[0]==="L")&&(Ot[0]==="M"||Ot[0]==="L")&&(ge&&_t[1]===ft[1]?(_t[1]+=ze,Ot[1]+=ze):ge||_t[2]!==ft[2]||(_t[2]+=ze,Ot[2]+=ze),ue.push(["M",ft[1],ft[2]],["L",St[1],St[2]],["L",Ot[1],Ot[2]],["L",_t[1],_t[2]],["Z"])),ue.isFlat=Re}return ue}function z(X){this.removePlotBandOrLine(X)}function B(X){let te=this.plotLinesAndBands,K=this.options,re=this.userOptions;if(te){let ue=te.length;for(;ue--;)te[ue].id===X&&te[ue].destroy();[K.plotLines||[],re.plotLines||[],K.plotBands||[],re.plotBands||[]].forEach(function(ge){for(ue=ge.length;ue--;)(ge[ue]||{}).id===X&&au(ge,ge[ue])})}}function U(X){this.removePlotBandOrLine(X)}Y.compose=function(X,te){let K=te.prototype;return K.addPlotBand||(h=X,Hm(K,{addPlotBand:v,addPlotLine:I,addPlotBandOrLine:S,getPlotBandPath:L,removePlotBand:z,removePlotLine:U,removePlotBandOrLine:B})),te}})(he||(he={}));let Wm=he,{addEvent:qm,arrayMax:Cf,arrayMin:Af,defined:Ko,destroyObjectProperties:dp,erase:ed,fireEvent:lu,merge:td,objectEach:Pf,pick:If}=Bi;class cu{static compose(h,v){return qm(h,"afterInit",function(){this.labelCollectors.push(()=>{var I;let S=[];for(let L of this.axes)for(let{label:z,options:B}of L.plotLinesAndBands)z&&!((I=B==null?void 0:B.label)!=null&&I.allowOverlap)&&S.push(z);return S})}),Wm.compose(cu,v)}constructor(h,v){this.axis=h,this.options=v,this.id=v.id}render(){lu(this,"render");let{axis:h,options:v}=this,{horiz:S,logarithmic:I}=h,{color:L,events:z,zIndex:B=0}=v,{renderer:U,time:X}=h.chart,te={},K=X.parse(v.to),re=X.parse(v.from),ue=X.parse(v.value),ge=v.borderWidth,ye=v.label,{label:xe,svgElem:_e}=this,ze=[],Re,ft=Ko(re)&&Ko(K),St=Ko(ue),_t=!_e,Ot={class:"highcharts-plot-"+(ft?"band ":"line ")+(v.className||"")},Pt=ft?"bands":"lines";if(!h.chart.styledMode&&(St?(Ot.stroke=L||"#999999",Ot["stroke-width"]=If(v.width,1),v.dashStyle&&(Ot.dashstyle=v.dashStyle)):ft&&(Ot.fill=L||"#e6e9ff",ge&&(Ot.stroke=v.borderColor,Ot["stroke-width"]=ge))),te.zIndex=B,Pt+="-"+B,(Re=h.plotLinesAndBandsGroups[Pt])||(h.plotLinesAndBandsGroups[Pt]=Re=U.g("plot-"+Pt).attr(te).add()),_e||(this.svgElem=_e=U.path().attr(Ot).add(Re)),Ko(ue))ze=h.getPlotLinePath({value:(I==null?void 0:I.log2lin(ue))??ue,lineWidth:_e.strokeWidth(),acrossPanes:v.acrossPanes});else{if(!(Ko(re)&&Ko(K)))return;ze=h.getPlotBandPath((I==null?void 0:I.log2lin(re))??re,(I==null?void 0:I.log2lin(K))??K,v)}return!this.eventsAdded&&z&&(Pf(z,(Ft,hi)=>{_e==null||_e.on(hi,mi=>{z[hi].apply(this,[mi])})}),this.eventsAdded=!0),(_t||!_e.d)&&(ze!=null&&ze.length)?_e.attr({d:ze}):_e&&(ze?(_e.show(),_e.animate({d:ze})):_e.d&&(_e.hide(),xe&&(this.label=xe=xe.destroy()))),ye&&(Ko(ye.text)||Ko(ye.formatter))&&(ze!=null&&ze.length)&&h.width>0&&h.height>0&&!ze.isFlat?(ye=td({align:S&&ft?"center":void 0,x:S?!ft&&4:10,verticalAlign:!S&&ft?"middle":void 0,y:S?ft?16:10:ft?6:-4,rotation:S&&!ft?90:0,...ft?{inside:!0}:{}},ye),this.renderLabel(ye,ze,ft,B)):xe&&xe.hide(),this}renderLabel(h,v,S,I){var ge;let L=this.axis,z=L.chart.renderer,B=h.inside,U=this.label;U||(this.label=U=z.text(this.getLabelText(h),0,0,h.useHTML).attr({align:h.textAlign||h.align,rotation:h.rotation,class:"highcharts-plot-"+(S?"band":"line")+"-label "+(h.className||""),zIndex:I}),L.chart.styledMode||U.css(td({fontSize:"0.8em",textOverflow:S&&!B?"":"ellipsis"},h.style)),U.add());let X=v.xBounds||[v[0][1],v[1][1],S?v[2][1]:v[0][1]],te=v.yBounds||[v[0][2],v[1][2],S?v[2][2]:v[0][2]],K=Af(X),re=Af(te),ue=Cf(X)-K;U.align(h,!1,{x:K,y:re,width:ue,height:Cf(te)-re}),(!U.alignValue||U.alignValue==="left"||Ko(B))&&U.css({width:(((ge=h.style)==null?void 0:ge.width)||(S&&B?ue:U.rotation===90?L.height-(U.alignAttr.y-L.top):(h.clip?L.width:L.chart.chartWidth)-(U.alignAttr.x-L.left)))+"px"}),U.show(!0)}getLabelText(h){return Ko(h.formatter)?h.formatter.call(this):h.text}destroy(){ed(this.axis.plotLinesAndBands,this),delete this.axis,dp(this)}}let{animObject:El}=se,{format:id}=Po,{composed:zo,dateFormats:rd,doc:uu,isSafari:Df}=Ne,{distribute:nd}=qo,{addEvent:nh,clamp:Cl,css:kf,discardElement:pp,extend:hu,fireEvent:Of,isArray:Ym,isNumber:Lf,isObject:Rf,isString:du,merge:pu,pick:la,pushUnique:sd,splat:dc,syncTimeout:zf}=Bi;class pc{constructor(h,v,S){this.allowShared=!0,this.crosshairs=[],this.distance=0,this.isHidden=!0,this.isSticky=!1,this.options={},this.outside=!1,this.chart=h,this.init(h,v),this.pointer=S}bodyFormatter(h){return h.map(v=>{let S=v.series.tooltipOptions,I=v.formatPrefix||"point";return(S[I+"Formatter"]||v.tooltipFormatter).call(v,S[I+"Format"]||"")})}cleanSplit(h){this.chart.series.forEach(function(v){let S=v&&v.tt;S&&(!S.isActive||h?v.tt=S.destroy():S.isActive=!1)})}defaultFormatter(h){let v,S=this.points||dc(this);return(v=(v=[h.headerFooterFormatter(S[0])]).concat(h.bodyFormatter(S))).push(h.headerFooterFormatter(S[0],!0)),v}destroy(){this.label&&(this.label=this.label.destroy()),this.split&&(this.cleanSplit(!0),this.tt&&(this.tt=this.tt.destroy())),this.renderer&&(this.renderer=this.renderer.destroy(),pp(this.container)),Bi.clearTimeout(this.hideTimer)}getAnchor(h,v){let S,{chart:I,pointer:L}=this,z=I.inverted,B=I.plotTop,U=I.plotLeft;if((h=dc(h))[0].series&&h[0].series.yAxis&&!h[0].series.yAxis.options.reversedStacks&&(h=h.slice().reverse()),this.followPointer&&v)v.chartX===void 0&&(v=L.normalize(v)),S=[v.chartX-U,v.chartY-B];else if(h[0].tooltipPos)S=h[0].tooltipPos;else{let X=0,te=0;h.forEach(function(K){let re=K.pos(!0);re&&(X+=re[0],te+=re[1])}),X/=h.length,te/=h.length,this.shared&&h.length>1&&v&&(z?X=v.chartX:te=v.chartY),S=[X-U,te-B]}return S.map(Math.round)}getClassName(h,v,S){let I=this.options,L=h.series,z=L.options;return[I.className,"highcharts-label",S&&"highcharts-tooltip-header",v?"highcharts-tooltip-box":"highcharts-tooltip",!S&&"highcharts-color-"+la(h.colorIndex,L.colorIndex),z&&z.className].filter(du).join(" ")}getLabel({anchorX:h,anchorY:v}={anchorX:0,anchorY:0}){let S=this,I=this.chart.styledMode,L=this.options,z=this.split&&this.allowShared,B=this.container,U=this.chart.renderer;if(this.label){let X=!this.label.hasClass("highcharts-label");(!z&&X||z&&!X)&&this.destroy()}if(!this.label){if(this.outside){let X=this.chart,te=X.options.chart.style,K=Wc.getRendererType();this.container=B=Ne.doc.createElement("div"),B.className="highcharts-tooltip-container "+(X.renderTo.className.match(/(highcharts[a-zA-Z0-9-]+)\s?/gm)||""),kf(B,{position:"absolute",top:"1px",pointerEvents:"none",zIndex:Math.max(this.options.style.zIndex||0,(te&&te.zIndex||0)+3)}),this.renderer=U=new K(B,0,0,te,void 0,void 0,U.styledMode)}if(z?this.label=U.g("tooltip"):(this.label=U.label("",h,v,L.shape,void 0,void 0,L.useHTML,void 0,"tooltip").attr({padding:L.padding,r:L.borderRadius}),I||this.label.attr({fill:L.backgroundColor,"stroke-width":L.borderWidth||0}).css(L.style).css({pointerEvents:L.style.pointerEvents||(this.shouldStickOnContact()?"auto":"none")})),S.outside){let X=this.label;[X.xSetter,X.ySetter].forEach((te,K)=>{X[K?"ySetter":"xSetter"]=re=>{te.call(X,S.distance),X[K?"y":"x"]=re,B&&(B.style[K?"top":"left"]=`${re}px`)}})}this.label.attr({zIndex:8}).shadow(L.shadow).add()}return B&&!B.parentElement&&Ne.doc.body.appendChild(B),this.label}getPlayingField(){let{body:h,documentElement:v}=uu,{chart:S,distance:I,outside:L}=this;return{width:L?Math.max(h.scrollWidth,v.scrollWidth,h.offsetWidth,v.offsetWidth,v.clientWidth)-2*I-2:S.chartWidth,height:L?Math.max(h.scrollHeight,v.scrollHeight,h.offsetHeight,v.offsetHeight,v.clientHeight):S.chartHeight}}getPosition(h,v,S){var Zi,kr;let{distance:I,chart:L,outside:z,pointer:B}=this,{inverted:U,plotLeft:X,plotTop:te,polar:K}=L,{plotX:re=0,plotY:ue=0}=S,ge={},ye=U&&S.h||0,{height:xe,width:_e}=this.getPlayingField(),ze=B.getChartPosition(),Re=Hi=>Hi*ze.scaleX,ft=Hi=>Hi*ze.scaleY,St=Hi=>{let gr=Hi==="x";return[Hi,gr?_e:xe,gr?h:v].concat(z?[gr?Re(h):ft(v),gr?ze.left-I+Re(re+X):ze.top-I+ft(ue+te),0,gr?_e:xe]:[gr?h:v,gr?re+X:ue+te,gr?X:te,gr?X+L.plotWidth:te+L.plotHeight])},_t=St("y"),Ot=St("x"),Pt,Ft=!!S.negative;!K&&((kr=(Zi=L.hoverSeries)==null?void 0:Zi.yAxis)!=null&&kr.reversed)&&(Ft=!Ft);let hi=!this.followPointer&&la(S.ttBelow,!K&&!U===Ft),mi=function(Hi,gr,Vi,Qi,_r,un,kn){let zr=z?Hi==="y"?ft(I):Re(I):I,Hr=(Vi-Qi)/2,Xr=Qi<_r-I,Ms=_r+I+Qi<gr,ss=_r-zr-Vi+Hr,Es=_r+zr-Hr;if(hi&&Ms)ge[Hi]=Es;else if(!hi&&Xr)ge[Hi]=ss;else if(Xr)ge[Hi]=Math.min(kn-Qi,ss-ye<0?ss:ss-ye);else{if(!Ms)return!1;ge[Hi]=Math.max(un,Es+ye+Vi>gr?Es:Es+ye)}},Ai=function(Hi,gr,Vi,Qi,_r){if(_r<I||_r>gr-I)return!1;_r<Vi/2?ge[Hi]=1:_r>gr-Qi/2?ge[Hi]=gr-Qi-2:ge[Hi]=_r-Vi/2},ai=function(Hi){[_t,Ot]=[Ot,_t],Pt=Hi},Ci=()=>{mi.apply(0,_t)!==!1?Ai.apply(0,Ot)!==!1||Pt||(ai(!0),Ci()):Pt?ge.x=ge.y=0:(ai(!0),Ci())};return(U&&!K||this.len>1)&&ai(),Ci(),ge}hide(h){let v=this;Bi.clearTimeout(this.hideTimer),h=la(h,this.options.hideDelay),this.isHidden||(this.hideTimer=zf(function(){let S=v.getLabel();v.getLabel().animate({opacity:0},{duration:h&&150,complete:()=>{S.hide(),v.container&&v.container.remove()}}),v.isHidden=!0},h))}init(h,v){this.chart=h,this.options=v,this.crosshairs=[],this.isHidden=!0,this.split=v.split&&!h.inverted&&!h.polar,this.shared=v.shared||this.split,this.outside=la(v.outside,!!(h.scrollablePixelsX||h.scrollablePixelsY))}shouldStickOnContact(h){return!!(!this.followPointer&&this.options.stickOnContact&&(!h||this.pointer.inClass(h.target,"highcharts-tooltip")))}move(h,v,S,I){let L=this,z=El(!L.isHidden&&L.options.animation),B=L.followPointer||(L.len||0)>1,U={x:h,y:v};B||(U.anchorX=S,U.anchorY=I),z.step=()=>L.drawTracker(),L.getLabel().animate(U,z)}refresh(h,v){let{chart:S,options:I,pointer:L,shared:z}=this,B=dc(h),U=B[0],X=I.format,te=I.formatter||this.defaultFormatter,K=S.styledMode,re=this.allowShared;if(!I.enabled||!U.series)return;Bi.clearTimeout(this.hideTimer),this.allowShared=!(!Ym(h)&&h.series&&h.series.noSharedTooltip),re=re&&!this.allowShared,this.followPointer=!this.split&&U.series.tooltipOptions.followPointer;let ue=this.getAnchor(h,v),ge=ue[0],ye=ue[1];z&&this.allowShared&&(L.applyInactiveState(B),B.forEach(ze=>ze.setState("hover")),U.points=B),this.len=B.length;let xe=du(X)?id(X,U,S):te.call(U,this);U.points=void 0;let _e=U.series;if(this.distance=la(_e.tooltipOptions.distance,16),xe===!1)this.hide();else{if(this.split&&this.allowShared)this.renderSplit(xe,B);else{let ze=ge,Re=ye;if(v&&L.isDirectTouch&&(ze=v.chartX-S.plotLeft,Re=v.chartY-S.plotTop),S.polar||_e.options.clip===!1||B.some(ft=>L.isDirectTouch||ft.series.shouldShowTooltip(ze,Re))){let ft=this.getLabel(re&&this.tt||{});(!I.style.width||K)&&ft.css({width:(this.outside?this.getPlayingField():S.spacingBox).width+"px"}),ft.attr({class:this.getClassName(U),text:xe&&xe.join?xe.join(""):xe}),this.outside&&ft.attr({x:Cl(ft.x||0,0,this.getPlayingField().width-(ft.width||0)-1)}),K||ft.attr({stroke:I.borderColor||U.color||_e.color||"#666666"}),this.updatePosition({plotX:ge,plotY:ye,negative:U.negative,ttBelow:U.ttBelow,h:ue[2]||0})}else{this.hide();return}}this.isHidden&&this.label&&this.label.attr({opacity:1}).show(),this.isHidden=!1}Of(this,"refresh")}renderSplit(h,v){var gr;let S=this,{chart:I,chart:{chartWidth:L,chartHeight:z,plotHeight:B,plotLeft:U,plotTop:X,scrollablePixelsY:te=0,scrollablePixelsX:K,styledMode:re},distance:ue,options:ge,options:{positioner:ye},pointer:xe}=S,{scrollLeft:_e=0,scrollTop:ze=0}=((gr=I.scrollablePlotArea)==null?void 0:gr.scrollingContainer)||{},Re=S.outside&&typeof K!="number"?uu.documentElement.getBoundingClientRect():{left:_e,right:_e+L},ft=S.getLabel(),St=this.renderer||I.renderer,_t=!!(I.xAxis[0]&&I.xAxis[0].opposite),{left:Ot,top:Pt}=xe.getChartPosition(),Ft=X+ze,hi=0,mi=B-te;function Ai(Vi,Qi,_r,un,kn=!0){let zr,Hr;return _r?(zr=_t?0:mi,Hr=Cl(Vi-un/2,Re.left,Re.right-un-(S.outside?Ot:0))):(zr=Qi-Ft,Hr=Cl(Hr=kn?Vi-un-ue:Vi+ue,kn?Hr:Re.left,Re.right)),{x:Hr,y:zr}}du(h)&&(h=[!1,h]);let ai=h.slice(0,v.length+1).reduce(function(Vi,Qi,_r){if(Qi!==!1&&Qi!==""){let un=v[_r-1]||{isHeader:!0,plotX:v[0].plotX,plotY:B,series:{}},kn=un.isHeader,zr=kn?S:un.series,Hr=zr.tt=function(os,Xn,Bs){let Pc=os,{isHeader:Ed,series:em}=Xn;if(!Pc){let Cd={padding:ge.padding,r:ge.borderRadius};re||(Cd.fill=ge.backgroundColor,Cd["stroke-width"]=ge.borderWidth??1),Pc=St.label("",0,0,ge[Ed?"headerShape":"shape"],void 0,void 0,ge.useHTML).addClass(S.getClassName(Xn,!0,Ed)).attr(Cd).add(ft)}return Pc.isActive=!0,Pc.attr({text:Bs}),re||Pc.css(ge.style).attr({stroke:ge.borderColor||Xn.color||em.color||"#333333"}),Pc}(zr.tt,un,Qi.toString()),Xr=Hr.getBBox(),Ms=Xr.width+Hr.strokeWidth();kn&&(hi=Xr.height,mi+=hi,_t&&(Ft-=hi));let{anchorX:ss,anchorY:Es}=function(os){let Xn,Bs,{isHeader:Pc,plotX:Ed=0,plotY:em=0,series:Cd}=os;if(Pc)Xn=Math.max(U+Ed,U),Bs=X+B/2;else{let{xAxis:sg,yAxis:Hp}=Cd;Xn=sg.pos+Cl(Ed,-ue,sg.len+ue),Cd.shouldShowTooltip(0,Hp.pos-X+em,{ignoreX:!0})&&(Bs=Hp.pos+em)}return{anchorX:Xn=Cl(Xn,Re.left-ue,Re.right+ue),anchorY:Bs}}(un);if(typeof Es=="number"){let os=Xr.height+1,Xn=ye?ye.call(S,Ms,os,un):Ai(ss,Es,kn,Ms);Vi.push({align:ye?0:void 0,anchorX:ss,anchorY:Es,boxWidth:Ms,point:un,rank:la(Xn.rank,kn?1:0),size:os,target:Xn.y,tt:Hr,x:Xn.x})}else Hr.isActive=!1}return Vi},[]);!ye&&ai.some(Vi=>{let{outside:Qi}=S,_r=(Qi?Ot:0)+Vi.anchorX;return _r<Re.left&&_r+Vi.boxWidth<Re.right||_r<Ot-Re.left+Vi.boxWidth&&Re.right-_r>_r})&&(ai=ai.map(Vi=>{let{x:Qi,y:_r}=Ai(Vi.anchorX,Vi.anchorY,Vi.point.isHeader,Vi.boxWidth,!1);return hu(Vi,{target:_r,x:Qi})})),S.cleanSplit(),nd(ai,mi);let Ci={left:Ot,right:Ot};ai.forEach(function(Vi){let{x:Qi,boxWidth:_r,isHeader:un}=Vi;!un&&(S.outside&&Ot+Qi<Ci.left&&(Ci.left=Ot+Qi),!un&&S.outside&&Ci.left+_r>Ci.right&&(Ci.right=Ot+Qi))}),ai.forEach(function(Vi){let{x:Qi,anchorX:_r,anchorY:un,pos:kn,point:{isHeader:zr}}=Vi,Hr={visibility:kn===void 0?"hidden":"inherit",x:Qi,y:(kn||0)+Ft,anchorX:_r,anchorY:un};if(S.outside&&Qi<_r){let Xr=Ot-Ci.left;Xr>0&&(zr||(Hr.x=Qi+Xr,Hr.anchorX=_r+Xr),zr&&(Hr.x=(Ci.right-Ci.left)/2,Hr.anchorX=_r+Xr))}Vi.tt.attr(Hr)});let{container:Zi,outside:kr,renderer:Hi}=S;if(kr&&Zi&&Hi){let{width:Vi,height:Qi,x:_r,y:un}=ft.getBBox();Hi.setSize(Vi+_r,Qi+un,!1),Zi.style.left=Ci.left+"px",Zi.style.top=Pt+"px"}Df&&ft.attr({opacity:ft.opacity===1?.999:1})}drawTracker(){if(!this.shouldStickOnContact()){this.tracker&&(this.tracker=this.tracker.destroy());return}let h=this.chart,v=this.label,S=this.shared?h.hoverPoints:h.hoverPoint;if(!v||!S)return;let I={x:0,y:0,width:0,height:0},L=this.getAnchor(S),z=v.getBBox();L[0]+=h.plotLeft-(v.translateX||0),L[1]+=h.plotTop-(v.translateY||0),I.x=Math.min(0,L[0]),I.y=Math.min(0,L[1]),I.width=L[0]<0?Math.max(Math.abs(L[0]),z.width-L[0]):Math.max(Math.abs(L[0]),z.width),I.height=L[1]<0?Math.max(Math.abs(L[1]),z.height-Math.abs(L[1])):Math.max(Math.abs(L[1]),z.height),this.tracker?this.tracker.attr(I):(this.tracker=v.renderer.rect(I).addClass("highcharts-tracker").add(v),h.styledMode||this.tracker.attr({fill:"rgba(0,0,0,0)"}))}styledModeFormat(h){return h.replace('style="font-size: 0.8em"','class="highcharts-header"').replace(/style="color:{(point|series)\.color}"/g,'class="highcharts-color-{$1.colorIndex} {series.options.className} {point.options.className}"')}headerFooterFormatter(h,v){let S=h.series,I=S.tooltipOptions,L=S.xAxis,z=L&&L.dateTime,B={isFooter:v,point:h},U=I.xDateFormat||"",X=I[v?"footerFormat":"headerFormat"];return Of(this,"headerFormatter",B,function(te){if(z&&!U&&Lf(h.key)&&(U=z.getXDateFormat(h.key,I.dateTimeLabelFormats)),z&&U){if(Rf(U)){let K=U;rd[0]=re=>S.chart.time.dateFormat(K,re),U="%0"}(h.tooltipDateKeys||["key"]).forEach(K=>{X=X.replace(RegExp("point\\."+K+"([ \\)}])",""),`(point.${K}:${U})$1`)})}S.chart.styledMode&&(X=this.styledModeFormat(X)),te.text=id(X,h,this.chart)}),B.text||""}update(h){this.destroy(),this.init(this.chart,pu(!0,this.options,h))}updatePosition(h){let{chart:v,container:S,distance:I,options:L,pointer:z,renderer:B}=this,{height:U=0,width:X=0}=this.getLabel(),{left:te,top:K,scaleX:re,scaleY:ue}=z.getChartPosition(),ge=(L.positioner||this.getPosition).call(this,X,U,h),ye=Ne.doc,xe=(h.plotX||0)+v.plotLeft,_e=(h.plotY||0)+v.plotTop,ze;B&&S&&(L.positioner&&(ge.x+=te-I,ge.y+=K-I),ze=(L.borderWidth||0)+2*I+2,B.setSize(Cl(X+ze,0,ye.documentElement.clientWidth)-1,U+ze,!1),(re!==1||ue!==1)&&(kf(S,{transform:`scale(${re}, ${ue})`}),xe*=re,_e*=ue),xe+=te-ge.x,_e+=K-ge.y),this.move(Math.round(ge.x),Math.round(ge.y||0),xe,_e)}}(function(Y){Y.compose=function(h){sd(zo,"Core.Tooltip")&&nh(h,"afterInit",function(){let v=this.chart;v.options.tooltip&&(v.tooltip=new Y(v,v.options.tooltip,this))})}})(pc||(pc={}));let fu=pc,{animObject:fp}=se,{defaultOptions:Ff}=zn,{format:Xm}=Po,{addEvent:fc,crisp:od,erase:_i,extend:mu,fireEvent:sh,getNestedProperty:Al,isArray:mc,isFunction:wi,isNumber:Ba,isObject:ad,merge:Bf,pick:ca,syncTimeout:mp,removeEvent:ld,uniqueKey:Nf}=Bi;class gc{animateBeforeDestroy(){let h=this,v={x:h.startXPos,opacity:0},S=h.getGraphicalProps();S.singular.forEach(function(I){h[I]=h[I].animate(I==="dataLabel"?{x:h[I].startXPos,y:h[I].startYPos,opacity:0}:v)}),S.plural.forEach(function(I){h[I].forEach(function(L){L.element&&L.animate(mu({x:h.startXPos},L.startYPos?{x:L.startXPos,y:L.startYPos}:{}))})})}applyOptions(h,v){let S=this.series,I=S.options.pointValKey||S.pointValKey;return mu(this,h=gc.prototype.optionsToObject.call(this,h)),this.options=this.options?mu(this.options,h):h,h.group&&delete this.group,h.dataLabels&&delete this.dataLabels,I&&(this.y=gc.prototype.getNestedProperty.call(this,I)),this.selected&&(this.state="select"),"name"in this&&v===void 0&&S.xAxis&&S.xAxis.hasNames&&(this.x=S.xAxis.nameToX(this)),this.x===void 0&&S?this.x=v??S.autoIncrement():Ba(h.x)&&S.options.relativeXValue?this.x=S.autoIncrement(h.x):typeof this.x=="string"&&(v??(v=S.chart.time.parse(this.x)),Ba(v)&&(this.x=v)),this.isNull=this.isValid&&!this.isValid(),this.formatPrefix=this.isNull?"null":"point",this}destroy(){if(!this.destroyed){let h=this,v=h.series,S=v.chart,I=v.options.dataSorting,L=S.hoverPoints,z=fp(h.series.chart.renderer.globalAnimation),B=()=>{for(let U in(h.graphic||h.graphics||h.dataLabel||h.dataLabels)&&(ld(h),h.destroyElements()),h)delete h[U]};h.legendItem&&S.legend.destroyItem(h),L&&(h.setState(),_i(L,h),L.length||(S.hoverPoints=null)),h===S.hoverPoint&&h.onMouseOut(),I&&I.enabled?(this.animateBeforeDestroy(),mp(B,z.duration)):B(),S.pointCount--}this.destroyed=!0}destroyElements(h){let v=this,S=v.getGraphicalProps(h);S.singular.forEach(function(I){v[I]=v[I].destroy()}),S.plural.forEach(function(I){v[I].forEach(function(L){L&&L.element&&L.destroy()}),delete v[I]})}firePointEvent(h,v,S){let I=this,L=this.series.options;I.manageEvent(h),h==="click"&&L.allowPointSelect&&(S=function(z){!I.destroyed&&I.select&&I.select(null,z.ctrlKey||z.metaKey||z.shiftKey)}),sh(I,h,v,S)}getClassName(){return"highcharts-point"+(this.selected?" highcharts-point-select":"")+(this.negative?" highcharts-negative":"")+(this.isNull?" highcharts-null-point":"")+(this.colorIndex!==void 0?" highcharts-color-"+this.colorIndex:"")+(this.options.className?" "+this.options.className:"")+(this.zone&&this.zone.className?" "+this.zone.className.replace("highcharts-negative",""):"")}getGraphicalProps(h){let v,S,I=this,L=[],z={singular:[],plural:[]};for((h=h||{graphic:1,dataLabel:1}).graphic&&L.push("graphic","connector"),h.dataLabel&&L.push("dataLabel","dataLabelPath","dataLabelUpper"),S=L.length;S--;)I[v=L[S]]&&z.singular.push(v);return["graphic","dataLabel"].forEach(function(B){let U=B+"s";h[B]&&I[U]&&z.plural.push(U)}),z}getNestedProperty(h){return h?h.indexOf("custom.")===0?Al(h,this.options):this[h]:void 0}getZone(){let h=this.series,v=h.zones,S=h.zoneAxis||"y",I,L=0;for(I=v[0];this[S]>=I.value;)I=v[++L];return this.nonZonedColor||(this.nonZonedColor=this.color),I&&I.color&&!this.options.color?this.color=I.color:this.color=this.nonZonedColor,I}hasNewShapeType(){return(this.graphic&&(this.graphic.symbolName||this.graphic.element.nodeName))!==this.shapeType}constructor(h,v,S){this.formatPrefix="point",this.visible=!0,this.point=this,this.series=h,this.applyOptions(v,S),this.id??(this.id=Nf()),this.resolveColor(),h.chart.pointCount++,sh(this,"afterInit")}isValid(){return(Ba(this.x)||this.x instanceof Date)&&Ba(this.y)}optionsToObject(h){var te;let v=this.series,S=v.options.keys,I=S||v.pointArrayMap||["y"],L=I.length,z={},B,U=0,X=0;if(Ba(h)||h===null)z[I[0]]=h;else if(mc(h))for(!S&&h.length>L&&((B=typeof h[0])=="string"?(te=v.xAxis)!=null&&te.dateTime?z.x=v.chart.time.parse(h[0]):z.name=h[0]:B==="number"&&(z.x=h[0]),U++);X<L;)S&&h[U]===void 0||(I[X].indexOf(".")>0?gc.prototype.setNestedProperty(z,h[U],I[X]):z[I[X]]=h[U]),U++,X++;else typeof h=="object"&&(z=h,h.dataLabels&&(v.hasDataLabels=()=>!0),h.marker&&(v._hasPointMarkers=!0));return z}pos(h,v=this.plotY){if(!this.destroyed){let{plotX:S,series:I}=this,{chart:L,xAxis:z,yAxis:B}=I,U=0,X=0;if(Ba(S)&&Ba(v))return h&&(U=z?z.pos:L.plotLeft,X=B?B.pos:L.plotTop),L.inverted&&z&&B?[B.len-v+X,z.len-S+U]:[S+U,v+X]}}resolveColor(){let h=this.series,v=h.chart.options.chart,S=h.chart.styledMode,I,L,z=v.colorCount,B;delete this.nonZonedColor,h.options.colorByPoint?(S||(I=(L=h.options.colors||h.chart.options.colors)[h.colorCounter],z=L.length),B=h.colorCounter,h.colorCounter++,h.colorCounter===z&&(h.colorCounter=0)):(S||(I=h.color),B=h.colorIndex),this.colorIndex=ca(this.options.colorIndex,B),this.color=ca(this.options.color,I)}setNestedProperty(h,v,S){return S.split(".").reduce(function(I,L,z,B){let U=B.length-1===z;return I[L]=U?v:ad(I[L],!0)?I[L]:{},I[L]},h),h}shouldDraw(){return!this.isNull}tooltipFormatter(h){var U;let{chart:v,pointArrayMap:S=["y"],tooltipOptions:I}=this.series,{valueDecimals:L="",valuePrefix:z="",valueSuffix:B=""}=I;return v.styledMode&&(h=((U=v.tooltip)==null?void 0:U.styledModeFormat(h))||h),S.forEach(X=>{X="{point."+X,(z||B)&&(h=h.replace(RegExp(X+"}","g"),z+X+"}"+B)),h=h.replace(RegExp(X+"}","g"),X+":,."+L+"f}")}),Xm(h,this,v)}update(h,v,S,I){let L,z=this,B=z.series,U=z.graphic,X=B.chart,te=B.options;function K(){z.applyOptions(h);let re=U&&z.hasMockGraphic,ue=z.y===null?!re:re;U&&ue&&(z.graphic=U.destroy(),delete z.hasMockGraphic),ad(h,!0)&&(U&&U.element&&h&&h.marker&&h.marker.symbol!==void 0&&(z.graphic=U.destroy()),h!=null&&h.dataLabels&&z.dataLabel&&(z.dataLabel=z.dataLabel.destroy())),L=z.index;let ge={};for(let ye of B.dataColumnKeys())ge[ye]=z[ye];B.dataTable.setRow(ge,L),te.data[L]=ad(te.data[L],!0)||ad(h,!0)?z.options:ca(h,te.data[L]),B.isDirty=B.isDirtyData=!0,!B.fixedBox&&B.hasCartesianSeries&&(X.isDirtyBox=!0),te.legendType==="point"&&(X.isDirtyLegend=!0),v&&X.redraw(S)}v=ca(v,!0),I===!1?K():z.firePointEvent("update",{options:h},K)}remove(h,v){this.series.removePoint(this.series.data.indexOf(this),h,v)}select(h,v){let S=this,I=S.series,L=I.chart;h=ca(h,!S.selected),this.selectedStaging=h,S.firePointEvent(h?"select":"unselect",{accumulate:v},function(){S.selected=S.options.selected=h,I.options.data[I.data.indexOf(S)]=S.options,S.setState(h&&"select"),v||L.getSelectedPoints().forEach(function(z){let B=z.series;z.selected&&z!==S&&(z.selected=z.options.selected=!1,B.options.data[B.data.indexOf(z)]=z.options,z.setState(L.hoverPoints&&B.options.inactiveOtherPoints?"inactive":""),z.firePointEvent("unselect"))})}),delete this.selectedStaging}onMouseOver(h){let{inverted:v,pointer:S}=this.series.chart;S&&(h=h?S.normalize(h):S.getChartCoordinatesFromPoint(this,v),S.runPointActions(h,this))}onMouseOut(){let h=this.series.chart;this.firePointEvent("mouseOut"),this.series.options.inactiveOtherPoints||(h.hoverPoints||[]).forEach(function(v){v.setState()}),h.hoverPoints=h.hoverPoint=null}manageEvent(h){var I,L,z,B,U,X,te;let v=Bf(this.series.options.point,this.options),S=(I=v.events)==null?void 0:I[h];wi(S)&&(!((L=this.hcEvents)!=null&&L[h])||((B=(z=this.hcEvents)==null?void 0:z[h])==null?void 0:B.map(K=>K.fn).indexOf(S))===-1)?((U=this.importedUserEvent)==null||U.call(this),this.importedUserEvent=fc(this,h,S),this.hcEvents&&(this.hcEvents[h].userEvent=!0)):this.importedUserEvent&&!S&&((X=this.hcEvents)!=null&&X[h])&&((te=this.hcEvents)!=null&&te[h].userEvent)&&(ld(this,h),delete this.hcEvents[h],Object.keys(this.hcEvents)||delete this.importedUserEvent)}setState(h,v){var _t;let S=this.series,I=this.state,L=S.options.states[h||"normal"]||{},z=Ff.plotOptions[S.type].marker&&S.options.marker,B=z&&z.enabled===!1,U=z&&z.states&&z.states[h||"normal"]||{},X=U.enabled===!1,te=this.marker||{},K=S.chart,re=z&&S.markerAttribs,ue=S.halo,ge,ye,xe,_e=S.stateMarkerGraphic,ze;if((h=h||"")===this.state&&!v||this.selected&&h!=="select"||L.enabled===!1||h&&(X||B&&U.enabled===!1)||h&&te.states&&te.states[h]&&te.states[h].enabled===!1)return;if(this.state=h,re&&(ge=S.markerAttribs(this,h)),this.graphic&&!this.hasMockGraphic){if(I&&this.graphic.removeClass("highcharts-point-"+I),h&&this.graphic.addClass("highcharts-point-"+h),!K.styledMode){ye=S.pointAttribs(this,h),xe=ca(K.options.chart.animation,L.animation);let Ot=ye.opacity;S.options.inactiveOtherPoints&&Ba(Ot)&&(this.dataLabels||[]).forEach(function(Pt){Pt&&!Pt.hasClass("highcharts-data-label-hidden")&&(Pt.animate({opacity:Ot},xe),Pt.connector&&Pt.connector.animate({opacity:Ot},xe))}),this.graphic.animate(ye,xe)}ge&&this.graphic.animate(ge,ca(K.options.chart.animation,U.animation,z.animation)),_e&&_e.hide()}else h&&U&&(ze=te.symbol||S.symbol,_e&&_e.currentSymbol!==ze&&(_e=_e.destroy()),ge&&(_e?_e[v?"animate":"attr"]({x:ge.x,y:ge.y}):ze&&(S.stateMarkerGraphic=_e=K.renderer.symbol(ze,ge.x,ge.y,ge.width,ge.height,Bf(z,U)).add(S.markerGroup),_e.currentSymbol=ze)),!K.styledMode&&_e&&this.state!=="inactive"&&_e.attr(S.pointAttribs(this,h))),_e&&(_e[h&&this.isInside?"show":"hide"](),_e.element.point=this,_e.addClass(this.getClassName(),!0));let Re=L.halo,ft=this.graphic||_e,St=ft&&ft.visibility||"inherit";Re&&Re.size&&ft&&St!=="hidden"&&!this.isCluster?(ue||(S.halo=ue=K.renderer.path().add(ft.parentGroup)),ue.show()[v?"animate":"attr"]({d:this.haloPath(Re.size)}),ue.attr({class:"highcharts-halo highcharts-color-"+ca(this.colorIndex,S.colorIndex)+(this.className?" "+this.className:""),visibility:St,zIndex:-1}),ue.point=this,K.styledMode||ue.attr(mu({fill:this.color||S.color,"fill-opacity":Re.opacity},pi.filterUserAttributes(Re.attributes||{})))):(_t=ue==null?void 0:ue.point)!=null&&_t.haloPath&&!ue.point.destroyed&&ue.animate({d:ue.point.haloPath(0)},null,ue.hide),sh(this,"afterSetState",{state:h})}haloPath(h){let v=this.pos();return v?this.series.chart.renderer.symbols.circle(od(v[0],1)-h,v[1]-h,2*h,2*h):[]}}let Jo=gc,{parse:cd}=Jr,{charts:oh,composed:Na,isTouchDevice:xo}=Ne,{addEvent:Ss,attr:gp,css:ah,extend:Pl,find:lh,fireEvent:Qo,isNumber:Qs,isObject:Vr,objectEach:ud,offset:ch,pick:bo,pushUnique:_p,splat:gu}=Bi;class Vn{applyInactiveState(h){let v=[],S;(h||[]).forEach(function(I){S=I.series,v.push(S),S.linkedParent&&v.push(S.linkedParent),S.linkedSeries&&(v=v.concat(S.linkedSeries)),S.navigatorSeries&&v.push(S.navigatorSeries)}),this.chart.series.forEach(function(I){v.indexOf(I)===-1?I.setState("inactive",!0):I.options.inactiveOtherPoints&&I.setAllPointsToState("inactive")})}destroy(){let h=this;this.eventsToUnbind.forEach(v=>v()),this.eventsToUnbind=[],!Ne.chartCount&&(Vn.unbindDocumentMouseUp.forEach(v=>v.unbind()),Vn.unbindDocumentMouseUp.length=0,Vn.unbindDocumentTouchEnd&&(Vn.unbindDocumentTouchEnd=Vn.unbindDocumentTouchEnd())),clearInterval(h.tooltipTimeout),ud(h,function(v,S){h[S]=void 0})}getSelectionMarkerAttrs(h,v){let S={args:{chartX:h,chartY:v},attrs:{},shapeType:"rect"};return Qo(this,"getSelectionMarkerAttrs",S,I=>{let L,{chart:z,zoomHor:B,zoomVert:U}=this,{mouseDownX:X=0,mouseDownY:te=0}=z,K=I.attrs;K.x=z.plotLeft,K.y=z.plotTop,K.width=B?1:z.plotWidth,K.height=U?1:z.plotHeight,B&&(L=h-X,K.width=Math.max(1,Math.abs(L)),K.x=(L>0?0:L)+X),U&&(L=v-te,K.height=Math.max(1,Math.abs(L)),K.y=(L>0?0:L)+te)}),S}drag(h){let{chart:v}=this,{mouseDownX:S=0,mouseDownY:I=0}=v,{panning:L,panKey:z,selectionMarkerFill:B}=v.options.chart,U=v.plotLeft,X=v.plotTop,te=v.plotWidth,K=v.plotHeight,re=Vr(L)?L.enabled:L,ue=z&&h[`${z}Key`],ge=h.chartX,ye=h.chartY,xe,_e=this.selectionMarker;if((!_e||!_e.touch)&&(ge<U?ge=U:ge>U+te&&(ge=U+te),ye<X?ye=X:ye>X+K&&(ye=X+K),this.hasDragged=Math.sqrt(Math.pow(S-ge,2)+Math.pow(I-ye,2)),this.hasDragged>10)){xe=v.isInsidePlot(S-U,I-X,{visiblePlotOnly:!0});let{shapeType:ze,attrs:Re}=this.getSelectionMarkerAttrs(ge,ye);(v.hasCartesianSeries||v.mapView)&&this.hasZoom&&xe&&!ue&&!_e&&(this.selectionMarker=_e=v.renderer[ze](),_e.attr({class:"highcharts-selection-marker",zIndex:7}).add(),v.styledMode||_e.attr({fill:B||cd("#334eff").setOpacity(.25).get()})),_e&&_e.attr(Re),xe&&!_e&&re&&v.pan(h,L)}}dragStart(h){let v=this.chart;v.mouseIsDown=h.type,v.cancelClick=!1,v.mouseDownX=h.chartX,v.mouseDownY=h.chartY}getSelectionBox(h){let v={args:{marker:h},result:h.getBBox()};return Qo(this,"getSelectionBox",v),v.result}drop(h){let v,{chart:S,selectionMarker:I}=this;for(let L of S.axes)L.isPanning&&(L.isPanning=!1,(L.options.startOnTick||L.options.endOnTick||L.series.some(z=>z.boosted))&&(L.forceRedraw=!0,L.setExtremes(L.userMin,L.userMax,!1),v=!0));if(v&&S.redraw(),I&&h){if(this.hasDragged){let L=this.getSelectionBox(I);S.transform({axes:S.axes.filter(z=>z.zoomEnabled&&(z.coll==="xAxis"&&this.zoomX||z.coll==="yAxis"&&this.zoomY)),selection:{originalEvent:h,xAxis:[],yAxis:[],...L},from:L})}Qs(S.index)&&(this.selectionMarker=I.destroy())}S&&Qs(S.index)&&(ah(S.container,{cursor:S._cursor}),S.cancelClick=this.hasDragged>10,S.mouseIsDown=!1,this.hasDragged=0,this.pinchDown=[])}findNearestKDPoint(h,v,S){let I;return h.forEach(function(L){let z=!(L.noSharedTooltip&&v)&&0>L.options.findNearestPointBy.indexOf("y"),B=L.searchPoint(S,z);Vr(B,!0)&&B.series&&(!Vr(I,!0)||function(U,X){var ue,ge;let te=U.distX-X.distX,K=U.dist-X.dist,re=((ue=X.series.group)==null?void 0:ue.zIndex)-((ge=U.series.group)==null?void 0:ge.zIndex);return te!==0&&v?te:K!==0?K:re!==0?re:U.series.index>X.series.index?-1:1}(I,B)>0)&&(I=B)}),I}getChartCoordinatesFromPoint(h,v){let{xAxis:S,yAxis:I}=h.series,L=h.shapeArgs;if(S&&I){let z=h.clientX??h.plotX??0,B=h.plotY||0;return h.isNode&&L&&Qs(L.x)&&Qs(L.y)&&(z=L.x,B=L.y),v?{chartX:I.len+I.pos-B,chartY:S.len+S.pos-z}:{chartX:z+S.pos,chartY:B+I.pos}}if(L&&L.x&&L.y)return{chartX:L.x,chartY:L.y}}getChartPosition(){if(this.chartPosition)return this.chartPosition;let{container:h}=this.chart,v=ch(h);this.chartPosition={left:v.left,top:v.top,scaleX:1,scaleY:1};let{offsetHeight:S,offsetWidth:I}=h;return I>2&&S>2&&(this.chartPosition.scaleX=v.width/I,this.chartPosition.scaleY=v.height/S),this.chartPosition}getCoordinates(h){let v={xAxis:[],yAxis:[]};for(let S of this.chart.axes)v[S.isXAxis?"xAxis":"yAxis"].push({axis:S,value:S.toValue(h[S.horiz?"chartX":"chartY"])});return v}getHoverData(h,v,S,I,L,z){let B=[],U=function(ue){return ue.visible&&!(!L&&ue.directTouch)&&bo(ue.options.enableMouseTracking,!0)},X=v,te,K={chartX:z?z.chartX:void 0,chartY:z?z.chartY:void 0,shared:L};Qo(this,"beforeGetHoverData",K),te=X&&!X.stickyTracking?[X]:S.filter(ue=>ue.stickyTracking&&(K.filter||U)(ue));let re=I&&h||!z?h:this.findNearestKDPoint(te,L,z);return X=re&&re.series,re&&(L&&!X.noSharedTooltip?(te=S.filter(function(ue){return K.filter?K.filter(ue):U(ue)&&!ue.noSharedTooltip})).forEach(function(ue){let ge=lh(ue.points,function(ye){return ye.x===re.x&&!ye.isNull});Vr(ge)&&(ue.boosted&&ue.boost&&(ge=ue.boost.getPoint(ge)),B.push(ge))}):B.push(re)),Qo(this,"afterGetHoverData",K={hoverPoint:re}),{hoverPoint:K.hoverPoint,hoverSeries:X,hoverPoints:B}}getPointFromEvent(h){let v=h.target,S;for(;v&&!S;)S=v.point,v=v.parentNode;return S}onTrackerMouseOut(h){let v=this.chart,S=h.relatedTarget,I=v.hoverSeries;this.isDirectTouch=!1,!I||!S||I.stickyTracking||this.inClass(S,"highcharts-tooltip")||this.inClass(S,"highcharts-series-"+I.index)&&this.inClass(S,"highcharts-tracker")||I.onMouseOut()}inClass(h,v){let S=h,I;for(;S;){if(I=gp(S,"class")){if(I.indexOf(v)!==-1)return!0;if(I.indexOf("highcharts-container")!==-1)return!1}S=S.parentElement}}constructor(h,v){var S;this.hasDragged=0,this.pointerCaptureEventsToUnbind=[],this.eventsToUnbind=[],this.options=v,this.chart=h,this.runChartClick=!!((S=v.chart.events)!=null&&S.click),this.pinchDown=[],this.setDOMEvents(),Qo(this,"afterInit")}normalize(h,v){let S=h.touches,I=S?S.length?S.item(0):bo(S.changedTouches,h.changedTouches)[0]:h;v||(v=this.getChartPosition());let L=I.pageX-v.left,z=I.pageY-v.top;return Pl(h,{chartX:Math.round(L/=v.scaleX),chartY:Math.round(z/=v.scaleY)})}onContainerClick(h){let v=this.chart,S=v.hoverPoint,I=this.normalize(h),L=v.plotLeft,z=v.plotTop;!v.cancelClick&&(S&&this.inClass(I.target,"highcharts-tracker")?(Qo(S.series,"click",Pl(I,{point:S})),v.hoverPoint&&S.firePointEvent("click",I)):(Pl(I,this.getCoordinates(I)),v.isInsidePlot(I.chartX-L,I.chartY-z,{visiblePlotOnly:!0})&&Qo(v,"click",I)))}onContainerMouseDown(h){var S;let v=(1&(h.buttons||h.button))==1;h=this.normalize(h),Ne.isFirefox&&h.button!==0&&this.onContainerMouseMove(h),(h.button===void 0||v)&&(this.zoomOption(h),v&&((S=h.preventDefault)==null||S.call(h)),this.dragStart(h))}onContainerMouseLeave(h){let{pointer:v}=oh[bo(Vn.hoverChartIndex,-1)]||{};h=this.normalize(h),this.onContainerMouseMove(h),v&&!this.inClass(h.relatedTarget,"highcharts-tooltip")&&(v.reset(),v.chartPosition=void 0)}onContainerMouseEnter(){delete this.chartPosition}onContainerMouseMove(h){let v=this.chart,S=v.tooltip,I=this.normalize(h);this.setHoverChartIndex(h),(v.mouseIsDown==="mousedown"||this.touchSelect(I))&&this.drag(I),!v.openMenu&&(this.inClass(I.target,"highcharts-tracker")||v.isInsidePlot(I.chartX-v.plotLeft,I.chartY-v.plotTop,{visiblePlotOnly:!0}))&&!(S&&S.shouldStickOnContact(I))&&(this.inClass(I.target,"highcharts-no-tooltip")?this.reset(!1,0):this.runPointActions(I))}onDocumentTouchEnd(h){this.onDocumentMouseUp(h)}onContainerTouchMove(h){this.touchSelect(h)?this.onContainerMouseMove(h):this.touch(h)}onContainerTouchStart(h){this.touchSelect(h)?this.onContainerMouseDown(h):(this.zoomOption(h),this.touch(h,!0))}onDocumentMouseMove(h){let v=this.chart,S=v.tooltip,I=this.chartPosition,L=this.normalize(h,I);!I||v.isInsidePlot(L.chartX-v.plotLeft,L.chartY-v.plotTop,{visiblePlotOnly:!0})||S&&S.shouldStickOnContact(L)||L.target!==v.container.ownerDocument&&this.inClass(L.target,"highcharts-tracker")||this.reset()}onDocumentMouseUp(h){var v,S;(S=(v=oh[bo(Vn.hoverChartIndex,-1)])==null?void 0:v.pointer)==null||S.drop(h)}pinch(h){let v=this,{chart:S,hasZoom:I,lastTouches:L}=v,z=[].map.call(h.touches||[],K=>v.normalize(K)),B=z.length,U=B===1&&(v.inClass(h.target,"highcharts-tracker")&&S.runTrackerClick||v.runChartClick),X=S.tooltip,te=B===1&&bo(X==null?void 0:X.options.followTouchMove,!0);B>1?v.initiated=!0:te&&(v.initiated=!1),I&&v.initiated&&!U&&h.cancelable!==!1&&h.preventDefault(),h.type==="touchstart"?(v.pinchDown=z,v.res=!0,S.mouseDownX=h.chartX):te?this.runPointActions(v.normalize(h)):L&&(Qo(S,"touchpan",{originalEvent:h,touches:z},()=>{let K=re=>{let ue=re[0],ge=re[1]||ue;return{x:ue.chartX,y:ue.chartY,width:ge.chartX-ue.chartX,height:ge.chartY-ue.chartY}};S.transform({axes:S.axes.filter(re=>re.zoomEnabled&&(this.zoomHor&&re.horiz||this.zoomVert&&!re.horiz)),to:K(z),from:K(L),trigger:h.type})}),v.res&&(v.res=!1,this.reset(!1,0))),v.lastTouches=z}reset(h,v){let S=this.chart,I=S.hoverSeries,L=S.hoverPoint,z=S.hoverPoints,B=S.tooltip,U=B&&B.shared?z:L;h&&U&&gu(U).forEach(function(X){X.series.isCartesian&&X.plotX===void 0&&(h=!1)}),h?B&&U&&gu(U).length&&(B.refresh(U),B.shared&&z?z.forEach(function(X){X.setState(X.state,!0),X.series.isCartesian&&(X.series.xAxis.crosshair&&X.series.xAxis.drawCrosshair(null,X),X.series.yAxis.crosshair&&X.series.yAxis.drawCrosshair(null,X))}):L&&(L.setState(L.state,!0),S.axes.forEach(function(X){X.crosshair&&L.series[X.coll]===X&&X.drawCrosshair(null,L)}))):(L&&L.onMouseOut(),z&&z.forEach(function(X){X.setState()}),I&&I.onMouseOut(),B&&B.hide(v),this.unDocMouseMove&&(this.unDocMouseMove=this.unDocMouseMove()),S.axes.forEach(function(X){X.hideCrosshair()}),S.hoverPoints=S.hoverPoint=void 0)}runPointActions(h,v,S){let I=this.chart,L=I.series,z=I.tooltip&&I.tooltip.options.enabled?I.tooltip:void 0,B=!!z&&z.shared,U=v||I.hoverPoint,X=U&&U.series||I.hoverSeries,te=(!h||h.type!=="touchmove")&&(!!v||X&&X.directTouch&&this.isDirectTouch),K=this.getHoverData(U,X,L,te,B,h);U=K.hoverPoint,X=K.hoverSeries;let re=K.hoverPoints,ue=X&&X.tooltipOptions.followPointer&&!X.tooltipOptions.split,ge=B&&X&&!X.noSharedTooltip;if(U&&(S||U!==I.hoverPoint||z&&z.isHidden)){if((I.hoverPoints||[]).forEach(function(ye){re.indexOf(ye)===-1&&ye.setState()}),I.hoverSeries!==X&&X.onMouseOver(),this.applyInactiveState(re),(re||[]).forEach(function(ye){ye.setState("hover")}),I.hoverPoint&&I.hoverPoint.firePointEvent("mouseOut"),!U.series)return;I.hoverPoints=re,I.hoverPoint=U,U.firePointEvent("mouseOver",void 0,()=>{z&&U&&z.refresh(ge?re:U,h)})}else if(ue&&z&&!z.isHidden){let ye=z.getAnchor([{}],h);I.isInsidePlot(ye[0],ye[1],{visiblePlotOnly:!0})&&z.updatePosition({plotX:ye[0],plotY:ye[1]})}this.unDocMouseMove||(this.unDocMouseMove=Ss(I.container.ownerDocument,"mousemove",ye=>{var xe,_e;return(_e=(xe=oh[Vn.hoverChartIndex??-1])==null?void 0:xe.pointer)==null?void 0:_e.onDocumentMouseMove(ye)}),this.eventsToUnbind.push(this.unDocMouseMove)),I.axes.forEach(function(ye){let xe,_e=bo((ye.crosshair||{}).snap,!0);!_e||(xe=I.hoverPoint)&&xe.series[ye.coll]===ye||(xe=lh(re,ze=>ze.series&&ze.series[ye.coll]===ye)),xe||!_e?ye.drawCrosshair(h,xe):ye.hideCrosshair()})}setDOMEvents(){let h=this.chart.container,v=h.ownerDocument;h.onmousedown=this.onContainerMouseDown.bind(this),h.onmousemove=this.onContainerMouseMove.bind(this),h.onclick=this.onContainerClick.bind(this),this.eventsToUnbind.push(Ss(h,"mouseenter",this.onContainerMouseEnter.bind(this)),Ss(h,"mouseleave",this.onContainerMouseLeave.bind(this))),Vn.unbindDocumentMouseUp.some(I=>I.doc===v)||Vn.unbindDocumentMouseUp.push({doc:v,unbind:Ss(v,"mouseup",this.onDocumentMouseUp.bind(this))});let S=this.chart.renderTo.parentElement;for(;S&&S.tagName!=="BODY";)this.eventsToUnbind.push(Ss(S,"scroll",()=>{delete this.chartPosition})),S=S.parentElement;this.eventsToUnbind.push(Ss(h,"touchstart",this.onContainerTouchStart.bind(this),{passive:!1}),Ss(h,"touchmove",this.onContainerTouchMove.bind(this),{passive:!1})),Vn.unbindDocumentTouchEnd||(Vn.unbindDocumentTouchEnd=Ss(v,"touchend",this.onDocumentTouchEnd.bind(this),{passive:!1})),this.setPointerCapture(),Ss(this.chart,"redraw",this.setPointerCapture.bind(this))}setPointerCapture(){var L,z;if(!xo)return;let h=this.pointerCaptureEventsToUnbind,v=this.chart,S=v.container,I=bo((L=v.options.tooltip)==null?void 0:L.followTouchMove,!0)&&v.series.some(B=>B.options.findNearestPointBy.indexOf("y")>-1);!this.hasPointerCapture&&I?(h.push(Ss(S,"pointerdown",B=>{var U,X;(U=B.target)!=null&&U.hasPointerCapture(B.pointerId)&&((X=B.target)==null||X.releasePointerCapture(B.pointerId))}),Ss(S,"pointermove",B=>{var U,X;(X=(U=v.pointer)==null?void 0:U.getPointFromEvent(B))==null||X.onMouseOver(B)})),v.styledMode||ah(S,{"touch-action":"none"}),S.className+=" highcharts-no-touch-action",this.hasPointerCapture=!0):this.hasPointerCapture&&!I&&(h.forEach(B=>B()),h.length=0,v.styledMode||ah(S,{"touch-action":bo((z=v.options.chart.style)==null?void 0:z["touch-action"],"manipulation")}),S.className=S.className.replace(" highcharts-no-touch-action",""),this.hasPointerCapture=!1)}setHoverChartIndex(h){var I;let v=this.chart,S=Ne.charts[bo(Vn.hoverChartIndex,-1)];if(S&&S!==v){let L={relatedTarget:v.container};h&&!(h!=null&&h.relatedTarget)&&Object.assign({},h,L),(I=S.pointer)==null||I.onContainerMouseLeave(h||L)}S&&S.mouseIsDown||(Vn.hoverChartIndex=v.index)}touch(h,v){let S,{chart:I,pinchDown:L=[]}=this;this.setHoverChartIndex(),(h=this.normalize(h)).touches.length===1?I.isInsidePlot(h.chartX-I.plotLeft,h.chartY-I.plotTop,{visiblePlotOnly:!0})&&!I.openMenu?(v&&this.runPointActions(h),h.type==="touchmove"&&(S=!!L[0]&&Math.pow(L[0].chartX-h.chartX,2)+Math.pow(L[0].chartY-h.chartY,2)>=16),bo(S,!0)&&this.pinch(h)):v&&this.reset():h.touches.length===2&&this.pinch(h)}touchSelect(h){return!!(this.chart.zooming.singleTouch&&h.touches&&h.touches.length===1)}zoomOption(h){let v=this.chart,S=v.inverted,I=v.zooming.type||"",L,z;/touch/.test(h.type)&&(I=bo(v.zooming.pinchType,I)),this.zoomX=L=/x/.test(I),this.zoomY=z=/y/.test(I),this.zoomHor=L&&!S||z&&S,this.zoomVert=z&&!S||L&&S,this.hasZoom=L||z}}Vn.unbindDocumentMouseUp=[],function(Y){Y.compose=function(h){_p(Na,"Core.Pointer")&&Ss(h,"beforeRender",function(){this.pointer=new Y(this,this.options)})}}(Vn||(Vn={}));let _c=Vn,{fireEvent:yc,isArray:Ht,objectEach:li,uniqueKey:Ka}=Bi,on=class{constructor(Y={}){this.autoId=!Y.id,this.columns={},this.id=Y.id||Ka(),this.modified=this,this.rowCount=0,this.versionTag=Ka();let h=0;li(Y.columns||{},(v,S)=>{this.columns[S]=v.slice(),h=Math.max(h,v.length)}),this.applyRowCount(h)}applyRowCount(Y){this.rowCount=Y,li(this.columns,h=>{Ht(h)&&(h.length=Y)})}getColumn(Y,h){return this.columns[Y]}getColumns(Y,h){return(Y||Object.keys(this.columns)).reduce((v,S)=>(v[S]=this.columns[S],v),{})}getRow(Y,h){return(h||Object.keys(this.columns)).map(v=>{var S;return(S=this.columns[v])==null?void 0:S[Y]})}setColumn(Y,h=[],v=0,S){this.setColumns({[Y]:h},v,S)}setColumns(Y,h,v){let S=this.rowCount;li(Y,(I,L)=>{this.columns[L]=I.slice(),S=I.length}),this.applyRowCount(S),v!=null&&v.silent||(yc(this,"afterSetColumns"),this.versionTag=Ka())}setRow(Y,h=this.rowCount,v,S){let{columns:I}=this,L=v?this.rowCount+1:h+1;li(Y,(z,B)=>{let U=I[B]||(S==null?void 0:S.addColumns)!==!1&&Array(L);U&&(v?U.splice(h,0,z):U[h]=z,I[B]=U)}),L>this.rowCount&&this.applyRowCount(L),S!=null&&S.silent||(yc(this,"afterSetRows"),this.versionTag=Ka())}},{extend:dt,merge:Vf,pick:uh}=Bi;(function(Y){function h(v,S,I){var ft,St;let L=this.legendItem=this.legendItem||{},{chart:z,options:B}=this,{baseline:U=0,symbolWidth:X,symbolHeight:te}=v,K=this.symbol||"circle",re=te/2,ue=z.renderer,ge=L.group,ye=U-Math.round((((ft=v.fontMetrics)==null?void 0:ft.b)||te)*(I?.4:.3)),xe={},_e,ze=B.marker,Re=0;if(z.styledMode||(xe["stroke-width"]=Math.min(B.lineWidth||0,24),B.dashStyle?xe.dashstyle=B.dashStyle:B.linecap==="square"||(xe["stroke-linecap"]="round")),L.line=ue.path().addClass("highcharts-graph").attr(xe).add(ge),I&&(L.area=ue.path().addClass("highcharts-area").add(ge)),xe["stroke-linecap"]&&(Re=Math.min(L.line.strokeWidth(),X)/2),X){let _t=[["M",Re,ye],["L",X-Re,ye]];L.line.attr({d:_t}),(St=L.area)==null||St.attr({d:[..._t,["L",X-Re,U],["L",Re,U]]})}if(ze&&ze.enabled!==!1&&X){let _t=Math.min(uh(ze.radius,re),re);K.indexOf("url")===0&&(ze=Vf(ze,{width:te,height:te}),_t=0),L.symbol=_e=ue.symbol(K,X/2-_t,ye-_t,2*_t,2*_t,dt({context:"legend"},ze)).addClass("highcharts-point").add(ge),_e.isMarker=!0}}Y.areaMarker=function(v,S){h.call(this,v,S,!0)},Y.lineMarker=h,Y.rectangle=function(v,S){let I=S.legendItem||{},L=v.options,z=v.symbolHeight,B=L.squareSymbol,U=B?z:v.symbolWidth;I.symbol=this.chart.renderer.rect(B?(v.symbolWidth-z)/2:0,v.baseline-z+1,U,z,uh(v.options.symbolRadius,z/2)).addClass("highcharts-point").attr({zIndex:3}).add(I.group)}})(ve||(ve={}));let hd=ve,{defaultOptions:yp}=zn,{extend:Uf,extendClass:jf,merge:_u}=Bi;(function(Y){function h(v,S){let I=yp.plotOptions||{},L=S.defaultOptions,z=S.prototype;return z.type=v,z.pointClass||(z.pointClass=Jo),!Y.seriesTypes[v]&&(L&&(I[v]=L),Y.seriesTypes[v]=S,!0)}Y.seriesTypes=Ne.seriesTypes,Y.registerSeriesType=h,Y.seriesType=function(v,S,I,L,z){let B=yp.plotOptions||{};if(S=S||"",B[v]=_u(B[S],I),delete Y.seriesTypes[v],h(v,jf(Y.seriesTypes[S]||function(){},L)),Y.seriesTypes[v].prototype.type=v,z){class U extends Jo{}Uf(U.prototype,z),Y.seriesTypes[v].prototype.pointClass=U}return Y.seriesTypes[v]}})(Ae||(Ae={}));let Gn=Ae,{animObject:$f,setAnimation:Gf}=se,{defaultOptions:vc}=zn,{registerEventOptions:Il}=Fa,{svg:vp,win:xp}=Ne,{seriesTypes:ea}=Gn,{arrayMax:yu,arrayMin:ua,clamp:Va,correctFloat:bp,crisp:ms,defined:Ts,destroyObjectProperties:hh,diffObjects:en,erase:Ir,error:dh,extend:wo,find:vu,fireEvent:tn,getClosestDistance:dd,getNestedProperty:xu,insertItem:ha,isArray:Rs,isNumber:ls,isString:ph,merge:Dl,objectEach:fh,pick:ln,removeEvent:wp,syncTimeout:Ja}=Bi;class kl{constructor(){this.zoneAxis="y"}init(h,v){let S;tn(this,"init",{options:v}),this.dataTable??(this.dataTable=new on);let I=h.series;this.eventsToUnbind=[],this.chart=h,this.options=this.setOptions(v);let L=this.options,z=L.visible!==!1;this.linkedSeries=[],this.bindAxes(),wo(this,{name:L.name,state:"",visible:z,selected:L.selected===!0}),Il(this,L);let B=L.events;(B&&B.click||L.point&&L.point.events&&L.point.events.click||L.allowPointSelect)&&(h.runTrackerClick=!0),this.getColor(),this.getSymbol(),this.isCartesian&&(h.hasCartesianSeries=!0),I.length&&(S=I[I.length-1]),this._i=ln(S&&S._i,-1)+1,this.opacity=this.options.opacity,h.orderItems("series",ha(this,I)),L.dataSorting&&L.dataSorting.enabled?this.setDataSortingOptions():this.points||this.data||this.setData(L.data,!1),tn(this,"afterInit")}is(h){return ea[h]&&this instanceof ea[h]}bindAxes(){let h,v=this,S=v.options,I=v.chart;tn(this,"bindAxes",null,function(){(v.axisTypes||[]).forEach(function(L){(I[L]||[]).forEach(function(z){h=z.options,(ln(S[L],0)===z.index||S[L]!==void 0&&S[L]===h.id)&&(ha(v,z.series),v[L]=z,z.isDirty=!0)}),v[L]||v.optionalAxis===L||dh(18,!0,I)})}),tn(this,"afterBindAxes")}hasData(){return this.visible&&this.dataMax!==void 0&&this.dataMin!==void 0||this.visible&&this.dataTable.rowCount>0}hasMarkerChanged(h,v){let S=h.marker,I=v.marker||{};return S&&(I.enabled&&!S.enabled||I.symbol!==S.symbol||I.height!==S.height||I.width!==S.width)}autoIncrement(h){let v,S=this.options,{pointIntervalUnit:I,relativeXValue:L}=this.options,z=this.chart.time,B=this.xIncrement??z.parse(S.pointStart)??0;if(this.pointInterval=v=ln(this.pointInterval,S.pointInterval,1),L&&ls(h)&&(v*=h),I){let U=z.toParts(B);I==="day"?U[2]+=v:I==="month"?U[1]+=v:I==="year"&&(U[0]+=v),v=z.makeTime.apply(z,U)-B}return L&&ls(h)?B+v:(this.xIncrement=B+v,B)}setDataSortingOptions(){let h=this.options;wo(this,{requireSorting:!1,sorted:!1,enabledDataSorting:!0,allowDG:!1}),Ts(h.pointRange)||(h.pointRange=1)}setOptions(h){var xe,_e;let v,S=this.chart,I=S.options.plotOptions,L=S.userOptions||{},z=Dl(h),B=S.styledMode,U={plotOptions:I,userOptions:z};tn(this,"setOptions",U);let X=U.plotOptions[this.type],te=L.plotOptions||{},K=te.series||{},re=vc.plotOptions[this.type]||{},ue=te[this.type]||{};this.userOptions=U.userOptions;let ge=Dl(X,I.series,ue,z);this.tooltipOptions=Dl(vc.tooltip,(xe=vc.plotOptions.series)==null?void 0:xe.tooltip,re==null?void 0:re.tooltip,S.userOptions.tooltip,(_e=te.series)==null?void 0:_e.tooltip,ue.tooltip,z.tooltip),this.stickyTracking=ln(z.stickyTracking,ue.stickyTracking,K.stickyTracking,!!this.tooltipOptions.shared&&!this.noSharedTooltip||ge.stickyTracking),X.marker===null&&delete ge.marker,this.zoneAxis=ge.zoneAxis||"y";let ye=this.zones=(ge.zones||[]).map(ze=>({...ze}));return(ge.negativeColor||ge.negativeFillColor)&&!ge.zones&&(v={value:ge[this.zoneAxis+"Threshold"]||ge.threshold||0,className:"highcharts-negative"},B||(v.color=ge.negativeColor,v.fillColor=ge.negativeFillColor),ye.push(v)),ye.length&&Ts(ye[ye.length-1].value)&&ye.push(B?{}:{color:this.color,fillColor:this.fillColor}),tn(this,"afterSetOptions",{options:ge}),ge}getName(){return ln(this.options.name,"Series "+(this.index+1))}getCyclic(h,v,S){let I,L,z=this.chart,B=`${h}Index`,U=`${h}Counter`,X=(S==null?void 0:S.length)||z.options.chart.colorCount;!v&&(Ts(L=ln(h==="color"?this.options.colorIndex:void 0,this[B]))?I=L:(z.series.length||(z[U]=0),I=z[U]%X,z[U]+=1),S&&(v=S[I])),I!==void 0&&(this[B]=I),this[h]=v}getColor(){this.chart.styledMode?this.getCyclic("color"):this.options.colorByPoint?this.color="#cccccc":this.getCyclic("color",this.options.color||vc.plotOptions[this.type].color,this.chart.options.colors)}getPointsCollection(){return(this.hasGroupedData?this.points:this.data)||[]}getSymbol(){let h=this.options.marker;this.getCyclic("symbol",h.symbol,this.chart.options.symbols)}getColumn(h,v){return(v?this.dataTable.modified:this.dataTable).getColumn(h,!0)||[]}findPointIndex(h,v){let S,I,L,z=h.id,B=h.x,U=this.points,X=this.options.dataSorting;if(z){let te=this.chart.get(z);te instanceof Jo&&(S=te)}else if(this.linkedParent||this.enabledDataSorting||this.options.relativeXValue){let te=K=>!K.touched&&K.index===h.index;if(X&&X.matchByName?te=K=>!K.touched&&K.name===h.name:this.options.relativeXValue&&(te=K=>!K.touched&&K.options.x===h.x),!(S=vu(U,te)))return}return S&&(L=S&&S.index)!==void 0&&(I=!0),L===void 0&&ls(B)&&(L=this.getColumn("x").indexOf(B,v)),L!==-1&&L!==void 0&&this.cropped&&(L=L>=this.cropStart?L-this.cropStart:L),!I&&ls(L)&&U[L]&&U[L].touched&&(L=void 0),L}updateData(h,v){let S=this.options,I=S.dataSorting,L=this.points,z=[],B=this.requireSorting,U=h.length===L.length,X,te,K,re,ue=!0;if(this.xIncrement=null,h.forEach(function(ye,xe){let _e,ze=Ts(ye)&&this.pointClass.prototype.optionsToObject.call({series:this},ye)||{},Re=ze.x;ze.id||ls(Re)?((_e=this.findPointIndex(ze,re))===-1||_e===void 0?z.push(ye):L[_e]&&ye!==S.data[_e]?(L[_e].update(ye,!1,null,!1),L[_e].touched=!0,B&&(re=_e+1)):L[_e]&&(L[_e].touched=!0),(!U||xe!==_e||I&&I.enabled||this.hasDerivedData)&&(X=!0)):z.push(ye)},this),X)for(te=L.length;te--;)(K=L[te])&&!K.touched&&K.remove&&K.remove(!1,v);else!U||I&&I.enabled?ue=!1:(h.forEach(function(ye,xe){ye===L[xe].y||L[xe].destroyed||L[xe].update(ye,!1,null,!1)}),z.length=0);if(L.forEach(function(ye){ye&&(ye.touched=!1)}),!ue)return!1;z.forEach(function(ye){this.addPoint(ye,!1,null,null,!1)},this);let ge=this.getColumn("x");return this.xIncrement===null&&ge.length&&(this.xIncrement=yu(ge),this.autoIncrement()),!0}dataColumnKeys(){return["x",...this.pointArrayMap||["y"]]}setData(h,v=!0,S,I){var Ot,Pt;let L=this.points,z=L&&L.length||0,B=this.options,U=this.chart,X=B.dataSorting,te=this.xAxis,K=B.turboThreshold,re=this.dataTable,ue=this.dataColumnKeys(),ge=this.pointValKey||"y",ye=(this.pointArrayMap||[]).length,xe=B.keys,_e,ze,Re=0,ft=1,St;U.options.chart.allowMutatingData||(B.data&&delete this.options.data,this.userOptions.data&&delete this.userOptions.data,St=Dl(!0,h));let _t=(h=St||h||[]).length;if(X&&X.enabled&&(h=this.sortData(h)),U.options.chart.allowMutatingData&&I!==!1&&_t&&z&&!this.cropped&&!this.hasGroupedData&&this.visible&&!this.boosted&&(ze=this.updateData(h,S)),!ze){this.xIncrement=null,this.colorCounter=0;let Ft=K&&_t>K;if(Ft){let hi=this.getFirstValidPoint(h),mi=this.getFirstValidPoint(h,_t-1,-1),Ai=ai=>!!(Rs(ai)&&(xe||ls(ai[0])));if(ls(hi)&&ls(mi)){let ai=[],Ci=[];for(let Zi of h)ai.push(this.autoIncrement()),Ci.push(Zi);re.setColumns({x:ai,[ge]:Ci})}else if(Ai(hi)&&Ai(mi))if(ye){let ai=hi.length===ye?1:0,Ci=Array(ue.length).fill(0).map(()=>[]);for(let Zi of h){ai&&Ci[0].push(this.autoIncrement());for(let kr=ai;kr<=ye;kr++)(Ot=Ci[kr])==null||Ot.push(Zi[kr-ai])}re.setColumns(ue.reduce((Zi,kr,Hi)=>(Zi[kr]=Ci[Hi],Zi),{}))}else{xe&&(Re=xe.indexOf("x"),ft=xe.indexOf("y"),Re=Re>=0?Re:0,ft=ft>=0?ft:1),hi.length===1&&(ft=0);let ai=[],Ci=[];if(Re===ft)for(let Zi of h)ai.push(this.autoIncrement()),Ci.push(Zi[ft]);else for(let Zi of h)ai.push(Zi[Re]),Ci.push(Zi[ft]);re.setColumns({x:ai,[ge]:Ci})}else Ft=!1}if(!Ft){let hi=ue.reduce((mi,Ai)=>(mi[Ai]=[],mi),{});for(_e=0;_e<_t;_e++){let mi=this.pointClass.prototype.applyOptions.apply({series:this},[h[_e]]);for(let Ai of ue)hi[Ai][_e]=mi[Ai]}re.setColumns(hi)}for(ph(this.getColumn("y")[0])&&dh(14,!0,U),this.data=[],this.options.data=this.userOptions.data=h,_e=z;_e--;)(Pt=L[_e])==null||Pt.destroy();te&&(te.minRange=te.userMinRange),this.isDirty=U.isDirtyBox=!0,this.isDirtyData=!!L,S=!1}B.legendType==="point"&&(this.processData(),this.generatePoints()),v&&U.redraw(S)}sortData(h){let v=this,S=v.options.dataSorting.sortKey||"y",I=function(L,z){return Ts(z)&&L.pointClass.prototype.optionsToObject.call({series:L},z)||{}};return h.forEach(function(L,z){h[z]=I(v,L),h[z].index=z},this),h.concat().sort((L,z)=>{let B=xu(S,L),U=xu(S,z);return U<B?-1:U>B?1:0}).forEach(function(L,z){L.x=z},this),v.linkedSeries&&v.linkedSeries.forEach(function(L){let z=L.options,B=z.data;z.dataSorting&&z.dataSorting.enabled||!B||(B.forEach(function(U,X){B[X]=I(L,U),h[X]&&(B[X].x=h[X].x,B[X].index=X)}),L.setData(B,!1))}),h}getProcessedData(h){let v=this,{dataTable:S,isCartesian:I,options:L,xAxis:z}=v,B=L.cropThreshold,U=h||v.getExtremesFromAll,X=z==null?void 0:z.logarithmic,te=S.rowCount,K,re,ue=0,ge,ye,xe,_e=v.getColumn("x"),ze=S,Re=!1;return z&&(ye=(ge=z.getExtremes()).min,xe=ge.max,Re=!!(z.categories&&!z.names.length),I&&v.sorted&&!U&&(!B||te>B||v.forceCrop)&&(_e[te-1]<ye||_e[0]>xe?ze=new on:v.getColumn(v.pointValKey||"y").length&&(_e[0]<ye||_e[te-1]>xe)&&(ze=(K=this.cropData(S,ye,xe)).modified,ue=K.start,re=!0))),_e=ze.getColumn("x")||[],{modified:ze,cropped:re,cropStart:ue,closestPointRange:dd([X?_e.map(X.log2lin):_e],()=>v.requireSorting&&!Re&&dh(15,!1,v.chart))}}processData(h){let v=this.xAxis,S=this.dataTable;if(this.isCartesian&&!this.isDirty&&!v.isDirty&&!this.yAxis.isDirty&&!h)return!1;let I=this.getProcessedData();S.modified=I.modified,this.cropped=I.cropped,this.cropStart=I.cropStart,this.closestPointRange=this.basePointRange=I.closestPointRange,tn(this,"afterProcessData")}cropData(h,v,S){let I=h.getColumn("x",!0)||[],L=I.length,z={},B,U,X=0,te=L;for(B=0;B<L;B++)if(I[B]>=v){X=Math.max(0,B-1);break}for(U=B;U<L;U++)if(I[U]>S){te=U+1;break}for(let K of this.dataColumnKeys()){let re=h.getColumn(K,!0);re&&(z[K]=re.slice(X,te))}return{modified:new on({columns:z}),start:X,end:te}}generatePoints(){var St,_t;let h=this.options,v=this.processedData||h.data,S=this.dataTable.modified,I=this.getColumn("x",!0),L=this.pointClass,z=S.rowCount,B=this.cropStart||0,U=this.hasGroupedData,X=h.keys,te=[],K=h.dataGrouping&&h.dataGrouping.groupAll?B:0,re=(St=this.xAxis)==null?void 0:St.categories,ue=this.pointArrayMap||["y"],ge=this.dataColumnKeys(),ye,xe,_e,ze,Re=this.data,ft;if(!Re&&!U){let Ot=[];Ot.length=(v==null?void 0:v.length)||0,Re=this.data=Ot}for(X&&U&&(this.options.keys=!1),ze=0;ze<z;ze++)xe=B+ze,U?((_e=new L(this,S.getRow(ze,ge)||[])).dataGroup=this.groupMap[K+ze],(_t=_e.dataGroup)!=null&&_t.options&&(_e.options=_e.dataGroup.options,wo(_e,_e.dataGroup.options),delete _e.dataLabels)):(_e=Re[xe],ft=v?v[xe]:S.getRow(ze,ue),_e||ft===void 0||(Re[xe]=_e=new L(this,ft,I[ze]))),_e&&(_e.index=U?K+ze:xe,te[ze]=_e,_e.category=(re==null?void 0:re[_e.x])??_e.x,_e.key=_e.name??_e.category);if(this.options.keys=X,Re&&(z!==(ye=Re.length)||U))for(ze=0;ze<ye;ze++)ze!==B||U||(ze+=z),Re[ze]&&(Re[ze].destroyElements(),Re[ze].plotX=void 0);this.data=Re,this.points=te,tn(this,"afterGeneratePoints")}getXExtremes(h){return{min:ua(h),max:yu(h)}}getExtremes(h,v){var St;let{xAxis:S,yAxis:I}=this,L=v||this.getExtremesFromAll||this.options.getExtremesFromAll,z=L&&this.cropped?this.dataTable:this.dataTable.modified,B=z.rowCount,U=h||this.stackedYData,X=U?[U]:((St=this.keysAffectYAxis||this.pointArrayMap||["y"])==null?void 0:St.map(_t=>z.getColumn(_t,!0)||[]))||[],te=this.getColumn("x",!0),K=[],re=this.requireSorting&&!this.is("column")?1:0,ue=!!I&&I.positiveValuesOnly,ge=L||this.cropped||!S,ye,xe,_e,ze=0,Re=0;for(S&&(ze=(ye=S.getExtremes()).min,Re=ye.max),_e=0;_e<B;_e++)if(xe=te[_e],ge||(te[_e+re]||xe)>=ze&&(te[_e-re]||xe)<=Re)for(let _t of X){let Ot=_t[_e];ls(Ot)&&(Ot>0||!ue)&&K.push(Ot)}let ft={activeYData:K,dataMin:ua(K),dataMax:yu(K)};return tn(this,"afterGetExtremes",{dataExtremes:ft}),ft}applyExtremes(){let h=this.getExtremes();return this.dataMin=h.dataMin,this.dataMax=h.dataMax,h}getFirstValidPoint(h,v=0,S=1){let I=h.length,L=v;for(;L>=0&&L<I;){if(Ts(h[L]))return h[L];L+=S}}translate(){var ze;this.generatePoints();let h=this.options,v=h.stacking,S=this.xAxis,I=this.enabledDataSorting,L=this.yAxis,z=this.points,B=z.length,U=this.pointPlacementToXValue(),X=!!U,te=h.threshold,K=h.startFromThreshold?te:0,re,ue,ge,ye,xe=Number.MAX_VALUE;function _e(Re){return Va(Re,-1e9,1e9)}for(re=0;re<B;re++){let Re,ft=z[re],St=ft.x,_t,Ot,Pt=ft.y,Ft=ft.low,hi=v&&((ze=L.stacking)==null?void 0:ze.stacks[(this.negStacks&&Pt<(K?0:te)?"-":"")+this.stackKey]);ue=S.translate(St,!1,!1,!1,!0,U),ft.plotX=ls(ue)?bp(_e(ue)):void 0,v&&this.visible&&hi&&hi[St]&&(ye=this.getStackIndicator(ye,St,this.index),!ft.isNull&&ye.key&&(Ot=(_t=hi[St]).points[ye.key]),_t&&Rs(Ot)&&(Ft=Ot[0],Pt=Ot[1],Ft===K&&ye.key===hi[St].base&&(Ft=ln(ls(te)?te:L.min)),L.positiveValuesOnly&&Ts(Ft)&&Ft<=0&&(Ft=void 0),ft.total=ft.stackTotal=ln(_t.total),ft.percentage=Ts(ft.y)&&_t.total?ft.y/_t.total*100:void 0,ft.stackY=Pt,this.irregularWidths||_t.setOffset(this.pointXOffset||0,this.barW||0,void 0,void 0,void 0,this.xAxis))),ft.yBottom=Ts(Ft)?_e(L.translate(Ft,!1,!0,!1,!0)):void 0,this.dataModify&&(Pt=this.dataModify.modifyValue(Pt,re)),ls(Pt)&&ft.plotX!==void 0&&(Re=ls(Re=L.translate(Pt,!1,!0,!1,!0))?_e(Re):void 0),ft.plotY=Re,ft.isInside=this.isPointInside(ft),ft.clientX=X?bp(S.translate(St,!1,!1,!1,!0,U)):ue,ft.negative=(ft.y||0)<(te||0),ft.isNull||ft.visible===!1||(ge!==void 0&&(xe=Math.min(xe,Math.abs(ue-ge))),ge=ue),ft.zone=this.zones.length?ft.getZone():void 0,!ft.graphic&&this.group&&I&&(ft.isNew=!0)}this.closestPointRangePx=xe,tn(this,"afterTranslate")}getValidPoints(h,v,S){let I=this.chart;return(h||this.points||[]).filter(function(L){let{plotX:z,plotY:B}=L;return!!((S||!L.isNull&&ls(B))&&(!v||I.isInsidePlot(z,B,{inverted:I.inverted})))&&L.visible!==!1})}getClipBox(){let{chart:h,xAxis:v,yAxis:S}=this,{x:I,y:L,width:z,height:B}=Dl(h.clipBox);return v&&v.len!==h.plotSizeX&&(z=v.len),S&&S.len!==h.plotSizeY&&(B=S.len),h.inverted&&!this.invertible&&([z,B]=[B,z]),{x:I,y:L,width:z,height:B}}getSharedClipKey(){return this.sharedClipKey=(this.options.xAxis||0)+","+(this.options.yAxis||0),this.sharedClipKey}setClip(){let{chart:h,group:v,markerGroup:S}=this,I=h.sharedClips,L=h.renderer,z=this.getClipBox(),B=this.getSharedClipKey(),U=I[B];U?U.animate(z):I[B]=U=L.clipRect(z),v&&v.clip(this.options.clip===!1?void 0:U),S&&S.clip()}animate(h){let{chart:v,group:S,markerGroup:I}=this,L=v.inverted,z=$f(this.options.animation),B=[this.getSharedClipKey(),z.duration,z.easing,z.defer].join(","),U=v.sharedClips[B],X=v.sharedClips[B+"m"];if(h&&S){let te=this.getClipBox();if(U)U.attr("height",te.height);else{te.width=0,L&&(te.x=v.plotHeight),U=v.renderer.clipRect(te),v.sharedClips[B]=U;let K={x:-99,y:-99,width:L?v.plotWidth+199:99,height:L?99:v.plotHeight+199};X=v.renderer.clipRect(K),v.sharedClips[B+"m"]=X}S.clip(U),I==null||I.clip(X)}else if(U&&!U.hasClass("highcharts-animating")){let te=this.getClipBox(),K=z.step;(I!=null&&I.element.childNodes.length||v.series.length>1)&&(z.step=function(re,ue){K&&K.apply(ue,arguments),ue.prop==="width"&&(X!=null&&X.element)&&X.attr(L?"height":"width",re+99)}),U.addClass("highcharts-animating").animate(te,z)}}afterAnimate(){this.setClip(),fh(this.chart.sharedClips,(h,v,S)=>{h&&!this.chart.container.querySelector(`[clip-path="url(#${h.id})"]`)&&(h.destroy(),delete S[v])}),this.finishedAnimating=!0,tn(this,"afterAnimate")}drawPoints(h=this.points){let v,S,I,L,z,B,U,X=this.chart,te=X.styledMode,{colorAxis:K,options:re}=this,ue=re.marker,ge=this[this.specialGroup||"markerGroup"],ye=this.xAxis,xe=ln(ue.enabled,!ye||!!ye.isRadial||null,this.closestPointRangePx>=ue.enabledThreshold*ue.radius);if(ue.enabled!==!1||this._hasPointMarkers)for(v=0;v<h.length;v++)if(L=(I=(S=h[v]).graphic)?"animate":"attr",z=S.marker||{},B=!!S.marker,(xe&&z.enabled===void 0||z.enabled)&&!S.isNull&&S.visible!==!1){let _e=ln(z.symbol,this.symbol,"rect");U=this.markerAttribs(S,S.selected&&"select"),this.enabledDataSorting&&(S.startXPos=ye.reversed?-(U.width||0):ye.width);let ze=S.isInside!==!1;if(!I&&ze&&((U.width||0)>0||S.hasImage)&&(S.graphic=I=X.renderer.symbol(_e,U.x,U.y,U.width,U.height,B?z:ue).add(ge),this.enabledDataSorting&&X.hasRendered&&(I.attr({x:S.startXPos}),L="animate")),I&&L==="animate"&&I[ze?"show":"hide"](ze).animate(U),I){let Re=this.pointAttribs(S,te||!S.selected?void 0:"select");te?K&&I.css({fill:Re.fill}):I[L](Re)}I&&I.addClass(S.getClassName(),!0)}else I&&(S.graphic=I.destroy())}markerAttribs(h,v){let S=this.options,I=S.marker,L=h.marker||{},z=L.symbol||I.symbol,B={},U,X,te=ln(L.radius,I&&I.radius);v&&(U=I.states[v],te=ln((X=L.states&&L.states[v])&&X.radius,U&&U.radius,te&&te+(U&&U.radiusPlus||0))),h.hasImage=z&&z.indexOf("url")===0,h.hasImage&&(te=0);let K=h.pos();return ls(te)&&K&&(S.crisp&&(K[0]=ms(K[0],h.hasImage?0:z==="rect"?(I==null?void 0:I.lineWidth)||0:1)),B.x=K[0]-te,B.y=K[1]-te),te&&(B.width=B.height=2*te),B}pointAttribs(h,v){let S=this.options.marker,I=h&&h.options,L=I&&I.marker||{},z=I&&I.color,B=h&&h.color,U=h&&h.zone&&h.zone.color,X,te,K=this.color,re,ue,ge=ln(L.lineWidth,S.lineWidth),ye=1;return K=z||U||B||K,re=L.fillColor||S.fillColor||K,ue=L.lineColor||S.lineColor||K,v=v||"normal",X=S.states[v]||{},ge=ln((te=L.states&&L.states[v]||{}).lineWidth,X.lineWidth,ge+ln(te.lineWidthPlus,X.lineWidthPlus,0)),re=te.fillColor||X.fillColor||re,{stroke:ue=te.lineColor||X.lineColor||ue,"stroke-width":ge,fill:re,opacity:ye=ln(te.opacity,X.opacity,ye)}}destroy(h){let v,S,I,L=this,z=L.chart,B=/AppleWebKit\/533/.test(xp.navigator.userAgent),U=L.data||[];for(tn(L,"destroy",{keepEventsForUpdate:h}),this.removeEvents(h),(L.axisTypes||[]).forEach(function(X){(I=L[X])&&I.series&&(Ir(I.series,L),I.isDirty=I.forceRedraw=!0)}),L.legendItem&&L.chart.legend.destroyItem(L),v=U.length;v--;)(S=U[v])&&S.destroy&&S.destroy();for(let X of L.zones)hh(X,void 0,!0);Bi.clearTimeout(L.animationTimeout),fh(L,function(X,te){X instanceof _o&&!X.survive&&X[B&&te==="group"?"hide":"destroy"]()}),z.hoverSeries===L&&(z.hoverSeries=void 0),Ir(z.series,L),z.orderItems("series"),fh(L,function(X,te){h&&te==="hcEvents"||delete L[te]})}applyZones(){let{area:h,chart:v,graph:S,zones:I,points:L,xAxis:z,yAxis:B,zoneAxis:U}=this,{inverted:X,renderer:te}=v,K=this[`${U}Axis`],{isXAxis:re,len:ue=0,minPointOffset:ge=0}=K||{},ye=((S==null?void 0:S.strokeWidth())||0)/2+1,xe=(_e,ze=0,Re=0)=>{X&&(Re=ue-Re);let{translated:ft=0,lineClip:St}=_e,_t=Re-ft;St==null||St.push(["L",ze,Math.abs(_t)<ye?Re-ye*(_t<=0?-1:1):ft])};if(I.length&&(S||h)&&K&&ls(K.min)){let _e=K.getExtremes().max+ge,ze=St=>{St.forEach((_t,Ot)=>{(_t[0]==="M"||_t[0]==="L")&&(St[Ot]=[_t[0],re?ue-_t[1]:_t[1],re?_t[2]:ue-_t[2]])})};if(I.forEach(St=>{St.lineClip=[],St.translated=Va(K.toPixels(ln(St.value,_e),!0)||0,0,ue)}),S&&!this.showLine&&S.hide(),h&&h.hide(),U==="y"&&L.length<z.len)for(let St of L){let{plotX:_t,plotY:Ot,zone:Pt}=St,Ft=Pt&&I[I.indexOf(Pt)-1];Pt&&xe(Pt,_t,Ot),Ft&&xe(Ft,_t,Ot)}let Re=[],ft=K.toPixels(K.getExtremes().min-ge,!0);I.forEach(St=>{var kr,Hi;let _t=St.lineClip||[],Ot=Math.round(St.translated||0);z.reversed&&_t.reverse();let{clip:Pt,simpleClip:Ft}=St,hi=0,mi=0,Ai=z.len,ai=B.len;re?(hi=Ot,Ai=ft):(mi=Ot,ai=ft);let Ci=[["M",hi,mi],["L",Ai,mi],["L",Ai,ai],["L",hi,ai],["Z"]],Zi=[Ci[0],..._t,Ci[1],Ci[2],...Re,Ci[3],Ci[4]];Re=_t.reverse(),ft=Ot,X&&(ze(Zi),h&&ze(Ci)),Pt?(Pt.animate({d:Zi}),Ft==null||Ft.animate({d:Ci})):(Pt=St.clip=te.path(Zi),h&&(Ft=St.simpleClip=te.path(Ci))),S&&((kr=St.graph)==null||kr.clip(Pt)),h&&((Hi=St.area)==null||Hi.clip(Ft))})}else this.visible&&(S&&S.show(),h&&h.show())}plotGroup(h,v,S,I,L){let z=this[h],B=!z,U={visibility:S,zIndex:I||.1};return Ts(this.opacity)&&!this.chart.styledMode&&this.state!=="inactive"&&(U.opacity=this.opacity),z||(this[h]=z=this.chart.renderer.g().add(L)),z.addClass("highcharts-"+v+" highcharts-series-"+this.index+" highcharts-"+this.type+"-series "+(Ts(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(z.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0),z.attr(U)[B?"attr":"animate"](this.getPlotBox(v)),z}getPlotBox(h){let v=this.xAxis,S=this.yAxis,I=this.chart,L=I.inverted&&!I.polar&&v&&this.invertible&&h==="series";return I.inverted&&(v=S,S=this.xAxis),{translateX:v?v.left:I.plotLeft,translateY:S?S.top:I.plotTop,rotation:L?90:0,rotationOriginX:L?(v.len-S.len)/2:0,rotationOriginY:L?(v.len+S.len)/2:0,scaleX:L?-1:1,scaleY:1}}removeEvents(h){let{eventsToUnbind:v}=this;h||wp(this),v.length&&(v.forEach(S=>{S()}),v.length=0)}render(){var te,K,re,ue,ge;let h=this,{chart:v,options:S,hasRendered:I}=h,L=$f(S.animation),z=h.visible?"inherit":"hidden",B=S.zIndex,U=v.seriesGroup,X=h.finishedAnimating?0:L.duration;tn(this,"render"),h.plotGroup("group","series",z,B,U),h.markerGroup=h.plotGroup("markerGroup","markers",z,B,U),S.clip!==!1&&h.setClip(),X&&((te=h.animate)==null||te.call(h,!0)),h.drawGraph&&(h.drawGraph(),h.applyZones()),h.visible&&h.drawPoints(),(K=h.drawDataLabels)==null||K.call(h),(re=h.redrawPoints)==null||re.call(h),S.enableMouseTracking&&((ue=h.drawTracker)==null||ue.call(h)),X&&((ge=h.animate)==null||ge.call(h)),I||(X&&L.defer&&(X+=L.defer),h.animationTimeout=Ja(()=>{h.afterAnimate()},X||0)),h.isDirty=!1,h.hasRendered=!0,tn(h,"afterRender")}redraw(){let h=this.isDirty||this.isDirtyData;this.translate(),this.render(),h&&delete this.kdTree}reserveSpace(){return this.visible||!this.chart.options.chart.ignoreHiddenSeries}searchPoint(h,v){let{xAxis:S,yAxis:I}=this,L=this.chart.inverted;return this.searchKDTree({clientX:L?S.len-h.chartY+S.pos:h.chartX-S.pos,plotY:L?I.len-h.chartX+I.pos:h.chartY-I.pos},v,h)}buildKDTree(h){this.buildingKdTree=!0;let v=this,S=v.options.findNearestPointBy.indexOf("y")>-1?2:1;delete v.kdTree,Ja(function(){v.kdTree=function I(L,z,B){let U,X,te=L==null?void 0:L.length;if(te)return U=v.kdAxisArray[z%B],L.sort((K,re)=>(K[U]||0)-(re[U]||0)),{point:L[X=Math.floor(te/2)],left:I(L.slice(0,X),z+1,B),right:I(L.slice(X+1),z+1,B)}}(v.getValidPoints(void 0,!v.directTouch),S,S),v.buildingKdTree=!1},v.options.kdNow||(h==null?void 0:h.type)==="touchstart"?0:1)}searchKDTree(h,v,S,I,L){let z=this,[B,U]=this.kdAxisArray,X=v?"distX":"dist",te=(z.options.findNearestPointBy||"").indexOf("y")>-1?2:1,K=!!z.isBubble,re=I||((ge,ye,xe)=>[(ge[xe]||0)<(ye[xe]||0)?ge:ye,!1]),ue=L||((ge,ye)=>ge<ye);if(this.kdTree||this.buildingKdTree||this.buildKDTree(S),this.kdTree)return function ge(ye,xe,_e,ze){var hi;let Re=xe.point,ft=z.kdAxisArray[_e%ze],St=Re,_t=!1;(function(mi,Ai){var Qi;let ai=mi[B],Ci=Ai[B],Zi=Ts(ai)&&Ts(Ci)?ai-Ci:null,kr=mi[U],Hi=Ai[U],gr=Ts(kr)&&Ts(Hi)?kr-Hi:0,Vi=K&&((Qi=Ai.marker)==null?void 0:Qi.radius)||0;Ai.dist=Math.sqrt((Zi&&Zi*Zi||0)+gr*gr)-Vi,Ai.distX=Ts(Zi)?Math.abs(Zi)-Vi:Number.MAX_VALUE})(ye,Re);let Ot=(ye[ft]||0)-(Re[ft]||0)+(K&&((hi=Re.marker)==null?void 0:hi.radius)||0),Pt=Ot<0?"left":"right",Ft=Ot<0?"right":"left";return xe[Pt]&&([St,_t]=re(Re,ge(ye,xe[Pt],_e+1,ze),X)),xe[Ft]&&ue(Math.sqrt(Ot*Ot),St[X],_t)&&(St=re(St,ge(ye,xe[Ft],_e+1,ze),X)[0]),St}(h,this.kdTree,te,te)}pointPlacementToXValue(){let{options:h,xAxis:v}=this,S=h.pointPlacement;return S==="between"&&(S=v.reversed?-.5:.5),ls(S)?S*(h.pointRange||v.pointRange):0}isPointInside(h){let{chart:v,xAxis:S,yAxis:I}=this,{plotX:L=-1,plotY:z=-1}=h;return z>=0&&z<=(I?I.len:v.plotHeight)&&L>=0&&L<=(S?S.len:v.plotWidth)}drawTracker(){var re;let h=this,v=h.options,S=v.trackByArea,I=[].concat((S?h.areaPath:h.graphPath)||[]),L=h.chart,z=L.pointer,B=L.renderer,U=((re=L.options.tooltip)==null?void 0:re.snap)||0,X=()=>{v.enableMouseTracking&&L.hoverSeries!==h&&h.onMouseOver()},te="rgba(192,192,192,"+(vp?1e-4:.002)+")",K=h.tracker;K?K.attr({d:I}):h.graph&&(h.tracker=K=B.path(I).attr({visibility:h.visible?"inherit":"hidden",zIndex:2}).addClass(S?"highcharts-tracker-area":"highcharts-tracker-line").add(h.group),L.styledMode||K.attr({"stroke-linecap":"round","stroke-linejoin":"round",stroke:te,fill:S?te:"none","stroke-width":h.graph.strokeWidth()+(S?0:2*U)}),[h.tracker,h.markerGroup,h.dataLabelsGroup].forEach(ue=>{ue&&(ue.addClass("highcharts-tracker").on("mouseover",X).on("mouseout",ge=>{z==null||z.onTrackerMouseOut(ge)}),v.cursor&&!L.styledMode&&ue.css({cursor:v.cursor}),ue.on("touchstart",X))})),tn(this,"afterDrawTracker")}addPoint(h,v,S,I,L){let z,B,U=this.options,{chart:X,data:te,dataTable:K,xAxis:re}=this,ue=re&&re.hasNames&&re.names,ge=U.data,ye=this.getColumn("x");v=ln(v,!0);let xe={series:this};this.pointClass.prototype.applyOptions.apply(xe,[h]);let _e=xe.x;if(B=ye.length,this.requireSorting&&_e<ye[B-1])for(z=!0;B&&ye[B-1]>_e;)B--;K.setRow(xe,B,!0,{addColumns:!1}),ue&&xe.name&&(ue[_e]=xe.name),ge==null||ge.splice(B,0,h),(z||this.processedData)&&(this.data.splice(B,0,null),this.processData()),U.legendType==="point"&&this.generatePoints(),S&&(te[0]&&te[0].remove?te[0].remove(!1):([te,ge,...Object.values(K.getColumns())].filter(Ts).forEach(ze=>{ze.shift()}),K.rowCount-=1,tn(K,"afterDeleteRows"))),L!==!1&&tn(this,"addPoint",{point:xe}),this.isDirty=!0,this.isDirtyData=!0,v&&X.redraw(I)}removePoint(h,v,S){let I=this,{chart:L,data:z,points:B,dataTable:U}=I,X=z[h],te=function(){[(B==null?void 0:B.length)===z.length?B:void 0,z,I.options.data,...Object.values(U.getColumns())].filter(Ts).forEach(K=>{K.splice(h,1)}),U.rowCount-=1,tn(U,"afterDeleteRows"),X==null||X.destroy(),I.isDirty=!0,I.isDirtyData=!0,v&&L.redraw()};Gf(S,L),v=ln(v,!0),X?X.firePointEvent("remove",null,te):te()}remove(h,v,S,I){let L=this,z=L.chart;function B(){L.destroy(I),z.isDirtyLegend=z.isDirtyBox=!0,z.linkSeries(I),ln(h,!0)&&z.redraw(v)}S!==!1?tn(L,"remove",null,B):B()}update(h,v){var _e,ze;tn(this,"update",{options:h=en(h,this.userOptions)});let S=this,I=S.chart,L=S.userOptions,z=S.initialType||S.type,B=I.options.plotOptions,U=ea[z].prototype,X=S.finishedAnimating&&{animation:!1},te={},K,re,ue=["colorIndex","eventOptions","navigatorSeries","symbolIndex","baseSeries"],ge=h.type||L.type||I.options.chart.type,ye=!(this.hasDerivedData||ge&&ge!==this.type||h.keys!==void 0||h.pointStart!==void 0||h.pointInterval!==void 0||h.relativeXValue!==void 0||h.joinBy||h.mapData||["dataGrouping","pointStart","pointInterval","pointIntervalUnit","keys"].some(Re=>S.hasOptionChanged(Re)));ge=ge||z,ye?(ue.push("data","isDirtyData","isDirtyCanvas","points","dataTable","processedData","xIncrement","cropped","_hasPointMarkers","hasDataLabels","nodes","layout","level","mapMap","mapData","minY","maxY","minX","maxX","transformGroups"),h.visible!==!1&&ue.push("area","graph"),S.parallelArrays.forEach(function(Re){ue.push(Re+"Data")}),h.data&&(h.dataSorting&&wo(S.options.dataSorting,h.dataSorting),this.setData(h.data,!1))):this.dataTable.modified=this.dataTable,h=Dl(L,{index:L.index===void 0?S.index:L.index,pointStart:((_e=B==null?void 0:B.series)==null?void 0:_e.pointStart)??L.pointStart??S.getColumn("x")[0]},!ye&&{data:S.options.data},h,X),ye&&h.data&&(h.data=S.options.data),(ue=["group","markerGroup","dataLabelsGroup","transformGroup"].concat(ue)).forEach(function(Re){ue[Re]=S[Re],delete S[Re]});let xe=!1;if(ea[ge]){if(xe=ge!==S.type,S.remove(!1,!1,!1,!0),xe)if(I.propFromSeries(),Object.setPrototypeOf)Object.setPrototypeOf(S,ea[ge].prototype);else{let Re=Object.hasOwnProperty.call(S,"hcEvents")&&S.hcEvents;for(re in U)S[re]=void 0;wo(S,ea[ge].prototype),Re?S.hcEvents=Re:delete S.hcEvents}}else dh(17,!0,I,{missingModuleFor:ge});if(ue.forEach(function(Re){S[Re]=ue[Re]}),S.init(I,h),ye&&this.points)for(let Re of((K=S.options).visible===!1?(te.graphic=1,te.dataLabel=1):(this.hasMarkerChanged(K,L)&&(te.graphic=1),(ze=S.hasDataLabels)!=null&&ze.call(S)||(te.dataLabel=1)),this.points))Re&&Re.series&&(Re.resolveColor(),Object.keys(te).length&&Re.destroyElements(te),K.showInLegend===!1&&Re.legendItem&&I.legend.destroyItem(Re));S.initialType=z,I.linkSeries(),I.setSortedData(),xe&&S.linkedSeries.length&&(S.isDirtyData=!0),tn(this,"afterUpdate"),ln(v,!0)&&I.redraw(!!ye&&void 0)}setName(h){this.name=this.options.name=this.userOptions.name=h,this.chart.isDirtyLegend=!0}hasOptionChanged(h){var B,U;let v=this.chart,S=this.options[h],I=v.options.plotOptions,L=this.userOptions[h],z=ln((B=I==null?void 0:I[this.type])==null?void 0:B[h],(U=I==null?void 0:I.series)==null?void 0:U[h]);return L&&!Ts(z)?S!==L:S!==ln(z,S)}onMouseOver(){let h=this.chart,v=h.hoverSeries,S=h.pointer;S==null||S.setHoverChartIndex(),v&&v!==this&&v.onMouseOut(),this.options.events.mouseOver&&tn(this,"mouseOver"),this.setState("hover"),h.hoverSeries=this}onMouseOut(){let h=this.options,v=this.chart,S=v.tooltip,I=v.hoverPoint;v.hoverSeries=null,I&&I.onMouseOut(),this&&h.events.mouseOut&&tn(this,"mouseOut"),S&&!this.stickyTracking&&(!S.shared||this.noSharedTooltip)&&S.hide(),v.series.forEach(function(L){L.setState("",!0)})}setState(h,v){let S=this,I=S.options,L=S.graph,z=I.inactiveOtherPoints,B=I.states,U=ln(B[h||"normal"]&&B[h||"normal"].animation,S.chart.options.chart.animation),X=I.lineWidth,te=I.opacity;if(h=h||"",S.state!==h&&([S.group,S.markerGroup,S.dataLabelsGroup].forEach(function(K){K&&(S.state&&K.removeClass("highcharts-series-"+S.state),h&&K.addClass("highcharts-series-"+h))}),S.state=h,!S.chart.styledMode)){if(B[h]&&B[h].enabled===!1)return;if(h&&(X=B[h].lineWidth||X+(B[h].lineWidthPlus||0),te=ln(B[h].opacity,te)),L&&!L.dashstyle&&ls(X))for(let K of[L,...this.zones.map(re=>re.graph)])K==null||K.animate({"stroke-width":X},U);z||[S.group,S.markerGroup,S.dataLabelsGroup,S.labelBySeries].forEach(function(K){K&&K.animate({opacity:te},U)})}v&&z&&S.points&&S.setAllPointsToState(h||void 0)}setAllPointsToState(h){this.points.forEach(function(v){v.setState&&v.setState(h)})}setVisible(h,v){var U;let S=this,I=S.chart,L=I.options.chart.ignoreHiddenSeries,z=S.visible;S.visible=h=S.options.visible=S.userOptions.visible=h===void 0?!z:h;let B=h?"show":"hide";["group","dataLabelsGroup","markerGroup","tracker","tt"].forEach(X=>{var te;(te=S[X])==null||te[B]()}),(I.hoverSeries===S||((U=I.hoverPoint)==null?void 0:U.series)===S)&&S.onMouseOut(),S.legendItem&&I.legend.colorizeItem(S,h),S.isDirty=!0,S.options.stacking&&I.series.forEach(X=>{X.options.stacking&&X.visible&&(X.isDirty=!0)}),S.linkedSeries.forEach(X=>{X.setVisible(h,!1)}),L&&(I.isDirtyBox=!0),tn(S,B),v!==!1&&I.redraw()}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}select(h){this.selected=h=this.options.selected=h===void 0?!this.selected:h,this.checkbox&&(this.checkbox.checked=h),tn(this,h?"select":"unselect")}shouldShowTooltip(h,v,S={}){return S.series=this,S.visiblePlotOnly=!0,this.chart.isInsidePlot(h,v,S)}drawLegendSymbol(h,v){var S;(S=hd[this.options.legendSymbol||"rectangle"])==null||S.call(this,h,v)}}kl.defaultOptions={lineWidth:2,allowPointSelect:!1,crisp:!0,showCheckbox:!1,animation:{duration:1e3},enableMouseTracking:!0,events:{},marker:{enabledThreshold:2,lineColor:"#ffffff",lineWidth:0,radius:4,states:{normal:{animation:!0},hover:{animation:{duration:150},enabled:!0,radiusPlus:2,lineWidthPlus:1},select:{fillColor:"#cccccc",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{animation:{},align:"center",borderWidth:0,defer:!0,formatter:function(){let{numberFormatter:Y}=this.series.chart;return typeof this.y!="number"?"":Y(this.y,-1)},padding:5,style:{fontSize:"0.7em",fontWeight:"bold",color:"contrast",textOutline:"1px contrast"},verticalAlign:"bottom",x:0,y:0},cropThreshold:300,opacity:1,pointRange:0,softThreshold:!0,states:{normal:{animation:!0},hover:{animation:{duration:150},lineWidthPlus:1,marker:{},halo:{size:10,opacity:.25}},select:{animation:{duration:0}},inactive:{animation:{duration:150},opacity:.2}},stickyTracking:!0,turboThreshold:1e3,findNearestPointBy:"x"},kl.types=Gn.seriesTypes,kl.registerType=Gn.registerSeriesType,wo(kl.prototype,{axisTypes:["xAxis","yAxis"],coll:"series",colorCounter:0,directTouch:!1,invertible:!0,isCartesian:!0,kdAxisArray:["clientX","plotY"],parallelArrays:["x","y"],pointClass:Jo,requireSorting:!0,sorted:!0}),Gn.series=kl;let eo=kl,{animObject:Sp,setAnimation:Tp}=se,{registerEventOptions:gs}=Fa,{composed:Mp,marginNames:pd}=Ne,{distribute:mh}=qo,{format:Ol}=Po,{addEvent:xc,createElement:Ua,css:fd,defined:Ll,discardElement:Ep,find:Cp,fireEvent:Fo,isNumber:bu,merge:Qa,pick:oo,pushUnique:Hf,relativeLength:Ap,stableSort:gh,syncTimeout:Wf}=Bi;class md{constructor(h,v){this.allItems=[],this.initialItemY=0,this.itemHeight=0,this.itemMarginBottom=0,this.itemMarginTop=0,this.itemX=0,this.itemY=0,this.lastItemY=0,this.lastLineHeight=0,this.legendHeight=0,this.legendWidth=0,this.maxItemWidth=0,this.maxLegendWidth=0,this.offsetWidth=0,this.padding=0,this.pages=[],this.symbolHeight=0,this.symbolWidth=0,this.titleHeight=0,this.totalItemWidth=0,this.widthOption=0,this.chart=h,this.setOptions(v),v.enabled&&(this.render(),gs(this,v),xc(this.chart,"endResize",function(){this.legend.positionCheckboxes()})),xc(this.chart,"render",()=>{this.options.enabled&&this.proximate&&(this.proximatePositions(),this.positionItems())})}setOptions(h){let v=oo(h.padding,8);this.options=h,this.chart.styledMode||(this.itemStyle=h.itemStyle,this.itemHiddenStyle=Qa(this.itemStyle,h.itemHiddenStyle)),this.itemMarginTop=h.itemMarginTop,this.itemMarginBottom=h.itemMarginBottom,this.padding=v,this.initialItemY=v-5,this.symbolWidth=oo(h.symbolWidth,16),this.pages=[],this.proximate=h.layout==="proximate"&&!this.chart.inverted,this.baseline=void 0}update(h,v){let S=this.chart;this.setOptions(Qa(!0,this.options,h)),"events"in this.options&&gs(this,this.options),this.destroy(),S.isDirtyLegend=S.isDirtyBox=!0,oo(v,!0)&&S.redraw(),Fo(this,"afterUpdate",{redraw:v})}colorizeItem(h,v){var X;let S=h.color,{area:I,group:L,label:z,line:B,symbol:U}=h.legendItem||{};if((h instanceof eo||h instanceof Jo)&&(h.color=((X=h.options)==null?void 0:X.legendSymbolColor)||S),L==null||L[v?"removeClass":"addClass"]("highcharts-legend-item-hidden"),!this.chart.styledMode){let{itemHiddenStyle:te={}}=this,K=te.color,{fillColor:re,fillOpacity:ue,lineColor:ge,marker:ye}=h.options,xe=_e=>(!v&&(_e.fill&&(_e.fill=K),_e.stroke&&(_e.stroke=K)),_e);z==null||z.css(Qa(v?this.itemStyle:te)),B==null||B.attr(xe({stroke:ge||h.color})),U&&U.attr(xe(ye&&U.isMarker?h.pointAttribs():{fill:h.color})),I==null||I.attr(xe({fill:re||h.color,"fill-opacity":re?1:ue??.75}))}h.color=S,Fo(this,"afterColorizeItem",{item:h,visible:v})}positionItems(){this.allItems.forEach(this.positionItem,this),this.chart.isResizing||this.positionCheckboxes()}positionItem(h){let{group:v,x:S=0,y:I=0}=h.legendItem||{},L=this.options,z=L.symbolPadding,B=!L.rtl,U=h.checkbox;if(v&&v.element){let X={translateX:B?S:this.legendWidth-S-2*z-4,translateY:I};v[Ll(v.translateY)?"animate":"attr"](X,void 0,()=>{Fo(this,"afterPositionItem",{item:h})})}U&&(U.x=S,U.y=I)}destroyItem(h){let v=h.checkbox,S=h.legendItem||{};for(let I of["group","label","line","symbol"])S[I]&&(S[I]=S[I].destroy());v&&Ep(v),h.legendItem=void 0}destroy(){for(let h of this.getAllItems())this.destroyItem(h);for(let h of["clipRect","up","down","pager","nav","box","title","group"])this[h]&&(this[h]=this[h].destroy());this.display=null}positionCheckboxes(){let h,v=this.group&&this.group.alignAttr,S=this.clipHeight||this.legendHeight,I=this.titleHeight;v&&(h=v.translateY,this.allItems.forEach(function(L){let z,B=L.checkbox;B&&(z=h+I+B.y+(this.scrollOffset||0)+3,fd(B,{left:v.translateX+L.checkboxOffset+B.x-20+"px",top:z+"px",display:this.proximate||z>h-6&&z<h+S-6?"":"none"}))},this))}renderTitle(){let h=this.options,v=this.padding,S=h.title,I,L=0;S.text&&(this.title||(this.title=this.chart.renderer.label(S.text,v-3,v-4,void 0,void 0,void 0,h.useHTML,void 0,"legend-title").attr({zIndex:1}),this.chart.styledMode||this.title.css(S.style),this.title.add(this.group)),S.width||this.title.css({width:this.maxLegendWidth+"px"}),L=(I=this.title.getBBox()).height,this.offsetWidth=I.width,this.contentGroup.attr({translateY:L})),this.titleHeight=L}setText(h){let v=this.options;h.legendItem.label.attr({text:v.labelFormat?Ol(v.labelFormat,h,this.chart):v.labelFormatter.call(h)})}renderItem(h){let v=h.legendItem=h.legendItem||{},S=this.chart,I=S.renderer,L=this.options,z=L.layout==="horizontal",B=this.symbolWidth,U=L.symbolPadding||0,X=this.itemStyle,te=this.itemHiddenStyle,K=z?oo(L.itemDistance,20):0,re=!L.rtl,ue=!h.series,ge=!ue&&h.series.drawLegendSymbol?h.series:h,ye=ge.options,xe=!!this.createCheckboxForItem&&ye&&ye.showCheckbox,_e=L.useHTML,ze=h.options.className,Re=v.label,ft=B+U+K+(xe?20:0);!Re&&(v.group=I.g("legend-item").addClass("highcharts-"+ge.type+"-series highcharts-color-"+h.colorIndex+(ze?" "+ze:"")+(ue?" highcharts-series-"+h.index:"")).attr({zIndex:1}).add(this.scrollGroup),v.label=Re=I.text("",re?B+U:-U,this.baseline||0,_e),S.styledMode||Re.css(Qa(h.visible?X:te)),Re.attr({align:re?"left":"right",zIndex:2}).add(v.group),!this.baseline&&(this.fontMetrics=I.fontMetrics(Re),this.baseline=this.fontMetrics.f+3+this.itemMarginTop,Re.attr("y",this.baseline),this.symbolHeight=oo(L.symbolHeight,this.fontMetrics.f),L.squareSymbol&&(this.symbolWidth=oo(L.symbolWidth,Math.max(this.symbolHeight,16)),ft=this.symbolWidth+U+K+(xe?20:0),re&&Re.attr("x",this.symbolWidth+U))),ge.drawLegendSymbol(this,h),this.setItemEvents&&this.setItemEvents(h,Re,_e)),xe&&!h.checkbox&&this.createCheckboxForItem&&this.createCheckboxForItem(h),this.colorizeItem(h,h.visible),(S.styledMode||!X.width)&&Re.css({width:(L.itemWidth||this.widthOption||S.spacingBox.width)-ft+"px"}),this.setText(h);let St=Re.getBBox(),_t=this.fontMetrics&&this.fontMetrics.h||0;h.itemWidth=h.checkboxOffset=L.itemWidth||v.labelWidth||St.width+ft,this.maxItemWidth=Math.max(this.maxItemWidth,h.itemWidth),this.totalItemWidth+=h.itemWidth,this.itemHeight=h.itemHeight=Math.round(v.labelHeight||(St.height>1.5*_t?St.height:_t))}layoutItem(h){let v=this.options,S=this.padding,I=v.layout==="horizontal",L=h.itemHeight,z=this.itemMarginBottom,B=this.itemMarginTop,U=I?oo(v.itemDistance,20):0,X=this.maxLegendWidth,te=v.alignColumns&&this.totalItemWidth>X?this.maxItemWidth:h.itemWidth,K=h.legendItem||{};I&&this.itemX-S+te>X&&(this.itemX=S,this.lastLineHeight&&(this.itemY+=B+this.lastLineHeight+z),this.lastLineHeight=0),this.lastItemY=B+this.itemY+z,this.lastLineHeight=Math.max(L,this.lastLineHeight),K.x=this.itemX,K.y=this.itemY,I?this.itemX+=te:(this.itemY+=B+L+z,this.lastLineHeight=L),this.offsetWidth=this.widthOption||Math.max((I?this.itemX-S-(h.checkbox?0:U):te)+S,this.offsetWidth)}getAllItems(){let h=[];return this.chart.series.forEach(function(v){let S=v&&v.options;v&&oo(S.showInLegend,!Ll(S.linkedTo)&&void 0,!0)&&(h=h.concat((v.legendItem||{}).labels||(S.legendType==="point"?v.data:v)))}),Fo(this,"afterGetAllItems",{allItems:h}),h}getAlignment(){let h=this.options;return this.proximate?h.align.charAt(0)+"tv":h.floating?"":h.align.charAt(0)+h.verticalAlign.charAt(0)+h.layout.charAt(0)}adjustMargins(h,v){let S=this.chart,I=this.options,L=this.getAlignment();L&&[/(lth|ct|rth)/,/(rtv|rm|rbv)/,/(rbh|cb|lbh)/,/(lbv|lm|ltv)/].forEach(function(z,B){z.test(L)&&!Ll(h[B])&&(S[pd[B]]=Math.max(S[pd[B]],S.legend[(B+1)%2?"legendHeight":"legendWidth"]+[1,-1,-1,1][B]*I[B%2?"x":"y"]+oo(I.margin,12)+v[B]+(S.titleOffset[B]||0)))})}proximatePositions(){let h,v=this.chart,S=[],I=this.options.align==="left";for(let L of(this.allItems.forEach(function(z){let B,U,X=I,te,K;z.yAxis&&(z.xAxis.options.reversed&&(X=!X),z.points&&(B=Cp(X?z.points:z.points.slice(0).reverse(),function(re){return bu(re.plotY)})),U=this.itemMarginTop+z.legendItem.label.getBBox().height+this.itemMarginBottom,K=z.yAxis.top-v.plotTop,te=z.visible?(B?B.plotY:z.yAxis.height)+(K-.3*U):K+z.yAxis.height,S.push({target:te,size:U,item:z}))},this),mh(S,v.plotHeight)))h=L.item.legendItem||{},bu(L.pos)&&(h.y=v.plotTop-v.spacing[0]+L.pos)}render(){let h=this.chart,v=h.renderer,S=this.options,I=this.padding,L=this.getAllItems(),z,B,U,X=this.group,te,K=this.box;this.itemX=I,this.itemY=this.initialItemY,this.offsetWidth=0,this.lastItemY=0,this.widthOption=Ap(S.width,h.spacingBox.width-I),te=h.spacingBox.width-2*I-S.x,["rm","lm"].indexOf(this.getAlignment().substring(0,2))>-1&&(te/=2),this.maxLegendWidth=this.widthOption||te,X||(this.group=X=v.g("legend").addClass(S.className||"").attr({zIndex:7}).add(),this.contentGroup=v.g().attr({zIndex:1}).add(X),this.scrollGroup=v.g().add(this.contentGroup)),this.renderTitle(),gh(L,(re,ue)=>(re.options&&re.options.legendIndex||0)-(ue.options&&ue.options.legendIndex||0)),S.reversed&&L.reverse(),this.allItems=L,this.display=z=!!L.length,this.lastLineHeight=0,this.maxItemWidth=0,this.totalItemWidth=0,this.itemHeight=0,L.forEach(this.renderItem,this),L.forEach(this.layoutItem,this),B=(this.widthOption||this.offsetWidth)+I,U=this.lastItemY+this.lastLineHeight+this.titleHeight,U=this.handleOverflow(U)+I,K||(this.box=K=v.rect().addClass("highcharts-legend-box").attr({r:S.borderRadius}).add(X)),h.styledMode||K.attr({stroke:S.borderColor,"stroke-width":S.borderWidth||0,fill:S.backgroundColor||"none"}).shadow(S.shadow),B>0&&U>0&&K[K.placed?"animate":"attr"](K.crisp.call({},{x:0,y:0,width:B,height:U},K.strokeWidth())),X[z?"show":"hide"](),h.styledMode&&X.getStyle("display")==="none"&&(B=U=0),this.legendWidth=B,this.legendHeight=U,z&&this.align(),this.proximate||this.positionItems(),Fo(this,"afterRender")}align(h=this.chart.spacingBox){let v=this.chart,S=this.options,I=h.y;/(lth|ct|rth)/.test(this.getAlignment())&&v.titleOffset[0]>0?I+=v.titleOffset[0]:/(lbh|cb|rbh)/.test(this.getAlignment())&&v.titleOffset[2]>0&&(I-=v.titleOffset[2]),I!==h.y&&(h=Qa(h,{y:I})),v.hasRendered||(this.group.placed=!1),this.group.align(Qa(S,{width:this.legendWidth,height:this.legendHeight,verticalAlign:this.proximate?"top":S.verticalAlign}),!0,h)}handleOverflow(h){let v=this,S=this.chart,I=S.renderer,L=this.options,z=L.y,B=L.verticalAlign==="top",U=this.padding,X=L.maxHeight,te=L.navigation,K=oo(te.animation,!0),re=te.arrowSize||12,ue=this.pages,ge=this.allItems,ye=function(Ot){typeof Ot=="number"?_t.attr({height:Ot}):_t&&(v.clipRect=_t.destroy(),v.contentGroup.clip()),v.contentGroup.div&&(v.contentGroup.div.style.clip=Ot?"rect("+U+"px,9999px,"+(U+Ot)+"px,0)":"auto")},xe=function(Ot){return v[Ot]=I.circle(0,0,1.3*re).translate(re/2,re/2).add(St),S.styledMode||v[Ot].attr("fill","rgba(0,0,0,0.0001)"),v[Ot]},_e,ze,Re,ft=S.spacingBox.height+(B?-z:z)-U,St=this.nav,_t=this.clipRect;return L.layout!=="horizontal"||L.verticalAlign==="middle"||L.floating||(ft/=2),X&&(ft=Math.min(ft,X)),ue.length=0,h&&ft>0&&h>ft&&te.enabled!==!1?(this.clipHeight=_e=Math.max(ft-20-this.titleHeight-U,0),this.currentPage=oo(this.currentPage,1),this.fullHeight=h,ge.forEach((Ot,Pt)=>{let Ft=(Re=Ot.legendItem||{}).y||0,hi=Math.round(Re.label.getBBox().height),mi=ue.length;(!mi||Ft-ue[mi-1]>_e&&(ze||Ft)!==ue[mi-1])&&(ue.push(ze||Ft),mi++),Re.pageIx=mi-1,ze&&((ge[Pt-1].legendItem||{}).pageIx=mi-1),Pt===ge.length-1&&Ft+hi-ue[mi-1]>_e&&Ft>ue[mi-1]&&(ue.push(Ft),Re.pageIx=mi),Ft!==ze&&(ze=Ft)}),_t||(_t=v.clipRect=I.clipRect(0,U-2,9999,0),v.contentGroup.clip(_t)),ye(_e),St||(this.nav=St=I.g().attr({zIndex:1}).add(this.group),this.up=I.symbol("triangle",0,0,re,re).add(St),xe("upTracker").on("click",function(){v.scroll(-1,K)}),this.pager=I.text("",15,10).addClass("highcharts-legend-navigation"),!S.styledMode&&te.style&&this.pager.css(te.style),this.pager.add(St),this.down=I.symbol("triangle-down",0,0,re,re).add(St),xe("downTracker").on("click",function(){v.scroll(1,K)})),v.scroll(0),h=ft):St&&(ye(),this.nav=St.destroy(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0),h}scroll(h,v){let S=this.chart,I=this.pages,L=I.length,z=this.clipHeight,B=this.options.navigation,U=this.pager,X=this.padding,te=this.currentPage+h;te>L&&(te=L),te>0&&(v!==void 0&&Tp(v,S),this.nav.attr({translateX:X,translateY:z+this.padding+7+this.titleHeight,visibility:"inherit"}),[this.up,this.upTracker].forEach(function(K){K.attr({class:te===1?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})}),U.attr({text:te+"/"+L}),[this.down,this.downTracker].forEach(function(K){K.attr({x:18+this.pager.getBBox().width,class:te===L?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})},this),S.styledMode||(this.up.attr({fill:te===1?B.inactiveColor:B.activeColor}),this.upTracker.css({cursor:te===1?"default":"pointer"}),this.down.attr({fill:te===L?B.inactiveColor:B.activeColor}),this.downTracker.css({cursor:te===L?"default":"pointer"})),this.scrollOffset=-I[te-1]+this.initialItemY,this.scrollGroup.animate({translateY:this.scrollOffset}),this.currentPage=te,this.positionCheckboxes(),Wf(()=>{Fo(this,"afterScroll",{currentPage:te})},Sp(oo(v,S.renderer.globalAnimation,!0)).duration))}setItemEvents(h,v,S){let I=this,L=h.legendItem||{},z=I.chart.renderer.boxWrapper,B=h instanceof Jo,U=h instanceof eo,X="highcharts-legend-"+(B?"point":"series")+"-active",te=I.chart.styledMode,K=S?[v,L.symbol]:[L.group],re=ue=>{I.allItems.forEach(ge=>{h!==ge&&[ge].concat(ge.linkedSeries||[]).forEach(ye=>{ye.setState(ue,!B)})})};for(let ue of K)ue&&ue.on("mouseover",function(){h.visible&&re("inactive"),h.setState("hover"),h.visible&&z.addClass(X),te||v.css(I.options.itemHoverStyle)}).on("mouseout",function(){I.chart.styledMode||v.css(Qa(h.visible?I.itemStyle:I.itemHiddenStyle)),re(""),z.removeClass(X),h.setState()}).on("click",function(ge){let ye=function(){h.setVisible&&h.setVisible(),re(h.visible?"inactive":"")};z.removeClass(X),Fo(I,"itemClick",{browserEvent:ge,legendItem:h},ye),B?h.firePointEvent("legendItemClick",{browserEvent:ge}):U&&Fo(h,"legendItemClick",{browserEvent:ge})})}createCheckboxForItem(h){h.checkbox=Ua("input",{type:"checkbox",className:"highcharts-legend-checkbox",checked:h.selected,defaultChecked:h.selected},this.options.itemCheckboxStyle,this.chart.container),xc(h.checkbox,"click",function(v){let S=v.target;Fo(h.series||h,"checkboxClick",{checked:S.checked,item:h},function(){h.select()})})}}(function(Y){Y.compose=function(h){Hf(Mp,"Core.Legend")&&xc(h,"beforeMargins",function(){this.legend=new Y(this,this.options.legend)})}})(md||(md={}));let Pp=md,{animate:gd,animObject:qf,setAnimation:bc}=se,{defaultOptions:wc}=zn,{numberFormat:So}=Po,{registerEventOptions:wu}=Fa,{charts:Rl,doc:_h,marginNames:Yf,svg:Sn,win:yh}=Ne,{seriesTypes:Ip}=Gn,{addEvent:vh,attr:Su,createElement:_d,css:ao,defined:da,diffObjects:pa,discardElement:xh,erase:Pn,error:To,extend:Bo,find:Sc,fireEvent:Ur,getAlignFactor:Xf,getStyle:Tc,isArray:Dp,isNumber:Tu,isObject:kp,isString:Mu,merge:lo,objectEach:el,pick:In,pInt:fa,relativeLength:tl,removeEvent:zl,splat:ma,syncTimeout:Zm,uniqueKey:Km}=Bi;class Fl{static chart(h,v,S){return new Fl(h,v,S)}constructor(h,v,S){this.sharedClips={};let I=[...arguments];(Mu(h)||h.nodeName)&&(this.renderTo=I.shift()),this.init(I[0],I[1])}setZoomOptions(){let h=this.options.chart,v=h.zooming;this.zooming={...v,type:In(h.zoomType,v.type),key:In(h.zoomKey,v.key),pinchType:In(h.pinchType,v.pinchType),singleTouch:In(h.zoomBySingleTouch,v.singleTouch,!1),resetButton:lo(v.resetButton,h.resetZoomButton)}}init(h,v){Ur(this,"init",{args:arguments},function(){var z;let S=lo(wc,h),I=S.chart,L=this.renderTo||I.renderTo;this.userOptions=Bo({},h),(this.renderTo=Mu(L)?_h.getElementById(L):L)||To(13,!0,this),this.margin=[],this.spacing=[],this.labelCollectors=[],this.callback=v,this.isResizing=0,this.options=S,this.axes=[],this.series=[],this.locale=S.lang.locale??((z=this.renderTo.closest("[lang]"))==null?void 0:z.lang),this.time=new $a(Bo(S.time||{},{locale:this.locale})),S.time=this.time.options,this.numberFormatter=(I.numberFormatter||So).bind(this),this.styledMode=I.styledMode,this.hasCartesianSeries=I.showAxes,this.index=Rl.length,Rl.push(this),Ne.chartCount++,wu(this,I),this.xAxis=[],this.yAxis=[],this.pointCount=this.colorCounter=this.symbolCounter=0,this.setZoomOptions(),Ur(this,"afterInit"),this.firstRender()})}initSeries(h){let v=this.options.chart,S=h.type||v.type,I=Ip[S];I||To(17,!0,this,{missingModuleFor:S});let L=new I;return typeof L.init=="function"&&L.init(this,h),L}setSortedData(){this.getSeriesOrderByLinks().forEach(function(h){h.points||h.data||!h.enabledDataSorting||h.setData(h.options.data,!1)})}getSeriesOrderByLinks(){return this.series.concat().sort(function(h,v){return h.linkedSeries.length||v.linkedSeries.length?v.linkedSeries.length-h.linkedSeries.length:0})}orderItems(h,v=0){let S=this[h],I=this.options[h]=ma(this.options[h]).slice(),L=this.userOptions[h]=this.userOptions[h]?ma(this.userOptions[h]).slice():[];if(this.hasRendered&&(I.splice(v),L.splice(v)),S)for(let z=v,B=S.length;z<B;++z){let U=S[z];U&&(U.index=z,U instanceof eo&&(U.name=U.getName()),U.options.isInternal||(I[z]=U.options,L[z]=U.userOptions))}}isInsidePlot(h,v,S={}){var xe;let{inverted:I,plotBox:L,plotLeft:z,plotTop:B,scrollablePlotBox:U}=this,{scrollLeft:X=0,scrollTop:te=0}=S.visiblePlotOnly&&((xe=this.scrollablePlotArea)==null?void 0:xe.scrollingContainer)||{},K=S.series,re=S.visiblePlotOnly&&U||L,ue=S.inverted?v:h,ge=S.inverted?h:v,ye={x:ue,y:ge,isInsidePlot:!0,options:S};if(!S.ignoreX){let _e=K&&(I&&!this.polar?K.yAxis:K.xAxis)||{pos:z,len:1/0},ze=S.paneCoordinates?_e.pos+ue:z+ue;ze>=Math.max(X+z,_e.pos)&&ze<=Math.min(X+z+re.width,_e.pos+_e.len)||(ye.isInsidePlot=!1)}if(!S.ignoreY&&ye.isInsidePlot){let _e=!I&&S.axis&&!S.axis.isXAxis&&S.axis||K&&(I?K.xAxis:K.yAxis)||{pos:B,len:1/0},ze=S.paneCoordinates?_e.pos+ge:B+ge;ze>=Math.max(te+B,_e.pos)&&ze<=Math.min(te+B+re.height,_e.pos+_e.len)||(ye.isInsidePlot=!1)}return Ur(this,"afterIsInsidePlot",ye),ye.isInsidePlot}redraw(h){Ur(this,"beforeRedraw");let v=this.hasCartesianSeries?this.axes:this.colorAxis||[],S=this.series,I=this.pointer,L=this.legend,z=this.userOptions.legend,B=this.renderer,U=B.isHidden(),X=[],te,K,re,ue=this.isDirtyBox,ge=this.isDirtyLegend,ye;for(B.rootFontSize=B.boxWrapper.getStyle("font-size"),this.setResponsive&&this.setResponsive(!1),bc(!!this.hasRendered&&h,this),U&&this.temporaryDisplay(),this.layOutTitles(!1),re=S.length;re--;)if(((ye=S[re]).options.stacking||ye.options.centerInCategory)&&(K=!0,ye.isDirty)){te=!0;break}if(te)for(re=S.length;re--;)(ye=S[re]).options.stacking&&(ye.isDirty=!0);S.forEach(function(xe){xe.isDirty&&(xe.options.legendType==="point"?(typeof xe.updateTotals=="function"&&xe.updateTotals(),ge=!0):z&&(z.labelFormatter||z.labelFormat)&&(ge=!0)),xe.isDirtyData&&Ur(xe,"updatedData")}),ge&&L&&L.options.enabled&&(L.render(),this.isDirtyLegend=!1),K&&this.getStacks(),v.forEach(function(xe){xe.updateNames(),xe.setScale()}),this.getMargins(),v.forEach(function(xe){xe.isDirty&&(ue=!0)}),v.forEach(function(xe){let _e=xe.min+","+xe.max;xe.extKey!==_e&&(xe.extKey=_e,X.push(function(){Ur(xe,"afterSetExtremes",Bo(xe.eventArgs,xe.getExtremes())),delete xe.eventArgs})),(ue||K)&&xe.redraw()}),ue&&this.drawChartBox(),Ur(this,"predraw"),S.forEach(function(xe){(ue||xe.isDirty)&&xe.visible&&xe.redraw(),xe.isDirtyData=!1}),I&&I.reset(!0),B.draw(),Ur(this,"redraw"),Ur(this,"render"),U&&this.temporaryDisplay(!0),X.forEach(function(xe){xe.call()})}get(h){let v=this.series;function S(L){return L.id===h||L.options&&L.options.id===h}let I=Sc(this.axes,S)||Sc(this.series,S);for(let L=0;!I&&L<v.length;L++)I=Sc(v[L].points||[],S);return I}createAxes(){let h=this.userOptions;for(let v of(Ur(this,"createAxes"),["xAxis","yAxis"]))for(let S of h[v]=ma(h[v]||{}))new Za(this,S,v);Ur(this,"afterCreateAxes")}getSelectedPoints(){return this.series.reduce((h,v)=>(v.getPointsCollection().forEach(S=>{In(S.selectedStaging,S.selected)&&h.push(S)}),h),[])}getSelectedSeries(){return this.series.filter(h=>h.selected)}setTitle(h,v,S){this.applyDescription("title",h),this.applyDescription("subtitle",v),this.applyDescription("caption",void 0),this.layOutTitles(S)}applyDescription(h,v){var z;let S=this,I=this.options[h]=lo(this.options[h],v),L=this[h];L&&v&&(this[h]=L=L.destroy()),I&&!L&&((L=this.renderer.text(I.text,0,0,I.useHTML).attr({align:I.align,class:"highcharts-"+h,zIndex:I.zIndex||4}).css({textOverflow:"ellipsis",whiteSpace:"nowrap"}).add()).update=function(B,U){S.applyDescription(h,B),S.layOutTitles(U)},this.styledMode||L.css(Bo(h==="title"?{fontSize:this.options.isStock?"1em":"1.2em"}:{},I.style)),L.textPxLength=L.getBBox().width,L.css({whiteSpace:(z=I.style)==null?void 0:z.whiteSpace}),this[h]=L)}layOutTitles(h=!0){var B,U,X,te;let v=[0,0,0],{options:S,renderer:I,spacingBox:L}=this;["title","subtitle","caption"].forEach(K=>{var xe;let re=this[K],ue=this.options[K],ge=lo(L),ye=(re==null?void 0:re.textPxLength)||0;if(re&&ue){Ur(this,"layOutTitle",{alignTo:ge,key:K,textPxLength:ye});let _e=I.fontMetrics(re),ze=_e.b,Re=_e.h,ft=ue.verticalAlign||"top",St=ft==="top",_t=St&&ue.minScale||1,Ot=K==="title"?St?-3:0:St?v[0]+2:0,Pt=Math.min(ge.width/ye,1),Ft=Math.max(_t,Pt),hi=lo({y:ft==="bottom"?ze:Ot+ze},{align:K==="title"?Pt<_t?"left":"center":(xe=this.title)==null?void 0:xe.alignValue},ue),mi=ue.width||(Pt>_t?this.chartWidth:ge.width)/Ft;re.alignValue!==hi.align&&(re.placed=!1);let Ai=Math.round(re.css({width:`${mi}px`}).getBBox(ue.useHTML).height);if(hi.height=Ai,re.align(hi,!1,ge).attr({align:hi.align,scaleX:Ft,scaleY:Ft,"transform-origin":`${ge.x+ye*Ft*Xf(hi.align)} ${Re}`}),!ue.floating){let ai=Ai*(Ai<1.2*Re?1:Ft);ft==="top"?v[0]=Math.ceil(v[0]+ai):ft==="bottom"&&(v[2]=Math.ceil(v[2]+ai))}}},this),v[0]&&(((B=S.title)==null?void 0:B.verticalAlign)||"top")==="top"&&(v[0]+=((U=S.title)==null?void 0:U.margin)||0),v[2]&&((X=S.caption)==null?void 0:X.verticalAlign)==="bottom"&&(v[2]+=((te=S.caption)==null?void 0:te.margin)||0);let z=!this.titleOffset||this.titleOffset.join(",")!==v.join(",");this.titleOffset=v,Ur(this,"afterLayOutTitles"),!this.isDirtyBox&&z&&(this.isDirtyBox=this.isDirtyLegend=z,this.hasRendered&&h&&this.isDirtyBox&&this.redraw())}getContainerBox(){let h=[].map.call(this.renderTo.children,S=>{if(S!==this.container){let I=S.style.display;return S.style.display="none",[S,I]}}),v={width:Tc(this.renderTo,"width",!0)||0,height:Tc(this.renderTo,"height",!0)||0};return h.filter(Boolean).forEach(([S,I])=>{S.style.display=I}),v}getChartSize(){var z;let h=this.options.chart,v=h.width,S=h.height,I=this.getContainerBox(),L=I.height<=1||!((z=this.renderTo.parentElement)!=null&&z.style.height)&&this.renderTo.style.height==="100%";this.chartWidth=Math.max(0,v||I.width||600),this.chartHeight=Math.max(0,tl(S,this.chartWidth)||(L?400:I.height)),this.containerBox=I}temporaryDisplay(h){let v=this.renderTo,S;if(h)for(;v&&v.style;)v.hcOrigStyle&&(ao(v,v.hcOrigStyle),delete v.hcOrigStyle),v.hcOrigDetached&&(_h.body.removeChild(v),v.hcOrigDetached=!1),v=v.parentNode;else for(;v&&v.style&&(_h.body.contains(v)||v.parentNode||(v.hcOrigDetached=!0,_h.body.appendChild(v)),(Tc(v,"display",!1)==="none"||v.hcOricDetached)&&(v.hcOrigStyle={display:v.style.display,height:v.style.height,overflow:v.style.overflow},S={display:"block",overflow:"hidden"},v!==this.renderTo&&(S.height=0),ao(v,S),v.offsetWidth||v.style.setProperty("display","block","important")),(v=v.parentNode)!==_h.body););}setClassName(h){this.container.className="highcharts-container "+(h||"")}getContainer(){var re;let h,v=this.options,S=v.chart,I="data-highcharts-chart",L=Km(),z=this.renderTo,B=fa(Su(z,I));Tu(B)&&Rl[B]&&Rl[B].hasRendered&&Rl[B].destroy(),Su(z,I,this.index),z.innerHTML=pi.emptyHTML,S.skipClone||z.offsetWidth||this.temporaryDisplay(),this.getChartSize();let U=this.chartHeight,X=this.chartWidth;ao(z,{overflow:"hidden"}),this.styledMode||(h=Bo({position:"relative",overflow:"hidden",width:X+"px",height:U+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)",userSelect:"none","touch-action":"manipulation",outline:"none",padding:"0px"},S.style||{}));let te=_d("div",{id:L},h,z);this.container=te,this.getChartSize(),X===this.chartWidth||(X=this.chartWidth,this.styledMode||ao(te,{width:In((re=S.style)==null?void 0:re.width,X+"px")})),this.containerBox=this.getContainerBox(),this._cursor=te.style.cursor;let K=S.renderer||!Sn?Wc.getRendererType(S.renderer):ei;if(this.renderer=new K(te,X,U,void 0,S.forExport,v.exporting&&v.exporting.allowHTML,this.styledMode),bc(void 0,this),this.setClassName(S.className),this.styledMode)for(let ue in v.defs)this.renderer.definition(v.defs[ue]);else this.renderer.setStyle(S.style);this.renderer.chartIndex=this.index,Ur(this,"afterGetContainer")}getMargins(h){let{spacing:v,margin:S,titleOffset:I}=this;this.resetMargins(),I[0]&&!da(S[0])&&(this.plotTop=Math.max(this.plotTop,I[0]+v[0])),I[2]&&!da(S[2])&&(this.marginBottom=Math.max(this.marginBottom,I[2]+v[2])),this.legend&&this.legend.display&&this.legend.adjustMargins(S,v),Ur(this,"getMargins"),h||this.getAxisMargins()}getAxisMargins(){let h=this,v=h.axisOffset=[0,0,0,0],S=h.colorAxis,I=h.margin,L=function(z){z.forEach(function(B){B.visible&&B.getOffset()})};h.hasCartesianSeries?L(h.axes):S&&S.length&&L(S),Yf.forEach(function(z,B){da(I[B])||(h[z]+=v[B])}),h.setChartSize()}getOptions(){return pa(this.userOptions,wc)}reflow(h){var L;let v=this,S=v.containerBox,I=v.getContainerBox();(L=v.pointer)==null||delete L.chartPosition,!v.isPrinting&&!v.isResizing&&S&&I.width&&((I.width!==S.width||I.height!==S.height)&&(Bi.clearTimeout(v.reflowTimeout),v.reflowTimeout=Zm(function(){v.container&&v.setSize(void 0,void 0,!1)},h?100:0)),v.containerBox=I)}setReflow(){let h=this,v=S=>{var I;(I=h.options)!=null&&I.chart.reflow&&h.hasLoaded&&h.reflow(S)};if(typeof ResizeObserver=="function")new ResizeObserver(v).observe(h.renderTo);else{let S=vh(yh,"resize",v);vh(this,"destroy",S)}}setSize(h,v,S){let I=this,L=I.renderer;I.isResizing+=1,bc(S,I);let z=L.globalAnimation;I.oldChartHeight=I.chartHeight,I.oldChartWidth=I.chartWidth,h!==void 0&&(I.options.chart.width=h),v!==void 0&&(I.options.chart.height=v),I.getChartSize();let{chartWidth:B,chartHeight:U,scrollablePixelsX:X=0,scrollablePixelsY:te=0}=I;(I.isDirtyBox||B!==I.oldChartWidth||U!==I.oldChartHeight)&&(I.styledMode||(z?gd:ao)(I.container,{width:`${B+X}px`,height:`${U+te}px`},z),I.setChartSize(!0),L.setSize(B,U,z),I.axes.forEach(function(K){K.isDirty=!0,K.setScale()}),I.isDirtyLegend=!0,I.isDirtyBox=!0,I.layOutTitles(),I.getMargins(),I.redraw(z),I.oldChartHeight=void 0,Ur(I,"resize"),setTimeout(()=>{I&&Ur(I,"endResize")},qf(z).duration)),I.isResizing-=1}setChartSize(h){let v,S,I,L,{chartHeight:z,chartWidth:B,inverted:U,spacing:X,renderer:te}=this,K=this.clipOffset,re=Math[U?"floor":"round"];this.plotLeft=v=Math.round(this.plotLeft),this.plotTop=S=Math.round(this.plotTop),this.plotWidth=I=Math.max(0,Math.round(B-v-this.marginRight)),this.plotHeight=L=Math.max(0,Math.round(z-S-this.marginBottom)),this.plotSizeX=U?L:I,this.plotSizeY=U?I:L,this.spacingBox=te.spacingBox={x:X[3],y:X[0],width:B-X[3]-X[1],height:z-X[0]-X[2]},this.plotBox=te.plotBox={x:v,y:S,width:I,height:L},K&&(this.clipBox={x:re(K[3]),y:re(K[0]),width:re(this.plotSizeX-K[1]-K[3]),height:re(this.plotSizeY-K[0]-K[2])}),h||(this.axes.forEach(function(ue){ue.setAxisSize(),ue.setAxisTranslation()}),te.alignElements()),Ur(this,"afterSetChartSize",{skipAxes:h})}resetMargins(){Ur(this,"resetMargins");let h=this,v=h.options.chart,S=v.plotBorderWidth||0,I=S/2;["margin","spacing"].forEach(function(L){let z=v[L],B=kp(z)?z:[z,z,z,z];["Top","Right","Bottom","Left"].forEach(function(U,X){h[L][X]=In(v[L+U],B[X])})}),Yf.forEach(function(L,z){h[L]=In(h.margin[z],h.spacing[z])}),h.axisOffset=[0,0,0,0],h.clipOffset=[I,I,I,I],h.plotBorderWidth=S}drawChartBox(){let h=this.options.chart,v=this.renderer,S=this.chartWidth,I=this.chartHeight,L=this.styledMode,z=this.plotBGImage,B=h.backgroundColor,U=h.plotBackgroundColor,X=h.plotBackgroundImage,te=this.plotLeft,K=this.plotTop,re=this.plotWidth,ue=this.plotHeight,ge=this.plotBox,ye=this.clipRect,xe=this.clipBox,_e=this.chartBackground,ze=this.plotBackground,Re=this.plotBorder,ft,St,_t,Ot="animate";_e||(this.chartBackground=_e=v.rect().addClass("highcharts-background").add(),Ot="attr"),L?ft=St=_e.strokeWidth():(St=(ft=h.borderWidth||0)+(h.shadow?8:0),_t={fill:B||"none"},(ft||_e["stroke-width"])&&(_t.stroke=h.borderColor,_t["stroke-width"]=ft),_e.attr(_t).shadow(h.shadow)),_e[Ot]({x:St/2,y:St/2,width:S-St-ft%2,height:I-St-ft%2,r:h.borderRadius}),Ot="animate",ze||(Ot="attr",this.plotBackground=ze=v.rect().addClass("highcharts-plot-background").add()),ze[Ot](ge),!L&&(ze.attr({fill:U||"none"}).shadow(h.plotShadow),X&&(z?(X!==z.attr("href")&&z.attr("href",X),z.animate(ge)):this.plotBGImage=v.image(X,te,K,re,ue).add())),ye?ye.animate({width:xe.width,height:xe.height}):this.clipRect=v.clipRect(xe),Ot="animate",Re||(Ot="attr",this.plotBorder=Re=v.rect().addClass("highcharts-plot-border").attr({zIndex:1}).add()),L||Re.attr({stroke:h.plotBorderColor,"stroke-width":h.plotBorderWidth||0,fill:"none"}),Re[Ot](Re.crisp({x:te,y:K,width:re,height:ue},-Re.strokeWidth())),this.isDirtyBox=!1,Ur(this,"afterDrawChartBox")}propFromSeries(){let h,v,S,I=this,L=I.options.chart,z=I.options.series;["inverted","angular","polar"].forEach(function(B){for(v=Ip[L.type],S=L[B]||v&&v.prototype[B],h=z&&z.length;!S&&h--;)(v=Ip[z[h].type])&&v.prototype[B]&&(S=!0);I[B]=S})}linkSeries(h){let v=this,S=v.series;S.forEach(function(I){I.linkedSeries.length=0}),S.forEach(function(I){let{linkedTo:L}=I.options;if(Mu(L)){let z;(z=L===":previous"?v.series[I.index-1]:v.get(L))&&z.linkedParent!==I&&(z.linkedSeries.push(I),I.linkedParent=z,z.enabledDataSorting&&I.setDataSortingOptions(),I.visible=In(I.options.visible,z.options.visible,I.visible))}}),Ur(this,"afterLinkSeries",{isUpdating:h})}renderSeries(){this.series.forEach(function(h){h.translate(),h.render()})}render(){var te;let h=this.axes,v=this.colorAxis,S=this.renderer,I=this.options.chart.axisLayoutRuns||2,L=K=>{K.forEach(re=>{re.visible&&re.render()})},z=0,B=!0,U,X=0;for(let K of(this.setTitle(),Ur(this,"beforeMargins"),(te=this.getStacks)==null||te.call(this),this.getMargins(!0),this.setChartSize(),h)){let{options:re}=K,{labels:ue}=re;if(this.hasCartesianSeries&&K.horiz&&K.visible&&ue.enabled&&K.series.length&&K.coll!=="colorAxis"&&!this.polar){z=re.tickLength,K.createGroups();let ge=new Zo(K,0,"",!0),ye=ge.createLabel("x",ue);if(ge.destroy(),ye&&In(ue.reserveSpace,!Tu(re.crossing))&&(z=ye.getBBox().height+ue.distance+Math.max(re.offset||0,0)),z){ye==null||ye.destroy();break}}}for(this.plotHeight=Math.max(this.plotHeight-z,0);(B||U||I>1)&&X<I;){let K=this.plotWidth,re=this.plotHeight;for(let ue of h)X===0?ue.setScale():(ue.horiz&&B||!ue.horiz&&U)&&ue.setTickInterval(!0);X===0?this.getAxisMargins():this.getMargins(),B=K/this.plotWidth>(X?1:1.1),U=re/this.plotHeight>(X?1:1.05),X++}this.drawChartBox(),this.hasCartesianSeries?L(h):v&&v.length&&L(v),this.seriesGroup||(this.seriesGroup=S.g("series-group").attr({zIndex:3}).shadow(this.options.chart.seriesGroupShadow).add()),this.renderSeries(),this.addCredits(),this.setResponsive&&this.setResponsive(),this.hasRendered=!0}addCredits(h){let v=this,S=lo(!0,this.options.credits,h);S.enabled&&!this.credits&&(this.credits=this.renderer.text(S.text+(this.mapCredits||""),0,0).addClass("highcharts-credits").on("click",function(){S.href&&(yh.location.href=S.href)}).attr({align:S.position.align,zIndex:8}),v.styledMode||this.credits.css(S.style),this.credits.add().align(S.position),this.credits.update=function(I){v.credits=v.credits.destroy(),v.addCredits(I)})}destroy(){let h,v=this,S=v.axes,I=v.series,L=v.container,z=L&&L.parentNode;for(Ur(v,"destroy"),v.renderer.forExport?Pn(Rl,v):Rl[v.index]=void 0,Ne.chartCount--,v.renderTo.removeAttribute("data-highcharts-chart"),zl(v),h=S.length;h--;)S[h]=S[h].destroy();for(this.scroller&&this.scroller.destroy&&this.scroller.destroy(),h=I.length;h--;)I[h]=I[h].destroy();["title","subtitle","chartBackground","plotBackground","plotBGImage","plotBorder","seriesGroup","clipRect","credits","pointer","rangeSelector","legend","resetZoomButton","tooltip","renderer"].forEach(function(B){let U=v[B];U&&U.destroy&&(v[B]=U.destroy())}),L&&(L.innerHTML=pi.emptyHTML,zl(L),z&&xh(L)),el(v,function(B,U){delete v[U]})}firstRender(){var I;let h=this,v=h.options;h.getContainer(),h.resetMargins(),h.setChartSize(),h.propFromSeries(),h.createAxes();let S=Dp(v.series)?v.series:[];v.series=[],S.forEach(function(L){h.initSeries(L)}),h.linkSeries(),h.setSortedData(),Ur(h,"beforeRender"),h.render(),(I=h.pointer)==null||I.getChartPosition(),h.renderer.imgCount||h.hasLoaded||h.onload(),h.temporaryDisplay(!0)}onload(){this.callbacks.concat([this.callback]).forEach(function(h){h&&this.index!==void 0&&h.apply(this,[this])},this),Ur(this,"load"),Ur(this,"render"),da(this.index)&&this.setReflow(),this.warnIfA11yModuleNotLoaded(),this.hasLoaded=!0}warnIfA11yModuleNotLoaded(){let{options:h,title:v}=this;!h||this.accessibility||(this.renderer.boxWrapper.attr({role:"img","aria-label":(v&&v.element.textContent||"").replace(/</g,"&lt;")}),h.accessibility&&h.accessibility.enabled===!1||To('Highcharts warning: Consider including the "accessibility.js" module to make your chart more usable for people with disabilities. Set the "accessibility.enabled" option to false to remove this warning. See https://www.highcharts.com/docs/accessibility/accessibility-module.',!1,this))}addSeries(h,v,S){let I,L=this;return h&&(v=In(v,!0),Ur(L,"addSeries",{options:h},function(){I=L.initSeries(h),L.isDirtyLegend=!0,L.linkSeries(),I.enabledDataSorting&&I.setData(h.data,!1),Ur(L,"afterAddSeries",{series:I}),v&&L.redraw(S)})),I}addAxis(h,v,S,I){return this.createAxis(v?"xAxis":"yAxis",{axis:h,redraw:S,animation:I})}addColorAxis(h,v,S){return this.createAxis("colorAxis",{axis:h,redraw:v,animation:S})}createAxis(h,v){let S=new Za(this,v.axis,h);return In(v.redraw,!0)&&this.redraw(v.animation),S}showLoading(h){let v=this,S=v.options,I=S.loading,L=function(){z&&ao(z,{left:v.plotLeft+"px",top:v.plotTop+"px",width:v.plotWidth+"px",height:v.plotHeight+"px"})},z=v.loadingDiv,B=v.loadingSpan;z||(v.loadingDiv=z=_d("div",{className:"highcharts-loading highcharts-loading-hidden"},null,v.container)),B||(v.loadingSpan=B=_d("span",{className:"highcharts-loading-inner"},null,z),vh(v,"redraw",L)),z.className="highcharts-loading",pi.setElementHTML(B,In(h,S.lang.loading,"")),v.styledMode||(ao(z,Bo(I.style,{zIndex:10})),ao(B,I.labelStyle),v.loadingShown||(ao(z,{opacity:0,display:""}),gd(z,{opacity:I.style.opacity||.5},{duration:I.showDuration||0}))),v.loadingShown=!0,L()}hideLoading(){let h=this.options,v=this.loadingDiv;v&&(v.className="highcharts-loading highcharts-loading-hidden",this.styledMode||gd(v,{opacity:0},{duration:h.loading.hideDuration||100,complete:function(){ao(v,{display:"none"})}})),this.loadingShown=!1}update(h,v,S,I){let L,z,B,U=this,X={credits:"addCredits",title:"setTitle",subtitle:"setSubtitle",caption:"setCaption"},te=h.isResponsiveOptions,K=[];Ur(U,"update",{options:h}),te||U.setResponsive(!1,!0),h=pa(h,U.options),U.userOptions=lo(U.userOptions,h);let re=h.chart;re&&(lo(!0,U.options.chart,re),this.setZoomOptions(),"className"in re&&U.setClassName(re.className),("inverted"in re||"polar"in re||"type"in re)&&(U.propFromSeries(),L=!0),"alignTicks"in re&&(L=!0),"events"in re&&wu(this,re),el(re,function(ye,xe){U.propsRequireUpdateSeries.indexOf("chart."+xe)!==-1&&(z=!0),U.propsRequireDirtyBox.indexOf(xe)!==-1&&(U.isDirtyBox=!0),U.propsRequireReflow.indexOf(xe)===-1||(U.isDirtyBox=!0,te||(B=!0))}),!U.styledMode&&re.style&&U.renderer.setStyle(U.options.chart.style||{})),!U.styledMode&&h.colors&&(this.options.colors=h.colors),el(h,function(ye,xe){U[xe]&&typeof U[xe].update=="function"?U[xe].update(ye,!1):typeof U[X[xe]]=="function"?U[X[xe]](ye):xe!=="colors"&&U.collectionsWithUpdate.indexOf(xe)===-1&&lo(!0,U.options[xe],h[xe]),xe!=="chart"&&U.propsRequireUpdateSeries.indexOf(xe)!==-1&&(z=!0)}),this.collectionsWithUpdate.forEach(function(ye){h[ye]&&(ma(h[ye]).forEach(function(xe,_e){let ze,Re=da(xe.id);Re&&(ze=U.get(xe.id)),!ze&&U[ye]&&(ze=U[ye][In(xe.index,_e)])&&(Re&&da(ze.options.id)||ze.options.isInternal)&&(ze=void 0),ze&&ze.coll===ye&&(ze.update(xe,!1),S&&(ze.touched=!0)),!ze&&S&&U.collectionsWithInit[ye]&&(U.collectionsWithInit[ye][0].apply(U,[xe].concat(U.collectionsWithInit[ye][1]||[]).concat([!1])).touched=!0)}),S&&U[ye].forEach(function(xe){xe.touched||xe.options.isInternal?delete xe.touched:K.push(xe)}))}),K.forEach(function(ye){ye.chart&&ye.remove&&ye.remove(!1)}),L&&U.axes.forEach(function(ye){ye.update({},!1)}),z&&U.getSeriesOrderByLinks().forEach(function(ye){ye.chart&&ye.update({},!1)},this);let ue=re&&re.width,ge=re&&(Mu(re.height)?tl(re.height,ue||U.chartWidth):re.height);B||Tu(ue)&&ue!==U.chartWidth||Tu(ge)&&ge!==U.chartHeight?U.setSize(ue,ge,I):In(v,!0)&&U.redraw(I),Ur(U,"afterUpdate",{options:h,redraw:v,animation:I})}setSubtitle(h,v){this.applyDescription("subtitle",h),this.layOutTitles(v)}setCaption(h,v){this.applyDescription("caption",h),this.layOutTitles(v)}showResetZoom(){let h=this,v=wc.lang,S=h.zooming.resetButton,I=S.theme,L=S.relativeTo==="chart"||S.relativeTo==="spacingBox"?null:"plotBox";function z(){h.zoomOut()}Ur(this,"beforeShowResetZoom",null,function(){h.resetZoomButton=h.renderer.button(v.resetZoom,null,null,z,I).attr({align:S.position.align,title:v.resetZoomTitle}).addClass("highcharts-reset-zoom").add().align(S.position,!1,L)}),Ur(this,"afterShowResetZoom")}zoomOut(){Ur(this,"selection",{resetSelection:!0},()=>this.transform({reset:!0,trigger:"zoom"}))}pan(h,v){let S=this,I=typeof v=="object"?v:{enabled:v,type:"x"},L=I.type,z=L&&S[{x:"xAxis",xy:"axes",y:"yAxis"}[L]].filter(U=>U.options.panningEnabled&&!U.options.isInternal),B=S.options.chart;B!=null&&B.panning&&(B.panning=I),Ur(this,"pan",{originalEvent:h},()=>{S.transform({axes:z,event:h,to:{x:h.chartX-(S.mouseDownX||0),y:h.chartY-(S.mouseDownY||0)},trigger:"pan"}),ao(S.container,{cursor:"move"})})}transform(h){var ge;let{axes:v=this.axes,event:S,from:I={},reset:L,selection:z,to:B={},trigger:U}=h,{inverted:X,time:te}=this,K=!1,re,ue;for(let ye of((ge=this.hoverPoints)==null||ge.forEach(xe=>xe.setState()),v)){let{horiz:xe,len:_e,minPointOffset:ze=0,options:Re,reversed:ft}=ye,St=xe?"width":"height",_t=xe?"x":"y",Ot=In(B[St],ye.len),Pt=In(I[St],ye.len),Ft=10>Math.abs(Ot)?1:Ot/Pt,hi=(I[_t]||0)+Pt/2-ye.pos,mi=hi-((B[_t]??ye.pos)+Ot/2-ye.pos)/Ft,Ai=ft&&!X||!ft&&X?-1:1;if(!L&&(hi<0||hi>ye.len))continue;let ai=ye.toValue(mi,!0)+(z||ye.isOrdinal?0:ze*Ai),Ci=ye.toValue(mi+_e/Ft,!0)-(z||ye.isOrdinal?0:ze*Ai||0),Zi=ye.allExtremes;if(ai>Ci&&([ai,Ci]=[Ci,ai]),Ft===1&&!L&&ye.coll==="yAxis"&&!Zi){for(let Xn of ye.series){let Bs=Xn.getExtremes(Xn.getProcessedData(!0).modified.getColumn("y")||[],!0);Zi??(Zi={dataMin:Number.MAX_VALUE,dataMax:-Number.MAX_VALUE}),Tu(Bs.dataMin)&&Tu(Bs.dataMax)&&(Zi.dataMin=Math.min(Bs.dataMin,Zi.dataMin),Zi.dataMax=Math.max(Bs.dataMax,Zi.dataMax))}ye.allExtremes=Zi}let{dataMin:kr,dataMax:Hi,min:gr,max:Vi}=Bo(ye.getExtremes(),Zi||{}),Qi=te.parse(Re.min),_r=te.parse(Re.max),un=kr??Qi,kn=Hi??_r,zr=Ci-ai,Hr=ye.categories?0:Math.min(zr,kn-un),Xr=un-Hr*(da(Qi)?0:Re.minPadding),Ms=kn+Hr*(da(_r)?0:Re.maxPadding),ss=ye.allowZoomOutside||Ft===1||U!=="zoom"&&Ft>1,Es=Math.min(Qi??Xr,Xr,ss?gr:Xr),os=Math.max(_r??Ms,Ms,ss?Vi:Ms);(!ye.isOrdinal||ye.options.overscroll||Ft!==1||L)&&(ai<Es&&(ai=Es,Ft>=1&&(Ci=ai+zr)),Ci>os&&(Ci=os,Ft>=1&&(ai=Ci-zr)),(L||ye.series.length&&(ai!==gr||Ci!==Vi)&&ai>=Es&&Ci<=os)&&(z?z[ye.coll].push({axis:ye,min:ai,max:Ci}):(ye.isPanning=U!=="zoom",ye.isPanning&&(ue=!0),ye.setExtremes(L?void 0:ai,L?void 0:Ci,!1,!1,{move:mi,trigger:U,scale:Ft}),!L&&(ai>Es||Ci<os)&&U!=="mousewheel"&&(re=!0)),K=!0),S&&(this[xe?"mouseDownX":"mouseDownY"]=S[xe?"chartX":"chartY"]))}return K&&(z?Ur(this,"selection",z,()=>{delete h.selection,h.trigger="zoom",this.transform(h)}):(!re||ue||this.resetZoomButton?!re&&this.resetZoomButton&&(this.resetZoomButton=this.resetZoomButton.destroy()):this.showResetZoom(),this.redraw(U==="zoom"&&(this.options.chart.animation??this.pointCount<100)))),K}}Bo(Fl.prototype,{callbacks:[],collectionsWithInit:{xAxis:[Fl.prototype.addAxis,[!0]],yAxis:[Fl.prototype.addAxis,[!1]],series:[Fl.prototype.addSeries]},collectionsWithUpdate:["xAxis","yAxis","series"],propsRequireDirtyBox:["backgroundColor","borderColor","borderWidth","borderRadius","plotBackgroundColor","plotBackgroundImage","plotBorderColor","plotBorderWidth","plotShadow","shadow"],propsRequireReflow:["margin","marginTop","marginRight","marginBottom","marginLeft","spacing","spacingTop","spacingRight","spacingBottom","spacingLeft"],propsRequireUpdateSeries:["chart.inverted","chart.polar","chart.ignoreHiddenSeries","chart.type","colors","plotOptions","time","tooltip"]});let{stop:yd}=se,{composed:Zf}=Ne,{addEvent:Hn,createElement:il,css:vd,defined:xd,erase:Eu,merge:bh,pushUnique:Mo}=Bi;function No(){let Y=this.scrollablePlotArea;(this.scrollablePixelsX||this.scrollablePixelsY)&&!Y&&(this.scrollablePlotArea=Y=new ga(this)),Y==null||Y.applyFixed()}function Mc(){this.chart.scrollablePlotArea&&(this.chart.scrollablePlotArea.isDirty=!0)}class ga{static compose(h,v,S){Mo(Zf,this.compose)&&(Hn(h,"afterInit",Mc),Hn(v,"afterSetChartSize",I=>this.afterSetSize(I.target,I)),Hn(v,"render",No),Hn(S,"show",Mc))}static afterSetSize(h,v){let S,I,L,{minWidth:z,minHeight:B}=h.options.chart.scrollablePlotArea||{},{clipBox:U,plotBox:X,inverted:te,renderer:K}=h;if(!K.forExport&&(z?(h.scrollablePixelsX=S=Math.max(0,z-h.chartWidth),S&&(h.scrollablePlotBox=bh(h.plotBox),X.width=h.plotWidth+=S,U[te?"height":"width"]+=S,L=!0)):B&&(h.scrollablePixelsY=I=Math.max(0,B-h.chartHeight),xd(I)&&(h.scrollablePlotBox=bh(h.plotBox),X.height=h.plotHeight+=I,U[te?"width":"height"]+=I,L=!1)),xd(L)&&!v.skipAxes))for(let re of h.axes)(re.horiz===L||h.hasParallelCoordinates&&re.coll==="yAxis")&&(re.setAxisSize(),re.setAxisTranslation())}constructor(h){var ue;let v,S=h.options.chart,I=Wc.getRendererType(),L=S.scrollablePlotArea||{},z=this.moveFixedElements.bind(this),B={WebkitOverflowScrolling:"touch",overflowX:"hidden",overflowY:"hidden"};h.scrollablePixelsX&&(B.overflowX="auto"),h.scrollablePixelsY&&(B.overflowY="auto"),this.chart=h;let U=this.parentDiv=il("div",{className:"highcharts-scrolling-parent"},{position:"relative"},h.renderTo),X=this.scrollingContainer=il("div",{className:"highcharts-scrolling"},B,U),te=this.innerContainer=il("div",{className:"highcharts-inner-container"},void 0,X),K=this.fixedDiv=il("div",{className:"highcharts-fixed"},{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:(((ue=S.style)==null?void 0:ue.zIndex)||0)+2,top:0},void 0,!0),re=this.fixedRenderer=new I(K,h.chartWidth,h.chartHeight,S.style);this.mask=re.path().attr({fill:S.backgroundColor||"#fff","fill-opacity":L.opacity??.85,zIndex:-1}).addClass("highcharts-scrollable-mask").add(),X.parentNode.insertBefore(K,X),vd(h.renderTo,{overflow:"visible"}),Hn(h,"afterShowResetZoom",z),Hn(h,"afterApplyDrilldown",z),Hn(h,"afterLayOutTitles",z),Hn(X,"scroll",()=>{let{pointer:ge,hoverPoint:ye}=h;ge&&(delete ge.chartPosition,ye&&(v=ye),ge.runPointActions(void 0,v,!0))}),te.appendChild(h.container)}applyFixed(){var hi;let{chart:h,fixedRenderer:v,isDirty:S,scrollingContainer:I}=this,{axisOffset:L,chartWidth:z,chartHeight:B,container:U,plotHeight:X,plotLeft:te,plotTop:K,plotWidth:re,scrollablePixelsX:ue=0,scrollablePixelsY:ge=0}=h,{scrollPositionX:ye=0,scrollPositionY:xe=0}=h.options.chart.scrollablePlotArea||{},_e=z+ue,ze=B+ge;v.setSize(z,B),(S??!0)&&(this.isDirty=!1,this.moveFixedElements()),yd(h.container),vd(U,{width:`${_e}px`,height:`${ze}px`}),h.renderer.boxWrapper.attr({width:_e,height:ze,viewBox:[0,0,_e,ze].join(" ")}),(hi=h.chartBackground)==null||hi.attr({width:_e,height:ze}),vd(I,{width:`${z}px`,height:`${B}px`}),xd(S)||(I.scrollLeft=ue*ye,I.scrollTop=ge*xe);let Re=K-L[0]-1,ft=te-L[3]-1,St=K+X+L[2]+1,_t=te+re+L[1]+1,Ot=te+re-ue,Pt=K+X-ge,Ft=[["M",0,0]];ue?Ft=[["M",0,Re],["L",te-1,Re],["L",te-1,St],["L",0,St],["Z"],["M",Ot,Re],["L",z,Re],["L",z,St],["L",Ot,St],["Z"]]:ge&&(Ft=[["M",ft,0],["L",ft,K-1],["L",_t,K-1],["L",_t,0],["Z"],["M",ft,Pt],["L",ft,B],["L",_t,B],["L",_t,Pt],["Z"]]),h.redrawTrigger!=="adjustHeight"&&this.mask.attr({d:Ft})}moveFixedElements(){let h,{container:v,inverted:S,scrollablePixelsX:I,scrollablePixelsY:L}=this.chart,z=this.fixedRenderer,B=ga.fixedSelectors;if(I&&!S?h=".highcharts-yaxis":I&&S||L&&!S?h=".highcharts-xaxis":L&&S&&(h=".highcharts-yaxis"),h&&!(this.chart.hasParallelCoordinates&&h===".highcharts-yaxis"))for(let U of[`${h}:not(.highcharts-radial-axis)`,`${h}-labels:not(.highcharts-radial-axis-labels)`])Mo(B,U);else for(let U of[".highcharts-xaxis",".highcharts-yaxis"])for(let X of[`${U}:not(.highcharts-radial-axis)`,`${U}-labels:not(.highcharts-radial-axis-labels)`])Eu(B,X);for(let U of B)[].forEach.call(v.querySelectorAll(U),X=>{(X.namespaceURI===z.SVG_NS?z.box:z.box.parentNode).appendChild(X),X.style.pointerEvents="auto"})}}ga.fixedSelectors=[".highcharts-breadcrumbs-group",".highcharts-contextbutton",".highcharts-caption",".highcharts-credits",".highcharts-drillup-button",".highcharts-legend",".highcharts-legend-checkbox",".highcharts-navigator-series",".highcharts-navigator-xaxis",".highcharts-navigator-yaxis",".highcharts-navigator",".highcharts-range-selector-group",".highcharts-reset-zoom",".highcharts-scrollbar",".highcharts-subtitle",".highcharts-title"];let{format:Ec}=Po,{series:Op}=Gn,{destroyObjectProperties:Er,fireEvent:rl,getAlignFactor:Lp,isNumber:Rp,pick:Bl}=Bi,_a=class{constructor(Y,h,v,S,I){let L=Y.chart.inverted,z=Y.reversed;this.axis=Y;let B=this.isNegative=!!v!=!!z;this.options=h=h||{},this.x=S,this.total=null,this.cumulative=null,this.points={},this.hasValidPoints=!1,this.stack=I,this.leftCliff=0,this.rightCliff=0,this.alignOptions={align:h.align||(L?B?"left":"right":"center"),verticalAlign:h.verticalAlign||(L?"middle":B?"bottom":"top"),y:h.y,x:h.x},this.textAlign=h.textAlign||(L?B?"right":"left":"center")}destroy(){Er(this,this.axis)}render(Y){let h=this.axis.chart,v=this.options,S=v.format,I=S?Ec(S,this,h):v.formatter.call(this);if(this.label)this.label.attr({text:I,visibility:"hidden"});else{this.label=h.renderer.label(I,null,void 0,v.shape,void 0,void 0,v.useHTML,!1,"stack-labels");let L={r:v.borderRadius||0,text:I,padding:Bl(v.padding,5),visibility:"hidden"};h.styledMode||(L.fill=v.backgroundColor,L.stroke=v.borderColor,L["stroke-width"]=v.borderWidth,this.label.css(v.style||{})),this.label.attr(L),this.label.added||this.label.add(Y)}this.label.labelrank=h.plotSizeY,rl(this,"afterRender")}setOffset(Y,h,v,S,I,L){let{alignOptions:z,axis:B,label:U,options:X,textAlign:te}=this,K=B.chart,re=this.getStackBox({xOffset:Y,width:h,boxBottom:v,boxTop:S,defaultX:I,xAxis:L}),{verticalAlign:ue}=z;if(U&&re){let ge=U.getBBox(void 0,0),ye=U.padding,xe=Bl(X.overflow,"justify")==="justify",_e;z.x=X.x||0,z.y=X.y||0;let{x:ze,y:Re}=this.adjustStackPosition({labelBox:ge,verticalAlign:ue,textAlign:te});re.x-=ze,re.y-=Re,U.align(z,!1,re),(_e=K.isInsidePlot(U.alignAttr.x+z.x+ze,U.alignAttr.y+z.y+Re))||(xe=!1),xe&&Op.prototype.justifyDataLabel.call(B,U,z,U.alignAttr,ge,re),U.attr({x:U.alignAttr.x,y:U.alignAttr.y,rotation:X.rotation,rotationOriginX:ge.width*Lp(X.textAlign||"center"),rotationOriginY:ge.height/2}),Bl(!xe&&X.crop,!0)&&(_e=Rp(U.x)&&Rp(U.y)&&K.isInsidePlot(U.x-ye+(U.width||0),U.y)&&K.isInsidePlot(U.x+ye,U.y)),U[_e?"show":"hide"]()}rl(this,"afterSetOffset",{xOffset:Y,width:h})}adjustStackPosition({labelBox:Y,verticalAlign:h,textAlign:v}){return{x:Y.width/2+Y.width/2*(2*Lp(v)-1),y:Y.height/2*2*(1-Lp(h))}}getStackBox(Y){let h=this.axis,v=h.chart,{boxTop:S,defaultX:I,xOffset:L,width:z,boxBottom:B}=Y,U=h.stacking.usePercentage?100:Bl(S,this.total,0),X=h.toPixels(U),te=Y.xAxis||v.xAxis[0],K=Bl(I,te.translate(this.x))+L,re=Math.abs(X-h.toPixels(B||Rp(h.min)&&h.logarithmic&&h.logarithmic.lin2log(h.min)||0)),ue=v.inverted,ge=this.isNegative;return ue?{x:(ge?X:X-re)-v.plotLeft,y:te.height-K-z+te.top-v.plotTop,width:re,height:z}:{x:K+te.transB-v.plotLeft,y:(ge?X-re:X)-v.plotTop,width:z,height:re}}},{getDeferredAnimation:ya}=se,{series:{prototype:to}}=Gn,{addEvent:co,correctFloat:Wn,defined:zp,destroyObjectProperties:uo,fireEvent:Fp,isNumber:Nl,objectEach:u,pick:t}=Bi;function n(){let Y=this.inverted;this.axes.forEach(h=>{h.stacking&&h.stacking.stacks&&h.hasVisibleSeries&&(h.stacking.oldStacks=h.stacking.stacks)}),this.series.forEach(h=>{let v=h.xAxis&&h.xAxis.options||{};h.options.stacking&&h.reserveSpace()&&(h.stackKey=[h.type,t(h.options.stack,""),Y?v.top:v.left,Y?v.height:v.width].join(","))})}function d(){var h;let Y=this.stacking;if(Y){let v=Y.stacks;u(v,(S,I)=>{uo(S),delete v[I]}),(h=Y.stackTotalGroup)==null||h.destroy()}}function y(){this.stacking||(this.stacking=new j(this))}function b(Y,h,v,S){return!zp(Y)||Y.x!==h||S&&Y.stackKey!==S?Y={x:h,index:0,key:S,stackKey:S}:Y.index++,Y.key=[v,h,Y.index].join(","),Y}function T(){let Y,h=this,v=h.yAxis,S=h.stackKey||"",I=v.stacking.stacks,L=h.getColumn("x",!0),z=h.options.stacking,B=h[z+"Stacker"];B&&[S,"-"+S].forEach(U=>{var ue;let X=L.length,te,K,re;for(;X--;)te=L[X],Y=h.getStackIndicator(Y,te,h.index,U),K=(ue=I[U])==null?void 0:ue[te],(re=K==null?void 0:K.points[Y.key||""])&&B.call(h,re,K,X)})}function D(Y,h,v){let S=h.total?100/h.total:0;Y[0]=Wn(Y[0]*S),Y[1]=Wn(Y[1]*S),this.stackedYData[v]=Y[1]}function F(Y){(this.is("column")||this.is("columnrange"))&&(this.options.centerInCategory&&this.chart.series.length>1?to.setStackedPoints.call(this,Y,"group"):Y.stacking.resetStacks())}function V(Y,h){var Pt,Ft;let v,S,I,L,z,B,U,X=h||this.options.stacking;if(!X||!this.reserveSpace()||({group:"xAxis"}[X]||"yAxis")!==Y.coll)return;let te=this.getColumn("x",!0),K=this.getColumn(this.pointValKey||"y",!0),re=[],ue=K.length,ge=this.options,ye=ge.threshold||0,xe=ge.startFromThreshold?ye:0,_e=ge.stack,ze=h?`${this.type},${X}`:this.stackKey||"",Re="-"+ze,ft=this.negStacks,St=Y.stacking,_t=St.stacks,Ot=St.oldStacks;for(St.stacksTouched+=1,U=0;U<ue;U++){let hi=te[U]||0,mi=K[U],Ai=Nl(mi)&&mi||0;B=(v=this.getStackIndicator(v,hi,this.index)).key||"",_t[z=(S=ft&&Ai<(xe?0:ye))?Re:ze]||(_t[z]={}),_t[z][hi]||((Pt=Ot[z])!=null&&Pt[hi]?(_t[z][hi]=Ot[z][hi],_t[z][hi].total=null):_t[z][hi]=new _a(Y,Y.options.stackLabels,!!S,hi,_e)),I=_t[z][hi],mi!==null?(I.points[B]=I.points[this.index]=[t(I.cumulative,xe)],zp(I.cumulative)||(I.base=B),I.touched=St.stacksTouched,v.index>0&&this.singleStacks===!1&&(I.points[B][0]=I.points[this.index+","+hi+",0"][0])):(delete I.points[B],delete I.points[this.index]);let ai=I.total||0;X==="percent"?(L=S?ze:Re,ai=ft&&((Ft=_t[L])!=null&&Ft[hi])?(L=_t[L][hi]).total=Math.max(L.total||0,ai)+Math.abs(Ai):Wn(ai+Math.abs(Ai))):X==="group"?Nl(mi)&&ai++:ai=Wn(ai+Ai),X==="group"?I.cumulative=(ai||1)-1:I.cumulative=Wn(t(I.cumulative,xe)+Ai),I.total=ai,mi!==null&&(I.points[B].push(I.cumulative),re[U]=I.cumulative,I.hasValidPoints=!0)}X==="percent"&&(St.usePercentage=!0),X!=="group"&&(this.stackedYData=re),St.oldStacks={}}class j{constructor(h){this.oldStacks={},this.stacks={},this.stacksTouched=0,this.axis=h}buildStacks(){let h,v,S=this.axis,I=S.series,L=S.coll==="xAxis",z=S.options.reversedStacks,B=I.length;for(this.resetStacks(),this.usePercentage=!1,v=B;v--;)h=I[z?v:B-v-1],L&&h.setGroupedPoints(S),h.setStackedPoints(S);if(!L)for(v=0;v<B;v++)I[v].modifyStacks();Fp(S,"afterBuildStacks")}cleanStacks(){this.oldStacks&&(this.stacks=this.oldStacks,u(this.stacks,h=>{u(h,v=>{v.cumulative=v.total})}))}resetStacks(){u(this.stacks,h=>{u(h,(v,S)=>{Nl(v.touched)&&v.touched<this.stacksTouched?(v.destroy(),delete h[S]):(v.total=null,v.cumulative=null)})})}renderStackTotals(){var B;let h=this.axis,v=h.chart,S=v.renderer,I=this.stacks,L=ya(v,((B=h.options.stackLabels)==null?void 0:B.animation)||!1),z=this.stackTotalGroup=this.stackTotalGroup||S.g("stack-labels").attr({zIndex:6,opacity:0}).add();z.translate(v.plotLeft,v.plotTop),u(I,U=>{u(U,X=>{X.render(z)})}),z.animate({opacity:1},L)}}(we||(we={})).compose=function(Y,h,v){let S=h.prototype,I=v.prototype;S.getStacks||(co(Y,"init",y),co(Y,"destroy",d),S.getStacks=n,I.getStackIndicator=b,I.modifyStacks=T,I.percentStacker=D,I.setGroupedPoints=F,I.setStackedPoints=V)};let H=we,{defined:W,merge:Q,isObject:ce}=Bi;class oe extends eo{drawGraph(){let h=this.options,v=(this.gappedPath||this.getGraphPath).call(this),S=this.chart.styledMode;[this,...this.zones].forEach((I,L)=>{let z,B=I.graph,U=B?"animate":"attr",X=I.dashStyle||h.dashStyle;B?(B.endX=this.preventGraphAnimation?null:v.xMap,B.animate({d:v})):v.length&&(I.graph=B=this.chart.renderer.path(v).addClass("highcharts-graph"+(L?` highcharts-zone-graph-${L-1} `:" ")+(L&&I.className||"")).attr({zIndex:1}).add(this.group)),B&&!S&&(z={stroke:!L&&h.lineColor||I.color||this.color||"#cccccc","stroke-width":h.lineWidth||0,fill:this.fillGraph&&this.color||"none"},X?z.dashstyle=X:h.linecap!=="square"&&(z["stroke-linecap"]=z["stroke-linejoin"]="round"),B[U](z).shadow(h.shadow&&Q({filterUnits:"userSpaceOnUse"},ce(h.shadow)?h.shadow:{}))),B&&(B.startX=v.xMap,B.isArea=v.isArea)})}getGraphPath(h,v,S){let I=this,L=I.options,z=[],B=[],U,X=L.step,te=(h=h||I.points).reversed;return te&&h.reverse(),(X={right:1,center:2}[X]||X&&3)&&te&&(X=4-X),(h=this.getValidPoints(h,!1,!(L.connectNulls&&!v&&!S))).forEach(function(K,re){let ue,ge=K.plotX,ye=K.plotY,xe=h[re-1],_e=K.isNull||typeof ye!="number";(K.leftCliff||xe&&xe.rightCliff)&&!S&&(U=!0),_e&&!W(v)&&re>0?U=!L.connectNulls:_e&&!v?U=!0:(re===0||U?ue=[["M",K.plotX,K.plotY]]:I.getPointSpline?ue=[I.getPointSpline(h,K,re)]:X?(ue=X===1?[["L",xe.plotX,ye]]:X===2?[["L",(xe.plotX+ge)/2,xe.plotY],["L",(xe.plotX+ge)/2,ye]]:[["L",ge,xe.plotY]]).push(["L",ge,ye]):ue=[["L",ge,ye]],B.push(K.x),X&&(B.push(K.x),X===2&&B.push(K.x)),z.push.apply(z,ue),U=!1)}),z.xMap=B,I.graphPath=z,z}}oe.defaultOptions=Q(eo.defaultOptions,{legendSymbol:"lineMarker"}),Gn.registerSeriesType("line",oe);let{seriesTypes:{line:de}}=Gn,{extend:pe,merge:Se,objectEach:ke,pick:Ie}=Bi;class Ue extends de{drawGraph(){this.areaPath=[],super.drawGraph.apply(this);let{areaPath:h,options:v}=this;[this,...this.zones].forEach((S,I)=>{let L={},z=S.fillColor||v.fillColor,B=S.area,U=B?"animate":"attr";B?(B.endX=this.preventGraphAnimation?null:h.xMap,B.animate({d:h})):(L.zIndex=0,(B=S.area=this.chart.renderer.path(h).addClass("highcharts-area"+(I?` highcharts-zone-area-${I-1} `:" ")+(I&&S.className||"")).add(this.group)).isArea=!0),this.chart.styledMode||(L.fill=z||S.color||this.color,L["fill-opacity"]=z?1:v.fillOpacity??.75,B.css({pointerEvents:this.stickyTracking?"none":"auto"})),B[U](L),B.startX=h.xMap,B.shiftUnit=v.step?2:1})}getGraphPath(h){let v,S,I,L=de.prototype.getGraphPath,z=this.options,B=z.stacking,U=this.yAxis,X=[],te=[],K=this.index,re=U.stacking.stacks[this.stackKey],ue=z.threshold,ge=Math.round(U.getThreshold(z.threshold)),ye=Ie(z.connectNulls,B==="percent"),xe=function(_t,Ot,Pt){let Ft=h[_t],hi=B&&re[Ft.x].points[K],mi=Ft[Pt+"Null"]||0,Ai=Ft[Pt+"Cliff"]||0,ai,Ci,Zi=!0;Ai||mi?(ai=(mi?hi[0]:hi[1])+Ai,Ci=hi[0]+Ai,Zi=!!mi):!B&&h[Ot]&&h[Ot].isNull&&(ai=Ci=ue),ai!==void 0&&(te.push({plotX:v,plotY:ai===null?ge:U.getThreshold(ai),isNull:Zi,isCliff:!0}),X.push({plotX:v,plotY:Ci===null?ge:U.getThreshold(Ci),doCurve:!1}))};h=h||this.points,B&&(h=this.getStackPoints(h));for(let _t=0,Ot=h.length;_t<Ot;++_t)B||(h[_t].leftCliff=h[_t].rightCliff=h[_t].leftNull=h[_t].rightNull=void 0),S=h[_t].isNull,v=Ie(h[_t].rectPlotX,h[_t].plotX),I=B?Ie(h[_t].yBottom,ge):ge,S&&!ye||(ye||xe(_t,_t-1,"left"),S&&!B&&ye||(te.push(h[_t]),X.push({x:_t,plotX:v,plotY:I})),ye||xe(_t,_t+1,"right"));let _e=L.call(this,te,!0,!0);X.reversed=!0;let ze=L.call(this,X,!0,!0),Re=ze[0];Re&&Re[0]==="M"&&(ze[0]=["L",Re[1],Re[2]]);let ft=_e.concat(ze);ft.length&&ft.push(["Z"]);let St=L.call(this,te,!1,ye);return this.chart.series.length>1&&B&&te.some(_t=>_t.isCliff)&&(ft.hasStackedCliffs=St.hasStackedCliffs=!0),ft.xMap=_e.xMap,this.areaPath=ft,St}getStackPoints(h){let v=this,S=[],I=[],L=this.xAxis,z=this.yAxis,B=z.stacking.stacks[this.stackKey],U={},X=z.series,te=X.length,K=z.options.reversedStacks?1:-1,re=X.indexOf(v);if(h=h||this.points,this.options.stacking){for(let ge=0;ge<h.length;ge++)h[ge].leftNull=h[ge].rightNull=void 0,U[h[ge].x]=h[ge];ke(B,function(ge,ye){ge.total!==null&&I.push(ye)}),I.sort(function(ge,ye){return ge-ye});let ue=X.map(ge=>ge.visible);I.forEach(function(ge,ye){let xe=0,_e,ze;if(U[ge]&&!U[ge].isNull)S.push(U[ge]),[-1,1].forEach(function(Re){let ft=Re===1?"rightNull":"leftNull",St=B[I[ye+Re]],_t=0;if(St){let Ot=re;for(;Ot>=0&&Ot<te;){let Pt=X[Ot].index;!(_e=St.points[Pt])&&(Pt===v.index?U[ge][ft]=!0:ue[Ot]&&(ze=B[ge].points[Pt])&&(_t-=ze[1]-ze[0])),Ot+=K}}U[ge][Re===1?"rightCliff":"leftCliff"]=_t});else{let Re=re;for(;Re>=0&&Re<te;){let ft=X[Re].index;if(_e=B[ge].points[ft]){xe=_e[1];break}Re+=K}xe=Ie(xe,0),xe=z.translate(xe,0,1,0,1),S.push({isNull:!0,plotX:L.translate(ge,0,0,0,1),x:ge,plotY:xe,yBottom:xe})}})}return S}}Ue.defaultOptions=Se(de.defaultOptions,{threshold:0,legendSymbol:"areaMarker"}),pe(Ue.prototype,{singleStacks:!1}),Gn.registerSeriesType("area",Ue);let{line:Le}=Gn.seriesTypes,{merge:Be,pick:Oe}=Bi;class He extends Le{getPointSpline(h,v,S){let I,L,z,B,U=v.plotX||0,X=v.plotY||0,te=h[S-1],K=h[S+1];function re(ge){return ge&&!ge.isNull&&ge.doCurve!==!1&&!v.isCliff}if(re(te)&&re(K)){let ge=te.plotX||0,ye=te.plotY||0,xe=K.plotX||0,_e=K.plotY||0,ze=0;I=(1.5*U+ge)/2.5,L=(1.5*X+ye)/2.5,z=(1.5*U+xe)/2.5,B=(1.5*X+_e)/2.5,z!==I&&(ze=(B-L)*(z-U)/(z-I)+X-B),L+=ze,B+=ze,L>ye&&L>X?(L=Math.max(ye,X),B=2*X-L):L<ye&&L<X&&(L=Math.min(ye,X),B=2*X-L),B>_e&&B>X?(B=Math.max(_e,X),L=2*X-B):B<_e&&B<X&&(B=Math.min(_e,X),L=2*X-B),v.rightContX=z,v.rightContY=B,v.controlPoints={low:[I,L],high:[z,B]}}let ue=["C",Oe(te.rightContX,te.plotX,0),Oe(te.rightContY,te.plotY,0),Oe(I,U,0),Oe(L,X,0),U,X];return te.rightContX=te.rightContY=void 0,ue}}He.defaultOptions=Be(Le.defaultOptions),Gn.registerSeriesType("spline",He);let Qe=He,{area:xt,area:{prototype:ut}}=Gn.seriesTypes,{extend:It,merge:At}=Bi;class ot extends Qe{}ot.defaultOptions=At(Qe.defaultOptions,xt.defaultOptions),It(ot.prototype,{getGraphPath:ut.getGraphPath,getStackPoints:ut.getStackPoints,drawGraph:ut.drawGraph}),Gn.registerSeriesType("areaspline",ot);let{animObject:wt}=se,{parse:Vt}=Jr,{noop:st}=Ne,{clamp:Dt,crisp:bt,defined:Kt,extend:Bt,fireEvent:kt,isArray:$t,isNumber:Xt,merge:ci,pick:di,objectEach:Fi}=Bi;class Mi extends eo{animate(h){let v,S,I=this,L=this.yAxis,z=L.pos,B=L.reversed,U=I.options,{clipOffset:X,inverted:te}=this.chart,K={},re=te?"translateX":"translateY";h&&X?(K.scaleY=.001,S=Dt(L.toPixels(U.threshold||0),z,z+L.len),te?(S+=B?-Math.floor(X[0]):Math.ceil(X[2]),K.translateX=S-L.len):(S+=B?Math.ceil(X[0]):-Math.floor(X[2]),K.translateY=S),I.clipBox&&I.setClip(),I.group.attr(K)):(v=Number(I.group.attr(re)),I.group.animate({scaleY:1},Bt(wt(I.options.animation),{step:function(ue,ge){I.group&&(K[re]=v+ge.pos*(z-v),I.group.attr(K))}})))}init(h,v){super.init.apply(this,arguments);let S=this;(h=S.chart).hasRendered&&h.series.forEach(function(I){I.type===S.type&&(I.isDirty=!0)})}getColumnMetrics(){var ye,xe;let h=this,v=h.options,S=h.xAxis,I=h.yAxis,L=S.options.reversedStacks,z=S.reversed&&!L||!S.reversed&&L,B={},U,X=0;v.grouping===!1?X=1:h.chart.series.forEach(function(_e){let ze,Re=_e.yAxis,ft=_e.options;_e.type===h.type&&_e.reserveSpace()&&I.len===Re.len&&I.pos===Re.pos&&(ft.stacking&&ft.stacking!=="group"?(B[U=_e.stackKey]===void 0&&(B[U]=X++),ze=B[U]):ft.grouping!==!1&&(ze=X++),_e.columnIndex=ze)});let te=Math.min(Math.abs(S.transA)*(!((ye=S.brokenAxis)!=null&&ye.hasBreaks)&&((xe=S.ordinal)==null?void 0:xe.slope)||v.pointRange||S.closestPointRange||S.tickInterval||1),S.len),K=te*v.groupPadding,re=(te-2*K)/(X||1),ue=Math.min(v.maxPointWidth||S.len,di(v.pointWidth,re*(1-2*v.pointPadding))),ge=(h.columnIndex||0)+(z?1:0);return h.columnMetrics={width:ue,offset:(re-ue)/2+(K+ge*re-te/2)*(z?-1:1),paddedWidth:re,columnCount:X},h.columnMetrics}crispCol(h,v,S,I){let L=this.borderWidth,z=this.chart.inverted;return I=bt(v+I,L,z)-(v=bt(v,L,z)),this.options.crisp&&(S=bt(h+S,L)-(h=bt(h,L))),{x:h,y:v,width:S,height:I}}adjustForMissingColumns(h,v,S,I){var L;if(!S.isNull&&I.columnCount>1){let z=this.xAxis.series.filter(te=>te.visible).map(te=>te.index),B=0,U=0;Fi((L=this.xAxis.stacking)==null?void 0:L.stacks,te=>{var ge;let K=typeof S.x=="number"?(ge=te[S.x.toString()])==null?void 0:ge.points:void 0,re=K==null?void 0:K[this.index],ue={};if(K&&$t(re)){let ye=this.index,xe=Object.keys(K).filter(_e=>!_e.match(",")&&K[_e]&&K[_e].length>1).map(parseFloat).filter(_e=>z.indexOf(_e)!==-1).filter(_e=>{let ze=this.chart.series[_e].options,Re=ze.stacking&&ze.stack;if(Kt(Re)){if(Xt(ue[Re]))return ye===_e&&(ye=ue[Re]),!1;ue[Re]=_e}return!0}).sort((_e,ze)=>ze-_e);B=xe.indexOf(ye),U=xe.length}}),B=this.xAxis.reversed?U-1-B:B;let X=(U-1)*I.paddedWidth+v;h=(S.plotX||0)+X/2-v-B*I.paddedWidth}return h}translate(){let h=this,v=h.chart,S=h.options,I=h.dense=h.closestPointRange*h.xAxis.transA<2,L=h.borderWidth=di(S.borderWidth,I?0:1),z=h.xAxis,B=h.yAxis,U=S.threshold,X=di(S.minPointLength,5),te=h.getColumnMetrics(),K=te.width,re=h.pointXOffset=te.offset,ue=h.dataMin,ge=h.dataMax,ye=h.translatedThreshold=B.getThreshold(U),xe=h.barW=Math.max(K,1+2*L);S.pointPadding&&S.crisp&&(xe=Math.ceil(xe)),eo.prototype.translate.apply(h),h.points.forEach(function(_e){let ze=di(_e.yBottom,ye),Re=999+Math.abs(ze),ft=_e.plotX||0,St=Dt(_e.plotY,-Re,B.len+Re),_t,Ot=Math.min(St,ze),Pt=Math.max(St,ze)-Ot,Ft=K,hi=ft+re,mi=xe;X&&Math.abs(Pt)<X&&(Pt=X,_t=!B.reversed&&!_e.negative||B.reversed&&_e.negative,Xt(U)&&Xt(ge)&&_e.y===U&&ge<=U&&(B.min||0)<U&&(ue!==ge||(B.max||0)<=U)&&(_t=!_t,_e.negative=!_e.negative),Ot=Math.abs(Ot-ye)>X?ze-X:ye-(_t?X:0)),Kt(_e.options.pointWidth)&&(hi-=Math.round(((Ft=mi=Math.ceil(_e.options.pointWidth))-K)/2)),S.centerInCategory&&(hi=h.adjustForMissingColumns(hi,Ft,_e,te)),_e.barX=hi,_e.pointWidth=Ft,_e.tooltipPos=v.inverted?[Dt(B.len+B.pos-v.plotLeft-St,B.pos-v.plotLeft,B.len+B.pos-v.plotLeft),z.len+z.pos-v.plotTop-hi-mi/2,Pt]:[z.left-v.plotLeft+hi+mi/2,Dt(St+B.pos-v.plotTop,B.pos-v.plotTop,B.len+B.pos-v.plotTop),Pt],_e.shapeType=h.pointClass.prototype.shapeType||"roundedRect",_e.shapeArgs=h.crispCol(hi,_e.isNull?ye:Ot,mi,_e.isNull?0:Pt)}),kt(this,"afterColumnTranslate")}drawGraph(){this.group[this.dense?"addClass":"removeClass"]("highcharts-dense-data")}pointAttribs(h,v){let S=this.options,I=this.pointAttrToOptions||{},L=I.stroke||"borderColor",z=I["stroke-width"]||"borderWidth",B,U,X,te=h&&h.color||this.color,K=h&&h[L]||S[L]||te,re=h&&h.options.dashStyle||S.dashStyle,ue=h&&h[z]||S[z]||this[z]||0,ge=di(h&&h.opacity,S.opacity,1);h&&this.zones.length&&(U=h.getZone(),te=h.options.color||U&&(U.color||h.nonZonedColor)||this.color,U&&(K=U.borderColor||K,re=U.dashStyle||re,ue=U.borderWidth||ue)),v&&h&&(X=(B=ci(S.states[v],h.options.states&&h.options.states[v]||{})).brightness,te=B.color||X!==void 0&&Vt(te).brighten(B.brightness).get()||te,K=B[L]||K,ue=B[z]||ue,re=B.dashStyle||re,ge=di(B.opacity,ge));let ye={fill:te,stroke:K,"stroke-width":ue,opacity:ge};return re&&(ye.dashstyle=re),ye}drawPoints(h=this.points){let v,S=this,I=this.chart,L=S.options,z=I.renderer,B=L.animationLimit||250;h.forEach(function(U){let X=U.plotY,te=U.graphic,K=!!te,re=te&&I.pointCount<B?"animate":"attr";Xt(X)&&U.y!==null?(v=U.shapeArgs,te&&U.hasNewShapeType()&&(te=te.destroy()),S.enabledDataSorting&&(U.startXPos=S.xAxis.reversed?-(v&&v.width||0):S.xAxis.width),!te&&(U.graphic=te=z[U.shapeType](v).add(U.group||S.group),te&&S.enabledDataSorting&&I.hasRendered&&I.pointCount<B&&(te.attr({x:U.startXPos}),K=!0,re="animate")),te&&K&&te[re](ci(v)),I.styledMode||te[re](S.pointAttribs(U,U.selected&&"select")).shadow(U.allowShadow!==!1&&L.shadow),te&&(te.addClass(U.getClassName(),!0),te.attr({visibility:U.visible?"inherit":"hidden"}))):te&&(U.graphic=te.destroy())})}drawTracker(h=this.points){let v,S=this,I=S.chart,L=I.pointer,z=function(B){L==null||L.normalize(B);let U=L==null?void 0:L.getPointFromEvent(B),X=!I.scrollablePlotArea||I.isInsidePlot(B.chartX-I.plotLeft,B.chartY-I.plotTop,{visiblePlotOnly:!0});L&&U&&S.options.enableMouseTracking&&X&&(L.isDirectTouch=!0,U.onMouseOver(B))};h.forEach(function(B){v=$t(B.dataLabels)?B.dataLabels:B.dataLabel?[B.dataLabel]:[],B.graphic&&(B.graphic.element.point=B),v.forEach(function(U){(U.div||U.element).point=B})}),S._hasTracking||(S.trackerGroups.forEach(function(B){S[B]&&(S[B].addClass("highcharts-tracker").on("mouseover",z).on("mouseout",function(U){L==null||L.onTrackerMouseOut(U)}).on("touchstart",z),!I.styledMode&&S.options.cursor&&S[B].css({cursor:S.options.cursor}))}),S._hasTracking=!0),kt(this,"afterDrawTracker")}remove(){let h=this,v=h.chart;v.hasRendered&&v.series.forEach(function(S){S.type===h.type&&(S.isDirty=!0)}),eo.prototype.remove.apply(h,arguments)}}Mi.defaultOptions=ci(eo.defaultOptions,{borderRadius:3,centerInCategory:!1,groupPadding:.2,marker:null,pointPadding:.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{halo:!1,brightness:.1},select:{color:"#cccccc",borderColor:"#000000"}},dataLabels:{align:void 0,verticalAlign:void 0,y:void 0},startFromThreshold:!0,stickyTracking:!1,tooltip:{distance:6},threshold:0,borderColor:"#ffffff"}),Bt(Mi.prototype,{directTouch:!0,getSymbol:st,negStacks:!0,trackerGroups:["group","dataLabelsGroup"]}),Gn.registerSeriesType("column",Mi);let Ei=Mi,{getDeferredAnimation:ji}=se,{format:pr}=Po,{defined:Cr,extend:dn,fireEvent:$r,getAlignFactor:$i,isArray:lr,isString:bi,merge:or,objectEach:Dr,pick:Mr,pInt:pn,splat:ns}=Bi;(function(Y){function h(){return U(this).some(te=>te==null?void 0:te.enabled)}function v(te,K,re,ue,ge){var hi;let{chart:ye,enabledDataSorting:xe}=this,_e=this.isCartesian&&ye.inverted,ze=te.plotX,Re=te.plotY,ft=re.rotation||0,St=Cr(ze)&&Cr(Re)&&ye.isInsidePlot(ze,Math.round(Re),{inverted:_e,paneCoordinates:!0,series:this}),_t=ft===0&&Mr(re.overflow,xe?"none":"justify")==="justify",Ot=this.visible&&te.visible!==!1&&Cr(ze)&&(te.series.forceDL||xe&&!_t||St||Mr(re.inside,!!this.options.stacking)&&ue&&ye.isInsidePlot(ze,_e?ue.x+1:ue.y+ue.height-1,{inverted:_e,paneCoordinates:!0,series:this})),Pt=te.pos();if(Ot&&Pt){var Ft;let mi=K.getBBox(),Ai=K.getBBox(void 0,0);if(ue=dn({x:Pt[0],y:Math.round(Pt[1]),width:0,height:0},ue||{}),re.alignTo==="plotEdges"&&this.isCartesian&&(ue[_e?"x":"y"]=0,ue[_e?"width":"height"]=((hi=this.yAxis)==null?void 0:hi.len)||0),dn(re,{width:mi.width,height:mi.height}),Ft=ue,xe&&this.xAxis&&!_t&&this.setDataLabelStartPos(te,K,ge,St,Ft),K.align(or(re,{width:Ai.width,height:Ai.height}),!1,ue,!1),K.alignAttr.x+=$i(re.align)*(Ai.width-mi.width),K.alignAttr.y+=$i(re.verticalAlign)*(Ai.height-mi.height),K[K.placed?"animate":"attr"]({"text-align":K.alignAttr["text-align"]||"center",x:K.alignAttr.x+(mi.width-Ai.width)/2,y:K.alignAttr.y+(mi.height-Ai.height)/2,rotationOriginX:(K.width||0)/2,rotationOriginY:(K.height||0)/2}),_t&&ue.height>=0)this.justifyDataLabel(K,re,K.alignAttr,mi,ue,ge);else if(Mr(re.crop,!0)){let{x:ai,y:Ci}=K.alignAttr;Ot=ye.isInsidePlot(ai,Ci,{paneCoordinates:!0,series:this})&&ye.isInsidePlot(ai+mi.width-1,Ci+mi.height-1,{paneCoordinates:!0,series:this})}re.shape&&!ft&&K[ge?"attr":"animate"]({anchorX:Pt[0],anchorY:Pt[1]})}ge&&xe&&(K.placed=!1),Ot||xe&&!_t?(K.show(),K.placed=!0):(K.hide(),K.placed=!1)}function S(){return this.plotGroup("dataLabelsGroup","data-labels",this.hasRendered?"inherit":"hidden",this.options.dataLabels.zIndex||6)}function I(te){let K=this.hasRendered||0,re=this.initDataLabelsGroup().attr({opacity:+K});return!K&&re&&(this.visible&&re.show(),this.options.animation?re.animate({opacity:1},te):re.attr({opacity:1})),re}function L(te){var Ot;let K;te=te||this.points;let re=this,ue=re.chart,ge=re.options,ye=ue.renderer,{backgroundColor:xe,plotBackgroundColor:_e}=ue.options.chart,ze=ye.getContrast(bi(_e)&&_e||bi(xe)&&xe||"#000000"),Re=U(re),{animation:ft,defer:St}=Re[0],_t=St?ji(ue,ft,re):{defer:0,duration:0};$r(this,"drawDataLabels"),(Ot=re.hasDataLabels)!=null&&Ot.call(re)&&(K=this.initDataLabels(_t),te.forEach(Pt=>{var mi,Ai;let Ft=Pt.dataLabels||[];ns(B(Re,Pt.dlOptions||((mi=Pt.options)==null?void 0:mi.dataLabels))).forEach((ai,Ci)=>{let Zi=ai.enabled&&(Pt.visible||Pt.dataLabelOnHidden)&&(!Pt.isNull||Pt.dataLabelOnNull)&&function(Ms,ss){let Es=ss.filter;if(Es){let os=Es.operator,Xn=Ms[Es.property],Bs=Es.value;return os===">"&&Xn>Bs||os==="<"&&Xn<Bs||os===">="&&Xn>=Bs||os==="<="&&Xn<=Bs||os==="=="&&Xn==Bs||os==="==="&&Xn===Bs||os==="!="&&Xn!=Bs||os==="!=="&&Xn!==Bs}return!0}(Pt,ai),{backgroundColor:kr,borderColor:Hi,distance:gr,style:Vi={}}=ai,Qi,_r,un,kn={},zr=Ft[Ci],Hr=!zr,Xr;Zi&&(_r=Cr(Qi=Mr(ai[Pt.formatPrefix+"Format"],ai.format))?pr(Qi,Pt,ue):(ai[Pt.formatPrefix+"Formatter"]||ai.formatter).call(Pt,ai),un=ai.rotation,!ue.styledMode&&(Vi.color=Mr(ai.color,Vi.color,bi(re.color)?re.color:void 0,"#000000"),Vi.color==="contrast"?(kr!=="none"&&(Xr=kr),Pt.contrastColor=ye.getContrast(Xr!=="auto"&&Xr||Pt.color||re.color),Vi.color=Xr||!Cr(gr)&&ai.inside||0>pn(gr||0)||ge.stacking?Pt.contrastColor:ze):delete Pt.contrastColor,ge.cursor&&(Vi.cursor=ge.cursor)),kn={r:ai.borderRadius||0,rotation:un,padding:ai.padding,zIndex:1},ue.styledMode||(kn.fill=kr==="auto"?Pt.color:kr,kn.stroke=Hi==="auto"?Pt.color:Hi,kn["stroke-width"]=ai.borderWidth),Dr(kn,(Ms,ss)=>{Ms===void 0&&delete kn[ss]})),!zr||Zi&&Cr(_r)&&!!zr.div==!!ai.useHTML&&(zr.rotation&&ai.rotation||zr.rotation===ai.rotation)||(zr=void 0,Hr=!0),Zi&&Cr(_r)&&(zr?kn.text=_r:(zr=ye.label(_r,0,0,ai.shape,void 0,void 0,ai.useHTML,void 0,"data-label")).addClass(" highcharts-data-label-color-"+Pt.colorIndex+" "+(ai.className||"")+(ai.useHTML?" highcharts-tracker":"")),zr&&(zr.options=ai,zr.attr(kn),ue.styledMode?Vi.width&&zr.css({width:Vi.width,textOverflow:Vi.textOverflow,whiteSpace:Vi.whiteSpace}):zr.css(Vi).shadow(ai.shadow),$r(zr,"beforeAddingDataLabel",{labelOptions:ai,point:Pt}),zr.added||zr.add(K),re.alignDataLabel(Pt,zr,ai,void 0,Hr),zr.isActive=!0,Ft[Ci]&&Ft[Ci]!==zr&&Ft[Ci].destroy(),Ft[Ci]=zr))});let hi=Ft.length;for(;hi--;)Ft[hi]&&Ft[hi].isActive?Ft[hi].isActive=!1:((Ai=Ft[hi])==null||Ai.destroy(),Ft.splice(hi,1));Pt.dataLabel=Ft[0],Pt.dataLabels=Ft})),$r(this,"afterDrawDataLabels")}function z(te,K,re,ue,ge,ye){let xe=this.chart,_e=K.align,ze=K.verticalAlign,Re=te.box?0:te.padding||0,ft=xe.inverted?this.yAxis:this.xAxis,St=ft?ft.left-xe.plotLeft:0,_t=xe.inverted?this.xAxis:this.yAxis,Ot=_t?_t.top-xe.plotTop:0,{x:Pt=0,y:Ft=0}=K,hi,mi;return(hi=(re.x||0)+Re+St)<0&&(_e==="right"&&Pt>=0?(K.align="left",K.inside=!0):Pt-=hi,mi=!0),(hi=(re.x||0)+ue.width-Re+St)>xe.plotWidth&&(_e==="left"&&Pt<=0?(K.align="right",K.inside=!0):Pt+=xe.plotWidth-hi,mi=!0),(hi=re.y+Re+Ot)<0&&(ze==="bottom"&&Ft>=0?(K.verticalAlign="top",K.inside=!0):Ft-=hi,mi=!0),(hi=(re.y||0)+ue.height-Re+Ot)>xe.plotHeight&&(ze==="top"&&Ft<=0?(K.verticalAlign="bottom",K.inside=!0):Ft+=xe.plotHeight-hi,mi=!0),mi&&(K.x=Pt,K.y=Ft,te.placed=!ye,te.align(K,void 0,ge)),mi}function B(te,K){let re=[],ue;if(lr(te)&&!lr(K))re=te.map(function(ge){return or(ge,K)});else if(lr(K)&&!lr(te))re=K.map(function(ge){return or(te,ge)});else if(lr(te)||lr(K)){if(lr(te)&&lr(K))for(ue=Math.max(te.length,K.length);ue--;)re[ue]=or(te[ue],K[ue])}else re=or(te,K);return re}function U(te){var re,ue;let K=te.chart.options.plotOptions;return ns(B(B((re=K==null?void 0:K.series)==null?void 0:re.dataLabels,(ue=K==null?void 0:K[te.type])==null?void 0:ue.dataLabels),te.options.dataLabels))}function X(te,K,re,ue,ge){let ye=this.chart,xe=ye.inverted,_e=this.xAxis,ze=_e.reversed,Re=((xe?K.height:K.width)||0)/2,ft=te.pointWidth,St=ft?ft/2:0;K.startXPos=xe?ge.x:ze?-Re-St:_e.width-Re+St,K.startYPos=xe?ze?this.yAxis.height-Re+St:-Re-St:ge.y,ue?K.visibility==="hidden"&&(K.show(),K.attr({opacity:0}).animate({opacity:1})):K.attr({opacity:1}).animate({opacity:0},void 0,K.hide),ye.hasRendered&&(re&&K.attr({x:K.startXPos,y:K.startYPos}),K.placed=!0)}Y.compose=function(te){let K=te.prototype;K.initDataLabels||(K.initDataLabels=I,K.initDataLabelsGroup=S,K.alignDataLabel=v,K.drawDataLabels=L,K.justifyDataLabel=z,K.setDataLabelStartPos=X,K.hasDataLabels=h)}})(Pe||(Pe={}));let Tn=Pe,{composed:qn}=Ne,{series:Eo}=Gn,{merge:Hs,pick:rn,pushUnique:Gr}=Bi;(function(Y){function h(v,S,I,L,z){let B=this.chart.inverted,U=v.series,X=(U.xAxis?U.xAxis.len:this.chart.plotSizeX)||0,te=(U.yAxis?U.yAxis.len:this.chart.plotSizeY)||0,K=v.dlBox||v.shapeArgs,re=rn(v.below,v.plotY>rn(this.translatedThreshold,te)),ue=rn(I.inside,!!this.options.stacking);if(K){if(L=Hs(K),!(I.overflow==="allow"&&I.crop===!1)){L.y<0&&(L.height+=L.y,L.y=0);let ge=L.y+L.height-te;ge>0&&ge<L.height-1&&(L.height-=ge)}B&&(L={x:te-L.y-L.height,y:X-L.x-L.width,width:L.height,height:L.width}),ue||(B?(L.x+=re?0:L.width,L.width=0):(L.y+=re?L.height:0,L.height=0))}I.align=rn(I.align,!B||ue?"center":re?"right":"left"),I.verticalAlign=rn(I.verticalAlign,B||ue?"middle":re?"top":"bottom"),Eo.prototype.alignDataLabel.call(this,v,S,I,L,z),I.inside&&v.contrastColor&&S.css({color:v.contrastColor})}Y.compose=function(v){Tn.compose(Eo),Gr(qn,"ColumnDataLabel")&&(v.prototype.alignDataLabel=h)}})(Ve||(Ve={}));let Br=Ve,{extend:mr,merge:Dn}=Bi;class Yn extends Ei{}Yn.defaultOptions=Dn(Ei.defaultOptions,{}),mr(Yn.prototype,{inverted:!0}),Gn.registerSeriesType("bar",Yn);let{column:jr,line:zs}=Gn.seriesTypes,{addEvent:ta,extend:Co,merge:ho}=Bi;class Vo extends zs{applyJitter(){let h=this,v=this.options.jitter,S=this.points.length;v&&this.points.forEach(function(I,L){["x","y"].forEach(function(z,B){if(v[z]&&!I.isNull){let U=`plot${z.toUpperCase()}`,X=h[`${z}Axis`],te=v[z]*X.transA;if(X&&!X.logarithmic){let K=Math.max(0,(I[U]||0)-te),re=Math.min(X.len,(I[U]||0)+te);I[U]=K+(re-K)*function(ue){let ge=1e4*Math.sin(ue);return ge-Math.floor(ge)}(L+B*S),z==="x"&&(I.clientX=I.plotX)}}})})}drawGraph(){this.options.lineWidth?super.drawGraph():this.graph&&(this.graph=this.graph.destroy())}}Vo.defaultOptions=ho(zs.defaultOptions,{lineWidth:0,findNearestPointBy:"xy",jitter:{x:0,y:0},marker:{enabled:!0},tooltip:{headerFormat:'<span style="color:{point.color}">●</span> <span style="font-size: 0.8em"> {series.name}</span><br/>',pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>"}}),Co(Vo.prototype,{drawTracker:jr.prototype.drawTracker,sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","markerGroup","dataLabelsGroup"]}),ta(Vo,"afterTranslate",function(){this.applyJitter()}),Gn.registerSeriesType("scatter",Vo);let{deg2rad:Uo}=Ne,{fireEvent:jo,isNumber:nl,pick:$o,relativeLength:Cc}=Bi;(function(Y){Y.getCenter=function(){let h=this.options,v=this.chart,S=2*(h.slicedOffset||0),I=v.plotWidth-2*S,L=v.plotHeight-2*S,z=h.center,B=Math.min(I,L),U=h.thickness,X,te=h.size,K=h.innerSize||0,re,ue;typeof te=="string"&&(te=parseFloat(te)),typeof K=="string"&&(K=parseFloat(K));let ge=[$o(z==null?void 0:z[0],"50%"),$o(z==null?void 0:z[1],"50%"),$o(te&&te<0?void 0:h.size,"100%"),$o(K&&K<0?void 0:h.innerSize||0,"0%")];for(!v.angular||this instanceof eo||(ge[3]=0),re=0;re<4;++re)ue=ge[re],X=re<2||re===2&&/%$/.test(ue),ge[re]=Cc(ue,[I,L,B,ge[2]][re])+(X?S:0);return ge[3]>ge[2]&&(ge[3]=ge[2]),nl(U)&&2*U<ge[2]&&U>0&&(ge[3]=ge[2]-2*U),jo(this,"afterGetCenter",{positions:ge}),ge},Y.getStartAndEndRadians=function(h,v){let S=nl(h)?h:0,I=nl(v)&&v>S&&v-S<360?v:S+360;return{start:Uo*(S+-90),end:Uo*(I+-90)}}})(We||(We={}));let Ac=We,{setAnimation:bd}=se,{addEvent:wd,defined:h_,extend:k0,isNumber:O0,pick:d_,relativeLength:p_}=Bi;class Jm extends Jo{getConnectorPath(h){let v=h.dataLabelPosition,S=h.options||{},I=S.connectorShape,L=this.connectorShapes[I]||I;return v&&L.call(this,{...v.computed,alignment:v.alignment},v.connectorPosition,S)||[]}getTranslate(){return this.sliced&&this.slicedTranslation||{translateX:0,translateY:0}}haloPath(h){let v=this.shapeArgs;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(v.x,v.y,v.r+h,v.r+h,{innerR:v.r-1,start:v.start,end:v.end,borderRadius:v.borderRadius})}constructor(h,v,S){super(h,v,S),this.half=0,this.name??(this.name="Slice");let I=L=>{this.slice(L.type==="select")};wd(this,"select",I),wd(this,"unselect",I)}isValid(){return O0(this.y)&&this.y>=0}setVisible(h,v=!0){h!==this.visible&&this.update({visible:h??!this.visible},v,void 0,!1)}slice(h,v,S){let I=this.series;bd(S,I.chart),v=d_(v,!0),this.sliced=this.options.sliced=h=h_(h)?h:!this.sliced,I.options.data[I.data.indexOf(this)]=this.options,this.graphic&&this.graphic.animate(this.getTranslate())}}k0(Jm.prototype,{connectorShapes:{fixedOffset:function(Y,h,v){let S=h.breakAt,I=h.touchingSliceAt,L=v.softConnector?["C",Y.x+(Y.alignment==="left"?-5:5),Y.y,2*S.x-I.x,2*S.y-I.y,S.x,S.y]:["L",S.x,S.y];return[["M",Y.x,Y.y],L,["L",I.x,I.y]]},straight:function(Y,h){let v=h.touchingSliceAt;return[["M",Y.x,Y.y],["L",v.x,v.y]]},crookedLine:function(Y,h,v){let{angle:S=this.angle||0,breakAt:I,touchingSliceAt:L}=h,{series:z}=this,[B,U,X]=z.center,te=X/2,{plotLeft:K,plotWidth:re}=z.chart,ue=Y.alignment==="left",{x:ge,y:ye}=Y,xe=I.x;if(v.crookDistance){let ze=p_(v.crookDistance,1);xe=ue?B+te+(re+K-B-te)*(1-ze):K+(B-te)*ze}else xe=B+(U-ye)*Math.tan(S-Math.PI/2);let _e=[["M",ge,ye]];return(ue?xe<=ge&&xe>=I.x:xe>=ge&&xe<=I.x)&&_e.push(["L",xe,ye]),_e.push(["L",I.x,I.y],["L",L.x,L.y]),_e}}});let{getStartAndEndRadians:f_}=Ac,{noop:Qm}=Ne,{clamp:m_,extend:g_,fireEvent:Kf,merge:Vl,pick:Fs}=Bi;class Jf extends eo{animate(h){let v=this,S=v.points,I=v.startAngleRad;h||S.forEach(function(L){let z=L.graphic,B=L.shapeArgs;z&&B&&(z.attr({r:Fs(L.startR,v.center&&v.center[3]/2),start:I,end:I}),z.animate({r:B.r,start:B.start,end:B.end},v.options.animation))})}drawEmpty(){let h,v,S=this.startAngleRad,I=this.endAngleRad,L=this.options;this.total===0&&this.center?(h=this.center[0],v=this.center[1],this.graph||(this.graph=this.chart.renderer.arc(h,v,this.center[1]/2,0,S,I).addClass("highcharts-empty-series").add(this.group)),this.graph.attr({d:Zc.arc(h,v,this.center[2]/2,0,{start:S,end:I,innerR:this.center[3]/2})}),this.chart.styledMode||this.graph.attr({"stroke-width":L.borderWidth,fill:L.fillColor||"none",stroke:L.color||"#cccccc"})):this.graph&&(this.graph=this.graph.destroy())}drawPoints(){let h=this.chart.renderer;this.points.forEach(function(v){v.graphic&&v.hasNewShapeType()&&(v.graphic=v.graphic.destroy()),v.graphic||(v.graphic=h[v.shapeType](v.shapeArgs).add(v.series.group),v.delayedRendering=!0)})}generatePoints(){super.generatePoints(),this.updateTotals()}getX(h,v,S,I){let L=this.center,z=this.radii?this.radii[S.index]||0:L[2]/2,B=I.dataLabelPosition,U=(B==null?void 0:B.distance)||0,X=Math.asin(m_((h-L[1])/(z+U),-1,1));return L[0]+Math.cos(X)*(z+U)*(v?-1:1)+(U>0?(v?-1:1)*(I.padding||0):0)}hasData(){return!!this.dataTable.rowCount}redrawPoints(){let h,v,S,I,L=this,z=L.chart;this.drawEmpty(),L.group&&!z.styledMode&&L.group.shadow(L.options.shadow),L.points.forEach(function(B){let U={};v=B.graphic,!B.isNull&&v?(I=B.shapeArgs,h=B.getTranslate(),z.styledMode||(S=L.pointAttribs(B,B.selected&&"select")),B.delayedRendering?(v.setRadialReference(L.center).attr(I).attr(h),z.styledMode||v.attr(S).attr({"stroke-linejoin":"round"}),B.delayedRendering=!1):(v.setRadialReference(L.center),z.styledMode||Vl(!0,U,S),Vl(!0,U,I,h),v.animate(U)),v.attr({visibility:B.visible?"inherit":"hidden"}),v.addClass(B.getClassName(),!0)):v&&(B.graphic=v.destroy())})}sortByAngle(h,v){h.sort(function(S,I){return S.angle!==void 0&&(I.angle-S.angle)*v})}translate(h){Kf(this,"translate"),this.generatePoints();let v=this.options,S=v.slicedOffset,I=f_(v.startAngle,v.endAngle),L=this.startAngleRad=I.start,z=(this.endAngleRad=I.end)-L,B=this.points,U=v.ignoreHiddenPoint,X=B.length,te,K,re,ue,ge,ye,xe,_e=0;for(h||(this.center=h=this.getCenter()),ye=0;ye<X;ye++){xe=B[ye],te=L+_e*z,xe.isValid()&&(!U||xe.visible)&&(_e+=xe.percentage/100),K=L+_e*z;let ze={x:h[0],y:h[1],r:h[2]/2,innerR:h[3]/2,start:Math.round(1e3*te)/1e3,end:Math.round(1e3*K)/1e3};xe.shapeType="arc",xe.shapeArgs=ze,(re=(K+te)/2)>1.5*Math.PI?re-=2*Math.PI:re<-Math.PI/2&&(re+=2*Math.PI),xe.slicedTranslation={translateX:Math.round(Math.cos(re)*S),translateY:Math.round(Math.sin(re)*S)},ue=Math.cos(re)*h[2]/2,ge=Math.sin(re)*h[2]/2,xe.tooltipPos=[h[0]+.7*ue,h[1]+.7*ge],xe.half=re<-Math.PI/2||re>Math.PI/2?1:0,xe.angle=re}Kf(this,"afterTranslate")}updateTotals(){let h=this.points,v=h.length,S=this.options.ignoreHiddenPoint,I,L,z=0;for(I=0;I<v;I++)(L=h[I]).isValid()&&(!S||L.visible)&&(z+=L.y);for(I=0,this.total=z;I<v;I++)(L=h[I]).percentage=z>0&&(L.visible||!S)?L.y/z*100:0,L.total=z}}Jf.defaultOptions=Vl(eo.defaultOptions,{borderRadius:3,center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{connectorPadding:5,connectorShape:"crookedLine",crookDistance:void 0,distance:30,enabled:!0,formatter:function(){return this.isNull?void 0:this.name},softConnector:!0,x:0},fillColor:void 0,ignoreHiddenPoint:!0,inactiveOtherPoints:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,stickyTracking:!1,tooltip:{followPointer:!0},borderColor:"#ffffff",borderWidth:1,lineWidth:void 0,states:{hover:{brightness:.1}}}),g_(Jf.prototype,{axisTypes:[],directTouch:!0,drawGraph:void 0,drawTracker:Ei.prototype.drawTracker,getCenter:Ac.getCenter,getSymbol:Qm,invertible:!1,isCartesian:!1,noSharedTooltip:!0,pointAttribs:Ei.prototype.pointAttribs,pointClass:Jm,requireSorting:!1,searchPoint:Qm,trackerGroups:["group","dataLabelsGroup"]}),Gn.registerSeriesType("pie",Jf);let{composed:Bp,noop:L0}=Ne,{distribute:R0}=qo,{series:Sd}=Gn,{arrayMax:__,clamp:Cu,defined:Td,pick:z0,pushUnique:F0,relativeLength:y_}=Bi;(function(Y){let h={radialDistributionY:function(z,B){var U;return(((U=B.dataLabelPosition)==null?void 0:U.top)||0)+z.distributeBox.pos},radialDistributionX:function(z,B,U,X,te){let K=te.dataLabelPosition;return z.getX(U<((K==null?void 0:K.top)||0)+2||U>((K==null?void 0:K.bottom)||0)-2?X:U,B.half,B,te)},justify:function(z,B,U,X){var te;return X[0]+(z.half?-1:1)*(U+(((te=B.dataLabelPosition)==null?void 0:te.distance)||0))},alignToPlotEdges:function(z,B,U,X){let te=z.getBBox().width;return B?te+X:U-te-X},alignToConnectors:function(z,B,U,X){let te=0,K;return z.forEach(function(re){(K=re.dataLabel.getBBox().width)>te&&(te=K)}),B?te+X:U-te-X}};function v(z,B){let U=Math.PI/2,{start:X=0,end:te=0}=z.shapeArgs||{},K=z.angle||0;B>0&&X<U&&te>U&&K>U/2&&K<1.5*U&&(K=K<=U?Math.max(U/2,(X+U)/2):Math.min(1.5*U,(U+te)/2));let{center:re,options:ue}=this,ge=re[2]/2,ye=Math.cos(K),xe=Math.sin(K),_e=re[0]+ye*ge,ze=re[1]+xe*ge,Re=Math.min((ue.slicedOffset||0)+(ue.borderWidth||0),B/5);return{natural:{x:_e+ye*B,y:ze+xe*B},computed:{},alignment:B<0?"center":z.half?"right":"left",connectorPosition:{angle:K,breakAt:{x:_e+ye*Re,y:ze+xe*Re},touchingSliceAt:{x:_e,y:ze}},distance:B}}function S(){var Ot;let z=this,B=z.points,U=z.chart,X=U.plotWidth,te=U.plotHeight,K=U.plotLeft,re=Math.round(U.chartWidth/3),ue=z.center,ge=ue[2]/2,ye=ue[1],xe=[[],[]],_e=[0,0,0,0],ze=z.dataLabelPositioners,Re,ft,St,_t=0;z.visible&&((Ot=z.hasDataLabels)!=null&&Ot.call(z))&&(B.forEach(Pt=>{(Pt.dataLabels||[]).forEach(Ft=>{Ft.shortened&&(Ft.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),Ft.shortened=!1)})}),Sd.prototype.drawDataLabels.apply(z),B.forEach(Pt=>{(Pt.dataLabels||[]).forEach((Ft,hi)=>{var Ci;let mi=ue[2]/2,Ai=Ft.options,ai=y_((Ai==null?void 0:Ai.distance)||0,mi);hi===0&&xe[Pt.half].push(Pt),!Td((Ci=Ai==null?void 0:Ai.style)==null?void 0:Ci.width)&&Ft.getBBox().width>re&&(Ft.css({width:Math.round(.7*re)+"px"}),Ft.shortened=!0),Ft.dataLabelPosition=this.getDataLabelPosition(Pt,ai),_t=Math.max(_t,ai)})}),xe.forEach((Pt,Ft)=>{let hi=Pt.length,mi=[],Ai,ai,Ci=0,Zi;hi&&(z.sortByAngle(Pt,Ft-.5),_t>0&&(Ai=Math.max(0,ye-ge-_t),ai=Math.min(ye+ge+_t,U.plotHeight),Pt.forEach(kr=>{(kr.dataLabels||[]).forEach(Hi=>{var Vi;let gr=Hi.dataLabelPosition;gr&&gr.distance>0&&(gr.top=Math.max(0,ye-ge-gr.distance),gr.bottom=Math.min(ye+ge+gr.distance,U.plotHeight),Ci=Hi.getBBox().height||21,Hi.lineHeight=U.renderer.fontMetrics(Hi.text||Hi).h+2*Hi.padding,kr.distributeBox={target:(((Vi=Hi.dataLabelPosition)==null?void 0:Vi.natural.y)||0)-gr.top+Hi.lineHeight/2,size:Ci,rank:kr.y},mi.push(kr.distributeBox))})}),R0(mi,Zi=ai+Ci-Ai,Zi/5)),Pt.forEach(kr=>{(kr.dataLabels||[]).forEach(Hi=>{let gr=Hi.options||{},Vi=kr.distributeBox,Qi=Hi.dataLabelPosition,_r=(Qi==null?void 0:Qi.natural.y)||0,un=gr.connectorPadding||0,kn=Hi.lineHeight||21,zr=(kn-Hi.getBBox().height)/2,Hr=0,Xr=_r,Ms="inherit";if(Qi){if(mi&&Td(Vi)&&Qi.distance>0&&(Vi.pos===void 0?Ms="hidden":(St=Vi.size,Xr=ze.radialDistributionY(kr,Hi))),gr.justify)Hr=ze.justify(kr,Hi,ge,ue);else switch(gr.alignTo){case"connectors":Hr=ze.alignToConnectors(Pt,Ft,X,K);break;case"plotEdges":Hr=ze.alignToPlotEdges(Hi,Ft,X,K);break;default:Hr=ze.radialDistributionX(z,kr,Xr-zr,_r,Hi)}if(Qi.attribs={visibility:Ms,align:Qi.alignment},Qi.posAttribs={x:Hr+(gr.x||0)+({left:un,right:-un}[Qi.alignment]||0),y:Xr+(gr.y||0)-kn/2},Qi.computed.x=Hr,Qi.computed.y=Xr-zr,z0(gr.crop,!0)){let ss;Hr-(ft=Hi.getBBox().width)<un&&Ft===1?(ss=Math.round(ft-Hr+un),_e[3]=Math.max(ss,_e[3])):Hr+ft>X-un&&Ft===0&&(ss=Math.round(Hr+ft-X+un),_e[1]=Math.max(ss,_e[1])),Xr-St/2<0?_e[0]=Math.max(Math.round(-Xr+St/2),_e[0]):Xr+St/2>te&&(_e[2]=Math.max(Math.round(Xr+St/2-te),_e[2])),Qi.sideOverflow=ss}}})}))}),(__(_e)===0||this.verifyDataLabelOverflow(_e))&&(this.placeDataLabels(),this.points.forEach(Pt=>{(Pt.dataLabels||[]).forEach(Ft=>{var ai;let{connectorColor:hi,connectorWidth:mi=1}=Ft.options||{},Ai=Ft.dataLabelPosition;if(mi){let Ci;Re=Ft.connector,Ai&&Ai.distance>0?(Ci=!Re,Re||(Ft.connector=Re=U.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+Pt.colorIndex+(Pt.className?" "+Pt.className:"")).add(z.dataLabelsGroup)),U.styledMode||Re.attr({"stroke-width":mi,stroke:hi||Pt.color||"#666666"}),Re[Ci?"attr":"animate"]({d:Pt.getConnectorPath(Ft)}),Re.attr({visibility:(ai=Ai.attribs)==null?void 0:ai.visibility})):Re&&(Ft.connector=Re.destroy())}})})))}function I(){this.points.forEach(z=>{(z.dataLabels||[]).forEach(B=>{var X;let U=B.dataLabelPosition;U?(U.sideOverflow&&(B.css({width:Math.max(B.getBBox().width-U.sideOverflow,0)+"px",textOverflow:(((X=B.options)==null?void 0:X.style)||{}).textOverflow||"ellipsis"}),B.shortened=!0),B.attr(U.attribs),B[B.moved?"animate":"attr"](U.posAttribs),B.moved=!0):B&&B.attr({y:-9999})}),delete z.distributeBox},this)}function L(z){let B=this.center,U=this.options,X=U.center,te=U.minSize||80,K=te,re=U.size!==null;return!re&&(X[0]!==null?K=Math.max(B[2]-Math.max(z[1],z[3]),te):(K=Math.max(B[2]-z[1]-z[3],te),B[0]+=(z[3]-z[1])/2),X[1]!==null?K=Cu(K,te,B[2]-Math.max(z[0],z[2])):(K=Cu(K,te,B[2]-z[0]-z[2]),B[1]+=(z[0]-z[2])/2),K<B[2]?(B[2]=K,B[3]=Math.min(U.thickness?Math.max(0,K-2*U.thickness):Math.max(0,y_(U.innerSize||0,K)),K),this.translate(B),this.drawDataLabels&&this.drawDataLabels()):re=!0),re}Y.compose=function(z){if(Tn.compose(Sd),F0(Bp,"PieDataLabel")){let B=z.prototype;B.dataLabelPositioners=h,B.alignDataLabel=L0,B.drawDataLabels=S,B.getDataLabelPosition=v,B.placeDataLabels=I,B.verifyDataLabelOverflow=L}}})(rt||(rt={}));let B0=rt;(function(Y){Y.getCenterOfPoints=function(h){let v=h.reduce((S,I)=>(S.x+=I.x,S.y+=I.y,S),{x:0,y:0});return{x:v.x/h.length,y:v.y/h.length}},Y.getDistanceBetweenPoints=function(h,v){return Math.sqrt(Math.pow(v.x-h.x,2)+Math.pow(v.y-h.y,2))},Y.getAngleBetweenPoints=function(h,v){return Math.atan2(v.x-h.x,v.y-h.y)},Y.pointInPolygon=function({x:h,y:v},S){let I=S.length,L,z,B=!1;for(L=0,z=I-1;L<I;z=L++){let[U,X]=S[L],[te,K]=S[z];X>v!=K>v&&h<(te-U)*(v-X)/(K-X)+U&&(B=!B)}return B}})(ht||(ht={}));let{pointInPolygon:N0}=ht,{addEvent:V0,fireEvent:v_,objectEach:Qf,pick:U0}=Bi;function Md(Y){let h=Y.length,v=(te,K)=>!(K.x>=te.x+te.width||K.x+K.width<=te.x||K.y>=te.y+te.height||K.y+K.height<=te.y),S=(te,K)=>{for(let re of te)if(N0({x:re[0],y:re[1]},K))return!0;return!1},I,L,z,B,U,X=!1;for(let te=0;te<h;te++)(I=Y[te])&&(I.oldOpacity=I.opacity,I.newOpacity=1,I.absoluteBox=function(K){var re,ue;if(K&&(!K.alignAttr||K.placed)){let ge=K.box?0:K.padding||0,ye=K.alignAttr||{x:K.attr("x"),y:K.attr("y")},xe=K.getBBox();return K.width=xe.width,K.height=xe.height,{x:ye.x+(((re=K.parentGroup)==null?void 0:re.translateX)||0)+ge,y:ye.y+(((ue=K.parentGroup)==null?void 0:ue.translateY)||0)+ge,width:(K.width||0)-2*ge,height:(K.height||0)-2*ge,polygon:xe==null?void 0:xe.polygon}}}(I));Y.sort((te,K)=>(K.labelrank||0)-(te.labelrank||0));for(let te=0;te<h;++te){B=(L=Y[te])&&L.absoluteBox;let K=B==null?void 0:B.polygon;for(let re=te+1;re<h;++re){U=(z=Y[re])&&z.absoluteBox;let ue=!1;if(B&&U&&L!==z&&L.newOpacity!==0&&z.newOpacity!==0&&L.visibility!=="hidden"&&z.visibility!=="hidden"){let ge=U.polygon;if(K&&ge&&K!==ge?S(K,ge)&&(ue=!0):v(B,U)&&(ue=!0),ue){let ye=L.labelrank<z.labelrank?L:z,xe=ye.text;ye.newOpacity=0,xe!=null&&xe.element.querySelector("textPath")&&xe.hide()}}}}for(let te of Y)x_(te,this)&&(X=!0);X&&v_(this,"afterHideAllOverlappingLabels")}function x_(Y,h){let v,S,I=!1;return Y&&(S=Y.newOpacity,Y.oldOpacity!==S&&(Y.hasClass("highcharts-data-label")?(Y[S?"removeClass":"addClass"]("highcharts-data-label-hidden"),v=function(){h.styledMode||Y.css({pointerEvents:S?"auto":"none"})},I=!0,Y[Y.isOld?"animate":"attr"]({opacity:S},void 0,v),v_(h,"afterHideOverlappingLabel")):Y.attr({opacity:S})),Y.isOld=!0),I}function cs(){var v;let Y=this,h=[];for(let S of Y.labelCollectors||[])h=h.concat(S());for(let S of Y.yAxis||[])S.stacking&&S.options.stackLabels&&!S.options.stackLabels.allowOverlap&&Qf(S.stacking.stacks,I=>{Qf(I,L=>{L.label&&h.push(L.label)})});for(let S of Y.series||[])if(S.visible&&((v=S.hasDataLabels)!=null&&v.call(S))){let I=L=>{for(let z of L)z.visible&&(z.dataLabels||[]).forEach(B=>{var X;let U=B.options||{};B.labelrank=U0(U.labelrank,z.labelrank,(X=z.shapeArgs)==null?void 0:X.height),U.allowOverlap??Number(U.distance)>0?(B.oldOpacity=B.opacity,B.newOpacity=1,x_(B,Y)):h.push(B)})};I(S.nodes||[]),I(S.points)}this.hideOverlappingLabels(h)}let Np={compose:function(Y){let h=Y.prototype;h.hideOverlappingLabels||(h.hideOverlappingLabels=Md,V0(Y,"render",cs))}},{defaultOptions:b_}=zn,{noop:Vp}=Ne,{addEvent:Up,extend:jp,isObject:eg,merge:w_,relativeLength:wh}=Bi,tg={radius:0,scope:"stack",where:void 0},$p=Vp,S_=Vp;function T_(Y,h,v,S,I={}){let L=$p(Y,h,v,S,I),{innerR:z=0,r:B=v,start:U=0,end:X=0}=I;if(I.open||!I.borderRadius)return L;let te=X-U,K=Math.sin(te/2),re=Math.max(Math.min(wh(I.borderRadius||0,B-z),(B-z)/2,B*K/(1+K)),0),ue=Math.min(re,te/Math.PI*2*z),ge=L.length-1;for(;ge--;)(function(ye,xe,_e){let ze,Re,ft,St=ye[xe],_t=ye[xe+1];if(_t[0]==="Z"&&(_t=ye[0]),(St[0]==="M"||St[0]==="L")&&_t[0]==="A"?(ze=St,Re=_t,ft=!0):St[0]==="A"&&(_t[0]==="M"||_t[0]==="L")&&(ze=_t,Re=St),ze&&Re&&Re.params){let Ot=Re[1],Pt=Re[5],Ft=Re.params,{start:hi,end:mi,cx:Ai,cy:ai}=Ft,Ci=Pt?Ot-_e:Ot+_e,Zi=Ci?Math.asin(_e/Ci):0,kr=Pt?Zi:-Zi,Hi=Math.cos(Zi)*Ci;ft?(Ft.start=hi+kr,ze[1]=Ai+Hi*Math.cos(hi),ze[2]=ai+Hi*Math.sin(hi),ye.splice(xe+1,0,["A",_e,_e,0,0,1,Ai+Ot*Math.cos(Ft.start),ai+Ot*Math.sin(Ft.start)])):(Ft.end=mi-kr,Re[6]=Ai+Ot*Math.cos(Ft.end),Re[7]=ai+Ot*Math.sin(Ft.end),ye.splice(xe+1,0,["A",_e,_e,0,0,1,Ai+Hi*Math.cos(mi),ai+Hi*Math.sin(mi)])),Re[4]=Math.abs(Ft.end-Ft.start)<Math.PI?0:1}})(L,ge,ge>1?ue:re);return L}function ig(){var Y,h;if(this.options.borderRadius&&!(this.chart.is3d&&this.chart.is3d())){let{options:v,yAxis:S}=this,I=v.stacking==="percent",L=(h=(Y=b_.plotOptions)==null?void 0:Y[this.type])==null?void 0:h.borderRadius,z=Gp(v.borderRadius,eg(L)?L:{}),B=S.options.reversed;for(let U of this.points){let{shapeArgs:X}=U;if(U.shapeType==="roundedRect"&&X){let{width:te=0,height:K=0,y:re=0}=X,ue=re,ge=K;if(z.scope==="stack"&&U.stackTotal){let ze=S.translate(I?100:U.stackTotal,!1,!0,!1,!0),Re=S.translate(v.threshold||0,!1,!0,!1,!0),ft=this.crispCol(0,Math.min(ze,Re),0,Math.abs(ze-Re));ue=ft.y,ge=ft.height}let ye=(U.negative?-1:1)*(B?-1:1)==-1,xe=z.where;!xe&&this.is("waterfall")&&Math.abs((U.yBottom||0)-(this.translatedThreshold||0))>this.borderWidth&&(xe="all"),xe||(xe="end");let _e=Math.min(wh(z.radius,te),te/2,xe==="all"?K/2:1/0)||0;xe==="end"&&(ye&&(ue-=_e),ge+=_e),jp(X,{brBoxHeight:ge,brBoxY:ue,r:_e})}}}}function Gp(Y,h){return eg(Y)||(Y={radius:Y||0}),w_(tg,h,Y)}function rg(){let Y=Gp(this.options.borderRadius);for(let h of this.points){let v=h.shapeArgs;v&&(v.borderRadius=wh(Y.radius,(v.r||0)-(v.innerR||0)))}}function M_(Y,h,v,S,I={}){let L=S_(Y,h,v,S,I),{r:z=0,brBoxHeight:B=S,brBoxY:U=h}=I,X=h-U,te=U+B-(h+S),K=X-z>-.1?0:z,re=te-z>-.1?0:z,ue=Math.max(K&&X,0),ge=Math.max(re&&te,0),ye=[Y+K,h],xe=[Y+v-K,h],_e=[Y+v,h+K],ze=[Y+v,h+S-re],Re=[Y+v-re,h+S],ft=[Y+re,h+S],St=[Y,h+S-re],_t=[Y,h+K],Ot=(Pt,Ft)=>Math.sqrt(Math.pow(Pt,2)-Math.pow(Ft,2));if(ue){let Pt=Ot(K,K-ue);ye[0]-=Pt,xe[0]+=Pt,_e[1]=_t[1]=h+K-ue}if(S<K-ue){let Pt=Ot(K,K-ue-S);_e[0]=ze[0]=Y+v-K+Pt,Re[0]=Math.min(_e[0],Re[0]),ft[0]=Math.max(ze[0],ft[0]),St[0]=_t[0]=Y+K-Pt,_e[1]=_t[1]=h+S}if(ge){let Pt=Ot(re,re-ge);Re[0]+=Pt,ft[0]-=Pt,ze[1]=St[1]=h+S-re+ge}if(S<re-ge){let Pt=Ot(re,re-ge-S);_e[0]=ze[0]=Y+v-re+Pt,xe[0]=Math.min(_e[0],xe[0]),ye[0]=Math.max(ze[0],ye[0]),St[0]=_t[0]=Y+re-Pt,ze[1]=St[1]=h}return L.length=0,L.push(["M",...ye],["L",...xe],["A",K,K,0,0,1,..._e],["L",...ze],["A",re,re,0,0,1,...Re],["L",...ft],["A",re,re,0,0,1,...St],["L",..._t],["A",K,K,0,0,1,...ye],["Z"]),L}let{diffObjects:E_,extend:C_,find:A_,merge:ng,pick:va,uniqueKey:P_}=Bi;(function(Y){function h(S,I){let L=S.condition;(L.callback||function(){return this.chartWidth<=va(L.maxWidth,Number.MAX_VALUE)&&this.chartHeight<=va(L.maxHeight,Number.MAX_VALUE)&&this.chartWidth>=va(L.minWidth,0)&&this.chartHeight>=va(L.minHeight,0)}).call(this)&&I.push(S._id)}function v(S,I){let L=this.options.responsive,z=this.currentResponsive,B=[],U;!I&&L&&L.rules&&L.rules.forEach(K=>{K._id===void 0&&(K._id=P_()),this.matchResponsiveRule(K,B)},this);let X=ng(...B.map(K=>A_((L||{}).rules||[],re=>re._id===K)).map(K=>K&&K.chartOptions));X.isResponsiveOptions=!0,B=B.toString()||void 0;let te=z&&z.ruleIds;B===te||(z&&(this.currentResponsive=void 0,this.updatingResponsive=!0,this.update(z.undoOptions,S,!0),this.updatingResponsive=!1),B?((U=E_(X,this.options,!0,this.collectionsWithUpdate)).isResponsiveOptions=!0,this.currentResponsive={ruleIds:B,mergedOptions:X,undoOptions:U},this.updatingResponsive||this.update(X,S,!0)):this.currentResponsive=void 0)}Y.compose=function(S){let I=S.prototype;return I.matchResponsiveRule||C_(I,{matchResponsiveRule:h,setResponsive:v}),S}})(tt||(tt={}));let j0=tt;Ne.AST=pi,Ne.Axis=Za,Ne.Chart=Fl,Ne.Color=Jr,Ne.DataLabel=Tn,Ne.DataTableCore=on,Ne.Fx=Ps,Ne.HTMLElement=sc,Ne.Legend=Pp,Ne.LegendSymbol=hd,Ne.OverlappingDataLabels=Ne.OverlappingDataLabels||Np,Ne.PlotLineOrBand=cu,Ne.Point=Jo,Ne.Pointer=_c,Ne.RendererRegistry=Wc,Ne.Series=eo,Ne.SeriesRegistry=Gn,Ne.StackItem=_a,Ne.SVGElement=_o,Ne.SVGRenderer=ei,Ne.Templating=Po,Ne.Tick=Zo,Ne.Time=$a,Ne.Tooltip=fu,Ne.animate=se.animate,Ne.animObject=se.animObject,Ne.chart=Fl.chart,Ne.color=Jr.parse,Ne.dateFormat=Po.dateFormat,Ne.defaultOptions=zn.defaultOptions,Ne.distribute=qo.distribute,Ne.format=Po.format,Ne.getDeferredAnimation=se.getDeferredAnimation,Ne.getOptions=zn.getOptions,Ne.numberFormat=Po.numberFormat,Ne.seriesType=Gn.seriesType,Ne.setAnimation=se.setAnimation,Ne.setOptions=zn.setOptions,Ne.stop=se.stop,Ne.time=zn.defaultTime,Ne.timers=Ps.timers,{compose:function(Y,h,v){let S=Y.types.pie;if(!h.symbolCustomAttribs.includes("borderRadius")){let I=v.prototype.symbols;Up(Y,"afterColumnTranslate",ig,{order:9}),Up(S,"afterTranslate",rg),h.symbolCustomAttribs.push("borderRadius","brBoxHeight","brBoxY"),$p=I.arc,S_=I.roundedRect,I.arc=T_,I.roundedRect=M_}},optionsToObject:Gp}.compose(Ne.Series,Ne.SVGElement,Ne.SVGRenderer),Br.compose(Ne.Series.types.column),Tn.compose(Ne.Series),hp.compose(Ne.Axis),sc.compose(Ne.SVGRenderer),Pp.compose(Ne.Chart),Mf.compose(Ne.Axis),Np.compose(Ne.Chart),B0.compose(Ne.Series.types.pie),cu.compose(Ne.Chart,Ne.Axis),_c.compose(Ne.Chart),j0.compose(Ne.Chart),ga.compose(Ne.Axis,Ne.Chart,Ne.Series),H.compose(Ne.Axis,Ne.Chart,Ne.Series),fu.compose(Ne.Pointer),Bi.extend(Ne,Bi);let $0=Ne;return Rt.default})())}(By)),By.exports}var NB=BB();const VB=t_(NB),UB=({vesselId:m,fromDate:g,toDate:l})=>{const[c,_]=Ke.useState([]);Ke.useEffect(()=>{m&&g&&l&&A()},[m,g,l]);const A=async()=>{try{const we=await uA(m,g,l);_(we)}catch(we){console.error("Error fetching CII Graph Data:",we)}},N=c.map(we=>new Date(we.yDate).toLocaleDateString("en-GB",{day:"2-digit",month:"short"})),r=c.map(we=>we.ciIref),q=c.map(we=>we.ciide-we.ciicd),ie=c.map(we=>we.ciide-we.ciicd),ae=c.map(we=>we.ciicd-we.ciibc),he=c.map(we=>we.ciibc-we.ciiab),ve=c.map(we=>we.ciiab),Ae={chart:{type:"area",height:400,backgroundColor:"white",scrollablePlotArea:{minWidth:800,scrollPositionX:1}},title:{text:"IMO – Carbon Intensity Indicator (CII)",align:"left",style:{fontWeight:"bold",fontSize:"16px"}},xAxis:{categories:N,tickInterval:15,labels:{rotation:-45}},yAxis:{title:{text:"AER (gCO2/DWTxnm)"},min:Math.floor(c.reduce((we,Pe)=>Math.min(we,Pe.yxLow),1/0)*1e3)/1e3,max:Math.ceil(c.reduce((we,Pe)=>Math.max(we,Pe.yxUp),-1/0)*1e3)/1e3,tickInterval:.5,gridLineColor:"lightgray"},plotOptions:{area:{stacking:"normal",lineColor:"transparent",tooltip:{pointFormatter:()=>""},marker:{enabled:!1}}},series:[{name:"Red",data:q,type:"area",color:"red"},{name:"Orange",data:ie,type:"area",color:"orange"},{name:"Yellow",data:ae,type:"area",color:"yellow"},{name:"Light Green",data:he,type:"area",color:"lightgreen"},{name:"Dark Green",data:ve,type:"area",color:"green"},{name:"AER Trend",data:c.map(we=>we.ciicO2),type:"line",color:"blue",lineWidth:2,marker:{enabled:!1}},{name:"Reference Line",type:"line",data:r,dashStyle:"Dash",color:"black",lineWidth:2,marker:{enabled:!1}}],legend:{enabled:!1}};return gi.jsx(zB,{highcharts:VB,options:Ae})};function jB(m){const[g,l]=Ke.useState(!0),[c,_]=Ke.useState(null),[A,N]=Ke.useState(!1),r=()=>{l(!1),N(!0)};return Ke.useEffect(()=>{if(!document){const he=new Error(`[ScriptLoadingError] document not defined when attempting to load ${m}`);_(he);return}const q=document.querySelector(`script[src="${m}"]`);if(q!=null&&q.dataset.loaded){r();return}const ie=q||document.createElement("script");q||(ie.src=m);const ae=()=>{ie.dataset.loaded="1",r()};ie.addEventListener("load",ae),ie.addEventListener("error",he=>{console.error("Failed to load script:",m,he);const ve=new Error(`[ScriptLoadingError] Failed to load script: ${m}`);_(ve)}),q||document.head.append(ie)},[]),{isLoading:g,error:c,isSuccess:A}}const $B=m=>m&&m.charts,NT=(m,g)=>{const{controls:l,toolbarItems:c,getChartEditor:_}=m;return g&&g.charts&&g.visualization&&g.visualization.ChartWrapper&&g.visualization.Dashboard&&(!l||g.visualization.ChartWrapper)&&(!_||g.visualization.ChartEditor)&&(!c||g.visualization.drawToolbar)},GB=m=>window.google;function HB(m){const{chartVersion:g="current",chartPackages:l=["corechart","controls"],chartLanguage:c="en",mapsApiKey:_}=m,[A,N]=Ke.useState(null),[r,q]=Ke.useState(null),[ie,ae]=Ke.useState(null),{isLoading:he,error:ve,isSuccess:Ae}=jB(m.chartLoaderScriptUrl||"https://www.gstatic.com/charts/loader.js");return Ke.useEffect(()=>{if(!Ae)return;const we=GB();if(!$B(we)){const Pe=new Error("[ScriptInitializationError] Script loaded but Google not attached to window.");q(Pe);return}if(NT(m,we)){N(we);return}we.charts.load(g,{packages:l,language:c,mapsApiKey:_}),we.charts.setOnLoadCallback(()=>{if(!NT(m,we)){const Pe=new Error("[GoogleChartsInitializationError] Google Charts not ready after load callback.");console.error(Pe),ae(Pe);return}N(we)})},[Ae]),{error:ve||r||ie,isLoading:he,google:A}}const DM={legend_toggle:!1,options:{},legendToggle:!1,getChartWrapper:()=>{},spreadSheetQueryParameters:{headers:1,gid:1},rootProps:{},chartWrapperParams:{},chartLoaderScriptUrl:"https://www.gstatic.com/charts/loader.js"},WB=m=>{const{isReady:g,chartControls:l,filter:c}=m;return!g||!l||!(l!=null&&l.length)?null:Qt.createElement(Qt.Fragment,null,l.filter(_=>{let{controlProp:A,control:N}=_;return c?c({control:N,controlProp:A}):!0}).map(_=>{let{control:A}=_;return Qt.createElement("div",{key:A.getContainerId(),id:A.getContainerId()})}))};let VT=0;const kM=()=>(VT+=1,`reactgooglegraph-${VT}`),Iu=class Iu{};Li(Iu,"initializeControls",g=>{for(let l=0;l<g.length;l+=1){const{controlType:c,options:_,controlWrapperParams:A}=g[l].controlProp;A&&"state"in A&&g[l].control.setState(A.state),g[l].control.setOptions(_),g[l].control.setControlType(c)}}),Li(Iu,"listenToControlEvents",(g,l)=>{const{google:c}=l;return g.flatMap(_=>{const{control:A,controlProp:N}=_,{controlEvents:r=[]}=N;return r.map(q=>{const{callback:ie,eventName:ae}=q;return c.visualization.events.addListener(A,ae,function(){for(var he=arguments.length,ve=new Array(he),Ae=0;Ae<he;Ae++)ve[Ae]=arguments[Ae];ie({chartWrapper:null,controlWrapper:A,props:l,google:c,eventArgs:ve})})})})}),Li(Iu,"createControlId",g=>{let l;return typeof g>"u"?l=`googlechart-control-${kM()}`:l=g,l}),Li(Iu,"createChartControls",g=>{const{controls:l,google:c}=g;return l?l.map((_,A)=>{const{controlID:N,controlType:r,options:q,controlWrapperParams:ie}=_,ae=Iu.createControlId(N);return{controlProp:_,control:new c.visualization.ControlWrapper({containerId:ae,controlType:r,options:q,...ie})}}):null}),Li(Iu,"addControls",g=>{const{chartWrapper:l,chartDashboard:c}=g,_=Iu.createChartControls(g);return!_||!c||!l?null:(c.bind(_.map(A=>{let{control:N}=A;return N}),l),Iu.initializeControls(_),_)});let o0=Iu;const qB=m=>{const[g,l]=Ke.useState(null);return[Ke.useMemo(()=>!g||!m?null:m.map((_,A)=>{const N=g[A];return N?{controlProp:_,control:N}:void 0}).flatMap(_=>_?[_]:[]),[g,m]),l]},YB=(m,g)=>{Ke.useEffect(()=>{const l=o0.listenToControlEvents(m??[],g);return()=>{l.forEach(c=>{g.google.visualization.events.removeListener(c)})}},[m,g])},XB=m=>{const[g,l]=qB(m.controls);return YB(g??[],m),{addControls:_=>{const A=o0.addControls(_);l((A==null?void 0:A.map(N=>N.control))??null)},renderControl:_=>{const{chartWrapper:A,chartDashboard:N}=m;return Ke.createElement(WB,{...m,isReady:!!(A&&N),chartControls:g,filter:_})}}},ZB=m=>{const g=Ke.useRef(null);return{chartId:(()=>{const{graphID:_,graph_id:A}=m,N=_||A;let r;return N?r=N:r=g.current||kM(),g.current=r,g.current})()}},KB=["#3366CC","#DC3912","#FF9900","#109618","#990099","#3B3EAC","#0099C6","#DD4477","#66AA00","#B82E2E","#316395","#994499","#22AA99","#AAAA11","#6633CC","#E67300","#8B0707","#329262","#5574A6","#3B3EAC"],JB=async function(m,g){let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return new Promise((c,_)=>{const A=`${l.headers?`headers=${l.headers}`:"headers=0"}`,N=`${l.query?`&tq=${encodeURIComponent(l.query)}`:""}`,r=`${l.gid?`&gid=${l.gid}`:""}`,q=`${l.sheet?`&sheet=${l.sheet}`:""}`,ie=`${l.access_token?`&access_token=${l.access_token}`:""}`,ae=`${A}${r}${q}${N}${ie}`,he=`${g}/gviz/tq?${ae}`;new m.visualization.Query(he).send(Ae=>{Ae.isError()?_(`Error in query:  ${Ae.getMessage()} ${Ae.getDetailedMessage()}`):c(Ae.getDataTable())})})},QB="#CCCCCC",Gl=class Gl{};Li(Gl,"grayOutHiddenColumnsLabel",(g,l)=>{const{googleChartWrapper:c,options:_}=g;if(!c){console.error("googleChartWrapper is not defined");return}const A=c.getDataTable();if(!A)return;const N=A.getNumberOfColumns();if(l.length>0===!1)return;const q=Array.from({length:N-1}).map((ie,ae)=>{const he=Gl.getColumnId(A,ae+1);return l.includes(he)?QB:_&&_.colors?_.colors[ae]:KB[ae]});c.setOptions({..._,colors:q}),c.draw()}),Li(Gl,"listenToLegendToggle",(g,l)=>{const[c,_]=l,{google:A,googleChartWrapper:N}=g;if(!N){console.error("googleChartWrapper is not defined");return}return A.visualization.events.addListener(N,"select",()=>{const q=N.getChart().getSelection(),ie=N.getDataTable();if(q.length===0||q[0].row!==null||!ie)return;const ae=q[0].column,he=Gl.getColumnId(ie,ae);c!=null&&c.includes(he)?_(ve=>[...ve.filter(Ae=>Ae!==he)]):_(ve=>[...ve,he])})}),Li(Gl,"draw",async g=>{const{data:l,diffdata:c,rows:_,columns:A,options:N,chartType:r,formatters:q,spreadSheetUrl:ie,spreadSheetQueryParameters:ae,googleChartDashboard:he,googleChartWrapper:ve,google:Ae,hiddenColumns:we,legendToggle:Pe,legend_toggle:Ve}=g;if(!ve){console.error("draw was called with googleChartWrapper = null");return}let We,rt=null;if(c){const Ne=Ae.visualization.arrayToDataTable(c.old),Tt=Ae.visualization.arrayToDataTable(c.new);rt=Ae.visualization[r].prototype.computeDiff(Ne,Tt)}l?l instanceof Ae.visualization.DataTable?We=l:Array.isArray(l)?We=Ae.visualization.arrayToDataTable(l):We=new Ae.visualization.DataTable(l):_&&A?We=Ae.visualization.arrayToDataTable([A,..._]):ie?We=await JB(Ae,ie,ae):We=Ae.visualization.arrayToDataTable([]);const ht=We.getNumberOfColumns(),tt=Array(ht).fill(0).map((Ne,Tt)=>{const qt=Gl.getColumnId(We,Tt);return we.includes(qt)?{label:We.getColumnLabel(Tt),type:We.getColumnType(Tt),calc:()=>null}:Tt}),at=ve.getChart();ve.getChartType()==="Timeline"&&at&&at.clearChart(),ve.setChartType(r),ve.setOptions(N||{});const Rt=new Ae.visualization.DataView(We);Rt.setColumns(tt),ve.setDataTable(Rt),ve.draw(),he&&he.draw(We),rt&&(ve.setDataTable(rt),ve.draw()),q&&(Gl.applyFormatters({dataTable:We,formatters:q,google:Ae}),ve.setDataTable(We),ve.draw()),(Pe===!0||Ve===!0)&&Gl.grayOutHiddenColumnsLabel(g,we)}),Li(Gl,"getColumnId",(g,l)=>g.getColumnId(l)||g.getColumnLabel(l)),Li(Gl,"applyFormatters",g=>{let{dataTable:l,formatters:c,google:_}=g;for(let A of c)switch(A.type){case"ArrowFormat":{new _.visualization.ArrowFormat(A.options).format(l,A.column);return}case"BarFormat":{new _.visualization.BarFormat(A.options).format(l,A.column);return}case"ColorFormat":{const N=new _.visualization.ColorFormat(A.options),{ranges:r}=A;if(r)for(let q of r)N.addRange(...q);N.format(l,A.column);return}case"DateFormat":{new _.visualization.DateFormat(A.options).format(l,A.column);return}case"NumberFormat":{new _.visualization.NumberFormat(A.options).format(l,A.column);return}case"PatternFormat":{new _.visualization.PatternFormat(A.options).format(l,A.column);return}default:{console.warn(`Unknown formatter type: ${A.type}`);return}}});let Wg=Gl;const e4=m=>{const{google:g,googleChartWrapper:l,googleChartDashboard:c}=m,[_,A]=Ke.useState([]);Ke.useEffect(()=>{l&&Wg.draw({...m,hiddenColumns:_,googleChartWrapper:l,googleChartDashboard:c,google:g})},[_,m.data,m.rows,m.columns,m.options,m.chartLoaderScriptUrl,m.chartType,m.formatters,m.spreadSheetUrl,m.spreadSheetQueryParameters,m.legendToggle,m.legend_toggle]);const N=()=>{const{googleChartWrapper:ie}=m;ie&&ie.draw()},r=ie=>{const ae=[],{legendToggle:he,legend_toggle:ve}=m;if(Wg.draw({...m,hiddenColumns:_,googleChartWrapper:ie,googleChartDashboard:c,google:g}),window.addEventListener("resize",N),ve||he){const Ae=Wg.listenToLegendToggle(m,[_,A]);Ae&&ae.push(Ae)}return ae},q=(ie,ae)=>{window.removeEventListener("resize",N),ae.forEach(he=>{g.visualization.events.removeListener(he)}),ie.getChartType()==="Timeline"&&ie.getChart()&&ie.getChart().clearChart()};Ke.useEffect(()=>{if(!l)return;const ie=r(l);return()=>{q(l,ie)}},[l,r,q])},t4=m=>{const{chartEvents:g,google:l,googleChartWrapper:c}=m;if(g){if(!c){console.warn("listenToEvents was called before chart wrapper ready.");return}return g.map(_=>{let{eventName:A,callback:N}=_;return l.visualization.events.addListener(c,A,function(){for(var r=arguments.length,q=new Array(r),ie=0;ie<r;ie++)q[ie]=arguments[ie];N({chartWrapper:c,props:m,google:l,eventArgs:q})})})}},i4=m=>{Ke.useEffect(()=>{if(!m.googleChartWrapper)return;const g=t4(m);return()=>{g==null||g.forEach(l=>{m.google.visualization.events.removeListener(l)})}},[m])},r4=m=>{const[g,l]=Ke.useState(null),[c,_]=Ke.useState(null),{addControls:A,renderControl:N}=XB({...m,chartDashboard:c,chartWrapper:g});i4({...m,googleChartWrapper:g});const{chartId:r}=ZB(m),q=Ke.useRef(null),ie=Ke.useRef(null);Ke.useEffect(()=>{const{options:We,google:rt,chartType:ht,chartWrapperParams:tt,toolbarItems:at,getChartEditor:Rt,getChartWrapper:Ne,onLoad:Tt}=m,qt={chartType:ht,options:We,containerId:r,...tt},Te=new rt.visualization.ChartWrapper(qt);Te.setOptions(We||{}),Ne==null||Ne(Te,rt);const gt=new rt.visualization.Dashboard(q.current);at&&rt.visualization.drawToolbar(ie.current,at);let oi=null;Rt&&(oi=new rt.visualization.ChartEditor,Rt({chartEditor:oi,chartWrapper:Te,google:rt})),A({...m,chartDashboard:gt,chartWrapper:Te}),l(Te),_(gt),Tt==null||Tt(rt,{google:rt,chartWrapper:Te,chartEditor:oi,chartDashboard:gt})},[]),e4({...m,googleChartWrapper:g,googleChartDashboard:c});const ae=()=>{const{width:We,height:rt,options:ht,style:tt,className:at,rootProps:Rt,google:Ne}=m,Tt={height:rt||ht&&ht.height,width:We||ht&&ht.width,...tt};return Ke.createElement("div",{id:r,style:Tt,className:at,...Rt})},he=()=>m.toolbarItems?Ke.createElement("div",{ref:ie}):null,{width:ve,height:Ae,options:we,style:Pe}=m,Ve={height:Ae||we&&we.height,width:ve||we&&we.width,...Pe};return m.render?Ke.createElement("div",{ref:q,style:Ve},Ke.createElement("div",{ref:ie,id:"toolbar"}),m.render({renderChart:ae,renderControl:N,renderToolbar:he})):Ke.createElement("div",{ref:q,style:Ve},N(We=>{let{controlProp:rt}=We;return rt.controlPosition!=="bottom"}),ae(),N(We=>{let{controlProp:rt}=We;return rt.controlPosition==="bottom"}),he())},n4=Ke.createContext(DM),s4=m=>{let{children:g,value:l}=m;return Ke.createElement(n4.Provider,{value:l},g)},o4=m=>{const{google:g,isLoading:l,error:c}=HB(m);return l?m.loader??null:c?m.errorElement??null:g?Qt.createElement(r4,{google:g,...m}):null},a4=m=>{const g={...DM,...m};return Qt.createElement(s4,{value:g},Qt.createElement(o4,g))};var UT;(function(m){m.annotation="annotation",m.annotationText="annotationText",m.certainty="certainty",m.emphasis="emphasis",m.interval="interval",m.scope="scope",m.style="style",m.tooltip="tooltip",m.domain="domain"})(UT||(UT={}));const l4=({pieData:m,pieOptions:g={},isLimited:l=!1})=>{const c=l?m.slice(0,5):m;return gi.jsx(a4,{chartType:"PieChart",width:"100%",height:"200px",data:c,options:g})},c4=({vesselId:m,fromDate:g,toDate:l})=>{const[c,_]=Ke.useState([]),[A,N]=Ke.useState(0);Ke.useEffect(()=>{m&&g&&l&&r()},[m,g,l]);const r=async()=>{try{const ve=(await hA(m,g,l)).filter(we=>we.distanceCat==="DistCov"),Ae=ve.reduce((we,Pe)=>{const Ve=(Pe.distanceVal1||0)+(Pe.distanceVal2||0)+(Pe.distanceVal3||0);return we+Ve},0);_(ve),N(Ae)}catch(he){console.error("Error fetching vessel distance:",he)}},q=[...c].sort((he,ve)=>{const Ae=(he.distanceVal1||0)+(he.distanceVal2||0)+(he.distanceVal3||0);return(ve.distanceVal1||0)+(ve.distanceVal2||0)+(ve.distanceVal3||0)-Ae}),ie=[["Distance Name","Value"],...q.map(he=>[he.distanceName,(he.distanceVal1||0)+(he.distanceVal2||0)+(he.distanceVal3||0)])],ae={pieHole:.4,legend:{position:"bottom"},chartArea:{width:"90%",height:"75%"}};return gi.jsxs("div",{className:"p-2 border border-borderColor",children:[gi.jsx(mB,{variant:"h6",fontWeight:600,mb:1,children:"Distance covered in Voyage Period [nm]"}),c.length?gi.jsxs("div",{className:"grid grid-cols-3 items-start gap-2",children:[gi.jsx("div",{className:"col-span-1",children:gi.jsx(vB,{size:"small",children:gi.jsxs(TB,{children:[gi.jsxs(zT,{children:[gi.jsx(wy,{className:"!font-bold",children:"Total"}),gi.jsx(wy,{className:"!font-bold",align:"right",children:A.toLocaleString()})]}),q.map((he,ve)=>{const Ae=(he.distanceVal1||0)+(he.distanceVal2||0)+(he.distanceVal3||0);return gi.jsxs(zT,{children:[gi.jsx(wy,{children:he.distanceName}),gi.jsx(wy,{align:"right",children:Ae.toLocaleString()})]},ve)})]})})}),gi.jsx("div",{className:"relative col-span-2",children:gi.jsx(l4,{pieData:ie,pieOptions:ae,isLimited:!0})})]}):gi.jsx("div",{className:"flex justify-center items-center",children:gi.jsx(cB,{size:24})})]})},u4=({isOpen:m,onClose:g,children:l,containerRef:c})=>{const _=Ke.useRef(null);return Ke.useEffect(()=>{function A(N){_.current&&!_.current.contains(N.target)&&(c!=null&&c.current)&&!c.current.contains(N.target)&&g()}return document.addEventListener("mousedown",A),()=>{document.removeEventListener("mousedown",A)}},[g,c]),gi.jsx("div",{className:`dropdown-menu absolute right-0 mt-2 ${m?"open":"hidden"}`,ref:_,children:l})},f4=({title:m})=>{const g=qw(Tt=>Tt.user.userDetails),l=rA(),{data:c,loading:_}=qw(Tt=>Tt.fleet),[A,N]=Ke.useState(null),[r,q]=Ke.useState(""),[ie,ae]=Ke.useState(0),[he,ve]=Ke.useState(0),[Ae,we]=Ke.useState(!1),Pe=Ke.useRef(null),[Ve,We]=Ke.useState({startDate:"",endDate:"",vesselType:"",vesselNames:[]}),rt=[{id:0,label:"Emission"},{id:1,label:"EU ETS"},{id:2,label:"Fuel EU"}],ht=(Tt,qt)=>{ae(Tt),console.log("Selected Tab:",qt.label)};Ke.useEffect(()=>{Ve.startDate&&Ve.endDate&&l(nA({userId:g.accountID,startDate:Ve.startDate,endDate:Ve.endDate}))},[l,g.accountID,Ve.startDate,Ve.endDate]);const tt=Tt=>{We(Tt)},at=Ke.useMemo(()=>c.filter(Tt=>{const qt=Ve.vesselType?Tt.vesselType===Ve.vesselType:!0,Te=Ve.vesselNames.length>0?Ve.vesselNames.includes(Tt.name):!0;return qt&&Te}),[c,Ve]),Rt=Ke.useMemo(()=>at.filter(Tt=>Tt.name.toLowerCase().includes(r.toLowerCase())),[at,r]);Ke.useEffect(()=>{Rt.length>0?N(Rt[0].vesselID):N(null)},[Rt]);const Ne=Ke.useMemo(()=>Rt.find(Tt=>Tt.vesselID===A),[Rt,A]);return Ke.useEffect(()=>{(async()=>{if(A&&Ve.startDate&&Ve.endDate)try{const Te=(await cA(A,Ve.startDate,Ve.endDate)).reduce((gt,oi)=>gt+oi.distanceVal1,0);ve(Math.round(Te))}catch(qt){console.error("Error fetching cargo delivered:",qt),ve(0)}})()},[A,Ve.startDate,Ve.endDate]),Ke.useEffect(()=>{document.title=m},[m]),gi.jsxs("div",{className:"grid px-4 gap-4",children:[gi.jsx(sA,{status:_}),gi.jsxs("div",{className:"grid md:grid-cols-5",children:[gi.jsx("h1",{className:"text-lg font-semibold",children:"Fleet"}),Ne&&gi.jsxs("div",{className:"flex items-center",children:[gi.jsx("span",{className:"vr-line"}),gi.jsx("h1",{className:"text-lg font-semibold",children:Ne.name})]}),gi.jsx("div",{className:"col-span-2"}),gi.jsxs("div",{className:"relative justify-self-end",ref:Pe,children:[gi.jsx("button",{className:"btn bg-green-500 text-white px-2 py-1 font-semibold",onClick:()=>we(!Ae),children:gi.jsx(lA,{size:18})}),gi.jsx(u4,{isOpen:Ae,onClose:()=>we(!1),containerRef:Pe,children:gi.jsx(i3,{fleetData:c,onFilterChange:tt})})]})]}),gi.jsxs("div",{className:"grid md:grid-cols-5 border border-borderColor rounded shadow min-h-screen overflow-hidden",children:[gi.jsxs("div",{className:"p-4 col-span-1",children:[gi.jsx("input",{type:"text",placeholder:"Search Vessel...",value:r,onChange:Tt=>q(Tt.target.value),className:"mb-4 w-full p-2 border border-borderColor rounded"}),Rt.length>0?gi.jsx("ul",{className:"space-y-2",children:Rt.map(Tt=>gi.jsxs("li",{onClick:()=>N(Tt.vesselID),className:`p-3 flex justify-between items-center bg-white shadow-sm cursor-pointer hover:bg-gray-100 ${A===Tt.vesselID?"border-green-500 border":""}`,children:[gi.jsxs("div",{children:[gi.jsx("div",{className:"font-semibold text-sm ",children:Tt.name}),gi.jsxs("div",{className:"text-[12px] text-gray-600",children:[Tt.vesselID," / ",Tt.vesselType]})]}),gi.jsx(n3,{status:Tt.cii})]},Tt.vesselID))}):!_&&gi.jsx("p",{children:"No search data found."})]}),gi.jsx("div",{className:" col-span-3 bg-white border-borderColor border-x p-4",children:Rt.length>0&&Ne?gi.jsxs(gi.Fragment,{children:[gi.jsx("div",{className:"flex justify-between mb-4",children:gi.jsxs("h2",{className:"text-[14px] font-semibold",children:["Voyage for the selected period : ",Ve.startDate," - ",Ve.endDate]})}),gi.jsx("div",{className:"relative p-2 border border-borderColor",children:gi.jsx(c3,{vesselId:String(Ne.vesselID),fromDate:Ve.startDate,toDate:Ve.endDate})}),gi.jsxs("div",{className:"mt-4",children:[gi.jsx(kB,{tabs:rt,activeTab:ie,onTabChange:ht}),gi.jsx("div",{style:{marginTop:"20px"},children:ie===0&&gi.jsxs("div",{children:[gi.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[gi.jsx(Ng,{label:"Total Distance",count:Ne.totDistance}),gi.jsx(Ng,{label:"CO2",count:Ne.aerT2W}),gi.jsx(Ng,{label:"CO2e",count:Ne.aerW2W}),gi.jsx(Ng,{label:"EEOI",count:Ne.eeoi}),gi.jsx(Ng,{label:"Total Cargo",count:he})]}),gi.jsx("div",{className:"mt-5 relative p-2 border border-borderColor",children:gi.jsx(UB,{vesselId:String(Ne.vesselID),fromDate:Ve.startDate,toDate:Ve.endDate})}),gi.jsx("div",{className:"mt-5",children:gi.jsx(c4,{vesselId:String(Ne.vesselID),fromDate:Ve.startDate,toDate:Ve.endDate})})]})})]})]}):gi.jsx("p",{children:"No vessels found."})}),gi.jsx("div",{className:"col-span-1"})]})]})};export{f4 as FleetOverview,f4 as default};
