var eA=Object.defineProperty;var tA=(m,g,a)=>g in m?eA(m,g,{enumerable:!0,configurable:!0,writable:!0,value:a}):m[g]=a;var Li=(m,g,a)=>tA(m,typeof g!="symbol"?g+"":g,a);import{g as t_,e as iA,c as rA,a as i_,r as Xe,R as px,j as hi,f as Qt,h as nA,i as Yw,u as sA,k as oA}from"./index-CudSqWDM.js";import{L as aA}from"./Loading-Dqa0WC_U.js";var Lx=iA();const lA=t_(Lx);/**
 * @license lucide-react v0.485.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cA=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],uA=rA("funnel",cA),$T=async(m,g,a)=>(await i_.get("/VesselCargoDelivered",{params:{VesseID:m,dtStart:`${g} 00:00`,DtEnd:`${a} 23:59`}})).data,hA=async(m,g,a)=>(await i_.get("/VesselCIIGraph",{params:{VesseID:m,dtStart:g,DtEnd:a}})).data,dA=async(m,g,a)=>(await i_.get("/VesselDistance",{params:{VesseID:m,dtStart:g,DtEnd:a}})).data,pA=async(m,g,a)=>(await i_.get("/VesselFOC",{params:{VesseID:m,dtStart:g,DtEnd:a}})).data,fA=async m=>{const{vesselId:g,fromDate:a,toDate:c}=m;return(await i_.get("/VesselVoyageRoutes",{params:{VesseID:g,dtStart:a,DtEnd:c}})).data};function cf(m){"@babel/helpers - typeof";return cf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},cf(m)}function mA(m,g){if(cf(m)!="object"||!m)return m;var a=m[Symbol.toPrimitive];if(a!==void 0){var c=a.call(m,g);if(cf(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(m)}function HT(m){var g=mA(m,"string");return cf(g)=="symbol"?g:g+""}function Vg(m,g,a){return(g=HT(g))in m?Object.defineProperty(m,g,{value:a,enumerable:!0,configurable:!0,writable:!0}):m[g]=a,m}function Xw(m,g){var a=Object.keys(m);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(m);g&&(c=c.filter(function(_){return Object.getOwnPropertyDescriptor(m,_).enumerable})),a.push.apply(a,c)}return a}function vr(m){for(var g=1;g<arguments.length;g++){var a=arguments[g]!=null?arguments[g]:{};g%2?Xw(Object(a),!0).forEach(function(c){Vg(m,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(a)):Xw(Object(a)).forEach(function(c){Object.defineProperty(m,c,Object.getOwnPropertyDescriptor(a,c))})}return m}function gA(m){if(Array.isArray(m))return m}function _A(m,g){var a=m==null?null:typeof Symbol<"u"&&m[Symbol.iterator]||m["@@iterator"];if(a!=null){var c,_,A,N,r=[],W=!0,ie=!1;try{if(A=(a=a.call(m)).next,g===0){if(Object(a)!==a)return;W=!1}else for(;!(W=(c=A.call(a)).done)&&(r.push(c.value),r.length!==g);W=!0);}catch(oe){ie=!0,_=oe}finally{try{if(!W&&a.return!=null&&(N=a.return(),Object(N)!==N))return}finally{if(ie)throw _}}return r}}function fx(m,g){(g==null||g>m.length)&&(g=m.length);for(var a=0,c=Array(g);a<g;a++)c[a]=m[a];return c}function GT(m,g){if(m){if(typeof m=="string")return fx(m,g);var a={}.toString.call(m).slice(8,-1);return a==="Object"&&m.constructor&&(a=m.constructor.name),a==="Map"||a==="Set"?Array.from(m):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?fx(m,g):void 0}}function yA(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ch(m,g){return gA(m)||_A(m,g)||GT(m,g)||yA()}function WT(m,g){if(m==null)return{};var a={};for(var c in m)if({}.hasOwnProperty.call(m,c)){if(g.indexOf(c)!==-1)continue;a[c]=m[c]}return a}function Lh(m,g){if(m==null)return{};var a,c,_=WT(m,g);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(m);for(c=0;c<A.length;c++)a=A[c],g.indexOf(a)===-1&&{}.propertyIsEnumerable.call(m,a)&&(_[a]=m[a])}return _}var vA=["defaultInputValue","defaultMenuIsOpen","defaultValue","inputValue","menuIsOpen","onChange","onInputChange","onMenuClose","onMenuOpen","value"];function xA(m){var g=m.defaultInputValue,a=g===void 0?"":g,c=m.defaultMenuIsOpen,_=c===void 0?!1:c,A=m.defaultValue,N=A===void 0?null:A,r=m.inputValue,W=m.menuIsOpen,ie=m.onChange,oe=m.onInputChange,he=m.onMenuClose,ve=m.onMenuOpen,Se=m.value,xe=Lh(m,vA),Ae=Xe.useState(r!==void 0?r:a),Re=Ch(Ae,2),He=Re[0],rt=Re[1],ht=Xe.useState(W!==void 0?W:_),tt=Ch(ht,2),at=tt[0],Lt=tt[1],Ve=Xe.useState(Se!==void 0?Se:N),Tt=Ch(Ve,2),qt=Tt[0],Me=Tt[1],gt=Xe.useCallback(function(Yt,jt){typeof ie=="function"&&ie(Yt,jt),Me(Yt)},[ie]),oi=Xe.useCallback(function(Yt,jt){var Ri;typeof oe=="function"&&(Ri=oe(Yt,jt)),rt(Ri!==void 0?Ri:Yt)},[oe]),Ti=Xe.useCallback(function(){typeof ve=="function"&&ve(),Lt(!0)},[ve]),ni=Xe.useCallback(function(){typeof he=="function"&&he(),Lt(!1)},[he]),Mt=r!==void 0?r:He,zt=W!==void 0?W:at,ii=Se!==void 0?Se:qt;return vr(vr({},xe),{},{inputValue:Mt,menuIsOpen:zt,onChange:gt,onInputChange:oi,onMenuClose:ni,onMenuOpen:Ti,value:ii})}function yr(){return yr=Object.assign?Object.assign.bind():function(m){for(var g=1;g<arguments.length;g++){var a=arguments[g];for(var c in a)({}).hasOwnProperty.call(a,c)&&(m[c]=a[c])}return m},yr.apply(null,arguments)}function bA(m,g){if(!(m instanceof g))throw new TypeError("Cannot call a class as a function")}function Zw(m,g){for(var a=0;a<g.length;a++){var c=g[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(m,HT(c.key),c)}}function wA(m,g,a){return g&&Zw(m.prototype,g),a&&Zw(m,a),Object.defineProperty(m,"prototype",{writable:!1}),m}function Vy(m,g){return Vy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,c){return a.__proto__=c,a},Vy(m,g)}function SA(m,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function");m.prototype=Object.create(g&&g.prototype,{constructor:{value:m,writable:!0,configurable:!0}}),Object.defineProperty(m,"prototype",{writable:!1}),g&&Vy(m,g)}function Uy(m){return Uy=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)},Uy(m)}function qT(){try{var m=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(qT=function(){return!!m})()}function YT(m){if(m===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m}function TA(m,g){if(g&&(cf(g)=="object"||typeof g=="function"))return g;if(g!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return YT(m)}function MA(m){var g=qT();return function(){var a,c=Uy(m);if(g){var _=Uy(this).constructor;a=Reflect.construct(c,arguments,_)}else a=c.apply(this,arguments);return TA(this,a)}}function CA(m){if(Array.isArray(m))return fx(m)}function EA(m){if(typeof Symbol<"u"&&m[Symbol.iterator]!=null||m["@@iterator"]!=null)return Array.from(m)}function AA(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rx(m){return CA(m)||EA(m)||GT(m)||AA()}function PA(m){if(m.sheet)return m.sheet;for(var g=0;g<document.styleSheets.length;g++)if(document.styleSheets[g].ownerNode===m)return document.styleSheets[g]}function DA(m){var g=document.createElement("style");return g.setAttribute("data-emotion",m.key),m.nonce!==void 0&&g.setAttribute("nonce",m.nonce),g.appendChild(document.createTextNode("")),g.setAttribute("data-s",""),g}var IA=function(){function m(a){var c=this;this._insertTag=function(_){var A;c.tags.length===0?c.insertionPoint?A=c.insertionPoint.nextSibling:c.prepend?A=c.container.firstChild:A=c.before:A=c.tags[c.tags.length-1].nextSibling,c.container.insertBefore(_,A),c.tags.push(_)},this.isSpeedy=a.speedy===void 0?!0:a.speedy,this.tags=[],this.ctr=0,this.nonce=a.nonce,this.key=a.key,this.container=a.container,this.prepend=a.prepend,this.insertionPoint=a.insertionPoint,this.before=null}var g=m.prototype;return g.hydrate=function(c){c.forEach(this._insertTag)},g.insert=function(c){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(DA(this));var _=this.tags[this.tags.length-1];if(this.isSpeedy){var A=PA(_);try{A.insertRule(c,A.cssRules.length)}catch{}}else _.appendChild(document.createTextNode(c));this.ctr++},g.flush=function(){this.tags.forEach(function(c){var _;return(_=c.parentNode)==null?void 0:_.removeChild(c)}),this.tags=[],this.ctr=0},m}(),ia="-ms-",jy="-moz-",vn="-webkit-",XT="comm",zx="rule",Fx="decl",kA="@import",ZT="@keyframes",OA="@layer",LA=Math.abs,l0=String.fromCharCode,RA=Object.assign;function zA(m,g){return Ho(m,0)^45?(((g<<2^Ho(m,0))<<2^Ho(m,1))<<2^Ho(m,2))<<2^Ho(m,3):0}function KT(m){return m.trim()}function FA(m,g){return(m=g.exec(m))?m[0]:m}function xn(m,g,a){return m.replace(g,a)}function mx(m,g){return m.indexOf(g)}function Ho(m,g){return m.charCodeAt(g)|0}function qg(m,g,a){return m.slice(g,a)}function ku(m){return m.length}function Bx(m){return m.length}function uy(m,g){return g.push(m),m}function BA(m,g){return m.map(g).join("")}var c0=1,Em=1,JT=0,ja=0,io=0,zm="";function u0(m,g,a,c,_,A,N){return{value:m,root:g,parent:a,type:c,props:_,children:A,line:c0,column:Em,length:N,return:""}}function kg(m,g){return RA(u0("",null,null,"",null,null,0),m,{length:-m.length},g)}function NA(){return io}function VA(){return io=ja>0?Ho(zm,--ja):0,Em--,io===10&&(Em=1,c0--),io}function cl(){return io=ja<JT?Ho(zm,ja++):0,Em++,io===10&&(Em=1,c0++),io}function Nu(){return Ho(zm,ja)}function Ty(){return ja}function r_(m,g){return qg(zm,m,g)}function Yg(m){switch(m){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function QT(m){return c0=Em=1,JT=ku(zm=m),ja=0,[]}function e2(m){return zm="",m}function My(m){return KT(r_(ja-1,gx(m===91?m+2:m===40?m+1:m)))}function UA(m){for(;(io=Nu())&&io<33;)cl();return Yg(m)>2||Yg(io)>3?"":" "}function jA(m,g){for(;--g&&cl()&&!(io<48||io>102||io>57&&io<65||io>70&&io<97););return r_(m,Ty()+(g<6&&Nu()==32&&cl()==32))}function gx(m){for(;cl();)switch(io){case m:return ja;case 34:case 39:m!==34&&m!==39&&gx(io);break;case 40:m===41&&gx(m);break;case 92:cl();break}return ja}function $A(m,g){for(;cl()&&m+io!==57;)if(m+io===84&&Nu()===47)break;return"/*"+r_(g,ja-1)+"*"+l0(m===47?m:cl())}function HA(m){for(;!Yg(Nu());)cl();return r_(m,ja)}function GA(m){return e2(Cy("",null,null,null,[""],m=QT(m),0,[0],m))}function Cy(m,g,a,c,_,A,N,r,W){for(var ie=0,oe=0,he=N,ve=0,Se=0,xe=0,Ae=1,Re=1,He=1,rt=0,ht="",tt=_,at=A,Lt=c,Ve=ht;Re;)switch(xe=rt,rt=cl()){case 40:if(xe!=108&&Ho(Ve,he-1)==58){mx(Ve+=xn(My(rt),"&","&\f"),"&\f")!=-1&&(He=-1);break}case 34:case 39:case 91:Ve+=My(rt);break;case 9:case 10:case 13:case 32:Ve+=UA(xe);break;case 92:Ve+=jA(Ty()-1,7);continue;case 47:switch(Nu()){case 42:case 47:uy(WA($A(cl(),Ty()),g,a),W);break;default:Ve+="/"}break;case 123*Ae:r[ie++]=ku(Ve)*He;case 125*Ae:case 59:case 0:switch(rt){case 0:case 125:Re=0;case 59+oe:He==-1&&(Ve=xn(Ve,/\f/g,"")),Se>0&&ku(Ve)-he&&uy(Se>32?Jw(Ve+";",c,a,he-1):Jw(xn(Ve," ","")+";",c,a,he-2),W);break;case 59:Ve+=";";default:if(uy(Lt=Kw(Ve,g,a,ie,oe,_,r,ht,tt=[],at=[],he),A),rt===123)if(oe===0)Cy(Ve,g,Lt,Lt,tt,A,he,r,at);else switch(ve===99&&Ho(Ve,3)===110?100:ve){case 100:case 108:case 109:case 115:Cy(m,Lt,Lt,c&&uy(Kw(m,Lt,Lt,0,0,_,r,ht,_,tt=[],he),at),_,at,he,r,c?tt:at);break;default:Cy(Ve,Lt,Lt,Lt,[""],at,0,r,at)}}ie=oe=Se=0,Ae=He=1,ht=Ve="",he=N;break;case 58:he=1+ku(Ve),Se=xe;default:if(Ae<1){if(rt==123)--Ae;else if(rt==125&&Ae++==0&&VA()==125)continue}switch(Ve+=l0(rt),rt*Ae){case 38:He=oe>0?1:(Ve+="\f",-1);break;case 44:r[ie++]=(ku(Ve)-1)*He,He=1;break;case 64:Nu()===45&&(Ve+=My(cl())),ve=Nu(),oe=he=ku(ht=Ve+=HA(Ty())),rt++;break;case 45:xe===45&&ku(Ve)==2&&(Ae=0)}}return A}function Kw(m,g,a,c,_,A,N,r,W,ie,oe){for(var he=_-1,ve=_===0?A:[""],Se=Bx(ve),xe=0,Ae=0,Re=0;xe<c;++xe)for(var He=0,rt=qg(m,he+1,he=LA(Ae=N[xe])),ht=m;He<Se;++He)(ht=KT(Ae>0?ve[He]+" "+rt:xn(rt,/&\f/g,ve[He])))&&(W[Re++]=ht);return u0(m,g,a,_===0?zx:r,W,ie,oe)}function WA(m,g,a){return u0(m,g,a,XT,l0(NA()),qg(m,2,-2),0)}function Jw(m,g,a,c){return u0(m,g,a,Fx,qg(m,0,c),qg(m,c+1,-1),c)}function Sm(m,g){for(var a="",c=Bx(m),_=0;_<c;_++)a+=g(m[_],_,m,g)||"";return a}function qA(m,g,a,c){switch(m.type){case OA:if(m.children.length)break;case kA:case Fx:return m.return=m.return||m.value;case XT:return"";case ZT:return m.return=m.value+"{"+Sm(m.children,c)+"}";case zx:m.value=m.props.join(",")}return ku(a=Sm(m.children,c))?m.return=m.value+"{"+a+"}":""}function YA(m){var g=Bx(m);return function(a,c,_,A){for(var N="",r=0;r<g;r++)N+=m[r](a,c,_,A)||"";return N}}function XA(m){return function(g){g.root||(g=g.return)&&m(g)}}function t2(m){var g=Object.create(null);return function(a){return g[a]===void 0&&(g[a]=m(a)),g[a]}}var ZA=function(g,a,c){for(var _=0,A=0;_=A,A=Nu(),_===38&&A===12&&(a[c]=1),!Yg(A);)cl();return r_(g,ja)},KA=function(g,a){var c=-1,_=44;do switch(Yg(_)){case 0:_===38&&Nu()===12&&(a[c]=1),g[c]+=ZA(ja-1,a,c);break;case 2:g[c]+=My(_);break;case 4:if(_===44){g[++c]=Nu()===58?"&\f":"",a[c]=g[c].length;break}default:g[c]+=l0(_)}while(_=cl());return g},JA=function(g,a){return e2(KA(QT(g),a))},Qw=new WeakMap,QA=function(g){if(!(g.type!=="rule"||!g.parent||g.length<1)){for(var a=g.value,c=g.parent,_=g.column===c.column&&g.line===c.line;c.type!=="rule";)if(c=c.parent,!c)return;if(!(g.props.length===1&&a.charCodeAt(0)!==58&&!Qw.get(c))&&!_){Qw.set(g,!0);for(var A=[],N=JA(a,A),r=c.props,W=0,ie=0;W<N.length;W++)for(var oe=0;oe<r.length;oe++,ie++)g.props[ie]=A[W]?N[W].replace(/&\f/g,r[oe]):r[oe]+" "+N[W]}}},eP=function(g){if(g.type==="decl"){var a=g.value;a.charCodeAt(0)===108&&a.charCodeAt(2)===98&&(g.return="",g.value="")}};function i2(m,g){switch(zA(m,g)){case 5103:return vn+"print-"+m+m;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return vn+m+m;case 5349:case 4246:case 4810:case 6968:case 2756:return vn+m+jy+m+ia+m+m;case 6828:case 4268:return vn+m+ia+m+m;case 6165:return vn+m+ia+"flex-"+m+m;case 5187:return vn+m+xn(m,/(\w+).+(:[^]+)/,vn+"box-$1$2"+ia+"flex-$1$2")+m;case 5443:return vn+m+ia+"flex-item-"+xn(m,/flex-|-self/,"")+m;case 4675:return vn+m+ia+"flex-line-pack"+xn(m,/align-content|flex-|-self/,"")+m;case 5548:return vn+m+ia+xn(m,"shrink","negative")+m;case 5292:return vn+m+ia+xn(m,"basis","preferred-size")+m;case 6060:return vn+"box-"+xn(m,"-grow","")+vn+m+ia+xn(m,"grow","positive")+m;case 4554:return vn+xn(m,/([^-])(transform)/g,"$1"+vn+"$2")+m;case 6187:return xn(xn(xn(m,/(zoom-|grab)/,vn+"$1"),/(image-set)/,vn+"$1"),m,"")+m;case 5495:case 3959:return xn(m,/(image-set\([^]*)/,vn+"$1$`$1");case 4968:return xn(xn(m,/(.+:)(flex-)?(.*)/,vn+"box-pack:$3"+ia+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+vn+m+m;case 4095:case 3583:case 4068:case 2532:return xn(m,/(.+)-inline(.+)/,vn+"$1$2")+m;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(ku(m)-1-g>6)switch(Ho(m,g+1)){case 109:if(Ho(m,g+4)!==45)break;case 102:return xn(m,/(.+:)(.+)-([^]+)/,"$1"+vn+"$2-$3$1"+jy+(Ho(m,g+3)==108?"$3":"$2-$3"))+m;case 115:return~mx(m,"stretch")?i2(xn(m,"stretch","fill-available"),g)+m:m}break;case 4949:if(Ho(m,g+1)!==115)break;case 6444:switch(Ho(m,ku(m)-3-(~mx(m,"!important")&&10))){case 107:return xn(m,":",":"+vn)+m;case 101:return xn(m,/(.+:)([^;!]+)(;|!.+)?/,"$1"+vn+(Ho(m,14)===45?"inline-":"")+"box$3$1"+vn+"$2$3$1"+ia+"$2box$3")+m}break;case 5936:switch(Ho(m,g+11)){case 114:return vn+m+ia+xn(m,/[svh]\w+-[tblr]{2}/,"tb")+m;case 108:return vn+m+ia+xn(m,/[svh]\w+-[tblr]{2}/,"tb-rl")+m;case 45:return vn+m+ia+xn(m,/[svh]\w+-[tblr]{2}/,"lr")+m}return vn+m+ia+m+m}return m}var tP=function(g,a,c,_){if(g.length>-1&&!g.return)switch(g.type){case Fx:g.return=i2(g.value,g.length);break;case ZT:return Sm([kg(g,{value:xn(g.value,"@","@"+vn)})],_);case zx:if(g.length)return BA(g.props,function(A){switch(FA(A,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Sm([kg(g,{props:[xn(A,/:(read-\w+)/,":"+jy+"$1")]})],_);case"::placeholder":return Sm([kg(g,{props:[xn(A,/:(plac\w+)/,":"+vn+"input-$1")]}),kg(g,{props:[xn(A,/:(plac\w+)/,":"+jy+"$1")]}),kg(g,{props:[xn(A,/:(plac\w+)/,ia+"input-$1")]})],_)}return""})}},iP=[tP],rP=function(g){var a=g.key;if(a==="css"){var c=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(c,function(Ae){var Re=Ae.getAttribute("data-emotion");Re.indexOf(" ")!==-1&&(document.head.appendChild(Ae),Ae.setAttribute("data-s",""))})}var _=g.stylisPlugins||iP,A={},N,r=[];N=g.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+a+' "]'),function(Ae){for(var Re=Ae.getAttribute("data-emotion").split(" "),He=1;He<Re.length;He++)A[Re[He]]=!0;r.push(Ae)});var W,ie=[QA,eP];{var oe,he=[qA,XA(function(Ae){oe.insert(Ae)})],ve=YA(ie.concat(_,he)),Se=function(Re){return Sm(GA(Re),ve)};W=function(Re,He,rt,ht){oe=rt,Se(Re?Re+"{"+He.styles+"}":He.styles),ht&&(xe.inserted[He.name]=!0)}}var xe={key:a,sheet:new IA({key:a,container:N,nonce:g.nonce,speedy:g.speedy,prepend:g.prepend,insertionPoint:g.insertionPoint}),nonce:g.nonce,inserted:A,registered:{},insert:W};return xe.sheet.hydrate(r),xe},Gv={exports:{}},Mn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eS;function nP(){if(eS)return Mn;eS=1;var m=typeof Symbol=="function"&&Symbol.for,g=m?Symbol.for("react.element"):60103,a=m?Symbol.for("react.portal"):60106,c=m?Symbol.for("react.fragment"):60107,_=m?Symbol.for("react.strict_mode"):60108,A=m?Symbol.for("react.profiler"):60114,N=m?Symbol.for("react.provider"):60109,r=m?Symbol.for("react.context"):60110,W=m?Symbol.for("react.async_mode"):60111,ie=m?Symbol.for("react.concurrent_mode"):60111,oe=m?Symbol.for("react.forward_ref"):60112,he=m?Symbol.for("react.suspense"):60113,ve=m?Symbol.for("react.suspense_list"):60120,Se=m?Symbol.for("react.memo"):60115,xe=m?Symbol.for("react.lazy"):60116,Ae=m?Symbol.for("react.block"):60121,Re=m?Symbol.for("react.fundamental"):60117,He=m?Symbol.for("react.responder"):60118,rt=m?Symbol.for("react.scope"):60119;function ht(at){if(typeof at=="object"&&at!==null){var Lt=at.$$typeof;switch(Lt){case g:switch(at=at.type,at){case W:case ie:case c:case A:case _:case he:return at;default:switch(at=at&&at.$$typeof,at){case r:case oe:case xe:case Se:case N:return at;default:return Lt}}case a:return Lt}}}function tt(at){return ht(at)===ie}return Mn.AsyncMode=W,Mn.ConcurrentMode=ie,Mn.ContextConsumer=r,Mn.ContextProvider=N,Mn.Element=g,Mn.ForwardRef=oe,Mn.Fragment=c,Mn.Lazy=xe,Mn.Memo=Se,Mn.Portal=a,Mn.Profiler=A,Mn.StrictMode=_,Mn.Suspense=he,Mn.isAsyncMode=function(at){return tt(at)||ht(at)===W},Mn.isConcurrentMode=tt,Mn.isContextConsumer=function(at){return ht(at)===r},Mn.isContextProvider=function(at){return ht(at)===N},Mn.isElement=function(at){return typeof at=="object"&&at!==null&&at.$$typeof===g},Mn.isForwardRef=function(at){return ht(at)===oe},Mn.isFragment=function(at){return ht(at)===c},Mn.isLazy=function(at){return ht(at)===xe},Mn.isMemo=function(at){return ht(at)===Se},Mn.isPortal=function(at){return ht(at)===a},Mn.isProfiler=function(at){return ht(at)===A},Mn.isStrictMode=function(at){return ht(at)===_},Mn.isSuspense=function(at){return ht(at)===he},Mn.isValidElementType=function(at){return typeof at=="string"||typeof at=="function"||at===c||at===ie||at===A||at===_||at===he||at===ve||typeof at=="object"&&at!==null&&(at.$$typeof===xe||at.$$typeof===Se||at.$$typeof===N||at.$$typeof===r||at.$$typeof===oe||at.$$typeof===Re||at.$$typeof===He||at.$$typeof===rt||at.$$typeof===Ae)},Mn.typeOf=ht,Mn}var tS;function sP(){return tS||(tS=1,Gv.exports=nP()),Gv.exports}var Wv,iS;function oP(){if(iS)return Wv;iS=1;var m=sP(),g={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},a={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},c={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},_={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},A={};A[m.ForwardRef]=c,A[m.Memo]=_;function N(xe){return m.isMemo(xe)?_:A[xe.$$typeof]||g}var r=Object.defineProperty,W=Object.getOwnPropertyNames,ie=Object.getOwnPropertySymbols,oe=Object.getOwnPropertyDescriptor,he=Object.getPrototypeOf,ve=Object.prototype;function Se(xe,Ae,Re){if(typeof Ae!="string"){if(ve){var He=he(Ae);He&&He!==ve&&Se(xe,He,Re)}var rt=W(Ae);ie&&(rt=rt.concat(ie(Ae)));for(var ht=N(xe),tt=N(Ae),at=0;at<rt.length;++at){var Lt=rt[at];if(!a[Lt]&&!(Re&&Re[Lt])&&!(tt&&tt[Lt])&&!(ht&&ht[Lt])){var Ve=oe(Ae,Lt);try{r(xe,Lt,Ve)}catch{}}}}return xe}return Wv=Se,Wv}oP();var aP=!0;function r2(m,g,a){var c="";return a.split(" ").forEach(function(_){m[_]!==void 0?g.push(m[_]+";"):_&&(c+=_+" ")}),c}var Nx=function(g,a,c){var _=g.key+"-"+a.name;(c===!1||aP===!1)&&g.registered[_]===void 0&&(g.registered[_]=a.styles)},n2=function(g,a,c){Nx(g,a,c);var _=g.key+"-"+a.name;if(g.inserted[a.name]===void 0){var A=a;do g.insert(a===A?"."+_:"",A,g.sheet,!0),A=A.next;while(A!==void 0)}};function lP(m){for(var g=0,a,c=0,_=m.length;_>=4;++c,_-=4)a=m.charCodeAt(c)&255|(m.charCodeAt(++c)&255)<<8|(m.charCodeAt(++c)&255)<<16|(m.charCodeAt(++c)&255)<<24,a=(a&65535)*1540483477+((a>>>16)*59797<<16),a^=a>>>24,g=(a&65535)*1540483477+((a>>>16)*59797<<16)^(g&65535)*1540483477+((g>>>16)*59797<<16);switch(_){case 3:g^=(m.charCodeAt(c+2)&255)<<16;case 2:g^=(m.charCodeAt(c+1)&255)<<8;case 1:g^=m.charCodeAt(c)&255,g=(g&65535)*1540483477+((g>>>16)*59797<<16)}return g^=g>>>13,g=(g&65535)*1540483477+((g>>>16)*59797<<16),((g^g>>>15)>>>0).toString(36)}var cP={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},uP=/[A-Z]|^ms/g,hP=/_EMO_([^_]+?)_([^]*?)_EMO_/g,s2=function(g){return g.charCodeAt(1)===45},rS=function(g){return g!=null&&typeof g!="boolean"},qv=t2(function(m){return s2(m)?m:m.replace(uP,"-$&").toLowerCase()}),nS=function(g,a){switch(g){case"animation":case"animationName":if(typeof a=="string")return a.replace(hP,function(c,_,A){return Ou={name:_,styles:A,next:Ou},_})}return cP[g]!==1&&!s2(g)&&typeof a=="number"&&a!==0?a+"px":a};function Xg(m,g,a){if(a==null)return"";var c=a;if(c.__emotion_styles!==void 0)return c;switch(typeof a){case"boolean":return"";case"object":{var _=a;if(_.anim===1)return Ou={name:_.name,styles:_.styles,next:Ou},_.name;var A=a;if(A.styles!==void 0){var N=A.next;if(N!==void 0)for(;N!==void 0;)Ou={name:N.name,styles:N.styles,next:Ou},N=N.next;var r=A.styles+";";return r}return dP(m,g,a)}case"function":{if(m!==void 0){var W=Ou,ie=a(m);return Ou=W,Xg(m,g,ie)}break}}var oe=a;if(g==null)return oe;var he=g[oe];return he!==void 0?he:oe}function dP(m,g,a){var c="";if(Array.isArray(a))for(var _=0;_<a.length;_++)c+=Xg(m,g,a[_])+";";else for(var A in a){var N=a[A];if(typeof N!="object"){var r=N;g!=null&&g[r]!==void 0?c+=A+"{"+g[r]+"}":rS(r)&&(c+=qv(A)+":"+nS(A,r)+";")}else if(Array.isArray(N)&&typeof N[0]=="string"&&(g==null||g[N[0]]===void 0))for(var W=0;W<N.length;W++)rS(N[W])&&(c+=qv(A)+":"+nS(A,N[W])+";");else{var ie=Xg(m,g,N);switch(A){case"animation":case"animationName":{c+=qv(A)+":"+ie+";";break}default:c+=A+"{"+ie+"}"}}}return c}var sS=/label:\s*([^\s;{]+)\s*(;|$)/g,Ou;function h0(m,g,a){if(m.length===1&&typeof m[0]=="object"&&m[0]!==null&&m[0].styles!==void 0)return m[0];var c=!0,_="";Ou=void 0;var A=m[0];if(A==null||A.raw===void 0)c=!1,_+=Xg(a,g,A);else{var N=A;_+=N[0]}for(var r=1;r<m.length;r++)if(_+=Xg(a,g,m[r]),c){var W=A;_+=W[r]}sS.lastIndex=0;for(var ie="",oe;(oe=sS.exec(_))!==null;)ie+="-"+oe[1];var he=lP(_)+ie;return{name:he,styles:_,next:Ou}}var pP=function(g){return g()},fP=px.useInsertionEffect?px.useInsertionEffect:!1,o2=fP||pP,a2=Xe.createContext(typeof HTMLElement<"u"?rP({key:"css"}):null);a2.Provider;var l2=function(g){return Xe.forwardRef(function(a,c){var _=Xe.useContext(a2);return g(a,_,c)})},c2=Xe.createContext({}),Vx={}.hasOwnProperty,_x="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",mP=function(g,a){var c={};for(var _ in a)Vx.call(a,_)&&(c[_]=a[_]);return c[_x]=g,c},gP=function(g){var a=g.cache,c=g.serialized,_=g.isStringTag;return Nx(a,c,_),o2(function(){return n2(a,c,_)}),null},_P=l2(function(m,g,a){var c=m.css;typeof c=="string"&&g.registered[c]!==void 0&&(c=g.registered[c]);var _=m[_x],A=[c],N="";typeof m.className=="string"?N=r2(g.registered,A,m.className):m.className!=null&&(N=m.className+" ");var r=h0(A,void 0,Xe.useContext(c2));N+=g.key+"-"+r.name;var W={};for(var ie in m)Vx.call(m,ie)&&ie!=="css"&&ie!==_x&&(W[ie]=m[ie]);return W.className=N,a&&(W.ref=a),Xe.createElement(Xe.Fragment,null,Xe.createElement(gP,{cache:g,serialized:r,isStringTag:typeof _=="string"}),Xe.createElement(_,W))}),yP=_P,hr=function(g,a){var c=arguments;if(a==null||!Vx.call(a,"css"))return Xe.createElement.apply(void 0,c);var _=c.length,A=new Array(_);A[0]=yP,A[1]=mP(g,a);for(var N=2;N<_;N++)A[N]=c[N];return Xe.createElement.apply(null,A)};(function(m){var g;g||(g=m.JSX||(m.JSX={}))})(hr||(hr={}));function n_(){for(var m=arguments.length,g=new Array(m),a=0;a<m;a++)g[a]=arguments[a];return h0(g)}function Fm(){var m=n_.apply(void 0,arguments),g="animation-"+m.name;return{name:g,styles:"@keyframes "+g+"{"+m.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}function vP(m,g){return g||(g=m.slice(0)),Object.freeze(Object.defineProperties(m,{raw:{value:Object.freeze(g)}}))}const Am=Math.min,of=Math.max,$y=Math.round,hy=Math.floor,Vu=m=>({x:m,y:m}),xP={left:"right",right:"left",bottom:"top",top:"bottom"},bP={start:"end",end:"start"};function wP(m,g,a){return of(m,Am(g,a))}function d0(m,g){return typeof m=="function"?m(g):m}function Pm(m){return m.split("-")[0]}function s_(m){return m.split("-")[1]}function SP(m){return m==="x"?"y":"x"}function Ux(m){return m==="y"?"height":"width"}function Zg(m){return["top","bottom"].includes(Pm(m))?"y":"x"}function jx(m){return SP(Zg(m))}function TP(m,g,a){a===void 0&&(a=!1);const c=s_(m),_=jx(m),A=Ux(_);let N=_==="x"?c===(a?"end":"start")?"right":"left":c==="start"?"bottom":"top";return g.reference[A]>g.floating[A]&&(N=Hy(N)),[N,Hy(N)]}function MP(m){const g=Hy(m);return[yx(m),g,yx(g)]}function yx(m){return m.replace(/start|end/g,g=>bP[g])}function CP(m,g,a){const c=["left","right"],_=["right","left"],A=["top","bottom"],N=["bottom","top"];switch(m){case"top":case"bottom":return a?g?_:c:g?c:_;case"left":case"right":return g?A:N;default:return[]}}function EP(m,g,a,c){const _=s_(m);let A=CP(Pm(m),a==="start",c);return _&&(A=A.map(N=>N+"-"+_),g&&(A=A.concat(A.map(yx)))),A}function Hy(m){return m.replace(/left|right|bottom|top/g,g=>xP[g])}function AP(m){return{top:0,right:0,bottom:0,left:0,...m}}function u2(m){return typeof m!="number"?AP(m):{top:m,right:m,bottom:m,left:m}}function Gy(m){const{x:g,y:a,width:c,height:_}=m;return{width:c,height:_,top:a,left:g,right:g+c,bottom:a+_,x:g,y:a}}function oS(m,g,a){let{reference:c,floating:_}=m;const A=Zg(g),N=jx(g),r=Ux(N),W=Pm(g),ie=A==="y",oe=c.x+c.width/2-_.width/2,he=c.y+c.height/2-_.height/2,ve=c[r]/2-_[r]/2;let Se;switch(W){case"top":Se={x:oe,y:c.y-_.height};break;case"bottom":Se={x:oe,y:c.y+c.height};break;case"right":Se={x:c.x+c.width,y:he};break;case"left":Se={x:c.x-_.width,y:he};break;default:Se={x:c.x,y:c.y}}switch(s_(g)){case"start":Se[N]-=ve*(a&&ie?-1:1);break;case"end":Se[N]+=ve*(a&&ie?-1:1);break}return Se}const PP=async(m,g,a)=>{const{placement:c="bottom",strategy:_="absolute",middleware:A=[],platform:N}=a,r=A.filter(Boolean),W=await(N.isRTL==null?void 0:N.isRTL(g));let ie=await N.getElementRects({reference:m,floating:g,strategy:_}),{x:oe,y:he}=oS(ie,c,W),ve=c,Se={},xe=0;for(let Ae=0;Ae<r.length;Ae++){const{name:Re,fn:He}=r[Ae],{x:rt,y:ht,data:tt,reset:at}=await He({x:oe,y:he,initialPlacement:c,placement:ve,strategy:_,middlewareData:Se,rects:ie,platform:N,elements:{reference:m,floating:g}});oe=rt??oe,he=ht??he,Se={...Se,[Re]:{...Se[Re],...tt}},at&&xe<=50&&(xe++,typeof at=="object"&&(at.placement&&(ve=at.placement),at.rects&&(ie=at.rects===!0?await N.getElementRects({reference:m,floating:g,strategy:_}):at.rects),{x:oe,y:he}=oS(ie,ve,W)),Ae=-1)}return{x:oe,y:he,placement:ve,strategy:_,middlewareData:Se}};async function DP(m,g){var a;g===void 0&&(g={});const{x:c,y:_,platform:A,rects:N,elements:r,strategy:W}=m,{boundary:ie="clippingAncestors",rootBoundary:oe="viewport",elementContext:he="floating",altBoundary:ve=!1,padding:Se=0}=d0(g,m),xe=u2(Se),Re=r[ve?he==="floating"?"reference":"floating":he],He=Gy(await A.getClippingRect({element:(a=await(A.isElement==null?void 0:A.isElement(Re)))==null||a?Re:Re.contextElement||await(A.getDocumentElement==null?void 0:A.getDocumentElement(r.floating)),boundary:ie,rootBoundary:oe,strategy:W})),rt=he==="floating"?{x:c,y:_,width:N.floating.width,height:N.floating.height}:N.reference,ht=await(A.getOffsetParent==null?void 0:A.getOffsetParent(r.floating)),tt=await(A.isElement==null?void 0:A.isElement(ht))?await(A.getScale==null?void 0:A.getScale(ht))||{x:1,y:1}:{x:1,y:1},at=Gy(A.convertOffsetParentRelativeRectToViewportRelativeRect?await A.convertOffsetParentRelativeRectToViewportRelativeRect({elements:r,rect:rt,offsetParent:ht,strategy:W}):rt);return{top:(He.top-at.top+xe.top)/tt.y,bottom:(at.bottom-He.bottom+xe.bottom)/tt.y,left:(He.left-at.left+xe.left)/tt.x,right:(at.right-He.right+xe.right)/tt.x}}const IP=m=>({name:"arrow",options:m,async fn(g){const{x:a,y:c,placement:_,rects:A,platform:N,elements:r,middlewareData:W}=g,{element:ie,padding:oe=0}=d0(m,g)||{};if(ie==null)return{};const he=u2(oe),ve={x:a,y:c},Se=jx(_),xe=Ux(Se),Ae=await N.getDimensions(ie),Re=Se==="y",He=Re?"top":"left",rt=Re?"bottom":"right",ht=Re?"clientHeight":"clientWidth",tt=A.reference[xe]+A.reference[Se]-ve[Se]-A.floating[xe],at=ve[Se]-A.reference[Se],Lt=await(N.getOffsetParent==null?void 0:N.getOffsetParent(ie));let Ve=Lt?Lt[ht]:0;(!Ve||!await(N.isElement==null?void 0:N.isElement(Lt)))&&(Ve=r.floating[ht]||A.floating[xe]);const Tt=tt/2-at/2,qt=Ve/2-Ae[xe]/2-1,Me=Am(he[He],qt),gt=Am(he[rt],qt),oi=Me,Ti=Ve-Ae[xe]-gt,ni=Ve/2-Ae[xe]/2+Tt,Mt=wP(oi,ni,Ti),zt=!W.arrow&&s_(_)!=null&&ni!==Mt&&A.reference[xe]/2-(ni<oi?Me:gt)-Ae[xe]/2<0,ii=zt?ni<oi?ni-oi:ni-Ti:0;return{[Se]:ve[Se]+ii,data:{[Se]:Mt,centerOffset:ni-Mt-ii,...zt&&{alignmentOffset:ii}},reset:zt}}}),kP=function(m){return m===void 0&&(m={}),{name:"flip",options:m,async fn(g){var a,c;const{placement:_,middlewareData:A,rects:N,initialPlacement:r,platform:W,elements:ie}=g,{mainAxis:oe=!0,crossAxis:he=!0,fallbackPlacements:ve,fallbackStrategy:Se="bestFit",fallbackAxisSideDirection:xe="none",flipAlignment:Ae=!0,...Re}=d0(m,g);if((a=A.arrow)!=null&&a.alignmentOffset)return{};const He=Pm(_),rt=Zg(r),ht=Pm(r)===r,tt=await(W.isRTL==null?void 0:W.isRTL(ie.floating)),at=ve||(ht||!Ae?[Hy(r)]:MP(r)),Lt=xe!=="none";!ve&&Lt&&at.push(...EP(r,Ae,xe,tt));const Ve=[r,...at],Tt=await DP(g,Re),qt=[];let Me=((c=A.flip)==null?void 0:c.overflows)||[];if(oe&&qt.push(Tt[He]),he){const ni=TP(_,N,tt);qt.push(Tt[ni[0]],Tt[ni[1]])}if(Me=[...Me,{placement:_,overflows:qt}],!qt.every(ni=>ni<=0)){var gt,oi;const ni=(((gt=A.flip)==null?void 0:gt.index)||0)+1,Mt=Ve[ni];if(Mt)return{data:{index:ni,overflows:Me},reset:{placement:Mt}};let zt=(oi=Me.filter(ii=>ii.overflows[0]<=0).sort((ii,Yt)=>ii.overflows[1]-Yt.overflows[1])[0])==null?void 0:oi.placement;if(!zt)switch(Se){case"bestFit":{var Ti;const ii=(Ti=Me.filter(Yt=>{if(Lt){const jt=Zg(Yt.placement);return jt===rt||jt==="y"}return!0}).map(Yt=>[Yt.placement,Yt.overflows.filter(jt=>jt>0).reduce((jt,Ri)=>jt+Ri,0)]).sort((Yt,jt)=>Yt[1]-jt[1])[0])==null?void 0:Ti[0];ii&&(zt=ii);break}case"initialPlacement":zt=r;break}if(_!==zt)return{reset:{placement:zt}}}return{}}}};async function OP(m,g){const{placement:a,platform:c,elements:_}=m,A=await(c.isRTL==null?void 0:c.isRTL(_.floating)),N=Pm(a),r=s_(a),W=Zg(a)==="y",ie=["left","top"].includes(N)?-1:1,oe=A&&W?-1:1,he=d0(g,m);let{mainAxis:ve,crossAxis:Se,alignmentAxis:xe}=typeof he=="number"?{mainAxis:he,crossAxis:0,alignmentAxis:null}:{mainAxis:he.mainAxis||0,crossAxis:he.crossAxis||0,alignmentAxis:he.alignmentAxis};return r&&typeof xe=="number"&&(Se=r==="end"?xe*-1:xe),W?{x:Se*oe,y:ve*ie}:{x:ve*ie,y:Se*oe}}const LP=function(m){return m===void 0&&(m=0),{name:"offset",options:m,async fn(g){var a,c;const{x:_,y:A,placement:N,middlewareData:r}=g,W=await OP(g,m);return N===((a=r.offset)==null?void 0:a.placement)&&(c=r.arrow)!=null&&c.alignmentOffset?{}:{x:_+W.x,y:A+W.y,data:{...W,placement:N}}}}};function p0(){return typeof window<"u"}function Bm(m){return h2(m)?(m.nodeName||"").toLowerCase():"#document"}function ul(m){var g;return(m==null||(g=m.ownerDocument)==null?void 0:g.defaultView)||window}function ju(m){var g;return(g=(h2(m)?m.ownerDocument:m.document)||window.document)==null?void 0:g.documentElement}function h2(m){return p0()?m instanceof Node||m instanceof ul(m).Node:!1}function Sa(m){return p0()?m instanceof Element||m instanceof ul(m).Element:!1}function Uu(m){return p0()?m instanceof HTMLElement||m instanceof ul(m).HTMLElement:!1}function aS(m){return!p0()||typeof ShadowRoot>"u"?!1:m instanceof ShadowRoot||m instanceof ul(m).ShadowRoot}function o_(m){const{overflow:g,overflowX:a,overflowY:c,display:_}=Zl(m);return/auto|scroll|overlay|hidden|clip/.test(g+c+a)&&!["inline","contents"].includes(_)}function RP(m){return["table","td","th"].includes(Bm(m))}function f0(m){return[":popover-open",":modal"].some(g=>{try{return m.matches(g)}catch{return!1}})}function $x(m){const g=Hx(),a=Sa(m)?Zl(m):m;return["transform","translate","scale","rotate","perspective"].some(c=>a[c]?a[c]!=="none":!1)||(a.containerType?a.containerType!=="normal":!1)||!g&&(a.backdropFilter?a.backdropFilter!=="none":!1)||!g&&(a.filter?a.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(c=>(a.willChange||"").includes(c))||["paint","layout","strict","content"].some(c=>(a.contain||"").includes(c))}function zP(m){let g=Nd(m);for(;Uu(g)&&!Dm(g);){if($x(g))return g;if(f0(g))return null;g=Nd(g)}return null}function Hx(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Dm(m){return["html","body","#document"].includes(Bm(m))}function Zl(m){return ul(m).getComputedStyle(m)}function m0(m){return Sa(m)?{scrollLeft:m.scrollLeft,scrollTop:m.scrollTop}:{scrollLeft:m.scrollX,scrollTop:m.scrollY}}function Nd(m){if(Bm(m)==="html")return m;const g=m.assignedSlot||m.parentNode||aS(m)&&m.host||ju(m);return aS(g)?g.host:g}function d2(m){const g=Nd(m);return Dm(g)?m.ownerDocument?m.ownerDocument.body:m.body:Uu(g)&&o_(g)?g:d2(g)}function Kg(m,g,a){var c;g===void 0&&(g=[]),a===void 0&&(a=!0);const _=d2(m),A=_===((c=m.ownerDocument)==null?void 0:c.body),N=ul(_);if(A){const r=vx(N);return g.concat(N,N.visualViewport||[],o_(_)?_:[],r&&a?Kg(r):[])}return g.concat(_,Kg(_,[],a))}function vx(m){return m.parent&&Object.getPrototypeOf(m.parent)?m.frameElement:null}function p2(m){const g=Zl(m);let a=parseFloat(g.width)||0,c=parseFloat(g.height)||0;const _=Uu(m),A=_?m.offsetWidth:a,N=_?m.offsetHeight:c,r=$y(a)!==A||$y(c)!==N;return r&&(a=A,c=N),{width:a,height:c,$:r}}function Gx(m){return Sa(m)?m:m.contextElement}function Tm(m){const g=Gx(m);if(!Uu(g))return Vu(1);const a=g.getBoundingClientRect(),{width:c,height:_,$:A}=p2(g);let N=(A?$y(a.width):a.width)/c,r=(A?$y(a.height):a.height)/_;return(!N||!Number.isFinite(N))&&(N=1),(!r||!Number.isFinite(r))&&(r=1),{x:N,y:r}}const FP=Vu(0);function f2(m){const g=ul(m);return!Hx()||!g.visualViewport?FP:{x:g.visualViewport.offsetLeft,y:g.visualViewport.offsetTop}}function BP(m,g,a){return g===void 0&&(g=!1),!a||g&&a!==ul(m)?!1:g}function uf(m,g,a,c){g===void 0&&(g=!1),a===void 0&&(a=!1);const _=m.getBoundingClientRect(),A=Gx(m);let N=Vu(1);g&&(c?Sa(c)&&(N=Tm(c)):N=Tm(m));const r=BP(A,a,c)?f2(A):Vu(0);let W=(_.left+r.x)/N.x,ie=(_.top+r.y)/N.y,oe=_.width/N.x,he=_.height/N.y;if(A){const ve=ul(A),Se=c&&Sa(c)?ul(c):c;let xe=ve,Ae=vx(xe);for(;Ae&&c&&Se!==xe;){const Re=Tm(Ae),He=Ae.getBoundingClientRect(),rt=Zl(Ae),ht=He.left+(Ae.clientLeft+parseFloat(rt.paddingLeft))*Re.x,tt=He.top+(Ae.clientTop+parseFloat(rt.paddingTop))*Re.y;W*=Re.x,ie*=Re.y,oe*=Re.x,he*=Re.y,W+=ht,ie+=tt,xe=ul(Ae),Ae=vx(xe)}}return Gy({width:oe,height:he,x:W,y:ie})}function Wx(m,g){const a=m0(m).scrollLeft;return g?g.left+a:uf(ju(m)).left+a}function m2(m,g,a){a===void 0&&(a=!1);const c=m.getBoundingClientRect(),_=c.left+g.scrollLeft-(a?0:Wx(m,c)),A=c.top+g.scrollTop;return{x:_,y:A}}function NP(m){let{elements:g,rect:a,offsetParent:c,strategy:_}=m;const A=_==="fixed",N=ju(c),r=g?f0(g.floating):!1;if(c===N||r&&A)return a;let W={scrollLeft:0,scrollTop:0},ie=Vu(1);const oe=Vu(0),he=Uu(c);if((he||!he&&!A)&&((Bm(c)!=="body"||o_(N))&&(W=m0(c)),Uu(c))){const Se=uf(c);ie=Tm(c),oe.x=Se.x+c.clientLeft,oe.y=Se.y+c.clientTop}const ve=N&&!he&&!A?m2(N,W,!0):Vu(0);return{width:a.width*ie.x,height:a.height*ie.y,x:a.x*ie.x-W.scrollLeft*ie.x+oe.x+ve.x,y:a.y*ie.y-W.scrollTop*ie.y+oe.y+ve.y}}function VP(m){return Array.from(m.getClientRects())}function UP(m){const g=ju(m),a=m0(m),c=m.ownerDocument.body,_=of(g.scrollWidth,g.clientWidth,c.scrollWidth,c.clientWidth),A=of(g.scrollHeight,g.clientHeight,c.scrollHeight,c.clientHeight);let N=-a.scrollLeft+Wx(m);const r=-a.scrollTop;return Zl(c).direction==="rtl"&&(N+=of(g.clientWidth,c.clientWidth)-_),{width:_,height:A,x:N,y:r}}function jP(m,g){const a=ul(m),c=ju(m),_=a.visualViewport;let A=c.clientWidth,N=c.clientHeight,r=0,W=0;if(_){A=_.width,N=_.height;const ie=Hx();(!ie||ie&&g==="fixed")&&(r=_.offsetLeft,W=_.offsetTop)}return{width:A,height:N,x:r,y:W}}function $P(m,g){const a=uf(m,!0,g==="fixed"),c=a.top+m.clientTop,_=a.left+m.clientLeft,A=Uu(m)?Tm(m):Vu(1),N=m.clientWidth*A.x,r=m.clientHeight*A.y,W=_*A.x,ie=c*A.y;return{width:N,height:r,x:W,y:ie}}function lS(m,g,a){let c;if(g==="viewport")c=jP(m,a);else if(g==="document")c=UP(ju(m));else if(Sa(g))c=$P(g,a);else{const _=f2(m);c={x:g.x-_.x,y:g.y-_.y,width:g.width,height:g.height}}return Gy(c)}function g2(m,g){const a=Nd(m);return a===g||!Sa(a)||Dm(a)?!1:Zl(a).position==="fixed"||g2(a,g)}function HP(m,g){const a=g.get(m);if(a)return a;let c=Kg(m,[],!1).filter(r=>Sa(r)&&Bm(r)!=="body"),_=null;const A=Zl(m).position==="fixed";let N=A?Nd(m):m;for(;Sa(N)&&!Dm(N);){const r=Zl(N),W=$x(N);!W&&r.position==="fixed"&&(_=null),(A?!W&&!_:!W&&r.position==="static"&&!!_&&["absolute","fixed"].includes(_.position)||o_(N)&&!W&&g2(m,N))?c=c.filter(oe=>oe!==N):_=r,N=Nd(N)}return g.set(m,c),c}function GP(m){let{element:g,boundary:a,rootBoundary:c,strategy:_}=m;const N=[...a==="clippingAncestors"?f0(g)?[]:HP(g,this._c):[].concat(a),c],r=N[0],W=N.reduce((ie,oe)=>{const he=lS(g,oe,_);return ie.top=of(he.top,ie.top),ie.right=Am(he.right,ie.right),ie.bottom=Am(he.bottom,ie.bottom),ie.left=of(he.left,ie.left),ie},lS(g,r,_));return{width:W.right-W.left,height:W.bottom-W.top,x:W.left,y:W.top}}function WP(m){const{width:g,height:a}=p2(m);return{width:g,height:a}}function qP(m,g,a){const c=Uu(g),_=ju(g),A=a==="fixed",N=uf(m,!0,A,g);let r={scrollLeft:0,scrollTop:0};const W=Vu(0);if(c||!c&&!A)if((Bm(g)!=="body"||o_(_))&&(r=m0(g)),c){const ve=uf(g,!0,A,g);W.x=ve.x+g.clientLeft,W.y=ve.y+g.clientTop}else _&&(W.x=Wx(_));const ie=_&&!c&&!A?m2(_,r):Vu(0),oe=N.left+r.scrollLeft-W.x-ie.x,he=N.top+r.scrollTop-W.y-ie.y;return{x:oe,y:he,width:N.width,height:N.height}}function Yv(m){return Zl(m).position==="static"}function cS(m,g){if(!Uu(m)||Zl(m).position==="fixed")return null;if(g)return g(m);let a=m.offsetParent;return ju(m)===a&&(a=a.ownerDocument.body),a}function _2(m,g){const a=ul(m);if(f0(m))return a;if(!Uu(m)){let _=Nd(m);for(;_&&!Dm(_);){if(Sa(_)&&!Yv(_))return _;_=Nd(_)}return a}let c=cS(m,g);for(;c&&RP(c)&&Yv(c);)c=cS(c,g);return c&&Dm(c)&&Yv(c)&&!$x(c)?a:c||zP(m)||a}const YP=async function(m){const g=this.getOffsetParent||_2,a=this.getDimensions,c=await a(m.floating);return{reference:qP(m.reference,await g(m.floating),m.strategy),floating:{x:0,y:0,width:c.width,height:c.height}}};function XP(m){return Zl(m).direction==="rtl"}const ZP={convertOffsetParentRelativeRectToViewportRelativeRect:NP,getDocumentElement:ju,getClippingRect:GP,getOffsetParent:_2,getElementRects:YP,getClientRects:VP,getDimensions:WP,getScale:Tm,isElement:Sa,isRTL:XP};function y2(m,g){return m.x===g.x&&m.y===g.y&&m.width===g.width&&m.height===g.height}function KP(m,g){let a=null,c;const _=ju(m);function A(){var r;clearTimeout(c),(r=a)==null||r.disconnect(),a=null}function N(r,W){r===void 0&&(r=!1),W===void 0&&(W=1),A();const ie=m.getBoundingClientRect(),{left:oe,top:he,width:ve,height:Se}=ie;if(r||g(),!ve||!Se)return;const xe=hy(he),Ae=hy(_.clientWidth-(oe+ve)),Re=hy(_.clientHeight-(he+Se)),He=hy(oe),ht={rootMargin:-xe+"px "+-Ae+"px "+-Re+"px "+-He+"px",threshold:of(0,Am(1,W))||1};let tt=!0;function at(Lt){const Ve=Lt[0].intersectionRatio;if(Ve!==W){if(!tt)return N();Ve?N(!1,Ve):c=setTimeout(()=>{N(!1,1e-7)},1e3)}Ve===1&&!y2(ie,m.getBoundingClientRect())&&N(),tt=!1}try{a=new IntersectionObserver(at,{...ht,root:_.ownerDocument})}catch{a=new IntersectionObserver(at,ht)}a.observe(m)}return N(!0),A}function v2(m,g,a,c){c===void 0&&(c={});const{ancestorScroll:_=!0,ancestorResize:A=!0,elementResize:N=typeof ResizeObserver=="function",layoutShift:r=typeof IntersectionObserver=="function",animationFrame:W=!1}=c,ie=Gx(m),oe=_||A?[...ie?Kg(ie):[],...Kg(g)]:[];oe.forEach(He=>{_&&He.addEventListener("scroll",a,{passive:!0}),A&&He.addEventListener("resize",a)});const he=ie&&r?KP(ie,a):null;let ve=-1,Se=null;N&&(Se=new ResizeObserver(He=>{let[rt]=He;rt&&rt.target===ie&&Se&&(Se.unobserve(g),cancelAnimationFrame(ve),ve=requestAnimationFrame(()=>{var ht;(ht=Se)==null||ht.observe(g)})),a()}),ie&&!W&&Se.observe(ie),Se.observe(g));let xe,Ae=W?uf(m):null;W&&Re();function Re(){const He=uf(m);Ae&&!y2(Ae,He)&&a(),Ae=He,xe=requestAnimationFrame(Re)}return a(),()=>{var He;oe.forEach(rt=>{_&&rt.removeEventListener("scroll",a),A&&rt.removeEventListener("resize",a)}),he==null||he(),(He=Se)==null||He.disconnect(),Se=null,W&&cancelAnimationFrame(xe)}}const JP=LP,QP=kP,uS=IP,eD=(m,g,a)=>{const c=new Map,_={platform:ZP,...a},A={..._.platform,_c:c};return PP(m,g,{..._,platform:A})};var xx=Xe.useLayoutEffect,tD=["className","clearValue","cx","getStyles","getClassNames","getValue","hasValue","isMulti","isRtl","options","selectOption","selectProps","setValue","theme"],Wy=function(){};function iD(m,g){return g?g[0]==="-"?m+g:m+"__"+g:m}function rD(m,g){for(var a=arguments.length,c=new Array(a>2?a-2:0),_=2;_<a;_++)c[_-2]=arguments[_];var A=[].concat(c);if(g&&m)for(var N in g)g.hasOwnProperty(N)&&g[N]&&A.push("".concat(iD(m,N)));return A.filter(function(r){return r}).map(function(r){return String(r).trim()}).join(" ")}var hS=function(g){return dD(g)?g.filter(Boolean):cf(g)==="object"&&g!==null?[g]:[]},x2=function(g){g.className,g.clearValue,g.cx,g.getStyles,g.getClassNames,g.getValue,g.hasValue,g.isMulti,g.isRtl,g.options,g.selectOption,g.selectProps,g.setValue,g.theme;var a=Lh(g,tD);return vr({},a)},Us=function(g,a,c){var _=g.cx,A=g.getStyles,N=g.getClassNames,r=g.className;return{css:A(a,g),className:_(c??{},N(a,g),r)}};function g0(m){return[document.documentElement,document.body,window].indexOf(m)>-1}function nD(m){return g0(m)?window.innerHeight:m.clientHeight}function b2(m){return g0(m)?window.pageYOffset:m.scrollTop}function qy(m,g){if(g0(m)){window.scrollTo(0,g);return}m.scrollTop=g}function sD(m){var g=getComputedStyle(m),a=g.position==="absolute",c=/(auto|scroll)/;if(g.position==="fixed")return document.documentElement;for(var _=m;_=_.parentElement;)if(g=getComputedStyle(_),!(a&&g.position==="static")&&c.test(g.overflow+g.overflowY+g.overflowX))return _;return document.documentElement}function oD(m,g,a,c){return a*((m=m/c-1)*m*m+1)+g}function dy(m,g){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:200,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Wy,_=b2(m),A=g-_,N=10,r=0;function W(){r+=N;var ie=oD(r,_,A,a);qy(m,ie),r<a?window.requestAnimationFrame(W):c(m)}W()}function dS(m,g){var a=m.getBoundingClientRect(),c=g.getBoundingClientRect(),_=g.offsetHeight/3;c.bottom+_>a.bottom?qy(m,Math.min(g.offsetTop+g.clientHeight-m.offsetHeight+_,m.scrollHeight)):c.top-_<a.top&&qy(m,Math.max(g.offsetTop-_,0))}function aD(m){var g=m.getBoundingClientRect();return{bottom:g.bottom,height:g.height,left:g.left,right:g.right,top:g.top,width:g.width}}function pS(){try{return document.createEvent("TouchEvent"),!0}catch{return!1}}function lD(){try{return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}catch{return!1}}var w2=!1,cD={get passive(){return w2=!0}},py=typeof window<"u"?window:{};py.addEventListener&&py.removeEventListener&&(py.addEventListener("p",Wy,cD),py.removeEventListener("p",Wy,!1));var uD=w2;function hD(m){return m!=null}function dD(m){return Array.isArray(m)}function fy(m,g,a){return m?g:a}var pD=function(g){for(var a=arguments.length,c=new Array(a>1?a-1:0),_=1;_<a;_++)c[_-1]=arguments[_];var A=Object.entries(g).filter(function(N){var r=Ch(N,1),W=r[0];return!c.includes(W)});return A.reduce(function(N,r){var W=Ch(r,2),ie=W[0],oe=W[1];return N[ie]=oe,N},{})},fD=["children","innerProps"],mD=["children","innerProps"];function gD(m){var g=m.maxHeight,a=m.menuEl,c=m.minHeight,_=m.placement,A=m.shouldScroll,N=m.isFixedPosition,r=m.controlHeight,W=sD(a),ie={placement:"bottom",maxHeight:g};if(!a||!a.offsetParent)return ie;var oe=W.getBoundingClientRect(),he=oe.height,ve=a.getBoundingClientRect(),Se=ve.bottom,xe=ve.height,Ae=ve.top,Re=a.offsetParent.getBoundingClientRect(),He=Re.top,rt=N?window.innerHeight:nD(W),ht=b2(W),tt=parseInt(getComputedStyle(a).marginBottom,10),at=parseInt(getComputedStyle(a).marginTop,10),Lt=He-at,Ve=rt-Ae,Tt=Lt+ht,qt=he-ht-Ae,Me=Se-rt+ht+tt,gt=ht+Ae-at,oi=160;switch(_){case"auto":case"bottom":if(Ve>=xe)return{placement:"bottom",maxHeight:g};if(qt>=xe&&!N)return A&&dy(W,Me,oi),{placement:"bottom",maxHeight:g};if(!N&&qt>=c||N&&Ve>=c){A&&dy(W,Me,oi);var Ti=N?Ve-tt:qt-tt;return{placement:"bottom",maxHeight:Ti}}if(_==="auto"||N){var ni=g,Mt=N?Lt:Tt;return Mt>=c&&(ni=Math.min(Mt-tt-r,g)),{placement:"top",maxHeight:ni}}if(_==="bottom")return A&&qy(W,Me),{placement:"bottom",maxHeight:g};break;case"top":if(Lt>=xe)return{placement:"top",maxHeight:g};if(Tt>=xe&&!N)return A&&dy(W,gt,oi),{placement:"top",maxHeight:g};if(!N&&Tt>=c||N&&Lt>=c){var zt=g;return(!N&&Tt>=c||N&&Lt>=c)&&(zt=N?Lt-at:Tt-at),A&&dy(W,gt,oi),{placement:"top",maxHeight:zt}}return{placement:"bottom",maxHeight:g};default:throw new Error('Invalid placement provided "'.concat(_,'".'))}return ie}function _D(m){var g={bottom:"top",top:"bottom"};return m?g[m]:"bottom"}var S2=function(g){return g==="auto"?"bottom":g},yD=function(g,a){var c,_=g.placement,A=g.theme,N=A.borderRadius,r=A.spacing,W=A.colors;return vr((c={label:"menu"},Vg(c,_D(_),"100%"),Vg(c,"position","absolute"),Vg(c,"width","100%"),Vg(c,"zIndex",1),c),a?{}:{backgroundColor:W.neutral0,borderRadius:N,boxShadow:"0 0 0 1px hsla(0, 0%, 0%, 0.1), 0 4px 11px hsla(0, 0%, 0%, 0.1)",marginBottom:r.menuGutter,marginTop:r.menuGutter})},T2=Xe.createContext(null),vD=function(g){var a=g.children,c=g.minMenuHeight,_=g.maxMenuHeight,A=g.menuPlacement,N=g.menuPosition,r=g.menuShouldScrollIntoView,W=g.theme,ie=Xe.useContext(T2)||{},oe=ie.setPortalPlacement,he=Xe.useRef(null),ve=Xe.useState(_),Se=Ch(ve,2),xe=Se[0],Ae=Se[1],Re=Xe.useState(null),He=Ch(Re,2),rt=He[0],ht=He[1],tt=W.spacing.controlHeight;return xx(function(){var at=he.current;if(at){var Lt=N==="fixed",Ve=r&&!Lt,Tt=gD({maxHeight:_,menuEl:at,minHeight:c,placement:A,shouldScroll:Ve,isFixedPosition:Lt,controlHeight:tt});Ae(Tt.maxHeight),ht(Tt.placement),oe==null||oe(Tt.placement)}},[_,A,N,r,c,oe,tt]),a({ref:he,placerProps:vr(vr({},g),{},{placement:rt||S2(A),maxHeight:xe})})},xD=function(g){var a=g.children,c=g.innerRef,_=g.innerProps;return hr("div",yr({},Us(g,"menu",{menu:!0}),{ref:c},_),a)},bD=xD,wD=function(g,a){var c=g.maxHeight,_=g.theme.spacing.baseUnit;return vr({maxHeight:c,overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},a?{}:{paddingBottom:_,paddingTop:_})},SD=function(g){var a=g.children,c=g.innerProps,_=g.innerRef,A=g.isMulti;return hr("div",yr({},Us(g,"menuList",{"menu-list":!0,"menu-list--is-multi":A}),{ref:_},c),a)},M2=function(g,a){var c=g.theme,_=c.spacing.baseUnit,A=c.colors;return vr({textAlign:"center"},a?{}:{color:A.neutral40,padding:"".concat(_*2,"px ").concat(_*3,"px")})},TD=M2,MD=M2,CD=function(g){var a=g.children,c=a===void 0?"No options":a,_=g.innerProps,A=Lh(g,fD);return hr("div",yr({},Us(vr(vr({},A),{},{children:c,innerProps:_}),"noOptionsMessage",{"menu-notice":!0,"menu-notice--no-options":!0}),_),c)},ED=function(g){var a=g.children,c=a===void 0?"Loading...":a,_=g.innerProps,A=Lh(g,mD);return hr("div",yr({},Us(vr(vr({},A),{},{children:c,innerProps:_}),"loadingMessage",{"menu-notice":!0,"menu-notice--loading":!0}),_),c)},AD=function(g){var a=g.rect,c=g.offset,_=g.position;return{left:a.left,position:_,top:c,width:a.width,zIndex:1}},PD=function(g){var a=g.appendTo,c=g.children,_=g.controlElement,A=g.innerProps,N=g.menuPlacement,r=g.menuPosition,W=Xe.useRef(null),ie=Xe.useRef(null),oe=Xe.useState(S2(N)),he=Ch(oe,2),ve=he[0],Se=he[1],xe=Xe.useMemo(function(){return{setPortalPlacement:Se}},[]),Ae=Xe.useState(null),Re=Ch(Ae,2),He=Re[0],rt=Re[1],ht=Xe.useCallback(function(){if(_){var Ve=aD(_),Tt=r==="fixed"?0:window.pageYOffset,qt=Ve[ve]+Tt;(qt!==(He==null?void 0:He.offset)||Ve.left!==(He==null?void 0:He.rect.left)||Ve.width!==(He==null?void 0:He.rect.width))&&rt({offset:qt,rect:Ve})}},[_,r,ve,He==null?void 0:He.offset,He==null?void 0:He.rect.left,He==null?void 0:He.rect.width]);xx(function(){ht()},[ht]);var tt=Xe.useCallback(function(){typeof ie.current=="function"&&(ie.current(),ie.current=null),_&&W.current&&(ie.current=v2(_,W.current,ht,{elementResize:"ResizeObserver"in window}))},[_,ht]);xx(function(){tt()},[tt]);var at=Xe.useCallback(function(Ve){W.current=Ve,tt()},[tt]);if(!a&&r!=="fixed"||!He)return null;var Lt=hr("div",yr({ref:at},Us(vr(vr({},g),{},{offset:He.offset,position:r,rect:He.rect}),"menuPortal",{"menu-portal":!0}),A),c);return hr(T2.Provider,{value:xe},a?Lx.createPortal(Lt,a):Lt)},DD=function(g){var a=g.isDisabled,c=g.isRtl;return{label:"container",direction:c?"rtl":void 0,pointerEvents:a?"none":void 0,position:"relative"}},ID=function(g){var a=g.children,c=g.innerProps,_=g.isDisabled,A=g.isRtl;return hr("div",yr({},Us(g,"container",{"--is-disabled":_,"--is-rtl":A}),c),a)},kD=function(g,a){var c=g.theme.spacing,_=g.isMulti,A=g.hasValue,N=g.selectProps.controlShouldRenderValue;return vr({alignItems:"center",display:_&&A&&N?"flex":"grid",flex:1,flexWrap:"wrap",WebkitOverflowScrolling:"touch",position:"relative",overflow:"hidden"},a?{}:{padding:"".concat(c.baseUnit/2,"px ").concat(c.baseUnit*2,"px")})},OD=function(g){var a=g.children,c=g.innerProps,_=g.isMulti,A=g.hasValue;return hr("div",yr({},Us(g,"valueContainer",{"value-container":!0,"value-container--is-multi":_,"value-container--has-value":A}),c),a)},LD=function(){return{alignItems:"center",alignSelf:"stretch",display:"flex",flexShrink:0}},RD=function(g){var a=g.children,c=g.innerProps;return hr("div",yr({},Us(g,"indicatorsContainer",{indicators:!0}),c),a)},fS,zD=["size"],FD=["innerProps","isRtl","size"],BD={name:"8mmkcg",styles:"display:inline-block;fill:currentColor;line-height:1;stroke:currentColor;stroke-width:0"},C2=function(g){var a=g.size,c=Lh(g,zD);return hr("svg",yr({height:a,width:a,viewBox:"0 0 20 20","aria-hidden":"true",focusable:"false",css:BD},c))},qx=function(g){return hr(C2,yr({size:20},g),hr("path",{d:"M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"}))},E2=function(g){return hr(C2,yr({size:20},g),hr("path",{d:"M4.516 7.548c0.436-0.446 1.043-0.481 1.576 0l3.908 3.747 3.908-3.747c0.533-0.481 1.141-0.446 1.574 0 0.436 0.445 0.408 1.197 0 1.615-0.406 0.418-4.695 4.502-4.695 4.502-0.217 0.223-0.502 0.335-0.787 0.335s-0.57-0.112-0.789-0.335c0 0-4.287-4.084-4.695-4.502s-0.436-1.17 0-1.615z"}))},A2=function(g,a){var c=g.isFocused,_=g.theme,A=_.spacing.baseUnit,N=_.colors;return vr({label:"indicatorContainer",display:"flex",transition:"color 150ms"},a?{}:{color:c?N.neutral60:N.neutral20,padding:A*2,":hover":{color:c?N.neutral80:N.neutral40}})},ND=A2,VD=function(g){var a=g.children,c=g.innerProps;return hr("div",yr({},Us(g,"dropdownIndicator",{indicator:!0,"dropdown-indicator":!0}),c),a||hr(E2,null))},UD=A2,jD=function(g){var a=g.children,c=g.innerProps;return hr("div",yr({},Us(g,"clearIndicator",{indicator:!0,"clear-indicator":!0}),c),a||hr(qx,null))},$D=function(g,a){var c=g.isDisabled,_=g.theme,A=_.spacing.baseUnit,N=_.colors;return vr({label:"indicatorSeparator",alignSelf:"stretch",width:1},a?{}:{backgroundColor:c?N.neutral10:N.neutral20,marginBottom:A*2,marginTop:A*2})},HD=function(g){var a=g.innerProps;return hr("span",yr({},a,Us(g,"indicatorSeparator",{"indicator-separator":!0})))},GD=Fm(fS||(fS=vP([`
  0%, 80%, 100% { opacity: 0; }
  40% { opacity: 1; }
`]))),WD=function(g,a){var c=g.isFocused,_=g.size,A=g.theme,N=A.colors,r=A.spacing.baseUnit;return vr({label:"loadingIndicator",display:"flex",transition:"color 150ms",alignSelf:"center",fontSize:_,lineHeight:1,marginRight:_,textAlign:"center",verticalAlign:"middle"},a?{}:{color:c?N.neutral60:N.neutral20,padding:r*2})},Xv=function(g){var a=g.delay,c=g.offset;return hr("span",{css:n_({animation:"".concat(GD," 1s ease-in-out ").concat(a,"ms infinite;"),backgroundColor:"currentColor",borderRadius:"1em",display:"inline-block",marginLeft:c?"1em":void 0,height:"1em",verticalAlign:"top",width:"1em"},"","")})},qD=function(g){var a=g.innerProps,c=g.isRtl,_=g.size,A=_===void 0?4:_,N=Lh(g,FD);return hr("div",yr({},Us(vr(vr({},N),{},{innerProps:a,isRtl:c,size:A}),"loadingIndicator",{indicator:!0,"loading-indicator":!0}),a),hr(Xv,{delay:0,offset:c}),hr(Xv,{delay:160,offset:!0}),hr(Xv,{delay:320,offset:!c}))},YD=function(g,a){var c=g.isDisabled,_=g.isFocused,A=g.theme,N=A.colors,r=A.borderRadius,W=A.spacing;return vr({label:"control",alignItems:"center",cursor:"default",display:"flex",flexWrap:"wrap",justifyContent:"space-between",minHeight:W.controlHeight,outline:"0 !important",position:"relative",transition:"all 100ms"},a?{}:{backgroundColor:c?N.neutral5:N.neutral0,borderColor:c?N.neutral10:_?N.primary:N.neutral20,borderRadius:r,borderStyle:"solid",borderWidth:1,boxShadow:_?"0 0 0 1px ".concat(N.primary):void 0,"&:hover":{borderColor:_?N.primary:N.neutral30}})},XD=function(g){var a=g.children,c=g.isDisabled,_=g.isFocused,A=g.innerRef,N=g.innerProps,r=g.menuIsOpen;return hr("div",yr({ref:A},Us(g,"control",{control:!0,"control--is-disabled":c,"control--is-focused":_,"control--menu-is-open":r}),N,{"aria-disabled":c||void 0}),a)},ZD=XD,KD=["data"],JD=function(g,a){var c=g.theme.spacing;return a?{}:{paddingBottom:c.baseUnit*2,paddingTop:c.baseUnit*2}},QD=function(g){var a=g.children,c=g.cx,_=g.getStyles,A=g.getClassNames,N=g.Heading,r=g.headingProps,W=g.innerProps,ie=g.label,oe=g.theme,he=g.selectProps;return hr("div",yr({},Us(g,"group",{group:!0}),W),hr(N,yr({},r,{selectProps:he,theme:oe,getStyles:_,getClassNames:A,cx:c}),ie),hr("div",null,a))},eI=function(g,a){var c=g.theme,_=c.colors,A=c.spacing;return vr({label:"group",cursor:"default",display:"block"},a?{}:{color:_.neutral40,fontSize:"75%",fontWeight:500,marginBottom:"0.25em",paddingLeft:A.baseUnit*3,paddingRight:A.baseUnit*3,textTransform:"uppercase"})},tI=function(g){var a=x2(g);a.data;var c=Lh(a,KD);return hr("div",yr({},Us(g,"groupHeading",{"group-heading":!0}),c))},iI=QD,rI=["innerRef","isDisabled","isHidden","inputClassName"],nI=function(g,a){var c=g.isDisabled,_=g.value,A=g.theme,N=A.spacing,r=A.colors;return vr(vr({visibility:c?"hidden":"visible",transform:_?"translateZ(0)":""},sI),a?{}:{margin:N.baseUnit/2,paddingBottom:N.baseUnit/2,paddingTop:N.baseUnit/2,color:r.neutral80})},P2={gridArea:"1 / 2",font:"inherit",minWidth:"2px",border:0,margin:0,outline:0,padding:0},sI={flex:"1 1 auto",display:"inline-grid",gridArea:"1 / 1 / 2 / 3",gridTemplateColumns:"0 min-content","&:after":vr({content:'attr(data-value) " "',visibility:"hidden",whiteSpace:"pre"},P2)},oI=function(g){return vr({label:"input",color:"inherit",background:0,opacity:g?0:1,width:"100%"},P2)},aI=function(g){var a=g.cx,c=g.value,_=x2(g),A=_.innerRef,N=_.isDisabled,r=_.isHidden,W=_.inputClassName,ie=Lh(_,rI);return hr("div",yr({},Us(g,"input",{"input-container":!0}),{"data-value":c||""}),hr("input",yr({className:a({input:!0},W),ref:A,style:oI(r),disabled:N},ie)))},lI=aI,cI=function(g,a){var c=g.theme,_=c.spacing,A=c.borderRadius,N=c.colors;return vr({label:"multiValue",display:"flex",minWidth:0},a?{}:{backgroundColor:N.neutral10,borderRadius:A/2,margin:_.baseUnit/2})},uI=function(g,a){var c=g.theme,_=c.borderRadius,A=c.colors,N=g.cropWithEllipsis;return vr({overflow:"hidden",textOverflow:N||N===void 0?"ellipsis":void 0,whiteSpace:"nowrap"},a?{}:{borderRadius:_/2,color:A.neutral80,fontSize:"85%",padding:3,paddingLeft:6})},hI=function(g,a){var c=g.theme,_=c.spacing,A=c.borderRadius,N=c.colors,r=g.isFocused;return vr({alignItems:"center",display:"flex"},a?{}:{borderRadius:A/2,backgroundColor:r?N.dangerLight:void 0,paddingLeft:_.baseUnit,paddingRight:_.baseUnit,":hover":{backgroundColor:N.dangerLight,color:N.danger}})},D2=function(g){var a=g.children,c=g.innerProps;return hr("div",c,a)},dI=D2,pI=D2;function fI(m){var g=m.children,a=m.innerProps;return hr("div",yr({role:"button"},a),g||hr(qx,{size:14}))}var mI=function(g){var a=g.children,c=g.components,_=g.data,A=g.innerProps,N=g.isDisabled,r=g.removeProps,W=g.selectProps,ie=c.Container,oe=c.Label,he=c.Remove;return hr(ie,{data:_,innerProps:vr(vr({},Us(g,"multiValue",{"multi-value":!0,"multi-value--is-disabled":N})),A),selectProps:W},hr(oe,{data:_,innerProps:vr({},Us(g,"multiValueLabel",{"multi-value__label":!0})),selectProps:W},a),hr(he,{data:_,innerProps:vr(vr({},Us(g,"multiValueRemove",{"multi-value__remove":!0})),{},{"aria-label":"Remove ".concat(a||"option")},r),selectProps:W}))},gI=mI,_I=function(g,a){var c=g.isDisabled,_=g.isFocused,A=g.isSelected,N=g.theme,r=N.spacing,W=N.colors;return vr({label:"option",cursor:"default",display:"block",fontSize:"inherit",width:"100%",userSelect:"none",WebkitTapHighlightColor:"rgba(0, 0, 0, 0)"},a?{}:{backgroundColor:A?W.primary:_?W.primary25:"transparent",color:c?W.neutral20:A?W.neutral0:"inherit",padding:"".concat(r.baseUnit*2,"px ").concat(r.baseUnit*3,"px"),":active":{backgroundColor:c?void 0:A?W.primary:W.primary50}})},yI=function(g){var a=g.children,c=g.isDisabled,_=g.isFocused,A=g.isSelected,N=g.innerRef,r=g.innerProps;return hr("div",yr({},Us(g,"option",{option:!0,"option--is-disabled":c,"option--is-focused":_,"option--is-selected":A}),{ref:N,"aria-disabled":c},r),a)},vI=yI,xI=function(g,a){var c=g.theme,_=c.spacing,A=c.colors;return vr({label:"placeholder",gridArea:"1 / 1 / 2 / 3"},a?{}:{color:A.neutral50,marginLeft:_.baseUnit/2,marginRight:_.baseUnit/2})},bI=function(g){var a=g.children,c=g.innerProps;return hr("div",yr({},Us(g,"placeholder",{placeholder:!0}),c),a)},wI=bI,SI=function(g,a){var c=g.isDisabled,_=g.theme,A=_.spacing,N=_.colors;return vr({label:"singleValue",gridArea:"1 / 1 / 2 / 3",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},a?{}:{color:c?N.neutral40:N.neutral80,marginLeft:A.baseUnit/2,marginRight:A.baseUnit/2})},TI=function(g){var a=g.children,c=g.isDisabled,_=g.innerProps;return hr("div",yr({},Us(g,"singleValue",{"single-value":!0,"single-value--is-disabled":c}),_),a)},MI=TI,CI={ClearIndicator:jD,Control:ZD,DropdownIndicator:VD,DownChevron:E2,CrossIcon:qx,Group:iI,GroupHeading:tI,IndicatorsContainer:RD,IndicatorSeparator:HD,Input:lI,LoadingIndicator:qD,Menu:bD,MenuList:SD,MenuPortal:PD,LoadingMessage:ED,NoOptionsMessage:CD,MultiValue:gI,MultiValueContainer:dI,MultiValueLabel:pI,MultiValueRemove:fI,Option:vI,Placeholder:wI,SelectContainer:ID,SingleValue:MI,ValueContainer:OD},EI=function(g){return vr(vr({},CI),g.components)},mS=Number.isNaN||function(g){return typeof g=="number"&&g!==g};function AI(m,g){return!!(m===g||mS(m)&&mS(g))}function PI(m,g){if(m.length!==g.length)return!1;for(var a=0;a<m.length;a++)if(!AI(m[a],g[a]))return!1;return!0}function DI(m,g){g===void 0&&(g=PI);var a=null;function c(){for(var _=[],A=0;A<arguments.length;A++)_[A]=arguments[A];if(a&&a.lastThis===this&&g(_,a.lastArgs))return a.lastResult;var N=m.apply(this,_);return a={lastResult:N,lastArgs:_,lastThis:this},N}return c.clear=function(){a=null},c}var II={name:"7pg0cj-a11yText",styles:"label:a11yText;z-index:9999;border:0;clip:rect(1px, 1px, 1px, 1px);height:1px;width:1px;position:absolute;overflow:hidden;padding:0;white-space:nowrap"},kI=function(g){return hr("span",yr({css:II},g))},gS=kI,OI={guidance:function(g){var a=g.isSearchable,c=g.isMulti,_=g.tabSelectsValue,A=g.context,N=g.isInitialFocus;switch(A){case"menu":return"Use Up and Down to choose options, press Enter to select the currently focused option, press Escape to exit the menu".concat(_?", press Tab to select the option and exit the menu":"",".");case"input":return N?"".concat(g["aria-label"]||"Select"," is focused ").concat(a?",type to refine list":"",", press Down to open the menu, ").concat(c?" press left to focus selected values":""):"";case"value":return"Use left and right to toggle between focused values, press Backspace to remove the currently focused value";default:return""}},onChange:function(g){var a=g.action,c=g.label,_=c===void 0?"":c,A=g.labels,N=g.isDisabled;switch(a){case"deselect-option":case"pop-value":case"remove-value":return"option ".concat(_,", deselected.");case"clear":return"All selected options have been cleared.";case"initial-input-focus":return"option".concat(A.length>1?"s":""," ").concat(A.join(","),", selected.");case"select-option":return N?"option ".concat(_," is disabled. Select another option."):"option ".concat(_,", selected.");default:return""}},onFocus:function(g){var a=g.context,c=g.focused,_=g.options,A=g.label,N=A===void 0?"":A,r=g.selectValue,W=g.isDisabled,ie=g.isSelected,oe=g.isAppleDevice,he=function(Ae,Re){return Ae&&Ae.length?"".concat(Ae.indexOf(Re)+1," of ").concat(Ae.length):""};if(a==="value"&&r)return"value ".concat(N," focused, ").concat(he(r,c),".");if(a==="menu"&&oe){var ve=W?" disabled":"",Se="".concat(ie?" selected":"").concat(ve);return"".concat(N).concat(Se,", ").concat(he(_,c),".")}return""},onFilter:function(g){var a=g.inputValue,c=g.resultsMessage;return"".concat(c).concat(a?" for search term "+a:"",".")}},LI=function(g){var a=g.ariaSelection,c=g.focusedOption,_=g.focusedValue,A=g.focusableOptions,N=g.isFocused,r=g.selectValue,W=g.selectProps,ie=g.id,oe=g.isAppleDevice,he=W.ariaLiveMessages,ve=W.getOptionLabel,Se=W.inputValue,xe=W.isMulti,Ae=W.isOptionDisabled,Re=W.isSearchable,He=W.menuIsOpen,rt=W.options,ht=W.screenReaderStatus,tt=W.tabSelectsValue,at=W.isLoading,Lt=W["aria-label"],Ve=W["aria-live"],Tt=Xe.useMemo(function(){return vr(vr({},OI),he||{})},[he]),qt=Xe.useMemo(function(){var Mt="";if(a&&Tt.onChange){var zt=a.option,ii=a.options,Yt=a.removedValue,jt=a.removedValues,Ri=a.value,Yi=function(qr){return Array.isArray(qr)?null:qr},Wi=Yt||zt||Yi(Ri),vi=Wi?ve(Wi):"",Wr=ii||jt||void 0,an=Wr?Wr.map(ve):[],_n=vr({isDisabled:Wi&&Ae(Wi,r),label:vi,labels:an},a);Mt=Tt.onChange(_n)}return Mt},[a,Tt,Ae,r,ve]),Me=Xe.useMemo(function(){var Mt="",zt=c||_,ii=!!(c&&r&&r.includes(c));if(zt&&Tt.onFocus){var Yt={focused:zt,label:ve(zt),isDisabled:Ae(zt,r),isSelected:ii,options:A,context:zt===c?"menu":"value",selectValue:r,isAppleDevice:oe};Mt=Tt.onFocus(Yt)}return Mt},[c,_,ve,Ae,Tt,A,r,oe]),gt=Xe.useMemo(function(){var Mt="";if(He&&rt.length&&!at&&Tt.onFilter){var zt=ht({count:A.length});Mt=Tt.onFilter({inputValue:Se,resultsMessage:zt})}return Mt},[A,Se,He,Tt,rt,ht,at]),oi=(a==null?void 0:a.action)==="initial-input-focus",Ti=Xe.useMemo(function(){var Mt="";if(Tt.guidance){var zt=_?"value":He?"menu":"input";Mt=Tt.guidance({"aria-label":Lt,context:zt,isDisabled:c&&Ae(c,r),isMulti:xe,isSearchable:Re,tabSelectsValue:tt,isInitialFocus:oi})}return Mt},[Lt,c,_,xe,Ae,Re,He,Tt,r,tt,oi]),ni=hr(Xe.Fragment,null,hr("span",{id:"aria-selection"},qt),hr("span",{id:"aria-focused"},Me),hr("span",{id:"aria-results"},gt),hr("span",{id:"aria-guidance"},Ti));return hr(Xe.Fragment,null,hr(gS,{id:ie},oi&&ni),hr(gS,{"aria-live":Ve,"aria-atomic":"false","aria-relevant":"additions text",role:"log"},N&&!oi&&ni))},RI=LI,bx=[{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],zI=new RegExp("["+bx.map(function(m){return m.letters}).join("")+"]","g"),I2={};for(var Zv=0;Zv<bx.length;Zv++)for(var Kv=bx[Zv],Jv=0;Jv<Kv.letters.length;Jv++)I2[Kv.letters[Jv]]=Kv.base;var k2=function(g){return g.replace(zI,function(a){return I2[a]})},FI=DI(k2),_S=function(g){return g.replace(/^\s+|\s+$/g,"")},BI=function(g){return"".concat(g.label," ").concat(g.value)},NI=function(g){return function(a,c){if(a.data.__isNew__)return!0;var _=vr({ignoreCase:!0,ignoreAccents:!0,stringify:BI,trim:!0,matchFrom:"any"},g),A=_.ignoreCase,N=_.ignoreAccents,r=_.stringify,W=_.trim,ie=_.matchFrom,oe=W?_S(c):c,he=W?_S(r(a)):r(a);return A&&(oe=oe.toLowerCase(),he=he.toLowerCase()),N&&(oe=FI(oe),he=k2(he)),ie==="start"?he.substr(0,oe.length)===oe:he.indexOf(oe)>-1}},VI=["innerRef"];function UI(m){var g=m.innerRef,a=Lh(m,VI),c=pD(a,"onExited","in","enter","exit","appear");return hr("input",yr({ref:g},c,{css:n_({label:"dummyInput",background:0,border:0,caretColor:"transparent",fontSize:"inherit",gridArea:"1 / 1 / 2 / 3",outline:0,padding:0,width:1,color:"transparent",left:-100,opacity:0,position:"relative",transform:"scale(.01)"},"","")}))}var jI=function(g){g.cancelable&&g.preventDefault(),g.stopPropagation()};function $I(m){var g=m.isEnabled,a=m.onBottomArrive,c=m.onBottomLeave,_=m.onTopArrive,A=m.onTopLeave,N=Xe.useRef(!1),r=Xe.useRef(!1),W=Xe.useRef(0),ie=Xe.useRef(null),oe=Xe.useCallback(function(Re,He){if(ie.current!==null){var rt=ie.current,ht=rt.scrollTop,tt=rt.scrollHeight,at=rt.clientHeight,Lt=ie.current,Ve=He>0,Tt=tt-at-ht,qt=!1;Tt>He&&N.current&&(c&&c(Re),N.current=!1),Ve&&r.current&&(A&&A(Re),r.current=!1),Ve&&He>Tt?(a&&!N.current&&a(Re),Lt.scrollTop=tt,qt=!0,N.current=!0):!Ve&&-He>ht&&(_&&!r.current&&_(Re),Lt.scrollTop=0,qt=!0,r.current=!0),qt&&jI(Re)}},[a,c,_,A]),he=Xe.useCallback(function(Re){oe(Re,Re.deltaY)},[oe]),ve=Xe.useCallback(function(Re){W.current=Re.changedTouches[0].clientY},[]),Se=Xe.useCallback(function(Re){var He=W.current-Re.changedTouches[0].clientY;oe(Re,He)},[oe]),xe=Xe.useCallback(function(Re){if(Re){var He=uD?{passive:!1}:!1;Re.addEventListener("wheel",he,He),Re.addEventListener("touchstart",ve,He),Re.addEventListener("touchmove",Se,He)}},[Se,ve,he]),Ae=Xe.useCallback(function(Re){Re&&(Re.removeEventListener("wheel",he,!1),Re.removeEventListener("touchstart",ve,!1),Re.removeEventListener("touchmove",Se,!1))},[Se,ve,he]);return Xe.useEffect(function(){if(g){var Re=ie.current;return xe(Re),function(){Ae(Re)}}},[g,xe,Ae]),function(Re){ie.current=Re}}var yS=["boxSizing","height","overflow","paddingRight","position"],vS={boxSizing:"border-box",overflow:"hidden",position:"relative",height:"100%"};function xS(m){m.cancelable&&m.preventDefault()}function bS(m){m.stopPropagation()}function wS(){var m=this.scrollTop,g=this.scrollHeight,a=m+this.offsetHeight;m===0?this.scrollTop=1:a===g&&(this.scrollTop=m-1)}function SS(){return"ontouchstart"in window||navigator.maxTouchPoints}var TS=!!(typeof window<"u"&&window.document&&window.document.createElement),Og=0,mm={capture:!1,passive:!1};function HI(m){var g=m.isEnabled,a=m.accountForScrollbars,c=a===void 0?!0:a,_=Xe.useRef({}),A=Xe.useRef(null),N=Xe.useCallback(function(W){if(TS){var ie=document.body,oe=ie&&ie.style;if(c&&yS.forEach(function(xe){var Ae=oe&&oe[xe];_.current[xe]=Ae}),c&&Og<1){var he=parseInt(_.current.paddingRight,10)||0,ve=document.body?document.body.clientWidth:0,Se=window.innerWidth-ve+he||0;Object.keys(vS).forEach(function(xe){var Ae=vS[xe];oe&&(oe[xe]=Ae)}),oe&&(oe.paddingRight="".concat(Se,"px"))}ie&&SS()&&(ie.addEventListener("touchmove",xS,mm),W&&(W.addEventListener("touchstart",wS,mm),W.addEventListener("touchmove",bS,mm))),Og+=1}},[c]),r=Xe.useCallback(function(W){if(TS){var ie=document.body,oe=ie&&ie.style;Og=Math.max(Og-1,0),c&&Og<1&&yS.forEach(function(he){var ve=_.current[he];oe&&(oe[he]=ve)}),ie&&SS()&&(ie.removeEventListener("touchmove",xS,mm),W&&(W.removeEventListener("touchstart",wS,mm),W.removeEventListener("touchmove",bS,mm)))}},[c]);return Xe.useEffect(function(){if(g){var W=A.current;return N(W),function(){r(W)}}},[g,N,r]),function(W){A.current=W}}var GI=function(g){var a=g.target;return a.ownerDocument.activeElement&&a.ownerDocument.activeElement.blur()},WI={name:"1kfdb0e",styles:"position:fixed;left:0;bottom:0;right:0;top:0"};function qI(m){var g=m.children,a=m.lockEnabled,c=m.captureEnabled,_=c===void 0?!0:c,A=m.onBottomArrive,N=m.onBottomLeave,r=m.onTopArrive,W=m.onTopLeave,ie=$I({isEnabled:_,onBottomArrive:A,onBottomLeave:N,onTopArrive:r,onTopLeave:W}),oe=HI({isEnabled:a}),he=function(Se){ie(Se),oe(Se)};return hr(Xe.Fragment,null,a&&hr("div",{onClick:GI,css:WI}),g(he))}var YI={name:"1a0ro4n-requiredInput",styles:"label:requiredInput;opacity:0;pointer-events:none;position:absolute;bottom:0;left:0;right:0;width:100%"},XI=function(g){var a=g.name,c=g.onFocus;return hr("input",{required:!0,name:a,tabIndex:-1,"aria-hidden":"true",onFocus:c,css:YI,value:"",onChange:function(){}})},ZI=XI;function Yx(m){var g;return typeof window<"u"&&window.navigator!=null?m.test(((g=window.navigator.userAgentData)===null||g===void 0?void 0:g.platform)||window.navigator.platform):!1}function KI(){return Yx(/^iPhone/i)}function O2(){return Yx(/^Mac/i)}function JI(){return Yx(/^iPad/i)||O2()&&navigator.maxTouchPoints>1}function QI(){return KI()||JI()}function ek(){return O2()||QI()}var tk=function(g){return g.label},ik=function(g){return g.label},rk=function(g){return g.value},nk=function(g){return!!g.isDisabled},sk={clearIndicator:UD,container:DD,control:YD,dropdownIndicator:ND,group:JD,groupHeading:eI,indicatorsContainer:LD,indicatorSeparator:$D,input:nI,loadingIndicator:WD,loadingMessage:MD,menu:yD,menuList:wD,menuPortal:AD,multiValue:cI,multiValueLabel:uI,multiValueRemove:hI,noOptionsMessage:TD,option:_I,placeholder:xI,singleValue:SI,valueContainer:kD},ok={primary:"#2684FF",primary75:"#4C9AFF",primary50:"#B2D4FF",primary25:"#DEEBFF",danger:"#DE350B",dangerLight:"#FFBDAD",neutral0:"hsl(0, 0%, 100%)",neutral5:"hsl(0, 0%, 95%)",neutral10:"hsl(0, 0%, 90%)",neutral20:"hsl(0, 0%, 80%)",neutral30:"hsl(0, 0%, 70%)",neutral40:"hsl(0, 0%, 60%)",neutral50:"hsl(0, 0%, 50%)",neutral60:"hsl(0, 0%, 40%)",neutral70:"hsl(0, 0%, 30%)",neutral80:"hsl(0, 0%, 20%)",neutral90:"hsl(0, 0%, 10%)"},ak=4,L2=4,lk=38,ck=L2*2,uk={baseUnit:L2,controlHeight:lk,menuGutter:ck},Qv={borderRadius:ak,colors:ok,spacing:uk},hk={"aria-live":"polite",backspaceRemovesValue:!0,blurInputOnSelect:pS(),captureMenuScroll:!pS(),classNames:{},closeMenuOnSelect:!0,closeMenuOnScroll:!1,components:{},controlShouldRenderValue:!0,escapeClearsValue:!1,filterOption:NI(),formatGroupLabel:tk,getOptionLabel:ik,getOptionValue:rk,isDisabled:!1,isLoading:!1,isMulti:!1,isRtl:!1,isSearchable:!0,isOptionDisabled:nk,loadingMessage:function(){return"Loading..."},maxMenuHeight:300,minMenuHeight:140,menuIsOpen:!1,menuPlacement:"bottom",menuPosition:"absolute",menuShouldBlockScroll:!1,menuShouldScrollIntoView:!lD(),noOptionsMessage:function(){return"No options"},openMenuOnFocus:!1,openMenuOnClick:!0,options:[],pageSize:5,placeholder:"Select...",screenReaderStatus:function(g){var a=g.count;return"".concat(a," result").concat(a!==1?"s":""," available")},styles:{},tabIndex:0,tabSelectsValue:!0,unstyled:!1};function MS(m,g,a,c){var _=F2(m,g,a),A=B2(m,g,a),N=z2(m,g),r=Yy(m,g);return{type:"option",data:g,isDisabled:_,isSelected:A,label:N,value:r,index:c}}function Ey(m,g){return m.options.map(function(a,c){if("options"in a){var _=a.options.map(function(N,r){return MS(m,N,g,r)}).filter(function(N){return ES(m,N)});return _.length>0?{type:"group",data:a,options:_,index:c}:void 0}var A=MS(m,a,g,c);return ES(m,A)?A:void 0}).filter(hD)}function R2(m){return m.reduce(function(g,a){return a.type==="group"?g.push.apply(g,Rx(a.options.map(function(c){return c.data}))):g.push(a.data),g},[])}function CS(m,g){return m.reduce(function(a,c){return c.type==="group"?a.push.apply(a,Rx(c.options.map(function(_){return{data:_.data,id:"".concat(g,"-").concat(c.index,"-").concat(_.index)}}))):a.push({data:c.data,id:"".concat(g,"-").concat(c.index)}),a},[])}function dk(m,g){return R2(Ey(m,g))}function ES(m,g){var a=m.inputValue,c=a===void 0?"":a,_=g.data,A=g.isSelected,N=g.label,r=g.value;return(!V2(m)||!A)&&N2(m,{label:N,value:r,data:_},c)}function pk(m,g){var a=m.focusedValue,c=m.selectValue,_=c.indexOf(a);if(_>-1){var A=g.indexOf(a);if(A>-1)return a;if(_<g.length)return g[_]}return null}function fk(m,g){var a=m.focusedOption;return a&&g.indexOf(a)>-1?a:g[0]}var ex=function(g,a){var c,_=(c=g.find(function(A){return A.data===a}))===null||c===void 0?void 0:c.id;return _||null},z2=function(g,a){return g.getOptionLabel(a)},Yy=function(g,a){return g.getOptionValue(a)};function F2(m,g,a){return typeof m.isOptionDisabled=="function"?m.isOptionDisabled(g,a):!1}function B2(m,g,a){if(a.indexOf(g)>-1)return!0;if(typeof m.isOptionSelected=="function")return m.isOptionSelected(g,a);var c=Yy(m,g);return a.some(function(_){return Yy(m,_)===c})}function N2(m,g,a){return m.filterOption?m.filterOption(g,a):!0}var V2=function(g){var a=g.hideSelectedOptions,c=g.isMulti;return a===void 0?c:a},mk=1,U2=function(m){SA(a,m);var g=MA(a);function a(c){var _;if(bA(this,a),_=g.call(this,c),_.state={ariaSelection:null,focusedOption:null,focusedOptionId:null,focusableOptionsWithIds:[],focusedValue:null,inputIsHidden:!1,isFocused:!1,selectValue:[],clearFocusValueOnUpdate:!1,prevWasFocused:!1,inputIsHiddenAfterUpdate:void 0,prevProps:void 0,instancePrefix:""},_.blockOptionHover=!1,_.isComposing=!1,_.commonProps=void 0,_.initialTouchX=0,_.initialTouchY=0,_.openAfterFocus=!1,_.scrollToFocusedOptionOnUpdate=!1,_.userIsDragging=void 0,_.isAppleDevice=ek(),_.controlRef=null,_.getControlRef=function(W){_.controlRef=W},_.focusedOptionRef=null,_.getFocusedOptionRef=function(W){_.focusedOptionRef=W},_.menuListRef=null,_.getMenuListRef=function(W){_.menuListRef=W},_.inputRef=null,_.getInputRef=function(W){_.inputRef=W},_.focus=_.focusInput,_.blur=_.blurInput,_.onChange=function(W,ie){var oe=_.props,he=oe.onChange,ve=oe.name;ie.name=ve,_.ariaOnChange(W,ie),he(W,ie)},_.setValue=function(W,ie,oe){var he=_.props,ve=he.closeMenuOnSelect,Se=he.isMulti,xe=he.inputValue;_.onInputChange("",{action:"set-value",prevInputValue:xe}),ve&&(_.setState({inputIsHiddenAfterUpdate:!Se}),_.onMenuClose()),_.setState({clearFocusValueOnUpdate:!0}),_.onChange(W,{action:ie,option:oe})},_.selectOption=function(W){var ie=_.props,oe=ie.blurInputOnSelect,he=ie.isMulti,ve=ie.name,Se=_.state.selectValue,xe=he&&_.isOptionSelected(W,Se),Ae=_.isOptionDisabled(W,Se);if(xe){var Re=_.getOptionValue(W);_.setValue(Se.filter(function(He){return _.getOptionValue(He)!==Re}),"deselect-option",W)}else if(!Ae)he?_.setValue([].concat(Rx(Se),[W]),"select-option",W):_.setValue(W,"select-option");else{_.ariaOnChange(W,{action:"select-option",option:W,name:ve});return}oe&&_.blurInput()},_.removeValue=function(W){var ie=_.props.isMulti,oe=_.state.selectValue,he=_.getOptionValue(W),ve=oe.filter(function(xe){return _.getOptionValue(xe)!==he}),Se=fy(ie,ve,ve[0]||null);_.onChange(Se,{action:"remove-value",removedValue:W}),_.focusInput()},_.clearValue=function(){var W=_.state.selectValue;_.onChange(fy(_.props.isMulti,[],null),{action:"clear",removedValues:W})},_.popValue=function(){var W=_.props.isMulti,ie=_.state.selectValue,oe=ie[ie.length-1],he=ie.slice(0,ie.length-1),ve=fy(W,he,he[0]||null);oe&&_.onChange(ve,{action:"pop-value",removedValue:oe})},_.getFocusedOptionId=function(W){return ex(_.state.focusableOptionsWithIds,W)},_.getFocusableOptionsWithIds=function(){return CS(Ey(_.props,_.state.selectValue),_.getElementId("option"))},_.getValue=function(){return _.state.selectValue},_.cx=function(){for(var W=arguments.length,ie=new Array(W),oe=0;oe<W;oe++)ie[oe]=arguments[oe];return rD.apply(void 0,[_.props.classNamePrefix].concat(ie))},_.getOptionLabel=function(W){return z2(_.props,W)},_.getOptionValue=function(W){return Yy(_.props,W)},_.getStyles=function(W,ie){var oe=_.props.unstyled,he=sk[W](ie,oe);he.boxSizing="border-box";var ve=_.props.styles[W];return ve?ve(he,ie):he},_.getClassNames=function(W,ie){var oe,he;return(oe=(he=_.props.classNames)[W])===null||oe===void 0?void 0:oe.call(he,ie)},_.getElementId=function(W){return"".concat(_.state.instancePrefix,"-").concat(W)},_.getComponents=function(){return EI(_.props)},_.buildCategorizedOptions=function(){return Ey(_.props,_.state.selectValue)},_.getCategorizedOptions=function(){return _.props.menuIsOpen?_.buildCategorizedOptions():[]},_.buildFocusableOptions=function(){return R2(_.buildCategorizedOptions())},_.getFocusableOptions=function(){return _.props.menuIsOpen?_.buildFocusableOptions():[]},_.ariaOnChange=function(W,ie){_.setState({ariaSelection:vr({value:W},ie)})},_.onMenuMouseDown=function(W){W.button===0&&(W.stopPropagation(),W.preventDefault(),_.focusInput())},_.onMenuMouseMove=function(W){_.blockOptionHover=!1},_.onControlMouseDown=function(W){if(!W.defaultPrevented){var ie=_.props.openMenuOnClick;_.state.isFocused?_.props.menuIsOpen?W.target.tagName!=="INPUT"&&W.target.tagName!=="TEXTAREA"&&_.onMenuClose():ie&&_.openMenu("first"):(ie&&(_.openAfterFocus=!0),_.focusInput()),W.target.tagName!=="INPUT"&&W.target.tagName!=="TEXTAREA"&&W.preventDefault()}},_.onDropdownIndicatorMouseDown=function(W){if(!(W&&W.type==="mousedown"&&W.button!==0)&&!_.props.isDisabled){var ie=_.props,oe=ie.isMulti,he=ie.menuIsOpen;_.focusInput(),he?(_.setState({inputIsHiddenAfterUpdate:!oe}),_.onMenuClose()):_.openMenu("first"),W.preventDefault()}},_.onClearIndicatorMouseDown=function(W){W&&W.type==="mousedown"&&W.button!==0||(_.clearValue(),W.preventDefault(),_.openAfterFocus=!1,W.type==="touchend"?_.focusInput():setTimeout(function(){return _.focusInput()}))},_.onScroll=function(W){typeof _.props.closeMenuOnScroll=="boolean"?W.target instanceof HTMLElement&&g0(W.target)&&_.props.onMenuClose():typeof _.props.closeMenuOnScroll=="function"&&_.props.closeMenuOnScroll(W)&&_.props.onMenuClose()},_.onCompositionStart=function(){_.isComposing=!0},_.onCompositionEnd=function(){_.isComposing=!1},_.onTouchStart=function(W){var ie=W.touches,oe=ie&&ie.item(0);oe&&(_.initialTouchX=oe.clientX,_.initialTouchY=oe.clientY,_.userIsDragging=!1)},_.onTouchMove=function(W){var ie=W.touches,oe=ie&&ie.item(0);if(oe){var he=Math.abs(oe.clientX-_.initialTouchX),ve=Math.abs(oe.clientY-_.initialTouchY),Se=5;_.userIsDragging=he>Se||ve>Se}},_.onTouchEnd=function(W){_.userIsDragging||(_.controlRef&&!_.controlRef.contains(W.target)&&_.menuListRef&&!_.menuListRef.contains(W.target)&&_.blurInput(),_.initialTouchX=0,_.initialTouchY=0)},_.onControlTouchEnd=function(W){_.userIsDragging||_.onControlMouseDown(W)},_.onClearIndicatorTouchEnd=function(W){_.userIsDragging||_.onClearIndicatorMouseDown(W)},_.onDropdownIndicatorTouchEnd=function(W){_.userIsDragging||_.onDropdownIndicatorMouseDown(W)},_.handleInputChange=function(W){var ie=_.props.inputValue,oe=W.currentTarget.value;_.setState({inputIsHiddenAfterUpdate:!1}),_.onInputChange(oe,{action:"input-change",prevInputValue:ie}),_.props.menuIsOpen||_.onMenuOpen()},_.onInputFocus=function(W){_.props.onFocus&&_.props.onFocus(W),_.setState({inputIsHiddenAfterUpdate:!1,isFocused:!0}),(_.openAfterFocus||_.props.openMenuOnFocus)&&_.openMenu("first"),_.openAfterFocus=!1},_.onInputBlur=function(W){var ie=_.props.inputValue;if(_.menuListRef&&_.menuListRef.contains(document.activeElement)){_.inputRef.focus();return}_.props.onBlur&&_.props.onBlur(W),_.onInputChange("",{action:"input-blur",prevInputValue:ie}),_.onMenuClose(),_.setState({focusedValue:null,isFocused:!1})},_.onOptionHover=function(W){if(!(_.blockOptionHover||_.state.focusedOption===W)){var ie=_.getFocusableOptions(),oe=ie.indexOf(W);_.setState({focusedOption:W,focusedOptionId:oe>-1?_.getFocusedOptionId(W):null})}},_.shouldHideSelectedOptions=function(){return V2(_.props)},_.onValueInputFocus=function(W){W.preventDefault(),W.stopPropagation(),_.focus()},_.onKeyDown=function(W){var ie=_.props,oe=ie.isMulti,he=ie.backspaceRemovesValue,ve=ie.escapeClearsValue,Se=ie.inputValue,xe=ie.isClearable,Ae=ie.isDisabled,Re=ie.menuIsOpen,He=ie.onKeyDown,rt=ie.tabSelectsValue,ht=ie.openMenuOnFocus,tt=_.state,at=tt.focusedOption,Lt=tt.focusedValue,Ve=tt.selectValue;if(!Ae&&!(typeof He=="function"&&(He(W),W.defaultPrevented))){switch(_.blockOptionHover=!0,W.key){case"ArrowLeft":if(!oe||Se)return;_.focusValue("previous");break;case"ArrowRight":if(!oe||Se)return;_.focusValue("next");break;case"Delete":case"Backspace":if(Se)return;if(Lt)_.removeValue(Lt);else{if(!he)return;oe?_.popValue():xe&&_.clearValue()}break;case"Tab":if(_.isComposing||W.shiftKey||!Re||!rt||!at||ht&&_.isOptionSelected(at,Ve))return;_.selectOption(at);break;case"Enter":if(W.keyCode===229)break;if(Re){if(!at||_.isComposing)return;_.selectOption(at);break}return;case"Escape":Re?(_.setState({inputIsHiddenAfterUpdate:!1}),_.onInputChange("",{action:"menu-close",prevInputValue:Se}),_.onMenuClose()):xe&&ve&&_.clearValue();break;case" ":if(Se)return;if(!Re){_.openMenu("first");break}if(!at)return;_.selectOption(at);break;case"ArrowUp":Re?_.focusOption("up"):_.openMenu("last");break;case"ArrowDown":Re?_.focusOption("down"):_.openMenu("first");break;case"PageUp":if(!Re)return;_.focusOption("pageup");break;case"PageDown":if(!Re)return;_.focusOption("pagedown");break;case"Home":if(!Re)return;_.focusOption("first");break;case"End":if(!Re)return;_.focusOption("last");break;default:return}W.preventDefault()}},_.state.instancePrefix="react-select-"+(_.props.instanceId||++mk),_.state.selectValue=hS(c.value),c.menuIsOpen&&_.state.selectValue.length){var A=_.getFocusableOptionsWithIds(),N=_.buildFocusableOptions(),r=N.indexOf(_.state.selectValue[0]);_.state.focusableOptionsWithIds=A,_.state.focusedOption=N[r],_.state.focusedOptionId=ex(A,N[r])}return _}return wA(a,[{key:"componentDidMount",value:function(){this.startListeningComposition(),this.startListeningToTouch(),this.props.closeMenuOnScroll&&document&&document.addEventListener&&document.addEventListener("scroll",this.onScroll,!0),this.props.autoFocus&&this.focusInput(),this.props.menuIsOpen&&this.state.focusedOption&&this.menuListRef&&this.focusedOptionRef&&dS(this.menuListRef,this.focusedOptionRef)}},{key:"componentDidUpdate",value:function(_){var A=this.props,N=A.isDisabled,r=A.menuIsOpen,W=this.state.isFocused;(W&&!N&&_.isDisabled||W&&r&&!_.menuIsOpen)&&this.focusInput(),W&&N&&!_.isDisabled?this.setState({isFocused:!1},this.onMenuClose):!W&&!N&&_.isDisabled&&this.inputRef===document.activeElement&&this.setState({isFocused:!0}),this.menuListRef&&this.focusedOptionRef&&this.scrollToFocusedOptionOnUpdate&&(dS(this.menuListRef,this.focusedOptionRef),this.scrollToFocusedOptionOnUpdate=!1)}},{key:"componentWillUnmount",value:function(){this.stopListeningComposition(),this.stopListeningToTouch(),document.removeEventListener("scroll",this.onScroll,!0)}},{key:"onMenuOpen",value:function(){this.props.onMenuOpen()}},{key:"onMenuClose",value:function(){this.onInputChange("",{action:"menu-close",prevInputValue:this.props.inputValue}),this.props.onMenuClose()}},{key:"onInputChange",value:function(_,A){this.props.onInputChange(_,A)}},{key:"focusInput",value:function(){this.inputRef&&this.inputRef.focus()}},{key:"blurInput",value:function(){this.inputRef&&this.inputRef.blur()}},{key:"openMenu",value:function(_){var A=this,N=this.state,r=N.selectValue,W=N.isFocused,ie=this.buildFocusableOptions(),oe=_==="first"?0:ie.length-1;if(!this.props.isMulti){var he=ie.indexOf(r[0]);he>-1&&(oe=he)}this.scrollToFocusedOptionOnUpdate=!(W&&this.menuListRef),this.setState({inputIsHiddenAfterUpdate:!1,focusedValue:null,focusedOption:ie[oe],focusedOptionId:this.getFocusedOptionId(ie[oe])},function(){return A.onMenuOpen()})}},{key:"focusValue",value:function(_){var A=this.state,N=A.selectValue,r=A.focusedValue;if(this.props.isMulti){this.setState({focusedOption:null});var W=N.indexOf(r);r||(W=-1);var ie=N.length-1,oe=-1;if(N.length){switch(_){case"previous":W===0?oe=0:W===-1?oe=ie:oe=W-1;break;case"next":W>-1&&W<ie&&(oe=W+1);break}this.setState({inputIsHidden:oe!==-1,focusedValue:N[oe]})}}}},{key:"focusOption",value:function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"first",A=this.props.pageSize,N=this.state.focusedOption,r=this.getFocusableOptions();if(r.length){var W=0,ie=r.indexOf(N);N||(ie=-1),_==="up"?W=ie>0?ie-1:r.length-1:_==="down"?W=(ie+1)%r.length:_==="pageup"?(W=ie-A,W<0&&(W=0)):_==="pagedown"?(W=ie+A,W>r.length-1&&(W=r.length-1)):_==="last"&&(W=r.length-1),this.scrollToFocusedOptionOnUpdate=!0,this.setState({focusedOption:r[W],focusedValue:null,focusedOptionId:this.getFocusedOptionId(r[W])})}}},{key:"getTheme",value:function(){return this.props.theme?typeof this.props.theme=="function"?this.props.theme(Qv):vr(vr({},Qv),this.props.theme):Qv}},{key:"getCommonProps",value:function(){var _=this.clearValue,A=this.cx,N=this.getStyles,r=this.getClassNames,W=this.getValue,ie=this.selectOption,oe=this.setValue,he=this.props,ve=he.isMulti,Se=he.isRtl,xe=he.options,Ae=this.hasValue();return{clearValue:_,cx:A,getStyles:N,getClassNames:r,getValue:W,hasValue:Ae,isMulti:ve,isRtl:Se,options:xe,selectOption:ie,selectProps:he,setValue:oe,theme:this.getTheme()}}},{key:"hasValue",value:function(){var _=this.state.selectValue;return _.length>0}},{key:"hasOptions",value:function(){return!!this.getFocusableOptions().length}},{key:"isClearable",value:function(){var _=this.props,A=_.isClearable,N=_.isMulti;return A===void 0?N:A}},{key:"isOptionDisabled",value:function(_,A){return F2(this.props,_,A)}},{key:"isOptionSelected",value:function(_,A){return B2(this.props,_,A)}},{key:"filterOption",value:function(_,A){return N2(this.props,_,A)}},{key:"formatOptionLabel",value:function(_,A){if(typeof this.props.formatOptionLabel=="function"){var N=this.props.inputValue,r=this.state.selectValue;return this.props.formatOptionLabel(_,{context:A,inputValue:N,selectValue:r})}else return this.getOptionLabel(_)}},{key:"formatGroupLabel",value:function(_){return this.props.formatGroupLabel(_)}},{key:"startListeningComposition",value:function(){document&&document.addEventListener&&(document.addEventListener("compositionstart",this.onCompositionStart,!1),document.addEventListener("compositionend",this.onCompositionEnd,!1))}},{key:"stopListeningComposition",value:function(){document&&document.removeEventListener&&(document.removeEventListener("compositionstart",this.onCompositionStart),document.removeEventListener("compositionend",this.onCompositionEnd))}},{key:"startListeningToTouch",value:function(){document&&document.addEventListener&&(document.addEventListener("touchstart",this.onTouchStart,!1),document.addEventListener("touchmove",this.onTouchMove,!1),document.addEventListener("touchend",this.onTouchEnd,!1))}},{key:"stopListeningToTouch",value:function(){document&&document.removeEventListener&&(document.removeEventListener("touchstart",this.onTouchStart),document.removeEventListener("touchmove",this.onTouchMove),document.removeEventListener("touchend",this.onTouchEnd))}},{key:"renderInput",value:function(){var _=this.props,A=_.isDisabled,N=_.isSearchable,r=_.inputId,W=_.inputValue,ie=_.tabIndex,oe=_.form,he=_.menuIsOpen,ve=_.required,Se=this.getComponents(),xe=Se.Input,Ae=this.state,Re=Ae.inputIsHidden,He=Ae.ariaSelection,rt=this.commonProps,ht=r||this.getElementId("input"),tt=vr(vr(vr({"aria-autocomplete":"list","aria-expanded":he,"aria-haspopup":!0,"aria-errormessage":this.props["aria-errormessage"],"aria-invalid":this.props["aria-invalid"],"aria-label":this.props["aria-label"],"aria-labelledby":this.props["aria-labelledby"],"aria-required":ve,role:"combobox","aria-activedescendant":this.isAppleDevice?void 0:this.state.focusedOptionId||""},he&&{"aria-controls":this.getElementId("listbox")}),!N&&{"aria-readonly":!0}),this.hasValue()?(He==null?void 0:He.action)==="initial-input-focus"&&{"aria-describedby":this.getElementId("live-region")}:{"aria-describedby":this.getElementId("placeholder")});return N?Xe.createElement(xe,yr({},rt,{autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",id:ht,innerRef:this.getInputRef,isDisabled:A,isHidden:Re,onBlur:this.onInputBlur,onChange:this.handleInputChange,onFocus:this.onInputFocus,spellCheck:"false",tabIndex:ie,form:oe,type:"text",value:W},tt)):Xe.createElement(UI,yr({id:ht,innerRef:this.getInputRef,onBlur:this.onInputBlur,onChange:Wy,onFocus:this.onInputFocus,disabled:A,tabIndex:ie,inputMode:"none",form:oe,value:""},tt))}},{key:"renderPlaceholderOrValue",value:function(){var _=this,A=this.getComponents(),N=A.MultiValue,r=A.MultiValueContainer,W=A.MultiValueLabel,ie=A.MultiValueRemove,oe=A.SingleValue,he=A.Placeholder,ve=this.commonProps,Se=this.props,xe=Se.controlShouldRenderValue,Ae=Se.isDisabled,Re=Se.isMulti,He=Se.inputValue,rt=Se.placeholder,ht=this.state,tt=ht.selectValue,at=ht.focusedValue,Lt=ht.isFocused;if(!this.hasValue()||!xe)return He?null:Xe.createElement(he,yr({},ve,{key:"placeholder",isDisabled:Ae,isFocused:Lt,innerProps:{id:this.getElementId("placeholder")}}),rt);if(Re)return tt.map(function(Tt,qt){var Me=Tt===at,gt="".concat(_.getOptionLabel(Tt),"-").concat(_.getOptionValue(Tt));return Xe.createElement(N,yr({},ve,{components:{Container:r,Label:W,Remove:ie},isFocused:Me,isDisabled:Ae,key:gt,index:qt,removeProps:{onClick:function(){return _.removeValue(Tt)},onTouchEnd:function(){return _.removeValue(Tt)},onMouseDown:function(Ti){Ti.preventDefault()}},data:Tt}),_.formatOptionLabel(Tt,"value"))});if(He)return null;var Ve=tt[0];return Xe.createElement(oe,yr({},ve,{data:Ve,isDisabled:Ae}),this.formatOptionLabel(Ve,"value"))}},{key:"renderClearIndicator",value:function(){var _=this.getComponents(),A=_.ClearIndicator,N=this.commonProps,r=this.props,W=r.isDisabled,ie=r.isLoading,oe=this.state.isFocused;if(!this.isClearable()||!A||W||!this.hasValue()||ie)return null;var he={onMouseDown:this.onClearIndicatorMouseDown,onTouchEnd:this.onClearIndicatorTouchEnd,"aria-hidden":"true"};return Xe.createElement(A,yr({},N,{innerProps:he,isFocused:oe}))}},{key:"renderLoadingIndicator",value:function(){var _=this.getComponents(),A=_.LoadingIndicator,N=this.commonProps,r=this.props,W=r.isDisabled,ie=r.isLoading,oe=this.state.isFocused;if(!A||!ie)return null;var he={"aria-hidden":"true"};return Xe.createElement(A,yr({},N,{innerProps:he,isDisabled:W,isFocused:oe}))}},{key:"renderIndicatorSeparator",value:function(){var _=this.getComponents(),A=_.DropdownIndicator,N=_.IndicatorSeparator;if(!A||!N)return null;var r=this.commonProps,W=this.props.isDisabled,ie=this.state.isFocused;return Xe.createElement(N,yr({},r,{isDisabled:W,isFocused:ie}))}},{key:"renderDropdownIndicator",value:function(){var _=this.getComponents(),A=_.DropdownIndicator;if(!A)return null;var N=this.commonProps,r=this.props.isDisabled,W=this.state.isFocused,ie={onMouseDown:this.onDropdownIndicatorMouseDown,onTouchEnd:this.onDropdownIndicatorTouchEnd,"aria-hidden":"true"};return Xe.createElement(A,yr({},N,{innerProps:ie,isDisabled:r,isFocused:W}))}},{key:"renderMenu",value:function(){var _=this,A=this.getComponents(),N=A.Group,r=A.GroupHeading,W=A.Menu,ie=A.MenuList,oe=A.MenuPortal,he=A.LoadingMessage,ve=A.NoOptionsMessage,Se=A.Option,xe=this.commonProps,Ae=this.state.focusedOption,Re=this.props,He=Re.captureMenuScroll,rt=Re.inputValue,ht=Re.isLoading,tt=Re.loadingMessage,at=Re.minMenuHeight,Lt=Re.maxMenuHeight,Ve=Re.menuIsOpen,Tt=Re.menuPlacement,qt=Re.menuPosition,Me=Re.menuPortalTarget,gt=Re.menuShouldBlockScroll,oi=Re.menuShouldScrollIntoView,Ti=Re.noOptionsMessage,ni=Re.onMenuScrollToTop,Mt=Re.onMenuScrollToBottom;if(!Ve)return null;var zt=function(vi,Wr){var an=vi.type,_n=vi.data,En=vi.isDisabled,qr=vi.isSelected,es=vi.label,Ye=vi.value,ds=Ae===_n,Bi=En?void 0:function(){return _.onOptionHover(_n)},Xs=En?void 0:function(){return _.selectOption(_n)},Wt="".concat(_.getElementId("option"),"-").concat(Wr),jn={id:Wt,onClick:Xs,onMouseMove:Bi,onMouseOver:Bi,tabIndex:-1,role:"option","aria-selected":_.isAppleDevice?void 0:qr};return Xe.createElement(Se,yr({},xe,{innerProps:jn,data:_n,isDisabled:En,isSelected:qr,key:Wt,label:es,type:an,value:Ye,isFocused:ds,innerRef:ds?_.getFocusedOptionRef:void 0}),_.formatOptionLabel(vi.data,"menu"))},ii;if(this.hasOptions())ii=this.getCategorizedOptions().map(function(Wi){if(Wi.type==="group"){var vi=Wi.data,Wr=Wi.options,an=Wi.index,_n="".concat(_.getElementId("group"),"-").concat(an),En="".concat(_n,"-heading");return Xe.createElement(N,yr({},xe,{key:_n,data:vi,options:Wr,Heading:r,headingProps:{id:En,data:Wi.data},label:_.formatGroupLabel(Wi.data)}),Wi.options.map(function(qr){return zt(qr,"".concat(an,"-").concat(qr.index))}))}else if(Wi.type==="option")return zt(Wi,"".concat(Wi.index))});else if(ht){var Yt=tt({inputValue:rt});if(Yt===null)return null;ii=Xe.createElement(he,xe,Yt)}else{var jt=Ti({inputValue:rt});if(jt===null)return null;ii=Xe.createElement(ve,xe,jt)}var Ri={minMenuHeight:at,maxMenuHeight:Lt,menuPlacement:Tt,menuPosition:qt,menuShouldScrollIntoView:oi},Yi=Xe.createElement(vD,yr({},xe,Ri),function(Wi){var vi=Wi.ref,Wr=Wi.placerProps,an=Wr.placement,_n=Wr.maxHeight;return Xe.createElement(W,yr({},xe,Ri,{innerRef:vi,innerProps:{onMouseDown:_.onMenuMouseDown,onMouseMove:_.onMenuMouseMove},isLoading:ht,placement:an}),Xe.createElement(qI,{captureEnabled:He,onTopArrive:ni,onBottomArrive:Mt,lockEnabled:gt},function(En){return Xe.createElement(ie,yr({},xe,{innerRef:function(es){_.getMenuListRef(es),En(es)},innerProps:{role:"listbox","aria-multiselectable":xe.isMulti,id:_.getElementId("listbox")},isLoading:ht,maxHeight:_n,focusedOption:Ae}),ii)}))});return Me||qt==="fixed"?Xe.createElement(oe,yr({},xe,{appendTo:Me,controlElement:this.controlRef,menuPlacement:Tt,menuPosition:qt}),Yi):Yi}},{key:"renderFormField",value:function(){var _=this,A=this.props,N=A.delimiter,r=A.isDisabled,W=A.isMulti,ie=A.name,oe=A.required,he=this.state.selectValue;if(oe&&!this.hasValue()&&!r)return Xe.createElement(ZI,{name:ie,onFocus:this.onValueInputFocus});if(!(!ie||r))if(W)if(N){var ve=he.map(function(Ae){return _.getOptionValue(Ae)}).join(N);return Xe.createElement("input",{name:ie,type:"hidden",value:ve})}else{var Se=he.length>0?he.map(function(Ae,Re){return Xe.createElement("input",{key:"i-".concat(Re),name:ie,type:"hidden",value:_.getOptionValue(Ae)})}):Xe.createElement("input",{name:ie,type:"hidden",value:""});return Xe.createElement("div",null,Se)}else{var xe=he[0]?this.getOptionValue(he[0]):"";return Xe.createElement("input",{name:ie,type:"hidden",value:xe})}}},{key:"renderLiveRegion",value:function(){var _=this.commonProps,A=this.state,N=A.ariaSelection,r=A.focusedOption,W=A.focusedValue,ie=A.isFocused,oe=A.selectValue,he=this.getFocusableOptions();return Xe.createElement(RI,yr({},_,{id:this.getElementId("live-region"),ariaSelection:N,focusedOption:r,focusedValue:W,isFocused:ie,selectValue:oe,focusableOptions:he,isAppleDevice:this.isAppleDevice}))}},{key:"render",value:function(){var _=this.getComponents(),A=_.Control,N=_.IndicatorsContainer,r=_.SelectContainer,W=_.ValueContainer,ie=this.props,oe=ie.className,he=ie.id,ve=ie.isDisabled,Se=ie.menuIsOpen,xe=this.state.isFocused,Ae=this.commonProps=this.getCommonProps();return Xe.createElement(r,yr({},Ae,{className:oe,innerProps:{id:he,onKeyDown:this.onKeyDown},isDisabled:ve,isFocused:xe}),this.renderLiveRegion(),Xe.createElement(A,yr({},Ae,{innerRef:this.getControlRef,innerProps:{onMouseDown:this.onControlMouseDown,onTouchEnd:this.onControlTouchEnd},isDisabled:ve,isFocused:xe,menuIsOpen:Se}),Xe.createElement(W,yr({},Ae,{isDisabled:ve}),this.renderPlaceholderOrValue(),this.renderInput()),Xe.createElement(N,yr({},Ae,{isDisabled:ve}),this.renderClearIndicator(),this.renderLoadingIndicator(),this.renderIndicatorSeparator(),this.renderDropdownIndicator())),this.renderMenu(),this.renderFormField())}}],[{key:"getDerivedStateFromProps",value:function(_,A){var N=A.prevProps,r=A.clearFocusValueOnUpdate,W=A.inputIsHiddenAfterUpdate,ie=A.ariaSelection,oe=A.isFocused,he=A.prevWasFocused,ve=A.instancePrefix,Se=_.options,xe=_.value,Ae=_.menuIsOpen,Re=_.inputValue,He=_.isMulti,rt=hS(xe),ht={};if(N&&(xe!==N.value||Se!==N.options||Ae!==N.menuIsOpen||Re!==N.inputValue)){var tt=Ae?dk(_,rt):[],at=Ae?CS(Ey(_,rt),"".concat(ve,"-option")):[],Lt=r?pk(A,rt):null,Ve=fk(A,tt),Tt=ex(at,Ve);ht={selectValue:rt,focusedOption:Ve,focusedOptionId:Tt,focusableOptionsWithIds:at,focusedValue:Lt,clearFocusValueOnUpdate:!1}}var qt=W!=null&&_!==N?{inputIsHidden:W,inputIsHiddenAfterUpdate:void 0}:{},Me=ie,gt=oe&&he;return oe&&!gt&&(Me={value:fy(He,rt,rt[0]||null),options:rt,action:"initial-input-focus"},gt=!he),(ie==null?void 0:ie.action)==="initial-input-focus"&&(Me=null),vr(vr(vr({},ht),qt),{},{prevProps:_,ariaSelection:Me,prevWasFocused:gt})}}]),a}(Xe.Component);U2.defaultProps=hk;var gk=Xe.forwardRef(function(m,g){var a=xA(m);return Xe.createElement(U2,yr({ref:g},a))}),AS=gk;function j2(m){var g,a,c="";if(typeof m=="string"||typeof m=="number")c+=m;else if(typeof m=="object")if(Array.isArray(m)){var _=m.length;for(g=0;g<_;g++)m[g]&&(a=j2(m[g]))&&(c&&(c+=" "),c+=a)}else for(a in m)m[a]&&(c&&(c+=" "),c+=a);return c}function gn(){for(var m,g,a=0,c="",_=arguments.length;a<_;a++)(m=arguments[a])&&(g=j2(m))&&(c&&(c+=" "),c+=g);return c}const $2=6048e5,_k=864e5,_0=6e4,y0=36e5,yk=1e3,PS=Symbol.for("constructDateFrom");function Rn(m,g){return typeof m=="function"?m(g):m&&typeof m=="object"&&PS in m?m[PS](g):m instanceof Date?new m.constructor(g):new Date(g)}function ar(m,g){return Rn(g||m,m)}function zc(m,g,a){const c=ar(m,a==null?void 0:a.in);return isNaN(g)?Rn((a==null?void 0:a.in)||m,NaN):(g&&c.setDate(c.getDate()+g),c)}function Fc(m,g,a){const c=ar(m,a==null?void 0:a.in);if(isNaN(g))return Rn(m,NaN);if(!g)return c;const _=c.getDate(),A=Rn(m,c.getTime());A.setMonth(c.getMonth()+g+1,0);const N=A.getDate();return _>=N?A:(c.setFullYear(A.getFullYear(),A.getMonth(),_),c)}function H2(m,g,a){return Rn(m,+ar(m)+g)}function vk(m,g,a){return H2(m,g*y0)}let xk={};function ff(){return xk}function kh(m,g){var r,W,ie,oe;const a=ff(),c=(g==null?void 0:g.weekStartsOn)??((W=(r=g==null?void 0:g.locale)==null?void 0:r.options)==null?void 0:W.weekStartsOn)??a.weekStartsOn??((oe=(ie=a.locale)==null?void 0:ie.options)==null?void 0:oe.weekStartsOn)??0,_=ar(m,g==null?void 0:g.in),A=_.getDay(),N=(A<c?7:0)+A-c;return _.setDate(_.getDate()-N),_.setHours(0,0,0,0),_}function Im(m,g){return kh(m,{...g,weekStartsOn:1})}function G2(m,g){const a=ar(m,g==null?void 0:g.in),c=a.getFullYear(),_=Rn(a,0);_.setFullYear(c+1,0,4),_.setHours(0,0,0,0);const A=Im(_),N=Rn(a,0);N.setFullYear(c,0,4),N.setHours(0,0,0,0);const r=Im(N);return a.getTime()>=A.getTime()?c+1:a.getTime()>=r.getTime()?c:c-1}function Xy(m){const g=ar(m),a=new Date(Date.UTC(g.getFullYear(),g.getMonth(),g.getDate(),g.getHours(),g.getMinutes(),g.getSeconds(),g.getMilliseconds()));return a.setUTCFullYear(g.getFullYear()),+m-+a}function Rh(m,...g){const a=Rn.bind(null,g.find(c=>typeof c=="object"));return g.map(a)}function hf(m,g){const a=ar(m,g==null?void 0:g.in);return a.setHours(0,0,0,0),a}function km(m,g,a){const[c,_]=Rh(a==null?void 0:a.in,m,g),A=hf(c),N=hf(_),r=+A-Xy(A),W=+N-Xy(N);return Math.round((r-W)/_k)}function bk(m,g){const a=G2(m,g),c=Rn(m,0);return c.setFullYear(a,0,4),c.setHours(0,0,0,0),Im(c)}function wx(m,g,a){const c=ar(m,a==null?void 0:a.in);return c.setTime(c.getTime()+g*_0),c}function Xx(m,g,a){return Fc(m,g*3,a)}function wk(m,g,a){return H2(m,g*1e3)}function Zy(m,g,a){return zc(m,g*7,a)}function Eh(m,g,a){return Fc(m,g*12,a)}function DS(m,g){let a,c=g==null?void 0:g.in;return m.forEach(_=>{!c&&typeof _=="object"&&(c=Rn.bind(null,_));const A=ar(_,c);(!a||a<A||isNaN(+A))&&(a=A)}),Rn(c,a||NaN)}function IS(m,g){let a,c=g==null?void 0:g.in;return m.forEach(_=>{!c&&typeof _=="object"&&(c=Rn.bind(null,_));const A=ar(_,c);(!a||a>A||isNaN(+A))&&(a=A)}),Rn(c,a||NaN)}function Sk(m,g,a){const[c,_]=Rh(a==null?void 0:a.in,m,g);return+hf(c)==+hf(_)}function Ah(m){return m instanceof Date||typeof m=="object"&&Object.prototype.toString.call(m)==="[object Date]"}function Ky(m){return!(!Ah(m)&&typeof m!="number"||isNaN(+ar(m)))}function Jy(m,g,a){const[c,_]=Rh(a==null?void 0:a.in,m,g),A=c.getFullYear()-_.getFullYear(),N=c.getMonth()-_.getMonth();return A*12+N}function af(m,g){const a=ar(m,g==null?void 0:g.in);return Math.trunc(a.getMonth()/3)+1}function Qy(m,g,a){const[c,_]=Rh(a==null?void 0:a.in,m,g),A=c.getFullYear()-_.getFullYear(),N=af(c)-af(_);return A*4+N}function e0(m,g,a){const[c,_]=Rh(a==null?void 0:a.in,m,g);return c.getFullYear()-_.getFullYear()}function Tk(m,g,a){const[c,_]=Rh(a==null?void 0:a.in,m,g),A=kS(c,_),N=Math.abs(km(c,_));c.setDate(c.getDate()-A*N);const r=+(kS(c,_)===-A),W=A*(N-r);return W===0?0:W}function kS(m,g){const a=m.getFullYear()-g.getFullYear()||m.getMonth()-g.getMonth()||m.getDate()-g.getDate()||m.getHours()-g.getHours()||m.getMinutes()-g.getMinutes()||m.getSeconds()-g.getSeconds()||m.getMilliseconds()-g.getMilliseconds();return a<0?-1:a>0?1:a}function W2(m,g){const a=ar(m,g==null?void 0:g.in);return a.setHours(23,59,59,999),a}function q2(m,g){const a=ar(m,g==null?void 0:g.in),c=a.getMonth();return a.setFullYear(a.getFullYear(),c+1,0),a.setHours(23,59,59,999),a}function Sx(m,g){const a=ar(m,g==null?void 0:g.in),c=a.getMonth(),_=c-c%3;return a.setMonth(_,1),a.setHours(0,0,0,0),a}function Y2(m,g){const a=ar(m,g==null?void 0:g.in);return a.setDate(1),a.setHours(0,0,0,0),a}function X2(m,g){const a=ar(m,g==null?void 0:g.in),c=a.getFullYear();return a.setFullYear(c+1,0,0),a.setHours(23,59,59,999),a}function v0(m,g){const a=ar(m,g==null?void 0:g.in);return a.setFullYear(a.getFullYear(),0,1),a.setHours(0,0,0,0),a}function Mk(m,g){var r,W;const a=ff(),c=a.weekStartsOn??((W=(r=a.locale)==null?void 0:r.options)==null?void 0:W.weekStartsOn)??0,_=ar(m,g==null?void 0:g.in),A=_.getDay(),N=(A<c?-7:0)+6-(A-c);return _.setDate(_.getDate()+N),_.setHours(23,59,59,999),_}const Ck={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Ek=(m,g,a)=>{let c;const _=Ck[m];return typeof _=="string"?c=_:g===1?c=_.one:c=_.other.replace("{{count}}",g.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"in "+c:c+" ago":c};function tx(m){return(g={})=>{const a=g.width?String(g.width):m.defaultWidth;return m.formats[a]||m.formats[m.defaultWidth]}}const Ak={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Pk={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Dk={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Ik={date:tx({formats:Ak,defaultWidth:"full"}),time:tx({formats:Pk,defaultWidth:"full"}),dateTime:tx({formats:Dk,defaultWidth:"full"})},kk={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Ok=(m,g,a,c)=>kk[m];function Lg(m){return(g,a)=>{const c=a!=null&&a.context?String(a.context):"standalone";let _;if(c==="formatting"&&m.formattingValues){const N=m.defaultFormattingWidth||m.defaultWidth,r=a!=null&&a.width?String(a.width):N;_=m.formattingValues[r]||m.formattingValues[N]}else{const N=m.defaultWidth,r=a!=null&&a.width?String(a.width):m.defaultWidth;_=m.values[r]||m.values[N]}const A=m.argumentCallback?m.argumentCallback(g):g;return _[A]}}const Lk={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Rk={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},zk={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Fk={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Bk={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Nk={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Vk=(m,g)=>{const a=Number(m),c=a%100;if(c>20||c<10)switch(c%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},Uk={ordinalNumber:Vk,era:Lg({values:Lk,defaultWidth:"wide"}),quarter:Lg({values:Rk,defaultWidth:"wide",argumentCallback:m=>m-1}),month:Lg({values:zk,defaultWidth:"wide"}),day:Lg({values:Fk,defaultWidth:"wide"}),dayPeriod:Lg({values:Bk,defaultWidth:"wide",formattingValues:Nk,defaultFormattingWidth:"wide"})};function Rg(m){return(g,a={})=>{const c=a.width,_=c&&m.matchPatterns[c]||m.matchPatterns[m.defaultMatchWidth],A=g.match(_);if(!A)return null;const N=A[0],r=c&&m.parsePatterns[c]||m.parsePatterns[m.defaultParseWidth],W=Array.isArray(r)?$k(r,he=>he.test(N)):jk(r,he=>he.test(N));let ie;ie=m.valueCallback?m.valueCallback(W):W,ie=a.valueCallback?a.valueCallback(ie):ie;const oe=g.slice(N.length);return{value:ie,rest:oe}}}function jk(m,g){for(const a in m)if(Object.prototype.hasOwnProperty.call(m,a)&&g(m[a]))return a}function $k(m,g){for(let a=0;a<m.length;a++)if(g(m[a]))return a}function Hk(m){return(g,a={})=>{const c=g.match(m.matchPattern);if(!c)return null;const _=c[0],A=g.match(m.parsePattern);if(!A)return null;let N=m.valueCallback?m.valueCallback(A[0]):A[0];N=a.valueCallback?a.valueCallback(N):N;const r=g.slice(_.length);return{value:N,rest:r}}}const Gk=/^(\d+)(th|st|nd|rd)?/i,Wk=/\d+/i,qk={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Yk={any:[/^b/i,/^(a|c)/i]},Xk={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Zk={any:[/1/i,/2/i,/3/i,/4/i]},Kk={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Jk={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Qk={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},eO={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},tO={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},iO={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},rO={ordinalNumber:Hk({matchPattern:Gk,parsePattern:Wk,valueCallback:m=>parseInt(m,10)}),era:Rg({matchPatterns:qk,defaultMatchWidth:"wide",parsePatterns:Yk,defaultParseWidth:"any"}),quarter:Rg({matchPatterns:Xk,defaultMatchWidth:"wide",parsePatterns:Zk,defaultParseWidth:"any",valueCallback:m=>m+1}),month:Rg({matchPatterns:Kk,defaultMatchWidth:"wide",parsePatterns:Jk,defaultParseWidth:"any"}),day:Rg({matchPatterns:Qk,defaultMatchWidth:"wide",parsePatterns:eO,defaultParseWidth:"any"}),dayPeriod:Rg({matchPatterns:tO,defaultMatchWidth:"any",parsePatterns:iO,defaultParseWidth:"any"})},Z2={code:"en-US",formatDistance:Ek,formatLong:Ik,formatRelative:Ok,localize:Uk,match:rO,options:{weekStartsOn:0,firstWeekContainsDate:1}};function nO(m,g){const a=ar(m,g==null?void 0:g.in);return km(a,v0(a))+1}function Zx(m,g){const a=ar(m,g==null?void 0:g.in),c=+Im(a)-+bk(a);return Math.round(c/$2)+1}function Kx(m,g){var oe,he,ve,Se;const a=ar(m,g==null?void 0:g.in),c=a.getFullYear(),_=ff(),A=(g==null?void 0:g.firstWeekContainsDate)??((he=(oe=g==null?void 0:g.locale)==null?void 0:oe.options)==null?void 0:he.firstWeekContainsDate)??_.firstWeekContainsDate??((Se=(ve=_.locale)==null?void 0:ve.options)==null?void 0:Se.firstWeekContainsDate)??1,N=Rn((g==null?void 0:g.in)||m,0);N.setFullYear(c+1,0,A),N.setHours(0,0,0,0);const r=kh(N,g),W=Rn((g==null?void 0:g.in)||m,0);W.setFullYear(c,0,A),W.setHours(0,0,0,0);const ie=kh(W,g);return+a>=+r?c+1:+a>=+ie?c:c-1}function sO(m,g){var r,W,ie,oe;const a=ff(),c=(g==null?void 0:g.firstWeekContainsDate)??((W=(r=g==null?void 0:g.locale)==null?void 0:r.options)==null?void 0:W.firstWeekContainsDate)??a.firstWeekContainsDate??((oe=(ie=a.locale)==null?void 0:ie.options)==null?void 0:oe.firstWeekContainsDate)??1,_=Kx(m,g),A=Rn((g==null?void 0:g.in)||m,0);return A.setFullYear(_,0,c),A.setHours(0,0,0,0),kh(A,g)}function K2(m,g){const a=ar(m,g==null?void 0:g.in),c=+kh(a,g)-+sO(a,g);return Math.round(c/$2)+1}function Ln(m,g){const a=m<0?"-":"",c=Math.abs(m).toString().padStart(g,"0");return a+c}const Ld={y(m,g){const a=m.getFullYear(),c=a>0?a:1-a;return Ln(g==="yy"?c%100:c,g.length)},M(m,g){const a=m.getMonth();return g==="M"?String(a+1):Ln(a+1,2)},d(m,g){return Ln(m.getDate(),g.length)},a(m,g){const a=m.getHours()/12>=1?"pm":"am";switch(g){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(m,g){return Ln(m.getHours()%12||12,g.length)},H(m,g){return Ln(m.getHours(),g.length)},m(m,g){return Ln(m.getMinutes(),g.length)},s(m,g){return Ln(m.getSeconds(),g.length)},S(m,g){const a=g.length,c=m.getMilliseconds(),_=Math.trunc(c*Math.pow(10,a-3));return Ln(_,g.length)}},gm={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},OS={G:function(m,g,a){const c=m.getFullYear()>0?1:0;switch(g){case"G":case"GG":case"GGG":return a.era(c,{width:"abbreviated"});case"GGGGG":return a.era(c,{width:"narrow"});case"GGGG":default:return a.era(c,{width:"wide"})}},y:function(m,g,a){if(g==="yo"){const c=m.getFullYear(),_=c>0?c:1-c;return a.ordinalNumber(_,{unit:"year"})}return Ld.y(m,g)},Y:function(m,g,a,c){const _=Kx(m,c),A=_>0?_:1-_;if(g==="YY"){const N=A%100;return Ln(N,2)}return g==="Yo"?a.ordinalNumber(A,{unit:"year"}):Ln(A,g.length)},R:function(m,g){const a=G2(m);return Ln(a,g.length)},u:function(m,g){const a=m.getFullYear();return Ln(a,g.length)},Q:function(m,g,a){const c=Math.ceil((m.getMonth()+1)/3);switch(g){case"Q":return String(c);case"QQ":return Ln(c,2);case"Qo":return a.ordinalNumber(c,{unit:"quarter"});case"QQQ":return a.quarter(c,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(c,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(c,{width:"wide",context:"formatting"})}},q:function(m,g,a){const c=Math.ceil((m.getMonth()+1)/3);switch(g){case"q":return String(c);case"qq":return Ln(c,2);case"qo":return a.ordinalNumber(c,{unit:"quarter"});case"qqq":return a.quarter(c,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(c,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(c,{width:"wide",context:"standalone"})}},M:function(m,g,a){const c=m.getMonth();switch(g){case"M":case"MM":return Ld.M(m,g);case"Mo":return a.ordinalNumber(c+1,{unit:"month"});case"MMM":return a.month(c,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(c,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(c,{width:"wide",context:"formatting"})}},L:function(m,g,a){const c=m.getMonth();switch(g){case"L":return String(c+1);case"LL":return Ln(c+1,2);case"Lo":return a.ordinalNumber(c+1,{unit:"month"});case"LLL":return a.month(c,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(c,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(c,{width:"wide",context:"standalone"})}},w:function(m,g,a,c){const _=K2(m,c);return g==="wo"?a.ordinalNumber(_,{unit:"week"}):Ln(_,g.length)},I:function(m,g,a){const c=Zx(m);return g==="Io"?a.ordinalNumber(c,{unit:"week"}):Ln(c,g.length)},d:function(m,g,a){return g==="do"?a.ordinalNumber(m.getDate(),{unit:"date"}):Ld.d(m,g)},D:function(m,g,a){const c=nO(m);return g==="Do"?a.ordinalNumber(c,{unit:"dayOfYear"}):Ln(c,g.length)},E:function(m,g,a){const c=m.getDay();switch(g){case"E":case"EE":case"EEE":return a.day(c,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(c,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(c,{width:"short",context:"formatting"});case"EEEE":default:return a.day(c,{width:"wide",context:"formatting"})}},e:function(m,g,a,c){const _=m.getDay(),A=(_-c.weekStartsOn+8)%7||7;switch(g){case"e":return String(A);case"ee":return Ln(A,2);case"eo":return a.ordinalNumber(A,{unit:"day"});case"eee":return a.day(_,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(_,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(_,{width:"short",context:"formatting"});case"eeee":default:return a.day(_,{width:"wide",context:"formatting"})}},c:function(m,g,a,c){const _=m.getDay(),A=(_-c.weekStartsOn+8)%7||7;switch(g){case"c":return String(A);case"cc":return Ln(A,g.length);case"co":return a.ordinalNumber(A,{unit:"day"});case"ccc":return a.day(_,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(_,{width:"narrow",context:"standalone"});case"cccccc":return a.day(_,{width:"short",context:"standalone"});case"cccc":default:return a.day(_,{width:"wide",context:"standalone"})}},i:function(m,g,a){const c=m.getDay(),_=c===0?7:c;switch(g){case"i":return String(_);case"ii":return Ln(_,g.length);case"io":return a.ordinalNumber(_,{unit:"day"});case"iii":return a.day(c,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(c,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(c,{width:"short",context:"formatting"});case"iiii":default:return a.day(c,{width:"wide",context:"formatting"})}},a:function(m,g,a){const _=m.getHours()/12>=1?"pm":"am";switch(g){case"a":case"aa":return a.dayPeriod(_,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(_,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(_,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(_,{width:"wide",context:"formatting"})}},b:function(m,g,a){const c=m.getHours();let _;switch(c===12?_=gm.noon:c===0?_=gm.midnight:_=c/12>=1?"pm":"am",g){case"b":case"bb":return a.dayPeriod(_,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(_,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(_,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(_,{width:"wide",context:"formatting"})}},B:function(m,g,a){const c=m.getHours();let _;switch(c>=17?_=gm.evening:c>=12?_=gm.afternoon:c>=4?_=gm.morning:_=gm.night,g){case"B":case"BB":case"BBB":return a.dayPeriod(_,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(_,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(_,{width:"wide",context:"formatting"})}},h:function(m,g,a){if(g==="ho"){let c=m.getHours()%12;return c===0&&(c=12),a.ordinalNumber(c,{unit:"hour"})}return Ld.h(m,g)},H:function(m,g,a){return g==="Ho"?a.ordinalNumber(m.getHours(),{unit:"hour"}):Ld.H(m,g)},K:function(m,g,a){const c=m.getHours()%12;return g==="Ko"?a.ordinalNumber(c,{unit:"hour"}):Ln(c,g.length)},k:function(m,g,a){let c=m.getHours();return c===0&&(c=24),g==="ko"?a.ordinalNumber(c,{unit:"hour"}):Ln(c,g.length)},m:function(m,g,a){return g==="mo"?a.ordinalNumber(m.getMinutes(),{unit:"minute"}):Ld.m(m,g)},s:function(m,g,a){return g==="so"?a.ordinalNumber(m.getSeconds(),{unit:"second"}):Ld.s(m,g)},S:function(m,g){return Ld.S(m,g)},X:function(m,g,a){const c=m.getTimezoneOffset();if(c===0)return"Z";switch(g){case"X":return RS(c);case"XXXX":case"XX":return rf(c);case"XXXXX":case"XXX":default:return rf(c,":")}},x:function(m,g,a){const c=m.getTimezoneOffset();switch(g){case"x":return RS(c);case"xxxx":case"xx":return rf(c);case"xxxxx":case"xxx":default:return rf(c,":")}},O:function(m,g,a){const c=m.getTimezoneOffset();switch(g){case"O":case"OO":case"OOO":return"GMT"+LS(c,":");case"OOOO":default:return"GMT"+rf(c,":")}},z:function(m,g,a){const c=m.getTimezoneOffset();switch(g){case"z":case"zz":case"zzz":return"GMT"+LS(c,":");case"zzzz":default:return"GMT"+rf(c,":")}},t:function(m,g,a){const c=Math.trunc(+m/1e3);return Ln(c,g.length)},T:function(m,g,a){return Ln(+m,g.length)}};function LS(m,g=""){const a=m>0?"-":"+",c=Math.abs(m),_=Math.trunc(c/60),A=c%60;return A===0?a+String(_):a+String(_)+g+Ln(A,2)}function RS(m,g){return m%60===0?(m>0?"-":"+")+Ln(Math.abs(m)/60,2):rf(m,g)}function rf(m,g=""){const a=m>0?"-":"+",c=Math.abs(m),_=Ln(Math.trunc(c/60),2),A=Ln(c%60,2);return a+_+g+A}const zS=(m,g)=>{switch(m){case"P":return g.date({width:"short"});case"PP":return g.date({width:"medium"});case"PPP":return g.date({width:"long"});case"PPPP":default:return g.date({width:"full"})}},J2=(m,g)=>{switch(m){case"p":return g.time({width:"short"});case"pp":return g.time({width:"medium"});case"ppp":return g.time({width:"long"});case"pppp":default:return g.time({width:"full"})}},oO=(m,g)=>{const a=m.match(/(P+)(p+)?/)||[],c=a[1],_=a[2];if(!_)return zS(m,g);let A;switch(c){case"P":A=g.dateTime({width:"short"});break;case"PP":A=g.dateTime({width:"medium"});break;case"PPP":A=g.dateTime({width:"long"});break;case"PPPP":default:A=g.dateTime({width:"full"});break}return A.replace("{{date}}",zS(c,g)).replace("{{time}}",J2(_,g))},Tx={p:J2,P:oO},aO=/^D+$/,lO=/^Y+$/,cO=["D","DD","YY","YYYY"];function uO(m){return aO.test(m)}function hO(m){return lO.test(m)}function dO(m,g,a){const c=pO(m,g,a);if(console.warn(c),cO.includes(m))throw new RangeError(c)}function pO(m,g,a){const c=m[0]==="Y"?"years":"days of the month";return`Use \`${m.toLowerCase()}\` instead of \`${m}\` (in \`${g}\`) for formatting ${c} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const fO=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,mO=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,gO=/^'([^]*?)'?$/,_O=/''/g,yO=/[a-zA-Z]/;function FS(m,g,a){var oe,he,ve,Se,xe,Ae,Re,He;const c=ff(),_=(a==null?void 0:a.locale)??c.locale??Z2,A=(a==null?void 0:a.firstWeekContainsDate)??((he=(oe=a==null?void 0:a.locale)==null?void 0:oe.options)==null?void 0:he.firstWeekContainsDate)??c.firstWeekContainsDate??((Se=(ve=c.locale)==null?void 0:ve.options)==null?void 0:Se.firstWeekContainsDate)??1,N=(a==null?void 0:a.weekStartsOn)??((Ae=(xe=a==null?void 0:a.locale)==null?void 0:xe.options)==null?void 0:Ae.weekStartsOn)??c.weekStartsOn??((He=(Re=c.locale)==null?void 0:Re.options)==null?void 0:He.weekStartsOn)??0,r=ar(m,a==null?void 0:a.in);if(!Ky(r))throw new RangeError("Invalid time value");let W=g.match(mO).map(rt=>{const ht=rt[0];if(ht==="p"||ht==="P"){const tt=Tx[ht];return tt(rt,_.formatLong)}return rt}).join("").match(fO).map(rt=>{if(rt==="''")return{isToken:!1,value:"'"};const ht=rt[0];if(ht==="'")return{isToken:!1,value:vO(rt)};if(OS[ht])return{isToken:!0,value:rt};if(ht.match(yO))throw new RangeError("Format string contains an unescaped latin alphabet character `"+ht+"`");return{isToken:!1,value:rt}});_.localize.preprocessor&&(W=_.localize.preprocessor(r,W));const ie={firstWeekContainsDate:A,weekStartsOn:N,locale:_};return W.map(rt=>{if(!rt.isToken)return rt.value;const ht=rt.value;(!(a!=null&&a.useAdditionalWeekYearTokens)&&hO(ht)||!(a!=null&&a.useAdditionalDayOfYearTokens)&&uO(ht))&&dO(ht,g,String(m));const tt=OS[ht[0]];return tt(r,ht,_.localize,ie)}).join("")}function vO(m){const g=m.match(gO);return g?g[1].replace(_O,"'"):m}function BS(m,g){return ar(m,g==null?void 0:g.in).getDate()}function xO(m,g){return ar(m,g==null?void 0:g.in).getDay()}function bO(m,g){const a=ar(m,g==null?void 0:g.in),c=a.getFullYear(),_=a.getMonth(),A=Rn(a,0);return A.setFullYear(c,_+1,0),A.setHours(0,0,0,0),A.getDate()}function wO(){return Object.assign({},ff())}function Ph(m,g){return ar(m,g==null?void 0:g.in).getHours()}function SO(m,g){const a=ar(m,g==null?void 0:g.in).getDay();return a===0?7:a}function Dh(m,g){return ar(m,g==null?void 0:g.in).getMinutes()}function Ta(m,g){return ar(m,g==null?void 0:g.in).getMonth()}function Fd(m){return ar(m).getSeconds()}function Mx(m){return+ar(m)}function Zr(m,g){return ar(m,g==null?void 0:g.in).getFullYear()}function Vd(m,g){return+ar(m)>+ar(g)}function df(m,g){return+ar(m)<+ar(g)}function TO(m,g){return+ar(m)==+ar(g)}function MO(m,g){const a=CO(g)?new g(0):Rn(g,0);return a.setFullYear(m.getFullYear(),m.getMonth(),m.getDate()),a.setHours(m.getHours(),m.getMinutes(),m.getSeconds(),m.getMilliseconds()),a}function CO(m){var g;return typeof m=="function"&&((g=m.prototype)==null?void 0:g.constructor)===m}const EO=10;class Q2{constructor(){Li(this,"subPriority",0)}validate(g,a){return!0}}class AO extends Q2{constructor(g,a,c,_,A){super(),this.value=g,this.validateValue=a,this.setValue=c,this.priority=_,A&&(this.subPriority=A)}validate(g,a){return this.validateValue(g,this.value,a)}set(g,a,c){return this.setValue(g,a,this.value,c)}}class PO extends Q2{constructor(a,c){super();Li(this,"priority",EO);Li(this,"subPriority",-1);this.context=a||(_=>Rn(c,_))}set(a,c){return c.timestampIsSet?a:Rn(a,MO(a,this.context))}}class bn{run(g,a,c,_){const A=this.parse(g,a,c,_);return A?{setter:new AO(A.value,this.validate,this.set,this.priority,this.subPriority),rest:A.rest}:null}validate(g,a,c){return!0}}class DO extends bn{constructor(){super(...arguments);Li(this,"priority",140);Li(this,"incompatibleTokens",["R","u","t","T"])}parse(a,c,_){switch(c){case"G":case"GG":case"GGG":return _.era(a,{width:"abbreviated"})||_.era(a,{width:"narrow"});case"GGGGG":return _.era(a,{width:"narrow"});case"GGGG":default:return _.era(a,{width:"wide"})||_.era(a,{width:"abbreviated"})||_.era(a,{width:"narrow"})}}set(a,c,_){return c.era=_,a.setFullYear(_,0,1),a.setHours(0,0,0,0),a}}const Ws={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},Ru={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function qs(m,g){return m&&{value:g(m.value),rest:m.rest}}function Es(m,g){const a=g.match(m);return a?{value:parseInt(a[0],10),rest:g.slice(a[0].length)}:null}function zu(m,g){const a=g.match(m);if(!a)return null;if(a[0]==="Z")return{value:0,rest:g.slice(1)};const c=a[1]==="+"?1:-1,_=a[2]?parseInt(a[2],10):0,A=a[3]?parseInt(a[3],10):0,N=a[5]?parseInt(a[5],10):0;return{value:c*(_*y0+A*_0+N*yk),rest:g.slice(a[0].length)}}function eM(m){return Es(Ws.anyDigitsSigned,m)}function js(m,g){switch(m){case 1:return Es(Ws.singleDigit,g);case 2:return Es(Ws.twoDigits,g);case 3:return Es(Ws.threeDigits,g);case 4:return Es(Ws.fourDigits,g);default:return Es(new RegExp("^\\d{1,"+m+"}"),g)}}function t0(m,g){switch(m){case 1:return Es(Ws.singleDigitSigned,g);case 2:return Es(Ws.twoDigitsSigned,g);case 3:return Es(Ws.threeDigitsSigned,g);case 4:return Es(Ws.fourDigitsSigned,g);default:return Es(new RegExp("^-?\\d{1,"+m+"}"),g)}}function Jx(m){switch(m){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function tM(m,g){const a=g>0,c=a?g:1-g;let _;if(c<=50)_=m||100;else{const A=c+50,N=Math.trunc(A/100)*100,r=m>=A%100;_=m+N-(r?100:0)}return a?_:1-_}function iM(m){return m%400===0||m%4===0&&m%100!==0}class IO extends bn{constructor(){super(...arguments);Li(this,"priority",130);Li(this,"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"])}parse(a,c,_){const A=N=>({year:N,isTwoDigitYear:c==="yy"});switch(c){case"y":return qs(js(4,a),A);case"yo":return qs(_.ordinalNumber(a,{unit:"year"}),A);default:return qs(js(c.length,a),A)}}validate(a,c){return c.isTwoDigitYear||c.year>0}set(a,c,_){const A=a.getFullYear();if(_.isTwoDigitYear){const r=tM(_.year,A);return a.setFullYear(r,0,1),a.setHours(0,0,0,0),a}const N=!("era"in c)||c.era===1?_.year:1-_.year;return a.setFullYear(N,0,1),a.setHours(0,0,0,0),a}}class kO extends bn{constructor(){super(...arguments);Li(this,"priority",130);Li(this,"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"])}parse(a,c,_){const A=N=>({year:N,isTwoDigitYear:c==="YY"});switch(c){case"Y":return qs(js(4,a),A);case"Yo":return qs(_.ordinalNumber(a,{unit:"year"}),A);default:return qs(js(c.length,a),A)}}validate(a,c){return c.isTwoDigitYear||c.year>0}set(a,c,_,A){const N=Kx(a,A);if(_.isTwoDigitYear){const W=tM(_.year,N);return a.setFullYear(W,0,A.firstWeekContainsDate),a.setHours(0,0,0,0),kh(a,A)}const r=!("era"in c)||c.era===1?_.year:1-_.year;return a.setFullYear(r,0,A.firstWeekContainsDate),a.setHours(0,0,0,0),kh(a,A)}}class OO extends bn{constructor(){super(...arguments);Li(this,"priority",130);Li(this,"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"])}parse(a,c){return t0(c==="R"?4:c.length,a)}set(a,c,_){const A=Rn(a,0);return A.setFullYear(_,0,4),A.setHours(0,0,0,0),Im(A)}}class LO extends bn{constructor(){super(...arguments);Li(this,"priority",130);Li(this,"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"])}parse(a,c){return t0(c==="u"?4:c.length,a)}set(a,c,_){return a.setFullYear(_,0,1),a.setHours(0,0,0,0),a}}class RO extends bn{constructor(){super(...arguments);Li(this,"priority",120);Li(this,"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"])}parse(a,c,_){switch(c){case"Q":case"QQ":return js(c.length,a);case"Qo":return _.ordinalNumber(a,{unit:"quarter"});case"QQQ":return _.quarter(a,{width:"abbreviated",context:"formatting"})||_.quarter(a,{width:"narrow",context:"formatting"});case"QQQQQ":return _.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return _.quarter(a,{width:"wide",context:"formatting"})||_.quarter(a,{width:"abbreviated",context:"formatting"})||_.quarter(a,{width:"narrow",context:"formatting"})}}validate(a,c){return c>=1&&c<=4}set(a,c,_){return a.setMonth((_-1)*3,1),a.setHours(0,0,0,0),a}}class zO extends bn{constructor(){super(...arguments);Li(this,"priority",120);Li(this,"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"])}parse(a,c,_){switch(c){case"q":case"qq":return js(c.length,a);case"qo":return _.ordinalNumber(a,{unit:"quarter"});case"qqq":return _.quarter(a,{width:"abbreviated",context:"standalone"})||_.quarter(a,{width:"narrow",context:"standalone"});case"qqqqq":return _.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return _.quarter(a,{width:"wide",context:"standalone"})||_.quarter(a,{width:"abbreviated",context:"standalone"})||_.quarter(a,{width:"narrow",context:"standalone"})}}validate(a,c){return c>=1&&c<=4}set(a,c,_){return a.setMonth((_-1)*3,1),a.setHours(0,0,0,0),a}}class FO extends bn{constructor(){super(...arguments);Li(this,"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]);Li(this,"priority",110)}parse(a,c,_){const A=N=>N-1;switch(c){case"M":return qs(Es(Ws.month,a),A);case"MM":return qs(js(2,a),A);case"Mo":return qs(_.ordinalNumber(a,{unit:"month"}),A);case"MMM":return _.month(a,{width:"abbreviated",context:"formatting"})||_.month(a,{width:"narrow",context:"formatting"});case"MMMMM":return _.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return _.month(a,{width:"wide",context:"formatting"})||_.month(a,{width:"abbreviated",context:"formatting"})||_.month(a,{width:"narrow",context:"formatting"})}}validate(a,c){return c>=0&&c<=11}set(a,c,_){return a.setMonth(_,1),a.setHours(0,0,0,0),a}}class BO extends bn{constructor(){super(...arguments);Li(this,"priority",110);Li(this,"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"])}parse(a,c,_){const A=N=>N-1;switch(c){case"L":return qs(Es(Ws.month,a),A);case"LL":return qs(js(2,a),A);case"Lo":return qs(_.ordinalNumber(a,{unit:"month"}),A);case"LLL":return _.month(a,{width:"abbreviated",context:"standalone"})||_.month(a,{width:"narrow",context:"standalone"});case"LLLLL":return _.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return _.month(a,{width:"wide",context:"standalone"})||_.month(a,{width:"abbreviated",context:"standalone"})||_.month(a,{width:"narrow",context:"standalone"})}}validate(a,c){return c>=0&&c<=11}set(a,c,_){return a.setMonth(_,1),a.setHours(0,0,0,0),a}}function NO(m,g,a){const c=ar(m,a==null?void 0:a.in),_=K2(c,a)-g;return c.setDate(c.getDate()-_*7),ar(c,a==null?void 0:a.in)}class VO extends bn{constructor(){super(...arguments);Li(this,"priority",100);Li(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"])}parse(a,c,_){switch(c){case"w":return Es(Ws.week,a);case"wo":return _.ordinalNumber(a,{unit:"week"});default:return js(c.length,a)}}validate(a,c){return c>=1&&c<=53}set(a,c,_,A){return kh(NO(a,_,A),A)}}function UO(m,g,a){const c=ar(m,a==null?void 0:a.in),_=Zx(c,a)-g;return c.setDate(c.getDate()-_*7),c}class jO extends bn{constructor(){super(...arguments);Li(this,"priority",100);Li(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"])}parse(a,c,_){switch(c){case"I":return Es(Ws.week,a);case"Io":return _.ordinalNumber(a,{unit:"week"});default:return js(c.length,a)}}validate(a,c){return c>=1&&c<=53}set(a,c,_){return Im(UO(a,_))}}const $O=[31,28,31,30,31,30,31,31,30,31,30,31],HO=[31,29,31,30,31,30,31,31,30,31,30,31];class GO extends bn{constructor(){super(...arguments);Li(this,"priority",90);Li(this,"subPriority",1);Li(this,"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"])}parse(a,c,_){switch(c){case"d":return Es(Ws.date,a);case"do":return _.ordinalNumber(a,{unit:"date"});default:return js(c.length,a)}}validate(a,c){const _=a.getFullYear(),A=iM(_),N=a.getMonth();return A?c>=1&&c<=HO[N]:c>=1&&c<=$O[N]}set(a,c,_){return a.setDate(_),a.setHours(0,0,0,0),a}}class WO extends bn{constructor(){super(...arguments);Li(this,"priority",90);Li(this,"subpriority",1);Li(this,"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"])}parse(a,c,_){switch(c){case"D":case"DD":return Es(Ws.dayOfYear,a);case"Do":return _.ordinalNumber(a,{unit:"date"});default:return js(c.length,a)}}validate(a,c){const _=a.getFullYear();return iM(_)?c>=1&&c<=366:c>=1&&c<=365}set(a,c,_){return a.setMonth(0,_),a.setHours(0,0,0,0),a}}function Qx(m,g,a){var he,ve,Se,xe;const c=ff(),_=(a==null?void 0:a.weekStartsOn)??((ve=(he=a==null?void 0:a.locale)==null?void 0:he.options)==null?void 0:ve.weekStartsOn)??c.weekStartsOn??((xe=(Se=c.locale)==null?void 0:Se.options)==null?void 0:xe.weekStartsOn)??0,A=ar(m,a==null?void 0:a.in),N=A.getDay(),W=(g%7+7)%7,ie=7-_,oe=g<0||g>6?g-(N+ie)%7:(W+ie)%7-(N+ie)%7;return zc(A,oe,a)}class qO extends bn{constructor(){super(...arguments);Li(this,"priority",90);Li(this,"incompatibleTokens",["D","i","e","c","t","T"])}parse(a,c,_){switch(c){case"E":case"EE":case"EEE":return _.day(a,{width:"abbreviated",context:"formatting"})||_.day(a,{width:"short",context:"formatting"})||_.day(a,{width:"narrow",context:"formatting"});case"EEEEE":return _.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return _.day(a,{width:"short",context:"formatting"})||_.day(a,{width:"narrow",context:"formatting"});case"EEEE":default:return _.day(a,{width:"wide",context:"formatting"})||_.day(a,{width:"abbreviated",context:"formatting"})||_.day(a,{width:"short",context:"formatting"})||_.day(a,{width:"narrow",context:"formatting"})}}validate(a,c){return c>=0&&c<=6}set(a,c,_,A){return a=Qx(a,_,A),a.setHours(0,0,0,0),a}}class YO extends bn{constructor(){super(...arguments);Li(this,"priority",90);Li(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"])}parse(a,c,_,A){const N=r=>{const W=Math.floor((r-1)/7)*7;return(r+A.weekStartsOn+6)%7+W};switch(c){case"e":case"ee":return qs(js(c.length,a),N);case"eo":return qs(_.ordinalNumber(a,{unit:"day"}),N);case"eee":return _.day(a,{width:"abbreviated",context:"formatting"})||_.day(a,{width:"short",context:"formatting"})||_.day(a,{width:"narrow",context:"formatting"});case"eeeee":return _.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return _.day(a,{width:"short",context:"formatting"})||_.day(a,{width:"narrow",context:"formatting"});case"eeee":default:return _.day(a,{width:"wide",context:"formatting"})||_.day(a,{width:"abbreviated",context:"formatting"})||_.day(a,{width:"short",context:"formatting"})||_.day(a,{width:"narrow",context:"formatting"})}}validate(a,c){return c>=0&&c<=6}set(a,c,_,A){return a=Qx(a,_,A),a.setHours(0,0,0,0),a}}class XO extends bn{constructor(){super(...arguments);Li(this,"priority",90);Li(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"])}parse(a,c,_,A){const N=r=>{const W=Math.floor((r-1)/7)*7;return(r+A.weekStartsOn+6)%7+W};switch(c){case"c":case"cc":return qs(js(c.length,a),N);case"co":return qs(_.ordinalNumber(a,{unit:"day"}),N);case"ccc":return _.day(a,{width:"abbreviated",context:"standalone"})||_.day(a,{width:"short",context:"standalone"})||_.day(a,{width:"narrow",context:"standalone"});case"ccccc":return _.day(a,{width:"narrow",context:"standalone"});case"cccccc":return _.day(a,{width:"short",context:"standalone"})||_.day(a,{width:"narrow",context:"standalone"});case"cccc":default:return _.day(a,{width:"wide",context:"standalone"})||_.day(a,{width:"abbreviated",context:"standalone"})||_.day(a,{width:"short",context:"standalone"})||_.day(a,{width:"narrow",context:"standalone"})}}validate(a,c){return c>=0&&c<=6}set(a,c,_,A){return a=Qx(a,_,A),a.setHours(0,0,0,0),a}}function ZO(m,g,a){const c=ar(m,a==null?void 0:a.in),_=SO(c,a),A=g-_;return zc(c,A,a)}class KO extends bn{constructor(){super(...arguments);Li(this,"priority",90);Li(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"])}parse(a,c,_){const A=N=>N===0?7:N;switch(c){case"i":case"ii":return js(c.length,a);case"io":return _.ordinalNumber(a,{unit:"day"});case"iii":return qs(_.day(a,{width:"abbreviated",context:"formatting"})||_.day(a,{width:"short",context:"formatting"})||_.day(a,{width:"narrow",context:"formatting"}),A);case"iiiii":return qs(_.day(a,{width:"narrow",context:"formatting"}),A);case"iiiiii":return qs(_.day(a,{width:"short",context:"formatting"})||_.day(a,{width:"narrow",context:"formatting"}),A);case"iiii":default:return qs(_.day(a,{width:"wide",context:"formatting"})||_.day(a,{width:"abbreviated",context:"formatting"})||_.day(a,{width:"short",context:"formatting"})||_.day(a,{width:"narrow",context:"formatting"}),A)}}validate(a,c){return c>=1&&c<=7}set(a,c,_){return a=ZO(a,_),a.setHours(0,0,0,0),a}}class JO extends bn{constructor(){super(...arguments);Li(this,"priority",80);Li(this,"incompatibleTokens",["b","B","H","k","t","T"])}parse(a,c,_){switch(c){case"a":case"aa":case"aaa":return _.dayPeriod(a,{width:"abbreviated",context:"formatting"})||_.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaaa":return _.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return _.dayPeriod(a,{width:"wide",context:"formatting"})||_.dayPeriod(a,{width:"abbreviated",context:"formatting"})||_.dayPeriod(a,{width:"narrow",context:"formatting"})}}set(a,c,_){return a.setHours(Jx(_),0,0,0),a}}class QO extends bn{constructor(){super(...arguments);Li(this,"priority",80);Li(this,"incompatibleTokens",["a","B","H","k","t","T"])}parse(a,c,_){switch(c){case"b":case"bb":case"bbb":return _.dayPeriod(a,{width:"abbreviated",context:"formatting"})||_.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbbb":return _.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return _.dayPeriod(a,{width:"wide",context:"formatting"})||_.dayPeriod(a,{width:"abbreviated",context:"formatting"})||_.dayPeriod(a,{width:"narrow",context:"formatting"})}}set(a,c,_){return a.setHours(Jx(_),0,0,0),a}}class eL extends bn{constructor(){super(...arguments);Li(this,"priority",80);Li(this,"incompatibleTokens",["a","b","t","T"])}parse(a,c,_){switch(c){case"B":case"BB":case"BBB":return _.dayPeriod(a,{width:"abbreviated",context:"formatting"})||_.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBBB":return _.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return _.dayPeriod(a,{width:"wide",context:"formatting"})||_.dayPeriod(a,{width:"abbreviated",context:"formatting"})||_.dayPeriod(a,{width:"narrow",context:"formatting"})}}set(a,c,_){return a.setHours(Jx(_),0,0,0),a}}class tL extends bn{constructor(){super(...arguments);Li(this,"priority",70);Li(this,"incompatibleTokens",["H","K","k","t","T"])}parse(a,c,_){switch(c){case"h":return Es(Ws.hour12h,a);case"ho":return _.ordinalNumber(a,{unit:"hour"});default:return js(c.length,a)}}validate(a,c){return c>=1&&c<=12}set(a,c,_){const A=a.getHours()>=12;return A&&_<12?a.setHours(_+12,0,0,0):!A&&_===12?a.setHours(0,0,0,0):a.setHours(_,0,0,0),a}}class iL extends bn{constructor(){super(...arguments);Li(this,"priority",70);Li(this,"incompatibleTokens",["a","b","h","K","k","t","T"])}parse(a,c,_){switch(c){case"H":return Es(Ws.hour23h,a);case"Ho":return _.ordinalNumber(a,{unit:"hour"});default:return js(c.length,a)}}validate(a,c){return c>=0&&c<=23}set(a,c,_){return a.setHours(_,0,0,0),a}}class rL extends bn{constructor(){super(...arguments);Li(this,"priority",70);Li(this,"incompatibleTokens",["h","H","k","t","T"])}parse(a,c,_){switch(c){case"K":return Es(Ws.hour11h,a);case"Ko":return _.ordinalNumber(a,{unit:"hour"});default:return js(c.length,a)}}validate(a,c){return c>=0&&c<=11}set(a,c,_){return a.getHours()>=12&&_<12?a.setHours(_+12,0,0,0):a.setHours(_,0,0,0),a}}class nL extends bn{constructor(){super(...arguments);Li(this,"priority",70);Li(this,"incompatibleTokens",["a","b","h","H","K","t","T"])}parse(a,c,_){switch(c){case"k":return Es(Ws.hour24h,a);case"ko":return _.ordinalNumber(a,{unit:"hour"});default:return js(c.length,a)}}validate(a,c){return c>=1&&c<=24}set(a,c,_){const A=_<=24?_%24:_;return a.setHours(A,0,0,0),a}}class sL extends bn{constructor(){super(...arguments);Li(this,"priority",60);Li(this,"incompatibleTokens",["t","T"])}parse(a,c,_){switch(c){case"m":return Es(Ws.minute,a);case"mo":return _.ordinalNumber(a,{unit:"minute"});default:return js(c.length,a)}}validate(a,c){return c>=0&&c<=59}set(a,c,_){return a.setMinutes(_,0,0),a}}class oL extends bn{constructor(){super(...arguments);Li(this,"priority",50);Li(this,"incompatibleTokens",["t","T"])}parse(a,c,_){switch(c){case"s":return Es(Ws.second,a);case"so":return _.ordinalNumber(a,{unit:"second"});default:return js(c.length,a)}}validate(a,c){return c>=0&&c<=59}set(a,c,_){return a.setSeconds(_,0),a}}class aL extends bn{constructor(){super(...arguments);Li(this,"priority",30);Li(this,"incompatibleTokens",["t","T"])}parse(a,c){const _=A=>Math.trunc(A*Math.pow(10,-c.length+3));return qs(js(c.length,a),_)}set(a,c,_){return a.setMilliseconds(_),a}}class lL extends bn{constructor(){super(...arguments);Li(this,"priority",10);Li(this,"incompatibleTokens",["t","T","x"])}parse(a,c){switch(c){case"X":return zu(Ru.basicOptionalMinutes,a);case"XX":return zu(Ru.basic,a);case"XXXX":return zu(Ru.basicOptionalSeconds,a);case"XXXXX":return zu(Ru.extendedOptionalSeconds,a);case"XXX":default:return zu(Ru.extended,a)}}set(a,c,_){return c.timestampIsSet?a:Rn(a,a.getTime()-Xy(a)-_)}}class cL extends bn{constructor(){super(...arguments);Li(this,"priority",10);Li(this,"incompatibleTokens",["t","T","X"])}parse(a,c){switch(c){case"x":return zu(Ru.basicOptionalMinutes,a);case"xx":return zu(Ru.basic,a);case"xxxx":return zu(Ru.basicOptionalSeconds,a);case"xxxxx":return zu(Ru.extendedOptionalSeconds,a);case"xxx":default:return zu(Ru.extended,a)}}set(a,c,_){return c.timestampIsSet?a:Rn(a,a.getTime()-Xy(a)-_)}}class uL extends bn{constructor(){super(...arguments);Li(this,"priority",40);Li(this,"incompatibleTokens","*")}parse(a){return eM(a)}set(a,c,_){return[Rn(a,_*1e3),{timestampIsSet:!0}]}}class hL extends bn{constructor(){super(...arguments);Li(this,"priority",20);Li(this,"incompatibleTokens","*")}parse(a){return eM(a)}set(a,c,_){return[Rn(a,_),{timestampIsSet:!0}]}}const dL={G:new DO,y:new IO,Y:new kO,R:new OO,u:new LO,Q:new RO,q:new zO,M:new FO,L:new BO,w:new VO,I:new jO,d:new GO,D:new WO,E:new qO,e:new YO,c:new XO,i:new KO,a:new JO,b:new QO,B:new eL,h:new tL,H:new iL,K:new rL,k:new nL,m:new sL,s:new oL,S:new aL,X:new lL,x:new cL,t:new uL,T:new hL},pL=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,fL=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,mL=/^'([^]*?)'?$/,gL=/''/g,_L=/\S/,yL=/[a-zA-Z]/;function vL(m,g,a,c){var Re,He,rt,ht,tt,at,Lt,Ve;const _=()=>Rn((c==null?void 0:c.in)||a,NaN),A=wO(),N=(c==null?void 0:c.locale)??A.locale??Z2,r=(c==null?void 0:c.firstWeekContainsDate)??((He=(Re=c==null?void 0:c.locale)==null?void 0:Re.options)==null?void 0:He.firstWeekContainsDate)??A.firstWeekContainsDate??((ht=(rt=A.locale)==null?void 0:rt.options)==null?void 0:ht.firstWeekContainsDate)??1,W=(c==null?void 0:c.weekStartsOn)??((at=(tt=c==null?void 0:c.locale)==null?void 0:tt.options)==null?void 0:at.weekStartsOn)??A.weekStartsOn??((Ve=(Lt=A.locale)==null?void 0:Lt.options)==null?void 0:Ve.weekStartsOn)??0;if(!g)return m?_():ar(a,c==null?void 0:c.in);const ie={firstWeekContainsDate:r,weekStartsOn:W,locale:N},oe=[new PO(c==null?void 0:c.in,a)],he=g.match(fL).map(Tt=>{const qt=Tt[0];if(qt in Tx){const Me=Tx[qt];return Me(Tt,N.formatLong)}return Tt}).join("").match(pL),ve=[];for(let Tt of he){const qt=Tt[0],Me=dL[qt];if(Me){const{incompatibleTokens:gt}=Me;if(Array.isArray(gt)){const Ti=ve.find(ni=>gt.includes(ni.token)||ni.token===qt);if(Ti)throw new RangeError(`The format string mustn't contain \`${Ti.fullToken}\` and \`${Tt}\` at the same time`)}else if(Me.incompatibleTokens==="*"&&ve.length>0)throw new RangeError(`The format string mustn't contain \`${Tt}\` and any other token at the same time`);ve.push({token:qt,fullToken:Tt});const oi=Me.run(m,Tt,N.match,ie);if(!oi)return _();oe.push(oi.setter),m=oi.rest}else{if(qt.match(yL))throw new RangeError("Format string contains an unescaped latin alphabet character `"+qt+"`");if(Tt==="''"?Tt="'":qt==="'"&&(Tt=xL(Tt)),m.indexOf(Tt)===0)m=m.slice(Tt.length);else return _()}}if(m.length>0&&_L.test(m))return _();const Se=oe.map(Tt=>Tt.priority).sort((Tt,qt)=>qt-Tt).filter((Tt,qt,Me)=>Me.indexOf(Tt)===qt).map(Tt=>oe.filter(qt=>qt.priority===Tt).sort((qt,Me)=>Me.subPriority-qt.subPriority)).map(Tt=>Tt[0]);let xe=ar(a,c==null?void 0:c.in);if(isNaN(+xe))return _();const Ae={};for(const Tt of Se){if(!Tt.validate(xe,ie))return _();const qt=Tt.set(xe,Ae,ie);Array.isArray(qt)?(xe=qt[0],Object.assign(Ae,qt[1])):xe=qt}return xe}function xL(m){return m.match(mL)[1].replace(gL,"'")}function bL(m,g,a){const[c,_]=Rh(a==null?void 0:a.in,m,g);return c.getFullYear()===_.getFullYear()&&c.getMonth()===_.getMonth()}function wL(m,g,a){const[c,_]=Rh(a==null?void 0:a.in,m,g);return+Sx(c)==+Sx(_)}function SL(m,g,a){const[c,_]=Rh(a==null?void 0:a.in,m,g);return c.getFullYear()===_.getFullYear()}function Jg(m,g,a){const c=+ar(m,a==null?void 0:a.in),[_,A]=[+ar(g.start,a==null?void 0:a.in),+ar(g.end,a==null?void 0:a.in)].sort((N,r)=>N-r);return c>=_&&c<=A}function TL(m,g,a){return zc(m,-1,a)}function ML(m,g){const a=()=>Rn(g==null?void 0:g.in,NaN),_=PL(m);let A;if(_.date){const ie=DL(_.date,2);A=IL(ie.restDateString,ie.year)}if(!A||isNaN(+A))return a();const N=+A;let r=0,W;if(_.time&&(r=kL(_.time),isNaN(r)))return a();if(_.timezone){if(W=OL(_.timezone),isNaN(W))return a()}else{const ie=new Date(N+r),oe=ar(0,g==null?void 0:g.in);return oe.setFullYear(ie.getUTCFullYear(),ie.getUTCMonth(),ie.getUTCDate()),oe.setHours(ie.getUTCHours(),ie.getUTCMinutes(),ie.getUTCSeconds(),ie.getUTCMilliseconds()),oe}return ar(N+r+W,g==null?void 0:g.in)}const my={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},CL=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,EL=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,AL=/^([+-])(\d{2})(?::?(\d{2}))?$/;function PL(m){const g={},a=m.split(my.dateTimeDelimiter);let c;if(a.length>2)return g;if(/:/.test(a[0])?c=a[0]:(g.date=a[0],c=a[1],my.timeZoneDelimiter.test(g.date)&&(g.date=m.split(my.timeZoneDelimiter)[0],c=m.substr(g.date.length,m.length))),c){const _=my.timezone.exec(c);_?(g.time=c.replace(_[1],""),g.timezone=_[1]):g.time=c}return g}function DL(m,g){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+g)+"})|(\\d{2}|[+-]\\d{"+(2+g)+"})$)"),c=m.match(a);if(!c)return{year:NaN,restDateString:""};const _=c[1]?parseInt(c[1]):null,A=c[2]?parseInt(c[2]):null;return{year:A===null?_:A*100,restDateString:m.slice((c[1]||c[2]).length)}}function IL(m,g){if(g===null)return new Date(NaN);const a=m.match(CL);if(!a)return new Date(NaN);const c=!!a[4],_=zg(a[1]),A=zg(a[2])-1,N=zg(a[3]),r=zg(a[4]),W=zg(a[5])-1;if(c)return BL(g,r,W)?LL(g,r,W):new Date(NaN);{const ie=new Date(0);return!zL(g,A,N)||!FL(g,_)?new Date(NaN):(ie.setUTCFullYear(g,A,Math.max(_,N)),ie)}}function zg(m){return m?parseInt(m):1}function kL(m){const g=m.match(EL);if(!g)return NaN;const a=ix(g[1]),c=ix(g[2]),_=ix(g[3]);return NL(a,c,_)?a*y0+c*_0+_*1e3:NaN}function ix(m){return m&&parseFloat(m.replace(",","."))||0}function OL(m){if(m==="Z")return 0;const g=m.match(AL);if(!g)return 0;const a=g[1]==="+"?-1:1,c=parseInt(g[2]),_=g[3]&&parseInt(g[3])||0;return VL(c,_)?a*(c*y0+_*_0):NaN}function LL(m,g,a){const c=new Date(0);c.setUTCFullYear(m,0,4);const _=c.getUTCDay()||7,A=(g-1)*7+a+1-_;return c.setUTCDate(c.getUTCDate()+A),c}const RL=[31,null,31,30,31,30,31,31,30,31,30,31];function rM(m){return m%400===0||m%4===0&&m%100!==0}function zL(m,g,a){return g>=0&&g<=11&&a>=1&&a<=(RL[g]||(rM(m)?29:28))}function FL(m,g){return g>=1&&g<=(rM(m)?366:365)}function BL(m,g,a){return g>=1&&g<=53&&a>=0&&a<=6}function NL(m,g,a){return m===24?g===0&&a===0:a>=0&&a<60&&g>=0&&g<60&&m>=0&&m<25}function VL(m,g){return g>=0&&g<=59}function Wl(m,g,a){const c=ar(m,a==null?void 0:a.in),_=c.getFullYear(),A=c.getDate(),N=Rn(m,0);N.setFullYear(_,g,15),N.setHours(0,0,0,0);const r=bO(N);return c.setMonth(g,Math.min(A,r)),c}function Ay(m,g,a){const c=ar(m,a==null?void 0:a.in);return c.setHours(g),c}function Py(m,g,a){const c=ar(m,a==null?void 0:a.in);return c.setMinutes(g),c}function wm(m,g,a){const c=ar(m,a==null?void 0:a.in),_=Math.trunc(c.getMonth()/3)+1,A=g-_;return Wl(c,c.getMonth()+A*3)}function Dy(m,g,a){const c=ar(m,a==null?void 0:a.in);return c.setSeconds(g),c}function Iu(m,g,a){const c=ar(m,a==null?void 0:a.in);return isNaN(+c)?Rn(m,NaN):(c.setFullYear(g),c)}function lf(m,g,a){return Fc(m,-g,a)}function nM(m,g,a){return Xx(m,-1,a)}function NS(m,g,a){return Zy(m,-1,a)}function Om(m,g,a){return Eh(m,-g,a)}var Iy=typeof document<"u"?Xe.useLayoutEffect:Xe.useEffect;function i0(m,g){if(m===g)return!0;if(typeof m!=typeof g)return!1;if(typeof m=="function"&&m.toString()===g.toString())return!0;let a,c,_;if(m&&g&&typeof m=="object"){if(Array.isArray(m)){if(a=m.length,a!==g.length)return!1;for(c=a;c--!==0;)if(!i0(m[c],g[c]))return!1;return!0}if(_=Object.keys(m),a=_.length,a!==Object.keys(g).length)return!1;for(c=a;c--!==0;)if(!{}.hasOwnProperty.call(g,_[c]))return!1;for(c=a;c--!==0;){const A=_[c];if(!(A==="_owner"&&m.$$typeof)&&!i0(m[A],g[A]))return!1}return!0}return m!==m&&g!==g}function sM(m){return typeof window>"u"?1:(m.ownerDocument.defaultView||window).devicePixelRatio||1}function VS(m,g){const a=sM(m);return Math.round(g*a)/a}function rx(m){const g=Xe.useRef(m);return Iy(()=>{g.current=m}),g}function UL(m){m===void 0&&(m={});const{placement:g="bottom",strategy:a="absolute",middleware:c=[],platform:_,elements:{reference:A,floating:N}={},transform:r=!0,whileElementsMounted:W,open:ie}=m,[oe,he]=Xe.useState({x:0,y:0,strategy:a,placement:g,middlewareData:{},isPositioned:!1}),[ve,Se]=Xe.useState(c);i0(ve,c)||Se(c);const[xe,Ae]=Xe.useState(null),[Re,He]=Xe.useState(null),rt=Xe.useCallback(Yt=>{Yt!==Lt.current&&(Lt.current=Yt,Ae(Yt))},[]),ht=Xe.useCallback(Yt=>{Yt!==Ve.current&&(Ve.current=Yt,He(Yt))},[]),tt=A||xe,at=N||Re,Lt=Xe.useRef(null),Ve=Xe.useRef(null),Tt=Xe.useRef(oe),qt=W!=null,Me=rx(W),gt=rx(_),oi=rx(ie),Ti=Xe.useCallback(()=>{if(!Lt.current||!Ve.current)return;const Yt={placement:g,strategy:a,middleware:ve};gt.current&&(Yt.platform=gt.current),eD(Lt.current,Ve.current,Yt).then(jt=>{const Ri={...jt,isPositioned:oi.current!==!1};ni.current&&!i0(Tt.current,Ri)&&(Tt.current=Ri,Lx.flushSync(()=>{he(Ri)}))})},[ve,g,a,gt,oi]);Iy(()=>{ie===!1&&Tt.current.isPositioned&&(Tt.current.isPositioned=!1,he(Yt=>({...Yt,isPositioned:!1})))},[ie]);const ni=Xe.useRef(!1);Iy(()=>(ni.current=!0,()=>{ni.current=!1}),[]),Iy(()=>{if(tt&&(Lt.current=tt),at&&(Ve.current=at),tt&&at){if(Me.current)return Me.current(tt,at,Ti);Ti()}},[tt,at,Ti,Me,qt]);const Mt=Xe.useMemo(()=>({reference:Lt,floating:Ve,setReference:rt,setFloating:ht}),[rt,ht]),zt=Xe.useMemo(()=>({reference:tt,floating:at}),[tt,at]),ii=Xe.useMemo(()=>{const Yt={position:a,left:0,top:0};if(!zt.floating)return Yt;const jt=VS(zt.floating,oe.x),Ri=VS(zt.floating,oe.y);return r?{...Yt,transform:"translate("+jt+"px, "+Ri+"px)",...sM(zt.floating)>=1.5&&{willChange:"transform"}}:{position:a,left:jt,top:Ri}},[a,r,zt.floating,oe.x,oe.y]);return Xe.useMemo(()=>({...oe,update:Ti,refs:Mt,elements:zt,floatingStyles:ii}),[oe,Ti,Mt,zt,ii])}const jL=m=>{function g(a){return{}.hasOwnProperty.call(a,"current")}return{name:"arrow",options:m,fn(a){const{element:c,padding:_}=typeof m=="function"?m(a):m;return c&&g(c)?c.current!=null?uS({element:c.current,padding:_}).fn(a):{}:c?uS({element:c,padding:_}).fn(a):{}}}},$L=(m,g)=>({...JP(m),options:[m,g]}),HL=(m,g)=>({...QP(m),options:[m,g]}),GL=(m,g)=>({...jL(m),options:[m,g]}),oM={...px},WL=oM.useInsertionEffect,qL=WL||(m=>m());function YL(m){const g=Xe.useRef(()=>{});return qL(()=>{g.current=m}),Xe.useCallback(function(){for(var a=arguments.length,c=new Array(a),_=0;_<a;_++)c[_]=arguments[_];return g.current==null?void 0:g.current(...c)},[])}var r0=typeof document<"u"?Xe.useLayoutEffect:Xe.useEffect;let US=!1,XL=0;const jS=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+XL++;function ZL(){const[m,g]=Xe.useState(()=>US?jS():void 0);return r0(()=>{m==null&&g(jS())},[]),Xe.useEffect(()=>{US=!0},[]),m}const KL=oM.useId,aM=KL||ZL,JL=Xe.forwardRef(function(g,a){const{context:{placement:c,elements:{floating:_},middlewareData:{arrow:A,shift:N}},width:r=14,height:W=7,tipRadius:ie=0,strokeWidth:oe=0,staticOffset:he,stroke:ve,d:Se,style:{transform:xe,...Ae}={},...Re}=g,He=aM(),[rt,ht]=Xe.useState(!1);if(r0(()=>{if(!_)return;Zl(_).direction==="rtl"&&ht(!0)},[_]),!_)return null;const[tt,at]=c.split("-"),Lt=tt==="top"||tt==="bottom";let Ve=he;(Lt&&N!=null&&N.x||!Lt&&N!=null&&N.y)&&(Ve=null);const Tt=oe*2,qt=Tt/2,Me=r/2*(ie/-8+1),gt=W/2*ie/4,oi=!!Se,Ti=Ve&&at==="end"?"bottom":"top";let ni=Ve&&at==="end"?"right":"left";Ve&&rt&&(ni=at==="end"?"left":"right");const Mt=(A==null?void 0:A.x)!=null?Ve||A.x:"",zt=(A==null?void 0:A.y)!=null?Ve||A.y:"",ii=Se||"M0,0"+(" H"+r)+(" L"+(r-Me)+","+(W-gt))+(" Q"+r/2+","+W+" "+Me+","+(W-gt))+" Z",Yt={top:oi?"rotate(180deg)":"",left:oi?"rotate(90deg)":"rotate(-90deg)",bottom:oi?"":"rotate(180deg)",right:oi?"rotate(-90deg)":"rotate(90deg)"}[tt];return hi.jsxs("svg",{...Re,"aria-hidden":!0,ref:a,width:oi?r:r+Tt,height:r,viewBox:"0 0 "+r+" "+(W>r?W:r),style:{position:"absolute",pointerEvents:"none",[ni]:Mt,[Ti]:zt,[tt]:Lt||oi?"100%":"calc(100% - "+Tt/2+"px)",transform:[Yt,xe].filter(jt=>!!jt).join(" "),...Ae},children:[Tt>0&&hi.jsx("path",{clipPath:"url(#"+He+")",fill:"none",stroke:ve,strokeWidth:Tt+(Se?0:1),d:ii}),hi.jsx("path",{stroke:Tt&&!Se?Re.fill:"none",d:ii}),hi.jsx("clipPath",{id:He,children:hi.jsx("rect",{x:-qt,y:qt*(oi?-1:1),width:r+Tt,height:r})})]})});function QL(){const m=new Map;return{emit(g,a){var c;(c=m.get(g))==null||c.forEach(_=>_(a))},on(g,a){m.set(g,[...m.get(g)||[],a])},off(g,a){var c;m.set(g,((c=m.get(g))==null?void 0:c.filter(_=>_!==a))||[])}}}const eR=Xe.createContext(null),tR=Xe.createContext(null),iR=()=>{var m;return((m=Xe.useContext(eR))==null?void 0:m.id)||null},rR=()=>Xe.useContext(tR);function nR(m){const{open:g=!1,onOpenChange:a,elements:c}=m,_=aM(),A=Xe.useRef({}),[N]=Xe.useState(()=>QL()),r=iR()!=null,[W,ie]=Xe.useState(c.reference),oe=YL((Se,xe,Ae)=>{A.current.openEvent=Se?xe:void 0,N.emit("openchange",{open:Se,event:xe,reason:Ae,nested:r}),a==null||a(Se,xe,Ae)}),he=Xe.useMemo(()=>({setPositionReference:ie}),[]),ve=Xe.useMemo(()=>({reference:W||c.reference||null,floating:c.floating||null,domReference:c.reference}),[W,c.reference,c.floating]);return Xe.useMemo(()=>({dataRef:A,open:g,onOpenChange:oe,elements:ve,events:N,floatingId:_,refs:he}),[g,oe,ve,N,_,he])}function sR(m){m===void 0&&(m={});const{nodeId:g}=m,a=nR({...m,elements:{reference:null,floating:null,...m.elements}}),c=m.rootContext||a,_=c.elements,[A,N]=Xe.useState(null),[r,W]=Xe.useState(null),oe=(_==null?void 0:_.domReference)||A,he=Xe.useRef(null),ve=rR();r0(()=>{oe&&(he.current=oe)},[oe]);const Se=UL({...m,elements:{..._,...r&&{reference:r}}}),xe=Xe.useCallback(ht=>{const tt=Sa(ht)?{getBoundingClientRect:()=>ht.getBoundingClientRect(),contextElement:ht}:ht;W(tt),Se.refs.setReference(tt)},[Se.refs]),Ae=Xe.useCallback(ht=>{(Sa(ht)||ht===null)&&(he.current=ht,N(ht)),(Sa(Se.refs.reference.current)||Se.refs.reference.current===null||ht!==null&&!Sa(ht))&&Se.refs.setReference(ht)},[Se.refs]),Re=Xe.useMemo(()=>({...Se.refs,setReference:Ae,setPositionReference:xe,domReference:he}),[Se.refs,Ae,xe]),He=Xe.useMemo(()=>({...Se.elements,domReference:oe}),[Se.elements,oe]),rt=Xe.useMemo(()=>({...Se,...c,refs:Re,elements:He,nodeId:g}),[Se,Re,He,g,c]);return r0(()=>{c.dataRef.current.floatingContext=rt;const ht=ve==null?void 0:ve.nodesRef.current.find(tt=>tt.id===g);ht&&(ht.context=rt)}),Xe.useMemo(()=>({...Se,context:rt,refs:Re,elements:He}),[Se,Re,He,rt])}/*!
  react-datepicker v8.2.1
  https://github.com/Hacker0x01/react-datepicker
  Released under the MIT License.
*/var Cx=function(g,a){return Cx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,_){c.__proto__=_}||function(c,_){for(var A in _)Object.prototype.hasOwnProperty.call(_,A)&&(c[A]=_[A])},Cx(g,a)};function Ao(m,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");Cx(m,g);function a(){this.constructor=m}m.prototype=g===null?Object.create(g):(a.prototype=g.prototype,new a)}var mn=function(){return mn=Object.assign||function(a){for(var c,_=1,A=arguments.length;_<A;_++){c=arguments[_];for(var N in c)Object.prototype.hasOwnProperty.call(c,N)&&(a[N]=c[N])}return a},mn.apply(this,arguments)};function Bu(m,g,a){if(a||arguments.length===2)for(var c=0,_=g.length,A;c<_;c++)(A||!(c in g))&&(A||(A=Array.prototype.slice.call(g,0,c)),A[c]=g[c]);return m.concat(A||Array.prototype.slice.call(g))}var oR=function(m){var g=m.showTimeSelectOnly,a=g===void 0?!1:g,c=m.showTime,_=c===void 0?!1:c,A=m.className,N=m.children,r=a?"Choose Time":"Choose Date".concat(_?" and Time":"");return Qt.createElement("div",{className:A,role:"dialog","aria-label":r,"aria-modal":"true"},N)},aR=function(m,g){var a=Xe.useRef(null),c=Xe.useRef(m);c.current=m;var _=Xe.useCallback(function(A){var N,r=A.composed&&A.composedPath&&A.composedPath().find(function(W){return W instanceof Node})||A.target;a.current&&!a.current.contains(r)&&(g&&r instanceof HTMLElement&&r.classList.contains(g)||(N=c.current)===null||N===void 0||N.call(c,A))},[g]);return Xe.useEffect(function(){return document.addEventListener("mousedown",_),function(){document.removeEventListener("mousedown",_)}},[_]),a},x0=function(m){var g=m.children,a=m.onClickOutside,c=m.className,_=m.containerRef,A=m.style,N=m.ignoreClass,r=aR(a,N);return Qt.createElement("div",{className:c,style:A,ref:function(W){r.current=W,_&&(_.current=W)}},g)},Ui;(function(m){m.ArrowUp="ArrowUp",m.ArrowDown="ArrowDown",m.ArrowLeft="ArrowLeft",m.ArrowRight="ArrowRight",m.PageUp="PageUp",m.PageDown="PageDown",m.Home="Home",m.End="End",m.Enter="Enter",m.Space=" ",m.Tab="Tab",m.Escape="Escape",m.Backspace="Backspace",m.X="x"})(Ui||(Ui={}));function lM(){var m=typeof window<"u"?window:globalThis;return m}var a_=12;function Cn(m){if(m==null)return new Date;var g=typeof m=="string"?ML(m):ar(m);return b0(g)?g:new Date}function nx(m,g,a,c,_){_===void 0&&(_=Cn());for(var A=Lm(a)||Lm(eb()),N=Array.isArray(g)?g:[g],r=0,W=N;r<W.length;r++){var ie=W[r],oe=vL(m,ie,_,{locale:A});if(b0(oe)&&(!c||m===vs(oe,ie,a)))return oe}return null}function b0(m,g){return Ky(m)&&!df(m,new Date("1/1/1800"))}function vs(m,g,a){if(a==="en")return FS(m,g,{useAdditionalWeekYearTokens:!0,useAdditionalDayOfYearTokens:!0});var c=a?Lm(a):void 0;return a&&!c&&console.warn('A locale object was not found for the provided string ["'.concat(a,'"].')),c=c||Lm(eb()),FS(m,g,{locale:c,useAdditionalWeekYearTokens:!0,useAdditionalDayOfYearTokens:!0})}function Gl(m,g){var a=g.dateFormat,c=g.locale,_=Array.isArray(a)&&a.length>0?a[0]:a;return m&&vs(m,_,c)||""}function lR(m,g,a){if(!m)return"";var c=Gl(m,a),_=g?Gl(g,a):"";return"".concat(c," - ").concat(_)}function cR(m,g){if(!(m!=null&&m.length))return"";var a=m[0]?Gl(m[0],g):"";if(m.length===1)return a;if(m.length===2&&m[1]){var c=Gl(m[1],g);return"".concat(a,", ").concat(c)}var _=m.length-1;return"".concat(a," (+").concat(_,")")}function sx(m,g){var a=g.hour,c=a===void 0?0:a,_=g.minute,A=_===void 0?0:_,N=g.second,r=N===void 0?0:N;return Ay(Py(Dy(m,r),A),c)}function uR(m){return Zx(m)}function hR(m,g){return vs(m,"ddd",g)}function ky(m){return hf(m)}function Bd(m,g,a){var c=Lm(g||eb());return kh(m,{locale:c,weekStartsOn:a})}function Ih(m){return Y2(m)}function Ug(m){return v0(m)}function $S(m){return Sx(m)}function HS(){return hf(Cn())}function GS(m){return W2(m)}function dR(m){return Mk(m)}function pR(m){return q2(m)}function Lu(m,g){return m&&g?SL(m,g):!m&&!g}function wa(m,g){return m&&g?bL(m,g):!m&&!g}function n0(m,g){return m&&g?wL(m,g):!m&&!g}function fn(m,g){return m&&g?Sk(m,g):!m&&!g}function nf(m,g){return m&&g?TO(m,g):!m&&!g}function jg(m,g,a){var c,_=hf(g),A=W2(a);try{c=Jg(m,{start:_,end:A})}catch{c=!1}return c}function eb(){var m=lM();return m.__localeId__}function Lm(m){if(typeof m=="string"){var g=lM();return g.__localeData__?g.__localeData__[m]:void 0}else return m}function fR(m,g,a){return g(vs(m,"EEEE",a))}function mR(m,g){return vs(m,"EEEEEE",g)}function gR(m,g){return vs(m,"EEE",g)}function tb(m,g){return vs(Wl(Cn(),m),"LLLL",g)}function cM(m,g){return vs(Wl(Cn(),m),"LLL",g)}function _R(m,g){return vs(wm(Cn(),m),"QQQ",g)}function Yl(m,g){var a=g===void 0?{}:g,c=a.minDate,_=a.maxDate,A=a.excludeDates,N=a.excludeDateIntervals,r=a.includeDates,W=a.includeDateIntervals,ie=a.filterDate;return l_(m,{minDate:c,maxDate:_})||A&&A.some(function(oe){return oe instanceof Date?fn(m,oe):fn(m,oe.date)})||N&&N.some(function(oe){var he=oe.start,ve=oe.end;return Jg(m,{start:he,end:ve})})||r&&!r.some(function(oe){return fn(m,oe)})||W&&!W.some(function(oe){var he=oe.start,ve=oe.end;return Jg(m,{start:he,end:ve})})||ie&&!ie(Cn(m))||!1}function ib(m,g){var a=g===void 0?{}:g,c=a.excludeDates,_=a.excludeDateIntervals;return _&&_.length>0?_.some(function(A){var N=A.start,r=A.end;return Jg(m,{start:N,end:r})}):c&&c.some(function(A){var N;return A instanceof Date?fn(m,A):fn(m,(N=A.date)!==null&&N!==void 0?N:new Date)})||!1}function uM(m,g){var a=g===void 0?{}:g,c=a.minDate,_=a.maxDate,A=a.excludeDates,N=a.includeDates,r=a.filterDate;return l_(m,{minDate:c?Y2(c):void 0,maxDate:_?q2(_):void 0})||(A==null?void 0:A.some(function(W){return wa(m,W instanceof Date?W:W.date)}))||N&&!N.some(function(W){return wa(m,W)})||r&&!r(Cn(m))||!1}function gy(m,g,a,c){var _=Zr(m),A=Ta(m),N=Zr(g),r=Ta(g),W=Zr(c);return _===N&&_===W?A<=a&&a<=r:_<N?W===_&&A<=a||W===N&&r>=a||W<N&&W>_:!1}function yR(m,g){var a=g===void 0?{}:g,c=a.minDate,_=a.maxDate,A=a.excludeDates,N=a.includeDates;return l_(m,{minDate:c,maxDate:_})||A&&A.some(function(r){return wa(r instanceof Date?r:r.date,m)})||N&&!N.some(function(r){return wa(r,m)})||!1}function _y(m,g){var a=g===void 0?{}:g,c=a.minDate,_=a.maxDate,A=a.excludeDates,N=a.includeDates,r=a.filterDate;return l_(m,{minDate:c,maxDate:_})||(A==null?void 0:A.some(function(W){return n0(m,W instanceof Date?W:W.date)}))||N&&!N.some(function(W){return n0(m,W)})||r&&!r(Cn(m))||!1}function yy(m,g,a){if(!g||!a||!Ky(g)||!Ky(a))return!1;var c=Zr(g),_=Zr(a);return c<=m&&_>=m}function Oy(m,g){var a=g===void 0?{}:g,c=a.minDate,_=a.maxDate,A=a.excludeDates,N=a.includeDates,r=a.filterDate,W=new Date(m,0,1);return l_(W,{minDate:c?v0(c):void 0,maxDate:_?X2(_):void 0})||(A==null?void 0:A.some(function(ie){return Lu(W,ie instanceof Date?ie:ie.date)}))||N&&!N.some(function(ie){return Lu(W,ie)})||r&&!r(Cn(W))||!1}function vy(m,g,a,c){var _=Zr(m),A=af(m),N=Zr(g),r=af(g),W=Zr(c);return _===N&&_===W?A<=a&&a<=r:_<N?W===_&&A<=a||W===N&&r>=a||W<N&&W>_:!1}function l_(m,g){var a,c=g===void 0?{}:g,_=c.minDate,A=c.maxDate;return(a=_&&km(m,_)<0||A&&km(m,A)>0)!==null&&a!==void 0?a:!1}function WS(m,g){return g.some(function(a){return Ph(a)===Ph(m)&&Dh(a)===Dh(m)&&Fd(a)===Fd(m)})}function qS(m,g){var a=g===void 0?{}:g,c=a.excludeTimes,_=a.includeTimes,A=a.filterTime;return c&&WS(m,c)||_&&!WS(m,_)||A&&!A(m)||!1}function YS(m,g){var a=g.minTime,c=g.maxTime;if(!a||!c)throw new Error("Both minTime and maxTime props required");var _=Cn();_=Ay(_,Ph(m)),_=Py(_,Dh(m)),_=Dy(_,Fd(m));var A=Cn();A=Ay(A,Ph(a)),A=Py(A,Dh(a)),A=Dy(A,Fd(a));var N=Cn();N=Ay(N,Ph(c)),N=Py(N,Dh(c)),N=Dy(N,Fd(c));var r;try{r=!Jg(_,{start:A,end:N})}catch{r=!1}return r}function XS(m,g){var a=g===void 0?{}:g,c=a.minDate,_=a.includeDates,A=lf(m,1);return c&&Jy(c,A)>0||_&&_.every(function(N){return Jy(N,A)>0})||!1}function ZS(m,g){var a=g===void 0?{}:g,c=a.maxDate,_=a.includeDates,A=Fc(m,1);return c&&Jy(A,c)>0||_&&_.every(function(N){return Jy(A,N)>0})||!1}function vR(m,g){var a=g===void 0?{}:g,c=a.minDate,_=a.includeDates,A=v0(m),N=nM(A);return c&&Qy(c,N)>0||_&&_.every(function(r){return Qy(r,N)>0})||!1}function xR(m,g){var a=g===void 0?{}:g,c=a.maxDate,_=a.includeDates,A=X2(m),N=Xx(A,1);return c&&Qy(N,c)>0||_&&_.every(function(r){return Qy(N,r)>0})||!1}function KS(m,g){var a=g===void 0?{}:g,c=a.minDate,_=a.includeDates,A=Om(m,1);return c&&e0(c,A)>0||_&&_.every(function(N){return e0(N,A)>0})||!1}function bR(m,g){var a=g===void 0?{}:g,c=a.minDate,_=a.yearItemNumber,A=_===void 0?a_:_,N=Ug(Om(m,A)),r=zd(N,A).endPeriod,W=c&&Zr(c);return W&&W>r||!1}function JS(m,g){var a=g===void 0?{}:g,c=a.maxDate,_=a.includeDates,A=Eh(m,1);return c&&e0(A,c)>0||_&&_.every(function(N){return e0(A,N)>0})||!1}function wR(m,g){var a=g===void 0?{}:g,c=a.maxDate,_=a.yearItemNumber,A=_===void 0?a_:_,N=Eh(m,A),r=zd(N,A).startPeriod,W=c&&Zr(c);return W&&W<r||!1}function hM(m){var g=m.minDate,a=m.includeDates;if(a&&g){var c=a.filter(function(_){return km(_,g)>=0});return IS(c)}else return a?IS(a):g}function dM(m){var g=m.maxDate,a=m.includeDates;if(a&&g){var c=a.filter(function(_){return km(_,g)<=0});return DS(c)}else return a?DS(a):g}function QS(m,g){var a;m===void 0&&(m=[]),g===void 0&&(g="react-datepicker__day--highlighted");for(var c=new Map,_=0,A=m.length;_<A;_++){var N=m[_];if(Ah(N)){var r=vs(N,"MM.dd.yyyy"),W=c.get(r)||[];W.includes(g)||(W.push(g),c.set(r,W))}else if(typeof N=="object"){var ie=Object.keys(N),oe=(a=ie[0])!==null&&a!==void 0?a:"",he=N[oe];if(typeof oe=="string"&&Array.isArray(he))for(var ve=0,Se=he.length;ve<Se;ve++){var xe=he[ve];if(xe){var r=vs(xe,"MM.dd.yyyy"),W=c.get(r)||[];W.includes(oe)||(W.push(oe),c.set(r,W))}}}}return c}function SR(m,g){return m.length!==g.length?!1:m.every(function(a,c){return a===g[c]})}function TR(m,g){m===void 0&&(m=[]),g===void 0&&(g="react-datepicker__day--holidays");var a=new Map;return m.forEach(function(c){var _=c.date,A=c.holidayName;if(Ah(_)){var N=vs(_,"MM.dd.yyyy"),r=a.get(N)||{className:"",holidayNames:[]};if(!("className"in r&&r.className===g&&SR(r.holidayNames,[A]))){r.className=g;var W=r.holidayNames;r.holidayNames=W?Bu(Bu([],W,!0),[A],!1):[A],a.set(N,r)}}}),a}function MR(m,g,a,c,_){for(var A=_.length,N=[],r=0;r<A;r++){var W=m,ie=_[r];ie&&(W=vk(W,Ph(ie)),W=wx(W,Dh(ie)),W=wk(W,Fd(ie)));var oe=wx(m,(a+1)*c);Vd(W,g)&&df(W,oe)&&ie!=null&&N.push(ie)}return N}function eT(m){return m<10?"0".concat(m):"".concat(m)}function zd(m,g){g===void 0&&(g=a_);var a=Math.ceil(Zr(m)/g)*g,c=a-(g-1);return{startPeriod:c,endPeriod:a}}function CR(m){var g=new Date(m.getFullYear(),m.getMonth(),m.getDate()),a=new Date(m.getFullYear(),m.getMonth(),m.getDate(),24);return Math.round((+a-+g)/36e5)}function tT(m){var g=m.getSeconds(),a=m.getMilliseconds();return ar(m.getTime()-g*1e3-a)}function ER(m,g){return tT(m).getTime()===tT(g).getTime()}function iT(m){if(!Ah(m))throw new Error("Invalid date");var g=new Date(m);return g.setHours(0,0,0,0),g}function rT(m,g){if(!Ah(m)||!Ah(g))throw new Error("Invalid date received");var a=iT(m),c=iT(g);return df(a,c)}function pM(m){return m.key===Ui.Space}var AR=function(m){Ao(g,m);function g(a){var c=m.call(this,a)||this;return c.inputRef=Qt.createRef(),c.onTimeChange=function(_){var A,N;c.setState({time:_});var r=c.props.date,W=r instanceof Date&&!isNaN(+r),ie=W?r:new Date;if(_!=null&&_.includes(":")){var oe=_.split(":"),he=oe[0],ve=oe[1];ie.setHours(Number(he)),ie.setMinutes(Number(ve))}(N=(A=c.props).onChange)===null||N===void 0||N.call(A,ie)},c.renderTimeInput=function(){var _=c.state.time,A=c.props,N=A.date,r=A.timeString,W=A.customTimeInput;return W?Xe.cloneElement(W,{date:N,value:_,onChange:c.onTimeChange}):Qt.createElement("input",{type:"time",className:"react-datepicker-time__input",placeholder:"Time",name:"time-input",ref:c.inputRef,onClick:function(){var ie;(ie=c.inputRef.current)===null||ie===void 0||ie.focus()},required:!0,value:_,onChange:function(ie){c.onTimeChange(ie.target.value||r)}})},c.state={time:c.props.timeString},c}return g.getDerivedStateFromProps=function(a,c){return a.timeString!==c.time?{time:a.timeString}:null},g.prototype.render=function(){return Qt.createElement("div",{className:"react-datepicker__input-time-container"},Qt.createElement("div",{className:"react-datepicker-time__caption"},this.props.timeInputLabel),Qt.createElement("div",{className:"react-datepicker-time__input-container"},Qt.createElement("div",{className:"react-datepicker-time__input"},this.renderTimeInput())))},g}(Xe.Component),PR=function(m){Ao(g,m);function g(){var a=m!==null&&m.apply(this,arguments)||this;return a.dayEl=Xe.createRef(),a.handleClick=function(c){!a.isDisabled()&&a.props.onClick&&a.props.onClick(c)},a.handleMouseEnter=function(c){!a.isDisabled()&&a.props.onMouseEnter&&a.props.onMouseEnter(c)},a.handleOnKeyDown=function(c){var _,A,N=c.key;N===Ui.Space&&(c.preventDefault(),c.key=Ui.Enter),(A=(_=a.props).handleOnKeyDown)===null||A===void 0||A.call(_,c)},a.isSameDay=function(c){return fn(a.props.day,c)},a.isKeyboardSelected=function(){var c;if(a.props.disabledKeyboardNavigation)return!1;var _=a.props.selectsMultiple?(c=a.props.selectedDates)===null||c===void 0?void 0:c.some(function(N){return a.isSameDayOrWeek(N)}):a.isSameDayOrWeek(a.props.selected),A=a.props.preSelection&&a.isDisabled(a.props.preSelection);return!_&&a.isSameDayOrWeek(a.props.preSelection)&&!A},a.isDisabled=function(c){return c===void 0&&(c=a.props.day),Yl(c,{minDate:a.props.minDate,maxDate:a.props.maxDate,excludeDates:a.props.excludeDates,excludeDateIntervals:a.props.excludeDateIntervals,includeDateIntervals:a.props.includeDateIntervals,includeDates:a.props.includeDates,filterDate:a.props.filterDate})},a.isExcluded=function(){return ib(a.props.day,{excludeDates:a.props.excludeDates,excludeDateIntervals:a.props.excludeDateIntervals})},a.isStartOfWeek=function(){return fn(a.props.day,Bd(a.props.day,a.props.locale,a.props.calendarStartDay))},a.isSameWeek=function(c){return a.props.showWeekPicker&&fn(c,Bd(a.props.day,a.props.locale,a.props.calendarStartDay))},a.isSameDayOrWeek=function(c){return a.isSameDay(c)||a.isSameWeek(c)},a.getHighLightedClass=function(){var c=a.props,_=c.day,A=c.highlightDates;if(!A)return!1;var N=vs(_,"MM.dd.yyyy");return A.get(N)},a.getHolidaysClass=function(){var c,_=a.props,A=_.day,N=_.holidays;if(!N)return[void 0];var r=vs(A,"MM.dd.yyyy");return N.has(r)?[(c=N.get(r))===null||c===void 0?void 0:c.className]:[void 0]},a.isInRange=function(){var c=a.props,_=c.day,A=c.startDate,N=c.endDate;return!A||!N?!1:jg(_,A,N)},a.isInSelectingRange=function(){var c,_=a.props,A=_.day,N=_.selectsStart,r=_.selectsEnd,W=_.selectsRange,ie=_.selectsDisabledDaysInRange,oe=_.startDate,he=_.endDate,ve=(c=a.props.selectingDate)!==null&&c!==void 0?c:a.props.preSelection;return!(N||r||W)||!ve||!ie&&a.isDisabled()?!1:N&&he&&(df(ve,he)||nf(ve,he))?jg(A,ve,he):r&&oe&&(Vd(ve,oe)||nf(ve,oe))||W&&oe&&!he&&(Vd(ve,oe)||nf(ve,oe))?jg(A,oe,ve):!1},a.isSelectingRangeStart=function(){var c;if(!a.isInSelectingRange())return!1;var _=a.props,A=_.day,N=_.startDate,r=_.selectsStart,W=(c=a.props.selectingDate)!==null&&c!==void 0?c:a.props.preSelection;return r?fn(A,W):fn(A,N)},a.isSelectingRangeEnd=function(){var c;if(!a.isInSelectingRange())return!1;var _=a.props,A=_.day,N=_.endDate,r=_.selectsEnd,W=_.selectsRange,ie=(c=a.props.selectingDate)!==null&&c!==void 0?c:a.props.preSelection;return r||W?fn(A,ie):fn(A,N)},a.isRangeStart=function(){var c=a.props,_=c.day,A=c.startDate,N=c.endDate;return!A||!N?!1:fn(A,_)},a.isRangeEnd=function(){var c=a.props,_=c.day,A=c.startDate,N=c.endDate;return!A||!N?!1:fn(N,_)},a.isWeekend=function(){var c=xO(a.props.day);return c===0||c===6},a.isAfterMonth=function(){return a.props.month!==void 0&&(a.props.month+1)%12===Ta(a.props.day)},a.isBeforeMonth=function(){return a.props.month!==void 0&&(Ta(a.props.day)+1)%12===a.props.month},a.isCurrentDay=function(){return a.isSameDay(Cn())},a.isSelected=function(){var c;return a.props.selectsMultiple?(c=a.props.selectedDates)===null||c===void 0?void 0:c.some(function(_){return a.isSameDayOrWeek(_)}):a.isSameDayOrWeek(a.props.selected)},a.getClassNames=function(c){var _=a.props.dayClassName?a.props.dayClassName(c):void 0;return gn("react-datepicker__day",_,"react-datepicker__day--"+hR(a.props.day),{"react-datepicker__day--disabled":a.isDisabled(),"react-datepicker__day--excluded":a.isExcluded(),"react-datepicker__day--selected":a.isSelected(),"react-datepicker__day--keyboard-selected":a.isKeyboardSelected(),"react-datepicker__day--range-start":a.isRangeStart(),"react-datepicker__day--range-end":a.isRangeEnd(),"react-datepicker__day--in-range":a.isInRange(),"react-datepicker__day--in-selecting-range":a.isInSelectingRange(),"react-datepicker__day--selecting-range-start":a.isSelectingRangeStart(),"react-datepicker__day--selecting-range-end":a.isSelectingRangeEnd(),"react-datepicker__day--today":a.isCurrentDay(),"react-datepicker__day--weekend":a.isWeekend(),"react-datepicker__day--outside-month":a.isAfterMonth()||a.isBeforeMonth()},a.getHighLightedClass(),a.getHolidaysClass())},a.getAriaLabel=function(){var c=a.props,_=c.day,A=c.ariaLabelPrefixWhenEnabled,N=A===void 0?"Choose":A,r=c.ariaLabelPrefixWhenDisabled,W=r===void 0?"Not available":r,ie=a.isDisabled()||a.isExcluded()?W:N;return"".concat(ie," ").concat(vs(_,"PPPP",a.props.locale))},a.getTitle=function(){var c=a.props,_=c.day,A=c.holidays,N=A===void 0?new Map:A,r=c.excludeDates,W=vs(_,"MM.dd.yyyy"),ie=[];return N.has(W)&&ie.push.apply(ie,N.get(W).holidayNames),a.isExcluded()&&ie.push(r==null?void 0:r.filter(function(oe){return oe instanceof Date?fn(oe,_):fn(oe==null?void 0:oe.date,_)}).map(function(oe){if(!(oe instanceof Date))return oe==null?void 0:oe.message})),ie.join(", ")},a.getTabIndex=function(){var c=a.props.selected,_=a.props.preSelection,A=!(a.props.showWeekPicker&&(a.props.showWeekNumber||!a.isStartOfWeek()))&&(a.isKeyboardSelected()||a.isSameDay(c)&&fn(_,c))?0:-1;return A},a.handleFocusDay=function(){var c;a.shouldFocusDay()&&((c=a.dayEl.current)===null||c===void 0||c.focus({preventScroll:!0}))},a.renderDayContents=function(){return a.props.monthShowsDuplicateDaysEnd&&a.isAfterMonth()||a.props.monthShowsDuplicateDaysStart&&a.isBeforeMonth()?null:a.props.renderDayContents?a.props.renderDayContents(BS(a.props.day),a.props.day):BS(a.props.day)},a.render=function(){return Qt.createElement("div",{ref:a.dayEl,className:a.getClassNames(a.props.day),onKeyDown:a.handleOnKeyDown,onClick:a.handleClick,onMouseEnter:a.props.usePointerEvent?void 0:a.handleMouseEnter,onPointerEnter:a.props.usePointerEvent?a.handleMouseEnter:void 0,tabIndex:a.getTabIndex(),"aria-label":a.getAriaLabel(),role:"option",title:a.getTitle(),"aria-disabled":a.isDisabled(),"aria-current":a.isCurrentDay()?"date":void 0,"aria-selected":a.isSelected()||a.isInRange()},a.renderDayContents(),a.getTitle()!==""&&Qt.createElement("span",{className:"overlay"},a.getTitle()))},a}return g.prototype.componentDidMount=function(){this.handleFocusDay()},g.prototype.componentDidUpdate=function(){this.handleFocusDay()},g.prototype.shouldFocusDay=function(){var a=!1;return this.getTabIndex()===0&&this.isSameDay(this.props.preSelection)&&((!document.activeElement||document.activeElement===document.body)&&(a=!0),this.props.inline&&!this.props.shouldFocusDayInline&&(a=!1),this.isDayActiveElement()&&(a=!0),this.isDuplicateDay()&&(a=!1)),a},g.prototype.isDayActiveElement=function(){var a,c,_;return((c=(a=this.props.containerRef)===null||a===void 0?void 0:a.current)===null||c===void 0?void 0:c.contains(document.activeElement))&&((_=document.activeElement)===null||_===void 0?void 0:_.classList.contains("react-datepicker__day"))},g.prototype.isDuplicateDay=function(){return this.props.monthShowsDuplicateDaysEnd&&this.isAfterMonth()||this.props.monthShowsDuplicateDaysStart&&this.isBeforeMonth()},g}(Xe.Component),DR=function(m){Ao(g,m);function g(){var a=m!==null&&m.apply(this,arguments)||this;return a.weekNumberEl=Xe.createRef(),a.handleClick=function(c){a.props.onClick&&a.props.onClick(c)},a.handleOnKeyDown=function(c){var _,A,N=c.key;N===Ui.Space&&(c.preventDefault(),c.key=Ui.Enter),(A=(_=a.props).handleOnKeyDown)===null||A===void 0||A.call(_,c)},a.isKeyboardSelected=function(){return!a.props.disabledKeyboardNavigation&&!fn(a.props.date,a.props.selected)&&fn(a.props.date,a.props.preSelection)},a.getTabIndex=function(){return a.props.showWeekPicker&&a.props.showWeekNumber&&(a.isKeyboardSelected()||fn(a.props.date,a.props.selected)&&fn(a.props.preSelection,a.props.selected))?0:-1},a.handleFocusWeekNumber=function(c){var _=!1;a.getTabIndex()===0&&!(c!=null&&c.isInputFocused)&&fn(a.props.date,a.props.preSelection)&&((!document.activeElement||document.activeElement===document.body)&&(_=!0),a.props.inline&&!a.props.shouldFocusDayInline&&(_=!1),a.props.containerRef&&a.props.containerRef.current&&a.props.containerRef.current.contains(document.activeElement)&&document.activeElement&&document.activeElement.classList.contains("react-datepicker__week-number")&&(_=!0)),_&&a.weekNumberEl.current&&a.weekNumberEl.current.focus({preventScroll:!0})},a}return Object.defineProperty(g,"defaultProps",{get:function(){return{ariaLabelPrefix:"week "}},enumerable:!1,configurable:!0}),g.prototype.componentDidMount=function(){this.handleFocusWeekNumber()},g.prototype.componentDidUpdate=function(a){this.handleFocusWeekNumber(a)},g.prototype.render=function(){var a=this.props,c=a.weekNumber,_=a.isWeekDisabled,A=a.ariaLabelPrefix,N=A===void 0?g.defaultProps.ariaLabelPrefix:A,r=a.onClick,W={"react-datepicker__week-number":!0,"react-datepicker__week-number--clickable":!!r&&!_,"react-datepicker__week-number--selected":!!r&&fn(this.props.date,this.props.selected)};return Qt.createElement("div",{ref:this.weekNumberEl,className:gn(W),"aria-label":"".concat(N," ").concat(this.props.weekNumber),onClick:this.handleClick,onKeyDown:this.handleOnKeyDown,tabIndex:this.getTabIndex()},c)},g}(Xe.Component),IR=function(m){Ao(g,m);function g(){var a=m!==null&&m.apply(this,arguments)||this;return a.isDisabled=function(c){return Yl(c,{minDate:a.props.minDate,maxDate:a.props.maxDate,excludeDates:a.props.excludeDates,excludeDateIntervals:a.props.excludeDateIntervals,includeDateIntervals:a.props.includeDateIntervals,includeDates:a.props.includeDates,filterDate:a.props.filterDate})},a.handleDayClick=function(c,_){a.props.onDayClick&&a.props.onDayClick(c,_)},a.handleDayMouseEnter=function(c){a.props.onDayMouseEnter&&a.props.onDayMouseEnter(c)},a.handleWeekClick=function(c,_,A){for(var N,r,W,ie=new Date(c),oe=0;oe<7;oe++){var he=new Date(c);he.setDate(he.getDate()+oe);var ve=!a.isDisabled(he);if(ve){ie=he;break}}typeof a.props.onWeekSelect=="function"&&a.props.onWeekSelect(ie,_,A),a.props.showWeekPicker&&a.handleDayClick(ie,A),((N=a.props.shouldCloseOnSelect)!==null&&N!==void 0?N:g.defaultProps.shouldCloseOnSelect)&&((W=(r=a.props).setOpen)===null||W===void 0||W.call(r,!1))},a.formatWeekNumber=function(c){return a.props.formatWeekNumber?a.props.formatWeekNumber(c):uR(c)},a.isWeekDisabled=function(){for(var c=a.startOfWeek(),_=zc(c,6),A=new Date(c);A<=_;){if(!a.isDisabled(A))return!1;A=zc(A,1)}return!0},a.renderDays=function(){var c=a.startOfWeek(),_=[],A=a.formatWeekNumber(c);if(a.props.showWeekNumber){var N=a.props.onWeekSelect||a.props.showWeekPicker?a.handleWeekClick.bind(a,c,A):void 0;_.push(Qt.createElement(DR,mn({key:"W"},g.defaultProps,a.props,{weekNumber:A,isWeekDisabled:a.isWeekDisabled(),date:c,onClick:N})))}return _.concat([0,1,2,3,4,5,6].map(function(r){var W=zc(c,r);return Qt.createElement(PR,mn({},g.defaultProps,a.props,{ariaLabelPrefixWhenEnabled:a.props.chooseDayAriaLabelPrefix,ariaLabelPrefixWhenDisabled:a.props.disabledDayAriaLabelPrefix,key:W.valueOf(),day:W,onClick:a.handleDayClick.bind(a,W),onMouseEnter:a.handleDayMouseEnter.bind(a,W)}))}))},a.startOfWeek=function(){return Bd(a.props.day,a.props.locale,a.props.calendarStartDay)},a.isKeyboardSelected=function(){return!a.props.disabledKeyboardNavigation&&!fn(a.startOfWeek(),a.props.selected)&&fn(a.startOfWeek(),a.props.preSelection)},a}return Object.defineProperty(g,"defaultProps",{get:function(){return{shouldCloseOnSelect:!0}},enumerable:!1,configurable:!0}),g.prototype.render=function(){var a={"react-datepicker__week":!0,"react-datepicker__week--selected":fn(this.startOfWeek(),this.props.selected),"react-datepicker__week--keyboard-selected":this.isKeyboardSelected()};return Qt.createElement("div",{className:gn(a)},this.renderDays())},g}(Xe.Component),Fg,kR=6,Mm={TWO_COLUMNS:"two_columns",THREE_COLUMNS:"three_columns",FOUR_COLUMNS:"four_columns"},ox=(Fg={},Fg[Mm.TWO_COLUMNS]={grid:[[0,1],[2,3],[4,5],[6,7],[8,9],[10,11]],verticalNavigationOffset:2},Fg[Mm.THREE_COLUMNS]={grid:[[0,1,2],[3,4,5],[6,7,8],[9,10,11]],verticalNavigationOffset:3},Fg[Mm.FOUR_COLUMNS]={grid:[[0,1,2,3],[4,5,6,7],[8,9,10,11]],verticalNavigationOffset:4},Fg),xy=1;function nT(m,g){return m?Mm.FOUR_COLUMNS:g?Mm.TWO_COLUMNS:Mm.THREE_COLUMNS}var OR=function(m){Ao(g,m);function g(){var a=m!==null&&m.apply(this,arguments)||this;return a.MONTH_REFS=Bu([],Array(12),!0).map(function(){return Xe.createRef()}),a.QUARTER_REFS=Bu([],Array(4),!0).map(function(){return Xe.createRef()}),a.isDisabled=function(c){return Yl(c,{minDate:a.props.minDate,maxDate:a.props.maxDate,excludeDates:a.props.excludeDates,excludeDateIntervals:a.props.excludeDateIntervals,includeDateIntervals:a.props.includeDateIntervals,includeDates:a.props.includeDates,filterDate:a.props.filterDate})},a.isExcluded=function(c){return ib(c,{excludeDates:a.props.excludeDates,excludeDateIntervals:a.props.excludeDateIntervals})},a.handleDayClick=function(c,_){var A,N;(N=(A=a.props).onDayClick)===null||N===void 0||N.call(A,c,_,a.props.orderInDisplay)},a.handleDayMouseEnter=function(c){var _,A;(A=(_=a.props).onDayMouseEnter)===null||A===void 0||A.call(_,c)},a.handleMouseLeave=function(){var c,_;(_=(c=a.props).onMouseLeave)===null||_===void 0||_.call(c)},a.isRangeStartMonth=function(c){var _=a.props,A=_.day,N=_.startDate,r=_.endDate;return!N||!r?!1:wa(Wl(A,c),N)},a.isRangeStartQuarter=function(c){var _=a.props,A=_.day,N=_.startDate,r=_.endDate;return!N||!r?!1:n0(wm(A,c),N)},a.isRangeEndMonth=function(c){var _=a.props,A=_.day,N=_.startDate,r=_.endDate;return!N||!r?!1:wa(Wl(A,c),r)},a.isRangeEndQuarter=function(c){var _=a.props,A=_.day,N=_.startDate,r=_.endDate;return!N||!r?!1:n0(wm(A,c),r)},a.isInSelectingRangeMonth=function(c){var _,A=a.props,N=A.day,r=A.selectsStart,W=A.selectsEnd,ie=A.selectsRange,oe=A.startDate,he=A.endDate,ve=(_=a.props.selectingDate)!==null&&_!==void 0?_:a.props.preSelection;return!(r||W||ie)||!ve?!1:r&&he?gy(ve,he,c,N):W&&oe||ie&&oe&&!he?gy(oe,ve,c,N):!1},a.isSelectingMonthRangeStart=function(c){var _;if(!a.isInSelectingRangeMonth(c))return!1;var A=a.props,N=A.day,r=A.startDate,W=A.selectsStart,ie=Wl(N,c),oe=(_=a.props.selectingDate)!==null&&_!==void 0?_:a.props.preSelection;return W?wa(ie,oe):wa(ie,r)},a.isSelectingMonthRangeEnd=function(c){var _;if(!a.isInSelectingRangeMonth(c))return!1;var A=a.props,N=A.day,r=A.endDate,W=A.selectsEnd,ie=A.selectsRange,oe=Wl(N,c),he=(_=a.props.selectingDate)!==null&&_!==void 0?_:a.props.preSelection;return W||ie?wa(oe,he):wa(oe,r)},a.isInSelectingRangeQuarter=function(c){var _,A=a.props,N=A.day,r=A.selectsStart,W=A.selectsEnd,ie=A.selectsRange,oe=A.startDate,he=A.endDate,ve=(_=a.props.selectingDate)!==null&&_!==void 0?_:a.props.preSelection;return!(r||W||ie)||!ve?!1:r&&he?vy(ve,he,c,N):W&&oe||ie&&oe&&!he?vy(oe,ve,c,N):!1},a.isWeekInMonth=function(c){var _=a.props.day,A=zc(c,6);return wa(c,_)||wa(A,_)},a.isCurrentMonth=function(c,_){return Zr(c)===Zr(Cn())&&_===Ta(Cn())},a.isCurrentQuarter=function(c,_){return Zr(c)===Zr(Cn())&&_===af(Cn())},a.isSelectedMonth=function(c,_,A){return Ta(A)===_&&Zr(c)===Zr(A)},a.isSelectMonthInList=function(c,_,A){return A.some(function(N){return a.isSelectedMonth(c,_,N)})},a.isSelectedQuarter=function(c,_,A){return af(c)===_&&Zr(c)===Zr(A)},a.renderWeeks=function(){for(var c=[],_=a.props.fixedHeight,A=0,N=!1,r=Bd(Ih(a.props.day),a.props.locale,a.props.calendarStartDay),W=function(xe){return a.props.showWeekPicker?Bd(xe,a.props.locale,a.props.calendarStartDay):a.props.preSelection},ie=function(xe){return a.props.showWeekPicker?Bd(xe,a.props.locale,a.props.calendarStartDay):a.props.selected},oe=a.props.selected?ie(a.props.selected):void 0,he=a.props.preSelection?W(a.props.preSelection):void 0;c.push(Qt.createElement(IR,mn({},a.props,{ariaLabelPrefix:a.props.weekAriaLabelPrefix,key:A,day:r,month:Ta(a.props.day),onDayClick:a.handleDayClick,onDayMouseEnter:a.handleDayMouseEnter,selected:oe,preSelection:he,showWeekNumber:a.props.showWeekNumbers}))),!N;){A++,r=Zy(r,1);var ve=_&&A>=kR,Se=!_&&!a.isWeekInMonth(r);if(ve||Se)if(a.props.peekNextMonth)N=!0;else break}return c},a.onMonthClick=function(c,_){var A=a.isMonthDisabledForLabelDate(_),N=A.isDisabled,r=A.labelDate;N||a.handleDayClick(Ih(r),c)},a.onMonthMouseEnter=function(c){var _=a.isMonthDisabledForLabelDate(c),A=_.isDisabled,N=_.labelDate;A||a.handleDayMouseEnter(Ih(N))},a.handleMonthNavigation=function(c,_){var A,N,r,W;(N=(A=a.props).setPreSelection)===null||N===void 0||N.call(A,_),(W=(r=a.MONTH_REFS[c])===null||r===void 0?void 0:r.current)===null||W===void 0||W.focus()},a.handleKeyboardNavigation=function(c,_,A){var N,r=a.props,W=r.selected,ie=r.preSelection,oe=r.setPreSelection,he=r.minDate,ve=r.maxDate,Se=r.showFourColumnMonthYearPicker,xe=r.showTwoColumnMonthYearPicker;if(ie){var Ae=nT(Se,xe),Re=a.getVerticalOffset(Ae),He=(N=ox[Ae])===null||N===void 0?void 0:N.grid,rt=function(Ve,Tt,qt){var Me,gt,oi=Tt,Ti=qt;switch(Ve){case Ui.ArrowRight:oi=Fc(Tt,xy),Ti=qt===11?0:qt+xy;break;case Ui.ArrowLeft:oi=lf(Tt,xy),Ti=qt===0?11:qt-xy;break;case Ui.ArrowUp:oi=lf(Tt,Re),Ti=!((Me=He==null?void 0:He[0])===null||Me===void 0)&&Me.includes(qt)?qt+12-Re:qt-Re;break;case Ui.ArrowDown:oi=Fc(Tt,Re),Ti=!((gt=He==null?void 0:He[He.length-1])===null||gt===void 0)&&gt.includes(qt)?qt-12+Re:qt+Re;break}return{newCalculatedDate:oi,newCalculatedMonth:Ti}},ht=function(Ve,Tt,qt){for(var Me=40,gt=Ve,oi=!1,Ti=0,ni=rt(gt,Tt,qt),Mt=ni.newCalculatedDate,zt=ni.newCalculatedMonth;!oi;){if(Ti>=Me){Mt=Tt,zt=qt;break}if(he&&Mt<he){gt=Ui.ArrowRight;var ii=rt(gt,Mt,zt);Mt=ii.newCalculatedDate,zt=ii.newCalculatedMonth}if(ve&&Mt>ve){gt=Ui.ArrowLeft;var ii=rt(gt,Mt,zt);Mt=ii.newCalculatedDate,zt=ii.newCalculatedMonth}if(yR(Mt,a.props)){var ii=rt(gt,Mt,zt);Mt=ii.newCalculatedDate,zt=ii.newCalculatedMonth}else oi=!0;Ti++}return{newCalculatedDate:Mt,newCalculatedMonth:zt}};if(_===Ui.Enter){a.isMonthDisabled(A)||(a.onMonthClick(c,A),oe==null||oe(W));return}var tt=ht(_,ie,A),at=tt.newCalculatedDate,Lt=tt.newCalculatedMonth;switch(_){case Ui.ArrowRight:case Ui.ArrowLeft:case Ui.ArrowUp:case Ui.ArrowDown:a.handleMonthNavigation(Lt,at);break}}},a.getVerticalOffset=function(c){var _,A;return(A=(_=ox[c])===null||_===void 0?void 0:_.verticalNavigationOffset)!==null&&A!==void 0?A:0},a.onMonthKeyDown=function(c,_){var A=a.props,N=A.disabledKeyboardNavigation,r=A.handleOnMonthKeyDown,W=c.key;W!==Ui.Tab&&c.preventDefault(),N||a.handleKeyboardNavigation(c,W,_),r&&r(c)},a.onQuarterClick=function(c,_){var A=wm(a.props.day,_);_y(A,a.props)||a.handleDayClick($S(A),c)},a.onQuarterMouseEnter=function(c){var _=wm(a.props.day,c);_y(_,a.props)||a.handleDayMouseEnter($S(_))},a.handleQuarterNavigation=function(c,_){var A,N,r,W;a.isDisabled(_)||a.isExcluded(_)||((N=(A=a.props).setPreSelection)===null||N===void 0||N.call(A,_),(W=(r=a.QUARTER_REFS[c-1])===null||r===void 0?void 0:r.current)===null||W===void 0||W.focus())},a.onQuarterKeyDown=function(c,_){var A,N,r=c.key;if(!a.props.disabledKeyboardNavigation)switch(r){case Ui.Enter:a.onQuarterClick(c,_),(N=(A=a.props).setPreSelection)===null||N===void 0||N.call(A,a.props.selected);break;case Ui.ArrowRight:if(!a.props.preSelection)break;a.handleQuarterNavigation(_===4?1:_+1,Xx(a.props.preSelection,1));break;case Ui.ArrowLeft:if(!a.props.preSelection)break;a.handleQuarterNavigation(_===1?4:_-1,nM(a.props.preSelection));break}},a.isMonthDisabledForLabelDate=function(c){var _,A=a.props,N=A.day,r=A.minDate,W=A.maxDate,ie=A.excludeDates,oe=A.includeDates,he=Wl(N,c);return{isDisabled:(_=(r||W||ie||oe)&&uM(he,a.props))!==null&&_!==void 0?_:!1,labelDate:he}},a.isMonthDisabled=function(c){var _=a.isMonthDisabledForLabelDate(c).isDisabled;return _},a.getMonthClassNames=function(c){var _=a.props,A=_.day,N=_.startDate,r=_.endDate,W=_.preSelection,ie=_.monthClassName,oe=ie?ie(Wl(A,c)):void 0,he=a.getSelection();return gn("react-datepicker__month-text","react-datepicker__month-".concat(c),oe,{"react-datepicker__month-text--disabled":a.isMonthDisabled(c),"react-datepicker__month-text--selected":he?a.isSelectMonthInList(A,c,he):void 0,"react-datepicker__month-text--keyboard-selected":!a.props.disabledKeyboardNavigation&&W&&a.isSelectedMonth(A,c,W)&&!a.isMonthDisabled(c),"react-datepicker__month-text--in-selecting-range":a.isInSelectingRangeMonth(c),"react-datepicker__month-text--in-range":N&&r?gy(N,r,c,A):void 0,"react-datepicker__month-text--range-start":a.isRangeStartMonth(c),"react-datepicker__month-text--range-end":a.isRangeEndMonth(c),"react-datepicker__month-text--selecting-range-start":a.isSelectingMonthRangeStart(c),"react-datepicker__month-text--selecting-range-end":a.isSelectingMonthRangeEnd(c),"react-datepicker__month-text--today":a.isCurrentMonth(A,c)})},a.getTabIndex=function(c){if(a.props.preSelection==null)return"-1";var _=Ta(a.props.preSelection),A=a.isMonthDisabledForLabelDate(_).isDisabled,N=c===_&&!(A||a.props.disabledKeyboardNavigation)?"0":"-1";return N},a.getQuarterTabIndex=function(c){if(a.props.preSelection==null)return"-1";var _=af(a.props.preSelection),A=_y(a.props.day,a.props),N=c===_&&!(A||a.props.disabledKeyboardNavigation)?"0":"-1";return N},a.getAriaLabel=function(c){var _=a.props,A=_.chooseDayAriaLabelPrefix,N=A===void 0?"Choose":A,r=_.disabledDayAriaLabelPrefix,W=r===void 0?"Not available":r,ie=_.day,oe=_.locale,he=Wl(ie,c),ve=a.isDisabled(he)||a.isExcluded(he)?W:N;return"".concat(ve," ").concat(vs(he,"MMMM yyyy",oe))},a.getQuarterClassNames=function(c){var _=a.props,A=_.day,N=_.startDate,r=_.endDate,W=_.selected,ie=_.minDate,oe=_.maxDate,he=_.excludeDates,ve=_.includeDates,Se=_.filterDate,xe=_.preSelection,Ae=_.disabledKeyboardNavigation,Re=(ie||oe||he||ve||Se)&&_y(wm(A,c),a.props);return gn("react-datepicker__quarter-text","react-datepicker__quarter-".concat(c),{"react-datepicker__quarter-text--disabled":Re,"react-datepicker__quarter-text--selected":W?a.isSelectedQuarter(A,c,W):void 0,"react-datepicker__quarter-text--keyboard-selected":!Ae&&xe&&a.isSelectedQuarter(A,c,xe)&&!Re,"react-datepicker__quarter-text--in-selecting-range":a.isInSelectingRangeQuarter(c),"react-datepicker__quarter-text--in-range":N&&r?vy(N,r,c,A):void 0,"react-datepicker__quarter-text--range-start":a.isRangeStartQuarter(c),"react-datepicker__quarter-text--range-end":a.isRangeEndQuarter(c),"react-datepicker__quarter-text--today":a.isCurrentQuarter(A,c)})},a.getMonthContent=function(c){var _=a.props,A=_.showFullMonthYearPicker,N=_.renderMonthContent,r=_.locale,W=_.day,ie=cM(c,r),oe=tb(c,r);return N?N(c,ie,oe,W):A?oe:ie},a.getQuarterContent=function(c){var _,A=a.props,N=A.renderQuarterContent,r=A.locale,W=_R(c,r);return(_=N==null?void 0:N(c,W))!==null&&_!==void 0?_:W},a.renderMonths=function(){var c,_=a.props,A=_.showTwoColumnMonthYearPicker,N=_.showFourColumnMonthYearPicker,r=_.day,W=_.selected,ie=(c=ox[nT(N,A)])===null||c===void 0?void 0:c.grid;return ie==null?void 0:ie.map(function(oe,he){return Qt.createElement("div",{className:"react-datepicker__month-wrapper",key:he},oe.map(function(ve,Se){return Qt.createElement("div",{ref:a.MONTH_REFS[ve],key:Se,onClick:function(xe){a.onMonthClick(xe,ve)},onKeyDown:function(xe){pM(xe)&&(xe.preventDefault(),xe.key=Ui.Enter),a.onMonthKeyDown(xe,ve)},onMouseEnter:a.props.usePointerEvent?void 0:function(){return a.onMonthMouseEnter(ve)},onPointerEnter:a.props.usePointerEvent?function(){return a.onMonthMouseEnter(ve)}:void 0,tabIndex:Number(a.getTabIndex(ve)),className:a.getMonthClassNames(ve),"aria-disabled":a.isMonthDisabled(ve),role:"option","aria-label":a.getAriaLabel(ve),"aria-current":a.isCurrentMonth(r,ve)?"date":void 0,"aria-selected":W?a.isSelectedMonth(r,ve,W):void 0},a.getMonthContent(ve))}))})},a.renderQuarters=function(){var c=a.props,_=c.day,A=c.selected,N=[1,2,3,4];return Qt.createElement("div",{className:"react-datepicker__quarter-wrapper"},N.map(function(r,W){return Qt.createElement("div",{key:W,ref:a.QUARTER_REFS[W],role:"option",onClick:function(ie){a.onQuarterClick(ie,r)},onKeyDown:function(ie){a.onQuarterKeyDown(ie,r)},onMouseEnter:a.props.usePointerEvent?void 0:function(){return a.onQuarterMouseEnter(r)},onPointerEnter:a.props.usePointerEvent?function(){return a.onQuarterMouseEnter(r)}:void 0,className:a.getQuarterClassNames(r),"aria-selected":A?a.isSelectedQuarter(_,r,A):void 0,tabIndex:Number(a.getQuarterTabIndex(r)),"aria-current":a.isCurrentQuarter(_,r)?"date":void 0},a.getQuarterContent(r))}))},a.getClassNames=function(){var c=a.props,_=c.selectingDate,A=c.selectsStart,N=c.selectsEnd,r=c.showMonthYearPicker,W=c.showQuarterYearPicker,ie=c.showWeekPicker;return gn("react-datepicker__month",{"react-datepicker__month--selecting-range":_&&(A||N)},{"react-datepicker__monthPicker":r},{"react-datepicker__quarterPicker":W},{"react-datepicker__weekPicker":ie})},a}return g.prototype.getSelection=function(){var a=this.props,c=a.selected,_=a.selectedDates,A=a.selectsMultiple;if(A)return _;if(c)return[c]},g.prototype.render=function(){var a=this.props,c=a.showMonthYearPicker,_=a.showQuarterYearPicker,A=a.day,N=a.ariaLabelPrefix,r=N===void 0?"Month ":N,W=r?r.trim()+" ":"";return Qt.createElement("div",{className:this.getClassNames(),onMouseLeave:this.props.usePointerEvent?void 0:this.handleMouseLeave,onPointerLeave:this.props.usePointerEvent?this.handleMouseLeave:void 0,"aria-label":"".concat(W).concat(vs(A,"MMMM, yyyy",this.props.locale)),role:"listbox"},c?this.renderMonths():_?this.renderQuarters():this.renderWeeks())},g}(Xe.Component),LR=function(m){Ao(g,m);function g(){var a=m!==null&&m.apply(this,arguments)||this;return a.isSelectedMonth=function(c){return a.props.month===c},a.renderOptions=function(){return a.props.monthNames.map(function(c,_){return Qt.createElement("div",{className:a.isSelectedMonth(_)?"react-datepicker__month-option react-datepicker__month-option--selected_month":"react-datepicker__month-option",key:c,onClick:a.onChange.bind(a,_),"aria-selected":a.isSelectedMonth(_)?"true":void 0},a.isSelectedMonth(_)?Qt.createElement("span",{className:"react-datepicker__month-option--selected"},"✓"):"",c)})},a.onChange=function(c){return a.props.onChange(c)},a.handleClickOutside=function(){return a.props.onCancel()},a}return g.prototype.render=function(){return Qt.createElement(x0,{className:"react-datepicker__month-dropdown",onClickOutside:this.handleClickOutside},this.renderOptions())},g}(Xe.Component),RR=function(m){Ao(g,m);function g(){var a=m!==null&&m.apply(this,arguments)||this;return a.state={dropdownVisible:!1},a.renderSelectOptions=function(c){return c.map(function(_,A){return Qt.createElement("option",{key:_,value:A},_)})},a.renderSelectMode=function(c){return Qt.createElement("select",{value:a.props.month,className:"react-datepicker__month-select",onChange:function(_){return a.onChange(parseInt(_.target.value))}},a.renderSelectOptions(c))},a.renderReadView=function(c,_){return Qt.createElement("div",{key:"read",style:{visibility:c?"visible":"hidden"},className:"react-datepicker__month-read-view",onClick:a.toggleDropdown},Qt.createElement("span",{className:"react-datepicker__month-read-view--down-arrow"}),Qt.createElement("span",{className:"react-datepicker__month-read-view--selected-month"},_[a.props.month]))},a.renderDropdown=function(c){return Qt.createElement(LR,mn({key:"dropdown"},a.props,{monthNames:c,onChange:a.onChange,onCancel:a.toggleDropdown}))},a.renderScrollMode=function(c){var _=a.state.dropdownVisible,A=[a.renderReadView(!_,c)];return _&&A.unshift(a.renderDropdown(c)),A},a.onChange=function(c){a.toggleDropdown(),c!==a.props.month&&a.props.onChange(c)},a.toggleDropdown=function(){return a.setState({dropdownVisible:!a.state.dropdownVisible})},a}return g.prototype.render=function(){var a=this,c=[0,1,2,3,4,5,6,7,8,9,10,11].map(this.props.useShortMonthInDropdown?function(A){return cM(A,a.props.locale)}:function(A){return tb(A,a.props.locale)}),_;switch(this.props.dropdownMode){case"scroll":_=this.renderScrollMode(c);break;case"select":_=this.renderSelectMode(c);break}return Qt.createElement("div",{className:"react-datepicker__month-dropdown-container react-datepicker__month-dropdown-container--".concat(this.props.dropdownMode)},_)},g}(Xe.Component);function zR(m,g){for(var a=[],c=Ih(m),_=Ih(g);!Vd(c,_);)a.push(Cn(c)),c=Fc(c,1);return a}var FR=function(m){Ao(g,m);function g(a){var c=m.call(this,a)||this;return c.renderOptions=function(){return c.state.monthYearsList.map(function(_){var A=Mx(_),N=Lu(c.props.date,_)&&wa(c.props.date,_);return Qt.createElement("div",{className:N?"react-datepicker__month-year-option--selected_month-year":"react-datepicker__month-year-option",key:A,onClick:c.onChange.bind(c,A),"aria-selected":N?"true":void 0},N?Qt.createElement("span",{className:"react-datepicker__month-year-option--selected"},"✓"):"",vs(_,c.props.dateFormat,c.props.locale))})},c.onChange=function(_){return c.props.onChange(_)},c.handleClickOutside=function(){c.props.onCancel()},c.state={monthYearsList:zR(c.props.minDate,c.props.maxDate)},c}return g.prototype.render=function(){var a=gn({"react-datepicker__month-year-dropdown":!0,"react-datepicker__month-year-dropdown--scrollable":this.props.scrollableMonthYearDropdown});return Qt.createElement(x0,{className:a,onClickOutside:this.handleClickOutside},this.renderOptions())},g}(Xe.Component),BR=function(m){Ao(g,m);function g(){var a=m!==null&&m.apply(this,arguments)||this;return a.state={dropdownVisible:!1},a.renderSelectOptions=function(){for(var c=Ih(a.props.minDate),_=Ih(a.props.maxDate),A=[];!Vd(c,_);){var N=Mx(c);A.push(Qt.createElement("option",{key:N,value:N},vs(c,a.props.dateFormat,a.props.locale))),c=Fc(c,1)}return A},a.onSelectChange=function(c){a.onChange(parseInt(c.target.value))},a.renderSelectMode=function(){return Qt.createElement("select",{value:Mx(Ih(a.props.date)),className:"react-datepicker__month-year-select",onChange:a.onSelectChange},a.renderSelectOptions())},a.renderReadView=function(c){var _=vs(a.props.date,a.props.dateFormat,a.props.locale);return Qt.createElement("div",{key:"read",style:{visibility:c?"visible":"hidden"},className:"react-datepicker__month-year-read-view",onClick:a.toggleDropdown},Qt.createElement("span",{className:"react-datepicker__month-year-read-view--down-arrow"}),Qt.createElement("span",{className:"react-datepicker__month-year-read-view--selected-month-year"},_))},a.renderDropdown=function(){return Qt.createElement(FR,mn({key:"dropdown"},a.props,{onChange:a.onChange,onCancel:a.toggleDropdown}))},a.renderScrollMode=function(){var c=a.state.dropdownVisible,_=[a.renderReadView(!c)];return c&&_.unshift(a.renderDropdown()),_},a.onChange=function(c){a.toggleDropdown();var _=Cn(c);Lu(a.props.date,_)&&wa(a.props.date,_)||a.props.onChange(_)},a.toggleDropdown=function(){return a.setState({dropdownVisible:!a.state.dropdownVisible})},a}return g.prototype.render=function(){var a;switch(this.props.dropdownMode){case"scroll":a=this.renderScrollMode();break;case"select":a=this.renderSelectMode();break}return Qt.createElement("div",{className:"react-datepicker__month-year-dropdown-container react-datepicker__month-year-dropdown-container--".concat(this.props.dropdownMode)},a)},g}(Xe.Component),NR=function(m){Ao(g,m);function g(){var a=m!==null&&m.apply(this,arguments)||this;return a.state={height:null},a.scrollToTheSelectedTime=function(){requestAnimationFrame(function(){var c,_,A;a.list&&(a.list.scrollTop=(A=a.centerLi&&g.calcCenterPosition(a.props.monthRef?a.props.monthRef.clientHeight-((_=(c=a.header)===null||c===void 0?void 0:c.clientHeight)!==null&&_!==void 0?_:0):a.list.clientHeight,a.centerLi))!==null&&A!==void 0?A:0)})},a.handleClick=function(c){var _,A;(a.props.minTime||a.props.maxTime)&&YS(c,a.props)||(a.props.excludeTimes||a.props.includeTimes||a.props.filterTime)&&qS(c,a.props)||(A=(_=a.props).onChange)===null||A===void 0||A.call(_,c)},a.isSelectedTime=function(c){return a.props.selected&&ER(a.props.selected,c)},a.isDisabledTime=function(c){return(a.props.minTime||a.props.maxTime)&&YS(c,a.props)||(a.props.excludeTimes||a.props.includeTimes||a.props.filterTime)&&qS(c,a.props)},a.liClasses=function(c){var _,A=["react-datepicker__time-list-item",a.props.timeClassName?a.props.timeClassName(c):void 0];return a.isSelectedTime(c)&&A.push("react-datepicker__time-list-item--selected"),a.isDisabledTime(c)&&A.push("react-datepicker__time-list-item--disabled"),a.props.injectTimes&&(Ph(c)*3600+Dh(c)*60+Fd(c))%(((_=a.props.intervals)!==null&&_!==void 0?_:g.defaultProps.intervals)*60)!==0&&A.push("react-datepicker__time-list-item--injected"),A.join(" ")},a.handleOnKeyDown=function(c,_){var A,N;c.key===Ui.Space&&(c.preventDefault(),c.key=Ui.Enter),(c.key===Ui.ArrowUp||c.key===Ui.ArrowLeft)&&c.target instanceof HTMLElement&&c.target.previousSibling&&(c.preventDefault(),c.target.previousSibling instanceof HTMLElement&&c.target.previousSibling.focus()),(c.key===Ui.ArrowDown||c.key===Ui.ArrowRight)&&c.target instanceof HTMLElement&&c.target.nextSibling&&(c.preventDefault(),c.target.nextSibling instanceof HTMLElement&&c.target.nextSibling.focus()),c.key===Ui.Enter&&a.handleClick(_),(N=(A=a.props).handleOnKeyDown)===null||N===void 0||N.call(A,c)},a.renderTimes=function(){for(var c,_=[],A=typeof a.props.format=="string"?a.props.format:"p",N=(c=a.props.intervals)!==null&&c!==void 0?c:g.defaultProps.intervals,r=a.props.selected||a.props.openToDate||Cn(),W=ky(r),ie=a.props.injectTimes&&a.props.injectTimes.sort(function(Re,He){return Re.getTime()-He.getTime()}),oe=60*CR(r),he=oe/N,ve=0;ve<he;ve++){var Se=wx(W,ve*N);if(_.push(Se),ie){var xe=MR(W,Se,ve,N,ie);_=_.concat(xe)}}var Ae=_.reduce(function(Re,He){return He.getTime()<=r.getTime()?He:Re},_[0]);return _.map(function(Re){return Qt.createElement("li",{key:Re.valueOf(),onClick:a.handleClick.bind(a,Re),className:a.liClasses(Re),ref:function(He){Re===Ae&&(a.centerLi=He)},onKeyDown:function(He){a.handleOnKeyDown(He,Re)},tabIndex:Re===Ae?0:-1,role:"option","aria-selected":a.isSelectedTime(Re)?"true":void 0,"aria-disabled":a.isDisabledTime(Re)?"true":void 0},vs(Re,A,a.props.locale))})},a.renderTimeCaption=function(){return a.props.showTimeCaption===!1?Qt.createElement(Qt.Fragment,null):Qt.createElement("div",{className:"react-datepicker__header react-datepicker__header--time ".concat(a.props.showTimeSelectOnly?"react-datepicker__header--time--only":""),ref:function(c){a.header=c}},Qt.createElement("div",{className:"react-datepicker-time__header"},a.props.timeCaption))},a}return Object.defineProperty(g,"defaultProps",{get:function(){return{intervals:30,todayButton:null,timeCaption:"Time",showTimeCaption:!0}},enumerable:!1,configurable:!0}),g.prototype.componentDidMount=function(){this.scrollToTheSelectedTime(),this.props.monthRef&&this.header&&this.setState({height:this.props.monthRef.clientHeight-this.header.clientHeight})},g.prototype.render=function(){var a=this,c,_=this.state.height;return Qt.createElement("div",{className:"react-datepicker__time-container ".concat(((c=this.props.todayButton)!==null&&c!==void 0?c:g.defaultProps.todayButton)?"react-datepicker__time-container--with-today-button":"")},this.renderTimeCaption(),Qt.createElement("div",{className:"react-datepicker__time"},Qt.createElement("div",{className:"react-datepicker__time-box"},Qt.createElement("ul",{className:"react-datepicker__time-list",ref:function(A){a.list=A},style:_?{height:_}:{},role:"listbox","aria-label":this.props.timeCaption},this.renderTimes()))))},g.calcCenterPosition=function(a,c){return c.offsetTop-(a/2-c.clientHeight/2)},g}(Xe.Component),sT=3,VR=function(m){Ao(g,m);function g(a){var c=m.call(this,a)||this;return c.YEAR_REFS=Bu([],Array(c.props.yearItemNumber),!0).map(function(){return Xe.createRef()}),c.isDisabled=function(_){return Yl(_,{minDate:c.props.minDate,maxDate:c.props.maxDate,excludeDates:c.props.excludeDates,includeDates:c.props.includeDates,filterDate:c.props.filterDate})},c.isExcluded=function(_){return ib(_,{excludeDates:c.props.excludeDates})},c.selectingDate=function(){var _;return(_=c.props.selectingDate)!==null&&_!==void 0?_:c.props.preSelection},c.updateFocusOnPaginate=function(_){var A=function(){var N,r;(r=(N=c.YEAR_REFS[_])===null||N===void 0?void 0:N.current)===null||r===void 0||r.focus()};window.requestAnimationFrame(A)},c.handleYearClick=function(_,A){c.props.onDayClick&&c.props.onDayClick(_,A)},c.handleYearNavigation=function(_,A){var N,r,W,ie,oe=c.props,he=oe.date,ve=oe.yearItemNumber;if(!(he===void 0||ve===void 0)){var Se=zd(he,ve).startPeriod;c.isDisabled(A)||c.isExcluded(A)||((r=(N=c.props).setPreSelection)===null||r===void 0||r.call(N,A),_-Se<0?c.updateFocusOnPaginate(ve-(Se-_)):_-Se>=ve?c.updateFocusOnPaginate(Math.abs(ve-(_-Se))):(ie=(W=c.YEAR_REFS[_-Se])===null||W===void 0?void 0:W.current)===null||ie===void 0||ie.focus())}},c.isSameDay=function(_,A){return fn(_,A)},c.isCurrentYear=function(_){return _===Zr(Cn())},c.isRangeStart=function(_){return c.props.startDate&&c.props.endDate&&Lu(Iu(Cn(),_),c.props.startDate)},c.isRangeEnd=function(_){return c.props.startDate&&c.props.endDate&&Lu(Iu(Cn(),_),c.props.endDate)},c.isInRange=function(_){return yy(_,c.props.startDate,c.props.endDate)},c.isInSelectingRange=function(_){var A=c.props,N=A.selectsStart,r=A.selectsEnd,W=A.selectsRange,ie=A.startDate,oe=A.endDate;return!(N||r||W)||!c.selectingDate()?!1:N&&oe?yy(_,c.selectingDate(),oe):r&&ie||W&&ie&&!oe?yy(_,ie,c.selectingDate()):!1},c.isSelectingRangeStart=function(_){var A;if(!c.isInSelectingRange(_))return!1;var N=c.props,r=N.startDate,W=N.selectsStart,ie=Iu(Cn(),_);return W?Lu(ie,(A=c.selectingDate())!==null&&A!==void 0?A:null):Lu(ie,r??null)},c.isSelectingRangeEnd=function(_){var A;if(!c.isInSelectingRange(_))return!1;var N=c.props,r=N.endDate,W=N.selectsEnd,ie=N.selectsRange,oe=Iu(Cn(),_);return W||ie?Lu(oe,(A=c.selectingDate())!==null&&A!==void 0?A:null):Lu(oe,r??null)},c.isKeyboardSelected=function(_){if(!(c.props.date===void 0||c.props.selected==null||c.props.preSelection==null)){var A=c.props,N=A.minDate,r=A.maxDate,W=A.excludeDates,ie=A.includeDates,oe=A.filterDate,he=Ug(Iu(c.props.date,_)),ve=(N||r||W||ie||oe)&&Oy(_,c.props);return!c.props.disabledKeyboardNavigation&&!c.props.inline&&!fn(he,Ug(c.props.selected))&&fn(he,Ug(c.props.preSelection))&&!ve}},c.onYearClick=function(_,A){var N=c.props.date;N!==void 0&&c.handleYearClick(Ug(Iu(N,A)),_)},c.onYearKeyDown=function(_,A){var N,r,W=_.key,ie=c.props,oe=ie.date,he=ie.yearItemNumber,ve=ie.handleOnKeyDown;if(W!==Ui.Tab&&_.preventDefault(),!c.props.disabledKeyboardNavigation)switch(W){case Ui.Enter:if(c.props.selected==null)break;c.onYearClick(_,A),(r=(N=c.props).setPreSelection)===null||r===void 0||r.call(N,c.props.selected);break;case Ui.ArrowRight:if(c.props.preSelection==null)break;c.handleYearNavigation(A+1,Eh(c.props.preSelection,1));break;case Ui.ArrowLeft:if(c.props.preSelection==null)break;c.handleYearNavigation(A-1,Om(c.props.preSelection,1));break;case Ui.ArrowUp:{if(oe===void 0||he===void 0||c.props.preSelection==null)break;var Se=zd(oe,he).startPeriod,xe=sT,Ae=A-xe;if(Ae<Se){var Re=he%xe;A>=Se&&A<Se+Re?xe=Re:xe+=Re,Ae=A-xe}c.handleYearNavigation(Ae,Om(c.props.preSelection,xe));break}case Ui.ArrowDown:{if(oe===void 0||he===void 0||c.props.preSelection==null)break;var He=zd(oe,he).endPeriod,xe=sT,Ae=A+xe;if(Ae>He){var Re=he%xe;A<=He&&A>He-Re?xe=Re:xe+=Re,Ae=A+xe}c.handleYearNavigation(Ae,Eh(c.props.preSelection,xe));break}}ve&&ve(_)},c.getYearClassNames=function(_){var A=c.props,N=A.date,r=A.minDate,W=A.maxDate,ie=A.selected,oe=A.excludeDates,he=A.includeDates,ve=A.filterDate,Se=A.yearClassName;return gn("react-datepicker__year-text","react-datepicker__year-".concat(_),N?Se==null?void 0:Se(Iu(N,_)):void 0,{"react-datepicker__year-text--selected":ie?_===Zr(ie):void 0,"react-datepicker__year-text--disabled":(r||W||oe||he||ve)&&Oy(_,c.props),"react-datepicker__year-text--keyboard-selected":c.isKeyboardSelected(_),"react-datepicker__year-text--range-start":c.isRangeStart(_),"react-datepicker__year-text--range-end":c.isRangeEnd(_),"react-datepicker__year-text--in-range":c.isInRange(_),"react-datepicker__year-text--in-selecting-range":c.isInSelectingRange(_),"react-datepicker__year-text--selecting-range-start":c.isSelectingRangeStart(_),"react-datepicker__year-text--selecting-range-end":c.isSelectingRangeEnd(_),"react-datepicker__year-text--today":c.isCurrentYear(_)})},c.getYearTabIndex=function(_){if(c.props.disabledKeyboardNavigation||c.props.preSelection==null)return"-1";var A=Zr(c.props.preSelection),N=Oy(_,c.props);return _===A&&!N?"0":"-1"},c.getYearContent=function(_){return c.props.renderYearContent?c.props.renderYearContent(_):_},c}return g.prototype.render=function(){var a=this,c=[],_=this.props,A=_.date,N=_.yearItemNumber,r=_.onYearMouseEnter,W=_.onYearMouseLeave;if(A===void 0)return null;for(var ie=zd(A,N),oe=ie.startPeriod,he=ie.endPeriod,ve=function(Ae){c.push(Qt.createElement("div",{ref:Se.YEAR_REFS[Ae-oe],onClick:function(Re){a.onYearClick(Re,Ae)},onKeyDown:function(Re){pM(Re)&&(Re.preventDefault(),Re.key=Ui.Enter),a.onYearKeyDown(Re,Ae)},tabIndex:Number(Se.getYearTabIndex(Ae)),className:Se.getYearClassNames(Ae),onMouseEnter:Se.props.usePointerEvent?void 0:function(Re){return r(Re,Ae)},onPointerEnter:Se.props.usePointerEvent?function(Re){return r(Re,Ae)}:void 0,onMouseLeave:Se.props.usePointerEvent?void 0:function(Re){return W(Re,Ae)},onPointerLeave:Se.props.usePointerEvent?function(Re){return W(Re,Ae)}:void 0,key:Ae,"aria-current":Se.isCurrentYear(Ae)?"date":void 0},Se.getYearContent(Ae)))},Se=this,xe=oe;xe<=he;xe++)ve(xe);return Qt.createElement("div",{className:"react-datepicker__year"},Qt.createElement("div",{className:"react-datepicker__year-wrapper",onMouseLeave:this.props.usePointerEvent?void 0:this.props.clearSelectingDate,onPointerLeave:this.props.usePointerEvent?this.props.clearSelectingDate:void 0},c))},g}(Xe.Component);function UR(m,g,a,c){for(var _=[],A=0;A<2*g+1;A++){var N=m+g-A,r=!0;a&&(r=Zr(a)<=N),c&&r&&(r=Zr(c)>=N),r&&_.push(N)}return _}var jR=function(m){Ao(g,m);function g(a){var c=m.call(this,a)||this;c.renderOptions=function(){var r=c.props.year,W=c.state.yearsList.map(function(he){return Qt.createElement("div",{className:r===he?"react-datepicker__year-option react-datepicker__year-option--selected_year":"react-datepicker__year-option",key:he,onClick:c.onChange.bind(c,he),"aria-selected":r===he?"true":void 0},r===he?Qt.createElement("span",{className:"react-datepicker__year-option--selected"},"✓"):"",he)}),ie=c.props.minDate?Zr(c.props.minDate):null,oe=c.props.maxDate?Zr(c.props.maxDate):null;return(!oe||!c.state.yearsList.find(function(he){return he===oe}))&&W.unshift(Qt.createElement("div",{className:"react-datepicker__year-option",key:"upcoming",onClick:c.incrementYears},Qt.createElement("a",{className:"react-datepicker__navigation react-datepicker__navigation--years react-datepicker__navigation--years-upcoming"}))),(!ie||!c.state.yearsList.find(function(he){return he===ie}))&&W.push(Qt.createElement("div",{className:"react-datepicker__year-option",key:"previous",onClick:c.decrementYears},Qt.createElement("a",{className:"react-datepicker__navigation react-datepicker__navigation--years react-datepicker__navigation--years-previous"}))),W},c.onChange=function(r){c.props.onChange(r)},c.handleClickOutside=function(){c.props.onCancel()},c.shiftYears=function(r){var W=c.state.yearsList.map(function(ie){return ie+r});c.setState({yearsList:W})},c.incrementYears=function(){return c.shiftYears(1)},c.decrementYears=function(){return c.shiftYears(-1)};var _=a.yearDropdownItemNumber,A=a.scrollableYearDropdown,N=_||(A?10:5);return c.state={yearsList:UR(c.props.year,N,c.props.minDate,c.props.maxDate)},c.dropdownRef=Xe.createRef(),c}return g.prototype.componentDidMount=function(){var a=this.dropdownRef.current;if(a){var c=a.children?Array.from(a.children):null,_=c?c.find(function(A){return A.ariaSelected}):null;a.scrollTop=_&&_ instanceof HTMLElement?_.offsetTop+(_.clientHeight-a.clientHeight)/2:(a.scrollHeight-a.clientHeight)/2}},g.prototype.render=function(){var a=gn({"react-datepicker__year-dropdown":!0,"react-datepicker__year-dropdown--scrollable":this.props.scrollableYearDropdown});return Qt.createElement(x0,{className:a,containerRef:this.dropdownRef,onClickOutside:this.handleClickOutside},this.renderOptions())},g}(Xe.Component),$R=function(m){Ao(g,m);function g(){var a=m!==null&&m.apply(this,arguments)||this;return a.state={dropdownVisible:!1},a.renderSelectOptions=function(){for(var c=a.props.minDate?Zr(a.props.minDate):1900,_=a.props.maxDate?Zr(a.props.maxDate):2100,A=[],N=c;N<=_;N++)A.push(Qt.createElement("option",{key:N,value:N},N));return A},a.onSelectChange=function(c){a.onChange(parseInt(c.target.value))},a.renderSelectMode=function(){return Qt.createElement("select",{value:a.props.year,className:"react-datepicker__year-select",onChange:a.onSelectChange},a.renderSelectOptions())},a.renderReadView=function(c){return Qt.createElement("div",{key:"read",style:{visibility:c?"visible":"hidden"},className:"react-datepicker__year-read-view",onClick:function(_){return a.toggleDropdown(_)}},Qt.createElement("span",{className:"react-datepicker__year-read-view--down-arrow"}),Qt.createElement("span",{className:"react-datepicker__year-read-view--selected-year"},a.props.year))},a.renderDropdown=function(){return Qt.createElement(jR,mn({key:"dropdown"},a.props,{onChange:a.onChange,onCancel:a.toggleDropdown}))},a.renderScrollMode=function(){var c=a.state.dropdownVisible,_=[a.renderReadView(!c)];return c&&_.unshift(a.renderDropdown()),_},a.onChange=function(c){a.toggleDropdown(),c!==a.props.year&&a.props.onChange(c)},a.toggleDropdown=function(c){a.setState({dropdownVisible:!a.state.dropdownVisible},function(){a.props.adjustDateOnChange&&a.handleYearChange(a.props.date,c)})},a.handleYearChange=function(c,_){var A;(A=a.onSelect)===null||A===void 0||A.call(a,c,_),a.setOpen()},a.onSelect=function(c,_){var A,N;(N=(A=a.props).onSelect)===null||N===void 0||N.call(A,c,_)},a.setOpen=function(){var c,_;(_=(c=a.props).setOpen)===null||_===void 0||_.call(c,!0)},a}return g.prototype.render=function(){var a;switch(this.props.dropdownMode){case"scroll":a=this.renderScrollMode();break;case"select":a=this.renderSelectMode();break}return Qt.createElement("div",{className:"react-datepicker__year-dropdown-container react-datepicker__year-dropdown-container--".concat(this.props.dropdownMode)},a)},g}(Xe.Component),HR=["react-datepicker__year-select","react-datepicker__month-select","react-datepicker__month-year-select"],GR=function(m){var g=(m.className||"").split(/\s+/);return HR.some(function(a){return g.indexOf(a)>=0})},WR=function(m){Ao(g,m);function g(a){var c=m.call(this,a)||this;return c.monthContainer=void 0,c.handleClickOutside=function(_){c.props.onClickOutside(_)},c.setClickOutsideRef=function(){return c.containerRef.current},c.handleDropdownFocus=function(_){var A,N;GR(_.target)&&((N=(A=c.props).onDropdownFocus)===null||N===void 0||N.call(A,_))},c.getDateInView=function(){var _=c.props,A=_.preSelection,N=_.selected,r=_.openToDate,W=hM(c.props),ie=dM(c.props),oe=Cn(),he=r||N||A;return he||(W&&df(oe,W)?W:ie&&Vd(oe,ie)?ie:oe)},c.increaseMonth=function(){c.setState(function(_){var A=_.date;return{date:Fc(A,1)}},function(){return c.handleMonthChange(c.state.date)})},c.decreaseMonth=function(){c.setState(function(_){var A=_.date;return{date:lf(A,1)}},function(){return c.handleMonthChange(c.state.date)})},c.handleDayClick=function(_,A,N){c.props.onSelect(_,A,N),c.props.setPreSelection&&c.props.setPreSelection(_)},c.handleDayMouseEnter=function(_){c.setState({selectingDate:_}),c.props.onDayMouseEnter&&c.props.onDayMouseEnter(_)},c.handleMonthMouseLeave=function(){c.setState({selectingDate:void 0}),c.props.onMonthMouseLeave&&c.props.onMonthMouseLeave()},c.handleYearMouseEnter=function(_,A){c.setState({selectingDate:Iu(Cn(),A)}),c.props.onYearMouseEnter&&c.props.onYearMouseEnter(_,A)},c.handleYearMouseLeave=function(_,A){c.props.onYearMouseLeave&&c.props.onYearMouseLeave(_,A)},c.handleYearChange=function(_){var A,N,r,W;(N=(A=c.props).onYearChange)===null||N===void 0||N.call(A,_),c.setState({isRenderAriaLiveMessage:!0}),c.props.adjustDateOnChange&&(c.props.onSelect(_),(W=(r=c.props).setOpen)===null||W===void 0||W.call(r,!0)),c.props.setPreSelection&&c.props.setPreSelection(_)},c.getEnabledPreSelectionDateForMonth=function(_){if(!Yl(_,c.props))return _;for(var A=Ih(_),N=pR(_),r=Tk(N,A),W=null,ie=0;ie<=r;ie++){var oe=zc(A,ie);if(!Yl(oe,c.props)){W=oe;break}}return W},c.handleMonthChange=function(_){var A,N,r,W=(A=c.getEnabledPreSelectionDateForMonth(_))!==null&&A!==void 0?A:_;c.handleCustomMonthChange(W),c.props.adjustDateOnChange&&(c.props.onSelect(W),(r=(N=c.props).setOpen)===null||r===void 0||r.call(N,!0)),c.props.setPreSelection&&c.props.setPreSelection(W)},c.handleCustomMonthChange=function(_){var A,N;(N=(A=c.props).onMonthChange)===null||N===void 0||N.call(A,_),c.setState({isRenderAriaLiveMessage:!0})},c.handleMonthYearChange=function(_){c.handleYearChange(_),c.handleMonthChange(_)},c.changeYear=function(_){c.setState(function(A){var N=A.date;return{date:Iu(N,Number(_))}},function(){return c.handleYearChange(c.state.date)})},c.changeMonth=function(_){c.setState(function(A){var N=A.date;return{date:Wl(N,Number(_))}},function(){return c.handleMonthChange(c.state.date)})},c.changeMonthYear=function(_){c.setState(function(A){var N=A.date;return{date:Iu(Wl(N,Ta(_)),Zr(_))}},function(){return c.handleMonthYearChange(c.state.date)})},c.header=function(_){_===void 0&&(_=c.state.date);var A=Bd(_,c.props.locale,c.props.calendarStartDay),N=[];return c.props.showWeekNumbers&&N.push(Qt.createElement("div",{key:"W",className:"react-datepicker__day-name"},c.props.weekLabel||"#")),N.concat([0,1,2,3,4,5,6].map(function(r){var W=zc(A,r),ie=c.formatWeekday(W,c.props.locale),oe=c.props.weekDayClassName?c.props.weekDayClassName(W):void 0;return Qt.createElement("div",{key:r,"aria-label":vs(W,"EEEE",c.props.locale),className:gn("react-datepicker__day-name",oe)},ie)}))},c.formatWeekday=function(_,A){return c.props.formatWeekDay?fR(_,c.props.formatWeekDay,A):c.props.useWeekdaysShort?gR(_,A):mR(_,A)},c.decreaseYear=function(){c.setState(function(_){var A,N=_.date;return{date:Om(N,c.props.showYearPicker?(A=c.props.yearItemNumber)!==null&&A!==void 0?A:g.defaultProps.yearItemNumber:1)}},function(){return c.handleYearChange(c.state.date)})},c.clearSelectingDate=function(){c.setState({selectingDate:void 0})},c.renderPreviousButton=function(){var _,A,N;if(!c.props.renderCustomHeader){var r=(_=c.props.monthsShown)!==null&&_!==void 0?_:g.defaultProps.monthsShown,W=c.props.showPreviousMonths?r-1:0,ie=(A=c.props.monthSelectedIn)!==null&&A!==void 0?A:W,oe=lf(c.state.date,ie),he;switch(!0){case c.props.showMonthYearPicker:he=KS(c.state.date,c.props);break;case c.props.showYearPicker:he=bR(c.state.date,c.props);break;case c.props.showQuarterYearPicker:he=vR(c.state.date,c.props);break;default:he=XS(oe,c.props);break}if(!(!((N=c.props.forceShowMonthNavigation)!==null&&N!==void 0?N:g.defaultProps.forceShowMonthNavigation)&&!c.props.showDisabledMonthNavigation&&he||c.props.showTimeSelectOnly)){var ve=["react-datepicker__navigation-icon","react-datepicker__navigation-icon--previous"],Se=["react-datepicker__navigation","react-datepicker__navigation--previous"],xe=c.decreaseMonth;(c.props.showMonthYearPicker||c.props.showQuarterYearPicker||c.props.showYearPicker)&&(xe=c.decreaseYear),he&&c.props.showDisabledMonthNavigation&&(Se.push("react-datepicker__navigation--previous--disabled"),xe=void 0);var Ae=c.props.showMonthYearPicker||c.props.showQuarterYearPicker||c.props.showYearPicker,Re=c.props,He=Re.previousMonthButtonLabel,rt=He===void 0?g.defaultProps.previousMonthButtonLabel:He,ht=Re.previousYearButtonLabel,tt=ht===void 0?g.defaultProps.previousYearButtonLabel:ht,at=c.props,Lt=at.previousMonthAriaLabel,Ve=Lt===void 0?typeof rt=="string"?rt:"Previous Month":Lt,Tt=at.previousYearAriaLabel,qt=Tt===void 0?typeof tt=="string"?tt:"Previous Year":Tt;return Qt.createElement("button",{type:"button",className:Se.join(" "),onClick:xe,onKeyDown:c.props.handleOnKeyDown,"aria-label":Ae?qt:Ve},Qt.createElement("span",{className:ve.join(" ")},Ae?tt:rt))}}},c.increaseYear=function(){c.setState(function(_){var A,N=_.date;return{date:Eh(N,c.props.showYearPicker?(A=c.props.yearItemNumber)!==null&&A!==void 0?A:g.defaultProps.yearItemNumber:1)}},function(){return c.handleYearChange(c.state.date)})},c.renderNextButton=function(){var _;if(!c.props.renderCustomHeader){var A;switch(!0){case c.props.showMonthYearPicker:A=JS(c.state.date,c.props);break;case c.props.showYearPicker:A=wR(c.state.date,c.props);break;case c.props.showQuarterYearPicker:A=xR(c.state.date,c.props);break;default:A=ZS(c.state.date,c.props);break}if(!(!((_=c.props.forceShowMonthNavigation)!==null&&_!==void 0?_:g.defaultProps.forceShowMonthNavigation)&&!c.props.showDisabledMonthNavigation&&A||c.props.showTimeSelectOnly)){var N=["react-datepicker__navigation","react-datepicker__navigation--next"],r=["react-datepicker__navigation-icon","react-datepicker__navigation-icon--next"];c.props.showTimeSelect&&N.push("react-datepicker__navigation--next--with-time"),c.props.todayButton&&N.push("react-datepicker__navigation--next--with-today-button");var W=c.increaseMonth;(c.props.showMonthYearPicker||c.props.showQuarterYearPicker||c.props.showYearPicker)&&(W=c.increaseYear),A&&c.props.showDisabledMonthNavigation&&(N.push("react-datepicker__navigation--next--disabled"),W=void 0);var ie=c.props.showMonthYearPicker||c.props.showQuarterYearPicker||c.props.showYearPicker,oe=c.props,he=oe.nextMonthButtonLabel,ve=he===void 0?g.defaultProps.nextMonthButtonLabel:he,Se=oe.nextYearButtonLabel,xe=Se===void 0?g.defaultProps.nextYearButtonLabel:Se,Ae=c.props,Re=Ae.nextMonthAriaLabel,He=Re===void 0?typeof ve=="string"?ve:"Next Month":Re,rt=Ae.nextYearAriaLabel,ht=rt===void 0?typeof xe=="string"?xe:"Next Year":rt;return Qt.createElement("button",{type:"button",className:N.join(" "),onClick:W,onKeyDown:c.props.handleOnKeyDown,"aria-label":ie?ht:He},Qt.createElement("span",{className:r.join(" ")},ie?xe:ve))}}},c.renderCurrentMonth=function(_){_===void 0&&(_=c.state.date);var A=["react-datepicker__current-month"];return c.props.showYearDropdown&&A.push("react-datepicker__current-month--hasYearDropdown"),c.props.showMonthDropdown&&A.push("react-datepicker__current-month--hasMonthDropdown"),c.props.showMonthYearDropdown&&A.push("react-datepicker__current-month--hasMonthYearDropdown"),Qt.createElement("h2",{className:A.join(" ")},vs(_,c.props.dateFormat,c.props.locale))},c.renderYearDropdown=function(_){if(_===void 0&&(_=!1),!(!c.props.showYearDropdown||_))return Qt.createElement($R,mn({},g.defaultProps,c.props,{date:c.state.date,onChange:c.changeYear,year:Zr(c.state.date)}))},c.renderMonthDropdown=function(_){if(_===void 0&&(_=!1),!(!c.props.showMonthDropdown||_))return Qt.createElement(RR,mn({},g.defaultProps,c.props,{month:Ta(c.state.date),onChange:c.changeMonth}))},c.renderMonthYearDropdown=function(_){if(_===void 0&&(_=!1),!(!c.props.showMonthYearDropdown||_))return Qt.createElement(BR,mn({},g.defaultProps,c.props,{date:c.state.date,onChange:c.changeMonthYear}))},c.handleTodayButtonClick=function(_){c.props.onSelect(HS(),_),c.props.setPreSelection&&c.props.setPreSelection(HS())},c.renderTodayButton=function(){if(!(!c.props.todayButton||c.props.showTimeSelectOnly))return Qt.createElement("div",{className:"react-datepicker__today-button",onClick:c.handleTodayButtonClick},c.props.todayButton)},c.renderDefaultHeader=function(_){var A=_.monthDate,N=_.i;return Qt.createElement("div",{className:"react-datepicker__header ".concat(c.props.showTimeSelect?"react-datepicker__header--has-time-select":"")},c.renderCurrentMonth(A),Qt.createElement("div",{className:"react-datepicker__header__dropdown react-datepicker__header__dropdown--".concat(c.props.dropdownMode),onFocus:c.handleDropdownFocus},c.renderMonthDropdown(N!==0),c.renderMonthYearDropdown(N!==0),c.renderYearDropdown(N!==0)),Qt.createElement("div",{className:"react-datepicker__day-names"},c.header(A)))},c.renderCustomHeader=function(_){var A,N,r=_.monthDate,W=_.i;if(c.props.showTimeSelect&&!c.state.monthContainer||c.props.showTimeSelectOnly)return null;var ie=XS(c.state.date,c.props),oe=ZS(c.state.date,c.props),he=KS(c.state.date,c.props),ve=JS(c.state.date,c.props),Se=!c.props.showMonthYearPicker&&!c.props.showQuarterYearPicker&&!c.props.showYearPicker;return Qt.createElement("div",{className:"react-datepicker__header react-datepicker__header--custom",onFocus:c.props.onDropdownFocus},(N=(A=c.props).renderCustomHeader)===null||N===void 0?void 0:N.call(A,mn(mn({},c.state),{customHeaderCount:W,monthDate:r,changeMonth:c.changeMonth,changeYear:c.changeYear,decreaseMonth:c.decreaseMonth,increaseMonth:c.increaseMonth,decreaseYear:c.decreaseYear,increaseYear:c.increaseYear,prevMonthButtonDisabled:ie,nextMonthButtonDisabled:oe,prevYearButtonDisabled:he,nextYearButtonDisabled:ve})),Se&&Qt.createElement("div",{className:"react-datepicker__day-names"},c.header(r)))},c.renderYearHeader=function(_){var A=_.monthDate,N=c.props,r=N.showYearPicker,W=N.yearItemNumber,ie=W===void 0?g.defaultProps.yearItemNumber:W,oe=zd(A,ie),he=oe.startPeriod,ve=oe.endPeriod;return Qt.createElement("div",{className:"react-datepicker__header react-datepicker-year-header"},r?"".concat(he," - ").concat(ve):Zr(A))},c.renderHeader=function(_){var A=_.monthDate,N=_.i,r=N===void 0?0:N,W={monthDate:A,i:r};switch(!0){case c.props.renderCustomHeader!==void 0:return c.renderCustomHeader(W);case(c.props.showMonthYearPicker||c.props.showQuarterYearPicker||c.props.showYearPicker):return c.renderYearHeader(W);default:return c.renderDefaultHeader(W)}},c.renderMonths=function(){var _,A;if(!(c.props.showTimeSelectOnly||c.props.showYearPicker)){for(var N=[],r=(_=c.props.monthsShown)!==null&&_!==void 0?_:g.defaultProps.monthsShown,W=c.props.showPreviousMonths?r-1:0,ie=c.props.showMonthYearPicker||c.props.showQuarterYearPicker?Eh(c.state.date,W):lf(c.state.date,W),oe=(A=c.props.monthSelectedIn)!==null&&A!==void 0?A:W,he=0;he<r;++he){var ve=he-oe+W,Se=c.props.showMonthYearPicker||c.props.showQuarterYearPicker?Eh(ie,ve):Fc(ie,ve),xe="month-".concat(he),Ae=he<r-1,Re=he>0;N.push(Qt.createElement("div",{key:xe,ref:function(He){c.monthContainer=He??void 0},className:"react-datepicker__month-container"},c.renderHeader({monthDate:Se,i:he}),Qt.createElement(OR,mn({},g.defaultProps,c.props,{containerRef:c.containerRef,ariaLabelPrefix:c.props.monthAriaLabelPrefix,day:Se,onDayClick:c.handleDayClick,handleOnKeyDown:c.props.handleOnDayKeyDown,handleOnMonthKeyDown:c.props.handleOnKeyDown,onDayMouseEnter:c.handleDayMouseEnter,onMouseLeave:c.handleMonthMouseLeave,orderInDisplay:he,selectingDate:c.state.selectingDate,monthShowsDuplicateDaysEnd:Ae,monthShowsDuplicateDaysStart:Re}))))}return N}},c.renderYears=function(){if(!c.props.showTimeSelectOnly&&c.props.showYearPicker)return Qt.createElement("div",{className:"react-datepicker__year--container"},c.renderHeader({monthDate:c.state.date}),Qt.createElement(VR,mn({},g.defaultProps,c.props,{selectingDate:c.state.selectingDate,date:c.state.date,onDayClick:c.handleDayClick,clearSelectingDate:c.clearSelectingDate,onYearMouseEnter:c.handleYearMouseEnter,onYearMouseLeave:c.handleYearMouseLeave})))},c.renderTimeSection=function(){if(c.props.showTimeSelect&&(c.state.monthContainer||c.props.showTimeSelectOnly))return Qt.createElement(NR,mn({},g.defaultProps,c.props,{onChange:c.props.onTimeChange,format:c.props.timeFormat,intervals:c.props.timeIntervals,monthRef:c.state.monthContainer}))},c.renderInputTimeSection=function(){var _=c.props.selected?new Date(c.props.selected):void 0,A=_&&b0(_)&&!!c.props.selected,N=A?"".concat(eT(_.getHours()),":").concat(eT(_.getMinutes())):"";if(c.props.showTimeInput)return Qt.createElement(AR,mn({},g.defaultProps,c.props,{date:_,timeString:N,onChange:c.props.onTimeChange}))},c.renderAriaLiveRegion=function(){var _,A=zd(c.state.date,(_=c.props.yearItemNumber)!==null&&_!==void 0?_:g.defaultProps.yearItemNumber),N=A.startPeriod,r=A.endPeriod,W;return c.props.showYearPicker?W="".concat(N," - ").concat(r):c.props.showMonthYearPicker||c.props.showQuarterYearPicker?W=Zr(c.state.date):W="".concat(tb(Ta(c.state.date),c.props.locale)," ").concat(Zr(c.state.date)),Qt.createElement("span",{role:"alert","aria-live":"polite",className:"react-datepicker__aria-live"},c.state.isRenderAriaLiveMessage&&W)},c.renderChildren=function(){if(c.props.children)return Qt.createElement("div",{className:"react-datepicker__children-container"},c.props.children)},c.containerRef=Xe.createRef(),c.state={date:c.getDateInView(),selectingDate:void 0,monthContainer:void 0,isRenderAriaLiveMessage:!1},c}return Object.defineProperty(g,"defaultProps",{get:function(){return{monthsShown:1,forceShowMonthNavigation:!1,timeCaption:"Time",previousYearButtonLabel:"Previous Year",nextYearButtonLabel:"Next Year",previousMonthButtonLabel:"Previous Month",nextMonthButtonLabel:"Next Month",yearItemNumber:a_}},enumerable:!1,configurable:!0}),g.prototype.componentDidMount=function(){var a=this;this.props.showTimeSelect&&(this.assignMonthContainer=function(){a.setState({monthContainer:a.monthContainer})}())},g.prototype.componentDidUpdate=function(a){var c=this;if(this.props.preSelection&&(!fn(this.props.preSelection,a.preSelection)||this.props.monthSelectedIn!==a.monthSelectedIn)){var _=!wa(this.state.date,this.props.preSelection);this.setState({date:this.props.preSelection},function(){return _&&c.handleCustomMonthChange(c.state.date)})}else this.props.openToDate&&!fn(this.props.openToDate,a.openToDate)&&this.setState({date:this.props.openToDate})},g.prototype.render=function(){var a=this.props.container||oR;return Qt.createElement(x0,{onClickOutside:this.handleClickOutside,style:{display:"contents"},ignoreClass:this.props.outsideClickIgnoreClass},Qt.createElement("div",{style:{display:"contents"},ref:this.containerRef},Qt.createElement(a,{className:gn("react-datepicker",this.props.className,{"react-datepicker--time-only":this.props.showTimeSelectOnly}),showTime:this.props.showTimeSelect||this.props.showTimeInput,showTimeSelectOnly:this.props.showTimeSelectOnly},this.renderAriaLiveRegion(),this.renderPreviousButton(),this.renderNextButton(),this.renderMonths(),this.renderYears(),this.renderTodayButton(),this.renderTimeSection(),this.renderInputTimeSection(),this.renderChildren())))},g}(Xe.Component),qR=function(m){var g=m.icon,a=m.className,c=a===void 0?"":a,_=m.onClick,A="react-datepicker__calendar-icon";if(typeof g=="string")return Qt.createElement("i",{className:"".concat(A," ").concat(g," ").concat(c),"aria-hidden":"true",onClick:_});if(Qt.isValidElement(g)){var N=g;return Qt.cloneElement(N,{className:"".concat(N.props.className||""," ").concat(A," ").concat(c),onClick:function(r){typeof N.props.onClick=="function"&&N.props.onClick(r),typeof _=="function"&&_(r)}})}return Qt.createElement("svg",{className:"".concat(A," ").concat(c),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",onClick:_},Qt.createElement("path",{d:"M96 32V64H48C21.5 64 0 85.5 0 112v48H448V112c0-26.5-21.5-48-48-48H352V32c0-17.7-14.3-32-32-32s-32 14.3-32 32V64H160V32c0-17.7-14.3-32-32-32S96 14.3 96 32zM448 192H0V464c0 26.5 21.5 48 48 48H400c26.5 0 48-21.5 48-48V192z"}))},fM=function(m){Ao(g,m);function g(a){var c=m.call(this,a)||this;return c.portalRoot=null,c.el=document.createElement("div"),c}return g.prototype.componentDidMount=function(){this.portalRoot=(this.props.portalHost||document).getElementById(this.props.portalId),this.portalRoot||(this.portalRoot=document.createElement("div"),this.portalRoot.setAttribute("id",this.props.portalId),(this.props.portalHost||document.body).appendChild(this.portalRoot)),this.portalRoot.appendChild(this.el)},g.prototype.componentWillUnmount=function(){this.portalRoot&&this.portalRoot.removeChild(this.el)},g.prototype.render=function(){return lA.createPortal(this.props.children,this.el)},g}(Xe.Component),YR="[tabindex], a, button, input, select, textarea",XR=function(m){return(m instanceof HTMLAnchorElement||!m.disabled)&&m.tabIndex!==-1},mM=function(m){Ao(g,m);function g(a){var c=m.call(this,a)||this;return c.getTabChildren=function(){var _;return Array.prototype.slice.call((_=c.tabLoopRef.current)===null||_===void 0?void 0:_.querySelectorAll(YR),1,-1).filter(XR)},c.handleFocusStart=function(){var _=c.getTabChildren();_&&_.length>1&&_[_.length-1].focus()},c.handleFocusEnd=function(){var _=c.getTabChildren();_&&_.length>1&&_[0].focus()},c.tabLoopRef=Xe.createRef(),c}return g.prototype.render=function(){var a;return((a=this.props.enableTabLoop)!==null&&a!==void 0?a:g.defaultProps.enableTabLoop)?Qt.createElement("div",{className:"react-datepicker__tab-loop",ref:this.tabLoopRef},Qt.createElement("div",{className:"react-datepicker__tab-loop__start",tabIndex:0,onFocus:this.handleFocusStart}),this.props.children,Qt.createElement("div",{className:"react-datepicker__tab-loop__end",tabIndex:0,onFocus:this.handleFocusEnd})):this.props.children},g.defaultProps={enableTabLoop:!0},g}(Xe.Component);function ZR(m){var g=function(a){var c,_=typeof a.hidePopper=="boolean"?a.hidePopper:!0,A=Xe.useRef(null),N=sR(mn({open:!_,whileElementsMounted:v2,placement:a.popperPlacement,middleware:Bu([HL({padding:15}),$L(10),GL({element:A})],(c=a.popperModifiers)!==null&&c!==void 0?c:[],!0)},a.popperProps)),r=mn(mn({},a),{hidePopper:_,popperProps:mn(mn({},N),{arrowRef:A})});return Qt.createElement(m,mn({},r))};return g}var KR=function(m){Ao(g,m);function g(){return m!==null&&m.apply(this,arguments)||this}return Object.defineProperty(g,"defaultProps",{get:function(){return{hidePopper:!0}},enumerable:!1,configurable:!0}),g.prototype.render=function(){var a=this.props,c=a.className,_=a.wrapperClassName,A=a.hidePopper,N=A===void 0?g.defaultProps.hidePopper:A,r=a.popperComponent,W=a.targetComponent,ie=a.enableTabLoop,oe=a.popperOnKeyDown,he=a.portalId,ve=a.portalHost,Se=a.popperProps,xe=a.showArrow,Ae=void 0;if(!N){var Re=gn("react-datepicker-popper",c);Ae=Qt.createElement(mM,{enableTabLoop:ie},Qt.createElement("div",{ref:Se.refs.setFloating,style:Se.floatingStyles,className:Re,"data-placement":Se.placement,onKeyDown:oe},r,xe&&Qt.createElement(JL,{ref:Se.arrowRef,context:Se.context,fill:"currentColor",strokeWidth:1,height:8,width:16,style:{transform:"translateY(-1px)"},className:"react-datepicker__triangle"})))}this.props.popperContainer&&(Ae=Xe.createElement(this.props.popperContainer,{},Ae)),he&&!N&&(Ae=Qt.createElement(fM,{portalId:he,portalHost:ve},Ae));var He=gn("react-datepicker-wrapper",_);return Qt.createElement(Qt.Fragment,null,Qt.createElement("div",{ref:Se.refs.setReference,className:He},W),Ae)},g}(Xe.Component),JR=ZR(KR),oT="react-datepicker-ignore-onclickoutside";function QR(m,g){return m&&g?Ta(m)!==Ta(g)||Zr(m)!==Zr(g):m!==g}var ax="Date input not valid.",aT=function(m){Ao(g,m);function g(a){var c=m.call(this,a)||this;return c.calendar=null,c.input=null,c.getPreSelection=function(){return c.props.openToDate?c.props.openToDate:c.props.selectsEnd&&c.props.startDate?c.props.startDate:c.props.selectsStart&&c.props.endDate?c.props.endDate:Cn()},c.modifyHolidays=function(){var _;return(_=c.props.holidays)===null||_===void 0?void 0:_.reduce(function(A,N){var r=new Date(N.date);return b0(r)?Bu(Bu([],A,!0),[mn(mn({},N),{date:r})],!1):A},[])},c.calcInitialState=function(){var _,A=c.getPreSelection(),N=hM(c.props),r=dM(c.props),W=N&&df(A,ky(N))?N:r&&Vd(A,GS(r))?r:A;return{open:c.props.startOpen||!1,preventFocus:!1,inputValue:null,preSelection:(_=c.props.selectsRange?c.props.startDate:c.props.selected)!==null&&_!==void 0?_:W,highlightDates:QS(c.props.highlightDates),focused:!1,shouldFocusDayInline:!1,isRenderAriaLiveMessage:!1,wasHidden:!1}},c.resetHiddenStatus=function(){c.setState(mn(mn({},c.state),{wasHidden:!1}))},c.setHiddenStatus=function(){c.setState(mn(mn({},c.state),{wasHidden:!0}))},c.setHiddenStateOnVisibilityHidden=function(){document.visibilityState==="hidden"&&c.setHiddenStatus()},c.clearPreventFocusTimeout=function(){c.preventFocusTimeout&&clearTimeout(c.preventFocusTimeout)},c.setFocus=function(){var _,A;(A=(_=c.input)===null||_===void 0?void 0:_.focus)===null||A===void 0||A.call(_,{preventScroll:!0})},c.setBlur=function(){var _,A;(A=(_=c.input)===null||_===void 0?void 0:_.blur)===null||A===void 0||A.call(_),c.cancelFocusInput()},c.deferBlur=function(){requestAnimationFrame(function(){c.setBlur()})},c.setOpen=function(_,A){A===void 0&&(A=!1),c.setState({open:_,preSelection:_&&c.state.open?c.state.preSelection:c.calcInitialState().preSelection,lastPreSelectChange:lx},function(){_||c.setState(function(N){return{focused:A?N.focused:!1}},function(){!A&&c.deferBlur(),c.setState({inputValue:null})})})},c.inputOk=function(){return Ah(c.state.preSelection)},c.isCalendarOpen=function(){return c.props.open===void 0?c.state.open&&!c.props.disabled&&!c.props.readOnly:c.props.open},c.handleFocus=function(_){var A,N,r=c.state.wasHidden,W=r?c.state.open:!0;r&&c.resetHiddenStatus(),c.state.preventFocus||((N=(A=c.props).onFocus)===null||N===void 0||N.call(A,_),W&&!c.props.preventOpenOnFocus&&!c.props.readOnly&&c.setOpen(!0)),c.setState({focused:!0})},c.sendFocusBackToInput=function(){c.preventFocusTimeout&&c.clearPreventFocusTimeout(),c.setState({preventFocus:!0},function(){c.preventFocusTimeout=setTimeout(function(){c.setFocus(),c.setState({preventFocus:!1})})})},c.cancelFocusInput=function(){clearTimeout(c.inputFocusTimeout),c.inputFocusTimeout=void 0},c.deferFocusInput=function(){c.cancelFocusInput(),c.inputFocusTimeout=setTimeout(function(){return c.setFocus()},1)},c.handleDropdownFocus=function(){c.cancelFocusInput()},c.handleBlur=function(_){var A,N;(!c.state.open||c.props.withPortal||c.props.showTimeInput)&&((N=(A=c.props).onBlur)===null||N===void 0||N.call(A,_)),c.state.open&&c.props.open===!1&&c.setOpen(!1),c.setState({focused:!1})},c.handleCalendarClickOutside=function(_){var A,N;c.props.inline||c.setOpen(!1),(N=(A=c.props).onClickOutside)===null||N===void 0||N.call(A,_),c.props.withPortal&&_.preventDefault()},c.handleChange=function(){for(var _,A,N,r,W,ie=[],oe=0;oe<arguments.length;oe++)ie[oe]=arguments[oe];var he=ie[0];if(!(c.props.onChangeRaw&&(c.props.onChangeRaw.apply(c,ie),!he||typeof he.isDefaultPrevented!="function"||he.isDefaultPrevented()))){c.setState({inputValue:(he==null?void 0:he.target)instanceof HTMLInputElement?he.target.value:null,lastPreSelectChange:e3});var ve=c.props,Se=ve.selectsRange,xe=ve.startDate,Ae=ve.endDate,Re=(_=c.props.dateFormat)!==null&&_!==void 0?_:g.defaultProps.dateFormat,He=(A=c.props.strictParsing)!==null&&A!==void 0?A:g.defaultProps.strictParsing,rt=(he==null?void 0:he.target)instanceof HTMLInputElement?he.target.value:"";if(Se){var ht=rt.split("-",2).map(function(gt){return gt.trim()}),tt=ht[0],at=ht[1],Lt=nx(tt??"",Re,c.props.locale,He),Ve=nx(at??"",Re,c.props.locale,He),Tt=(xe==null?void 0:xe.getTime())!==(Lt==null?void 0:Lt.getTime()),qt=(Ae==null?void 0:Ae.getTime())!==(Ve==null?void 0:Ve.getTime());if(!Tt&&!qt||Lt&&Yl(Lt,c.props)||Ve&&Yl(Ve,c.props))return;(r=(N=c.props).onChange)===null||r===void 0||r.call(N,[Lt,Ve],he)}else{var Me=nx(rt,Re,c.props.locale,He,(W=c.props.selected)!==null&&W!==void 0?W:void 0);(Me||!rt)&&c.setSelected(Me,he,!0)}}},c.handleSelect=function(_,A,N){if(c.props.shouldCloseOnSelect&&!c.props.showTimeSelect&&c.sendFocusBackToInput(),c.props.onChangeRaw&&c.props.onChangeRaw(A),c.setSelected(_,A,!1,N),c.props.showDateSelect&&c.setState({isRenderAriaLiveMessage:!0}),!c.props.shouldCloseOnSelect||c.props.showTimeSelect)c.setPreSelection(_);else if(!c.props.inline){c.props.selectsRange||c.setOpen(!1);var r=c.props,W=r.startDate,ie=r.endDate;W&&!ie&&(c.props.swapRange||!rT(_,W))&&c.setOpen(!1)}},c.setSelected=function(_,A,N,r){var W,ie,oe=_;if(c.props.showYearPicker){if(oe!==null&&Oy(Zr(oe),c.props))return}else if(c.props.showMonthYearPicker){if(oe!==null&&uM(oe,c.props))return}else if(oe!==null&&Yl(oe,c.props))return;var he=c.props,ve=he.onChange,Se=he.selectsRange,xe=he.startDate,Ae=he.endDate,Re=he.selectsMultiple,He=he.selectedDates,rt=he.minTime,ht=he.swapRange;if(!nf(c.props.selected,oe)||c.props.allowSameDay||Se||Re)if(oe!==null&&(c.props.selected&&(!N||!c.props.showTimeSelect&&!c.props.showTimeSelectOnly&&!c.props.showTimeInput)&&(oe=sx(oe,{hour:Ph(c.props.selected),minute:Dh(c.props.selected),second:Fd(c.props.selected)})),!N&&(c.props.showTimeSelect||c.props.showTimeSelectOnly)&&rt&&(oe=sx(oe,{hour:rt.getHours(),minute:rt.getMinutes(),second:rt.getSeconds()})),c.props.inline||c.setState({preSelection:oe}),c.props.focusSelectedMonth||c.setState({monthSelectedIn:r})),Se){var tt=!xe&&!Ae,at=xe&&!Ae,Lt=xe&&Ae;tt?ve==null||ve([oe,null],A):at&&(oe===null?ve==null||ve([null,null],A):rT(oe,xe)?ht?ve==null||ve([oe,xe],A):ve==null||ve([oe,null],A):ve==null||ve([xe,oe],A)),Lt&&(ve==null||ve([oe,null],A))}else if(Re){if(oe!==null)if(!(He!=null&&He.length))ve==null||ve([oe],A);else{var Ve=He.some(function(qt){return fn(qt,oe)});if(Ve){var Tt=He.filter(function(qt){return!fn(qt,oe)});ve==null||ve(Tt,A)}else ve==null||ve(Bu(Bu([],He,!0),[oe],!1),A)}}else ve==null||ve(oe,A);N||((ie=(W=c.props).onSelect)===null||ie===void 0||ie.call(W,oe,A),c.setState({inputValue:null}))},c.setPreSelection=function(_){var A=Ah(c.props.minDate),N=Ah(c.props.maxDate),r=!0;if(_){var W=ky(_);if(A&&N)r=jg(_,c.props.minDate,c.props.maxDate);else if(A){var ie=ky(c.props.minDate);r=Vd(_,ie)||nf(W,ie)}else if(N){var oe=GS(c.props.maxDate);r=df(_,oe)||nf(W,oe)}}r&&c.setState({preSelection:_})},c.toggleCalendar=function(){c.setOpen(!c.state.open)},c.handleTimeChange=function(_){var A,N;if(!(c.props.selectsRange||c.props.selectsMultiple)){var r=c.props.selected?c.props.selected:c.getPreSelection(),W=c.props.selected?_:sx(r,{hour:Ph(_),minute:Dh(_)});c.setState({preSelection:W}),(N=(A=c.props).onChange)===null||N===void 0||N.call(A,W),c.props.shouldCloseOnSelect&&!c.props.showTimeInput&&(c.sendFocusBackToInput(),c.setOpen(!1)),c.props.showTimeInput&&c.setOpen(!0),(c.props.showTimeSelectOnly||c.props.showTimeSelect)&&c.setState({isRenderAriaLiveMessage:!0}),c.setState({inputValue:null})}},c.onInputClick=function(){var _,A;!c.props.disabled&&!c.props.readOnly&&c.setOpen(!0),(A=(_=c.props).onInputClick)===null||A===void 0||A.call(_)},c.onInputKeyDown=function(_){var A,N,r,W,ie,oe;(N=(A=c.props).onKeyDown)===null||N===void 0||N.call(A,_);var he=_.key;if(!c.state.open&&!c.props.inline&&!c.props.preventOpenOnFocus){(he===Ui.ArrowDown||he===Ui.ArrowUp||he===Ui.Enter)&&((r=c.onInputClick)===null||r===void 0||r.call(c));return}if(c.state.open){if(he===Ui.ArrowDown||he===Ui.ArrowUp){_.preventDefault();var ve=c.props.showTimeSelectOnly?".react-datepicker__time-list-item[tabindex='0']":c.props.showWeekPicker&&c.props.showWeekNumbers?'.react-datepicker__week-number[tabindex="0"]':c.props.showFullMonthYearPicker||c.props.showMonthYearPicker?'.react-datepicker__month-text[tabindex="0"]':'.react-datepicker__day[tabindex="0"]',Se=((W=c.calendar)===null||W===void 0?void 0:W.containerRef.current)instanceof Element&&c.calendar.containerRef.current.querySelector(ve);Se instanceof HTMLElement&&Se.focus({preventScroll:!0});return}var xe=Cn(c.state.preSelection);he===Ui.Enter?(_.preventDefault(),_.target.blur(),c.inputOk()&&c.state.lastPreSelectChange===lx?(c.handleSelect(xe,_),!c.props.shouldCloseOnSelect&&c.setPreSelection(xe)):c.setOpen(!1)):he===Ui.Escape?(_.preventDefault(),_.target.blur(),c.sendFocusBackToInput(),c.setOpen(!1)):he===Ui.Tab&&c.setOpen(!1),c.inputOk()||(oe=(ie=c.props).onInputError)===null||oe===void 0||oe.call(ie,{code:1,msg:ax})}},c.onPortalKeyDown=function(_){var A=_.key;A===Ui.Escape&&(_.preventDefault(),c.setState({preventFocus:!0},function(){c.setOpen(!1),setTimeout(function(){c.setFocus(),c.setState({preventFocus:!1})})}))},c.onDayKeyDown=function(_){var A,N,r,W,ie,oe,he=c.props,ve=he.minDate,Se=he.maxDate,xe=he.disabledKeyboardNavigation,Ae=he.showWeekPicker,Re=he.shouldCloseOnSelect,He=he.locale,rt=he.calendarStartDay,ht=he.adjustDateOnChange,tt=he.inline;if((N=(A=c.props).onKeyDown)===null||N===void 0||N.call(A,_),!xe){var at=_.key,Lt=_.shiftKey,Ve=Cn(c.state.preSelection),Tt=function(Mt,zt){var ii=zt;switch(Mt){case Ui.ArrowRight:ii=Ae?Zy(zt,1):zc(zt,1);break;case Ui.ArrowLeft:ii=Ae?NS(zt):TL(zt);break;case Ui.ArrowUp:ii=NS(zt);break;case Ui.ArrowDown:ii=Zy(zt,1);break;case Ui.PageUp:ii=Lt?Om(zt,1):lf(zt,1);break;case Ui.PageDown:ii=Lt?Eh(zt,1):Fc(zt,1);break;case Ui.Home:ii=Bd(zt,He,rt);break;case Ui.End:ii=dR(zt);break}return ii},qt=function(Mt,zt){for(var ii=40,Yt=Mt,jt=!1,Ri=0,Yi=Tt(Mt,zt);!jt;){if(Ri>=ii){Yi=zt;break}ve&&Yi<ve&&(Yt=Ui.ArrowRight,Yi=Yl(ve,c.props)?Tt(Yt,Yi):ve),Se&&Yi>Se&&(Yt=Ui.ArrowLeft,Yi=Yl(Se,c.props)?Tt(Yt,Yi):Se),Yl(Yi,c.props)?((Yt===Ui.PageUp||Yt===Ui.Home)&&(Yt=Ui.ArrowRight),(Yt===Ui.PageDown||Yt===Ui.End)&&(Yt=Ui.ArrowLeft),Yi=Tt(Yt,Yi)):jt=!0,Ri++}return Yi};if(at===Ui.Enter){_.preventDefault(),c.handleSelect(Ve,_),!Re&&c.setPreSelection(Ve);return}else if(at===Ui.Escape){_.preventDefault(),c.setOpen(!1),c.inputOk()||(W=(r=c.props).onInputError)===null||W===void 0||W.call(r,{code:1,msg:ax});return}var Me=null;switch(at){case Ui.ArrowLeft:case Ui.ArrowRight:case Ui.ArrowUp:case Ui.ArrowDown:case Ui.PageUp:case Ui.PageDown:case Ui.Home:case Ui.End:Me=qt(at,Ve);break}if(!Me){(oe=(ie=c.props).onInputError)===null||oe===void 0||oe.call(ie,{code:1,msg:ax});return}if(_.preventDefault(),c.setState({lastPreSelectChange:lx}),ht&&c.setSelected(Me),c.setPreSelection(Me),tt){var gt=Ta(Ve),oi=Ta(Me),Ti=Zr(Ve),ni=Zr(Me);gt!==oi||Ti!==ni?c.setState({shouldFocusDayInline:!0}):c.setState({shouldFocusDayInline:!1})}}},c.onPopperKeyDown=function(_){var A=_.key;A===Ui.Escape&&(_.preventDefault(),c.sendFocusBackToInput())},c.onClearClick=function(_){_&&_.preventDefault&&_.preventDefault(),c.sendFocusBackToInput();var A=c.props,N=A.selectsRange,r=A.onChange;N?r==null||r([null,null],_):r==null||r(null,_),c.setState({inputValue:null})},c.clear=function(){c.onClearClick()},c.onScroll=function(_){typeof c.props.closeOnScroll=="boolean"&&c.props.closeOnScroll?(_.target===document||_.target===document.documentElement||_.target===document.body)&&c.setOpen(!1):typeof c.props.closeOnScroll=="function"&&c.props.closeOnScroll(_)&&c.setOpen(!1)},c.renderCalendar=function(){var _,A;return!c.props.inline&&!c.isCalendarOpen()?null:Qt.createElement(WR,mn({showMonthYearDropdown:void 0,ref:function(N){c.calendar=N}},c.props,c.state,{setOpen:c.setOpen,dateFormat:(_=c.props.dateFormatCalendar)!==null&&_!==void 0?_:g.defaultProps.dateFormatCalendar,onSelect:c.handleSelect,onClickOutside:c.handleCalendarClickOutside,holidays:TR(c.modifyHolidays()),outsideClickIgnoreClass:oT,onDropdownFocus:c.handleDropdownFocus,onTimeChange:c.handleTimeChange,className:c.props.calendarClassName,container:c.props.calendarContainer,handleOnKeyDown:c.props.onKeyDown,handleOnDayKeyDown:c.onDayKeyDown,setPreSelection:c.setPreSelection,dropdownMode:(A=c.props.dropdownMode)!==null&&A!==void 0?A:g.defaultProps.dropdownMode}),c.props.children)},c.renderAriaLiveRegion=function(){var _=c.props,A=_.dateFormat,N=A===void 0?g.defaultProps.dateFormat:A,r=_.locale,W=c.props.showTimeInput||c.props.showTimeSelect,ie=W?"PPPPp":"PPPP",oe;return c.props.selectsRange?oe="Selected start date: ".concat(Gl(c.props.startDate,{dateFormat:ie,locale:r}),". ").concat(c.props.endDate?"End date: "+Gl(c.props.endDate,{dateFormat:ie,locale:r}):""):c.props.showTimeSelectOnly?oe="Selected time: ".concat(Gl(c.props.selected,{dateFormat:N,locale:r})):c.props.showYearPicker?oe="Selected year: ".concat(Gl(c.props.selected,{dateFormat:"yyyy",locale:r})):c.props.showMonthYearPicker?oe="Selected month: ".concat(Gl(c.props.selected,{dateFormat:"MMMM yyyy",locale:r})):c.props.showQuarterYearPicker?oe="Selected quarter: ".concat(Gl(c.props.selected,{dateFormat:"yyyy, QQQ",locale:r})):oe="Selected date: ".concat(Gl(c.props.selected,{dateFormat:ie,locale:r})),Qt.createElement("span",{role:"alert","aria-live":"polite",className:"react-datepicker__aria-live"},oe)},c.renderDateInput=function(){var _,A,N,r=gn(c.props.className,(_={},_[oT]=c.state.open,_)),W=c.props.customInput||Qt.createElement("input",{type:"text"}),ie=c.props.customInputRef||"ref",oe=c.props,he=oe.dateFormat,ve=he===void 0?g.defaultProps.dateFormat:he,Se=oe.locale,xe=typeof c.props.value=="string"?c.props.value:typeof c.state.inputValue=="string"?c.state.inputValue:c.props.selectsRange?lR(c.props.startDate,c.props.endDate,{dateFormat:ve,locale:Se}):c.props.selectsMultiple?cR((N=c.props.selectedDates)!==null&&N!==void 0?N:[],{dateFormat:ve,locale:Se}):Gl(c.props.selected,{dateFormat:ve,locale:Se});return Xe.cloneElement(W,(A={},A[ie]=function(Ae){c.input=Ae},A.value=xe,A.onBlur=c.handleBlur,A.onChange=c.handleChange,A.onClick=c.onInputClick,A.onFocus=c.handleFocus,A.onKeyDown=c.onInputKeyDown,A.id=c.props.id,A.name=c.props.name,A.form=c.props.form,A.autoFocus=c.props.autoFocus,A.placeholder=c.props.placeholderText,A.disabled=c.props.disabled,A.autoComplete=c.props.autoComplete,A.className=gn(W.props.className,r),A.title=c.props.title,A.readOnly=c.props.readOnly,A.required=c.props.required,A.tabIndex=c.props.tabIndex,A["aria-describedby"]=c.props.ariaDescribedBy,A["aria-invalid"]=c.props.ariaInvalid,A["aria-labelledby"]=c.props.ariaLabelledBy,A["aria-required"]=c.props.ariaRequired,A))},c.renderClearButton=function(){var _=c.props,A=_.isClearable,N=_.disabled,r=_.selected,W=_.startDate,ie=_.endDate,oe=_.clearButtonTitle,he=_.clearButtonClassName,ve=he===void 0?"":he,Se=_.ariaLabelClose,xe=Se===void 0?"Close":Se,Ae=_.selectedDates;return A&&(r!=null||W!=null||ie!=null||Ae!=null&&Ae.length)?Qt.createElement("button",{type:"button",className:gn("react-datepicker__close-icon",ve,{"react-datepicker__close-icon--disabled":N}),disabled:N,"aria-label":xe,onClick:c.onClearClick,title:oe,tabIndex:-1}):null},c.state=c.calcInitialState(),c.preventFocusTimeout=void 0,c}return Object.defineProperty(g,"defaultProps",{get:function(){return{allowSameDay:!1,dateFormat:"MM/dd/yyyy",dateFormatCalendar:"LLLL yyyy",disabled:!1,disabledKeyboardNavigation:!1,dropdownMode:"scroll",preventOpenOnFocus:!1,monthsShown:1,readOnly:!1,withPortal:!1,selectsDisabledDaysInRange:!1,shouldCloseOnSelect:!0,showTimeSelect:!1,showTimeInput:!1,showPreviousMonths:!1,showMonthYearPicker:!1,showFullMonthYearPicker:!1,showTwoColumnMonthYearPicker:!1,showFourColumnMonthYearPicker:!1,showYearPicker:!1,showQuarterYearPicker:!1,showWeekPicker:!1,strictParsing:!1,swapRange:!1,timeIntervals:30,timeCaption:"Time",previousMonthAriaLabel:"Previous Month",previousMonthButtonLabel:"Previous Month",nextMonthAriaLabel:"Next Month",nextMonthButtonLabel:"Next Month",previousYearAriaLabel:"Previous Year",previousYearButtonLabel:"Previous Year",nextYearAriaLabel:"Next Year",nextYearButtonLabel:"Next Year",timeInputLabel:"Time",enableTabLoop:!0,yearItemNumber:a_,focusSelectedMonth:!1,showPopperArrow:!0,excludeScrollbar:!0,customTimeInput:null,calendarStartDay:void 0,toggleCalendarOnIconClick:!1,usePointerEvent:!1}},enumerable:!1,configurable:!0}),g.prototype.componentDidMount=function(){window.addEventListener("scroll",this.onScroll,!0),document.addEventListener("visibilitychange",this.setHiddenStateOnVisibilityHidden)},g.prototype.componentDidUpdate=function(a,c){var _,A,N,r;a.inline&&QR(a.selected,this.props.selected)&&this.setPreSelection(this.props.selected),this.state.monthSelectedIn!==void 0&&a.monthsShown!==this.props.monthsShown&&this.setState({monthSelectedIn:0}),a.highlightDates!==this.props.highlightDates&&this.setState({highlightDates:QS(this.props.highlightDates)}),!c.focused&&!nf(a.selected,this.props.selected)&&this.setState({inputValue:null}),c.open!==this.state.open&&(c.open===!1&&this.state.open===!0&&((A=(_=this.props).onCalendarOpen)===null||A===void 0||A.call(_)),c.open===!0&&this.state.open===!1&&((r=(N=this.props).onCalendarClose)===null||r===void 0||r.call(N)))},g.prototype.componentWillUnmount=function(){this.clearPreventFocusTimeout(),window.removeEventListener("scroll",this.onScroll,!0),document.removeEventListener("visibilitychange",this.setHiddenStateOnVisibilityHidden)},g.prototype.renderInputContainer=function(){var a=this.props,c=a.showIcon,_=a.icon,A=a.calendarIconClassname,N=a.calendarIconClassName,r=a.toggleCalendarOnIconClick,W=this.state.open;return A&&console.warn("calendarIconClassname props is deprecated. should use calendarIconClassName props."),Qt.createElement("div",{className:"react-datepicker__input-container".concat(c?" react-datepicker__view-calendar-icon":"")},c&&Qt.createElement(qR,mn({icon:_,className:gn(N,!N&&A,W&&"react-datepicker-ignore-onclickoutside")},r?{onClick:this.toggleCalendar}:null)),this.state.isRenderAriaLiveMessage&&this.renderAriaLiveRegion(),this.renderDateInput(),this.renderClearButton())},g.prototype.render=function(){var a=this.renderCalendar();if(this.props.inline)return a;if(this.props.withPortal){var c=this.state.open?Qt.createElement(mM,{enableTabLoop:this.props.enableTabLoop},Qt.createElement("div",{className:"react-datepicker__portal",tabIndex:-1,onKeyDown:this.onPortalKeyDown},a)):null;return this.state.open&&this.props.portalId&&(c=Qt.createElement(fM,mn({portalId:this.props.portalId},this.props),c)),Qt.createElement("div",null,this.renderInputContainer(),c)}return Qt.createElement(JR,mn({},this.props,{className:this.props.popperClassName,hidePopper:!this.isCalendarOpen(),targetComponent:this.renderInputContainer(),popperComponent:a,popperOnKeyDown:this.onPopperKeyDown,showArrow:this.props.showPopperArrow}))},g}(Xe.Component),e3="input",lx="navigate",Ly={exports:{}},t3=Ly.exports,lT;function i3(){return lT||(lT=1,function(m,g){(function(a,c){m.exports=c()})(t3,function(){var a=1e3,c=6e4,_=36e5,A="millisecond",N="second",r="minute",W="hour",ie="day",oe="week",he="month",ve="quarter",Se="year",xe="date",Ae="Invalid Date",Re=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,He=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,rt={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(ni){var Mt=["th","st","nd","rd"],zt=ni%100;return"["+ni+(Mt[(zt-20)%10]||Mt[zt]||Mt[0])+"]"}},ht=function(ni,Mt,zt){var ii=String(ni);return!ii||ii.length>=Mt?ni:""+Array(Mt+1-ii.length).join(zt)+ni},tt={s:ht,z:function(ni){var Mt=-ni.utcOffset(),zt=Math.abs(Mt),ii=Math.floor(zt/60),Yt=zt%60;return(Mt<=0?"+":"-")+ht(ii,2,"0")+":"+ht(Yt,2,"0")},m:function ni(Mt,zt){if(Mt.date()<zt.date())return-ni(zt,Mt);var ii=12*(zt.year()-Mt.year())+(zt.month()-Mt.month()),Yt=Mt.clone().add(ii,he),jt=zt-Yt<0,Ri=Mt.clone().add(ii+(jt?-1:1),he);return+(-(ii+(zt-Yt)/(jt?Yt-Ri:Ri-Yt))||0)},a:function(ni){return ni<0?Math.ceil(ni)||0:Math.floor(ni)},p:function(ni){return{M:he,y:Se,w:oe,d:ie,D:xe,h:W,m:r,s:N,ms:A,Q:ve}[ni]||String(ni||"").toLowerCase().replace(/s$/,"")},u:function(ni){return ni===void 0}},at="en",Lt={};Lt[at]=rt;var Ve="$isDayjsObject",Tt=function(ni){return ni instanceof oi||!(!ni||!ni[Ve])},qt=function ni(Mt,zt,ii){var Yt;if(!Mt)return at;if(typeof Mt=="string"){var jt=Mt.toLowerCase();Lt[jt]&&(Yt=jt),zt&&(Lt[jt]=zt,Yt=jt);var Ri=Mt.split("-");if(!Yt&&Ri.length>1)return ni(Ri[0])}else{var Yi=Mt.name;Lt[Yi]=Mt,Yt=Yi}return!ii&&Yt&&(at=Yt),Yt||!ii&&at},Me=function(ni,Mt){if(Tt(ni))return ni.clone();var zt=typeof Mt=="object"?Mt:{};return zt.date=ni,zt.args=arguments,new oi(zt)},gt=tt;gt.l=qt,gt.i=Tt,gt.w=function(ni,Mt){return Me(ni,{locale:Mt.$L,utc:Mt.$u,x:Mt.$x,$offset:Mt.$offset})};var oi=function(){function ni(zt){this.$L=qt(zt.locale,null,!0),this.parse(zt),this.$x=this.$x||zt.x||{},this[Ve]=!0}var Mt=ni.prototype;return Mt.parse=function(zt){this.$d=function(ii){var Yt=ii.date,jt=ii.utc;if(Yt===null)return new Date(NaN);if(gt.u(Yt))return new Date;if(Yt instanceof Date)return new Date(Yt);if(typeof Yt=="string"&&!/Z$/i.test(Yt)){var Ri=Yt.match(Re);if(Ri){var Yi=Ri[2]-1||0,Wi=(Ri[7]||"0").substring(0,3);return jt?new Date(Date.UTC(Ri[1],Yi,Ri[3]||1,Ri[4]||0,Ri[5]||0,Ri[6]||0,Wi)):new Date(Ri[1],Yi,Ri[3]||1,Ri[4]||0,Ri[5]||0,Ri[6]||0,Wi)}}return new Date(Yt)}(zt),this.init()},Mt.init=function(){var zt=this.$d;this.$y=zt.getFullYear(),this.$M=zt.getMonth(),this.$D=zt.getDate(),this.$W=zt.getDay(),this.$H=zt.getHours(),this.$m=zt.getMinutes(),this.$s=zt.getSeconds(),this.$ms=zt.getMilliseconds()},Mt.$utils=function(){return gt},Mt.isValid=function(){return this.$d.toString()!==Ae},Mt.isSame=function(zt,ii){var Yt=Me(zt);return this.startOf(ii)<=Yt&&Yt<=this.endOf(ii)},Mt.isAfter=function(zt,ii){return Me(zt)<this.startOf(ii)},Mt.isBefore=function(zt,ii){return this.endOf(ii)<Me(zt)},Mt.$g=function(zt,ii,Yt){return gt.u(zt)?this[ii]:this.set(Yt,zt)},Mt.unix=function(){return Math.floor(this.valueOf()/1e3)},Mt.valueOf=function(){return this.$d.getTime()},Mt.startOf=function(zt,ii){var Yt=this,jt=!!gt.u(ii)||ii,Ri=gt.p(zt),Yi=function(es,Ye){var ds=gt.w(Yt.$u?Date.UTC(Yt.$y,Ye,es):new Date(Yt.$y,Ye,es),Yt);return jt?ds:ds.endOf(ie)},Wi=function(es,Ye){return gt.w(Yt.toDate()[es].apply(Yt.toDate("s"),(jt?[0,0,0,0]:[23,59,59,999]).slice(Ye)),Yt)},vi=this.$W,Wr=this.$M,an=this.$D,_n="set"+(this.$u?"UTC":"");switch(Ri){case Se:return jt?Yi(1,0):Yi(31,11);case he:return jt?Yi(1,Wr):Yi(0,Wr+1);case oe:var En=this.$locale().weekStart||0,qr=(vi<En?vi+7:vi)-En;return Yi(jt?an-qr:an+(6-qr),Wr);case ie:case xe:return Wi(_n+"Hours",0);case W:return Wi(_n+"Minutes",1);case r:return Wi(_n+"Seconds",2);case N:return Wi(_n+"Milliseconds",3);default:return this.clone()}},Mt.endOf=function(zt){return this.startOf(zt,!1)},Mt.$set=function(zt,ii){var Yt,jt=gt.p(zt),Ri="set"+(this.$u?"UTC":""),Yi=(Yt={},Yt[ie]=Ri+"Date",Yt[xe]=Ri+"Date",Yt[he]=Ri+"Month",Yt[Se]=Ri+"FullYear",Yt[W]=Ri+"Hours",Yt[r]=Ri+"Minutes",Yt[N]=Ri+"Seconds",Yt[A]=Ri+"Milliseconds",Yt)[jt],Wi=jt===ie?this.$D+(ii-this.$W):ii;if(jt===he||jt===Se){var vi=this.clone().set(xe,1);vi.$d[Yi](Wi),vi.init(),this.$d=vi.set(xe,Math.min(this.$D,vi.daysInMonth())).$d}else Yi&&this.$d[Yi](Wi);return this.init(),this},Mt.set=function(zt,ii){return this.clone().$set(zt,ii)},Mt.get=function(zt){return this[gt.p(zt)]()},Mt.add=function(zt,ii){var Yt,jt=this;zt=Number(zt);var Ri=gt.p(ii),Yi=function(Wr){var an=Me(jt);return gt.w(an.date(an.date()+Math.round(Wr*zt)),jt)};if(Ri===he)return this.set(he,this.$M+zt);if(Ri===Se)return this.set(Se,this.$y+zt);if(Ri===ie)return Yi(1);if(Ri===oe)return Yi(7);var Wi=(Yt={},Yt[r]=c,Yt[W]=_,Yt[N]=a,Yt)[Ri]||1,vi=this.$d.getTime()+zt*Wi;return gt.w(vi,this)},Mt.subtract=function(zt,ii){return this.add(-1*zt,ii)},Mt.format=function(zt){var ii=this,Yt=this.$locale();if(!this.isValid())return Yt.invalidDate||Ae;var jt=zt||"YYYY-MM-DDTHH:mm:ssZ",Ri=gt.z(this),Yi=this.$H,Wi=this.$m,vi=this.$M,Wr=Yt.weekdays,an=Yt.months,_n=Yt.meridiem,En=function(Ye,ds,Bi,Xs){return Ye&&(Ye[ds]||Ye(ii,jt))||Bi[ds].slice(0,Xs)},qr=function(Ye){return gt.s(Yi%12||12,Ye,"0")},es=_n||function(Ye,ds,Bi){var Xs=Ye<12?"AM":"PM";return Bi?Xs.toLowerCase():Xs};return jt.replace(He,function(Ye,ds){return ds||function(Bi){switch(Bi){case"YY":return String(ii.$y).slice(-2);case"YYYY":return gt.s(ii.$y,4,"0");case"M":return vi+1;case"MM":return gt.s(vi+1,2,"0");case"MMM":return En(Yt.monthsShort,vi,an,3);case"MMMM":return En(an,vi);case"D":return ii.$D;case"DD":return gt.s(ii.$D,2,"0");case"d":return String(ii.$W);case"dd":return En(Yt.weekdaysMin,ii.$W,Wr,2);case"ddd":return En(Yt.weekdaysShort,ii.$W,Wr,3);case"dddd":return Wr[ii.$W];case"H":return String(Yi);case"HH":return gt.s(Yi,2,"0");case"h":return qr(1);case"hh":return qr(2);case"a":return es(Yi,Wi,!0);case"A":return es(Yi,Wi,!1);case"m":return String(Wi);case"mm":return gt.s(Wi,2,"0");case"s":return String(ii.$s);case"ss":return gt.s(ii.$s,2,"0");case"SSS":return gt.s(ii.$ms,3,"0");case"Z":return Ri}return null}(Ye)||Ri.replace(":","")})},Mt.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},Mt.diff=function(zt,ii,Yt){var jt,Ri=this,Yi=gt.p(ii),Wi=Me(zt),vi=(Wi.utcOffset()-this.utcOffset())*c,Wr=this-Wi,an=function(){return gt.m(Ri,Wi)};switch(Yi){case Se:jt=an()/12;break;case he:jt=an();break;case ve:jt=an()/3;break;case oe:jt=(Wr-vi)/6048e5;break;case ie:jt=(Wr-vi)/864e5;break;case W:jt=Wr/_;break;case r:jt=Wr/c;break;case N:jt=Wr/a;break;default:jt=Wr}return Yt?jt:gt.a(jt)},Mt.daysInMonth=function(){return this.endOf(he).$D},Mt.$locale=function(){return Lt[this.$L]},Mt.locale=function(zt,ii){if(!zt)return this.$L;var Yt=this.clone(),jt=qt(zt,ii,!0);return jt&&(Yt.$L=jt),Yt},Mt.clone=function(){return gt.w(this.$d,this)},Mt.toDate=function(){return new Date(this.valueOf())},Mt.toJSON=function(){return this.isValid()?this.toISOString():null},Mt.toISOString=function(){return this.$d.toISOString()},Mt.toString=function(){return this.$d.toUTCString()},ni}(),Ti=oi.prototype;return Me.prototype=Ti,[["$ms",A],["$s",N],["$m",r],["$H",W],["$W",ie],["$M",he],["$y",Se],["$D",xe]].forEach(function(ni){Ti[ni[1]]=function(Mt){return this.$g(Mt,ni[0],ni[1])}}),Me.extend=function(ni,Mt){return ni.$i||(ni(Mt,oi,Me),ni.$i=!0),Me},Me.locale=qt,Me.isDayjs=Tt,Me.unix=function(ni){return Me(1e3*ni)},Me.en=Lt[at],Me.Ls=Lt,Me.p={},Me})}(Ly)),Ly.exports}var r3=i3();const tf=t_(r3),n3=({fleetData:m,onFilterChange:g})=>{const a=tf().year(),c=tf().subtract(1,"day").toDate(),_=tf(`${a}-01-01`).toDate(),[A,N]=Xe.useState(_),[r,W]=Xe.useState(c),[ie,oe]=Xe.useState(null),[he,ve]=Xe.useState([]),[Se,xe]=Xe.useState([]),[Ae,Re]=Xe.useState([]),He=()=>A&&r?tf(r).diff(tf(A),"day")+1:0;return Xe.useEffect(()=>{const rt=Array.from(new Set(m.map(tt=>tt.vesselType))).map(tt=>({value:tt,label:tt}));xe(rt);const ht=m.map(tt=>({value:tt.name,label:tt.name}));Re(ht)},[m]),Xe.useEffect(()=>{if(A&&r){const rt=tf(A).format("DD-MMM-YYYY"),ht=tf(r).format("DD-MMM-YYYY");g({startDate:rt,endDate:ht,vesselType:(ie==null?void 0:ie.value)||"",vesselNames:he.map(tt=>tt.value)})}},[A,r,ie,he]),hi.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 p-4",children:[hi.jsxs("div",{className:"grid flex-wrap items-center gap-2",children:[hi.jsxs("div",{className:"grid",children:[hi.jsx("label",{className:"text-sm font-bold text-body mb-1",children:"Start Date:"}),hi.jsx(aT,{selected:A,onChange:rt=>N(rt),dateFormat:"dd-MMM-yyyy",className:"min-h-[38px] border border-borderColor rounded px-2 py-1 w-[190px] text-sm focus:outline-none"})]}),hi.jsxs("div",{className:"grid",children:[hi.jsx("label",{className:"text-sm font-bold text-body mb-1",children:"End Date:"}),hi.jsx(aT,{selected:r,onChange:rt=>W(rt),dateFormat:"dd-MMM-yyyy",className:"min-h-[38px] border border-borderColor rounded px-2 py-1 w-[190px] text-sm focus:outline-none"})]}),hi.jsxs("span",{className:"text-sm",children:[He()," days"]})]}),hi.jsxs("div",{className:"grid items-center gap-2",children:[hi.jsx("label",{className:"text-sm font-bold text-body",children:"Filter:"}),hi.jsx(AS,{options:Se,value:ie,onChange:rt=>oe(rt),placeholder:"Vessel Type",className:"w-[190px] text-sm",isClearable:!0}),hi.jsx(AS,{options:Ae,value:he,onChange:rt=>ve(rt),placeholder:"Vessel Name",isMulti:!0,className:"w-[190px] text-sm"})]})]})},s3={A:"bg-green-600 text-white",B:"bg-green-400 text-black",C:"bg-yellow-400 text-black",E:"bg-red-600 text-white"},o3=({status:m})=>hi.jsx("span",{className:`w-6 h-6 flex items-center justify-center rounded-full text-xs font-bold ${s3[m]}`,children:m});var Ry={exports:{}},a3=Ry.exports,cT;function l3(){return cT||(cT=1,function(m,g){(function(a,c){m.exports=c()})(a3,function(){var a,c,_;function A(r,W){if(!a)a=W;else if(!c)c=W;else{var ie="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+a+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",oe={};a(oe),_=W(oe),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(_.workerUrl=window.URL.createObjectURL(new Blob([ie],{type:"text/javascript"})))}}A(["exports"],function(r){function W(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var ie,oe={},he={};function ve(){if(ie)return he;ie=1,Object.defineProperty(he,"__esModule",{value:!0}),he.setMatrixArrayType=function(p){he.ARRAY_TYPE=e=p},he.toRadian=function(p){return p*o},he.equals=function(p,l){return Math.abs(p-l)<=s*Math.max(1,Math.abs(p),Math.abs(l))},he.RANDOM=he.ARRAY_TYPE=he.EPSILON=void 0;var s=1e-6;he.EPSILON=s;var e=typeof Float32Array<"u"?Float32Array:Array;he.ARRAY_TYPE=e;var i=Math.random;he.RANDOM=i;var o=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var p=0,l=arguments.length;l--;)p+=arguments[l]*arguments[l];return Math.sqrt(p)}),he}var Se,xe={};function Ae(){if(Se)return xe;function s(l){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},s(l)}Se=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.create=function(){var l=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},xe.clone=function(l){var f=new e.ARRAY_TYPE(4);return f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f},xe.copy=function(l,f){return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l},xe.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l},xe.fromValues=function(l,f,w,C){var O=new e.ARRAY_TYPE(4);return O[0]=l,O[1]=f,O[2]=w,O[3]=C,O},xe.set=function(l,f,w,C,O){return l[0]=f,l[1]=w,l[2]=C,l[3]=O,l},xe.transpose=function(l,f){if(l===f){var w=f[1];l[1]=f[2],l[2]=w}else l[0]=f[0],l[1]=f[2],l[2]=f[1],l[3]=f[3];return l},xe.invert=function(l,f){var w=f[0],C=f[1],O=f[2],x=f[3],E=w*x-O*C;return E?(l[0]=x*(E=1/E),l[1]=-C*E,l[2]=-O*E,l[3]=w*E,l):null},xe.adjoint=function(l,f){var w=f[0];return l[0]=f[3],l[1]=-f[1],l[2]=-f[2],l[3]=w,l},xe.determinant=function(l){return l[0]*l[3]-l[2]*l[1]},xe.multiply=o,xe.rotate=function(l,f,w){var C=f[0],O=f[1],x=f[2],E=f[3],k=Math.sin(w),M=Math.cos(w);return l[0]=C*M+x*k,l[1]=O*M+E*k,l[2]=C*-k+x*M,l[3]=O*-k+E*M,l},xe.scale=function(l,f,w){var C=f[1],O=f[2],x=f[3],E=w[0],k=w[1];return l[0]=f[0]*E,l[1]=C*E,l[2]=O*k,l[3]=x*k,l},xe.fromRotation=function(l,f){var w=Math.sin(f),C=Math.cos(f);return l[0]=C,l[1]=w,l[2]=-w,l[3]=C,l},xe.fromScaling=function(l,f){return l[0]=f[0],l[1]=0,l[2]=0,l[3]=f[1],l},xe.str=function(l){return"mat2("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+")"},xe.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3])},xe.LDU=function(l,f,w,C){return l[2]=C[2]/C[0],w[0]=C[0],w[1]=C[1],w[3]=C[3]-l[2]*w[1],[l,f,w]},xe.add=function(l,f,w){return l[0]=f[0]+w[0],l[1]=f[1]+w[1],l[2]=f[2]+w[2],l[3]=f[3]+w[3],l},xe.subtract=p,xe.exactEquals=function(l,f){return l[0]===f[0]&&l[1]===f[1]&&l[2]===f[2]&&l[3]===f[3]},xe.equals=function(l,f){var w=l[0],C=l[1],O=l[2],x=l[3],E=f[0],k=f[1],M=f[2],P=f[3];return Math.abs(w-E)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(E))&&Math.abs(C-k)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(k))&&Math.abs(O-M)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(M))&&Math.abs(x-P)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(P))},xe.multiplyScalar=function(l,f,w){return l[0]=f[0]*w,l[1]=f[1]*w,l[2]=f[2]*w,l[3]=f[3]*w,l},xe.multiplyScalarAndAdd=function(l,f,w,C){return l[0]=f[0]+w[0]*C,l[1]=f[1]+w[1]*C,l[2]=f[2]+w[2]*C,l[3]=f[3]+w[3]*C,l},xe.sub=xe.mul=void 0;var e=function(l,f){if(l&&l.__esModule)return l;if(l===null||s(l)!=="object"&&typeof l!="function")return{default:l};var w=i(void 0);if(w&&w.has(l))return w.get(l);var C={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in l)if(x!=="default"&&Object.prototype.hasOwnProperty.call(l,x)){var E=O?Object.getOwnPropertyDescriptor(l,x):null;E&&(E.get||E.set)?Object.defineProperty(C,x,E):C[x]=l[x]}return C.default=l,w&&w.set(l,C),C}(ve());function i(l){if(typeof WeakMap!="function")return null;var f=new WeakMap,w=new WeakMap;return(i=function(C){return C?w:f})(l)}function o(l,f,w){var C=f[0],O=f[1],x=f[2],E=f[3],k=w[0],M=w[1],P=w[2],R=w[3];return l[0]=C*k+x*M,l[1]=O*k+E*M,l[2]=C*P+x*R,l[3]=O*P+E*R,l}function p(l,f,w){return l[0]=f[0]-w[0],l[1]=f[1]-w[1],l[2]=f[2]-w[2],l[3]=f[3]-w[3],l}return xe.mul=o,xe.sub=p,xe}var Re,He={};function rt(){if(Re)return He;function s(l){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},s(l)}Re=1,Object.defineProperty(He,"__esModule",{value:!0}),He.create=function(){var l=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0,l[4]=0,l[5]=0),l[0]=1,l[3]=1,l},He.clone=function(l){var f=new e.ARRAY_TYPE(6);return f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[4]=l[4],f[5]=l[5],f},He.copy=function(l,f){return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l[4]=f[4],l[5]=f[5],l},He.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=0,l[5]=0,l},He.fromValues=function(l,f,w,C,O,x){var E=new e.ARRAY_TYPE(6);return E[0]=l,E[1]=f,E[2]=w,E[3]=C,E[4]=O,E[5]=x,E},He.set=function(l,f,w,C,O,x,E){return l[0]=f,l[1]=w,l[2]=C,l[3]=O,l[4]=x,l[5]=E,l},He.invert=function(l,f){var w=f[0],C=f[1],O=f[2],x=f[3],E=f[4],k=f[5],M=w*x-C*O;return M?(l[0]=x*(M=1/M),l[1]=-C*M,l[2]=-O*M,l[3]=w*M,l[4]=(O*k-x*E)*M,l[5]=(C*E-w*k)*M,l):null},He.determinant=function(l){return l[0]*l[3]-l[1]*l[2]},He.multiply=o,He.rotate=function(l,f,w){var C=f[0],O=f[1],x=f[2],E=f[3],k=f[4],M=f[5],P=Math.sin(w),R=Math.cos(w);return l[0]=C*R+x*P,l[1]=O*R+E*P,l[2]=C*-P+x*R,l[3]=O*-P+E*R,l[4]=k,l[5]=M,l},He.scale=function(l,f,w){var C=f[1],O=f[2],x=f[3],E=f[4],k=f[5],M=w[0],P=w[1];return l[0]=f[0]*M,l[1]=C*M,l[2]=O*P,l[3]=x*P,l[4]=E,l[5]=k,l},He.translate=function(l,f,w){var C=f[0],O=f[1],x=f[2],E=f[3],k=f[4],M=f[5],P=w[0],R=w[1];return l[0]=C,l[1]=O,l[2]=x,l[3]=E,l[4]=C*P+x*R+k,l[5]=O*P+E*R+M,l},He.fromRotation=function(l,f){var w=Math.sin(f),C=Math.cos(f);return l[0]=C,l[1]=w,l[2]=-w,l[3]=C,l[4]=0,l[5]=0,l},He.fromScaling=function(l,f){return l[0]=f[0],l[1]=0,l[2]=0,l[3]=f[1],l[4]=0,l[5]=0,l},He.fromTranslation=function(l,f){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=f[0],l[5]=f[1],l},He.str=function(l){return"mat2d("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+", "+l[4]+", "+l[5]+")"},He.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3],l[4],l[5],1)},He.add=function(l,f,w){return l[0]=f[0]+w[0],l[1]=f[1]+w[1],l[2]=f[2]+w[2],l[3]=f[3]+w[3],l[4]=f[4]+w[4],l[5]=f[5]+w[5],l},He.subtract=p,He.multiplyScalar=function(l,f,w){return l[0]=f[0]*w,l[1]=f[1]*w,l[2]=f[2]*w,l[3]=f[3]*w,l[4]=f[4]*w,l[5]=f[5]*w,l},He.multiplyScalarAndAdd=function(l,f,w,C){return l[0]=f[0]+w[0]*C,l[1]=f[1]+w[1]*C,l[2]=f[2]+w[2]*C,l[3]=f[3]+w[3]*C,l[4]=f[4]+w[4]*C,l[5]=f[5]+w[5]*C,l},He.exactEquals=function(l,f){return l[0]===f[0]&&l[1]===f[1]&&l[2]===f[2]&&l[3]===f[3]&&l[4]===f[4]&&l[5]===f[5]},He.equals=function(l,f){var w=l[0],C=l[1],O=l[2],x=l[3],E=l[4],k=l[5],M=f[0],P=f[1],R=f[2],$=f[3],H=f[4],J=f[5];return Math.abs(w-M)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(M))&&Math.abs(C-P)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(P))&&Math.abs(O-R)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(R))&&Math.abs(x-$)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs($))&&Math.abs(E-H)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(H))&&Math.abs(k-J)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(J))},He.sub=He.mul=void 0;var e=function(l,f){if(l&&l.__esModule)return l;if(l===null||s(l)!=="object"&&typeof l!="function")return{default:l};var w=i(void 0);if(w&&w.has(l))return w.get(l);var C={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in l)if(x!=="default"&&Object.prototype.hasOwnProperty.call(l,x)){var E=O?Object.getOwnPropertyDescriptor(l,x):null;E&&(E.get||E.set)?Object.defineProperty(C,x,E):C[x]=l[x]}return C.default=l,w&&w.set(l,C),C}(ve());function i(l){if(typeof WeakMap!="function")return null;var f=new WeakMap,w=new WeakMap;return(i=function(C){return C?w:f})(l)}function o(l,f,w){var C=f[0],O=f[1],x=f[2],E=f[3],k=f[4],M=f[5],P=w[0],R=w[1],$=w[2],H=w[3],J=w[4],ee=w[5];return l[0]=C*P+x*R,l[1]=O*P+E*R,l[2]=C*$+x*H,l[3]=O*$+E*H,l[4]=C*J+x*ee+k,l[5]=O*J+E*ee+M,l}function p(l,f,w){return l[0]=f[0]-w[0],l[1]=f[1]-w[1],l[2]=f[2]-w[2],l[3]=f[3]-w[3],l[4]=f[4]-w[4],l[5]=f[5]-w[5],l}return He.mul=o,He.sub=p,He}var ht,tt={};function at(){if(ht)return tt;function s(l){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},s(l)}ht=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.create=function(){var l=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l},tt.fromMat4=function(l,f){return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[4],l[4]=f[5],l[5]=f[6],l[6]=f[8],l[7]=f[9],l[8]=f[10],l},tt.clone=function(l){var f=new e.ARRAY_TYPE(9);return f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[4]=l[4],f[5]=l[5],f[6]=l[6],f[7]=l[7],f[8]=l[8],f},tt.copy=function(l,f){return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l[4]=f[4],l[5]=f[5],l[6]=f[6],l[7]=f[7],l[8]=f[8],l},tt.fromValues=function(l,f,w,C,O,x,E,k,M){var P=new e.ARRAY_TYPE(9);return P[0]=l,P[1]=f,P[2]=w,P[3]=C,P[4]=O,P[5]=x,P[6]=E,P[7]=k,P[8]=M,P},tt.set=function(l,f,w,C,O,x,E,k,M,P){return l[0]=f,l[1]=w,l[2]=C,l[3]=O,l[4]=x,l[5]=E,l[6]=k,l[7]=M,l[8]=P,l},tt.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},tt.transpose=function(l,f){if(l===f){var w=f[1],C=f[2],O=f[5];l[1]=f[3],l[2]=f[6],l[3]=w,l[5]=f[7],l[6]=C,l[7]=O}else l[0]=f[0],l[1]=f[3],l[2]=f[6],l[3]=f[1],l[4]=f[4],l[5]=f[7],l[6]=f[2],l[7]=f[5],l[8]=f[8];return l},tt.invert=function(l,f){var w=f[0],C=f[1],O=f[2],x=f[3],E=f[4],k=f[5],M=f[6],P=f[7],R=f[8],$=R*E-k*P,H=-R*x+k*M,J=P*x-E*M,ee=w*$+C*H+O*J;return ee?(l[0]=$*(ee=1/ee),l[1]=(-R*C+O*P)*ee,l[2]=(k*C-O*E)*ee,l[3]=H*ee,l[4]=(R*w-O*M)*ee,l[5]=(-k*w+O*x)*ee,l[6]=J*ee,l[7]=(-P*w+C*M)*ee,l[8]=(E*w-C*x)*ee,l):null},tt.adjoint=function(l,f){var w=f[0],C=f[1],O=f[2],x=f[3],E=f[4],k=f[5],M=f[6],P=f[7],R=f[8];return l[0]=E*R-k*P,l[1]=O*P-C*R,l[2]=C*k-O*E,l[3]=k*M-x*R,l[4]=w*R-O*M,l[5]=O*x-w*k,l[6]=x*P-E*M,l[7]=C*M-w*P,l[8]=w*E-C*x,l},tt.determinant=function(l){var f=l[3],w=l[4],C=l[5],O=l[6],x=l[7],E=l[8];return l[0]*(E*w-C*x)+l[1]*(-E*f+C*O)+l[2]*(x*f-w*O)},tt.multiply=o,tt.translate=function(l,f,w){var C=f[0],O=f[1],x=f[2],E=f[3],k=f[4],M=f[5],P=f[6],R=f[7],$=f[8],H=w[0],J=w[1];return l[0]=C,l[1]=O,l[2]=x,l[3]=E,l[4]=k,l[5]=M,l[6]=H*C+J*E+P,l[7]=H*O+J*k+R,l[8]=H*x+J*M+$,l},tt.rotate=function(l,f,w){var C=f[0],O=f[1],x=f[2],E=f[3],k=f[4],M=f[5],P=f[6],R=f[7],$=f[8],H=Math.sin(w),J=Math.cos(w);return l[0]=J*C+H*E,l[1]=J*O+H*k,l[2]=J*x+H*M,l[3]=J*E-H*C,l[4]=J*k-H*O,l[5]=J*M-H*x,l[6]=P,l[7]=R,l[8]=$,l},tt.scale=function(l,f,w){var C=w[0],O=w[1];return l[0]=C*f[0],l[1]=C*f[1],l[2]=C*f[2],l[3]=O*f[3],l[4]=O*f[4],l[5]=O*f[5],l[6]=f[6],l[7]=f[7],l[8]=f[8],l},tt.fromTranslation=function(l,f){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=f[0],l[7]=f[1],l[8]=1,l},tt.fromRotation=function(l,f){var w=Math.sin(f),C=Math.cos(f);return l[0]=C,l[1]=w,l[2]=0,l[3]=-w,l[4]=C,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},tt.fromScaling=function(l,f){return l[0]=f[0],l[1]=0,l[2]=0,l[3]=0,l[4]=f[1],l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},tt.fromMat2d=function(l,f){return l[0]=f[0],l[1]=f[1],l[2]=0,l[3]=f[2],l[4]=f[3],l[5]=0,l[6]=f[4],l[7]=f[5],l[8]=1,l},tt.fromQuat=function(l,f){var w=f[0],C=f[1],O=f[2],x=f[3],E=w+w,k=C+C,M=O+O,P=w*E,R=C*E,$=C*k,H=O*E,J=O*k,ee=O*M,Z=x*E,ne=x*k,le=x*M;return l[0]=1-$-ee,l[3]=R-le,l[6]=H+ne,l[1]=R+le,l[4]=1-P-ee,l[7]=J-Z,l[2]=H-ne,l[5]=J+Z,l[8]=1-P-$,l},tt.normalFromMat4=function(l,f){var w=f[0],C=f[1],O=f[2],x=f[3],E=f[4],k=f[5],M=f[6],P=f[7],R=f[8],$=f[9],H=f[10],J=f[11],ee=f[12],Z=f[13],ne=f[14],le=f[15],fe=w*k-C*E,Pe=w*M-O*E,Ee=w*P-x*E,Ce=C*M-O*k,$e=C*P-x*k,Ie=O*P-x*M,Ge=R*Z-$*ee,Ze=R*ne-H*ee,qe=R*le-J*ee,et=$*ne-H*Z,nt=$*le-J*Z,ct=H*le-J*ne,it=fe*ct-Pe*nt+Ee*et+Ce*qe-$e*Ze+Ie*Ge;return it?(l[0]=(k*ct-M*nt+P*et)*(it=1/it),l[1]=(M*qe-E*ct-P*Ze)*it,l[2]=(E*nt-k*qe+P*Ge)*it,l[3]=(O*nt-C*ct-x*et)*it,l[4]=(w*ct-O*qe+x*Ze)*it,l[5]=(C*qe-w*nt-x*Ge)*it,l[6]=(Z*Ie-ne*$e+le*Ce)*it,l[7]=(ne*Ee-ee*Ie-le*Pe)*it,l[8]=(ee*$e-Z*Ee+le*fe)*it,l):null},tt.projection=function(l,f,w){return l[0]=2/f,l[1]=0,l[2]=0,l[3]=0,l[4]=-2/w,l[5]=0,l[6]=-1,l[7]=1,l[8]=1,l},tt.str=function(l){return"mat3("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+", "+l[4]+", "+l[5]+", "+l[6]+", "+l[7]+", "+l[8]+")"},tt.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8])},tt.add=function(l,f,w){return l[0]=f[0]+w[0],l[1]=f[1]+w[1],l[2]=f[2]+w[2],l[3]=f[3]+w[3],l[4]=f[4]+w[4],l[5]=f[5]+w[5],l[6]=f[6]+w[6],l[7]=f[7]+w[7],l[8]=f[8]+w[8],l},tt.subtract=p,tt.multiplyScalar=function(l,f,w){return l[0]=f[0]*w,l[1]=f[1]*w,l[2]=f[2]*w,l[3]=f[3]*w,l[4]=f[4]*w,l[5]=f[5]*w,l[6]=f[6]*w,l[7]=f[7]*w,l[8]=f[8]*w,l},tt.multiplyScalarAndAdd=function(l,f,w,C){return l[0]=f[0]+w[0]*C,l[1]=f[1]+w[1]*C,l[2]=f[2]+w[2]*C,l[3]=f[3]+w[3]*C,l[4]=f[4]+w[4]*C,l[5]=f[5]+w[5]*C,l[6]=f[6]+w[6]*C,l[7]=f[7]+w[7]*C,l[8]=f[8]+w[8]*C,l},tt.exactEquals=function(l,f){return l[0]===f[0]&&l[1]===f[1]&&l[2]===f[2]&&l[3]===f[3]&&l[4]===f[4]&&l[5]===f[5]&&l[6]===f[6]&&l[7]===f[7]&&l[8]===f[8]},tt.equals=function(l,f){var w=l[0],C=l[1],O=l[2],x=l[3],E=l[4],k=l[5],M=l[6],P=l[7],R=l[8],$=f[0],H=f[1],J=f[2],ee=f[3],Z=f[4],ne=f[5],le=f[6],fe=f[7],Pe=f[8];return Math.abs(w-$)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs($))&&Math.abs(C-H)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(H))&&Math.abs(O-J)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(J))&&Math.abs(x-ee)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(ee))&&Math.abs(E-Z)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(Z))&&Math.abs(k-ne)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(ne))&&Math.abs(M-le)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(le))&&Math.abs(P-fe)<=e.EPSILON*Math.max(1,Math.abs(P),Math.abs(fe))&&Math.abs(R-Pe)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(Pe))},tt.sub=tt.mul=void 0;var e=function(l,f){if(l&&l.__esModule)return l;if(l===null||s(l)!=="object"&&typeof l!="function")return{default:l};var w=i(void 0);if(w&&w.has(l))return w.get(l);var C={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in l)if(x!=="default"&&Object.prototype.hasOwnProperty.call(l,x)){var E=O?Object.getOwnPropertyDescriptor(l,x):null;E&&(E.get||E.set)?Object.defineProperty(C,x,E):C[x]=l[x]}return C.default=l,w&&w.set(l,C),C}(ve());function i(l){if(typeof WeakMap!="function")return null;var f=new WeakMap,w=new WeakMap;return(i=function(C){return C?w:f})(l)}function o(l,f,w){var C=f[0],O=f[1],x=f[2],E=f[3],k=f[4],M=f[5],P=f[6],R=f[7],$=f[8],H=w[0],J=w[1],ee=w[2],Z=w[3],ne=w[4],le=w[5],fe=w[6],Pe=w[7],Ee=w[8];return l[0]=H*C+J*E+ee*P,l[1]=H*O+J*k+ee*R,l[2]=H*x+J*M+ee*$,l[3]=Z*C+ne*E+le*P,l[4]=Z*O+ne*k+le*R,l[5]=Z*x+ne*M+le*$,l[6]=fe*C+Pe*E+Ee*P,l[7]=fe*O+Pe*k+Ee*R,l[8]=fe*x+Pe*M+Ee*$,l}function p(l,f,w){return l[0]=f[0]-w[0],l[1]=f[1]-w[1],l[2]=f[2]-w[2],l[3]=f[3]-w[3],l[4]=f[4]-w[4],l[5]=f[5]-w[5],l[6]=f[6]-w[6],l[7]=f[7]-w[7],l[8]=f[8]-w[8],l}return tt.mul=o,tt.sub=p,tt}var Lt,Ve={};function Tt(){if(Lt)return Ve;function s(x){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},s(x)}Lt=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.create=function(){var x=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=0,x[12]=0,x[13]=0,x[14]=0),x[0]=1,x[5]=1,x[10]=1,x[15]=1,x},Ve.clone=function(x){var E=new e.ARRAY_TYPE(16);return E[0]=x[0],E[1]=x[1],E[2]=x[2],E[3]=x[3],E[4]=x[4],E[5]=x[5],E[6]=x[6],E[7]=x[7],E[8]=x[8],E[9]=x[9],E[10]=x[10],E[11]=x[11],E[12]=x[12],E[13]=x[13],E[14]=x[14],E[15]=x[15],E},Ve.copy=function(x,E){return x[0]=E[0],x[1]=E[1],x[2]=E[2],x[3]=E[3],x[4]=E[4],x[5]=E[5],x[6]=E[6],x[7]=E[7],x[8]=E[8],x[9]=E[9],x[10]=E[10],x[11]=E[11],x[12]=E[12],x[13]=E[13],x[14]=E[14],x[15]=E[15],x},Ve.fromValues=function(x,E,k,M,P,R,$,H,J,ee,Z,ne,le,fe,Pe,Ee){var Ce=new e.ARRAY_TYPE(16);return Ce[0]=x,Ce[1]=E,Ce[2]=k,Ce[3]=M,Ce[4]=P,Ce[5]=R,Ce[6]=$,Ce[7]=H,Ce[8]=J,Ce[9]=ee,Ce[10]=Z,Ce[11]=ne,Ce[12]=le,Ce[13]=fe,Ce[14]=Pe,Ce[15]=Ee,Ce},Ve.set=function(x,E,k,M,P,R,$,H,J,ee,Z,ne,le,fe,Pe,Ee,Ce){return x[0]=E,x[1]=k,x[2]=M,x[3]=P,x[4]=R,x[5]=$,x[6]=H,x[7]=J,x[8]=ee,x[9]=Z,x[10]=ne,x[11]=le,x[12]=fe,x[13]=Pe,x[14]=Ee,x[15]=Ce,x},Ve.identity=o,Ve.transpose=function(x,E){if(x===E){var k=E[1],M=E[2],P=E[3],R=E[6],$=E[7],H=E[11];x[1]=E[4],x[2]=E[8],x[3]=E[12],x[4]=k,x[6]=E[9],x[7]=E[13],x[8]=M,x[9]=R,x[11]=E[14],x[12]=P,x[13]=$,x[14]=H}else x[0]=E[0],x[1]=E[4],x[2]=E[8],x[3]=E[12],x[4]=E[1],x[5]=E[5],x[6]=E[9],x[7]=E[13],x[8]=E[2],x[9]=E[6],x[10]=E[10],x[11]=E[14],x[12]=E[3],x[13]=E[7],x[14]=E[11],x[15]=E[15];return x},Ve.invert=function(x,E){var k=E[0],M=E[1],P=E[2],R=E[3],$=E[4],H=E[5],J=E[6],ee=E[7],Z=E[8],ne=E[9],le=E[10],fe=E[11],Pe=E[12],Ee=E[13],Ce=E[14],$e=E[15],Ie=k*H-M*$,Ge=k*J-P*$,Ze=k*ee-R*$,qe=M*J-P*H,et=M*ee-R*H,nt=P*ee-R*J,ct=Z*Ee-ne*Pe,it=Z*Ce-le*Pe,Et=Z*$e-fe*Pe,Nt=ne*Ce-le*Ee,Ct=ne*$e-fe*Ee,si=le*$e-fe*Ce,ti=Ie*si-Ge*Ct+Ze*Nt+qe*Et-et*it+nt*ct;return ti?(x[0]=(H*si-J*Ct+ee*Nt)*(ti=1/ti),x[1]=(P*Ct-M*si-R*Nt)*ti,x[2]=(Ee*nt-Ce*et+$e*qe)*ti,x[3]=(le*et-ne*nt-fe*qe)*ti,x[4]=(J*Et-$*si-ee*it)*ti,x[5]=(k*si-P*Et+R*it)*ti,x[6]=(Ce*Ze-Pe*nt-$e*Ge)*ti,x[7]=(Z*nt-le*Ze+fe*Ge)*ti,x[8]=($*Ct-H*Et+ee*ct)*ti,x[9]=(M*Et-k*Ct-R*ct)*ti,x[10]=(Pe*et-Ee*Ze+$e*Ie)*ti,x[11]=(ne*Ze-Z*et-fe*Ie)*ti,x[12]=(H*it-$*Nt-J*ct)*ti,x[13]=(k*Nt-M*it+P*ct)*ti,x[14]=(Ee*Ge-Pe*qe-Ce*Ie)*ti,x[15]=(Z*qe-ne*Ge+le*Ie)*ti,x):null},Ve.adjoint=function(x,E){var k=E[0],M=E[1],P=E[2],R=E[3],$=E[4],H=E[5],J=E[6],ee=E[7],Z=E[8],ne=E[9],le=E[10],fe=E[11],Pe=E[12],Ee=E[13],Ce=E[14],$e=E[15];return x[0]=H*(le*$e-fe*Ce)-ne*(J*$e-ee*Ce)+Ee*(J*fe-ee*le),x[1]=-(M*(le*$e-fe*Ce)-ne*(P*$e-R*Ce)+Ee*(P*fe-R*le)),x[2]=M*(J*$e-ee*Ce)-H*(P*$e-R*Ce)+Ee*(P*ee-R*J),x[3]=-(M*(J*fe-ee*le)-H*(P*fe-R*le)+ne*(P*ee-R*J)),x[4]=-($*(le*$e-fe*Ce)-Z*(J*$e-ee*Ce)+Pe*(J*fe-ee*le)),x[5]=k*(le*$e-fe*Ce)-Z*(P*$e-R*Ce)+Pe*(P*fe-R*le),x[6]=-(k*(J*$e-ee*Ce)-$*(P*$e-R*Ce)+Pe*(P*ee-R*J)),x[7]=k*(J*fe-ee*le)-$*(P*fe-R*le)+Z*(P*ee-R*J),x[8]=$*(ne*$e-fe*Ee)-Z*(H*$e-ee*Ee)+Pe*(H*fe-ee*ne),x[9]=-(k*(ne*$e-fe*Ee)-Z*(M*$e-R*Ee)+Pe*(M*fe-R*ne)),x[10]=k*(H*$e-ee*Ee)-$*(M*$e-R*Ee)+Pe*(M*ee-R*H),x[11]=-(k*(H*fe-ee*ne)-$*(M*fe-R*ne)+Z*(M*ee-R*H)),x[12]=-($*(ne*Ce-le*Ee)-Z*(H*Ce-J*Ee)+Pe*(H*le-J*ne)),x[13]=k*(ne*Ce-le*Ee)-Z*(M*Ce-P*Ee)+Pe*(M*le-P*ne),x[14]=-(k*(H*Ce-J*Ee)-$*(M*Ce-P*Ee)+Pe*(M*J-P*H)),x[15]=k*(H*le-J*ne)-$*(M*le-P*ne)+Z*(M*J-P*H),x},Ve.determinant=function(x){var E=x[0],k=x[1],M=x[2],P=x[3],R=x[4],$=x[5],H=x[6],J=x[7],ee=x[8],Z=x[9],ne=x[10],le=x[11],fe=x[12],Pe=x[13],Ee=x[14],Ce=x[15];return(E*$-k*R)*(ne*Ce-le*Ee)-(E*H-M*R)*(Z*Ce-le*Pe)+(E*J-P*R)*(Z*Ee-ne*Pe)+(k*H-M*$)*(ee*Ce-le*fe)-(k*J-P*$)*(ee*Ee-ne*fe)+(M*J-P*H)*(ee*Pe-Z*fe)},Ve.multiply=p,Ve.translate=function(x,E,k){var M,P,R,$,H,J,ee,Z,ne,le,fe,Pe,Ee=k[0],Ce=k[1],$e=k[2];return E===x?(x[12]=E[0]*Ee+E[4]*Ce+E[8]*$e+E[12],x[13]=E[1]*Ee+E[5]*Ce+E[9]*$e+E[13],x[14]=E[2]*Ee+E[6]*Ce+E[10]*$e+E[14],x[15]=E[3]*Ee+E[7]*Ce+E[11]*$e+E[15]):(P=E[1],R=E[2],$=E[3],H=E[4],J=E[5],ee=E[6],Z=E[7],ne=E[8],le=E[9],fe=E[10],Pe=E[11],x[0]=M=E[0],x[1]=P,x[2]=R,x[3]=$,x[4]=H,x[5]=J,x[6]=ee,x[7]=Z,x[8]=ne,x[9]=le,x[10]=fe,x[11]=Pe,x[12]=M*Ee+H*Ce+ne*$e+E[12],x[13]=P*Ee+J*Ce+le*$e+E[13],x[14]=R*Ee+ee*Ce+fe*$e+E[14],x[15]=$*Ee+Z*Ce+Pe*$e+E[15]),x},Ve.scale=function(x,E,k){var M=k[0],P=k[1],R=k[2];return x[0]=E[0]*M,x[1]=E[1]*M,x[2]=E[2]*M,x[3]=E[3]*M,x[4]=E[4]*P,x[5]=E[5]*P,x[6]=E[6]*P,x[7]=E[7]*P,x[8]=E[8]*R,x[9]=E[9]*R,x[10]=E[10]*R,x[11]=E[11]*R,x[12]=E[12],x[13]=E[13],x[14]=E[14],x[15]=E[15],x},Ve.rotate=function(x,E,k,M){var P,R,$,H,J,ee,Z,ne,le,fe,Pe,Ee,Ce,$e,Ie,Ge,Ze,qe,et,nt,ct,it,Et,Nt,Ct=M[0],si=M[1],ti=M[2],Ht=Math.hypot(Ct,si,ti);return Ht<e.EPSILON?null:(Ct*=Ht=1/Ht,si*=Ht,ti*=Ht,P=Math.sin(k),R=Math.cos(k),J=E[1],ee=E[2],Z=E[3],le=E[5],fe=E[6],Pe=E[7],Ce=E[9],$e=E[10],Ie=E[11],Ge=Ct*Ct*($=1-R)+R,et=Ct*si*$-ti*P,nt=si*si*$+R,ct=ti*si*$+Ct*P,it=Ct*ti*$+si*P,Et=si*ti*$-Ct*P,Nt=ti*ti*$+R,x[0]=(H=E[0])*Ge+(ne=E[4])*(Ze=si*Ct*$+ti*P)+(Ee=E[8])*(qe=ti*Ct*$-si*P),x[1]=J*Ge+le*Ze+Ce*qe,x[2]=ee*Ge+fe*Ze+$e*qe,x[3]=Z*Ge+Pe*Ze+Ie*qe,x[4]=H*et+ne*nt+Ee*ct,x[5]=J*et+le*nt+Ce*ct,x[6]=ee*et+fe*nt+$e*ct,x[7]=Z*et+Pe*nt+Ie*ct,x[8]=H*it+ne*Et+Ee*Nt,x[9]=J*it+le*Et+Ce*Nt,x[10]=ee*it+fe*Et+$e*Nt,x[11]=Z*it+Pe*Et+Ie*Nt,E!==x&&(x[12]=E[12],x[13]=E[13],x[14]=E[14],x[15]=E[15]),x)},Ve.rotateX=function(x,E,k){var M=Math.sin(k),P=Math.cos(k),R=E[4],$=E[5],H=E[6],J=E[7],ee=E[8],Z=E[9],ne=E[10],le=E[11];return E!==x&&(x[0]=E[0],x[1]=E[1],x[2]=E[2],x[3]=E[3],x[12]=E[12],x[13]=E[13],x[14]=E[14],x[15]=E[15]),x[4]=R*P+ee*M,x[5]=$*P+Z*M,x[6]=H*P+ne*M,x[7]=J*P+le*M,x[8]=ee*P-R*M,x[9]=Z*P-$*M,x[10]=ne*P-H*M,x[11]=le*P-J*M,x},Ve.rotateY=function(x,E,k){var M=Math.sin(k),P=Math.cos(k),R=E[0],$=E[1],H=E[2],J=E[3],ee=E[8],Z=E[9],ne=E[10],le=E[11];return E!==x&&(x[4]=E[4],x[5]=E[5],x[6]=E[6],x[7]=E[7],x[12]=E[12],x[13]=E[13],x[14]=E[14],x[15]=E[15]),x[0]=R*P-ee*M,x[1]=$*P-Z*M,x[2]=H*P-ne*M,x[3]=J*P-le*M,x[8]=R*M+ee*P,x[9]=$*M+Z*P,x[10]=H*M+ne*P,x[11]=J*M+le*P,x},Ve.rotateZ=function(x,E,k){var M=Math.sin(k),P=Math.cos(k),R=E[0],$=E[1],H=E[2],J=E[3],ee=E[4],Z=E[5],ne=E[6],le=E[7];return E!==x&&(x[8]=E[8],x[9]=E[9],x[10]=E[10],x[11]=E[11],x[12]=E[12],x[13]=E[13],x[14]=E[14],x[15]=E[15]),x[0]=R*P+ee*M,x[1]=$*P+Z*M,x[2]=H*P+ne*M,x[3]=J*P+le*M,x[4]=ee*P-R*M,x[5]=Z*P-$*M,x[6]=ne*P-H*M,x[7]=le*P-J*M,x},Ve.fromTranslation=function(x,E){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=E[0],x[13]=E[1],x[14]=E[2],x[15]=1,x},Ve.fromScaling=function(x,E){return x[0]=E[0],x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=E[1],x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=E[2],x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Ve.fromRotation=function(x,E,k){var M,P,R,$=k[0],H=k[1],J=k[2],ee=Math.hypot($,H,J);return ee<e.EPSILON?null:($*=ee=1/ee,H*=ee,J*=ee,M=Math.sin(E),P=Math.cos(E),x[0]=$*$*(R=1-P)+P,x[1]=H*$*R+J*M,x[2]=J*$*R-H*M,x[3]=0,x[4]=$*H*R-J*M,x[5]=H*H*R+P,x[6]=J*H*R+$*M,x[7]=0,x[8]=$*J*R+H*M,x[9]=H*J*R-$*M,x[10]=J*J*R+P,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x)},Ve.fromXRotation=function(x,E){var k=Math.sin(E),M=Math.cos(E);return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=M,x[6]=k,x[7]=0,x[8]=0,x[9]=-k,x[10]=M,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Ve.fromYRotation=function(x,E){var k=Math.sin(E),M=Math.cos(E);return x[0]=M,x[1]=0,x[2]=-k,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=k,x[9]=0,x[10]=M,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Ve.fromZRotation=function(x,E){var k=Math.sin(E),M=Math.cos(E);return x[0]=M,x[1]=k,x[2]=0,x[3]=0,x[4]=-k,x[5]=M,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Ve.fromRotationTranslation=l,Ve.fromQuat2=function(x,E){var k=new e.ARRAY_TYPE(3),M=-E[0],P=-E[1],R=-E[2],$=E[3],H=E[4],J=E[5],ee=E[6],Z=E[7],ne=M*M+P*P+R*R+$*$;return ne>0?(k[0]=2*(H*$+Z*M+J*R-ee*P)/ne,k[1]=2*(J*$+Z*P+ee*M-H*R)/ne,k[2]=2*(ee*$+Z*R+H*P-J*M)/ne):(k[0]=2*(H*$+Z*M+J*R-ee*P),k[1]=2*(J*$+Z*P+ee*M-H*R),k[2]=2*(ee*$+Z*R+H*P-J*M)),l(x,E,k),x},Ve.getTranslation=function(x,E){return x[0]=E[12],x[1]=E[13],x[2]=E[14],x},Ve.getScaling=f,Ve.getRotation=function(x,E){var k=new e.ARRAY_TYPE(3);f(k,E);var M=1/k[0],P=1/k[1],R=1/k[2],$=E[0]*M,H=E[1]*P,J=E[2]*R,ee=E[4]*M,Z=E[5]*P,ne=E[6]*R,le=E[8]*M,fe=E[9]*P,Pe=E[10]*R,Ee=$+Z+Pe,Ce=0;return Ee>0?(Ce=2*Math.sqrt(Ee+1),x[3]=.25*Ce,x[0]=(ne-fe)/Ce,x[1]=(le-J)/Ce,x[2]=(H-ee)/Ce):$>Z&&$>Pe?(Ce=2*Math.sqrt(1+$-Z-Pe),x[3]=(ne-fe)/Ce,x[0]=.25*Ce,x[1]=(H+ee)/Ce,x[2]=(le+J)/Ce):Z>Pe?(Ce=2*Math.sqrt(1+Z-$-Pe),x[3]=(le-J)/Ce,x[0]=(H+ee)/Ce,x[1]=.25*Ce,x[2]=(ne+fe)/Ce):(Ce=2*Math.sqrt(1+Pe-$-Z),x[3]=(H-ee)/Ce,x[0]=(le+J)/Ce,x[1]=(ne+fe)/Ce,x[2]=.25*Ce),x},Ve.fromRotationTranslationScale=function(x,E,k,M){var P=E[0],R=E[1],$=E[2],H=E[3],J=P+P,ee=R+R,Z=$+$,ne=P*J,le=P*ee,fe=P*Z,Pe=R*ee,Ee=R*Z,Ce=$*Z,$e=H*J,Ie=H*ee,Ge=H*Z,Ze=M[0],qe=M[1],et=M[2];return x[0]=(1-(Pe+Ce))*Ze,x[1]=(le+Ge)*Ze,x[2]=(fe-Ie)*Ze,x[3]=0,x[4]=(le-Ge)*qe,x[5]=(1-(ne+Ce))*qe,x[6]=(Ee+$e)*qe,x[7]=0,x[8]=(fe+Ie)*et,x[9]=(Ee-$e)*et,x[10]=(1-(ne+Pe))*et,x[11]=0,x[12]=k[0],x[13]=k[1],x[14]=k[2],x[15]=1,x},Ve.fromRotationTranslationScaleOrigin=function(x,E,k,M,P){var R=E[0],$=E[1],H=E[2],J=E[3],ee=R+R,Z=$+$,ne=H+H,le=R*ee,fe=R*Z,Pe=R*ne,Ee=$*Z,Ce=$*ne,$e=H*ne,Ie=J*ee,Ge=J*Z,Ze=J*ne,qe=M[0],et=M[1],nt=M[2],ct=P[0],it=P[1],Et=P[2],Nt=(1-(Ee+$e))*qe,Ct=(fe+Ze)*qe,si=(Pe-Ge)*qe,ti=(fe-Ze)*et,Ht=(1-(le+$e))*et,Ut=(Ce+Ie)*et,xi=(Pe+Ge)*nt,ui=(Ce-Ie)*nt,mi=(1-(le+Ee))*nt;return x[0]=Nt,x[1]=Ct,x[2]=si,x[3]=0,x[4]=ti,x[5]=Ht,x[6]=Ut,x[7]=0,x[8]=xi,x[9]=ui,x[10]=mi,x[11]=0,x[12]=k[0]+ct-(Nt*ct+ti*it+xi*Et),x[13]=k[1]+it-(Ct*ct+Ht*it+ui*Et),x[14]=k[2]+Et-(si*ct+Ut*it+mi*Et),x[15]=1,x},Ve.fromQuat=function(x,E){var k=E[0],M=E[1],P=E[2],R=E[3],$=k+k,H=M+M,J=P+P,ee=k*$,Z=M*$,ne=M*H,le=P*$,fe=P*H,Pe=P*J,Ee=R*$,Ce=R*H,$e=R*J;return x[0]=1-ne-Pe,x[1]=Z+$e,x[2]=le-Ce,x[3]=0,x[4]=Z-$e,x[5]=1-ee-Pe,x[6]=fe+Ee,x[7]=0,x[8]=le+Ce,x[9]=fe-Ee,x[10]=1-ee-ne,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Ve.frustum=function(x,E,k,M,P,R,$){var H=1/(k-E),J=1/(P-M),ee=1/(R-$);return x[0]=2*R*H,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=2*R*J,x[6]=0,x[7]=0,x[8]=(k+E)*H,x[9]=(P+M)*J,x[10]=($+R)*ee,x[11]=-1,x[12]=0,x[13]=0,x[14]=$*R*2*ee,x[15]=0,x},Ve.perspectiveNO=w,Ve.perspectiveZO=function(x,E,k,M,P){var R,$=1/Math.tan(E/2);return x[0]=$/k,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=$,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,P!=null&&P!==1/0?(x[10]=P*(R=1/(M-P)),x[14]=P*M*R):(x[10]=-1,x[14]=-M),x},Ve.perspectiveFromFieldOfView=function(x,E,k,M){var P=Math.tan(E.upDegrees*Math.PI/180),R=Math.tan(E.downDegrees*Math.PI/180),$=Math.tan(E.leftDegrees*Math.PI/180),H=Math.tan(E.rightDegrees*Math.PI/180),J=2/($+H),ee=2/(P+R);return x[0]=J,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=ee,x[6]=0,x[7]=0,x[8]=-($-H)*J*.5,x[9]=(P-R)*ee*.5,x[10]=M/(k-M),x[11]=-1,x[12]=0,x[13]=0,x[14]=M*k/(k-M),x[15]=0,x},Ve.orthoNO=C,Ve.orthoZO=function(x,E,k,M,P,R,$){var H=1/(E-k),J=1/(M-P),ee=1/(R-$);return x[0]=-2*H,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*J,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=ee,x[11]=0,x[12]=(E+k)*H,x[13]=(P+M)*J,x[14]=R*ee,x[15]=1,x},Ve.lookAt=function(x,E,k,M){var P,R,$,H,J,ee,Z,ne,le,fe,Pe=E[0],Ee=E[1],Ce=E[2],$e=M[0],Ie=M[1],Ge=M[2],Ze=k[0],qe=k[1],et=k[2];return Math.abs(Pe-Ze)<e.EPSILON&&Math.abs(Ee-qe)<e.EPSILON&&Math.abs(Ce-et)<e.EPSILON?o(x):(Z=Pe-Ze,ne=Ee-qe,le=Ce-et,P=Ie*(le*=fe=1/Math.hypot(Z,ne,le))-Ge*(ne*=fe),R=Ge*(Z*=fe)-$e*le,$=$e*ne-Ie*Z,(fe=Math.hypot(P,R,$))?(P*=fe=1/fe,R*=fe,$*=fe):(P=0,R=0,$=0),H=ne*$-le*R,J=le*P-Z*$,ee=Z*R-ne*P,(fe=Math.hypot(H,J,ee))?(H*=fe=1/fe,J*=fe,ee*=fe):(H=0,J=0,ee=0),x[0]=P,x[1]=H,x[2]=Z,x[3]=0,x[4]=R,x[5]=J,x[6]=ne,x[7]=0,x[8]=$,x[9]=ee,x[10]=le,x[11]=0,x[12]=-(P*Pe+R*Ee+$*Ce),x[13]=-(H*Pe+J*Ee+ee*Ce),x[14]=-(Z*Pe+ne*Ee+le*Ce),x[15]=1,x)},Ve.targetTo=function(x,E,k,M){var P=E[0],R=E[1],$=E[2],H=M[0],J=M[1],ee=M[2],Z=P-k[0],ne=R-k[1],le=$-k[2],fe=Z*Z+ne*ne+le*le;fe>0&&(Z*=fe=1/Math.sqrt(fe),ne*=fe,le*=fe);var Pe=J*le-ee*ne,Ee=ee*Z-H*le,Ce=H*ne-J*Z;return(fe=Pe*Pe+Ee*Ee+Ce*Ce)>0&&(Pe*=fe=1/Math.sqrt(fe),Ee*=fe,Ce*=fe),x[0]=Pe,x[1]=Ee,x[2]=Ce,x[3]=0,x[4]=ne*Ce-le*Ee,x[5]=le*Pe-Z*Ce,x[6]=Z*Ee-ne*Pe,x[7]=0,x[8]=Z,x[9]=ne,x[10]=le,x[11]=0,x[12]=P,x[13]=R,x[14]=$,x[15]=1,x},Ve.str=function(x){return"mat4("+x[0]+", "+x[1]+", "+x[2]+", "+x[3]+", "+x[4]+", "+x[5]+", "+x[6]+", "+x[7]+", "+x[8]+", "+x[9]+", "+x[10]+", "+x[11]+", "+x[12]+", "+x[13]+", "+x[14]+", "+x[15]+")"},Ve.frob=function(x){return Math.hypot(x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8],x[9],x[10],x[11],x[12],x[13],x[14],x[15])},Ve.add=function(x,E,k){return x[0]=E[0]+k[0],x[1]=E[1]+k[1],x[2]=E[2]+k[2],x[3]=E[3]+k[3],x[4]=E[4]+k[4],x[5]=E[5]+k[5],x[6]=E[6]+k[6],x[7]=E[7]+k[7],x[8]=E[8]+k[8],x[9]=E[9]+k[9],x[10]=E[10]+k[10],x[11]=E[11]+k[11],x[12]=E[12]+k[12],x[13]=E[13]+k[13],x[14]=E[14]+k[14],x[15]=E[15]+k[15],x},Ve.subtract=O,Ve.multiplyScalar=function(x,E,k){return x[0]=E[0]*k,x[1]=E[1]*k,x[2]=E[2]*k,x[3]=E[3]*k,x[4]=E[4]*k,x[5]=E[5]*k,x[6]=E[6]*k,x[7]=E[7]*k,x[8]=E[8]*k,x[9]=E[9]*k,x[10]=E[10]*k,x[11]=E[11]*k,x[12]=E[12]*k,x[13]=E[13]*k,x[14]=E[14]*k,x[15]=E[15]*k,x},Ve.multiplyScalarAndAdd=function(x,E,k,M){return x[0]=E[0]+k[0]*M,x[1]=E[1]+k[1]*M,x[2]=E[2]+k[2]*M,x[3]=E[3]+k[3]*M,x[4]=E[4]+k[4]*M,x[5]=E[5]+k[5]*M,x[6]=E[6]+k[6]*M,x[7]=E[7]+k[7]*M,x[8]=E[8]+k[8]*M,x[9]=E[9]+k[9]*M,x[10]=E[10]+k[10]*M,x[11]=E[11]+k[11]*M,x[12]=E[12]+k[12]*M,x[13]=E[13]+k[13]*M,x[14]=E[14]+k[14]*M,x[15]=E[15]+k[15]*M,x},Ve.exactEquals=function(x,E){return x[0]===E[0]&&x[1]===E[1]&&x[2]===E[2]&&x[3]===E[3]&&x[4]===E[4]&&x[5]===E[5]&&x[6]===E[6]&&x[7]===E[7]&&x[8]===E[8]&&x[9]===E[9]&&x[10]===E[10]&&x[11]===E[11]&&x[12]===E[12]&&x[13]===E[13]&&x[14]===E[14]&&x[15]===E[15]},Ve.equals=function(x,E){var k=x[0],M=x[1],P=x[2],R=x[3],$=x[4],H=x[5],J=x[6],ee=x[7],Z=x[8],ne=x[9],le=x[10],fe=x[11],Pe=x[12],Ee=x[13],Ce=x[14],$e=x[15],Ie=E[0],Ge=E[1],Ze=E[2],qe=E[3],et=E[4],nt=E[5],ct=E[6],it=E[7],Et=E[8],Nt=E[9],Ct=E[10],si=E[11],ti=E[12],Ht=E[13],Ut=E[14],xi=E[15];return Math.abs(k-Ie)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(Ie))&&Math.abs(M-Ge)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(Ge))&&Math.abs(P-Ze)<=e.EPSILON*Math.max(1,Math.abs(P),Math.abs(Ze))&&Math.abs(R-qe)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(qe))&&Math.abs($-et)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(et))&&Math.abs(H-nt)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(nt))&&Math.abs(J-ct)<=e.EPSILON*Math.max(1,Math.abs(J),Math.abs(ct))&&Math.abs(ee-it)<=e.EPSILON*Math.max(1,Math.abs(ee),Math.abs(it))&&Math.abs(Z-Et)<=e.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Et))&&Math.abs(ne-Nt)<=e.EPSILON*Math.max(1,Math.abs(ne),Math.abs(Nt))&&Math.abs(le-Ct)<=e.EPSILON*Math.max(1,Math.abs(le),Math.abs(Ct))&&Math.abs(fe-si)<=e.EPSILON*Math.max(1,Math.abs(fe),Math.abs(si))&&Math.abs(Pe-ti)<=e.EPSILON*Math.max(1,Math.abs(Pe),Math.abs(ti))&&Math.abs(Ee-Ht)<=e.EPSILON*Math.max(1,Math.abs(Ee),Math.abs(Ht))&&Math.abs(Ce-Ut)<=e.EPSILON*Math.max(1,Math.abs(Ce),Math.abs(Ut))&&Math.abs($e-xi)<=e.EPSILON*Math.max(1,Math.abs($e),Math.abs(xi))},Ve.sub=Ve.mul=Ve.ortho=Ve.perspective=void 0;var e=function(x,E){if(x&&x.__esModule)return x;if(x===null||s(x)!=="object"&&typeof x!="function")return{default:x};var k=i(void 0);if(k&&k.has(x))return k.get(x);var M={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var R in x)if(R!=="default"&&Object.prototype.hasOwnProperty.call(x,R)){var $=P?Object.getOwnPropertyDescriptor(x,R):null;$&&($.get||$.set)?Object.defineProperty(M,R,$):M[R]=x[R]}return M.default=x,k&&k.set(x,M),M}(ve());function i(x){if(typeof WeakMap!="function")return null;var E=new WeakMap,k=new WeakMap;return(i=function(M){return M?k:E})(x)}function o(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x}function p(x,E,k){var M=E[0],P=E[1],R=E[2],$=E[3],H=E[4],J=E[5],ee=E[6],Z=E[7],ne=E[8],le=E[9],fe=E[10],Pe=E[11],Ee=E[12],Ce=E[13],$e=E[14],Ie=E[15],Ge=k[0],Ze=k[1],qe=k[2],et=k[3];return x[0]=Ge*M+Ze*H+qe*ne+et*Ee,x[1]=Ge*P+Ze*J+qe*le+et*Ce,x[2]=Ge*R+Ze*ee+qe*fe+et*$e,x[3]=Ge*$+Ze*Z+qe*Pe+et*Ie,x[4]=(Ge=k[4])*M+(Ze=k[5])*H+(qe=k[6])*ne+(et=k[7])*Ee,x[5]=Ge*P+Ze*J+qe*le+et*Ce,x[6]=Ge*R+Ze*ee+qe*fe+et*$e,x[7]=Ge*$+Ze*Z+qe*Pe+et*Ie,x[8]=(Ge=k[8])*M+(Ze=k[9])*H+(qe=k[10])*ne+(et=k[11])*Ee,x[9]=Ge*P+Ze*J+qe*le+et*Ce,x[10]=Ge*R+Ze*ee+qe*fe+et*$e,x[11]=Ge*$+Ze*Z+qe*Pe+et*Ie,x[12]=(Ge=k[12])*M+(Ze=k[13])*H+(qe=k[14])*ne+(et=k[15])*Ee,x[13]=Ge*P+Ze*J+qe*le+et*Ce,x[14]=Ge*R+Ze*ee+qe*fe+et*$e,x[15]=Ge*$+Ze*Z+qe*Pe+et*Ie,x}function l(x,E,k){var M=E[0],P=E[1],R=E[2],$=E[3],H=M+M,J=P+P,ee=R+R,Z=M*H,ne=M*J,le=M*ee,fe=P*J,Pe=P*ee,Ee=R*ee,Ce=$*H,$e=$*J,Ie=$*ee;return x[0]=1-(fe+Ee),x[1]=ne+Ie,x[2]=le-$e,x[3]=0,x[4]=ne-Ie,x[5]=1-(Z+Ee),x[6]=Pe+Ce,x[7]=0,x[8]=le+$e,x[9]=Pe-Ce,x[10]=1-(Z+fe),x[11]=0,x[12]=k[0],x[13]=k[1],x[14]=k[2],x[15]=1,x}function f(x,E){var k=E[4],M=E[5],P=E[6],R=E[8],$=E[9],H=E[10];return x[0]=Math.hypot(E[0],E[1],E[2]),x[1]=Math.hypot(k,M,P),x[2]=Math.hypot(R,$,H),x}function w(x,E,k,M,P){var R,$=1/Math.tan(E/2);return x[0]=$/k,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=$,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,P!=null&&P!==1/0?(x[10]=(P+M)*(R=1/(M-P)),x[14]=2*P*M*R):(x[10]=-1,x[14]=-2*M),x}function C(x,E,k,M,P,R,$){var H=1/(E-k),J=1/(M-P),ee=1/(R-$);return x[0]=-2*H,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*J,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=2*ee,x[11]=0,x[12]=(E+k)*H,x[13]=(P+M)*J,x[14]=($+R)*ee,x[15]=1,x}function O(x,E,k){return x[0]=E[0]-k[0],x[1]=E[1]-k[1],x[2]=E[2]-k[2],x[3]=E[3]-k[3],x[4]=E[4]-k[4],x[5]=E[5]-k[5],x[6]=E[6]-k[6],x[7]=E[7]-k[7],x[8]=E[8]-k[8],x[9]=E[9]-k[9],x[10]=E[10]-k[10],x[11]=E[11]-k[11],x[12]=E[12]-k[12],x[13]=E[13]-k[13],x[14]=E[14]-k[14],x[15]=E[15]-k[15],x}return Ve.perspective=w,Ve.ortho=C,Ve.mul=p,Ve.sub=O,Ve}var qt,Me={},gt={};function oi(){if(qt)return gt;function s(P){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},s(P)}qt=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.create=o,gt.clone=function(P){var R=new e.ARRAY_TYPE(3);return R[0]=P[0],R[1]=P[1],R[2]=P[2],R},gt.length=p,gt.fromValues=function(P,R,$){var H=new e.ARRAY_TYPE(3);return H[0]=P,H[1]=R,H[2]=$,H},gt.copy=function(P,R){return P[0]=R[0],P[1]=R[1],P[2]=R[2],P},gt.set=function(P,R,$,H){return P[0]=R,P[1]=$,P[2]=H,P},gt.add=function(P,R,$){return P[0]=R[0]+$[0],P[1]=R[1]+$[1],P[2]=R[2]+$[2],P},gt.subtract=l,gt.multiply=f,gt.divide=w,gt.ceil=function(P,R){return P[0]=Math.ceil(R[0]),P[1]=Math.ceil(R[1]),P[2]=Math.ceil(R[2]),P},gt.floor=function(P,R){return P[0]=Math.floor(R[0]),P[1]=Math.floor(R[1]),P[2]=Math.floor(R[2]),P},gt.min=function(P,R,$){return P[0]=Math.min(R[0],$[0]),P[1]=Math.min(R[1],$[1]),P[2]=Math.min(R[2],$[2]),P},gt.max=function(P,R,$){return P[0]=Math.max(R[0],$[0]),P[1]=Math.max(R[1],$[1]),P[2]=Math.max(R[2],$[2]),P},gt.round=function(P,R){return P[0]=Math.round(R[0]),P[1]=Math.round(R[1]),P[2]=Math.round(R[2]),P},gt.scale=function(P,R,$){return P[0]=R[0]*$,P[1]=R[1]*$,P[2]=R[2]*$,P},gt.scaleAndAdd=function(P,R,$,H){return P[0]=R[0]+$[0]*H,P[1]=R[1]+$[1]*H,P[2]=R[2]+$[2]*H,P},gt.distance=C,gt.squaredDistance=O,gt.squaredLength=x,gt.negate=function(P,R){return P[0]=-R[0],P[1]=-R[1],P[2]=-R[2],P},gt.inverse=function(P,R){return P[0]=1/R[0],P[1]=1/R[1],P[2]=1/R[2],P},gt.normalize=function(P,R){var $=R[0],H=R[1],J=R[2],ee=$*$+H*H+J*J;return ee>0&&(ee=1/Math.sqrt(ee)),P[0]=R[0]*ee,P[1]=R[1]*ee,P[2]=R[2]*ee,P},gt.dot=E,gt.cross=function(P,R,$){var H=R[0],J=R[1],ee=R[2],Z=$[0],ne=$[1],le=$[2];return P[0]=J*le-ee*ne,P[1]=ee*Z-H*le,P[2]=H*ne-J*Z,P},gt.lerp=function(P,R,$,H){var J=R[0],ee=R[1],Z=R[2];return P[0]=J+H*($[0]-J),P[1]=ee+H*($[1]-ee),P[2]=Z+H*($[2]-Z),P},gt.hermite=function(P,R,$,H,J,ee){var Z=ee*ee,ne=Z*(2*ee-3)+1,le=Z*(ee-2)+ee,fe=Z*(ee-1),Pe=Z*(3-2*ee);return P[0]=R[0]*ne+$[0]*le+H[0]*fe+J[0]*Pe,P[1]=R[1]*ne+$[1]*le+H[1]*fe+J[1]*Pe,P[2]=R[2]*ne+$[2]*le+H[2]*fe+J[2]*Pe,P},gt.bezier=function(P,R,$,H,J,ee){var Z=1-ee,ne=Z*Z,le=ee*ee,fe=ne*Z,Pe=3*ee*ne,Ee=3*le*Z,Ce=le*ee;return P[0]=R[0]*fe+$[0]*Pe+H[0]*Ee+J[0]*Ce,P[1]=R[1]*fe+$[1]*Pe+H[1]*Ee+J[1]*Ce,P[2]=R[2]*fe+$[2]*Pe+H[2]*Ee+J[2]*Ce,P},gt.random=function(P,R){R=R||1;var $=2*e.RANDOM()*Math.PI,H=2*e.RANDOM()-1,J=Math.sqrt(1-H*H)*R;return P[0]=Math.cos($)*J,P[1]=Math.sin($)*J,P[2]=H*R,P},gt.transformMat4=function(P,R,$){var H=R[0],J=R[1],ee=R[2],Z=$[3]*H+$[7]*J+$[11]*ee+$[15];return P[0]=($[0]*H+$[4]*J+$[8]*ee+$[12])/(Z=Z||1),P[1]=($[1]*H+$[5]*J+$[9]*ee+$[13])/Z,P[2]=($[2]*H+$[6]*J+$[10]*ee+$[14])/Z,P},gt.transformMat3=function(P,R,$){var H=R[0],J=R[1],ee=R[2];return P[0]=H*$[0]+J*$[3]+ee*$[6],P[1]=H*$[1]+J*$[4]+ee*$[7],P[2]=H*$[2]+J*$[5]+ee*$[8],P},gt.transformQuat=function(P,R,$){var H=$[0],J=$[1],ee=$[2],Z=R[0],ne=R[1],le=R[2],fe=J*le-ee*ne,Pe=ee*Z-H*le,Ee=H*ne-J*Z,Ce=J*Ee-ee*Pe,$e=ee*fe-H*Ee,Ie=H*Pe-J*fe,Ge=2*$[3];return Pe*=Ge,Ee*=Ge,$e*=2,Ie*=2,P[0]=Z+(fe*=Ge)+(Ce*=2),P[1]=ne+Pe+$e,P[2]=le+Ee+Ie,P},gt.rotateX=function(P,R,$,H){var J=[],ee=[];return J[0]=R[0]-$[0],J[1]=R[1]-$[1],J[2]=R[2]-$[2],ee[0]=J[0],ee[1]=J[1]*Math.cos(H)-J[2]*Math.sin(H),ee[2]=J[1]*Math.sin(H)+J[2]*Math.cos(H),P[0]=ee[0]+$[0],P[1]=ee[1]+$[1],P[2]=ee[2]+$[2],P},gt.rotateY=function(P,R,$,H){var J=[],ee=[];return J[0]=R[0]-$[0],J[1]=R[1]-$[1],J[2]=R[2]-$[2],ee[0]=J[2]*Math.sin(H)+J[0]*Math.cos(H),ee[1]=J[1],ee[2]=J[2]*Math.cos(H)-J[0]*Math.sin(H),P[0]=ee[0]+$[0],P[1]=ee[1]+$[1],P[2]=ee[2]+$[2],P},gt.rotateZ=function(P,R,$,H){var J=[],ee=[];return J[0]=R[0]-$[0],J[1]=R[1]-$[1],J[2]=R[2]-$[2],ee[0]=J[0]*Math.cos(H)-J[1]*Math.sin(H),ee[1]=J[0]*Math.sin(H)+J[1]*Math.cos(H),ee[2]=J[2],P[0]=ee[0]+$[0],P[1]=ee[1]+$[1],P[2]=ee[2]+$[2],P},gt.angle=function(P,R){var $=P[0],H=P[1],J=P[2],ee=R[0],Z=R[1],ne=R[2],le=Math.sqrt($*$+H*H+J*J)*Math.sqrt(ee*ee+Z*Z+ne*ne),fe=le&&E(P,R)/le;return Math.acos(Math.min(Math.max(fe,-1),1))},gt.zero=function(P){return P[0]=0,P[1]=0,P[2]=0,P},gt.str=function(P){return"vec3("+P[0]+", "+P[1]+", "+P[2]+")"},gt.exactEquals=function(P,R){return P[0]===R[0]&&P[1]===R[1]&&P[2]===R[2]},gt.equals=function(P,R){var $=P[0],H=P[1],J=P[2],ee=R[0],Z=R[1],ne=R[2];return Math.abs($-ee)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(ee))&&Math.abs(H-Z)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(Z))&&Math.abs(J-ne)<=e.EPSILON*Math.max(1,Math.abs(J),Math.abs(ne))},gt.forEach=gt.sqrLen=gt.len=gt.sqrDist=gt.dist=gt.div=gt.mul=gt.sub=void 0;var e=function(P,R){if(P&&P.__esModule)return P;if(P===null||s(P)!=="object"&&typeof P!="function")return{default:P};var $=i(void 0);if($&&$.has(P))return $.get(P);var H={},J=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ee in P)if(ee!=="default"&&Object.prototype.hasOwnProperty.call(P,ee)){var Z=J?Object.getOwnPropertyDescriptor(P,ee):null;Z&&(Z.get||Z.set)?Object.defineProperty(H,ee,Z):H[ee]=P[ee]}return H.default=P,$&&$.set(P,H),H}(ve());function i(P){if(typeof WeakMap!="function")return null;var R=new WeakMap,$=new WeakMap;return(i=function(H){return H?$:R})(P)}function o(){var P=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(P[0]=0,P[1]=0,P[2]=0),P}function p(P){return Math.hypot(P[0],P[1],P[2])}function l(P,R,$){return P[0]=R[0]-$[0],P[1]=R[1]-$[1],P[2]=R[2]-$[2],P}function f(P,R,$){return P[0]=R[0]*$[0],P[1]=R[1]*$[1],P[2]=R[2]*$[2],P}function w(P,R,$){return P[0]=R[0]/$[0],P[1]=R[1]/$[1],P[2]=R[2]/$[2],P}function C(P,R){return Math.hypot(R[0]-P[0],R[1]-P[1],R[2]-P[2])}function O(P,R){var $=R[0]-P[0],H=R[1]-P[1],J=R[2]-P[2];return $*$+H*H+J*J}function x(P){var R=P[0],$=P[1],H=P[2];return R*R+$*$+H*H}function E(P,R){return P[0]*R[0]+P[1]*R[1]+P[2]*R[2]}gt.sub=l,gt.mul=f,gt.div=w,gt.dist=C,gt.sqrDist=O,gt.len=p,gt.sqrLen=x;var k,M=(k=o(),function(P,R,$,H,J,ee){var Z,ne;for(R||(R=3),$||($=0),ne=H?Math.min(H*R+$,P.length):P.length,Z=$;Z<ne;Z+=R)k[0]=P[Z],k[1]=P[Z+1],k[2]=P[Z+2],J(k,k,ee),P[Z]=k[0],P[Z+1]=k[1],P[Z+2]=k[2];return P});return gt.forEach=M,gt}var Ti,ni,Mt={};function zt(){if(Ti)return Mt;function s(M){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},s(M)}Ti=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.create=o,Mt.clone=function(M){var P=new e.ARRAY_TYPE(4);return P[0]=M[0],P[1]=M[1],P[2]=M[2],P[3]=M[3],P},Mt.fromValues=function(M,P,R,$){var H=new e.ARRAY_TYPE(4);return H[0]=M,H[1]=P,H[2]=R,H[3]=$,H},Mt.copy=function(M,P){return M[0]=P[0],M[1]=P[1],M[2]=P[2],M[3]=P[3],M},Mt.set=function(M,P,R,$,H){return M[0]=P,M[1]=R,M[2]=$,M[3]=H,M},Mt.add=function(M,P,R){return M[0]=P[0]+R[0],M[1]=P[1]+R[1],M[2]=P[2]+R[2],M[3]=P[3]+R[3],M},Mt.subtract=p,Mt.multiply=l,Mt.divide=f,Mt.ceil=function(M,P){return M[0]=Math.ceil(P[0]),M[1]=Math.ceil(P[1]),M[2]=Math.ceil(P[2]),M[3]=Math.ceil(P[3]),M},Mt.floor=function(M,P){return M[0]=Math.floor(P[0]),M[1]=Math.floor(P[1]),M[2]=Math.floor(P[2]),M[3]=Math.floor(P[3]),M},Mt.min=function(M,P,R){return M[0]=Math.min(P[0],R[0]),M[1]=Math.min(P[1],R[1]),M[2]=Math.min(P[2],R[2]),M[3]=Math.min(P[3],R[3]),M},Mt.max=function(M,P,R){return M[0]=Math.max(P[0],R[0]),M[1]=Math.max(P[1],R[1]),M[2]=Math.max(P[2],R[2]),M[3]=Math.max(P[3],R[3]),M},Mt.round=function(M,P){return M[0]=Math.round(P[0]),M[1]=Math.round(P[1]),M[2]=Math.round(P[2]),M[3]=Math.round(P[3]),M},Mt.scale=function(M,P,R){return M[0]=P[0]*R,M[1]=P[1]*R,M[2]=P[2]*R,M[3]=P[3]*R,M},Mt.scaleAndAdd=function(M,P,R,$){return M[0]=P[0]+R[0]*$,M[1]=P[1]+R[1]*$,M[2]=P[2]+R[2]*$,M[3]=P[3]+R[3]*$,M},Mt.distance=w,Mt.squaredDistance=C,Mt.length=O,Mt.squaredLength=x,Mt.negate=function(M,P){return M[0]=-P[0],M[1]=-P[1],M[2]=-P[2],M[3]=-P[3],M},Mt.inverse=function(M,P){return M[0]=1/P[0],M[1]=1/P[1],M[2]=1/P[2],M[3]=1/P[3],M},Mt.normalize=function(M,P){var R=P[0],$=P[1],H=P[2],J=P[3],ee=R*R+$*$+H*H+J*J;return ee>0&&(ee=1/Math.sqrt(ee)),M[0]=R*ee,M[1]=$*ee,M[2]=H*ee,M[3]=J*ee,M},Mt.dot=function(M,P){return M[0]*P[0]+M[1]*P[1]+M[2]*P[2]+M[3]*P[3]},Mt.cross=function(M,P,R,$){var H=R[0]*$[1]-R[1]*$[0],J=R[0]*$[2]-R[2]*$[0],ee=R[0]*$[3]-R[3]*$[0],Z=R[1]*$[2]-R[2]*$[1],ne=R[1]*$[3]-R[3]*$[1],le=R[2]*$[3]-R[3]*$[2],fe=P[0],Pe=P[1],Ee=P[2],Ce=P[3];return M[0]=Pe*le-Ee*ne+Ce*Z,M[1]=-fe*le+Ee*ee-Ce*J,M[2]=fe*ne-Pe*ee+Ce*H,M[3]=-fe*Z+Pe*J-Ee*H,M},Mt.lerp=function(M,P,R,$){var H=P[0],J=P[1],ee=P[2],Z=P[3];return M[0]=H+$*(R[0]-H),M[1]=J+$*(R[1]-J),M[2]=ee+$*(R[2]-ee),M[3]=Z+$*(R[3]-Z),M},Mt.random=function(M,P){var R,$,H,J,ee,Z;P=P||1;do ee=(R=2*e.RANDOM()-1)*R+($=2*e.RANDOM()-1)*$;while(ee>=1);do Z=(H=2*e.RANDOM()-1)*H+(J=2*e.RANDOM()-1)*J;while(Z>=1);var ne=Math.sqrt((1-ee)/Z);return M[0]=P*R,M[1]=P*$,M[2]=P*H*ne,M[3]=P*J*ne,M},Mt.transformMat4=function(M,P,R){var $=P[0],H=P[1],J=P[2],ee=P[3];return M[0]=R[0]*$+R[4]*H+R[8]*J+R[12]*ee,M[1]=R[1]*$+R[5]*H+R[9]*J+R[13]*ee,M[2]=R[2]*$+R[6]*H+R[10]*J+R[14]*ee,M[3]=R[3]*$+R[7]*H+R[11]*J+R[15]*ee,M},Mt.transformQuat=function(M,P,R){var $=P[0],H=P[1],J=P[2],ee=R[0],Z=R[1],ne=R[2],le=R[3],fe=le*$+Z*J-ne*H,Pe=le*H+ne*$-ee*J,Ee=le*J+ee*H-Z*$,Ce=-ee*$-Z*H-ne*J;return M[0]=fe*le+Ce*-ee+Pe*-ne-Ee*-Z,M[1]=Pe*le+Ce*-Z+Ee*-ee-fe*-ne,M[2]=Ee*le+Ce*-ne+fe*-Z-Pe*-ee,M[3]=P[3],M},Mt.zero=function(M){return M[0]=0,M[1]=0,M[2]=0,M[3]=0,M},Mt.str=function(M){return"vec4("+M[0]+", "+M[1]+", "+M[2]+", "+M[3]+")"},Mt.exactEquals=function(M,P){return M[0]===P[0]&&M[1]===P[1]&&M[2]===P[2]&&M[3]===P[3]},Mt.equals=function(M,P){var R=M[0],$=M[1],H=M[2],J=M[3],ee=P[0],Z=P[1],ne=P[2],le=P[3];return Math.abs(R-ee)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(ee))&&Math.abs($-Z)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(Z))&&Math.abs(H-ne)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(ne))&&Math.abs(J-le)<=e.EPSILON*Math.max(1,Math.abs(J),Math.abs(le))},Mt.forEach=Mt.sqrLen=Mt.len=Mt.sqrDist=Mt.dist=Mt.div=Mt.mul=Mt.sub=void 0;var e=function(M,P){if(M&&M.__esModule)return M;if(M===null||s(M)!=="object"&&typeof M!="function")return{default:M};var R=i(void 0);if(R&&R.has(M))return R.get(M);var $={},H=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var J in M)if(J!=="default"&&Object.prototype.hasOwnProperty.call(M,J)){var ee=H?Object.getOwnPropertyDescriptor(M,J):null;ee&&(ee.get||ee.set)?Object.defineProperty($,J,ee):$[J]=M[J]}return $.default=M,R&&R.set(M,$),$}(ve());function i(M){if(typeof WeakMap!="function")return null;var P=new WeakMap,R=new WeakMap;return(i=function($){return $?R:P})(M)}function o(){var M=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0,M[3]=0),M}function p(M,P,R){return M[0]=P[0]-R[0],M[1]=P[1]-R[1],M[2]=P[2]-R[2],M[3]=P[3]-R[3],M}function l(M,P,R){return M[0]=P[0]*R[0],M[1]=P[1]*R[1],M[2]=P[2]*R[2],M[3]=P[3]*R[3],M}function f(M,P,R){return M[0]=P[0]/R[0],M[1]=P[1]/R[1],M[2]=P[2]/R[2],M[3]=P[3]/R[3],M}function w(M,P){return Math.hypot(P[0]-M[0],P[1]-M[1],P[2]-M[2],P[3]-M[3])}function C(M,P){var R=P[0]-M[0],$=P[1]-M[1],H=P[2]-M[2],J=P[3]-M[3];return R*R+$*$+H*H+J*J}function O(M){return Math.hypot(M[0],M[1],M[2],M[3])}function x(M){var P=M[0],R=M[1],$=M[2],H=M[3];return P*P+R*R+$*$+H*H}Mt.sub=p,Mt.mul=l,Mt.div=f,Mt.dist=w,Mt.sqrDist=C,Mt.len=O,Mt.sqrLen=x;var E,k=(E=o(),function(M,P,R,$,H,J){var ee,Z;for(P||(P=4),R||(R=0),Z=$?Math.min($*P+R,M.length):M.length,ee=R;ee<Z;ee+=P)E[0]=M[ee],E[1]=M[ee+1],E[2]=M[ee+2],E[3]=M[ee+3],H(E,E,J),M[ee]=E[0],M[ee+1]=E[1],M[ee+2]=E[2],M[ee+3]=E[3];return M});return Mt.forEach=k,Mt}function ii(){if(ni)return Me;function s(Ie){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Ge){return typeof Ge}:function(Ge){return Ge&&typeof Symbol=="function"&&Ge.constructor===Symbol&&Ge!==Symbol.prototype?"symbol":typeof Ge},s(Ie)}ni=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.create=w,Me.identity=function(Ie){return Ie[0]=0,Ie[1]=0,Ie[2]=0,Ie[3]=1,Ie},Me.setAxisAngle=C,Me.getAxisAngle=function(Ie,Ge){var Ze=2*Math.acos(Ge[3]),qe=Math.sin(Ze/2);return qe>e.EPSILON?(Ie[0]=Ge[0]/qe,Ie[1]=Ge[1]/qe,Ie[2]=Ge[2]/qe):(Ie[0]=1,Ie[1]=0,Ie[2]=0),Ze},Me.getAngle=function(Ie,Ge){var Ze=R(Ie,Ge);return Math.acos(2*Ze*Ze-1)},Me.multiply=O,Me.rotateX=function(Ie,Ge,Ze){Ze*=.5;var qe=Ge[0],et=Ge[1],nt=Ge[2],ct=Ge[3],it=Math.sin(Ze),Et=Math.cos(Ze);return Ie[0]=qe*Et+ct*it,Ie[1]=et*Et+nt*it,Ie[2]=nt*Et-et*it,Ie[3]=ct*Et-qe*it,Ie},Me.rotateY=function(Ie,Ge,Ze){Ze*=.5;var qe=Ge[0],et=Ge[1],nt=Ge[2],ct=Ge[3],it=Math.sin(Ze),Et=Math.cos(Ze);return Ie[0]=qe*Et-nt*it,Ie[1]=et*Et+ct*it,Ie[2]=nt*Et+qe*it,Ie[3]=ct*Et-et*it,Ie},Me.rotateZ=function(Ie,Ge,Ze){Ze*=.5;var qe=Ge[0],et=Ge[1],nt=Ge[2],ct=Ge[3],it=Math.sin(Ze),Et=Math.cos(Ze);return Ie[0]=qe*Et+et*it,Ie[1]=et*Et-qe*it,Ie[2]=nt*Et+ct*it,Ie[3]=ct*Et-nt*it,Ie},Me.calculateW=function(Ie,Ge){var Ze=Ge[0],qe=Ge[1],et=Ge[2];return Ie[0]=Ze,Ie[1]=qe,Ie[2]=et,Ie[3]=Math.sqrt(Math.abs(1-Ze*Ze-qe*qe-et*et)),Ie},Me.exp=x,Me.ln=E,Me.pow=function(Ie,Ge,Ze){return E(Ie,Ge),P(Ie,Ie,Ze),x(Ie,Ie),Ie},Me.slerp=k,Me.random=function(Ie){var Ge=e.RANDOM(),Ze=e.RANDOM(),qe=e.RANDOM(),et=Math.sqrt(1-Ge),nt=Math.sqrt(Ge);return Ie[0]=et*Math.sin(2*Math.PI*Ze),Ie[1]=et*Math.cos(2*Math.PI*Ze),Ie[2]=nt*Math.sin(2*Math.PI*qe),Ie[3]=nt*Math.cos(2*Math.PI*qe),Ie},Me.invert=function(Ie,Ge){var Ze=Ge[0],qe=Ge[1],et=Ge[2],nt=Ge[3],ct=Ze*Ze+qe*qe+et*et+nt*nt,it=ct?1/ct:0;return Ie[0]=-Ze*it,Ie[1]=-qe*it,Ie[2]=-et*it,Ie[3]=nt*it,Ie},Me.conjugate=function(Ie,Ge){return Ie[0]=-Ge[0],Ie[1]=-Ge[1],Ie[2]=-Ge[2],Ie[3]=Ge[3],Ie},Me.fromMat3=M,Me.fromEuler=function(Ie,Ge,Ze,qe){var et=.5*Math.PI/180;Ge*=et,Ze*=et,qe*=et;var nt=Math.sin(Ge),ct=Math.cos(Ge),it=Math.sin(Ze),Et=Math.cos(Ze),Nt=Math.sin(qe),Ct=Math.cos(qe);return Ie[0]=nt*Et*Ct-ct*it*Nt,Ie[1]=ct*it*Ct+nt*Et*Nt,Ie[2]=ct*Et*Nt-nt*it*Ct,Ie[3]=ct*Et*Ct+nt*it*Nt,Ie},Me.str=function(Ie){return"quat("+Ie[0]+", "+Ie[1]+", "+Ie[2]+", "+Ie[3]+")"},Me.setAxes=Me.sqlerp=Me.rotationTo=Me.equals=Me.exactEquals=Me.normalize=Me.sqrLen=Me.squaredLength=Me.len=Me.length=Me.lerp=Me.dot=Me.scale=Me.mul=Me.add=Me.set=Me.copy=Me.fromValues=Me.clone=void 0;var e=f(ve()),i=f(at()),o=f(oi()),p=f(zt());function l(Ie){if(typeof WeakMap!="function")return null;var Ge=new WeakMap,Ze=new WeakMap;return(l=function(qe){return qe?Ze:Ge})(Ie)}function f(Ie,Ge){if(Ie&&Ie.__esModule)return Ie;if(Ie===null||s(Ie)!=="object"&&typeof Ie!="function")return{default:Ie};var Ze=l(Ge);if(Ze&&Ze.has(Ie))return Ze.get(Ie);var qe={},et=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var nt in Ie)if(nt!=="default"&&Object.prototype.hasOwnProperty.call(Ie,nt)){var ct=et?Object.getOwnPropertyDescriptor(Ie,nt):null;ct&&(ct.get||ct.set)?Object.defineProperty(qe,nt,ct):qe[nt]=Ie[nt]}return qe.default=Ie,Ze&&Ze.set(Ie,qe),qe}function w(){var Ie=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(Ie[0]=0,Ie[1]=0,Ie[2]=0),Ie[3]=1,Ie}function C(Ie,Ge,Ze){Ze*=.5;var qe=Math.sin(Ze);return Ie[0]=qe*Ge[0],Ie[1]=qe*Ge[1],Ie[2]=qe*Ge[2],Ie[3]=Math.cos(Ze),Ie}function O(Ie,Ge,Ze){var qe=Ge[0],et=Ge[1],nt=Ge[2],ct=Ge[3],it=Ze[0],Et=Ze[1],Nt=Ze[2],Ct=Ze[3];return Ie[0]=qe*Ct+ct*it+et*Nt-nt*Et,Ie[1]=et*Ct+ct*Et+nt*it-qe*Nt,Ie[2]=nt*Ct+ct*Nt+qe*Et-et*it,Ie[3]=ct*Ct-qe*it-et*Et-nt*Nt,Ie}function x(Ie,Ge){var Ze=Ge[0],qe=Ge[1],et=Ge[2],nt=Ge[3],ct=Math.sqrt(Ze*Ze+qe*qe+et*et),it=Math.exp(nt),Et=ct>0?it*Math.sin(ct)/ct:0;return Ie[0]=Ze*Et,Ie[1]=qe*Et,Ie[2]=et*Et,Ie[3]=it*Math.cos(ct),Ie}function E(Ie,Ge){var Ze=Ge[0],qe=Ge[1],et=Ge[2],nt=Ge[3],ct=Math.sqrt(Ze*Ze+qe*qe+et*et),it=ct>0?Math.atan2(ct,nt)/ct:0;return Ie[0]=Ze*it,Ie[1]=qe*it,Ie[2]=et*it,Ie[3]=.5*Math.log(Ze*Ze+qe*qe+et*et+nt*nt),Ie}function k(Ie,Ge,Ze,qe){var et,nt,ct,it,Et,Nt=Ge[0],Ct=Ge[1],si=Ge[2],ti=Ge[3],Ht=Ze[0],Ut=Ze[1],xi=Ze[2],ui=Ze[3];return(nt=Nt*Ht+Ct*Ut+si*xi+ti*ui)<0&&(nt=-nt,Ht=-Ht,Ut=-Ut,xi=-xi,ui=-ui),1-nt>e.EPSILON?(et=Math.acos(nt),ct=Math.sin(et),it=Math.sin((1-qe)*et)/ct,Et=Math.sin(qe*et)/ct):(it=1-qe,Et=qe),Ie[0]=it*Nt+Et*Ht,Ie[1]=it*Ct+Et*Ut,Ie[2]=it*si+Et*xi,Ie[3]=it*ti+Et*ui,Ie}function M(Ie,Ge){var Ze,qe=Ge[0]+Ge[4]+Ge[8];if(qe>0)Ze=Math.sqrt(qe+1),Ie[3]=.5*Ze,Ie[0]=(Ge[5]-Ge[7])*(Ze=.5/Ze),Ie[1]=(Ge[6]-Ge[2])*Ze,Ie[2]=(Ge[1]-Ge[3])*Ze;else{var et=0;Ge[4]>Ge[0]&&(et=1),Ge[8]>Ge[3*et+et]&&(et=2);var nt=(et+1)%3,ct=(et+2)%3;Ze=Math.sqrt(Ge[3*et+et]-Ge[3*nt+nt]-Ge[3*ct+ct]+1),Ie[et]=.5*Ze,Ie[3]=(Ge[3*nt+ct]-Ge[3*ct+nt])*(Ze=.5/Ze),Ie[nt]=(Ge[3*nt+et]+Ge[3*et+nt])*Ze,Ie[ct]=(Ge[3*ct+et]+Ge[3*et+ct])*Ze}return Ie}Me.clone=p.clone,Me.fromValues=p.fromValues,Me.copy=p.copy,Me.set=p.set,Me.add=p.add,Me.mul=O;var P=p.scale;Me.scale=P;var R=p.dot;Me.dot=R,Me.lerp=p.lerp;var $=p.length;Me.length=$,Me.len=$;var H=p.squaredLength;Me.squaredLength=H,Me.sqrLen=H;var J=p.normalize;Me.normalize=J,Me.exactEquals=p.exactEquals,Me.equals=p.equals;var ee,Z,ne,le=(ee=o.create(),Z=o.fromValues(1,0,0),ne=o.fromValues(0,1,0),function(Ie,Ge,Ze){var qe=o.dot(Ge,Ze);return qe<-.999999?(o.cross(ee,Z,Ge),o.len(ee)<1e-6&&o.cross(ee,ne,Ge),o.normalize(ee,ee),C(Ie,ee,Math.PI),Ie):qe>.999999?(Ie[0]=0,Ie[1]=0,Ie[2]=0,Ie[3]=1,Ie):(o.cross(ee,Ge,Ze),Ie[0]=ee[0],Ie[1]=ee[1],Ie[2]=ee[2],Ie[3]=1+qe,J(Ie,Ie))});Me.rotationTo=le;var fe,Pe,Ee=(fe=w(),Pe=w(),function(Ie,Ge,Ze,qe,et,nt){return k(fe,Ge,et,nt),k(Pe,Ze,qe,nt),k(Ie,fe,Pe,2*nt*(1-nt)),Ie});Me.sqlerp=Ee;var Ce,$e=(Ce=i.create(),function(Ie,Ge,Ze,qe){return Ce[0]=Ze[0],Ce[3]=Ze[1],Ce[6]=Ze[2],Ce[1]=qe[0],Ce[4]=qe[1],Ce[7]=qe[2],Ce[2]=-Ge[0],Ce[5]=-Ge[1],Ce[8]=-Ge[2],J(Ie,M(Ie,Ce))});return Me.setAxes=$e,Me}var Yt,jt={};function Ri(){if(Yt)return jt;function s(k){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},s(k)}Yt=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.create=function(){var k=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(k[0]=0,k[1]=0,k[2]=0,k[4]=0,k[5]=0,k[6]=0,k[7]=0),k[3]=1,k},jt.clone=function(k){var M=new e.ARRAY_TYPE(8);return M[0]=k[0],M[1]=k[1],M[2]=k[2],M[3]=k[3],M[4]=k[4],M[5]=k[5],M[6]=k[6],M[7]=k[7],M},jt.fromValues=function(k,M,P,R,$,H,J,ee){var Z=new e.ARRAY_TYPE(8);return Z[0]=k,Z[1]=M,Z[2]=P,Z[3]=R,Z[4]=$,Z[5]=H,Z[6]=J,Z[7]=ee,Z},jt.fromRotationTranslationValues=function(k,M,P,R,$,H,J){var ee=new e.ARRAY_TYPE(8);ee[0]=k,ee[1]=M,ee[2]=P,ee[3]=R;var Z=.5*$,ne=.5*H,le=.5*J;return ee[4]=Z*R+ne*P-le*M,ee[5]=ne*R+le*k-Z*P,ee[6]=le*R+Z*M-ne*k,ee[7]=-Z*k-ne*M-le*P,ee},jt.fromRotationTranslation=f,jt.fromTranslation=function(k,M){return k[0]=0,k[1]=0,k[2]=0,k[3]=1,k[4]=.5*M[0],k[5]=.5*M[1],k[6]=.5*M[2],k[7]=0,k},jt.fromRotation=function(k,M){return k[0]=M[0],k[1]=M[1],k[2]=M[2],k[3]=M[3],k[4]=0,k[5]=0,k[6]=0,k[7]=0,k},jt.fromMat4=function(k,M){var P=i.create();o.getRotation(P,M);var R=new e.ARRAY_TYPE(3);return o.getTranslation(R,M),f(k,P,R),k},jt.copy=w,jt.identity=function(k){return k[0]=0,k[1]=0,k[2]=0,k[3]=1,k[4]=0,k[5]=0,k[6]=0,k[7]=0,k},jt.set=function(k,M,P,R,$,H,J,ee,Z){return k[0]=M,k[1]=P,k[2]=R,k[3]=$,k[4]=H,k[5]=J,k[6]=ee,k[7]=Z,k},jt.getDual=function(k,M){return k[0]=M[4],k[1]=M[5],k[2]=M[6],k[3]=M[7],k},jt.setDual=function(k,M){return k[4]=M[0],k[5]=M[1],k[6]=M[2],k[7]=M[3],k},jt.getTranslation=function(k,M){var P=M[4],R=M[5],$=M[6],H=M[7],J=-M[0],ee=-M[1],Z=-M[2],ne=M[3];return k[0]=2*(P*ne+H*J+R*Z-$*ee),k[1]=2*(R*ne+H*ee+$*J-P*Z),k[2]=2*($*ne+H*Z+P*ee-R*J),k},jt.translate=function(k,M,P){var R=M[0],$=M[1],H=M[2],J=M[3],ee=.5*P[0],Z=.5*P[1],ne=.5*P[2],le=M[4],fe=M[5],Pe=M[6],Ee=M[7];return k[0]=R,k[1]=$,k[2]=H,k[3]=J,k[4]=J*ee+$*ne-H*Z+le,k[5]=J*Z+H*ee-R*ne+fe,k[6]=J*ne+R*Z-$*ee+Pe,k[7]=-R*ee-$*Z-H*ne+Ee,k},jt.rotateX=function(k,M,P){var R=-M[0],$=-M[1],H=-M[2],J=M[3],ee=M[4],Z=M[5],ne=M[6],le=M[7],fe=ee*J+le*R+Z*H-ne*$,Pe=Z*J+le*$+ne*R-ee*H,Ee=ne*J+le*H+ee*$-Z*R,Ce=le*J-ee*R-Z*$-ne*H;return i.rotateX(k,M,P),k[4]=fe*(J=k[3])+Ce*(R=k[0])+Pe*(H=k[2])-Ee*($=k[1]),k[5]=Pe*J+Ce*$+Ee*R-fe*H,k[6]=Ee*J+Ce*H+fe*$-Pe*R,k[7]=Ce*J-fe*R-Pe*$-Ee*H,k},jt.rotateY=function(k,M,P){var R=-M[0],$=-M[1],H=-M[2],J=M[3],ee=M[4],Z=M[5],ne=M[6],le=M[7],fe=ee*J+le*R+Z*H-ne*$,Pe=Z*J+le*$+ne*R-ee*H,Ee=ne*J+le*H+ee*$-Z*R,Ce=le*J-ee*R-Z*$-ne*H;return i.rotateY(k,M,P),k[4]=fe*(J=k[3])+Ce*(R=k[0])+Pe*(H=k[2])-Ee*($=k[1]),k[5]=Pe*J+Ce*$+Ee*R-fe*H,k[6]=Ee*J+Ce*H+fe*$-Pe*R,k[7]=Ce*J-fe*R-Pe*$-Ee*H,k},jt.rotateZ=function(k,M,P){var R=-M[0],$=-M[1],H=-M[2],J=M[3],ee=M[4],Z=M[5],ne=M[6],le=M[7],fe=ee*J+le*R+Z*H-ne*$,Pe=Z*J+le*$+ne*R-ee*H,Ee=ne*J+le*H+ee*$-Z*R,Ce=le*J-ee*R-Z*$-ne*H;return i.rotateZ(k,M,P),k[4]=fe*(J=k[3])+Ce*(R=k[0])+Pe*(H=k[2])-Ee*($=k[1]),k[5]=Pe*J+Ce*$+Ee*R-fe*H,k[6]=Ee*J+Ce*H+fe*$-Pe*R,k[7]=Ce*J-fe*R-Pe*$-Ee*H,k},jt.rotateByQuatAppend=function(k,M,P){var R=P[0],$=P[1],H=P[2],J=P[3],ee=M[0],Z=M[1],ne=M[2],le=M[3];return k[0]=ee*J+le*R+Z*H-ne*$,k[1]=Z*J+le*$+ne*R-ee*H,k[2]=ne*J+le*H+ee*$-Z*R,k[3]=le*J-ee*R-Z*$-ne*H,k[4]=(ee=M[4])*J+(le=M[7])*R+(Z=M[5])*H-(ne=M[6])*$,k[5]=Z*J+le*$+ne*R-ee*H,k[6]=ne*J+le*H+ee*$-Z*R,k[7]=le*J-ee*R-Z*$-ne*H,k},jt.rotateByQuatPrepend=function(k,M,P){var R=M[0],$=M[1],H=M[2],J=M[3],ee=P[0],Z=P[1],ne=P[2],le=P[3];return k[0]=R*le+J*ee+$*ne-H*Z,k[1]=$*le+J*Z+H*ee-R*ne,k[2]=H*le+J*ne+R*Z-$*ee,k[3]=J*le-R*ee-$*Z-H*ne,k[4]=R*(le=P[7])+J*(ee=P[4])+$*(ne=P[6])-H*(Z=P[5]),k[5]=$*le+J*Z+H*ee-R*ne,k[6]=H*le+J*ne+R*Z-$*ee,k[7]=J*le-R*ee-$*Z-H*ne,k},jt.rotateAroundAxis=function(k,M,P,R){if(Math.abs(R)<e.EPSILON)return w(k,M);var $=Math.hypot(P[0],P[1],P[2]);R*=.5;var H=Math.sin(R),J=H*P[0]/$,ee=H*P[1]/$,Z=H*P[2]/$,ne=Math.cos(R),le=M[0],fe=M[1],Pe=M[2],Ee=M[3];k[0]=le*ne+Ee*J+fe*Z-Pe*ee,k[1]=fe*ne+Ee*ee+Pe*J-le*Z,k[2]=Pe*ne+Ee*Z+le*ee-fe*J,k[3]=Ee*ne-le*J-fe*ee-Pe*Z;var Ce=M[4],$e=M[5],Ie=M[6],Ge=M[7];return k[4]=Ce*ne+Ge*J+$e*Z-Ie*ee,k[5]=$e*ne+Ge*ee+Ie*J-Ce*Z,k[6]=Ie*ne+Ge*Z+Ce*ee-$e*J,k[7]=Ge*ne-Ce*J-$e*ee-Ie*Z,k},jt.add=function(k,M,P){return k[0]=M[0]+P[0],k[1]=M[1]+P[1],k[2]=M[2]+P[2],k[3]=M[3]+P[3],k[4]=M[4]+P[4],k[5]=M[5]+P[5],k[6]=M[6]+P[6],k[7]=M[7]+P[7],k},jt.multiply=C,jt.scale=function(k,M,P){return k[0]=M[0]*P,k[1]=M[1]*P,k[2]=M[2]*P,k[3]=M[3]*P,k[4]=M[4]*P,k[5]=M[5]*P,k[6]=M[6]*P,k[7]=M[7]*P,k},jt.lerp=function(k,M,P,R){var $=1-R;return O(M,P)<0&&(R=-R),k[0]=M[0]*$+P[0]*R,k[1]=M[1]*$+P[1]*R,k[2]=M[2]*$+P[2]*R,k[3]=M[3]*$+P[3]*R,k[4]=M[4]*$+P[4]*R,k[5]=M[5]*$+P[5]*R,k[6]=M[6]*$+P[6]*R,k[7]=M[7]*$+P[7]*R,k},jt.invert=function(k,M){var P=E(M);return k[0]=-M[0]/P,k[1]=-M[1]/P,k[2]=-M[2]/P,k[3]=M[3]/P,k[4]=-M[4]/P,k[5]=-M[5]/P,k[6]=-M[6]/P,k[7]=M[7]/P,k},jt.conjugate=function(k,M){return k[0]=-M[0],k[1]=-M[1],k[2]=-M[2],k[3]=M[3],k[4]=-M[4],k[5]=-M[5],k[6]=-M[6],k[7]=M[7],k},jt.normalize=function(k,M){var P=E(M);if(P>0){P=Math.sqrt(P);var R=M[0]/P,$=M[1]/P,H=M[2]/P,J=M[3]/P,ee=M[4],Z=M[5],ne=M[6],le=M[7],fe=R*ee+$*Z+H*ne+J*le;k[0]=R,k[1]=$,k[2]=H,k[3]=J,k[4]=(ee-R*fe)/P,k[5]=(Z-$*fe)/P,k[6]=(ne-H*fe)/P,k[7]=(le-J*fe)/P}return k},jt.str=function(k){return"quat2("+k[0]+", "+k[1]+", "+k[2]+", "+k[3]+", "+k[4]+", "+k[5]+", "+k[6]+", "+k[7]+")"},jt.exactEquals=function(k,M){return k[0]===M[0]&&k[1]===M[1]&&k[2]===M[2]&&k[3]===M[3]&&k[4]===M[4]&&k[5]===M[5]&&k[6]===M[6]&&k[7]===M[7]},jt.equals=function(k,M){var P=k[0],R=k[1],$=k[2],H=k[3],J=k[4],ee=k[5],Z=k[6],ne=k[7],le=M[0],fe=M[1],Pe=M[2],Ee=M[3],Ce=M[4],$e=M[5],Ie=M[6],Ge=M[7];return Math.abs(P-le)<=e.EPSILON*Math.max(1,Math.abs(P),Math.abs(le))&&Math.abs(R-fe)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(fe))&&Math.abs($-Pe)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(Pe))&&Math.abs(H-Ee)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(Ee))&&Math.abs(J-Ce)<=e.EPSILON*Math.max(1,Math.abs(J),Math.abs(Ce))&&Math.abs(ee-$e)<=e.EPSILON*Math.max(1,Math.abs(ee),Math.abs($e))&&Math.abs(Z-Ie)<=e.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Ie))&&Math.abs(ne-Ge)<=e.EPSILON*Math.max(1,Math.abs(ne),Math.abs(Ge))},jt.sqrLen=jt.squaredLength=jt.len=jt.length=jt.dot=jt.mul=jt.setReal=jt.getReal=void 0;var e=l(ve()),i=l(ii()),o=l(Tt());function p(k){if(typeof WeakMap!="function")return null;var M=new WeakMap,P=new WeakMap;return(p=function(R){return R?P:M})(k)}function l(k,M){if(k&&k.__esModule)return k;if(k===null||s(k)!=="object"&&typeof k!="function")return{default:k};var P=p(M);if(P&&P.has(k))return P.get(k);var R={},$=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var H in k)if(H!=="default"&&Object.prototype.hasOwnProperty.call(k,H)){var J=$?Object.getOwnPropertyDescriptor(k,H):null;J&&(J.get||J.set)?Object.defineProperty(R,H,J):R[H]=k[H]}return R.default=k,P&&P.set(k,R),R}function f(k,M,P){var R=.5*P[0],$=.5*P[1],H=.5*P[2],J=M[0],ee=M[1],Z=M[2],ne=M[3];return k[0]=J,k[1]=ee,k[2]=Z,k[3]=ne,k[4]=R*ne+$*Z-H*ee,k[5]=$*ne+H*J-R*Z,k[6]=H*ne+R*ee-$*J,k[7]=-R*J-$*ee-H*Z,k}function w(k,M){return k[0]=M[0],k[1]=M[1],k[2]=M[2],k[3]=M[3],k[4]=M[4],k[5]=M[5],k[6]=M[6],k[7]=M[7],k}function C(k,M,P){var R=M[0],$=M[1],H=M[2],J=M[3],ee=P[4],Z=P[5],ne=P[6],le=P[7],fe=M[4],Pe=M[5],Ee=M[6],Ce=M[7],$e=P[0],Ie=P[1],Ge=P[2],Ze=P[3];return k[0]=R*Ze+J*$e+$*Ge-H*Ie,k[1]=$*Ze+J*Ie+H*$e-R*Ge,k[2]=H*Ze+J*Ge+R*Ie-$*$e,k[3]=J*Ze-R*$e-$*Ie-H*Ge,k[4]=R*le+J*ee+$*ne-H*Z+fe*Ze+Ce*$e+Pe*Ge-Ee*Ie,k[5]=$*le+J*Z+H*ee-R*ne+Pe*Ze+Ce*Ie+Ee*$e-fe*Ge,k[6]=H*le+J*ne+R*Z-$*ee+Ee*Ze+Ce*Ge+fe*Ie-Pe*$e,k[7]=J*le-R*ee-$*Z-H*ne+Ce*Ze-fe*$e-Pe*Ie-Ee*Ge,k}jt.getReal=i.copy,jt.setReal=i.copy,jt.mul=C;var O=i.dot;jt.dot=O;var x=i.length;jt.length=x,jt.len=x;var E=i.squaredLength;return jt.squaredLength=E,jt.sqrLen=E,jt}var Yi,Wi,vi={};function Wr(){if(Yi)return vi;function s(M){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},s(M)}Yi=1,Object.defineProperty(vi,"__esModule",{value:!0}),vi.create=o,vi.clone=function(M){var P=new e.ARRAY_TYPE(2);return P[0]=M[0],P[1]=M[1],P},vi.fromValues=function(M,P){var R=new e.ARRAY_TYPE(2);return R[0]=M,R[1]=P,R},vi.copy=function(M,P){return M[0]=P[0],M[1]=P[1],M},vi.set=function(M,P,R){return M[0]=P,M[1]=R,M},vi.add=function(M,P,R){return M[0]=P[0]+R[0],M[1]=P[1]+R[1],M},vi.subtract=p,vi.multiply=l,vi.divide=f,vi.ceil=function(M,P){return M[0]=Math.ceil(P[0]),M[1]=Math.ceil(P[1]),M},vi.floor=function(M,P){return M[0]=Math.floor(P[0]),M[1]=Math.floor(P[1]),M},vi.min=function(M,P,R){return M[0]=Math.min(P[0],R[0]),M[1]=Math.min(P[1],R[1]),M},vi.max=function(M,P,R){return M[0]=Math.max(P[0],R[0]),M[1]=Math.max(P[1],R[1]),M},vi.round=function(M,P){return M[0]=Math.round(P[0]),M[1]=Math.round(P[1]),M},vi.scale=function(M,P,R){return M[0]=P[0]*R,M[1]=P[1]*R,M},vi.scaleAndAdd=function(M,P,R,$){return M[0]=P[0]+R[0]*$,M[1]=P[1]+R[1]*$,M},vi.distance=w,vi.squaredDistance=C,vi.length=O,vi.squaredLength=x,vi.negate=function(M,P){return M[0]=-P[0],M[1]=-P[1],M},vi.inverse=function(M,P){return M[0]=1/P[0],M[1]=1/P[1],M},vi.normalize=function(M,P){var R=P[0],$=P[1],H=R*R+$*$;return H>0&&(H=1/Math.sqrt(H)),M[0]=P[0]*H,M[1]=P[1]*H,M},vi.dot=function(M,P){return M[0]*P[0]+M[1]*P[1]},vi.cross=function(M,P,R){var $=P[0]*R[1]-P[1]*R[0];return M[0]=M[1]=0,M[2]=$,M},vi.lerp=function(M,P,R,$){var H=P[0],J=P[1];return M[0]=H+$*(R[0]-H),M[1]=J+$*(R[1]-J),M},vi.random=function(M,P){P=P||1;var R=2*e.RANDOM()*Math.PI;return M[0]=Math.cos(R)*P,M[1]=Math.sin(R)*P,M},vi.transformMat2=function(M,P,R){var $=P[0],H=P[1];return M[0]=R[0]*$+R[2]*H,M[1]=R[1]*$+R[3]*H,M},vi.transformMat2d=function(M,P,R){var $=P[0],H=P[1];return M[0]=R[0]*$+R[2]*H+R[4],M[1]=R[1]*$+R[3]*H+R[5],M},vi.transformMat3=function(M,P,R){var $=P[0],H=P[1];return M[0]=R[0]*$+R[3]*H+R[6],M[1]=R[1]*$+R[4]*H+R[7],M},vi.transformMat4=function(M,P,R){var $=P[0],H=P[1];return M[0]=R[0]*$+R[4]*H+R[12],M[1]=R[1]*$+R[5]*H+R[13],M},vi.rotate=function(M,P,R,$){var H=P[0]-R[0],J=P[1]-R[1],ee=Math.sin($),Z=Math.cos($);return M[0]=H*Z-J*ee+R[0],M[1]=H*ee+J*Z+R[1],M},vi.angle=function(M,P){var R=M[0],$=M[1],H=P[0],J=P[1],ee=Math.sqrt(R*R+$*$)*Math.sqrt(H*H+J*J);return Math.acos(Math.min(Math.max(ee&&(R*H+$*J)/ee,-1),1))},vi.zero=function(M){return M[0]=0,M[1]=0,M},vi.str=function(M){return"vec2("+M[0]+", "+M[1]+")"},vi.exactEquals=function(M,P){return M[0]===P[0]&&M[1]===P[1]},vi.equals=function(M,P){var R=M[0],$=M[1],H=P[0],J=P[1];return Math.abs(R-H)<=e.EPSILON*Math.max(1,Math.abs(R),Math.abs(H))&&Math.abs($-J)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(J))},vi.forEach=vi.sqrLen=vi.sqrDist=vi.dist=vi.div=vi.mul=vi.sub=vi.len=void 0;var e=function(M,P){if(M&&M.__esModule)return M;if(M===null||s(M)!=="object"&&typeof M!="function")return{default:M};var R=i(void 0);if(R&&R.has(M))return R.get(M);var $={},H=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var J in M)if(J!=="default"&&Object.prototype.hasOwnProperty.call(M,J)){var ee=H?Object.getOwnPropertyDescriptor(M,J):null;ee&&(ee.get||ee.set)?Object.defineProperty($,J,ee):$[J]=M[J]}return $.default=M,R&&R.set(M,$),$}(ve());function i(M){if(typeof WeakMap!="function")return null;var P=new WeakMap,R=new WeakMap;return(i=function($){return $?R:P})(M)}function o(){var M=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0),M}function p(M,P,R){return M[0]=P[0]-R[0],M[1]=P[1]-R[1],M}function l(M,P,R){return M[0]=P[0]*R[0],M[1]=P[1]*R[1],M}function f(M,P,R){return M[0]=P[0]/R[0],M[1]=P[1]/R[1],M}function w(M,P){return Math.hypot(P[0]-M[0],P[1]-M[1])}function C(M,P){var R=P[0]-M[0],$=P[1]-M[1];return R*R+$*$}function O(M){return Math.hypot(M[0],M[1])}function x(M){var P=M[0],R=M[1];return P*P+R*R}vi.len=O,vi.sub=p,vi.mul=l,vi.div=f,vi.dist=w,vi.sqrDist=C,vi.sqrLen=x;var E,k=(E=o(),function(M,P,R,$,H,J){var ee,Z;for(P||(P=2),R||(R=0),Z=$?Math.min($*P+R,M.length):M.length,ee=R;ee<Z;ee+=P)E[0]=M[ee],E[1]=M[ee+1],H(E,E,J),M[ee]=E[0],M[ee+1]=E[1];return M});return vi.forEach=k,vi}function an(){if(Wi)return oe;function s(M){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},s(M)}Wi=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.vec4=oe.vec3=oe.vec2=oe.quat2=oe.quat=oe.mat4=oe.mat3=oe.mat2d=oe.mat2=oe.glMatrix=void 0;var e=k(ve());oe.glMatrix=e;var i=k(Ae());oe.mat2=i;var o=k(rt());oe.mat2d=o;var p=k(at());oe.mat3=p;var l=k(Tt());oe.mat4=l;var f=k(ii());oe.quat=f;var w=k(Ri());oe.quat2=w;var C=k(Wr());oe.vec2=C;var O=k(oi());oe.vec3=O;var x=k(zt());function E(M){if(typeof WeakMap!="function")return null;var P=new WeakMap,R=new WeakMap;return(E=function($){return $?R:P})(M)}function k(M,P){if(M&&M.__esModule)return M;if(M===null||s(M)!=="object"&&typeof M!="function")return{default:M};var R=E(P);if(R&&R.has(M))return R.get(M);var $={},H=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var J in M)if(J!=="default"&&Object.prototype.hasOwnProperty.call(M,J)){var ee=H?Object.getOwnPropertyDescriptor(M,J):null;ee&&(ee.get||ee.set)?Object.defineProperty($,J,ee):$[J]=M[J]}return $.default=M,R&&R.set(M,$),$}return oe.vec4=x,oe}var _n,En,qr,es,Ye=an(),ds=function(){if(En)return _n;function s(e,i,o,p){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(p-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=p}return En=1,_n=s,s.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,p=0;p<8;p++){var l=this.sampleCurveX(o)-e;if(Math.abs(l)<i)return o;var f=this.sampleCurveDerivativeX(o);if(Math.abs(f)<1e-6)break;o-=l/f}var w=0,C=1;for(o=e,p=0;p<20&&(l=this.sampleCurveX(o),!(Math.abs(l-e)<i));p++)e>l?w=o:C=o,o=.5*(C-w)+w;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},_n}(),Bi=W(ds);function Xs(){if(es)return qr;function s(e,i){this.x=e,this.y=i}return es=1,qr=s,s.prototype={clone:function(){return new s(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,o=e.y-this.y;return i*i+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),o=Math.sin(e),p=o*this.x+i*this.y;return this.x=i*this.x-o*this.y,this.y=p,this},_rotateAround:function(e,i){var o=Math.cos(e),p=Math.sin(e),l=i.y+p*(this.x-i.x)+o*(this.y-i.y);return this.x=i.x+o*(this.x-i.x)-p*(this.y-i.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},s.convert=function(e){return e instanceof s?e:Array.isArray(e)?new s(e[0],e[1]):e},qr}var Wt=W(Xs());function jn(s,e){if(Array.isArray(s)){if(!Array.isArray(e)||s.length!==e.length)return!1;for(let i=0;i<s.length;i++)if(!jn(s[i],e[i]))return!1;return!0}if(typeof s=="object"&&s!==null&&e!==null){if(typeof e!="object"||Object.keys(s).length!==Object.keys(e).length)return!1;for(const i in s)if(!jn(s[i],e[i]))return!1;return!0}return s===e}const As=Math.PI/180,mo=180/Math.PI;function rr(s){return s*As}function $n(s){return s*mo}const xs=[[0,0],[1,0],[1,1],[0,1]];function Ca(s){if(s<=0)return 0;if(s>=1)return 1;const e=s*s,i=e*s;return 4*(s<.5?i:3*(s-e)+i-.75)}function xr(s,e,i,o){const p=new Bi(s,e,i,o);return function(l){return p.solve(l)}}const go=xr(.25,.1,.25,1);function nr(s,e,i){return Math.min(i,Math.max(e,s))}function Kr(s,e,i){return(i=nr((i-s)/(e-s),0,1))*i*(3-2*i)}function ra(s,e,i){const o=i-e,p=((s-e)%o+o)%o+e;return p===e?i:p}function dl(s,e,i){if(!s.length)return i(null,[]);let o=s.length;const p=new Array(s.length);let l=null;s.forEach((f,w)=>{e(f,(C,O)=>{C&&(l=C),p[w]=O,--o==0&&i(l,p)})})}function Zs(s,...e){for(const i of e)for(const o in i)s[o]=i[o];return s}let Ea=1;function $a(){return Ea++}function Nc(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Vc(s,e){s.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function ro(s,e){return s.indexOf(e,s.length-e.length)!==-1}function na(s,e,i){const o={};for(const p in s)o[p]=e.call(this,s[p],p,s);return o}function pl(s,e,i){const o={};for(const p in s)e.call(this,s[p],p,s)&&(o[p]=s[p]);return o}function zn(s){return Array.isArray(s)?s.map(zn):typeof s=="object"&&s?na(s,zn):s}const Aa={};function qi(s){Aa[s]||(typeof console<"u"&&console.warn(s),Aa[s]=!0)}function Fn(s,e,i){return(i.y-s.y)*(e.x-s.x)>(e.y-s.y)*(i.x-s.x)}function $u(s){let e=0;for(let i,o,p=0,l=s.length,f=l-1;p<l;f=p++)i=s[p],o=s[f],e+=(o.x-i.x)*(i.y+o.y);return e}function Jr([s,e,i]){const o=rr(e+90),p=rr(i);return{x:s*Math.cos(o)*Math.sin(p),y:s*Math.sin(o)*Math.sin(p),z:s*Math.cos(p),azimuthal:e,polar:i}}function Pa(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Uc(s){const e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,p,l)=>{const f=p||l;return e[o]=!f||f.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let fl=null;function jc(s,e){return[s[4*e],s[4*e+1],s[4*e+2],s[4*e+3]]}function Ps(s,e,i,o){for(;e<i;){const p=e+i>>1;s[p]<o?e=p+1:i=p}return e}function $c(s,e,i,o){for(;e<i;){const p=e+i>>1;s[p]<=o?e=p+1:i=p}return e}function zh(s){return s>0?1/(1.001-s):1+s}function Fh(s){return s>0?1-1/(1.001-s):-s}const ts={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ts.API_URL)return null;try{const s=new URL(ts.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Jl(s){return ts.API_URL_REGEX.test(s)}function Hu(s){return ts.API_SPRITE_REGEX.test(s)}let Gu,Ds,Go,vt,se,me;function we(){return Gu==null&&(Gu=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Gu}const Be={now:()=>vt!==void 0?vt:performance.now(),setNow(s){vt=s},restoreNow(){vt=void 0},frame(s){const e=requestAnimationFrame(s);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(s,e=0){const{width:i,height:o}=s;se||(se=document.createElement("canvas"));const p=se.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(i>se.width||o>se.height)&&(se.width=i,se.height=o),p.clearRect(-e,-e,i+2*e,o+2*e),p.drawImage(s,0,0,i,o),p.getImageData(-e,-e,i+2*e,o+2*e)},resolveURL:s=>(Ds||(Ds=document.createElement("a")),Ds.href=s,Ds.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Go==null&&(Go=window.matchMedia("(prefers-reduced-motion: reduce)")),Go.matches)},hasCanvasFingerprintNoise(){if(me!==void 0)return me;if(!we())return me=!1,!1;const s=new OffscreenCanvas(85,1),e=s.getContext("2d",{willReadFrequently:!0});let i=0;for(let p=0;p<s.width;++p)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(p,0,1,1);const o=e.getImageData(0,0,s.width,s.height);i=0;for(let p=0;p<o.data.length;++p)if(p%4!=3&&i++!==o.data[p])return me=!0,!0;return me=!1,!1}};function je(s,e){const i=s.indexOf("?");if(i<0)return`${s}?${new URLSearchParams(e).toString()}`;const o=new URLSearchParams(s.slice(i));for(const p in e)o.set(p,e[p]);return`${s.slice(0,i)}?${o.toString()}`}function Ke(s,e={persistentParams:[]}){const i=s.indexOf("?");if(i<0)return s;const o=new URLSearchParams,p=new URLSearchParams(s.slice(i));for(const f of e.persistentParams){const w=p.get(f);w&&o.set(f,w)}const l=o.toString();return`${s.slice(0,i)}${l.length>0?`?${l}`:""}`}const lt="mapbox-tiles";let Je=500,mt=50;const pt=["language","worldview","jobid"];let yt,Rt;function Zt(){try{return caches}catch{}}function Jt(){const s=Zt();s&&yt==null&&(yt=s.open(lt))}let fi=1/0;const Ii={supported:!1,testSupport:function(s){!dr&&Pi&&(br?wr(s):ki=s)}};let ki,Pi,dr=!1,br=!1;const sr=typeof self<"u"?self:{};function wr(s){const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Pi),s.isContextLost())return;Ii.supported=!0}catch{}s.deleteTexture(e),dr=!0}sr.document&&(Pi=sr.document.createElement("img"),Pi.onload=function(){ki&&wr(ki),ki=null,br=!0},Pi.onerror=function(){dr=!0,ki=null},Pi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Pr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Pr);class Bn extends Error{constructor(e,i,o){i===401&&Jl(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Da=Pa()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,is=function(s,e){if(!(/^file:/.test(i=s.url)||/^file:/.test(Da())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,p){const l=new AbortController,f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Da(),referrerPolicy:o.referrerPolicy,signal:l.signal});let w=!1,C=!1;const O=(x=f.url).indexOf("sku=")>0&&Jl(x);var x;o.type==="json"&&f.headers.set("Accept","application/json");const E=(M,P,R)=>{if(C)return;if(M&&M.message!=="SecurityError"&&qi(M.toString()),P&&R)return k(P);const $=Date.now();fetch(f).then(H=>{if(H.ok){const J=O?H.clone():null;return k(H,J,$)}return p(new Bn(H.statusText,H.status,o.url))}).catch(H=>{H.name!=="AbortError"&&p(new Error(`${H.message} ${o.url}`))})},k=(M,P,R)=>{(o.type==="arrayBuffer"?M.arrayBuffer():o.type==="json"?M.json():M.text()).then($=>{C||(P&&R&&function(H,J,ee){if(Jt(),yt==null)return;const Z=Uc(J.headers.get("Cache-Control")||"");if(Z["no-store"])return;const ne={status:J.status,statusText:J.statusText,headers:new Headers};J.headers.forEach((Pe,Ee)=>ne.headers.set(Ee,Pe)),Z["max-age"]&&ne.headers.set("Expires",new Date(ee+1e3*Z["max-age"]).toUTCString());const le=ne.headers.get("Expires");if(!le||new Date(le).getTime()-ee<42e4)return;let fe=Ke(H.url,{persistentParams:pt});if(J.status===206){const Pe=H.headers.get("Range");if(!Pe)return;ne.status=200,fe=je(fe,{range:Pe})}(function(Pe,Ee){if(Rt===void 0)try{new Response(new ReadableStream),Rt=!0}catch{Rt=!1}Rt?Ee(Pe.body):Pe.blob().then(Ee)})(J,Pe=>{const Ee=new Response((Ce=J.status)!==200&&Ce!==404&&[101,103,204,205,304].includes(Ce)?null:Pe,ne);var Ce;Jt(),yt!=null&&yt.then($e=>$e.put(fe,Ee)).catch($e=>qi($e.message))})}(f,P,R),w=!0,p(null,$,M.headers.get("Cache-Control"),M.headers.get("Expires")))}).catch($=>{C||p(new Error($.message))})};return O?function(M,P){if(Jt(),yt==null)return P(null);yt.then(R=>{let $=Ke(M.url,{persistentParams:pt});const H=M.headers.get("Range");H&&($=je($,{range:H})),R.match($).then(J=>{const ee=function(Z){if(!Z)return!1;const ne=new Date(Z.headers.get("Expires")||0),le=Uc(Z.headers.get("Cache-Control")||"");return ne>Date.now()&&!le["no-cache"]}(J);R.delete($),ee&&R.put($,J.clone()),P(null,J,ee)}).catch(P)}).catch(P)}(f,E):E(null,null),{cancel:()=>{C=!0,w||l.abort()}}}(s,e);if(Pa()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,e,void 0,!0)}var i;return function(o,p){const l=new XMLHttpRequest;l.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(l.responseType="arraybuffer");for(const f in o.headers)l.setRequestHeader(f,o.headers[f]);return o.type==="json"&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials=o.credentials==="include",l.onerror=()=>{p(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||l.status===0)&&l.response!==null){let f=l.response;if(o.type==="json")try{f=JSON.parse(l.response)}catch(w){return p(w)}p(null,f,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else p(new Bn(l.statusText,l.status,o.url))},l.send(o.body),{cancel:()=>l.abort()}}(s,e)},Nn=function(s,e){return is(Zs(s,{type:"arrayBuffer"}),e)};function $s(s){const e=document.createElement("a");return e.href=s,e.protocol===location.protocol&&e.host===location.host}const Hc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Wo,Gc;Wo=[],Gc=0;const Po=function(s,e){if(Ii.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),Gc>=ts.MAX_PARALLEL_IMAGE_REQUESTS){const l={requestParameters:s,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Wo.push(l),l}Gc++;let i=!1;const o=()=>{if(!i)for(i=!0,Gc--;Wo.length&&Gc<ts.MAX_PARALLEL_IMAGE_REQUESTS;){const l=Wo.shift(),{requestParameters:f,callback:w,cancelled:C}=l;C||(l.cancel=Po(f,w).cancel)}},p=Nn(s,(l,f,w,C)=>{o(),l?e(l):f&&(self.createImageBitmap?function(O,x){const E=new Blob([new Uint8Array(O)],{type:"image/png"});createImageBitmap(E).then(k=>{x(null,k)}).catch(k=>{x(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(O,x)=>e(O,x,w,C)):function(O,x){const E=new Image;E.onload=()=>{x(null,E),URL.revokeObjectURL(E.src),E.onload=null,requestAnimationFrame(()=>{E.src=Hc})},E.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const k=new Blob([new Uint8Array(O)],{type:"image/png"});E.src=O.byteLength?URL.createObjectURL(k):Hc}(f,(O,x)=>e(O,x,w,C)))});return{cancel:()=>{p.cancel(),o()}}};var Wc,Gd,Wd,Ks={exports:{}},Do={exports:{}},qo={exports:{}},Ia=function(){if(Wd)return Ks.exports;Wd=1;var s=(Wc||(Wc=1,Do.exports=function(i,o){var p,l,f,w,C,O,x,E;for(l=i.length-(p=3&i.length),f=o,C=3432918353,O=461845907,E=0;E<l;)x=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,f=27492+(65535&(w=5*(65535&(f=(f^=x=(65535&(x=(x=(65535&x)*C+(((x>>>16)*C&65535)<<16)&4294967295)<<15|x>>>17))*O+(((x>>>16)*O&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(x=0,p){case 3:x^=(255&i.charCodeAt(E+2))<<16;case 2:x^=(255&i.charCodeAt(E+1))<<8;case 1:f^=x=(65535&(x=(x=(65535&(x^=255&i.charCodeAt(E)))*C+(((x>>>16)*C&65535)<<16)&4294967295)<<15|x>>>17))*O+(((x>>>16)*O&65535)<<16)&4294967295}return f^=i.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),Do.exports),e=(Gd||(Gd=1,qo.exports=function(i,o){for(var p,l=i.length,f=o^l,w=0;l>=4;)p=1540483477*(65535&(p=255&i.charCodeAt(w)|(255&i.charCodeAt(++w))<<8|(255&i.charCodeAt(++w))<<16|(255&i.charCodeAt(++w))<<24))+((1540483477*(p>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),l-=4,++w;switch(l){case 3:f^=(255&i.charCodeAt(w+2))<<16;case 2:f^=(255&i.charCodeAt(w+1))<<8;case 1:f=1540483477*(65535&(f^=255&i.charCodeAt(w)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),qo.exports);return Ks.exports=s,Ks.exports.murmur3=s,Ks.exports.murmur2=e,Ks.exports}(),sa=W(Ia);class oa{constructor(e,...i){Zs(this,i[0]||{}),this.type=e}}class Wu extends oa{constructor(e,i={}){super("error",Zs({error:e},i))}}function ml(s,e,i){i[s]&&i[s].indexOf(e)!==-1||(i[s]=i[s]||[],i[s].push(e))}function gl(s,e,i){if(i&&i[s]){const o=i[s].indexOf(e);o!==-1&&i[s].splice(o,1)}}class aa{on(e,i){return this._listeners=this._listeners||{},ml(e,i,this._listeners),this}off(e,i){return gl(e,i,this._listeners),gl(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},ml(e,i,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,i){const o=typeof e=="string"?new oa(e,i):e,p=o.type;if(this.listens(p)){o.target=this;const l=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const C of l)C.call(this,o);const f=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const C of f)gl(p,C,this._oneTimeListeners),C.call(this,o);const w=this._eventedParent;w&&(Zs(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(o))}else o instanceof Wu&&console.error(o.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var gf,qd={},Yo=function(){if(gf)return qd;gf=1;var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(l){return(l=Math.round(l))<0?0:l>255?255:l}function i(l){return e(l[l.length-1]==="%"?parseFloat(l)/100*255:parseInt(l))}function o(l){return(f=l[l.length-1]==="%"?parseFloat(l)/100:parseFloat(l))<0?0:f>1?1:f;var f}function p(l,f,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?l+(f-l)*w*6:2*w<1?f:3*w<2?l+(f-l)*(2/3-w)*6:l}try{qd.parseCSSColor=function(l){var f,w=l.replace(/ /g,"").toLowerCase();if(w in s)return s[w].slice();if(w[0]==="#")return w.length===4?(f=parseInt(w.substr(1),16))>=0&&f<=4095?[(3840&f)>>4|(3840&f)>>8,240&f|(240&f)>>4,15&f|(15&f)<<4,1]:null:w.length===7&&(f=parseInt(w.substr(1),16))>=0&&f<=16777215?[(16711680&f)>>16,(65280&f)>>8,255&f,1]:null;var C=w.indexOf("("),O=w.indexOf(")");if(C!==-1&&O+1===w.length){var x=w.substr(0,C),E=w.substr(C+1,O-(C+1)).split(","),k=1;switch(x){case"rgba":if(E.length!==4)return null;k=o(E.pop());case"rgb":return E.length!==3?null:[i(E[0]),i(E[1]),i(E[2]),k];case"hsla":if(E.length!==4)return null;k=o(E.pop());case"hsl":if(E.length!==3)return null;var M=(parseFloat(E[0])%360+360)%360/360,P=o(E[1]),R=o(E[2]),$=R<=.5?R*(P+1):R+P-R*P,H=2*R-$;return[e(255*p(H,$,M+1/3)),e(255*p(H,$,M)),e(255*p(H,$,M-1/3)),k];default:return null}}return null}}catch{}return qd}();class Ar{constructor(e,i,o,p=1){this.r=e,this.g=i,this.b=o,this.a=p}static parse(e){if(!e)return;if(e instanceof Ar)return e;if(typeof e!="string")return;const i=Yo.parseCSSColor(e);return i?new Ar(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toStringPremultipliedAlpha(){const[e,i,o,p]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(o)},${p})`}toString(){const[e,i,o,p]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*o)},${p})`}toRenderColor(e){const{r:i,g:o,b:p,a:l}=this;return new Yd(e,i,o,p,l)}clone(){return new Ar(this.r,this.g,this.b,this.a)}}class Yd{constructor(e,i,o,p,l){if(e){const f=e.image.height,w=f*f;i=l===0?0:i/l*(f-1),o=l===0?0:o/l*(f-1),p=l===0?0:p/l*(f-1);const C=Math.floor(i),O=Math.floor(o),x=Math.floor(p),E=Math.ceil(i),k=Math.ceil(o),M=Math.ceil(p),P=i-C,R=o-O,$=p-x,H=e.image.data,J=4*(C+O*w+x*f),ee=4*(C+O*w+M*f),Z=4*(C+k*w+x*f),ne=4*(C+k*w+M*f),le=4*(E+O*w+x*f),fe=4*(E+O*w+M*f),Pe=4*(E+k*w+x*f),Ee=4*(E+k*w+M*f);if(J<0||Ee>=H.length)throw new Error("out of range");this.r=Di(Di(Di(H[J],H[ee],$),Di(H[Z],H[ne],$),R),Di(Di(H[le],H[fe],$),Di(H[Pe],H[Ee],$),R),P)/255*l,this.g=Di(Di(Di(H[J+1],H[ee+1],$),Di(H[Z+1],H[ne+1],$),R),Di(Di(H[le+1],H[fe+1],$),Di(H[Pe+1],H[Ee+1],$),R),P)/255*l,this.b=Di(Di(Di(H[J+2],H[ee+2],$),Di(H[Z+2],H[ne+2],$),R),Di(Di(H[le+2],H[fe+2],$),Di(H[Pe+2],H[Ee+2],$),R),P)/255*l,this.a=l}else this.r=i,this.g=o,this.b=p,this.a=l}toArray(){const{r:e,g:i,b:o,a:p}=this;return p===0?[0,0,0,0]:[255*e/p,255*i/p,255*o/p,p]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:i,b:o,a:p}=this,l=Math.min(Math.max(e/p,0),1),f=Math.min(Math.max(i/p,0),1),w=Math.min(Math.max(o/p,0),1),C=Math.min(l,f,w),O=Math.max(l,f,w),x=(C+O)/2;if(C===O)return[0,0,100*x,p];const E=O-C,k=x>.5?E/(2-O-C):E/(O+C);let M=0;return O===l?M=(f-w)/E+(f<w?6:0):O===f?M=(w-l)/E+2:O===w&&(M=(l-f)/E+4),M*=60,[Math.min(Math.max(M,0),360),Math.min(Math.max(100*k,0),100),Math.min(Math.max(100*x,0),100),p]}toArray01(){const{r:e,g:i,b:o,a:p}=this;return p===0?[0,0,0,0]:[e/p,i/p,o/p,p]}toArray01Scaled(e){const{r:i,g:o,b:p,a:l}=this;return l===0?[0,0,0]:[i/l*e,o/l*e,p/l*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:o,a:p}=this;return[e,i,o,p]}toArray01Linear(){const{r:e,g:i,b:o,a:p}=this;return p===0?[0,0,0,0]:[Math.pow(e/p,2.2),Math.pow(i/p,2.2),Math.pow(o/p,2.2),p]}}function Di(s,e,i){return s*(1-i)+e*i}function Xd(s,e,i){return s.map((o,p)=>Di(o,e[p],i))}Ar.black=new Ar(0,0,0,1),Ar.white=new Ar(1,1,1,1),Ar.transparent=new Ar(0,0,0,0),Ar.red=new Ar(1,0,0,1),Ar.blue=new Ar(0,0,1,1);var Io=Object.freeze({__proto__:null,array:Xd,color:function(s,e,i){return new Ar(Di(s.r,e.r,i),Di(s.g,e.g,i),Di(s.b,e.b,i),Di(s.a,e.a,i))},number:Di});function Bh(s,...e){for(const i of e)for(const o in i)s[o]=i[o];return s}class Ji extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class qc{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,p]of i)this.bindings[o]=p}concat(e){return new qc(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Ha={kind:"null"},yi={kind:"number"},Lr={kind:"string"},Sr={kind:"boolean"},Hs={kind:"color"},ka={kind:"object"},Tr={kind:"value"},Oa={kind:"collator"},ps={kind:"formatted"},_l={kind:"resolvedImage"};function bs(s,e){return{kind:"array",itemType:s,N:e}}function wn(s){if(s.kind==="array"){const e=wn(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}return s.kind}const Zd=[Ha,yi,Lr,Sr,Hs,ps,ka,bs(Tr),_l];function Js(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Js(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(const i of Zd)if(!Js(i,e))return null}}return`Expected ${wn(s)} but found ${wn(e)} instead.`}function rs(s,e){return e.some(i=>i.kind===s.kind)}function _o(s,e){return e.some(i=>i==="null"?s===null:i==="array"?Array.isArray(s):i==="object"?s&&!Array.isArray(s)&&typeof s=="object":i===typeof s)}class qu{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Yu{constructor(e,i,o,p,l){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=p,this.textColor=l}}class Is{constructor(e){this.sections=e}static fromString(e){return new Is([new Yu(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary)}static factory(e){return e instanceof Is?e:Is.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);const o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(o)}return e}}class yo{constructor(e,i){if(this.id=e,this.options=i||{params:{}},this.options.transform){const{a:o,b:p,c:l,d:f,e:w,f:C}=this.options.transform;this.options.transform=new DOMMatrix([o,p,l,f,w,C])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}static deserializeId(e){return JSON.parse(e).id}static deserializeFromString(e){const i=JSON.parse(e),{a:o,b:p,c:l,d:f,e:w,f:C}=i.options.transform;return new DOMMatrix([o,p,l,f,w,C]),new yo(i.id,i.options)}scaleSelf(e){return this.options.transform=this.options.transform.scale(e),this}serialize(){const e={id:this.id};this.options&&(e.options=this.options);const{a:i,b:o,c:p,d:l,e:f,f:w}=this.options.transform;return e.options.transform={a:i,b:o,c:p,d:l,e:f,f:w},JSON.stringify(e)}}class ks{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),e.optionsPrimary&&(this.optionsPrimary=e.optionsPrimary),e.optionsSecondary&&(this.optionsSecondary=e.optionsSecondary),this.available=e.available}toString(){return this.namePrimary&&this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}getPrimary(){return new yo(this.namePrimary,{params:this.optionsPrimary&&this.optionsPrimary.params||{}})}getSerializedPrimary(){return this.getPrimary().serialize()}getSecondary(){return this.nameSecondary?new yo(this.nameSecondary,{params:this.optionsSecondary&&this.optionsSecondary.params||{}}):null}static from(e){return typeof e=="string"?ks.build(e):e}static build(e,i,o,p){return e?new ks({namePrimary:e,nameSecondary:i,optionsPrimary:o,optionsSecondary:p,available:!1}):null}}function Yc(s,e,i,o){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[s,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[s,e,i,o]:[s,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function La(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Ar||s instanceof qu||s instanceof Is||s instanceof ks)return!0;if(Array.isArray(s)){for(const e of s)if(!La(e))return!1;return!0}if(typeof s=="object"){for(const e in s)if(!La(s[e]))return!1;return!0}return!1}function Qr(s){if(s===null)return Ha;if(typeof s=="string")return Lr;if(typeof s=="boolean")return Sr;if(typeof s=="number")return yi;if(s instanceof Ar)return Hs;if(s instanceof qu)return Oa;if(s instanceof Is)return ps;if(s instanceof ks)return _l;if(Array.isArray(s)){const e=s.length;let i;for(const o of s){const p=Qr(o);if(i){if(i===p)continue;i=Tr;break}i=p}return bs(i||Tr,e)}return ka}function ko(s){const e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof Ar?s.toStringPremultipliedAlpha():s instanceof Is||s instanceof ks?s.toString():JSON.stringify(s)}class ws{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!La(e[1]))return i.error("invalid value");const o=e[1];let p=Qr(o);const l=i.expectedType;return p.kind!=="array"||p.N!==0||!l||l.kind!=="array"||typeof l.N=="number"&&l.N!==0||(p=l),new ws(p,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ar?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Is?this.value.serialize():this.value}}class yn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Xc={string:Lr,number:yi,boolean:Sr,object:ka};class Xo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,p=1;const l=e[0];if(l==="array"){let w,C;if(e.length>2){const O=e[1];if(typeof O!="string"||!(O in Xc)||O==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);w=Xc[O],p++}else w=Tr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);C=e[2],p++}o=bs(w,C)}else o=Xc[l];const f=[];for(;p<e.length;p++){const w=i.parse(e[p],p,Tr);if(!w)return null;f.push(w)}return new Xo(o,f)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!Js(this.type,Qr(o)))return o;if(i===this.args.length-1)throw new yn(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${wn(Qr(o))} but was expected to be of type ${wn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);const p=e.N;(typeof p=="number"||this.args.length>1)&&i.push(p)}}return i.concat(this.args.map(o=>o.serialize()))}}class Ga{constructor(e){this.type=ps,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const p=[];let l=!1;for(let f=1;f<=e.length-1;++f){const w=e[f];if(l&&typeof w=="object"&&!Array.isArray(w)){l=!1;let C=null;if(w["font-scale"]&&(C=i.parseObjectValue(w["font-scale"],f,"font-scale",yi),!C))return null;let O=null;if(w["text-font"]&&(O=i.parseObjectValue(w["text-font"],f,"text-font",bs(Lr)),!O))return null;let x=null;if(w["text-color"]&&(x=i.parseObjectValue(w["text-color"],f,"text-color",Hs),!x))return null;const E=p[p.length-1];E.scale=C,E.font=O,E.textColor=x}else{const C=i.parse(e[f],f,Tr);if(!C)return null;const O=C.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,p.push({content:C,scale:null,font:null,textColor:null})}}return new Ga(p)}evaluate(e){return new Is(this.sections.map(i=>{const o=i.content.evaluate(e);return Qr(o)===_l?new Yu("",o,null,null,null):new Yu(ko(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class Zc{constructor(e,i,o,p){this._imageWarnHistory={},this.type=_l,this.inputPrimary=e,this.inputSecondary=i,this.inputPrimaryParams=o,this.inputSecondaryParams=p}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let o=1;const p=[];function l(){if(o<e.length){const w=i.parse(e[o],o++,Lr);return w?(p.push({image:w,options:void 0}),!0):(i.error(p.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function f(){if(o<e.length){if((w=e[o])===null||typeof w!="object"||Array.isArray(w))return!0;const C=e[o].params,O=i.concat(o);if(!C)return o++,!0;if(typeof C!="object"||C.constructor!==Object)return O.error('Image options "params" should be an object'),!1;const x={},E=O.concat(void 0,"params");for(const k in C){if(!k)return E.error("Image parameter name should be non-empty"),!1;const M=E.concat(void 0,k).parse(C[k],void 0,Hs,void 0,{typeAnnotation:"coerce"});if(!M)return!1;x[k]=M}return p[p.length-1].options=x,o++,!0}var w;return!0}for(let w=0;w<2;w++)if(!l()||!f())return;return new Zc(p[0].image,p[1]?p[1].image:void 0,p[0].options,p[1]?p[1].options:void 0)}evaluateParams(e,i){const o={};if(i){for(const p in i)if(i[p])try{const l=i[p].evaluate(e),f=`Ignoring image parameter "${p}" with semi-transparent color ${l.toString()}`;if(l.a!==1){this._imageWarnHistory[f]||(console.warn(f),this._imageWarnHistory[f]=!0);continue}o[p]=l}catch{continue}if(Object.keys(o).length!==0)return{params:o}}}evaluate(e){const i=ks.build(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0,this.inputPrimaryParams?this.evaluateParams(e,this.inputPrimaryParams):void 0,this.inputSecondaryParams?this.evaluateParams(e,this.inputSecondaryParams):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){if(e(this.inputPrimary),this.inputPrimaryParams)for(const i in this.inputPrimaryParams)this.inputPrimaryParams[i]&&e(this.inputPrimaryParams[i]);if(this.inputSecondary&&(e(this.inputSecondary),this.inputSecondaryParams))for(const i in this.inputSecondaryParams)this.inputSecondaryParams[i]&&e(this.inputSecondaryParams[i])}outputDefined(){return!1}serializeParams(e){const i={};if(e){for(const o in e)e[o]&&(i[o]=e[o].serialize());return{params:i}}}serialize(){const e=["image",this.inputPrimary.serialize()];return this.inputPrimaryParams&&e.push(this.serializeParams(this.inputPrimaryParams)),this.inputSecondary&&(e.push(this.inputSecondary.serialize()),this.inputSecondaryParams&&e.push(this.serializeParams(this.inputSecondaryParams))),e}}function Oo(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}const Kd={"to-boolean":Sr,"to-color":Hs,"to-number":yi,"to-string":Lr};class Ra{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0],p=[];let l=Ha;if(o==="to-array"){if(!Array.isArray(e[1]))return null;const f=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);l=bs(i.expectedType.itemType,f)}else{if(!(f>0&&La(e[1][0])))return null;l=bs(Qr(e[1][0]),f)}for(let w=0;w<f;w++){const C=e[1][w];let O;if(Oo(C)==="array")O=i.parse(C,void 0,l.itemType);else{const x=Oo(C);if(x!==l.itemType.kind)return i.error(`Expected ${l.itemType.kind} but found ${x}.`);O=i.registry.literal.parse(["literal",C===void 0?null:C],i)}if(!O)return null;p.push(O)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");l=Kd[o];for(let f=1;f<e.length;f++){const w=i.parse(e[f],f,Tr);if(!w)return null;p.push(w)}}return new Ra(l,p)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,o;for(const p of this.args){if(i=p.evaluate(e),o=null,i instanceof Ar)return i;if(typeof i=="string"){const l=e.parseColor(i);if(l)return l}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Yc(i[0],i[1],i[2],i[3]),!o))return new Ar(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new yn(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const p=Number(i);if(!isNaN(p))return p}throw new yn(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Is.fromString(ko(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ks.build(ko(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):ko(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ga([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Zc(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Jd=["Unknown","Point","LineString","Polygon"];class Qd{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Jd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:o,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*i-e[0])+this.featureDistanceData.bearing[1]*(p*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Ar.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class no{constructor(e,i,o,p,l){this.name=e,this.type=i,this._evaluate=o,this.args=p,this._overloadIndex=l}evaluate(e){if(!this._evaluate){const i=no.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const o=e[0],p=no.definitions[o];if(!p)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const l=Array.isArray(p)?p[0]:p.type,f=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=[];let C=null,O=-1;for(const[x,E]of f){if(Array.isArray(x)&&x.length!==e.length-1)continue;w.push(x),O++,C=new su(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const k=[];let M=!1;for(let P=1;P<e.length;P++){const R=e[P],$=Array.isArray(x)?x[P-1]:x.type,H=C.parse(R,1+k.length,$);if(!H){M=!0;break}k.push(H)}if(!M)if(Array.isArray(x)&&x.length!==k.length)C.error(`Expected ${x.length} arguments, but found ${k.length} instead.`);else{for(let P=0;P<k.length;P++){const R=Array.isArray(x)?x[P]:x.type,$=k[P];C.concat(P+1).checkSubtype(R,$.type)}if(C.errors.length===0)return new no(o,l,E,k,O)}}if(w.length===1)i.errors.push(...C.errors);else{const x=(w.length?w:f.map(([k])=>k)).map(ep).join(" | "),E=[];for(let k=1;k<e.length;k++){const M=i.parse(e[k],1+E.length);if(!M)return null;E.push(wn(M.type))}i.error(`Expected arguments of type ${x}, but found (${E.join(", ")}) instead.`)}return null}static register(e,i){no.definitions=i;for(const o in i)e[o]=no}}function ep(s){return Array.isArray(s)?`(${s.map(wn).join(", ")})`:`(${wn(s.type)}...)`}class Nh{constructor(e,i,o){this.type=Oa,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const p=o["case-sensitive"]===void 0?i.parse(!1,1,Sr):i.parseObjectValue(o["case-sensitive"],1,"case-sensitive",Sr);if(!p)return null;const l=o["diacritic-sensitive"]===void 0?i.parse(!1,1,Sr):i.parseObjectValue(o["diacritic-sensitive"],1,"diacritic-sensitive",Sr);if(!l)return null;let f=null;return o.locale&&(f=i.parseObjectValue(o.locale,1,"locale",Lr),!f)?null:new Nh(p,l,f)}evaluate(e){return new qu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Xu(s,e,i=0,o=s.length-1,p=Vm){for(;o>i;){if(o-i>600){const C=o-i+1,O=e-i+1,x=Math.log(C),E=.5*Math.exp(2*x/3),k=.5*Math.sqrt(x*E*(C-E)/C)*(O-C/2<0?-1:1);Xu(s,e,Math.max(i,Math.floor(e-O*E/C+k)),Math.min(o,Math.floor(e+(C-O)*E/C+k)),p)}const l=s[e];let f=i,w=o;for(Ql(s,i,e),p(s[o],l)>0&&Ql(s,i,o);f<w;){for(Ql(s,f,w),f++,w--;p(s[f],l)<0;)f++;for(;p(s[w],l)>0;)w--}p(s[i],l)===0?Ql(s,i,w):(w++,Ql(s,w,o)),w<=e&&(i=w+1),e<=w&&(o=w-1)}}function Ql(s,e,i){const o=s[e];s[e]=s[i],s[i]=o}function Vm(s,e){return s<e?-1:s>e?1:0}function Um(s){let e=0;for(let i,o,p=0,l=s.length,f=l-1;p<l;f=p++)i=s[p],o=s[f],e+=(o.x-i.x)*(i.y+o.y);return e}function Zu(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function Kc(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function Jc(s,e,i){const o=s[0]-e[0],p=s[1]-e[1],l=s[0]-i[0],f=s[1]-i[1];return o*f-l*p==0&&o*l<=0&&p*f<=0}function ec(s,e,i=!1){let o=!1;for(let w=0,C=e.length;w<C;w++){const O=e[w];for(let x=0,E=O.length,k=E-1;x<E;k=x++){const M=O[k],P=O[x];if(Jc(s,M,P))return i;(l=M)[1]>(p=s)[1]!=(f=P)[1]>p[1]&&p[0]<(f[0]-l[0])*(p[1]-l[1])/(f[1]-l[1])+l[0]&&(o=!o)}}var p,l,f;return o}function Vh(s,e,i,o){const p=o[0]-i[0],l=o[1]-i[1],f=(s[0]-i[0])*l-p*(s[1]-i[1]),w=(e[0]-i[0])*l-p*(e[1]-i[1]);return f>0&&w<0||f<0&&w>0}function Wa(s,e,i,o){return(p=[o[0]-i[0],o[1]-i[1]])[0]*(l=[e[0]-s[0],e[1]-s[1]])[1]-p[1]*l[0]!=0&&!(!Vh(s,e,i,o)||!Vh(i,o,s,e));var p,l}const yl=8192;function jm(s,e){const i=(180+s[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,p=Math.pow(2,e.z);return[Math.round(i*p*yl),Math.round(o*p*yl)]}function tc(s,e){for(let i=0;i<e.length;i++)if(ec(s,e[i]))return!0;return!1}function tp(s,e,i){for(const o of i)for(let p=0,l=o.length,f=l-1;p<l;f=p++)if(Wa(s,e,o[f],o[p]))return!0;return!1}function Ku(s,e){for(let i=0;i<s.length;++i)if(!ec(s[i],e))return!1;for(let i=0;i<s.length-1;++i)if(tp(s[i],s[i+1],e))return!1;return!0}function Uh(s,e){for(let i=0;i<e.length;i++)if(Ku(s,e[i]))return!0;return!1}function ip(s,e,i){const o=[];for(let p=0;p<s.length;p++){const l=[];for(let f=0;f<s[p].length;f++){const w=jm(s[p][f],i);Zu(e,w),l.push(w)}o.push(l)}return o}function vl(s,e,i){const o=[];for(let p=0;p<s.length;p++){const l=ip(s[p],e,i);o.push(l)}return o}function Xi(s,e,i,o){if(s[0]<i[0]||s[0]>i[2]){const p=.5*o;let l=s[0]-i[0]>p?-o:i[0]-s[0]>p?o:0;l===0&&(l=s[0]-i[2]>p?-o:i[2]-s[0]>p?o:0),s[0]+=l}Zu(e,s)}function Si(s,e,i,o){const p=Math.pow(2,o.z)*yl,l=[o.x*yl,o.y*yl],f=[];if(!s)return f;for(const w of s)for(const C of w){const O=[C.x+l[0],C.y+l[1]];Xi(O,e,i,p),f.push(O)}return f}function jh(s,e,i,o){const p=Math.pow(2,o.z)*yl,l=[o.x*yl,o.y*yl],f=[];if(!s)return f;for(const C of s){const O=[];for(const x of C){const E=[x.x+l[0],x.y+l[1]];Zu(e,E),O.push(E)}f.push(O)}if(e[2]-e[0]<=p/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const C of f)for(const O of C)Xi(O,e,i,p)}var w;return f}class Oi{constructor(e,i){this.type=Sr,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(La(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let p=0;p<o.features.length;++p){const l=o.features[p].geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Oi(o,o.features[p].geometry)}else if(o.type==="Feature"){const p=o.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Oi(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Oi(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){const p=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const w=ip(o.coordinates,l,f),C=Si(i.geometry(),p,l,f);if(!Kc(p,l))return!1;for(const O of C)if(!ec(O,w))return!1}if(o.type==="MultiPolygon"){const w=vl(o.coordinates,l,f),C=Si(i.geometry(),p,l,f);if(!Kc(p,l))return!1;for(const O of C)if(!tc(O,w))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){const p=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const w=ip(o.coordinates,l,f),C=jh(i.geometry(),p,l,f);if(!Kc(p,l))return!1;for(const O of C)if(!Ku(O,w))return!1}if(o.type==="MultiPolygon"){const w=vl(o.coordinates,l,f),C=jh(i.geometry(),p,l,f);if(!Kc(p,l))return!1;for(const O of C)if(!Uh(O,w))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Qc={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},xl=1/298.257223563,zi=xl*(2-xl),eu=Math.PI/180;class qa{static fromTile(e,i,o){const p=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),l=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/eu;return new qa(l,o)}static get units(){return Qc}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!Qc[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(Qc).join(", ")}`);const o=6378.137*eu*(i?Qc[i]:1),p=Math.cos(e*eu),l=1/(1-zi*(1-p*p)),f=Math.sqrt(l);this.kx=o*f*p,this.ky=o*f*l*(1-zi)}distance(e,i){const o=so(e[0]-i[0])*this.kx,p=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+p*p)}bearing(e,i){const o=so(i[0]-e[0])*this.kx;return Math.atan2(o,(i[1]-e[1])*this.ky)/eu}destination(e,i,o){const p=o*eu;return this.offset(e,Math.sin(p)*i,Math.cos(p)*i)}offset(e,i,o){return[e[0]+i/this.kx,e[1]+o/this.ky]}lineDistance(e){let i=0;for(let o=0;o<e.length-1;o++)i+=this.distance(e[o],e[o+1]);return i}area(e){let i=0;for(let o=0;o<e.length;o++){const p=e[o];for(let l=0,f=p.length,w=f-1;l<f;w=l++)i+=so(p[l][0]-p[w][0])*(p[l][1]+p[w][1])*(o?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let o=0;if(i<=0)return e[0];for(let p=0;p<e.length-1;p++){const l=e[p],f=e[p+1],w=this.distance(l,f);if(o+=w,o>i)return $h(l,f,(i-(o-w))/w)}return e[e.length-1]}pointToSegmentDistance(e,i,o){let[p,l]=i,f=so(o[0]-p)*this.kx,w=(o[1]-l)*this.ky;if(f!==0||w!==0){const C=(so(e[0]-p)*this.kx*f+(e[1]-l)*this.ky*w)/(f*f+w*w);C>1?(p=o[0],l=o[1]):C>0&&(p+=f/this.kx*C,l+=w/this.ky*C)}return f=so(e[0]-p)*this.kx,w=(e[1]-l)*this.ky,Math.sqrt(f*f+w*w)}pointOnLine(e,i){let o=1/0,p=e[0][0],l=e[0][1],f=0,w=0;for(let C=0;C<e.length-1;C++){let O=e[C][0],x=e[C][1],E=so(e[C+1][0]-O)*this.kx,k=(e[C+1][1]-x)*this.ky,M=0;E===0&&k===0||(M=(so(i[0]-O)*this.kx*E+(i[1]-x)*this.ky*k)/(E*E+k*k),M>1?(O=e[C+1][0],x=e[C+1][1]):M>0&&(O+=E/this.kx*M,x+=k/this.ky*M)),E=so(i[0]-O)*this.kx,k=(i[1]-x)*this.ky;const P=E*E+k*k;P<o&&(o=P,p=O,l=x,f=C,w=M)}return{point:[p,l],index:f,t:Math.max(0,Math.min(1,w))}}lineSlice(e,i,o){let p=this.pointOnLine(o,e),l=this.pointOnLine(o,i);if(p.index>l.index||p.index===l.index&&p.t>l.t){const O=p;p=l,l=O}const f=[p.point],w=p.index+1,C=l.index;!Ju(o[w],f[0])&&w<=C&&f.push(o[w]);for(let O=w+1;O<=C;O++)f.push(o[O]);return Ju(o[C],l.point)||f.push(l.point),f}lineSliceAlong(e,i,o){let p=0;const l=[];for(let f=0;f<o.length-1;f++){const w=o[f],C=o[f+1],O=this.distance(w,C);if(p+=O,p>e&&l.length===0&&l.push($h(w,C,(e-(p-O))/O)),p>=i)return l.push($h(w,C,(i-(p-O))/O)),l;p>e&&l.push(C)}return l}bufferPoint(e,i){const o=i/this.ky,p=i/this.kx;return[e[0]-p,e[1]-o,e[0]+p,e[1]+o]}bufferBBox(e,i){const o=i/this.ky,p=i/this.kx;return[e[0]-p,e[1]-o,e[2]+p,e[3]+o]}insideBBox(e,i){return so(e[0]-i[0])>=0&&so(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function Ju(s,e){return s[0]===e[0]&&s[1]===e[1]}function $h(s,e,i){const o=so(e[0]-s[0]);return[s[0]+o*i,s[1]+(e[1]-s[1])*i]}function so(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}class Os{constructor(e=[],i=(o,p)=>o<p?-1:o>p?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,p=i[e];for(;e>0;){const l=e-1>>1,f=i[l];if(o(p,f)>=0)break;i[e]=f,e=l}i[e]=p}_down(e){const{data:i,compare:o}=this,p=this.length>>1,l=i[e];for(;e<p;){let f=1+(e<<1);const w=f+1;if(w<this.length&&o(i[w],i[f])<0&&(f=w),o(i[f],l)>=0)break;i[e]=i[f],e=f}i[e]=l}}var ei=8192;function rp(s,e){return e.dist-s.dist}const Hh=100,za=50;function bl(s){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==s.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==s[i])return!1;return!0}function fs(s){return s[1]-s[0]+1}function Ya(s,e){const i=s[1]>=s[0]&&s[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function np(s,e){if(s[0]>s[1])return[null,null];const i=fs(s);if(e){if(i===2)return[s,null];const o=Math.floor(i/2);return[[s[0],s[0]+o],[s[0]+o,s[1]]]}{if(i===1)return[s,null];const o=Math.floor(i/2)-1;return[[s[0],s[0]+o],[s[0]+o+1,s[1]]]}}function ic(s,e){const i=[1/0,1/0,-1/0,-1/0];if(!Ya(e,s.length))return i;for(let o=e[0];o<=e[1];++o)Zu(i,s[o]);return i}function rc(s){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<s.length;++i)for(let o=0;o<s[i].length;++o)Zu(e,s[i][o]);return e}function nc(s,e,i){if(bl(s)||bl(e))return NaN;let o=0,p=0;return s[2]<e[0]&&(o=e[0]-s[2]),s[0]>e[2]&&(o=s[0]-e[2]),s[1]>e[3]&&(p=s[1]-e[3]),s[3]<e[1]&&(p=e[1]-s[3]),i.distance([0,0],[o,p])}function Gh(s){return 360*s-180}function $m(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function sc(s,e){const i=Math.pow(2,e.z),o=(s.y/ei+e.y)/i;return[Gh((s.x/ei+e.x)/i),$m(o)]}function oc(s,e){const i=[];for(let o=0;o<s.length;++o)i.push(sc(s[o],e));return i}function _f(s,e,i){const o=i.pointOnLine(e,s).point;return i.distance(s,o)}function sp(s,e,i,o,p){const l=i.slice(o[0],o[1]+1);let f=1/0;for(let w=e[0];w<=e[1];++w)if((f=Math.min(f,_f(s[w],l,p)))===0)return 0;return f}function op(s,e,i,o,p){const l=Math.min(p.pointToSegmentDistance(s,i,o),p.pointToSegmentDistance(e,i,o)),f=Math.min(p.pointToSegmentDistance(i,s,e),p.pointToSegmentDistance(o,s,e));return Math.min(l,f)}function Hm(s,e,i,o,p){if(!Ya(e,s.length)||!Ya(o,i.length))return NaN;let l=1/0;for(let f=e[0];f<e[1];++f)for(let w=o[0];w<o[1];++w){if(Wa(s[f],s[f+1],i[w],i[w+1]))return 0;l=Math.min(l,op(s[f],s[f+1],i[w],i[w+1],p))}return l}function yf(s,e,i,o,p){if(!Ya(e,s.length)||!Ya(o,i.length))return NaN;let l=1/0;for(let f=e[0];f<=e[1];++f)for(let w=o[0];w<=o[1];++w)if((l=Math.min(l,p.distance(s[f],i[w])))===0)return l;return l}function Fa(s,e,i){if(ec(s,e,!0))return 0;let o=1/0;for(const p of e){const l=p.length;if(l<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[l-1]&&(o=Math.min(o,i.pointToSegmentDistance(s,p[l-1],p[0])))===0||(o=Math.min(o,_f(s,p,i)))===0)return o}return o}function ap(s,e,i,o){if(!Ya(e,s.length))return NaN;for(let l=e[0];l<=e[1];++l)if(ec(s[l],i,!0))return 0;let p=1/0;for(let l=e[0];l<e[1];++l)for(const f of i)for(let w=0,C=f.length,O=C-1;w<C;O=w++){if(Wa(s[l],s[l+1],f[O],f[w]))return 0;p=Math.min(p,op(s[l],s[l+1],f[O],f[w],o))}return p}function vf(s,e){for(const i of s)for(let o=0;o<=i.length-1;++o)if(ec(i[o],e,!0))return!0;return!1}function tu(s,e,i,o=1/0){const p=rc(s),l=rc(e);if(o!==1/0&&nc(p,l,i)>=o)return o;if(Kc(p,l)){if(vf(s,e))return 0}else if(vf(e,s))return 0;let f=o;for(const w of s)for(let C=0,O=w.length,x=O-1;C<O;x=C++)for(const E of e)for(let k=0,M=E.length,P=M-1;k<M;P=k++){if(Wa(w[x],w[C],E[P],E[k]))return 0;f=Math.min(f,op(w[x],w[C],E[P],E[k],i))}return f}function ac(s,e,i,o,p,l,f){if(l===null||f===null)return;const w=nc(ic(o,l),ic(p,f),i);w<e&&s.push({dist:w,range1:l,range2:f})}function xf(s,e,i,o,p=1/0){let l=Math.min(o.distance(s[0],i[0][0]),p);if(l===0)return l;const f=new Os([{dist:0,range1:[0,s.length-1],range2:[0,0]}],rp),w=e?za:Hh,C=rc(i);for(;f.length;){const O=f.pop();if(O.dist>=l)continue;const x=O.range1;if(fs(x)<=w){if(!Ya(x,s.length))return NaN;if(e){const E=ap(s,x,i,o);if((l=Math.min(l,E))===0)return l}else for(let E=x[0];E<=x[1];++E){const k=Fa(s[E],i,o);if((l=Math.min(l,k))===0)return l}}else{const E=np(x,e);if(E[0]!==null){const k=nc(ic(s,E[0]),C,o);k<l&&f.push({dist:k,range1:E[0],range2:[0,0]})}if(E[1]!==null){const k=nc(ic(s,E[1]),C,o);k<l&&f.push({dist:k,range1:E[1],range2:[0,0]})}}}return l}function Lo(s,e,i,o,p,l=1/0){let f=Math.min(l,p.distance(s[0],i[0]));if(f===0)return f;const w=new Os([{dist:0,range1:[0,s.length-1],range2:[0,i.length-1]}],rp),C=e?za:Hh,O=o?za:Hh;for(;w.length;){const x=w.pop();if(x.dist>=f)continue;const E=x.range1,k=x.range2;if(fs(E)<=C&&fs(k)<=O){if(!Ya(E,s.length)||!Ya(k,i.length))return NaN;if(e&&o?f=Math.min(f,Hm(s,E,i,k,p)):e||o?e&&!o?f=Math.min(f,sp(i,k,s,E,p)):!e&&o&&(f=Math.min(f,sp(s,E,i,k,p))):f=Math.min(f,yf(s,E,i,k,p)),f===0)return f}else{const M=np(E,e),P=np(k,o);ac(w,f,p,s,i,M[0],P[0]),ac(w,f,p,s,i,M[0],P[1]),ac(w,f,p,s,i,M[1],P[0]),ac(w,f,p,s,i,M[1],P[1])}}return f}function wl(s,e,i,o,p=1/0){let l=p;const f=ic(s,[0,s.length-1]);for(const w of i)if(!(l!==1/0&&nc(f,ic(w,[0,w.length-1]),o)>=l)&&(l=Math.min(l,Lo(s,e,w,!0,o,l)),l===0))return l;return l}function Qu(s,e,i,o,p=1/0){let l=p;const f=ic(s,[0,s.length-1]);for(const w of i){if(l!==1/0&&nc(f,rc(w),o)>=l)continue;const C=xf(s,e,w,o,l);if(isNaN(C))return C;if((l=Math.min(l,C))===0)return l}return l}function lc(s){return s==="Point"||s==="MultiPoint"||s==="LineString"||s==="MultiLineString"||s==="Polygon"||s==="MultiPolygon"}class Sl{constructor(e,i){this.type=yi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(La(e[1])){const o=e[1];if(o.type==="FeatureCollection"){for(let p=0;p<o.features.length;++p)if(lc(o.features[p].geometry.type))return new Sl(o,o.features[p].geometry)}else if(o.type==="Feature"){if(lc(o.geometry.type))return new Sl(o,o.geometry)}else if(lc(o.type))return new Sl(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),o=e.canonicalID();if(i!=null&&o!=null){if(e.geometryType()==="Point")return function(p,l,f){const w=[];for(const O of p)for(const x of O)w.push(sc(x,l));const C=new qa(w[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?Lo(w,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",C):f.type==="MultiLineString"?wl(w,!1,f.coordinates,C):f.type==="Polygon"||f.type==="MultiPolygon"?Qu(w,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,C):null}(i,o,this.geometries);if(e.geometryType()==="LineString")return function(p,l,f){const w=[];for(const O of p){const x=[];for(const E of O)x.push(sc(E,l));w.push(x)}const C=new qa(w[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return wl(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",w,C);if(f.type==="MultiLineString"){let O=1/0;for(let x=0;x<f.coordinates.length;x++){const E=wl(f.coordinates[x],!0,w,C,O);if(isNaN(E))return E;if((O=Math.min(O,E))===0)return O}return O}if(f.type==="Polygon"||f.type==="MultiPolygon"){let O=1/0;for(let x=0;x<w.length;x++){const E=Qu(w[x],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,C,O);if(isNaN(E))return E;if((O=Math.min(O,E))===0)return O}return O}return null}(i,o,this.geometries);if(e.geometryType()==="Polygon")return function(p,l,f){const w=[];for(const O of function(x,E){const k=x.length;if(k<=1)return[x];const M=[];let P,R;for(let $=0;$<k;$++){const H=Um(x[$]);H!==0&&(x[$].area=Math.abs(H),R===void 0&&(R=H<0),R===H<0?(P&&M.push(P),P=[x[$]]):P.push(x[$]))}return P&&M.push(P),M}(p)){const x=[];for(let E=0;E<O.length;++E)x.push(oc(O[E],l));w.push(x)}const C=new qa(w[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return Qu(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",w,C);if(f.type==="MultiLineString"){let O=1/0;for(let x=0;x<f.coordinates.length;x++){const E=Qu(f.coordinates[x],!0,w,C,O);if(isNaN(E))return E;if((O=Math.min(O,E))===0)return O}return O}return f.type==="Polygon"||f.type==="MultiPolygon"?function(O,x,E){let k=1/0;for(const M of O)for(const P of x){const R=tu(M,P,E,k);if(isNaN(R))return R;if((k=Math.min(k,R))===0)return k}return k}(f.type==="Polygon"?[f.coordinates]:f.coordinates,w,C):null}(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Wh(s,e){switch(s){case"string":return ko(e);case"number":return+e;case"boolean":return!!e;case"color":return Ar.parse(e);case"formatted":return Is.fromString(ko(e));case"resolvedImage":return ks.build(ko(e))}return e}function Ro(s,e,i,o){return o!==void 0&&(s=o*Math.round(s/o)),e!==void 0&&s<e&&(s=e),i!==void 0&&s>i&&(s=i),s}class Zo{constructor(e,i,o){this.type=e,this.key=i,this.scope=o}static parse(e,i){let o=i.expectedType;if(o==null&&(o=Tr),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const p=i.parse(e[1],1);if(!(p instanceof ws))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const l=i.parse(e[2],2);return l instanceof ws?new Zo(o,ko(p.value),ko(l.value)):i.error("Scope of 'config' expression must be a string literal.")}return new Zo(o,ko(p.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),o=e.getConfig(i);if(!o)return null;const{type:p,value:l,values:f,minValue:w,maxValue:C,stepValue:O}=o,x=o.default.evaluate(e);let E=x;if(l){const k=e.scope;e.scope=(k||"").split("").slice(1).join(""),E=l.evaluate(e),e.scope=k}return p&&(E=Wh(p,E)),E===void 0||w===void 0&&C===void 0&&O===void 0||(typeof E=="number"?E=Ro(E,w,C,O):Array.isArray(E)&&(E=E.map(k=>typeof k=="number"?Ro(k,w,C,O):k))),l!==void 0&&E!==void 0&&f&&!f.includes(E)&&(E=x,p&&(E=Wh(p,E))),(p&&p!==this.type||E!==void 0&&Qr(E)!==this.type)&&(E=Wh(this.type.kind,E)),E}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function iu(s){if(s instanceof no&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Oi||s instanceof Sl)return!1;let e=!0;return s.eachChild(i=>{e&&!iu(i)&&(e=!1)}),e}function ru(s){if(s instanceof no&&s.name==="feature-state")return!1;let e=!0;return s.eachChild(i=>{e&&!ru(i)&&(e=!1)}),e}function eh(s){if(s instanceof Zo)return new Set([s.key]);let e=new Set;return s.eachChild(i=>{e=new Set([...e,...eh(i)])}),e}function Xa(s,e){if(s instanceof no&&e.indexOf(s.name)>=0)return!1;let i=!0;return s.eachChild(o=>{i&&!Xa(o,e)&&(i=!1)}),i}class cc{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new cc(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class nu{constructor(e,i=[],o,p=new qc,l=[],f,w){this.registry=e,this.path=i,this.key=i.map(C=>typeof C=="string"?`['${C}']`:`[${C}]`).join(""),this.scope=p,this.errors=l,this.expectedType=o,this._scope=f,this.options=w}parse(e,i,o,p,l={}){return i||o?this.concat(i,null,o,p)._parse(e,l):this._parse(e,l)}parseObjectValue(e,i,o,p,l,f={}){return this.concat(i,o,p,l)._parse(e,f)}_parse(e,i){function o(p,l,f){return f==="assert"?new Xo(l,[p]):f==="coerce"?new Ra(l,[p]):p}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(p){let l=p.parse(e,this);if(!l)return null;if(this.expectedType){const f=this.expectedType,w=l.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||w.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(f,w))return null}else l=o(l,f,i.typeAnnotation||"coerce");else l=o(l,f,i.typeAnnotation||"assert")}if(!(l instanceof ws)&&l.type.kind!=="resolvedImage"&&qh(l)){const f=new Qd(this._scope,this.options);try{l=new ws(l.type,l.evaluate(f))}catch(w){return this.error(w.message),null}}return l}return Ra.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o,p){let l=typeof e=="number"?this.path.concat(e):this.path;l=typeof i=="string"?l.concat(i):l;const f=p?this.scope.concat(p):this.scope;return new nu(this.registry,l,o||null,f,this.errors,this._scope,this.options)}error(e,...i){const o=`${this.key}${i.map(p=>`[${p}]`).join("")}`;this.errors.push(new Ji(o,e))}checkSubtype(e,i){const o=Js(e,i);return o&&this.error(o),o}}var su=nu;function qh(s){if(s instanceof cc)return qh(s.boundExpression);if(s instanceof no&&s.name==="error"||s instanceof Nh||s instanceof Oi||s instanceof Sl||s instanceof Zo)return!1;const e=s instanceof Ra||s instanceof Xo;let i=!0;return s.eachChild(o=>{i=e?i&&qh(o):i&&o instanceof ws}),!!i&&iu(s)&&Xa(s,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function uc(s,e){const i=s.length-1;let o,p,l=0,f=i,w=0;for(;l<=f;)if(w=Math.floor((l+f)/2),o=s[w],p=s[w+1],o<=e){if(w===i||e<p)return w;l=w+1}else{if(!(o>e))throw new yn("Input is not a number.");f=w-1}return 0}class Ls{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[p,l]of o)this.labels.push(p),this.outputs.push(l)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,yi);if(!o)return null;const p=[];let l=null;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);for(let f=1;f<e.length;f+=2){const w=f===1?-1/0:e[f],C=e[f+1],O=f,x=f+1;if(typeof w!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(p.length&&p[p.length-1][0]>=w)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const E=i.parse(C,x,l);if(!E)return null;l=l||E.type,p.push([w,E])}return new Ls(l,o,p)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const p=this.input.evaluate(e);if(p<=i[0])return o[0].evaluate(e);const l=i.length;return p>=i[l-1]?o[l-1].evaluate(e):o[uc(i,p)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Yr=.95047,fr=1.08883,lp=4/29,Tl=6/29,th=3*Tl*Tl,An=Tl*Tl*Tl,bf=Math.PI/180,sn=180/Math.PI;function Yh(s){return s>An?Math.pow(s,1/3):s/th+lp}function ir(s){return s>Tl?s*s*s:th*(s-lp)}function Xh(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function ou(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function wf(s){const e=ou(s.r),i=ou(s.g),o=ou(s.b),p=Yh((.4124564*e+.3575761*i+.1804375*o)/Yr),l=Yh((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*l-16,a:500*(p-l),b:200*(l-Yh((.0193339*e+.119192*i+.9503041*o)/fr)),alpha:s.a}}function ih(s){let e=(s.l+16)/116,i=isNaN(s.a)?e:e+s.a/500,o=isNaN(s.b)?e:e-s.b/200;return e=1*ir(e),i=Yr*ir(i),o=fr*ir(o),new Ar(Xh(3.2404542*i-1.5371385*e-.4985314*o),Xh(-.969266*i+1.8760108*e+.041556*o),Xh(.0556434*i-.2040259*e+1.0572252*o),s.alpha)}function Or(s,e,i){const o=e-s;return s+i*(o>180||o<-180?o-360*Math.round(o/360):o)}const Ml={forward:wf,reverse:ih,interpolate:function(s,e,i){return{l:Di(s.l,e.l,i),a:Di(s.a,e.a,i),b:Di(s.b,e.b,i),alpha:Di(s.alpha,e.alpha,i)}}},rh={forward:function(s){const{l:e,a:i,b:o}=wf(s),p=Math.atan2(o,i)*sn;return{h:p<0?p+360:p,c:Math.sqrt(i*i+o*o),l:e,alpha:s.a}},reverse:function(s){const e=s.h*bf,i=s.c;return ih({l:s.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:s.alpha})},interpolate:function(s,e,i){return{h:Or(s.h,e.h,i),c:Di(s.c,e.c,i),l:Di(s.l,e.l,i),alpha:Di(s.alpha,e.alpha,i)}}};var Sf=Object.freeze({__proto__:null,hcl:rh,lab:Ml});class vo{constructor(e,i,o,p,l,f){this.type=e,this.operator=i,this.interpolation=o,this.input=p,this.dynamicStops=l,this.labels=[],this.outputs=[];for(const[w,C]of f)this.labels.push(w),this.outputs.push(C)}static interpolationFactor(e,i,o,p){let l=0;if(e.name==="exponential")l=Zh(i,e.base,o,p);else if(e.name==="linear")l=Zh(i,1,o,p);else if(e.name==="cubic-bezier"){const f=e.controlPoints;l=new Bi(f[0],f[1],f[2],f[3]).solve(Zh(i,1,o,p))}return l}static parse(e,i){let[o,p,l,...f]=e;if(!Array.isArray(p)||p.length===0)return i.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const O=p[1];if(typeof O!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:O}}else{if(p[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const O=p.slice(1);if(O.length!==4||O.some(x=>typeof x!="number"||x<0||x>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:O}}}if(e.length-1<3)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(l=i.parse(l,2,yi),!l)return null;const w=[];let C=null;if(o==="interpolate-hcl"||o==="interpolate-lab"?C=Hs:i.expectedType&&i.expectedType.kind!=="value"&&(C=i.expectedType),e.length-1==3){const O=i.parse(f[0],3,Tr);return O?new vo(C,o,p,l,O,w):null}for(let O=0;O<f.length;O+=2){const x=f[O],E=f[O+1],k=O+3,M=O+4;if(typeof x!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(w.length&&w[w.length-1][0]>=x)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const P=i.parse(E,M,C);if(!P)return null;C=C||P.type,w.push([x,P])}return C.kind==="number"||C.kind==="color"||C.kind==="array"&&C.itemType.kind==="number"&&typeof C.N=="number"?new vo(C,o,p,l,null,w):i.error(`Type ${wn(C)} is not interpolatable.`)}evaluate(e){let i=this.labels,o=this.outputs;if(this.dynamicStops){const x=this.dynamicStops.evaluate(e);if(x.length%2!=0)throw new yn("Expected an even number of arguments.");i=[],o=[];for(let E=0;E<x.length;E+=2){const k=x[E],M=new ws(yi,x[E+1]);if(typeof k!="number")throw new yn('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.');if(i.length&&i[i.length-1]>=k)throw new yn('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.');i.push(k),o.push(M)}if(i.length===0)throw new yn("Expected at least one input/output pair.")}if(i.length===1)return o[0].evaluate(e);const p=this.input.evaluate(e);if(p<=i[0])return o[0].evaluate(e);const l=i.length;if(p>=i[l-1])return o[l-1].evaluate(e);const f=uc(i,p),w=vo.interpolationFactor(this.interpolation,p,i[f],i[f+1]),C=o[f].evaluate(e),O=o[f+1].evaluate(e);return this.operator==="interpolate"?Io[this.type.kind.toLowerCase()](C,O,w):this.operator==="interpolate-hcl"?rh.reverse(rh.interpolate(rh.forward(C),rh.forward(O),w)):Ml.reverse(Ml.interpolate(Ml.forward(C),Ml.forward(O),w))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];if(this.dynamicStops)i.push(this.dynamicStops.serialize());else for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function Zh(s,e,i,o){const p=o-i,l=s-i;return p===0?0:e===1?l/p:(Math.pow(e,l)-1)/(Math.pow(e,p)-1)}class Za{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const p=i.expectedType;p&&p.kind!=="value"&&(o=p);const l=[];for(const w of e.slice(1)){const C=i.parse(w,1+l.length,o,void 0,{typeAnnotation:"omit"});if(!C)return null;o=o||C.type,l.push(C)}const f=p&&l.some(w=>Js(p,w.type));return new Za(f?Tr:o,l)}evaluate(e){let i,o=null,p=0;for(const l of this.args){if(p++,o=l.evaluate(e),o&&o instanceof ks&&!o.available&&(i||(i=o),o=null,p===this.args.length))return i;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Kh{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let l=1;l<e.length-1;l+=2){const f=e[l];if(typeof f!="string")return i.error(`Expected string, but found ${typeof f} instead.`,l);if(/[^a-zA-Z0-9_]/.test(f))return i.error("Variable names must contain only alphanumeric characters or '_'.",l);const w=i.parse(e[l+1],l+1);if(!w)return null;o.push([f,w])}const p=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return p?new Kh(o,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}class cp{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,yi),p=i.parse(e[2],2,bs(i.expectedType||Tr));return o&&p?new cp(p.type.itemType,o,p):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new yn(`Array index out of bounds: ${i} < 0.`);if(i>o.length-1)throw new yn(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i===Math.floor(i))return o[i];const p=Math.floor(i),l=Math.ceil(i),f=o[p],w=o[l];if(typeof f!="number"||typeof w!="number")throw new yn(`Cannot interpolate between non-number values at index ${i}.`);const C=i-p;return f*(1-C)+w*C}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class up{constructor(e,i){this.type=Sr,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Tr),p=i.parse(e[2],2,Tr);return o&&p?rs(o.type,[Sr,Lr,yi,Ha,Tr])?new up(o,p):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${wn(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!_o(i,["boolean","string","number","null"]))throw new yn(`Expected first argument to be of type boolean, string, number or null, but found ${wn(Qr(i))} instead.`);if(!_o(o,["string","array"]))throw new yn(`Expected second argument to be of type array or string, but found ${wn(Qr(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class hc{constructor(e,i,o){this.type=yi,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Tr),p=i.parse(e[2],2,Tr);if(!o||!p)return null;if(!rs(o.type,[Sr,Lr,yi,Ha,Tr]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${wn(o.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,yi);return l?new hc(o,p,l):null}return new hc(o,p)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!_o(i,["boolean","string","number","null"]))throw new yn(`Expected first argument to be of type boolean, string, number or null, but found ${wn(Qr(i))} instead.`);if(!_o(o,["string","array"]))throw new yn(`Expected second argument to be of type array or string, but found ${wn(Qr(o))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(e);return o.indexOf(i,p)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class hp{constructor(e,i,o,p,l,f){this.inputType=e,this.type=i,this.input=o,this.cases=p,this.outputs=l,this.otherwise=f}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,p;i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);const l={},f=[];for(let O=2;O<e.length-1;O+=2){let x=e[O];const E=e[O+1];Array.isArray(x)||(x=[x]);const k=i.concat(O);if(x.length===0)return k.error("Expected at least one branch label.");for(const P of x){if(typeof P!="number"&&typeof P!="string")return k.error("Branch labels must be numbers or strings.");if(typeof P=="number"&&Math.abs(P)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof P=="number"&&Math.floor(P)!==P)return k.error("Numeric branch labels must be integer values.");if(o){if(k.checkSubtype(o,Qr(P)))return null}else o=Qr(P);if(l[String(P)]!==void 0)return k.error("Branch labels must be unique.");l[String(P)]=f.length}const M=i.parse(E,O,p);if(!M)return null;p=p||M.type,f.push(M)}const w=i.parse(e[1],1,Tr);if(!w)return null;const C=i.parse(e[e.length-1],e.length-1,p);return C?w.type.kind!=="value"&&i.concat(1).checkSubtype(o,w.type)?null:new hp(o,p,w,l,f,C):null}evaluate(e){const i=this.input.evaluate(e);return(Qr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],p={};for(const f of i){const w=p[this.cases[f]];w===void 0?(p[this.cases[f]]=o.length,o.push([this.cases[f],[f]])):o[w][1].push(f)}const l=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,w]of o)e.push(w.length===1?l(w[0]):w.map(l)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class Jh{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const p=[];for(let f=1;f<e.length-1;f+=2){const w=i.parse(e[f],f,Sr);if(!w)return null;const C=i.parse(e[f+1],f+1,o);if(!C)return null;p.push([w,C]),o=o||C.type}const l=i.parse(e[e.length-1],e.length-1,o);return l?new Jh(o,p,l):null}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Qh{constructor(e,i,o,p){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=p}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Tr),p=i.parse(e[2],2,yi);if(!o||!p)return null;if(!rs(o.type,[bs(Tr),Lr,Tr]))return i.error(`Expected first argument to be of type array or string, but found ${wn(o.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,yi);return l?new Qh(o.type,o,p,l):null}return new Qh(o.type,o,p)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!_o(i,["string","array"]))throw new yn(`Expected first argument to be of type array or string, but found ${wn(Qr(i))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(e);return i.slice(o,p)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Tf(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Mf(s,e,i,o){return o.compare(e,i)===0}function au(s,e,i){const o=s!=="=="&&s!=="!=";return class gM{constructor(l,f,w){this.type=Sr,this.lhs=l,this.rhs=f,this.collator=w,this.hasUntypedArgument=l.type.kind==="value"||f.type.kind==="value"}static parse(l,f){if(l.length!==3&&l.length!==4)return f.error("Expected two or three arguments.");const w=l[0];let C=f.parse(l[1],1,Tr);if(!C)return null;if(!Tf(w,C.type))return f.concat(1).error(`"${w}" comparisons are not supported for type '${wn(C.type)}'.`);let O=f.parse(l[2],2,Tr);if(!O)return null;if(!Tf(w,O.type))return f.concat(2).error(`"${w}" comparisons are not supported for type '${wn(O.type)}'.`);if(C.type.kind!==O.type.kind&&C.type.kind!=="value"&&O.type.kind!=="value")return f.error(`Cannot compare types '${wn(C.type)}' and '${wn(O.type)}'.`);o&&(C.type.kind==="value"&&O.type.kind!=="value"?C=new Xo(O.type,[C]):C.type.kind!=="value"&&O.type.kind==="value"&&(O=new Xo(C.type,[O])));let x=null;if(l.length===4){if(C.type.kind!=="string"&&O.type.kind!=="string"&&C.type.kind!=="value"&&O.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(x=f.parse(l[3],3,Oa),!x)return null}return new gM(C,O,x)}evaluate(l){const f=this.lhs.evaluate(l),w=this.rhs.evaluate(l);if(o&&this.hasUntypedArgument){const C=Qr(f),O=Qr(w);if(C.kind!==O.kind||C.kind!=="string"&&C.kind!=="number")throw new yn(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${C.kind}, ${O.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const C=Qr(f),O=Qr(w);if(C.kind!=="string"||O.kind!=="string")return e(l,f,w)}return this.collator?i(l,f,w,this.collator.evaluate(l)):e(l,f,w)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){const l=[s];return this.eachChild(f=>{l.push(f.serialize())}),l}}}const Gm=au("==",function(s,e,i){return e===i},Mf),Cf=au("!=",function(s,e,i){return e!==i},function(s,e,i,o){return!Mf(0,e,i,o)}),Wm=au("<",function(s,e,i){return e<i},function(s,e,i,o){return o.compare(e,i)<0}),qm=au(">",function(s,e,i){return e>i},function(s,e,i,o){return o.compare(e,i)>0}),Ef=au("<=",function(s,e,i){return e<=i},function(s,e,i,o){return o.compare(e,i)<=0}),Af=au(">=",function(s,e,i){return e>=i},function(s,e,i,o){return o.compare(e,i)>=0});class Ko{constructor(e,i,o,p,l,f){this.type=Lr,this.number=e,this.locale=i,this.currency=o,this.unit=p,this.minFractionDigits=l,this.maxFractionDigits=f}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,yi);if(!o)return null;const p=e[2];if(typeof p!="object"||Array.isArray(p))return i.error("NumberFormat options argument must be an object.");let l=null;if(p.locale&&(l=i.parseObjectValue(p.locale,2,"locale",Lr),!l))return null;let f=null;if(p.currency&&(f=i.parseObjectValue(p.currency,2,"currency",Lr),!f))return null;let w=null;if(p.unit&&(w=i.parseObjectValue(p.unit,2,"unit",Lr),!w))return null;let C=null;if(p["min-fraction-digits"]&&(C=i.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",yi),!C))return null;let O=null;return p["max-fraction-digits"]&&(O=i.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",yi),!O)?null:new Ko(o,l,f,w,C,O)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class dp{constructor(e){this.type=yi,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${wn(o.type)} instead.`):new dp(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new yn(`Expected value to be of type string or array, but found ${wn(Qr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function ed(s){return function(){s=1831565813+(s|=0)|0;let e=Math.imul(s^s>>>15,1|s);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const lu={"==":Gm,"!=":Cf,">":qm,"<":Wm,">=":Af,"<=":Ef,array:Xo,at:cp,boolean:Xo,case:Jh,coalesce:Za,collator:Nh,format:Ga,image:Zc,in:up,"index-of":hc,interpolate:vo,"interpolate-hcl":vo,"interpolate-lab":vo,length:dp,let:Kh,literal:ws,match:hp,number:Xo,"number-format":Ko,object:Xo,slice:Qh,step:Ls,string:Xo,"to-boolean":Ra,"to-color":Ra,"to-number":Ra,"to-string":Ra,var:cc,within:Oi,distance:Sl,config:Zo};function td(s,[e,i,o,p]){e=e.evaluate(s),i=i.evaluate(s),o=o.evaluate(s);const l=p?p.evaluate(s):1,f=Yc(e,i,o,l);if(f)throw new yn(f);return new Ar(e/255*l,i/255*l,o/255*l,l)}function Pf(s,[e,i,o,p]){e=e.evaluate(s),i=i.evaluate(s),o=o.evaluate(s);const l=p?p.evaluate(s):1,f=function(O,x,E,k){return typeof O=="number"&&O>=0&&O<=360?typeof x=="number"&&x>=0&&x<=100&&typeof E=="number"&&E>=0&&E<=100?k===void 0||typeof k=="number"&&k>=0&&k<=1?null:`Invalid hsla value [${[O,x,E,k].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof k=="number"?[O,x,E,k]:[O,x,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof k=="number"?[O,x,E,k]:[O,x,E]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,o,l);if(f)throw new yn(f);const w=`hsla(${e}, ${i}%, ${o}%, ${l})`,C=Ar.parse(w);if(!C)throw new yn(`Failed to parse HSLA color: ${w}`);return C}function Df(s,e){return s in e}function cu(s,e){const i=e[s];return i===void 0?null:i}function Cl(s){return{type:s}}function id(s){return{result:"success",value:s}}function zo(s){return{result:"error",value:s}}function rd(s,e){return!!s&&!!s.parameters&&s.parameters.indexOf(e)>-1}function uu(s){return s["property-type"]==="data-driven"}function If(s){return rd(s.expression,"measure-light")}function nd(s){return rd(s.expression,"zoom")}function nh(s){return!!s.expression&&s.expression.interpolated}function El(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function kf(s){return s}function pp(s,e){const i=e.type==="color",o=s.stops&&typeof s.stops[0][0]=="object",p=o||!(o||s.property!==void 0),l=s.type||(nh(e)?"exponential":"interval");if(i&&((s=Bh({},s)).stops&&(s.stops=s.stops.map(O=>[O[0],Ar.parse(O[1])])),s.default=Ar.parse(s.default?s.default:e.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!Sf[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let f,w,C;if(l==="exponential")f=Lf;else if(l==="interval")f=Ym;else if(l==="categorical"){f=Of,w=Object.create(null);for(const O of s.stops)w[O[0]]=O[1];C=typeof s.stops[0][0]}else{if(l!=="identity")throw new Error(`Unknown function type "${l}"`);f=Rf}if(o){const O={},x=[];for(let M=0;M<s.stops.length;M++){const P=s.stops[M],R=P[0].zoom;O[R]===void 0&&(O[R]={zoom:R,type:s.type,property:s.property,default:s.default,stops:[]},x.push(R)),O[R].stops.push([P[0].value,P[1]])}const E=[];for(const M of x)E.push([O[M].zoom,pp(O[M],e)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:vo.interpolationFactor.bind(void 0,k),zoomStops:E.map(M=>M[0]),evaluate:({zoom:M},P)=>Lf({stops:E,base:s.base},e,M).evaluate(M,P)}}if(p){const O=l==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:O,interpolationFactor:vo.interpolationFactor.bind(void 0,O),zoomStops:s.stops.map(x=>x[0]),evaluate:({zoom:x})=>f(s,e,x,w,C)}}return{kind:"source",evaluate(O,x){const E=x&&x.properties?x.properties[s.property]:void 0;return E===void 0?hu(s.default,e.default):f(s,e,E,w,C)}}}function hu(s,e,i){return s!==void 0?s:e!==void 0?e:i!==void 0?i:void 0}function Of(s,e,i,o,p){return hu(typeof i===p?o[i]:void 0,s.default,e.default)}function Ym(s,e,i){if(Oo(i)!=="number")return hu(s.default,e.default);const o=s.stops.length;if(o===1||i<=s.stops[0][0])return s.stops[0][1];if(i>=s.stops[o-1][0])return s.stops[o-1][1];const p=uc(s.stops.map(l=>l[0]),i);return s.stops[p][1]}function Lf(s,e,i){const o=s.base!==void 0?s.base:1;if(Oo(i)!=="number")return hu(s.default,e.default);const p=s.stops.length;if(p===1||i<=s.stops[0][0])return s.stops[0][1];if(i>=s.stops[p-1][0])return s.stops[p-1][1];const l=uc(s.stops.map(x=>x[0]),i),f=function(x,E,k,M){const P=M-k,R=x-k;return P===0?0:E===1?R/P:(Math.pow(E,R)-1)/(Math.pow(E,P)-1)}(i,o,s.stops[l][0],s.stops[l+1][0]),w=s.stops[l][1],C=s.stops[l+1][1];let O=Io[e.type]||kf;if(s.colorSpace&&s.colorSpace!=="rgb"){const x=Sf[s.colorSpace];O=(E,k)=>x.reverse(x.interpolate(x.forward(E),x.forward(k),f))}return typeof w.evaluate=="function"?{evaluate(...x){const E=w.evaluate.apply(void 0,x),k=C.evaluate.apply(void 0,x);if(E!==void 0&&k!==void 0)return O(E,k,f)}}:O(w,C,f)}function Rf(s,e,i){return e.type==="color"?i=Ar.parse(i):e.type==="formatted"?i=Is.fromString(i.toString()):e.type==="resolvedImage"?i=ks.build(i.toString()):Oo(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),hu(i,s.default,e.default)}no.register(lu,{error:[{kind:"error"},[Lr],(s,[e])=>{throw new yn(e.evaluate(s))}],typeof:[Lr,[Tr],(s,[e])=>wn(Qr(e.evaluate(s)))],"to-rgba":[bs(yi,4),[Hs],(s,[e])=>e.evaluate(s).toRenderColor(null).toArray()],"to-hsla":[bs(yi,4),[Hs],(s,[e])=>e.evaluate(s).toRenderColor(null).toHslaArray()],rgb:[Hs,[yi,yi,yi],td],rgba:[Hs,[yi,yi,yi,yi],td],hsl:[Hs,[yi,yi,yi],Pf],hsla:[Hs,[yi,yi,yi,yi],Pf],has:{type:Sr,overloads:[[[Lr],(s,[e])=>Df(e.evaluate(s),s.properties())],[[Lr,ka],(s,[e,i])=>Df(e.evaluate(s),i.evaluate(s))]]},get:{type:Tr,overloads:[[[Lr],(s,[e])=>cu(e.evaluate(s),s.properties())],[[Lr,ka],(s,[e,i])=>cu(e.evaluate(s),i.evaluate(s))]]},"feature-state":[Tr,[Lr],(s,[e])=>cu(e.evaluate(s),s.featureState||{})],properties:[ka,[],s=>s.properties()],"geometry-type":[Lr,[],s=>s.geometryType()],id:[Tr,[],s=>s.id()],zoom:[yi,[],s=>s.globals.zoom],pitch:[yi,[],s=>s.globals.pitch||0],"distance-from-center":[yi,[],s=>s.distanceFromCenter()],"measure-light":[yi,[Lr],(s,[e])=>s.measureLight(e.evaluate(s))],"heatmap-density":[yi,[],s=>s.globals.heatmapDensity||0],"line-progress":[yi,[],s=>s.globals.lineProgress||0],"raster-value":[yi,[],s=>s.globals.rasterValue||0],"raster-particle-speed":[yi,[],s=>s.globals.rasterParticleSpeed||0],"sky-radial-progress":[yi,[],s=>s.globals.skyRadialProgress||0],accumulated:[Tr,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[yi,Cl(yi),(s,e)=>{let i=0;for(const o of e)i+=o.evaluate(s);return i}],"*":[yi,Cl(yi),(s,e)=>{let i=1;for(const o of e)i*=o.evaluate(s);return i}],"-":{type:yi,overloads:[[[yi,yi],(s,[e,i])=>e.evaluate(s)-i.evaluate(s)],[[yi],(s,[e])=>-e.evaluate(s)]]},"/":[yi,[yi,yi],(s,[e,i])=>e.evaluate(s)/i.evaluate(s)],"%":[yi,[yi,yi],(s,[e,i])=>e.evaluate(s)%i.evaluate(s)],ln2:[yi,[],()=>Math.LN2],pi:[yi,[],()=>Math.PI],e:[yi,[],()=>Math.E],"^":[yi,[yi,yi],(s,[e,i])=>Math.pow(e.evaluate(s),i.evaluate(s))],sqrt:[yi,[yi],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[yi,[yi],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[yi,[yi],(s,[e])=>Math.log(e.evaluate(s))],log2:[yi,[yi],(s,[e])=>Math.log(e.evaluate(s))/Math.LN2],sin:[yi,[yi],(s,[e])=>Math.sin(e.evaluate(s))],cos:[yi,[yi],(s,[e])=>Math.cos(e.evaluate(s))],tan:[yi,[yi],(s,[e])=>Math.tan(e.evaluate(s))],asin:[yi,[yi],(s,[e])=>Math.asin(e.evaluate(s))],acos:[yi,[yi],(s,[e])=>Math.acos(e.evaluate(s))],atan:[yi,[yi],(s,[e])=>Math.atan(e.evaluate(s))],min:[yi,Cl(yi),(s,e)=>Math.min(...e.map(i=>i.evaluate(s)))],max:[yi,Cl(yi),(s,e)=>Math.max(...e.map(i=>i.evaluate(s)))],abs:[yi,[yi],(s,[e])=>Math.abs(e.evaluate(s))],round:[yi,[yi],(s,[e])=>{const i=e.evaluate(s);return i<0?-Math.round(-i):Math.round(i)}],floor:[yi,[yi],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[yi,[yi],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[Sr,[Lr,Tr],(s,[e,i])=>s.properties()[e.value]===i.value],"filter-id-==":[Sr,[Tr],(s,[e])=>s.id()===e.value],"filter-type-==":[Sr,[Lr],(s,[e])=>s.geometryType()===e.value],"filter-<":[Sr,[Lr,Tr],(s,[e,i])=>{const o=s.properties()[e.value],p=i.value;return typeof o==typeof p&&o<p}],"filter-id-<":[Sr,[Tr],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[Sr,[Lr,Tr],(s,[e,i])=>{const o=s.properties()[e.value],p=i.value;return typeof o==typeof p&&o>p}],"filter-id->":[Sr,[Tr],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[Sr,[Lr,Tr],(s,[e,i])=>{const o=s.properties()[e.value],p=i.value;return typeof o==typeof p&&o<=p}],"filter-id-<=":[Sr,[Tr],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[Sr,[Lr,Tr],(s,[e,i])=>{const o=s.properties()[e.value],p=i.value;return typeof o==typeof p&&o>=p}],"filter-id->=":[Sr,[Tr],(s,[e])=>{const i=s.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[Sr,[Tr],(s,[e])=>e.value in s.properties()],"filter-has-id":[Sr,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Sr,[bs(Lr)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[Sr,[bs(Tr)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[Sr,[Lr,bs(Tr)],(s,[e,i])=>i.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[Sr,[Lr,bs(Tr)],(s,[e,i])=>function(o,p,l,f){for(;l<=f;){const w=l+f>>1;if(p[w]===o)return!0;p[w]>o?f=w-1:l=w+1}return!1}(s.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Sr,overloads:[[[Sr,Sr],(s,[e,i])=>e.evaluate(s)&&i.evaluate(s)],[Cl(Sr),(s,e)=>{for(const i of e)if(!i.evaluate(s))return!1;return!0}]]},any:{type:Sr,overloads:[[[Sr,Sr],(s,[e,i])=>e.evaluate(s)||i.evaluate(s)],[Cl(Sr),(s,e)=>{for(const i of e)if(i.evaluate(s))return!0;return!1}]]},"!":[Sr,[Sr],(s,[e])=>!e.evaluate(s)],"is-supported-script":[Sr,[Lr],(s,[e])=>{const i=s.globals&&s.globals.isSupportedScript;return!i||i(e.evaluate(s))}],upcase:[Lr,[Lr],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[Lr,[Lr],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[Lr,Cl(Tr),(s,e)=>e.map(i=>ko(i.evaluate(s))).join("")],"resolved-locale":[Lr,[Oa],(s,[e])=>e.evaluate(s).resolvedLocale()],random:[yi,[yi,yi,Tr],(s,e)=>{const[i,o,p]=e.map(f=>f.evaluate(s));if(i>o||i===o)return i;let l;if(typeof p=="string")l=function(f){let w=0;if(f.length===0)return w;for(let C=0;C<f.length;C++)w=(w<<5)-w+f.charCodeAt(C),w|=0;return w}(p);else{if(typeof p!="number")throw new yn(`Invalid seed input: ${p}`);l=p}return i+ed(l)()*(o-i)}]});class du{constructor(e,i,o,p){this.expression=e,this._warningHistory={},this._evaluator=new Qd(o,p),this._defaultValue=i?function(l){return l.type==="color"&&(El(l.default)||Array.isArray(l.default))?new Ar(0,0,0,0):l.type==="color"?Ar.parse(l.default)||null:l.default===void 0?null:l.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=eh(e)}evaluateWithoutErrorHandling(e,i,o,p,l,f,w,C){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=p||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,p,l,f,w,C){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=C||null;try{const O=this.expression.evaluate(this._evaluator);if(O==null||typeof O=="number"&&O!=O)return this._defaultValue;if(this._enumValues&&!(O in this._enumValues))throw new yn(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(O)} instead.`);return O}catch(O){return this._warningHistory[O.message]||(this._warningHistory[O.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${O.message}`)),this._defaultValue}}}function pu(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in lu}function la(s,e,i,o){const p=new su(lu,[],e?function(f){const w={color:Hs,string:Lr,number:yi,enum:Lr,boolean:Sr,formatted:ps,resolvedImage:_l};return f.type==="array"?bs(w[f.value]||Tr,f.length):w[f.type]}(e):void 0,void 0,void 0,i,o),l=p.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?id(new du(l,e,i,o)):zo(p.errors)}class sd{constructor(e,i,o,p){this.kind=e,this._styleExpression=i,this.isLightConstant=o,this.isLineProgressConstant=p,this.isStateDependent=e!=="constant"&&!ru(i.expression),this.configDependencies=eh(i.expression)}evaluateWithoutErrorHandling(e,i,o,p,l,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,p,l,f)}evaluate(e,i,o,p,l,f){return this._styleExpression.evaluate(e,i,o,p,l,f)}}class dc{constructor(e,i,o,p,l,f){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!ru(i.expression),this.isLightConstant=l,this.isLineProgressConstant=f,this.configDependencies=eh(i.expression),this.interpolationType=p}evaluateWithoutErrorHandling(e,i,o,p,l,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,p,l,f)}evaluate(e,i,o,p,l,f){return this._styleExpression.evaluate(e,i,o,p,l,f)}interpolationFactor(e,i,o){return this.interpolationType?vo.interpolationFactor(this.interpolationType,e,i,o):0}}function zf(s,e,i,o){if((s=la(s,e,i,o)).result==="error")return s;const p=s.value.expression,l=iu(p);if(!l&&!uu(e))return zo([new Ji("","data expressions not supported")]);const f=Xa(p,["zoom","pitch","distance-from-center"]);if(!f&&!nd(e))return zo([new Ji("","zoom expressions not supported")]);const w=Xa(p,["measure-light"]);if(!w&&!If(e))return zo([new Ji("","measure-light expression not supported")]);const C=Xa(p,["line-progress"]);if(!C&&!function(E){return rd(E.expression,"line-progress")}(e))return zo([new Ji("","line-progress expression not supported")]);const O=e.expression&&e.expression.relaxZoomRestriction,x=fu(p);return x||f||O?x instanceof Ji?zo([x]):x instanceof vo&&!nh(e)?zo([new Ji("",'"interpolate" expressions cannot be used with this property')]):id(x?new dc(l&&C?"camera":"composite",s.value,x.labels,x instanceof vo?x.interpolation:void 0,w,C):new sd(l&&C?"constant":"source",s.value,w,C)):zo([new Ji("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class pc{constructor(e,i){this._parameters=e,this._specification=i,Bh(this,pp(this._parameters,this._specification))}static deserialize(e){return new pc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function fu(s){let e=null;if(s instanceof Kh)e=fu(s.result);else if(s instanceof Za){for(const i of s.args)if(e=fu(i),e)break}else(s instanceof Ls||s instanceof vo)&&s.input instanceof no&&s.input.name==="zoom"&&(e=s);return e instanceof Ji||s.eachChild(i=>{const o=fu(i);o instanceof Ji?e=o:e&&o&&e!==o&&(e=new Ji("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var fp,Ff,Xm=function(){if(Ff)return fp;Ff=1,fp=e;var s=3;function e(i,o,p){var l=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var f=new Int32Array(this.arrayBuffer);i=f[0],this.d=(o=f[1])+2*(p=f[2]);for(var w=0;w<this.d*this.d;w++){var C=f[s+w],O=f[s+w+1];l.push(C===O?null:f.subarray(C,O))}var x=f[s+l.length+1];this.keys=f.subarray(f[s+l.length],x),this.bboxes=f.subarray(x),this.insert=this._insertReadonly}else{this.d=o+2*p;for(var E=0;E<this.d*this.d;E++)l.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=i,this.padding=p,this.scale=o/i,this.uid=0;var k=p/o*i;this.min=-k,this.max=i+k}return e.prototype.insert=function(i,o,p,l,f){this._forEachCell(o,p,l,f,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(o),this.bboxes.push(p),this.bboxes.push(l),this.bboxes.push(f)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,o,p,l,f,w){this.cells[f].push(w)},e.prototype.query=function(i,o,p,l,f){var w=this.min,C=this.max;if(i<=w&&o<=w&&C<=p&&C<=l&&!f)return Array.prototype.slice.call(this.keys);var O=[];return this._forEachCell(i,o,p,l,this._queryCell,O,{},f),O},e.prototype._queryCell=function(i,o,p,l,f,w,C,O){var x=this.cells[f];if(x!==null)for(var E=this.keys,k=this.bboxes,M=0;M<x.length;M++){var P=x[M];if(C[P]===void 0){var R=4*P;(O?O(k[R+0],k[R+1],k[R+2],k[R+3]):i<=k[R+2]&&o<=k[R+3]&&p>=k[R+0]&&l>=k[R+1])?(C[P]=!0,w.push(E[P])):C[P]=!1}}},e.prototype._forEachCell=function(i,o,p,l,f,w,C,O){for(var x=this._convertToCellCoord(i),E=this._convertToCellCoord(o),k=this._convertToCellCoord(p),M=this._convertToCellCoord(l),P=x;P<=k;P++)for(var R=E;R<=M;R++){var $=this.d*R+P;if((!O||O(this._convertFromCellCoord(P),this._convertFromCellCoord(R),this._convertFromCellCoord(P+1),this._convertFromCellCoord(R+1)))&&f.call(this,i,o,p,l,$,w,C,O))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,o=s+this.cells.length+1+1,p=0,l=0;l<this.cells.length;l++)p+=this.cells[l].length;var f=new Int32Array(o+p+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var w=o,C=0;C<i.length;C++){var O=i[C];f[s+C]=w,f.set(O,w),w+=O.length}return f[s+i.length]=w,f.set(this.keys,w),f[s+i.length+1]=w+=this.keys.length,f.set(this.bboxes,w),w+=this.bboxes.length,f.buffer},fp}(),fc=W(Xm);const od={};function _i(s,e,i={}){Object.defineProperty(s,"_classRegistryKey",{value:e,writable:!1}),od[e]={klass:s,omit:i.omit||[]}}_i(Object,"Object"),fc.serialize=function(s,e){const i=s.toArrayBuffer();return e&&e.add(i),{buffer:i}},fc.deserialize=function(s){return new fc(s.buffer)},Object.defineProperty(fc,"name",{value:"Grid"}),_i(fc,"Grid"),typeof DOMMatrix<"u"&&_i(DOMMatrix,"DOMMatrix"),_i(Ar,"Color"),_i(Error,"Error"),_i(Is,"Formatted"),_i(Yu,"FormattedSection"),_i(Bn,"AJAXError"),_i(ks,"ResolvedImage"),_i(pc,"StylePropertyFunction"),_i(du,"StyleExpression",{omit:["_evaluator"]}),_i(yo,"ImageIdWithOptions"),_i(dc,"ZoomDependentExpression"),_i(sd,"ZoomConstantExpression"),_i(no,"CompoundExpression",{omit:["_evaluate"]});for(const s in lu)od[lu[s]._classRegistryKey]||_i(lu[s],`Expression${s}`);function mu(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function sh(s){return self.ImageBitmap&&s instanceof ImageBitmap}function Al(s,e){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(mu(s)||sh(s))return e&&e.add(s),s;if(ArrayBuffer.isView(s))return e&&e.add(s.buffer),s;if(s instanceof ImageData)return e&&e.add(s.data.buffer),s;if(Array.isArray(s)){const i=[];for(const o of s)i.push(Al(o,e));return i}if(s instanceof Map){const i={$name:"Map"};for(const[o,p]of s.entries())i[o]=Al(p);return i}if(s instanceof Set){const i={$name:"Set"};let o=0;for(const p of s.values())i[++o]=Al(p);return i}if(typeof s=="object"){const i=s.constructor,o=i._classRegistryKey;if(!o)throw new Error(`Can't serialize object of unregistered class "${o}".`);const p=i.serialize?i.serialize(s,e):{};if(!i.serialize){for(const l in s)s.hasOwnProperty(l)&&(od[o].omit.indexOf(l)>=0||(p[l]=Al(s[l],e)));s instanceof Error&&(p.message=s.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(p.$name=o),p}throw new Error("can't serialize object of type "+typeof s)}function mc(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||mu(s)||sh(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(mc);if(typeof s=="object"){const e=s.$name||"Object";if(e==="Map"){const p=new Map;for(const l of Object.keys(s))l!=="$name"&&p.set(l,mc(s[l]));return p}if(e==="Set"){const p=new Set;for(const l of Object.keys(s))l!=="$name"&&p.add(mc(s[l]));return p}const{klass:i}=od[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(s);const o=Object.create(i.prototype);for(const p of Object.keys(s))p!=="$name"&&(o[p]=mc(s[p]));return o}throw new Error("can't deserialize object of type "+typeof s)}const wi={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519,Osage:s=>s>=66736&&s<=66815,"CJK Unified Ideographs Extension B":s=>s>=131072&&s<=173791};function Ba(s){for(const e of s)if(ca(e.charCodeAt(0)))return!0;return!1}function ad(s){for(const e of s)if(!Bf(e.charCodeAt(0)))return!1;return!0}function Bf(s){return!(wi.Arabic(s)||wi["Arabic Supplement"](s)||wi["Arabic Extended-A"](s)||wi["Arabic Presentation Forms-A"](s)||wi["Arabic Presentation Forms-B"](s))}function ca(s){return!(s!==746&&s!==747&&(s<4352||!(wi["Bopomofo Extended"](s)||wi.Bopomofo(s)||wi["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||wi["CJK Compatibility Ideographs"](s)||wi["CJK Compatibility"](s)||wi["CJK Radicals Supplement"](s)||wi["CJK Strokes"](s)||!(!wi["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||wi["CJK Unified Ideographs Extension A"](s)||wi["CJK Unified Ideographs"](s)||wi["Enclosed CJK Letters and Months"](s)||wi["Hangul Compatibility Jamo"](s)||wi["Hangul Jamo Extended-A"](s)||wi["Hangul Jamo Extended-B"](s)||wi["Hangul Jamo"](s)||wi["Hangul Syllables"](s)||wi.Hiragana(s)||wi["Ideographic Description Characters"](s)||wi.Kanbun(s)||wi["Kangxi Radicals"](s)||wi["Katakana Phonetic Extensions"](s)||wi.Katakana(s)&&s!==12540||!(!wi["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!wi["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||wi["Unified Canadian Aboriginal Syllabics"](s)||wi["Unified Canadian Aboriginal Syllabics Extended"](s)||wi["Vertical Forms"](s)||wi["Yijing Hexagram Symbols"](s)||wi["Yi Syllables"](s)||wi["Yi Radicals"](s))))}function mp(s){return!(ca(s)||function(e){return!!(wi["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||wi["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||wi["Letterlike Symbols"](e)||wi["Number Forms"](e)||wi["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||wi["Control Pictures"](e)&&e!==9251||wi["Optical Character Recognition"](e)||wi["Enclosed Alphanumerics"](e)||wi["Geometric Shapes"](e)||wi["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||wi["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||wi["CJK Symbols and Punctuation"](e)||wi.Katakana(e)||wi["Private Use Area"](e)||wi["CJK Compatibility Forms"](e)||wi["Small Form Variants"](e)||wi["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(s))}function ld(s){return s>=1424&&s<=2303||wi["Arabic Presentation Forms-A"](s)||wi["Arabic Presentation Forms-B"](s)}function Nf(s,e){return!(!e&&ld(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||wi.Khmer(s))}function gc(s){for(const e of s)if(ld(e.charCodeAt(0)))return!0;return!1}const Jo="deferred",cd="loading",oh="loaded";let Na=null,xo="unavailable",Ss=null;const gp=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(xo="error"),Na&&Na(s)};function ah(){Pl.fire(new oa("pluginStateChange",{pluginStatus:xo,pluginURL:Ss}))}const Pl=new aa,lh=function(){return xo},Qo=function(){if(xo!==Jo||!Ss)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");xo=cd,ah(),Ss&&Nn({url:Ss},s=>{s?gp(s):(xo=oh,ah())})},Qs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>xo===oh||Qs.applyArabicShaping!=null,isLoading:()=>xo===cd,setState(s){xo=s.pluginStatus,Ss=s.pluginURL},isParsed:()=>Qs.applyArabicShaping!=null&&Qs.processBidirectionalText!=null&&Qs.processStyledBidirectionalText!=null,getPluginURL:()=>Ss};class Vr{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,o){for(const p of i)if(!Nf(p.charCodeAt(0),o))return!1;return!0}(e,Qs.isLoaded())}}class ud{constructor(e,i,o,p){this.property=e,this.value=i,this.expression=function(l,f,w,C){if(El(l))return new pc(l,f);if(pu(l)||Array.isArray(l)&&l.length>0){const O=zf(l,f,w,C);if(O.result==="error")throw new Error(O.value.map(x=>`${x.key}: ${x.message}`).join(", "));return O.value}{let O=l;return typeof l=="string"&&f.type==="color"&&(O=Ar.parse(l)),{kind:"constant",configDependencies:new Set,evaluate:()=>O}}}(i===void 0?e.specification.default:i,e.specification,o,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class ch{constructor(e,i,o){this.property=e,this.value=new ud(e,void 0,i,o)}transitioned(e,i){return new _p(this.property,this.value,i,Zs({},e.transition,this.transition),e.now)}untransitioned(){return new _p(this.property,this.value,null,{},0)}}class bo{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return zn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ch(this._values[e].property,this._scope,this._options)),this._values[e].value=new ud(this._values[e].property,i===null?void 0:zn(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const o=this._properties.properties;if(e)for(const p in e){const l=e[p];if(ro(p,"-transition")){const f=p.slice(0,-11);o[f]&&this.setTransition(f,l)}else o.hasOwnProperty(p)&&this.setValue(p,l)}}getTransition(e){return zn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ch(this._values[e].property)),this._values[e].transition=zn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const p=this.getTransition(i);p!==void 0&&(e[`${i}-transition`]=p)}return e}transitioned(e,i){const o=new gu(this._properties);for(const p of Object.keys(this._values))o._values[p]=this._values[p].transitioned(e,i._values[p]);return o}untransitioned(){const e=new gu(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class _p{constructor(e,i,o,p,l){const f=p.delay||0,w=p.duration||0;l=l||0,this.property=e,this.value=i,this.begin=l+f,this.end=this.begin+w,e.specification.transition&&(p.delay||p.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const p=e.now||0,l=this.value.possiblyEvaluate(e,i,o),f=this.prior;if(f){if(p>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(p<this.begin)return f.possiblyEvaluate(e,i,o);{const w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,i,o),l,Ca(w))}}return l}}class gu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const p=new yc(this._properties);for(const l of Object.keys(this._values))p._values[l]=this._values[l].possiblyEvaluate(e,i,o);return p}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Vn{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return zn(this._values[e].value)}setValue(e,i){this._values[e]=new ud(this._values[e].property,i===null?void 0:zn(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const p=new yc(this._properties);for(const l of Object.keys(this._values))p._values[l]=this._values[l].possiblyEvaluate(e,i,o);return p}}class _c{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,p){return this.property.evaluate(this.value,this.parameters,e,i,o,p)}}class yc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Gt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){const p=Io[this.specification.type];return p?p(e,i,o):e}}class li{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,p){return new _c(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,p)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new _c(this,{kind:"constant",value:void 0},e.parameters);const p=Io[this.specification.type];return p?new _c(this,{kind:"constant",value:p(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,p,l,f){return e.kind==="constant"?e.value:e.evaluate(i,o,p,l,f)}}class Ka{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,p){return!!e.expression.evaluate(i,null,{},o,p)}interpolate(){return!1}}class on{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Vr(0,{});for(const o in e){const p=e[o];p.specification.overridable&&this.overridableProperties.push(o);const l=this.defaultPropertyValues[o]=new ud(p,void 0),f=this.defaultTransitionablePropertyValues[o]=new ch(p);this.defaultTransitioningPropertyValues[o]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=l.possiblyEvaluate(i)}}}_i(li,"DataDrivenProperty"),_i(Gt,"DataConstantProperty"),_i(Ka,"ColorRampProperty");var dt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function Vf(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function uh(s){if(Array.isArray(s))return s.map(uh);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const e={};for(const i in s)e[i]=uh(s[i]);return e}return Vf(s)}function hd(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!hd(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function yp(s,e="",i=null,o="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};hd(s)||(s=vc(s));const p=s;let l=!0;try{l=function(x){if(!_u(x))return x;let E=uh(x);return jf(E),E=Uf(E),E}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let f=null,w=null;if(o!=="background"&&o!=="sky"&&o!=="slot"){w=dt[`filter_${o}`];const x=la(l,w,e,i);if(x.result==="error")throw new Error(x.value.map(E=>`${E.key}: ${E.message}`).join(", "));f=(E,k,M)=>x.value.evaluate(E,k,{},M)}let C=null,O=null;if(l!==p){const x=la(p,w,e,i);if(x.result==="error")throw new Error(x.value.map(E=>`${E.key}: ${E.message}`).join(", "));C=(E,k,M,P,R)=>x.value.evaluate(E,k,{},M,void 0,void 0,P,R),O=!iu(x.value.expression)}return{filter:f,dynamicFilter:C||void 0,needGeometry:Hf(l),needFeature:!!O}}function Uf(s){if(!Array.isArray(s))return s;const e=function(i){if(Hn.has(i[0])){for(let o=1;o<i.length;o++)if(_u(i[o]))return!0}return i}(s);return e===!0?e:e.map(i=>Uf(i))}function jf(s){let e=!1;const i=[];if(s[0]==="case"){for(let o=1;o<s.length-1;o+=2)e=e||_u(s[o]),i.push(s[o+1]);i.push(s[s.length-1])}else if(s[0]==="match"){e=e||_u(s[1]);for(let o=2;o<s.length-1;o+=2)i.push(s[o+1]);i.push(s[s.length-1])}else if(s[0]==="step"){e=e||_u(s[1]);for(let o=1;o<s.length-1;o+=2)i.push(s[o+1])}e&&(s.length=0,s.push("any",...i));for(let o=1;o<s.length;o++)jf(s[o])}function _u(s){if(!Array.isArray(s))return!1;if((e=s[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<s.length;i++)if(_u(s[i]))return!0;return!1}const Hn=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function $f(s,e){return s<e?-1:s>e?1:0}function Hf(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let e=1;e<s.length;e++)if(Hf(s[e]))return!0;return!1}function vc(s){if(!s)return!0;const e=s[0];return s.length<=1?e!=="any":e==="=="?Dl(s[1],s[2],"=="):e==="!="?ea(Dl(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Dl(s[1],s[2],e):e==="any"?(i=s.slice(1),["any"].concat(i.map(vc))):e==="all"?["all"].concat(s.slice(1).map(vc)):e==="none"?["all"].concat(s.slice(1).map(vc).map(ea)):e==="in"?vp(s[1],s.slice(2)):e==="!in"?ea(vp(s[1],s.slice(2))):e==="has"?xp(s[1]):e!=="!has"||ea(xp(s[1]));var i}function Dl(s,e,i){switch(s){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,s,e]}}function vp(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",s,["literal",e.sort($f)]]:["filter-in-small",s,["literal",e]]}}function xp(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function ea(s){return["!",s]}const yu="";function ua(s,e){return e?`${s}${yu}${e}`:s}const Va="-transition",bp=new Set(["fill","line","background","hillshade","raster"]);class ms extends aa{constructor(e,i,o,p,l){if(super(),this.id=e.id,this.fqid=ua(this.id,o),this.type=e.type,this.scope=o,this.lut=p,this.options=l,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const f=la(this.filter,dt[`filter_${e.type}`]);f.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...f.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new Vn(i.layout,this.scope,l),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new bo(i.paint,this.scope,l);for(const f in e.paint)this.setPaintProperty(f,e.paint[f]);for(const f in e.layout)this.setLayoutProperty(f,e.layout[f]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new yc(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D()&&bp.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return ro(e,Va)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const o=this._transitionablePaint,p=o._properties.properties;if(ro(e,Va)){const E=e.slice(0,-11);return p[E]&&o.setTransition(E,i||void 0),!1}if(!p[e])return!1;const l=o._values[e],f=l.value.isDataDriven(),w=l.value;o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const C=o._values[e].value,O=C.isDataDriven(),x=ro(e,"pattern")||e==="line-dasharray";return O||f||x||this._handleOverridablePaintPropertyUpdate(e,w,C)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,o){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return pl({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof _c&&uu(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=yp(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,o,p,l,f,w,C,O){}}const Ts={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class hh{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class en{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Dr(s,e=1){let i=0,o=0;return{members:s.map(p=>{const l=Ts[p.type].BYTES_PER_ELEMENT,f=i=dh(i,Math.max(e,l)),w=p.components||1;return o=Math.max(o,l),i+=l*w,{name:p.name,type:p.type,components:w,offset:f}}),size:dh(i,Math.max(o,e)),alignment:e}}function dh(s,e){return Math.ceil(s/e)*e}class wo extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const p=2*e;return this.int16[p+0]=i,this.int16[p+1]=o,e}}wo.prototype.bytesPerElement=4,_i(wo,"StructArrayLayout2i4");class vu extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o)}emplace(e,i,o,p){const l=3*e;return this.int16[l+0]=i,this.int16[l+1]=o,this.int16[l+2]=p,e}}vu.prototype.bytesPerElement=6,_i(vu,"StructArrayLayout3i6");class tn extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,p){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,p)}emplace(e,i,o,p,l){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=p,this.int16[f+3]=l,e}}tn.prototype.bytesPerElement=8,_i(tn,"StructArrayLayout4i8");class dd extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,p,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,p,l)}emplace(e,i,o,p,l,f){const w=5*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.int16[w+2]=p,this.int16[w+3]=l,this.int16[w+4]=f,e}}dd.prototype.bytesPerElement=10,_i(dd,"StructArrayLayout5i10");class xu extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,l,f,w){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,o,p,l,f,w)}emplace(e,i,o,p,l,f,w,C){const O=6*e,x=12*e,E=3*e;return this.int16[O+0]=i,this.int16[O+1]=o,this.uint8[x+4]=p,this.uint8[x+5]=l,this.uint8[x+6]=f,this.uint8[x+7]=w,this.float32[E+2]=C,e}}xu.prototype.bytesPerElement=12,_i(xu,"StructArrayLayout2i4ub1f12");class ha extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o)}emplace(e,i,o,p){const l=3*e;return this.float32[l+0]=i,this.float32[l+1]=o,this.float32[l+2]=p,e}}ha.prototype.bytesPerElement=12,_i(ha,"StructArrayLayout3f12");class Rs extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,p,l)}emplace(e,i,o,p,l,f){const w=6*e,C=3*e;return this.uint16[w+0]=i,this.uint16[w+1]=o,this.uint16[w+2]=p,this.uint16[w+3]=l,this.float32[C+2]=f,e}}Rs.prototype.bytesPerElement=12,_i(Rs,"StructArrayLayout4ui1f12");class ls extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,p){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,p)}emplace(e,i,o,p,l){const f=4*e;return this.uint16[f+0]=i,this.uint16[f+1]=o,this.uint16[f+2]=p,this.uint16[f+3]=l,e}}ls.prototype.bytesPerElement=8,_i(ls,"StructArrayLayout4ui8");class ph extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,p,l,f){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,p,l,f)}emplace(e,i,o,p,l,f,w){const C=6*e;return this.int16[C+0]=i,this.int16[C+1]=o,this.int16[C+2]=p,this.int16[C+3]=l,this.int16[C+4]=f,this.int16[C+5]=w,e}}ph.prototype.bytesPerElement=12,_i(ph,"StructArrayLayout6i12");class Il extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,p,l,f,w,C,O,x,E,k){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,o,p,l,f,w,C,O,x,E,k)}emplace(e,i,o,p,l,f,w,C,O,x,E,k,M){const P=12*e;return this.int16[P+0]=i,this.int16[P+1]=o,this.int16[P+2]=p,this.int16[P+3]=l,this.uint16[P+4]=f,this.uint16[P+5]=w,this.uint16[P+6]=C,this.uint16[P+7]=O,this.int16[P+8]=x,this.int16[P+9]=E,this.int16[P+10]=k,this.int16[P+11]=M,e}}Il.prototype.bytesPerElement=24,_i(Il,"StructArrayLayout4i4ui4i24");class fh extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,l,f){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,p,l,f)}emplace(e,i,o,p,l,f,w){const C=10*e,O=5*e;return this.int16[C+0]=i,this.int16[C+1]=o,this.int16[C+2]=p,this.float32[O+2]=l,this.float32[O+3]=f,this.float32[O+4]=w,e}}fh.prototype.bytesPerElement=20,_i(fh,"StructArrayLayout3i3f20");class ln extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,p)}emplace(e,i,o,p,l){const f=4*e;return this.float32[f+0]=i,this.float32[f+1]=o,this.float32[f+2]=p,this.float32[f+3]=l,e}}ln.prototype.bytesPerElement=16,_i(ln,"StructArrayLayout4f16");class wp extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}wp.prototype.bytesPerElement=4,_i(wp,"StructArrayLayout1ul4");class Ja extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const p=2*e;return this.uint16[p+0]=i,this.uint16[p+1]=o,e}}Ja.prototype.bytesPerElement=4,_i(Ja,"StructArrayLayout2ui4");class kl extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,p,l,f,w,C,O,x,E,k,M){const P=this.length;return this.resize(P+1),this.emplace(P,e,i,o,p,l,f,w,C,O,x,E,k,M)}emplace(e,i,o,p,l,f,w,C,O,x,E,k,M,P){const R=20*e,$=10*e;return this.int16[R+0]=i,this.int16[R+1]=o,this.int16[R+2]=p,this.int16[R+3]=l,this.int16[R+4]=f,this.float32[$+3]=w,this.float32[$+4]=C,this.float32[$+5]=O,this.float32[$+6]=x,this.int16[R+14]=E,this.uint32[$+8]=k,this.uint16[R+18]=M,this.uint16[R+19]=P,e}}kl.prototype.bytesPerElement=40,_i(kl,"StructArrayLayout5i4f1i1ul2ui40");class eo extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,p,l,f,w){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,o,p,l,f,w)}emplace(e,i,o,p,l,f,w,C){const O=8*e;return this.int16[O+0]=i,this.int16[O+1]=o,this.int16[O+2]=p,this.int16[O+4]=l,this.int16[O+5]=f,this.int16[O+6]=w,this.int16[O+7]=C,e}}eo.prototype.bytesPerElement=16,_i(eo,"StructArrayLayout3i2i2i16");class Sp extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,p,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,p,l)}emplace(e,i,o,p,l,f){const w=4*e,C=8*e;return this.float32[w+0]=i,this.float32[w+1]=o,this.float32[w+2]=p,this.int16[C+6]=l,this.int16[C+7]=f,e}}Sp.prototype.bytesPerElement=16,_i(Sp,"StructArrayLayout2f1f2i16");class Tp extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,l,f){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,p,l,f)}emplace(e,i,o,p,l,f,w){const C=20*e,O=5*e;return this.uint8[C+0]=i,this.uint8[C+1]=o,this.float32[O+1]=p,this.float32[O+2]=l,this.float32[O+3]=f,this.float32[O+4]=w,e}}Tp.prototype.bytesPerElement=20,_i(Tp,"StructArrayLayout2ub4f20");class gs extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o)}emplace(e,i,o,p){const l=3*e;return this.uint16[l+0]=i,this.uint16[l+1]=o,this.uint16[l+2]=p,e}}gs.prototype.bytesPerElement=6,_i(gs,"StructArrayLayout3ui6");class Mp extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,l,f,w,C,O,x,E,k,M,P,R,$,H,J,ee,Z,ne){const le=this.length;return this.resize(le+1),this.emplace(le,e,i,o,p,l,f,w,C,O,x,E,k,M,P,R,$,H,J,ee,Z,ne)}emplace(e,i,o,p,l,f,w,C,O,x,E,k,M,P,R,$,H,J,ee,Z,ne,le){const fe=30*e,Pe=15*e,Ee=60*e;return this.int16[fe+0]=i,this.int16[fe+1]=o,this.int16[fe+2]=p,this.float32[Pe+2]=l,this.float32[Pe+3]=f,this.uint16[fe+8]=w,this.uint16[fe+9]=C,this.uint32[Pe+5]=O,this.uint32[Pe+6]=x,this.uint32[Pe+7]=E,this.uint16[fe+16]=k,this.uint16[fe+17]=M,this.uint16[fe+18]=P,this.float32[Pe+10]=R,this.float32[Pe+11]=$,this.uint8[Ee+48]=H,this.uint8[Ee+49]=J,this.uint8[Ee+50]=ee,this.uint32[Pe+13]=Z,this.int16[fe+28]=ne,this.uint8[Ee+58]=le,e}}Mp.prototype.bytesPerElement=60,_i(Mp,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class pd extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,l,f,w,C,O,x,E,k,M,P,R,$,H,J,ee,Z,ne,le,fe,Pe,Ee,Ce,$e,Ie,Ge,Ze,qe,et){const nt=this.length;return this.resize(nt+1),this.emplace(nt,e,i,o,p,l,f,w,C,O,x,E,k,M,P,R,$,H,J,ee,Z,ne,le,fe,Pe,Ee,Ce,$e,Ie,Ge,Ze,qe,et)}emplace(e,i,o,p,l,f,w,C,O,x,E,k,M,P,R,$,H,J,ee,Z,ne,le,fe,Pe,Ee,Ce,$e,Ie,Ge,Ze,qe,et,nt){const ct=20*e,it=40*e,Et=80*e;return this.float32[ct+0]=i,this.float32[ct+1]=o,this.int16[it+4]=p,this.int16[it+5]=l,this.int16[it+6]=f,this.int16[it+7]=w,this.int16[it+8]=C,this.int16[it+9]=O,this.int16[it+10]=x,this.int16[it+11]=E,this.int16[it+12]=k,this.uint16[it+13]=M,this.uint16[it+14]=P,this.uint16[it+15]=R,this.uint16[it+16]=$,this.uint16[it+17]=H,this.uint16[it+18]=J,this.uint16[it+19]=ee,this.uint16[it+20]=Z,this.uint16[it+21]=ne,this.uint16[it+22]=le,this.uint16[it+23]=fe,this.uint16[it+24]=Pe,this.uint16[it+25]=Ee,this.uint16[it+26]=Ce,this.uint16[it+27]=$e,this.uint32[ct+14]=Ie,this.float32[ct+15]=Ge,this.float32[ct+16]=Ze,this.float32[ct+17]=qe,this.float32[ct+18]=et,this.uint8[Et+76]=nt,e}}pd.prototype.bytesPerElement=80,_i(pd,"StructArrayLayout2f9i15ui1ul4f1ub80");class mh extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}mh.prototype.bytesPerElement=4,_i(mh,"StructArrayLayout1f4");class Ol extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,p,l)}emplace(e,i,o,p,l,f){const w=5*e;return this.float32[w+0]=i,this.float32[w+1]=o,this.float32[w+2]=p,this.float32[w+3]=l,this.float32[w+4]=f,e}}Ol.prototype.bytesPerElement=20,_i(Ol,"StructArrayLayout5f20");class xc extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,l,f,w){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,o,p,l,f,w)}emplace(e,i,o,p,l,f,w,C){const O=7*e;return this.float32[O+0]=i,this.float32[O+1]=o,this.float32[O+2]=p,this.float32[O+3]=l,this.float32[O+4]=f,this.float32[O+5]=w,this.float32[O+6]=C,e}}xc.prototype.bytesPerElement=28,_i(xc,"StructArrayLayout7f28");class Ua extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,l,f,w,C,O,x,E){const k=this.length;return this.resize(k+1),this.emplace(k,e,i,o,p,l,f,w,C,O,x,E)}emplace(e,i,o,p,l,f,w,C,O,x,E,k){const M=11*e;return this.float32[M+0]=i,this.float32[M+1]=o,this.float32[M+2]=p,this.float32[M+3]=l,this.float32[M+4]=f,this.float32[M+5]=w,this.float32[M+6]=C,this.float32[M+7]=O,this.float32[M+8]=x,this.float32[M+9]=E,this.float32[M+10]=k,e}}Ua.prototype.bytesPerElement=44,_i(Ua,"StructArrayLayout11f44");class fd extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,l,f,w,C,O){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,p,l,f,w,C,O)}emplace(e,i,o,p,l,f,w,C,O,x){const E=9*e;return this.float32[E+0]=i,this.float32[E+1]=o,this.float32[E+2]=p,this.float32[E+3]=l,this.float32[E+4]=f,this.float32[E+5]=w,this.float32[E+6]=C,this.float32[E+7]=O,this.float32[E+8]=x,e}}fd.prototype.bytesPerElement=36,_i(fd,"StructArrayLayout9f36");class Ll extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const p=2*e;return this.float32[p+0]=i,this.float32[p+1]=o,e}}Ll.prototype.bytesPerElement=8,_i(Ll,"StructArrayLayout2f8");class Cp extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,p){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o,p)}emplace(e,i,o,p,l){const f=6*e;return this.uint32[3*e+0]=i,this.uint16[f+2]=o,this.uint16[f+3]=p,this.uint16[f+4]=l,e}}Cp.prototype.bytesPerElement=12,_i(Cp,"StructArrayLayout1ul3ui12");class Ep extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Ep.prototype.bytesPerElement=2,_i(Ep,"StructArrayLayout1ui2");class Fo extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,l,f,w,C,O,x,E,k,M,P,R,$){const H=this.length;return this.resize(H+1),this.emplace(H,e,i,o,p,l,f,w,C,O,x,E,k,M,P,R,$)}emplace(e,i,o,p,l,f,w,C,O,x,E,k,M,P,R,$,H){const J=16*e;return this.float32[J+0]=i,this.float32[J+1]=o,this.float32[J+2]=p,this.float32[J+3]=l,this.float32[J+4]=f,this.float32[J+5]=w,this.float32[J+6]=C,this.float32[J+7]=O,this.float32[J+8]=x,this.float32[J+9]=E,this.float32[J+10]=k,this.float32[J+11]=M,this.float32[J+12]=P,this.float32[J+13]=R,this.float32[J+14]=$,this.float32[J+15]=H,e}}Fo.prototype.bytesPerElement=64,_i(Fo,"StructArrayLayout16f64");class bu extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,p,l,f,w){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,o,p,l,f,w)}emplace(e,i,o,p,l,f,w,C){const O=10*e,x=5*e;return this.uint16[O+0]=i,this.uint16[O+1]=o,this.uint16[O+2]=p,this.uint16[O+3]=l,this.float32[x+2]=f,this.float32[x+3]=w,this.float32[x+4]=C,e}}bu.prototype.bytesPerElement=20,_i(bu,"StructArrayLayout4ui3f20");class Qa extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Qa.prototype.bytesPerElement=2,_i(Qa,"StructArrayLayout1i2");class oo extends en{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}oo.prototype.bytesPerElement=1,_i(oo,"StructArrayLayout1ub1");class Gf extends hh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Gf.prototype.size=40;class Ap extends kl{get(e){return new Gf(this,e)}}_i(Ap,"CollisionBoxArray");class gh extends hh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}gh.prototype.size=60;class Wf extends Mp{get(e){return new gh(this,e)}}_i(Wf,"PlacedSymbolArray");class md extends hh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}md.prototype.size=80;class Pp extends pd{get(e){return new md(this,e)}}_i(Pp,"SymbolInstanceArray");class gd extends mh{getoffsetX(e){return this.float32[1*e+0]}}_i(gd,"GlyphOffsetArray");class qf extends wo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}_i(qf,"SymbolLineVertexArray");class bc extends hh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}bc.prototype.size=12;class wc extends Cp{get(e){return new bc(this,e)}}_i(wc,"FeatureIndexArray");class So extends Ja{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}_i(So,"FillExtrusionCentroidArray");class wu extends hh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}wu.prototype.size=6;class Rl extends vu{get(e){return new wu(this,e)}}_i(Rl,"FillExtrusionWallArray");const _h=Dr([{name:"a_pos",components:2,type:"Int16"}],4),Yf=Dr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Sn{constructor(e=[]){this.segments=e}_prepareSegment(e,i,o,p){let l=this.segments[this.segments.length-1];return e>Sn.MAX_VERTEX_ARRAY_LENGTH&&qi(`Max vertices per segment is ${Sn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!l||l.vertexLength+e>Sn.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==p)&&(l={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},p!==void 0&&(l.sortKey=p),this.segments.push(l)),l}prepareSegment(e,i,o,p){return this._prepareSegment(e,i.length,o.length,p)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,p){return new Sn([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:p,vaos:{},sortKey:0}])}}function yh(s,e){return 256*(s=nr(Math.floor(s),0,255))+nr(Math.floor(e),0,255)}Sn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_i(Sn,"SegmentVector");const Dp=Dr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),vh=Dr([{name:"a_dash",components:4,type:"Uint16"}]);class Su{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,o,p){this.ids.push(_d(e)),this.positions.push(i,o,p)}eachPosition(e,i){const o=_d(e);let p=0,l=this.ids.length-1;for(;p<l;){const f=p+l>>1;this.ids[f]>=o?l=f:p=f+1}for(;this.ids[p]===o;)i(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(e,i){const o=new Float64Array(e.ids),p=new Uint32Array(e.positions);return ao(o,p,0,o.length-1),i&&(i.add(o.buffer),i.add(p.buffer)),{ids:o,positions:p}}static deserialize(e){const i=new Su;let o;i.ids=e.ids,i.positions=e.positions;for(const p of i.ids)p!==o&&i.uniqueIds.push(p),o=p;return i.indexed=!0,i}}function _d(s){const e=+s;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:sa(String(s))}function ao(s,e,i,o){for(;i<o;){const p=s[i+o>>1];let l=i-1,f=o+1;for(;;){do l++;while(s[l]<p);do f--;while(s[f]>p);if(l>=f)break;da(s,l,f),da(e,3*l,3*f),da(e,3*l+1,3*f+1),da(e,3*l+2,3*f+2)}f-i<o-f?(ao(s,e,i,f),i=f+1):(ao(s,e,f+1,o),o=f)}}function da(s,e,i){const o=s[e];s[e]=s[i],s[i]=o}_i(Su,"FeaturePositionMap");class pa{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class xh extends pa{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class Pn extends pa{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class To extends pa{constructor(e){super(e),this.current=[0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class Bo extends pa{constructor(e){super(e),this.current=[0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class Sc extends pa{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class Ur extends pa{constructor(e){super(e),this.current=Ar.transparent.toRenderColor(null)}set(e,i,o){this.fetchUniformLocation(e,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const Xf=new Float32Array(16);class Tc extends pa{constructor(e){super(e),this.current=Xf}set(e,i,o){if(this.fetchUniformLocation(e,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let p=1;p<16;p++)if(o[p]!==this.current[p]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}const Ip=new Float32Array(9),Tu=new Float32Array(4);class kp extends pa{constructor(e){super(e),this.current=Tu}set(e,i,o){if(this.fetchUniformLocation(e,i)){for(let p=0;p<4;p++)if(o[p]!==this.current[p]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function Mu(s){return[yh(255*s.r,255*s.g),yh(255*s.b,255*s.a)]}class lo{constructor(e,i,o,p){this.value=e,this.uniformNames=i.map(l=>`u_${l}`),this.type=o,this.context=p}setUniform(e,i,o,p,l){const f=p.constantOr(this.value);i.set(e,l,f instanceof Ar?f.toRenderColor(this.ignoreLut?null:this.context.lut):f)}getBinding(e,i){return this.type==="color"?new Ur(e):new Pn(e)}}class el{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,o,p,l){const f=l==="u_pattern"||l==="u_dash"?this.pattern:l==="u_pixel_ratio"?this.pixelRatio:null;f&&i.set(e,l,f)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new Sc(e):new Pn(e)}}class Dn{constructor(e,i,o,p){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(l=>({name:`a_${l}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,i,o,p,l,f,w){const C=this.paintVertexArray.length,O=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Vr(0,{brightness:f}),i,{},l,p,w):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new Vr(0,{brightness:f}),i,{},l,p,w)==="none"),this.paintVertexArray.resize(e),this._setPaintValue(C,e,O,this.context)}updatePaintArray(e,i,o,p,l,f,w){const C=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:w},o,p,void 0,l):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:0,brightness:w},o,p,void 0,l)==="none"),this._setPaintValue(e,i,C,this.context)}_setPaintValue(e,i,o,p){if(this.type==="color"){const l=Mu(o.toRenderColor(this.ignoreLut?null:p.lut));for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,l[0],l[1])}else{for(let l=e;l<i;l++)this.paintVertexArray.emplace(l,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fa{constructor(e,i,o,p,l,f){this.expression=e,this.uniformNames=i.map(w=>`u_${w}_t`),this.type=o,this.useIntegerZoom=p,this.context=l,this.maxValue=0,this.paintVertexAttributes=i.map(w=>({name:`a_${w}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,i,o,p,l,f,w){const C=this.expression.evaluate(new Vr(this.context.zoom,{brightness:f}),i,{},l,p,w),O=this.expression.evaluate(new Vr(this.context.zoom+1,{brightness:f}),i,{},l,p,w);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new Vr(this.context.zoom,{brightness:f}),i,{},l,p,w)==="none");const x=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(x,e,C,O,this.context)}updatePaintArray(e,i,o,p,l,f,w){const C=this.expression.evaluate({zoom:this.context.zoom,brightness:w},o,p,void 0,l),O=this.expression.evaluate({zoom:this.context.zoom+1,brightness:w},o,p,void 0,l);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:this.context.zoom,brightness:w},o,p,void 0,l)==="none"),this._setPaintValue(e,i,C,O,this.context)}_setPaintValue(e,i,o,p,l){if(this.type==="color"){const f=Mu(o.toRenderColor(this.ignoreLut?null:l.lut)),w=Mu(o.toRenderColor(this.ignoreLut?null:l.lut));for(let C=e;C<i;C++)this.paintVertexArray.emplace(C,f[0],f[1],w[0],w[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,o,p);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(p))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,o,p,l){const f=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,w=nr(this.expression.interpolationFactor(f,this.context.zoom,this.context.zoom+1),0,1);i.set(e,l,w)}getBinding(e,i){return new Pn(e)}}class tl{constructor(e,i,o,p,l){this.expression=e,this.layerId=l,this.paintVertexAttributes=(o==="array"?vh:Dp).members;for(let f=0;f<i.length;++f);this.paintVertexArray=new p}populatePaintArray(e,i,o,p){const l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,p,l,f,w){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],f)}_setPaintValues(e,i,o,p){if(!p||!o)return;const l=p[o];if(!l)return;const{tl:f,br:w,pixelRatio:C}=l;for(let O=e;O<i;O++)this.paintVertexArray.emplace(O,f[0],f[1],w[0],w[1],C)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class zl{constructor(e,i,o=()=>!0){this.binders={},this._buffers=[],this.context=i;const p=[];for(const l in e.paint._values){const f=e.paint.get(l),w=e.paint.get(`${l}-use-theme`);if(l.endsWith("-use-theme")||!o(l)||!(f instanceof _c&&uu(f.property.specification)))continue;const C=Km(l,e.type),O=f.value,x=f.property.specification.type,E=!!f.property.useIntegerZoom,k=l==="line-dasharray"||l.endsWith("pattern"),M=l==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||w&&w.value.kind!=="constant";if(O.kind!=="constant"||M)if(O.kind==="source"||M||k){const P=Zf(l,x,"source");this.binders[l]=k?new tl(O,C,x,P,e.id):new Dn(O,C,x,P),p.push(`/a_${l}`)}else{const P=Zf(l,x,"composite");this.binders[l]=new fa(O,C,x,E,i,P),p.push(`/z_${l}`)}else this.binders[l]=k?new el(O.value,C):new lo(O.value,C,x,i),p.push(`/u_${l}`);w&&(this.binders[l].ignoreLut=w.constantOr("default")==="none",this.binders[l].lutExpression=w.value,this.binders[l].checkUseTheme=!0)}this.cacheKey=p.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Dn||i instanceof fa?i.maxValue:0}populatePaintArrays(e,i,o,p,l,f,w){for(const C in this.binders){const O=this.binders[C];O.context=this.context,O instanceof Dn||O instanceof fa||O instanceof tl?O.populatePaintArray(e,i,o,p,l,f,w):O.lutExpression&&O instanceof lo&&O.lutExpression&&(O.lutExpression.kind==="composite"||O.lutExpression.kind==="source")&&(O.ignoreLut=O.lutExpression.evaluate(new Vr(0,{brightness:f}),i,{},l,p,w)==="none")}}setConstantPatternPositions(e){for(const i in this.binders){const o=this.binders[i];o instanceof el&&o.setConstantPatternPositions(e)}}updatePaintArrays(e,i,o,p,l,f,w,C,O){let x=!1;const E=Object.keys(e),k=E.length!==0&&!C,M=k?E:i.uniqueIds;this.context.lut=l.lut;for(const P in this.binders){const R=this.binders[P];if(R.context=this.context,(R instanceof Dn||R instanceof fa||R instanceof tl)&&R.expression&&R.expression.kind&&R.expression.kind!=="constant"&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){const $=l.paint.get(P);R.expression=$.value;for(const H of M){const J=e[H.toString()];i.eachPosition(H,(ee,Z,ne)=>{const le=p.feature(ee);R.updatePaintArray(Z,ne,le,J,f,w,O)})}if(!k)for(const H of o.uniqueIds){const J=e[H.toString()];o.eachPosition(H,(ee,Z,ne)=>{const le=p.feature(ee);R.updatePaintArray(Z,ne,le,J,f,w,O)})}x=!0}}return x}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof lo||o instanceof el)&&e.push(...o.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Dn||o instanceof fa||o instanceof tl)for(let p=0;p<o.paintVertexAttributes.length;p++)e.push(o.paintVertexAttributes[p].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof lo||o instanceof el||o instanceof fa)for(const p of o.uniformNames)e.push(p)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const o in this.binders){const p=this.binders[o];if(p instanceof lo||p instanceof el||p instanceof fa)for(const l of p.uniformNames)i.push({name:l,property:o,binding:p.getBinding(e,l)})}return i}setUniforms(e,i,o,p,l){for(const{name:f,property:w,binding:C}of o){if(this.binders[w].checkUseTheme&&this.binders[w]instanceof lo){const O=p.get(`${w}-use-theme`);O.isConstant()&&(this.binders[w].ignoreLut=O.constantOr("default")==="none")}this.binders[w].setUniform(e,C,l,p.get(w),f)}}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Dn||i instanceof fa||i instanceof tl)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof Dn||o instanceof fa||o instanceof tl)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Dn||i instanceof fa||i instanceof tl)&&i.destroy()}}}class ma{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const p of e)this.programConfigurations[p.id]=new zl(p,i,o);this.needsUpload=!1,this._featureMap=new Su,this._featureMapWithoutIds=new Su,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,o,p,l,f,w,C){for(const O in this.programConfigurations)this.programConfigurations[O].populatePaintArrays(e,i,p,l,f,w,C);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,p,l,f,w){for(const C of o)this.needsUpload=this.programConfigurations[C.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,C,p,l,f,w||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Zm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Km(s,e){return Zm[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}const Fl={"line-pattern":{source:Rs,composite:Rs},"fill-pattern":{source:Rs,composite:Rs},"fill-extrusion-pattern":{source:Rs,composite:Rs},"line-dasharray":{source:ls,composite:ls}},yd={color:{source:Ll,composite:ln},number:{source:mh,composite:Ll}};function Zf(s,e,i){const o=Fl[s];return o&&o[i]||yd[e][i]}_i(lo,"ConstantBinder"),_i(el,"PatternConstantBinder"),_i(Dn,"SourceExpressionBinder"),_i(tl,"PatternCompositeBinder"),_i(fa,"CompositeExpressionBinder"),_i(zl,"ProgramConfiguration",{omit:["_buffers"]}),_i(ma,"ProgramConfigurationSet");const Gn=ei/Math.PI/2,il=5,vd=6,xd=16383,Cu=64,bh=[Cu,32,16],Mo=-Gn,No=Gn;function Mc(s,e,i,o=Gn){return i=rr(i),[s*Math.sin(i)*o,-e*o,s*Math.cos(i)*o]}function ga(s,e,i){return Mc(Math.cos(rr(s)),Math.sin(rr(s)),e,i)}const Cc=63710088e-1,Op=2*Math.PI*Cc;class Cr{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Cr(ra(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,p=e.lat*i,l=Math.sin(o)*Math.sin(p)+Math.cos(o)*Math.cos(p)*Math.cos((e.lng-this.lng)*i);return Cc*Math.acos(Math.min(l,1))}toBounds(e=0){const i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new rl({lng:this.lng-o,lat:this.lat-i},{lng:this.lng+o,lat:this.lat+i})}toEcef(e){return ga(this.lat,this.lng,Gn+e*Gn/Cc)}static convert(e){if(e instanceof Cr)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Cr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Cr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class rl{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const o=e;this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]])}else{const o=e;this.setSouthWest(o[0]).setNorthEast(o[1])}}setNorthEast(e){return this._ne=e instanceof Cr?new Cr(e.lng,e.lat):Cr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Cr?new Cr(e.lng,e.lat):Cr.convert(e),this}extend(e){const i=this._sw,o=this._ne;let p,l;if(e instanceof Cr)p=e,l=e;else{if(!(e instanceof rl))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(rl.convert(e)):this.extend(Cr.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Cr.convert(e)):this;if(p=e._sw,l=e._ne,!p||!l)return this}return i||o?(i.lng=Math.min(p.lng,i.lng),i.lat=Math.min(p.lat,i.lat),o.lng=Math.max(l.lng,o.lng),o.lat=Math.max(l.lat,o.lat)):(this._sw=new Cr(p.lng,p.lat),this._ne=new Cr(l.lng,l.lat)),this}getCenter(){return new Cr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Cr(this.getWest(),this.getNorth())}getSouthEast(){return new Cr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:o}=Cr.convert(e);let p=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&p}static convert(e){if(e)return e instanceof rl?e:new rl(e)}}const Lp=0,Rp=25.5;function Bl(s){return Op*Math.cos(s*Math.PI/180)}function _a(s){return(180+s)/360}function ya(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function to(s,e){return s/Bl(e)}function co(s){return 360*s-180}function Wn(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function zp(s,e){return s*Bl(Wn(e))}const uo=85.051129;function Fp(s){return Math.cos(rr(nr(s,-85.051129,uo)))}function Nl(s,e){const i=nr(e,Lp,Rp),o=Math.pow(2,i);return Fp(s)*Op/(512*o)}function u(s){return 1/Math.cos(s*Math.PI/180)}function t(s,e=0){const i=Math.exp(Math.PI*(1-(s.y+e/ei)/(1<<s.z)*2));return 80150034*i/(i*i+1)/ei/(1<<s.z)}class n{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=Cr.convert(e);return new n(_a(o.lng),ya(o.lat),to(i,o.lat))}toLngLat(){return new Cr(co(this.x),Wn(this.y))}toAltitude(){return zp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Op*u(Wn(this.y))}}function d(s,e,i,o,p,l,f,w,C){const O=(e+o)/2,x=(i+p)/2,E=new Wt(O,x);w(E),function(k,M,P,R,$,H){const J=P-$,ee=R-H;return Math.abs((R-M)*J-(P-k)*ee)/Math.hypot(J,ee)}(E.x,E.y,l.x,l.y,f.x,f.y)>=C?(d(s,e,i,O,x,l,E,w,C),d(s,O,x,o,p,E,f,w,C)):s.push(f)}function y(s,e,i){let o=s[0],p=o.x,l=o.y;e(o);const f=[o];for(let w=1;w<s.length;w++){const C=s[w],{x:O,y:x}=C;e(C),d(f,p,l,O,x,o,C,e,i),p=O,l=x,o=C}return f}function b(s,e,i,o){if(o(e,i)){const p=e.add(i)._mult(.5);b(s,e,p,o),b(s,p,i,o)}else s.push(i)}function T(s,e){let i=s[0];const o=[i];for(let p=1;p<s.length;p++){const l=s[p];b(o,i,l,e),i=l}return o}const I=Math.pow(2,14)-1,F=-I-1;function V(s,e){const i=Math.round(s.x*e),o=Math.round(s.y*e);return s.x=nr(i,F,I),s.y=nr(o,F,I),(i<s.x||i>s.x+1||o<s.y||o>s.y+1)&&qi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function j(s,e,i){const o=s.loadGeometry(),p=s.extent,l=ei/p;if(e&&i&&i.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:w,x:C,y:O,projection:x}=i,E=k=>{const M=co((e.x+k.x/p)/f),P=Wn((e.y+k.y/p)/f),R=x.project(M,P);k.x=(R.x*w-C)*p,k.y=(R.y*w-O)*p};for(let k=0;k<o.length;k++)if(s.type!==1)o[k]=y(o[k],E,1);else{const M=[];for(const P of o[k])P.x<0||P.x>=p||P.y<0||P.y>=p||(E(P),M.push(P));o[k]=M}}for(const f of o)for(const w of f)V(w,l);return o}function G(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?j(s):[]}}function q(s,e,i,o,p){s.emplaceBack(2*e+(o+1)/2,2*i+(p+1)/2)}function Q(s,e,i){s.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class ce{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new wo,this.indexArray=new gs,this.segments=new Sn,this.programConfigurations=new ma(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(e,i){}populate(e,i,o,p){const l=this.layers[0],f=[];let w=null;l.type==="circle"&&(w=l.layout.get("circle-sort-key"));for(const{feature:O,id:x,index:E,sourceLayerIndex:k}of e){const M=this.layers[0]._featureFilter.needGeometry,P=G(O,M);if(!this.layers[0]._featureFilter.filter(new Vr(this.zoom),P,o))continue;const R=w?w.evaluate(P,{},o):void 0,$={id:x,properties:O.properties,type:O.type,sourceLayerIndex:k,index:E,geometry:M?P.geometry:j(O,o,p),patterns:{},sortKey:R};f.push($)}w&&f.sort((O,x)=>O.sortKey-x.sortKey);let C=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new ph,C=p.projection);for(const O of f){const{geometry:x,index:E,sourceLayerIndex:k}=O,M=e[E].feature;this.addFeature(O,x,E,i.availableImages,o,C,i.brightness),i.featureIndex.insert(M,x,E,k,this.index)}}update(e,i,o,p,l,f,w){this.programConfigurations.updatePaintArrays(e,i,l,o,p,f,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_h.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Yf.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,o,p,l,f,w){for(const C of i)for(const O of C){const x=O.x,E=O.y;if(x<0||x>=ei||E<0||E>=ei)continue;if(f){const P=f.projectTilePoint(x,E,l),R=f.upVector(l,x,E),$=this.globeExtVertexArray;Q($,P,R),Q($,P,R),Q($,P,R),Q($,P,R)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),M=k.vertexLength;q(this.layoutVertexArray,x,E,-1,-1),q(this.layoutVertexArray,x,E,1,-1),q(this.layoutVertexArray,x,E,1,1),q(this.layoutVertexArray,x,E,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+2,M+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},p,l,w)}}function ae(s,e){for(let i=0;i<s.length;i++)if(Oe(e,s[i]))return!0;for(let i=0;i<e.length;i++)if(Oe(s,e[i]))return!0;return!!ke(s,e)}function de(s,e,i){return!!Oe(s,e)||!!Ue(e,s,i)}function pe(s,e){if(s.length===1)return Ne(e,s[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let p=0;p<o.length;p++)if(Oe(s,o[p]))return!0}for(let i=0;i<s.length;i++)if(Ne(e,s[i]))return!0;for(let i=0;i<e.length;i++)if(ke(s,e[i]))return!0;return!1}function Te(s,e,i){if(s.length>1){if(ke(s,e))return!0;for(let o=0;o<e.length;o++)if(Ue(e[o],s,i))return!0}for(let o=0;o<s.length;o++)if(Ue(s[o],e,i))return!0;return!1}function ke(s,e){if(s.length===0||e.length===0)return!1;for(let i=0;i<s.length-1;i++){const o=s[i],p=s[i+1];for(let l=0;l<e.length-1;l++)if(De(o,p,e[l],e[l+1]))return!0}return!1}function De(s,e,i,o){return Fn(s,i,o)!==Fn(e,i,o)&&Fn(s,e,i)!==Fn(s,e,o)}function Ue(s,e,i){const o=i*i;if(e.length===1)return s.distSqr(e[0])<o;for(let p=1;p<e.length;p++)if(Le(s,e[p-1],e[p])<o)return!0;return!1}function Le(s,e,i){const o=e.distSqr(i);if(o===0)return s.distSqr(e);const p=((s.x-e.x)*(i.x-e.x)+(s.y-e.y)*(i.y-e.y))/o;return s.distSqr(p<0?e:p>1?i:i.sub(e)._mult(p)._add(e))}function Ne(s,e){let i,o,p,l=!1;for(let f=0;f<s.length;f++){i=s[f];for(let w=0,C=i.length-1;w<i.length;C=w++)o=i[w],p=i[C],o.y>e.y!=p.y>e.y&&e.x<(p.x-o.x)*(e.y-o.y)/(p.y-o.y)+o.x&&(l=!l)}return l}function Oe(s,e){let i=!1;for(let o=0,p=s.length-1;o<s.length;p=o++){const l=s[o],f=s[p];l.y>e.y!=f.y>e.y&&e.x<(f.x-l.x)*(e.y-l.y)/(f.y-l.y)+l.x&&(i=!i)}return i}function We(s,e,i,o,p){for(const f of s)if(e<=f.x&&i<=f.y&&o>=f.x&&p>=f.y)return!0;const l=[new Wt(e,i),new Wt(e,p),new Wt(o,p),new Wt(o,i)];if(s.length>2){for(const f of l)if(Oe(s,f))return!0}for(let f=0;f<s.length-1;f++)if(Qe(s[f],s[f+1],l))return!0;return!1}function Qe(s,e,i){const o=i[0],p=i[2];if(s.x<o.x&&e.x<o.x||s.x>p.x&&e.x>p.x||s.y<o.y&&e.y<o.y||s.y>p.y&&e.y>p.y)return!1;const l=Fn(s,e,i[0]);return l!==Fn(s,e,i[1])||l!==Fn(s,e,i[2])||l!==Fn(s,e,i[3])}function xt(s,e,i,o,p,l){let f=e.y-s.y,w=s.x-e.x;if(l=l||0){const C=f*f+w*w;if(C===0)return!0;const O=Math.sqrt(C);f/=O,w/=O}return!((i.x-s.x)*f+(i.y-s.y)*w-l<0||(o.x-s.x)*f+(o.y-s.y)*w-l<0||(p.x-s.x)*f+(p.y-s.y)*w-l<0)}function ut(s,e,i,o,p,l,f){return!(xt(s,e,o,p,l,f)||xt(e,i,o,p,l,f)||xt(i,s,o,p,l,f)||xt(o,p,s,e,i,f)||xt(p,l,s,e,i,f)||xt(l,o,s,e,i,f))}function Dt(s,e,i){const o=e.paint.get(s).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(s)}function At(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function ot(s,e,i,o,p){if(!e[0]&&!e[1])return s;const l=Wt.convert(e)._mult(p);i==="viewport"&&l._rotate(-o);const f=[];for(let w=0;w<s.length;w++)f.push(s[w].sub(l));return f}function wt(s,e,i,o){const p=Wt.convert(s)._mult(o);return e==="viewport"&&p._rotate(-i),p}let Vt,st;_i(ce,"CircleBucket",{omit:["layers"]});var It,bt={exports:{}},Kt=(It||(It=1,function(s,e){(function(i){function o(l,f,w){var C=p(256*l,256*(f=Math.pow(2,w)-f-1),w),O=p(256*(l+1),256*(f+1),w);return C[0]+","+C[1]+","+O[0]+","+O[1]}function p(l,f,w){var C=2*Math.PI*6378137/256/Math.pow(2,w);return[l*C-2*Math.PI*6378137/2,f*C-2*Math.PI*6378137/2]}i.getURL=function(l,f,w,C,O,x){return x=x||{},l+"?"+["bbox="+o(w,C,O),"format="+(x.format||"image/png"),"service="+(x.service||"WMS"),"version="+(x.version||"1.1.1"),"request="+(x.request||"GetMap"),"srs="+(x.srs||"EPSG:3857"),"width="+(x.width||256),"height="+(x.height||256),"layers="+f].join("&")},i.getTileBBox=o,i.getMercCoords=p,Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,bt.exports)),bt.exports);class Bt{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=Xt(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const o=Kt.getTileBBox(this.x,this.y,this.z),p=function(l,f,w){let C,O="";for(let x=l;x>0;x--)C=1<<x-1,O+=(f&C?1:0)+(w&C?2:0);return O}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class kt{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Xt(e,i.z,i.z,i.x,i.y)}}class $t{constructor(e,i,o,p,l){this.overscaledZ=e,this.wrap=i,this.canonical=new Bt(o,+p,+l),this.key=i===0&&e===o?this.canonical.key:Xt(i,e,o,p,l)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new $t(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $t(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Xt(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return Xt(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new $t(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,p=2*this.canonical.y;return[new $t(i,this.wrap,i,o,p),new $t(i,this.wrap,i,o+1,p),new $t(i,this.wrap,i,o,p+1),new $t(i,this.wrap,i,o+1,p+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new $t(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new $t(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new kt(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Xt(s,e,i,o,p){const l=1<<Math.min(i,22);let f=l*(p%l)+o%l;return s&&i<22&&(f+=l*l*((s<0?-2*s-1:2*s)%(1<<2*(22-i)))),16*(32*f+i)+(e-i)}const ci=[s=>{let e=s.canonical.x-1,i=s.wrap;return e<0&&(e=(1<<s.canonical.z)-1,i--),new $t(s.overscaledZ,i,s.canonical.z,e,s.canonical.y)},s=>{let e=s.canonical.x+1,i=s.wrap;return e===1<<s.canonical.z&&(e=0,i++),new $t(s.overscaledZ,i,s.canonical.z,e,s.canonical.y)},s=>new $t(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,(s.canonical.y===0?1<<s.canonical.z:s.canonical.y)-1),s=>new $t(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y===(1<<s.canonical.z)-1?0:s.canonical.y+1)];_i(Bt,"CanonicalTileID"),_i($t,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const pi=Dr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Fi}=pi,Mi=Dr([{name:"a_pos_3",components:3,type:"Int16"}]);var Ci=Dr([{name:"a_pos",type:"Int16",components:2}]);class ji{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const p=Ye.vec3.dot(i,this.dir);if(Math.abs(p)<1e-6)return!1;const l=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/p;return o[0]=this.pos[0]+this.dir[0]*l,o[1]=this.pos[1]+this.dir[1]*l,o[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(e,i,o){if(Ye.vec3.equals(this.pos,e)||i===0)return o[0]=o[1]=o[2]=0,!1;const[p,l,f]=this.dir,w=this.pos[0]-e[0],C=this.pos[1]-e[1],O=this.pos[2]-e[2],x=p*p+l*l+f*f,E=2*(w*p+C*l+O*f),k=E*E-4*x*(w*w+C*C+O*O-i*i);if(k<0){const M=Math.max(-E/2,0),P=w+p*M,R=C+l*M,$=O+f*M,H=Math.hypot(P,R,$);return o[0]=P*i/H,o[1]=R*i/H,o[2]=$*i/H,!1}{const M=(-E-Math.sqrt(k))/(2*x);if(M<0){const P=Math.hypot(w,C,O);return o[0]=w*i/P,o[1]=C*i/P,o[2]=O*i/P,!1}return o[0]=w+p*M,o[1]=C+l*M,o[2]=O+f*M,!0}}}class pr{constructor(e,i,o,p,l){this.TL=e,this.TR=i,this.BR=o,this.BL=p,this.horizon=l}static fromInvProjectionMatrix(e,i,o){const p=[-1,1,1],l=[1,1,1],f=[1,-1,1],w=[-1,-1,1],C=Ye.vec3.transformMat4(p,p,e),O=Ye.vec3.transformMat4(l,l,e),x=Ye.vec3.transformMat4(f,f,e),E=Ye.vec3.transformMat4(w,w,e);return new pr(C,O,x,E,i/o)}}function Er(s,e,i){let o=1/0,p=-1/0;const l=[];for(const f of s){Ye.vec3.sub(l,f,e);const w=Ye.vec3.dot(l,i);o=Math.min(o,w),p=Math.max(p,w)}return[o,p]}function dn(s,e){let i=!0;for(let o=0;o<s.planes.length;o++){const p=s.planes[o];let l=0;for(let f=0;f<e.length;f++)l+=Ye.vec3.dot(p,e[f])+p[3]>=0;if(l===0)return 0;l!==e.length&&(i=!1)}return i?2:1}function $r(s,e){for(const i of s.projections){const o=Er(e,s.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function $i(s,e){let i=0;const o=[0,0,0,0];for(let p=0;p<s.length;p++)o[0]=s[p][0],o[1]=s[p][1],o[2]=s[p][2],o[3]=1,Ye.vec4.dot(o,e)>=0&&i++;return i}class lr{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=bi.fromPoints(this.points),this.projections=[],this.frustumEdges=[Ye.vec3.sub([],this.points[2],this.points[3]),Ye.vec3.sub([],this.points[0],this.points[3]),Ye.vec3.sub([],this.points[4],this.points[0]),Ye.vec3.sub([],this.points[5],this.points[1]),Ye.vec3.sub([],this.points[6],this.points[2]),Ye.vec3.sub([],this.points[7],this.points[3])];for(const o of this.frustumEdges){const p=[0,-o[2],o[1]],l=[o[2],0,-o[0]];this.projections.push({axis:p,projection:Er(this.points,this.points[0],p)}),this.projections.push({axis:l,projection:Er(this.points,this.points[0],l)})}}static fromInvProjectionMatrix(e,i,o,p){const l=Math.pow(2,o),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(O=>{const x=Ye.vec4.transformMat4([],O,e),E=1/x[3]/i*l;return Ye.vec4.mul(x,x,[E,E,p?1/x[3]:E,E])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(O=>{const x=Ye.vec3.sub([],f[O[0]],f[O[1]]),E=Ye.vec3.sub([],f[O[2]],f[O[1]]),k=Ye.vec3.normalize([],Ye.vec3.cross([],x,E)),M=-Ye.vec3.dot(k,f[O[1]]);return k.concat(M)}),C=[];for(let O=0;O<f.length;O++)C.push([f[O][0],f[O][1],f[O][2]]);return new lr(C,w)}intersectsPrecise(e,i,o){for(let p=0;p<i.length;p++)if(!$i(e,i[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!$i(e,this.planes[p]))return 0;for(const p of o)for(const l of this.frustumEdges){const f=Ye.vec3.cross([],p,l),w=Ye.vec3.length(f);if(w===0)continue;Ye.vec3.scale(f,f,1/w);const C=Er(this.points,this.points[0],f),O=Er(e,this.points[0],f);if(C[0]>O[1]||O[0]>C[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const o=i[3];if(Ye.vec3.dot([i[0],i[1],i[2]],e)+o<0)return!1}return!0}}class bi{static fromPoints(e){const i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const p of e)Ye.vec3.min(i,i,p),Ye.vec3.max(o,o,p);return new bi(i,o)}static fromTileIdAndHeight(e,i,o){const p=1<<e.canonical.z,l=e.canonical.x,f=e.canonical.y;return new bi([l/p,f/p,i],[(l+1)/p,(f+1)/p,o])}static applyTransform(e,i){const o=e.getCorners();for(let p=0;p<o.length;++p)Ye.vec3.transformMat4(o[p],o[p],i);return bi.fromPoints(o)}static applyTransformFast(e,i){const o=[i[12],i[13],i[14]],p=[...o];for(let l=0;l<3;l++)for(let f=0;f<3;f++){const w=i[4*f+l],C=w*e.min[f],O=w*e.max[f];o[l]+=Math.min(C,O),p[l]+=Math.max(C,O)}return new bi(o,p)}static projectAabbCorners(e,i){const o=e.getCorners();for(let p=0;p<o.length;++p)Ye.vec3.transformMat4(o[p],o[p],i);return o}constructor(e,i){this.min=e,this.max=i,this.center=Ye.vec3.scale([],Ye.vec3.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],o=Ye.vec3.clone(this.min),p=Ye.vec3.clone(this.max);for(let l=0;l<i.length;l++)o[l]=i[l]?this.min[l]:this.center[l],p[l]=i[l]?this.center[l]:this.max[l];return p[2]=this.max[2],new bi(o,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?dn(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?dn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?$r(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?$r(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function or(s){return s*Gn/Cc}_i(bi,"Aabb");const Ir=[new bi([Mo,Mo,Mo],[No,No,No]),new bi([Mo,Mo,Mo],[0,0,No]),new bi([0,Mo,Mo],[No,0,No]),new bi([Mo,0,Mo],[0,No,No]),new bi([0,0,Mo],[No,No,No])];function Mr(s,e,i,o=!0){const p=Ye.vec3.scale([],s._camera.position,s.worldSize),l=[e,i,1,1];Ye.vec4.transformMat4(l,l,s.pixelMatrixInverse),Ye.vec4.scale(l,l,1/l[3]);const f=Ye.vec3.sub([],l,p),w=Ye.vec3.normalize([],f),C=s.globeMatrix,O=[C[12],C[13],C[14]],x=Ye.vec3.sub([],O,p),E=Ye.vec3.length(x),k=Ye.vec3.normalize([],x),M=s.worldSize/(2*Math.PI),P=Ye.vec3.dot(k,w),R=Math.asin(M/E);if(R<Math.acos(P)){if(!o)return null;const $e=[],Ie=[];Ye.vec3.scale($e,w,E/P),Ye.vec3.normalize(Ie,Ye.vec3.sub(Ie,$e,x)),Ye.vec3.normalize(w,Ye.vec3.add(w,x,Ye.vec3.scale(w,Ie,Math.tan(R)*E)))}const $=[];new ji(p,w).closestPointOnSphere(O,M,$);const H=Ye.vec3.normalize([],jc(C,0)),J=Ye.vec3.normalize([],jc(C,1)),ee=Ye.vec3.normalize([],jc(C,2)),Z=Ye.vec3.dot(H,$),ne=Ye.vec3.dot(J,$),le=Ye.vec3.dot(ee,$),fe=$n(Math.asin(-ne/M));let Pe=$n(Math.atan2(Z,le));Pe=s.center.lng+function($e,Ie){const Ge=(Ie-$e+180)%360-180;return Ge<-180?Ge+360:Ge}(s.center.lng,Pe);const Ee=_a(Pe),Ce=nr(ya(fe),0,1);return new n(Ee,Ce)}class pn{constructor(e,i,o){this.a=Ye.vec3.sub([],e,o),this.b=Ye.vec3.sub([],i,o),this.center=o;const p=Ye.vec3.normalize([],this.a),l=Ye.vec3.normalize([],this.b);this.angle=Math.acos(Ye.vec3.dot(p,l))}}function ns(s,e){if(s.angle===0)return null;let i;return i=s.a[e]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[e]/s.a[e]/Math.sin(s.angle)-1/Math.tan(s.angle)),i<0||i>1?null:function(o,p,l,f){const w=Math.sin(l);return o*(Math.sin((1-f)*l)/w)+p*(Math.sin(f*l)/w)}(s.a[e],s.b[e],s.angle,nr(i,0,1))+s.center[e]}function Tn(s){if(s.z<=1)return Ir[s.z+2*s.y+s.x];const e=Hr(rn(s));return bi.fromPoints(e)}function qn(s,e,i){return Ye.vec3.scale(s,s,1-i),Ye.vec3.scaleAndAdd(s,s,e,i)}function Co(s,e,i){for(const o of s)Ye.vec3.transformMat4(o,o,e),Ye.vec3.scale(o,o,i)}function Gs(s,e,i,o){const p=e/s.worldSize,l=s.globeMatrix;if(i.z<=1){const Ee=Tn(i).getCorners();return Co(Ee,l,p),bi.fromPoints(Ee)}const f=rn(i,o),w=Hr(f,Gn+or(s._tileCoverLift));Co(w,l,p);const C=Number.MAX_VALUE,O=[-C,-C,-C],x=[C,C,C];if(f.contains(s.center)){for(const $e of w)Ye.vec3.min(x,x,$e),Ye.vec3.max(O,O,$e);O[2]=0;const Ee=s.point,Ce=[Ee.x*p,Ee.y*p,0];return Ye.vec3.min(x,x,Ce),Ye.vec3.max(O,O,Ce),new bi(x,O)}if(s._tileCoverLift>0){for(const Ee of w)Ye.vec3.min(x,x,Ee),Ye.vec3.max(O,O,Ee);return new bi(x,O)}const E=[l[12]*p,l[13]*p,l[14]*p],k=f.getCenter(),M=nr(s.center.lat,-85.051129,uo),P=nr(k.lat,-85.051129,uo),R=_a(s.center.lng),$=ya(M);let H=R-_a(k.lng);const J=$-ya(P);H>.5?H-=1:H<-.5&&(H+=1);let ee=0;if(Math.abs(H)>Math.abs(J))ee=H>=0?1:3;else{ee=J>=0?0:2;const Ee=[l[4]*p,l[5]*p,l[6]*p],Ce=-Math.sin(rr(J>=0?f.getSouth():f.getNorth()))*Gn;Ye.vec3.scaleAndAdd(E,E,Ee,Ce)}const Z=w[ee],ne=w[(ee+1)%4],le=new pn(Z,ne,E),fe=[ns(le,0)||Z[0],ns(le,1)||Z[1],ns(le,2)||Z[2]],Pe=ho(s.zoom);if(Pe>0){const Ee=function({x:$e,y:Ie,z:Ge},Ze,qe,et,nt){const ct=1/(1<<Ge);let it=$e*ct,Et=it+ct,Nt=Ie*ct,Ct=Nt+ct,si=0;const ti=(it+Et)/2-et;return ti>.5?si=-1:ti<-.5&&(si=1),it=((it+si)*Ze-(et*=Ze))*qe+et,Et=((Et+si)*Ze-et)*qe+et,Nt=(Nt*Ze-(nt*=Ze))*qe+nt,Ct=(Ct*Ze-nt)*qe+nt,[[it,Ct,0],[Et,Ct,0],[Et,Nt,0],[it,Nt,0]]}(i,e,s._pixelsPerMercatorPixel,R,$);for(let $e=0;$e<w.length;$e++)qn(w[$e],Ee[$e],Pe);const Ce=Ye.vec3.add([],Ee[ee],Ee[(ee+1)%4]);Ye.vec3.scale(Ce,Ce,.5),qn(fe,Ce,Pe)}for(const Ee of w)Ye.vec3.min(x,x,Ee),Ye.vec3.max(O,O,Ee);return x[2]=Math.min(Z[2],ne[2]),Ye.vec3.min(x,x,fe),Ye.vec3.max(O,O,fe),new bi(x,O)}function rn({x:s,y:e,z:i},o=!1){const p=1/(1<<i),l=new Cr(co(s*p),e===(1<<i)-1&&o?-90:Wn((e+1)*p)),f=new Cr(co((s+1)*p),e===0&&o?90:Wn(e*p));return new rl(l,f)}function Hr(s,e=Gn){const i=rr(s.getNorth()),o=rr(s.getSouth()),p=Math.cos(i),l=Math.cos(o),f=Math.sin(i),w=Math.sin(o),C=s.getWest(),O=s.getEast();return[Mc(l,w,C,e),Mc(l,w,O,e),Mc(p,f,O,e),Mc(p,f,C,e)]}function Br(s,e,i,o){const p=1<<i.z,l=(s/ei+i.x)/p;return ga(Wn((e/ei+i.y)/p),co(l),o)}function mr({min:s,max:e}){return xd/Math.max(e[0]-s[0],e[1]-s[1],e[2]-s[2])}const In=new Float64Array(16);function Yn(s){const e=mr(s),i=Ye.mat4.fromScaling(In,[e,e,e]);return Ye.mat4.translate(i,i,Ye.vec3.negate([],s.min))}function jr(s){const e=Ye.mat4.fromTranslation(In,s.min),i=1/mr(s);return Ye.mat4.scale(e,e,[i,i,i])}function zs(s){const e=ei/(2*Math.PI);return s/(2*Math.PI)/e}function ta(s,e){return ei/(512*Math.pow(2,s))*mr(Tn(e))}function Eo(s,e,i,o,p){const l=zs(i),f=[s,e,-i/(2*Math.PI)],w=Ye.mat4.identity(new Float64Array(16));return Ye.mat4.translate(w,w,f),Ye.mat4.scale(w,w,[l,l,l]),Ye.mat4.rotateX(w,w,rr(-p)),Ye.mat4.rotateY(w,w,rr(-o)),w}function ho(s){return Kr(il,vd,s)}function Vo(s,e){const i=ga(e.lat,e.lng),o=function(l){const f=ga(l._center.lat,l._center.lng),w=Ye.vec3.fromValues(0,1,0);let C=Ye.vec3.cross([],w,f);const O=Ye.mat4.fromRotation([],-l.angle,f);C=Ye.vec3.transformMat4(C,C,O),Ye.mat4.fromRotation(O,-l._pitch,C);const x=Ye.vec3.normalize([],f);return Ye.vec3.scale(x,x,or(l.cameraToCenterDistance/l.pixelsPerMeter)),Ye.vec3.transformMat4(x,x,O),Ye.vec3.add([],f,x)}(s),p=Ye.vec3.subtract([],o,i);return Ye.vec3.angle(p,i)}function Uo(s,e){return Vo(s,e)>Math.PI/2*1.01}const jo=rr(85),nl=Math.cos(jo),$o=Math.sin(jo),Ec=Ye.mat4.create(),Ac=s=>{const e=[];return s.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),s.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function bd(s,e,i,o,p,l,f,w,C){if(l&&s.queryGeometry.isAboveHorizon)return!1;l&&(C*=s.pixelToTileUnitsFactor);const O=s.tileID.canonical,x=i.projection.upVectorScale(O,i.center.lat,i.worldSize).metersToTile;for(const E of e)for(const k of E){const M=k.add(w),P=p&&i.elevation?i.elevation.exaggeration()*p.getElevationAt(M.x,M.y,!0):0,R=i.projection.projectTilePoint(M.x,M.y,O);if(P>0){const ee=i.projection.upVector(O,M.x,M.y);R.x+=ee[0]*x*P,R.y+=ee[1]*x*P,R.z+=ee[2]*x*P}const $=l?M:wd(R.x,R.y,R.z,o),H=l?s.tilespaceRays.map(ee=>O0(ee,P)):s.queryGeometry.screenGeometry,J=Ye.vec4.transformMat4([],[R.x,R.y,R.z,1],o);if(!f&&l?C*=J[3]/i.cameraToCenterDistance:f&&!l&&(C*=i.cameraToCenterDistance/J[3]),l){const ee=Wn((k.y/ei+O.y)/(1<<O.z));C/=i.projection.pixelsPerMeter(ee,1)/to(1,ee)}if(de(H,$,C))return!0}return!1}function wd(s,e,i,o){const p=Ye.vec4.transformMat4([],[s,e,i,1],o);return new Wt(p[0]/p[3],p[1]/p[3])}const d_=Ye.vec3.fromValues(0,0,0),k0=Ye.vec3.fromValues(0,0,1);function O0(s,e){const i=Ye.vec3.create();return d_[2]=e,s.intersectsPlane(d_,k0,i),new Wt(i[0],i[1])}class p_ extends ce{}let f_,Jm,m_,Qm;function g_(s,{width:e,height:i},o,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==e*i*o)throw new RangeError("mismatched image size")}else p=new Uint8Array(e*i*o);return s.width=e,s.height=i,s.data=p,s}function __(s,e,i){const{width:o,height:p}=e;o===s.width&&p===s.height||(Kf(s,e,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,o),height:Math.min(s.height,p)},i,null),s.width=o,s.height=p,s.data=e.data)}function Kf(s,e,i,o,p,l,f,w){if(p.width===0||p.height===0)return e;if(p.width>s.width||p.height>s.height||i.x>s.width-p.width||i.y>s.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>e.width||p.height>e.height||o.x>e.width-p.width||o.y>e.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const C=s.data,O=e.data,x=l===4&&w;for(let E=0;E<p.height;E++){const k=((i.y+E)*s.width+i.x)*l,M=((o.y+E)*e.width+o.x)*l;if(x)for(let P=0;P<p.width;P++){const R=k+P*l+3,$=M+P*l;O[$+0]=255,O[$+1]=255,O[$+2]=255,O[$+3]=C[R]}else if(f)for(let P=0;P<p.width;P++){const R=k+P*l,$=M+P*l,H=C[R+3],J=new Ar(C[R+0]/255*H,C[R+1]/255*H,C[R+2]/255*H,H).toRenderColor(f).toArray();O[$+0]=J[0],O[$+1]=J[1],O[$+2]=J[2],O[$+3]=J[3]}else for(let P=0;P<p.width*l;P++)O[M+P]=C[k+P]}return e}_i(p_,"HeatmapBucket",{omit:["layers"]});class Vl{constructor(e,i){g_(this,e,1,i)}resize(e){__(this,new Vl(e),1)}clone(){return new Vl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,p,l){Kf(e,i,o,p,l,1,null)}}class Fs{constructor(e,i){g_(this,e,4,i)}resize(e){__(this,new Fs(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Fs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,p,l,f,w){Kf(e,i,o,p,l,4,f,w)}}class Jf{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Bp(s){const e={},i=s.resolution||256,o=s.clips?s.clips.length:1,p=s.image||new Fs({width:i,height:o}),l=(f,w,C)=>{e[s.evaluationKey]=C;const O=s.expression.evaluate(e);O&&(p.data[f+w+0]=Math.floor(255*O.r/O.a),p.data[f+w+1]=Math.floor(255*O.g/O.a),p.data[f+w+2]=Math.floor(255*O.b/O.a),p.data[f+w+3]=Math.floor(255*O.a))};if(s.clips)for(let f=0,w=0;f<o;++f,w+=4*i)for(let C=0,O=0;C<i;C++,O+=4){const x=C/(i-1),{start:E,end:k}=s.clips[f];l(w,O,E*(1-x)+k*x)}else for(let f=0,w=0;f<i;f++,w+=4)l(0,w,f/(i-1));return p}_i(Vl,"AlphaImage"),_i(Fs,"RGBAImage");const L0=Dr([{name:"a_pos",components:2,type:"Int16"}],4),{members:R0}=L0;function Sd(s,e,i=2){const o=e&&e.length,p=o?e[0]*i:s.length;let l=y_(s,0,p,i,!0);const f=[];if(!l||l.next===l.prev)return f;let w,C,O;if(o&&(l=function(x,E,k,M){const P=[];for(let R=0,$=E.length;R<$;R++){const H=y_(x,E[R]*M,R<$-1?E[R+1]*M:x.length,M,!1);H===H.next&&(H.steiner=!0),P.push(U0(H))}P.sort(N0);for(let R=0;R<P.length;R++)k=V0(P[R],k);return k}(s,e,l,i)),s.length>80*i){w=1/0,C=1/0;let x=-1/0,E=-1/0;for(let k=i;k<p;k+=i){const M=s[k],P=s[k+1];M<w&&(w=M),P<C&&(C=P),M>x&&(x=M),P>E&&(E=P)}O=Math.max(x-w,E-C),O=O!==0?32767/O:0}return Td(l,f,i,w,C,O,0),f}function y_(s,e,i,o,p){let l;if(p===function(f,w,C,O){let x=0;for(let E=w,k=C-O;E<C;E+=O)x+=(f[k]-f[E])*(f[E+1]+f[k+1]),k=E;return x}(s,e,i,o)>0)for(let f=e;f<i;f+=o)l=S_(f/o|0,s[f],s[f+1],l);else for(let f=i-o;f>=e;f-=o)l=S_(f/o|0,s[f],s[f+1],l);return l&&Np(l,l.next)&&(wh(l),l=l.next),l}function Eu(s,e){if(!s)return s;e||(e=s);let i,o=s;do if(i=!1,o.steiner||!Np(o,o.next)&&cs(o.prev,o,o.next)!==0)o=o.next;else{if(wh(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function Td(s,e,i,o,p,l,f){if(!s)return;!f&&l&&function(C,O,x,E){let k=C;do k.z===0&&(k.z=Qf(k.x,k.y,O,x,E)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==C);k.prevZ.nextZ=null,k.prevZ=null,function(M){let P,R=1;do{let $,H=M;M=null;let J=null;for(P=0;H;){P++;let ee=H,Z=0;for(let le=0;le<R&&(Z++,ee=ee.nextZ,ee);le++);let ne=R;for(;Z>0||ne>0&&ee;)Z!==0&&(ne===0||!ee||H.z<=ee.z)?($=H,H=H.nextZ,Z--):($=ee,ee=ee.nextZ,ne--),J?J.nextZ=$:M=$,$.prevZ=J,J=$;H=ee}J.nextZ=null,R*=2}while(P>1)}(k)}(s,o,p,l);let w=s;for(;s.prev!==s.next;){const C=s.prev,O=s.next;if(l?F0(s,o,p,l):z0(s))e.push(C.i,s.i,O.i),wh(s),s=O.next,w=O.next;else if((s=O)===w){f?f===1?Td(s=v_(Eu(s),e),e,i,o,p,l,2):f===2&&B0(s,e,i,o,p,l):Td(Eu(s),e,i,o,p,l,1);break}}}function z0(s){const e=s.prev,i=s,o=s.next;if(cs(e,i,o)>=0)return!1;const p=e.x,l=i.x,f=o.x,w=e.y,C=i.y,O=o.y,x=p<l?p<f?p:f:l<f?l:f,E=w<C?w<O?w:O:C<O?C:O,k=p>l?p>f?p:f:l>f?l:f,M=w>C?w>O?w:O:C>O?C:O;let P=o.next;for(;P!==e;){if(P.x>=x&&P.x<=k&&P.y>=E&&P.y<=M&&Md(p,w,l,C,f,O,P.x,P.y)&&cs(P.prev,P,P.next)>=0)return!1;P=P.next}return!0}function F0(s,e,i,o){const p=s.prev,l=s,f=s.next;if(cs(p,l,f)>=0)return!1;const w=p.x,C=l.x,O=f.x,x=p.y,E=l.y,k=f.y,M=w<C?w<O?w:O:C<O?C:O,P=x<E?x<k?x:k:E<k?E:k,R=w>C?w>O?w:O:C>O?C:O,$=x>E?x>k?x:k:E>k?E:k,H=Qf(M,P,e,i,o),J=Qf(R,$,e,i,o);let ee=s.prevZ,Z=s.nextZ;for(;ee&&ee.z>=H&&Z&&Z.z<=J;){if(ee.x>=M&&ee.x<=R&&ee.y>=P&&ee.y<=$&&ee!==p&&ee!==f&&Md(w,x,C,E,O,k,ee.x,ee.y)&&cs(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,Z.x>=M&&Z.x<=R&&Z.y>=P&&Z.y<=$&&Z!==p&&Z!==f&&Md(w,x,C,E,O,k,Z.x,Z.y)&&cs(Z.prev,Z,Z.next)>=0))return!1;Z=Z.nextZ}for(;ee&&ee.z>=H;){if(ee.x>=M&&ee.x<=R&&ee.y>=P&&ee.y<=$&&ee!==p&&ee!==f&&Md(w,x,C,E,O,k,ee.x,ee.y)&&cs(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;Z&&Z.z<=J;){if(Z.x>=M&&Z.x<=R&&Z.y>=P&&Z.y<=$&&Z!==p&&Z!==f&&Md(w,x,C,E,O,k,Z.x,Z.y)&&cs(Z.prev,Z,Z.next)>=0)return!1;Z=Z.nextZ}return!0}function v_(s,e){let i=s;do{const o=i.prev,p=i.next.next;!Np(o,p)&&w_(o,i,i.next,p)&&jp(o,p)&&jp(p,o)&&(e.push(o.i,i.i,p.i),wh(i),wh(i.next),i=s=p),i=i.next}while(i!==s);return Eu(i)}function B0(s,e,i,o,p,l){let f=s;do{let w=f.next.next;for(;w!==f.prev;){if(f.i!==w.i&&b_(f,w)){let C=eg(f,w);return f=Eu(f,f.next),C=Eu(C,C.next),Td(f,e,i,o,p,l,0),void Td(C,e,i,o,p,l,0)}w=w.next}f=f.next}while(f!==s)}function N0(s,e){return s.x-e.x}function V0(s,e){const i=function(p,l){let f=l;const w=p.x,C=p.y;let O,x=-1/0;do{if(C<=f.y&&C>=f.next.y&&f.next.y!==f.y){const R=f.x+(C-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(R<=w&&R>x&&(x=R,O=f.x<f.next.x?f:f.next,R===w))return O}f=f.next}while(f!==l);if(!O)return null;const E=O,k=O.x,M=O.y;let P=1/0;f=O;do{if(w>=f.x&&f.x>=k&&w!==f.x&&Md(C<M?w:x,C,k,M,C<M?x:w,C,f.x,f.y)){const R=Math.abs(C-f.y)/(w-f.x);jp(f,p)&&(R<P||R===P&&(f.x>O.x||f.x===O.x&&x_(O,f)))&&(O=f,P=R)}f=f.next}while(f!==E);return O}(s,e);if(!i)return e;const o=eg(i,s);return Eu(o,o.next),Eu(i,i.next)}function x_(s,e){return cs(s.prev,s,e.prev)<0&&cs(e.next,s,s.next)<0}function Qf(s,e,i,o,p){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-i)*p|0)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*p|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function U0(s){let e=s,i=s;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==s);return i}function Md(s,e,i,o,p,l,f,w){return(p-f)*(e-w)>=(s-f)*(l-w)&&(s-f)*(o-w)>=(i-f)*(e-w)&&(i-f)*(l-w)>=(p-f)*(o-w)}function b_(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function(i,o){let p=i;do{if(p.i!==i.i&&p.next.i!==i.i&&p.i!==o.i&&p.next.i!==o.i&&w_(p,p.next,i,o))return!0;p=p.next}while(p!==i);return!1}(s,e)&&(jp(s,e)&&jp(e,s)&&function(i,o){let p=i,l=!1;const f=(i.x+o.x)/2,w=(i.y+o.y)/2;do p.y>w!=p.next.y>w&&p.next.y!==p.y&&f<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(l=!l),p=p.next;while(p!==i);return l}(s,e)&&(cs(s.prev,s,e.prev)||cs(s,e.prev,e))||Np(s,e)&&cs(s.prev,s,s.next)>0&&cs(e.prev,e,e.next)>0)}function cs(s,e,i){return(e.y-s.y)*(i.x-e.x)-(e.x-s.x)*(i.y-e.y)}function Np(s,e){return s.x===e.x&&s.y===e.y}function w_(s,e,i,o){const p=Up(cs(s,e,i)),l=Up(cs(s,e,o)),f=Up(cs(i,o,s)),w=Up(cs(i,o,e));return p!==l&&f!==w||!(p!==0||!Vp(s,i,e))||!(l!==0||!Vp(s,o,e))||!(f!==0||!Vp(i,s,o))||!(w!==0||!Vp(i,e,o))}function Vp(s,e,i){return e.x<=Math.max(s.x,i.x)&&e.x>=Math.min(s.x,i.x)&&e.y<=Math.max(s.y,i.y)&&e.y>=Math.min(s.y,i.y)}function Up(s){return s>0?1:s<0?-1:0}function jp(s,e){return cs(s.prev,s,s.next)<0?cs(s,e,s.next)>=0&&cs(s,s.prev,e)>=0:cs(s,e,s.prev)<0||cs(s,s.next,e)<0}function eg(s,e){const i=tg(s.i,s.x,s.y),o=tg(e.i,e.x,e.y),p=s.next,l=e.prev;return s.next=e,e.prev=s,i.next=p,p.prev=i,o.next=i,i.prev=o,l.next=o,o.prev=l,o}function S_(s,e,i,o){const p=tg(s,e,i);return o?(p.next=o.next,p.prev=o,o.next.prev=p,o.next=p):(p.prev=p,p.next=p),p}function wh(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function tg(s,e,i){return{i:s,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function $p(s,e){const i=s.length;if(i<=1)return[s];const o=[];let p,l;for(let f=0;f<i;f++){const w=$u(s[f]);w!==0&&(s[f].area=Math.abs(w),l===void 0&&(l=w<0),l===w<0?(p&&o.push(p),p=[s[f]]):p.push(s[f]))}if(p&&o.push(p),e>1)for(let f=0;f<o.length;f++)o[f].length<=e||(Xu(o[f],e,1,o[f].length-1,T_),o[f]=o[f].slice(0,e));return o}function T_(s,e){return e.area-s.area}function M_(s,e,i=1){if(!s)return null;const o=typeof s=="string"?s:s.getPrimary().id;e[o]||(e[o]=[]);const p=ks.from(o).getPrimary().scaleSelf(i);return e[o].push(p),p.serialize()}function ig(s,e,i,o){const p=o.patternDependencies;let l=!1;for(const f of e){const w=f.paint.get(`${s}-pattern`);w.isConstant()||(l=!0),M_(w.constantOr(null),p,i)&&(l=!0)}return l}function Hp(s,e,i,o,p,l){const f=l.patternDependencies;for(const w of e){const C=w.paint.get(`${s}-pattern`).value;if(C.kind!=="constant"){let O=C.evaluate({zoom:o},i,{},l.availableImages);O=O&&O.name?O.name:O;const x=M_(O,f,p);x&&(i.patterns[w.id]=x)}}return i}class rg{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new wo,this.indexArray=new gs,this.indexArray2=new Ja,this.programConfigurations=new ma(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Sn,this.segments2=new Sn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}updateFootprints(e,i){}populate(e,i,o,p){this.hasPattern=ig("fill",this.layers,this.pixelRatio,i);const l=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:w,id:C,index:O,sourceLayerIndex:x}of e){const E=this.layers[0]._featureFilter.needGeometry,k=G(w,E);if(!this.layers[0]._featureFilter.filter(new Vr(this.zoom),k,o))continue;const M=l?l.evaluate(k,{},o,i.availableImages):void 0,P={id:C,properties:w.properties,type:w.type,sourceLayerIndex:x,index:O,geometry:E?k.geometry:j(w,o,p),patterns:{},sortKey:M};f.push(P)}l&&f.sort((w,C)=>w.sortKey-C.sortKey);for(const w of f){const{geometry:C,index:O,sourceLayerIndex:x}=w;if(this.hasPattern){const E=Hp("fill",this.layers,w,this.zoom,this.pixelRatio,i);this.patternFeatures.push(E)}else this.addFeature(w,C,O,o,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[O].feature,C,O,x,this.index)}}update(e,i,o,p,l,f,w){this.programConfigurations.updatePaintArrays(e,i,l,o,p,f,w)}addFeatures(e,i,o,p,l,f){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,i,o,p,f,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,R0),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,p,l,f=[],w,C){for(const O of $p(i,500)){let x=0;for(const $ of O)x+=$.length;const E=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),k=E.vertexLength,M=[],P=[];for(const $ of O){if($.length===0)continue;$!==O[0]&&P.push(M.length/2);const H=this.segments2.prepareSegment($.length,this.layoutVertexArray,this.indexArray2),J=H.vertexLength;this.layoutVertexArray.emplaceBack($[0].x,$[0].y),this.indexArray2.emplaceBack(J+$.length-1,J),M.push($[0].x),M.push($[0].y);for(let ee=1;ee<$.length;ee++)this.layoutVertexArray.emplaceBack($[ee].x,$[ee].y),this.indexArray2.emplaceBack(J+ee-1,J+ee),M.push($[ee].x),M.push($[ee].y);H.vertexLength+=$.length,H.primitiveLength+=$.length}const R=Sd(M,P);for(let $=0;$<R.length;$+=3)this.indexArray.emplaceBack(k+R[$],k+R[$+1],k+R[$+2]);E.vertexLength+=x,E.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,l,f,p,w)}}let C_,E_,A_,P_;_i(rg,"FillBucket",{omit:["layers","patternFeatures"]});class ng{constructor(e,i,o,p){if(this.triangleCount=i.length/3,this.min=new Wt(0,0),this.max=new Wt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[l,f]=[e[0].clone(),e[0].clone()];for(let E=1;E<e.length;++E){const k=e[E];l.x=Math.min(l.x,k.x),l.y=Math.min(l.y,k.y),f.x=Math.max(f.x,k.x),f.y=Math.max(f.y,k.y)}if(p){const E=Math.ceil(Math.max(f.x-l.x,f.y-l.y)/p);o=Math.max(o,E)}if(o===0)return;this.min=l,this.max=f;const w=this.max.sub(this.min);w.x=Math.max(w.x,1),w.y=Math.max(w.y,1);const C=Math.max(w.x,w.y)/o;this.cellsX=Math.max(1,Math.ceil(w.x/C)),this.cellsY=Math.max(1,Math.ceil(w.y/C)),this.xScale=1/C,this.yScale=1/C;const O=[];for(let E=0;E<this.triangleCount;E++){const k=e[i[3*E+0]].sub(this.min),M=e[i[3*E+1]].sub(this.min),P=e[i[3*E+2]].sub(this.min),R=va(Math.floor(Math.min(k.x,M.x,P.x)),this.xScale,this.cellsX),$=va(Math.floor(Math.max(k.x,M.x,P.x)),this.xScale,this.cellsX),H=va(Math.floor(Math.min(k.y,M.y,P.y)),this.yScale,this.cellsY),J=va(Math.floor(Math.max(k.y,M.y,P.y)),this.yScale,this.cellsY),ee=new Wt(0,0),Z=new Wt(0,0),ne=new Wt(0,0),le=new Wt(0,0);for(let fe=H;fe<=J;++fe){ee.y=Z.y=fe*C,ne.y=le.y=(fe+1)*C;for(let Pe=R;Pe<=$;++Pe)ee.x=ne.x=Pe*C,Z.x=le.x=(Pe+1)*C,(ut(k,M,P,ee,Z,le)||ut(k,M,P,ee,le,ne))&&O.push({cellIdx:fe*this.cellsX+Pe,triIdx:E})}}if(O.length===0)return;O.sort((E,k)=>E.cellIdx-k.cellIdx||E.triIdx-k.triIdx);let x=0;for(;x<O.length;){const E=O[x].cellIdx,k={start:this.payload.length,len:0};for(;x<O.length&&O[x].cellIdx===E;)++k.len,this.payload.push(O[x++].triIdx);this.cells[E]=k}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const o=va(e.x-this.min.x,this.xScale,this.cellsX),p=va(e.y-this.min.y,this.yScale,this.cellsY),l=this.cells[p*this.cellsX+o];if(l){this._lazyInitLookup();for(let f=0;f<l.len;f++){const w=this.payload[l.start+f],C=Math.floor(w/8),O=1<<w%8;if(!(this.lookup[C]&O)&&(this.lookup[C]|=O,i.push(w),i.length===this.triangleCount))return}}}query(e,i,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const p=va(e.x-this.min.x,this.xScale,this.cellsX),l=va(i.x-this.min.x,this.xScale,this.cellsX),f=va(e.y-this.min.y,this.yScale,this.cellsY),w=va(i.y-this.min.y,this.yScale,this.cellsY);for(let C=f;C<=w;C++)for(let O=p;O<=l;O++){const x=this.cells[C*this.cellsX+O];if(x)for(let E=0;E<x.len;E++){const k=this.payload[x.start+E],M=Math.floor(k/8),P=1<<k%8;if(!(this.lookup[M]&P)&&(this.lookup[M]|=P,o.push(k),o.length===this.triangleCount))return}}}}function va(s,e,i){return Math.max(0,Math.min(i-1,Math.floor(s*e)))}_i(ng,"TriangleGridIndex");class D_{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(e,i){for(const o of this.footprints)i.push({footprint:o,id:e})}populate(e,i,o,p){const l=[];for(const{feature:f,id:w,index:C,sourceLayerIndex:O}of e){const x=this.layers[0]._featureFilter.needGeometry,E=G(f,x);if(!this.layers[0]._featureFilter.filter(new Vr(this.zoom),E,o))continue;const k={id:w,properties:f.properties,type:f.type,sourceLayerIndex:O,index:C,geometry:x?E.geometry:j(f,o,p),patterns:{}};l.push(k)}for(const f of l){const{geometry:w,index:C,sourceLayerIndex:O}=f;this.addFeature(f,w,C,o,{},i.availableImages,i.brightness),i.featureIndex.insert(e[C].feature,w,C,O,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,o,p,l,f,w){}destroy(){}addFeature(e,i,o,p,l,f=[],w){for(const C of $p(i,2)){const O=[],x=[],E=[],k=new Wt(1/0,1/0),M=new Wt(-1/0,-1/0);for(const $ of C)if($.length!==0){$!==C[0]&&E.push(x.length/2);for(let H=0;H<$.length;H++)x.push($[H].x),x.push($[H].y),O.push($[H]),k.x=Math.min(k.x,$[H].x),k.y=Math.min(k.y,$[H].y),M.x=Math.max(M.x,$[H].x),M.y=Math.max(M.y,$[H].y)}const P=Sd(x,E),R=new ng(O,P,8,256);this.footprints.push({vertices:O,indices:P,grid:R,min:k,max:M})}}}_i(D_,"ClipBucket",{omit:["layers"]});const j0=Dr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),$0=Dr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Y=Dr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),h=Dr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),v=Dr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),S=Dr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:D}=j0;var L,z,B,U,X,te,K,re={};function ue(){if(z)return L;z=1;var s=Xs();function e(p,l,f,w,C){this.properties={},this.extent=f,this.type=0,this._pbf=p,this._geometry=-1,this._keys=w,this._values=C,p.readFields(i,this,l)}function i(p,l,f){p==1?l.id=f.readVarint():p==2?function(w,C){for(var O=w.readVarint()+w.pos;w.pos<O;){var x=C._keys[w.readVarint()],E=C._values[w.readVarint()];C.properties[x]=E}}(f,l):p==3?l.type=f.readVarint():p==4&&(l._geometry=f.pos)}function o(p){for(var l,f,w=0,C=0,O=p.length,x=O-1;C<O;x=C++)w+=((f=p[x]).x-(l=p[C]).x)*(l.y+f.y);return w}return L=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var l,f=p.readVarint()+p.pos,w=1,C=0,O=0,x=0,E=[];p.pos<f;){if(C<=0){var k=p.readVarint();w=7&k,C=k>>3}if(C--,w===1||w===2)O+=p.readSVarint(),x+=p.readSVarint(),w===1&&(l&&E.push(l),l=[]),l.push(new s(O,x));else{if(w!==7)throw new Error("unknown command "+w);l&&l.push(l[0].clone())}}return l&&E.push(l),E},e.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var l=p.readVarint()+p.pos,f=1,w=0,C=0,O=0,x=1/0,E=-1/0,k=1/0,M=-1/0;p.pos<l;){if(w<=0){var P=p.readVarint();f=7&P,w=P>>3}if(w--,f===1||f===2)(C+=p.readSVarint())<x&&(x=C),C>E&&(E=C),(O+=p.readSVarint())<k&&(k=O),O>M&&(M=O);else if(f!==7)throw new Error("unknown command "+f)}return[x,k,E,M]},e.prototype.toGeoJSON=function(p,l,f){var w,C,O=this.extent*Math.pow(2,f),x=this.extent*p,E=this.extent*l,k=this.loadGeometry(),M=e.types[this.type];function P(H){for(var J=0;J<H.length;J++){var ee=H[J];H[J]=[360*(ee.x+x)/O-180,360/Math.PI*Math.atan(Math.exp((180-360*(ee.y+E)/O)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(w=0;w<k.length;w++)R[w]=k[w][0];P(k=R);break;case 2:for(w=0;w<k.length;w++)P(k[w]);break;case 3:for(k=function(H){var J=H.length;if(J<=1)return[H];for(var ee,Z,ne=[],le=0;le<J;le++){var fe=o(H[le]);fe!==0&&(Z===void 0&&(Z=fe<0),Z===fe<0?(ee&&ne.push(ee),ee=[H[le]]):ee.push(H[le]))}return ee&&ne.push(ee),ne}(k),w=0;w<k.length;w++)for(C=0;C<k[w].length;C++)P(k[w][C])}k.length===1?k=k[0]:M="Multi"+M;var $={type:"Feature",geometry:{type:M,coordinates:k},properties:this.properties};return"id"in this&&($.id=this.id),$},L}function ge(){if(U)return B;U=1;var s=ue();function e(o,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(i,this,p),this.length=this._features.length}function i(o,p,l){o===15?p.version=l.readVarint():o===1?p.name=l.readString():o===5?p.extent=l.readVarint():o===2?p._features.push(l.pos):o===3?p._keys.push(l.readString()):o===4&&p._values.push(function(f){for(var w=null,C=f.readVarint()+f.pos;f.pos<C;){var O=f.readVarint()>>3;w=O===1?f.readString():O===2?f.readFloat():O===3?f.readDouble():O===4?f.readVarint64():O===5?f.readVarint():O===6?f.readSVarint():O===7?f.readBoolean():null}return w}(l))}return B=e,e.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var p=this._pbf.readVarint()+this._pbf.pos;return new s(this._pbf,p,this.extent,this._keys,this._values)},B}function ye(){return K||(K=1,re.VectorTile=function(){if(te)return X;te=1;var s=ge();function e(i,o,p){if(i===3){var l=new s(p,p.readVarint()+p.pos);l.length&&(o[l.name]=l)}}return X=function(i,o){this.layers=i.readFields(e,{},o)},X}(),re.VectorTileFeature=ue(),re.VectorTileLayer=ge()),re}var be=ye();class _e extends Wt{constructor(e,i,o){super(e,i),this.z=o}}class Fe extends _e{constructor(e,i,o,p){super(e,i,o),this.w=p}}function ze(s,e,i,o){const p=[],l=o===0?(f,w,C,O,x,E)=>{f.push(new Wt(E,C+(E-w)/(O-w)*(x-C)))}:(f,w,C,O,x,E)=>{f.push(new Wt(w+(E-C)/(x-C)*(O-w),E))};for(const f of s){const w=[];for(const C of f){if(C.length<=2)continue;const O=[];for(let k=0;k<C.length-1;k++){const M=C[k].x,P=C[k].y,R=C[k+1].x,$=C[k+1].y,H=o===0?M:P,J=o===0?R:$;H<e?J>e&&l(O,M,P,R,$,e):H>i?J<i&&l(O,M,P,R,$,i):O.push(C[k]),J<e&&H>=e&&l(O,M,P,R,$,e),J>i&&H<=i&&l(O,M,P,R,$,i)}let x=C[C.length-1];const E=o===0?x.x:x.y;E>=e&&E<=i&&O.push(x),O.length&&(x=O[O.length-1],O[0].x===x.x&&O[0].y===x.y||O.push(O[0]),w.push(O))}w.length&&p.push(w)}return p}function ft(s,e,i,o){const p=i==="x"?"y":"x",l=(o-s[i])/(e[i]-s[i]);s[p]=s[p]+(e[p]-s[p])*l,s[i]=o,s.hasOwnProperty("z")&&(s.z=Di(s.z,e.z,l)),s.hasOwnProperty("w")&&(s.w=Di(s.w,e.w,l))}function St(s,e,i,o){const p=i,l=o;for(const f of["x","y"]){let w=s,C=e;w[f]>=C[f]&&(w=e,C=s),w[f]<p&&C[f]>p&&ft(w,C,f,p),w[f]<l&&C[f]>l&&ft(C,w,f,l)}}const _t=Number.MAX_SAFE_INTEGER;function Ot(s,e,i,o){return s.order<e||s.order===_t||!(s.clipMask&i)||function(p,l){return l.length!==0&&l.find(f=>f===p)===void 0}(o,s.clipScope)}function Pt(s,e){return s.x-e.x||s.y-e.y}function Ft(s,e){return Pt(s.min,e.min)===0&&Pt(s.max,e.max)===0}function di(s,e){return!(s.min.x>e.max.x||s.max.x<e.min.x||s.min.y>e.max.y||s.max.y<e.min.y)}function gi(s,e){if(s.length!==e.length)return!1;for(let i=0;i<s.length;i++)if(s[i].sourceId!==e[i].sourceId||!Ft(s[i],e[i])||s[i].order!==e[i].order||s[i].clipMask!==e[i].clipMask||!jn(s[i].clipScope,e[i].clipScope))return!1;return!0}function Ai(s,e,i){const o=1/ei,p=1/(1<<i.canonical.z),l=(e.x*o+i.canonical.x)*p+i.wrap,f=(e.y*o+i.canonical.y)*p;return{min:new Wt((s.x*o+i.canonical.x)*p+i.wrap,(s.y*o+i.canonical.y)*p),max:new Wt(l,f)}}function ai(s,e,i){const o=1<<i.canonical.z,p=((e.x-i.wrap)*o-i.canonical.x)*ei,l=(e.y*o-i.canonical.y)*ei;return{min:new Wt(((s.x-i.wrap)*o-i.canonical.x)*ei,(s.y*o-i.canonical.y)*ei),max:new Wt(p,l)}}function Ei(s,e,i,o,p,l,f){const w=s.indices,C=s.vertices,O=[];for(let x=o;x<o+p;x+=3){const E=e[i[x+0]+l],k=e[i[x+1]+l],M=e[i[x+2]+l],P=Math.min(E.x,k.x,M.x),R=Math.max(E.x,k.x,M.x),$=Math.min(E.y,k.y,M.y),H=Math.max(E.y,k.y,M.y);O.length=0,s.grid.query(new Wt(P,$),new Wt(R,H),O);for(let J=0;J<O.length;J++){const ee=O[J];if(ut(C[w[3*ee+0]],C[w[3*ee+1]],C[w[3*ee+2]],E,k,M,f))return!0}}return!1}function Zi(s,e,i,o){if(!s||!i)return!1;let p=s.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(i.vertices.length<s.vertices.length)return Zi(i,o,s,e);const l=e.canonical,f=o.canonical,w=Math.pow(2,f.z-l.z);p=s.vertices.map(C=>new Wt((C.x+l.x*ei)*w-f.x*ei,(C.y+l.y*ei)*w-f.y*ei))}return Ei(i,p,s.indices,0,s.indices.length,0,0)}function kr(s,e,i,o){const p=Math.pow(2,o.z-i.z);return new Wt((s+i.x*ei)*p-o.x*ei,(e+i.y*ei)*p-o.y*ei)}function Gi(s,e){const i=[];e.grid.queryPoint(s,i);const o=e.indices,p=e.vertices;for(let l=0;l<i.length;l++){const f=i[l];if(Oe([p[o[3*f+0]],p[o[3*f+1]],p[o[3*f+2]]],s))return!0}return!1}const gr=[new Wt(0,0),new Wt(ei,0),new Wt(ei,ei),new Wt(0,ei)];function Vi(s,e){const i=[];let o=[];if(!e||s.length<2)return[s];if(s.length===2)return Qe(s[0],s[1],gr)?[s]:[];for(let p=0;p<s.length+2;p++){const l=s[p%s.length],f=s[(p+1)%s.length],w=Qe(p===0?s[s.length-1]:s[(p-1)%s.length],l,gr),C=Qe(l,f,gr),O=w||C;O&&o.push(l),O&&C||o.length>0&&(o.length>1&&i.push(o),o=[])}return o.length>1&&i.push(o),i}const Qi=be.VectorTileFeature.types,_r=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],un=["fill-extrusion-flood-light-ground-radius"],kn=Math.pow(2,13),zr=Math.pow(2,15)-1,Gr=new Wt(0,1),Xr=2147483648;function Ms(s,e,i,o,p,l,f,w){s.emplaceBack((e<<1)+f,(i<<1)+l,(Math.floor(o*kn)<<1)+p,Math.round(w))}function ss(s,e,i){s.emplaceBack(e.x*ei,e.y*ei,i?1:0)}function Cs(s,e,i,o,p,l){s.emplaceBack(e.x,e.y,(i.x<<1)+o,(i.y<<1)+p,l)}function os(s,e,i){s.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Xn{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Bs{constructor(){this.centroidXY=new Wt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Wt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Wt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Wt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Pc{constructor(){this.acc=new Wt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,o){this.accCount++,this.acc._add(i);let p=!!this.borders;i.x<e.min.x?(e.min.x=i.x,p=!0):i.x>e.max.x&&(e.max.x=i.x,p=!0),i.y<e.min.y?(e.min.y=i.y,p=!0):i.y>e.max.y&&(e.max.y=i.y,p=!0),((i.x===0||i.x===ei)&&i.x===o.x)!=((i.y===0||i.y===ei)&&i.y===o.y)&&this.processBorderOverlap(i,o),p&&this.checkBorderIntersection(i,o)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Di(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>ei!=e.x>ei&&this.addBorderIntersection(1,Di(i.y,e.y,(ei-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Di(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>ei!=e.y>ei&&this.addBorderIntersection(3,Di(i.x,e.x,(ei-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new Wt(0,0):new Wt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function Cd(s,e){const i=s.add(e)._unit(),o=nr(s.x*i.x+s.y*i.y,-1,1);var p,l,f;return f=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(f)))/4*zr*((p=s).x*(l=e).y-p.y*l.x<0?-1:1)}const em=[s=>s.x<0,s=>s.x>ei,s=>s.y<0,s=>s.y>ei];function Ed(s,e,i,o){const p=[4];if(o===0)return p;i._mult(o);const l=s.sub(i),f=e.sub(i),w=[s,e,l,f];for(let C=0;C<4;C++)for(const O of w)if(em[C](O)){p.push(C);break}return p}class sg{constructor(e){this.vertexArray=new dd,this.indexArray=new gs,this.programConfigurations=new ma(e.layers,{zoom:e.zoom,lut:e.lut},i=>un.includes(i)),this._segments=new Sn,this.hiddenByLandmarkVertexArray=new oo,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Sn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,o,p=!1){const l=e.length;if(l>2){let f=Math.max(0,this._segments.get().length-1);const w=this._segments._prepareSegment(4*l,this.vertexArray.length,2*this._segmentToGroundQuads[f].length);let C;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{const O=e[0],x=e[1];C=Cd(O.sub(e[l-1])._perp()._unit(),x.sub(O)._perp()._unit())}for(let O=0;O<l;O++){const x=O===l-1?0:O+1,E=e[O],k=e[x],M=e[x===l-1?0:x+1],P=k.sub(E)._perp()._unit(),R=Cd(P,M.sub(k)._perp()._unit()),$=C,H=R;if(H0(E,k,i)||p&&gb(E,i)&&gb(k,i)){C=R;continue}const J=w.vertexLength;Cs(this.vertexArray,E,k,1,1,$),Cs(this.vertexArray,E,k,1,0,$),Cs(this.vertexArray,E,k,0,1,H),Cs(this.vertexArray,E,k,0,0,H),w.vertexLength+=4;const ee=Ed(E,k,P,o);for(const Z of ee)this._segmentToGroundQuads[f].push({id:J,region:Z}),this._segmentToRegionTriCounts[f][Z]+=2,w.primitiveLength+=2;C=R}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort((p,l)=>p.region-l.region);for(let o=0;o<i;o++){const p=this._segmentToGroundQuads[o],l=e[o],f=this._segmentToRegionTriCounts[o];f.reduce((C,O)=>C+O,0);let w=0;for(let C=0;C<=4;C++){const O=f[C];if(O!==0){let x=this.regionSegments[C];x||(x=this.regionSegments[C]=new Sn);const E={vertexOffset:l.vertexOffset,primitiveOffset:l.primitiveOffset+w,vertexLength:l.vertexLength,primitiveLength:O};x.get().push(E)}w+=O}for(let C=0;C<p.length;C++){const O=p[C].id;this.indexArray.emplaceBack(O,O+1,O+3),this.indexArray.emplaceBack(O,O+3,O+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,o,p,l,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,o,p,l,f)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,$0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,o,p,l,f,w){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,o,p,l,f,w)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const o=e.flags&Xr?1:0;for(let p=e.groundVertexArrayOffset;p<i;++p)this.hiddenByLandmarkVertexArray.emplace(p,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,v.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Gp{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new gs,this.footprintVertices=new wo,this.footprintSegments=[],this.layoutVertexArray=new tn,this.centroidVertexArray=new So,this.wallVertexArray=new Rl,this.indexArray=new gs,this.programConfigurations=new ma(e.layers,{zoom:e.zoom,lut:e.lut},i=>_r.includes(i)),this.segments=new Sn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new sg(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,o,p){this.features=[],this.hasPattern=ig("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=t(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:l,id:f,index:w,sourceLayerIndex:C}of e){const O=this.layers[0]._featureFilter.needGeometry,x=G(l,O);if(!this.layers[0]._featureFilter.filter(new Vr(this.zoom),x,o))continue;const E={id:f,sourceLayerIndex:C,index:w,geometry:O?x.geometry:j(l,o,p),properties:l.properties,type:l.type,patterns:{}},k=this.layoutVertexArray.length,M=Qi[E.type]==="Polygon";if(this.hasPattern)this.features.push(Hp("fill-extrusion",this.layers,E,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const P of E.geometry)for(const R of Vi(P,M))this.addFeature(E,[R],w,o,{},i.availableImages,p,i.brightness);else this.addFeature(E,E.geometry,w,o,{},i.availableImages,p,i.brightness);i.featureIndex.insert(l,E.geometry,w,C,this.index,k)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,o,p,l,f){for(const w of this.features){const C=Qi[w.type]==="Polygon",{geometry:O}=w;if(this.wallMode)for(const x of O)for(const E of Vi(x,C))this.addFeature(w,[E],w.index,i,o,p,l,f);else this.addFeature(w,O,w.index,i,o,p,l,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,o,p,l,f,w){this.programConfigurations.updatePaintArrays(e,i,l,o,p,f,w),this.groundEffect.update(e,i,l,o,p,f,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,D),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,h.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,S.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Y.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,p,l,f,w,C){const O=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,x=[new Wt(0,0),new Wt(ei,ei)],E=w.projection,k=E.name==="globe",M=this.wallMode||Qi[e.type]==="Polygon",P=new Pc;P.centroidDataIndex=this.centroidData.length;const R=new Bs,$=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},p)<=0,H=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},p);let J;if(R.height=H,R.vertexArrayOffset=this.layoutVertexArray.length,R.groundVertexArrayOffset=this.groundEffect.vertexArray.length,k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ph),this.wallMode){if(k)return void qi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;J=function(Ce){const $e=Ce[0].x===Ce[Ce.length-1].x&&Ce[0].y===Ce[Ce.length-1].y;(function(Ht){let Ut=0;const xi=Ht.length;for(let ui=0;ui<xi;ui++)Ut+=(Ht[(ui+1)%xi].x-Ht[ui].x)*(Ht[(ui+1)%xi].y+Ht[ui].y);return Ut>=0})(Ce)||(Ce=Ce.reverse());const Ge={geometry:[],joinNormals:[],indices:[]},Ze=[],qe=[],et=[];let nt=Ce.length;for(;nt>=2&&Ce[nt-1].equals(Ce[nt-2]);)nt--;if(nt<($e?3:2))return Ge;let ct,it,Et,Nt,Ct,si=0;for(;si<nt-1&&Ce[si].equals(Ce[si+1]);)si++;$e&&(ct=Ce[nt-2],Ct=Ce[si].sub(ct)._unit()._perp());for(let Ht=si;Ht<nt;Ht++){if(Et=Ht===nt-1?$e?Ce[si+1]:void 0:Ce[Ht+1],Et&&Ce[Ht].equals(Et))continue;Ct&&(Nt=Ct),ct&&(it=ct),ct=Ce[Ht],Ct=Et?Et.sub(ct)._unit()._perp():Nt,Nt=Nt||Ct;let Ut=Nt.add(Ct);Ut.x===0&&Ut.y===0||Ut._unit();const xi=Ut.x*Ct.x+Ut.y*Ct.y,ui=xi!==0?1/xi:1/0,mi=Nt.x*Ct.y-Nt.y*Ct.x>0;let Ni="miter";const Ki=2;Ni==="miter"&&ui>Ki&&(Ni="bevel"),Ni==="bevel"&&(ui>100&&(Ni="flipbevel"),ui<Ki&&(Ni="miter"));const er=(tr,cr,ur,nn)=>{const Nr=new Wt(tr.x,tr.y),Hi=new Wt(tr.x,tr.y);Nr.x+=cr.x*nn,Nr.y+=cr.y*nn,Hi.x-=cr.x*Math.max(ur,1),Hi.y-=cr.y*Math.max(ur,1),et.push(cr),Ze.push(Nr),qe.push(Hi)};if(Ni==="miter")Ut._mult(ui),er(ct,Ut,0,0);else if(Ni==="flipbevel")Ut=Ct.mult(-1),er(ct,Ut,0,0),er(ct,Ut.mult(-1),0,0);else{const tr=-Math.sqrt(ui*ui-1),cr=mi?tr:0,ur=mi?0:tr;it&&er(ct,Nt,cr,ur),Et&&er(ct,Ct,cr,ur)}}Ge.geometry=[...Ze,...qe.reverse(),Ze[0]],Ge.joinNormals=[...et,...et.reverse(),et[et.length-1]];const ti=Ge.geometry.length-1;for(let Ht=0;Ht<ti/2;Ht++)if(Ht+1<ti/2){let Ut=Ht,xi=Ht+1,ui=ti-1-Ht,mi=ti-2-Ht;Ut=Ut===0?ti-1:Ut-1,xi=xi===0?ti-1:xi-1,ui=ui===0?ti-1:ui-1,mi=mi===0?ti-1:mi-1,Ge.indices.push(ui),Ge.indices.push(xi),Ge.indices.push(Ut),Ge.indices.push(ui),Ge.indices.push(mi),Ge.indices.push(xi)}return Ge}(i[0]),i=[J.geometry]}const ee=(Ce,$e)=>Ce<($e.length-1)/2||Ce===$e.length-1,Z=this.wallMode?[i]:$p(i,500);for(let Ce=Z.length-1;Ce>=0;Ce--){const $e=Z[Ce];($e.length===0||(ne=$e[0]).every(Ie=>Ie.x<=0)||ne.every(Ie=>Ie.x>=ei)||ne.every(Ie=>Ie.y<=0)||ne.every(Ie=>Ie.y>=ei))&&Z.splice(Ce,1)}var ne;let le;if(k)le=xb(Z,x,p);else{le=[];for(const Ce of Z)le.push({polygon:Ce,bounds:x})}const fe=M?this.edgeRadius:0,Pe=fe>0&&this.zoom<17,Ee=(Ce,$e)=>{if(Ce.length===0)return!1;const Ie=Ce[Ce.length-1];return $e.x===Ie.x&&$e.y===Ie.y};for(const{polygon:Ce,bounds:$e}of le){let Ie=0,Ge=0;for(const nt of Ce)M&&!nt[0].equals(nt[nt.length-1])&&nt.push(nt[0]),Ge+=M?nt.length-1:nt.length;const Ze=this.segments.prepareSegment((M?5:4)*Ge,this.layoutVertexArray,this.indexArray);R.footprintSegIdx<0&&(R.footprintSegIdx=this.footprintSegments.length),R.polygonSegIdx<0&&(R.polygonSegIdx=this.polygonSegments.length);const qe={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},et=new Xn;if(et.vertexOffset=this.footprintVertices.length,et.indexOffset=3*this.footprintIndices.length,et.ringIndices=[],M){const nt=[],ct=[];Ie=Ze.vertexLength;for(let Et=0;Et<Ce.length;Et++){const Nt=Ce[Et];Nt.length&&Et!==0&&ct.push(nt.length/2);const Ct=[];let si,ti;si=Nt[1].sub(Nt[0])._perp()._unit(),et.ringIndices.push(Nt.length-1);for(let Ht=1;Ht<Nt.length;Ht++){const Ut=Nt[Ht],xi=Nt[Ht===Nt.length-1?1:Ht+1],ui=Ut.clone();if(fe){ti=xi.sub(Ut)._perp()._unit();const mi=si.add(ti)._unit(),Ni=fe*Math.min(4,1/(si.x*mi.x+si.y*mi.y));ui.x+=Ni*mi.x,ui.y+=Ni*mi.y,ui.x=Math.round(ui.x),ui.y=Math.round(ui.y),si=ti}if(!$||fe!==0&&!Pe||Ee(Ct,ui)||Ct.push(ui),Ms(this.layoutVertexArray,ui.x,ui.y,0,0,1,1,0),this.wallMode){const mi=ee(Ht,Nt);ss(this.wallVertexArray,J.joinNormals[Ht],!mi)}Ze.vertexLength++,this.footprintVertices.emplaceBack(Ut.x,Ut.y),nt.push(Ut.x,Ut.y),k&&os(this.layoutVertexExtArray,E.projectTilePoint(ui.x,ui.y,p),E.upVector(p,ui.x,ui.y))}$&&(fe===0||Pe)&&(Ct.length!==0&&Ee(Ct,Ct[0])&&Ct.pop(),this.groundEffect.addData(Ct,$e,O))}const it=this.wallMode?J.indices:Sd(nt,ct);for(let Et=0;Et<it.length;Et+=3)this.footprintIndices.emplaceBack(et.vertexOffset+it[Et+0],et.vertexOffset+it[Et+1],et.vertexOffset+it[Et+2]),this.indexArray.emplaceBack(Ie+it[Et],Ie+it[Et+2],Ie+it[Et+1]),Ze.primitiveLength++;et.indexCount+=it.length,et.vertexCount+=this.footprintVertices.length-et.vertexOffset}for(let nt=0;nt<Ce.length;nt++){const ct=Ce[nt];P.startRing(R,ct[0]);let it=ct.length>4&&_b(ct[ct.length-2],ct[0],ct[1]),Et=fe?RM(ct[ct.length-2],ct[0],ct[1],fe):0;const Nt=[];let Ct,si,ti;si=ct[1].sub(ct[0])._perp()._unit();let Ht=!0;for(let Ut=1,xi=0;Ut<ct.length;Ut++){let ui=ct[Ut-1],mi=ct[Ut];const Ni=ct[Ut===ct.length-1?1:Ut+1];if(P.appendEdge(R,mi,ui),H0(mi,ui,$e)){fe&&(si=Ni.sub(mi)._perp()._unit(),Ht=!Ht);continue}const Ki=mi.sub(ui)._perp(),er=Ki.x/(Math.abs(Ki.x)+Math.abs(Ki.y)),tr=Ki.y>0?1:0,cr=ui.dist(mi);if(xi+cr>32768&&(xi=0),fe){ti=Ni.sub(mi)._perp()._unit();let Hi=mb(ui,mi,Ni,fb(si,ti),fe);isNaN(Hi)&&(Hi=0);const Rr=mi.sub(ui)._unit();ui=ui.add(Rr.mult(Et))._round(),mi=mi.add(Rr.mult(-Hi))._round(),Et=Hi,si=ti,$&&this.zoom>=17&&(Ee(Nt,ui)||Nt.push(ui),Ee(Nt,mi)||Nt.push(mi))}const ur=Ze.vertexLength,nn=ct.length>4&&_b(ui,mi,Ni);let Nr=yb(xi,it,Ht);if(Ms(this.layoutVertexArray,ui.x,ui.y,er,tr,0,0,Nr),Ms(this.layoutVertexArray,ui.x,ui.y,er,tr,0,1,Nr),this.wallMode){const Hi=ee(Ut-1,ct),Rr=J.joinNormals[Ut-1];ss(this.wallVertexArray,Rr,Hi),ss(this.wallVertexArray,Rr,Hi)}if(xi+=cr,Nr=yb(xi,nn,!Ht),it=nn,Ms(this.layoutVertexArray,mi.x,mi.y,er,tr,0,0,Nr),Ms(this.layoutVertexArray,mi.x,mi.y,er,tr,0,1,Nr),this.wallMode){const Hi=ee(Ut,ct),Rr=J.joinNormals[Ut];ss(this.wallVertexArray,Rr,Hi),ss(this.wallVertexArray,Rr,Hi)}if(Ze.vertexLength+=4,this.indexArray.emplaceBack(ur+0,ur+1,ur+2),this.indexArray.emplaceBack(ur+1,ur+3,ur+2),Ze.primitiveLength+=2,fe){const Hi=Ie+(Ut===1?ct.length-2:Ut-2),Rr=Ut===1?Ie:Hi+1;if(this.indexArray.emplaceBack(ur+1,Hi,ur+3),this.indexArray.emplaceBack(Hi,Rr,ur+3),Ze.primitiveLength+=2,Ct===void 0&&(Ct=ur),!H0(Ni,ct[Ut],$e)){const Fr=Ut===ct.length-1?Ct:Ze.vertexLength;this.indexArray.emplaceBack(ur+2,ur+3,Fr),this.indexArray.emplaceBack(ur+3,Fr+1,Fr),this.indexArray.emplaceBack(ur+3,Rr,Fr+1),Ze.primitiveLength+=3}Ht=!Ht}if(k){const Hi=this.layoutVertexExtArray,Rr=E.projectTilePoint(ui.x,ui.y,p),Fr=E.projectTilePoint(mi.x,mi.y,p),hn=E.upVector(p,ui.x,ui.y),Zn=E.upVector(p,mi.x,mi.y);os(Hi,Rr,hn),os(Hi,Rr,hn),os(Hi,Fr,Zn),os(Hi,Fr,Zn)}}M&&(Ie+=ct.length-1),$&&fe&&this.zoom>=17&&(Nt.length!==0&&Ee(Nt,Nt[0])&&Nt.pop(),this.groundEffect.addData(Nt,$e,O,fe>0))}this.footprintSegments.push(et),qe.triangleCount=this.indexArray.length-qe.triangleArrayOffset,this.polygonSegments.push(qe),++R.footprintSegLen,++R.polygonSegLen}if(R.vertexCount=this.layoutVertexArray.length-R.vertexArrayOffset,R.groundVertexCount=this.groundEffect.vertexArray.length-R.groundVertexArrayOffset,R.vertexCount!==0){if(R.centroidXY=P.borders?Gr:this.encodeCentroid(P,R),this.centroidData.push(R),P.borders){this.featuresOnBorder.push(P);const Ce=this.featuresOnBorder.length-1;for(let $e=0;$e<P.borders.length;$e++)P.borders[$e][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[$e].push(Ce)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,l,f,p,C),this.groundEffect.addPaintPropertiesData(e,o,l,f,p,C),this.maxHeight=Math.max(this.maxHeight,H)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){const e=[];for(let w=0;w<this.centroidData.length;w++){const C=this.centroidData[w],O=+(C.min.y+C.max.y>ei),x=2*O+(+(C.min.x+C.max.x>ei)^O);for(let E=0;E<C.polygonSegLen;E++){const k=C.polygonSegIdx+E;e.push({centroidIdx:w,subtile:x,polygonSegmentIdx:k,triangleSegmentIdx:this.polygonSegments[k].triangleSegIdx})}}const i=new gs;e.sort((w,C)=>w.triangleSegmentIdx===C.triangleSegmentIdx?w.subtile-C.subtile:w.triangleSegmentIdx-C.triangleSegmentIdx);let o=0,p=0,l=0;for(const w of e){if(w.triangleSegmentIdx!==o)break;l++}const f=e.length;for(;p!==e.length;){o=e[p].triangleSegmentIdx;let w=0,C=p,O=p;for(let x=C;x<l&&e[x].subtile===w;x++)O++;for(;C!==l;){const x=e[C];w=x.subtile;const E=this.centroidData[x.centroidIdx].min.clone(),k=this.centroidData[x.centroidIdx].max.clone(),M={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let P=C;P<O;P++){const R=e[P],$=this.polygonSegments[R.polygonSegmentIdx],H=this.centroidData[R.centroidIdx].min,J=this.centroidData[R.centroidIdx].max,ee=this.indexArray.uint16;for(let Z=$.triangleArrayOffset;Z<$.triangleArrayOffset+$.triangleCount;Z++)i.emplaceBack(ee[3*Z],ee[3*Z+1],ee[3*Z+2]);M.primitiveLength+=$.triangleCount,E.x=Math.min(E.x,H.x),E.y=Math.min(E.y,H.y),k.x=Math.max(k.x,J.x),k.y=Math.max(k.y,J.y)}M.primitiveLength>0&&this.triangleSubSegments.push({segment:M,min:E,max:k}),C=O;for(let P=C;P<l&&e[P].subtile===e[C].subtile;P++)O++}p=l;for(let x=p;x<f&&e[x].triangleSegmentIdx===e[p].triangleSegmentIdx;x++)l++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,o){const p=new Sn;if(this.wallMode){for(const R of this.triangleSubSegments)p.segments.push(R.segment);return p}let l=0,f=0;const w=1<<e.canonical.z;if(i){const R=i.getMinMaxForTile(e);R&&(l=R.min,f=R.max)}f+=this.maxHeight;const C=e.toUnwrapped();let O;const x=[C.canonical.x/w+C.wrap,C.canonical.y/w],E=[(C.canonical.x+1)/w+C.wrap,(C.canonical.y+1)/w],k=(R,$,H)=>[R[0]*(1-H[0])+$[0]*H[0],R[1]*(1-H[1])+$[1]*H[1]],M=[],P=[];for(const R of this.triangleSubSegments){M[0]=R.min.x/ei,M[1]=R.min.y/ei,P[0]=R.max.x/ei,P[1]=R.max.y/ei;const $=k(x,E,M),H=k(x,E,P);if(new bi([$[0],$[1],l],[H[0],H[1],f]).intersectsPrecise(o)===0){O&&(p.segments.push(O),O=void 0);continue}const J=R.segment;O&&O.vertexOffset!==J.vertexOffset&&(p.segments.push(O),O=void 0),O?(O.vertexLength+=J.vertexLength,O.primitiveLength+=J.primitiveLength):O={vertexOffset:J.vertexOffset,primitiveLength:J.primitiveLength,vertexLength:J.vertexLength,primitiveOffset:J.primitiveOffset,sortKey:void 0,vaos:{}}}return O&&p.segments.push(O),p}encodeCentroid(e,i){const o=e.centroid(),p=i.span(),l=Math.min(7,Math.round(p.x*this.tileToMeter/10)),f=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new Wt(nr(o.x,1,ei-1)<<3|l,nr(o.y,1,ei-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new Wt(0,0);const i=e.borders,o=Number.MAX_VALUE;if(i[0][0]!==o||i[1][0]!==o){const p=i[0][0]!==o?0:1;return new Wt(6|(i[0][0]!==o?0:65528),(i[p][0]+i[p][1])/2<<3|6)}{const p=i[2][0]!==o?2:3;return new Wt((i[p][0]+i[p][1])/2<<3|6,6|(i[2][0]!==o?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=Xr,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,p=e.flags&Xr?Gr:e.centroidXY,l=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==p.y||l!==p.x){for(let f=i;f<o;++f)this.centroidVertexArray.emplace(f,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,o){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const p=i.getReplacementRegionsForTile(e.toUnwrapped());if(gi(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const l=[];for(const f of this.activeReplacements){if(f.order<o)continue;const w=Math.max(1,Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z));for(const C of this.centroidData)if(!(C.flags&Xr||f.min.x>C.max.x||C.min.x>f.max.x||f.min.y>C.max.y||C.min.y>f.max.y))for(let O=0;O<C.footprintSegLen;O++){const x=this.footprintSegments[C.footprintSegIdx+O];if(l.length=0,zM(this.footprintVertices,x.vertexOffset,x.vertexCount,f.footprintTileId.canonical,e.canonical,l),Ei(f.footprint,l,this.footprintIndices.uint16,x.indexOffset,x.indexCount,-x.vertexOffset,-w)){C.flags|=Xr;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,o){let p=!1;for(let l=0;l<o.footprintSegLen;l++){const f=this.footprintSegments[o.footprintSegIdx+l];let w=0;for(const C of f.ringIndices){for(let O=w,x=C+w-1;O<C+w;x=O++){const E=this.footprintVertices.int16[2*(O+f.vertexOffset)+0],k=this.footprintVertices.int16[2*(O+f.vertexOffset)+1],M=this.footprintVertices.int16[2*(x+f.vertexOffset)+1];k>i!=M>i&&e<(this.footprintVertices.int16[2*(x+f.vertexOffset)+0]-E)*(i-k)/(M-k)+E&&(p=!p)}w=C}}return p}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,p=!0;const l=4*(e+ei)*ei+(i+ei);if(this.partLookup.hasOwnProperty(l)){const f=this.partLookup[l];return f?{height:f.height,hidden:!!(f.flags&Xr)}:void 0}for(const f of this.centroidData)e>f.max.x||f.min.x>e||i>f.max.y||f.min.y>i||this.footprintContainsPoint(e,i,f)&&f&&f.height>o&&(o=f.height,this.partLookup[l]=f,p=!!(f.flags&Xr));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:p};this.partLookup[l]=void 0}}function fb(s,e){const i=s.add(e)._unit();return s.x*i.x+s.y*i.y}function RM(s,e,i,o){const p=e.sub(s)._perp()._unit(),l=i.sub(e)._perp()._unit();return mb(s,e,i,fb(p,l),o)}function mb(s,e,i,o,p){const l=Math.sqrt(1-o*o);return Math.min(s.dist(e)/3,e.dist(i)/3,p*l/o)}function H0(s,e,i){return s.x<i[0].x&&e.x<i[0].x||s.x>i[1].x&&e.x>i[1].x||s.y<i[0].y&&e.y<i[0].y||s.y>i[1].y&&e.y>i[1].y}function gb(s,e){return s.x<e[0].x||s.x>e[1].x||s.y<e[0].y||s.y>e[1].y}function _b(s,e,i){if(s.x<0||s.x>=ei||e.x<0||e.x>=ei||i.x<0||i.x>=ei)return!1;const o=i.sub(e),p=o.perp(),l=s.sub(e);return(o.x*l.x+o.y*l.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(l.x*l.x+l.y*l.y))>-.866&&p.x*l.x+p.y*l.y<0}function yb(s,e,i){const o=e?2|s:-3&s;return i?1|o:-2&o}function vb(){const s=Math.PI/32,e=Math.tan(s),i=Cc;return i*Math.sqrt(1+2*e*e)-i}function xb(s,e,i){const o=1<<i.z,p=co(i.x/o),l=co((i.x+1)/o),f=Wn(i.y/o),w=Wn((i.y+1)/o);return function(C,O,x,E,k=0,M){const P=[];if(!C.length||!x||!E)return P;const R=(le,fe)=>{for(const Pe of le)P.push({polygon:Pe,bounds:fe})},$=Math.ceil(Math.log2(x)),H=Math.ceil(Math.log2(E)),J=$-H,ee=[];for(let le=0;le<Math.abs(J);le++)ee.push(J>0?0:1);for(let le=0;le<Math.min($,H);le++)ee.push(0),ee.push(1);let Z=C;if(Z=ze(Z,O[0].y-k,O[1].y+k,1),Z=ze(Z,O[0].x-k,O[1].x+k,0),!Z.length)return P;const ne=[];for(ee.length?ne.push({polygons:Z,bounds:O,depth:0}):R(Z,O);ne.length;){const le=ne.pop(),fe=le.depth,Pe=ee[fe],Ee=le.bounds[0],Ce=le.bounds[1],$e=Pe===0?Ee.x:Ee.y,Ie=Pe===0?Ce.x:Ce.y,Ge=M?M(Pe,$e,Ie):.5*($e+Ie),Ze=ze(le.polygons,$e-k,Ge+k,Pe),qe=ze(le.polygons,Ge-k,Ie+k,Pe);if(Ze.length){const et=[Ee,new Wt(Pe===0?Ge:Ce.x,Pe===1?Ge:Ce.y)];ee.length>fe+1?ne.push({polygons:Ze,bounds:et,depth:fe+1}):R(Ze,et)}if(qe.length){const et=[new Wt(Pe===0?Ge:Ee.x,Pe===1?Ge:Ee.y),Ce];ee.length>fe+1?ne.push({polygons:qe,bounds:et,depth:fe+1}):R(qe,et)}}return P}(s,e,Math.ceil((l-p)/11.25),Math.ceil((f-w)/11.25),1,(C,O,x)=>{if(C===0)return .5*(O+x);{const E=Wn((i.y+O/ei)/o);return(ya(.5*(Wn((i.y+x/ei)/o)+E))*o-i.y)*ei}})}function zM(s,e,i,o,p,l){const f=Math.pow(2,o.z-p.z);for(let w=0;w<i;w++){let C=s.int16[2*(w+e)+0],O=s.int16[2*(w+e)+1];C=(C+p.x*ei)*f-o.x*ei,O=(O+p.y*ei)*f-o.y*ei,l.push(new Wt(C,O))}}let bb,wb;function og(s,e){return s.x*e.x+s.y*e.y}function Sb(s,e){if(s.length===1){let i=0;const o=e[i++];let p;for(;!p||o.equals(p);)if(p=e[i++],!p)return 1/0;for(;i<e.length;i++){const l=e[i],f=s[0],w=p.sub(o),C=l.sub(o),O=f.sub(o),x=og(w,w),E=og(w,C),k=og(C,C),M=og(O,w),P=og(O,C),R=x*k-E*E,$=(k*M-E*P)/R,H=(x*P-E*M)/R,J=o.z*(1-$-H)+p.z*$+l.z*H;if(isFinite(J))return J}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}function Tb(s,e,i,o,p,l,f,w){const C=f*p.getElevationAt(s,e,!0,!0),O=l[0]!==0,x=O?l[1]===0?f*(l[0]/7-450):f*function(E,k,M){const P=Math.floor(k[0]/8),R=Math.floor(k[1]/8),$=10*(k[0]-8*P),H=10*(k[1]-8*R),J=E.getElevationAt(P,R,!0,!0),ee=E.getMeterToDEM(M),Z=Math.floor(.5*($*ee-1)),ne=Math.floor(.5*(H*ee-1)),le=E.tileCoordToPixel(P,R),fe=2*Z+1,Pe=2*ne+1,Ee=function(qe,et,nt,ct,it){return[qe.getElevationAtPixel(et,nt,!0),qe.getElevationAtPixel(et+it,nt,!0),qe.getElevationAtPixel(et,nt+it,!0),qe.getElevationAtPixel(et+ct,nt+it,!0)]}(E,le.x-Z,le.y-ne,fe,Pe),Ce=Math.abs(Ee[0]-Ee[1]),$e=Math.abs(Ee[2]-Ee[3]),Ie=Math.abs(Ee[0]-Ee[2])+Math.abs(Ee[1]-Ee[3]),Ge=Math.min(.25,.5*ee*(Ce+$e)/fe),Ze=Math.min(.25,.5*ee*Ie/Pe);return J+Math.max(Ge*$,Ze*H)}(p,l,w):C;return{base:C+(i===0?-1:i),top:O?Math.max(x+o,C+i+2):C+o}}_i(Gp,"FillExtrusionBucket",{omit:["layers","features"]}),_i(Bs,"PartData"),_i(Xn,"FootprintSegment"),_i(Pc,"BorderCentroidData"),_i(sg,"GroundEffect");const FM=Dr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),BM=Dr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:NM}=FM,VM=Dr([{name:"a_packed",components:3,type:"Float32"}]),{members:UM}=VM,jM=Dr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:$M}=jM;class Mb{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Vl({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const o=this.getKey(e,i);return this.positions[o]}trim(){const e=this.width,i=this.height=Nc(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){const p=[];let l=e.length%2==1?-e[e.length-1]*o:0,f=e[0]*o,w=!0;p.push({left:l,right:f,isDash:w,zeroLength:e[0]===0});let C=e[0];for(let O=1;O<e.length;O++){w=!w;const x=e[O];l=C*o,C+=x,f=C*o,p.push({left:l,right:f,isDash:w,zeroLength:x===0})}return p}addRoundDash(e,i,o){const p=i/2;for(let l=-o;l<=o;l++){const f=this.width*(this.nextRow+o+l);let w=0,C=e[w];for(let O=0;O<this.width;O++){O/C.right>1&&(C=e[++w]);const x=Math.abs(O-C.left),E=Math.abs(O-C.right),k=Math.min(x,E);let M;const P=l/o*(p+1);if(C.isDash){const R=p-Math.abs(P);M=Math.sqrt(k*k+R*R)}else M=p-Math.sqrt(k*k+P*P);this.image.data[f+O]=Math.max(0,Math.min(255,M+128))}}}addRegularDash(e,i){for(let C=e.length-1;C>=0;--C){const O=e[C],x=e[C+1];O.zeroLength?e.splice(C,1):x&&x.isDash===O.isDash&&(x.left=O.left,e.splice(C,1))}const o=e[0],p=e[e.length-1];o.isDash===p.isDash&&(o.left=p.left-this.width,p.right=o.right+this.width);const l=this.width*this.nextRow;let f=0,w=e[f];for(let C=0;C<this.width;C++){C/w.right>1&&(w=e[++f]);const O=Math.abs(C-w.left),x=Math.abs(C-w.right),E=Math.min(O,x);this.image.data[l+C]=Math.max(0,Math.min(255,(w.isDash?E:-E)+i+128))}}addDash(e,i){const o=this.getKey(e,i);if(this.positions[o])return this.positions[o];const p=i==="round",l=p?7:0,f=2*l+1;if(this.nextRow+f>this.height)return qi("LineAtlas out of space"),null;e.length===0&&e.push(1);let w=0;for(let x=0;x<e.length;x++)e[x]<0&&(qi("Negative value is found in line dasharray, replacing values with 0"),e[x]=0),w+=e[x];if(w!==0){const x=this.width/w,E=this.getDashRanges(e,this.width,x);p?this.addRoundDash(E,x,l):this.addRegularDash(E,i==="square"?.5*x:0)}const C=this.nextRow+l;this.nextRow+=f;const O={tl:[C,l],br:[w,0]};return this.positions[o]=O,O}}_i(Mb,"LineAtlas");const HM=be.VectorTileFeature.types,GM=Math.cos(Math.PI/180*37.5),WM=Math.cos(Math.PI/180*5);class G0{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new xu,this.layoutVertexArray2=new ha,this.patternVertexArray=new ha,this.indexArray=new gs,this.programConfigurations=new ma(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Sn,this.maxLineLength=0,this.zOffsetVertexArray=new ha,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:ei/64}updateFootprints(e,i){}populate(e,i,o,p){this.hasPattern=ig("line",this.layers,this.pixelRatio,i);const l=this.layers[0].layout.get("line-sort-key");this.tileToMeter=t(o);const f=this.layers[0].layout.get("line-z-offset"),w=f.isConstant()&&!f.constantOr(0),C=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=C==="sea"||C==="ground"||!w&&C==="none",this.hasZOffset&&C==="none"&&qi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const O=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&O!==void 0;const x=[];for(const{feature:P,id:R,index:$,sourceLayerIndex:H}of e){const J=this.layers[0]._featureFilter.needGeometry,ee=G(P,J);if(!this.layers[0]._featureFilter.filter(new Vr(this.zoom),ee,o))continue;const Z=l?l.evaluate(ee,{},o):void 0,ne={id:R,properties:P.properties,type:P.type,sourceLayerIndex:H,index:$,geometry:J?ee.geometry:j(P,o,p),patterns:{},sortKey:Z};x.push(ne)}l&&x.sort((P,R)=>P.sortKey-R.sortKey);const{lineAtlas:E,featureIndex:k}=i,M=this.addConstantDashes(E);for(const P of x){const{geometry:R,index:$,sourceLayerIndex:H}=P;if(M&&this.addFeatureDashes(P,E),this.hasPattern){const J=Hp("line",this.layers,P,this.zoom,this.pixelRatio,i);this.patternFeatures.push(J)}else this.addFeature(P,R,$,o,E.positions,i.availableImages,i.brightness);k.insert(e[$].feature,R,$,H,this.index)}}addConstantDashes(e){let i=!1;for(const o of this.layers){const p=o.paint.get("line-dasharray").value,l=o.layout.get("line-cap").value;if(p.kind!=="constant"||l.kind!=="constant")i=!0;else{const f=l.value,w=p.value;if(!w)continue;e.addDash(w,f)}}return i}addFeatureDashes(e,i){const o=this.zoom;for(const p of this.layers){const l=p.paint.get("line-dasharray").value,f=p.layout.get("line-cap").value;if(l.kind==="constant"&&f.kind==="constant")continue;let w,C;if(l.kind==="constant"){if(w=l.value,!w)continue}else w=l.evaluate({zoom:o},e);C=f.kind==="constant"?f.value:f.evaluate({zoom:o},e),i.addDash(w,C),e.patterns[p.id]=i.getKey(w,C)}}update(e,i,o,p,l,f,w){this.programConfigurations.updatePaintArrays(e,i,l,o,p,f,w)}addFeatures(e,i,o,p,l,f){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,i,o,p,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,UM)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,$M)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,BM.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,NM),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,p,l,f,w){const C=this.layers[0].layout,O=C.get("line-join").evaluate(e,{}),x=C.get("line-cap").evaluate(e,{}),E=C.get("line-miter-limit"),k=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=C.get("line-z-offset").value;const M=this.layers[0].paint.get("line-width").value;M.kind!=="constant"&&M.isLineProgressConstant===!1&&(this.variableWidthValue=M);for(const P of i)this.addLine(P,e,p,O,x,E,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,l,f,p,w)}addLine(e,i,o,p,l,f,w){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const C=p==="none";if(this.patternJoinNone=this.hasPattern&&C,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<e.length-1;ee++)this.totalDistance+=e[ee].dist(e[ee+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const O=HM[i.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let E=0;for(;E<x-1&&e[E].equals(e[E+1]);)E++;if(x<(O?3:2))return;p==="bevel"&&(f=1.05);const k=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let M,P,R,$,H,J;this.e1=this.e2=-1,O&&(M=e[x-2],H=e[E].sub(M)._unit()._perp());for(let ee=E;ee<x;ee++){if(R=ee===x-1?O?e[E+1]:void 0:e[ee+1],R&&e[ee].equals(R))continue;H&&($=H),M&&(P=M),M=e[ee],J=this.evaluateLineProgressFeatures(P?P.dist(M):0),H=R?R.sub(M)._unit()._perp():$,$=$||H;const Z=P&&R;let ne=Z?p:O||C?"butt":l;const le=$.x*H.x+$.y*H.y;if(C){const Ze=function(qe){if(qe.patternJoinNone){const et=qe.segmentPoints.length/2,nt=qe.lineSoFar-qe.segmentStart;for(let ct=0;ct<et;++ct){const it=qe.segmentPoints[2*ct+1],Et=Math.round(qe.segmentPoints[2*ct])+.5+.25*it;qe.patternVertexArray.emplaceBack(Et,nt,qe.segmentStart),qe.patternVertexArray.emplaceBack(Et,nt,qe.segmentStart)}qe.segmentPoints.length=0}qe.e1=qe.e2=-1};if(Z&&le<WM){this.updateDistance(P,M),this.addCurrentVertex(M,$,1,1,k,J),Ze(this),this.addCurrentVertex(M,H,-1,-1,k,J);continue}if(P){if(!R){this.updateDistance(P,M),this.addCurrentVertex(M,$,1,1,k,J),Ze(this);continue}ne="miter"}}let fe=$.add(H);fe.x===0&&fe.y===0||fe._unit();const Pe=fe.x*H.x+fe.y*H.y,Ee=Pe!==0?1/Pe:1/0,Ce=2*Math.sqrt(2-2*Pe),$e=Pe<GM&&P&&R,Ie=$.x*H.y-$.y*H.x>0,Ge=this.overscaling<=16?15*ei/(512*this.overscaling):0;if(Z&&ne==="round"){if(Ee<w)ne="miter";else if(Ee<=2){const Ze=W0(M,-10,ei+10);ne=this.hasZOffset&&(Ze||this.hasCrossSlope)?"miter":"fakeround"}}if(ne==="miter"&&Ee>f&&(ne="bevel"),ne==="bevel"&&(Ee>2&&(ne="flipbevel"),Ee<f&&(ne="miter")),P&&!(ne==="miter"&&$e)&&this.updateDistance(P,M),ne==="miter")if($e){const Ze=M.dist(P);if(Ze>2*Ge){const et=M.sub(M.sub(P)._mult(Ge/Ze)._round());this.updateDistance(P,et),this.addCurrentVertex(et,$,0,0,k,J),P=et}this.updateDistance(P,M),fe._mult(Ee),this.addCurrentVertex(M,fe,0,0,k,J);const qe=M.dist(R);if(qe>2*Ge){const et=M.add(R.sub(M)._mult(Ge/qe)._round());this.updateDistance(M,et),this.addCurrentVertex(et,H,0,0,k,J),M=et}}else fe._mult(Ee),this.addCurrentVertex(M,fe,0,0,k,J);else if(ne==="flipbevel"){if(Ee>100)fe=H.mult(-1);else{const Ze=Ee*$.add(H).mag()/$.sub(H).mag();fe._perp()._mult(Ze*(Ie?-1:1))}this.addCurrentVertex(M,fe,0,0,k,J),this.addCurrentVertex(M,fe.mult(-1),0,0,k,J)}else if(ne==="bevel"||ne==="fakeround"){J!=null&&P&&this.addCurrentVertex(M,$,-1,-1,k,J);const Ze=M.dist(P)<=2*Ge&&ne!=="bevel",qe=fe.mult(Ie?1:-1);qe._mult(Ee);const et=H.mult(Ie?-1:1),nt=$.mult(Ie?-1:1),ct=this.evaluateLineProgressFeatures(this.distance);if(J==null&&(this.addHalfVertex(M,qe.x,qe.y,!1,!Ie,0,k,ct),Ze||this.addHalfVertex(M,qe.x+2*nt.x,qe.y+2*nt.y,!1,Ie,0,k,ct)),ne==="fakeround"){const it=Math.round(180*Ce/Math.PI/20);this.addHalfVertex(M,nt.x,nt.y,!1,Ie,0,k,ct);for(let Et=0;Et<it;Et++){let Nt=Et/it;if(Nt!==.5){const si=Nt-.5;Nt+=Nt*si*(Nt-1)*((1.0904+le*(le*(3.55645-1.43519*le)-3.2452))*si*si+(.848013+le*(.215638*le-1.06021)))}const Ct=et.sub(nt)._mult(Nt)._add(nt)._unit();this.addHalfVertex(M,Ct.x,Ct.y,!1,Ie,0,k,ct)}this.addHalfVertex(M,et.x,et.y,!1,Ie,0,k,ct)}Ze||J!=null||this.addHalfVertex(M,qe.x+2*et.x,qe.y+2*et.y,!1,Ie,0,k,ct),J!=null&&R&&this.addCurrentVertex(M,H,1,1,k,J)}else ne==="butt"?this.addCurrentVertex(M,fe,0,0,k,J):ne==="square"?(P||this.addCurrentVertex(M,fe,-1,-1,k,J),this.addCurrentVertex(M,fe,0,0,k,J),P&&this.addCurrentVertex(M,fe,1,1,k,J)):ne==="round"&&(P&&(this.addCurrentVertex(M,$,0,0,k,J),this.addCurrentVertex(M,$,1,1,k,J,!0)),R&&(this.addCurrentVertex(M,H,-1,-1,k,J,!0),this.addCurrentVertex(M,H,0,0,k,J)))}}addVerticesTo(e,i,o,p,l,f,w,C,O,x){const E=(i.w-e.w)/this.tessellationStep|0;let k=0;const M=this.scaledDistance;if(E>1){this.lineSoFar=e.w;const R=(i.x-e.x)/E,$=(i.y-e.y)/E,H=(i.z-e.z)/E,J=(i.w-e.w)/E;for(let ee=1;ee<E;++ee){e.x+=R,e.y+=$,e.z+=H,this.lineSoFar+=J,k+=J;const Z=this.evaluateLineProgressFeatures(this.prevDistance+k);this.scaledDistance=(this.prevDistance+k)/this.totalDistance,this.addHalfVertex(e,o,p,x,!1,w,O,Z),this.addHalfVertex(e,l,f,x,!0,-C,O,Z)}}this.lineSoFar=i.w,this.scaledDistance=M;const P=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,o,p,x,!1,w,O,P),this.addHalfVertex(i,l,f,x,!0,-C,O,P)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):qi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}:{zOffset:0,variableWidth:i}}addCurrentVertex(e,i,o,p,l,f,w=!1){const C=i.x+i.y*o,O=i.y-i.x*o,x=i.y*p-i.x,E=-i.y-i.x*p;if(f!=null){const k=this.hasZOffset,M=-10,P=ei+10,R=f.zOffset,$=new Fe(e.x,e.y,R,this.lineSoFar),H=!!k&&W0(e,M,P),J=this.lineSoFar,ee=this.distance;if(this.currentVertex)if(H){const Z=this.currentVertexIsOutside,ne=this.currentVertex,le=new Fe(e.x,e.y,R,this.lineSoFar);if(St(ne,le,M,P),!W0(le,M,P)){if(Z){this.e1=this.e2=-1,this.distance-=ne.dist($),this.lineSoFar=ne.w;const fe=this.evaluateLineProgressFeatures(ne.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ne,C,O,w,!1,o,l,fe),this.addHalfVertex(ne,x,E,w,!0,-p,l,fe),this.prevDistance=this.distance}this.distance=this.prevDistance+ne.dist(le),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ne,le,C,O,x,E,o,p,l,w),this.distance=ee,this.scaledDistance=this.distance/this.totalDistance}}else{const Z=this.currentVertex;if(this.currentVertexIsOutside){St(Z,$,M,P),this.e1=this.e2=-1,this.distance-=Z.dist($),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Z.w;const ne=this.evaluateLineProgressFeatures(Z.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Z,C,O,w,!1,o,l,ne),this.addHalfVertex(Z,x,E,w,!0,-p,l,ne),this.prevDistance=this.distance,this.distance=ee,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Z,$,C,O,x,E,o,p,l,w)}else H||(this.addHalfVertex(e,C,O,w,!1,o,l,f),this.addHalfVertex(e,x,E,w,!0,-p,l,f));this.currentVertex=$,this.currentVertexIsOutside=H,this.lineSoFar=J}else this.addHalfVertex(e,C,O,w,!1,o,l,f),this.addHalfVertex(e,x,E,w,!0,-p,l,f)}addHalfVertex({x:e,y:i},o,p,l,f,w,C,O){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),f||this.segmentPoints.push(this.lineSoFar-this.segmentStart,w)),this.layoutVertexArray.emplaceBack((e<<1)+(l?1:0),(i<<1)+(f?1:0),Math.round(63*o)+128,Math.round(63*p)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const E=Di(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,E)}const x=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),C.primitiveLength++),f?this.e2=x:this.e1=x,O!=null&&this.zOffsetVertexArray.emplaceBack(O.zOffset,O.variableWidth,O.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function W0(s,e,i){return s.x<e||s.x>i||s.y<e||s.y>i}let Cb,Eb;function Ab(s,e,i){return e*(ei/(s.tileSize*Math.pow(2,i-s.tileID.overscaledZ)))}_i(G0,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Pb=(s,e,i)=>(1-i)*s+i*e;function Db(s,e){return 1/Ab(s,1,e.tileZoom)}function Ib(s,e,i,o){return s.translatePosMatrix(o||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const kb=s=>{const e=[];Ob(s)&&e.push("RENDER_LINE_DASH"),s.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=s.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),s.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const o=s.layout.get("line-join").constantOr("miter")==="none",p=!!s.paint.get("line-pattern").constantOr(1);return o&&p&&e.push("LINE_JOIN_NONE"),e};function Ob(s){const e=s.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let q0;const Lb=()=>q0||(q0={layout:Cb||(Cb=new on({"line-cap":new li(dt.layout_line["line-cap"]),"line-join":new li(dt.layout_line["line-join"]),"line-miter-limit":new Gt(dt.layout_line["line-miter-limit"]),"line-round-limit":new Gt(dt.layout_line["line-round-limit"]),"line-sort-key":new li(dt.layout_line["line-sort-key"]),"line-z-offset":new li(dt.layout_line["line-z-offset"]),"line-elevation-reference":new Gt(dt.layout_line["line-elevation-reference"]),"line-cross-slope":new Gt(dt.layout_line["line-cross-slope"]),visibility:new Gt(dt.layout_line.visibility),"line-width-unit":new Gt(dt.layout_line["line-width-unit"])})),paint:Eb||(Eb=new on({"line-opacity":new li(dt.paint_line["line-opacity"]),"line-color":new li(dt.paint_line["line-color"]),"line-translate":new Gt(dt.paint_line["line-translate"]),"line-translate-anchor":new Gt(dt.paint_line["line-translate-anchor"]),"line-width":new li(dt.paint_line["line-width"]),"line-gap-width":new li(dt.paint_line["line-gap-width"]),"line-offset":new li(dt.paint_line["line-offset"]),"line-blur":new li(dt.paint_line["line-blur"]),"line-dasharray":new li(dt.paint_line["line-dasharray"]),"line-pattern":new li(dt.paint_line["line-pattern"]),"line-gradient":new Ka(dt.paint_line["line-gradient"]),"line-trim-offset":new Gt(dt.paint_line["line-trim-offset"]),"line-trim-fade-range":new Gt(dt.paint_line["line-trim-fade-range"]),"line-trim-color":new Gt(dt.paint_line["line-trim-color"]),"line-emissive-strength":new Gt(dt.paint_line["line-emissive-strength"]),"line-border-width":new li(dt.paint_line["line-border-width"]),"line-border-color":new li(dt.paint_line["line-border-color"]),"line-occlusion-opacity":new Gt(dt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},q0);class qM extends li{possiblyEvaluate(e,i){return i=new Vr(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,p){return i=Zs({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,p)}}let ag;function Rb(s,e){return e>0?e+2*s:s}const YM=Dr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),XM=Dr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ZM=Dr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Dr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const KM=Dr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),JM=Dr([{name:"a_texb",components:2,type:"Uint16"}]),QM=Dr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),eC=Dr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Dr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const zb=Dr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),tC=Dr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Dr([{name:"triangle",components:3,type:"Uint16"}]),Dr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Dr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Dr([{type:"Float32",name:"offsetX"}]),Dr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var po=24;const Dc=128;function Y0(s,e,i,o,p){if(s.kind==="camera")return s.maxSize;if(s.kind==="composite"){const l=e.possiblyEvaluate(new Vr(s.maxZoom),i).evaluate(p,{},i),f=e.possiblyEvaluate(new Vr(s.minZoom),i).evaluate(p,{},i);return Math.max(l,f)}return e.possiblyEvaluate(new Vr(o)).evaluate(p,{},i)}function X0(s,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Vr(s+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:p}=i;let l=0;for(;l<o.length&&o[l]<=s;)l++;l=Math.max(0,l-1);let f=l;for(;f<o.length&&o[f]<s+1;)f++;f=Math.min(o.length-1,f);const w=o[l],C=o[f];return i.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:C,interpolationType:p}:{kind:"camera",minZoom:w,maxZoom:C,minSize:i.evaluate(new Vr(w)),maxSize:i.evaluate(new Vr(C)),interpolationType:p}}}function I_(s,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:p}){return s.kind==="source"?o/Dc:s.kind==="composite"?Di(o/Dc,p/Dc,i):e}function tm(s,e,i=1){let o=0,p=0;if(s.kind==="constant")p=s.layoutSize*i;else if(s.kind!=="source"){const{interpolationType:l,minZoom:f,maxZoom:w}=s,C=l?nr(vo.interpolationFactor(l,e,f,w),0,1):0;s.kind==="camera"?p=Di(s.minSize,s.maxSize,C)*i:o=C*i}return{uSizeT:o,uSize:p}}var iC=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Dc,evaluateSizeForFeature:I_,evaluateSizeForZoom:tm,getRasterizedIconSize:Y0,getSizeData:X0});function rC(s,e,i){return s.sections.forEach(o=>{o.text=function(p,l,f){const w=l.layout.get("text-transform").evaluate(f,{});return w==="uppercase"?p=p.toLocaleUpperCase():w==="lowercase"&&(p=p.toLocaleLowerCase()),Qs.applyArabicShaping&&(p=Qs.applyArabicShaping(p)),p}(o.text,e,i)}),s}const lg={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function nC(s){return s==="︶"||s==="﹈"||s==="︸"||s==="﹄"||s==="﹂"||s==="︾"||s==="︼"||s==="︺"||s==="︘"||s==="﹀"||s==="︐"||s==="︓"||s==="︔"||s==="｀"||s==="￣"||s==="︑"||s==="︒"}function sC(s){return s==="︵"||s==="﹇"||s==="︷"||s==="﹃"||s==="﹁"||s==="︽"||s==="︻"||s==="︹"||s==="︗"||s==="︿"}var Fb,Z0,Bb,K0={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function oC(){return Fb||(Fb=1,K0.read=function(s,e,i,o,p){var l,f,w=8*p-o-1,C=(1<<w)-1,O=C>>1,x=-7,E=i?p-1:0,k=i?-1:1,M=s[e+E];for(E+=k,l=M&(1<<-x)-1,M>>=-x,x+=w;x>0;l=256*l+s[e+E],E+=k,x-=8);for(f=l&(1<<-x)-1,l>>=-x,x+=o;x>0;f=256*f+s[e+E],E+=k,x-=8);if(l===0)l=1-O;else{if(l===C)return f?NaN:1/0*(M?-1:1);f+=Math.pow(2,o),l-=O}return(M?-1:1)*f*Math.pow(2,l-o)},K0.write=function(s,e,i,o,p,l){var f,w,C,O=8*l-p-1,x=(1<<O)-1,E=x>>1,k=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,M=o?0:l-1,P=o?1:-1,R=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(w=isNaN(e)?1:0,f=x):(f=Math.floor(Math.log(e)/Math.LN2),e*(C=Math.pow(2,-f))<1&&(f--,C*=2),(e+=f+E>=1?k/C:k*Math.pow(2,1-E))*C>=2&&(f++,C/=2),f+E>=x?(w=0,f=x):f+E>=1?(w=(e*C-1)*Math.pow(2,p),f+=E):(w=e*Math.pow(2,E-1)*Math.pow(2,p),f=0));p>=8;s[i+M]=255&w,M+=P,w/=256,p-=8);for(f=f<<p|w,O+=p;O>0;s[i+M]=255&f,M+=P,f/=256,O-=8);s[i+M-P]|=128*R}),K0}function Nb(){if(Bb)return Z0;Bb=1,Z0=e;var s=oC();function e(Z){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(Z)?Z:new Uint8Array(Z||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,o=1/i,p=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function l(Z){return Z.type===e.Bytes?Z.readVarint()+Z.pos:Z.pos+1}function f(Z,ne,le){return le?4294967296*ne+(Z>>>0):4294967296*(ne>>>0)+(Z>>>0)}function w(Z,ne,le){var fe=ne<=16383?1:ne<=2097151?2:ne<=268435455?3:Math.floor(Math.log(ne)/(7*Math.LN2));le.realloc(fe);for(var Pe=le.pos-1;Pe>=Z;Pe--)le.buf[Pe+fe]=le.buf[Pe]}function C(Z,ne){for(var le=0;le<Z.length;le++)ne.writeVarint(Z[le])}function O(Z,ne){for(var le=0;le<Z.length;le++)ne.writeSVarint(Z[le])}function x(Z,ne){for(var le=0;le<Z.length;le++)ne.writeFloat(Z[le])}function E(Z,ne){for(var le=0;le<Z.length;le++)ne.writeDouble(Z[le])}function k(Z,ne){for(var le=0;le<Z.length;le++)ne.writeBoolean(Z[le])}function M(Z,ne){for(var le=0;le<Z.length;le++)ne.writeFixed32(Z[le])}function P(Z,ne){for(var le=0;le<Z.length;le++)ne.writeSFixed32(Z[le])}function R(Z,ne){for(var le=0;le<Z.length;le++)ne.writeFixed64(Z[le])}function $(Z,ne){for(var le=0;le<Z.length;le++)ne.writeSFixed64(Z[le])}function H(Z,ne){return(Z[ne]|Z[ne+1]<<8|Z[ne+2]<<16)+16777216*Z[ne+3]}function J(Z,ne,le){Z[le]=ne,Z[le+1]=ne>>>8,Z[le+2]=ne>>>16,Z[le+3]=ne>>>24}function ee(Z,ne){return(Z[ne]|Z[ne+1]<<8|Z[ne+2]<<16)+(Z[ne+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(Z,ne,le){for(le=le||this.length;this.pos<le;){var fe=this.readVarint(),Pe=fe>>3,Ee=this.pos;this.type=7&fe,Z(Pe,ne,this),this.pos===Ee&&this.skip(fe)}return ne},readMessage:function(Z,ne){return this.readFields(Z,ne,this.readVarint()+this.pos)},readFixed32:function(){var Z=H(this.buf,this.pos);return this.pos+=4,Z},readSFixed32:function(){var Z=ee(this.buf,this.pos);return this.pos+=4,Z},readFixed64:function(){var Z=H(this.buf,this.pos)+H(this.buf,this.pos+4)*i;return this.pos+=8,Z},readSFixed64:function(){var Z=H(this.buf,this.pos)+ee(this.buf,this.pos+4)*i;return this.pos+=8,Z},readFloat:function(){var Z=s.read(this.buf,this.pos,!0,23,4);return this.pos+=4,Z},readDouble:function(){var Z=s.read(this.buf,this.pos,!0,52,8);return this.pos+=8,Z},readVarint:function(Z){var ne,le,fe=this.buf;return ne=127&(le=fe[this.pos++]),le<128?ne:(ne|=(127&(le=fe[this.pos++]))<<7,le<128?ne:(ne|=(127&(le=fe[this.pos++]))<<14,le<128?ne:(ne|=(127&(le=fe[this.pos++]))<<21,le<128?ne:function(Pe,Ee,Ce){var $e,Ie,Ge=Ce.buf;if($e=(112&(Ie=Ge[Ce.pos++]))>>4,Ie<128||($e|=(127&(Ie=Ge[Ce.pos++]))<<3,Ie<128)||($e|=(127&(Ie=Ge[Ce.pos++]))<<10,Ie<128)||($e|=(127&(Ie=Ge[Ce.pos++]))<<17,Ie<128)||($e|=(127&(Ie=Ge[Ce.pos++]))<<24,Ie<128)||($e|=(1&(Ie=Ge[Ce.pos++]))<<31,Ie<128))return f(Pe,$e,Ee);throw new Error("Expected varint not more than 10 bytes")}(ne|=(15&(le=fe[this.pos]))<<28,Z,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var Z=this.readVarint();return Z%2==1?(Z+1)/-2:Z/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var Z=this.readVarint()+this.pos,ne=this.pos;return this.pos=Z,Z-ne>=12&&p?function(le,fe,Pe){return p.decode(le.subarray(fe,Pe))}(this.buf,ne,Z):function(le,fe,Pe){for(var Ee="",Ce=fe;Ce<Pe;){var $e,Ie,Ge,Ze=le[Ce],qe=null,et=Ze>239?4:Ze>223?3:Ze>191?2:1;if(Ce+et>Pe)break;et===1?Ze<128&&(qe=Ze):et===2?(192&($e=le[Ce+1]))==128&&(qe=(31&Ze)<<6|63&$e)<=127&&(qe=null):et===3?(Ie=le[Ce+2],(192&($e=le[Ce+1]))==128&&(192&Ie)==128&&((qe=(15&Ze)<<12|(63&$e)<<6|63&Ie)<=2047||qe>=55296&&qe<=57343)&&(qe=null)):et===4&&(Ie=le[Ce+2],Ge=le[Ce+3],(192&($e=le[Ce+1]))==128&&(192&Ie)==128&&(192&Ge)==128&&((qe=(15&Ze)<<18|(63&$e)<<12|(63&Ie)<<6|63&Ge)<=65535||qe>=1114112)&&(qe=null)),qe===null?(qe=65533,et=1):qe>65535&&(qe-=65536,Ee+=String.fromCharCode(qe>>>10&1023|55296),qe=56320|1023&qe),Ee+=String.fromCharCode(qe),Ce+=et}return Ee}(this.buf,ne,Z)},readBytes:function(){var Z=this.readVarint()+this.pos,ne=this.buf.subarray(this.pos,Z);return this.pos=Z,ne},readPackedVarint:function(Z,ne){if(this.type!==e.Bytes)return Z.push(this.readVarint(ne));var le=l(this);for(Z=Z||[];this.pos<le;)Z.push(this.readVarint(ne));return Z},readPackedSVarint:function(Z){if(this.type!==e.Bytes)return Z.push(this.readSVarint());var ne=l(this);for(Z=Z||[];this.pos<ne;)Z.push(this.readSVarint());return Z},readPackedBoolean:function(Z){if(this.type!==e.Bytes)return Z.push(this.readBoolean());var ne=l(this);for(Z=Z||[];this.pos<ne;)Z.push(this.readBoolean());return Z},readPackedFloat:function(Z){if(this.type!==e.Bytes)return Z.push(this.readFloat());var ne=l(this);for(Z=Z||[];this.pos<ne;)Z.push(this.readFloat());return Z},readPackedDouble:function(Z){if(this.type!==e.Bytes)return Z.push(this.readDouble());var ne=l(this);for(Z=Z||[];this.pos<ne;)Z.push(this.readDouble());return Z},readPackedFixed32:function(Z){if(this.type!==e.Bytes)return Z.push(this.readFixed32());var ne=l(this);for(Z=Z||[];this.pos<ne;)Z.push(this.readFixed32());return Z},readPackedSFixed32:function(Z){if(this.type!==e.Bytes)return Z.push(this.readSFixed32());var ne=l(this);for(Z=Z||[];this.pos<ne;)Z.push(this.readSFixed32());return Z},readPackedFixed64:function(Z){if(this.type!==e.Bytes)return Z.push(this.readFixed64());var ne=l(this);for(Z=Z||[];this.pos<ne;)Z.push(this.readFixed64());return Z},readPackedSFixed64:function(Z){if(this.type!==e.Bytes)return Z.push(this.readSFixed64());var ne=l(this);for(Z=Z||[];this.pos<ne;)Z.push(this.readSFixed64());return Z},skip:function(Z){var ne=7&Z;if(ne===e.Varint)for(;this.buf[this.pos++]>127;);else if(ne===e.Bytes)this.pos=this.readVarint()+this.pos;else if(ne===e.Fixed32)this.pos+=4;else{if(ne!==e.Fixed64)throw new Error("Unimplemented type: "+ne);this.pos+=8}},writeTag:function(Z,ne){this.writeVarint(Z<<3|ne)},realloc:function(Z){for(var ne=this.length||16;ne<this.pos+Z;)ne*=2;if(ne!==this.length){var le=new Uint8Array(ne);le.set(this.buf),this.buf=le,this.length=ne}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(Z){this.realloc(4),J(this.buf,Z,this.pos),this.pos+=4},writeSFixed32:function(Z){this.realloc(4),J(this.buf,Z,this.pos),this.pos+=4},writeFixed64:function(Z){this.realloc(8),J(this.buf,-1&Z,this.pos),J(this.buf,Math.floor(Z*o),this.pos+4),this.pos+=8},writeSFixed64:function(Z){this.realloc(8),J(this.buf,-1&Z,this.pos),J(this.buf,Math.floor(Z*o),this.pos+4),this.pos+=8},writeVarint:function(Z){(Z=+Z||0)>268435455||Z<0?function(ne,le){var fe,Pe;if(ne>=0?(fe=ne%4294967296|0,Pe=ne/4294967296|0):(Pe=~(-ne/4294967296),4294967295^(fe=~(-ne%4294967296))?fe=fe+1|0:(fe=0,Pe=Pe+1|0)),ne>=18446744073709552e3||ne<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");le.realloc(10),function(Ee,Ce,$e){$e.buf[$e.pos++]=127&Ee|128,Ee>>>=7,$e.buf[$e.pos++]=127&Ee|128,Ee>>>=7,$e.buf[$e.pos++]=127&Ee|128,Ee>>>=7,$e.buf[$e.pos++]=127&Ee|128,$e.buf[$e.pos]=127&(Ee>>>=7)}(fe,0,le),function(Ee,Ce){var $e=(7&Ee)<<4;Ce.buf[Ce.pos++]|=$e|((Ee>>>=3)?128:0),Ee&&(Ce.buf[Ce.pos++]=127&Ee|((Ee>>>=7)?128:0),Ee&&(Ce.buf[Ce.pos++]=127&Ee|((Ee>>>=7)?128:0),Ee&&(Ce.buf[Ce.pos++]=127&Ee|((Ee>>>=7)?128:0),Ee&&(Ce.buf[Ce.pos++]=127&Ee|((Ee>>>=7)?128:0),Ee&&(Ce.buf[Ce.pos++]=127&Ee)))))}(Pe,le)}(Z,this):(this.realloc(4),this.buf[this.pos++]=127&Z|(Z>127?128:0),Z<=127||(this.buf[this.pos++]=127&(Z>>>=7)|(Z>127?128:0),Z<=127||(this.buf[this.pos++]=127&(Z>>>=7)|(Z>127?128:0),Z<=127||(this.buf[this.pos++]=Z>>>7&127))))},writeSVarint:function(Z){this.writeVarint(Z<0?2*-Z-1:2*Z)},writeBoolean:function(Z){this.writeVarint(!!Z)},writeString:function(Z){Z=String(Z),this.realloc(4*Z.length),this.pos++;var ne=this.pos;this.pos=function(fe,Pe,Ee){for(var Ce,$e,Ie=0;Ie<Pe.length;Ie++){if((Ce=Pe.charCodeAt(Ie))>55295&&Ce<57344){if(!$e){Ce>56319||Ie+1===Pe.length?(fe[Ee++]=239,fe[Ee++]=191,fe[Ee++]=189):$e=Ce;continue}if(Ce<56320){fe[Ee++]=239,fe[Ee++]=191,fe[Ee++]=189,$e=Ce;continue}Ce=$e-55296<<10|Ce-56320|65536,$e=null}else $e&&(fe[Ee++]=239,fe[Ee++]=191,fe[Ee++]=189,$e=null);Ce<128?fe[Ee++]=Ce:(Ce<2048?fe[Ee++]=Ce>>6|192:(Ce<65536?fe[Ee++]=Ce>>12|224:(fe[Ee++]=Ce>>18|240,fe[Ee++]=Ce>>12&63|128),fe[Ee++]=Ce>>6&63|128),fe[Ee++]=63&Ce|128)}return Ee}(this.buf,Z,this.pos);var le=this.pos-ne;le>=128&&w(ne,le,this),this.pos=ne-1,this.writeVarint(le),this.pos+=le},writeFloat:function(Z){this.realloc(4),s.write(this.buf,Z,this.pos,!0,23,4),this.pos+=4},writeDouble:function(Z){this.realloc(8),s.write(this.buf,Z,this.pos,!0,52,8),this.pos+=8},writeBytes:function(Z){var ne=Z.length;this.writeVarint(ne),this.realloc(ne);for(var le=0;le<ne;le++)this.buf[this.pos++]=Z[le]},writeRawMessage:function(Z,ne){this.pos++;var le=this.pos;Z(ne,this);var fe=this.pos-le;fe>=128&&w(le,fe,this),this.pos=le-1,this.writeVarint(fe),this.pos+=fe},writeMessage:function(Z,ne,le){this.writeTag(Z,e.Bytes),this.writeRawMessage(ne,le)},writePackedVarint:function(Z,ne){ne.length&&this.writeMessage(Z,C,ne)},writePackedSVarint:function(Z,ne){ne.length&&this.writeMessage(Z,O,ne)},writePackedBoolean:function(Z,ne){ne.length&&this.writeMessage(Z,k,ne)},writePackedFloat:function(Z,ne){ne.length&&this.writeMessage(Z,x,ne)},writePackedDouble:function(Z,ne){ne.length&&this.writeMessage(Z,E,ne)},writePackedFixed32:function(Z,ne){ne.length&&this.writeMessage(Z,M,ne)},writePackedSFixed32:function(Z,ne){ne.length&&this.writeMessage(Z,P,ne)},writePackedFixed64:function(Z,ne){ne.length&&this.writeMessage(Z,R,ne)},writePackedSFixed64:function(Z,ne){ne.length&&this.writeMessage(Z,$,ne)},writeBytesField:function(Z,ne){this.writeTag(Z,e.Bytes),this.writeBytes(ne)},writeFixed32Field:function(Z,ne){this.writeTag(Z,e.Fixed32),this.writeFixed32(ne)},writeSFixed32Field:function(Z,ne){this.writeTag(Z,e.Fixed32),this.writeSFixed32(ne)},writeFixed64Field:function(Z,ne){this.writeTag(Z,e.Fixed64),this.writeFixed64(ne)},writeSFixed64Field:function(Z,ne){this.writeTag(Z,e.Fixed64),this.writeSFixed64(ne)},writeVarintField:function(Z,ne){this.writeTag(Z,e.Varint),this.writeVarint(ne)},writeSVarintField:function(Z,ne){this.writeTag(Z,e.Varint),this.writeSVarint(ne)},writeStringField:function(Z,ne){this.writeTag(Z,e.Bytes),this.writeString(ne)},writeFloatField:function(Z,ne){this.writeTag(Z,e.Fixed32),this.writeFloat(ne)},writeDoubleField:function(Z,ne){this.writeTag(Z,e.Fixed64),this.writeDouble(ne)},writeBooleanField:function(Z,ne){this.writeVarintField(Z,!!ne)}},Z0}var k_=W(Nb());const J0=3;function aC(s,e,i){e.glyphs=[],s===1&&i.readMessage(lC,e)}function lC(s,e,i){if(s===3){const{id:o,bitmap:p,width:l,height:f,left:w,top:C,advance:O}=i.readMessage(cC,{});e.glyphs.push({id:o,bitmap:new Vl({width:l+2*J0,height:f+2*J0},p),metrics:{width:l,height:f,left:w,top:C,advance:O}})}else s===4?e.ascender=i.readSVarint():s===5&&(e.descender=i.readSVarint())}function cC(s,e,i){s===1?e.id=i.readVarint():s===2?e.bitmap=i.readBytes():s===3?e.width=i.readVarint():s===4?e.height=i.readVarint():s===5?e.left=i.readSVarint():s===6?e.top=i.readSVarint():s===7&&(e.advance=i.readVarint())}const uC=J0,sl={horizontal:1,vertical:2,horizontalOnly:3};class cg{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const o=new cg;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new cg;return i.image=e,i}}class im{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const o=new im;for(let p=0;p<e.sections.length;p++){const l=e.sections[p];l.image?o.addImageSection(l):o.addTextSection(l,i)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,o){let p="";for(let l=0;l<i.length;l++){const f=i.charCodeAt(l+1)||null,w=i.charCodeAt(l-1)||null;p+=!o&&(f&&mp(f)&&!lg[i[l+1]]||w&&mp(w)&&!lg[i[l-1]])||!lg[i[l]]?i[l]:lg[i[l]]}return p}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&O_[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&O_[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new im;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(cg.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let p=0;p<e.text.length;++p)this.sectionIndex.push(o)}addImageSection(e){const i=e.image&&e.image.namePrimary?e.image.getPrimary():null;if(!i)return void qi("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push(cg.forImage(i)),this.sectionIndex.push(this.sections.length-1)):qi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Q0(s,e,i,o,p,l,f,w,C,O,x,E,k,M,P){const R=im.fromFeature(s,p);E===sl.vertical&&R.verticalizePunctuation(k);let $=[];const H=function(le,fe,Pe,Ee,Ce,$e){if(!le)return[];const Ie=[],Ge=function(nt,ct,it,Et,Nt,Ct){let si=0;for(let ti=0;ti<nt.length();ti++){const Ht=nt.getSection(ti);si+=Vb(nt.getCodePoint(ti),Ht,Et,Nt,ct,Ct)}return si/Math.max(1,Math.ceil(si/it))}(le,fe,Pe,Ee,Ce,$e),Ze=le.text.indexOf("​")>=0;let qe=0;for(let nt=0;nt<le.length();nt++){const ct=le.getSection(nt),it=le.getCodePoint(nt);if(O_[it]||(qe+=Vb(it,ct,Ee,Ce,fe,$e)),nt<le.length()-1){const Et=!((et=it)<11904||!(wi["Bopomofo Extended"](et)||wi.Bopomofo(et)||wi["CJK Compatibility Forms"](et)||wi["CJK Compatibility Ideographs"](et)||wi["CJK Compatibility"](et)||wi["CJK Radicals Supplement"](et)||wi["CJK Strokes"](et)||wi["CJK Symbols and Punctuation"](et)||wi["CJK Unified Ideographs Extension A"](et)||wi["CJK Unified Ideographs"](et)||wi["Enclosed CJK Letters and Months"](et)||wi["Halfwidth and Fullwidth Forms"](et)||wi.Hiragana(et)||wi["Ideographic Description Characters"](et)||wi["Kangxi Radicals"](et)||wi["Katakana Phonetic Extensions"](et)||wi.Katakana(et)||wi["Vertical Forms"](et)||wi["Yi Radicals"](et)||wi["Yi Syllables"](et)));(hC[it]||Et||ct.image)&&Ie.push(jb(nt+1,qe,Ge,Ie,dC(it,le.getCodePoint(nt+1),Et&&Ze),!1))}}var et;return $b(jb(le.length(),qe,Ge,Ie,0,!0))}(R,O,l,e,o,M),{processBidirectionalText:J,processStyledBidirectionalText:ee}=Qs;if(J&&R.sections.length===1){const le=J(R.toString(),H);for(const fe of le){const Pe=new im;Pe.text=fe,Pe.sections=R.sections;for(let Ee=0;Ee<fe.length;Ee++)Pe.sectionIndex.push(0);$.push(Pe)}}else if(ee){const le=ee(R.text,R.sectionIndex,H);for(const fe of le){const Pe=new im;Pe.text=fe[0],Pe.sectionIndex=fe[1],Pe.sections=R.sections,$.push(Pe)}}else $=function(le,fe){const Pe=[],Ee=le.text;let Ce=0;for(const $e of fe)Pe.push(le.substring(Ce,$e)),Ce=$e;return Ce<Ee.length&&Pe.push(le.substring(Ce,Ee.length)),Pe}(R,H);const Z=[],ne={positionedLines:Z,text:R.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(le,fe,Pe,Ee,Ce,$e,Ie,Ge,Ze,qe,et,nt){let ct=0,it=0,Et=0;const Nt=Ge==="right"?1:Ge==="left"?0:.5;let Ct=!1;for(const ui of Ce){const mi=ui.getSections();for(const Ni of mi){if(Ni.image)continue;const Ki=fe[Ni.fontStack];if(Ki&&(Ct=Ki.ascender!==void 0&&Ki.descender!==void 0,!Ct))break}if(!Ct)break}let si=0;for(const ui of Ce){ui.trim();const mi=ui.getMaxScale(),Ni=(mi-1)*po,Ki={positionedGlyphs:[],lineOffset:0};le.positionedLines[si]=Ki;const er=Ki.positionedGlyphs;let tr=0;if(!ui.length()){it+=$e,++si;continue}let cr=0,ur=0;for(let Nr=0;Nr<ui.length();Nr++){const Hi=ui.getSection(Nr),Rr=ui.getSectionIndex(Nr),Fr=ui.getCodePoint(Nr);let hn=Hi.scale,Zn=null,hs=null,Kn=null,On=po,as=0;const _s=!(Ze===sl.horizontal||!et&&!ca(Fr)||et&&(O_[Fr]||(ti=Fr,wi.Arabic(ti)||wi["Arabic Supplement"](ti)||wi["Arabic Extended-A"](ti)||wi["Arabic Presentation Forms-A"](ti)||wi["Arabic Presentation Forms-B"](ti))));if(Hi.image){const fo=Ee[Hi.image.serialize()];if(!fo)continue;Kn=Hi.image.id,le.iconsInText=le.iconsInText||!0,hs=fo.paddedRect;const cn=fo.displaySize;hn=hn*po/nt,Zn={width:cn[0],height:cn[1],left:0,top:-3,advance:_s?cn[1]:cn[0],localGlyph:!1},as=Ct?-Zn.height*hn:mi*po-17-cn[1]*hn,On=Zn.advance;const xa=(_s?cn[0]:cn[1])*hn-po*mi;xa>0&&xa>tr&&(tr=xa)}else{const fo=Pe[Hi.fontStack];if(!fo)continue;fo[Fr]&&(hs=fo[Fr]);const cn=fe[Hi.fontStack];if(!cn)continue;const xa=cn.glyphs[Fr];if(!xa)continue;if(Zn=xa.metrics,On=Fr!==8203?po:0,Ct){const Rc=cn.ascender!==void 0?Math.abs(cn.ascender):0,jl=cn.descender!==void 0?Math.abs(cn.descender):0,$l=(Rc+jl)*hn;cr<$l&&(cr=$l,ur=(Rc-jl)/2*hn),as=-Rc*hn}else as=(mi-hn)*po-17}_s?(le.verticalizable=!0,er.push({glyph:Fr,imageName:Kn,x:ct,y:it+as,vertical:_s,scale:hn,localGlyph:Zn.localGlyph,fontStack:Hi.fontStack,sectionIndex:Rr,metrics:Zn,rect:hs}),ct+=On*hn+qe):(er.push({glyph:Fr,imageName:Kn,x:ct,y:it+as,vertical:_s,scale:hn,localGlyph:Zn.localGlyph,fontStack:Hi.fontStack,sectionIndex:Rr,metrics:Zn,rect:hs}),ct+=Zn.advance*hn+qe)}er.length!==0&&(Et=Math.max(ct-qe,Et),Ct?Hb(er,Nt,tr,ur,$e*mi/2):Hb(er,Nt,tr,0,$e/2)),ct=0;const nn=$e*mi+tr;Ki.lineOffset=Math.max(tr,Ni),it+=nn,++si}var ti;const Ht=it,{horizontalAlign:Ut,verticalAlign:xi}=ev(Ie);(function(ui,mi,Ni,Ki,er,tr){const cr=(mi-Ni)*er,ur=-tr*Ki;for(const nn of ui)for(const Nr of nn.positionedGlyphs)Nr.x+=cr,Nr.y+=ur})(le.positionedLines,Nt,Ut,xi,Et,Ht),le.top+=-xi*Ht,le.bottom=le.top+Ht,le.left+=-Ut*Et,le.right=le.left+Et,le.hasBaseline=Ct}(ne,e,i,o,$,f,w,C,E,O,k,P),!function(le){for(const fe of le)if(fe.positionedGlyphs.length!==0)return!1;return!0}(Z)&&ne}const O_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},hC={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Vb(s,e,i,o,p,l){if(e.image){const f=o[e.image.serialize()];return f?f.displaySize[0]*e.scale*po/l+p:0}{const f=i[e.fontStack],w=f&&f.glyphs[s];return w?w.metrics.advance*e.scale+p:0}}function Ub(s,e,i,o){const p=Math.pow(s-e,2);return o?s<e?p/2:2*p:p+Math.abs(i)*i}function dC(s,e,i){let o=0;return s===10&&(o-=1e4),i&&(o+=150),s!==40&&s!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function jb(s,e,i,o,p,l){let f=null,w=Ub(e,i,p,l);for(const C of o){const O=Ub(e-C.x,i,p,l)+C.badness;O<=w&&(f=C,w=O)}return{index:s,x:e,priorBreak:f,badness:w}}function $b(s){return s?$b(s.priorBreak).concat(s.index):[]}function ev(s){let e=.5,i=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Hb(s,e,i,o,p){if(!(e||i||o||p))return;const l=s.length-1,f=s[l],w=(f.x+f.metrics.advance*f.scale)*e;for(let C=0;C<=l;C++)s[C].x-=w,s[C].y+=i+o+p}function pC(s,e,i,o){const{horizontalAlign:p,verticalAlign:l}=ev(o),f=i[0]-s.displaySize[0]*p,w=i[1]-s.displaySize[1]*l;return{imagePrimary:s,imageSecondary:e,top:w,bottom:w+s.displaySize[1],left:f,right:f+s.displaySize[0]}}function Gb(s,e,i,o,p,l){const f=s.imagePrimary;let w;if(f.content){const $=f.content,H=f.pixelRatio||1;w=[$[0]/H,$[1]/H,f.displaySize[0]-$[2]/H,f.displaySize[1]-$[3]/H]}const C=e.left*l,O=e.right*l;let x,E,k,M;i==="width"||i==="both"?(M=p[0]+C-o[3],E=p[0]+O+o[1]):(M=p[0]+(C+O-f.displaySize[0])/2,E=M+f.displaySize[0]);const P=e.top*l,R=e.bottom*l;return i==="height"||i==="both"?(x=p[1]+P-o[0],k=p[1]+R+o[2]):(x=p[1]+(P+R-f.displaySize[1])/2,k=x+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:x,right:E,bottom:k,left:M,collisionPadding:w}}class Sh extends Wt{constructor(e,i,o,p,l){super(e,i),this.angle=p,this.z=o,l!==void 0&&(this.segment=l)}clone(){return new Sh(this.x,this.y,this.z,this.angle,this.segment)}}function Wb(s,e,i,o,p){if(e.segment===void 0)return!0;let l=e,f=e.segment+1,w=0;for(;w>-i/2;){if(f--,f<0)return!1;w-=s[f].dist(l),l=s[f]}w+=s[f].dist(s[f+1]),f++;const C=[];let O=0;for(;w<i/2;){const x=s[f],E=s[f+1];if(!E)return!1;let k=s[f-1].angleTo(x)-x.angleTo(E);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:w,angleDelta:k}),O+=k;w-C[0].distance>o;)O-=C.shift().angleDelta;if(O>p)return!1;f++,w+=x.dist(E)}return!0}function qb(s){let e=0;for(let i=0;i<s.length-1;i++)e+=s[i].dist(s[i+1]);return e}function Yb(s,e,i){return s?.6*e*i:0}function Xb(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function fC(s,e,i,o,p,l){const f=Yb(i,p,l),w=Xb(i,o)*l;let C=0;const O=qb(s)/2;for(let x=0;x<s.length-1;x++){const E=s[x],k=s[x+1],M=E.dist(k);if(C+M>O){const P=(O-C)/M,R=Di(E.x,k.x,P),$=Di(E.y,k.y,P),H=new Sh(R,$,0,k.angleTo(E),x);return!f||Wb(s,H,w,f,e)?H:void 0}C+=M}}function mC(s,e,i,o,p,l,f,w,C){const O=Yb(o,l,f),x=Xb(o,p),E=x*f,k=s[0].x===0||s[0].x===C||s[0].y===0||s[0].y===C;return e-E<e/4&&(e=E+e/4),Zb(s,k?e/2*w%e:(x/2+2*l)*f*w%e,e,O,i,E,k,!1,C)}function Zb(s,e,i,o,p,l,f,w,C){const O=l/2,x=qb(s);let E=0,k=e-i,M=[];for(let P=0;P<s.length-1;P++){const R=s[P],$=s[P+1],H=R.dist($),J=$.angleTo(R);for(;k+i<E+H;){k+=i;const ee=(k-E)/H,Z=Di(R.x,$.x,ee),ne=Di(R.y,$.y,ee);if(Z>=0&&Z<C&&ne>=0&&ne<C&&k-O>=0&&k+O<=x){const le=new Sh(Z,ne,0,J,P);o&&!Wb(s,le,l,o,p)||M.push(le)}}E+=H}return w||M.length||f||(M=Zb(s,E/2,i,o,p,l,f,!0,C)),M}function Kb(s,e,i,o,p){const l=[];for(let f=0;f<s.length;f++){const w=s[f];let C;for(let O=0;O<w.length-1;O++){let x=w[O],E=w[O+1];x.x<e&&E.x<e||(x.x<e?x=new Wt(e,x.y+(e-x.x)/(E.x-x.x)*(E.y-x.y))._round():E.x<e&&(E=new Wt(e,x.y+(e-x.x)/(E.x-x.x)*(E.y-x.y))._round()),x.y<i&&E.y<i||(x.y<i?x=new Wt(x.x+(i-x.y)/(E.y-x.y)*(E.x-x.x),i)._round():E.y<i&&(E=new Wt(x.x+(i-x.y)/(E.y-x.y)*(E.x-x.x),i)._round()),x.x>=o&&E.x>=o||(x.x>=o?x=new Wt(o,x.y+(o-x.x)/(E.x-x.x)*(E.y-x.y))._round():E.x>=o&&(E=new Wt(o,x.y+(o-x.x)/(E.x-x.x)*(E.y-x.y))._round()),x.y>=p&&E.y>=p||(x.y>=p?x=new Wt(x.x+(p-x.y)/(E.y-x.y)*(E.x-x.x),p)._round():E.y>=p&&(E=new Wt(x.x+(p-x.y)/(E.y-x.y)*(E.x-x.x),p)._round()),C&&x.equals(C[C.length-1])||(C=[x],l.push(C)),C.push(E)))))}}return l}function Jb(s){let e=0,i=0;for(const f of s)e+=f.w*f.h,i=Math.max(i,f.w);s.sort((f,w)=>w.h-f.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let p=0,l=0;for(const f of s)for(let w=o.length-1;w>=0;w--){const C=o[w];if(!(f.w>C.w||f.h>C.h)){if(f.x=C.x,f.y=C.y,l=Math.max(l,f.y+f.h),p=Math.max(p,f.x+f.w),f.w===C.w&&f.h===C.h){const O=o.pop();w<o.length&&(o[w]=O)}else f.h===C.h?(C.x+=f.w,C.w-=f.w):f.w===C.w?(C.y+=f.h,C.h-=f.h):(o.push({x:C.x+f.w,y:C.y,w:C.w-f.w,h:f.h}),C.y+=f.h,C.h-=f.h);break}}return{w:p,h:l,fill:e/(p*l)||0}}_i(Sh,"Anchor");const ug=1;class hg{static getImagePositionScale(e,i,o){return i&&e&&e.options&&e.options.transform?{x:e.options.transform.a,y:e.options.transform.d}:{x:o,y:o}}constructor(e,{pixelRatio:i,version:o,stretchX:p,stretchY:l,content:f,sdf:w,usvg:C},O,x){this.paddedRect=e,this.pixelRatio=i,this.stretchX=p,this.stretchY=l,this.content=f,this.version=o,this.padding=O,this.sdf=w,this.scale=hg.getImagePositionScale(x,C,i)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}class Qb{constructor(e,i,o){const p={},l={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,p,ug,f),this.addImages(i,l,2,f);const{w,h:C}=Jb(f),O=new Fs({width:w||1,height:C||1});for(const x in e){const E=e[x],k=p[x].paddedRect;Fs.copy(E.data,O,{x:0,y:0},{x:k.x+ug,y:k.y+ug},E.data,o,E.sdf)}for(const x in i){const E=i[x],k=l[x].paddedRect;let M=l[x].padding;const P=k.x+M,R=k.y+M,$=E.data.width,H=E.data.height;M=M>1?M-1:M,Fs.copy(E.data,O,{x:0,y:0},{x:P,y:R},E.data,o),Fs.copy(E.data,O,{x:0,y:H-M},{x:P,y:R-M},{width:$,height:M},o),Fs.copy(E.data,O,{x:0,y:0},{x:P,y:R+H},{width:$,height:M},o),Fs.copy(E.data,O,{x:$-M,y:0},{x:P-M,y:R},{width:M,height:H},o),Fs.copy(E.data,O,{x:0,y:0},{x:P+$,y:R},{width:M,height:H},o),Fs.copy(E.data,O,{x:$-M,y:H-M},{x:P-M,y:R-M},{width:M,height:M},o),Fs.copy(E.data,O,{x:0,y:H-M},{x:P+$,y:R-M},{width:M,height:M},o),Fs.copy(E.data,O,{x:0,y:0},{x:P+$,y:R+H},{width:M,height:M},o),Fs.copy(E.data,O,{x:$-M,y:0},{x:P-M,y:R+H},{width:M,height:M},o)}this.lut=o,this.image=O,this.iconPositions=p,this.patternPositions=l}addImages(e,i,o,p){for(const l in e){const f=e[l],w={x:0,y:0,w:f.data.width+2*o,h:f.data.height+2*o};p.push(w);const C=yo.deserializeFromString(l);i[l]=new hg(w,f,o,C),f.hasRenderCallback&&this.haveRenderCallbacks.push(C.id)}}patchUpdatedImages(e,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>e.hasImage(p,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(const p in e.getUpdatedImages(o)){for(const l of Object.keys(this.iconPositions))yo.deserializeId(l)===p&&this.patchUpdatedImage(this.iconPositions[l],e.getImage(p,o),i);for(const l of Object.keys(this.patternPositions))yo.deserializeId(l)===p&&this.patchUpdatedImage(this.patternPositions[l],e.getImage(p,o),i)}}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[p,l]=e.tl,f=e.sdf;if(this.lut||f){const w={width:i.data.width,height:i.data.height},C=new Fs(w);Fs.copy(i.data,C,{x:0,y:0},{x:0,y:0},w,this.lut,f),o.update(C,{position:{x:p,y:l}})}else o.update(i.data,{position:{x:p,y:l}})}}_i(hg,"ImagePosition"),_i(Qb,"ImageAtlas");const L_=1e20;function e1(s,e,i,o,p,l,f,w,C){for(let O=e;O<e+o;O++)t1(s,i*l+O,l,p,f,w,C);for(let O=i;O<i+p;O++)t1(s,O*l+e,1,o,f,w,C)}function t1(s,e,i,o,p,l,f){l[0]=0,f[0]=-1e20,f[1]=L_,p[0]=s[e];for(let w=1,C=0,O=0;w<o;w++){p[w]=s[e+w*i];const x=w*w;do{const E=l[C];O=(p[w]-p[E]+x-E*E)/(w-E)/2}while(O<=f[C]&&--C>-1);C++,l[C]=w,f[C]=O,f[C+1]=L_}for(let w=0,C=0;w<o;w++){for(;f[C+1]<w;)C++;const O=l[C],x=w-O;s[e+w*i]=p[O]+x*x}}const Ic=2,tv={none:0,ideographs:1,all:2};class rm{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,o){const p=[],l=this.urls[i]||ts.GLYPHS_URL;for(const f in e)for(const w of e[f])p.push({stack:f,id:w});dl(p,({stack:f,id:w},C)=>{let O=this.entries[f];O||(O=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=O.glyphs[w];if(x!==void 0)return void C(null,{stack:f,id:w,glyph:x});if(x=this._tinySDF(O,f,w),x)return O.glyphs[w]=x,void C(null,{stack:f,id:w,glyph:x});const E=Math.floor(w/256);if(256*E>65535)return qi("glyphs > 65535 not supported"),void C(null,{stack:f,id:w,glyph:x});if(O.ranges[E])return void C(null,{stack:f,id:w,glyph:x});let k=O.requests[E];k||(k=O.requests[E]=[],rm.loadGlyphRange(f,E,l,this.requestManager,(M,P)=>{if(P){O.ascender=P.ascender,O.descender=P.descender;for(const R in P.glyphs)this._doesCharSupportLocalGlyph(+R)||(O.glyphs[+R]=P.glyphs[+R]);O.ranges[E]=!0}for(const R of k)R(M,P);delete O.requests[E]})),k.push((M,P)=>{M?C(M):P&&C(null,{stack:f,id:w,glyph:P.glyphs[w]||null})})},(f,w)=>{if(f)o(f);else if(w){const C={};for(const{stack:O,id:x,glyph:E}of w)C[O]===void 0&&(C[O]={}),C[O].glyphs===void 0&&(C[O].glyphs={}),C[O].glyphs[x]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},C[O].ascender=this.entries[O].ascender,C[O].descender=this.entries[O].descender;o(null,C)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==tv.none&&(this.localGlyphMode===tv.all?!!this.localFontFamily:!!this.localFontFamily&&(wi["CJK Unified Ideographs"](e)||wi["Hangul Syllables"](e)||wi.Hiragana(e)||wi.Katakana(e)||wi["CJK Symbols and Punctuation"](e)||wi["CJK Unified Ideographs Extension A"](e)||wi["CJK Unified Ideographs Extension B"](e)||wi.Osage(e)))}_tinySDF(e,i,o){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(o))return;let l=e.tinySDF;if(!l){let R="400";/bold/i.test(i)?R="900":/medium/i.test(i)?R="500":/light/i.test(i)&&(R="200"),l=e.tinySDF=new rm.TinySDF({fontFamily:p,fontWeight:R,fontSize:24*Ic,buffer:3*Ic,radius:8*Ic}),l.fontWeight=R}if(this.localGlyphs[l.fontWeight][o])return this.localGlyphs[l.fontWeight][o];const f=String.fromCodePoint(o),{data:w,width:C,height:O,glyphWidth:x,glyphHeight:E,glyphLeft:k,glyphTop:M,glyphAdvance:P}=l.draw(f);return this.localGlyphs[l.fontWeight][o]={id:o,bitmap:new Vl({width:C,height:O},w),metrics:{width:x/Ic,height:E/Ic,left:k/Ic,top:M/Ic-27,advance:P/Ic,localGlyph:!0}}}}rm.loadGlyphRange=function(s,e,i,o,p){const l=256*e,f=l+255,w=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",s).replace("{range}",`${l}-${f}`),Pr.Glyphs);Nn(w,(C,O)=>{if(C)p(C);else if(O){const x={},E=function(k){return new k_(k).readFields(aC,{})}(O);for(const k of E.glyphs)x[k.id]=k;p(null,{glyphs:x,ascender:E.ascender,descender:E.descender})}})},rm.TinySDF=class{constructor({fontSize:s=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:p="sans-serif",fontWeight:l="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=i;const w=this.size=s+4*e,C=this._createCanvas(w),O=this.ctx=C.getContext("2d",{willReadFrequently:!0});O.font=`${f} ${l} ${s}px ${p}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(s){const e=document.createElement("canvas");return e.width=e.height=s,e}draw(s){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:p,actualBoundingBoxRight:l}=this.ctx.measureText(s),f=Math.ceil(i),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-p))),C=Math.min(this.size-this.buffer,f+Math.ceil(o)),O=w+2*this.buffer,x=C+2*this.buffer,E=Math.max(O*x,0),k=new Uint8ClampedArray(E),M={data:k,width:O,height:x,glyphWidth:w,glyphHeight:C,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(w===0||C===0)return M;const{ctx:P,buffer:R,gridInner:$,gridOuter:H}=this;P.clearRect(R,R,w,C),P.fillText(s,R,R+f);const J=P.getImageData(R,R,w,C);H.fill(L_,0,E),$.fill(0,0,E);for(let ee=0;ee<C;ee++)for(let Z=0;Z<w;Z++){const ne=J.data[4*(ee*w+Z)+3]/255;if(ne===0)continue;const le=(ee+R)*O+Z+R;if(ne===1)H[le]=0,$[le]=L_;else{const fe=.5-ne;H[le]=fe>0?fe*fe:0,$[le]=fe<0?fe*fe:0}}e1(H,0,0,O,x,O,this.f,this.v,this.z),e1($,R,R,w,C,O,this.f,this.v,this.z);for(let ee=0;ee<E;ee++){const Z=Math.sqrt(H[ee])-Math.sqrt($[ee]);k[ee]=Math.round(255-255*(Z/this.radius+this.cutoff))}return M}};const Wp=ug;function i1(s,e){return s+e[1]-e[0]}function r1(s,e,i,o,p=1){const l=[],f=s.imagePrimary,w=f.pixelRatio,C=f.paddedRect.w-2*Wp,O=f.paddedRect.h-2*Wp,x=(s.right-s.left)*p,E=(s.bottom-s.top)*p,k=f.stretchX||[[0,C]],M=f.stretchY||[[0,O]],P=k.reduce(i1,0),R=M.reduce(i1,0),$=C-P,H=O-R;let J=0,ee=P,Z=0,ne=R,le=0,fe=$,Pe=0,Ee=H;if(f.content&&o){const $e=f.content;J=R_(k,0,$e[0]),Z=R_(M,0,$e[1]),ee=R_(k,$e[0],$e[2]),ne=R_(M,$e[1],$e[3]),le=$e[0]-J,Pe=$e[1]-Z,fe=$e[2]-$e[0]-ee,Ee=$e[3]-$e[1]-ne}const Ce=($e,Ie,Ge,Ze)=>{const qe=z_($e.stretch-J,ee,x,s.left*p),et=F_($e.fixed-le,fe,$e.stretch,P),nt=z_(Ie.stretch-Z,ne,E,s.top*p),ct=F_(Ie.fixed-Pe,Ee,Ie.stretch,R),it=z_(Ge.stretch-J,ee,x,s.left*p),Et=F_(Ge.fixed-le,fe,Ge.stretch,P),Nt=z_(Ze.stretch-Z,ne,E,s.top*p),Ct=F_(Ze.fixed-Pe,Ee,Ze.stretch,R),si=new Wt(qe,nt),ti=new Wt(it,nt),Ht=new Wt(it,Nt),Ut=new Wt(qe,Nt),xi=new Wt(et/w,ct/w),ui=new Wt(Et/w,Ct/w),mi=e*Math.PI/180;if(mi){const ur=Math.sin(mi),nn=Math.cos(mi),Nr=[nn,-ur,ur,nn];si._matMult(Nr),ti._matMult(Nr),Ut._matMult(Nr),Ht._matMult(Nr)}const Ni=$e.stretch+$e.fixed,Ki=Ge.stretch+Ge.fixed,er=Ie.stretch+Ie.fixed,tr=Ze.stretch+Ze.fixed,cr=s.imageSecondary;return{tl:si,tr:ti,bl:Ut,br:Ht,texPrimary:{x:f.paddedRect.x+Wp+Ni,y:f.paddedRect.y+Wp+er,w:Ki-Ni,h:tr-er},texSecondary:cr?{x:cr.paddedRect.x+Wp+Ni,y:cr.paddedRect.y+Wp+er,w:Ki-Ni,h:tr-er}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xi,pixelOffsetBR:ui,minFontScaleX:fe/w/x,minFontScaleY:Ee/w/E,isSDF:i}};if(o&&(f.stretchX||f.stretchY)){const $e=n1(k,$,P),Ie=n1(M,H,R);for(let Ge=0;Ge<$e.length-1;Ge++){const Ze=$e[Ge],qe=$e[Ge+1];for(let et=0;et<Ie.length-1;et++)l.push(Ce(Ze,Ie[et],qe,Ie[et+1]))}}else l.push(Ce({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:O+1}));return l}function R_(s,e,i){let o=0;for(const p of s)o+=Math.max(e,Math.min(i,p[1]))-Math.max(e,Math.min(i,p[0]));return o}function n1(s,e,i){const o=[{fixed:-1,stretch:0}];for(const[p,l]of s){const f=o[o.length-1];o.push({fixed:p-f.stretch,stretch:f.stretch}),o.push({fixed:p-f.stretch,stretch:f.stretch+(l-p)})}return o.push({fixed:e+Wp,stretch:i}),o}function z_(s,e,i,o){return s/e*i+o}function F_(s,e,i,o){return s-e*i/o}function gC(s,e,i,o){const p=e+s.positionedLines[o].lineOffset;return o===0?i+p/2:i+(p+(e+s.positionedLines[o-1].lineOffset))/2}function _C(s,e=1,i=!1){let o=1/0,p=1/0,l=-1/0,f=-1/0;const w=s[0];for(let M=0;M<w.length;M++){const P=w[M];(!M||P.x<o)&&(o=P.x),(!M||P.y<p)&&(p=P.y),(!M||P.x>l)&&(l=P.x),(!M||P.y>f)&&(f=P.y)}const C=Math.min(l-o,f-p);let O=C/2;const x=new Os([],yC);if(C===0)return new Wt(o,p);for(let M=o;M<l;M+=C)for(let P=p;P<f;P+=C)x.push(new nm(M+O,P+O,O,s));let E=function(M){let P=0,R=0,$=0;const H=M[0];for(let J=0,ee=H.length,Z=ee-1;J<ee;Z=J++){const ne=H[J],le=H[Z],fe=ne.x*le.y-le.x*ne.y;R+=(ne.x+le.x)*fe,$+=(ne.y+le.y)*fe,P+=3*fe}return new nm(R/P,$/P,0,M)}(s),k=x.length;for(;x.length;){const M=x.pop();(M.d>E.d||!E.d)&&(E=M,i&&console.log("found best %d after %d probes",Math.round(1e4*M.d)/1e4,k)),M.max-E.d<=e||(O=M.h/2,x.push(new nm(M.p.x-O,M.p.y-O,O,s)),x.push(new nm(M.p.x+O,M.p.y-O,O,s)),x.push(new nm(M.p.x-O,M.p.y+O,O,s)),x.push(new nm(M.p.x+O,M.p.y+O,O,s)),k+=4)}return i&&(console.log(`num probes: ${k}`),console.log(`best distance: ${E.d}`)),E.p}function yC(s,e){return e.max-s.max}class nm{constructor(e,i,o,p){this.p=new Wt(e,i),this.h=o,this.d=function(l,f){let w=!1,C=1/0;for(let O=0;O<f.length;O++){const x=f[O];for(let E=0,k=x.length,M=k-1;E<k;M=E++){const P=x[E],R=x[M];P.y>l.y!=R.y>l.y&&l.x<(R.x-P.x)*(l.y-P.y)/(R.y-P.y)+P.x&&(w=!w),C=Math.min(C,Le(l,P,R))}}return(w?1:-1)*Math.sqrt(C)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const iv=Number.POSITIVE_INFINITY,vC=Math.sqrt(2);function s1(s,[e,i]){let o=0,p=0;if(i===iv){e<0&&(e=0);const l=e/vC;switch(s){case"top-right":case"top-left":p=l-7;break;case"bottom-right":case"bottom-left":p=7-l;break;case"bottom":p=7-e;break;case"top":p=e-7}switch(s){case"top-right":case"bottom-right":o=-l;break;case"top-left":case"bottom-left":o=l;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),s){case"top-right":case"top-left":case"top":p=i-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-i}switch(s){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,p]}function rv(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function xC(s,e,i,o,p,l,f,w,C,O,x,E,k,M,P){let R=l.textMaxSize.evaluate(e,{},E);R===void 0?R=f*l.textScaleFactor:R*=l.textScaleFactor;const $=s.layers[0].layout,H=$.get("icon-offset").evaluate(e,{},E),J=a1(i.horizontal)||i.vertical,ee=k.name==="globe",Z=po,ne=f*l.textScaleFactor/Z,le=s.tilePixelRatio*R/Z,fe=(qe=s.overscaling,s.zoom>18&&qe>2&&(qe>>=1),Math.max(ei/(512*qe),1)*$.get("symbol-spacing")),Pe=$.get("text-padding")*s.tilePixelRatio,Ee=$.get("icon-padding")*s.tilePixelRatio,Ce=rr($.get("text-max-angle")),$e=$.get("text-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",Ie=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",Ge=$.get("symbol-placement"),Ze=fe/2;var qe;const et=$.get("icon-text-fit").evaluate(e,{},E),nt=$.get("icon-text-fit-padding").evaluate(e,{},E),ct=et!=="none";let it;s.hasAnyIconTextFit===!1&&ct&&(s.hasAnyIconTextFit=!0),o&&ct&&(s.allowVerticalPlacement&&i.vertical&&(it=Gb(o,i.vertical,et,nt,H,ne)),J&&(o=Gb(o,J,et,nt,H,ne)));const Et=(Nt,Ct,si)=>{if(Ct.x<0||Ct.x>=ei||Ct.y<0||Ct.y>=ei)return;let ti=null;if(ee){const{x:Ht,y:Ut,z:xi}=k.projectTilePoint(Ct.x,Ct.y,si);ti={anchor:new Sh(Ht,Ut,xi,0,void 0),up:k.upVector(si,Ct.x,Ct.y)}}(function(Ht,Ut,xi,ui,mi,Ni,Ki,er,tr,cr,ur,nn,Nr,Hi,Rr,Fr,hn,Zn,hs,Kn,On,as,_s,fo,cn,xa,Rc){const jl=Ht.addToLineVertexArray(Ut,ui);let $l,Kp,kd,Jp,Dg,Uw,jw,$w=0,Hw=0,Gw=0,Ww=0,Bv=-1,Nv=-1;const Au={};let qw=sa("");const Qp=xi?xi.anchor:Ut,Vv=tr.layout.get("icon-text-fit").evaluate(On,{},cn)!=="none";let Uv=0,jv=0;if(tr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Uv,jv]=tr.layout.get("text-offset").evaluate(On,{},cn).map(al=>al*po):(Uv=tr.layout.get("text-radial-offset").evaluate(On,{},cn)*po,jv=iv),Ht.allowVerticalPlacement&&mi.vertical){const al=mi.vertical;if(Rr)Uw=nv(al),er&&(jw=nv(er));else{const ba=tr.layout.get("text-rotate").evaluate(On,{},cn)+90;kd=B_(cr,Qp,Ut,ur,nn,Nr,al,Hi,ba,Fr),er&&(Jp=B_(cr,Qp,Ut,ur,nn,Nr,er,Zn,ba))}}if(Ni){const al=Ht.iconSizeData,ba=tr.layout.get("icon-rotate").evaluate(On,{},cn),Ig=r1(Ni,ba,_s,Vv,as.iconScaleFactor),Hv=er?r1(er,ba,_s,Vv,as.iconScaleFactor):void 0;Kp=B_(cr,Qp,Ut,ur,nn,Nr,Ni,Zn,ba,null),$w=4*Ig.length;let ef=null;al.kind==="source"?(ef=[Dc*tr.layout.get("icon-size").evaluate(On,{},cn)*as.iconScaleFactor],ef[0]>Ad&&qi(`${Ht.layerIds[0]}: Value for "icon-size" is >= ${dg}. Reduce your "icon-size".`)):al.kind==="composite"&&(ef=[Dc*as.compositeIconSizes[0].evaluate(On,{},cn)*as.iconScaleFactor,Dc*as.compositeIconSizes[1].evaluate(On,{},cn)*as.iconScaleFactor],(ef[0]>Ad||ef[1]>Ad)&&qi(`${Ht.layerIds[0]}: Value for "icon-size" is >= ${dg}. Reduce your "icon-size".`)),Ht.addSymbols(Ht.icon,Ig,ef,Kn,hs,On,!1,xi,Ut,jl.lineStartIndex,jl.lineLength,-1,fo,cn,xa,Rc),Bv=Ht.icon.placedSymbolArray.length-1,Hv&&(Hw=4*Hv.length,Ht.addSymbols(Ht.icon,Hv,ef,Kn,hs,On,sl.vertical,xi,Ut,jl.lineStartIndex,jl.lineLength,-1,fo,cn,xa,Rc),Nv=Ht.icon.placedSymbolArray.length-1)}for(const al in mi.horizontal){const ba=mi.horizontal[al];$l||(qw=sa(ba.text),Rr?Dg=nv(ba):$l=B_(cr,Qp,Ut,ur,nn,Nr,ba,Hi,tr.layout.get("text-rotate").evaluate(On,{},cn),Fr));const Ig=ba.positionedLines.length===1;if(Gw+=o1(Ht,xi,Ut,ba,Ki,tr,Rr,On,Fr,jl,mi.vertical?sl.horizontal:sl.horizontalOnly,Ig?Object.keys(mi.horizontal):[al],Au,Bv,as,fo,cn,xa),Ig)break}mi.vertical&&(Ww+=o1(Ht,xi,Ut,mi.vertical,Ki,tr,Rr,On,Fr,jl,sl.vertical,["vertical"],Au,Nv,as,fo,cn,xa));let Od=-1;const $v=(al,ba)=>al?Math.max(al,ba):ba;Od=$v(Dg,Od),Od=$v(Uw,Od),Od=$v(jw,Od);const QE=Od>-1?1:0;Ht.glyphOffsetArray.length>=65535&&qi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),On.sortKey!==void 0&&Ht.addToSortKeyRanges(Ht.symbolInstances.length,On.sortKey),Ht.symbolInstances.emplaceBack(Ut.x,Ut.y,Qp.x,Qp.y,Qp.z,Au.right>=0?Au.right:-1,Au.center>=0?Au.center:-1,Au.left>=0?Au.left:-1,Au.vertical>=0?Au.vertical:-1,Bv,Nv,qw,$l!==void 0?$l:Ht.collisionBoxArray.length,$l!==void 0?$l+1:Ht.collisionBoxArray.length,kd!==void 0?kd:Ht.collisionBoxArray.length,kd!==void 0?kd+1:Ht.collisionBoxArray.length,Kp!==void 0?Kp:Ht.collisionBoxArray.length,Kp!==void 0?Kp+1:Ht.collisionBoxArray.length,Jp||Ht.collisionBoxArray.length,Jp?Jp+1:Ht.collisionBoxArray.length,ur,Gw,Ww,$w,Hw,QE,0,Uv,jv,Od,0,Vv?1:0)})(s,Ct,ti,Nt,i,o,p,it,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,Pe,$e,C,0,Ee,Ie,H,e,l,O,x,E,M,P)};if(Ge==="line")for(const Nt of Kb(e.geometry,0,0,ei,ei)){const Ct=mC(Nt,fe,Ce,i.vertical||J,o,Z,le,s.overscaling,ei);for(const si of Ct)J&&bC(s,J.text,Ze,si)||Et(Nt,si,E)}else if(Ge==="line-center"){for(const Nt of e.geometry)if(Nt.length>1){const Ct=fC(Nt,Ce,i.vertical||J,o,Z,le);Ct&&Et(Nt,Ct,E)}}else if(e.type==="Polygon")for(const Nt of $p(e.geometry,0)){const Ct=_C(Nt,16);Et(Nt[0],new Sh(Ct.x,Ct.y,0,0,void 0),E)}else if(e.type==="LineString")for(const Nt of e.geometry)Et(Nt,new Sh(Nt[0].x,Nt[0].y,0,0,void 0),E);else if(e.type==="Point")for(const Nt of e.geometry)for(const Ct of Nt)Et([Ct],new Sh(Ct.x,Ct.y,0,0,void 0),E)}const dg=255,Ad=dg*Dc;function o1(s,e,i,o,p,l,f,w,C,O,x,E,k,M,P,R,$,H){const J=function(ne,le,fe,Pe,Ee,Ce,$e,Ie){const Ge=[];if(le.positionedLines.length===0)return Ge;const Ze=Pe.layout.get("text-rotate").evaluate(Ce,{})*Math.PI/180,qe=function(Et){const Nt=Et[0],Ct=Et[1],si=Nt*Ct;return si>0?[Nt,-Ct]:si<0?[-Nt,Ct]:Nt===0?[Ct,Nt]:[Ct,-Nt]}(fe);let et=Math.abs(le.top-le.bottom);for(const Et of le.positionedLines)et-=Et.lineOffset;const nt=le.positionedLines.length,ct=et/nt;let it=le.top-fe[1];for(let Et=0;Et<nt;++Et){const Nt=le.positionedLines[Et];it=gC(le,ct,it,Et);for(const Ct of Nt.positionedGlyphs){if(!Ct.rect)continue;const si=Ct.rect||{};let ti=uC+1,Ht=!0,Ut=1,xi=0;if(Ct.imageName){const Kn=$e[ks.build(Ct.imageName).getSerializedPrimary()];if(!Kn)continue;if(Kn.sdf){qi("SDF images are not supported in formatted text and will be ignored.");continue}Ht=!1,Ut=Kn.pixelRatio,ti=ug/Ut}const ui=(Ee||Ie)&&Ct.vertical,mi=Ct.metrics.advance*Ct.scale/2,Ni=Ct.metrics,Ki=Ct.rect;if(Ki===null)continue;Ie&&le.verticalizable&&(xi=Ct.imageName?mi-Ct.metrics.width*Ct.scale/2:0);const er=Ee?[Ct.x+mi,Ct.y]:[0,0];let tr=[0,0],cr=[0,0],ur=!1;Ee||(ui?(cr=[Ct.x+mi+qe[0],Ct.y+qe[1]-xi],ur=!0):tr=[Ct.x+mi+fe[0],Ct.y+fe[1]-xi]);const nn=Ki.w*Ct.scale/(Ut*(Ct.localGlyph?Ic:1)),Nr=Ki.h*Ct.scale/(Ut*(Ct.localGlyph?Ic:1));let Hi,Rr,Fr,hn;if(ui){const Kn=Ct.y-it,On=new Wt(-mi,mi-Kn),as=-Math.PI/2,_s=new Wt(...cr);Hi=new Wt(-mi+tr[0],tr[1]),Hi._rotateAround(as,On)._add(_s),Hi.x+=-Kn+mi,Hi.y-=(Ni.left-ti)*Ct.scale;const fo=Ct.imageName?Ni.advance*Ct.scale:po*Ct.scale,cn=String.fromCodePoint(Ct.glyph);nC(cn)?Hi.x+=(1-ti)*Ct.scale:sC(cn)?Hi.x+=fo-Ni.height*Ct.scale+(-ti-1)*Ct.scale:Hi.x+=Ct.imageName||Ni.width+2*ti===Ki.w&&Ni.height+2*ti===Ki.h?(fo-Nr)/2:(fo-(Ni.height+2*ti)*Ct.scale)/2,Rr=new Wt(Hi.x,Hi.y-nn),Fr=new Wt(Hi.x+Nr,Hi.y),hn=new Wt(Hi.x+Nr,Hi.y-nn)}else{const Kn=(Ni.left-ti)*Ct.scale-mi+tr[0],On=(-Ni.top-ti)*Ct.scale+tr[1],as=Kn+nn,_s=On+Nr;Hi=new Wt(Kn,On),Rr=new Wt(as,On),Fr=new Wt(Kn,_s),hn=new Wt(as,_s)}if(Ze){let Kn;Kn=Ee?new Wt(0,0):ur?new Wt(qe[0],qe[1]):new Wt(fe[0],fe[1]),Hi._rotateAround(Ze,Kn),Rr._rotateAround(Ze,Kn),Fr._rotateAround(Ze,Kn),hn._rotateAround(Ze,Kn)}const Zn=new Wt(0,0),hs=new Wt(0,0);Ge.push({tl:Hi,tr:Rr,bl:Fr,br:hn,texPrimary:si,texSecondary:void 0,writingMode:le.writingMode,glyphOffset:er,sectionIndex:Ct.sectionIndex,isSDF:Ht,pixelOffsetTL:Zn,pixelOffsetBR:hs,minFontScaleX:0,minFontScaleY:0})}}return Ge}(0,o,C,l,f,w,p,s.allowVerticalPlacement),ee=s.textSizeData;let Z=null;ee.kind==="source"?(Z=[Dc*l.layout.get("text-size").evaluate(w,{},$)*P.textScaleFactor],Z[0]>Ad&&qi(`${s.layerIds[0]}: Value for "text-size" is >= ${dg}. Reduce your "text-size".`)):ee.kind==="composite"&&(Z=[Dc*P.compositeTextSizes[0].evaluate(w,{},$)*P.textScaleFactor,Dc*P.compositeTextSizes[1].evaluate(w,{},$)*P.textScaleFactor],(Z[0]>Ad||Z[1]>Ad)&&qi(`${s.layerIds[0]}: Value for "text-size" is >= ${dg}. Reduce your "text-size".`)),s.addSymbols(s.text,J,Z,C,f,w,x,e,i,O.lineStartIndex,O.lineLength,M,R,$,H,!1);for(const ne of E)k[ne]=s.text.placedSymbolArray.length-1;return 4*J.length}function a1(s){for(const e in s)return s[e];return null}function B_(s,e,i,o,p,l,f,w,C,O){let x=f.top,E=f.bottom,k=f.left,M=f.right;const P=f.collisionPadding;if(P&&(k-=P[0],x-=P[1],M+=P[2],E+=P[3]),C){const R=new Wt(k,x),$=new Wt(M,x),H=new Wt(k,E),J=new Wt(M,E),ee=rr(C);let Z=new Wt(0,0);O&&(Z=new Wt(O[0],O[1])),R._rotateAround(ee,Z),$._rotateAround(ee,Z),H._rotateAround(ee,Z),J._rotateAround(ee,Z),k=Math.min(R.x,$.x,H.x,J.x),M=Math.max(R.x,$.x,H.x,J.x),x=Math.min(R.y,$.y,H.y,J.y),E=Math.max(R.y,$.y,H.y,J.y)}return s.emplaceBack(e.x,e.y,e.z,i.x,i.y,k,x,M,E,w,o,p,l),s.length-1}function nv(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const e=s.bottom-s.top;return e>0?Math.max(10,e):null}function bC(s,e,i,o){const p=s.compareText;if(e in p){const l=p[e];for(let f=l.length-1;f>=0;f--)if(o.dist(l[f])<i)return!0}else p[e]=[];return p[e].push(o),!1}function l1(s,e){const i=s.fovAboveCenter,o=s.elevation?s.elevation.getMinElevationBelowMSL()*e:0,p=(s._camera.position[2]*s.worldSize-o)/Math.cos(s._pitch),l=Math.sin(i)*p/Math.sin(Math.max(Math.PI/2-s._pitch-i,.01));let f=Math.sin(s._pitch)*l+p;const w=p*(1/s._horizonShift);if(!s.elevation||s.elevation.exaggeration()===0){let C=Math.max(s.zoom-17,0);s.isOrthographic&&(C/=10),f*=1+C}return Math.min(1.01*f,w)}function pg(s,e){if(!e.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:e};const i=Math.pow(2,-s.z),o=s.x*i,p=(s.x+1)*i,l=s.y*i,f=(s.y+1)*i,w=co(o),C=co(p),O=Wn(l),x=Wn(f),E=e.project(w,O),k=e.project(C,O),M=e.project(C,x),P=e.project(w,x);let R=Math.min(E.x,k.x,M.x,P.x),$=Math.min(E.y,k.y,M.y,P.y),H=Math.max(E.x,k.x,M.x,P.x),J=Math.max(E.y,k.y,M.y,P.y);const ee=i/16;function Z(le,fe,Pe,Ee,Ce,$e){const Ie=(Pe+Ce)/2,Ge=(Ee+$e)/2,Ze=e.project(co(Ie),Wn(Ge)),qe=Math.max(0,R-Ze.x,$-Ze.y,Ze.x-H,Ze.y-J);R=Math.min(R,Ze.x),H=Math.max(H,Ze.x),$=Math.min($,Ze.y),J=Math.max(J,Ze.y),qe>ee&&(Z(le,Ze,Pe,Ee,Ie,Ge),Z(Ze,fe,Ie,Ge,Ce,$e))}Z(E,k,o,l,p,l),Z(k,M,p,l,p,f),Z(M,P,p,f,o,f),Z(P,E,o,f,o,l),R-=ee,$-=ee,H+=ee,J+=ee;const ne=1/Math.max(H-R,J-$);return{scale:ne,x:R*ne,y:$*ne,x2:H*ne,y2:J*ne,projection:e}}function c1(s,{x:e,y:i},o=0){return new Wt(((e-o)*s.scale-s.x)*ei,(i*s.scale-s.y)*ei)}const wC=Ye.mat4.identity(new Float32Array(16));class Pd{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Cr(0,0)}projectTilePoint(e,i,o){return{x:e,y:i,z:0}}locationPoint(e,i,o=!0){return e._coordinatePoint(e.locationCoordinate(i),o)}pixelsPerMeter(e,i){return to(1,e)*i}pixelSpaceConversion(e,i,o){return 1}farthestPixelDistance(e){return l1(e,e.pixelsPerMeter)}pointCoordinate(e,i,o,p){const l=e.horizonLineFromTop(!1),f=new Wt(i,Math.max(l,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,p))}pointCoordinate3D(e,i,o){const p=new Wt(i,o);if(e.elevation)return e.elevation.pointCoordinate(p);{const l=this.pointCoordinate(e,p.x,p.y,0);return[l.x,l.y,l.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const o=e.horizonLineFromTop();return i.y<o}createInversionMatrix(e,i){return wC}createTileMatrix(e,i,o){let p,l,f;const w=o.canonical,C=Ye.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const O=pg(w,this);p=1,l=O.x+o.wrap*O.scale,f=O.y,Ye.mat4.scale(C,C,[p/O.scale,p/O.scale,e.pixelsPerMeter/i])}else p=i/e.zoomScale(w.z),l=(w.x+Math.pow(2,w.z)*o.wrap)*p,f=w.y*p;return Ye.mat4.translate(C,C,[l,f,0]),Ye.mat4.scale(C,C,[p/ei,p/ei,1]),C}upVector(e,i,o){return[0,0,1]}upVectorScale(e,i,o){return{metersToTile:1}}}class SC extends Pd{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,o]=this.parallels=e.parallels||[29.5,45.5],p=Math.sin(rr(i));this.n=(p+Math.sin(rr(o)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:o,c:p,r0:l}=this,f=rr(e-this.center[0]),w=rr(i),C=Math.sqrt(p-2*o*Math.sin(w))/o;return{x:C*Math.sin(f*o),y:C*Math.cos(f*o)-l,z:0}}unproject(e,i){const{n:o,c:p,r0:l}=this,f=l+i;let w=Math.atan2(e,Math.abs(f))*Math.sign(f);f*o<0&&(w-=Math.PI*Math.sign(e)*Math.sign(f));const C=rr(this.center[0])*o;w=ra(w,-Math.PI-C,Math.PI-C);const O=nr($n(w/o)+this.center[0],-180,180),x=Math.asin(nr((p-(e*e+f*f)*o*o)/(2*o),-1,1)),E=nr($n(x),-85.051129,uo);return new Cr(O,E)}}const fg=1.340264,mg=-.081106,gg=893e-6,_g=.003796,N_=Math.sqrt(3)/2;class TC extends Pd{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(N_*Math.sin(i)),p=o*o,l=p*p*p;return{x:.5*(e*Math.cos(o)/(N_*(fg+3*mg*p+l*(7*gg+9*_g*p)))/Math.PI+.5),y:1-.5*(o*(fg+mg*p+l*(gg+_g*p))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,p=o*o,l=p*p*p;for(let x,E,k,M=0;M<12&&(E=o*(fg+mg*p+l*(gg+_g*p))-i,k=fg+3*mg*p+l*(7*gg+9*_g*p),x=E/k,o=nr(o-x,-Math.PI/3,Math.PI/3),p=o*o,l=p*p*p,!(Math.abs(x)<1e-12));++M);const f=N_*e*(fg+3*mg*p+l*(7*gg+9*_g*p))/Math.cos(o),w=Math.asin(Math.sin(o)/N_),C=nr(180*f/Math.PI,-180,180),O=nr(180*w/Math.PI,-85.051129,uo);return new Cr(C,O)}}class MC extends Pd{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const o=360*(e-.5),p=nr(360*(.5-i),-85.051129,uo);return new Cr(o,p)}}const sm=Math.PI/2;function V_(s){return Math.tan((sm+s)/2)}class CC extends Pd{constructor(e){super(e),this.center=e.center||[0,30];const[i,o]=this.parallels=e.parallels||[30,30];let p=rr(i),l=rr(o);this.southernCenter=p+l<0,this.southernCenter&&(p=-p,l=-l);const f=Math.cos(p),w=V_(p);this.n=p===l?Math.sin(p):Math.log(f/Math.cos(l))/Math.log(V_(l)/w),this.f=f*Math.pow(V_(p),this.n)/this.n}project(e,i){i=rr(i),this.southernCenter&&(i=-i),e=rr(e-this.center[0]);const o=1e-6,{n:p,f:l}=this;l>0?i<-sm+o&&(i=-sm+o):i>sm-o&&(i=sm-o);const f=l/Math.pow(V_(i),p);let w=f*Math.sin(p*e),C=l-f*Math.cos(p*e);return w=.5*(w/Math.PI+.5),C=.5*(C/Math.PI+.5),{x:w,y:this.southernCenter?C:1-C,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:o,f:p}=this,l=p-i,f=Math.sign(l),w=Math.sign(o)*Math.sqrt(e*e+l*l);let C=Math.atan2(e,Math.abs(l))*f;l*o<0&&(C-=Math.PI*Math.sign(e)*f);const O=nr($n(C/o)+this.center[0],-180,180),x=nr($n(2*Math.atan(Math.pow(p/w,1/o))-sm),-85.051129,uo);return new Cr(O,this.southernCenter?-x:x)}}class u1 extends Pd{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:_a(e),y:ya(i),z:0}}unproject(e,i){const o=co(e),p=Wn(i);return new Cr(o,p)}}const h1=rr(uo);class EC extends Pd{project(e,i){const o=(i=rr(i))*i,p=o*o;return{x:.5*((e=rr(e))*(.8707-.131979*o+p*(p*(.003971*o-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+p*(.028874*o-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,p=25,l=0,f=o*o;do{f=o*o;const O=f*f;l=(o*(1.007226+f*(.015085+O*(.028874*f-.044475-.005916*O)))-i)/(1.007226+f*(.045255+O*(.259866*f-.311325-.005916*11*O))),o=nr(o-l,-h1,h1)}while(Math.abs(l)>1e-6&&--p>0);f=o*o;const w=nr($n(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),C=$n(o);return new Cr(w,C)}}const d1=rr(uo);class AC extends Pd{project(e,i){i=rr(i),e=rr(e);const o=Math.cos(i),p=2/Math.PI,l=Math.acos(o*Math.cos(e/2)),f=Math.sin(l)/l,w=.5*(e*p+2*o*Math.sin(e/2)/f)||0,C=.5*(i+Math.sin(i)/f)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(C/Math.PI+1),z:0}}unproject(e,i){let o=e=(2*e-.5)*Math.PI,p=i=(2*(1-i)-1)*Math.PI,l=25;const f=1e-6;let w=0,C=0;do{const O=Math.cos(p),x=Math.sin(p),E=2*x*O,k=x*x,M=O*O,P=Math.cos(o/2),R=Math.sin(o/2),$=2*P*R,H=R*R,J=1-M*P*P,ee=J?1/J:0,Z=J?Math.acos(O*P)*Math.sqrt(1/J):0,ne=.5*(2*Z*O*R+2*o/Math.PI)-e,le=.5*(Z*x+p)-i,fe=.5*ee*(M*H+Z*O*P*k)+1/Math.PI,Pe=ee*($*E/4-Z*x*R),Ee=.125*ee*(E*R-Z*x*M*$),Ce=.5*ee*(k*P+Z*H*O)+.5,$e=Pe*Ee-Ce*fe;w=(le*Pe-ne*Ce)/$e,C=(ne*Ee-le*fe)/$e,o=nr(o-w,-Math.PI,Math.PI),p=nr(p-C,-d1,d1)}while((Math.abs(w)>f||Math.abs(C)>f)&&--l>0);return new Cr($n(o),$n(p))}}class p1 extends Pd{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(rr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:o,cosPhi:p}=this;return{x:rr(e)*p*o+.5,y:-Math.sin(rr(i))/p*o+.5,z:0}}unproject(e,i){const{scale:o,cosPhi:p}=this,l=-(i-.5)/o,f=nr($n((e-.5)/o)/p,-180,180),w=Math.asin(nr(l*p,-1,1)),C=nr($n(w),-85.051129,uo);return new Cr(f,C)}}class PC extends u1{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,o){const p=Br(e,i,o),l=Yn(Tn(o));return Ye.vec3.transformMat4(p,p,l),{x:p[0],y:p[1],z:p[2]}}locationPoint(e,i){const o=ga(i.lat,i.lng),p=Ye.vec3.normalize([],o),l=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,f=to(1,0)*ei*l;Ye.vec3.scaleAndAdd(o,o,p,f);const w=Ye.mat4.identity(new Float64Array(16));return Ye.mat4.multiply(w,e.pixelMatrix,e.globeMatrix),Ye.vec3.transformMat4(o,o,w),new Wt(o[0],o[1])}pixelsPerMeter(e,i){return to(1,0)*i}pixelSpaceConversion(e,i,o){const p=to(1,e)*i,l=Di(to(1,45)*i,p,o);return this.pixelsPerMeter(e,i)/l}createTileMatrix(e,i,o){const p=jr(Tn(o.canonical));return Ye.mat4.multiply(new Float64Array(16),e.globeMatrix,p)}createInversionMatrix(e,i){const{center:o}=e,p=Yn(Tn(i));return Ye.mat4.rotateY(p,p,rr(o.lng)),Ye.mat4.rotateX(p,p,rr(o.lat)),Ye.mat4.scale(p,p,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(e,i,o,p){return Mr(e,i,o,!0)||new n(0,0)}pointCoordinate3D(e,i,o){const p=this.pointCoordinate(e,i,o,0);return[p.x,p.y,p.z]}isPointAboveHorizon(e,i){return!Mr(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(p,l){const f=p.cameraToCenterDistance,w=p._centerAltitude*l,C=p._camera,O=p._camera.forward(),x=Ye.vec3.add([],Ye.vec3.scale([],O,-f),[0,0,w]),E=p.worldSize/(2*Math.PI),k=[0,0,-E],M=p.width/p.height,P=Math.tan(p.fovAboveCenter),R=Ye.vec3.scale([],C.up(),P),$=Ye.vec3.scale([],C.right(),P*M),H=Ye.vec3.normalize([],Ye.vec3.add([],Ye.vec3.add([],O,R),$)),J=[];let ee;if(new ji(x,H).closestPointOnSphere(k,E,J)){const Z=Ye.vec3.add([],J,k),ne=Ye.vec3.sub([],Z,x);ee=Math.cos(p.fovAboveCenter)*Ye.vec3.length(ne)}else{const Z=Ye.vec3.sub([],x,k),ne=Ye.vec3.sub([],k,x);Ye.vec3.normalize(ne,ne);const le=Ye.vec3.length(Z)-E;ee=Math.sqrt(le*(le+2*E));const fe=Math.acos(ee/(E+le))-Math.acos(Ye.vec3.dot(O,ne));ee*=Math.cos(fe)}return 1.01*ee}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=ho(e.zoom);if(o>0){const p=l1(e,to(1,e.center.lat)*e.worldSize),l=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Di(i,p+l*(1-Math.cos(f)),Math.pow(o,10))}return i}upVector(e,i,o){return Br(i,o,e,1)}upVectorScale(e){return{metersToTile:or(mr(Tn(e)))}}}function f1(s){const e=s.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(s.name){case"mercator":return new u1(s);case"equirectangular":return new MC(s);case"naturalEarth":return new EC(s);case"equalEarth":return new TC(s);case"winkelTripel":return new AC(s);case"albers":return i?new p1(s):new SC(s);case"lambertConformalConic":return i?new p1(s):new CC(s);case"globe":return new PC(s)}throw new Error(`Invalid projection name: ${s.name}`)}const DC=be.VectorTileFeature.types,IC=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function U_(s,e,i,o,p,l,f,w,C,O,x,E,k){const M=w?Math.min(Ad,Math.round(w[0])):0,P=w?Math.min(Ad,Math.round(w[1])):0;s.emplaceBack(e,i,Math.round(32*o),Math.round(32*p),l,f,(M<<1)+(C?1:0),P,16*O,16*x,256*E,256*k)}function j_(s,e,i){s.emplaceBack(e,i)}function $_(s,e,i,o,p,l,f){s.emplaceBack(e,i,o,p,l,f)}function H_(s,e,i,o,p){s.emplaceBack(e,i,o,p),s.emplaceBack(e,i,o,p),s.emplaceBack(e,i,o,p),s.emplaceBack(e,i,o,p)}function kC(s){for(const e of s.sections)if(gc(e.text))return!0;return!1}class sv{constructor(e){this.layoutVertexArray=new Il,this.indexArray=new gs,this.programConfigurations=e,this.segments=new Sn,this.dynamicLayoutVertexArray=new ln,this.opacityVertexArray=new wp,this.placedSymbolArray=new Wf,this.iconTransitioningVertexArray=new Ja,this.globeExtVertexArray=new fh,this.zOffsetVertexArray=new mh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,o,p,l){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,YM.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,ZM.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,IC,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,JM.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,XM.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||l)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,KM.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||p)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}_i(sv,"SymbolBuffers");class ov{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new Sn,this.collisionVertexArray=new Tp,this.collisionVertexArrayExt=new ln}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,QM.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,eC.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}_i(ov,"CollisionBuffers");class G_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ye.mat4.identity([]),this.placementViewportMatrix=Ye.mat4.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=X0(this.zoom,i["text-size"]),this.iconSizeData=X0(this.zoom,i["icon-size"]);const o=this.layers[0].layout,p=o.get("symbol-sort-key"),l=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=l!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(l==="viewport-y"||l==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(f=>sl[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=o.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new sv(new ma(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new sv(new ma(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new gd,this.lineVertexArray=new qf,this.symbolInstances=new Pp}calculateGlyphDependencies(e,i,o,p,l){for(const f of e){const w=f.codePointAt(0);if(w===void 0)break;if(i[w]=!0,p&&l&&w<=65535){const C=lg[f];C&&(i[C.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!gi(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}populate(e,i,o,p){const l=this.layers[0],f=l.layout,w=this.projection.name==="globe",C=f.get("text-font"),O=f.get("text-field"),x=f.get("icon-image"),[E,k]=f.get("icon-size-scale-range"),M=nr(i.scaleFactor||1,E,k),P=(O.value.kind!=="constant"||O.value.value instanceof Is&&!O.value.value.isEmpty()||O.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),R=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,$=f.get("symbol-sort-key");if(this.features=[],!P&&!R)return;const H=i.iconDependencies,J=i.glyphDependencies,ee=i.availableImages,Z=new Vr(this.zoom);for(const{feature:ne,id:le,index:fe,sourceLayerIndex:Pe}of e){const Ee=l._featureFilter.needGeometry,Ce=G(ne,Ee);if(!l._featureFilter.filter(Z,Ce,o))continue;if(Ee||(Ce.geometry=j(ne,o,p)),w&&ne.type!==1&&o.z<=5){const qe=Ce.geometry,et=.98078528056,nt=(ct,it)=>{const Et=Br(ct.x,ct.y,o,1),Nt=Br(it.x,it.y,o,1);return Ye.vec3.dot(Et,Nt)<et};for(let ct=0;ct<qe.length;ct++)qe[ct]=T(qe[ct],nt)}let $e,Ie;if(P){const qe=l.getValueAndResolveTokens("text-field",Ce,o,ee),et=Is.factory(qe);kC(et)&&(this.hasRTLText=!0),(!this.hasRTLText||lh()==="unavailable"||this.hasRTLText&&Qs.isParsed())&&($e=rC(et,l,Ce))}if(R){const qe=l.getValueAndResolveTokens("icon-image",Ce,o,ee);Ie=qe instanceof ks?qe:ks.build(qe)}if(!$e&&!Ie)continue;const Ge=this.sortFeaturesByKey?$.evaluate(Ce,{},o):void 0,Ze={id:le,text:$e,icon:Ie,index:fe,sourceLayerIndex:Pe,geometry:Ce.geometry,properties:ne.properties,type:DC[ne.type],sortKey:Ge};if(this.features.push(Ze),Ie){const qe=Y0(this.iconSizeData,this.layers[0]._unevaluatedLayout._values["icon-size"],o,this.zoom,Ze)*M*this.pixelRatio,et=Ie.getPrimary().scaleSelf(qe);if(H[et.id]=H[et.id]||[],H[et.id].push(et),Ie.nameSecondary){const nt=Ie.getSecondary().scaleSelf(qe);H[nt.id]=H[nt.id]||[],H[nt.id].push(nt)}}if($e){const qe=C.evaluate(Ce,{},o).join(","),et=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(sl.vertical)>=0;for(const nt of $e.sections)if(nt.image){const ct=nt.image.getPrimary().scaleSelf(this.pixelRatio);H[ct.id]=H[ct.id]||[],H[ct.id].push(ct)}else{const ct=Ba($e.toString()),it=nt.fontStack||qe,Et=J[it]=J[it]||{};this.calculateGlyphDependencies(nt.text,Et,et,this.allowVerticalPlacement,ct)}}}f.get("symbol-placement")==="line"&&(this.features=function(ne){const le={},fe={},Pe=[];let Ee=0;function Ce(Ze){Pe.push(ne[Ze]),Ee++}function $e(Ze,qe,et){const nt=fe[Ze];return delete fe[Ze],fe[qe]=nt,Pe[nt].geometry[0].pop(),Pe[nt].geometry[0]=Pe[nt].geometry[0].concat(et[0]),nt}function Ie(Ze,qe,et){const nt=le[qe];return delete le[qe],le[Ze]=nt,Pe[nt].geometry[0].shift(),Pe[nt].geometry[0]=et[0].concat(Pe[nt].geometry[0]),nt}function Ge(Ze,qe,et){const nt=et?qe[0][qe[0].length-1]:qe[0][0];return`${Ze}:${nt.x}:${nt.y}`}for(let Ze=0;Ze<ne.length;Ze++){const qe=ne[Ze],et=qe.geometry,nt=qe.text?qe.text.toString():null;if(!nt){Ce(Ze);continue}const ct=Ge(nt,et),it=Ge(nt,et,!0);if(ct in fe&&it in le&&fe[ct]!==le[it]){const Et=Ie(ct,it,et),Nt=$e(ct,it,Pe[Et].geometry);delete le[ct],delete fe[it],fe[Ge(nt,Pe[Nt].geometry,!0)]=Nt,Pe[Et].geometry=null}else ct in fe?$e(ct,it,et):it in le?Ie(ct,it,et):(Ce(Ze),le[ct]=Ee-1,fe[it]=Ee-1)}return Pe.filter(Ze=>Ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ne,le)=>ne.sortKey-le.sortKey)}update(e,i,o,p,l,f,w){this.text.programConfigurations.updatePaintArrays(e,i,l,o,p,f,w),this.icon.programConfigurations.updatePaintArrays(e,i,l,o,p,f,w)}updateZOffset(){const e=(l,f,w)=>{o+=f,o>l.length&&l.resize(o);for(let C=-f;C<0;C++)l.emplace(C+o,w)},i=(l,f,w)=>{p+=f,p>l.length&&l.resize(p);for(let C=-f;C<0;C++)l.emplace(C+p,w)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,p=0;for(let l=0;l<this.symbolInstances.length;l++){const f=this.symbolInstances.get(l),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:C,numIconVertices:O}=f,x=f.zOffset,E=O>0;if((w>0||C>0)&&(e(this.text.zOffsetVertexArray,w,x),e(this.text.zOffsetVertexArray,C,x)),E){const{placedIconSymbolIndex:k,verticalPlacedIconSymbolIndex:M}=f;k>=0&&i(this.icon.zOffsetVertexArray,O,x),M>=0&&i(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,x)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=f1(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:p,y:l}of i)this.lineVertexArray.emplaceBack(p,l);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,p,l,f,w,C,O,x,E,k,M,P,R,$){const H=e.indexArray,J=e.layoutVertexArray,ee=e.globeExtVertexArray,Z=e.segments.prepareSegment(4*i.length,J,H,this.canOverlap?f.sortKey:void 0),ne=this.glyphOffsetArray.length,le=Z.vertexLength,fe=this.allowVerticalPlacement&&w===sl.vertical?Math.PI/2:0,Pe=f.text&&f.text.sections;for(let Ce=0;Ce<i.length;Ce++){const{tl:$e,tr:Ie,bl:Ge,br:Ze,texPrimary:qe,texSecondary:et,pixelOffsetTL:nt,pixelOffsetBR:ct,minFontScaleX:it,minFontScaleY:Et,glyphOffset:Nt,isSDF:Ct,sectionIndex:si}=i[Ce],ti=Z.vertexLength,Ht=Nt[1];if(U_(J,O.x,O.y,$e.x,Ht+$e.y,qe.x,qe.y,o,Ct,nt.x,nt.y,it,Et),U_(J,O.x,O.y,Ie.x,Ht+Ie.y,qe.x+qe.w,qe.y,o,Ct,ct.x,nt.y,it,Et),U_(J,O.x,O.y,Ge.x,Ht+Ge.y,qe.x,qe.y+qe.h,o,Ct,nt.x,ct.y,it,Et),U_(J,O.x,O.y,Ze.x,Ht+Ze.y,qe.x+qe.w,qe.y+qe.h,o,Ct,ct.x,ct.y,it,Et),C){const{x:Ut,y:xi,z:ui}=C.anchor,[mi,Ni,Ki]=C.up;$_(ee,Ut,xi,ui,mi,Ni,Ki),$_(ee,Ut,xi,ui,mi,Ni,Ki),$_(ee,Ut,xi,ui,mi,Ni,Ki),$_(ee,Ut,xi,ui,mi,Ni,Ki),H_(e.dynamicLayoutVertexArray,Ut,xi,ui,fe)}else H_(e.dynamicLayoutVertexArray,O.x,O.y,O.z,fe);if($){const Ut=et||qe;j_(e.iconTransitioningVertexArray,Ut.x,Ut.y),j_(e.iconTransitioningVertexArray,Ut.x+Ut.w,Ut.y),j_(e.iconTransitioningVertexArray,Ut.x,Ut.y+Ut.h),j_(e.iconTransitioningVertexArray,Ut.x+Ut.w,Ut.y+Ut.h)}H.emplaceBack(ti,ti+1,ti+2),H.emplaceBack(ti+1,ti+2,ti+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Nt[0]),Ce!==i.length-1&&si===i[Ce+1].sectionIndex||e.programConfigurations.populatePaintArrays(J.length,f,f.index,{},M,P,R,Pe&&Pe[si])}const Ee=C?C.anchor:O;e.placedSymbolArray.emplaceBack(Ee.x,Ee.y,Ee.z,O.x,O.y,ne,this.glyphOffsetArray.length-ne,le,x,E,O.segment,o?o[0]:0,o?o[1]:0,p[0],p[1],w,0,!1,0,k,0)}_commitLayoutVertex(e,i,o,p,l,f,w){e.emplaceBack(i,o,p,l,f,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(e,i,o,p,l,f,w){const C=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),O=C.vertexLength,x=w.tileAnchorX,E=w.tileAnchorY;for(let M=0;M<4;M++)o.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,e.padding,w.zOffset),this._commitLayoutVertex(o.layoutVertexArray,p,l,f,x,E,new Wt(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,p,l,f,x,E,new Wt(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,p,l,f,x,E,new Wt(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,p,l,f,x,E,new Wt(e.x1,e.y2)),C.vertexLength+=4;const k=o.indexArray;k.emplaceBack(O,O+1),k.emplaceBack(O+1,O+2),k.emplaceBack(O+2,O+3),k.emplaceBack(O+3,O),C.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,p,l,f){for(let w=p;w<l;w++){const C=o.get(w),O=this.getSymbolInstanceTextSize(e,f,i,w);this._addCollisionDebugVertices(C,O,this.textCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,i,o,p,l,f){for(let w=p;w<l;w++){const C=o.get(w),O=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._addCollisionDebugVertices(C,O,this.iconCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,i,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ov(eo,zb.members,Ja),this.iconCollisionBox=new ov(eo,zb.members,Ja);const p=tm(this.iconSizeData,e),l=tm(this.textSizeData,e,o);for(let f=0;f<this.symbolInstances.length;f++){const w=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(l,e,i,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(l,e,i,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(p,e,i,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(p,e,i,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(e,i,o,p){const l=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:p),f=I_(this.textSizeData,e,l)/po;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,i,o){const p=this.icon.placedSymbolArray.get(o),l=I_(this.iconSizeData,e,p);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(e,i,o,p){e.emplaceBack(i,-o,-o,p),e.emplaceBack(i,o,-o,p),e.emplaceBack(i,o,o,p),e.emplaceBack(i,-o,o,p)}_updateTextDebugCollisionBoxes(e,i,o,p,l,f,w){for(let C=p;C<l;C++){const O=o.get(C),x=this.getSymbolInstanceTextSize(e,f,i,C);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,O.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,i,o,p,l,f,w){for(let C=p;C<l;C++){const O=o.get(C),x=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,O.padding,f.zOffset)}}updateCollisionDebugBuffers(e,i,o,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=tm(this.iconSizeData,e,p),f=tm(this.textSizeData,e,o);for(let w=0;w<this.symbolInstances.length;w++){const C=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(f,e,i,C.textBoxStartIndex,C.textBoxEndIndex,C,o),this._updateTextDebugCollisionBoxes(f,e,i,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C,o),this._updateIconDebugCollisionBoxes(l,e,i,C.iconBoxStartIndex,C.iconBoxEndIndex,C,p),this._updateIconDebugCollisionBoxes(l,e,i,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,p,l,f,w,C,O){const x={};if(i<o){const{x1:E,y1:k,x2:M,y2:P,padding:R,projectedAnchorX:$,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:Z,featureIndex:ne}=e.get(i);x.textBox={x1:E,y1:k,x2:M,y2:P,padding:R,projectedAnchorX:$,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:Z},x.textFeatureIndex=ne}if(p<l){const{x1:E,y1:k,x2:M,y2:P,padding:R,projectedAnchorX:$,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:Z,featureIndex:ne}=e.get(p);x.verticalTextBox={x1:E,y1:k,x2:M,y2:P,padding:R,projectedAnchorX:$,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:Z},x.verticalTextFeatureIndex=ne}if(f<w){const{x1:E,y1:k,x2:M,y2:P,padding:R,projectedAnchorX:$,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:Z,featureIndex:ne}=e.get(f);x.iconBox={x1:E,y1:k,x2:M,y2:P,padding:R,projectedAnchorX:$,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:Z},x.iconFeatureIndex=ne}if(C<O){const{x1:E,y1:k,x2:M,y2:P,padding:R,projectedAnchorX:$,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:Z,featureIndex:ne}=e.get(C);x.verticalIconBox={x1:E,y1:k,x2:M,y2:P,padding:R,projectedAnchorX:$,projectedAnchorY:H,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:Z},x.verticalIconFeatureIndex=ne}return x}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),p=o.vertexStartIndex+4*o.numGlyphs;for(let l=o.vertexStartIndex;l<p;l+=4)e.indexArray.emplaceBack(l,l+1,l+2),e.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),p=[],l=[],f=[];for(let w=0;w<this.symbolInstances.length;++w){f.push(w);const C=this.symbolInstances.get(w);p.push(0|Math.round(i*C.tileAnchorX+o*C.tileAnchorY)),l.push(C.featureIndex)}return f.sort((w,C)=>p[w]-p[C]||l[C]-l[w]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:l,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:O}=o;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),l>=0&&l!==p&&this.addIndicesForPlacedSymbol(this.text,l),f>=0&&f!==l&&f!==p&&this.addIndicesForPlacedSymbol(this.text,f),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C),O>=0&&this.addIndicesForPlacedSymbol(this.icon,O)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let m1,g1,av;_i(G_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),G_.addDynamicAttributes=H_;class _1{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ha,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}_i(_1,"FormatSectionOverride",{omit:["defaultValue"]});const lv=()=>av||(av={layout:m1||(m1=new on({"symbol-placement":new Gt(dt.layout_symbol["symbol-placement"]),"symbol-spacing":new Gt(dt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Gt(dt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new li(dt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Gt(dt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Gt(dt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Gt(dt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Gt(dt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Gt(dt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Gt(dt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Gt(dt.layout_symbol["icon-rotation-alignment"]),"icon-size":new li(dt.layout_symbol["icon-size"]),"icon-size-scale-range":new Gt(dt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new li(dt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new li(dt.layout_symbol["icon-text-fit-padding"]),"icon-image":new li(dt.layout_symbol["icon-image"]),"icon-rotate":new li(dt.layout_symbol["icon-rotate"]),"icon-padding":new Gt(dt.layout_symbol["icon-padding"]),"icon-keep-upright":new Gt(dt.layout_symbol["icon-keep-upright"]),"icon-offset":new li(dt.layout_symbol["icon-offset"]),"icon-anchor":new li(dt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Gt(dt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Gt(dt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Gt(dt.layout_symbol["text-rotation-alignment"]),"text-field":new li(dt.layout_symbol["text-field"]),"text-font":new li(dt.layout_symbol["text-font"]),"text-size":new li(dt.layout_symbol["text-size"]),"text-size-scale-range":new Gt(dt.layout_symbol["text-size-scale-range"]),"text-max-width":new li(dt.layout_symbol["text-max-width"]),"text-line-height":new li(dt.layout_symbol["text-line-height"]),"text-letter-spacing":new li(dt.layout_symbol["text-letter-spacing"]),"text-justify":new li(dt.layout_symbol["text-justify"]),"text-radial-offset":new li(dt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Gt(dt.layout_symbol["text-variable-anchor"]),"text-anchor":new li(dt.layout_symbol["text-anchor"]),"text-max-angle":new Gt(dt.layout_symbol["text-max-angle"]),"text-writing-mode":new Gt(dt.layout_symbol["text-writing-mode"]),"text-rotate":new li(dt.layout_symbol["text-rotate"]),"text-padding":new Gt(dt.layout_symbol["text-padding"]),"text-keep-upright":new Gt(dt.layout_symbol["text-keep-upright"]),"text-transform":new li(dt.layout_symbol["text-transform"]),"text-offset":new li(dt.layout_symbol["text-offset"]),"text-allow-overlap":new Gt(dt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Gt(dt.layout_symbol["text-ignore-placement"]),"text-optional":new Gt(dt.layout_symbol["text-optional"]),visibility:new Gt(dt.layout_symbol.visibility)})),paint:g1||(g1=new on({"icon-opacity":new li(dt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new li(dt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new li(dt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new li(dt.paint_symbol["text-emissive-strength"]),"icon-color":new li(dt.paint_symbol["icon-color"]),"icon-halo-color":new li(dt.paint_symbol["icon-halo-color"]),"icon-halo-width":new li(dt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new li(dt.paint_symbol["icon-halo-blur"]),"icon-translate":new Gt(dt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Gt(dt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new li(dt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new li(dt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new li(dt.paint_symbol["text-occlusion-opacity"]),"text-color":new li(dt.paint_symbol["text-color"],{runtimeType:Hs,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new li(dt.paint_symbol["text-halo-color"]),"text-halo-width":new li(dt.paint_symbol["text-halo-width"]),"text-halo-blur":new li(dt.paint_symbol["text-halo-blur"]),"text-translate":new Gt(dt.paint_symbol["text-translate"]),"text-translate-anchor":new Gt(dt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Gt(dt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Gt(dt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Gt(dt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Gt(dt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new li(dt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},av);class W_ extends ms{constructor(e,i,o,p){super(e,lv(),i,o,p),this._colorAdjustmentMatrix=Ye.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const p=[];for(const l of o)p.indexOf(l)<0&&p.push(l);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,o,p){return this._saturation===e&&this._contrast===i&&this._brightnessMin===o&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(l,f,w,C){l=Fh(l),f=zh(f);const O=Ye.mat4.create(),x=l/3,E=1-2*x,k=[E,x,x,0,x,E,x,0,x,x,E,0,0,0,0,1],M=.5-.5*f,P=C-w;return Ye.mat4.multiply(O,[P,0,0,0,0,P,0,0,0,0,P,0,w,w,w,1],[f,0,0,0,0,f,0,0,0,0,f,0,M,M,M,1]),Ye.mat4.multiply(O,O,k),O}(e,i,o,p),this._saturation=e,this._contrast=i,this._brightnessMin=o,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,o,p){const l=this.layout.get(e).evaluate(i,{},o,p),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||pu(f.value)||!l?l:function(w,C){return C.replace(/{([^{}]+)}/g,(O,x)=>x in w?String(w[x]):"")}(i.properties,l)}createBucket(e){return new G_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of lv().paint.overridableProperties){if(!W_.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new _1(i),p=new du(o,i.property.specification,this.scope,this.options);let l=null;l=i.value.kind==="constant"||i.value.kind==="source"?new sd("source",p):new dc("composite",p,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new _c(i.property,l,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&W_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),p=lv().paint.properties[i];let l=!1;const f=w=>{for(const C of w)if(p.overrides&&p.overrides.hasOverride(C))return void(l=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Is)f(o.value.value.sections);else if(o.value.kind==="source"){const w=O=>{l||(O instanceof ws&&Qr(O.value)===ps?f(O.value.sections):O instanceof Ga?f(O.sections):O.eachChild(w))},C=o.value;C._styleExpression&&w(C._styleExpression.expression)}return l}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,o){return{config:new zl(this,{zoom:i,lut:o}),overrideFog:!1}}}let y1,v1,x1,b1;var cv=Dr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function uv(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function hv(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class dv{constructor(e,i,o,p){this.context=e,this.format=o,this.useMipmap=p&&p.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:p&&p.premultiply})}update(e,i){const o=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,p=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:l}=this,{gl:f}=l,{x:w,y:C}=i&&i.position?i.position:{x:0,y:0},O=w+o,x=C+p;!this.size||this.size[0]===O&&this.size[1]===x||(f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(this.texture),this.texture=f.createTexture(),this.size=null),f.bindTexture(f.TEXTURE_2D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA8&&(!i||i.premultiply!==!1));const E=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&O>0&&x>0){const k=this.useMipmap?Math.floor(Math.log2(Math.max(O,x)))+1:1;f.texStorage2D(f.TEXTURE_2D,k,this.format,O,x),this.size=[O,x]}if(this.size)if(E)f.texSubImage2D(f.TEXTURE_2D,0,w,C,uv(this.format),hv(this.format),e);else{const k=e.data;k&&f.texSubImage2D(f.TEXTURE_2D,0,w,C,o,p,uv(this.format),hv(this.format),k)}this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,i,o=!1){const{context:p}=this,{gl:l}=p;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,o,p){const{context:l}=this,{gl:f}=l;f.bindTexture(f.TEXTURE_2D,this.texture),i!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),this.wrapS=o),p!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,p),this.wrapT=p)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class q_{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:o}=this,{gl:p}=o;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,i),this.wrapS=i)}}function Y_(s,e,i,o,p,l,f,w){const C=[s,e,1,i,o,1,p,l,1],O=[f,w,1],x=Ye.mat3.adjoint([],C),[E,k,M]=Ye.vec3.transformMat3(O,O,x);return Ye.mat3.multiply(C,C,[E,0,0,0,k,0,0,0,M])}function w1(s,e,i,o,p,l,f,w){const C=function(O,x,E,k,M,P,R,$){const H=Y_(0,0,1,0,1,1,0,1),J=Y_(O,x,E,k,M,P,R,$),ee=Ye.mat3.adjoint([],H);return Ye.mat3.multiply(J,J,ee)}(s,e,i,o,p,l,f,w);return[C[2]/C[8]/ei,C[5]/C[8]/ei]}function X_(s){return[s[0],Math.min(Math.max(s[1],-85.051129),uo)]}class S1 extends aa{constructor(e,i,o,p){super(),this.id=e,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new oa("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Po(this.map._requestManager.transformRequest(this.url,Pr.Image),(o,p)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new Wu(o)):p&&(this.image=p instanceof HTMLImageElement?Be.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new q_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new oa("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof q_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],o=e[0][1];for(const l of e)l[1]>o&&(o=l[1]),l[1]<i&&(i=l[1]);const p=(o+i)/2;if(p>uo?this.onNorthPole=!0:p<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const l=e.map(n.fromLngLat);this.tileID=function(f){let w=1/0,C=1/0,O=-1/0,x=-1/0;for(const R of f)w=Math.min(w,R.x),C=Math.min(C,R.y),O=Math.max(O,R.x),x=Math.max(x,R.y);const E=Math.max(O-w,x-C),k=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),M=Math.pow(2,k);let P=Math.floor((w+O)/2*M);return P>1&&(P-=1),new Bt(k,P,Math.floor((C+x)/2*M))}(l),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new oa("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const H in this.tiles){const J=this.tiles[H];J.state!=="loaded"&&(J.state="loaded",J.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=pg(new Bt(0,0,0),this.map.transform.projection),o=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(H){const J=H[1].x-H[0].x,ee=H[1].y-H[0].y,Z=H[2].x-H[1].x,ne=H[2].y-H[1].y,le=H[3].x-H[2].x,fe=H[3].y-H[2].y,Pe=H[0].x-H[3].x,Ee=H[0].y-H[3].y,Ce=J*ne-Z*ee,$e=Z*fe-le*ne,Ie=le*Ee-Pe*fe,Ge=Pe*ee-J*Ee;return Ce>0&&$e>0&&Ie>0&&Ge>0||Ce<0&&$e<0&&Ie<0&&Ge<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const p=pg(this.tileID,this.map.transform.projection),[l,f,w,C]=this.coordinates.map(H=>{const J=p.projection.project(H[0],H[1]);return c1(p,J)._round()});this.perspectiveTransform=w1(l.x,l.y,f.x,f.y,w.x,w.y,C.x,C.y);const O=this._boundsArray=new tn;O.emplaceBack(l.x,l.y,0,0),O.emplaceBack(f.x,f.y,ei,0),O.emplaceBack(C.x,C.y,0,ei),O.emplaceBack(w.x,w.y,ei,ei),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(O,cv.members),this.boundsSegments=Sn.simpleSegment(0,0,4,2);const x=[],E=[X_((k=this.coordinates)[0]),X_(k[1]),X_(k[2]),X_(k[3])];var k;const[M,P,R,$]=function(H){let J=H[0][0],ee=J,Z=H[0][1],ne=Z;for(let le=1;le<H.length;le++)H[le][0]<J?J=H[le][0]:H[le][0]>ee&&(ee=H[le][0]),H[le][1]<Z?Z=H[le][1]:H[le][1]>ne&&(ne=H[le][1]);return[J,Z,ee-J,ne-Z]}(E);{const H=new tn,[J,ee,Z,ne]=function(nt){let ct=nt[0].x,it=ct,Et=nt[0].y,Nt=Et;for(let Ct=1;Ct<nt.length;Ct++)nt[Ct].x<ct?ct=nt[Ct].x:nt[Ct].x>it&&(it=nt[Ct].x),nt[Ct].y<Et?Et=nt[Ct].y:nt[Ct].y>Nt&&(Nt=nt[Ct].y);return[ct,Et,it-ct,Nt-Et]}(o),le=nt=>[(nt.x-J)/Z,(nt.y-ee)/ne],[fe,Pe,Ee,Ce]=o.map(le),$e=function(nt,ct,it,Et,Nt,Ct,si,ti){const Ht=Y_(0,0,1,0,1,1,0,1),Ut=Y_(nt,ct,it,Et,Nt,Ct,si,ti),xi=Ye.mat3.adjoint([],Ut);return Ye.mat3.multiply(Ht,Ht,xi)}(fe[0],fe[1],Pe[0],Pe[1],Ee[0],Ee[1],Ce[0],Ce[1]);this.elevatedGlobePerspectiveTransform=w1(fe[0],fe[1],Pe[0],Pe[1],Ee[0],Ee[1],Ce[0],Ce[1]);const Ie=(nt,ct)=>{x.push(nt.lng);const it=Math.round((nt.lng-M)/R*ei),Et=Math.round((nt.lat-P)/$*ei),Nt=le(ct),Ct=Ye.vec3.transformMat3([],[Nt[0],Nt[1],1],$e),si=Math.round(Ct[0]/Ct[2]*ei),ti=Math.round(Ct[1]/Ct[2]*ei);H.emplaceBack(it,Et,si,ti)},Ge=o[3].x-o[0].x,Ze=o[3].y-o[0].y,qe=o[2].x-o[1].x,et=o[2].y-o[1].y;for(let nt=0;nt<65;nt++){const ct=nt/64,it=[o[0].x+ct*Ge,o[0].y+ct*Ze],Et=[o[1].x+ct*qe,o[1].y+ct*et],Nt=Et[0]-it[0],Ct=Et[1]-it[1];for(let si=0;si<65;si++){const ti=si/64,Ht={x:it[0]+Nt*ti,y:it[1]+Ct*ti};Ie(i.projection.unproject(Ht.x,Ht.y),Ht)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(H,cv.members)}{this.maxLongitudeTriangleSize=0;let H=[],J=new gs;const ee=(Z,ne,le)=>{J.emplaceBack(Z,ne,le);const fe=x[Z],Pe=x[ne],Ee=x[le],Ce=Math.min(Math.min(fe,Pe),Ee),$e=Math.max(Math.max(fe,Pe),Ee)-Ce;$e>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=$e),H.push(Ce+$e/2)};for(let Z=0;Z<64;Z++)for(let ne=0;ne<64;ne++){const le=65*Z+ne,fe=le+1,Pe=le+65,Ee=Pe+1;ee(le,Pe,fe),ee(fe,Pe,Ee)}[H,J]=function(Z,ne){const le=Array.from({length:Z.length},(Ee,Ce)=>Ce);le.sort((Ee,Ce)=>Z[Ee]-Z[Ce]);const fe=[],Pe=new gs;for(let Ee=0;Ee<le.length;Ee++){const Ce=le[Ee];fe.push(Z[Ce]);const $e=3*Ce,Ie=$e+1;Pe.emplaceBack(ne.uint16[$e],ne.uint16[Ie],ne.uint16[Ie+1])}return[fe,Pe]}(H,J),this.elevatedGlobeTrianglesCenterLongitudes=H,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(J)}this.elevatedGlobeSegments=Sn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/ei,0,$/ei,0,0,P,M,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof q_||(this.texture?this.texture.update(this.image):(this.texture=new dv(i,this.image,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const o=this.elevatedGlobeTrianglesCenterLongitudes;let p=(l=e+180)+360*Math.round((o[0]-l)/360);var l;const f=new Sn,w=(E,k)=>{f.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:i.segments[0].vertexLength,primitiveLength:k,sortKey:void 0,vaos:{}})},C=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-p)<=C){const E=$c(o,0,o.length,p+C);return E===o.length||w(E,Ps(o,E+1,o.length,p+360-C)-E),f}p<o[0]&&(p+=360);const O=Ps(o,0,o.length,p-C);if(O===o.length)return w(0,o.length),f;w(0,O-0);const x=$c(o,O+1,o.length,p+C);return x!==o.length&&w(x,o.length-x),f}}const OC=(Math.pow(256,2)-1)/16907520;class T1 extends ms{constructor(e,i,o,p){super(e,{layout:x1||(x1=new on({visibility:new Gt(dt.layout_raster.visibility)})),paint:b1||(b1=new on({"raster-opacity":new Gt(dt.paint_raster["raster-opacity"]),"raster-color":new Ka(dt.paint_raster["raster-color"]),"raster-color-mix":new Gt(dt.paint_raster["raster-color-mix"]),"raster-color-range":new Gt(dt.paint_raster["raster-color-range"]),"raster-hue-rotate":new Gt(dt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Gt(dt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Gt(dt.paint_raster["raster-brightness-max"]),"raster-saturation":new Gt(dt.paint_raster["raster-saturation"]),"raster-contrast":new Gt(dt.paint_raster["raster-contrast"]),"raster-resampling":new Gt(dt.paint_raster["raster-resampling"]),"raster-fade-duration":new Gt(dt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Gt(dt.paint_raster["raster-emissive-strength"]),"raster-array-band":new Gt(dt.paint_raster["raster-array-band"]),"raster-elevation":new Gt(dt.paint_raster["raster-elevation"]),"raster-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},i,o,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof S1&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[o,p]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(p)||o===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=Bp({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,p])}}let M1,C1,E1,A1,P1;class D1 extends ms{constructor(e,i,o,p){super(e,{layout:M1||(M1=new on({visibility:new Gt(dt["layout_raster-particle"].visibility)})),paint:C1||(C1=new on({"raster-particle-array-band":new Gt(dt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Gt(dt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ka(dt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Gt(dt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Gt(dt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Gt(dt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Gt(dt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Gt(dt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},i,o,p),this._updateColorRamp(),this.lastInvalidatedAt=Be.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Bp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Be.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class LC extends ms{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function pv(s,e,i){const o=[0,0,1],p=Ye.quat.identity([]);return Ye.quat.rotateY(p,p,i?-rr(s)+Math.PI:rr(s)),Ye.quat.rotateX(p,p,-rr(e)),Ye.vec3.transformQuat(o,o,p),Ye.vec3.normalize(o,o)}function I1(s,e){const i=Z_(s.projection,s.zoom,s.width,s.height),o=function(l,f,w,C,O){const x=new Cr(w.lng-180*Dd,w.lat),E=new Cr(w.lng+180*Dd,w.lat),k=l.project(x.lng,x.lat),M=l.project(E.lng,E.lat),P=-Math.atan2(M.y-k.y,M.x-k.x),R=n.fromLngLat(w);R.y=nr(R.y,-1+Dd,1-Dd);const $=R.toLngLat(),H=l.project($.lng,$.lat),J=n.fromLngLat($);J.x+=Dd;const ee=J.toLngLat(),Z=l.project(ee.lng,ee.lat),ne=O1(Z.x-H.x,Z.y-H.y,P),le=n.fromLngLat($);le.y+=Dd;const fe=le.toLngLat(),Pe=l.project(fe.lng,fe.lat),Ee=O1(Pe.x-H.x,Pe.y-H.y,P),Ce=Math.abs(ne.x)/Math.abs(Ee.y),$e=Ye.mat4.identity([]);Ye.mat4.rotateZ($e,$e,-P*(1-(O?0:C)));const Ie=Ye.mat4.identity([]);return Ye.mat4.scale(Ie,Ie,[1,1-(1-Ce)*C,1]),Ie[4]=-Ee.x/Ee.y*C,Ye.mat4.rotateZ(Ie,Ie,P),Ye.mat4.multiply(Ie,$e,Ie),Ie}(s.projection,0,s.center,i,e),p=k1(s);return Ye.mat4.scale(o,o,[p,p,1]),o}function k1(s){const e=s.projection,i=Z_(s.projection,s.zoom,s.width,s.height),o=fv(e,s.center),p=fv(e,Cr.convert(e.center));return Math.pow(2,o*i+(1-i)*p)}function Z_(s,e,i,o,p=1/0){const l=s.range;if(!l)return 0;const f=Math.min(p,Math.max(i,o)),w=Math.log(f/1024)/Math.LN2;return Kr(l[0]+w,l[1]+w,e)}const Dd=1/4e4;function fv(s,e){const i=nr(e.lat,-85.051129,uo),o=new Cr(e.lng-180*Dd,i),p=new Cr(e.lng+180*Dd,i),l=s.project(o.lng,i),f=s.project(p.lng,i),w=n.fromLngLat(o),C=n.fromLngLat(p),O=f.x-l.x,x=f.y-l.y,E=C.x-w.x,k=C.y-w.y,M=Math.sqrt((E*E+k*k)/(O*O+x*x));return Math.log(M)/Math.LN2}function O1(s,e,i){const o=Math.cos(i),p=Math.sin(i);return{x:s*o-e*p,y:s*p+e*o}}function L1(s,e,i){Ye.mat4.identity(s),Ye.mat4.rotateZ(s,s,rr(e[2])),Ye.mat4.rotateX(s,s,rr(e[0])),Ye.mat4.rotateY(s,s,rr(e[1])),Ye.mat4.scale(s,s,i),Ye.mat4.multiply(s,s,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function K_(s,e,i,o,p,l,f,w){const C=[i[0]-e[0],i[1]-e[1],0],O=[o[0]-e[0],o[1]-e[1],0];if(Ye.vec3.length(C)<1e-12||Ye.vec3.length(O)<1e-12)return Ye.quat.identity(s);const x=Ye.vec3.cross([],C,O);Ye.vec3.normalize(x,x),Ye.vec3.subtract(O,o,e),C[2]=(l-p)*w,O[2]=(f-p)*w;const E=C;return Ye.vec3.cross(E,C,O),Ye.vec3.normalize(E,E),Ye.quat.rotationTo(s,x,E)}function mv(s,e,i=!1){const o=ho(e.zoom),p=function(l,f,w){const C=f.worldSize,O=[l[12],l[13],l[14]],x=Wn(O[1]/C),E=co(O[0]/C),k=Ye.mat4.identity([]),M=to(1,x)*C,P=to(1,0)*C*Nl(x,f.zoom),R=1/zs(C);let $=P*R;if(w){const Z=Z_(f.projection,f.zoom,f.width,f.height,1024);$=R*f.projection.pixelSpaceConversion(f.center.lat,C,Z)}const H=ga(x,E);Ye.vec3.add(H,H,Ye.vec3.scale([],Ye.vec3.normalize([],H),M*$*O[2]));const J=function(Z){const ne=[Z[0],Z[1],Z[2]];let le=[0,1,0];const fe=Ye.vec3.cross([],le,ne);return Ye.vec3.cross(le,ne,fe),Ye.vec3.squaredLength(le)===0&&(le=[0,1,0],Ye.vec3.cross(fe,ne,le)),Ye.vec3.normalize(fe,fe),Ye.vec3.normalize(le,le),Ye.vec3.normalize(ne,ne),[fe[0],fe[1],fe[2],0,le[0],le[1],le[2],0,ne[0],ne[1],ne[2],0,Z[0],Z[1],Z[2],1]}(H);Ye.mat4.scale(k,k,[$,$,$*M]),Ye.mat4.translate(k,k,[-O[0],-O[1],-O[2]]);const ee=Ye.mat4.multiply([],f.globeMatrix,J);return Ye.mat4.multiply(ee,ee,k),Ye.mat4.multiply(ee,ee,l),ee}(s,e,i);if(o>0){const l=function(f,w){const C=w.worldSize,O=to(1,0)*C*Nl(w.center.lat,w.zoom)/zs(C),x=to(1,w.center.lat)*C,E=Ye.mat4.identity([]);return Ye.mat4.rotateY(E,E,rr(w.center.lng)),Ye.mat4.rotateX(E,E,rr(w.center.lat)),Ye.mat4.translate(E,E,[0,0,Gn]),Ye.mat4.scale(E,E,[O,O,O*x]),Ye.mat4.translate(E,E,[w.point.x-.5*C,w.point.y-.5*C,0]),Ye.mat4.multiply(E,E,f),Ye.mat4.multiply(E,w.globeMatrix,E)}(s,e);return function(f,w,C){const O=(P,R,$)=>{const H=Ye.vec3.length(P),J=Ye.vec3.length(R),ee=qn(P,R,$);return Ye.vec3.scale(ee,ee,1/Ye.vec3.length(ee)*Di(H,J,$))},x=O([f[0],f[1],f[2]],[w[0],w[1],w[2]],C),E=O([f[4],f[5],f[6]],[w[4],w[5],w[6]],C),k=O([f[8],f[9],f[10]],[w[8],w[9],w[10]],C),M=qn([f[12],f[13],f[14]],[w[12],w[13],w[14]],C);return[x[0],x[1],x[2],0,E[0],E[1],E[2],0,k[0],k[1],k[2],0,M[0],M[1],M[2],1]}(p,l,o)}return p}function R1(s,e,i,o){const p=bi.projectAabbCorners(o,i);let l=Number.MAX_VALUE,f=-1;for(let O=0;O<p.length;++O){const x=p[O];x[0]=(.5*x[0]+.5)*e.width,x[1]=(.5-.5*x[1])*e.height,x[2]<l&&(f=O,l=x[2])}const w=O=>new Wt(p[O][0],p[O][1]);let C;switch(f){case 0:case 6:C=[w(1),w(5),w(4),w(7),w(3),w(2),w(1)];break;case 1:case 7:C=[w(0),w(4),w(5),w(6),w(2),w(3),w(0)];break;case 3:case 5:C=[w(1),w(0),w(4),w(7),w(6),w(2),w(1)];break;default:C=[w(1),w(5),w(6),w(7),w(3),w(0),w(1)]}if(ae(s,C))return l}const RC=Dr([{name:"a_pos_3f",components:3,type:"Float32"}]),zC=Dr([{name:"a_color_3f",components:3,type:"Float32"}]),FC=Dr([{name:"a_color_4f",components:4,type:"Float32"}]),BC=Dr([{name:"a_uv_2f",components:2,type:"Float32"}]),NC=Dr([{name:"a_normal_3f",components:3,type:"Float32"}]),VC=Dr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),UC=Dr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),z1={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class J_{constructor(e,i,o,p){this.message=(e?`${e}: `:"")+o,p&&(this.identifier=p),i!=null&&i.__line__&&(this.line=i.__line__)}}function F1(s,e){const i=s.indexOf("://")===-1;try{return new URL(s,i&&e?"http://example.com":void 0),!0}catch{return!1}}class B1{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class N1{constructor(){this.instancedDataArray=new Fo,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class gv{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,i){}populate(e,i,o,p){this.tileToMeter=t(o);const l=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:f,id:w,index:C,sourceLayerIndex:O}of e){const x=w??(f.properties&&f.properties.hasOwnProperty("id")?f.properties.id:void 0),E=G(f,l);if(!this.layers[0]._featureFilter.filter(new Vr(this.zoom),E,o))continue;const k={id:x,sourceLayerIndex:O,index:C,geometry:l?E.geometry:j(f,o,p),properties:f.properties,type:f.type,patterns:{}},M=this.addFeature(k,k.geometry,E);M&&i.featureIndex.insert(f,k.geometry,C,O,this.index,this.instancesPerModel[M].instancedDataArray.length,ei/32)}this.lookup=null}update(e,i,o,p){for(const l in this.instancesPerModel){const f=this.instancesPerModel[l];for(const w in e)f.idToFeaturesIndex.hasOwnProperty(w)&&(this.evaluate(f.features[f.idToFeaturesIndex[w]],e[w],f,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];for(const p of o.features){const l=this.layers[0],f=p.feature,w=this.canonical,C=l.paint.get("model-rotation").evaluate(f,{},w),O=l.paint.get("model-scale").evaluate(f,{},w),x=l.paint.get("model-translation").evaluate(f,{},w);Ye.vec3.exactEquals(p.rotation,C)&&Ye.vec3.exactEquals(p.scale,O)&&Ye.vec3.exactEquals(p.translation,x)||(this.evaluate(p,p.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,i,o,p){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(gi(this.activeReplacements,l))return!1;this.activeReplacements=l;let f=!1;for(const w in this.instancesPerModel){const C=this.instancesPerModel[w],O=C.instancedDataArray;for(const x of C.features){const E=x.instancedDataOffset,k=x.instancedDataCount;for(let M=0;M<k;M++){const P=16*(M+E);let R=O.float32[P+0];const $=R>ei;R=$?R-ei:R;const H=Math.floor(R),J=O.float32[P+1];let ee=!1;for(const Z of this.activeReplacements)if(!Ot(Z,o,z1.Model,p)&&!(Z.min.x>H||H>Z.max.x||Z.min.y>J||J>Z.max.y)&&(ee=Gi(kr(H,J,e.canonical,Z.footprintTileId.canonical),Z.footprint),ee))break;O.float32[P]=ee?R+ei:R,f=f||ee!==$}}}return f}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,VC.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const i of this.modelUris)e.removeModel(i,"")}addFeature(e,i,o){const p=this.layers[0],l=p.layout.get("model-id").evaluate(o,{},this.canonical);if(!l)return qi(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),l;F1(l,!1)&&(this.modelUris.includes(l)||this.modelUris.push(l)),this.instancesPerModel[l]||(this.instancesPerModel[l]=new N1);const f=this.instancesPerModel[l],w=f.instancedDataArray,C=new B1(o,w.length);for(const O of i)for(const x of O){if(x.x<0||x.x>=ei||x.y<0||x.y>=ei)continue;const E=(this.lookupDim-1)/ei,k=this.lookupDim*(x.y*E|0)+x.x*E|0;if(this.lookup){if(this.lookup[k]!==0)continue;this.lookup[k]=1}this.instanceCount++;const M=w.length;w.resize(M+1),f.instancesEvaluatedElevation.push(0),w.float32[16*M]=x.x,w.float32[16*M+1]=x.y}return C.instancedDataCount=f.instancedDataArray.length-C.instancedDataOffset,C.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(C),this.evaluate(C,{},f,!1)),l}getModelUris(){return this.modelUris}evaluate(e,i,o,p){const l=this.layers[0],f=e.feature,w=this.canonical,C=e.rotation=l.paint.get("model-rotation").evaluate(f,i,w),O=e.scale=l.paint.get("model-scale").evaluate(f,i,w),x=e.translation=l.paint.get("model-translation").evaluate(f,i,w),E=l.paint.get("model-color").evaluate(f,i,w);E.a=l.paint.get("model-color-mix-intensity").evaluate(f,i,w);const k=[];this.maxVerticalOffset<x[2]&&(this.maxVerticalOffset=x[2]),this.maxScale=Math.max(Math.max(this.maxScale,O[0]),Math.max(O[1],O[2])),L1(k,C,O);const M=Math.round(100*E.a)+E.b/1.05;for(let P=0;P<e.instancedDataCount;++P){const R=e.instancedDataOffset+P,$=16*R,H=o.instancedDataArray.float32;let J=0;p&&(J=H[$+6]-o.instancesEvaluatedElevation[R]);const ee=0|H[$+1];H[$]=(0|H[$])+E.r/1.05,H[$+1]=ee+E.g/1.05,H[$+2]=M,H[$+3]=1/(w.z>10?this.tileToMeter:t(w,ee)),H[$+4]=x[0],H[$+5]=x[1],H[$+6]=x[2]+J,H[$+7]=k[0],H[$+8]=k[1],H[$+9]=k[2],H[$+10]=k[4],H[$+11]=k[5],H[$+12]=k[6],H[$+13]=k[8],H[$+14]=k[9],H[$+15]=k[10],o.instancesEvaluatedElevation[R]=x[2]}}}let V1,U1;_i(gv,"ModelBucket",{omit:["layers"]}),_i(N1,"PerModelAttributes"),_i(B1,"ModelFeature");const qp=64,om={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function j1(s,e,i,o,p,l,f,w,C,O=!1){const x=i.zoom,E=i.project(o),k=Nl(o.lat,x),M=1/k;Ye.mat4.identity(s),Ye.mat4.translate(s,s,[E.x+f[0]*M,E.y+f[1]*M,f[2]]);let P=1,R=1;const $=i.worldSize;if(O){if(i.projection.name==="mercator"){let Z=0;i.elevation&&(Z=i.elevation.getAtPointOrZero(new n(E.x/$,E.y/$),0));const ne=Ye.vec4.transformMat4([],[E.x,E.y,Z,1],i.projMatrix)[3]/i.cameraToCenterDistance;P=ne,R=ne*Nl(i.center.lat,x)}else if(i.projection.name==="globe"){const Z=mv(s,i),ne=Ye.mat4.multiply([],i.projMatrix,Z),le=[0,0,0,1];Ye.vec4.transformMat4(le,le,ne);const fe=le[3]/i.cameraToCenterDistance,Pe=ho(x),Ee=i.projection.pixelsPerMeter(o.lat,$)*Nl(o.lat,x),Ce=i.projection.pixelsPerMeter(i.center.lat,$)*Nl(i.center.lat,x);P=fe/Di(Ee,Fp(i.center.lat),Pe),R=fe*k/Ee,P*=Ce,R*=Ce}}else P=M;Ye.mat4.scale(s,s,[P,P,R]);const H=[...s],J=e.orientation,ee=[];if(L1(ee,[J[0]+p[0],J[1]+p[1],J[2]+p[2]],l),Ye.mat4.multiply(s,H,ee),w&&i.elevation){let Z=0;const ne=[];if(C&&i.elevation){Z=function(Pe,Ee,Ce,$e,Ie){const Ge=Ee.elevation;if(!Ge)return 0;const Ze=bi.projectAabbCorners(Ce,$e),qe=to(1,Ie.lat)*Ee.worldSize,et=function(xi,ui){const mi=[0,0,1],Ni=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ki of Ni){const er=xi[Ki.corners[0]],tr=xi[Ki.corners[1]],cr=xi[Ki.corners[2]],ur=[tr[0]-er[0],tr[1]-er[1],ui*(tr[2]-er[2])],nn=Ye.vec3.cross(ur,ur,[cr[0]-er[0],cr[1]-er[1],ui*(cr[2]-er[2])]);Ye.vec3.normalize(nn,nn),Ki.dotProductWithUp=Ye.vec3.dot(nn,mi)}return Ni.sort((Ki,er)=>Ki.dotProductWithUp-er.dotProductWithUp),Ni[0].corners}(Ze,qe),nt=Ze[et[0]],ct=Ze[et[1]],it=Ze[et[2]],Et=Ze[et[3]],Nt=Ge.getAtPointOrZero(new n(nt[0]/Ee.worldSize,nt[1]/Ee.worldSize),0),Ct=Ge.getAtPointOrZero(new n(ct[0]/Ee.worldSize,ct[1]/Ee.worldSize),0),si=Ge.getAtPointOrZero(new n(it[0]/Ee.worldSize,it[1]/Ee.worldSize),0),ti=Ge.getAtPointOrZero(new n(Et[0]/Ee.worldSize,Et[1]/Ee.worldSize),0),Ht=(Nt+ti)/2,Ut=(Ct+si)/2;return Ht>Ut?Ct<si?K_(Pe,ct,Et,nt,Ct,ti,Nt,qe):K_(Pe,it,nt,Et,si,Nt,ti,qe):Nt<ti?K_(Pe,nt,ct,it,Nt,Ct,si,qe):K_(Pe,Et,it,ct,ti,si,Ct,qe),Math.max(Ht,Ut)}(ne,i,e.aabb,s,o);const le=Ye.mat4.fromQuat([],ne),fe=Ye.mat4.multiply([],le,ee);Ye.mat4.multiply(s,H,fe)}else Z=i.elevation.getAtPointOrZero(new n(E.x/$,E.y/$),0);Z!==0&&(s[14]+=Z)}}function yg(s,e,i=!1){s.uploaded||(s.gfxTexture=new dv(e,s.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:s.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),s.uploaded=!0,s.image=null)}function jC(s,e,i){s.indexBuffer=e.createIndexBuffer(s.indexArray,!1,!0),s.vertexBuffer=e.createVertexBuffer(s.vertexArray,RC.members,!1,!0),s.normalArray&&(s.normalBuffer=e.createVertexBuffer(s.normalArray,NC.members,!1,!0)),s.texcoordArray&&(s.texcoordBuffer=e.createVertexBuffer(s.texcoordArray,BC.members,!1,!0)),s.colorArray&&(s.colorBuffer=e.createVertexBuffer(s.colorArray,(s.colorArray.bytesPerElement===12?zC:FC).members,!1,!0)),s.featureArray&&(s.pbrBuffer=e.createVertexBuffer(s.featureArray,UC.members,!0)),s.segments=Sn.simpleSegment(0,0,s.vertexArray.length,s.indexArray.length);const o=s.material;o.pbrMetallicRoughness.baseColorTexture&&yg(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&yg(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&yg(o.normalTexture,e),o.occlusionTexture&&yg(o.occlusionTexture,e,i),o.emissionTexture&&yg(o.emissionTexture,e)}function _v(s,e,i){if(s.meshes)for(const o of s.meshes)jC(o,e,i);if(s.children)for(const o of s.children)_v(o,e,i)}function Q_(s){if(s.meshes)for(const e of s.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(s.children)for(const e of s.children)Q_(e)}function yv(s){if(s.meshes)for(const i of s.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(s.children)for(const i of s.children)yv(i)}class am{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){const p=o||e.findDEMTileFor(i);if(!p||!p.dem)return;const l=p.dem,f=p.tileID,w=1<<i.canonical.z-f.canonical.z;return new am(p,l.dim/ei/w,[(i.canonical.x/w-f.canonical.x)*l.dim,(i.canonical.y/w-f.canonical.y)*l.dim])}tileCoordToPixel(e,i){const o=i*this._scale+this._offset[1],p=Math.floor(e*this._scale+this._offset[0]),l=Math.floor(o);return new Wt(p,l)}getElevationAt(e,i,o,p){const l=e*this._scale+this._offset[0],f=i*this._scale+this._offset[1],w=Math.floor(l),C=Math.floor(f),O=this._dem;return p=!!p,o?Di(Di(O.get(w,C,p),O.get(w,C+1,p),f-C),Di(O.get(w+1,C,p),O.get(w+1,C+1,p),f-C),l-w):O.get(w,C,p)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*to(1,e)*this._dem.stride}}const vv=new Float32Array(262144),Yp=new Uint8Array(262144);function $1(s){let e=0;if(s.meshes)for(const i of s.meshes)e=Math.max(e,i.aabb.max[2]);if(s.children)for(const i of s.children)e=Math.max(e,$1(i));return e}function H1(s,e,i){if(s.meshes)for(const o of s.meshes){if(o.aabb.min[0]===1/0)continue;const p=bi.applyTransform(o.aabb,s.matrix);i.insert(e,p.min[0],p.min[1],p.max[0],p.max[1])}if(s.children)for(const o of s.children)H1(o,e,i)}const G1=["","wall","door","roof","window","lamp","logo"];class W1{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:$1(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new bi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new bi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=bi.applyTransformFast(o.aabb,this.node.matrix),i.encapsulate(o.transformedAabb)),e++;this.aabb=i}return this.aabb}}class ey{constructor(e,i,o,p,l,f,w){this.id=o,this.layers=e,this.layerIds=this.layers.map(C=>C.fqid),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.modelTraits|=om.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=om.HasMapboxMeshFeatures),l&&(this.modelTraits|=om.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=f,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const C of i)this.nodesInfo.push(new W1(C)),H1(C,w.featureIndexArray.length,w.grid),w.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,w.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const o of this.getNodesInfo()){const p=o.node;p.footprint&&i.push({footprint:p.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const o=i?this.stateDependentLayers:this.layers;if(!jn(e,this.states))for(const p of o)this.evaluate(p,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const o of i){const p=o.node;this.uploaded?this.updatePbrBuffer(p):_v(p,e,!0)}for(const o of i)Q_(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(e,i,o){const p=e.transform.projectionOptions,l=e.style.getBrightness(),f=this.brightness!==l;if(!this.uploaded||this.dirty||p.name!==this.projection.name||vg(o.paint.get("model-color").value,f)||vg(o.paint.get("model-color-mix-intensity").value,f)||vg(o.paint.get("model-roughness").value,f)||vg(o.paint.get("model-emissive-strength").value,f)||vg(o.paint.get("model-height-based-emissive-strength-multiplier").value,f)){this.projection=p,this.brightness=l;const w=this.getNodesInfo();for(const C of w)C.state=null;return!0}return!1}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const o=this.getNodesInfo(),p=this.id.canonical;for(const l of o){const f=l.feature;l.evaluatedScale=i.paint.get("model-scale").evaluate(f,{},p)}}evaluate(e,i){const o=this.getNodesInfo();for(const p of o){if(!p.node.meshes)continue;const l=p.feature,f=i&&i[l.id];if(jn(f,p.state))continue;p.state=structuredClone(f);const w=p.node.meshes&&p.node.meshes[0].featureData,C=p.evaluatedColor[2],O=p.evaluatedRMEA[2],x=this.id.canonical;if(p.hasTranslucentParts=!1,w){for(let E=0;E<G1.length;E++){const k=G1[E];k.length&&(l.properties.part=k);const M=e.paint.get("model-color").evaluate(l,f,x).toRenderColor(null),P=e.paint.get("model-color-mix-intensity").evaluate(l,f,x);p.evaluatedColor[E]=[M.r,M.g,M.b,P],p.evaluatedRMEA[E][0]=e.paint.get("model-roughness").evaluate(l,f,x),p.evaluatedRMEA[E][2]=e.paint.get("model-emissive-strength").evaluate(l,f,x),p.evaluatedRMEA[E][3]=M.a,p.emissionHeightBasedParams[E]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(l,f,x),!p.hasTranslucentParts&&M.a<1&&(p.hasTranslucentParts=!0)}delete l.properties.part,HC(p,C!==p.evaluatedColor[2]||O!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(l,f,x);p.evaluatedScale=e.paint.get("model-scale").evaluate(l,f,x),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,o,p){const l=e.findDEMTileFor(o);if(l&&(l.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(l.dem&&l.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=l.tileID.overscaledZ;const f=am.create(e,o,l);if(!f)return;this.modelTraits&om.HasMapboxMeshFeatures&&this.updateDEM(e,f,o,p);for(const w of this.getNodesInfo()){const C=w.node;if(!C.footprint||!C.footprint.vertices||!C.footprint.vertices.length)continue;const O=C.footprint.vertices;let x=f.getElevationAt(O[0].x,O[0].y,!0,!0);for(let E=1;E<O.length;E++)x=Math.min(x,f.getElevationAt(O[E].x,O[E].y,!0,!0));C.elevation=x}}this.terrainTile=l.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,o,p){let l=i._dem._modifiedForSources[p];if(l===void 0&&(i._dem._modifiedForSources[p]=[],l=i._dem._modifiedForSources[p]),l.includes(o.canonical))return;const f=i._dem.dim;l.push(o.canonical);let w=!1;for(const C of this.getNodesInfo()){const O=C.node;if(!O.footprint||!O.footprint.grid)continue;const x=O.footprint.grid,E=i.tileCoordToPixel(x.min.x,x.min.y),k=i.tileCoordToPixel(x.max.x,x.max.y),M=Math.min(Math.min(f-k.y,E.x),Math.min(E.y,f-k.x));if(M<0)continue;const P=nr(M,2,5);let R=Math.max(0,E.x-P),$=Math.max(0,E.y-P),H=Math.min(k.x+P,f-1),J=Math.min(k.y+P,f-1);for(let le=$;le<=J;++le)for(let fe=R;fe<=H;++fe)Yp[le*f+fe]=255;let ee=0,Z=0;for(let le=0;le<x.cellsY;++le)for(let fe=0;fe<x.cellsX;++fe){if(!x.cells[le*x.cellsX+fe])continue;const Pe=i.tileCoordToPixel(x.min.x+fe/x.xScale,x.min.y+le/x.yScale),Ee=i.tileCoordToPixel(x.min.x+(fe+1)/x.xScale,x.min.y+(le+1)/x.yScale);for(let Ce=Pe.y;Ce<=Math.min(Ee.y+1,f-1);++Ce)for(let $e=Pe.x;$e<=Math.min(Ee.x+1,f-1);++$e)Yp[Ce*f+$e]===255&&(Yp[Ce*f+$e]=0,ee+=i.getElevationAtPixel($e,Ce),Z++)}const ne=ee/Z;R=Math.max(1,E.x-P),$=Math.max(1,E.y-P),H=Math.min(k.x+P,f-2),J=Math.min(k.y+P,f-2),w=!0;for(let le=$;le<=J;++le)for(let fe=R;fe<=H;++fe)Yp[le*f+fe]===0&&(vv[le*f+fe]=i._dem.set(fe,le,ne));for(let le=1;le<P;++le){R=Math.max(1,E.x-le),$=Math.max(1,E.y-le),H=Math.min(k.x+le,f-2),J=Math.min(k.y+le,f-2);for(let fe=$;fe<=J;++fe)for(let Pe=R;Pe<=H;++Pe){const Ee=fe*f+Pe;if(Yp[Ee]===255){let Ce=0,$e=0,Ie=-1,Ge=-1;for(let Ze=-1;Ze<=1;++Ze)for(let qe=-1;qe<=1;++qe){const et=(fe+Ze)*f+Pe+qe;if(Yp[et]>=le)continue;const nt=vv[et],ct=Math.abs(nt);ct>$e&&(Ce=nt,$e=ct,Ie=qe,Ge=Ze)}if($e>.1){const Ze=1-(le+.5*Math.abs(Ie*Ge))/P;let qe=i._dem.get(Pe,fe)+Ce*Ze;const et=i._dem.get(Pe+Ie,fe+Ge),nt=i._dem.get(Pe-Ie,fe-Ge,!0);(qe-et)*(qe-nt)>0&&(qe=(et+nt)/2),vv[Ee]=i._dem.set(Pe,fe,qe),Yp[Ee]=le}}}}}w&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Be.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)Q_(i.node),yv(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped()),p=this.getNodesInfo();for(let l=0;l<this.nodesInfo.length;l++){const f=p[l].node;p[l].hiddenByReplacement=!!f.footprint&&!o.find(w=>w.footprint===f.footprint)}}getHeightAtTileCoord(e,i){const o=this.getNodesInfo(),p=[],l=[0,0,0],f=Ye.mat4.identity([]);for(let w=0;w<this.nodesInfo.length;w++){const C=o[w],O=C.node.meshes[0],x=O.transformedAabb;if(e<x.min[0]||i<x.min[1]||e>x.max[0]||i>x.max[1])continue;if(C.node.hidden===!0)return{height:1/0,maxHeight:C.feature.properties.height,hidden:!1,verticalScale:C.evaluatedScale[2]};Ye.mat4.invert(f,C.node.matrix),l[0]=e,l[1]=i,Ye.vec3.transformMat4(l,l,f);const E=(l[0]-O.aabb.min[0])/(O.aabb.max[0]-O.aabb.min[0])*qp|0,k=Math.min(63,(l[1]-O.aabb.min[1])/(O.aabb.max[1]-O.aabb.min[1])*qp|0)*qp+Math.min(63,E),M=O.heightmap[k];if(!(M<0&&C.node.footprint))return C.hiddenByReplacement?void 0:{height:M,maxHeight:C.feature.properties.height,hidden:!1,verticalScale:C.evaluatedScale[2]};if(C.node.footprint.grid.query(new Wt(e,i),new Wt(e,i),p),p.length>0)return{height:void 0,maxHeight:C.feature.properties.height,hidden:C.hiddenByReplacement,verticalScale:C.evaluatedScale[2]}}}}function vg(s,e){return!s.isLightConstant&&e}function $C(s,e,i,o,p,l,f,w){let C=(61440&e|(61440&e)>>4)>>8,O=(3840&e|(3840&e)>>4)>>4,x=240&e|(240&e)>>4;i[3]>0&&(C=Di(C,255*i[0],i[3]),O=Di(O,255*i[1],i[3]),x=Di(x,255*i[2],i[3]));const E=C<<8|O,k=x<<8|Math.floor(255*o[3]),M=function(le){const fe=nr(le,0,2);return Math.min(Math.round(.5*fe*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],P=nr(p[0],0,1),R=nr(p[1],0,1),$=nr(p[2],0,1),H=nr(p[3],0,1);let J,ee,Z,ne;if(P!==R&&f!==l&&R!==P){const le=f-l;ee=1/(le*(R-P)),Z=-(l+le*P)/(le*(R-P));const fe=nr(p[4],-1,1);ne=Math.pow(10,fe),J=255*$<<8|255*H}else J=65535,ee=0,Z=1,ne=1;if(s.emplaceBack(E,k,M,J,ee,Z,ne),w){const le=w.length;w.clear();for(let fe=0;fe<le;fe++)w.emplaceBack(E,k,M,J,ee,Z,ne)}}function HC(s,e,i){const o=s.node;let p=0;const l=i&om.HasMeshoptCompression;for(const f of o.meshes){if(o.lights&&o.lightMeshIndex===p||!f.featureData)continue;f.featureArray=new bu,f.featureArray.reserve(f.featureData.length);let w=e;for(const C of f.featureData){const O=l?65535&C:C>>16&65535,x=l?C>>16&65535:65535&C,E=(15&x)<8?15&x:0,k=s.evaluatedRMEA[E],M=s.evaluatedColor[E],P=s.emissionHeightBasedParams[E];let R;if(w&&E===2&&o.lights&&(R=new bu,R.resize(10*o.lights.length)),$C(f.featureArray,O,M,k,P,f.aabb.min[2],f.aabb.max[2],R),R&&w){w=!1;const $=o.meshes[o.lightMeshIndex];$.featureArray=R,$.featureArray._trim()}}f.featureArray._trim(),p++}}function q1(s,e,i,o){const p=1<<s.z;e.lat=Wn((o/ei+s.y)/p),e.lng=co((i/ei+s.x)/p)}_i(ey,"Tiled3dModelBucket",{omit:["layers"]}),_i(W1,"Tiled3dModelFeature");const GC={circle:class extends ms{constructor(s,e,i,o){super(s,{layout:Vt||(Vt=new on({"circle-sort-key":new li(dt.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Gt(dt.layout_circle["circle-elevation-reference"]),visibility:new Gt(dt.layout_circle.visibility)})),paint:st||(st=new on({"circle-radius":new li(dt.paint_circle["circle-radius"]),"circle-color":new li(dt.paint_circle["circle-color"]),"circle-blur":new li(dt.paint_circle["circle-blur"]),"circle-opacity":new li(dt.paint_circle["circle-opacity"]),"circle-translate":new Gt(dt.paint_circle["circle-translate"]),"circle-translate-anchor":new Gt(dt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Gt(dt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Gt(dt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new li(dt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new li(dt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new li(dt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Gt(dt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}createBucket(s){return new ce(s)}queryRadius(s){const e=s;return Dt("circle-radius",this,e)+Dt("circle-stroke-width",this,e)+At(this.paint.get("circle-translate"))}queryIntersectsFeature(s,e,i,o,p,l,f,w){const C=wt(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,s.pixelToTileUnitsFactor),O=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return bd(s,o,l,f,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",C,O)}getProgramIds(){return["circle"]}getDefaultProgramParams(s,e,i){const o=Ac(this);return{config:new zl(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}},heatmap:class extends ms{createBucket(s){return new p_(s)}constructor(s,e,i,o){super(s,{layout:f_||(f_=new on({visibility:new Gt(dt.layout_heatmap.visibility)})),paint:Jm||(Jm=new on({"heatmap-radius":new li(dt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new li(dt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Gt(dt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ka(dt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Gt(dt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Bp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return Dt("heatmap-radius",this,s)}queryIntersectsFeature(s,e,i,o,p,l,f,w){const C=this.paint.get("heatmap-radius").evaluate(e,i);return bd(s,o,l,f,w,!0,!0,new Wt(0,0),C)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(s,e,i){return s==="heatmap"?{config:new zl(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends ms{constructor(s,e,i,o){super(s,{layout:m_||(m_=new on({visibility:new Gt(dt.layout_hillshade.visibility)})),paint:Qm||(Qm=new on({"hillshade-illumination-direction":new Gt(dt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Gt(dt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Gt(dt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Gt(dt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Gt(dt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Gt(dt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Gt(dt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(s,e,i){return{overrideFog:!1}}},fill:class extends ms{constructor(s,e,i,o){super(s,{layout:C_||(C_=new on({"fill-sort-key":new li(dt.layout_fill["fill-sort-key"]),visibility:new Gt(dt.layout_fill.visibility),"fill-elevation-reference":new Gt(dt.layout_fill["fill-elevation-reference"])})),paint:E_||(E_=new on({"fill-antialias":new Gt(dt.paint_fill["fill-antialias"]),"fill-opacity":new li(dt.paint_fill["fill-opacity"]),"fill-color":new li(dt.paint_fill["fill-color"]),"fill-outline-color":new li(dt.paint_fill["fill-outline-color"]),"fill-translate":new Gt(dt.paint_fill["fill-translate"]),"fill-translate-anchor":new Gt(dt.paint_fill["fill-translate-anchor"]),"fill-pattern":new li(dt.paint_fill["fill-pattern"]),"fill-emissive-strength":new Gt(dt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new li(dt.paint_fill["fill-z-offset"]),"fill-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){const s=this.paint.get("fill-pattern"),e=s&&s.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(s,e,i){return{config:new zl(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(s,e){super.recalculate(s,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new rg(s)}queryRadius(){return At(this.paint.get("fill-translate"))}queryIntersectsFeature(s,e,i,o,p,l){return!s.queryGeometry.isAboveHorizon&&pe(ot(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,s.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends ms{constructor(s,e,i,o){super(s,{layout:bb||(bb=new on({visibility:new Gt(dt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Gt(dt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:wb||(wb=new on({"fill-extrusion-opacity":new Gt(dt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new li(dt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Gt(dt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Gt(dt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new li(dt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new li(dt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new li(dt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Gt(dt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Gt(dt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Gt(dt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Gt(dt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Gt(dt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Gt(dt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Gt(dt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Gt(dt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Gt(dt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Gt(dt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new li(dt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new li(dt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Gt(dt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Gt(dt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Gt(dt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Gt(dt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new li(dt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new li(dt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Gt(dt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new Gp(s)}queryRadius(){return At(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(s,e,i,o,p,l,f,w,C){const O=wt(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,s.pixelToTileUnitsFactor),x=this.paint.get("fill-extrusion-height").evaluate(e,i),E=this.paint.get("fill-extrusion-base").evaluate(e,i),k=[0,0],M=w&&l.elevation,P=l.elevation?l.elevation.exaggeration():1,R=s.tile.getBucket(this);if(M&&R instanceof Gp){const Z=R.centroidVertexArray,ne=C+1;ne<Z.length&&(k[0]=Z.geta_centroid_pos0(ne),k[1]=Z.geta_centroid_pos1(ne))}if(k[0]===0&&k[1]===1)return!1;l.projection.name==="globe"&&(o=xb([o],[new Wt(0,0),new Wt(ei,ei)],s.tileID.canonical).map(Z=>Z.polygon).flat());const $=M?w:null,[H,J]=function(Z,ne,le,fe,Pe,Ee,Ce,$e,Ie,Ge,Ze){return Z.projection.name==="globe"?function(qe,et,nt,ct,it,Et,Nt,Ct,si,ti,Ht){const Ut=[],xi=[],ui=qe.projection.upVectorScale(Ht,qe.center.lat,qe.worldSize).metersToTile,mi=[0,0,0,1],Ni=[0,0,0,1],Ki=(tr,cr,ur,nn)=>{tr[0]=cr,tr[1]=ur,tr[2]=nn,tr[3]=1},er=vb();nt>0&&(nt+=er),ct+=er;for(const tr of et){const cr=[],ur=[];for(const nn of tr){const Nr=nn.x+it.x,Hi=nn.y+it.y,Rr=qe.projection.projectTilePoint(Nr,Hi,Ht),Fr=qe.projection.upVector(Ht,nn.x,nn.y);let hn=nt,Zn=ct;if(Nt){const hs=Tb(Nr,Hi,nt,ct,Nt,Ct,si,ti);hn+=hs.base,Zn+=hs.top}nt!==0?Ki(mi,Rr.x+Fr[0]*ui*hn,Rr.y+Fr[1]*ui*hn,Rr.z+Fr[2]*ui*hn):Ki(mi,Rr.x,Rr.y,Rr.z),Ki(Ni,Rr.x+Fr[0]*ui*Zn,Rr.y+Fr[1]*ui*Zn,Rr.z+Fr[2]*ui*Zn),Ye.vec3.transformMat4(mi,mi,Et),Ye.vec3.transformMat4(Ni,Ni,Et),cr.push(new _e(mi[0],mi[1],mi[2])),ur.push(new _e(Ni[0],Ni[1],Ni[2]))}Ut.push(cr),xi.push(ur)}return[Ut,xi]}(Z,ne,le,fe,Pe,Ee,Ce,$e,Ie,Ge,Ze):Ce?function(qe,et,nt,ct,it,Et,Nt,Ct,si){const ti=[],Ht=[],Ut=[0,0,0,1];for(const xi of qe){const ui=[],mi=[];for(const Ni of xi){const Ki=Ni.x+ct.x,er=Ni.y+ct.y,tr=Tb(Ki,er,et,nt,Et,Nt,Ct,si);Ut[0]=Ki,Ut[1]=er,Ut[2]=tr.base,Ut[3]=1,Ye.vec4.transformMat4(Ut,Ut,it),Ut[3]=Math.max(Ut[3],1e-5);const cr=new _e(Ut[0]/Ut[3],Ut[1]/Ut[3],Ut[2]/Ut[3]);Ut[0]=Ki,Ut[1]=er,Ut[2]=tr.top,Ut[3]=1,Ye.vec4.transformMat4(Ut,Ut,it),Ut[3]=Math.max(Ut[3],1e-5);const ur=new _e(Ut[0]/Ut[3],Ut[1]/Ut[3],Ut[2]/Ut[3]);ui.push(cr),mi.push(ur)}ti.push(ui),Ht.push(mi)}return[ti,Ht]}(ne,le,fe,Pe,Ee,Ce,$e,Ie,Ge):function(qe,et,nt,ct,it){const Et=[],Nt=[],Ct=it[8]*et,si=it[9]*et,ti=it[10]*et,Ht=it[11]*et,Ut=it[8]*nt,xi=it[9]*nt,ui=it[10]*nt,mi=it[11]*nt;for(const Ni of qe){const Ki=[],er=[];for(const tr of Ni){const cr=tr.x+ct.x,ur=tr.y+ct.y,nn=it[0]*cr+it[4]*ur+it[12],Nr=it[1]*cr+it[5]*ur+it[13],Hi=it[2]*cr+it[6]*ur+it[14],Rr=it[3]*cr+it[7]*ur+it[15],Fr=nn+Ct,hn=Nr+si,Zn=Hi+ti,hs=Math.max(Rr+Ht,1e-5),Kn=nn+Ut,On=Nr+xi,as=Hi+ui,_s=Math.max(Rr+mi,1e-5);Ki.push(new _e(Fr/hs,hn/hs,Zn/hs)),er.push(new _e(Kn/_s,On/_s,as/_s))}Et.push(Ki),Nt.push(er)}return[Et,Nt]}(ne,le,fe,Pe,Ee)}(l,o,E,x,O,f,$,k,P,l.center.lat,s.tileID.canonical),ee=s.queryGeometry;return function(Z,ne,le){let fe=1/0;pe(le,ne)&&(fe=Sb(le,ne[0]));for(let Pe=0;Pe<ne.length;Pe++){const Ee=ne[Pe],Ce=Z[Pe];for(let $e=0;$e<Ee.length-1;$e++){const Ie=Ee[$e],Ge=[Ie,Ee[$e+1],Ce[$e+1],Ce[$e],Ie];ae(le,Ge)&&(fe=Math.min(fe,Sb(le,Ge)))}}return fe!==1/0&&fe}(H,J,ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},line:class extends ms{constructor(s,e,i,o){const p=Lb();super(s,p,e,i,o),p.layout&&(this.layout=new yc(p.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ls,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,e){super.recalculate(s,e),this.paint._values["line-floorwidth"]=(()=>{if(ag)return ag;const i=Lb();return ag=new qM(i.paint.properties["line-width"].specification),ag.useIntegerZoom=!0,ag})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new G0(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(s,e,i){const o=kb(this);return{config:new zl(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}queryRadius(s){const e=s,i=Rb(Dt("line-width",this,e),Dt("line-gap-width",this,e)),o=Dt("line-offset",this,e);return i/2+Math.abs(o)+At(this.paint.get("line-translate"))}queryIntersectsFeature(s,e,i,o,p,l){if(s.queryGeometry.isAboveHorizon)return!1;const f=ot(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,s.pixelToTileUnitsFactor),w=s.pixelToTileUnitsFactor/2*Rb(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),C=this.paint.get("line-offset").evaluate(e,i);return C&&(o=function(O,x){const E=[],k=new Wt(0,0);for(let M=0;M<O.length;M++){const P=O[M],R=[];for(let $=0;$<P.length;$++){const H=P[$],J=P[$+1],ee=$===0?k:H.sub(P[$-1])._unit()._perp(),Z=$===P.length-1?k:J.sub(H)._unit()._perp(),ne=ee._add(Z)._unit();ne._mult(1/(ne.x*Z.x+ne.y*Z.y)),R.push(ne._mult(x)._add(H))}E.push(R)}return E}(o,C*s.pixelToTileUnitsFactor)),function(O,x,E){for(let k=0;k<x.length;k++){const M=x[k];if(O.length>=3){for(let P=0;P<M.length;P++)if(Oe(O,M[P]))return!0}if(Te(O,M,E))return!0}return!1}(f,o,w)}isTileClipped(){return!0}isDraped(s){return!this.hasElevatedBuckets}},symbol:W_,background:class extends ms{constructor(s,e,i,o){super(s,{layout:y1||(y1=new on({visibility:new Gt(dt.layout_background.visibility)})),paint:v1||(v1=new on({"background-pitch-alignment":new Gt(dt.paint_background["background-pitch-alignment"]),"background-color":new Gt(dt.paint_background["background-color"]),"background-pattern":new Gt(dt.paint_background["background-pattern"]),"background-opacity":new Gt(dt.paint_background["background-opacity"]),"background-emissive-strength":new Gt(dt.paint_background["background-emissive-strength"]),"background-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(s,e,i){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:T1,"raster-particle":D1,sky:class extends ms{constructor(s,e,i,o){super(s,{layout:E1||(E1=new on({visibility:new Gt(dt.layout_sky.visibility)})),paint:A1||(A1=new on({"sky-type":new Gt(dt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Gt(dt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Gt(dt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Gt(dt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Gt(dt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ka(dt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Gt(dt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Gt(dt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Gt(dt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Bp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(s,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),p=!o,l=s.style.light,f=l.properties.get("position");return p&&l.properties.get("anchor")==="viewport"&&qi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?pv(f.azimuthal,90-f.polar,e):pv(o[0],90-o[1],e)}const i=this.paint.get("sky-gradient-center");return pv(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}},slot:class extends ms{constructor(s,e,i,o){super(s,{paint:P1||(P1=new on({}))},e,null)}},model:class extends ms{constructor(s,e,i,o){super(s,{layout:V1||(V1=new on({visibility:new Gt(dt.layout_model.visibility),"model-id":new li(dt.layout_model["model-id"])})),paint:U1||(U1=new on({"model-opacity":new li(dt.paint_model["model-opacity"]),"model-rotation":new li(dt.paint_model["model-rotation"]),"model-scale":new li(dt.paint_model["model-scale"]),"model-translation":new li(dt.paint_model["model-translation"]),"model-color":new li(dt.paint_model["model-color"]),"model-color-mix-intensity":new li(dt.paint_model["model-color-mix-intensity"]),"model-type":new Gt(dt.paint_model["model-type"]),"model-cast-shadows":new Gt(dt.paint_model["model-cast-shadows"]),"model-receive-shadows":new Gt(dt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Gt(dt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new li(dt.paint_model["model-emissive-strength"]),"model-roughness":new li(dt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new li(dt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Gt(dt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Gt(dt.paint_model["model-front-cutoff"]),"model-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new gv(s)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(s){return s instanceof ey?ei-1:0}queryIntersectsFeature(s,e,i,o,p,l){if(!this.modelManager)return!1;const f=this.modelManager,w=s.tile.getBucket(this);if(!(w&&w instanceof gv))return!1;for(const C in w.instancesPerModel){const O=w.instancesPerModel[C],x=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(O.idToFeaturesIndex.hasOwnProperty(x)){const E=O.features[O.idToFeaturesIndex[x]],k=f.getModel(C,this.scope);if(!k)return!1;let M=Ye.mat4.create();const P=new Cr(0,0),R=w.canonical;let $=Number.MAX_VALUE;for(let H=0;H<E.instancedDataCount;++H){const J=16*(E.instancedDataOffset+H),ee=O.instancedDataArray.float32,Z=[ee[J+4],ee[J+5],ee[J+6]];q1(R,P,ee[J],0|ee[J+1]),j1(M,k,l,P,E.rotation,E.scale,Z,!1,!1,!1),l.projection.name==="globe"&&(M=mv(M,l));const ne=Ye.mat4.multiply([],l.projMatrix,M),le=s.queryGeometry,fe=R1(le.isPointQuery()?le.screenBounds:le.screenGeometry,l,ne,k.aabb);fe!=null&&($=Math.min(fe,$))}return $!==Number.MAX_VALUE&&$}}return!1}_handleOverridablePaintPropertyUpdate(s,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||s!=="model-color"&&s!=="model-color-mix-intensity"&&s!=="model-rotation"&&s!=="model-scale"&&s!=="model-translation"&&s!=="model-emissive-strength")}_isPropertyZoomDependent(s){const e=this._transitionablePaint._values[s];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof dc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends ms{constructor(s,e,i,o){super(s,{layout:A_||(A_=new on({"clip-layer-types":new Gt(dt.layout_clip["clip-layer-types"]),"clip-layer-scope":new Gt(dt.layout_clip["clip-layer-scope"])})),paint:P_||(P_=new on({}))},e,i,o)}recalculate(s,e){super.recalculate(s,e)}createBucket(s){return new D_(s)}isTileClipped(){return!0}is3D(){return!0}}};class WC{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class qC{constructor(){this.tasks={},this.taskQueue=[],Vc(["process"],this),this.invoker=new WC(this.process),this.nextId=0}add(e,i){const o=this.nextId++,p=function({type:l,isSymbolTile:f,zoom:w}){return w=w||0,l==="message"?0:l!=="maybePrepare"||f?l!=="parseTile"||f?l==="parseTile"&&f?300-w:l==="maybePrepare"&&f?400-w:500:200-w:100-w}(i);if(p===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:i,priority:p,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let p=0;p<this.taskQueue.length;p++){const l=this.tasks[this.taskQueue[p]];l.priority<i&&(i=l.priority,e=p)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class Y1{constructor(e,i,o){this.target=e,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},Vc(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new qC}send(e,i,o,p,l=!1,f){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=f,this.callbacks[w]=o);const C=new Set;return this.target.postMessage({id:w,type:e,hasCallback:!!o,targetMapId:p,mustQueue:l,sourceMapId:this.mapId,data:Al(i,C)},C),{cancel:()=>{o&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(e){const i=e.data,o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const p=this.cancelCallbacks[o];delete this.cancelCallbacks[o],p&&p.cancel()}else if(i.mustQueue||Pa()){const p=this.callbacks[o],l=this.scheduler.add(()=>this.processTask(o,i),p&&p.metadata||{type:"message"});l&&(this.cancelCallbacks[o]=l)}else this.processTask(o,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const o=this.callbacks[e];delete this.callbacks[e],o&&(i.error?o(mc(i.error)):o(null,mc(i.data)))}else{const o=new Set,p=i.hasCallback?(f,w)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?Al(f):null,data:Al(w,o)},o)}:()=>{},l=mc(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,l,p);else if(this.parent.getWorkerSource){const f=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,f[0],l.source,l.scope)[f[1]](l,p)}else p(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var xg={workerUrl:"",workerClass:null,workerParams:void 0};const xv="mapboxgl_preloaded_worker_pool";class Xp{constructor(){this.active={}}acquire(e,i=Xp.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(xg.workerClass!=null?new xg.workerClass:new self.Worker(xg.workerUrl,xg.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[xv]}numActive(){return Object.keys(this.active).length}}Xp.workerCount=2;class lm{constructor(e,i,o="Worker",p=Xp.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=$a();const l=this.workerPool.acquire(this.id,p);for(let f=0;f<l.length;f++){const w=new lm.Actor(l[f],i,this.id);w.name=`${o} ${f}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,o){dl(this.actors,(p,l)=>{p.send(e,i,l)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let bg,bv;function ty(){return bg||(bg=new Xp),bg}lm.Actor=Y1;const wv=new Ar(0,0,0);var Sv=(s=>(s[s.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",s[s.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",s[s.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",s))(Sv||{}),iy=(s=>(s[s.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",s[s.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",s[s.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",s[s.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",s))(iy||{}),wg=(s=>(s[s.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",s[s.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",s[s.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",s[s.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",s[s.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",s))(wg||{}),X1=(s=>(s[s.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",s[s.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",s[s.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",s))(X1||{}),cm=(s=>(s[s.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",s[s.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",s[s.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",s[s.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",s[s.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",s[s.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",s))(cm||{}),Z1=(s=>(s[s.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",s[s.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",s[s.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",s))(Z1||{});function YC(s,e,i){s===1&&e.icons.push(function(o,p){return function(l){if(l.usvg_tree.height||(l.usvg_tree.height=l.usvg_tree.width),!l.metadata)return l;const{metadata:f}=l;if(f.content_area){const{content_area:w}=f;w.top==null&&(w.top=w.left),w.width==null&&(w.width=l.usvg_tree.width),w.height==null&&(w.height=w.width)}return f.stretch_x&&f.stretch_x.length&&K1(f,"x"),f.stretch_y&&f.stretch_y.length&&K1(f,"y"),l}(o.readFields(XC,{name:void 0},p))}(i,i.readVarint()+i.pos))}function K1(s,e){const i=[],o=s[`stretch_${e}`];let p=null;for(let l=0;l<o.length;l++)p===null?p=i.length===0?o[0]:i[i.length-1][1]+o[l]:(i.push([p,p+o[l]]),p=null);s[`stretch_${e}_areas`]=i}function XC(s,e,i){s===1?e.name=i.readString():s===2?e.metadata=function(o,p){return o.readFields(ZC,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},p)}(i,i.readVarint()+i.pos):s===3&&(e.usvg_tree=function(o,p){return o.readFields(QC,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},p)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function ZC(s,e,i){s===1?e.stretch_x=i.readPackedVarint():s===2?e.stretch_y=i.readPackedVarint():s===3?e.content_area=function(o,p){return o.readFields(KC,{left:0},p)}(i,i.readVarint()+i.pos):s===4&&e.variables.push(function(o,p){return o.readFields(JC,{name:void 0},p)}(i,i.readVarint()+i.pos))}function KC(s,e,i){s===1?e.left=i.readVarint():s===2?e.width=i.readVarint():s===3?e.top=i.readVarint():s===4&&(e.height=i.readVarint())}function JC(s,e,i){s===1?e.name=i.readString():s===2&&(e.rgb_color=sy(i.readVarint()),e.value="rgb_color")}function QC(s,e,i){s===1?e.width=e.height=i.readVarint():s===2?e.height=i.readVarint():s===3?e.children.push(ry(i,i.readVarint()+i.pos)):s===4?e.linear_gradients.push(function(o,p){return o.readFields(oE,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},p)}(i,i.readVarint()+i.pos)):s===5?e.radial_gradients.push(function(o,p){return o.readFields(lE,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},p)}(i,i.readVarint()+i.pos)):s===7?e.clip_paths.push(function(o,p){return o.readFields(cE,{children:[]},p)}(i,i.readVarint()+i.pos)):s===8&&e.masks.push(function(o,p){const l=o.readFields(uE,{left:0,width:20,mask_type:1,children:[]},p);return l.height==null&&(l.height=l.width),l.top==null&&(l.top=l.left),l}(i,i.readVarint()+i.pos))}function ry(s,e){return s.readFields(eE,{},e)}function eE(s,e,i){s===1?(e.group=function(o,p){return o.readFields(tE,{opacity:255,children:[]},p)}(i,i.readVarint()+i.pos),e.node="group"):s===2&&(e.path=function(o,p){return o.readFields(rE,{paint_order:1,commands:[],step:1,diffs:[],rule:1},p)}(i,i.readVarint()+i.pos),e.node="path")}function tE(s,e,i){s===1?e.transform=ny(i,i.readVarint()+i.pos):s===2?e.opacity=i.readVarint():s===5?e.clip_path_idx=i.readVarint():s===6?e.mask_idx=i.readVarint():s===7&&e.children.push(ry(i,i.readVarint()+i.pos))}function ny(s,e){return s.readFields(iE,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function iE(s,e,i){s===1?e.sx=i.readFloat():s===2?e.ky=i.readFloat():s===3?e.kx=i.readFloat():s===4?e.sy=i.readFloat():s===5?e.tx=i.readFloat():s===6&&(e.ty=i.readFloat())}function rE(s,e,i){s===1?e.fill=function(o,p){return o.readFields(nE,{rgb_color:wv,paint:"rgb_color",opacity:255},p)}(i,i.readVarint()+i.pos):s===2?e.stroke=function(o,p){return o.readFields(sE,{rgb_color:wv,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},p)}(i,i.readVarint()+i.pos):s===3?e.paint_order=i.readVarint():s===5?i.readPackedVarint(e.commands):s===6?e.step=i.readFloat():s===7?i.readPackedSVarint(e.diffs):s===8&&(e.rule=i.readVarint())}function nE(s,e,i){s===1?(e.rgb_color=sy(i.readVarint()),e.paint="rgb_color"):s===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):s===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):s===5&&(e.opacity=i.readVarint())}function sy(s){return new Ar((s>>16&255)/255,(s>>8&255)/255,(255&s)/255,1)}function sE(s,e,i){s===1?(e.rgb_color=sy(i.readVarint()),e.paint="rgb_color"):s===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):s===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):s===5?i.readPackedFloat(e.dasharray):s===6?e.dashoffset=i.readFloat():s===7?e.miterlimit=i.readFloat():s===8?e.opacity=i.readVarint():s===9?e.width=i.readFloat():s===10?e.linecap=i.readVarint():s===11&&(e.linejoin=i.readVarint())}function oE(s,e,i){s===1?e.transform=ny(i,i.readVarint()+i.pos):s===2?e.spread_method=i.readVarint():s===3?e.stops.push(J1(i,i.readVarint()+i.pos)):s===4?e.x1=i.readFloat():s===5?e.y1=i.readFloat():s===6?e.x2=i.readFloat():s===7&&(e.y2=i.readFloat())}function J1(s,e){return s.readFields(aE,{offset:0,opacity:255,rgb_color:wv},e)}function aE(s,e,i){s===1?e.offset=i.readFloat():s===2?e.opacity=i.readVarint():s===3&&(e.rgb_color=sy(i.readVarint()))}function lE(s,e,i){s===1?e.transform=ny(i,i.readVarint()+i.pos):s===2?e.spread_method=i.readVarint():s===3?e.stops.push(J1(i,i.readVarint()+i.pos)):s===4?e.cx=i.readFloat():s===5?e.cy=i.readFloat():s===6?e.r=i.readFloat():s===7?e.fx=i.readFloat():s===8?e.fy=i.readFloat():s===9&&(e.fr=i.readFloat())}function cE(s,e,i){s===1?e.transform=ny(i,i.readVarint()+i.pos):s===2?e.clip_path_idx=i.readVarint():s===3&&e.children.push(ry(i,i.readVarint()+i.pos))}function uE(s,e,i){s===1?e.left=e.top=i.readFloat():s===2?e.width=e.height=i.readFloat():s===3?e.top=i.readFloat():s===4?e.height=i.readFloat():s===5?e.mask_type=i.readVarint():s===6?e.mask_idx=i.readVarint():s===7&&e.children.push(ry(i,i.readVarint()+i.pos))}class hE{static calculate(e,i){const o=new Map,p=new Map;if(Object.keys(e).length===0)return o;i.forEach(l=>{p.set(l.name,l.rgb_color||new Ar(0,0,0))});for(const[l,f]of Object.entries(e))p.has(l)?o.set(p.get(l).toStringPremultipliedAlpha(),f):console.warn(`Ignoring unknown image variable "${l}"`);return o}}function um(s,e=255,i){const o=e/255,p=s.toStringPremultipliedAlpha(),l=i.has(p)?i.get(p).clone():s.clone();return l.a=o,l.toString()}function Sg(s,e){if(!we()){const i=document.createElement("canvas");return i.width=s,i.height=e,i}return new OffscreenCanvas(s,e)}function dE(s,e){const i=hE.calculate(e.params,s.metadata?s.metadata.variables:[]),o=s.usvg_tree,p=o.width,l=o.height,f=e.transform?e.transform:new DOMMatrix,w=Math.max(1,Math.round(p*f.a)),C=Math.max(1,Math.round(l*f.d)),O=new DOMMatrix([w/p,0,0,C/l,0,0]),x=Sg(w,C).getContext("2d");return Tv(x,O,o,o,i),x.getImageData(0,0,w,C)}function Tv(s,e,i,o,p){for(const l of o.children)Q1(s,e,i,l,p)}function Q1(s,e,i,o,p){o.group?(s.save(),function(l,f,w,C,O){const x=C.mask_idx!=null?w.masks[C.mask_idx]:null,E=C.clip_path_idx!=null?w.clip_paths[C.clip_path_idx]:null;if(C.transform&&(f=oy(C.transform).preMultiplySelf(f)),!function(P,R,$){return P.opacity!==255||R||$}(C,E!=null,x!=null))return void Tv(l,f,w,C,O);const k=Sg(l.canvas.width,l.canvas.height),M=k.getContext("2d");Tv(M,f,w,C,O),E&&ow(M,f,w,E),x&&aw(M,f,w,x,O),l.globalAlpha=C.opacity/255,l.drawImage(k,0,0)}(s,e,i,o.group,p),s.restore()):o.path&&(s.save(),function(l,f,w,C,O){const x=lw(C);l.setTransform(f),C.paint_order===X1.PAINT_ORDER_FILL_AND_STROKE?(ew(l,w,C,x,O),iw(l,w,C,x,O)):(iw(l,w,C,x,O),ew(l,w,C,x,O))}(s,e,i,o.path,p),s.restore())}function ew(s,e,i,o,p){const l=i.fill;if(!l)return;const f=l.opacity/255;switch(l.paint){case"rgb_color":s.fillStyle=um(l.rgb_color,l.opacity,p);break;case"linear_gradient_idx":s.fillStyle=rw(s,e.linear_gradients[l.linear_gradient_idx],f,p);break;case"radial_gradient_idx":s.fillStyle=nw(s,e.radial_gradients[l.radial_gradient_idx],f,p)}s.fill(o,tw(i))}function tw(s){return s.rule===Sv.PATH_RULE_NON_ZERO?"nonzero":s.rule===Sv.PATH_RULE_EVEN_ODD?"evenodd":void 0}function iw(s,e,i,o,p){const l=i.stroke;if(!l)return;s.lineWidth=l.width,s.miterLimit=l.miterlimit,s.setLineDash(l.dasharray),s.lineDashOffset=l.dashoffset;const f=l.opacity/255;switch(l.paint){case"rgb_color":s.strokeStyle=um(l.rgb_color,l.opacity,p);break;case"linear_gradient_idx":s.strokeStyle=rw(s,e.linear_gradients[l.linear_gradient_idx],f,p);break;case"radial_gradient_idx":s.strokeStyle=nw(s,e.radial_gradients[l.radial_gradient_idx],f,p)}switch(l.linejoin){case wg.LINE_JOIN_MITER_CLIP:case wg.LINE_JOIN_MITER:s.lineJoin="miter";break;case wg.LINE_JOIN_ROUND:s.lineJoin="round";break;case wg.LINE_JOIN_BEVEL:s.lineJoin="bevel"}switch(l.linecap){case iy.LINE_CAP_BUTT:s.lineCap="butt";break;case iy.LINE_CAP_ROUND:s.lineCap="round";break;case iy.LINE_CAP_SQUARE:s.lineCap="square"}s.stroke(o)}function rw(s,e,i,o){if(e.stops.length===1){const k=e.stops[0];return um(k.rgb_color,k.opacity*i,o)}const p=oy(e.transform),{x1:l,y1:f,x2:w,y2:C}=e,O=p.transformPoint(new DOMPoint(l,f)),x=p.transformPoint(new DOMPoint(w,C)),E=s.createLinearGradient(O.x,O.y,x.x,x.y);for(const k of e.stops)E.addColorStop(k.offset,um(k.rgb_color,k.opacity*i,o));return E}function nw(s,e,i,o){if(e.stops.length===1){const k=e.stops[0];return um(k.rgb_color,k.opacity*i,o)}const p=oy(e.transform),{fx:l,fy:f,cx:w,cy:C}=e,O=p.transformPoint(new DOMPoint(l,f)),x=p.transformPoint(new DOMPoint(w,C)),E=s.createRadialGradient(O.x,O.y,0,x.x,x.y,e.r*((p.a+p.d)/2));for(const k of e.stops)E.addColorStop(k.offset,um(k.rgb_color,k.opacity*i,o));return E}function sw(s,e,i,o){const p=o.transform?oy(o.transform).preMultiplySelf(e):e,l=Sg(s.canvas.width,s.canvas.height),f=l.getContext("2d");for(const C of o.children)if(C.group)sw(f,p,i,C.group);else if(C.path){const O=C.path,x=new Path2D;x.addPath(lw(O),p),f.fill(x,tw(O))}const w=o.clip_path_idx!=null?i.clip_paths[o.clip_path_idx]:null;w&&ow(f,p,i,w),s.globalCompositeOperation="source-over",s.drawImage(l,0,0)}function ow(s,e,i,o){const p=Sg(s.canvas.width,s.canvas.height);sw(p.getContext("2d"),e,i,o),s.globalCompositeOperation="destination-in",s.drawImage(p,0,0)}function aw(s,e,i,o,p){if(o.children.length===0)return;const l=o.mask_idx!=null?i.masks[o.mask_idx]:null;l&&aw(s,e,i,l,p);const f=s.canvas.width,w=s.canvas.height,C=Sg(f,w),O=C.getContext("2d"),x=o.width,E=o.height,k=o.left,M=o.top,P=new Path2D,R=new Path2D;R.rect(k,M,x,E),P.addPath(R,e),O.clip(P);for(const J of o.children)Q1(O,e,i,J,p);const $=O.getImageData(0,0,f,w),H=$.data;if(o.mask_type===Z1.MASK_TYPE_LUMINANCE)for(let J=0;J<H.length;J+=4)H[J+3]=H[J+3]/255*(.2126*H[J]+.7152*H[J+1]+.0722*H[J+2]);O.putImageData($,0,0),s.globalCompositeOperation="destination-in",s.drawImage(C,0,0)}function oy(s){return s?new DOMMatrix([s.sx,s.ky,s.kx,s.sy,s.tx,s.ty]):new DOMMatrix}function lw(s){const e=new Path2D,i=s.step;let o=s.diffs[0]*i,p=s.diffs[1]*i;e.moveTo(o,p);for(let l=0,f=2;l<s.commands.length;l++)switch(s.commands[l]){case cm.PATH_COMMAND_MOVE:o+=s.diffs[f++]*i,p+=s.diffs[f++]*i,e.moveTo(o,p);break;case cm.PATH_COMMAND_LINE:o+=s.diffs[f++]*i,p+=s.diffs[f++]*i,e.lineTo(o,p);break;case cm.PATH_COMMAND_QUAD:{const w=o+s.diffs[f++]*i,C=p+s.diffs[f++]*i;o=w+s.diffs[f++]*i,p=C+s.diffs[f++]*i,e.quadraticCurveTo(w,C,o,p);break}case cm.PATH_COMMAND_CUBIC:{const w=o+s.diffs[f++]*i,C=p+s.diffs[f++]*i,O=w+s.diffs[f++]*i,x=C+s.diffs[f++]*i;o=O+s.diffs[f++]*i,p=x+s.diffs[f++]*i,e.bezierCurveTo(w,C,O,x,o,p);break}case cm.PATH_COMMAND_CLOSE:e.closePath()}return e}class Mv{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}class Cv{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Fs(e,e.data)}getFromCache(e,i,o){return this.cacheMap.has(o)||this.cacheMap.set(o,new Mv(150)),this.cacheMap.get(o).get(ua(e.serialize(),i))}setInCache(e,i,o,p){this.cacheDependenciesMap.has(p)||this.cacheDependenciesMap.set(p,new Map),this.cacheMap.has(p)||this.cacheMap.set(p,new Mv(150));const l=this.cacheDependenciesMap.get(p);l.get(ua(e.id,o))||l.set(ua(e.id,o),new Set);const f=this.cacheMap.get(p),w=e.serialize();l.get(ua(e.id,o)).add(w),f.put(ua(e.serialize(),o),i)}removeImagesFromCacheByIds(e,i,o=""){if(!this.cacheMap.has(o)||!this.cacheDependenciesMap.has(o))return;const p=this.cacheMap.get(o),l=this.cacheDependenciesMap.get(o);for(const f of e)if(l.has(ua(f,i))){for(const w of l.get(ua(f,i)))p.delete(w);l.delete(ua(f,i))}}rasterize(e,i,o,p,l=dE){const f=this.getFromCache(e,o,p);if(f)return f.clone();const w=l(i.icon,e.options),C=Cv._getImage(w);return this.setInCache(e,C,o,p),C.clone()}}class cw{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function uw(s,e,i,o){let p=0,l=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(o[f])<1e-15){if(i[f]<s[f]||i[f]>e[f])return null}else{const w=1/o[f];let C=(s[f]-i[f])*w,O=(e[f]-i[f])*w;if(C>O){const x=C;C=O,O=x}if(C>p&&(p=C),O<l&&(l=O),p>l)return null}return p}function hw(s,e,i,o,p,l,f,w,C,O,x){const E=o-s,k=p-e,M=l-i,P=f-s,R=w-e,$=C-i,H=x[1]*$-x[2]*R,J=x[2]*P-x[0]*$,ee=x[0]*R-x[1]*P,Z=E*H+k*J+M*ee;if(Math.abs(Z)<1e-15)return null;const ne=1/Z,le=O[0]-s,fe=O[1]-e,Pe=O[2]-i,Ee=(le*H+fe*J+Pe*ee)*ne;if(Ee<0||Ee>1)return null;const Ce=fe*M-Pe*k,$e=Pe*E-le*M,Ie=le*k-fe*E,Ge=(x[0]*Ce+x[1]*$e+x[2]*Ie)*ne;return Ge<0||Ee+Ge>1?null:(P*Ce+R*$e+$*Ie)*ne}function dw(s,e,i){return(s-e)/(i-e)}function pw(s,e,i,o,p,l,f,w,C){const O=1<<i,x=l-o,E=f-p,k=(s+1)/O*x+o,M=(e+0)/O*E+p,P=(e+1)/O*E+p;w[0]=(s+0)/O*x+o,w[1]=M,C[0]=k,C[1]=P}class fw{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(l){const f=Math.ceil(Math.log2(l.dim/8)),w=[];let C=Math.ceil(Math.pow(2,f));const O=1/C,x=(M,P,R,$,H)=>{const J=$?1:0,ee=(M+1)*R-J,Z=P*R,ne=(P+1)*R-J;H[0]=M*R,H[1]=Z,H[2]=ee,H[3]=ne};let E=new cw(C);const k=[];for(let M=0;M<C*C;M++){x(M%C,Math.floor(M/C),O,!1,k);const P=Id(k[0],k[1],l),R=Id(k[2],k[1],l),$=Id(k[2],k[3],l),H=Id(k[0],k[3],l);E.minimums.push(Math.min(P,R,$,H)),E.maximums.push(Math.max(P,R,$,H)),E.leaves.push(1)}for(w.push(E),C/=2;C>=1;C/=2){const M=w[w.length-1];E=new cw(C);for(let P=0;P<C*C;P++){x(P%C,Math.floor(P/C),2,!0,k);const R=M.getElevation(k[0],k[1]),$=M.getElevation(k[2],k[1]),H=M.getElevation(k[2],k[3]),J=M.getElevation(k[0],k[3]),ee=M.isLeaf(k[0],k[1]),Z=M.isLeaf(k[2],k[1]),ne=M.isLeaf(k[2],k[3]),le=M.isLeaf(k[0],k[3]),fe=Math.min(R.min,$.min,H.min,J.min),Pe=Math.max(R.max,$.max,H.max,J.max),Ee=ee&&Z&&ne&&le;E.maximums.push(Pe),E.minimums.push(fe),E.leaves.push(Pe-fe<=5&&Ee?1:0)}w.push(E)}return w}(this.dem),o=i.length-1,p=i[o];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,p,l,f,w=1){return uw([e,i,-100],[o,p,this.maximums[0]*w],l,f)}raycast(e,i,o,p,l,f,w=1){if(!this.nodeCount)return null;const C=this.raycastRoot(e,i,o,p,l,f,w);if(C==null)return null;const O=[],x=[],E=[],k=[],M=[{idx:0,t:C,nodex:0,nodey:0,depth:0}];for(;M.length>0;){const{idx:P,t:R,nodex:$,nodey:H,depth:J}=M.pop();if(this.leaves[P]){pw($,H,J,e,i,o,p,E,k);const Z=1<<J,ne=($+0)/Z,le=($+1)/Z,fe=(H+0)/Z,Pe=(H+1)/Z,Ee=Id(ne,fe,this.dem)*w,Ce=Id(le,fe,this.dem)*w,$e=Id(le,Pe,this.dem)*w,Ie=Id(ne,Pe,this.dem)*w,Ge=hw(E[0],E[1],Ee,k[0],E[1],Ce,k[0],k[1],$e,l,f),Ze=hw(k[0],k[1],$e,E[0],k[1],Ie,E[0],E[1],Ee,l,f),qe=Math.min(Ge!==null?Ge:Number.MAX_VALUE,Ze!==null?Ze:Number.MAX_VALUE);if(qe!==Number.MAX_VALUE)return qe;{const et=Ye.vec3.scaleAndAdd([],l,f,R);if(mw(Ee,Ce,Ie,$e,dw(et[0],E[0],k[0]),dw(et[1],E[1],k[1]))>=et[2])return R}continue}let ee=0;for(let Z=0;Z<this._siblingOffset.length;Z++){pw(($<<1)+this._siblingOffset[Z][0],(H<<1)+this._siblingOffset[Z][1],J+1,e,i,o,p,E,k),E[2]=-100,k[2]=this.maximums[this.childOffsets[P]+Z]*w;const ne=uw(E,k,l,f);if(ne!=null){const le=ne;O[Z]=le;let fe=!1;for(let Pe=0;Pe<ee&&!fe;Pe++)le>=O[x[Pe]]&&(x.splice(Pe,0,Z),fe=!0);fe||(x[ee]=Z),ee++}}for(let Z=0;Z<ee;Z++){const ne=x[Z];M.push({idx:this.childOffsets[P]+ne,t:O[ne],nodex:($<<1)+this._siblingOffset[ne][0],nodey:(H<<1)+this._siblingOffset[ne][1],depth:J+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,p,l){if(e[p].isLeaf(i,o)===1)return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);const f=p-1,w=e[f];let C=0,O=0;for(let x=0;x<this._siblingOffset.length;x++){const E=2*i+this._siblingOffset[x][0],k=2*o+this._siblingOffset[x][1],M=w.getElevation(E,k),P=w.isLeaf(E,k),R=this._addNode(M.min,M.max,P);P&&(C|=1<<x),O||(O=R)}for(let x=0;x<this._siblingOffset.length;x++)C&1<<x||this._construct(e,2*i+this._siblingOffset[x][0],2*o+this._siblingOffset[x][1],f,O+x)}}function mw(s,e,i,o,p,l){return Di(Di(s,i,l),Di(e,o,l),p)}function Id(s,e,i){const o=i.dim,p=nr(s*o-.5,0,o-1),l=nr(e*o-.5,0,o-1),f=Math.floor(p),w=Math.floor(l),C=Math.min(f+1,o-1),O=Math.min(w+1,o-1);return mw(i.get(f,w),i.get(C,w),i.get(f,O),i.get(C,O),p-f,l-w)}const pE={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function fE(s,e,i){return(256*s*256+256*e+i)/10-1e4}function mE(s,e,i){return 256*s+e+i/256-32768}class ay{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,p=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void qi(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const l=this.dim=i.height-2,f=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let C=0;C<l;C++)f[this._idx(-1,C)]=f[this._idx(0,C)],f[this._idx(l,C)]=f[this._idx(l-1,C)],f[this._idx(C,-1)]=f[this._idx(C,0)],f[this._idx(C,l)]=f[this._idx(C,l-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(l,-1)]=f[this._idx(l-1,0)],f[this._idx(-1,l)]=f[this._idx(0,l-1)],f[this._idx(l,l)]=f[this._idx(l-1,l-1)]}const w=o==="terrarium"?mE:fE;for(let C=0;C<f.length;++C){const O=4*C;this.floatView[C]=w(this.pixels[O],this.pixels[O+1],this.pixels[O+2])}this._timestamp=Be.now()}_buildQuadTree(){this._tree=new fw(this)}get(e,i,o=!1){o&&(e=nr(e,-1,this.dim),i=nr(i,-1,this.dim));const p=this._idx(e,i);return this.floatView[p]}set(e,i,o){const p=this._idx(e,i),l=this.floatView[p];return this.floatView[p]=o,o-l}static getUnpackVector(e){return pE[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const o=[0,0,0,0],p=ay.getUnpackVector(i);let l=Math.floor((e+p[3])/p[2]);return o[2]=l%256,l=Math.floor(l/256),o[1]=l%256,l=Math.floor(l/256),o[0]=l,o}getPixels(){return new Jf({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let p=i*this.dim,l=i*this.dim+this.dim,f=o*this.dim,w=o*this.dim+this.dim;switch(i){case-1:p=l-1;break;case 1:l=p+1}switch(o){case-1:f=w-1;break;case 1:w=f+1}const C=-i*this.dim,O=-o*this.dim;for(let x=f;x<w;x++)for(let E=p;E<l;E++){const k=4*this._idx(E,x),M=4*this._idx(E+C,x+O);this.pixels[k+0]=e.pixels[M+0],this.pixels[k+1]=e.pixels[M+1],this.pixels[k+2]=e.pixels[M+2],this.pixels[k+3]=e.pixels[M+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function gE(s,e,i){s===1?e.headerLength=i.readFixed32():s===2?e.x=i.readVarint():s===3?e.y=i.readVarint():s===4?e.z=i.readVarint():s===5&&e.layers.push(function(o,p){return o.readFields(bE,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)}(i,i.readVarint()+i.pos))}function _E(s,e,i){s===1?(e.delta_filter=function(o,p){return o.readFields(yE,{blockSize:0},p)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):s===2?(i.readVarint(),e.filter="zigzag_filter"):s===3?(i.readVarint(),e.filter="bitshuffle_filter"):s===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function yE(s,e,i){s===1&&(e.blockSize=i.readVarint())}function vE(s,e,i){s===1?(i.readVarint(),e.codec="gzip_data"):s===2?(i.readVarint(),e.codec="jpeg_image"):s===3?(i.readVarint(),e.codec="webp_image"):s===4&&(i.readVarint(),e.codec="png_image")}function xE(s,e,i){let o=0,p=0;s===1?e.firstByte=i.readFixed64():s===2?e.lastByte=i.readFixed64():s===3?e.filters.push(function(l,f){return l.readFields(_E,{},f)}(i,i.readVarint()+i.pos)):s===4?e.codec=function(l,f){return l.readFields(vE,{},f)}(i,i.readVarint()+i.pos):s===5?p=i.readFloat():s===6?o=i.readFloat():s===7?e.bands.push(i.readString()):s===8?e.offset=i.readDouble():s===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=p),e.scale===0&&(e.scale=o)}function bE(s,e,i){s===1?e.version=i.readVarint():s===2?e.name=i.readString():s===3?e.units=i.readString():s===4?e.tileSize=i.readVarint():s===5?e.buffer=i.readVarint():s===6?e.pixelFormat=i.readVarint():s===7&&e.dataIndex.push(function(o,p){return o.readFields(xE,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)}(i,i.readVarint()+i.pos))}function wE(s,e,i){if(s===2)(function(o,p,l){o.readFields(SE,l,p)})(i,i.readVarint()+i.pos,e);else if(s===3)throw new Error("Not implemented")}function SE(s,e,i){if(s===1){let o=0;const p=i.readVarint()+i.pos;for(;i.pos<p;)e[o++]=i.readVarint()}}function TE(s,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let o=2;o>=1;o--){const p=o===1?1:0,l=o===2?1:0;for(let f=0;f<e[0];f++){const w=e[1]*f;for(let C=p;C<e[1];C++){const O=e[2]*(C+w);for(let x=l;x<e[2];x++){const E=e[3]*(x+O);for(let k=0;k<e[3];k++){const M=E+k;s[M]+=s[M-i]}}}}i*=e[o]}return s}function ME(s){for(let e=0,i=s.length;e<i;e++)s[e]=s[e]>>>1^-(1&s[e]);return s}function CE(s,e){switch(e){case"uint32":return s;case"uint16":for(let i=0;i<s.length;i+=2){const o=s[i],p=s[i+1];s[i]=(240&o)>>4|(61440&o)>>8|(240&p)<<4|61440&p,s[i+1]=15&o|(3840&o)>>4|(15&p)<<8|(3840&p)<<4}return s;case"uint8":for(let i=0;i<s.length;i+=4){const o=s[i],p=s[i+1],l=s[i+2],f=s[i+3];s[i+0]=(192&o)>>6|(192&p)>>4|(192&l)>>2|192&f,s[i+1]=(48&o)>>4|(48&p)>>2|48&l|(48&f)<<2,s[i+2]=(12&o)>>2|12&p|(12&l)<<2|(12&f)<<4,s[i+3]=3&o|(3&p)<<2|(3&l)<<4|(3&f)<<6}return s;default:throw new Error(`Invalid pixel format, "${e}"`)}}_i(ay,"DEMData"),_i(fw,"DemMinMaxQuadTree",{omit:["dem"]});var ol=Uint8Array,Tg=Uint16Array,EE=Int32Array,gw=new ol([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_w=new ol([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),AE=new ol([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),yw=function(s,e){for(var i=new Tg(31),o=0;o<31;++o)i[o]=e+=1<<s[o-1];var p=new EE(i[30]);for(o=1;o<30;++o)for(var l=i[o];l<i[o+1];++l)p[l]=l-i[o]<<5|o;return{b:i,r:p}},vw=yw(gw,2),xw=vw.b,PE=vw.r;xw[28]=258,PE[258]=28;for(var DE=yw(_w,0).b,bw=new Tg(32768),us=0;us<32768;++us){var hm=(43690&us)>>1|(21845&us)<<1;bw[us]=((65280&(hm=(61680&(hm=(52428&hm)>>2|(13107&hm)<<2))>>4|(3855&hm)<<4))>>8|(255&hm)<<8)>>1}var Mg=function(s,e,i){for(var o=s.length,p=0,l=new Tg(e);p<o;++p)s[p]&&++l[s[p]-1];var f,w=new Tg(e);for(p=1;p<e;++p)w[p]=w[p-1]+l[p-1]<<1;f=new Tg(1<<e);var C=15-e;for(p=0;p<o;++p)if(s[p])for(var O=p<<4|s[p],x=e-s[p],E=w[s[p]-1]++<<x,k=E|(1<<x)-1;E<=k;++E)f[bw[E]>>C]=O;return f},Cg=new ol(288);for(us=0;us<144;++us)Cg[us]=8;for(us=144;us<256;++us)Cg[us]=9;for(us=256;us<280;++us)Cg[us]=7;for(us=280;us<288;++us)Cg[us]=8;var ww=new ol(32);for(us=0;us<32;++us)ww[us]=5;var IE=Mg(Cg,9),kE=Mg(ww,5),Ev=function(s){for(var e=s[0],i=1;i<s.length;++i)s[i]>e&&(e=s[i]);return e},kc=function(s,e,i){var o=e/8|0;return(s[o]|s[o+1]<<8)>>(7&e)&i},Av=function(s,e){var i=e/8|0;return(s[i]|s[i+1]<<8|s[i+2]<<16)>>(7&e)},OE=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Oc=function(s,e,i){var o=new Error(e||OE[s]);if(o.code=s,Error.captureStackTrace&&Error.captureStackTrace(o,Oc),!i)throw o;return o},LE=new ol(0),RE=typeof TextDecoder<"u"&&new TextDecoder;try{RE.decode(LE,{stream:!0})}catch{}const zE={gzip_data:"gzip"};class Ul extends Error{constructor(e){super(e),this.name="MRTError"}}const FE={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Sw={uint32:1,uint16:2,uint8:4},BE={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Pv;class Dv{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new Ul(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),o=new DataView(e);if(i[0]!==13)throw new Ul("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),o=this.getHeaderLength(e);if(i.length<o)throw new Ul(`Expected header with length >= ${o} but got buffer of length ${i.length}`);const p=function(l,f){return l.readFields(gE,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new Pv(i.subarray(0,o)));if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new Ul(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const l of p.layers)this.layers[l.name]=new NE(l,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],o=this.getLayer(e.layerName);for(let p of e.blockIndices){const l=o.dataIndex[p],f=l.firstByte-e.firstByte,w=l.lastByte-e.firstByte;if(o._blocksInProgress.has(p))continue;const C={layerName:o.name,firstByte:f,lastByte:w,pixelFormat:o.pixelFormat,blockIndex:p,blockShape:[l.bands.length].concat(o.bandShape),buffer:o.buffer,codec:l.codec.codec,filters:l.filters.map(O=>O.filter)};o._blocksInProgress.add(p),i.push(C)}return new Tw(i,()=>{i.forEach(p=>o._blocksInProgress.delete(p.blockIndex))},(p,l)=>{if(i.forEach(f=>o._blocksInProgress.delete(f.blockIndex)),p)throw p;l.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class NE{constructor({version:e,name:i,units:o,tileSize:p,pixelFormat:l,buffer:f,dataIndex:w},C){if(this.version=e,this.version!==1)throw new Ul(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=o,this.tileSize=p,this.buffer=f,this.pixelFormat=FE[l],this.dataIndex=w,this.bandShape=[p+2*f,p+2*f,Sw[this.pixelFormat]],this._decodedBlocks=new Mv(C?C.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Sw[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[o,p]of this.dataIndex.entries()){for(const[l,f]of p.bands.entries())if(f===e)return{bandIndex:i+l,blockIndex:o,blockBandIndex:l};i+=p.bands.length}break;case"number":for(const[o,p]of this.dataIndex.entries()){if(e>=i&&e<i+p.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-i};i+=p.bands.length}break;default:throw new Ul(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Ul(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,o=-1/0;const p=[],l=new Set;for(const f of e){const{blockIndex:w}=this.getBlockForBand(f);if(w<0)throw new Ul(`Invalid band: ${JSON.stringify(f)}`);const C=this.dataIndex[w];p.includes(w)||p.push(w),l.add(w),i=Math.min(i,C.firstByte),o=Math.max(o,C.lastByte)}if(l.size>this.cacheSize)throw new Ul(`Number of blocks to decode (${l.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:o,blockIndices:p}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:o}=this.getBlockForBand(e),p=this._decodedBlocks.get(i.toString());if(!p)throw new Ul(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const l=this.dataIndex[i],f=this.bandShape.reduce((O,x)=>O*x,1),w=o*f,C=p.subarray(w,w+f);return{data:C,bytes:new Uint8Array(C.buffer).subarray(C.byteOffset,C.byteOffset+C.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:l.offset,scale:l.scale}}}Dv.setPbf=function(s){Pv=s};class Tw{constructor(e,i,o){this.tasks=e,this._onCancel=i,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}Dv.performDecoding=function(s,e){const i=new Uint8Array(s);return Promise.all(e.tasks.map(o=>{const{layerName:p,firstByte:l,lastByte:f,pixelFormat:w,blockShape:C,blockIndex:O,filters:x,codec:E}=o,k=i.subarray(l,f+1),M=new Uint32Array(C[0]*C[1]*C[2]);let P;if(E!=="gzip_data")throw new Ul(`Unhandled codec: ${E}`);return P=function(R,$){if(!globalThis.DecompressionStream&&$==="gzip_data")return Promise.resolve(((Z=function(fe){fe[0]==31&&fe[1]==139&&fe[2]==8||Oc(6,"invalid gzip data");var Pe=fe[3],Ee=10;4&Pe&&(Ee+=2+(fe[10]|fe[11]<<8));for(var Ce=(Pe>>3&1)+(Pe>>4&1);Ce>0;Ce-=!fe[Ee++]);return Ee+(2&Pe)}(ee=R))+8>ee.length&&Oc(6,"invalid gzip data"),function(fe,Pe,Ee,Ce){var $e=fe.length;if(!$e||Pe.f&&!Pe.l)return Ee||new ol(0);var Ie=!Ee,Ge=Ie||Pe.i!=2,Ze=Pe.i;Ie&&(Ee=new ol(3*$e));var qe,et,nt=function(kd){var Jp=Ee.length;if(kd>Jp){var Dg=new ol(Math.max(2*Jp,kd));Dg.set(Ee),Ee=Dg}},ct=Pe.f||0,it=Pe.p||0,Et=Pe.b||0,Nt=Pe.l,Ct=Pe.d,si=Pe.m,ti=Pe.n,Ht=8*$e;do{if(!Nt){ct=kc(fe,it,1);var Ut=kc(fe,it+1,3);if(it+=3,!Ut){var xi=fe[(Hi=4+((it+7)/8|0))-4]|fe[Hi-3]<<8,ui=Hi+xi;if(ui>$e){Ze&&Oc(0);break}Ge&&nt(Et+xi),Ee.set(fe.subarray(Hi,ui),Et),Pe.b=Et+=xi,Pe.p=it=8*ui,Pe.f=ct;continue}if(Ut==1)Nt=IE,Ct=kE,si=9,ti=5;else if(Ut==2){var mi=kc(fe,it,31)+257,Ni=kc(fe,it+10,15)+4,Ki=mi+kc(fe,it+5,31)+1;it+=14;for(var er=new ol(Ki),tr=new ol(19),cr=0;cr<Ni;++cr)tr[AE[cr]]=kc(fe,it+3*cr,7);it+=3*Ni;var ur=Ev(tr),nn=(1<<ur)-1,Nr=Mg(tr,ur);for(cr=0;cr<Ki;){var Hi,Rr=Nr[kc(fe,it,nn)];if(it+=15&Rr,(Hi=Rr>>4)<16)er[cr++]=Hi;else{var Fr=0,hn=0;for(Hi==16?(hn=3+kc(fe,it,3),it+=2,Fr=er[cr-1]):Hi==17?(hn=3+kc(fe,it,7),it+=3):Hi==18&&(hn=11+kc(fe,it,127),it+=7);hn--;)er[cr++]=Fr}}var Zn=er.subarray(0,mi),hs=er.subarray(mi);si=Ev(Zn),ti=Ev(hs),Nt=Mg(Zn,si),Ct=Mg(hs,ti)}else Oc(1);if(it>Ht){Ze&&Oc(0);break}}Ge&&nt(Et+131072);for(var Kn=(1<<si)-1,On=(1<<ti)-1,as=it;;as=it){var _s=(Fr=Nt[Av(fe,it)&Kn])>>4;if((it+=15&Fr)>Ht){Ze&&Oc(0);break}if(Fr||Oc(2),_s<256)Ee[Et++]=_s;else{if(_s==256){as=it,Nt=null;break}var fo=_s-254;_s>264&&(fo=kc(fe,it,(1<<(Rc=gw[cr=_s-257]))-1)+xw[cr],it+=Rc);var cn=Ct[Av(fe,it)&On],xa=cn>>4;if(cn||Oc(3),it+=15&cn,hs=DE[xa],xa>3){var Rc=_w[xa];hs+=Av(fe,it)&(1<<Rc)-1,it+=Rc}if(it>Ht){Ze&&Oc(0);break}Ge&&nt(Et+131072);var jl=Et+fo;if(Et<hs){var $l=0-hs,Kp=Math.min(hs,jl);for($l+Et<0&&Oc(3);Et<Kp;++Et)Ee[Et]=(void 0)[$l+Et]}for(;Et<jl;++Et)Ee[Et]=Ee[Et-hs]}}Pe.l=Nt,Pe.p=as,Pe.b=Et,Pe.f=ct,Nt&&(ct=1,Pe.m=si,Pe.d=Ct,Pe.n=ti)}while(!ct);return Et!=Ee.length&&Ie?(qe=Ee,((et=Et)==null||et>qe.length)&&(et=qe.length),new ol(qe.subarray(0,et))):Ee.subarray(0,Et)}(ee.subarray(Z,-8),{i:2},new ol(((H=ee)[(J=H.length)-4]|H[J-3]<<8|H[J-2]<<16|H[J-1]<<24)>>>0))));var H,J,ee,Z;const ne=zE[$];if(!ne)throw new Error(`Unhandled codec: ${$}`);const le=new globalThis.DecompressionStream(ne);return new Response(new Blob([R]).stream().pipeThrough(le)).arrayBuffer().then(fe=>new Uint8Array(fe))}(k,E).then(R=>(function($,H){$.readFields(wE,H)}(new Pv(R),M),new BE[w](M.buffer))),P.then(R=>{for(let $=x.length-1;$>=0;$--)switch(x[$]){case"delta_filter":TE(R,C);break;case"zigzag_filter":ME(R);break;case"bitshuffle_filter":CE(R,w);break;default:throw new Ul(`Unhandled filter "${x[$]}"`)}return{layerName:p,blockIndex:O,data:R}}).catch(R=>{throw R})}))},_i(Tw,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let Eg,Iv,Lc,dm,kv,pm=null;function Mw(){return Pa()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Iv||ts.DRACO_URL}function Cw(){if(Pa()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(dm)return dm;const s=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return dm=WebAssembly.validate(s)?ts.MESHOPT_SIMD_URL:ts.MESHOPT_URL,dm}const ly={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},VE={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Ag={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Ew(s,e,i){const o=i.json.bufferViews.length,p=i.buffers.length;e.bufferView=o,i.json.bufferViews[o]={buffer:p,byteLength:s.byteLength},i.buffers[p]=s}const Ov="KHR_draco_mesh_compression";function UE(s,e){const i=s.extensions&&s.extensions[Ov];if(!i)return;const o=new Lc.Decoder,p=Iw(e,i.bufferView),l=new Lc.Mesh;if(!o.DecodeArrayToMesh(p,p.byteLength,l))throw new Error("Failed to decode Draco mesh");const f=e.json.accessors[s.indices],w=ly[f.componentType],C=f.count*w.BYTES_PER_ELEMENT,O=Lc._malloc(C);w===Uint16Array?o.GetTrianglesUInt16Array(l,C,O):o.GetTrianglesUInt32Array(l,C,O),Ew(Lc.memory.buffer.slice(O,O+C),f,e),Lc._free(O);for(const x of Object.keys(i.attributes)){const E=o.GetAttributeByUniqueId(l,i.attributes[x]),k=e.json.accessors[s.attributes[x]],M=VE[k.componentType],P=k.count*Ag[k.type]*ly[k.componentType].BYTES_PER_ELEMENT,R=Lc._malloc(P);o.GetAttributeDataArrayForAllPoints(l,E,Lc[M],P,R),Ew(Lc.memory.buffer.slice(R,R+P),k,e),Lc._free(R)}o.destroy(),l.destroy(),delete s.extensions[Ov]}const cy="EXT_meshopt_compression";function jE(s,e){if(!s.extensions||!s.extensions[cy])return;const i=s.extensions[cy],o=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),p=new Uint8Array(i.count*i.byteStride);kv.decodeGltfBuffer(p,i.count,i.byteStride,o,i.mode,i.filter),s.buffer=e.buffers.length,s.byteOffset=0,e.buffers[s.buffer]=p.buffer,delete s.extensions[cy]}const Aw=1179937895,Pw=new TextDecoder("utf8");function Dw(s,e){return new URL(s,e).href}function $E(s,e,i,o){return fetch(Dw(s.uri,o)).then(p=>p.arrayBuffer()).then(p=>{e.buffers[i]=p})}function Iw(s,e){const i=s.json.bufferViews[e];return new Uint8Array(s.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function HE(s,e,i,o){if(s.uri){const p=Dw(s.uri,o);return fetch(p).then(l=>l.blob()).then(l=>createImageBitmap(l)).then(l=>{e.images[i]=l})}if(s.bufferView!==void 0){const p=Iw(e,s.bufferView),l=new Blob([p],{type:s.mimeType});return createImageBitmap(l).then(f=>{e.images[i]=f})}}function kw(s,e=0,i){const o={json:null,images:[],buffers:[]};if(new Uint32Array(s,e,1)[0]===Aw){const x=new Uint32Array(s,e);let E=2;const k=(x[E++]>>2)-3,M=x[E++]>>2;if(E++,o.json=JSON.parse(Pw.decode(x.subarray(E,E+M))),E+=M,E<k){const P=x[E++];E++;const R=e+(E<<2);o.buffers[0]=s.slice(R,R+P)}}else o.json=JSON.parse(Pw.decode(new Uint8Array(s,e)));const{buffers:p,images:l,meshes:f,extensionsUsed:w,bufferViews:C}=o.json;let O=Promise.resolve();if(p){const x=[];for(let E=0;E<p.length;E++){const k=p[E];k.uri?x.push($E(k,o,E,i)):o.buffers[E]||(o.buffers[E]=null)}O=Promise.all(x)}return O.then(()=>{const x=[],E=w&&w.includes(Ov),k=w&&w.includes(cy);if(E&&x.push(function(){if(!Lc)return Eg??(Eg=function(M){let P,R=null;function $(){P=new Uint8Array(R.buffer)}function H(){throw new Error("Unexpected Draco error.")}const J={a:{a:H,d:function(ee,Z,ne){return P.copyWithin(ee,Z,Z+ne)},c:function(ee){const Z=P.length,ne=Math.max(ee>>>0,Math.ceil(1.2*Z)),le=Math.ceil((ne-Z)/65536);try{return R.grow(le),$(),!0}catch{return!1}},b:H}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(M,J):M.then(ee=>ee.arrayBuffer()).then(ee=>WebAssembly.instantiate(ee,J))).then(ee=>{const{Rb:Z,Qb:ne,P:le,T:fe,X:Pe,Ja:Ee,La:Ce,Qa:$e,Va:Ie,Wa:Ge,eb:Ze,jb:qe,f:et,e:nt,yb:ct,zb:it,Ab:Et,Bb:Nt,Db:Ct,Gb:si}=ee.instance.exports;R=nt;const ti=(()=>{let Ht=0,Ut=0,xi=0,ui=0;return mi=>{xi&&(Z(ui),Z(Ht),Ut+=xi,xi=Ht=0),Ht||(Ut+=128,Ht=ne(Ut));const Ni=mi.length+7&-8;let Ki=Ht;Ni>=Ut&&(xi=Ni,Ki=ui=ne(Ni));for(let er=0;er<mi.length;er++)P[Ki+er]=mi[er];return Ki}})();return $(),et(),{memory:nt,_free:Z,_malloc:ne,Mesh:class{constructor(){this.ptr=le()}destroy(){fe(this.ptr)}},Decoder:class{constructor(){this.ptr=Ee()}destroy(){qe(this.ptr)}DecodeArrayToMesh(Ht,Ut,xi){const ui=ti(Ht),mi=Ce(this.ptr,ui,Ut,xi.ptr);return!!Pe(mi)}GetAttributeByUniqueId(Ht,Ut){return{ptr:$e(this.ptr,Ht.ptr,Ut)}}GetTrianglesUInt16Array(Ht,Ut,xi){Ie(this.ptr,Ht.ptr,Ut,xi)}GetTrianglesUInt32Array(Ht,Ut,xi){Ge(this.ptr,Ht.ptr,Ut,xi)}GetAttributeDataArrayForAllPoints(Ht,Ut,xi,ui,mi){Ze(this.ptr,Ht.ptr,Ut.ptr,xi,ui,mi)}},DT_INT8:ct(),DT_UINT8:it(),DT_INT16:Et(),DT_UINT16:Nt(),DT_UINT32:Ct(),DT_FLOAT32:si()}})}(fetch(Mw())),Eg.then(M=>{Lc=M,Eg=void 0}))}()),k&&x.push(function(){if(kv)return;const M=function(P){let R;const $=WebAssembly.instantiateStreaming(P,{}).then(ee=>{R=ee.instance,R.exports.__wasm_call_ctors()}),H={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},J={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:$,supported:!0,decodeGltfBuffer(ee,Z,ne,le,fe,Pe){(function(Ee,Ce,$e,Ie,Ge,Ze,qe){const et=Ee.exports.sbrk,nt=Ie+3&-4,ct=et(nt*Ge),it=et(Ze.length),Et=new Uint8Array(Ee.exports.memory.buffer);Et.set(Ze,it);const Nt=Ce(ct,Ie,Ge,it,Ze.length);if(Nt===0&&qe&&qe(ct,nt,Ge),$e.set(Et.subarray(ct,ct+Ie*Ge)),et(ct-et(0)),Nt!==0)throw new Error(`Malformed buffer data: ${Nt}`)})(R,R.exports[J[fe]],ee,Z,ne,le,R.exports[H[Pe]])}}}(fetch(Cw()));return M.ready.then(()=>{kv=M})}()),l)for(let M=0;M<l.length;M++)x.push(HE(l[M],o,M,i));return(x.length?Promise.all(x):Promise.resolve()).then(()=>{if(E&&f)for(const{primitives:M}of f)for(const P of M)UE(P,o);if(k&&f&&C)for(const M of C)jE(M,o);return o})})}function Zp(s,e){const i=s.json.bufferViews[e.bufferView],o=ly[e.componentType];return new o(s.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Ag[e.type]*o.BYTES_PER_ELEMENT?i.byteStride/o.BYTES_PER_ELEMENT:Ag[e.type]))}function Lv(s,e,i,o){const p=ly[e.componentType],l=function(x){switch(x){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),f=s.json.bufferViews[e.bufferView],w=f.byteStride?f.byteStride/p.BYTES_PER_ELEMENT:Ag[e.type],C=i.float32,O=C.length/i.capacity;for(let x=0,E=0;x<e.count*w;x+=w,E+=O)for(let k=0;k<O;k++)C[E+k]=o[x+k]*l;i._trim()}function GE(s,e,i){const o=s.indices,p=s.attributes,l={};l.indexArray=new gs;const f=e.json.accessors[o],w=f.count/3;l.indexArray.reserve(w);const C=Zp(e,f);for(let k=0;k<w;k++)l.indexArray.emplaceBack(C[3*k],C[3*k+1],C[3*k+2]);l.indexArray._trim(),l.vertexArray=new ha;const O=e.json.accessors[p.POSITION];l.vertexArray.reserve(O.count);const x=Zp(e,O);for(let k=0;k<O.count;k++)l.vertexArray.emplaceBack(x[3*k],x[3*k+1],x[3*k+2]);if(l.vertexArray._trim(),l.aabb=new bi(O.min,O.max),l.centroid=function(k,M){const P=[0,0,0],R=k.length;if(R>0){for(let $=0;$<R;$++){const H=3*k[$];P[0]+=M[H],P[1]+=M[H+1],P[2]+=M[H+2]}P[0]/=R,P[1]/=R,P[2]/=R}return P}(C,x),p.COLOR_0!==void 0){const k=e.json.accessors[p.COLOR_0],M=Ag[k.type],P=Zp(e,k);l.colorArray=M===3?new ha:new ln,l.colorArray.resize(k.count),Lv(e,k,l.colorArray,P)}if(p.NORMAL!==void 0){l.normalArray=new ha;const k=e.json.accessors[p.NORMAL];l.normalArray.resize(k.count);const M=Zp(e,k);Lv(e,k,l.normalArray,M)}if(p.TEXCOORD_0!==void 0&&i.length>0){l.texcoordArray=new Ll;const k=e.json.accessors[p.TEXCOORD_0];l.texcoordArray.resize(k.count);const M=Zp(e,k);Lv(e,k,l.texcoordArray,M)}if(p._FEATURE_ID_RGBA4444!==void 0){const k=e.json.accessors[p._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(l.featureData=Zp(e,k))}p._FEATURE_RGBA4444!==void 0&&(l.featureData=new Uint32Array(Zp(e,e.json.accessors[p._FEATURE_RGBA4444]).buffer));const E=s.material;return l.material=function(k,M){const{emissiveFactor:P=[0,0,0],alphaMode:R="OPAQUE",alphaCutoff:$=.5,normalTexture:H,occlusionTexture:J,emissiveTexture:ee,doubleSided:Z}=k,{baseColorFactor:ne=[1,1,1,1],metallicFactor:le=1,roughnessFactor:fe=1,baseColorTexture:Pe,metallicRoughnessTexture:Ee}=k.pbrMetallicRoughness||{},Ce=J?M[J.index]:void 0;if(J&&J.extensions&&J.extensions.KHR_texture_transform&&Ce){const $e=J.extensions.KHR_texture_transform;Ce.offsetScale=[$e.offset[0],$e.offset[1],$e.scale[0],$e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Ar(...ne),metallicFactor:le,roughnessFactor:fe,baseColorTexture:Pe?M[Pe.index]:void 0,metallicRoughnessTexture:Ee?M[Ee.index]:void 0},doubleSided:Z,emissiveFactor:P,alphaMode:R,alphaCutoff:$,normalTexture:H?M[H.index]:void 0,occlusionTexture:Ce,emissionTexture:ee?M[ee.index]:void 0,defined:k.defined===void 0}}(E!==void 0?e.json.materials[E]:{defined:!1},i),l}function Ow(s,e,i){const{matrix:o,rotation:p,translation:l,scale:f,mesh:w,extras:C,children:O}=s,x={};if(x.matrix=o||Ye.mat4.fromRotationTranslationScale([],p||[0,0,0,1],l||[0,0,0],f||[1,1,1]),w!==void 0){x.meshes=i[w];const E=x.anchor=[0,0];for(const k of x.meshes){const{min:M,max:P}=k.aabb;E[0]+=M[0]+P[0],E[1]+=M[1]+P[1]}E[0]=Math.floor(E[0]/x.meshes.length/2),E[1]=Math.floor(E[1]/x.meshes.length/2)}if(C&&(C.id&&(x.id=C.id),C.lights&&(x.lights=function(E){if(!E.length)return[];const k=function(H){const J=atob(H),ee=new Uint8Array(J.length);for(let Z=0;Z<J.length;Z++)ee[Z]=J.codePointAt(Z);return ee}(E),M=[],P=k.length/24,R=new Uint16Array(k.buffer),$=new Float32Array(k.buffer);for(let H=0;H<P;H++){const J=R[2*H*6]/30,ee=R[2*H*6+1]/30,Z=R[2*H*6+10]/100,ne=$[6*H+1],le=$[6*H+2],fe=$[6*H+3],Pe=$[6*H+4],Ee=fe-ne,Ce=Pe-le,$e=Math.hypot(Ee,Ce);M.push({pos:[ne+.5*Ee,le+.5*Ce,ee],normal:[Ce/$e,-Ee/$e,0],width:$e,height:J,depth:Z,points:[ne,le,fe,Pe]})}return M}(C.lights))),O){const E=[];for(const k of O)E.push(Ow(e.json.nodes[k],e,i));x.children=E}return x}function WE(s){if(s.vertices.length===0||s.indices.length===0)return null;const e=new ng(s.vertices,s.indices,8,256),[i,o]=[e.min.clone(),e.max.clone()];return{vertices:s.vertices,indices:s.indices,grid:e,min:i,max:o}}function qE(s){if(!s.extras||!s.extras.ground)return null;const e=s.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const o=[];for(const f of i){if(!Array.isArray(f)||f.length!==2)continue;const w=f[0],C=f[1];typeof w=="number"&&typeof C=="number"&&o.push(new Wt(w,C))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let p=0;for(let f=0;f<o.length;f++){const w=o[f],C=o[(f+1)%o.length],O=o[(f+2)%o.length];p+=(w.x-C.x)*(O.y-C.y)-(O.x-C.x)*(w.y-C.y)}p>0&&o.reverse();const l=Sd(o.flatMap(f=>[f.x,f.y]),[]);return l.length===0?null:{vertices:o,indices:l}}function YE(s,e){const i=[],o=[];let p=0;const l=[];for(const f of s){p=i.length;const w=f.vertexArray.float32,C=f.indexArray.uint16;for(let O=0;O<f.vertexArray.length;O++)l[0]=w[3*O+0],l[1]=w[3*O+1],l[2]=w[3*O+2],Ye.vec3.transformMat4(l,l,e),i.push(new Wt(l[0],l[1]));for(let O=0;O<3*f.indexArray.length;O++)o.push(C[O]+p)}if(o.length%3!=0)return null;for(let f=0;f<o.length;f+=3){const w=i[o[f+0]],C=i[o[f+1]],O=i[o[f+2]];(w.x-C.x)*(O.y-C.y)-(O.x-C.x)*(w.y-C.y)>0&&([o[f+1],o[f+2]]=[o[f+2],o[f+1]])}return{vertices:i,indices:o}}function Lw(s){const e=function(C,O){const x=[],E=WebGL2RenderingContext;if(C.json.textures)for(const k of C.json.textures){const M={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};k.sampler!==void 0&&Object.assign(M,C.json.samplers[k.sampler]),x.push({image:O[k.source],sampler:M,uploaded:!1})}return x}(s,s.images),i=function(C,O){const x=[];for(const E of C.json.meshes){const k=[];for(const M of E.primitives)k.push(GE(M,C,O));x.push(k)}return x}(s,e),{scenes:o,scene:p,nodes:l}=s.json,f=o?o[p||0].nodes:l,w=[];for(const C of f)w.push(Ow(l[C],s,i));return function(C,O,x){const E={},k=new Set;for(let M=0;M<C.length;M++){const P=x[O[M]];if(!P.extras)continue;const R=P.extras["mapbox:footprint:version"],$=P.extras["mapbox:footprint:id"];(R||$)&&k.add(M),R==="1.0.0"&&$&&(E[$]=M)}for(let M=0;M<C.length;M++){if(k.has(M))continue;const P=C[M],R=x[O[M]];if(!R.extras)continue;let $=null;P.id in E&&($=YE(C[E[P.id]].meshes,P.matrix)),$||($=qE(R)),$&&(P.footprint=WE($))}if(k.size>0){const M=Array.from(k.values()).sort((P,R)=>P-R);for(let P=M.length-1;P>=0;P--)C.splice(M[P],1)}}(w,f,s.json.nodes),w}function XE(s){s.heightmap=new Float32Array(4096),s.heightmap.fill(-1);const e=s.vertexArray.float32,i=s.aabb.min[0]-1,o=s.aabb.min[1]-1,p=qp/(s.aabb.max[0]-i+2),l=qp/(s.aabb.max[1]-o+2);for(let f=0;f<e.length;f+=3){const w=e[f+2],C=(e[f+0]-i)*p|0,O=(e[f+1]-o)*l|0;w>s.heightmap[O*qp+C]&&(s.heightmap[O*qp+C]=w)}}function ZE(s,e){const i={};i.indexArray=new gs,i.indexArray.reserve(4*s.length),i.vertexArray=new ha,i.vertexArray.reserve(10*s.length),i.colorArray=new ln,i.vertexArray.reserve(10*s.length);let o=0;for(const f of s){const w=Math.min(10,Math.max(4,1.3*f.height))*e,C=[-f.normal[1],f.normal[0],0],O=Math.min(.29,.1*f.width/f.depth),x=f.width-2*f.depth*e*(O+.01),E=Ye.vec3.scaleAndAdd([],f.pos,C,x/2),k=Ye.vec3.scaleAndAdd([],f.pos,C,-x/2),M=[E[0],E[1],E[2]+f.height],P=[k[0],k[1],k[2]+f.height],R=Ye.vec3.scaleAndAdd([],f.normal,C,O);Ye.vec3.scale(R,R,w);const $=Ye.vec3.scaleAndAdd([],f.normal,C,-O);Ye.vec3.scale($,$,w),Ye.vec3.add(R,E,R),Ye.vec3.add($,k,$),E[2]+=.1,k[2]+=.1,i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack($[0],$[1],$[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(k[0],k[1],k[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(k[0],k[1],k[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack($[0],$[1],$[2]);const H=x/w/2;i.colorArray.emplaceBack(-H-O,-1,H,.8),i.colorArray.emplaceBack(H+O,-1,H,.8),i.colorArray.emplaceBack(-H,0,H,1.3),i.colorArray.emplaceBack(H,0,H,1.3),i.colorArray.emplaceBack(H+O,-.8,H,.7),i.colorArray.emplaceBack(H+O,-.8,H,.7),i.colorArray.emplaceBack(0,0,H,1.3),i.colorArray.emplaceBack(0,0,H,1.3),i.colorArray.emplaceBack(H+O,-1.2,H,.8),i.colorArray.emplaceBack(H+O,-1.2,H,.8),i.indexArray.emplaceBack(6+o,4+o,8+o),i.indexArray.emplaceBack(7+o,9+o,5+o),i.indexArray.emplaceBack(0+o,1+o,2+o),i.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}const p={defined:!0,emissiveFactor:[0,0,0]},l={};return l.baseColorFactor=Ar.white,p.pbrMetallicRoughness=l,i.material=p,i.aabb=new bi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class Rw{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const KE=["id","tile","layer","source","sourceLayer","state"];class fm{constructor(e,i,o,p,l){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=o,this._y=p,this.properties=e.properties,this.id=l}clone(){const e=new fm(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of KE)this[i]!==void 0&&(e[i]=this[i]);return e}}class zw{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new fc(ei,16,0),this.featureIndexArray=new wc,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,o,p,l,f=0,w=0){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,p,l,f);const O=this.grid;for(let x=0;x<i.length;x++){const E=i[x],k=[1/0,1/0,-1/0,-1/0];for(let M=0;M<E.length;M++){const P=E[M];k[0]=Math.min(k[0],P.x),k[1]=Math.min(k[1],P.y),k[2]=Math.max(k[2],P.x),k[3]=Math.max(k[3],P.y)}w!==0&&(k[0]-=w,k[1]-=w,k[2]+=w,k[3]+=w),k[0]<ei&&k[1]<ei&&k[2]>=0&&k[3]>=0&&O.insert(C,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new be.VectorTile(new k_(this.rawTileData)).layers,this.sourceLayerCoder=new Rw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:o,transform:p,tileTransform:l,pixelPosMatrix:f,availableImages:w}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const C=o.bufferedTilespaceBounds,O=this.grid.query(C.min.x,C.min.y,C.max.x,C.max.y,(M,P,R,$)=>We(o.bufferedTilespaceGeometry,M,P,R,$));O.sort(JE);let x=null;p.elevation&&O.length>0&&(x=am.create(p.elevation,this.tileID));const E={};let k;for(let M=0;M<O.length;M++){const P=O[M];if(P===k)continue;k=P;const R=this.featureIndexArray.get(P);let $=null;this.is3DTile?this.loadMatchingModelFeature(E,R,e,o,p):this.loadMatchingFeature(E,R,e,w,(H,J,ee,Z=0)=>($||($=j(H,this.tileID.canonical,l)),J.queryIntersectsFeature(o,H,ee,$,this.z,p,f,x,Z)))}return E}loadMatchingFeature(e,i,o,p,l){const{featureIndex:f,bucketIndex:w,sourceLayerIndex:C,layoutVertexArrayOffset:O}=i,x=this.bucketLayerIDs[w],E=o.layers,k=Object.keys(E);if(k.length&&!function(H,J){for(let ee=0;ee<H.length;ee++)if(J.indexOf(H[ee])>=0)return!0;return!1}(k,x))return;const M=o.sourceCache,P=this.sourceLayerCoder.decode(C),R=this.vtLayers[P].feature(f),$=this.getId(R,P);for(let H=0;H<x.length;H++){const J=x[H];if(!E[J])continue;const{styleLayer:ee,targets:Z}=E[J];let ne={};$!==void 0&&(ne=M.getFeatureState(ee.sourceLayer,$));const le=!l||l(R,ee,ne,O);if(!le)continue;const fe=new fm(R,this.z,this.x,this.y,$);fe.tile=this.tileID.canonical,fe.state=ne;let Pe=this.serializedLayersCache.get(J);Pe||(Pe=ee.serialize(),Pe.id=J,this.serializedLayersCache.set(J,Pe)),fe.source=Pe.source,fe.sourceLayer=Pe["source-layer"],fe.layer=Zs({},Pe),fe.layer.paint=Fw(Pe.paint,ee.paint,R,ne,p),fe.layer.layout=Fw(Pe.layout,ee.layout,R,ne,p);let Ee=!1;for(const Ce of Z){this.updateFeatureProperties(fe,Ce);const{filter:$e}=Ce;if($e){if(R.properties=fe.properties,$e.needGeometry){const Ie=G(R,!0);if(!$e.filter(new Vr(this.tileID.overscaledZ),Ie,this.tileID.canonical))continue}else if(!$e.filter(new Vr(this.tileID.overscaledZ),R))continue}Ee=!0,Ce.targetId&&this.addFeatureVariant(fe,Ce)}Ee&&this.appendToResult(e,J,f,fe,le)}}loadMatchingModelFeature(e,i,o,p,l){const f=this.bucketLayerIDs[0][0],w=o.layers;if(!w[f])return;const{styleLayer:C,targets:O}=w[f];if(C.type!=="model")return;const x=p.tile,E=i.featureIndex,k=x.getBucket(C);if(!(k&&k instanceof ey))return;const M=function(Pe,Ee,Ce,$e){const Ie=Pe.getNodesInfo()[Ee];if(Ie.hiddenByReplacement||!Ie.node.meshes)return;let Ge=Number.MAX_VALUE;const Ze=Ie.node,qe=Ce.tile,et=$e.calculatePosMatrix(qe.tileID.toUnwrapped(),$e.worldSize),nt=Ie.evaluatedScale;let ct=0;$e.elevation&&Ze.elevation&&(ct=Ze.elevation*$e.elevation.exaggeration()),Ye.mat4.translate(et,et,[(Ze.anchor?Ze.anchor[0]:0)*(nt[0]-1),(Ze.anchor?Ze.anchor[1]:0)*(nt[1]-1),ct]),Ye.mat4.scale(et,et,nt);const it=Ce.queryGeometry,Et=it.isPointQuery()?it.screenBounds:it.screenGeometry,Nt=function(si){const ti=Ye.mat4.multiply([],et,si.matrix);Ye.mat4.multiply(ti,$e.expandedFarZProjMatrix,ti);for(let Ht=0;Ht<si.meshes.length;++Ht){const Ut=si.meshes[Ht];if(Ht===si.lightMeshIndex)continue;const xi=R1(Et,$e,ti,Ut.aabb);xi!=null&&(Ge=Math.min(xi,Ge))}if(si.children)for(const Ht of si.children)Nt(Ht)};if(Nt(Ze),Ge===Number.MAX_VALUE)return;const Ct=new Cr(0,0);return q1(qe.tileID.canonical,Ct,Ie.node.anchor[0],Ie.node.anchor[1]),{intersectionZ:Ge,position:Ct,feature:Ie.feature}}(k,E,p,l);if(!M)return;const{z:P,x:R,y:$}=x.tileID.canonical,{feature:H,intersectionZ:J,position:ee}=M;let Z={};H.id!==void 0&&(Z=o.sourceCache.getFeatureState(C.sourceLayer,H.id));const ne=new fm({},P,R,$,H.id);ne.tile=this.tileID.canonical,ne.state=Z,ne.properties=H.properties,ne.geometry={type:"Point",coordinates:[ee.lng,ee.lat]};let le=this.serializedLayersCache.get(f);le||(le=C.serialize(),le.id=f,this.serializedLayersCache.set(f,le)),ne.source=le.source,ne.sourceLayer=le["source-layer"],ne.layer=Zs({},le);let fe=!1;for(const Pe of O){this.updateFeatureProperties(ne,Pe);const{filter:Ee}=Pe;if(Ee){if(H.properties=ne.properties,Ee.needGeometry){if(!Ee.filter(new Vr(this.tileID.overscaledZ),H,this.tileID.canonical))continue}else if(!Ee.filter(new Vr(this.tileID.overscaledZ),H))continue}fe=!0,Pe.targetId&&this.addFeatureVariant(ne,Pe)}fe&&this.appendToResult(e,f,E,ne,J)}updateFeatureProperties(e,i,o){if(i.properties){const p={};for(const l in i.properties){const f=i.properties[l].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,o);f!=null&&(p[l]=f)}e.properties=p}}addFeatureVariant(e,i,o){const p={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(p.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(p)}appendToResult(e,i,o,p,l){let f=e[i];f===void 0&&(f=e[i]=[]),f.push({featureIndex:o,feature:p,intersectionZ:l})}lookupSymbolFeatures(e,i,o,p,l){const f={};this.loadVTLayers();for(const w of e)this.loadMatchingFeature(f,{bucketIndex:i,sourceLayerIndex:o,featureIndex:w,layoutVertexArrayOffset:0},p,l);return f}loadFeature(e){const{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();const p=this.sourceLayerCoder.decode(o),l=this.vtFeatures[p];if(l[i])return l[i];const f=this.vtLayers[p].feature(i);return l[i]=f,f}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;if(this.promoteId){const p=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(p!=null)if(Array.isArray(p)){if(!this.promoteIdExpression){const l=la(p);if(l.result!=="success"){const f=l.value.map(w=>`${w.key}: ${w.message}`).join(", ");return void qi(`Failed to create expression for promoteId: ${f}`)}this.promoteIdExpression=l.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Qd),o=this.promoteIdExpression.evaluate({zoom:0},e)}else o=e.properties[p];typeof o=="boolean"&&(o=Number(o))}return o}}function Fw(s,e,i,o,p){return na(s,(l,f)=>{const w=e instanceof yc?e.get(f):null;return w&&w.evaluate?w.evaluate(i,o,p):w})}function JE(s,e){return e-s}_i(zw,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Bw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Rv{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=o>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const l=Bw[15&o];if(!l)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[w]=new Uint32Array(e,4,1);return new Rv(w,f,l,e)}constructor(e,i=64,o=Float64Array,p){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const l=Bw.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,w=e*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-w%8)%8;if(l<0)throw new Error(`Unexpected typed array class: ${o}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+C,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+w+C),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+C,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+l]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return zv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:f,nodeSize:w}=this,C=[0,l.length-1,0],O=[];for(;C.length;){const x=C.pop()||0,E=C.pop()||0,k=C.pop()||0;if(E-k<=w){for(let $=k;$<=E;$++){const H=f[2*$],J=f[2*$+1];H>=e&&H<=o&&J>=i&&J<=p&&O.push(l[$])}continue}const M=k+E>>1,P=f[2*M],R=f[2*M+1];P>=e&&P<=o&&R>=i&&R<=p&&O.push(l[M]),(x===0?e<=P:i<=R)&&(C.push(k),C.push(M-1),C.push(1-x)),(x===0?o>=P:p>=R)&&(C.push(M+1),C.push(E),C.push(1-x))}return O}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:l,nodeSize:f}=this,w=[0,p.length-1,0],C=[],O=o*o;for(;w.length;){const x=w.pop()||0,E=w.pop()||0,k=w.pop()||0;if(E-k<=f){for(let $=k;$<=E;$++)Vw(l[2*$],l[2*$+1],e,i)<=O&&C.push(p[$]);continue}const M=k+E>>1,P=l[2*M],R=l[2*M+1];Vw(P,R,e,i)<=O&&C.push(p[M]),(x===0?e-o<=P:i-o<=R)&&(w.push(k),w.push(M-1),w.push(1-x)),(x===0?e+o>=P:i+o>=R)&&(w.push(M+1),w.push(E),w.push(1-x))}return C}}function zv(s,e,i,o,p,l){if(p-o<=i)return;const f=o+p>>1;Nw(s,e,f,o,p,l),zv(s,e,i,o,f-1,1-l),zv(s,e,i,f+1,p,1-l)}function Nw(s,e,i,o,p,l){for(;p>o;){if(p-o>600){const O=p-o+1,x=i-o+1,E=Math.log(O),k=.5*Math.exp(2*E/3),M=.5*Math.sqrt(E*k*(O-k)/O)*(x-O/2<0?-1:1);Nw(s,e,i,Math.max(o,Math.floor(i-x*k/O+M)),Math.min(p,Math.floor(i+(O-x)*k/O+M)),l)}const f=e[2*i+l];let w=o,C=p;for(Pg(s,e,o,i),e[2*p+l]>f&&Pg(s,e,o,p);w<C;){for(Pg(s,e,w,C),w++,C--;e[2*w+l]<f;)w++;for(;e[2*C+l]>f;)C--}e[2*o+l]===f?Pg(s,e,o,C):(C++,Pg(s,e,C,p)),C<=i&&(o=C+1),i<=C&&(p=C-1)}}function Pg(s,e,i,o){Fv(s,i,o),Fv(e,2*i,2*o),Fv(e,2*i+1,2*o+1)}function Fv(s,e,i){const o=s[e];s[e]=s[i],s[i]=o}function Vw(s,e,i,o){const p=s-i,l=e-o;return p*p+l*l}r.$=hd,r.A=ks,r.B=2,r.C=hg,r.D=lm,r.E=aa,r.F=Jb,r.G=class extends J_{},r.H=Oo,r.I=Cv,r.J=Bh,r.K=Vf,r.L=nh,r.M=uu,r.N=nd,r.O=pu,r.P=Wt,r.Q=uh,r.R=Pr,r.S=zf,r.T=dv,r.U=la,r.V=J_,r.W=ru,r.X=Xa,r.Y=iu,r.Z=no,r._=Yo,r.a=function(s){return ts.API_CDN_URL_REGEX.test(s)},r.a$=fm,r.a0=El,r.a1=If,r.a2=function(s){const e=s.value;let i=[];if(!e)return i;const o=Oo(e);return o!=="string"?(i=i.concat([new J_(s.key,e,`string expected, "${o}" found`)]),i):(F1(e,!0)||(i=i.concat([new J_(s.key,e,`invalid url "${e}"`)])),i)},r.a3=dt,r.a4=bo,r.a5=on,r.a6=Gt,r.a7=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return Jr(s.expression.evaluate(e))}interpolate(s,e,i){return{x:Di(s.x,e.x,i),y:Di(s.y,e.y,i),z:Di(s.z,e.z,i),azimuthal:Di(s.azimuthal,e.azimuthal,i),polar:Di(s.polar,e.polar,i)}}},r.a8=Vr,r.a9=dc,r.aA=ya,r.aB=class{constructor(s){this.entries={},this.scheduler=s}request(s,e,i,o){const p=this.entries[s]=this.entries[s]||{callbacks:[]};if(p.result){const[l,f]=p.result;return this.scheduler?this.scheduler.add(()=>{o(l,f)},e):o(l,f),()=>{}}return p.callbacks.push(o),p.cancel||(p.cancel=i((l,f)=>{p.result=[l,f];for(const w of p.callbacks)this.scheduler?this.scheduler.add(()=>{w(l,f)},e):w(l,f);setTimeout(()=>delete this.entries[s],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(l=>l!==o),p.callbacks.length||(p.cancel(),delete this.entries[s]))}}},r.aC=ua,r.aD=function(s,e,i){const o=JSON.stringify(s.request);return s.data&&(this.deduped.entries[o]={result:[null,s.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},p=>{const l=Nn(s.request,(f,w,C,O)=>{f?p(f):w&&p(null,{vectorTile:i?void 0:new be.VectorTile(new k_(w)),rawData:w,cacheControl:C,expires:O})});return()=>{l.cancel(),p()}},e)},r.aE=function(s){fi++,fi>mt&&(s.getActor().send("enforceCacheSizeLimit",Je),fi=0)},r.aF=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},r.aG=$t,r.aH=T1,r.aI=D1,r.aJ=S1,r.aK=function(s,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<s.length;o++){const p=document.createElement("source");$s(s[o])||(i.crossOrigin="Anonymous"),p.src=s[o],i.appendChild(p)}return{cancel:()=>{}}},r.aL=q_,r.aM=function(s){return fetch(s).then(e=>e.arrayBuffer()).then(e=>kw(e,0,s))},r.aN=Lw,r.aO=class{constructor(s,e,i,o){this.id=s,this.position=e!=null?new Cr(e[0],e[1]):new Cr(0,0),this.orientation=i??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new bi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(s,e){if(Ye.mat4.multiply(s.matrix,e,s.matrix),s.meshes)for(const i of s.meshes){const o=bi.applyTransformFast(i.aabb,s.matrix);this.aabb.encapsulate(o)}if(s.children)for(const i of s.children)this._applyTransformations(i,s.matrix)}computeBoundsAndApplyParent(){const s=Ye.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,s)}computeModelMatrix(s,e,i,o,p,l,f=!1){j1(this.matrix,this,s.transform,this.position,e,i,o,p,l,f)}upload(s){if(!this.uploaded){for(const e of this.nodes)_v(e,s);for(const e of this.nodes)Q_(e);this.uploaded=!0}}destroy(){for(const s of this.nodes)yv(s)}},r.aP=Vc,r.aQ=pg,r.aR=co,r.aS=Wn,r.aT=tn,r.aU=gs,r.aV=$a,r.aW=Ap,r.aX=G_,r.aY=function(){Qs.isLoading()||Qs.isLoaded()||lh()!=="deferred"||Qo()},r.aZ=yp,r.a_=G,r.aa=n,r.ab=Ye,r.ac=Kr,r.ad=yc,r.ae=ho,r.af=Di,r.ag=ei,r.ah=Xd,r.ai=rr,r.aj=Ar,r.ak=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return function([i,o]){const p=Jr([1,i,o]);return{x:p.x,y:p.y,z:p.z}}(s.expression.evaluate(e))}interpolate(s,e,i){return{x:Di(s.x,e.x,i),y:Di(s.y,e.y,i),z:Di(s.z,e.z,i)}}},r.al=function(s,e,i=0,o=!0){const p=new Wt(i,i),l=s.sub(p),f=e.add(p),w=[l,new Wt(f.x,l.y),f,new Wt(l.x,f.y)];return o&&w.push(l.clone()),w},r.am=function(s,e){const i=[];for(let o=0;o<s.length;o++){const p=ra(o-1,-1,s.length-1),l=ra(o+1,-1,s.length-1),f=s[o],w=s[l],C=s[p].sub(f).unit(),O=w.sub(f).unit(),x=O.angleWithSep(C.x,C.y),E=C.add(O).unit().mult(-1*e/Math.sin(x/2));i.push(f.add(E))}return i},r.an=c1,r.ao=We,r.ap=function(s,e,i=0){return Ye.vec3.fromValues(((e.x-i)*s.scale-s.x)*ei,(e.y*s.scale-s.y)*ei,zp(e.z,e.y))},r.aq=ji,r.ar=Ab,r.as=function(s){let e=1/0,i=1/0,o=-1/0,p=-1/0;for(const l of s)e=Math.min(e,l.x),i=Math.min(i,l.y),o=Math.max(o,l.x),p=Math.max(p,l.y);return{min:new Wt(e,i),max:new Wt(o,p)}},r.at=_a,r.au=Oe,r.av=y,r.aw=nr,r.ax=Gn,r.ay=function(s,e){const i={};for(let o=0;o<e.length;o++){const p=e[o];p in s&&(i[p]=s[p])}return i},r.az=rl,r.b=function(s){return ts.API_FONTS_REGEX.test(s)},r.b$=Z_,r.b0=Uc,r.b1=G0,r.b2=rg,r.b3=j,r.b4=wo,r.b5=Ep,r.b6=Ci,r.b7=Sn,r.b8=Sd,r.b9=cv,r.bA=Gi,r.bB=rv,r.bC=s1,r.bD=ev,r.bE=Rv,r.bF=ra,r.bG=jc,r.bH=to,r.bI=function(s,e,i){s[4*e+0]=i[0],s[4*e+1]=i[1],s[4*e+2]=i[2],s[4*e+3]=i[3]},r.bJ=Tc,r.bK=To,r.bL=Bo,r.bM=Pn,r.bN=xh,r.bO=Cr,r.bP=f1,r.bQ=kt,r.bR=lr,r.bS=k1,r.bT=Bt,r.bU=Gs,r.bV=function(s,e,i,o,p,l,f,w,C){if(C.name==="globe")return Gs(s,e,new Bt(i,o,p),!1);const O=pg({z:i,x:o,y:p},C);return new bi([(l+O.x/O.scale)*e,e*(O.y/O.scale),f],[(l+O.x2/O.scale)*e,e*(O.y2/O.scale),w])},r.bW=function(s,e,i){let o=0;for(let p=0;p<2;++p)s[p]>0&&(o+=(s[p]-0)*(s[p]-0)),e[p]<0&&(o+=(0-e[p])*(0-e[p]));return o},r.bX=uo,r.bY=vd,r.bZ=function(s){const e=Ye.mat4.identity(new Float64Array(16));Ye.mat4.multiply(e,s.pixelMatrix,s.globeMatrix);const i=[0,Mo,0],o=[0,No,0];return Ye.vec3.transformMat4(i,i,e),Ye.vec3.transformMat4(o,o,e),[i[0]>0&&i[0]<=s.width&&i[1]>0&&i[1]<=s.height&&!Uo(s,new Cr(s.center.lat,90)),o[0]>0&&o[0]<=s.width&&o[1]>0&&o[1]<=s.height&&!Uo(s,new Cr(s.center.lat,-90))]},r.b_=function(s,e){const{scale:i}=s.tileTransform,o=i*ei/(s.tileSize*Math.pow(2,e.zoom-s.tileID.overscaledZ+s.tileID.canonical.z));return Ye.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},r.ba=function(s,e){const i=ho(e.zoom);if(i===0)return Tn(s);const o=rn(s),p=Hr(o),l=_a(o.getWest())*e.worldSize,f=_a(o.getEast())*e.worldSize,w=ya(o.getNorth())*e.worldSize,C=ya(o.getSouth())*e.worldSize,O=[l,w,0],x=[f,w,0],E=[l,C,0],k=[f,C,0],M=Ye.mat4.invert([],e.globeMatrix);return Ye.vec3.transformMat4(O,O,M),Ye.vec3.transformMat4(x,x,M),Ye.vec3.transformMat4(E,E,M),Ye.vec3.transformMat4(k,k,M),p[0]=qn(p[0],E,i),p[1]=qn(p[1],k,i),p[2]=qn(p[2],x,i),p[3]=qn(p[3],O,i),bi.fromPoints(p)},r.bb=Yn,r.bc=Br,r.bd=qn,r.be=vu,r.bf=Mi,r.bg=Dv,r.bh=k_,r.bi=Nn,r.bj=function(s){const e=[];for(const i in s)e.push(s[i]);return e},r.bk=function(s,e){const i=[];for(const o in s)o in e||i.push(o);return i},r.bl=dl,r.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.bn=jn,r.bo=function(s,e){const{x:i,y:o}=s.point,p=Eo(i,o,s.worldSize/s._pixelsPerMercatorPixel,0,0);return Ye.mat4.multiply(p,p,jr(Tn(e)))},r.bp=tm,r.bq=sl,r.br=I_,r.bs=function(s,e,i,o,p){const l=5*e+2;s.float32[l+0]=i,s.float32[l+1]=o,s.float32[l+2]=p},r.bt=H_,r.bu=Kb,r.bv=ae,r.bw=po,r.bx=Ot,r.by=z1,r.bz=kr,r.c=Hu,r.c$=(s,e,i,o,p,l,f,w)=>{const C=s.transform,O=C.pitch<15?Pb(.07,.7,nr((14-C.zoom)/5,0,1)):.07,x=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Ib(s,e,i,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:C.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:p,u_width_scale:l,u_floor_width_scale:f,u_image:0,u_tile_units_to_pixels:Db(e,C),u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(x?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:O,u_tile_to_meter:t(e.tileID.canonical,0)}},r.c0=I1,r.c1=function(s){const e=I1(s,!0);return Ye.mat2.invert([],[e[0],e[1],e[4],e[5]])},r.c2=pr,r.c3=function(s){const{x:e,y:i}=s.point,{lng:o,lat:p}=s._center;return Eo(e,i,s.worldSize,o,p)},r.c4=$n,r.c5=Xt,r.c6=il,r.c7=function(s){const e=Math.round((s+45+360)%360/90)%4;return xs[e]},r.c8=45,r.c9=Bl,r.cA=class extends pa{constructor(s){super(s),this.current=Ip}set(s,e,i){if(this.fetchUniformLocation(s,e)){for(let o=0;o<9;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.cB=Ca,r.cC=function(s,e,i){const o=ho(i.zoom),p=s.style.map._antialias,l=s.terrain&&s.terrain.exaggeration()>0;return o===0&&!p&&!l},r.cD=function(s){const e=s.pixelsPerMeter,i=e/to(1,s.center.lat),o=Ye.mat4.identity(new Float64Array(16));return Ye.mat4.translate(o,o,[s.point.x,s.point.y,0]),Ye.mat4.scale(o,o,[i,i,e]),Float32Array.from(o)},r.cE=rn,r.cF=function(s){const e=uo-5;s=nr(s,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(rr(s))),3);return Math.round(i*(bh.length-1))},r.cG=function(s,e,i,o){const p=e.getNorth(),l=e.getSouth(),f=e.getWest(),w=e.getEast(),C=1<<s.z,O=w-f,x=p-l,E=O/Cu,k=-x/bh[i],M=[0,E,0,k,0,0,p,f,0];if(s.z>0){const P=180/o;Ye.mat3.multiply(M,M,[P/O+1,0,0,0,P/x+1,0,-.5*P/E,.5*P/k,1])}return M[2]=C,M[5]=s.x,M[8]=s.y,M},r.cH=Tn,r.cI=function(s,e,i){const o=Ye.mat4.identity(new Float64Array(16)),p=(e/(1<<s)-.5)*Math.PI*2;return Ye.mat4.rotateY(o,i.globeMatrix,p),Float32Array.from(o)},r.cJ=class{isDataAvailableAtPoint(s){const e=this._source();if(this.isUsingMockSource()||!e||s.y<0||s.y>1)return!1;const i=e.getSource().maxzoom,o=1<<i,p=Math.floor(s.x),l=Math.floor((s.x-p)*o),f=Math.floor(s.y*o),w=this.findDEMTileFor(new $t(i,p,i,l,f));return!(!w||!w.dem)}getAtPointOrZero(s,e=0){return this.getAtPoint(s,e)||0}getAtPoint(s,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||s.y<0||s.y>1)return e;const p=o.getSource().maxzoom,l=1<<p,f=Math.floor(s.x),w=s.x-f,C=new $t(p,f,p,Math.floor(w*l),Math.floor(s.y*l)),O=this.findDEMTileFor(C);if(!O||!O.dem)return e;const x=O.dem,E=1<<O.tileID.canonical.z,k=(w*E-O.tileID.canonical.x)*x.dim,M=(s.y*E-O.tileID.canonical.y)*x.dim,P=Math.floor(k),R=Math.floor(M);return(i?this.exaggeration():1)*Di(Di(x.get(P,R),x.get(P,R+1),M-R),Di(x.get(P+1,R),x.get(P+1,R+1),M-R),k-P)}getAtTileOffset(s,e,i){const o=1<<s.canonical.z;return this.getAtPointOrZero(new n(s.wrap+(s.canonical.x+e/ei)/o,(s.canonical.y+i/ei)/o))}getAtTileOffsetFunc(s,e,i,o){return p=>{const l=this.getAtTileOffset(s,p.x,p.y),f=o.upVector(s.canonical,p.x,p.y),w=o.upVectorScale(s.canonical,e,i).metersToTile;return Ye.vec3.scale(f,f,l*w),f}}getForTilePoints(s,e,i,o){if(this.isUsingMockSource())return!1;const p=am.create(this,s,o);return!!p&&(e.forEach(l=>{l[2]=this.exaggeration()*p.getElevationAt(l[0],l[1],i)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(s);if(!e||!e.dem)return null;const i=e.dem.tree,o=e.tileID,p=1<<s.canonical.z-o.canonical.z;let l=s.canonical.x/p-o.canonical.x,f=s.canonical.y/p-o.canonical.y,w=0;for(let C=0;C<s.canonical.z-o.canonical.z&&!i.leaves[w];C++){l*=2,f*=2;const O=2*Math.floor(f)+Math.floor(l);w=i.childOffsets[w]+O,l%=1,f%=1}return{min:this.exaggeration()*i.minimums[w],max:this.exaggeration()*i.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const s=this.visibleDemTiles;if(s.length===0)return null;let e=!1,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const p of s){const l=this.getMinMaxForTile(p.tileID);l&&(i=Math.min(i,l.min),o=Math.max(o,l.max),e=!0)}return e?{min:i,max:o}:null}},r.cK=Jf,r.cL=or,r.cM=function(s,e){return[Math.pow(s[0],2.2)*e,Math.pow(s[1],2.2)*e,Math.pow(s[2],2.2)*e]},r.cN=ta,r.cO=Fh,r.cP=zh,r.cQ=256,r.cR=function(s,e){const i=[0,0,0],o=Yn(Tn(e.canonical));return Ye.vec3.transformMat4(i,i,o),Ye.vec3.transformMat4(i,i,s),i},r.cS=s=>({u_camera_to_center_distance:new Pn(s),u_extrude_scale:new kp(s),u_device_pixel_ratio:new Pn(s),u_matrix:new Tc(s),u_inv_rot_matrix:new Tc(s),u_merc_center:new To(s),u_tile_id:new Bo(s),u_zoom_transition:new Pn(s),u_up_dir:new Bo(s),u_emissive_strength:new Pn(s)}),r.cT=s=>({u_matrix:new Tc(s),u_pixels_to_tile_units:new kp(s),u_device_pixel_ratio:new Pn(s),u_width_scale:new Pn(s),u_floor_width_scale:new Pn(s),u_units_to_pixels:new To(s),u_dash_image:new xh(s),u_gradient_image:new xh(s),u_image_height:new Pn(s),u_texsize:new To(s),u_tile_units_to_pixels:new Pn(s),u_alpha_discard_threshold:new Pn(s),u_trim_offset:new To(s),u_trim_fade_range:new To(s),u_trim_color:new Sc(s),u_emissive_strength:new Pn(s),u_zbias_factor:new Pn(s),u_tile_to_meter:new Pn(s)}),r.cU=s=>({u_matrix:new Tc(s),u_texsize:new To(s),u_pixels_to_tile_units:new kp(s),u_device_pixel_ratio:new Pn(s),u_width_scale:new Pn(s),u_floor_width_scale:new Pn(s),u_image:new xh(s),u_units_to_pixels:new To(s),u_tile_units_to_pixels:new Pn(s),u_alpha_discard_threshold:new Pn(s),u_trim_offset:new To(s),u_trim_fade_range:new To(s),u_trim_color:new Sc(s),u_emissive_strength:new Pn(s),u_zbias_factor:new Pn(s),u_tile_to_meter:new Pn(s)}),r.cV=Sp,r.cW=tC,r.cX=iC,r.cY=Ac,r.cZ=(s,e,i,o,p,l)=>{const f=s.transform,w=f.projection.name==="globe";let C;if(l.paint.get("circle-pitch-alignment")==="map")if(w){const x=ta(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;C=Float32Array.from([x,0,0,x])}else C=f.calculatePixelsToTileUnitsMatrix(i);else C=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const O={u_camera_to_center_distance:s.transform.getCameraToCenterDistance(f.projection),u_matrix:s.translatePosMatrix(e.projMatrix,i,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Be.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:Ec,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:l.paint.get("circle-emissive-strength")};if(w){O.u_inv_rot_matrix=o,O.u_merc_center=p,O.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],O.u_zoom_transition=ho(f.zoom);const x=p[0]*ei,E=p[1]*ei;O.u_up_dir=f.projection.upVector(new Bt(0,0,0),x,E)}return O},r.c_=kb,r.ca=Sc,r.cb=function(s,e,i){const o=Math.sqrt(s*s+e*e+i*i),p=o>0?Math.acos(i/o)*mo:0;let l=s!==0||e!==0?Math.atan2(-e,-s)*mo+90:0;return l<0&&(l+=360),[o,l,p]},r.cc=t,r.cd=bi,r.ce=Jr,r.cf=function(s){return[Math.pow(s[0],1/2.2),Math.pow(s[1],1/2.2),Math.pow(s[2],1/2.2)]},r.cg=function(s,e){return s.readFields(YC,{icons:[]},e)},r.ch=function(s){return s({pluginStatus:xo,pluginURL:Ss}),Pl.on("pluginStateChange",s),s},r.ci=ty,r.cj=rm,r.ck=tv,r.cl=Da,r.cm=gp,r.cn=Ke,r.co=sa,r.cp=zn,r.cq=function(s){const e=s.indexOf(yu);return e>=0?s.slice(0,e):s},r.cr=function(s){return s.indexOf(yu)>=0},r.cs=function(s){const e=s.indexOf(yu);return e>=0?s.slice(e+1):""},r.ct=function(s){const e=[],i=s.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),s.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.cu=function(s,e,i,o){return s.type==="custom"?new LC(s,e):new GC[s.type](s,e,i,o)},r.cv=pl,r.cw=class extends fm{constructor(s,e){super(s._vectorTileFeature,s._z,s._x,s._y,s.id),s.state&&(this.state=Object.assign({},s.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=s.source,this.sourceLayer=s.sourceLayer,this.layer=s.layer)}toJSON(){const s=super.toJSON();return s.target=this.target,s.namespace=this.namespace,s}},r.cx=Pl,r.cy=is,r.cz=Ur,r.d=function(s){return ts.API_TILEJSON_REGEX.test(s)},r.d$=zw,r.d0=(s,e,i,o,p,l,f,w,C)=>{const O=s.transform,x=O.calculatePixelsToTileUnitsMatrix(e),E=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",k=O.pitch<15?Pb(.07,.7,nr((14-O.zoom)/5,0,1)):.07;return{u_matrix:Ib(s,e,i,o),u_pixels_to_tile_units:x,u_device_pixel_ratio:l,u_width_scale:f,u_floor_width_scale:w,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:Ob(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Db(e,s.transform),u_alpha_discard_threshold:0,u_trim_offset:C,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(E?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:k,u_tile_to_meter:t(e.tileID.canonical,0)}},r.d1=Nc,r.d2=Bp,r.d3=vb,r.d4=ci,r.d5=Gp,r.d6=Xr,r.d7=450,r.d8=7,r.d9=OC,r.dA=go,r.dB=u,r.dC=ga,r.dD=function([s,e,i]){const o=Math.hypot(s,e,i),p=Math.atan2(s,i),l=.5*Math.PI-Math.acos(-e/o);return new Cr($n(p),$n(l))},r.dE=fv,r.dF=function(s){const e=s.navigator?s.navigator.userAgent:null;return!!function(i){if(fl==null){const o=i.navigator?i.navigator.userAgent:null;fl=!!i.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return fl}(s)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.dG=function(s,e){Je=s,mt=e},r.dH=Uo,r.dI=Vo,r.dJ=function(s){const e=[0,0,0],i=Ye.mat4.identity(new Float64Array(16));return Ye.mat4.multiply(i,s.pixelMatrix,s.globeMatrix),Ye.vec3.transformMat4(e,e,i),new Wt(e[0],e[1])},r.dK=function(s,e,i=!1){if(xo===Jo||xo===cd||xo===oh)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ss=Be.resolveURL(s),xo=Jo,Na=e,ah(),i||Qo()},r.dL=lh,r.dM=function(){ty().acquire(xv)},r.dN=function(){const s=bg;s&&(s.isPreloaded()&&s.numActive()===1?(s.release(xv),bg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dO=Xp,r.dP=function(s){const e=Zt();if(!e)return;const i=e.delete(lt);s&&i.catch(s).then(()=>s())},r.dQ=xg,r.dR=Mw,r.dS=function(s){Iv=Be.resolveURL(s),pm||(pm=new lm(ty(),new aa)),pm.broadcast("setDracoUrl",Iv)},r.dT=Cw,r.dU=function(s){dm=Be.resolveURL(s),pm||(pm=new lm(ty(),new aa)),pm.broadcast("setMeshoptUrl",dm)},r.dV=_i,r.dW=Vl,r.dX=Ic,r.dY=be,r.dZ=class{constructor(s,e){this.pos=s,this.dir=e}intersectsPlane(s,e,i){const o=Ye.vec2.dot(e,this.dir);if(Math.abs(o)<1e-6)return!1;const p=((s[0]-this.pos[0])*e[0]+(s[1]-this.pos[1])*e[1])/o;return i[0]=this.pos[0]+this.dir[0]*p,i[1]=this.pos[1]+this.dir[1]*p,!0}},r.d_=Rw,r.da=Dr,r.db=Qa,r.dc=256,r.dd=jr,r.de=ha,r.df=Ol,r.dg=xc,r.dh=function(s,e,i,o,p){return nr((s-e)/(i-e)*(p-o)+o,o,p)},r.di=ed,r.dj=Nl,r.dk=class{constructor(s,e,i,o){this.context=s,this.format=o,this.size=i,this.texture=s.gl.createTexture();const[p,l,f]=this.size,{gl:w}=s;w.bindTexture(w.TEXTURE_3D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),w.texImage3D(w.TEXTURE_3D,0,this.format,p,l,f,0,uv(this.format),hv(this.format),e.data)}bind(s,e){const{context:i}=this,{gl:o}=i;o.bindTexture(o.TEXTURE_3D,this.texture),s!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,s),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,s),this.minFilter=s),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}},r.dl=mv,r.dm=[1,1,1],r.dn=am,r.dp=om,r.dq=Ja,r.dr=Ll,r.ds=Cc,r.dt=fd,r.du=Ua,r.dv=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Wt(1/0,1/0),max:new Wt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(s,e=!1){const i=Ai(new Wt(0,0),new Wt(ei,ei),s),o=[];if(e&&!di(i,this._globalClipBounds))return o;for(const p of this._activeRegions){if(p.hiddenByOverlap||!di(i,p))continue;const l=ai(p.min,p.max,s);o.push({min:l.min,max:l.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return o}setSources(s){this._setSources(s.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const o of e.cache.getVisibleCoordinates()){const p=e.cache.getTile(o).buckets[e.layer];p&&p.updateFootprints(o.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(s){const e=s.getFootprints();if(e.length===0)return;const i=s.getOrder(),o=s.getClipMask(),p=s.getClipScope();for(const l of e){if(!l.footprint)continue;const f=Ai(l.footprint.min,l.footprint.max,l.id);this._activeRegions.push({min:f.min,max:f.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:l.id,footprint:l.footprint,order:i,clipMask:o,clipScope:p})}this._sourceIds.push(s.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||Pt(e.min,i.min)||Pt(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(o,p){const l=(f,w)=>f+w;return o.length-p.length||o.reduce(l,"").localeCompare(p.reduce(l,""))}(e.clipScope,i.clipScope));let s=this._activeRegions.length!==this._prevRegions.length;if(!s){let e=0;for(;!s&&e!==this._activeRegions.length;){const i=this._activeRegions[e],o=this._prevRegions[e];s=i.priority!==o.priority||!Ft(i,o)||i.order!==o.order||i.clipMask!==o.clipMask||!jn(i.clipScope,o.clipScope),++e}}if(s){++this._updateTime;for(const i of this._activeRegions)i.order!==_t&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const o=this._activeRegions;if(i>=o.length)return i;const p=o[i].priority;for(;i<o.length&&o[i].priority===p;)++i;return i};if(this._sourceIds.length>1){let i=0,o=e(i);for(;i!==o;){let p=i;const l=i;for(;p!==o;){const f=this._activeRegions[p];f.hiddenByOverlap=!1;for(let w=0;w<l;w++){const C=this._activeRegions[w];if(!C.hiddenByOverlap&&f.order===_t&&di(f,C)&&(f.hiddenByOverlap=Zi(f.footprint,f.tileId,C.footprint,C.tileId),f.hiddenByOverlap))break}++p}i=o,o=e(i)}}}}_setSources(s){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=s.length-1;e>=0;e--)this._addSource(s[e]);this._computeReplacement()}},r.dw=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy()}_fillGridMeshWithLods(s,e){const i=new wo,o=new gs,p=[],l=s+1+2,f=e[0]+1,w=e[0]+1+(1+e.length),C=(O,x,E)=>{let k=O===l-1?O-2:O===0?O:O-1;return k+=E?24575:0,[k,x]};for(let O=0;O<l;++O)i.emplaceBack(...C(O,0,!0));for(let O=0;O<f;++O)for(let x=0;x<l;++x)i.emplaceBack(...C(x,O,(x===0||x===l-1)&&!0));for(let O=0;O<e.length;++O){const x=e[O];for(let E=0;E<l;++E)i.emplaceBack(...C(E,x,!0))}for(let O=0;O<e.length;++O){const x=o.length,E=e[O]+1+2,k=new gs;for(let R=0;R<E-1;R++){const $=R===E-2,H=$?l*(w-e.length+O-R):l;for(let J=0;J<l-1;J++){const ee=R*l+J;R===0||$||J===0||J===l-2?(k.emplaceBack(ee+1,ee,ee+H),k.emplaceBack(ee+H,ee+H+1,ee+1)):(o.emplaceBack(ee+1,ee,ee+H),o.emplaceBack(ee+H,ee+H+1,ee+1))}}const M=Sn.simpleSegment(0,x,i.length,o.length-x);for(let R=0;R<k.uint16.length;R+=3)o.emplaceBack(k.uint16[R],k.uint16[R+1],k.uint16[R+2]);const P=Sn.simpleSegment(0,x,i.length,o.length-x);p.push({withoutSkirts:M,withSkirts:P})}return{vertices:i,indices:o,segments:p}}_createGrid(s){const e=this._fillGridMeshWithLods(Cu,bh);this._gridSegments=e.segments,this._gridBuffer=s.createVertexBuffer(e.vertices,Ci.members),this._gridIndexBuffer=s.createIndexBuffer(e.indices,!0)}_createPoles(s){const e=new gs;for(let f=0;f<=Cu;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=s.createIndexBuffer(e,!0);const i=new Ol,o=new Ol,p=new Ol,l=new Ol;this._poleSegments=[];for(let f=0,w=0;f<il;f++){const C=360/(1<<f);i.emplaceBack(0,-Gn,0,.5,0),o.emplaceBack(0,-Gn,0,.5,1),p.emplaceBack(0,-Gn,0,.5,.5),l.emplaceBack(0,-Gn,0,.5,.5);for(let O=0;O<=Cu;O++){let x=O/Cu,E=0;const k=Di(0,C,x),[M,P,R]=Mc(nl,$o,k,Gn);i.emplaceBack(M,P,R,x,E),o.emplaceBack(M,P,R,x,1-E);const $=rr(k);x=.5+.5*Math.sin($),E=.5+.5*Math.cos($),p.emplaceBack(M,P,R,x,E),l.emplaceBack(M,P,R,x,1-E)}this._poleSegments.push(Sn.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(i,Fi,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(o,Fi,!1),this._texturedPoleNorthVertexBuffer=s.createVertexBuffer(p,Fi,!1),this._texturedPoleSouthVertexBuffer=s.createVertexBuffer(l,Fi,!1)}getGridBuffers(s,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}},r.dx=_t,r.dy=xr,r.dz=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.e=ts,r.e0=Mb,r.e1=na,r.e2=yo,r.e3=Qb,r.e4=function(s,e,i,o,p,l,f,w,C,O,x=1,E,k){s.createArrays(),s.tilePixelRatio=ei/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const M=s.layers[0].layout,P=s.layers[0]._unevaluatedLayout._values,R={};R.scaleFactor=x,R.textSizeScaleRange=M.get("text-size-scale-range"),R.iconSizeScaleRange=M.get("icon-size-scale-range");const[$,H]=R.textSizeScaleRange,[J,ee]=R.iconSizeScaleRange;if(R.textScaleFactor=nr(R.scaleFactor,$,H),R.iconScaleFactor=nr(R.scaleFactor,J,ee),s.textSizeData.kind==="composite"){const{minZoom:fe,maxZoom:Pe}=s.textSizeData;R.compositeTextSizes=[P["text-size"].possiblyEvaluate(new Vr(fe),w),P["text-size"].possiblyEvaluate(new Vr(Pe),w)]}if(s.iconSizeData.kind==="composite"){const{minZoom:fe,maxZoom:Pe}=s.iconSizeData;R.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new Vr(fe),w),P["icon-size"].possiblyEvaluate(new Vr(Pe),w)]}R.layoutTextSize=P["text-size"].possiblyEvaluate(new Vr(C+1),w),R.layoutIconSize=P["icon-size"].possiblyEvaluate(new Vr(C+1),w),R.textMaxSize=P["text-size"].possiblyEvaluate(new Vr(18),w);const Z=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",ne=M.get("text-size");let le=!1;for(const fe of s.features)if(fe.icon&&fe.icon.nameSecondary){le=!0;break}for(const fe of s.features){const Pe=M.get("text-font").evaluate(fe,{},w).join(","),Ee=ne.evaluate(fe,{},w)*R.textScaleFactor,Ce=R.layoutTextSize.evaluate(fe,{},w)*R.textScaleFactor,$e=(R.layoutIconSize.evaluate(fe,{},w),{horizontal:{},vertical:void 0}),Ie=fe.text;let Ge,Ze=[0,0];if(Ie){const nt=Ie.toString(),ct=M.get("text-letter-spacing").evaluate(fe,{},w)*po,it=M.get("text-line-height").evaluate(fe,{},w)*po,Et=ad(nt)?ct:0,Nt=M.get("text-anchor").evaluate(fe,{},w),Ct=M.get("text-variable-anchor");if(!Ct){const xi=M.get("text-radial-offset").evaluate(fe,{},w);Ze=xi?s1(Nt,[xi*po,iv]):M.get("text-offset").evaluate(fe,{},w).map(ui=>ui*po)}let si=Z?"center":M.get("text-justify").evaluate(fe,{},w);const ti=M.get("symbol-placement")==="point",Ht=ti?M.get("text-max-width").evaluate(fe,{},w)*po:1/0,Ut=xi=>{s.allowVerticalPlacement&&Ba(nt)&&($e.vertical=Q0(Ie,e,i,p,Pe,Ht,it,Nt,xi,Et,Ze,sl.vertical,!0,Ce,Ee))};if(!Z&&Ct){const xi=si==="auto"?Ct.map(mi=>rv(mi)):[si];let ui=!1;for(let mi=0;mi<xi.length;mi++){const Ni=xi[mi];if(!$e.horizontal[Ni])if(ui)$e.horizontal[Ni]=$e.horizontal[0];else{const Ki=Q0(Ie,e,i,p,Pe,Ht,it,"center",Ni,Et,Ze,sl.horizontal,!1,Ce,Ee);Ki&&($e.horizontal[Ni]=Ki,ui=Ki.positionedLines.length===1)}}Ut("left")}else{if(si==="auto"&&(si=rv(Nt)),ti||M.get("text-writing-mode").indexOf("horizontal")>=0||!Ba(nt)){const xi=Q0(Ie,e,i,p,Pe,Ht,it,Nt,si,Et,Ze,sl.horizontal,!1,Ce,Ee);xi&&($e.horizontal[si]=xi)}Ut(ti?"left":si)}}let qe=!1;if(fe.icon&&fe.icon.namePrimary){const nt=Y0(s.iconSizeData,P["icon-size"],w,s.zoom,fe)*R.iconScaleFactor*E,ct=fe.icon.getPrimary().scaleSelf(nt).serialize(),it=o[ct];it&&(Ge=pC(p[ct],fe.icon.nameSecondary?p[fe.icon.getSecondary().scaleSelf(nt).serialize()]:void 0,M.get("icon-offset").evaluate(fe,{},w),M.get("icon-anchor").evaluate(fe,{},w)),qe=it.sdf,s.sdfIcons===void 0?s.sdfIcons=it.sdf:s.sdfIcons!==it.sdf&&qi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(it.pixelRatio!==s.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}const et=a1($e.horizontal)||$e.vertical;s.iconsInText||(s.iconsInText=!!et&&et.iconsInText),(et||Ge)&&xC(s,fe,$e,Ge,o,R,Ce,0,Ze,qe,f,w,O,k,le)}l&&s.generateCollisionDebugBuffers(C,s.collisionBoxArray,R.textScaleFactor)},r.e5=ay,r.e6=Xs,r.e7=ye,r.e8=Nb,r.e9=W,r.ea=function(s){let e=0;if(new Uint32Array(s,0,1)[0]!==Aw){const i=new Uint32Array(s,0,7),[,,o,p,l,f]=i;e=i.byteLength+p+l+f+l,(o!==s.byteLength||e>=s.byteLength)&&qi("Invalid b3dm header information.")}return kw(s,e)},r.eb=function(s,e){const i=Lw(s);for(const o of i){for(const p of o.meshes)XE(p);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(ZE(o.lights,e)))}return i},r.ec=ey,r.ed=Y1,r.ee=Qs,r.ef=function(s){Jt(),yt!=null&&yt.then(e=>{e.keys().then(i=>{for(let o=0;o<i.length-s;o++)e.delete(i[o])})})},r.f=function(s){return s.indexOf("mapbox:")===0},r.g=function(s,e){return is(Zs(s,{method:"GET"}),e)},r.h=Jl,r.i=function(s){return ts.API_STYLE_REGEX.test(s)&&!Hu(s)},r.j=function(s){return decodeURIComponent(atob(s).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.k=function(s){return btoa(encodeURIComponent(s).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},r.l=Zs,r.m=Ii,r.n=function(s,e){return is(Zs(s,{type:"json"}),e)},r.o=Po,r.p=function(s,e){return is(Zs(s,{method:"POST"}),e)},r.q=Be,r.r=Fs,r.s=function(s){try{const e=self[s];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=we,r.u=function(){return function s(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()},r.v=function(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)},r.w=qi,r.x=function(){return bv||(bv=new Xp),bv},r.y=Wu,r.z=oa}),A(["./shared"],function(r){function W(vt){const se=vt?vt.url.toString():void 0;return se?performance.getEntriesByName(se):[]}function ie(vt){if(typeof vt=="number"||typeof vt=="boolean"||typeof vt=="string"||vt==null)return JSON.stringify(vt);if(Array.isArray(vt)){let me="[";for(const we of vt)me+=`${ie(we)},`;return`${me}]`}let se="{";for(const me of Object.keys(vt).sort())se+=`${me}:${ie(vt[me])},`;return`${se}}`}function oe(vt){let se="";for(const me of r.bm)(vt.type!=="model"||me!=="minzoom"&&me!=="maxzoom")&&(se+=`/${ie(vt[me])}`);return se}class he{constructor(se){this.keyCache={},this._layers={},this._layerConfigs={},se&&this.replace(se)}replace(se,me){this._layerConfigs={},this._layers={},this.update(se,[],me)}update(se,me,we){this._options=we;for(const je of se)this._layerConfigs[je.id]=je,(this._layers[je.id]=r.cu(je,this.scope,null,this._options)).compileFilter(we),this.keyCache[je.id]&&delete this.keyCache[je.id];for(const je of me)delete this.keyCache[je],delete this._layerConfigs[je],delete this._layers[je];this.familiesBySource={};const Be=function(je,Ke){const lt={};for(let mt=0;mt<je.length;mt++){const pt=je[mt];let yt=Ke&&Ke[pt.id];!yt&&(yt=oe(pt),pt.type==="line"&&pt.paint)&&function Zt(Jt){return typeof Jt=="string"&&Jt==="line-progress"||(Array.isArray(Jt)?Jt.some(Zt):!(!Jt||typeof Jt!="object")&&Object.values(Jt).some(Zt))}(pt.paint["line-width"])&&(yt+=`/${ie(pt.paint["line-width"])}`),Ke&&(Ke[pt.id]=yt);let Rt=lt[yt];Rt||(Rt=lt[yt]=[]),Rt.push(pt)}const Je=[];for(const mt in lt)Je.push(lt[mt]);return Je}(r.bj(this._layerConfigs),this.keyCache);for(const je of Be){const Ke=je.map(Rt=>this._layers[Rt.id]),lt=Ke[0];if(lt.visibility==="none")continue;const Je=lt.source||"";let mt=this.familiesBySource[Je];mt||(mt=this.familiesBySource[Je]={});const pt=lt.sourceLayer||"_geojsonTileLayer";let yt=mt[pt];yt||(yt=mt[pt]=[]),yt.push(Ke)}}}const ve=1*r.dX;class Se{constructor(se){const me={},we=[];for(const lt in se){const Je=se[lt],mt=me[lt]={};for(const pt in Je.glyphs){const yt=Je.glyphs[+pt];if(!yt||yt.bitmap.width===0||yt.bitmap.height===0)continue;const Rt=yt.metrics.localGlyph?ve:1,Zt={x:0,y:0,w:yt.bitmap.width+2*Rt,h:yt.bitmap.height+2*Rt};we.push(Zt),mt[pt]=Zt}}const{w:Be,h:je}=r.F(we),Ke=new r.dW({width:Be||1,height:je||1});for(const lt in se){const Je=se[lt];for(const mt in Je.glyphs){const pt=Je.glyphs[+mt];if(!pt||pt.bitmap.width===0||pt.bitmap.height===0)continue;const yt=me[lt][mt],Rt=pt.metrics.localGlyph?ve:1;r.dW.copy(pt.bitmap,Ke,{x:0,y:0},{x:yt.x+Rt,y:yt.y+Rt},pt.bitmap)}}this.image=Ke,this.positions=me}}r.dV(Se,"GlyphAtlas");const xe="3d_elevation_id",Ae="hd_road_elevation";class Re{constructor(){this._valid=!1}reset(se){return this.feature=se,this._valid=!0,this._geometry=se.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(se,me){return this._valid&&se(me(this._geometry)),this}require(se,me,we){return this.get(se,!0,me,we)}optional(se,me,we){return this.get(se,!1,me,we)}success(){return this._valid}get(se,me,we,Be){const je=this.feature.properties.hasOwnProperty(se)?+this.feature.properties[se]:void 0;return this._valid&&je!==void 0?we(Be?Be(je):je):me&&(this._valid=!1),this}}class He{constructor(se,me){this.featureFunc=se,this.vertexFunc=me}parseFeature(se,me,we){return this.featureFunc(se,me,we)}parseVertex(se,me,we){return this.vertexFunc(se,me,we)}}const rt=new He((vt,se,me)=>vt.reset(se).require(xe,we=>{me.id=we}).optional("fixed_height_relative",we=>{me.constantHeight=we},tt.decodeRelativeHeight).geometry(we=>{me.bounds=we},tt.computeBounds).success(),(vt,se,me)=>vt.reset(se).require(xe,we=>{me.id=we}).require("elevation_idx",we=>{me.idx=we}).require("extent",we=>{me.extent=we}).require("height_relative",we=>{me.height=we},tt.decodeRelativeHeight).geometry(we=>{me.position=we},tt.getPoint).success()),ht=new He((vt,se,me)=>vt.reset(se).require(xe,we=>{me.id=we}).optional("fixed_height",we=>{me.constantHeight=we},tt.decodeMetricHeight).geometry(we=>{me.bounds=we},tt.computeBounds).success(),(vt,se,me)=>vt.reset(se).require(xe,we=>{me.id=we}).require("elevation_idx",we=>{me.idx=we}).require("extent",we=>{me.extent=we}).require("height",we=>{me.height=we},tt.decodeMetricHeight).geometry(we=>{me.position=we},tt.getPoint).success());class tt{static computeBounds(se){const me=new r.P(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),we=new r.P(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const Be of se[0])me.x>Be.x&&(me.x=Be.x),me.y>Be.y&&(me.y=Be.y),we.x<Be.x&&(we.x=Be.x),we.y<Be.y&&(we.y=Be.y);return{min:me,max:we}}static getPoint(se){return r.ab.vec2.fromValues(se[0][0].x,se[0][0].y)}static decodeRelativeHeight(se){return 1e-4*se*5}static decodeMetricHeight(se){return 1e-4*se}static parse(se){const me=[],we=[],Be=se.length,je=new Re;for(let lt=0;lt<Be;lt++){const Je=se.feature(lt),mt=Je.properties.hasOwnProperty("version")?String(Je.properties.version):void 0,pt=(Ke=mt)?Ke==="1.0.1"?ht:void 0:rt;if(pt===void 0){r.w(`Unknown elevation feature version number ${mt||"(unknown)"}`);continue}const yt=Je.properties.hasOwnProperty("type")?Je.properties.type:void 0;if(yt){if(r.dY.VectorTileFeature.types[Je.type]==="Point"&&yt==="curve_point"){const Rt={};pt.parseVertex(je,Je,Rt)&&me.push(Rt)}else if(r.dY.VectorTileFeature.types[Je.type]==="Polygon"&&yt==="curve_meta"){const Rt={};pt.parseFeature(je,Je,Rt)&&we.push(Rt)}}}var Ke;return{vertices:me,features:we}}}class at{constructor(se,me,we,Be,je,Ke){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=se,this.heightRange={min:we,max:we},this.safeArea=me,this.constantHeight=we,this.constantHeight==null&&(this.constantHeight!=null||Be.length!==0)){this.vertices=Be,this.edges=je,this.edges=this.edges.filter(lt=>lt.a<this.vertices.length&&lt.b<this.vertices.length&&!r.ab.vec2.exactEquals(this.vertices[lt.a].position,this.vertices[lt.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const lt of this.vertices)this.vertexProps.push({dir:r.ab.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,lt.height),this.heightRange.max=Math.max(this.heightRange.max,lt.height);for(const lt of this.edges){const Je=this.vertices[lt.a].position,mt=this.vertices[lt.b].position,pt=r.ab.vec2.subtract(r.ab.vec2.create(),mt,Je),yt=r.ab.vec2.length(pt),Rt=r.ab.vec2.scale(r.ab.vec2.create(),pt,1/yt);this.edgeProps.push({vec:pt,dir:Rt,len:yt});const Zt=this.vertexProps[lt.a].dir,Jt=this.vertexProps[lt.b].dir;r.ab.vec2.add(Zt,Zt,Rt),r.ab.vec2.add(Jt,Jt,Rt)}for(const lt of this.vertexProps)lt.dir[0]===0&&lt.dir[1]===0||r.ab.vec2.normalize(lt.dir,lt.dir);this.tessellate(Ke)}}pointElevation(se){if(this.constantHeight!=null)return this.constantHeight;const me=this.getClosestEdge(se);if(me==null)return 0;const[we,Be]=me;return(1-(je=Be))*this.vertices[this.edges[we].a].height+je*this.vertices[this.edges[we].b].height;var je}getClosestEdge(se){if(this.edges.length===0)return;let me=0,we=Number.POSITIVE_INFINITY,Be=0;const je=r.ab.vec2.fromValues(se.x,se.y);for(let Ke=0;Ke<this.edges.length;Ke++){const lt=this.edges[Ke],Je=this.edgeProps[Ke].dir,mt=new r.dZ(je,this.edgeProps[Ke].dir),pt=this.vertices[lt.a].position,yt=this.vertices[lt.b].position,Rt=r.ab.vec2.create(),Zt=r.ab.vec2.create(),Jt=mt.intersectsPlane(pt,this.vertexProps[lt.a].dir,Rt),fi=mt.intersectsPlane(yt,this.vertexProps[lt.b].dir,Zt);if(!Jt||!fi)continue;const Ii=r.ab.vec2.subtract(r.ab.vec2.create(),Zt,Rt),ki=r.ab.vec2.subtract(r.ab.vec2.create(),je,Rt),Pi=r.ab.vec2.dot(Ii,Ii),dr=Pi>0?r.ab.vec2.dot(ki,Ii)/Pi:0,br=r.aw(dr,0,1),sr=Math.abs((dr-br)*this.edgeProps[Ke].len),wr=r.ab.vec2.subtract(r.ab.vec2.create(),je,pt),Pr=sr+Math.abs(r.ab.vec2.dot(wr,r.ab.vec2.fromValues(Je[1],-Je[0])));Pr<we&&(me=Ke,we=Pr,Be=br)}return[me,Be]}tessellate(se){for(let me=this.edges.length-1;me>=0;--me){const we=this.edges[me].a,Be=this.edges[me].b,{position:je,height:Ke,extent:lt}=this.vertices[we],{position:Je,height:mt,extent:pt}=this.vertices[Be],yt=this.vertexProps[we].dir,Rt=this.vertexProps[Be].dir,Zt=r.ab.vec3.fromValues(je[0]/se,je[1]/se,Ke),Jt=r.ab.vec3.fromValues(Je[0]/se,Je[1]/se,mt),fi=r.ab.vec3.fromValues(yt[1],-yt[0],0);r.ab.vec3.scale(fi,fi,lt);const Ii=r.ab.vec3.fromValues(Rt[1],-Rt[0],0);if(r.ab.vec3.scale(Ii,Ii,pt),this.distSqLines(r.ab.vec3.fromValues(Zt[0]+.5*fi[0],Zt[1]+.5*fi[1],Zt[2]+.5*fi[2]),r.ab.vec3.fromValues(Jt[0]-.5*Ii[0],Jt[1]-.5*Ii[1],Jt[2]-.5*Ii[2]),r.ab.vec3.fromValues(Zt[0]-.5*fi[0],Zt[1]-.5*fi[1],Zt[2]-.5*fi[2]),r.ab.vec3.fromValues(Jt[0]+.5*Ii[0],Jt[1]+.5*Ii[1],Jt[2]+.5*Ii[2]))<=.05*.05)continue;const ki=this.vertices.length,Pi=r.ab.vec2.add(r.ab.vec2.create(),je,Je);this.vertices.push({position:r.ab.vec2.scale(Pi,Pi,.5),height:.5*(Ke+mt),extent:.5*(lt+pt)});const dr=r.ab.vec2.add(r.ab.vec2.create(),yt,Rt);this.vertexProps.push({dir:r.ab.vec2.normalize(dr,dr)}),this.edges.splice(me,1),this.edgeProps.splice(me,1),this.edges.push({a:we,b:ki}),this.edges.push({a:ki,b:Be});const br=r.ab.vec2.subtract(r.ab.vec2.create(),this.vertices[ki].position,je),sr=r.ab.vec2.length(br),wr={vec:br,dir:r.ab.vec2.scale(r.ab.vec2.create(),br,1/sr),len:sr};this.edgeProps.push(wr),this.edgeProps.push(wr)}}distSqLines(se,me,we,Be){const je=r.ab.vec3.subtract(r.ab.vec3.create(),me,se),Ke=r.ab.vec3.subtract(r.ab.vec3.create(),Be,we),lt=r.ab.vec3.subtract(r.ab.vec3.create(),se,we),Je=r.ab.vec3.dot(je,je),mt=r.ab.vec3.dot(je,Ke),pt=r.ab.vec3.dot(je,lt),yt=r.ab.vec3.dot(Ke,Ke),Rt=r.ab.vec3.dot(Ke,lt),Zt=Je*yt-mt*mt;if(Zt===0){const Pi=r.ab.vec3.dot(lt,Ke)/r.ab.vec3.dot(Ke,Ke),dr=r.ab.vec3.lerp(r.ab.vec3.create(),we,Be,Pi);return r.ab.vec3.squaredDistance(dr,se)}const Jt=(mt*Rt-pt*yt)/Zt,fi=(Je*Rt-mt*pt)/Zt,Ii=r.ab.vec3.lerp(r.ab.vec3.create(),se,me,Jt),ki=r.ab.vec3.lerp(r.ab.vec3.create(),we,Be,fi);return r.ab.vec3.squaredDistance(Ii,ki)}}class Lt{static parseFrom(se,me){const we=tt.parse(se);if(!we)return[];let{vertices:Be,features:je}=we;const Ke=1/r.cc(me);je.sort((pt,yt)=>pt.id-yt.id),Be.sort((pt,yt)=>pt.id-yt.id||pt.idx-yt.idx),Be=Be.filter((pt,yt,Rt)=>yt===Rt.findIndex(Zt=>Zt.id===pt.id&&Zt.idx===pt.idx));const lt=new Array;let Je=0;const mt=Be.length;for(const pt of je){if(pt.constantHeight){lt.push(new at(pt.id,pt.bounds,pt.constantHeight));continue}for(;Je!==mt&&Be[Je].id<pt.id;)Je++;if(Je===mt||Be[Je].id!==pt.id)continue;const yt=new Array,Rt=new Array,Zt=Je;for(;Je!==mt&&Be[Je].id===pt.id;){const Jt=Be[Je];if(yt.push({position:Jt.position,height:Jt.height,extent:Jt.extent}),Je!==Zt&&Be[Je-1].idx===Jt.idx-1){const fi=Je-Zt;Rt.push({a:fi-1,b:fi})}Je++}lt.push(new at(pt.id,pt.bounds,void 0,yt,Rt,Ke))}return lt}}r.dV(at,"ElevationFeature");class Ve{constructor(se){this.tileID=new r.aG(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),this.tileZoom=se.tileZoom,this.uid=se.uid,this.zoom=se.zoom,this.lut=se.lut,this.canonical=se.tileID.canonical,this.pixelRatio=se.pixelRatio,this.tileSize=se.tileSize,this.source=se.source,this.scope=se.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=se.showCollisionBoxes,this.collectResourceTiming=!!se.request&&se.request.collectResourceTiming,this.promoteId=se.promoteId,this.isSymbolTile=se.isSymbolTile,this.tileTransform=r.aQ(se.tileID.canonical,se.projection),this.projection=se.projection,this.worldview=se.worldview,this.localizableLayerIds=se.localizableLayerIds,this.brightness=se.brightness,this.extraShadowCaster=!!se.extraShadowCaster,this.tessellationStep=se.tessellationStep,this.scaleFactor=se.scaleFactor}parse(se,me,we,Be,je){this.status="parsing",this.data=se,this.collisionBoxArray=new r.aW;const Ke=new r.d_(Object.keys(se.layers).sort()),lt=new r.d$(this.tileID,this.promoteId);lt.bucketLayerIDs=[];const Je={},mt=new r.e0(256,256),pt={featureIndex:lt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:mt,availableImages:we,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},yt=me.familiesBySource[this.source];for(const Pi in yt){const dr=se.layers[Pi];if(!dr)continue;let br=!1,sr=!1,wr=!1;for(const is of yt[Pi])is[0].type==="symbol"?br=!0:sr=!0,is[0].is3D()&&is[0].type!=="model"&&(wr=!0);if(this.extraShadowCaster&&!wr||this.isSymbolTile===!0&&!br||this.isSymbolTile===!1&&!sr)continue;dr.version===1&&r.w(`Vector tile source "${this.source}" layer "${Pi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Pr=Ke.encode(Pi),Bn=[];let Da=!1;for(let is=0,Nn=0;is<dr.length;is++){const $s=dr.feature(is),Hc=lt.getId($s,Pi);if(this.localizableLayerIds&&this.localizableLayerIds.has(Pi)){const Wo=$s.properties?$s.properties.worldview:null;if(this.worldview&&typeof Wo=="string")if(Wo==="all")$s.properties.$localized=!0;else{if(!Wo.split(",").includes(this.worldview))continue;$s.properties.$localized=!0,$s.properties.worldview=this.worldview}}!Da&&$s.properties&&$s.properties.hasOwnProperty(xe)&&(Da=!0),Bn.push({feature:$s,id:Hc,index:Nn,sourceLayerIndex:Pr}),Nn++}Da&&se.layers.hasOwnProperty(Ae)&&(pt.elevationFeatures=Lt.parseFrom(se.layers[Ae],this.canonical));for(const is of yt[Pi]){const Nn=is[0];(!this.extraShadowCaster||Nn.is3D()&&Nn.type!=="model")&&(this.isSymbolTile!==void 0&&Nn.type==="symbol"!==this.isSymbolTile||Nn.minzoom&&this.zoom<Math.floor(Nn.minzoom)||Nn.maxzoom&&this.zoom>=Nn.maxzoom||Nn.visibility!=="none"&&(Tt(is,this.zoom,pt.brightness,we),(Je[Nn.id]=Nn.createBucket({index:lt.bucketLayerIDs.length,layers:is,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Pr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Bn,pt,this.tileID.canonical,this.tileTransform),lt.bucketLayerIDs.push(is.map($s=>r.aC($s.id,$s.scope)))))}}let Rt,Zt,Jt,fi;mt.trim();const Ii={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ki=()=>{if(Rt)return this.status="done",je(Rt);if(this.extraShadowCaster)this.status="done",je(null,{buckets:r.bj(Je).filter(Pi=>!Pi.isEmpty()),featureIndex:lt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:pt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Zt&&Jt&&fi){const Pi=new Se(Zt),dr=new r.e3(Jt,fi,this.lut);for(const br in Je){const sr=Je[br];sr instanceof r.aX?(Tt(sr.layers,this.zoom,pt.brightness,we),r.e4(sr,Zt,Pi.positions,Jt,dr.iconPositions,this.showCollisionBoxes,we,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.pixelRatio,this.brightness)):sr.hasPattern&&(sr instanceof r.b1||sr instanceof r.b2||sr instanceof r.d5)&&(Tt(sr.layers,this.zoom,pt.brightness,we),sr.addFeatures(pt,this.tileID.canonical,dr.patternPositions,we,this.tileTransform,this.brightness))}this.status="done",je(null,{buckets:r.bj(Je).filter(br=>!br.isEmpty()),featureIndex:lt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Pi.image,lineAtlas:mt,imageAtlas:dr,brightness:pt.brightness})}};if(!this.extraShadowCaster){const Pi=r.e1(pt.glyphDependencies,sr=>Object.keys(sr).map(Number));Object.keys(Pi).length?Be.send("getGlyphs",{uid:this.uid,stacks:Pi,scope:this.scope},(sr,wr)=>{Rt||(Rt=sr,Zt=wr,ki())},void 0,!1,Ii):Zt={};const dr=Object.keys(pt.iconDependencies);dr.length?Be.send("getImages",{icons:dr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(sr,wr)=>{if(Rt)return;Rt=sr;const Pr={};Object.values(wr).some(Bn=>Bn.usvg)?this.rasterize(Be,Pr,wr,pt.iconDependencies,()=>{Jt=Pr,ki()}):(this.fillImageMap(Pr,pt.iconDependencies,wr),Jt=Pr,ki())},void 0,!1,Ii):Jt={};const br=Object.keys(pt.patternDependencies);br.length?Be.send("getImages",{icons:br,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(sr,wr)=>{if(!Rt){Rt=sr;const Pr={};Object.values(wr).some(Bn=>Bn.usvg)?this.rasterize(Be,Pr,wr,pt.patternDependencies,()=>{fi=Pr,ki()}):(this.fillImageMap(Pr,pt.patternDependencies,wr),fi=Pr,ki())}},void 0,!1,Ii):fi={}}ki()}fillImageMap(se,me,we){for(const Be in we){const je=me[Be]||[];for(const Ke of je)we[Ke.id].usvg||(se[Ke.serialize()]=we[Ke.id])}}getImageTaskQueue(se,me,we){const Be={};for(const je in me){const Ke=we[je]||[];for(const lt of Ke){const Je=lt.serialize();me[lt.id].usvg?Be[Je]||(Be[Je]=lt):se[Je]=me[lt.id]}}return Be}rasterize(se,me,we,Be,je){const Ke=this.getImageTaskQueue(me,we,Be);this.rasterizeTask=se.send("rasterizeImages",{scope:this.scope,imageTasks:Ke},(lt,Je)=>{if(!lt)for(const mt in Je){const{id:pt}=r.e2.deserializeFromString(mt);me[mt]=Object.assign({},we[pt],{data:Je[mt]})}je()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Tt(vt,se,me,we){const Be=new r.a8(se,{brightness:me});for(const je of vt)je.recalculate(Be,we)}class qt extends r.E{constructor(se,me,we,Be,je,Ke){super(),this.actor=se,this.layerIndex=me,this.availableImages=we,this.loadVectorData=je||r.aD,this.loading={},this.loaded={},this.deduped=new r.aB(se.scheduler),this.isSpriteLoaded=Be,this.scheduler=se.scheduler,this.brightness=Ke}loadTile(se,me){const we=se.uid,Be=se&&se.request,je=Be&&Be.collectResourceTiming,Ke=this.loading[we]=new Ve(se);Ke.abort=this.loadVectorData(se,(lt,Je)=>{const mt=!this.loading[we];if(delete this.loading[we],Ke.cancelRasterize(),mt||lt||!Je)return Ke.status="done",mt||(this.loaded[we]=Ke),me(lt);const pt=Je.rawData,yt={};Je.expires&&(yt.expires=Je.expires),Je.cacheControl&&(yt.cacheControl=Je.cacheControl),Ke.vectorTile=Je.vectorTile||new r.dY.VectorTile(new r.bh(pt));const Rt=()=>{Ke.parse(Ke.vectorTile,this.layerIndex,this.availableImages,this.actor,(Zt,Jt)=>{if(Zt||!Jt)return me(Zt);const fi={};if(je){const Ii=W(Be);Ii.length>0&&(fi.resourceTiming=JSON.parse(JSON.stringify(Ii)))}me(null,r.l({rawTileData:pt.slice(0)},Jt,yt,fi))})};this.isSpriteLoaded?Rt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Rt,{type:"parseTile",isSymbolTile:se.isSymbolTile,zoom:se.tileZoom}):Rt()}),this.loaded=this.loaded||{},this.loaded[we]=Ke})}reloadTile(se,me){const we=this.loaded,Be=se.uid;if(we&&we[Be]){const je=we[Be];je.scaleFactor=se.scaleFactor,je.showCollisionBoxes=se.showCollisionBoxes,je.projection=se.projection,je.brightness=se.brightness,je.tileTransform=r.aQ(se.tileID.canonical,se.projection),je.extraShadowCaster=se.extraShadowCaster,je.lut=se.lut;const Ke=(lt,Je)=>{const mt=je.reloadCallback;mt&&(delete je.reloadCallback,je.parse(je.vectorTile,this.layerIndex,this.availableImages,this.actor,mt)),me(lt,Je)};je.status==="parsing"?je.reloadCallback=Ke:je.status==="done"&&(je.vectorTile?je.parse(je.vectorTile,this.layerIndex,this.availableImages,this.actor,Ke):Ke())}else me(null,void 0)}abortTile(se,me){const we=se.uid,Be=this.loading[we];Be&&(Be.abort&&Be.abort(),delete this.loading[we]),me()}removeTile(se,me){const we=this.loaded,Be=se.uid;we&&we[Be]&&delete we[Be],me()}}class Me{loadTile(se,me){const{uid:we,encoding:Be,rawImageData:je,padding:Ke}=se,lt=ImageBitmap&&je instanceof ImageBitmap?this.getImageData(je,Ke):je;me(null,new r.e5(we,lt,Be,Ke<1))}getImageData(se,me){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(se.width,se.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=se.width,this.offscreenCanvas.height=se.height,this.offscreenCanvasContext.drawImage(se,0,0,se.width,se.height);const we=this.offscreenCanvasContext.getImageData(-me,-me,se.width+2*me,se.height+2*me);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),we}}r.bg.setPbf(r.bh);class gt{decodeRasterArray({task:se,buffer:me},we){r.bg.performDecoding(me,se).then(Be=>{we(null,Be)},Be=>{we(Be)})}}const oi=r.dY.VectorTileFeature.prototype.toGeoJSON;class Ti{constructor(se){this._feature=se,this.extent=r.ag,this.type=se.type,this.properties=se.tags,"id"in se&&!isNaN(se.id)&&(this.id=parseInt(se.id,10))}loadGeometry(){if(this._feature.type===1){const se=[];for(const me of this._feature.geometry)se.push([new r.P(me[0],me[1])]);return se}{const se=[];for(const me of this._feature.geometry){const we=[];for(const Be of me)we.push(new r.P(Be[0],Be[1]));se.push(we)}return se}}toGeoJSON(se,me,we){return oi.call(this,se,me,we)}}class ni{constructor(se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.ag,this.length=se.length,this._features=se}feature(se){return new Ti(this._features[se])}}const Mt=64/4096,zt=128;class ii{constructor(){this.features=new Map}clear(){this.features.clear()}load(se=[],me){for(const we of se){const Be=we.id;if(Be==null)continue;let je=this.features.get(Be);je&&this.updateCache(je,me),we.geometry?(je=jt(we),this.updateCache(je,me),this.features.set(Be,je)):this.features.delete(Be),this.updateCache(je,me)}}updateCache(se,me){for(const{canonical:we,uid:Be}of Object.values(me)){const{z:je,x:Ke,y:lt}=we;Yt(se,Math.pow(2,je),Ke,lt)&&delete me[Be]}}getTile(se,me,we){const Be=Math.pow(2,se),je=[];for(const Ke of this.features.values())Yt(Ke,Be,me,we)&&je.push(vi(Ke,Be,me,we));return{features:je}}getFeatures(){return[...this.features.values()]}}function Yt({minX:vt,minY:se,maxX:me,maxY:we},Be,je,Ke){return vt<(je+1+Mt)/Be&&se<(Ke+1+Mt)/Be&&me>(je-Mt)/Be&&we>(Ke-Mt)/Be}function jt(vt){const{id:se,geometry:me,properties:we}=vt;if(!me)return;if(me.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Be,coordinates:je}=me,Ke={id:se,type:1,geometry:[],tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},lt=Ke.geometry;if(Be==="Point")Ri(je,lt,Ke);else if(Be==="MultiPoint")for(const Je of je)Ri(Je,lt,Ke);else if(Be==="LineString")Ke.type=2,Yi(je,lt,Ke);else if(Be==="MultiLineString")Ke.type=2,Wi(je,lt,Ke);else if(Be==="Polygon")Ke.type=3,Wi(je,lt,Ke,!0);else{if(Be!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ke.type=3;for(const Je of je)Wi(Je,lt,Ke,!0)}return Ke}function Ri([vt,se],me,we){const Be=r.at(vt);let je=r.aA(se);je=je<0?0:je>1?1:je,me.push(Be,je),we.minX=Math.min(we.minX,Be),we.minY=Math.min(we.minY,je),we.maxX=Math.max(we.maxX,Be),we.maxY=Math.max(we.maxY,je)}function Yi(vt,se,me,we=!1,Be=!1){const je=[];for(const Ke of vt)Ri(Ke,je,me);se.push(je),we&&function(Ke,lt){let Je=0;for(let mt=0,pt=Ke.length,yt=pt-2;mt<pt;yt=mt,mt+=2)Je+=(Ke[mt]-Ke[yt])*(Ke[mt+1]+Ke[yt+1]);if(Je>0===lt)for(let mt=0,pt=Ke.length;mt<pt/2;mt+=2){const yt=Ke[mt],Rt=Ke[mt+1];Ke[mt]=Ke[pt-2-mt],Ke[mt+1]=Ke[pt-1-mt],Ke[pt-2-mt]=yt,Ke[pt-1-mt]=Rt}}(je,Be)}function Wi(vt,se,me,we=!1){for(let Be=0;Be<vt.length;Be++)Yi(vt[Be],se,me,we,Be===0)}function vi(vt,se,me,we){const{id:Be,type:je,geometry:Ke,tags:lt}=vt,Je=[];if(je===1)(function(mt,pt,yt,Rt,Zt){for(let Jt=0;Jt<mt.length;Jt+=2){const fi=Math.round(r.ag*(mt[Jt+0]*pt-yt)),Ii=Math.round(r.ag*(mt[Jt+1]*pt-Rt));Zt.push([fi,Ii])}})(Ke,se,me,we,Je);else for(const mt of Ke)Wr(mt,se,me,we,Je);return{id:Be,type:je,geometry:Je,tags:lt}}function Wr(vt,se,me,we,Be){const Ke=r.ag+zt;let lt;for(let Je=0;Je<vt.length-2;Je+=2){let mt=Math.round(r.ag*(vt[Je+0]*se-me)),pt=Math.round(r.ag*(vt[Je+1]*se-we)),yt=Math.round(r.ag*(vt[Je+2]*se-me)),Rt=Math.round(r.ag*(vt[Je+3]*se-we));const Zt=yt-mt,Jt=Rt-pt;mt<-128&&yt<-128||(mt<-128?(pt+=Math.round(Jt*((-128-mt)/Zt)),mt=-128):yt<-128&&(Rt=pt+Math.round(Jt*((-128-mt)/Zt)),yt=-128),pt<-128&&Rt<-128||(pt<-128?(mt+=Math.round(Zt*((-128-pt)/Jt)),pt=-128):Rt<-128&&(yt=mt+Math.round(Zt*((-128-pt)/Jt)),Rt=-128),mt>=Ke&&yt>=Ke||(mt>=Ke?(pt+=Math.round(Jt*((Ke-mt)/Zt)),mt=Ke):yt>=Ke&&(Rt=pt+Math.round(Jt*((Ke-mt)/Zt)),yt=Ke),pt>=Ke&&Rt>=Ke||(pt>=Ke?(mt+=Math.round(Zt*((Ke-pt)/Jt)),pt=Ke):Rt>=Ke&&(yt=mt+Math.round(Zt*((Ke-pt)/Jt)),Rt=Ke),lt&&mt===lt[lt.length-1][0]&&pt===lt[lt.length-1][1]||(lt=[[mt,pt]],Be.push(lt)),lt.push([yt,Rt])))))}}var an,_n,En,qr={exports:{}},es=function(){if(En)return qr.exports;En=1;var vt=r.e8(),se=function(){if(_n)return an;_n=1;var pt=r.e6(),yt=r.e7().VectorTileFeature;function Rt(Jt,fi){this.options=fi||{},this.features=Jt,this.length=Jt.length}function Zt(Jt,fi){this.id=typeof Jt.id=="number"?Jt.id:void 0,this.type=Jt.type,this.rawGeometry=Jt.type===1?[Jt.geometry]:Jt.geometry,this.properties=Jt.tags,this.extent=fi||4096}return an=Rt,Rt.prototype.feature=function(Jt){return new Zt(this.features[Jt],this.options.extent)},Zt.prototype.loadGeometry=function(){var Jt=this.rawGeometry;this.geometry=[];for(var fi=0;fi<Jt.length;fi++){for(var Ii=Jt[fi],ki=[],Pi=0;Pi<Ii.length;Pi++)ki.push(new pt(Ii[Pi][0],Ii[Pi][1]));this.geometry.push(ki)}return this.geometry},Zt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Jt=this.geometry,fi=1/0,Ii=-1/0,ki=1/0,Pi=-1/0,dr=0;dr<Jt.length;dr++)for(var br=Jt[dr],sr=0;sr<br.length;sr++){var wr=br[sr];fi=Math.min(fi,wr.x),Ii=Math.max(Ii,wr.x),ki=Math.min(ki,wr.y),Pi=Math.max(Pi,wr.y)}return[fi,ki,Ii,Pi]},Zt.prototype.toGeoJSON=yt.prototype.toGeoJSON,an}();function me(pt){var yt=new vt;return function(Rt,Zt){for(var Jt in Rt.layers)Zt.writeMessage(3,we,Rt.layers[Jt])}(pt,yt),yt.finish()}function we(pt,yt){var Rt;yt.writeVarintField(15,pt.version||1),yt.writeStringField(1,pt.name||""),yt.writeVarintField(5,pt.extent||4096);var Zt={keys:[],values:[],keycache:{},valuecache:{}};for(Rt=0;Rt<pt.length;Rt++)Zt.feature=pt.feature(Rt),yt.writeMessage(2,Be,Zt);var Jt=Zt.keys;for(Rt=0;Rt<Jt.length;Rt++)yt.writeStringField(3,Jt[Rt]);var fi=Zt.values;for(Rt=0;Rt<fi.length;Rt++)yt.writeMessage(4,mt,fi[Rt])}function Be(pt,yt){var Rt=pt.feature;Rt.id!==void 0&&yt.writeVarintField(1,Rt.id),yt.writeMessage(2,je,pt),yt.writeVarintField(3,Rt.type),yt.writeMessage(4,Je,Rt)}function je(pt,yt){var Rt=pt.feature,Zt=pt.keys,Jt=pt.values,fi=pt.keycache,Ii=pt.valuecache;for(var ki in Rt.properties){var Pi=Rt.properties[ki],dr=fi[ki];if(Pi!==null){dr===void 0&&(Zt.push(ki),fi[ki]=dr=Zt.length-1),yt.writeVarint(dr);var br=typeof Pi;br!=="string"&&br!=="boolean"&&br!=="number"&&(Pi=JSON.stringify(Pi));var sr=br+":"+Pi,wr=Ii[sr];wr===void 0&&(Jt.push(Pi),Ii[sr]=wr=Jt.length-1),yt.writeVarint(wr)}}}function Ke(pt,yt){return(yt<<3)+(7&pt)}function lt(pt){return pt<<1^pt>>31}function Je(pt,yt){for(var Rt=pt.loadGeometry(),Zt=pt.type,Jt=0,fi=0,Ii=Rt.length,ki=0;ki<Ii;ki++){var Pi=Rt[ki],dr=1;Zt===1&&(dr=Pi.length),yt.writeVarint(Ke(1,dr));for(var br=Zt===3?Pi.length-1:Pi.length,sr=0;sr<br;sr++){sr===1&&Zt!==1&&yt.writeVarint(Ke(2,br-1));var wr=Pi[sr].x-Jt,Pr=Pi[sr].y-fi;yt.writeVarint(lt(wr)),yt.writeVarint(lt(Pr)),Jt+=wr,fi+=Pr}Zt===3&&yt.writeVarint(Ke(7,1))}}function mt(pt,yt){var Rt=typeof pt;Rt==="string"?yt.writeStringField(1,pt):Rt==="boolean"?yt.writeBooleanField(7,pt):Rt==="number"&&(pt%1!=0?yt.writeDoubleField(3,pt):pt<0?yt.writeSVarintField(6,pt):yt.writeVarintField(5,pt))}return qr.exports=me,qr.exports.fromVectorTileJs=me,qr.exports.fromGeojsonVt=function(pt,yt){yt=yt||{};var Rt={};for(var Zt in pt)Rt[Zt]=new se(pt[Zt].features,yt),Rt[Zt].name=Zt,Rt[Zt].version=yt.version,Rt[Zt].extent=yt.extent;return me({layers:Rt})},qr.exports.GeoJSONWrapper=se,qr.exports}(),Ye=r.e9(es);const ds={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:vt=>vt},Bi=Math.fround||(Xs=new Float32Array(1),vt=>(Xs[0]=+vt,Xs[0]));var Xs;const Wt=3,jn=5,As=6;class mo{constructor(se){this.options=Object.assign(Object.create(ds),se),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(se){const{log:me,minZoom:we,maxZoom:Be}=this.options;me&&console.time("total time");const je=`prepare ${se.length} points`;me&&console.time(je),this.points=se;const Ke=[];for(let Je=0;Je<se.length;Je++){const mt=se[Je];if(!mt.geometry)continue;const[pt,yt]=mt.geometry.coordinates,Rt=Bi(xs(pt)),Zt=Bi(Ca(yt));Ke.push(Rt,Zt,1/0,Je,-1,1),this.options.reduce&&Ke.push(0)}let lt=this.trees[Be+1]=this._createTree(Ke);me&&console.timeEnd(je);for(let Je=Be;Je>=we;Je--){const mt=+Date.now();lt=this.trees[Je]=this._createTree(this._cluster(lt,Je)),me&&console.log("z%d: %d clusters in %dms",Je,lt.numItems,+Date.now()-mt)}return me&&console.timeEnd("total time"),this}getClusters(se,me){let we=((se[0]+180)%360+360)%360-180;const Be=Math.max(-90,Math.min(90,se[1]));let je=se[2]===180?180:((se[2]+180)%360+360)%360-180;const Ke=Math.max(-90,Math.min(90,se[3]));if(se[2]-se[0]>=360)we=-180,je=180;else if(we>je){const yt=this.getClusters([we,Be,180,Ke],me),Rt=this.getClusters([-180,Be,je,Ke],me);return yt.concat(Rt)}const lt=this.trees[this._limitZoom(me)],Je=lt.range(xs(we),Ca(Ke),xs(je),Ca(Be)),mt=lt.data,pt=[];for(const yt of Je){const Rt=this.stride*yt;pt.push(mt[Rt+jn]>1?rr(mt,Rt,this.clusterProps):this.points[mt[Rt+Wt]])}return pt}getChildren(se){const me=this._getOriginId(se),we=this._getOriginZoom(se),Be="No cluster with the specified id.",je=this.trees[we];if(!je)throw new Error(Be);const Ke=je.data;if(me*this.stride>=Ke.length)throw new Error(Be);const lt=this.options.radius/(this.options.extent*Math.pow(2,we-1)),Je=je.within(Ke[me*this.stride],Ke[me*this.stride+1],lt),mt=[];for(const pt of Je){const yt=pt*this.stride;Ke[yt+4]===se&&mt.push(Ke[yt+jn]>1?rr(Ke,yt,this.clusterProps):this.points[Ke[yt+Wt]])}if(mt.length===0)throw new Error(Be);return mt}getLeaves(se,me,we){const Be=[];return this._appendLeaves(Be,se,me=me||10,we=we||0,0),Be}getTile(se,me,we){const Be=this.trees[this._limitZoom(se)],je=Math.pow(2,se),{extent:Ke,radius:lt}=this.options,Je=lt/Ke,mt=(we-Je)/je,pt=(we+1+Je)/je,yt={features:[]};return this._addTileFeatures(Be.range((me-Je)/je,mt,(me+1+Je)/je,pt),Be.data,me,we,je,yt),me===0&&this._addTileFeatures(Be.range(1-Je/je,mt,1,pt),Be.data,je,we,je,yt),me===je-1&&this._addTileFeatures(Be.range(0,mt,Je/je,pt),Be.data,-1,we,je,yt),yt.features.length?yt:null}getClusterExpansionZoom(se){let me=this._getOriginZoom(se)-1;for(;me<=this.options.maxZoom;){const we=this.getChildren(se);if(me++,we.length!==1)break;se=we[0].properties.cluster_id}return me}_appendLeaves(se,me,we,Be,je){const Ke=this.getChildren(me);for(const lt of Ke){const Je=lt.properties;if(Je&&Je.cluster?je+Je.point_count<=Be?je+=Je.point_count:je=this._appendLeaves(se,Je.cluster_id,we,Be,je):je<Be?je++:se.push(lt),se.length===we)break}return je}_createTree(se){const me=new r.bE(se.length/this.stride|0,this.options.nodeSize,Float32Array);for(let we=0;we<se.length;we+=this.stride)me.add(se[we],se[we+1]);return me.finish(),me.data=se,me}_addTileFeatures(se,me,we,Be,je,Ke){for(const lt of se){const Je=lt*this.stride,mt=me[Je+jn]>1;let pt,yt,Rt;if(mt)pt=$n(me,Je,this.clusterProps),yt=me[Je],Rt=me[Je+1];else{const fi=this.points[me[Je+Wt]];pt=fi.properties;const[Ii,ki]=fi.geometry.coordinates;yt=xs(Ii),Rt=Ca(ki)}const Zt={type:1,geometry:[[Math.round(this.options.extent*(yt*je-we)),Math.round(this.options.extent*(Rt*je-Be))]],tags:pt};let Jt;Jt=mt||this.options.generateId?me[Je+Wt]:this.points[me[Je+Wt]].id,Jt!==void 0&&(Zt.id=Jt),Ke.features.push(Zt)}}_limitZoom(se){return Math.max(this.options.minZoom,Math.min(Math.floor(+se),this.options.maxZoom+1))}_cluster(se,me){const{radius:we,extent:Be,reduce:je,minPoints:Ke}=this.options,lt=we/(Be*Math.pow(2,me)),Je=se.data,mt=[],pt=this.stride;for(let yt=0;yt<Je.length;yt+=pt){if(Je[yt+2]<=me)continue;Je[yt+2]=me;const Rt=Je[yt],Zt=Je[yt+1],Jt=se.within(Je[yt],Je[yt+1],lt),fi=Je[yt+jn];let Ii=fi;for(const ki of Jt){const Pi=ki*pt;Je[Pi+2]>me&&(Ii+=Je[Pi+jn])}if(Ii>fi&&Ii>=Ke){let ki,Pi=Rt*fi,dr=Zt*fi,br=-1;const sr=(yt/pt<<5)+(me+1)+this.points.length;for(const wr of Jt){const Pr=wr*pt;if(Je[Pr+2]<=me)continue;Je[Pr+2]=me;const Bn=Je[Pr+jn];Pi+=Je[Pr]*Bn,dr+=Je[Pr+1]*Bn,Je[Pr+4]=sr,je&&(ki||(ki=this._map(Je,yt,!0),br=this.clusterProps.length,this.clusterProps.push(ki)),je(ki,this._map(Je,Pr)))}Je[yt+4]=sr,mt.push(Pi/Ii,dr/Ii,1/0,sr,-1,Ii),je&&mt.push(br)}else{for(let ki=0;ki<pt;ki++)mt.push(Je[yt+ki]);if(Ii>1)for(const ki of Jt){const Pi=ki*pt;if(!(Je[Pi+2]<=me)){Je[Pi+2]=me;for(let dr=0;dr<pt;dr++)mt.push(Je[Pi+dr])}}}}return mt}_getOriginId(se){return se-this.points.length>>5}_getOriginZoom(se){return(se-this.points.length)%32}_map(se,me,we){if(se[me+jn]>1){const Ke=this.clusterProps[se[me+As]];return we?Object.assign({},Ke):Ke}const Be=this.points[se[me+Wt]].properties,je=this.options.map(Be);return we&&je===Be?Object.assign({},je):je}}function rr(vt,se,me){return{type:"Feature",id:vt[se+Wt],properties:$n(vt,se,me),geometry:{type:"Point",coordinates:[(we=vt[se],360*(we-.5)),xr(vt[se+1])]}};var we}function $n(vt,se,me){const we=vt[se+jn],Be=we>=1e4?`${Math.round(we/1e3)}k`:we>=1e3?Math.round(we/100)/10+"k":we,je=vt[se+As],Ke=je===-1?{}:Object.assign({},me[je]);return Object.assign(Ke,{cluster:!0,cluster_id:vt[se+Wt],point_count:we,point_count_abbreviated:Be})}function xs(vt){return vt/360+.5}function Ca(vt){const se=Math.sin(vt*Math.PI/180),me=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return me<0?0:me>1?1:me}function xr(vt){const se=(180-360*vt)*Math.PI/180;return 360*Math.atan(Math.exp(se))/Math.PI-90}function go(vt,se,me,we){let Be=we;const je=se+(me-se>>1);let Ke,lt=me-se;const Je=vt[se],mt=vt[se+1],pt=vt[me],yt=vt[me+1];for(let Rt=se+3;Rt<me;Rt+=3){const Zt=nr(vt[Rt],vt[Rt+1],Je,mt,pt,yt);if(Zt>Be)Ke=Rt,Be=Zt;else if(Zt===Be){const Jt=Math.abs(Rt-je);Jt<lt&&(Ke=Rt,lt=Jt)}}Be>we&&(Ke-se>3&&go(vt,se,Ke,we),vt[Ke+2]=Be,me-Ke>3&&go(vt,Ke,me,we))}function nr(vt,se,me,we,Be,je){let Ke=Be-me,lt=je-we;if(Ke!==0||lt!==0){const Je=((vt-me)*Ke+(se-we)*lt)/(Ke*Ke+lt*lt);Je>1?(me=Be,we=je):Je>0&&(me+=Ke*Je,we+=lt*Je)}return Ke=vt-me,lt=se-we,Ke*Ke+lt*lt}function Kr(vt,se,me,we){const Be={id:vt??null,type:se,geometry:me,tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(se==="Point"||se==="MultiPoint"||se==="LineString")ra(Be,me);else if(se==="Polygon")ra(Be,me[0]);else if(se==="MultiLineString")for(const je of me)ra(Be,je);else if(se==="MultiPolygon")for(const je of me)ra(Be,je[0]);return Be}function ra(vt,se){for(let me=0;me<se.length;me+=3)vt.minX=Math.min(vt.minX,se[me]),vt.minY=Math.min(vt.minY,se[me+1]),vt.maxX=Math.max(vt.maxX,se[me]),vt.maxY=Math.max(vt.maxY,se[me+1])}function dl(vt,se,me,we){if(!se.geometry)return;const Be=se.geometry.coordinates;if(Be&&Be.length===0)return;const je=se.geometry.type,Ke=Math.pow(me.tolerance/((1<<me.maxZoom)*me.extent),2);let lt=[],Je=se.id;if(me.promoteId?Je=se.properties[me.promoteId]:me.generateId&&(Je=we||0),je==="Point")Zs(Be,lt);else if(je==="MultiPoint")for(const mt of Be)Zs(mt,lt);else if(je==="LineString")Ea(Be,lt,Ke,!1);else if(je==="MultiLineString"){if(me.lineMetrics){for(const mt of Be)lt=[],Ea(mt,lt,Ke,!1),vt.push(Kr(Je,"LineString",lt,se.properties));return}$a(Be,lt,Ke,!1)}else if(je==="Polygon")$a(Be,lt,Ke,!0);else{if(je!=="MultiPolygon"){if(je==="GeometryCollection"){for(const mt of se.geometry.geometries)dl(vt,{id:Je,geometry:mt,properties:se.properties},me,we);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const mt of Be){const pt=[];$a(mt,pt,Ke,!0),lt.push(pt)}}vt.push(Kr(Je,je,lt,se.properties))}function Zs(vt,se){se.push(Nc(vt[0]),Vc(vt[1]),0)}function Ea(vt,se,me,we){let Be,je,Ke=0;for(let Je=0;Je<vt.length;Je++){const mt=Nc(vt[Je][0]),pt=Vc(vt[Je][1]);se.push(mt,pt,0),Je>0&&(Ke+=we?(Be*pt-mt*je)/2:Math.sqrt(Math.pow(mt-Be,2)+Math.pow(pt-je,2))),Be=mt,je=pt}const lt=se.length-3;se[2]=1,go(se,0,lt,me),se[lt+2]=1,se.size=Math.abs(Ke),se.start=0,se.end=se.size}function $a(vt,se,me,we){for(let Be=0;Be<vt.length;Be++){const je=[];Ea(vt[Be],je,me,we),se.push(je)}}function Nc(vt){return vt/360+.5}function Vc(vt){const se=Math.sin(vt*Math.PI/180),me=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return me<0?0:me>1?1:me}function ro(vt,se,me,we,Be,je,Ke,lt){if(we/=se,je>=(me/=se)&&Ke<we)return vt;if(Ke<me||je>=we)return null;const Je=[];for(const mt of vt){const pt=mt.geometry;let yt=mt.type;const Rt=Be===0?mt.minX:mt.minY,Zt=Be===0?mt.maxX:mt.maxY;if(Rt>=me&&Zt<we){Je.push(mt);continue}if(Zt<me||Rt>=we)continue;let Jt=[];if(yt==="Point"||yt==="MultiPoint")na(pt,Jt,me,we,Be);else if(yt==="LineString")pl(pt,Jt,me,we,Be,!1,lt.lineMetrics);else if(yt==="MultiLineString")Aa(pt,Jt,me,we,Be,!1);else if(yt==="Polygon")Aa(pt,Jt,me,we,Be,!0);else if(yt==="MultiPolygon")for(const fi of pt){const Ii=[];Aa(fi,Ii,me,we,Be,!0),Ii.length&&Jt.push(Ii)}if(Jt.length){if(lt.lineMetrics&&yt==="LineString"){for(const fi of Jt)Je.push(Kr(mt.id,yt,fi,mt.tags));continue}yt!=="LineString"&&yt!=="MultiLineString"||(Jt.length===1?(yt="LineString",Jt=Jt[0]):yt="MultiLineString"),yt!=="Point"&&yt!=="MultiPoint"||(yt=Jt.length===3?"Point":"MultiPoint"),Je.push(Kr(mt.id,yt,Jt,mt.tags))}}return Je.length?Je:null}function na(vt,se,me,we,Be){for(let je=0;je<vt.length;je+=3){const Ke=vt[je+Be];Ke>=me&&Ke<=we&&qi(se,vt[je],vt[je+1],vt[je+2])}}function pl(vt,se,me,we,Be,je,Ke){let lt=zn(vt);const Je=Be===0?Fn:$u;let mt,pt,yt=vt.start;for(let Ii=0;Ii<vt.length-3;Ii+=3){const ki=vt[Ii],Pi=vt[Ii+1],dr=vt[Ii+2],br=vt[Ii+3],sr=vt[Ii+4],wr=Be===0?ki:Pi,Pr=Be===0?br:sr;let Bn=!1;Ke&&(mt=Math.sqrt(Math.pow(ki-br,2)+Math.pow(Pi-sr,2))),wr<me?Pr>me&&(pt=Je(lt,ki,Pi,br,sr,me),Ke&&(lt.start=yt+mt*pt)):wr>we?Pr<we&&(pt=Je(lt,ki,Pi,br,sr,we),Ke&&(lt.start=yt+mt*pt)):qi(lt,ki,Pi,dr),Pr<me&&wr>=me&&(pt=Je(lt,ki,Pi,br,sr,me),Bn=!0),Pr>we&&wr<=we&&(pt=Je(lt,ki,Pi,br,sr,we),Bn=!0),!je&&Bn&&(Ke&&(lt.end=yt+mt*pt),se.push(lt),lt=zn(vt)),Ke&&(yt+=mt)}let Rt=vt.length-3;const Zt=vt[Rt],Jt=vt[Rt+1],fi=Be===0?Zt:Jt;fi>=me&&fi<=we&&qi(lt,Zt,Jt,vt[Rt+2]),Rt=lt.length-3,je&&Rt>=3&&(lt[Rt]!==lt[0]||lt[Rt+1]!==lt[1])&&qi(lt,lt[0],lt[1],lt[2]),lt.length&&se.push(lt)}function zn(vt){const se=[];return se.size=vt.size,se.start=vt.start,se.end=vt.end,se}function Aa(vt,se,me,we,Be,je){for(const Ke of vt)pl(Ke,se,me,we,Be,je,!1)}function qi(vt,se,me,we){vt.push(se,me,we)}function Fn(vt,se,me,we,Be,je){const Ke=(je-se)/(we-se);return qi(vt,je,me+(Be-me)*Ke,1),Ke}function $u(vt,se,me,we,Be,je){const Ke=(je-me)/(Be-me);return qi(vt,se+(we-se)*Ke,je,1),Ke}function Jr(vt,se){const me=[];for(let we=0;we<vt.length;we++){const Be=vt[we],je=Be.type;let Ke;if(je==="Point"||je==="MultiPoint"||je==="LineString")Ke=Pa(Be.geometry,se);else if(je==="MultiLineString"||je==="Polygon"){Ke=[];for(const lt of Be.geometry)Ke.push(Pa(lt,se))}else if(je==="MultiPolygon"){Ke=[];for(const lt of Be.geometry){const Je=[];for(const mt of lt)Je.push(Pa(mt,se));Ke.push(Je)}}me.push(Kr(Be.id,je,Ke,Be.tags))}return me}function Pa(vt,se){const me=[];me.size=vt.size,vt.start!==void 0&&(me.start=vt.start,me.end=vt.end);for(let we=0;we<vt.length;we+=3)me.push(vt[we]+se,vt[we+1],vt[we+2]);return me}function Uc(vt,se){if(vt.transformed)return vt;const me=1<<vt.z,we=vt.x,Be=vt.y;for(const je of vt.features){const Ke=je.geometry,lt=je.type;if(je.geometry=[],lt===1)for(let Je=0;Je<Ke.length;Je+=2)je.geometry.push(fl(Ke[Je],Ke[Je+1],se,me,we,Be));else for(let Je=0;Je<Ke.length;Je++){const mt=[];for(let pt=0;pt<Ke[Je].length;pt+=2)mt.push(fl(Ke[Je][pt],Ke[Je][pt+1],se,me,we,Be));je.geometry.push(mt)}}return vt.transformed=!0,vt}function fl(vt,se,me,we,Be,je){return[Math.round(me*(vt*we-Be)),Math.round(me*(se*we-je))]}function jc(vt,se,me,we,Be){const je=se===Be.maxZoom?0:Be.tolerance/((1<<se)*Be.extent),Ke={features:[],numPoints:0,numSimplified:0,numFeatures:vt.length,source:null,x:me,y:we,z:se,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const lt of vt)Ps(Ke,lt,je,Be);return Ke}function Ps(vt,se,me,we){const Be=se.geometry,je=se.type,Ke=[];if(vt.minX=Math.min(vt.minX,se.minX),vt.minY=Math.min(vt.minY,se.minY),vt.maxX=Math.max(vt.maxX,se.maxX),vt.maxY=Math.max(vt.maxY,se.maxY),je==="Point"||je==="MultiPoint")for(let lt=0;lt<Be.length;lt+=3)Ke.push(Be[lt],Be[lt+1]),vt.numPoints++,vt.numSimplified++;else if(je==="LineString")$c(Ke,Be,vt,me,!1,!1);else if(je==="MultiLineString"||je==="Polygon")for(let lt=0;lt<Be.length;lt++)$c(Ke,Be[lt],vt,me,je==="Polygon",lt===0);else if(je==="MultiPolygon")for(let lt=0;lt<Be.length;lt++){const Je=Be[lt];for(let mt=0;mt<Je.length;mt++)$c(Ke,Je[mt],vt,me,!0,mt===0)}if(Ke.length){let lt=se.tags||null;if(je==="LineString"&&we.lineMetrics){lt={};for(const mt in se.tags)lt[mt]=se.tags[mt];lt.mapbox_clip_start=Be.start/Be.size,lt.mapbox_clip_end=Be.end/Be.size}const Je={geometry:Ke,type:je==="Polygon"||je==="MultiPolygon"?3:je==="LineString"||je==="MultiLineString"?2:1,tags:lt};se.id!==null&&(Je.id=se.id),vt.features.push(Je)}}function $c(vt,se,me,we,Be,je){const Ke=we*we;if(we>0&&se.size<(Be?Ke:we))return void(me.numPoints+=se.length/3);const lt=[];for(let Je=0;Je<se.length;Je+=3)(we===0||se[Je+2]>Ke)&&(me.numSimplified++,lt.push(se[Je],se[Je+1])),me.numPoints++;Be&&function(Je,mt){let pt=0;for(let yt=0,Rt=Je.length,Zt=Rt-2;yt<Rt;Zt=yt,yt+=2)pt+=(Je[yt]-Je[Zt])*(Je[yt+1]+Je[Zt+1]);if(pt>0===mt)for(let yt=0,Rt=Je.length;yt<Rt/2;yt+=2){const Zt=Je[yt],Jt=Je[yt+1];Je[yt]=Je[Rt-2-yt],Je[yt+1]=Je[Rt-1-yt],Je[Rt-2-yt]=Zt,Je[Rt-1-yt]=Jt}}(lt,je),vt.push(lt)}const zh={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Fh{constructor(se,me){const we=(me=this.options=function(je,Ke){for(const lt in Ke)je[lt]=Ke[lt];return je}(Object.create(zh),me)).debug;if(we&&console.time("preprocess data"),me.maxZoom<0||me.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(me.promoteId&&me.generateId)throw new Error("promoteId and generateId cannot be used together.");let Be=function(je,Ke){const lt=[];if(je.type==="FeatureCollection")for(let Je=0;Je<je.features.length;Je++)dl(lt,je.features[Je],Ke,Je);else dl(lt,je.type==="Feature"?je:{geometry:je},Ke);return lt}(se,me);this.tiles={},this.tileCoords=[],we&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",me.indexMaxZoom,me.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Be=function(je,Ke){const lt=Ke.buffer/Ke.extent;let Je=je;const mt=ro(je,1,-1-lt,lt,0,-1,2,Ke),pt=ro(je,1,1-lt,2+lt,0,-1,2,Ke);return(mt||pt)&&(Je=ro(je,1,-lt,1+lt,0,-1,2,Ke)||[],mt&&(Je=Jr(mt,1).concat(Je)),pt&&(Je=Je.concat(Jr(pt,-1)))),Je}(Be,me),Be.length&&this.splitTile(Be,0,0,0),we&&(Be.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(se,me,we,Be,je,Ke,lt){const Je=[se,me,we,Be],mt=this.options,pt=mt.debug;for(;Je.length;){Be=Je.pop(),we=Je.pop(),me=Je.pop(),se=Je.pop();const yt=1<<me,Rt=ts(me,we,Be);let Zt=this.tiles[Rt];if(!Zt&&(pt>1&&console.time("creation"),Zt=this.tiles[Rt]=jc(se,me,we,Be,mt),this.tileCoords.push({z:me,x:we,y:Be}),pt)){pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",me,we,Be,Zt.numFeatures,Zt.numPoints,Zt.numSimplified),console.timeEnd("creation"));const Bn=`z${me}`;this.stats[Bn]=(this.stats[Bn]||0)+1,this.total++}if(Zt.source=se,je==null){if(me===mt.indexMaxZoom||Zt.numPoints<=mt.indexMaxPoints)continue}else{if(me===mt.maxZoom||me===je)continue;if(je!=null){const Bn=je-me;if(we!==Ke>>Bn||Be!==lt>>Bn)continue}}if(Zt.source=null,se.length===0)continue;pt>1&&console.time("clipping");const Jt=.5*mt.buffer/mt.extent,fi=.5-Jt,Ii=.5+Jt,ki=1+Jt;let Pi=null,dr=null,br=null,sr=null,wr=ro(se,yt,we-Jt,we+Ii,0,Zt.minX,Zt.maxX,mt),Pr=ro(se,yt,we+fi,we+ki,0,Zt.minX,Zt.maxX,mt);se=null,wr&&(Pi=ro(wr,yt,Be-Jt,Be+Ii,1,Zt.minY,Zt.maxY,mt),dr=ro(wr,yt,Be+fi,Be+ki,1,Zt.minY,Zt.maxY,mt),wr=null),Pr&&(br=ro(Pr,yt,Be-Jt,Be+Ii,1,Zt.minY,Zt.maxY,mt),sr=ro(Pr,yt,Be+fi,Be+ki,1,Zt.minY,Zt.maxY,mt),Pr=null),pt>1&&console.timeEnd("clipping"),Je.push(Pi||[],me+1,2*we,2*Be),Je.push(dr||[],me+1,2*we,2*Be+1),Je.push(br||[],me+1,2*we+1,2*Be),Je.push(sr||[],me+1,2*we+1,2*Be+1)}}getTile(se,me,we){se=+se,me=+me,we=+we;const Be=this.options,{extent:je,debug:Ke}=Be;if(se<0||se>24)return null;const lt=1<<se,Je=ts(se,me=me+lt&lt-1,we);if(this.tiles[Je])return Uc(this.tiles[Je],je);Ke>1&&console.log("drilling down to z%d-%d-%d",se,me,we);let mt,pt=se,yt=me,Rt=we;for(;!mt&&pt>0;)pt--,yt>>=1,Rt>>=1,mt=this.tiles[ts(pt,yt,Rt)];return mt&&mt.source?(Ke>1&&(console.log("found parent tile z%d-%d-%d",pt,yt,Rt),console.time("drilling down")),this.splitTile(mt.source,pt,yt,Rt,se,me,we),Ke>1&&console.timeEnd("drilling down"),this.tiles[Je]?Uc(this.tiles[Je],je):null):null}}function ts(vt,se,me){return 32*((1<<vt)*me+se)+vt}function Jl(vt,se){const me=vt.tileID.canonical;if(!this._geoJSONIndex)return void se(null,null);const we=this._geoJSONIndex.getTile(me.z,me.x,me.y);if(!we)return void se(null,null);const Be=new ni(we.features);let je=Ye(Be);je.byteOffset===0&&je.byteLength===je.buffer.byteLength||(je=new Uint8Array(je)),se(null,{vectorTile:Be,rawData:je.buffer})}class Hu extends qt{constructor(se,me,we,Be,je,Ke){super(se,me,we,Be,Jl,Ke),je&&(this.loadGeoJSON=je),this._dynamicIndex=new ii}loadData(se,me){const we=se&&se.request,Be=we&&we.collectResourceTiming;this.loadGeoJSON(se,(je,Ke)=>{if(je||!Ke)return me(je);if(typeof Ke!="object")return me(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));{try{if(se.filter){const Je=r.U(se.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Je.result==="error")throw new Error(Je.value.map(mt=>`${mt.key}: ${mt.message}`).join(", "));Ke.features=Ke.features.filter(mt=>Je.value.evaluate({zoom:0},mt))}se.dynamic?(Ke.type==="Feature"&&(Ke={type:"FeatureCollection",features:[Ke]}),se.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ke.features,this.loaded),se.cluster&&(Ke.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=se.cluster?new mo(function({superclusterOptions:Je,clusterProperties:mt}){if(!mt||!Je)return Je;const pt={},yt={},Rt={accumulated:null,zoom:0},Zt={properties:null},Jt=Object.keys(mt);for(const fi of Jt){const[Ii,ki]=mt[fi],Pi=r.U(ki),dr=r.U(typeof Ii=="string"?[Ii,["accumulated"],["get",fi]]:Ii);pt[fi]=Pi.value,yt[fi]=dr.value}return Je.map=fi=>{Zt.properties=fi;const Ii={};for(const ki of Jt)Ii[ki]=pt[ki].evaluate(Rt,Zt);return Ii},Je.reduce=(fi,Ii)=>{Zt.properties=Ii;for(const ki of Jt)Rt.accumulated=fi[ki],fi[ki]=yt[ki].evaluate(Rt,Zt)},Je}(se)).load(Ke.features):se.dynamic?this._dynamicIndex:function(Je,mt){return new Fh(Je,mt)}(Ke,se.geojsonVtOptions)}catch(Je){return me(Je)}const lt={};if(Be){const Je=W(we);Je&&(lt.resourceTiming={},lt.resourceTiming[se.source]=JSON.parse(JSON.stringify(Je)))}me(null,lt)}})}reloadTile(se,me){const we=this.loaded;return we&&we[se.uid]?se.partial?me(null,void 0):super.reloadTile(se,me):this.loadTile(se,me)}loadGeoJSON(se,me){if(se.request)r.n(se.request,me);else{if(typeof se.data!="string")return me(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));try{return me(null,JSON.parse(se.data))}catch{return me(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(se,me){try{me(null,this._geoJSONIndex.getClusterExpansionZoom(se.clusterId))}catch(we){me(we)}}getClusterChildren(se,me){try{me(null,this._geoJSONIndex.getChildren(se.clusterId))}catch(we){me(we)}}getClusterLeaves(se,me){try{me(null,this._geoJSONIndex.getLeaves(se.clusterId,se.limit,se.offset))}catch(we){me(we)}}}class Gu{constructor(se,me){this.tileID=new r.aG(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),this.tileZoom=se.tileZoom,this.uid=se.uid,this.zoom=se.zoom,this.canonical=se.tileID.canonical,this.pixelRatio=se.pixelRatio,this.tileSize=se.tileSize,this.source=se.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=se.projection,this.brightness=me}parse(se,me,we,Be){this.status="parsing";const je=new r.aG(we.tileID.overscaledZ,we.tileID.wrap,we.tileID.canonical.z,we.tileID.canonical.x,we.tileID.canonical.y),Ke=[],lt=me.familiesBySource[we.source],Je=new r.d$(je,we.promoteId);return Je.bucketLayerIDs=[],Je.is3DTile=!0,r.ea(se).then(mt=>{if(!mt)return Be(new Error("Could not parse tile"));const pt=r.eb(mt,1/r.cc(we.tileID.canonical)),yt=mt.json.extensionsUsed&&mt.json.extensionsUsed.includes("MAPBOX_mesh_features")||mt.json.asset.extras&&mt.json.asset.extras.MAPBOX_mesh_features,Rt=mt.json.extensionsUsed&&mt.json.extensionsUsed.includes("EXT_meshopt_compression"),Zt=new r.a8(this.zoom,{brightness:this.brightness});for(const Jt in lt)for(const fi of lt[Jt]){const Ii=fi[0];Je.bucketLayerIDs.push(fi.map(Pi=>r.aC(Pi.id,Pi.scope))),Ii.recalculate(Zt,[]);const ki=new r.ec(fi,pt,je,yt,Rt,this.brightness,Je);yt||(ki.needsUpload=!0),Ke.push(ki),ki.evaluate(Ii)}this.status="done",Be(null,{buckets:Ke,featureIndex:Je,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(mt=>Be(new Error(mt.message)))}}class Ds{constructor(se,me,we,Be,je,Ke){this.actor=se,this.layerIndex=me,this.availableImages=we,this.brightness=Ke,this.loading={},this.loaded={}}loadTile(se,me){const we=se.uid,Be=this.loading[we]=new Gu(se,this.brightness);r.bi(se.request,(je,Ke)=>{const lt=!this.loading[we];return delete this.loading[we],lt||je?(Be.status="done",lt||(this.loaded[we]=Be),me(je)):Ke&&Ke.byteLength!==0?void Be.parse(Ke,this.layerIndex,se,(Je,mt)=>{Be.status="done",this.loaded=this.loaded||{},this.loaded[we]=Be,Je||!mt?me(Je):me(null,mt)}):(Be.status="done",this.loaded[we]=Be,me())})}reloadTile(se,me){const we=this.loaded,Be=se.uid;if(we&&we[Be]){const je=we[Be];je.projection=se.projection,je.brightness=se.brightness;const Ke=(lt,Je)=>{je.reloadCallback&&(delete je.reloadCallback,this.loadTile(se,me)),me(lt,Je)};je.status==="parsing"?je.reloadCallback=Ke:je.status==="done"&&this.loadTile(se,me)}}abortTile(se,me){const we=se.uid;this.loading[we]&&delete this.loading[we],me()}removeTile(se,me){const we=this.loaded,Be=se.uid;we&&we[Be]&&delete we[Be],me()}}class Go{constructor(se){this.self=se,this.actor=new r.ed(se,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new r.I,this.projections={},this.defaultProjection=r.bP({name:"mercator"}),this.workerSourceTypes={vector:qt,geojson:Hu,"batched-model":Ds},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(me,we)=>{if(this.workerSourceTypes[me])throw new Error(`Worker source with name "${me}" already registered.`);this.workerSourceTypes[me]=we},this.self.registerRTLTextPlugin=me=>{if(r.ee.isParsed())throw new Error("RTL text plugin already registered.");r.ee.applyArabicShaping=me.applyArabicShaping,r.ee.processBidirectionalText=me.processBidirectionalText,r.ee.processStyledBidirectionalText=me.processStyledBidirectionalText}}clearCaches(se,me,we){delete this.layerIndexes[se],delete this.availableImages[se],delete this.workerSources[se],delete this.demWorkerSources[se],delete this.rasterArrayWorkerSource,we()}checkIfReady(se,me,we){we()}setReferrer(se,me){this.referrer=me}spriteLoaded(se,{scope:me,isLoaded:we}){if(this.isSpriteLoaded[se]||(this.isSpriteLoaded[se]={}),this.isSpriteLoaded[se][me]=we,this.workerSources[se]&&this.workerSources[se][me])for(const Be in this.workerSources[se][me]){const je=this.workerSources[se][me][Be];for(const Ke in je){const lt=je[Ke];lt instanceof qt&&(lt.isSpriteLoaded=we,lt.fire(new r.z("isSpriteLoaded")))}}}setImages(se,{scope:me,images:we},Be){if(this.availableImages[se]||(this.availableImages[se]={}),this.availableImages[se][me]=we,this.workerSources[se]&&this.workerSources[se][me]){for(const je in this.workerSources[se][me]){const Ke=this.workerSources[se][me][je];for(const lt in Ke)Ke[lt].availableImages=we}Be()}else Be()}setProjection(se,me){this.projections[se]=r.bP(me)}setBrightness(se,me,we){this.brightness=me,we()}setLayers(se,me,we){this.getLayerIndex(se,me.scope).replace(me.layers,me.options),we()}updateLayers(se,me,we){this.getLayerIndex(se,me.scope).update(me.layers,me.removedIds,me.options),we()}loadTile(se,me,we){me.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,me.type,me.source,me.scope).loadTile(me,we)}loadDEMTile(se,me,we){this.getDEMWorkerSource(se,me.source,me.scope).loadTile(me,we)}decodeRasterArray(se,me,we){this.getRasterArrayWorkerSource().decodeRasterArray(me,we)}reloadTile(se,me,we){me.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,me.type,me.source,me.scope).reloadTile(me,we)}abortTile(se,me,we){this.getWorkerSource(se,me.type,me.source,me.scope).abortTile(me,we)}removeTile(se,me,we){this.getWorkerSource(se,me.type,me.source,me.scope).removeTile(me,we)}removeSource(se,me,we){if(!(this.workerSources[se]&&this.workerSources[se][me.scope]&&this.workerSources[se][me.scope][me.type]&&this.workerSources[se][me.scope][me.type][me.source]))return;const Be=this.workerSources[se][me.scope][me.type][me.source];delete this.workerSources[se][me.scope][me.type][me.source],Be.removeSource!==void 0?Be.removeSource(me,we):we()}loadWorkerSource(se,me,we){try{this.self.importScripts(me.url),we()}catch(Be){we(Be.toString())}}syncRTLPluginState(se,me,we){try{r.ee.setState(me);const Be=r.ee.getPluginURL();if(r.ee.isLoaded()&&!r.ee.isParsed()&&Be!=null){this.self.importScripts(Be);const je=r.ee.isParsed();we(je?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Be}`),je)}}catch(Be){we(Be.toString())}}setDracoUrl(se,me){this.dracoUrl=me}getAvailableImages(se,me){this.availableImages[se]||(this.availableImages[se]={});let we=this.availableImages[se][me];return we||(we=[]),we}getLayerIndex(se,me){this.layerIndexes[se]||(this.layerIndexes[se]={});let we=this.layerIndexes[se][me];return we||(we=this.layerIndexes[se][me]=new he,we.scope=me),we}getWorkerSource(se,me,we,Be){return this.workerSources[se]||(this.workerSources[se]={}),this.workerSources[se][Be]||(this.workerSources[se][Be]={}),this.workerSources[se][Be][me]||(this.workerSources[se][Be][me]={}),this.isSpriteLoaded[se]||(this.isSpriteLoaded[se]={}),this.workerSources[se][Be][me][we]||(this.workerSources[se][Be][me][we]=new this.workerSourceTypes[me]({send:(je,Ke,lt,Je,mt,pt)=>{this.actor.send(je,Ke,lt,se,mt,pt)},scheduler:this.actor.scheduler},this.getLayerIndex(se,Be),this.getAvailableImages(se,Be),this.isSpriteLoaded[se][Be],void 0,this.brightness)),this.workerSources[se][Be][me][we]}rasterizeImages(se,me,we){const{imageTasks:Be,scope:je}=me,Ke={};for(const lt in Be){const{image:Je,imageIdWithOptions:mt}=Be[lt];Ke[lt]=this.imageRasterizer.rasterize(mt,Je,je,se)}we(void 0,Ke)}removeRasterizedImages(se,me,we){const{imageIds:Be,scope:je}=me;this.imageRasterizer.removeImagesFromCacheByIds(Be,je,se),we()}getDEMWorkerSource(se,me,we){return this.demWorkerSources[se]||(this.demWorkerSources[se]={}),this.demWorkerSources[se][we]||(this.demWorkerSources[se][we]={}),this.demWorkerSources[se][we][me]||(this.demWorkerSources[se][we][me]=new Me),this.demWorkerSources[se][we][me]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new gt),this.rasterArrayWorkerSource}enforceCacheSizeLimit(se,me){r.ef(me)}getWorkerPerformanceMetrics(se,me,we){we(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Go(self)),Go}),A(["./shared"],function(r){var W="3.10.0";const ie={create:"create",load:"load",fullLoad:"fullLoad"},oe={mark(u){performance.mark(u)},measure(u,t,n){performance.measure(u,t,n)}};function he(u){const t=u.name.split("?")[0];return r.a(t)&&t.includes("mapbox-gl.js")?"javascript":r.a(t)&&t.includes("mapbox-gl.css")?"css":r.b(t)?"fontRange":r.c(t)?"sprite":r.i(t)?"style":r.d(t)?"tilejson":"other"}var ve,Se={},xe=function(){if(ve)return Se;function u(d){return!t(d)}function t(d){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,T,I=new Blob([""],{type:"text/javascript"}),F=URL.createObjectURL(I);try{T=new Worker(F),b=!0}catch{b=!1}return T&&T.terminate(),URL.revokeObjectURL(F),b}()?function(){var b=document.createElement("canvas");b.width=b.height=1;var T=b.getContext("2d");if(!T)return!1;var I=T.getImageData(0,0,1,1);return I&&I.width===b.width}()?(n[y=d&&d.failIfMajorPerformanceCaveat]===void 0&&(n[y]=function(b){var T,I=function(F){var V=document.createElement("canvas"),j=Object.create(u.webGLContextAttributes);return j.failIfMajorPerformanceCaveat=F,V.getContext("webgl2",j)}(b);if(!I)return!1;try{T=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!T||I.isContextLost())&&(I.shaderSource(T,"void main() {}"),I.compileShader(T),I.getShaderParameter(T,I.COMPILE_STATUS)===!0)}(y)),n[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}ve=1,Se.supported=u,Se.notSupportedReason=t;var n={};return u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Se}();function Ae(u,t,n){const d=document.createElement(u);return t!=null&&(d.className=t),n&&n.appendChild(d),d}function Re(u,t,n){const d=document.createElementNS("http://www.w3.org/2000/svg",u);for(const y of Object.keys(t))d.setAttributeNS(null,y,String(t[y]));return n&&n.appendChild(d),d}const He=typeof document<"u"?document.documentElement&&document.documentElement.style:null,rt=He&&He.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ht;function tt(){He&&rt&&(ht=He[rt],He[rt]="none")}function at(){He&&rt&&(He[rt]=ht)}function Lt(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",Lt,!0)}function Ve(){window.addEventListener("click",Lt,!0),window.setTimeout(()=>{window.removeEventListener("click",Lt,!0)},0)}function Tt(u,t){const n=u.getBoundingClientRect();return gt(u,n,t)}function qt(u,t){const n=u.getBoundingClientRect(),d=[];for(let y=0;y<t.length;y++)d.push(gt(u,n,t[y]));return d}function Me(u){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&u.button===2&&u.ctrlKey?0:u.button}function gt(u,t,n){const d=u.offsetWidth===t.width?1:u.offsetWidth/t.width;return new r.P((n.clientX-t.left)*d,(n.clientY-t.top)*d)}const oi="01",Ti="NO_ACCESS_TOKEN";class ni{constructor(t,n,d){this._transformRequestFn=t,this._customAccessToken=n,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const t=function(){let n="";for(let d=0;d<10;d++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",oi,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeStyleURL(t,n){if(!r.f(t))return t;const d=zt(t);return d.params.push(`sdk=js-${W}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||n)}normalizeGlyphsURL(t,n){if(!r.f(t))return t;const d=zt(t);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||n)}normalizeModelURL(t,n){if(!r.f(t))return t;const d=zt(t);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||n)}normalizeSourceURL(t,n,d,y){if(!r.f(t))return t;const b=zt(t);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),d&&b.params.push(`language=${d}`),y&&b.params.push(`worldview=${y}`),this._makeAPIURL(b,this._customAccessToken||n)}normalizeIconsetURL(t,n){const d=zt(t);return r.f(t)?(d.path=`/styles/v1${d.path}/iconset.pbf`,this._makeAPIURL(d,this._customAccessToken||n)):ii(d)}normalizeSpriteURL(t,n,d,y){const b=zt(t);return r.f(t)?(b.path=`/styles/v1${b.path}/sprite${n}${d}`,this._makeAPIURL(b,this._customAccessToken||y)):(b.path+=`${n}${d}`,ii(b))}normalizeTileURL(t,n,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!r.f(t))return t;const y=zt(t);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||d&&y.authority!=="raster"&&d===512?"@2x":""}${r.m.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${r.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${r.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${r.e.TILE_URL_VERSION}${y.path}`);const b=this._customAccessToken||function(T){for(const I of T){const F=I.match(/^access_token=(.*)$/);if(F)return F[1]}return null}(y.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,b)}canonicalizeTileURL(t,n){const d=zt(t);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return t;let y="mapbox://";d.path.match(/^\/raster\/v1\//)?y+=`raster/${d.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${d.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${d.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let b=d.params;return n&&(b=b.filter(T=>!T.match(/^access_token=/))),b.length&&(y+=`?${b.join("&")}`),y}canonicalizeTileset(t,n){const d=!!n&&r.f(n),y=[];for(const b of t.tiles||[])r.h(b)?y.push(this.canonicalizeTileURL(b,d)):y.push(b);return y}_makeAPIURL(t,n){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=zt(r.e.API_URL);if(t.protocol=y.protocol,t.authority=y.authority,t.protocol==="http"){const b=t.params.indexOf("secure");b>=0&&t.params.splice(b,1)}if(y.path!=="/"&&(t.path=`${y.path}${t.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return ii(t);if(n=n||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return t.params=t.params.filter(b=>b.indexOf("access_token")===-1),t.params.push(`access_token=${n||""}`),ii(t)}}const Mt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function zt(u){const t=u.match(Mt);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ii(u){const t=u.params.length?`?${u.params.join("&")}`:"";return`${u.protocol}://${u.authority}${u.path}${t}`}const Yt="mapbox.eventData";function jt(u){if(!u)return null;const t=u.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(r.j(t[1]))}catch{return null}}class Ri{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=jt(r.e.ACCESS_TOKEN);let d="";return d=n&&n.u?r.k(n.u):r.e.ACCESS_TOKEN||"",t?`${Yt}.${t}:${d}`:`${Yt}:${d}`}fetchEventData(){const t=r.s("localStorage"),n=this.getStorageKey(),d=this.getStorageKey("uuid");if(t)try{const y=localStorage.getItem(n);y&&(this.eventData=JSON.parse(y));const b=localStorage.getItem(d);b&&(this.anonId=b)}catch{r.w("Unable to read from LocalStorage")}}saveEventData(){const t=r.s("localStorage"),n=this.getStorageKey(),d=this.getStorageKey("uuid"),y=this.anonId;if(t&&y)try{localStorage.setItem(d,y),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{r.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,d,y){if(!r.e.EVENTS_URL)return;const b=zt(r.e.EVENTS_URL);b.params.push(`access_token=${y||r.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(t).toISOString()},I=n?r.l(T,n):T,F={url:ii(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=r.p(F,V=>{this.pendingRequest=null,d(V),this.saveEventData(),this.processRequests(y)})}queueRequest(t,n){this.queue.push(t),this.processRequests(n)}}const Yi=new class extends Ri{constructor(u){super("appUserTurnstile"),this._customAccessToken=u}postTurnstileEvent(u,t){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(u)&&u.some(n=>r.f(n)||r.h(n))&&this.queueRequest(Date.now(),t)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=jt(r.e.ACCESS_TOKEN),n=t?t.u:r.e.ACCESS_TOKEN;let d=n!==this.eventData.tokenU;r.v(this.anonId)||(this.anonId=r.u(),d=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),T=new Date(y),I=(y-this.eventData.lastSuccess)/864e5;d=d||I>=1||I<-1||b.getDate()!==T.getDate()}else d=!0;d?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:W,skuId:oi,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=y,this.eventData.tokenU=n)},u):this.processRequests()}},Wi=Yi.postTurnstileEvent.bind(Yi),vi=new class extends Ri{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(u,t,n,d){this.skuToken=t,this.errorCb=d,r.e.EVENTS_URL&&(n||r.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},n):this.errorCb(new Error(Ti)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),r.v(this.anonId)||(this.anonId=r.u()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:W,skuId:oi,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},u))}remove(){this.errorCb=null}},Wr=vi.postMapLoadEvent.bind(vi),an=new class extends Ri{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(u){let t=this.mapInstanceIdMap.get(u);return t||(t=r.u(),this.mapInstanceIdMap.set(u,t)),t}getEventId(u){const t=this.eventIdPerMapInstanceMap.get(u)||0;return this.eventIdPerMapInstanceMap.set(u,t+1),t}postStyleLoadEvent(u,t){const{map:n,style:d,importedStyles:y}=t;if(!r.e.EVENTS_URL||!u&&!r.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(n),T={mapInstanceId:b,eventId:this.getEventId(b),style:d};y.length&&(T.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:T},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:n}=this.queue.shift();this.postEvent(t,n,()=>{},u)}},_n=an.postStyleLoadEvent.bind(an),En=new class extends Ri{constructor(){super("gljs.performance")}postPerformanceEvent(u,t){r.e.EVENTS_URL&&(u||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:n}=this.queue.shift(),d=function(y){const b=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),I=function(Q){const ce={};if(Q){for(const ae in Q)if(ae!=="other")for(const de of Q[ae]){const pe=`${ae}ResolveRangeMin`,Te=`${ae}ResolveRangeMax`,ke=`${ae}RequestCount`,De=`${ae}RequestCachedCount`;ce[pe]=Math.min(ce[pe]||1/0,de.startTime),ce[Te]=Math.max(ce[Te]||-1/0,de.responseEnd);const Ue=Le=>{ce[Le]===void 0&&(ce[Le]=0),++ce[Le]};de.transferSize!==void 0&&de.transferSize===0&&Ue(De),Ue(ke)}}return ce}(function(Q,ce){const ae={};if(Q)for(const de of Q){const pe=ce(de);ae[pe]===void 0&&(ae[pe]=[]),ae[pe].push(de)}return ae}(b,he)),F=window.devicePixelRatio,V=navigator.connection||navigator.mozConnection||navigator.webkitConnection,j=V?V.effectiveType:void 0,G={counters:[],metadata:[],attributes:[]},q=(Q,ce,ae)=>{ae!=null&&Q.push({name:ce,value:ae.toString()})};for(const Q in I)q(G.counters,Q,I[Q]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(q(G.counters,"interactionRangeMin",y.interactionRange[0]),q(G.counters,"interactionRangeMax",y.interactionRange[1])),T)for(const Q of Object.keys(ie)){const ce=ie[Q],ae=T.find(de=>de.name===ce);ae&&q(G.counters,ce,ae.startTime)}return q(G.counters,"visibilityHidden",y.visibilityHidden),q(G.attributes,"style",function(Q){if(Q)for(const ce of Q){const ae=ce.name.split("?")[0];if(r.i(ae)){const de=ae.split("/").slice(-2);if(de.length===2)return`mapbox://styles/${de[0]}/${de[1]}`}}}(b)),q(G.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),q(G.attributes,"fogEnabled",y.fogEnabled?"true":"false"),q(G.attributes,"projection",y.projection),q(G.attributes,"zoom",y.zoom),q(G.metadata,"devicePixelRatio",F),q(G.metadata,"connectionEffectiveType",j),q(G.metadata,"navigatorUserAgent",navigator.userAgent),q(G.metadata,"screenWidth",window.screen.width),q(G.metadata,"screenHeight",window.screen.height),q(G.metadata,"windowWidth",window.innerWidth),q(G.metadata,"windowHeight",window.innerHeight),q(G.metadata,"mapWidth",y.width/F),q(G.metadata,"mapHeight",y.height/F),q(G.metadata,"webglRenderer",y.renderer),q(G.metadata,"webglVendor",y.vendor),q(G.metadata,"sdkVersion",W),q(G.metadata,"sdkIdentifier","mapbox-gl-js"),G}(n);for(const y of d.metadata);for(const y of d.counters);for(const y of d.attributes);this.postEvent(t,d,()=>{},u)}},qr=En.postPerformanceEvent.bind(En),es=new class extends Ri{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(u,t,n,d){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const y=zt(r.e.API_URL+r.e.SESSION_PATH);y.params.push(`sku=${t||""}`),y.params.push(`access_token=${d||r.e.ACCESS_TOKEN||""}`);const b={url:ii(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(b,T=>{this.pendingRequest=null,n(T),this.saveEventData(),this.processRequests(d)})}getSessionAPI(u,t,n,d){this.skuToken=t,this.errorCb=d,r.e.SESSION_PATH&&r.e.API_URL&&(n||r.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},n):this.errorCb(new Error(Ti)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},u)}remove(){this.errorCb=null}},Ye=es.getSessionAPI.bind(es),ds=new Set;function Bi(u,t){t?ds.add(u):ds.delete(u)}class Xs{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,n){this._updatedSourceCaches[t]=n,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const n=t.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(t.id),this.setDirty()}removeLayer(t){const n=t.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][t.id]=t,this._updatedLayers[n].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const n in this._updatedLayers)t[n]=t[n]||{},t[n].updatedIds=Array.from(this._updatedLayers[n].values());for(const n in this._removedLayers)t[n]=t[n]||{},t[n].removedIds=Object.keys(this._removedLayers[n]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Wt(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class jn extends r.E{constructor(t){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=t,t!=="raster"&&r.t()&&(this.imageRasterizerDispatcher=new r.D(r.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.I),this._imageRasterizer}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new r.r({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,n){if(this.loaded[n]!==t&&(this.loaded[n]=t,t)){for(const{ids:d,callback:y}of this.requestors)this._notify(d,n,y);this.requestors=[]}}hasImage(t,n){return!!this.getImage(t,n)}getImage(t,n){return this.images[n][t]}addImage(t,n,d){this._validate(t,d)&&(this.images[n][t]=d)}_validate(t,n){let d=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new r.y(new Error(`Image "${t}" has invalid "stretchX" value`))),d=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new r.y(new Error(`Image "${t}" has invalid "stretchY" value`))),d=!1),this._validateContent(n.content,n)||(this.fire(new r.y(new Error(`Image "${t}" has invalid "content" value`))),d=!1),d}_validateStretch(t,n){if(!t)return!0;let d=0;for(const y of t){if(y[0]<d||y[1]<y[0]||n<y[1])return!1;d=y[1]}return!0}_validateContent(t,n){return t?t.length!==4||!n.usvg&&(t[0]<0||n.data.width<t[0]||t[1]<0||n.data.height<t[1]||t[2]<0||n.data.width<t[2]||t[3]<0||n.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,n,d){d.version=this.images[n][t].version+1,this.images[n][t]=d,this.updatedImages[n][t]=!0,this.removeFromImageRasterizerCache(t,n)}removeFromImageRasterizerCache(t,n){this.spriteFormat!=="raster"&&(r.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:n}):this.imageRasterizer.removeImagesFromCacheByIds([t],n))}removeImage(t,n){const d=this.images[n][t];delete this.images[n][t],delete this.patterns[n][t],this.removeFromImageRasterizerCache(t,n),d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,n,d){let y=!0;const b=!!this.loaded[n];if(!b)for(const T of t)this.images[n][T]||(y=!1);b||y?this._notify(t,n,d):this.requestors.push({ids:t,scope:n,callback:d})}rasterizeImages({scope:t,imageTasks:n},d){const y={};for(const b in n){const T=n[b],I=this.getImage(T.id,t);I&&(y[b]={image:I,imageIdWithOptions:T})}r.t()?this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{imageTasks:y,scope:t},d):this.rasterizeImagesInMainThread({imageTasks:y,scope:t},d)}rasterizeImagesInMainThread(t,n){const{imageTasks:d,scope:y}=t,b={};for(const T in d){const{image:I,imageIdWithOptions:F}=d[T];b[T]=this.imageRasterizer.rasterize(F,I,y,"")}n(void 0,b)}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,n,d){const y={};for(const b of t){this.images[n][b]||this.fire(new r.z("styleimagemissing",{id:b}));const T=this.images[n][b];T?y[b]={data:T.usvg?null:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,usvg:T.usvg,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)}:r.w(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,y)}getPixelSize(t){const{width:n,height:d}=this.atlasImage[t];return{width:n,height:d}}getPattern(t,n,d){const y=this.patterns[n][t],b=this.getImage(t,n);if(!b)return null;if(y&&y.position.version===b.version)return y.position;if(y)y.position.version=b.version;else{b.usvg&&!b.data&&(b.data=this.imageRasterizer.rasterize(r.A.from(t).getPrimary(),b,n,""));const T={w:b.data.width+2*r.B,h:b.data.height+2*r.B,x:0,y:0},I=new r.C(T,b,r.B);this.patterns[n][t]={bin:T,position:I}}return this._updatePatternAtlas(n,d),this.patterns[n][t].position}bind(t,n){const d=t.gl;let y=this.atlasTexture[n];y?this.dirty&&(y.update(this.atlasImage[n]),this.dirty=!1):(y=new r.T(t,this.atlasImage[n],d.RGBA8),this.atlasTexture[n]=y),y.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(t,n){const d=[];for(const I in this.patterns[t])d.push(this.patterns[t][I].bin);const{w:y,h:b}=r.F(d),T=this.atlasImage[t];T.resize({width:y||1,height:b||1});for(const I in this.patterns[t]){const{bin:F,position:V}=this.patterns[t][I];let j=V.padding;const G=F.x+j,q=F.y+j,Q=this.images[t][I].data,ce=Q.width,ae=Q.height;j=j>1?j-1:j,r.r.copy(Q,T,{x:0,y:0},{x:G,y:q},{width:ce,height:ae},n),r.r.copy(Q,T,{x:0,y:ae-j},{x:G,y:q-j},{width:ce,height:j},n),r.r.copy(Q,T,{x:0,y:0},{x:G,y:q+ae},{width:ce,height:j},n),r.r.copy(Q,T,{x:ce-j,y:0},{x:G-j,y:q},{width:j,height:ae},n),r.r.copy(Q,T,{x:0,y:0},{x:G+ce,y:q},{width:j,height:ae},n),r.r.copy(Q,T,{x:ce-j,y:ae-j},{x:G-j,y:q-j},{width:j,height:j},n),r.r.copy(Q,T,{x:0,y:ae-j},{x:G+ce,y:q-j},{width:j,height:j},n),r.r.copy(Q,T,{x:0,y:0},{x:G+ce,y:q+ae},{width:j,height:j},n),r.r.copy(Q,T,{x:ce-j,y:0},{x:G-j,y:q+ae},{width:j,height:j},n)}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,n){for(const d of t){if(this.callbackDispatchedThisFrame[n][d])continue;this.callbackDispatchedThisFrame[n][d]=!0;const y=this.images[n][d];Wt(y)&&this.updateImage(d,n,y)}}}function As(u){const t=u.key,n=u.value,d=u.valueSpec||{},y=u.objectElementValidators||{},b=u.style,T=u.styleSpec;let I=[];const F=r.H(n);if(F!=="object")return[new r.V(t,n,`object expected, ${F} found`)];for(const V in n){const j=V.split(".")[0];let G;y[j]?G=y[j]:d[j]?G=qi:y["*"]?G=y["*"]:d["*"]&&(G=qi),G?I=I.concat(G({key:(t&&`${t}.`)+V,value:n[V],valueSpec:d[j]||d["*"],style:b,styleSpec:T,object:n,objectKey:V},n)):I.push(new r.G(t,n[V],`unknown property "${V}"`))}for(const V in d)y[V]||d[V].required&&d[V].default===void 0&&n[V]===void 0&&I.push(new r.V(t,n,`missing required property "${V}"`));return I}function mo(u){const t=u.value,n=u.valueSpec,d=u.style,y=u.styleSpec,b=u.key,T=u.arrayElementValidator||qi;if(r.H(t)!=="array")return[new r.V(b,t,`array expected, ${r.H(t)} found`)];if(n.length&&t.length!==n.length)return[new r.V(b,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new r.V(b,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let I={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};y.$version<7&&(I.function=n.function),r.H(n.value)==="object"&&(I=n.value);let F=[];for(let V=0;V<t.length;V++)F=F.concat(T({array:t,arrayIndex:V,value:t[V],valueSpec:I,style:d,styleSpec:y,key:`${b}[${V}]`},!0));return F}function rr(u){const t=u.key,n=u.value,d=u.valueSpec;let y=r.H(n);if(y==="number"&&n!=n&&(y="NaN"),y!=="number")return[new r.V(t,n,`number expected, ${y} found`)];if("minimum"in d){let b=d.minimum;if(r.H(d.minimum)==="array"&&(b=d.minimum[u.arrayIndex]),n<b)return[new r.V(t,n,`${n} is less than the minimum value ${b}`)]}if("maximum"in d){let b=d.maximum;if(r.H(d.maximum)==="array"&&(b=d.maximum[u.arrayIndex]),n>b)return[new r.V(t,n,`${n} is greater than the maximum value ${b}`)]}return[]}function $n(u){const t=u.valueSpec,n=r.K(u.value.type);let d,y,b,T={};const I=n!=="categorical"&&u.value.property===void 0,F=!I,V=r.H(u.value.stops)==="array"&&r.H(u.value.stops[0])==="array"&&r.H(u.value.stops[0][0])==="object",j=As({key:u.key,value:u.value,valueSpec:u.styleSpec.function,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(Q){if(n==="identity")return[new r.V(Q.key,Q.value,'identity function may not have a "stops" property')];let ce=[];const ae=Q.value;return ce=ce.concat(mo({key:Q.key,value:ae,valueSpec:Q.valueSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:G})),r.H(ae)==="array"&&ae.length===0&&ce.push(new r.V(Q.key,ae,"array must have at least one stop")),ce},default:function(Q){return qi({key:Q.key,value:Q.value,valueSpec:t,style:Q.style,styleSpec:Q.styleSpec})}}});return n==="identity"&&I&&j.push(new r.V(u.key,u.value,'missing required property "property"')),n==="identity"||u.value.stops||j.push(new r.V(u.key,u.value,'missing required property "stops"')),n==="exponential"&&u.valueSpec.expression&&!r.L(u.valueSpec)&&j.push(new r.V(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(F&&!r.M(u.valueSpec)?j.push(new r.V(u.key,u.value,"property functions not supported")):I&&!r.N(u.valueSpec)&&j.push(new r.V(u.key,u.value,"zoom functions not supported"))),n!=="categorical"&&!V||u.value.property!==void 0||j.push(new r.V(u.key,u.value,'"property" property is required')),j;function G(Q){let ce=[];const ae=Q.value,de=Q.key;if(r.H(ae)!=="array")return[new r.V(de,ae,`array expected, ${r.H(ae)} found`)];if(ae.length!==2)return[new r.V(de,ae,`array length 2 expected, length ${ae.length} found`)];if(V){if(r.H(ae[0])!=="object")return[new r.V(de,ae,`object expected, ${r.H(ae[0])} found`)];if(ae[0].zoom===void 0)return[new r.V(de,ae,"object stop key must have zoom")];if(ae[0].value===void 0)return[new r.V(de,ae,"object stop key must have value")];const pe=r.K(ae[0].zoom);if(typeof pe!="number")return[new r.V(de,ae[0].zoom,"stop zoom values must be numbers")];if(b&&b>pe)return[new r.V(de,ae[0].zoom,"stop zoom values must appear in ascending order")];pe!==b&&(b=pe,y=void 0,T={}),ce=ce.concat(As({key:`${de}[0]`,value:ae[0],valueSpec:{zoom:{}},style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:rr,value:q}}))}else ce=ce.concat(q({key:`${de}[0]`,value:ae[0],style:Q.style,styleSpec:Q.styleSpec},ae));return r.O(r.Q(ae[1]))?ce.concat([new r.V(`${de}[1]`,ae[1],"expressions are not allowed in function stops.")]):ce.concat(qi({key:`${de}[1]`,value:ae[1],valueSpec:t,style:Q.style,styleSpec:Q.styleSpec}))}function q(Q,ce){const ae=r.H(Q.value),de=r.K(Q.value),pe=Q.value!==null?Q.value:ce;if(d){if(ae!==d)return[new r.V(Q.key,pe,`${ae} stop domain type must match previous stop domain type ${d}`)]}else d=ae;if(ae!=="number"&&ae!=="string"&&ae!=="boolean"&&typeof de!="number"&&typeof de!="string"&&typeof de!="boolean")return[new r.V(Q.key,pe,"stop domain value must be a number, string, or boolean")];if(ae!=="number"&&n!=="categorical"){let Te=`number expected, ${ae} found`;return r.M(t)&&n===void 0&&(Te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(Q.key,pe,Te)]}return n!=="categorical"||ae!=="number"||typeof de=="number"&&isFinite(de)&&Math.floor(de)===de?n!=="categorical"&&ae==="number"&&typeof de=="number"&&typeof y=="number"&&y!==void 0&&de<y?[new r.V(Q.key,pe,"stop domain values must appear in ascending order")]:(y=de,n==="categorical"&&de in T?[new r.V(Q.key,pe,"stop domain values must be unique")]:(T[de]=!0,[])):[new r.V(Q.key,pe,`integer expected, found ${String(de)}`)]}}function xs(u){const t=(u.expressionContext==="property"?r.S:r.U)(r.Q(u.value),u.valueSpec);if(t.result==="error")return t.value.map(d=>new r.V(`${u.key}${d.key}`,u.value,d.message));const n=t.value.expression||t.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!n.outputDefined())return[new r.V(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!r.W(n))return[new r.V(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter")return Ca(n,u);if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!r.X(n,["zoom","feature-state"]))return[new r.V(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!r.Y(n))return[new r.V(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ca(u,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const y of t.valueSpec.expression.parameters)n.delete(y);if(n.size===0)return[];const d=[];return u instanceof r.Z&&n.has(u.name)?[new r.V(t.key,t.value,`["${u.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(u.eachChild(y=>{d.push(...Ca(y,t))}),d)}function xr(u){const t=u.key,n=u.value,d=u.valueSpec,y=[];return Array.isArray(d.values)?d.values.indexOf(r.K(n))===-1&&y.push(new r.V(t,n,`expected one of [${d.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(d.values).indexOf(r.K(n))===-1&&y.push(new r.V(t,n,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(n)} found`)),y}function go(u){return r.$(r.Q(u.value))?xs(r.J({},u,{expressionContext:"filter",valueSpec:u.styleSpec[`filter_${u.layerType||"fill"}`]})):nr(u)}function nr(u){const t=u.value,n=u.key;if(r.H(t)!=="array")return[new r.V(n,t,`array expected, ${r.H(t)} found`)];const d=u.styleSpec;let y,b=[];if(t.length<1)return[new r.V(n,t,"filter array must have at least 1 element")];switch(b=b.concat(xr({key:`${n}[0]`,value:t[0],valueSpec:d.filter_operator,style:u.style,styleSpec:u.styleSpec})),r.K(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&r.K(t[1])==="$type"&&b.push(new r.V(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&b.push(new r.V(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(y=r.H(t[1]),y!=="string"&&b.push(new r.V(`${n}[1]`,t[1],`string expected, ${y} found`)));for(let T=2;T<t.length;T++)y=r.H(t[T]),r.K(t[1])==="$type"?b=b.concat(xr({key:`${n}[${T}]`,value:t[T],valueSpec:d.geometry_type,style:u.style,styleSpec:u.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&b.push(new r.V(`${n}[${T}]`,t[T],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let T=1;T<t.length;T++)b=b.concat(nr({key:`${n}[${T}]`,value:t[T],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":y=r.H(t[1]),t.length!==2?b.push(new r.V(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):y!=="string"&&b.push(new r.V(`${n}[1]`,t[1],`string expected, ${y} found`))}return b}function Kr(u,t){const n=u.key,d=u.style,y=u.layer,b=u.styleSpec,T=u.value,I=u.objectKey,F=b[`${t}_${u.layerType}`];if(!F)return[];const V=I.match(/^(.*)-use-theme$/);if(t==="paint"&&V&&F[V[1]])return r.O(T)?[].concat(qi({key:u.key,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:d,styleSpec:b,expressionContext:"property",propertyType:t,propertyKey:I})):qi({key:n,value:T,valueSpec:{type:"string"},style:d,styleSpec:b});const j=I.match(/^(.*)-transition$/);if(t==="paint"&&j&&F[j[1]]&&F[j[1]].transition)return qi({key:n,value:T,valueSpec:b.transition,style:d,styleSpec:b});const G=u.valueSpec||F[I];if(!G)return[new r.G(n,T,`unknown property "${I}"`)];let q;if(r.H(T)==="string"&&r.M(G)&&!G.tokens&&(q=/^{([^}]+)}$/.exec(T))){const ce=`\`{ "type": "identity", "property": ${q?JSON.stringify(q[1]):'"_"'} }\``;return[new r.V(n,T,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${ce}.`)]}const Q=[];if(u.layerType==="symbol")I!=="text-field"||!d||d.glyphs||d.imports||Q.push(new r.V(n,T,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&r.a0(r.Q(T))&&r.K(T.type)==="identity"&&Q.push(new r.V(n,T,'"text-font" does not support identity functions'));else if(u.layerType==="model"&&t==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&r.M(G)&&(r.a1(G)||r.N(G))){const ce=r.S(r.Q(T),G),ae=ce.value.expression||ce.value._styleExpression.expression;ae&&!r.X(ae,["measure-light"])&&(I==="model-emissive-strength"&&r.Y(ae)&&r.W(ae)||Q.push(new r.V(n,T,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Q.concat(qi({key:u.key,value:T,valueSpec:G,style:d,styleSpec:b,expressionContext:"property",propertyType:t,propertyKey:I}))}function ra(u){return Kr(u,"paint")}function dl(u){return Kr(u,"layout")}function Zs(u){let t=[];const n=u.value,d=u.key,y=u.style,b=u.styleSpec;n.type||n.ref||t.push(new r.V(d,n,'either "type" or "ref" is required'));let T=r.K(n.type);const I=r.K(n.ref);if(n.id){const F=r.K(n.id);for(let V=0;V<u.arrayIndex;V++){const j=y.layers[V];r.K(j.id)===F&&t.push(new r.V(d,n.id,`duplicate layer id "${n.id}", previously used at line ${j.id.__line__}`))}}if("ref"in n){let F;["type","source","source-layer","filter","layout"].forEach(V=>{V in n&&t.push(new r.V(d,n[V],`"${V}" is prohibited for ref layers`))}),y.layers.forEach(V=>{r.K(V.id)===I&&(F=V)}),F?F.ref?t.push(new r.V(d,n.ref,"ref cannot reference another ref layer")):T=r.K(F.type):typeof I=="string"&&t.push(new r.V(d,n.ref,`ref layer "${I}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(n.source){const F=y.sources&&y.sources[n.source],V=F&&r.K(F.type);F?V==="vector"&&T==="raster"?t.push(new r.V(d,n.source,`layer "${n.id}" requires a raster source`)):V==="raster"&&T!=="raster"?t.push(new r.V(d,n.source,`layer "${n.id}" requires a vector source`)):V!=="vector"||n["source-layer"]?V==="raster-dem"&&T!=="hillshade"?t.push(new r.V(d,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):V!=="raster-array"||["raster","raster-particle"].includes(T)?T!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||V==="geojson"&&F.lineMetrics?T==="raster-particle"&&V!=="raster-array"&&t.push(new r.V(d,n.source,`layer "${n.id}" requires a 'raster-array' source.`)):t.push(new r.V(d,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new r.V(d,n.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new r.V(d,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new r.V(d,n.source,`source "${n.source}" not found`))}else t.push(new r.V(d,n,'missing required property "source"'));return t=t.concat(As({key:d,value:n,valueSpec:b.layer,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{"*":()=>[],type:()=>qi({key:`${d}.type`,value:n.type,valueSpec:b.layer.type,style:u.style,styleSpec:u.styleSpec,object:n,objectKey:"type"}),filter:F=>go(r.J({layerType:T},F)),layout:F=>As({layer:n,key:F.key,value:F.value,valueSpec:{},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{"*":V=>dl(r.J({layerType:T},V))}}),paint:F=>As({layer:n,key:F.key,value:F.value,valueSpec:{},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{"*":V=>ra(r.J({layerType:T,layer:n},V))}})}})),t}function Ea(u){const t=u.value,n=u.key,d=r.H(t);return d!=="string"?[new r.V(n,t,`string expected, ${d} found`)]:[]}const $a={promoteId:function u({key:t,value:n}){if(r.H(n)==="string")return Ea({key:t,value:n});if(Array.isArray(n)){const d=[],y=r.Q(n),b=r.U(y);return b.result==="error"&&b.value.forEach(T=>{d.push(new r.V(`${t}${T.key}`,null,`${T.message}`))}),r.X(b.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||d.push(new r.V(`${t}`,null,"promoteId expression should be only feature dependent")),d}{const d=[];for(const y in n)d.push(...u({key:`${t}.${y}`,value:n[y]}));return d}}};function Nc(u){const t=u.value,n=u.key,d=u.styleSpec,y=u.style;if(!t.type)return[new r.V(n,t,'"type" is required')];const b=r.K(t.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&(t.url||t.tiles||T.push(new r.G(n,t,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(As({key:n,value:t,valueSpec:d[`source_${b.replace("-","_")}`],style:u.style,styleSpec:d,objectElementValidators:$a})),T;case"geojson":if(T=As({key:n,value:t,valueSpec:d.source_geojson,style:y,styleSpec:d,objectElementValidators:$a}),t.cluster)for(const I in t.clusterProperties){const[F,V]=t.clusterProperties[I],j=typeof F=="string"?[F,["accumulated"],["get",I]]:F;T.push(...xs({key:`${n}.${I}.map`,value:V,expressionContext:"cluster-map"})),T.push(...xs({key:`${n}.${I}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return T;case"video":return As({key:n,value:t,valueSpec:d.source_video,style:y,styleSpec:d});case"image":return As({key:n,value:t,valueSpec:d.source_image,style:y,styleSpec:d});case"canvas":return[new r.V(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xr({key:`${n}.type`,value:t.type,valueSpec:{values:Vc(d)}})}}function Vc(u){return u.source.reduce((t,n)=>{const d=u[n];return d.type.type==="enum"&&(t=t.concat(Object.keys(d.type.values))),t},[])}function ro(u){const t=u.value,n=u.styleSpec,d=n.light,y=u.style;let b=[];const T=r.H(t);if(t===void 0)return b;if(T!=="object")return b=b.concat([new r.V("light",t,`object expected, ${T} found`)]),b;for(const I in t){const F=I.match(/^(.*)-transition$/),V=I.match(/^(.*)-use-theme$/);b=b.concat(V&&d[V[1]]?qi({key:I,value:t[I],valueSpec:{type:"string"},style:y,styleSpec:n}):F&&d[F[1]]&&d[F[1]].transition?qi({key:I,value:t[I],valueSpec:n.transition,style:y,styleSpec:n}):d[I]?qi({key:I,value:t[I],valueSpec:d[I],style:y,styleSpec:n}):[new r.V(I,t[I],`unknown property "${I}"`)])}return b}function na(u){const t=u.value;let n=[];if(!t)return n;const d=r.H(t);if(d!=="object")return n=n.concat([new r.V("light-3d",t,`object expected, ${d} found`)]),n;const y=u.styleSpec,b=y["light-3d"],T=u.key,I=u.style,F=u.style.lights;for(const G of["type","id"])if(!(G in t))return n=n.concat([new r.V("light-3d",t,`missing property ${G} on light`)]),n;if(t.type&&F)for(let G=0;G<u.arrayIndex;G++){const q=r.K(t.type),Q=F[G];r.K(Q.type)===q&&n.push(new r.V(T,t.id,`duplicate light type "${t.type}", previously defined at line ${Q.id.__line__}`))}const V=`properties_light_${t.type}`;if(!(V in y))return n=n.concat([new r.V("light-3d",t,`Invalid light type ${t.type}`)]),n;const j=y[V];for(const G in t)if(G==="properties"){const q=t[G],Q=r.H(q);if(Q!=="object")return n=n.concat([new r.V("properties",q,`object expected, ${Q} found`)]),n;for(const ce in q)n=n.concat(j[ce]?qi({key:ce,value:q[ce],valueSpec:j[ce],style:I,styleSpec:y}):[new r.G(u.key,q[ce],`unknown property "${ce}"`)])}else{const q=G.match(/^(.*)-transition$/),Q=G.match(/^(.*)-use-theme$/);n=n.concat(Q&&b[Q[1]]?qi({key:G,value:t[G],valueSpec:{type:"string"},style:I,styleSpec:y}):q&&b[q[1]]&&b[q[1]].transition?qi({key:G,value:t[G],valueSpec:y.transition,style:I,styleSpec:y}):b[G]?qi({key:G,value:t[G],valueSpec:b[G],style:I,styleSpec:y}):[new r.G(G,t[G],`unknown property "${G}"`)])}return n}function pl(u){const t=u.value,n=u.key,d=u.style,y=u.styleSpec,b=y.terrain;let T=[];const I=r.H(t);if(t===void 0||I==="null")return T;if(I!=="object")return T=T.concat([new r.V("terrain",t,`object expected, ${I} found`)]),T;for(const F in t){const V=F.match(/^(.*)-transition$/),j=F.match(/^(.*)-use-theme$/);T=T.concat(j&&b[j[1]]?qi({key:F,value:t[F],valueSpec:{type:"string"},style:d,styleSpec:y}):V&&b[V[1]]&&b[V[1]].transition?qi({key:F,value:t[F],valueSpec:y.transition,style:d,styleSpec:y}):b[F]?qi({key:F,value:t[F],valueSpec:b[F],style:d,styleSpec:y}):[new r.G(F,t[F],`unknown property "${F}"`)])}if(t.source){const F=d.sources&&d.sources[t.source],V=F&&r.K(F.type);F?V!=="raster-dem"&&T.push(new r.V(n,t.source,`terrain cannot be used with a source of type ${String(V)}, it only be used with a "raster-dem" source type`)):T.push(new r.V(n,t.source,`source "${t.source}" not found`))}else T.push(new r.V(n,t,'terrain is missing required property "source"'));return T}function zn(u){const t=u.value,n=u.style,d=u.styleSpec,y=d.fog;let b=[];const T=r.H(t);if(t===void 0)return b;if(T!=="object")return b=b.concat([new r.V("fog",t,`object expected, ${T} found`)]),b;for(const I in t){const F=I.match(/^(.*)-transition$/),V=I.match(/^(.*)-use-theme$/);b=b.concat(V&&y[V[1]]?qi({key:I,value:t[I],valueSpec:{type:"string"},style:n,styleSpec:d}):F&&y[F[1]]&&y[F[1]].transition?qi({key:I,value:t[I],valueSpec:d.transition,style:n,styleSpec:d}):y[I]?qi({key:I,value:t[I],valueSpec:y[I],style:n,styleSpec:d}):[new r.G(I,t[I],`unknown property "${I}"`)])}return b}const Aa={"*":()=>[],array:mo,boolean:function(u){const t=u.value,n=u.key,d=r.H(t);return d!=="boolean"?[new r.V(n,t,`boolean expected, ${d} found`)]:[]},number:rr,color:function(u){const t=u.key,n=u.value,d=r.H(n);return d!=="string"?[new r.V(t,n,`color expected, ${d} found`)]:r._.parseCSSColor(n)===null?[new r.V(t,n,`color expected, "${n}" found`)]:[]},enum:xr,filter:go,function:$n,layer:Zs,object:As,source:Nc,model:r.a2,light:ro,"light-3d":na,terrain:pl,fog:zn,string:Ea,formatted:function(u){return Ea(u).length===0?[]:xs(u)},resolvedImage:function(u){return Ea(u).length===0?[]:xs(u)},projection:function(u){const t=u.value,n=u.styleSpec,d=n.projection,y=u.style;let b=[];const T=r.H(t);if(T==="object")for(const I in t)b=b.concat(qi({key:I,value:t[I],valueSpec:d[I],style:y,styleSpec:n}));else T!=="string"&&(b=b.concat([new r.V("projection",t,`object or string expected, ${T} found`)]));return b},import:function(u){const{value:t,styleSpec:n}=u,{data:d,...y}=t;Object.defineProperty(y,"__line__",{value:t.__line__,enumerable:!1});let b=As(r.J({},u,{value:y,valueSpec:n.import}));return r.K(y.id)===""&&b.push(new r.V(`${u.key}.id`,y,"import id can't be an empty string")),d&&(b=b.concat($u(d,n,{key:`${u.key}.data`}))),b}};function qi(u,t=!1){const n=u.value,d=u.valueSpec,y=u.styleSpec;if(d.expression&&r.a0(r.K(n)))return $n(u);if(d.expression&&r.O(r.Q(n)))return xs(u);if(d.type&&Aa[d.type]){const b=Aa[d.type](u);return t===!0&&b.length>0&&r.H(u.value)==="array"?xs(u):b}return As(r.J({},u,{valueSpec:d.type?y[d.type]:d}))}function Fn(u){const t=u.value,n=u.key,d=Ea(u);return d.length||(t.indexOf("{fontstack}")===-1&&d.push(new r.V(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&d.push(new r.V(n,t,'"glyphs" url must include a "{range}" token'))),d}function $u(u,t=r.a3,n={}){return qi({key:n.key||"",value:u,valueSpec:t.$root,styleSpec:t,style:u,objectElementValidators:{glyphs:Fn,"*":()=>[]}})}function Jr(u,t=r.a3){return Ds($u(u,t))}const Pa=u=>Ds(Nc(u)),Uc=u=>Ds(ro(u)),fl=u=>Ds(na(u)),jc=u=>Ds(pl(u)),Ps=u=>Ds(zn(u)),$c=u=>Ds(function(t){const n=t.value,d=t.style,y=t.styleSpec,b=y.snow;let T=[];const I=r.H(n);if(n===void 0)return T;if(I!=="object")return T=T.concat([new r.V("snow",n,`object expected, ${I} found`)]),T;for(const F in n){const V=F.match(/^(.*)-transition$/);T=T.concat(V&&b[V[1]]&&b[V[1]].transition?qi({key:F,value:n[F],valueSpec:y.transition,style:d,styleSpec:y}):b[F]?qi({key:F,value:n[F],valueSpec:b[F],style:d,styleSpec:y}):[new r.G(F,n[F],`unknown property "${F}"`)])}return T}(u)),zh=u=>Ds(function(t){const n=t.value,d=t.style,y=t.styleSpec,b=y.rain;let T=[];const I=r.H(n);if(n===void 0)return T;if(I!=="object")return T=T.concat([new r.V("rain",n,`object expected, ${I} found`)]),T;for(const F in n){const V=F.match(/^(.*)-transition$/);T=T.concat(V&&b[V[1]]&&b[V[1]].transition?qi({key:F,value:n[F],valueSpec:y.transition,style:d,styleSpec:y}):b[F]?qi({key:F,value:n[F],valueSpec:b[F],style:d,styleSpec:y}):[new r.G(F,n[F],`unknown property "${F}"`)])}return T}(u)),Fh=u=>Ds(Zs(u)),ts=u=>Ds(go(u)),Jl=u=>Ds(ra(u)),Hu=u=>Ds(dl(u)),Gu=u=>Ds(r.a2(u));function Ds(u){return u.slice().sort((t,n)=>t.line&&n.line?t.line-n.line:0)}function Go(u,t){let n=!1;if(t&&t.length)for(const d of t)d instanceof r.G?r.w(d.message):(u.fire(new r.y(new Error(d.message))),n=!0);return n}let vt;class se extends r.E{constructor(t,n="flat"){super(),this._transitionable=new r.a4(vt||(vt=new r.a5({anchor:new r.a6(r.a3.light.anchor),position:new r.a7(r.a3.light.position),color:new r.a6(r.a3.light.color),intensity:new r.a6(r.a3.light.intensity)}))),this.setLight(t,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n,d={}){this._validate(Uc,t,d)||(this._transitionable.setTransitionOrValue(t),this.id=n)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,d){return(!d||d.validate!==!1)&&Go(this,t.call(Jr,r.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}}let me=class extends r.E{constructor(u,t,n,d){super(),this.scope=n,this._transitionable=new r.a4(new r.a5({source:new r.a6(r.a3.terrain.source),exaggeration:new r.a6(r.a3.terrain.exaggeration)}),n,d),this._transitionable.setTransitionOrValue(u,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(u,t){this._transitionable.setTransitionOrValue(u,t)}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}getExaggeration(u){return this._transitioning.possiblyEvaluate(new r.a8(u)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const u=this._transitionable._values.exaggeration;if(!u)return null;const t=u.value.expression;if(!t)return null;let n=-1,d=-1,y=1;for(const b of t.zoomStops)y=t.evaluate(new r.a8(b)),y>.01?(n=b,d=-1):d=b;return y<.01&&n>0&&d>n?[n,d]:null}isZoomDependent(){const u=this._transitionable._values.exaggeration;return u!=null&&u.value!=null&&u.value.expression!=null&&u.value.expression instanceof r.a9}};const we=45,Be=65,je=.05;function Ke(u,t,n,d){const y=r.ac(we,Be,n),[b,T]=lt(u,d);let I=1-Math.min(1,Math.exp((t-b)/(T-b)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*y*u.alpha}function lt(u,t){const n=.5/Math.tan(.5*t);return[u.range[0]+n,u.range[1]+n]}function Je(u,t,n,d,y){const b=r.ab.vec3.transformMat4([],[t,n,d],y.mercatorFogMatrix);return Ke(u,r.ab.vec3.length(b),y.pitch,y._fov)}function mt(u,t,n,d,y,b,T){const I=[[n,d,0],[y,d,0],[y,b,0],[n,b,0]];let F=Number.MAX_VALUE,V=-Number.MAX_VALUE;for(const j of I){const G=r.ab.vec3.transformMat4([],j,t),q=r.ab.vec3.length(G);F=Math.min(F,q),V=Math.max(V,q)}return[Ke(u,F,T.pitch,T._fov),Ke(u,V,T.pitch,T._fov)]}class pt extends r.E{constructor(t,n,d,y){super();const b=new r.a5({range:new r.a6(r.a3.fog.range),color:new r.a6(r.a3.fog.color),"color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.a6(r.a3.fog["high-color"]),"high-color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.a6(r.a3.fog["space-color"]),"space-color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.a6(r.a3.fog["horizon-blend"]),"star-intensity":new r.a6(r.a3.fog["star-intensity"]),"vertical-range":new r.a6(r.a3.fog["vertical-range"])});this._transitionable=new r.a4(b,d,new Map(y)),this.set(t,y),this._transitioning=this._transitionable.untransitioned(),this._transform=n,this.properties=new r.ad(b),this.scope=d}get state(){const t=this._transform,n=t.projection.name==="globe",d=r.ae(t.zoom),y=this.properties.get("range"),b=[.5,3];return{range:n?[r.af(b[0],y[0],d),r.af(b[1],y[1],d)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,n,d={}){if(this._validate(Ps,t,d))return;const y=r.l({},t);for(const b of Object.keys(r.a3.fog))y[b]===void 0&&(y[b]=r.a3.fog[b].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,n)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ac(we,Be,t))*n.a}getOpacityAtLatLng(t,n){return this._transform.projection.supportsFog?function(d,y,b){const T=r.aa.fromLngLat(y),I=b.elevation?b.elevation.getAtPointOrZero(T):0;return Je(d,T.x,T.y,I,b)}(this.state,t,n):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(t.toUnwrapped());return mt(this.state,n,0,0,r.ag,r.ag,this._transform)}getOpacityForBounds(t,n,d,y,b){return this._transform.projection.supportsFog?mt(this.state,t,n,d,y,b,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?lt(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const d of n){const y=t.points[d];let b;if(y[2]>=0)b=y;else{const T=t.points[d-4];b=r.ah(T,y,T[2]/(T[2]-y[2]))}if(Je(this.state,b[0],b[1],0,this._transform)>=je)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,d){return(!d||d.validate!==!1)&&Go(this,t.call(Jr,r.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}}let yt,Rt,Zt,Jt,fi=class extends r.E{constructor(u,t,n,d){super();const y=yt||(yt=new r.a5({density:new r.a6(r.a3.snow.density),intensity:new r.a6(r.a3.snow.intensity),color:new r.a6(r.a3.snow.color),opacity:new r.a6(r.a3.snow.opacity),vignette:new r.a6(r.a3.snow.vignette),"vignette-color":new r.a6(r.a3.snow["vignette-color"]),"center-thinning":new r.a6(r.a3.snow["center-thinning"]),direction:new r.a6(r.a3.snow.direction),"flake-size":new r.a6(r.a3.snow["flake-size"])}));this._transitionable=new r.a4(y,n,new Map(d)),this.set(u,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ad(y),this.scope=n}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),n=this.properties.get("direction"),d=r.ai(n[0]),y=-Math.max(r.ai(n[1]),.01),b=[Math.cos(d)*Math.cos(y),Math.sin(d)*Math.cos(y),Math.sin(y)],T=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.aj(t.r,t.g,t.b,t.a*u),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(u,t,n={}){if(this._validate($c,u,n))return;const d=r.l({},u);for(const y of Object.keys(r.a3.snow))d[y]===void 0&&(d[y]=r.a3.snow[y].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,n){return(!n||n.validate!==!1)&&Go(this,u.call(Jr,r.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}},Ii=class extends r.E{constructor(u,t,n,d){super();const y=Rt||(Rt=new r.a5({density:new r.a6(r.a3.rain.density),intensity:new r.a6(r.a3.rain.intensity),color:new r.a6(r.a3.rain.color),opacity:new r.a6(r.a3.rain.opacity),vignette:new r.a6(r.a3.rain.vignette),"vignette-color":new r.a6(r.a3.rain["vignette-color"]),"center-thinning":new r.a6(r.a3.rain["center-thinning"]),direction:new r.a6(r.a3.rain.direction),"droplet-size":new r.a6(r.a3.rain["droplet-size"]),"distortion-strength":new r.a6(r.a3.rain["distortion-strength"])}));this._transitionable=new r.a4(y,n,new Map(d)),this.set(u,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ad(y),this.scope=n}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),n=this.properties.get("direction"),d=r.ai(n[0]),y=-Math.max(r.ai(n[1]),.01),b=[Math.cos(d)*Math.cos(y),Math.sin(d)*Math.cos(y),Math.sin(y)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.aj(t.r,t.g,t.b,t.a*u),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(u,t,n={}){if(this._validate(zh,u,n))return;const d=r.l({},u);for(const y of Object.keys(r.a3.rain))d[y]===void 0&&(d[y]=r.a3.rain[y].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,n){return(!n||n.validate!==!1)&&Go(this,u.call(Jr,r.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}};class ki extends r.E{constructor(t,n,d,y){super(),this.scope=d,this._options=t,this.properties=new r.ad(n),this._transitionable=new r.a4(n,d,new Map(y)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,n){this._options=t,this._transitionable.setTransitionOrValue(t.properties,n)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Pi{constructor(t,n,d,y){this.screenBounds=t,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(t,n){let d,y;if(t instanceof r.P||typeof t[0]=="number"){const b=r.P.convert(t);d=[b],y=n.isPointAboveHorizon(b)}else{const b=r.P.convert(t[0]),T=r.P.convert(t[1]);d=[b,T],y=r.al(b,T).every(I=>n.isPointAboveHorizon(I))}return new Pi(d,n.getCameraPoint(),y,n)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return r.al(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],y=r.al(n,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<d.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?y[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(y[3]=this.cameraPoint)),r.am(y,t)}bufferedCameraGeometryGlobe(t){const n=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],y=r.al(n,d,t),b=this.cameraPoint.clone();switch(3*((b.y>n.y)+(b.y>d.y))+((b.x>n.x)+(b.x>d.x))){case 0:y[0]=b,y[4]=b.clone();break;case 1:y.splice(1,0,b);break;case 2:y[1]=b;break;case 3:y.splice(4,0,b);break;case 5:y.splice(2,0,b);break;case 6:y[3]=b;break;case 7:y.splice(3,0,b);break;case 8:y[2]=b}return y}containsTile(t,n,d,y=0){const b=t.queryPadding/n._pixelsPerMercatorPixel+1,T=d?this._bufferedCameraMercator(b,n):this._bufferedScreenMercator(b,n);let I=t.tileID.wrap+(T.unwrapped?y:0);const F=T.polygon.map(de=>r.an(t.tileTransform,de,I));if(!r.ao(F,0,0,r.ag,r.ag))return;I=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const V=this.screenGeometryMercator.polygon.map(de=>r.ap(t.tileTransform,de,I)),j=V.map(de=>new r.P(de[0],de[1])),G=n.getFreeCameraOptions().position||new r.aa(0,0,0),q=r.ap(t.tileTransform,G,I),Q=V.map(de=>{const pe=r.ab.vec3.sub(de,de,q);return r.ab.vec3.normalize(pe,pe),new r.aq(q,pe)}),ce=r.ar(t,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:j,tilespaceRays:Q,bufferedTilespaceGeometry:F,bufferedTilespaceBounds:(ae=r.as(F),ae.min.x=r.aw(ae.min.x,0,r.ag),ae.min.y=r.aw(ae.min.y,0,r.ag),ae.max.x=r.aw(ae.max.x,0,r.ag),ae.max.y=r.aw(ae.max.y,0,r.ag),ae),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:ce};var ae}_bufferedScreenMercator(t,n){const d=sr(t);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let y;return y=n.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),n):{polygon:this.bufferedScreenGeometry(t).map(b=>n.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[d]=y,y}}_bufferedCameraMercator(t,n){const d=sr(t);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let y;return y=n.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),n):{polygon:this.bufferedCameraGeometry(t).map(b=>n.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[d]=y,y}}_projectAndResample(t,n){const d=function(b,T){const I=r.ab.mat4.multiply([],T.pixelMatrix,T.globeMatrix),F=[0,-r.ax,0,1],V=[0,r.ax,0,1],j=[0,0,0,1];r.ab.vec4.transformMat4(F,F,I),r.ab.vec4.transformMat4(V,V,I),r.ab.vec4.transformMat4(j,j,I);const G=new r.P(F[0]/F[3],F[1]/F[3]),q=new r.P(V[0]/V[3],V[1]/V[3]),Q=r.au(b,G)&&F[3]<j[3],ce=r.au(b,q)&&V[3]<j[3];if(!Q&&!ce)return null;const ae=function(Ne,Oe,We){for(let Qe=1;Qe<Ne.length;Qe++){const xt=br(Oe.pointCoordinate3D(Ne[Qe-1]).x),ut=br(Oe.pointCoordinate3D(Ne[Qe]).x);if(We<0){if(xt<ut)return{idx:Qe,t:-xt/(ut-1-xt)}}else if(ut<xt)return{idx:Qe,t:(1-xt)/(ut+1-xt)}}return null}(b,T,Q?-1:1);if(!ae)return null;const{idx:de,t:pe}=ae;let Te=de>1?dr(b.slice(0,de),T):[],ke=de<b.length?dr(b.slice(de),T):[];Te=Te.map(Ne=>new r.P(br(Ne.x),Ne.y)),ke=ke.map(Ne=>new r.P(br(Ne.x),Ne.y));const De=[...Te];De.length===0&&De.push(ke[ke.length-1]);const Ue=r.af(De[De.length-1].y,(ke.length===0?Te[0]:ke[0]).y,pe);let Le;return Le=Q?[new r.P(0,Ue),new r.P(0,0),new r.P(1,0),new r.P(1,Ue)]:[new r.P(1,Ue),new r.P(1,1),new r.P(0,1),new r.P(0,Ue)],De.push(...Le),ke.length===0?De.push(Te[0]):De.push(...ke),{polygon:De.map(Ne=>new r.aa(Ne.x,Ne.y)),unwrapped:!1}}(t,n);if(d)return d;const y=function(b,T){let I=!1,F=-1/0,V=0;for(let G=0;G<b.length-1;G++)b[G].x>F&&(F=b[G].x,V=G);for(let G=0;G<b.length-1;G++){const q=(V+G)%(b.length-1),Q=b[q],ce=b[q+1];Math.abs(Q.x-ce.x)>.5&&(Q.x<ce.x?(Q.x+=1,q===0&&(b[b.length-1].x+=1)):(ce.x+=1,q+1===b.length-1&&(b[0].x+=1)),I=!0)}const j=r.at(T.center.lng);return I&&j<Math.abs(j-1)&&b.forEach(G=>{G.x-=1}),{polygon:b,unwrapped:I}}(dr(t,n).map(b=>new r.P(br(b.x),b.y)),n);return{polygon:y.polygon.map(b=>new r.aa(b.x,b.y)),unwrapped:y.unwrapped}}}function dr(u,t){return r.av(u,n=>{const d=t.pointCoordinate3D(n);n.x=d.x,n.y=d.y},1/256)}function br(u){return u<0?1+u%1:u%1}function sr(u){return 100*u|0}function wr(u,t,n,d,y){const b=function(I,F){if(I)return y(I);if(F){if(u.url&&F.tiles&&u.tiles&&delete u.tiles,F.variants){if(!Array.isArray(F.variants))return y(new Error("variants must be an array"));for(const j of F.variants){if(j==null||typeof j!="object"||j.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(j.capabilities))return y(new Error("capabilities must be an array"));if(j.capabilities.length===1&&j.capabilities[0]==="meshopt"){F=r.l(F,j);break}}}const V=r.ay(r.l({},F,u),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);V.tiles=t.canonicalizeTileset(V,u.url),y(null,V)}},T=function(I,F,V){if(!I)return null;if(!F&&!V)return I;V=V||I.worldview_default;const j=Object.values(I.language||{});if(j.length===0)return null;const G=Object.values(I.worldview||{});if(G.length===0)return null;const q=j.every(ce=>ce===F),Q=G.every(ce=>ce===V);return q&&Q?I:F in(I.language_options||{})||V in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null}(u.data,n,d);return T?r.q.frame(()=>b(null,T)):u.url?r.n(t.transformRequest(t.normalizeSourceURL(u.url,null,n,d),r.R.Source),b):r.q.frame(()=>{const{data:I,...F}=u;b(null,F)})}class Pr{constructor(t,n,d){this.bounds=r.az.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),d=Math.floor(r.at(this.bounds.getWest())*n),y=Math.floor(r.aA(this.bounds.getNorth())*n),b=Math.ceil(r.at(this.bounds.getEast())*n),T=Math.ceil(r.aA(this.bounds.getSouth())*n);return t.x>=d&&t.x<b&&t.y>=y&&t.y<T}}class Bn extends r.E{constructor(t,n,d,y){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.l(this,r.ay(n,["url","scheme","tileSize","promoteId"])),this._options=r.l({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new r.aB}load(t){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=wr(this._options,this.map._requestManager,n,d,(y,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new r.y(y));else if(b){if(r.l(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of b.vector_layers)this.vectorLayerIds.push(T.id),b.worldview&&b.worldview[T.source]&&this.localizableLayerIds.add(T.id)}b.bounds&&(this.tileBounds=new Pr(b.bounds,this.minzoom,this.maxzoom)),Wi(b.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(y)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}loadTile(t,n){const d=t.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(d),b=this.map._requestManager.transformRequest(y,r.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,I=T?{image:T.image.clone()}:null,F={request:b,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&r.f(d)&&(F.worldview=this.map.getWorldview()||this.worldviewDefault,F.localizableLayerIds=this.localizableLayerIds),F.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",F,V.bind(this));else if(t.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",F,V.bind(this),void 0,!0);else{const j=r.aD.call({deduped:this._deduped},F,(G,q)=>{G||!q?V.call(this,G):(F.data={cacheControl:q.cacheControl,expires:q.expires,rawData:q.rawData.slice(0)},t.actor&&t.actor.send("loadTile",F,V.bind(this),void 0,!0))},!0);t.request={cancel:j}}function V(j,G){return delete t.request,t.aborted?n(null):j&&j.status!==404?n(j):(G&&G.resourceTiming&&(t.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&t.setExpiryData(G),t.loadVectorData(G,this.map.painter),r.aE(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,n){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Da extends r.E{constructor(t,n,d,y){super(),this.id=t,this.dispatcher=d,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.l({type:"raster"},n),r.l(this,r.ay(n,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._tileJSONRequest=wr(this._options,this.map._requestManager,null,null,(n,d)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new r.y(n)):d&&(r.l(this,d),d.raster_layers&&(this.rasterLayers=d.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),d.bounds&&(this.tileBounds=new Pr(d.bounds,this.minzoom,this.maxzoom)),Wi(d.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const d=r.q.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);t.request=r.o(this.map._requestManager.transformRequest(y,r.R.Tile),(b,T,I,F)=>(delete t.request,t.aborted?(t.state="unloaded",n(null)):b?(t.state="errored",n(b)):T?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:I,expires:F}),t.setTexture(T,this.map.painter),t.state="loaded",r.aE(this.dispatcher),void n(null)):n(null)))}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n&&n()}unloadTile(t,n){t.texture&&t.texture instanceof r.T?(t.destroy(!0),t.texture&&t.texture instanceof r.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),n&&n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class is extends Da{constructor(t,n,d,y){super(t,n,d,y),this.type="raster-array",this.maxzoom=22,this._options=r.l({type:"raster-array"},n)}triggerRepaint(t){const n=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);n&&n.enabled&&d&&n._clearRenderCacheForTile(d.id,t.tileID),this.map.triggerRepaint()}loadTile(t,n){const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(d,r.R.Tile);t.requestParams=y,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,(b,T,I,F)=>{if(delete t.request,t.aborted)return t.state="unloaded",n(null);if(b)return b.code===20?void 0:(t.state="errored",n(b));this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:I,expires:F}),t.state="empty",n(null)})}unloadTile(t,n){const d=t.texture;d&&d instanceof r.T?(t.destroy(!0),this.map.painter.saveTileTexture(d)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,n,d){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(n,d,(y,b)=>{if(y)return t.state="errored",this.fire(new r.y(y)),void this.triggerRepaint(t);b&&(t.setTexture(b,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const n=this.rasterLayers.find(({id:b})=>b===t),d=n&&n.fields,y=d&&d.bands&&d.bands;return y?y[0]:0}getTextureDescriptor(t,n,d){if(!t)return;const y=n.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let b=null;n instanceof r.aH?b=n.paint.get("raster-array-band"):n instanceof r.aI&&(b=n.paint.get("raster-particle-array-band"));const T=b||this.getInitialBand(y);if(T!=null)if(t.textureDescriptor){if(!t.updateNeeded(y,T)||d)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,y,T)}}const Nn={vector:Bn,raster:Da,"raster-dem":class extends Da{constructor(u,t,n,d){super(u,t,n,d),this.type="raster-dem",this.maxzoom=22,this._options=r.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(u,t){const n=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(y,b){y&&(u.state="errored",t(y)),b&&(u.dem=b,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",t(null))}u.request=r.o(this.map._requestManager.transformRequest(n,r.R.Tile),(function(y,b,T,I){if(delete u.request,u.aborted)u.state="unloaded",t(null);else if(y)u.state="errored",t(y);else if(b){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:T,expires:I});const F=ImageBitmap&&b instanceof ImageBitmap&&r.t(),V=1-(b.width-r.aF(b.width))/2;V<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const j=F?b:r.q.getImageData(b,V),G={uid:u.uid,coord:u.tileID,source:this.id,scope:this.scope,rawImageData:j,encoding:this.encoding,padding:V};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",G,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(u){const t=u.canonical,n=Math.pow(2,t.z),d=(t.x-1+n)%n,y=t.x===0?u.wrap-1:u.wrap,b=(t.x+1+n)%n,T=t.x+1===n?u.wrap+1:u.wrap,I={};return I[new r.aG(u.overscaledZ,y,t.z,d,t.y).key]={backfilled:!1},I[new r.aG(u.overscaledZ,T,t.z,b,t.y).key]={backfilled:!1},t.y>0&&(I[new r.aG(u.overscaledZ,y,t.z,d,t.y-1).key]={backfilled:!1},I[new r.aG(u.overscaledZ,u.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},I[new r.aG(u.overscaledZ,T,t.z,b,t.y-1).key]={backfilled:!1}),t.y+1<n&&(I[new r.aG(u.overscaledZ,y,t.z,d,t.y+1).key]={backfilled:!1},I[new r.aG(u.overscaledZ,u.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},I[new r.aG(u.overscaledZ,T,t.z,b,t.y+1).key]={backfilled:!1}),I}},"raster-array":is,geojson:class extends r.E{constructor(u,t,n,d){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(d),this._data=t.data,this._options=r.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const y=r.ag/this.tileSize;this.workerOptions=r.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*y,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*y,extent:r.ag,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:r.ag,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*y,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}updateData(u){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof u!="string"&&(u.type==="Feature"&&(u={type:"FeatureCollection",features:[u]}),u.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof u!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const n of this._data.features)t.set(n.id,n);for(const n of u.features)t.set(n.id,n);this._data.features=[...t.values()]}else this._data=u;return this._updateWorkerData(!0),this}getClusterExpansionZoom(u,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterChildren(u,t){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterLeaves(u,t,n,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:u,limit:t,offset:n},d),this}_updateWorkerData(u=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=r.l({append:u},this.workerOptions);t.scope=this.scope;const n=this._data;typeof n=="string"?(t.request=this.map._requestManager.transformRequest(r.q.resolveURL(n),r.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(d,y)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new r.y(d));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(b.resourceTiming=y.resourceTiming[this.id]),u&&(this._partialReload=!0),this.fire(new r.z("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(u),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const u=r.aC(this.id,this.scope);this.map.style.clearSource(u),this._updateWorkerData()}loadTile(u,t){const n=u.actor?"reloadTile":"loadTile";u.actor=this.actor;const d=this.map.style?this.map.style.getLut(this.scope):null,y=d?{image:d.image.clone()}:null,b=this._partialReload,T={type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:b};u.request=this.actor.send(n,T,(I,F)=>b&&!F?(u.state="loaded",t(null)):(delete u.request,u.destroy(),u.aborted?t(null):I?t(I):(u.loadVectorData(F,this.map.painter,n==="reloadTile"),t(null))),void 0,n==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u,t){this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope}),u.destroy()}onRemove(u){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aJ{constructor(u,t,n,d){super(u,t,n,d),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const t of u.urls)this.urls.push(this.map._requestManager.transformRequest(t,r.R.Source).url);r.aK(this.urls,(t,n)=>{this._loaded=!0,t?this.fire(new r.y(t)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const t=this.video.seekable;u<t.start(0)||u>t.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,t=u.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(u,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aJ,model:class extends r.E{constructor(u,t,n,d){super(),this.id=u,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const u=[];for(const t in this._options.models){const n=this._options.models[t],d=r.aM(this.map._requestManager.transformRequest(n.uri,r.R.Model).url).then(y=>{if(!y)return;const b=r.aN(y),T=new r.aO(t,n.position,n.orientation,b);T.computeBoundsAndApplyParent(),this.models.push(T)}).catch(y=>{this.fire(new r.y(new Error(`Could not load model ${t} from ${n.uri}: ${y.message}`)))});u.push(d)}return Promise.allSettled(u).then(()=>{this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new r.y(new Error(`Could not load models: ${t.message}`)))})}onAdd(u){this.map=u,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(u,t){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(u,t,n,d){super(),this.type="batched-model",this.id=u,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest();const u=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(u))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(u){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=wr(this._options,this.map._requestManager,t,n,(d,y)=>{this._tileJSONRequest=null,this._loaded=!0,d?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),n&&n.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new r.y(d))):y&&(r.l(this,y),y.bounds&&(this.tileBounds=new Pr(y.bounds,this.minzoom,this.maxzoom)),Wi(y.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),u&&u(d)})}hasTransition(){return!1}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loaded(){return this._loaded}loadTile(u,t){const n=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(n,r.R.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:u.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(u.actor&&u.state!=="expired")if(u.state==="loading")u.reloadCallback=t;else{if(u.buckets){const b=Object.values(u.buckets);for(const T of b)T.dirty=!0;return void(u.state="loaded")}u.request=u.actor.send("reloadTile",d,y.bind(this))}else u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",d,y.bind(this),void 0,!0);function y(b,T){return u.aborted?t(null):b&&b.status!==404?t(b):(this.map._refreshExpiredTiles&&T&&u.setExpiryData(T),u.loadModelData(T,this.map.painter),u.state="loaded",void t(null))}}serialize(){return r.l({},this._options)}},canvas:class extends r.aJ{constructor(u,t,n,d){super(u,t,n,d),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(b=>typeof b!="number"))||this.fire(new r.y(new r.V(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${u}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${u}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(u){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!u&&!this._playing||this.texture instanceof r.aL||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends r.E{constructor(u,t,n,d){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=t,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Pr(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),r.l(this,r.ay(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ay(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this.map=u,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:t,y:n,z:d}=u.canonical;return this._implementation.hasTile({x:t,y:n,z:d})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,t){const{x:n,y:d,z:y}=u.tileID.canonical,b=new AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:n,y:d,z:y},{signal:b.signal})).then((function(T){return delete u.request,u.aborted?(u.state="unloaded",t(null)):T===void 0?(u.state="errored",t(null)):T===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",t(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(T)?(this.loadTileData(u,T),u.state="loaded",void t(null)):(u.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.code!==20&&(u.state="errored",t(T))}),u.request.cancel=()=>b.abort()}loadTileData(u,t){u.setTexture(t,this.map.painter)}unloadTile(u,t){if(u.texture&&u.texture instanceof r.T?(u.destroy(!0),u.texture&&u.texture instanceof r.T&&this.map.painter.saveTileTexture(u.texture)):u.destroy(),this._implementation.unloadTile){const{x:n,y:d,z:y}=u.tileID.canonical;this._implementation.unloadTile({x:n,y:d,z:y})}t&&t()}abortTile(u,t){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){const u=r.aC(this.id,this.scope);this.map.style.clearSource(u)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},$s=function(u,t,n,d){const y=new Nn[t.type](u,t,n,d);if(y.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${y.id}`);return r.aP(["load","abort","unload","serialize","prepare"],y),y};function Hc(u,t,n=""){return`${n}:${t.id||""}:${t.layer.id}:${function(d){if("layerId"in d)return`layer:${d.layerId}`;{const{featuresetId:y,importId:b}=d;return`featureset:${y}${b?`:import:${b}`:""}`}}(u.target)}`}function Wo(u,t,n,d=""){if(u.uniqueFeatureID){const y=Hc(u,t,d);if(n.has(y))return!0;n.add(y)}return!1}function Gc(u,t,n,d,y=!1){const b=t.sourceCache.transform,T=t.sourceCache.tilesIn(u,t.has3DLayers,y);T.sort(Gd);const I=[];for(const F of T){const V=F.tile.queryRenderedFeatures(t,F,n,d,b,y);Object.keys(V).length&&I.push({wrappedTileID:F.tile.tileID.wrapped().key,queryResults:V})}return I.length===0?{}:function(F){const V={},j={};for(const G of F){const q=G.queryResults,Q=G.wrappedTileID,ce=j[Q]=j[Q]||{};for(const ae in q){const de=q[ae],pe=ce[ae]=ce[ae]||{},Te=V[ae]=V[ae]||[];for(const ke of de)pe[ke.featureIndex]||(pe[ke.featureIndex]=!0,Te.push(ke))}}return V}(I)}function Po(u,t,n,d,y){const b={},T=d.queryRenderedSymbols(u),I=[];for(const F of Object.keys(T).map(Number))I.push(y[F]);I.sort(Gd);for(const F of I){const V=F.featureIndex.lookupSymbolFeatures(T[F.bucketInstanceId],F.bucketIndex,F.sourceLayerIndex,t,n);for(const j in V){const G=b[j]=b[j]||[],q=V[j];q.sort((Q,ce)=>{const ae=F.featureSortOrder;if(ae){const de=ae.indexOf(Q.featureIndex);return ae.indexOf(ce.featureIndex)-de}return ce.featureIndex-Q.featureIndex});for(const Q of q)G.push(Q)}}return b}function Wc(u,t){const n=u.getRenderableIds().map(b=>u.getTileByID(b)),d=[],y={};for(let b=0;b<n.length;b++){const T=n[b],I=T.tileID.canonical.key;y[I]||(y[I]=!0,T.querySourceFeatures(d,t))}return d}function Gd(u,t){const n=u.tileID,d=t.tileID;return n.overscaledZ-d.overscaledZ||n.canonical.y-d.canonical.y||n.wrap-d.wrap||n.canonical.x-d.canonical.x}function Wd(u,t){const n={};if(!t)return n;for(const d of u){const y=d.layerIds.map(b=>t.getLayer(b)).filter(Boolean);if(y.length!==0){d.layers=y,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(b=>y.filter(T=>T.id===b)[0]));for(const b of y)n[b.fqid]=d}}return n}const Ks=32,Do=33,qo=new Uint16Array(8184);for(let u=0;u<2046;u++){let t=u+2,n=0,d=0,y=0,b=0,T=0,I=0;for(1&t?y=b=T=Ks:n=d=I=Ks;(t>>=1)>1;){const V=n+y>>1,j=d+b>>1;1&t?(y=n,b=d,n=T,d=I):(n=y,d=b,y=T,b=I),T=V,I=j}const F=4*u;qo[F+0]=n,qo[F+1]=d,qo[F+2]=y,qo[F+3]=b}const Ia=new Uint16Array(2178),sa=new Uint8Array(1089),oa=new Uint16Array(1089);function Wu(u){return u===0?-.03125:u===32?.03125:0}const ml={type:2,extent:r.ag,loadGeometry:()=>[[new r.P(0,0),new r.P(r.ag+1,0),new r.P(r.ag+1,r.ag+1),new r.P(0,r.ag+1),new r.P(0,0)]]};class gl{constructor(t,n,d,y,b){this.tileID=t,this.uid=r.aV(),this.uses=0,this.tileSize=n,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection)}registerFadeDuration(t){const n=t+this.timeAdded;n<r.q.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aQ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,d){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Wd(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const b=this.buckets[y];if(b instanceof r.aX){if(this.hasSymbolBuckets=!0,!d)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const b=this.buckets[y];if(b instanceof r.aX&&b.hasRTLText){this.hasRTLText=!0,r.aY();break}}this.queryPadding=0;for(const y in this.buckets){const b=this.buckets[y],T=n.style.getOwnLayer(y);if(!T)continue;const I=T.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,I)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new r.aW}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,n,d){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Wd(t.buckets,n.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const y in this.buckets){const b=this.buckets[y];b.uploadPending()&&b.upload(t)}const n=t.gl,d=this.imageAtlas;if(d&&!d.uploaded){const y=!!Object.keys(d.patternPositions).length;this.imageAtlasTexture=new r.T(t,d.image,n.RGBA8,{useMipmap:y}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(t,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(t,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(t,n,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,d),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=n.style.getBrightness();(this._lastUpdatedBrightness||y)&&(this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(n,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}queryRenderedFeatures(t,n,d,y,b,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const I=function(F,V){const j=r.ab.mat4.fromScaling([],[.5*F.width,.5*-F.height,1]);return r.ab.mat4.translate(j,j,[1,-1,0]),r.ab.mat4.multiply(j,j,F.calculateProjMatrix(V.toUnwrapped())),Float32Array.from(j)}(b,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:n,pixelPosMatrix:I,transform:y,availableImages:d,tileTransform:this.tileTransform})}querySourceFeatures(t,n){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const y=d.loadVTLayers(),b=n?n.sourceLayer:"",T=y._geojsonTileLayer||y[b];if(!T)return;const I=r.aZ(n&&n.filter),{z:F,x:V,y:j}=this.tileID.canonical,G={z:F,x:V,y:j};for(let q=0;q<T.length;q++){const Q=T.feature(q);if(I.needGeometry){const de=r.a_(Q,!0);if(!I.filter(new r.a8(this.tileID.overscaledZ),de,this.tileID.canonical))continue}else if(!I.filter(new r.a8(this.tileID.overscaledZ),Q))continue;const ce=d.getId(Q,b),ae=new r.a$(Q,F,V,j,ce);ae.tile=G,t.push(ae)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const d=r.b0(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const d=Date.now();let y=!1;if(this.expirationTime>d)y=!1;else if(n)if(this.expirationTime<n)y=!0;else{const b=this.expirationTime-n;b?this.expirationTime=d+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,n){if(!this.latestFeatureIndex||!t.style)return;const d=this.latestFeatureIndex.loadVTLayers(),y=t.style.listImages(),b=t.style.getBrightness();for(const T in this.buckets){if(!t.style.hasLayer(T))continue;const I=this.buckets[T],F=I.layers[0],V=F.sourceLayer||"_geojsonTileLayer",j=d[V],G=t.style.getLayerSourceCache(F);let q={};G&&(q=G._state.getState(V,void 0));const Q=this.imageAtlas&&this.imageAtlas.patternPositions||{},ce=Object.keys(q).length>0&&!n;ce&&!I.stateDependentLayers.length&&!n||I.update(q,j,y,Q,ce?I.stateDependentLayers:I.layers,n,b),(I instanceof r.b1||I instanceof r.b2)&&t._terrain&&t._terrain.enabled&&G&&I.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(G.id,this.tileID);const ae=t&&t.style&&t.style.getOwnLayer(T);ae&&(this.queryPadding=Math.max(this.queryPadding,ae.queryRadius(I)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=r.q.now()+t}setTexture(t,n){const d=n.context,y=d.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t):(this.texture=new r.T(d,t,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(t,n){const d={};for(const y of n)d[y]=!0;this.dependencies[t]=d}hasDependency(t,n){for(const d of t){const y=this.dependencies[d];if(y){for(const b of n)if(y[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const d=r.b3(ml,this.tileID.canonical,this.tileTransform)[0],y=new r.b4,b=new r.b5;for(let T=0;T<d.length;T++){const{x:I,y:F}=d[T];y.emplaceBack(I,F),b.emplaceBack(T)}b.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(b),this._tileDebugBuffer=t.createVertexBuffer(y,r.b6.members),this._tileDebugSegments=r.b7.simpleSegment(0,0,y.length,b.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const d=r.b3(ml,this.tileID.canonical,this.tileTransform)[0];let y,b;if(this.isRaster){const T=function(I,F){const V=r.aQ(I,F),j=Math.pow(2,I.z);for(let de=0;de<Do;de++)for(let pe=0;pe<Do;pe++){const Te=r.aR((I.x+(pe+Wu(pe))/Ks)/j),ke=r.aS((I.y+(de+Wu(de))/Ks)/j),De=F.project(Te,ke),Ue=de*Do+pe;Ia[2*Ue+0]=Math.round((De.x*V.scale-V.x)*r.ag),Ia[2*Ue+1]=Math.round((De.y*V.scale-V.y)*r.ag)}sa.fill(0),oa.fill(0);for(let de=2045;de>=0;de--){const pe=4*de,Te=qo[pe+0],ke=qo[pe+1],De=qo[pe+2],Ue=qo[pe+3],Le=Te+De>>1,Ne=ke+Ue>>1,Oe=Le+Ne-ke,We=Ne+Te-Le,Qe=ke*Do+Te,xt=Ue*Do+De,ut=Ne*Do+Le,Dt=Math.hypot((Ia[2*Qe+0]+Ia[2*xt+0])/2-Ia[2*ut+0],(Ia[2*Qe+1]+Ia[2*xt+1])/2-Ia[2*ut+1])>=16;sa[ut]=sa[ut]||(Dt?1:0),de<1022&&(sa[ut]=sa[ut]||sa[(ke+We>>1)*Do+(Te+Oe>>1)]||sa[(Ue+We>>1)*Do+(De+Oe>>1)])}const G=new r.aT,q=new r.aU;let Q=0;function ce(de,pe){const Te=pe*Do+de;return oa[Te]===0&&(G.emplaceBack(Ia[2*Te+0],Ia[2*Te+1],de*r.ag/Ks,pe*r.ag/Ks),oa[Te]=++Q),oa[Te]-1}function ae(de,pe,Te,ke,De,Ue){const Le=de+Te>>1,Ne=pe+ke>>1;if(Math.abs(de-De)+Math.abs(pe-Ue)>1&&sa[Ne*Do+Le])ae(De,Ue,de,pe,Le,Ne),ae(Te,ke,De,Ue,Le,Ne);else{const Oe=ce(de,pe),We=ce(Te,ke),Qe=ce(De,Ue);q.emplaceBack(Oe,We,Qe)}}return ae(0,0,Ks,Ks,Ks,0),ae(Ks,Ks,0,0,0,Ks),{vertices:G,indices:q}}(this.tileID.canonical,n);y=T.vertices,b=T.indices}else{y=new r.aT,b=new r.aU;for(const{x:I,y:F}of d)y.emplaceBack(I,F,0,0);const T=r.b8(y.int16,void 0,4);for(let I=0;I<T.length;I+=3)b.emplaceBack(T[I],T[I+1],T[I+2])}this._tileBoundsBuffer=t.createVertexBuffer(y,r.b9.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(b),this._tileBoundsSegments=r.b7.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugBuffers(t,n){const d=n.projection;if(!d||d.name!=="globe"||n.freezeTileCoverage)return;const y=this.tileID.canonical,b=r.ba(y,n),T=r.bb(b),I=r.ae(n.zoom);let F;I>0&&(F=r.ab.mat4.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,y,n,T,F,I),this._makeGlobeTileDebugTextBuffer(t,y,n,T,F,I)}_globePoint(t,n,d,y,b,T,I){let F=r.bc(t,n,d);if(T){const V=1<<d.z,j=r.at(y.center.lng),G=r.aA(y.center.lat),q=(d.x+.5)/V-j;let Q=0;q>.5?Q=-1:q<-.5&&(Q=1);let ce=(t/r.ag+d.x)/V+Q,ae=(n/r.ag+d.y)/V;ce=(ce-j)*y._pixelsPerMercatorPixel+j,ae=(ae-G)*y._pixelsPerMercatorPixel+G;const de=[ce*y.worldSize,ae*y.worldSize,0];r.ab.vec3.transformMat4(de,de,T),F=r.bd(F,de,I)}return r.ab.vec3.transformMat4(F,F,b)}_makeGlobeTileDebugBorderBuffer(t,n,d,y,b,T){const I=new r.b4,F=new r.b5,V=new r.be,j=(q,Q,ce,ae,de)=>{const pe=(ce-q)/(de-1),Te=(ae-Q)/(de-1),ke=I.length;for(let De=0;De<de;De++){const Ue=q+De*pe,Le=Q+De*Te;I.emplaceBack(Ue,Le);const Ne=this._globePoint(Ue,Le,n,d,y,b,T);V.emplaceBack(Ne[0],Ne[1],Ne[2]),F.emplaceBack(ke+De)}},G=r.ag;j(0,0,G,0,16),j(G,0,G,G,16),j(G,G,0,G,16),j(0,G,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(F),this._tileDebugBuffer=t.createVertexBuffer(I,r.b6.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(V,r.bf.members),this._tileDebugSegments=r.b7.simpleSegment(0,0,I.length,F.length)}_makeGlobeTileDebugTextBuffer(t,n,d,y,b,T){const I=r.ag/4,F=new r.b4,V=new r.aU,j=new r.be,G=25;V.reserve(32),F.reserve(G),j.reserve(G);const q=(Q,ce)=>G*Q+ce;for(let Q=0;Q<G;Q++){const ce=Q*I;for(let ae=0;ae<G;ae++){const de=ae*I;F.emplaceBack(de,ce);const pe=this._globePoint(de,ce,n,d,y,b,T);j.emplaceBack(pe[0],pe[1],pe[2])}}for(let Q=0;Q<4;Q++)for(let ce=0;ce<4;ce++){const ae=q(Q,ce),de=q(Q,ce+1),pe=q(Q+1,ce),Te=q(Q+1,ce+1);V.emplaceBack(ae,de,pe),V.emplaceBack(pe,de,Te)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(V),this._tileDebugTextBuffer=t.createVertexBuffer(F,r.b6.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(j,r.bf.members),this._tileDebugTextSegments=r.b7.simpleSegment(0,0,G,32)}destroy(t=!1){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bg.setPbf(r.bh);class aa extends gl{constructor(t,n,d,y,b){super(t,n,d,y,b),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,n){const d=n.context,y=d.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t,{premultiply:!1}):this.texture=new r.T(d,t,y.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,n){const d=this._mrt=new r.bg(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=r.bi(y,(b,T,I,F)=>{if(b)n(b);else try{const V=d.getHeaderLength(T);if(V>t)return void(this.request=this.fetchHeader(V,n));d.parseHeader(T),this._isHeaderLoaded=!0;let j=0;for(const G of Object.values(d.layers))j=Math.max(j,G.dataIndex[G.dataIndex.length-1].last_byte);T.byteLength>=j&&(this.entireBuffer=T),n(null,this.entireBuffer||T,I,F)}catch(V){n(V)}}),this.request}fetchBand(t,n,d){const y=this._mrt;if(!this._isHeaderLoaded||!y)return void d(new Error("Tile header is not ready"));const b=this.actor;if(!b)return void d(new Error("Can't fetch tile band without an actor"));let T;const I=(G,q)=>{T.complete(G,q),G?d(G):(this.updateTextureDescriptor(t,n),d(null,this.textureDescriptor&&this.textureDescriptor.img))},F=(G,q)=>{if(G)return d(G);const Q=b.send("decodeRasterArray",{buffer:q,task:T},I,void 0,!0);this._workQueue.push(()=>{Q&&Q.cancel(),T.cancel()})},V=y.getLayer(t);if(!V)return void d(new Error(`Unknown sourceLayer "${t}"`));if(V.hasDataForBand(n))return this.updateTextureDescriptor(t,n),void d(null,this.textureDescriptor?this.textureDescriptor.img:null);const j=V.getDataRange([n]);if(T=y.createDecodingTask(j),!T||T.tasks.length)if(this.flushQueues(),this.entireBuffer)F(null,this.entireBuffer.slice(j.firstByte,j.lastByte+1));else{const G=Object.assign({},this.requestParams,{headers:{Range:`bytes=${j.firstByte}-${j.lastByte}`}}),q=r.bi(G,F);this._fetchQueue.push(()=>{q.cancel(),T.cancel()})}else d(null)}updateNeeded(t,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,n){if(!this._mrt)return;const d=this._mrt.getLayer(t);if(!d||!d.hasBand(n)||!d.hasDataForBand(n))return;const{bytes:y,tileSize:b,buffer:T,offset:I,scale:F}=d.getBandView(n),V=b+2*T,j={data:y,width:V,height:V},G=this.texture;G&&G instanceof r.T&&G.update(j,{premultiply:!1}),this.textureDescriptor={layer:t,band:n,img:j,buffer:T,offset:I,tileSize:b,format:d.pixelFormat,mix:[F,256*F,65536*F,16777216*F]}}}class gf{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,d){const y=t.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const b={value:n,timeout:void 0};if(d!==void 0&&(b.timeout=setTimeout(()=>{this.remove(t,b)},d)),this.data[y].push(b),this.order.push(y),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const d=t.wrapped().key,y=n===void 0?0:this.data[d].indexOf(n),b=this.data[d][y];return this.data[d].splice(y,1),b.timeout&&clearTimeout(b.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(b.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const d in this.data)for(const y of this.data[d])t(y.value)||n.push(y);for(const d of n)this.remove(d.value.tileID,d)}}class qd{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,d){const y=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][y]=this.stateChanges[t][y]||{},r.l(this.stateChanges[t][y],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(const b in this.state[t])b!==y&&(this.deletedStates[t][b]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][y]===null){this.deletedStates[t][y]={};for(const b in this.state[t][y])d[b]||(this.deletedStates[t][y][b]=null)}else for(const b in d)this.deletedStates[t]&&this.deletedStates[t][y]&&this.deletedStates[t][y][b]===null&&delete this.deletedStates[t][y][b]}removeFeatureState(t,n,d){if(this.deletedStates[t]===null)return;const y=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&n!==void 0)this.deletedStates[t][y]!==null&&(this.deletedStates[t][y]=this.deletedStates[t][y]||{},this.deletedStates[t][y][d]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][y])for(d in this.deletedStates[t][y]={},this.stateChanges[t][y])this.deletedStates[t][y][d]=null;else this.deletedStates[t][y]=null;else this.deletedStates[t]=null}getState(t,n){const d=this.state[t]||{},y=this.stateChanges[t]||{},b=this.deletedStates[t];if(b===null)return{};if(n!==void 0){const I=String(n),F=r.l({},d[I],y[I]);if(b){const V=b[n];if(V===null)return{};for(const j in V)delete F[j]}return F}const T=r.l({},d,y);if(b)for(const I in b)delete T[I];return T}initializeTileState(t,n){t.refreshFeatureState(n)}coalesceChanges(t,n){const d={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const b={};for(const T in this.stateChanges[y])this.state[y][T]||(this.state[y][T]={}),r.l(this.state[y][T],this.stateChanges[y][T]),b[T]=this.state[y][T];d[y]=b}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const b={};if(this.deletedStates[y]===null)for(const T in this.state[y])b[T]={},this.state[y][T]={};else for(const T in this.deletedStates[y]){if(this.deletedStates[y][T]===null)this.state[y][T]={};else if(this.state[y][T])for(const I of Object.keys(this.deletedStates[y][T]))delete this.state[y][T][I];b[T]=this.state[y][T]}d[y]=d[y]||{},r.l(d[y],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const y in t)t[y].refreshFeatureState(n)}}class Yo extends r.E{constructor(t,n,d){super(),this.id=t,this._onlySymbols=d,n.on("data",y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new gf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new qd,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,n){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const d=this._tiles[n];d.upload(t),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return r.bj(this._tiles).map(t=>t.tileID).sort(Ar).map(t=>t.key)}getRenderableIds(t,n){const d=[];for(const y in this._tiles)this._isIdRenderable(+y,t,n)&&d.push(this._tiles[y]);return t?d.sort((y,b)=>{const T=y.tileID,I=b.tileID,F=new r.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),V=new r.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-I.overscaledZ||V.y-F.y||V.x-F.x}).map(y=>y.tileID.key):d.map(y=>y.tileID).sort(Ar).map(y=>y.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n,d){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())&&(d||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,n){const d=this._tiles[t];d&&(d.state!=="loading"&&(d.state=n),this._loadTile(d,this._tileLoaded.bind(this,d,t,n)))}_tileLoaded(t,n,d,y){if(y)if(t.state="errored",y.status!==404)this._source.fire(new r.y(y,{tile:t}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=r.q.now(),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new r.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const n=this.getRenderableIds();for(let y=0;y<n.length;y++){const b=n[y];if(t.neighboringTiles&&t.neighboringTiles[b]){const T=this.getTileByID(b);d(t,T),d(T,t)}}function d(y,b){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let T=b.tileID.canonical.x-y.tileID.canonical.x;const I=b.tileID.canonical.y-y.tileID.canonical.y,F=Math.pow(2,y.tileID.canonical.z),V=b.tileID.key;T===0&&I===0||Math.abs(I)>1||(Math.abs(T)>1&&(Math.abs(T+F)===1?T+=F:Math.abs(T-F)===1&&(T-=F)),b.dem&&y.dem&&(y.dem.backfillBorder(b.dem,T,I),y.neighboringTiles&&y.neighboringTiles[V]&&(y.neighboringTiles[V].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,d,y){for(const b in this._tiles){let T=this._tiles[b];if(y[b]||!T.hasData()||T.tileID.overscaledZ<=n||T.tileID.overscaledZ>d)continue;let I=T.tileID;for(;T&&T.tileID.overscaledZ>n+1;){const V=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[V.key],T&&T.hasData()&&(I=V)}let F=I;for(;F.overscaledZ>n;)if(F=F.scaledTo(F.overscaledZ-1),t[F.key]){y[I.key]=I;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const d=this._loadedParentTiles[t.key];return d&&d.tileID.overscaledZ>=n?d:null}for(let d=t.overscaledZ-1;d>=n;d--){const y=t.scaledTo(d),b=this._getLoadedTile(y);if(b)return b}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,n){n=n||this._source.tileSize;const d=Math.ceil(t.width/n)+1,y=Math.ceil(t.height/n)+1,b=Math.floor(d*y*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(I)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const d={};for(const y in this._tiles){const b=this._tiles[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+n),d[b.tileID.key]=b}this._tiles=d;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(t,n,d,y){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(t,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const b=this._source.type==="batched-model";let T,I=this._source.maxzoom;const F=this.map&&this.map.painter?this.map.painter._terrain:null;if(F&&F.sourceCache===this&&F.attenuationRange()){const G=F.attenuationRange()[0],q=Math.floor(G)-Math.log2(F.getDemUpscale());I>q&&(I=q)}if(this.used||this.usedForTerrain){if(this._source.tileID)T=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(G=>new r.aG(G.canonical.z,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y));else if(this.tileCoverLift!==0){const G=t.clone();G.tileCoverLift=this.tileCoverLift,T=G.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.minzoom<=1&&t.projection.name==="globe"&&(T.push(new r.aG(1,0,1,0,0)),T.push(new r.aG(1,0,1,1,0)),T.push(new r.aG(1,0,1,0,1)),T.push(new r.aG(1,0,1,1,1)))}else if(T=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.hasTile){const G=this._source.hasTile.bind(this._source);T=T.filter(q=>G(q))}}else T=[];if(T.length>0&&this.castsShadows&&y&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Yd(this._source.type)){const G=t.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),q=Math.min(G,this._source.maxzoom);if(b){const Q=t.extendTileCover(T,q);for(const ce of Q)T.push(ce)}else{const Q=t.extendTileCover(T,q,y);for(const ce of Q)this._shadowCasterTiles[ce.key]=!0,T.push(ce)}}const V=this._updateRetainedTiles(T);if(Yd(this._source.type)&&T.length!==0){const G={},q={},Q=Object.keys(V);for(const ae of Q){const de=V[ae],pe=this._tiles[ae];if(!pe||pe.fadeEndTime&&pe.fadeEndTime<=r.q.now())continue;const Te=this.findLoadedParent(de,Math.max(de.overscaledZ-Yo.maxOverzooming,this._source.minzoom));Te&&(this._addTile(Te.tileID),G[Te.tileID.key]=Te.tileID),q[ae]=de}const ce=T[T.length-1].overscaledZ;for(const ae in this._tiles){const de=this._tiles[ae];if(V[ae]||!de.hasData())continue;let pe=de.tileID;for(;pe.overscaledZ>ce;){pe=pe.scaledTo(pe.overscaledZ-1);const Te=this._tiles[pe.key];if(Te&&Te.hasData()&&q[pe.key]){V[ae]=de.tileID;break}}}for(const ae in G)V[ae]||(this._coveredTiles[ae]=!0,V[ae]=G[ae])}for(const G in V)this._tiles[G].clearFadeHold();const j=r.bk(this._tiles,V);for(const G of j){const q=this._tiles[G];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(+G)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const n={};if(t.length===0)return n;const d={},y=t.reduce((V,j)=>Math.min(V,j.overscaledZ),1/0),b=t[0].overscaledZ,T=Math.max(b-Yo.maxOverzooming,this._source.minzoom),I=Math.max(b+Yo.maxUnderzooming,this._source.minzoom),F={};for(const V of t){const j=this._addTile(V);n[V.key]=V,j.hasData()||y<this._source.maxzoom&&(F[V.key]=V)}this._retainLoadedChildren(F,y,I,n);for(const V of t){let j=this._tiles[V.key];if(j.hasData())continue;if(V.canonical.z>=this._source.maxzoom){const q=V.children(this._source.maxzoom)[0],Q=this.getTile(q);if(Q&&Q.hasData()){n[q.key]=q;continue}}else{const q=V.children(this._source.maxzoom);if(n[q[0].key]&&n[q[1].key]&&n[q[2].key]&&n[q[3].key])continue}let G=j.wasRequested();for(let q=V.overscaledZ-1;q>=T;--q){const Q=V.scaledTo(q);if(d[Q.key]||(d[Q.key]=!0,j=this.getTile(Q),!j&&G&&(j=this._addTile(Q)),j&&(n[Q.key]=Q,G=j.wasRequested(),j.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let d,y=this._tiles[t].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){d=this._loadedParentTiles[y.key];break}n.push(y.key);const b=y.scaledTo(y.overscaledZ-1);if(d=this._getLoadedTile(b),d)break;y=b}for(const b of n)this._loadedParentTiles[b]=d}}_addTile(t){let n=this._tiles[t.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const d=!!n;if(!d){const y=this.map?this.map.painter:null,b=this._source.tileSize*t.overscaleFactor();n=this._source.type==="raster-array"?new aa(t,b,this.transform.tileZoom,y,this._isRaster):new gl(t,b,this.transform.tileZoom,y,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n?(n.uses++,this._tiles[t.key]=n,d||this._source.fire(new r.z("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const d=n.getExpiryTimeout();d&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},d))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,d){const y=[],b=this.transform;if(!b)return y;const T=b.projection.name==="globe",I=r.at(b.center.lng);for(const F in this._tiles){const V=this._tiles[F];if(d&&V.clearQueryDebugViz(),V.holdingForFade())continue;let j;if(T){const G=V.tileID.canonical;if(G.z===0){const q=[Math.abs(r.aw(I,...Di(G,-1))-I),Math.abs(r.aw(I,...Di(G,1))-I)];j=[0,2*q.indexOf(Math.min(...q))-1]}else{const q=[Math.abs(r.aw(I,...Di(G,-1))-I),Math.abs(r.aw(I,...Di(G,0))-I),Math.abs(r.aw(I,...Di(G,1))-I)];j=[q.indexOf(Math.min(...q))-1]}}else j=[0];for(const G of j){const q=t.containsTile(V,b,n,G);q&&y.push(q)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,n){const d=this.getRenderableIds(t,n).map(b=>this._tiles[b].tileID),y=this.transform.projection.name==="globe";for(const b of d)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=y?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return d}sortCoordinatesByDistance(t){const n=t.slice(),d=this.transform._camera.position,y=this.transform._camera.forward(),b={};for(const T of n){const I=1/(1<<T.canonical.z);b[T.key]=((T.canonical.x+.5)*I+T.wrap-d[0])*y[0]+((T.canonical.y+.5)*I-d[1])*y[1]-d[2]*y[2]}return n.sort((T,I)=>b[T.key]-b[I.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(Yd(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=r.q.now())return!0}return!1}setFeatureState(t,n,d){this._state.updateState(t=t||"_geojsonTileLayer",n,d)}removeFeatureState(t,n,d){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,d)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,d){const y=this._tiles[t];y&&y.setDependencies(n,d)}reloadTilesForDependencies(t,n){for(const d in this._tiles)this._tiles[d].hasDependency(t,n)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(t,n))}_preloadTiles(t,n){if(!this._sourceLoaded){const F=()=>{this._sourceLoaded&&(this._source.off("data",F),this._preloadTiles(t,n))};return void this._source.on("data",F)}const d=new Map,y=Array.isArray(t)?t:[t],b=this.map.painter.terrain,T=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const F of y){const V=F.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const j of V)d.set(j.key,j);this.usedForTerrain&&F.updateElevation(!1)}const I=Array.from(d.values());r.bl(I,(F,V)=>{const j=new gl(F,this._source.tileSize*F.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(j,G=>{this._source.type==="raster-dem"&&j.dem&&this._backfillDEM(j),V(G,j)})},n)}}function Ar(u,t){const n=Math.abs(2*u.wrap)-+(u.wrap<0),d=Math.abs(2*t.wrap)-+(t.wrap<0);return u.overscaledZ-t.overscaledZ||d-n||t.canonical.y-u.canonical.y||t.canonical.x-u.canonical.x}function Yd(u){return u==="raster"||u==="image"||u==="video"||u==="custom"}function Di(u,t){const n=1<<u.z;return[u.x/n+t,(u.x+1)/n+t]}Yo.maxOverzooming=10,Yo.maxUnderzooming=3;class Xd{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,n=!1;for(const d in this.style._mergedLayers){const y=this.style._mergedLayers[d];if(y.type==="fill-extrusion")this.layers.push({layer:y,visible:t,visibilityChanged:n});else if(y.type==="model"){const b=this.style.getLayerSource(y);b&&b.type==="batched-model"&&this.layers.push({layer:y,visible:t,visibilityChanged:n})}}}onNewFrame(t){this.layersGotHidden=!1;for(const n of this.layers){const d=n.layer;let y=!1;d.type==="fill-extrusion"?y=!d.isHidden(t)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="model"&&(y=!d.isHidden(t)&&d.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&n.visible,n.visible=y}}updateZOffset(t,n){this.currentBuildingBuckets=[];for(const y of this.layers){const b=y.layer,T=this.style.getLayerSourceCache(b);let I=1;b.type==="fill-extrusion"&&(I=y.visible?b.paint.get("fill-extrusion-vertical-scale"):0);let F=T?T.getTile(n):null;if(!F&&T&&n.canonical.z>T.getSource().minzoom){let V=n.scaledTo(Math.min(T.getSource().maxzoom,n.overscaledZ-1));for(;V.overscaledZ>=T.getSource().minzoom&&(F=T.getTile(V),!F&&V.overscaledZ!==0);)V=V.scaledTo(V.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:F?F.getBucket(b):null,tileID:F?F.tileID:n,verticalScale:I})}t.hasAnyZOffset=!1;let d=!1;for(let y=0;y<t.symbolInstances.length;y++){const b=t.symbolInstances.get(y),T=b.zOffset,I=this._getHeightAtTileOffset(n,b.tileAnchorX,b.tileAnchorY);b.zOffset=I!==Number.NEGATIVE_INFINITY?I:T,d||T===b.zOffset||(d=!0),t.hasAnyZOffset||b.zOffset===0||(t.hasAnyZOffset=!0)}d&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,n,d,y){let b=n,T=d;if(t.canonical.z!==y.canonical.z){const I=y.canonical,F=1/(1<<t.canonical.z-I.z);b=(n+t.canonical.x*r.ag)*F-I.x*r.ag|0,T=(d+t.canonical.y*r.ag)*F-I.y*r.ag|0}return{tileX:b,tileY:T}}_getHeightAtTileOffset(t,n,d){let y,b;for(let T=0;T<this.layers.length;++T){if(this.layers[T].layer.type!=="fill-extrusion")continue;const{bucket:I,tileID:F,verticalScale:V}=this.currentBuildingBuckets[T];if(!I)continue;const{tileX:j,tileY:G}=this._mapCoordToOverlappingTile(t,n,d,F),q=I.getHeightAtTileCoord(j,G);q&&q.height!==void 0&&(q.hidden?y=q.height:b=Math.max(q.height*V,b||0))}if(b!==void 0)return b;for(let T=0;T<this.layers.length;++T){const I=this.layers[T];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:F,tileID:V}=this.currentBuildingBuckets[T];if(!F)continue;const{tileX:j,tileY:G}=this._mapCoordToOverlappingTile(t,n,d,V),q=F.getHeightAtTileCoord(j,G);if(q&&!q.hidden)return q.height===void 0&&y!==void 0?Math.min(q.maxHeight,y)*q.verticalScale:q.height?q.height*q.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Io(u,t){const n={};for(const d in u)d!=="ref"&&(n[d]=u[d]);return r.bm.forEach(d=>{d in t&&(n[d]=t[d])}),n}function Bh(u){u=u.slice();const t=Object.create(null);for(let n=0;n<u.length;n++)t[u[n].id]=u[n];for(let n=0;n<u.length;n++)"ref"in u[n]&&(u[n]=Io(u[n],t[u[n].ref]));return u}const Ji={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function qc(u,t,n){n.push({command:Ji.addSource,args:[u,t[u]]})}function Ha(u,t,n){t.push({command:Ji.removeSource,args:[u]}),n[u]=!0}function yi(u,t,n,d){Ha(u,n,d),qc(u,t,n)}function Lr(u,t,n){let d;for(d in u[n])if(u[n].hasOwnProperty(d)&&d!=="data"&&!r.bn(u[n][d],t[n][d]))return!1;for(d in t[n])if(t[n].hasOwnProperty(d)&&d!=="data"&&!r.bn(u[n][d],t[n][d]))return!1;return!0}function Sr(u,t,n,d,y,b){let T;for(T in t=t||{},u=u||{})u.hasOwnProperty(T)&&(r.bn(u[T],t[T])||n.push({command:b,args:[d,T,t[T],y]}));for(T in t)t.hasOwnProperty(T)&&!u.hasOwnProperty(T)&&(r.bn(u[T],t[T])||n.push({command:b,args:[d,T,t[T],y]}))}function Hs(u){return u.id}function ka(u,t){return u[t.id]=t,u}class Tr{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=r.aw(t,0,1);let n=1,d=this._distances[n];const y=t*this.paddedLength+this.padding;for(;d<y&&n<this._distances.length;)d=this._distances[++n];const b=n-1,T=this._distances[b],I=d-T,F=I>0?(y-T)/I:0;return this.points[b].mult(1-F).add(this.points[n].mult(F))}}class Oa{constructor(t,n,d){const y=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(n/d);for(let T=0;T<this.xCellCount*this.yCellCount;T++)y.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,d,y,b){this._forEachCell(n,d,y,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(b)}insertCircle(t,n,d,y){this._forEachCell(n-y,d-y,n+y,d+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(d),this.circles.push(y)}_insertBoxCell(t,n,d,y,b,T){this.boxCells[b].push(T)}_insertCircleCell(t,n,d,y,b,T){this.circleCells[b].push(T)}_query(t,n,d,y,b,T){if(d<0||t>this.width||y<0||n>this.height)return!b&&[];const I=[];if(t<=0&&n<=0&&this.width<=d&&this.height<=y){if(b)return!0;for(let F=0;F<this.boxKeys.length;F++)I.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const V=this.circles[3*F],j=this.circles[3*F+1],G=this.circles[3*F+2];I.push({key:this.circleKeys[F],x1:V-G,y1:j-G,x2:V+G,y2:j+G})}return T?I.filter(T):I}return this._forEachCell(t,n,d,y,this._queryCell,I,{hitTest:b,seenUids:{box:{},circle:{}}},T),b?I.length>0:I}_queryCircle(t,n,d,y,b){const T=t-d,I=t+d,F=n-d,V=n+d;if(I<0||T>this.width||V<0||F>this.height)return!y&&[];const j=[];return this._forEachCell(T,F,I,V,this._queryCellCircle,j,{hitTest:y,circle:{x:t,y:n,radius:d},seenUids:{box:{},circle:{}}},b),y?j.length>0:j}query(t,n,d,y,b){return this._query(t,n,d,y,!1,b)}hitTest(t,n,d,y,b){return this._query(t,n,d,y,!0,b)}hitTestCircle(t,n,d,y){return this._queryCircle(t,n,d,!0,y)}_queryCell(t,n,d,y,b,T,I,F){const V=I.seenUids,j=this.boxCells[b];if(j!==null){const q=this.bboxes;for(const Q of j)if(!V.box[Q]){V.box[Q]=!0;const ce=4*Q;if(t<=q[ce+2]&&n<=q[ce+3]&&d>=q[ce+0]&&y>=q[ce+1]&&(!F||F(this.boxKeys[Q]))){if(I.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Q],x1:q[ce],y1:q[ce+1],x2:q[ce+2],y2:q[ce+3]})}}}const G=this.circleCells[b];if(G!==null){const q=this.circles;for(const Q of G)if(!V.circle[Q]){V.circle[Q]=!0;const ce=3*Q;if(this._circleAndRectCollide(q[ce],q[ce+1],q[ce+2],t,n,d,y)&&(!F||F(this.circleKeys[Q]))){if(I.hitTest)return T.push(!0),!0;{const ae=q[ce],de=q[ce+1],pe=q[ce+2];T.push({key:this.circleKeys[Q],x1:ae-pe,y1:de-pe,x2:ae+pe,y2:de+pe})}}}}}_queryCellCircle(t,n,d,y,b,T,I,F){const V=I.circle,j=I.seenUids,G=this.boxCells[b];if(G!==null){const Q=this.bboxes;for(const ce of G)if(!j.box[ce]){j.box[ce]=!0;const ae=4*ce;if(this._circleAndRectCollide(V.x,V.y,V.radius,Q[ae+0],Q[ae+1],Q[ae+2],Q[ae+3])&&(!F||F(this.boxKeys[ce])))return T.push(!0),!0}}const q=this.circleCells[b];if(q!==null){const Q=this.circles;for(const ce of q)if(!j.circle[ce]){j.circle[ce]=!0;const ae=3*ce;if(this._circlesCollide(Q[ae],Q[ae+1],Q[ae+2],V.x,V.y,V.radius)&&(!F||F(this.circleKeys[ce])))return T.push(!0),!0}}}_forEachCell(t,n,d,y,b,T,I,F){const V=this._convertToXCellCoord(t),j=this._convertToYCellCoord(n),G=this._convertToXCellCoord(d),q=this._convertToYCellCoord(y);for(let Q=V;Q<=G;Q++)for(let ce=j;ce<=q;ce++)if(b.call(this,t,n,d,y,this.xCellCount*ce+Q,T,I,F))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,d,y,b,T){const I=y-t,F=b-n,V=d+T;return V*V>I*I+F*F}_circleAndRectCollide(t,n,d,y,b,T,I){const F=(T-y)/2,V=Math.abs(t-(y+F));if(V>F+d)return!1;const j=(I-b)/2,G=Math.abs(n-(b+j));if(G>j+d)return!1;if(V<=F||G<=j)return!0;const q=V-F,Q=G-j;return q*q+Q*Q<=d*d}}const ps={unknown:0,flipRequired:1,flipNotRequired:2},_l=Math.tan(85*Math.PI/180);function bs(u,t,n,d,y,b,T){const I=r.ab.mat4.create();if(n)if(b.name==="globe"){const F=r.bo(y,t);r.ab.mat4.multiply(I,I,F)}else{const F=r.ab.mat2.invert([],T);I[0]=F[0],I[1]=F[1],I[4]=F[2],I[5]=F[3],d||r.ab.mat4.rotateZ(I,I,y.angle)}else r.ab.mat4.multiply(I,y.labelPlaneMatrix,u);return I}function wn(u,t,n,d,y,b,T){const I=bs(u,t,n,d,y,b,T);return b.name==="globe"&&n||(I[2]=I[6]=I[10]=I[14]=0),I}function Zd(u,t,n,d,y,b,T){if(n){if(b.name==="globe"){const I=bs(u,t,n,d,y,b,T);return r.ab.mat4.invert(I,I),r.ab.mat4.multiply(I,u,I),I}{const I=r.ab.mat4.clone(u),F=r.ab.mat4.identity([]);return F[0]=T[0],F[1]=T[1],F[4]=T[2],F[5]=T[3],r.ab.mat4.multiply(I,I,F),d||r.ab.mat4.rotateZ(I,I,-y.angle),I}}return y.glCoordMatrix}function Js(u,t,n,d){const y=[u,t,n,1];n?r.ab.vec4.transformMat4(y,y,d):ko(y,y,d);const b=y[3];return y[0]/=b,y[1]/=b,y[2]/=b,y}function rs(u,t){return Math.min(.5+u/t*.5,1.5)}function _o(u,t){const n=u[0]/u[3],d=u[1]/u[3];return n>=-t[0]&&n<=t[0]&&d>=-t[1]&&d<=t[1]}function qu(u,t,n,d,y,b,T,I,F,V){const j=n.transform,G=d?u.textSizeData:u.iconSizeData,q=r.bp(G,n.transform.zoom),Q=j.projection.name==="globe",ce=[256/n.width*2+1,256/n.height*2+1],ae=d?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;ae.clear();let de=null;Q&&(de=d?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const pe=u.lineVertexArray,Te=d?u.text.placedSymbolArray:u.icon.placedSymbolArray,ke=n.transform.width/n.transform.height;let De,Ue=!1;for(let Le=0;Le<Te.length;Le++){const Ne=Te.get(Le),{numGlyphs:Oe,writingMode:We}=Ne;if(We!==r.bq.vertical||Ue||De===r.bq.horizontal||(Ue=!0),De=We,(Ne.hidden||We===r.bq.vertical)&&!Ue){Qr(Oe,ae);continue}Ue=!1;const Qe=new r.P(Ne.tileAnchorX,Ne.tileAnchorY);let{x:xt,y:ut,z:Dt}=j.projection.projectTilePoint(Qe.x,Qe.y,V.canonical);if(F){const[kt,$t,Xt]=F(Qe);xt+=kt,ut+=$t,Dt+=Xt}const At=[xt,ut,Dt,1];if(r.ab.vec4.transformMat4(At,At,t),!_o(At,ce)){Qr(Oe,ae);continue}const ot=At[3],wt=rs(n.transform.getCameraToCenterDistance(j.projection),ot),Vt=r.br(G,q,Ne),st=T?Vt/wt:Vt*wt,It=Js(xt,ut,Dt,y);if(It[3]<=0){Qr(Oe,ae);continue}let bt={};const Kt=T?null:F,Bt=yo(Ne,st,!1,I,t,y,b,u.glyphOffsetArray,pe,ae,de,It,Qe,bt,ke,Kt,j.projection,V,T);Ue=Bt.useVertical,Kt&&Bt.needsFlipping&&(bt={}),(Bt.notEnoughRoom||Ue||Bt.needsFlipping&&yo(Ne,st,!0,I,t,y,b,u.glyphOffsetArray,pe,ae,de,It,Qe,bt,ke,Kt,j.projection,V,T).notEnoughRoom)&&Qr(Oe,ae)}d?(u.text.dynamicLayoutVertexBuffer.updateData(ae),de&&u.text.globeExtVertexBuffer&&u.text.globeExtVertexBuffer.updateData(de)):(u.icon.dynamicLayoutVertexBuffer.updateData(ae),de&&u.icon.globeExtVertexBuffer&&u.icon.globeExtVertexBuffer.updateData(de))}function Yu(u,t,n,d,y,b,T,I,F,V,j,G,q,Q,ce,ae){const{lineStartIndex:de,glyphStartIndex:pe,segment:Te}=I,ke=pe+I.numGlyphs,De=de+I.lineLength,Ue=t.getoffsetX(pe),Le=t.getoffsetX(ke-1),Ne=La(u*Ue,n,d,y,b,T,Te,de,De,F,V,j,G,q,!0,Q,ce,ae);if(!Ne)return null;const Oe=La(u*Le,n,d,y,b,T,Te,de,De,F,V,j,G,q,!0,Q,ce,ae);return Oe?{first:Ne,last:Oe}:null}function Is(u,t,n,d){return u===r.bq.horizontal&&Math.abs(d)>Math.abs(n)?{useVertical:!0}:u===r.bq.vertical?d>0?{needsFlipping:!0}:null:t!==ps.unknown&&function(y,b){return y===0||Math.abs(b/y)>_l}(n,d)?t===ps.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function yo(u,t,n,d,y,b,T,I,F,V,j,G,q,Q,ce,ae,de,pe,Te){const ke=t/24,De=u.lineOffsetX*ke,Ue=u.lineOffsetY*ke,{lineStartIndex:Le,glyphStartIndex:Ne,numGlyphs:Oe,segment:We,writingMode:Qe,flipState:xt}=u,ut=Le+u.lineLength,Dt=At=>{if(j){const[st,It,bt]=At.up,Kt=V.length;r.bs(j,Kt+0,st,It,bt),r.bs(j,Kt+1,st,It,bt),r.bs(j,Kt+2,st,It,bt),r.bs(j,Kt+3,st,It,bt)}const[ot,wt,Vt]=At.point;r.bt(V,ot,wt,Vt,At.angle)};if(Oe>1){const At=Yu(ke,I,De,Ue,n,G,q,u,F,b,Q,ae,!1,de,pe,Te);if(!At)return{notEnoughRoom:!0};if(d&&!n){let[ot,wt,Vt]=At.first.point,[st,It,bt]=At.last.point;[ot,wt]=Js(ot,wt,Vt,T),[st,It]=Js(st,It,bt,T);const Kt=Is(Qe,xt,(st-ot)*ce,It-wt);if(u.flipState=Kt&&Kt.needsFlipping?ps.flipRequired:ps.flipNotRequired,Kt)return Kt}Dt(At.first);for(let ot=Ne+1;ot<Ne+Oe-1;ot++){const wt=La(ke*I.getoffsetX(ot),De,Ue,n,G,q,We,Le,ut,F,b,Q,ae,!1,!1,de,pe,Te);if(!wt)return V.length-=4*(ot-Ne),{notEnoughRoom:!0};Dt(wt)}Dt(At.last)}else{if(d&&!n){const ot=Js(q.x,q.y,0,y),wt=Le+We+1,Vt=new r.P(F.getx(wt),F.gety(wt)),st=Js(Vt.x,Vt.y,0,y),It=st[3]>0?st:Yc(q,Vt,ot,1,y,void 0,de,pe.canonical),bt=Is(Qe,xt,(It[0]-ot[0])*ce,It[1]-ot[1]);if(u.flipState=bt&&bt.needsFlipping?ps.flipRequired:ps.flipNotRequired,bt)return bt}const At=La(ke*I.getoffsetX(Ne),De,Ue,n,G,q,We,Le,ut,F,b,Q,ae,!1,!1,de,pe,Te);if(!At)return{notEnoughRoom:!0};Dt(At)}return{}}function ks(u,t,n,d,y){const{x:b,y:T,z:I}=d.projectTilePoint(u.x,u.y,t);if(!y)return Js(b,T,I,n);const[F,V,j]=y(u);return Js(b+F,T+V,I+j,n)}function Yc(u,t,n,d,y,b,T,I){const F=ks(u.sub(t)._unit()._add(u),I,y,T,b);return r.ab.vec3.sub(F,n,F),r.ab.vec3.normalize(F,F),r.ab.vec3.scaleAndAdd(F,n,F,d)}function La(u,t,n,d,y,b,T,I,F,V,j,G,q,Q,ce,ae,de,pe){const Te=d?u-t:u+t;let ke=Te>0?1:-1,De=0;d&&(ke*=-1,De=Math.PI),ke<0&&(De+=Math.PI);let Ue=I+T+(ke>0?0:1)|0,Le=y,Ne=y,Oe=0,We=0;const Qe=Math.abs(Te),xt=[],ut=[];let Dt=b,At=Dt;const ot=()=>Yc(At,Dt,Ne,Qe-Oe+1,j,q,ae,de.canonical);for(;Oe+We<=Qe;){if(Ue+=ke,Ue<I||Ue>=F)return null;if(Ne=Le,At=Dt,xt.push(Ne),Q&&ut.push(At),Dt=new r.P(V.getx(Ue),V.gety(Ue)),Le=G[Ue],!Le){const $t=ks(Dt,de.canonical,j,ae,q);Le=$t[3]>0?G[Ue]=$t:ot()}Oe+=We,We=r.ab.vec3.distance(Ne,Le)}ce&&q&&(G[Ue]&&(Le=ot(),We=r.ab.vec3.distance(Ne,Le)),G[Ue]=Le);const wt=(Qe-Oe)/We,Vt=Dt.sub(At)._mult(wt)._add(At),st=r.ab.vec3.sub([],Le,Ne),It=r.ab.vec3.scaleAndAdd([],Ne,st,wt);let bt=[0,0,1],Kt=st[0],Bt=st[1];if(pe&&(bt=ae.upVector(de.canonical,Vt.x,Vt.y),bt[0]!==0||bt[1]!==0||bt[2]!==1)){const $t=[bt[2],0,-bt[0]],Xt=r.ab.vec3.cross([],bt,$t);r.ab.vec3.normalize($t,$t),r.ab.vec3.normalize(Xt,Xt),Kt=r.ab.vec3.dot(st,$t),Bt=r.ab.vec3.dot(st,Xt)}if(n){const $t=r.ab.vec3.cross([],bt,st);r.ab.vec3.normalize($t,$t),r.ab.vec3.scaleAndAdd(It,It,$t,n*ke)}const kt=De+Math.atan2(Bt,Kt);return xt.push(It),Q&&ut.push(Vt),{point:It,angle:kt,path:xt,tilePath:ut,up:bt}}function Qr(u,t){const n=t.length,d=n+4*u;t.resize(d),t.float32.fill(-1/0,4*n,4*d)}function ko(u,t,n){const d=t[0],y=t[1];return u[0]=n[0]*d+n[4]*y+n[12],u[1]=n[1]*d+n[5]*y+n[13],u[3]=n[3]*d+n[7]*y+n[15],u}const ws=100;class yn{constructor(t,n,d=new Oa(t.width+200,t.height+200,25),y=new Oa(t.width+200,t.height+200,25)){this.transform=t,this.grid=d,this.ignoredGrid=y,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ws,this.screenBottomBoundary=t.height+ws,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=n}placeCollisionBox(t,n,d,y,b,T,I,F){let V=d.projectedAnchorX,j=d.projectedAnchorY,G=d.projectedAnchorZ;const q=d.elevation,Q=d.tileID,ce=t.getProjection();if(q&&Q){const[Le,Ne,Oe]=ce.upVector(Q.canonical,d.tileAnchorX,d.tileAnchorY),We=ce.upVectorScale(Q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;V+=Le*q*We,j+=Ne*q*We,G+=Oe*q*We}const ae=this.projectAndGetPerspectiveRatio(I,V,j,G,d.tileID,ce.name==="globe"||!!q||this.transform.pitch>0,ce),de=T*ae.perspectiveRatio,pe=(d.x1*n+y.x-d.padding)*de+ae.point.x,Te=(d.y1*n+y.y-d.padding)*de+ae.point.y,ke=(d.x2*n+y.x+d.padding)*de+ae.point.x,De=(d.y2*n+y.y+d.padding)*de+ae.point.y,Ue=ae.perspectiveRatio<=.55||ae.occluded;return!this.isInsideGrid(pe,Te,ke,De)||!b&&this.grid.hitTest(pe,Te,ke,De,F)||Ue?{box:[],offscreen:!1,occluded:ae.occluded}:{box:[pe,Te,ke,De],offscreen:this.isOffscreen(pe,Te,ke,De),occluded:!1}}placeCollisionCircles(t,n,d,y,b,T,I,F,V,j,G,q,Q,ce,ae){const de=[],pe=this.transform.elevation,Te=t.getProjection(),ke=pe?pe.getAtTileOffsetFunc(ae,this.transform.center.lat,this.transform.worldSize,Te):null,De=new r.P(d.tileAnchorX,d.tileAnchorY);let{x:Ue,y:Le,z:Ne}=Te.projectTilePoint(De.x,De.y,ae.canonical);if(ke){const[Vt,st,It]=ke(De);Ue+=Vt,Le+=st,Ne+=It}const Oe=Te.name==="globe",We=this.projectAndGetPerspectiveRatio(I,Ue,Le,Ne,ae,Oe||!!pe||this.transform.pitch>0,Te),{perspectiveRatio:Qe}=We,xt=(G?T/Qe:T*Qe)/r.bw,ut=Js(Ue,Le,Ne,F),Dt=We.signedDistanceFromCamera>0?Yu(xt,b,d.lineOffsetX*xt,d.lineOffsetY*xt,!1,ut,De,d,y,F,{},pe&&!G?ke:null,G&&!!pe,Te,ae,G):null;let At=!1,ot=!1,wt=!0;if(Dt&&!We.occluded){const Vt=.5*Q*Qe+ce,st=new r.P(-100,-100),It=new r.P(this.screenRightBoundary,this.screenBottomBoundary),bt=new Tr,{first:Kt,last:Bt}=Dt,kt=Kt.path.length;let $t=[];for(let pi=kt-1;pi>=1;pi--)$t.push(Kt.path[pi]);for(let pi=1;pi<Bt.path.length;pi++)$t.push(Bt.path[pi]);const Xt=2.5*Vt;V&&($t=$t.map(([pi,Fi,Mi],Ci)=>(ke&&!Oe&&(Mi=ke(Ci<kt-1?Kt.tilePath[kt-1-Ci]:Bt.tilePath[Ci-kt+2])[2]),Js(pi,Fi,Mi,V))),$t.some(pi=>pi[3]<=0)&&($t=[]));let ci=[];if($t.length>0){let pi=1/0,Fi=-1/0,Mi=1/0,Ci=-1/0;for(const ji of $t)pi=Math.min(pi,ji[0]),Mi=Math.min(Mi,ji[1]),Fi=Math.max(Fi,ji[0]),Ci=Math.max(Ci,ji[1]);Fi>=st.x&&pi<=It.x&&Ci>=st.y&&Mi<=It.y&&(ci=[$t.map(ji=>new r.P(ji[0],ji[1]))],(pi<st.x||Fi>It.x||Mi<st.y||Ci>It.y)&&(ci=r.bu(ci,st.x,st.y,It.x,It.y)))}for(const pi of ci){bt.reset(pi,.25*Vt);let Fi=0;Fi=bt.length<=.5*Vt?1:Math.ceil(bt.paddedLength/Xt)+1;for(let Mi=0;Mi<Fi;Mi++){const Ci=Mi/Math.max(Fi-1,1),ji=bt.lerp(Ci),pr=ji.x+ws,Er=ji.y+ws;de.push(pr,Er,Vt,0);const dn=pr-Vt,$r=Er-Vt,$i=pr+Vt,lr=Er+Vt;if(wt=wt&&this.isOffscreen(dn,$r,$i,lr),ot=ot||this.isInsideGrid(dn,$r,$i,lr),!n&&this.grid.hitTestCircle(pr,Er,Vt,q)&&(At=!0,!j))return{circles:[],offscreen:!1,collisionDetected:At,occluded:!1}}}}return{circles:!j&&At||!ot?[]:de,offscreen:wt,collisionDetected:At,occluded:We.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let d=1/0,y=1/0,b=-1/0,T=-1/0;for(const j of t){const G=new r.P(j.x+ws,j.y+ws);d=Math.min(d,G.x),y=Math.min(y,G.y),b=Math.max(b,G.x),T=Math.max(T,G.y),n.push(G)}const I=this.grid.query(d,y,b,T).concat(this.ignoredGrid.query(d,y,b,T)),F={},V={};for(const j of I){const G=j.key;if(F[G.bucketInstanceId]===void 0&&(F[G.bucketInstanceId]={}),F[G.bucketInstanceId][G.featureIndex])continue;const q=[new r.P(j.x1,j.y1),new r.P(j.x2,j.y1),new r.P(j.x2,j.y2),new r.P(j.x1,j.y2)];r.bv(n,q)&&(F[G.bucketInstanceId][G.featureIndex]=!0,V[G.bucketInstanceId]===void 0&&(V[G.bucketInstanceId]=[]),V[G.bucketInstanceId].push(G.featureIndex))}return V}insertCollisionBox(t,n,d,y,b){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:y,collisionGroupID:b},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,d,y,b){const T=n?this.ignoredGrid:this.grid,I={bucketInstanceId:d,featureIndex:y,collisionGroupID:b};for(let F=0;F<t.length;F+=4)T.insertCircle(I,t[F],t[F+1],t[F+2])}projectAndGetPerspectiveRatio(t,n,d,y,b,T,I){const F=[n,d,y,1];let V=!1;y||this.transform.pitch>0?(r.ab.vec4.transformMat4(F,F,t),this.fogState&&b&&I.name!=="globe"&&(V=function(q,Q,ce,ae,de,pe){const Te=pe.calculateFogTileMatrix(de),ke=[Q,ce,ae];return r.ab.vec3.transformMat4(ke,ke,Te),Ke(q,r.ab.vec3.length(ke),pe.pitch,pe._fov)}(this.fogState,n,d,y,b.toUnwrapped(),this.transform)>.9)):ko(F,F,t);const j=F[3];return{point:new r.P((F[0]/j+1)/2*this.transform.width+ws,(-F[1]/j+1)/2*this.transform.height+ws),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/j*.5,1.5),signedDistanceFromCamera:j,occluded:T&&F[2]>j||V}}isOffscreen(t,n,d,y){return d<ws||t>=this.screenRightBoundary||y<ws||n>this.screenBottomBoundary}isInsideGrid(t,n,d,y){return d>=0&&t<this.gridRightBoundary&&y>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=r.ab.mat4.identity([]);return r.ab.mat4.translate(t,t,[-100,-100,0]),t}}function Xc(u,t,n){const d=t.createTileMatrix(u,u.worldSize,n.toUnwrapped());return r.ab.mat4.multiply(new Float32Array(16),u.projMatrix,d)}function Xo(u,t,n){if(t.projection.name===n.projection.name)return u.projMatrix;const d=n.clone();return d.setProjection(t.projection),Xc(d,t.getProjection(),u)}function Ga(u,t,n){return t.name===n.projection.name?u.projMatrix:Xc(n,t,u)}class Zc{constructor(t,n,d,y){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):y&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Oo{constructor(t,n,d,y,b,T=!1){this.text=new Zc(t?t.text:null,n,d,b),this.icon=new Zc(t?t.icon:null,n,y,b),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Kd{constructor(t,n,d,y=!1){this.text=t,this.icon=n,this.skipFade=d,this.clipped=y}}class Ra{constructor(){this.invProjMatrix=r.ab.mat4.create(),this.viewportMatrix=r.ab.mat4.create(),this.circles=[]}}class Jd{constructor(t,n,d,y,b){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=d,this.bucketIndex=y,this.tileID=b}}class Qd{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:d=>d.collisionGroupID===n}}return this.collisionGroups[t]}}function no(u,t,n,d,y){const{horizontalAlign:b,verticalAlign:T}=r.bD(u),I=-(b-.5)*t,F=-(T-.5)*n,V=r.bC(u,d);return new r.P(I+V[0]*y,F+V[1]*y)}function ep(u,t,n,d,y){const b=new r.P(u,t);return n&&b._rotate(d?y:-y),b}class Nh{constructor(t,n,d,y,b,T){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new yn(this.transform,b),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new Qd(d),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,d,y,b=1){const T=d.getBucket(n),I=d.latestFeatureIndex;if(!T||!I||n.fqid!==T.layerIds[0])return;const F=T.layers[0].layout,V=T.layers[0].paint,j=d.collisionBoxArray,G=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),q=d.tileSize/r.ag,Q=d.tileID.toUnwrapped();this.transform.setProjection(T.projection);const ce=(ae=d.tileID,de=T.getProjection(),pe=this.transform,de.name===this.projection?pe.calculateProjMatrix(ae.toUnwrapped()):Xc(pe,de,ae));var ae,de,pe;const Te=F.get("text-pitch-alignment")==="map",ke=F.get("text-rotation-alignment")==="map";n.compileFilter(n.options);const De=n.dynamicFilter(),Ue=n.dynamicFilterNeedsFeature(),Le=this.transform.calculatePixelsToTileUnitsMatrix(d),Ne=wn(ce,d.tileID.canonical,Te,ke,this.transform,T.getProjection(),Le);let Oe=null;if(Te){const Vt=Zd(ce,d.tileID.canonical,Te,ke,this.transform,T.getProjection(),Le);Oe=r.ab.mat4.multiply([],this.transform.labelPlaneMatrix,Vt)}let We=null;De&&d.latestFeatureIndex&&(We={unwrappedTileID:Q,dynamicFilter:De,dynamicFilterNeedsFeature:Ue}),this.retainedQueryData[T.bucketInstanceId]=new Jd(T.bucketInstanceId,I,T.sourceLayerIndex,T.index,d.tileID);const[Qe,xt]=T.layers[0].layout.get("text-size-scale-range"),ut=r.aw(b,Qe,xt),[Dt,At]=F.get("icon-size-scale-range"),ot=r.aw(b,Dt,At),wt={bucket:T,layout:F,paint:V,posMatrix:ce,textLabelPlaneMatrix:Ne,labelToScreenMatrix:Oe,clippingData:We,scale:G,textPixelRatio:q,holdingForFade:d.holdingForFade(),collisionBoxArray:j,partiallyEvaluatedTextSize:r.bp(T.textSizeData,this.transform.zoom,ut),partiallyEvaluatedIconSize:r.bp(T.iconSizeData,this.transform.zoom,ot),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(y)for(const Vt of T.sortKeyRanges){const{sortKey:st,symbolInstanceStart:It,symbolInstanceEnd:bt}=Vt;t.push({sortKey:st,symbolInstanceStart:It,symbolInstanceEnd:bt,parameters:wt})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:wt})}attemptAnchorPlacement(t,n,d,y,b,T,I,F,V,j,G,q,Q,ce,ae,de,pe,Te){const{textOffset0:ke,textOffset1:De,crossTileID:Ue}=q,Le=[ke,De],Ne=no(t,d,y,Le,b),Oe=this.collisionIndex.placeCollisionBox(ce,b,n,ep(Ne.x,Ne.y,T,I,this.transform.angle),G,F,V,j.predicate);if(de){const We=ce.getSymbolInstanceIconSize(Te,this.transform.zoom,q.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ce,We,de,ep(Ne.x,Ne.y,T,I,this.transform.angle),G,F,V,j.predicate).box.length===0)return}if(Oe.box.length>0){let We;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ue]&&this.prevPlacement.placements[Ue]&&this.prevPlacement.placements[Ue].text&&(We=this.prevPlacement.variableOffsets[Ue].anchor),this.variableOffsets[Ue]={textOffset:Le,width:d,height:y,anchor:t,textScale:b,prevAnchor:We},this.markUsedJustification(ce,t,q,ae),ce.allowVerticalPlacement&&(this.markUsedOrientation(ce,ae,q),this.placedOrientations[Ue]=ae),{shift:Ne,placedGlyphBoxes:Oe}}}placeLayerBucketPart(t,n,d,y,b=1){const{bucket:T,layout:I,paint:F,posMatrix:V,textLabelPlaneMatrix:j,labelToScreenMatrix:G,clippingData:q,textPixelRatio:Q,holdingForFade:ce,collisionBoxArray:ae,partiallyEvaluatedTextSize:de,partiallyEvaluatedIconSize:pe,collisionGroup:Te,latestFeatureIndex:ke}=t.parameters,De=I.get("text-optional"),Ue=I.get("icon-optional"),Le=I.get("text-allow-overlap"),Ne=I.get("icon-allow-overlap"),Oe=I.get("text-rotation-alignment")==="map",We=I.get("text-pitch-alignment")==="map",Qe=I.get("symbol-z-elevate"),xt=F.get("symbol-z-offset"),ut=I.get("symbol-elevation-reference")==="sea",[Dt,At]=I.get("text-size-scale-range"),[ot,wt]=I.get("icon-size-scale-range"),Vt=r.aw(b,Dt,At),st=r.aw(b,ot,wt);this.transform.setProjection(T.projection);let It=Le&&(Ne||!T.hasIconData()||Ue),bt=Ne&&(Le||!T.hasTextData()||De);const Kt=!xt.isConstant();!T.collisionArrays&&ae&&T.deserializeCollisionBoxes(ae),d&&y&&T.updateCollisionDebugBuffers(this.transform.zoom,ae,Vt,st);const Bt=(kt,$t,Xt)=>{const{crossTileID:ci,numVerticalGlyphVertices:pi}=kt;let Fi=null;if(q&&q.dynamicFilterNeedsFeature||Kt){const Hr=this.retainedQueryData[T.bucketInstanceId];Fi=ke.loadFeature({featureIndex:kt.featureIndex,bucketIndex:Hr.bucketIndex,sourceLayerIndex:Hr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(q&&!(0,q.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Fi,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new r.P(kt.tileAnchorX,kt.tileAnchorY),this.transform.calculateDistanceTileData(q.unwrappedTileID)))return this.placements[ci]=new Kd(!1,!1,!1,!0),void n.add(ci);const Mi=xt.evaluate(Fi,{});if(n.has(ci))return;if(ce)return void(this.placements[ci]=new Kd(!1,!1,!1));let Ci=!1,ji=!1,pr=!0,Er=!1,dn=!1,$r=null,$i={box:null,offscreen:null,occluded:null},lr={box:null},bi=null,or=null,Ir=null,Mr=0,pn=0,ns=0;Xt.textFeatureIndex?Mr=Xt.textFeatureIndex:kt.useRuntimeCollisionCircles&&(Mr=kt.featureIndex),Xt.verticalTextFeatureIndex&&(pn=Xt.verticalTextFeatureIndex);const Tn=Hr=>{Hr.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const Br=this.transform.elevation;Hr.elevation=ut?Mi:Mi+(Br?Br.getAtTileOffset(Hr.tileID,Hr.tileAnchorX,Hr.tileAnchorY):0),Hr.elevation+=kt.zOffset},qn=Xt.textBox;if(qn){Tn(qn);const Hr=mr=>{let In=r.bq.horizontal;if(T.allowVerticalPlacement&&!mr&&this.prevPlacement){const Yn=this.prevPlacement.placedOrientations[ci];Yn&&(this.placedOrientations[ci]=Yn,In=Yn,this.markUsedOrientation(T,In,kt))}return In},Br=(mr,In)=>{if(T.allowVerticalPlacement&&pi>0&&Xt.verticalTextBox){for(const Yn of T.writingModes)if(Yn===r.bq.vertical?($i=In(),lr=$i):$i=mr(),$i&&$i.box&&$i.box.length)break}else $i=mr()};if(I.get("text-variable-anchor")){let mr=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ci]){const jr=this.prevPlacement.variableOffsets[ci];mr.indexOf(jr.anchor)>0&&(mr=mr.filter(zs=>zs!==jr.anchor),mr.unshift(jr.anchor))}const In=(jr,zs,ta)=>{const Eo=T.getSymbolInstanceTextSize(de,kt,this.transform.zoom,$t),ho=(jr.x2-jr.x1)*Eo+2*jr.padding,Vo=(jr.y2-jr.y1)*Eo+2*jr.padding,Uo=kt.hasIconTextFit&&!Ne?zs:null;Uo&&Tn(Uo);let jo={box:[],offscreen:!1,occluded:!1};const nl=Le?2*mr.length:mr.length;for(let $o=0;$o<nl;++$o){const Ec=this.attemptAnchorPlacement(mr[$o%mr.length],jr,ho,Vo,Eo,Oe,We,Q,V,Te,$o>=mr.length,kt,$t,T,ta,Uo,de,pe);if(Ec&&(jo=Ec.placedGlyphBoxes,jo&&jo.box&&jo.box.length)){Ci=!0,$r=Ec.shift;break}}return jo};Br(()=>In(qn,Xt.iconBox,r.bq.horizontal),()=>{const jr=Xt.verticalTextBox;return jr&&Tn(jr),T.allowVerticalPlacement&&!($i&&$i.box&&$i.box.length)&&pi>0&&jr?In(jr,Xt.verticalIconBox,r.bq.vertical):{box:null,offscreen:null,occluded:null}}),$i&&(Ci=$i.box,pr=$i.offscreen,Er=$i.occluded);const Yn=Hr(!(!$i||!$i.box));if(!Ci&&this.prevPlacement){const jr=this.prevPlacement.variableOffsets[ci];jr&&(this.variableOffsets[ci]=jr,this.markUsedJustification(T,jr.anchor,kt,Yn))}}else{const mr=(In,Yn)=>{const jr=T.getSymbolInstanceTextSize(de,kt,this.transform.zoom,$t,b),zs=this.collisionIndex.placeCollisionBox(T,jr,In,new r.P(0,0),Le,Q,V,Te.predicate);return zs&&zs.box&&zs.box.length&&(this.markUsedOrientation(T,Yn,kt),this.placedOrientations[ci]=Yn),zs};Br(()=>mr(qn,r.bq.horizontal),()=>{const In=Xt.verticalTextBox;return T.allowVerticalPlacement&&pi>0&&In?(Tn(In),mr(In,r.bq.vertical)):{box:null,offscreen:null,occluded:null}}),Hr(!!($i&&$i.box&&$i.box.length))}}if(bi=$i,Ci=bi&&bi.box&&bi.box.length>0,pr=bi&&bi.offscreen,Er=bi&&bi.occluded,kt.useRuntimeCollisionCircles){const Hr=T.text.placedSymbolArray.get(kt.centerJustifiedTextSymbolIndex>=0?kt.centerJustifiedTextSymbolIndex:kt.verticalPlacedTextSymbolIndex),Br=r.br(T.textSizeData,de,Hr),mr=I.get("text-padding");or=this.collisionIndex.placeCollisionCircles(T,Le,Hr,T.lineVertexArray,T.glyphOffsetArray,Br,V,j,G,d,We,Te.predicate,kt.collisionCircleDiameter*Br/r.bw,mr,this.retainedQueryData[T.bucketInstanceId].tileID),Ci=Le||or.circles.length>0&&!or.collisionDetected,pr=pr&&or.offscreen,Er=or.occluded}if(Xt.iconFeatureIndex&&(ns=Xt.iconFeatureIndex),Xt.iconBox){const Hr=Br=>{Tn(Br);const mr=kt.hasIconTextFit&&$r?ep($r.x,$r.y,Oe,We,this.transform.angle):new r.P(0,0),In=T.getSymbolInstanceIconSize(pe,this.transform.zoom,kt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,In,Br,mr,Ne,Q,V,Te.predicate)};lr&&lr.box&&lr.box.length&&Xt.verticalIconBox?(Ir=Hr(Xt.verticalIconBox),ji=Ir.box.length>0):(Ir=Hr(Xt.iconBox),ji=Ir.box.length>0),pr=pr&&Ir.offscreen,dn=Ir.occluded}const Co=De||kt.numHorizontalGlyphVertices===0&&pi===0,Gs=Ue||kt.numIconVertices===0;if(Co||Gs?Gs?Co||(ji=ji&&Ci):Ci=ji&&Ci:ji=Ci=ji&&Ci,Ci&&bi&&bi.box&&this.collisionIndex.insertCollisionBox(bi.box,I.get("text-ignore-placement"),T.bucketInstanceId,lr&&lr.box&&pn?pn:Mr,Te.ID),ji&&Ir&&this.collisionIndex.insertCollisionBox(Ir.box,I.get("icon-ignore-placement"),T.bucketInstanceId,ns,Te.ID),or&&(Ci&&this.collisionIndex.insertCollisionCircles(or.circles,I.get("text-ignore-placement"),T.bucketInstanceId,Mr,Te.ID),d)){const Hr=T.bucketInstanceId;let Br=this.collisionCircleArrays[Hr];Br===void 0&&(Br=this.collisionCircleArrays[Hr]=new Ra);for(let mr=0;mr<or.circles.length;mr+=4)Br.circles.push(or.circles[mr+0]),Br.circles.push(or.circles[mr+1]),Br.circles.push(or.circles[mr+2]),Br.circles.push(or.collisionDetected?1:0)}const rn=T.projection.name!=="globe";It=It&&(rn||!Er),bt=bt&&(rn||!dn),this.placements[ci]=new Kd(Ci||It,ji||bt,pr||T.justReloaded),n.add(ci)};if(Qe&&this.buildingIndex&&(this.buildingIndex.updateZOffset(T,this.retainedQueryData[T.bucketInstanceId].tileID),T.updateZOffset()),T.sortFeaturesByY){const kt=T.getSortedSymbolIndexes(this.transform.angle);for(let $t=kt.length-1;$t>=0;--$t){const Xt=kt[$t];Bt(T.symbolInstances.get(Xt),Xt,T.collisionArrays[Xt])}T.hasAnyZOffset&&r.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const kt=T.getSortedIndexesByZOffset();for(let $t=0;$t<kt.length;++$t){const Xt=kt[$t];Bt(T.symbolInstances.get(Xt),Xt,T.collisionArrays[Xt])}}else for(let kt=t.symbolInstanceStart;kt<t.symbolInstanceEnd;kt++)Bt(T.symbolInstances.get(kt),kt,T.collisionArrays[kt]);if(d&&T.bucketInstanceId in this.collisionCircleArrays){const kt=this.collisionCircleArrays[T.bucketInstanceId];r.ab.mat4.invert(kt.invProjMatrix,V),kt.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(t,n,d,y){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:F,crossTileID:V}=d,j=r.bB(n),G=y===r.bq.vertical?F:j==="left"?b:j==="center"?T:j==="right"?I:-1;b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=G>=0&&b!==G?0:V),T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=G>=0&&T!==G?0:V),I>=0&&(t.text.placedSymbolArray.get(I).crossTileID=G>=0&&I!==G?0:V),F>=0&&(t.text.placedSymbolArray.get(F).crossTileID=G>=0&&F!==G?0:V)}markUsedOrientation(t,n,d){const y=n===r.bq.horizontal||n===r.bq.horizontalOnly?n:0,b=n===r.bq.vertical?n:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:F,verticalPlacedTextSymbolIndex:V}=d,j=t.text.placedSymbolArray;T>=0&&(j.get(T).placedOrientation=y),I>=0&&(j.get(I).placedOrientation=y),F>=0&&(j.get(F).placedOrientation=y),V>=0&&(j.get(V).placedOrientation=b)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let d=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const y=n?n.symbolFadeChange(t):1,b=n?n.opacities:{},T=n?n.variableOffsets:{},I=n?n.placedOrientations:{};for(const F in this.placements){const V=this.placements[F],j=b[F];j?(this.opacities[F]=new Oo(j,y,V.text,V.icon,null,V.clipped),d=d||V.text!==j.text.placed||V.icon!==j.icon.placed):(this.opacities[F]=new Oo(null,y,V.text,V.icon,V.skipFade,V.clipped),d=d||V.text||V.icon)}for(const F in b){const V=b[F];if(!this.opacities[F]){const j=new Oo(V,y,!1,!1);j.isHidden()||(this.opacities[F]=j,d=d||V.text.placed||V.icon.placed)}}for(const F in T)this.variableOffsets[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.variableOffsets[F]=T[F]);for(const F in I)this.placedOrientations[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.placedOrientations[F]=I[F]);d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n,d,y){const b=new Set;for(const T of n){const I=T.getBucket(t);I&&T.latestFeatureIndex&&t.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,b,T,T.collisionBoxArray,d,y,T.tileID,t.scope),I.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(I,T.tileID),I.updateZOffset()))}}updateBucketOpacities(t,n,d,y,b,T,I,F){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const V=t.layers[0].layout,j=t.layers[0].paint,G=!!t.layers[0].dynamicFilter(),q=new Oo(null,0,!1,!1,!0),Q=V.get("text-allow-overlap"),ce=V.get("icon-allow-overlap"),ae=V.get("text-variable-anchor"),de=V.get("text-rotation-alignment")==="map",pe=V.get("text-pitch-alignment")==="map",Te=j.get("symbol-z-offset"),ke=V.get("symbol-elevation-reference")==="sea",De=!Te.isConstant(),Ue=new Oo(null,0,Q&&(ce||!t.hasIconData()||V.get("icon-optional")),ce&&(Q||!t.hasTextData()||V.get("text-optional")),!0);!t.collisionArrays&&y&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(y);const Le=(Oe,We,Qe)=>{for(let xt=0;xt<We/4;xt++)Oe.opacityVertexArray.emplaceBack(Qe)};let Ne=0;T&&t.updateReplacement(I,T);for(let Oe=0;Oe<t.symbolInstances.length;Oe++){const We=t.symbolInstances.get(Oe),{numHorizontalGlyphVertices:Qe,numVerticalGlyphVertices:xt,crossTileID:ut,numIconVertices:Dt,tileAnchorX:At,tileAnchorY:ot}=We;let wt=null;const Vt=this.retainedQueryData[t.bucketInstanceId];De&&We&&Vt&&(wt=d.latestFeatureIndex.loadFeature({featureIndex:We.featureIndex,bucketIndex:Vt.bucketIndex,sourceLayerIndex:Vt.sourceLayerIndex,layoutVertexArrayOffset:0}));const st=Te.evaluate(wt,{}),It=n.has(ut);let bt=this.opacities[ut];It?bt=q:bt||(bt=Ue,this.opacities[ut]=bt),n.add(ut);const Kt=Qe>0||xt>0,Bt=Dt>0,kt=this.placedOrientations[ut],$t=kt===r.bq.vertical,Xt=kt===r.bq.horizontal||kt===r.bq.horizontalOnly;!Kt&&!Bt||bt.isHidden()||Ne++;let ci=!1;if((Kt||Bt)&&T)for(const pi of t.activeReplacements){if(r.bx(pi,b,r.by.Symbol,F)||pi.min.x>At||At>pi.max.x||pi.min.y>ot||ot>pi.max.y)continue;const Fi=r.bz(At,ot,I.canonical,pi.footprintTileId.canonical);if(ci=r.bA(Fi,pi.footprint),ci)break}if(Kt){const pi=ci?Wa:Vh(bt.text);Le(t.text,Qe,$t?Wa:pi),Le(t.text,xt,Xt?Wa:pi);const Fi=bt.text.isHidden(),{leftJustifiedTextSymbolIndex:Mi,centerJustifiedTextSymbolIndex:Ci,rightJustifiedTextSymbolIndex:ji,verticalPlacedTextSymbolIndex:pr}=We,Er=t.text.placedSymbolArray,dn=Fi||$t?1:0;Mi>=0&&(Er.get(Mi).hidden=dn),Ci>=0&&(Er.get(Ci).hidden=dn),ji>=0&&(Er.get(ji).hidden=dn),pr>=0&&(Er.get(pr).hidden=Fi||Xt?1:0);const $r=this.variableOffsets[ut];$r&&this.markUsedJustification(t,$r.anchor,We,kt);const $i=this.placedOrientations[ut];$i&&(this.markUsedJustification(t,"left",We,$i),this.markUsedOrientation(t,$i,We))}if(Bt){const pi=ci?Wa:Vh(bt.icon),{placedIconSymbolIndex:Fi,verticalPlacedIconSymbolIndex:Mi}=We,Ci=t.icon.placedSymbolArray,ji=bt.icon.isHidden()?1:0;Fi>=0&&(Le(t.icon,Dt,$t?Wa:pi),Ci.get(Fi).hidden=ji),Mi>=0&&(Le(t.icon,We.numVerticalIconVertices,Xt?Wa:pi),Ci.get(Mi).hidden=ji)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const pi=t.collisionArrays[Oe];if(pi){let Fi=new r.P(0,0),Mi=!0;if(pi.textBox||pi.verticalTextBox){if(ae){const ji=this.variableOffsets[ut];ji?(Fi=no(ji.anchor,ji.width,ji.height,ji.textOffset,ji.textScale),de&&Fi._rotate(pe?this.transform.angle:-this.transform.angle)):Mi=!1}G&&(Mi=!bt.clipped),pi.textBox&&Xu(t.textCollisionBox.collisionVertexArray,bt.text.placed,!Mi||$t,st,ke,Fi.x,Fi.y),pi.verticalTextBox&&Xu(t.textCollisionBox.collisionVertexArray,bt.text.placed,!Mi||Xt,st,ke,Fi.x,Fi.y)}const Ci=Mi&&!!(!Xt&&pi.verticalIconBox);pi.iconBox&&Xu(t.iconCollisionBox.collisionVertexArray,bt.icon.placed,Ci,st,ke,We.hasIconTextFit?Fi.x:0,We.hasIconTextFit?Fi.y:0),pi.verticalIconBox&&Xu(t.iconCollisionBox.collisionVertexArray,bt.icon.placed,!Ci,st,ke,We.hasIconTextFit?Fi.x:0,We.hasIconTextFit?Fi.y:0)}}}if(t.fullyClipped=Ne===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const Oe=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Oe.invProjMatrix,t.placementViewportMatrix=Oe.viewportMatrix,t.collisionCircleArray=Oe.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const d=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*d>t}setStale(){this.stale=!0}}function Xu(u,t,n,d,y,b,T){u.emplaceBack(t?1:0,n?1:0,b||0,T||0,d,y?1:0),u.emplaceBack(t?1:0,n?1:0,b||0,T||0,d,y?1:0),u.emplaceBack(t?1:0,n?1:0,b||0,T||0,d,y?1:0),u.emplaceBack(t?1:0,n?1:0,b||0,T||0,d,y?1:0)}const Ql=Math.pow(2,25),Vm=Math.pow(2,24),Um=Math.pow(2,17),Zu=Math.pow(2,16),Kc=Math.pow(2,9),Jc=Math.pow(2,8),ec=Math.pow(2,1);function Vh(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,n=Math.floor(127*u.opacity);return n*Ql+t*Vm+n*Um+t*Zu+n*Kc+t*Jc+n*ec+t}const Wa=0;class yl{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,n,d,y,b,T){const I=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(I,y,t[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((F,V)=>F.sortKey-V.sortKey));this._currentPartIndex<I.length;){const F=I[this._currentPartIndex];if(n.placeLayerBucketPart(F,this._seenCrossTileIDs,d,F.symbolInstanceStart===0,T),this._currentPartIndex++,b())return!0}return!1}}class jm{constructor(t,n,d,y,b,T,I,F,V){this.placement=new Nh(t,b,T,I,F,V),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(t,n,d,y,b){const T=r.q.now(),I=()=>{const F=r.q.now()-T;return!this._forceFullPlacement&&F>2};for(;this._currentPlacementIndex>=0;){const F=n[t[this._currentPlacementIndex]],V=this.placement.collisionIndex.transform.zoom;if(F.type==="symbol"&&(!F.minzoom||F.minzoom<=V)&&(!F.maxzoom||F.maxzoom>V)){const j=F,G=j.layout.get("symbol-z-elevate"),q=j.layout.get("symbol-sort-key").constantOr(1)!==void 0,Q=j.layout.get("symbol-z-order"),ce=Q==="viewport-y"||Q==="auto"&&!(Q!=="viewport-y"&&q),ae=j.layout.get("text-allow-overlap")||j.layout.get("icon-allow-overlap")||j.layout.get("text-ignore-placement")||j.layout.get("icon-ignore-placement"),de=ce&&ae,pe=this._inProgressLayer=this._inProgressLayer||new yl(j),Te=r.aC(F.source,F.scope);if(pe.continuePlacement(G||de?y[Te]:d[Te],this.placement,this._showCollisionBoxes,F,I,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const tc=512/r.ag/2;class tp{constructor(t,n,d){this.tileID=t,this.bucketInstanceId=d,this.index=new r.bE(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=t.canonical.x*r.ag,b=t.canonical.y*r.ag;for(let T=0;T<n.length;T++){const{key:I,crossTileID:F,tileAnchorX:V,tileAnchorY:j}=n.get(T),G=Math.floor((y+V)*tc),q=Math.floor((b+j)*tc);this.index.add(G,q),this.keys.push(I),this.crossTileIDs.push(F)}this.index.finish()}findMatches(t,n,d){const y=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),b=tc/Math.pow(2,n.canonical.z-this.tileID.canonical.z),T=n.canonical.x*r.ag,I=n.canonical.y*r.ag;for(let F=0;F<t.length;F++){const V=t.get(F);if(V.crossTileID)continue;const{key:j,tileAnchorX:G,tileAnchorY:q}=V,Q=Math.floor((T+G)*b),ce=Math.floor((I+q)*b),ae=this.index.range(Q-y,ce-y,Q+y,ce+y);for(const de of ae){const pe=this.crossTileIDs[de];if(this.keys[de]===j&&!d.has(pe)){d.add(pe),V.crossTileID=pe;break}}}}}class Ku{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Uh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const d in this.indexes){const y=this.indexes[d],b={};for(const T in y){const I=y[T];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+n),b[I.tileID.key]=I}this.indexes[d]=b}this.lng=t}addBucket(t,n,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let b=0;b<n.symbolInstances.length;b++)n.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const y=this.usedCrossTileIDs[t.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>t.overscaledZ)for(const I in T){const F=T[I];F.tileID.isChildOf(t)&&F.findMatches(n.symbolInstances,t,y)}else{const I=T[t.scaledTo(Number(b)).key];I&&I.findMatches(n.symbolInstances,t,y)}}for(let b=0;b<n.symbolInstances.length;b++){const T=n.symbolInstances.get(b);T.crossTileID||(T.crossTileID=d.generate(),y.add(T.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new tp(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const d of n.crossTileIDs)this.usedCrossTileIDs[t].delete(d)}removeStaleBuckets(t){let n=!1;for(const d in this.indexes){const y=this.indexes[d];for(const b in y)t[y[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,y[b]),delete y[b],n=!0)}return n}}class ip{constructor(){this.layerIndexes={},this.crossTileIDs=new Ku,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,d,y){let b=this.layerIndexes[t.fqid];b===void 0&&(b=this.layerIndexes[t.fqid]=new Uh);let T=!1;const I={};y.name!=="globe"&&b.handleWrapJump(d);for(const F of n){const V=F.getBucket(t);V&&t.fqid===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(F.tileID,V,this.crossTileIDs)&&(T=!0),I[V.bucketInstanceId]=!0)}return b.removeStaleBuckets(I)&&(T=!0),T}pruneUnusedLayers(t){const n={};t.forEach(d=>{n[d]=!0});for(const d in this.layerIndexes)n[d]||delete this.layerIndexes[d]}}const vl=771;class Xi{constructor(t,n,d,y){this.blendFunction=t,this.blendColor=n,this.mask=d,this.blendEquation=y}}Xi.Replace=[1,0,1,0],Xi.disabled=new Xi(Xi.Replace,r.aj.transparent,[!1,!1,!1,!1]),Xi.unblended=new Xi(Xi.Replace,r.aj.transparent,[!0,!0,!0,!0]),Xi.alphaBlended=new Xi([1,vl,1,vl],r.aj.transparent,[!0,!0,!0,!0]),Xi.alphaBlendedNonPremultiplied=new Xi([770,vl,770,vl],r.aj.transparent,[!0,!0,!0,!0]),Xi.multiply=new Xi([774,0,774,0],r.aj.transparent,[!0,!0,!0,!0]);class Si{constructor(t,n,d){this.func=t,this.mask=n,this.range=d}}Si.ReadOnly=!1,Si.ReadWrite=!0,Si.disabled=new Si(519,Si.ReadOnly,[0,1]);const jh=7680;class Oi{constructor(t,n,d,y,b,T){this.test=t,this.ref=n,this.mask=d,this.fail=y,this.depthFail=b,this.pass=T}}Oi.disabled=new Oi({func:519,mask:0},0,0,jh,jh,jh);const Qc=1029,xl=2305;class zi{constructor(t,n,d){this.enable=t,this.mode=n,this.frontFace=d}}function eu(u,t){const n=r.bG(u,3);r.ab.mat4.fromQuat(u,t),r.bI(u,3,n)}function qa(u,t){const n=r.ab.quat.identity([]);return r.ab.quat.rotateZ(n,n,-t),r.ab.quat.rotateX(n,n,-u),n}function Ju(u,t){const n=[u[0],u[1],0],d=[t[0],t[1],0];if(r.ab.vec3.length(n)>=1e-15){const T=r.ab.vec3.normalize([],n);r.ab.vec3.scale(d,T,r.ab.vec3.dot(d,T)),t[0]=d[0],t[1]=d[1]}const y=r.ab.vec3.cross([],t,u);if(r.ab.vec3.len(y)<1e-15)return null;const b=Math.atan2(-y[1],y[0]);return qa(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),b)}zi.disabled=new zi(!1,Qc,xl),zi.backCCW=new zi(!0,Qc,xl),zi.backCW=new zi(!0,Qc,2304),zi.frontCW=new zi(!0,1028,2304),zi.frontCCW=new zi(!0,1028,xl);class $h{constructor(t,n){this.position=t,this.orientation=n}get position(){return this._position}set position(t){if(t){const n=t instanceof r.aa?t:new r.aa(t[0],t[1],t[2]);this._renderWorldCopies&&(n.x=r.bF(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(t,n){if(this.orientation=null,!this.position)return;const d=this.position,y=this._elevation?this._elevation.getAtPointOrZero(r.aa.fromLngLat(t)):0,b=r.aa.fromLngLat(t,y),T=[b.x-d.x,b.y-d.y,b.z-d.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=Ju(T,n)}setPitchBearing(t,n){this.orientation=qa(r.ai(t),r.ai(-n))}}class so{constructor(t,n){this._transform=r.ab.mat4.identity([]),this.orientation=n,this.position=t}get mercatorPosition(){const t=this.position;return new r.aa(t[0],t[1],t[2])}get position(){const t=r.bG(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var n;t&&r.bI(this._transform,3,[(n=t)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||r.ab.quat.identity([]),t&&eu(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,n){this._orientation=qa(t,n),eu(this._transform,this._orientation)}forward(){const t=r.bG(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=r.bG(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=r.bG(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,n){const d=new Float64Array(16);return r.ab.mat4.invert(d,this.getWorldToCamera(t,n)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,n,d){const y=this.position;r.ab.vec3.scale(y,y,-t);const b=new Float64Array(16);return r.ab.mat4.fromScaling(b,[d,d,d]),r.ab.mat4.translate(b,b,y),b[10]*=n,b}getWorldToCamera(t,n){const d=new Float64Array(16),y=new Float64Array(4),b=this.position;return r.ab.quat.conjugate(y,this._orientation),r.ab.vec3.scale(b,b,-t),r.ab.mat4.fromQuat(d,y),r.ab.mat4.translate(d,d,b),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=n,d[9]*=n,d[10]*=n,d[11]*=n,d}getCameraToClipPerspective(t,n,d,y){const b=new Float64Array(16);return r.ab.mat4.perspective(b,t,n,d,y),b}getCameraToClipOrthographic(t,n,d,y,b,T){const I=new Float64Array(16);return r.ab.mat4.ortho(I,t,n,d,y,b,T),I}getDistanceToElevation(t,n=!1){const d=t===0?0:r.bH(t,n?r.aS(this.position[1]):this.position[1]),y=this.forward();return(d-this.position[2])/y[2]}clone(){return new so([...this.position],[...this.orientation])}}const Os={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ei{constructor(t=0,n=0,d=0,y=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(d)||d<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=d,this.right=y}interpolate(t,n,d){return n.top!=null&&t.top!=null&&(this.top=r.af(t.top,n.top,d)),n.bottom!=null&&t.bottom!=null&&(this.bottom=r.af(t.bottom,n.bottom,d)),n.left!=null&&t.left!=null&&(this.left=r.af(t.left,n.left,d)),n.right!=null&&t.right!=null&&(this.right=r.af(t.right,n.right,d)),this}getCenter(t,n){const d=r.aw((this.left+t-this.right)/2,0,t),y=r.aw((this.top+n-this.bottom)/2,0,n);return new r.P(d,y)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ei(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const rp=(u,t,n)=>(1-n)*u+n*t,Hh=u=>u*u*u*u*u;class za{constructor(t,n,d,y,b,T,I){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=d??0,this._maxPitch=y??60,this.setProjection(T),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new r.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ei,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new so,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new za(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,n=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(t||d)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return r.ay(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=r.bP(this.projectionOptions);const d=this.getProjection(),y=!r.bn(n,d);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.bP({name:"mercator"});const n=t!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bF(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const n=-t*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=r.ab.mat2.create(),r.ab.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=r.aw(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=r.ai(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let y=0,b=0;for(let T=0;T<n.length;T++){const I=new r.P(n[T][0]*this.width,d+n[T][1]*(this.height-d)),F=t.pointCoordinate(I);if(!F)continue;const V=1/Math.hypot(F[0]-this._camera.position[0],F[1]-this._camera.position[1]);y+=F[3]*V,b+=V}return b===0?NaN:y/b}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*n,y=this._mercatorZfromZoom(t),b=this._mercatorZfromZoom(this._maxZoom),T=Math.max(y-d,b);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let d;d=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const y=r.ab.vec3.length(r.ab.vec3.sub([],this._camera.position,d));return r.aw(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!r.ab.quat.exactEquals(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const d=[t.position.x,t.position.y,t.position.z];r.ab.vec3.exactEquals(d,this._camera.position)||(this._setCameraPosition(d),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new $h;return n.position=new r.aa(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(t){if(!r.ab.quat.length(t))return!1;r.ab.quat.normalize(t,t);const n=r.ab.vec3.transformQuat([],[0,0,-1],t),d=r.ab.vec3.transformQuat([],[0,-1,0],t);if(d[2]<0)return!1;const y=Ju(n,d);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;t[2]=r.aw(t[2],y/d,y/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,d){this._unmodified=!1,this._edgeInsets.interpolate(t,n,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new r.bQ(0,t)];if(this.renderWorldCopies){const d=this.pointCoordinate(new r.P(0,0)),y=this.pointCoordinate(new r.P(this.width,0)),b=this.pointCoordinate(new r.P(this.width,this.height)),T=this.pointCoordinate(new r.P(0,this.height)),I=Math.floor(Math.min(d.x,y.x,b.x,T.x)),F=Math.floor(Math.max(d.x,y.x,b.x,T.x)),V=1;for(let j=I-V;j<=F+V;j++)j!==0&&n.push(new r.bQ(j,t))}return n}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,n,d){let y=[];const b=d!==void 0,T=!b;if(T&&this.zoom<n||b&&d[0]===0&&d[1]===0)return y;const I=new Set,F=(j,G,q,Q,ce)=>{const ae=r.c5(G,j,q,Q,ce);I.has(ae)||(y.push(new r.aG(j,G,q,Q,ce)),I.add(ae))};for(let j=0;j<t.length;j++){const G=t[j];if(T&&G.canonical.z!==n)continue;const q=G.canonical,Q=G.overscaledZ,ce=G.wrap,ae=1<<q.z,de=q.x+1<ae,pe=q.x>0,Te=q.y+1<ae,ke=q.y>0,De=G.wrap-(pe?0:1),Ue=G.wrap+(de?0:1),Le=pe?q.x-1:ae-1,Ne=de?q.x+1:0;if(b)d[0]<0?(F(Q,Ue,q.z,Ne,q.y),d[1]<0&&Te&&(F(Q,ce,q.z,q.x,q.y+1),F(Q,Ue,q.z,Ne,q.y+1)),d[1]>0&&ke&&(F(Q,ce,q.z,q.x,q.y-1),F(Q,Ue,q.z,Ne,q.y-1))):d[0]>0?(F(Q,De,q.z,Le,q.y),d[1]<0&&Te&&(F(Q,ce,q.z,q.x,q.y+1),F(Q,De,q.z,Le,q.y+1)),d[1]>0&&ke&&(F(Q,ce,q.z,q.x,q.y-1),F(Q,De,q.z,Le,q.y-1))):d[1]<0&&Te?F(Q,ce,q.z,q.x,q.y+1):ke&&F(Q,ce,q.z,q.x,q.y-1);else{const Oe=G.visibleQuadrants;1&Oe&&(F(Q,De,q.z,Le,q.y),ke&&(F(Q,ce,q.z,q.x,q.y-1),F(Q,De,q.z,Le,q.y-1))),2&Oe&&(F(Q,Ue,q.z,Ne,q.y),ke&&(F(Q,ce,q.z,q.x,q.y-1),F(Q,Ue,q.z,Ne,q.y-1))),4&Oe&&(F(Q,De,q.z,Le,q.y),Te&&(F(Q,ce,q.z,q.x,q.y+1),F(Q,De,q.z,Le,q.y+1))),8&Oe&&(F(Q,Ue,q.z,Ne,q.y),Te&&(F(Q,ce,q.z,q.x,q.y+1),F(Q,Ue,q.z,Ne,q.y+1)))}}const V=[];for(const j of y)y.some(G=>j.isChildOf(G))||V.push(j);if(y=V.filter(j=>!t.some(G=>!!(j.overscaledZ<n&&G.isChildOf(j))||j.equals(G)||j.isChildOf(G))),T){const j=1<<n,G=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=[j*G.x,j*G.y],Q=4,ce=Q*Q;y=y.filter(ae=>{const de=ae.canonical.x+.5-q[0],pe=ae.canonical.y+.5-q[1];return de*de+pe*pe<ce})}return y}coveringTiles(t){let n=this.coveringZoomLevel(t);const d=n,y=this.elevation&&this.elevation.exaggeration(),b=y&&!t.isTerrainDEM,T=this.projection.name==="mercator";if(t.minzoom!==void 0&&n<t.minzoom)return[];t.maxzoom!==void 0&&n>t.maxzoom&&(n=t.maxzoom);const I=this.locationCoordinate(this.center),F=this.center.lat,V=1<<n,j=[V*I.x,V*I.y,0],G=this.projection.name==="globe",q=!G,Q=r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,q),ce=G?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ae=V*r.bH(1,this.center.lat),de=this._camera.position[2]/r.bH(1,this.center.lat),pe=[V*ce.x,V*ce.y,de*(q?1:ae)],Te=G||y,ke=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),De=this.isLODDisabled(!0)?n:0;let Ue;if(this._elevation&&t.isTerrainDEM)Ue=1e4*this._elevation.exaggeration();else if(this._elevation){const st=this._elevation.getMinMaxForVisibleTiles();Ue=st?st.max:this._centerAltitude}else Ue=this._centerAltitude;const Le=t.isTerrainDEM?-Ue:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ne=this.projection.isReprojectedInTileSpace?r.bS(this):1,Oe=st=>{const bt=new r.aa(st.x+25e-6,st.y,st.z),Kt=new r.aa(st.x,st.y+25e-6,st.z),Bt=st.toLngLat(),kt=bt.toLngLat(),$t=Kt.toLngLat(),Xt=this.locationCoordinate(Bt),ci=this.locationCoordinate(kt),pi=this.locationCoordinate($t),Fi=Math.hypot(ci.x-Xt.x,ci.y-Xt.y),Mi=Math.hypot(pi.x-Xt.x,pi.y-Xt.y);return Math.sqrt(Fi*Mi)*Ne/25e-6},We=st=>{const It=Ue,bt=Le;return{aabb:r.bV(this,V,0,0,0,st,bt,It,this.projection),zoom:0,x:0,y:0,minZ:bt,maxZ:It,wrap:st,fullyVisible:!1}},Qe=[];let xt=[];const ut=n,Dt=t.reparseOverscaled?d:n,At=(de-this._centerAltitude)*ae,ot=st=>{if(!this._elevation||!st.tileID||!T)return;const It=this._elevation.getMinMaxForTile(st.tileID),bt=st.aabb;It?(bt.min[2]=It.min,bt.max[2]=It.max,bt.center[2]=(bt.min[2]+bt.max[2])/2):(st.shouldSplit=Vt(st),st.shouldSplit||(bt.min[2]=bt.max[2]=bt.center[2]=this._centerAltitude))},wt=(st,It)=>{if(.707*It<st)return 1;const bt=It/st;return bt/(1.4144271570014144+(Math.pow(1.1,bt-1.4144271570014144+1)-1)/(1.1-1)-1)},Vt=st=>{if(st.zoom<De)return!0;if(st.zoom===ut)return!1;if(st.shouldSplit!=null)return st.shouldSplit;const It=st.aabb.distanceX(pe),bt=st.aabb.distanceY(pe);let Kt=At,Bt=1;if(G){Kt=st.aabb.distanceZ(pe);const Mi=Math.pow(2,st.zoom),Ci=r.aS((st.y+1)/Mi),ji=r.aS(st.y/Mi),pr=Math.min(Math.max(F,Ci),ji),Er=r.c9(pr)/r.c9(F);if(Bt=pr===F?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Er/this._mercatorScaleRatio),this.zoom<=r.c6&&st.zoom===ut-1&&Er>=.9)return!0}else if(b&&(Kt=st.aabb.distanceZ(pe)*ae),this.projection.isReprojectedInTileSpace&&d<=5){const Mi=Math.pow(2,st.zoom),Ci=Oe(new r.aa((st.x+.5)/Mi,(st.y+.5)/Mi));Bt=Ci>.85?1:Ci}if(!T){const Mi=Math.sqrt(It*It+bt*bt+Kt*Kt);let Ci=(1<<ut-st.zoom)*ke*Bt;return Ci*=wt(Math.max(Kt,At),Mi),Mi<Ci}let kt=Number.MAX_VALUE,$t=0;const Xt=st.aabb.getCorners(),ci=[];for(const Mi of Xt){r.ab.vec3.sub(ci,Mi,pe),G||(b?ci[2]*=ae:ci[2]=At);const Ci=r.ab.vec3.dot(ci,this._camera.forward());Ci<kt&&(kt=Ci,$t=Math.abs(ci[2]))}let pi=(1<<ut-st.zoom)*ke*Bt;if(pi*=wt(Math.max($t,At),kt),kt<pi)return!0;const Fi=st.aabb.closestPoint(j);return Fi[0]===j[0]&&Fi[1]===j[1]};if(this.renderWorldCopies)for(let st=1;st<=3;st++)Qe.push(We(-st)),Qe.push(We(st));for(Qe.push(We(0));Qe.length>0;){const st=Qe.pop(),It=st.x,bt=st.y;let Kt=st.fullyVisible;const Bt=()=>this.projection.name==="globe"&&(st.y===0||st.y===(1<<st.zoom)-1);if(!Kt){let kt=Te?st.aabb.intersects(Q):st.aabb.intersectsFlat(Q);if(kt===0&&Bt()){const $t=new r.bT(st.zoom,It,bt);kt=r.bU(this,V,$t,!0).intersects(Q)}if(kt===0)continue;Kt=kt===2}if(st.zoom!==ut&&Vt(st))for(let kt=0;kt<4;kt++){const $t=(It<<1)+kt%2,Xt=(bt<<1)+(kt>>1),ci={aabb:T?st.aabb.quadrant(kt):r.bV(this,V,st.zoom+1,$t,Xt,st.wrap,st.minZ,st.maxZ,this.projection),zoom:st.zoom+1,x:$t,y:Xt,wrap:st.wrap,fullyVisible:Kt,tileID:void 0,shouldSplit:void 0,minZ:st.minZ,maxZ:st.maxZ};b&&!G&&(ci.tileID=new r.aG(st.zoom+1===ut?Dt:st.zoom+1,st.wrap,st.zoom+1,$t,Xt),ot(ci)),Qe.push(ci)}else{const kt=st.zoom===ut?Dt:st.zoom;if(t.minzoom&&t.minzoom>kt)continue;let $t=0;if(!Kt){let Fi=Te?st.aabb.intersectsPrecise(Q):st.aabb.intersectsPreciseFlat(Q);if(Fi===0&&Bt()){const Mi=new r.bT(st.zoom,It,bt);Fi=r.bU(this,V,Mi,!0).intersectsPrecise(Q)}if(Fi===0)continue;if(t.calculateQuadrantVisibility)if(Q.containsPoint(st.aabb.center))$t=15;else for(let Mi=0;Mi<4;Mi++)st.aabb.quadrant(Mi).intersects(Q)!==0&&($t|=1<<Mi)}const Xt=j[0]-(.5+It+(st.wrap<<st.zoom))*(1<<n-st.zoom),ci=j[1]-.5-bt,pi=st.tileID?st.tileID:new r.aG(kt,st.wrap,st.zoom,It,bt);t.calculateQuadrantVisibility&&(pi.visibleQuadrants=$t),xt.push({tileID:pi,distanceSq:Xt*Xt+ci*ci})}}if(this.fogCullDistSq){const st=this.fogCullDistSq,It=this.horizonLineFromTop();xt=xt.filter(bt=>{const Kt=[0,0,0,1],Bt=[r.ag,r.ag,0,1],kt=this.calculateFogTileMatrix(bt.tileID.toUnwrapped());r.ab.vec4.transformMat4(Kt,Kt,kt),r.ab.vec4.transformMat4(Bt,Bt,kt);const $t=r.ab.vec4.min([],Kt,Bt),Xt=r.ab.vec4.max([],Kt,Bt),ci=r.bW($t,Xt);if(ci===0)return!0;let pi=!1;const Fi=this._elevation;if(Fi&&ci>st&&It!==0){const Mi=this.calculateProjMatrix(bt.tileID.toUnwrapped());let Ci;t.isTerrainDEM||(Ci=Fi.getMinMaxForTile(bt.tileID)),Ci||(Ci={min:Le,max:Ue});const ji=r.c7(this.rotation),pr=[ji[0]*r.ag,ji[1]*r.ag,Ci.max];r.ab.vec3.transformMat4(pr,pr,Mi),pi=(1-pr[1])*this.height*.5<It}return ci<st||pi})}return xt.sort((st,It)=>st.distanceSq-It.distanceSq).map(st=>st.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=r.aw(t.lat,-r.bX,r.bX),d=this.projection.project(t.lng,n);return new r.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,n){let d,y;const b=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;d=(n.x-b.x)/I,y=(n.y-b.y)/I}else{const I=this.pointCoordinate(n),F=this.pointCoordinate(b);d=I.x-F.x,y=I.y-F.y}const T=this.locationCoordinate(t);this.setLocation(new r.aa(T.x-d,T.y-y))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,n){const d=n?r.bH(n,t.lat):void 0,y=this.projection.project(t.lng,t.lat);return new r.aa(y.x,y.y,d)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,n){const d=n??this._centerAltitude,y=[t.x,t.y,0,1],b=[t.x,t.y,1,1];r.ab.vec4.transformMat4(y,y,this.pixelMatrixInverse),r.ab.vec4.transformMat4(b,b,this.pixelMatrixInverse);const T=b[3];r.ab.vec4.scale(y,y,1/y[3]),r.ab.vec4.scale(b,b,1/T);const I=y[2],F=b[2];return{p0:y,p1:b,t:I===F?0:(d-I)/(F-I)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],d=[t.x,t.y,1,1];return r.ab.vec4.transformMat4(n,n,this.pixelMatrixInverse),r.ab.vec4.transformMat4(d,d,this.pixelMatrixInverse),r.ab.vec4.scale(n,n,1/n[3]),r.ab.vec4.scale(d,d,1/d[3]),n[2]=r.bH(n[2],this._center.lat)*this.worldSize,d[2]=r.bH(d[2],this._center.lat)*this.worldSize,r.ab.vec4.scale(n,n,1/this.worldSize),r.ab.vec4.scale(d,d,1/this.worldSize),new r.aq([n[0],n[1],n[2]],r.ab.vec3.normalize([],r.ab.vec3.sub([],d,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:d,t:y}=t,b=r.bH(n[2],this._center.lat),T=r.bH(d[2],this._center.lat);return new r.aa(r.af(n[0],d[0],y)/this.worldSize,r.af(n[1],d[1],y)/this.worldSize,r.af(b,T,y))}pointCoordinate(t,n=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,n)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let n=this.projection.pointCoordinate3D(this,t.x,t.y);if(n)return new r.aa(n[0],n[1],n[2]);let d=0,y=this.horizonLineFromTop();if(t.y>y)return this.pointCoordinate(t);const b=.02*y,T=t.clone();for(let I=0;I<10&&y-d>b;I++){T.y=r.af(d,y,.66);const F=this.projection.pointCoordinate3D(this,T.x,T.y);F?(y=T.y,n=F):d=T.y}return n?new r.aa(n[0],n[1],n[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=r.bY)return!this.isPointAboveHorizon(t);const n=this.pointCoordinate(t);return n.y>=0&&n.y<=1}_coordinatePoint(t,n){const d=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,y=[t.x*this.worldSize,t.y*this.worldSize,d+t.toAltitude(),1];return r.ab.vec4.transformMat4(y,y,this.pixelMatrix),y[3]>0?new r.P(y[0]/y[3],y[1]/y[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:n}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,b=this.pointLocation3D(new r.P(n,t)),T=this.pointLocation3D(new r.P(y,t)),I=this.pointLocation3D(new r.P(y,d)),F=this.pointLocation3D(new r.P(n,d));let V=Math.min(b.lng,T.lng,I.lng,F.lng),j=Math.max(b.lng,T.lng,I.lng,F.lng),G=Math.min(b.lat,T.lat,I.lat,F.lat),q=Math.max(b.lat,T.lat,I.lat,F.lat);const Q=Math.pow(2,-this.zoom)/16*270,ce=this.projection.name==="globe"?1:4,ae=(de,pe,Te,ke,De)=>{const Ue=(de+Te)/2,Le=(pe+ke)/2,Ne=new r.P(Ue,Le),{lng:Oe,lat:We}=this.pointLocation3D(Ne),Qe=Math.max(0,V-Oe,G-We,Oe-j,We-q);V=Math.min(V,Oe),j=Math.max(j,Oe),G=Math.min(G,We),q=Math.max(q,We),(De<ce||Qe>Q)&&(ae(de,pe,Ue,Le,De+1),ae(Ue,Le,Te,ke,De+1))};if(ae(n,t,y,t,1),ae(y,t,y,d,1),ae(y,d,n,d,1),ae(n,d,n,t,1),this.projection.name==="globe"){const[de,pe]=r.bZ(this);de?(q=90,j=180,V=-180):pe&&(G=-90,j=180,V=-180)}return new r.az(new r.bO(V,G),new r.bO(j,q))}_getBoundsRectangular(t,n){const{top:d,left:y}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,I=new r.P(y,d),F=new r.P(T,d),V=new r.P(T,b),j=new r.P(y,b);let G=this.pointCoordinate(I,t),q=this.pointCoordinate(F,t);const Q=this.pointCoordinate(V,n),ce=this.pointCoordinate(j,n),ae=(de,pe)=>(pe.y-de.y)/(pe.x-de.x);return G.y>1&&q.y>=0?G=new r.aa((1-ce.y)/ae(ce,G)+ce.x,1):G.y<0&&q.y<=1&&(G=new r.aa(-ce.y/ae(ce,G)+ce.x,0)),q.y>1&&G.y>=0?q=new r.aa((1-Q.y)/ae(Q,q)+Q.x,1):q.y<0&&G.y<=1&&(q=new r.aa(-Q.y/ae(Q,q)+Q.x,0)),new r.az().extend(this.coordinateLocation(G)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(ce)).extend(this.coordinateLocation(Q))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const n=t.visibleDemTiles.reduce((d,y)=>{if(y.dem){const b=y.dem.tree;d.min=Math.min(d.min,b.minimums[0]),d.max=Math.max(d.max,b.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*t.exaggeration(),n.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-n*(1-this._horizonShift);return t?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-r.bX,this.maxLat=r.bX,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.at(this.minLng)*this.tileSize,this.worldMaxX=r.at(this.maxLng)*this.tileSize,this.worldMinY=r.aA(this.maxLat)*this.tileSize,this.worldMaxY=r.aA(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,n){return this.projection.createTileMatrix(this,n,t)}calculateDistanceTileData(t){const n=t.key,d=this._distanceTileDataCache;if(d[n])return d[n];const y=t.canonical,b=1/this.height,T=this.cameraWorldSize,I=T/this.zoomScale(y.z),F=(y.x+Math.pow(2,y.z)*t.wrap)*I,V=y.y*I,j=this.point;j.x*=T/this.worldSize,j.y*=T/this.worldSize;const G=this.angle,q=Math.sin(-G),Q=-Math.cos(-G);return d[n]={bearing:[q,Q],center:[(j.x-F)*b,(j.y-V)*b],scale:I/r.ag*b},d[n]}calculateFogTileMatrix(t){const n=t.key,d=this._fogTileMatrixCache;if(d[n])return d[n];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return r.ab.mat4.multiply(y,this.worldToFogMatrix,y),d[n]=new Float32Array(y),d[n]}calculateProjMatrix(t,n=!1,d=!1){const y=t.key;let b;if(b=d?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,b[y])return b[y];const T=this.calculatePosMatrix(t,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,r.ab.mat4.multiply(T,I,T),b[y]=new Float32Array(T),b[y]}calculatePixelsToTileUnitsMatrix(t){const n=t.tileID.key,d=this._pixelsToTileUnitsCache;if(d[n])return d[n];const y=r.b_(t,this);return d[n]=y,d[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,n=r.ab.mat4.fromScaling([],[t,t,t]);return r.ab.mat4.multiply(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const n=r.bH(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(n),y=this._camera.forward(),b=r.bH(1,this._center.lat);d[2]/=b,y[2]/=b,r.ab.vec3.normalize(y,y);const T=t.raycast(d,y,t.exaggeration());if(T){const I=r.ab.vec3.scaleAndAdd([],d,y,T),F=new r.aa(I[0],I[1],r.bH(I[2],r.aS(I[1]))),V=(F.z+r.ab.vec3.length([F.x-d[0],F.y-d[1],F.z-d[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(V),this._centerAltitude=F.toAltitude(),this._center=this.coordinateLocation(F),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const n=this._elevation,d=r.bH(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(d),b=n.getAtPointOrZero(new r.aa(...y)),T=this.pixelsPerMeter/this.worldSize*b,I=this._minimumHeightOverTerrain(),F=y[2]-T;if(F<=I)if(F<0||t){const V=this.locationCoordinate(this._center,this._centerAltitude),j=[y[0],y[1],V.z-y[2]],G=r.ab.vec3.length(j);j[2]-=(I-F)/this._pixelsPerMercatorPixel;const q=r.ab.vec3.length(j);if(q===0)return;r.ab.vec3.scale(j,j,G/q*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],V.z*this._pixelsPerMercatorPixel-j[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const q=this.center;return q.lat=r.aw(q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(q.lng=r.aw(q.lng,this.minLng,this.maxLng)),this.center=q,void(this._constraining=!1)}const n=this._unmodified,{x:d,y}=this.point;let b=0,T=d,I=y;const F=this.width/2,V=this.height/2,j=this.worldMinY*this.scale,G=this.worldMaxY*this.scale;if(y-V<j&&(I=j+V),y+V>G&&(I=G-V),G-j<this.height&&(b=Math.max(b,this.height/(G-j)),I=(G+j)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const q=this.worldMinX*this.scale,Q=this.worldMaxX*this.scale,ce=this.worldSize/2-(q+Q)/2;T=(d+ce+this.worldSize)%this.worldSize-ce,T-F<q&&(T=q+F),T+F>Q&&(T=Q-F),Q-q<this.width&&(b=Math.max(b,this.width/(Q-q)),T=(Q+q)/2)}T===d&&I===y||(this.center=this.unproject(new r.P(T,I))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.bH(1,this.center.lat)/r.bH(1,r.c8));const y=r.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?d:1,T=this._camera.getWorldToCamera(this.worldSize,b);let I;const F=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(F[8]=2*-t.x/this.width,F[9]=2*t.y/this.height,this.isOrthographic){let We=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Qe=We*this.aspect,xt=-Qe,ut=-We;Qe-=t.x,xt-=t.x,We+=t.y,ut+=t.y,I=this._camera.getCameraToClipOrthographic(xt,Qe,ut,We,this._nearZ,this._farZ),((Dt,At,ot,wt)=>{for(let Vt=0;Vt<16;Vt++)Dt[Vt]=rp(At[Vt],ot[Vt],wt)})(I,I,F,Hh(this.pitch>=15?1:this.pitch/15))}else I=F;const V=r.ab.mat4.mul([],F,T);let j=r.ab.mat4.mul([],I,T);if(this.projection.isReprojectedInTileSpace){const We=this.locationCoordinate(this.center),Qe=r.ab.mat4.identity([]);r.ab.mat4.translate(Qe,Qe,[We.x*this.worldSize,We.y*this.worldSize,0]),r.ab.mat4.multiply(Qe,Qe,r.c0(this)),r.ab.mat4.translate(Qe,Qe,[-We.x*this.worldSize,-We.y*this.worldSize,0]),r.ab.mat4.multiply(j,j,Qe),r.ab.mat4.multiply(V,V,Qe),this.inverseAdjustmentMatrix=r.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.ab.mat4.scale([],j,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=j,this.invProjMatrix=r.ab.mat4.invert(new Float64Array(16),this.projMatrix),n){const We=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);We[8]=2*-t.x/this.width,We[9]=2*t.y/this.height,this.expandedFarZProjMatrix=r.ab.mat4.mul([],We,T)}else this.expandedFarZProjMatrix=this.projMatrix;const G=r.ab.mat4.invert([],I);this.frustumCorners=r.c2.fromInvProjectionMatrix(G,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const q=new Float32Array(16);r.ab.mat4.identity(q),r.ab.mat4.scale(q,q,[1,-1,1]),r.ab.mat4.rotateX(q,q,this._pitch),r.ab.mat4.rotateZ(q,q,this.angle);const Q=r.ab.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.ab.mat4.clone(Q);const ce=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Q[8]=2*-t.x/this.width,Q[9]=2*(t.y+ce)/this.height,this.skyboxMatrix=r.ab.mat4.multiply(q,Q,q);const ae=this.point,de=ae.x,pe=ae.y,Te=this.width%2/2,ke=this.height%2/2,De=Math.cos(this.angle),Ue=Math.sin(this.angle),Le=de-Math.round(de)+De*Te+Ue*ke,Ne=pe-Math.round(pe)+De*ke+Ue*Te,Oe=new Float64Array(j);if(r.ab.mat4.translate(Oe,Oe,[Le>.5?Le-1:Le,Ne>.5?Ne-1:Ne,0]),this.alignedProjMatrix=Oe,j=r.ab.mat4.create(),r.ab.mat4.scale(j,j,[this.width/2,-this.height/2,1]),r.ab.mat4.translate(j,j,[1,-1,0]),this.labelPlaneMatrix=j,j=r.ab.mat4.create(),r.ab.mat4.scale(j,j,[1,-1,1]),r.ab.mat4.translate(j,j,[-1,-1,0]),r.ab.mat4.scale(j,j,[2/this.width,2/this.height,1]),this.glCoordMatrix=j,this.pixelMatrix=r.ab.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,V),this._calcFogMatrices(),this._distanceTileDataCache={},j=r.ab.mat4.invert(new Float64Array(16),this.pixelMatrix),!j)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=j,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.c3(this);const We=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.ab.vec3.transformMat4(We,We,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=j;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,d=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,b=[t,t,n];r.ab.vec3.scale(b,b,y),r.ab.vec3.scale(d,d,-1),r.ab.vec3.multiply(d,d,b);const T=r.ab.mat4.create();r.ab.mat4.translate(T,T,d),r.ab.mat4.scale(T,T,b),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,y)}_computeCameraPosition(t){const n=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),y=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-t/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-d[0]*b,y.y/this.worldSize-d[1]*b,t/this.worldSize*this._centerAltitude-d[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],y=t[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(b=Math.min((n-d)/y,1)),this._camera.position=r.ab.vec3.scaleAndAdd([],this._camera.position,t,b),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:d,bearing:y}=this._camera.getPitchBearing(),b=r.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.ai(this._maxPitch)),I=Math.max((t[2]-b)/Math.cos(d),T),F=this._zoomFromMercatorZ(I);r.ab.vec3.scaleAndAdd(t,t,n,I),this._pitch=r.aw(d,r.ai(this.minPitch),r.ai(this.maxPitch)),this.angle=r.bF(y,-Math.PI,Math.PI),this._setZoom(r.aw(F,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.aa(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let n=0,d=r.bY,y=0,b=1/0;for(;d-n>1e-6&&d>n;){const T=n+.5*(d-n),I=this.tileSize*Math.pow(2,T),F=this.getCameraToCenterDistance(this.projection,T,I),V=this.scaleZoom(F/(t*this.tileSize)),j=Math.abs(T-V);j<b&&(b=j,y=T),T<V?n=T:d=T}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,n){const d=Math.min(t.x,n.x),y=Math.max(t.x,n.x),b=Math.min(t.y,n.y),T=Math.max(t.y,n.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new r.P(d,b),new r.P(y,T),new r.P(d,T),new r.P(y,b)],F=this.renderWorldCopies?-3:0,V=this.renderWorldCopies?4:1;for(const j of I){const G=this.pointRayIntersection(j);if(G.t<0)return!0;const q=this.rayIntersectionCoordinate(G);if(q.x<F||q.y<0||q.x>V||q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(t,n){const d=r.ab.vec3.length(r.ab.vec3.sub([],this._camera.position,t)),y=this._zoomFromMercatorZ(d)+n;return d-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([n,d,y],b){const T=[n,d,y,1];r.ab.vec4.transformMat4(T,T,b);const I=T[3]=Math.max(T[3],1e-6);return T[0]/=I,T[1]/=I,T[2]/=I,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,t))}}getCameraToCenterDistance(t,n=this.zoom,d=this.worldSize){const y=r.b$(t,n,this.width,this.height,1024),b=t.pixelSpaceConversion(this.center.lat,d,y);let T=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(T=rp(1,T,Hh(this.pitch>=15?1:this.pitch/15))),T}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.ab.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const bl=(u,t)=>{if(t>0&&u.terrain&&r.w("Cutoff is currently disabled on terrain"),t<=0||u.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const n=u.transform,d=Math.max(Math.abs(n._zoom-(u.minCutoffZoom-1)),1),y=n.isLODDisabled(!1)?r.ac(60,45,n.pitch):r.ac(30,15,n.pitch),b=n._farZ-n._nearZ,T=t*n.height,I=((1-(F=y))*n.cameraToCenterDistance+F*(n._farZ+T))*d;var F;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(I-n._nearZ)/b,(I-T-n._nearZ)/b]}}},fs={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Ya{constructor(t,n){this.aabb=t,this.lastCascade=n}}class np{add(t,n){const d=this.receivers[t.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],n.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],n.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],n.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],n.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],n.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],n.max[2])):this.receivers[t.key]=new Ya(n,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,n,d){const y=r.cd.fromPoints(t.points);let b=0;for(const T in this.receivers){const I=this.receivers[T];if(!I||!y.intersectsAabb(I.aabb))continue;I.aabb.min=y.closestPoint(I.aabb.min),I.aabb.max=y.closestPoint(I.aabb.max);const F=I.aabb.getCorners();for(let V=0;V<d.length;V++){let j=!0;for(const G of F){const q=[G[0]*n,G[1]*n,G[2]];if(r.ab.vec3.transformMat4(q,q,d[V].matrix),q[0]<-1||q[0]>1||q[1]<-1||q[1]>1){j=!1;break}}if(I.lastCascade=V,b=Math.max(b,V),j)break}}return b+1}}class ic{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new np,this._depthMode=new Si(t.context.gl.LEQUAL,Si.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(fs,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(fs,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(fs,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,n){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const y=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||y<=0||(this._shadowLayerCount=d.style.order.reduce((ce,ae)=>{const de=d.style._mergedLayers[ae];return ce+(de.hasShadowPass()&&!de.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const b=d.context,T=fs.shadowMapResolution,I=fs.shadowMapResolution;if(this._cascades.length===0||fs.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ce=0;ce<fs.cascadeCount;++ce){const ae=d._shadowMapDebug,de=b.gl,pe=b.createFramebuffer(T,I,ae,"texture"),Te=new r.T(b,{width:T,height:I,data:null},de.DEPTH_COMPONENT16);if(pe.depthAttachment.set(Te.texture),ae){const ke=new r.T(b,{width:T,height:I,data:null},de.RGBA8);pe.colorAttachment.set(ke.texture)}this._cascades.push({framebuffer:pe,texture:Te,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.bR,scale:0})}}this.shadowDirection=nc(n);let F=0;if(t.elevation){const ce=t.elevation,ae=[1e4,-1e4];ce.visibleDemTiles.filter(de=>de.dem).forEach(de=>{const pe=de.dem.tree;ae[0]=Math.min(ae[0],pe.minimums[0]),ae[1]=Math.max(ae[1],pe.maximums[0])}),ae[0]!==1e4&&(F=(ae[1]-ae[0])*ce.exaggeration())}const V=1.5*t.cameraToCenterDistance,j=3*V,G=new Float64Array(16);for(let ce=0;ce<this._cascades.length;++ce){const ae=this._cascades[ce];let de=t.height/50,pe=1;fs.cascadeCount===1?pe=j:ce===0?pe=V:(de=V,pe=j);const[Te,ke]=$m(t,this.shadowDirection,de,pe,fs.shadowMapResolution,F);ae.scale=t.scale,ae.matrix=Te,ae.boundingSphereRadius=ke,r.ab.mat4.invert(G,ae.matrix),ae.frustum=r.bR.fromInvProjectionMatrix(G,1,0,!0),ae.far=pe}const q=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[q].far,this._cascades[q].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/fs.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=fs.shadowMapResolution,this._uniformValues.u_shadowmap_0=Os.ShadowMap0,this._uniformValues.u_shadowmap_1=Os.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Q=d.transform.elevation;for(const ce of this._groundShadowTiles){let ae={min:0,max:0};if(Q){const de=Q.getMinMaxForTile(ce);de&&(ae=de)}this.addShadowReceiver(ce.toUnwrapped(),ae.min,ae.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,n){if(!this.enabled)return;const d=this.painter,y=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),y.viewport.set([0,0,fs.shadowMapResolution,fs.shadowMapResolution]);for(let b=0;b<this._numCascadesToRender;++b){d.currentShadowCascade=b,y.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),y.clear({color:r.aj.white,depth:1});for(const T of t.order){const I=t._mergedLayers[T];if(!I.hasShadowPass()||I.isHidden(d.transform.zoom))continue;const F=t.getLayerSourceCache(I),V=F?n[F.id]:void 0;(I.type==="model"||V&&V.length)&&d.renderLayer(d,F,I,V)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,n=t.style,d=t.context,y=n.directionalLight,b=n.ambientLight;if(!y||!b)return;const T=[],I=bl(t,t.longestCutoffRange);I.shouldRenderCutoff&&T.push("RENDER_CUTOFF"),T.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&T.push("NORMAL_OFFSET");const F=Gh(n,y,b),V=new Si(d.gl.LEQUAL,Si.ReadOnly,t.depthRangeFor3D);for(const j of this._groundShadowTiles){const G=j.toUnwrapped(),q=t.isTileAffectedByFog(j),Q=t.getOrCreateProgram("groundShadow",{defines:T,overrideFog:q});this.setupShadows(G,Q),t.uploadCommonUniforms(d,Q,G,null,I);const ce={u_matrix:t.transform.calculateProjMatrix(G),u_ground_shadow_factor:F};Q.draw(t,d.gl.TRIANGLES,V,Oi.disabled,Xi.multiply,zi.disabled,ce,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Xi.unblended:Xi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const n=this.painter.transform,d=n.calculatePosMatrix(t,n.worldSize);return r.ab.mat4.multiply(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(t){return r.ab.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,n,d,y=0){if(!this.enabled)return;const b=this.painter.transform,T=this.painter.context,I=T.gl,F=this._uniformValues,V=new Float64Array(16),j=b.calculatePosMatrix(t,b.worldSize);for(let G=0;G<this._cascades.length;G++)r.ab.mat4.multiply(V,this._cascades[G].matrix,j),F[G===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(V),T.activeTexture.set(I.TEXTURE0+Os.ShadowMap0+G),this._cascades[G].texture.bind(I.NEAREST,I.CLAMP_TO_EDGE);if(this.useNormalOffset=!!d,this.useNormalOffset){const G=r.cc(t.canonical),q=2/b.tileSize*r.ag/fs.shadowMapResolution,Q=q*this._cascades[0].boundingSphereRadius,ce=q*this._cascades[this._cascades.length-1].boundingSphereRadius,ae=(d==="vector-tile"?1:3)/Math.pow(2,y-t.canonical.z-(1-b.zoom+Math.floor(b.zoom)));F.u_shadow_normal_offset=[G,Q*ae,ce*ae],F.u_shadow_bias=[6e-5,.0012,.012]}else F.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(T,F)}setupShadowsFromMatrix(t,n,d=!1){if(!this.enabled)return;const y=this.painter.context,b=y.gl,T=this._uniformValues,I=new Float64Array(16);for(let F=0;F<fs.cascadeCount;F++)r.ab.mat4.multiply(I,this._cascades[F].matrix,t),T[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),y.activeTexture.set(b.TEXTURE0+Os.ShadowMap0+F),this._cascades[F].texture.bind(b.NEAREST,b.CLAMP_TO_EDGE);if(this.useNormalOffset=d,d){const F=fs.normalOffset;T.u_shadow_normal_offset=[1,F,F],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(y,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,n,d,y){if(y[2]>=0)return{};const b=function(F,V,j){const G=j/(1<<F.canonical.z);return new r.cd([F.canonical.x*G+F.wrap*j,F.canonical.y*G+F.wrap*j,0],[(F.canonical.x+1)*G+F.wrap*j,(F.canonical.y+1)*G+F.wrap*j,V])}(t,n,d).getCorners(),T=n/-y[2];y[0]<0?(r.ab.vec3.add(b[0],b[0],[y[0]*T,0,0]),r.ab.vec3.add(b[3],b[3],[y[0]*T,0,0])):y[0]>0&&(r.ab.vec3.add(b[1],b[1],[y[0]*T,0,0]),r.ab.vec3.add(b[2],b[2],[y[0]*T,0,0])),y[1]<0?(r.ab.vec3.add(b[0],b[0],[0,y[1]*T,0]),r.ab.vec3.add(b[1],b[1],[0,y[1]*T,0])):y[1]>0&&(r.ab.vec3.add(b[2],b[2],[0,y[1]*T,0]),r.ab.vec3.add(b[3],b[3],[0,y[1]*T,0]));const I={};return I.vertices=b,I.planes=[rc(b[1],b[0],b[4]),rc(b[2],b[1],b[5]),rc(b[3],b[2],b[6]),rc(b[0],b[3],b[7])],I}addShadowReceiver(t,n,d){this._receivers.add(t,r.cd.fromTileIdAndHeight(t,n,d))}getMaxCascadeForTile(t){const n=this._receivers.get(t);return n&&n.lastCascade?n.lastCascade:0}}function rc(u,t,n){const d=r.ab.vec3.sub([],n,t),y=r.ab.vec3.sub([],u,t),b=r.ab.vec3.cross([],d,y),T=r.ab.vec3.length(b);return T===0?[0,0,1,0]:(r.ab.vec3.scale(b,b,1/T),[b[0],b[1],b[2],-r.ab.vec3.dot(b,t)])}function nc(u){const t=u.properties.get("direction"),n=r.cb(t.x,t.y,t.z);n[2]=r.aw(n[2],0,75);const d=r.ce([n[0],n[1],n[2]]);return r.ab.vec3.fromValues(d.x,d.y,d.z)}function Gh(u,t,n){const d=t.properties.get("color-use-theme")==="none",y=t.properties.get("color"),b=t.properties.get("intensity"),T=t.properties.get("direction"),I=[T.x,T.y,T.z],F=n.properties.get("color-use-theme")==="none",V=n.properties.get("color"),j=n.properties.get("intensity"),G=Math.max(r.ab.vec3.dot([0,0,1],I),0),q=[0,0,0];r.ab.vec3.scale(q,V.toRenderColor(F?null:u.getLut(t.scope)).toArray01Linear().slice(0,3),j);const Q=[0,0,0];return r.ab.vec3.scale(Q,y.toRenderColor(d?null:u.getLut(n.scope)).toArray01Linear().slice(0,3),G*b),r.cf([q[0]>0?q[0]/(q[0]+Q[0]):0,q[1]>0?q[1]/(q[1]+Q[1]):0,q[2]>0?q[2]/(q[2]+Q[2]):0])}function $m(u,t,n,d,y,b){const T=u.zoom,I=u.scale,F=u.worldSize,V=1/F,j=u.aspect,G=Math.sqrt(1+j*j)*Math.tan(.5*u.fovX),q=G*G,Q=d-n,ce=d+n;let ae,de;q>Q/ce?(ae=d,de=d*G):(ae=.5*ce*(1+q),de=.5*Math.sqrt(Q*Q+2*(d*d+n*n)*q+ce*ce*q*q));const pe=u.projection.pixelsPerMeter(u.center.lat,F),Te=u._camera.getCameraToWorldMercator(),ke=[0,0,-ae*V];r.ab.vec3.transformMat4(ke,ke,Te);let De=de*V;const Ue=u._edgeInsets;if(!(Ue.left===0&&Ue.top===0&&Ue.right===0&&Ue.bottom===0||Ue.left===Ue.right&&Ue.top===Ue.bottom)){const Kt=u._camera.getWorldToCamera(u.worldSize,u.projection.zAxisUnit==="meters"?pe:1),Bt=u._camera.getCameraToClipPerspective(u._fov,u.width/u.height,n,d);Bt[8]=2*-u.centerOffset.x/u.width,Bt[9]=2*u.centerOffset.y/u.height;const kt=new Float64Array(16);r.ab.mat4.mul(kt,Bt,Kt);const $t=new Float64Array(16);r.ab.mat4.invert($t,kt);const Xt=r.bR.fromInvProjectionMatrix($t,F,T,!0);for(const ci of Xt.points){const pi=((Le=ci)[0]/=I,Le[1]/=I,Le[2]=r.bH(Le[2],u._center.lat),Le);De=Math.max(De,r.ab.vec3.len(r.ab.vec3.subtract([],ke,pi)))}}var Le;De*=y/(y-1);const Ne=Math.acos(t[2]),Oe=Math.atan2(-t[0],-t[1]),We=new so;We.position=ke,We.setPitchBearing(Ne,Oe);const Qe=We.getWorldToCamera(F,pe),xt=De*F,ut=Math.min(u._mercatorZfromZoom(17)*F*-2,-2*xt),Dt=We.getCameraToClipOrthographic(-xt,xt,-xt,xt,ut,(xt+b*pe)/t[2]),At=new Float64Array(16);r.ab.mat4.multiply(At,Dt,Qe);const ot=r.ab.vec3.fromValues(Math.floor(1e6*ke[0])/1e6*F,Math.floor(1e6*ke[1])/1e6*F,0),wt=.5*y,Vt=[0,0,0];r.ab.vec3.transformMat4(Vt,ot,At),r.ab.vec3.scale(Vt,Vt,wt);const st=[Math.floor(Vt[0]),Math.floor(Vt[1]),Math.floor(Vt[2])],It=[0,0,0];r.ab.vec3.sub(It,Vt,st),r.ab.vec3.scale(It,It,-1/wt);const bt=new Float64Array(16);return r.ab.mat4.identity(bt),r.ab.mat4.translate(bt,bt,It),r.ab.mat4.multiply(At,bt,At),[At,xt]}class sc extends r.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(t,n){return r.aM(this.requestManager.transformRequest(n,r.R.Model).url).then(d=>{if(!d)return;const y=r.aN(d),b=new r.aO(t,void 0,void 0,y);return b.computeBoundsAndApplyParent(),b}).catch(d=>{if(d&&d.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${t} from ${n}: ${d.message}`)))})}load(t,n,d={keepNumReferences:!1}){this.models[n]||(this.models[n]={});const y=Object.keys(t);this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+y.length;const b=[];for(const T of y)b.push(this.loadModel(T,t[T]));Promise.allSettled(b).then(T=>{for(let I=0;I<T.length;I++){const{status:F,value:V}=T[I];if(F==="fulfilled"&&V){const j=this.models[n][y[I]];this.models[n][y[I]]={model:V,numReferences:d.keepNumReferences&&j?j.numReferences:1}}}this.numModelsLoading[n]-=y.length,this.fire(new r.z("data",{dataType:"style"}))}).catch(T=>{this.fire(new r.y(new Error(`Could not load models: ${T.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,n){return!!this.getModel(t,n)}getModel(t,n){return this.models[n]||(this.models[n]={}),this.models[n][t]?this.models[n][t].model:void 0}addModel(t,n,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={}),this.hasModel(t,d)&&this.models[d][t].numReferences++,this.modelUris[d][t]=this.requestManager.normalizeModelURL(n),this.load({[t]:this.modelUris[d][t]},d)}addModels(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const d=this.modelUris[n];for(const y in t)this.models[n][y]={},d[y]=this.requestManager.normalizeModelURL(t[y]);this.load(d,n,{keepNumReferences:!0})}reloadModels(t){this.load(this.modelUris[t],t)}addModelsFromBucket(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const d={};for(const y of t)this.hasModel(y,n)?this.models[n][y].numReferences++:(this.modelUris[n][y]=this.requestManager.normalizeModelURL(y),d[y]=this.modelUris[n][y]);this.load(d,n)}removeModel(t,n){if(this.models[n]&&this.models[n][t]&&(this.models[n][t].numReferences--,this.models[n][t].numReferences===0)){const d=this.models[n][t].model;delete this.models[n][t],delete this.modelUris[n][t],d.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,n){this.models[n]||(this.models[n]={});for(const d in this.models[n])this.models[n][d].model&&this.models[n][d].model.upload(t.context)}}const oc=new r.a5({data:new r.a6(r.a3.colorTheme.data)}),_f={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function sp(u){return u=u||{},Object.assign(u,_f)}class op extends r.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},r.aP(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new r.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(T,I){const[F,V]=T,{center:j,radius:G}=I,[q,Q]=j,ce=Math.abs(F-q);return Math.sqrt((ce>180?360-ce:ce)**2+(V-Q)**2)<=G}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new r.z("floorplangone")));const n={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},d=new r.P(this._map.transform.width/2,this._map.transform.height/2),y=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],b=this._map.queryRenderedFeatures(t?y:d,n);b.length>0&&(this._selectedFloorplan&&b[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=b[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(b){const[[T,I],[F,V]]=b,j=(F-T+360)%360,G=j>180?360-j:j;return{center:[(T+G/2+360)%360,(I+V)/2],radius:Math.sqrt(G**2+(V-I)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const n=this._floorplanStates[this._indoorData.id].selectedBuilding,d=this._floorplanStates[this._indoorData.id].selectedLevel;let y;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const b of this._indoorData.levels)b.id===this._selectedLevel.id&&(y=b.id);if(this.fire(new r.z("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:y})),n){const b=this._indoorData.buildings.find(T=>T.id===n);this._buildingSelected(b,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(d){const b=this._indoorData.levels.find(T=>T.id===d);this._updateLevels(b,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,n){n&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const d=this._indoorData.levels.filter(y=>t.levels.includes(y.id));this.fire(new r.z("buildingselected",{buildingId:t.id,levels:d}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{const n=this._indoorData.levels.find(d=>d.id===t);this._updateLevels(n,!0)}this.fire(new r.z("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,n){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(n&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function d(V){const j=V.indexOf("/floor/");if(j===-1)return V;const G=j+7,q=V.indexOf("/",G);return q===-1?V.slice(G):V.slice(G,q)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const y=[],b={},T={},I={},F={};for(const V of this._indoorData.levels)if(y.push(V.id),b[V.id]=V.height,T[V.id]=V.base,t){if(this.mergeFloors){const j=d(t.id),G=d(V.id);I[V.id]=G===j?"true":"false"}else I[V.id]=V.id===t.id?"true":"false";F[V.id]=V.base<t.base?"true":"false"}else F[V.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",y]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",b]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",T]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",I]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",F]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),n&&t.extent)){const V=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),j=this._map.getZoom(),G=V.zoom?Math.abs(j-V.zoom):0;this._map.fitBounds(t.extent,G>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:j})}}selectFloorplan(t){const n={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},d=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],y=this._map.queryRenderedFeatures(d,n);if(y.length>0){for(const b of y)if(JSON.parse(b.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=b,this._floorplanSelected(!0);break}}}selectBuilding(t){const n=this._indoorData.buildings.find(d=>d.id===t);this._buildingSelected(n,!0)}selectLevel(t){this._levelSelected(t)}}function Hm(u){if(!u.metadata||!u.metadata.content_area)return;const t=r.q.devicePixelRatio,{left:n,top:d,width:y,height:b}=u.metadata.content_area,T=n*t,I=d*t;return[T,I,T+y*t,I+b*t]}function yf(u){if(u)return u.map(([t,n])=>[t*r.q.devicePixelRatio,n*r.q.devicePixelRatio])}const Fa=(u,t)=>Go(u,t&&t.filter(n=>n.identifier!=="source.canvas")),ap=r.ay(Ji,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),vf=r.ay(Ji,["setCenter","setZoom","setBearing","setPitch"]),tu=new Set(["background","sky","slot","custom"]),ac={version:8,layers:[],sources:{}},xf={duration:300,delay:0};class Lo extends r.E{constructor(t,n={}){super(),this.map=t,this.scope=n.scope||"",this.globalId=null,this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=r.l({},xf),this._buildingIndex=new Xd(this),this.crossTileSymbolIndex=new ip,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new Xs,this.dispatcher=n.dispatcher?n.dispatcher:new r.D(r.ci(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new jn(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new r.cj(t._requestManager,n.localFontFamily?r.ck.all:n.localIdeographFontFamily?r.ck.ideographs:r.ck.none,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new sc(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=n.configOptions?n.configOptions:new Map,this._configDependentLayers=n.configDependentLayers?n.configDependentLayers:new Set,this._config=n.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:n.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=n.initialConfig,this.dispatcher.broadcast("setReferrer",r.cl());const d=this;this._rtlTextPluginCallback=Lo.registerForPluginStateChange(y=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(b,T)=>{if(r.cm(b),T&&T.every(I=>I))for(const I in d._sourceCaches){const F=d._sourceCaches[I],V=F.getSource().type;V!=="vector"&&V!=="geojson"||F.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const b=this.getOwnSource(y.sourceId);if(b&&b.vectorLayerIds)for(const T in this._layers){const I=this._layers[T];I.source===b.id&&this._validateLayer(I)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(r.f(t))return t;const n=r.cn(t);if(!n.startsWith("http"))try{return new URL(n,location.href).toString()}catch{return n}return n}return`json://${r.co(JSON.stringify(t))}`}_diffStyle(t,n,d){this.globalId=this._getGlobalId(t);const y=(b,T)=>{try{T(null,this.setState(b,d))}catch(I){T(I,!1)}};if(typeof t=="string"){const b=this.map._requestManager.normalizeStyleURL(t),T=this.map._requestManager.transformRequest(b,r.R.Style);r.n(T,(I,F)=>{I?this.fire(new r.y(I)):F&&y(F,n)})}else typeof t=="object"&&y(t,n)}loadURL(t,n={}){this.fire(new r.z("dataloading",{dataType:"style"}));const d=typeof n.validate=="boolean"?n.validate:!r.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,n.accessToken),this.resolvedImports.add(t);const y=this.importsCache.get(t);if(y)return this._load(y,d);const b=this.map._requestManager.transformRequest(t,r.R.Style);this._request=r.n(b,(T,I)=>{if(this._request=null,T)this.fire(new r.y(T));else if(I)return this.importsCache.set(t,I),this._load(I,d)})}loadJSON(t,n={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=r.q.frame(()=>{this._request=null,this._load(t,n.validate!==!1)})}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(ac,!1)}_loadImports(t,n,d){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const b of t){const T=this._createFragmentStyle(b),I=new Promise(j=>{T.once("style.import.load",j),T.once("error",j)}).then(()=>this.mergeAll());if(y.push(I),this.resolvedImports.has(b.url)){T.loadEmpty();continue}const F=b.data||this.importsCache.get(b.url);F?(T.loadJSON(F,{validate:n}),this._isInternalStyle(F)&&(T.globalId=null)):b.url?T.loadURL(b.url,{validate:n}):T.loadEmpty();const V={style:T,id:b.id,config:b.config};if(d){const j=this.fragments.findIndex(({id:G})=>G===d);this.fragments=this.fragments.slice(0,j).concat(V).concat(this.fragments.slice(j))}else this.fragments.push(V)}return Promise.allSettled(y)}getImportGlobalIds(t=this,n=new Set){for(const d of t.fragments)d.style.globalId&&n.add(d.style.globalId),this.getImportGlobalIds(d.style,n);return[...n.values()]}_createFragmentStyle(t){const n=this.scope?r.aC(t.id,this.scope):t.id;let d;const y=this._initialConfig&&this._initialConfig[n];(t.config||y)&&(d=r.l({},t.config,y));const b=new Lo(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,n){const d=t.indoor?sp(t.schema):t.schema;if(this._isInternalStyle(t)){const T=r.l({},ac,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(T,n)}if(this.updateConfig(this._config,d),n&&Fa(this,Jr(t)))return;this._loaded=!0,this.stylesheet=r.cp(t);const y=()=>{for(const V in t.sources)this.addSource(V,t.sources[V],{validate:!1,isInitialLoad:!0});t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const T=Bh(this.stylesheet.layers);if(this._order=T.map(V=>V.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const V=this.stylesheet.lights[0];this.light=new se(V.properties,V.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new se(this.stylesheet.light)),this._layers={};for(const V of T){const j=r.cu(V,this.scope,this._styleColorTheme.lut,this.options);j.configDependencies.size!==0&&this._configDependentLayers.add(j.fqid),j.setEventedParent(this,{layer:{id:j.id}}),this._layers[j.id]=j;const G=this.getOwnLayerSourceCache(j),q=!!this.directionalLight&&this.directionalLight.shadowsEnabled();G&&j.canCastShadows()&&q&&(G.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const I=this.stylesheet.terrain;I&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(I,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));const F=this.isRootStyle();t.imports?this._loadImports(t.imports,n).then(()=>{this._reloadImports(),this.fire(new r.z(F?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.z(F?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const b=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(b){const T=this._evaluateColorThemeData(b);this._loadColorTheme(T).then(()=>{y()}).catch(I=>{r.w(`Couldn't load color theme from the stylesheet: ${I}`),y()})}else this._styleColorTheme.lut=null,y()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,n,d,y,b,T,I,F,V,j;const G={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(q=>{if(q.stylesheet){if(q.light!=null&&(t=q.light),q.stylesheet.lights)for(const Q of q.stylesheet.lights)Q.type==="ambient"&&q.ambientLight!=null&&(n=q.ambientLight),Q.type==="directional"&&q.directionalLight!=null&&(d=q.directionalLight);y=this._prioritizeTerrain(y,q.terrain,q.stylesheet.terrain),q.stylesheet.fog&&q.fog!=null&&(b=q.fog),q.stylesheet.snow&&q.snow!=null&&(T=q.snow),q.stylesheet.rain&&q.rain!=null&&(I=q.rain),q.stylesheet.camera!=null&&(j=q.stylesheet.camera),q.stylesheet.projection!=null&&(F=q.stylesheet.projection),q.stylesheet.transition!=null&&(V=q.stylesheet.transition),G[q.scope]=q._styleColorTheme}}),this.light=t,this.ambientLight=n,this.directionalLight=d,this.fog=b,this.snow=T,this.rain=I,this._styleColorThemeForScope=G,y===null?delete this.terrain:this.terrain=y,this.camera=j||{"camera-projection":"perspective"},this.projection=F||{name:"mercator"},this.transition=r.l({},xf,V),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const n=d=>{for(const y of d.fragments)n(y.style);t(d)};n(this)}_prioritizeTerrain(t,n,d){const y=t&&t.drapeRenderMode===0;return d===null?n&&n.drapeRenderMode===0?n:y?t:null:n!=null&&(!t||y||n&&n.drapeRenderMode===1)?n:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(n=>{t=this._prioritizeTerrain(t,n.terrain,n.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(n=>{n.stylesheet.projection!=null&&(t=n.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},n={},d={};this.forEachFragmentStyle(y=>{for(const b in y._sourceCaches){const T=r.aC(b,y.scope);t[T]=y._sourceCaches[b]}for(const b in y._otherSourceCaches){const T=r.aC(b,y.scope);n[T]=y._otherSourceCaches[b]}for(const b in y._symbolSourceCaches){const T=r.aC(b,y.scope);d[T]=y._symbolSourceCaches[b]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=d}mergeLayers(){const t={},n=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(b=>{for(const T of b._order){const I=b._layers[T];if(I.type==="slot"){const F=r.cq(T);if(t[F])continue;t[F]=[]}I.slot&&t[I.slot]?t[I.slot].push(I):n.push(I)}}),this._mergedOrder=[];const y=(b=[])=>{for(const T of b)if(T.type==="slot"){const I=r.cq(T.id);t[I]&&y(t[I]),this._mergedSlots.push(I)}else{const I=r.aC(T.id,T.scope);this._mergedOrder.push(I),d[I]=T,T.is3D()&&(this._has3DLayers=!0),T.type==="circle"&&(this._hasCircleLayers=!0),T.type==="symbol"&&(this._hasSymbolLayers=!0),T.type==="clip"&&(this._clipLayerPresent=!0)}};y(n),this._mergedOrder.sort((b,T)=>{const I=d[b],F=d[T];return I.hasInitialOcclusionOpacityProperties?F.is3D()?1:0:I.is3D()&&F.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=r.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(n,d,y){const b=r.l({},d);for(const I of Object.keys(r.a3.colorTheme))b[I]===void 0&&(b[I]=r.a3.colorTheme[I].default);const T=new r.a4(oc,n,new Map(y));return T.setTransitionOrValue(b,y),T.untransitioned().possiblyEvaluate(new r.a8(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const n=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((d,y)=>{const b="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let T=t;T.startsWith(b)||(T=b+T);const I="mapbox-reserved-lut",F=new Image;F.src=T,F.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},F.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==n)return void d();this._styleColorTheme.lutLoading=!1;const{width:V,height:j,data:G}=r.q.getImageData(F);if(j>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(V!==j*j)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new r.r({width:V,height:j},G),pixelRatio:1,sdf:!1,usvg:!1,version:0});const q=this.imageManager.getImage(I,this.scope);q?(this._styleColorTheme.lut={image:q.data,data:t},d()):y(new Error("Missing LUT image."))}})}getLut(t){const n=this._styleColorThemeForScope[t];return n?n.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(n,d,y){let b,T,I;const F=r.q.devicePixelRatio>1?"@2x":"";let V=r.n(d.transformRequest(d.normalizeSpriteURL(n,F,".json"),r.R.SpriteJSON),(q,Q)=>{V=null,I||(I=q,b=Q,G())}),j=r.o(d.transformRequest(d.normalizeSpriteURL(n,F,".png"),r.R.SpriteImage),(q,Q)=>{j=null,I||(I=q,T=Q,G())});function G(){if(I)y(I);else if(b&&T){const q=r.q.getImageData(T),Q={};for(const ce in b){const{width:ae,height:de,x:pe,y:Te,sdf:ke,pixelRatio:De,stretchX:Ue,stretchY:Le,content:Ne}=b[ce],Oe=new r.r({width:ae,height:de});r.r.copy(q,Oe,{x:pe,y:Te},{x:0,y:0},{width:ae,height:de},null),Q[ce]={data:Oe,pixelRatio:De,sdf:ke,stretchX:Ue,stretchY:Le,content:Ne,usvg:!1}}y(null,Q)}}return{cancel(){V&&(V.cancel(),V=null),j&&(j.cancel(),j=null)}}}(t,this.map._requestManager,(n,d)=>{if(this._spriteRequest=null,n)this.fire(new r.y(n));else if(d)for(const y in d)this.imageManager.addImage(y,this.scope,d[y]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))})}_loadIconset(t){if(!r.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const n=this.map._spriteFormat==="auto";var d,y;this._spriteRequest=(y=(b,T)=>{if(this._spriteRequest=null,b)n?this._loadSprite(t):this.fire(new r.y(b));else if(T)for(const I in T)this.imageManager.addImage(I,this.scope,T[I]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bi((d=this.map._requestManager).transformRequest(d.normalizeIconsetURL(t),r.R.Iconset),(b,T)=>{if(b)return void y(b);const I={},F=r.cg(new r.bh(T));for(const V of F.icons){const j={version:1,pixelRatio:r.q.devicePixelRatio,content:Hm(V),stretchX:V.metadata?yf(V.metadata.stretch_x_areas):void 0,stretchY:V.metadata?yf(V.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:V};I[V.name]=j}y(null,I)}))}_validateLayer(t){const n=this.getOwnSource(t.source);if(!n)return;const d=t.sourceLayer;d&&(n.type==="geojson"||n.vectorLayerIds&&n.vectorLayerIds.indexOf(d)===-1)&&this.fire(new r.y(new Error(`Source layer "${d}" does not exist on source "${n.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,n)=>{const d=this.fragments[n];return d&&d.style&&(t.data=d.style.serialize()),t})}_serializeSources(){const t={};for(const n in this._sourceCaches){const d=this._sourceCaches[n].getSource();t[d.id]||(t[d.id]=d.serialize())}return t}_serializeLayers(t){const n=[];for(const d of t){const y=this._layers[d];y&&y.type!=="custom"&&n.push(y.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const n=this.getOwnLayer(t);if(n)return n;this.fire(new r.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const n=this.getOwnSource(t);if(n)return n;this.fire(new r.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,n){const d=this.map.painter;if(d)for(let y=t.minzoom||0;y<(t.maxzoom||25.5);y++){const b=t.getProgramIds();if(b)for(const T of b){const I=t.getDefaultProgramParams(T,n.zoom,this._styleColorTheme.lut);I&&(d.style=this,this.fog&&(d._fogVisible=!0,I.overrideFog=!0,d.getOrCreateProgram(T,I)),d._fogVisible=!1,I.overrideFog=!1,d.getOrCreateProgram(T,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,d.getOrCreateProgram(T,I)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const n=this.calculateLightsBrightness();t.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n));const d=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const T=this._changes.getLayerUpdatesByScope();for(const I in T){const{updatedIds:F,removedIds:V}=T[I];(F||V)&&(this._updateWorkerLayers(I,F,V),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const b={};for(const T in this._mergedSourceCaches){const I=this._mergedSourceCaches[T];b[T]=I.used,I.used=!1,I.tileCoverLift=0}for(const T of this._mergedOrder){const I=this._mergedLayers[T];if(I.recalculate(t,this._availableImages),!I.isHidden(t.zoom)){const F=this.getLayerSourceCache(I);F&&(F.used=!0,F.tileCoverLift=Math.max(F.tileCoverLift,I.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(I,t)}):this.precompilePrograms(I,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();for(const T in b){const I=this._mergedSourceCaches[T];b[T]!==I.used&&I.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new r.z("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const n in this._sourceCaches)this._sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,n,d){const y=this.getFragmentStyle(t);y&&this.dispatcher.broadcast("updateLayers",{layers:n?y._serializeLayers(n):[],scope:t,removedIds:d||[],options:y.options})}setState(t,n){if(this._checkLoaded(),Fa(this,Jr(t)))return!1;(t=r.cp(t)).layers=Bh(t.layers);const d=function(T,I){if(!T)return[{command:Ji.setStyle,args:[I]}];let F=[];try{if(!r.bn(T.version,I.version))return[{command:Ji.setStyle,args:[I]}];if(r.bn(T.center,I.center)||F.push({command:Ji.setCenter,args:[I.center]}),r.bn(T.zoom,I.zoom)||F.push({command:Ji.setZoom,args:[I.zoom]}),r.bn(T.bearing,I.bearing)||F.push({command:Ji.setBearing,args:[I.bearing]}),r.bn(T.pitch,I.pitch)||F.push({command:Ji.setPitch,args:[I.pitch]}),r.bn(T.sprite,I.sprite)||F.push({command:Ji.setSprite,args:[I.sprite]}),r.bn(T.glyphs,I.glyphs)||F.push({command:Ji.setGlyphs,args:[I.glyphs]}),r.bn(T.imports,I.imports)||function(Q=[],ce=[],ae){ce=ce||[];const de=(Q=Q||[]).map(Hs),pe=ce.map(Hs),Te=Q.reduce(ka,{}),ke=ce.reduce(ka,{}),De=de.slice();let Ue,Le,Ne,Oe;for(Ue=0,Le=0;Ue<de.length;Ue++)Ne=de[Ue],ke.hasOwnProperty(Ne)?Le++:(ae.push({command:Ji.removeImport,args:[Ne]}),De.splice(De.indexOf(Ne,Le),1));for(Ue=0,Le=0;Ue<pe.length;Ue++)Ne=pe[pe.length-1-Ue],De[De.length-1-Ue]!==Ne&&(Te.hasOwnProperty(Ne)?(ae.push({command:Ji.removeImport,args:[Ne]}),De.splice(De.lastIndexOf(Ne,De.length-Le),1)):Le++,Oe=De[De.length-Ue],ae.push({command:Ji.addImport,args:[ke[Ne],Oe]}),De.splice(De.length-Ue,0,Ne));for(const We of ce){const Qe=Te[We.id];Qe&&!r.bn(Qe,We)&&ae.push({command:Ji.updateImport,args:[We.id,We]})}}(T.imports,I.imports,F),r.bn(T.transition,I.transition)||F.push({command:Ji.setTransition,args:[I.transition]}),r.bn(T.light,I.light)||F.push({command:Ji.setLight,args:[I.light]}),r.bn(T.fog,I.fog)||F.push({command:Ji.setFog,args:[I.fog]}),r.bn(T.snow,I.snow)||F.push({command:Ji.setSnow,args:[I.snow]}),r.bn(T.rain,I.rain)||F.push({command:Ji.setRain,args:[I.rain]}),r.bn(T.projection,I.projection)||F.push({command:Ji.setProjection,args:[I.projection]}),r.bn(T.lights,I.lights)||F.push({command:Ji.setLights,args:[I.lights]}),r.bn(T.camera,I.camera)||F.push({command:Ji.setCamera,args:[I.camera]}),!r.bn(T["color-theme"],I["color-theme"]))return[{command:Ji.setStyle,args:[I]}];const V={},j=[];(function(Q,ce,ae,de){let pe;for(pe in ce=ce||{},Q=Q||{})Q.hasOwnProperty(pe)&&(ce.hasOwnProperty(pe)||Ha(pe,ae,de));for(pe in ce){if(!ce.hasOwnProperty(pe))continue;const Te=ce[pe];Q.hasOwnProperty(pe)?r.bn(Q[pe],Te)||(Q[pe].type==="geojson"&&Te.type==="geojson"&&Lr(Q,ce,pe)?ae.push({command:Ji.setGeoJSONSourceData,args:[pe,Te.data]}):yi(pe,ce,ae,de)):qc(pe,ce,ae)}})(T.sources,I.sources,j,V);const G=[];T.layers&&T.layers.forEach(Q=>{Q.source&&V[Q.source]?F.push({command:Ji.removeLayer,args:[Q.id]}):G.push(Q)});let q=T.terrain;q&&V[q.source]&&(F.push({command:Ji.setTerrain,args:[void 0]}),q=void 0),F=F.concat(j),r.bn(q,I.terrain)||F.push({command:Ji.setTerrain,args:[I.terrain]}),function(Q,ce,ae){ce=ce||[];const de=(Q=Q||[]).map(Hs),pe=ce.map(Hs),Te=Q.reduce(ka,{}),ke=ce.reduce(ka,{}),De=de.slice(),Ue=Object.create(null);let Le,Ne,Oe,We,Qe,xt,ut;for(Le=0,Ne=0;Le<de.length;Le++)Oe=de[Le],ke.hasOwnProperty(Oe)?Ne++:(ae.push({command:Ji.removeLayer,args:[Oe]}),De.splice(De.indexOf(Oe,Ne),1));for(Le=0,Ne=0;Le<pe.length;Le++)Oe=pe[pe.length-1-Le],De[De.length-1-Le]!==Oe&&(Te.hasOwnProperty(Oe)?(ae.push({command:Ji.removeLayer,args:[Oe]}),De.splice(De.lastIndexOf(Oe,De.length-Ne),1)):Ne++,xt=De[De.length-Le],ae.push({command:Ji.addLayer,args:[ke[Oe],xt]}),De.splice(De.length-Le,0,Oe),Ue[Oe]=!0);for(Le=0;Le<pe.length;Le++)if(Oe=pe[Le],We=Te[Oe],Qe=ke[Oe],!Ue[Oe]&&!r.bn(We,Qe))if(r.bn(We.source,Qe.source)&&r.bn(We["source-layer"],Qe["source-layer"])&&r.bn(We.type,Qe.type)){for(ut in Sr(We.layout,Qe.layout,ae,Oe,null,Ji.setLayoutProperty),Sr(We.paint,Qe.paint,ae,Oe,null,Ji.setPaintProperty),r.bn(We.slot,Qe.slot)||ae.push({command:Ji.setSlot,args:[Oe,Qe.slot]}),r.bn(We.filter,Qe.filter)||ae.push({command:Ji.setFilter,args:[Oe,Qe.filter]}),r.bn(We.minzoom,Qe.minzoom)&&r.bn(We.maxzoom,Qe.maxzoom)||ae.push({command:Ji.setLayerZoomRange,args:[Oe,Qe.minzoom,Qe.maxzoom]}),We)We.hasOwnProperty(ut)&&ut!=="layout"&&ut!=="paint"&&ut!=="filter"&&ut!=="metadata"&&ut!=="minzoom"&&ut!=="maxzoom"&&ut!=="slot"&&(ut.indexOf("paint.")===0?Sr(We[ut],Qe[ut],ae,Oe,ut.slice(6),Ji.setPaintProperty):r.bn(We[ut],Qe[ut])||ae.push({command:Ji.setLayerProperty,args:[Oe,ut,Qe[ut]]}));for(ut in Qe)Qe.hasOwnProperty(ut)&&!We.hasOwnProperty(ut)&&ut!=="layout"&&ut!=="paint"&&ut!=="filter"&&ut!=="metadata"&&ut!=="minzoom"&&ut!=="maxzoom"&&ut!=="slot"&&(ut.indexOf("paint.")===0?Sr(We[ut],Qe[ut],ae,Oe,ut.slice(6),Ji.setPaintProperty):r.bn(We[ut],Qe[ut])||ae.push({command:Ji.setLayerProperty,args:[Oe,ut,Qe[ut]]}))}else ae.push({command:Ji.removeLayer,args:[Oe]}),xt=De[De.lastIndexOf(Oe)+1],ae.push({command:Ji.addLayer,args:[Qe,xt]})}(G,I.layers,F)}catch(V){console.warn("Unable to compute style diff:",V),F=[{command:Ji.setStyle,args:[I]}]}return F}(this.serialize(),t).filter(T=>!(T.command in vf));if(d.length===0)return!1;const y=d.filter(T=>!(T.command in ap));if(y.length>0)throw new Error(`Unimplemented: ${y.map(T=>T.command).join(", ")}.`);const b=[];return d.forEach(T=>{b.push(this[T.command].apply(this,T.args))}),n&&Promise.all(b).then(n),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,n){return this.getImage(t)?this.fire(new r.y(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,n),this._afterImageUpdated(t),this)}updateImage(t,n,d=!1){this.imageManager.updateImage(t,this.scope,n),d&&this._afterImageUpdated(t)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new r.y(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.z("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,n,d={}){return this._checkLoaded(),this._validate(Gu,`models.${t}`,n,null,d)||(this.modelManager.addModel(t,n,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,n,d={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(Pa,`sources.${t}`,n,null,d))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const y=$s(t,n,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id}));const b=T=>{const I=(T?"symbol:":"other:")+y.id,F=r.aC(I,this.scope),V=this._sourceCaches[I]=new Yo(F,y,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=V,V.onAdd(this.map)};b(!1),n.type!=="vector"&&n.type!=="geojson"||b(!0),y.onAdd&&y.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const n=this.getOwnSource(t);if(!n)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===t)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const d=this.getOwnSourceCaches(t);for(const y of d){const b=r.cq(y.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(y.id),y.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,n){this._checkLoaded(),this.getOwnSource(t).setData(n),this._changes.setDirty()}getOwnSource(t){const n=this.getOwnSourceCache(t);return n&&n.getSource()}getOwnSources(){const t=[];for(const n in this._otherSourceCaches){const d=this.getOwnSourceCache(n);d&&t.push(d.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const n in t){const d=t[n]._tiles;for(const y in d){const b=d[y];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const y of t){if(this._validate(fl,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){const b=this.ambientLight;b.set(y),b.updateTransitions(n)}else this.ambientLight=new ki(y,Zt||(Zt=new r.a5({color:new r.a6(r.a3.properties_light_ambient.color),"color-use-theme":new r.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a6(r.a3.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const b=this.directionalLight;b.set(y),b.updateTransitions(n)}else this.directionalLight=new ki(y,Jt||(Jt=new r.a5({direction:new r.ak(r.a3.properties_light_directional.direction),color:new r.a6(r.a3.properties_light_directional.color),"color-use-theme":new r.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a6(r.a3.properties_light_directional.intensity),"cast-shadows":new r.a6(r.a3.properties_light_directional["cast-shadows"]),"shadow-quality":new r.a6(r.a3.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.a6(r.a3.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const d=new r.a8(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(d),this.directionalLight&&this.directionalLight.recalculate(d),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,n=this.ambientLight;if(!t||!n)return;const d=q=>.2126*(q[0]<=.03928?q[0]/12.92:Math.pow((q[0]+.055)/1.055,2.4))+.7152*(q[1]<=.03928?q[1]/12.92:Math.pow((q[1]+.055)/1.055,2.4))+.0722*(q[2]<=.03928?q[2]/12.92:Math.pow((q[2]+.055)/1.055,2.4)),y=t.properties.get("color").toRenderColor(null).toArray01(),b=t.properties.get("intensity"),T=t.properties.get("direction"),I=1-r.cb(T.x,T.y,T.z)[2]/90,F=d(y)*b*I,V=n.properties.get("color").toRenderColor(null).toArray01(),j=n.properties.get("intensity"),G=d(V)*j;return Number(((F+G)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(r.cr(t)){const n=r.cs(t),d=this.fragments.find(({id:b})=>b===n);if(!d)throw new Error(`Style import '${t}' not found`);const y=r.cq(t);return d.style.getFragmentStyle(y)}{const n=this.fragments.find(({id:d})=>d===t);return n?n.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const n={},d=(y,b="")=>`${y}::${b}`;this._featuresetSelectors={};for(const y in t){const b=this._featuresetSelectors[y]=[];for(const T of t[y].selectors){if(T.featureNamespace){const F=this.getOwnLayer(T.layer);if(!F){r.w(`Layer is undefined for selector: ${T.layer}`);continue}const V=d(F.source,F.sourceLayer);if(V in n&&n[V]!==T.featureNamespace){r.w(`"featureNamespace ${T.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}n[V]=T.featureNamespace}let I;if(T.properties)for(const F in T.properties){const V=r.U(T.properties[F]);V.result==="success"&&(I=I||{},I[F]=V.value)}b.push({layerId:T.layer,namespace:T.featureNamespace,properties:I,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const n=this.getFragmentStyle(t);if(!n||!n.stylesheet.featuresets)return[];const d=[];for(const y in n.stylesheet.featuresets)d.push({featuresetId:y,importId:n.scope?n.scope:void 0});return d}getFeaturesetLayers(t,n){const d=this.getFragmentStyle(n),y=d.stylesheet.featuresets;if(!y||!y[t])return this.fire(new r.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const T of y[t].selectors){const I=d.getOwnLayer(T.layer);I&&b.push(I)}return b}getConfigProperty(t,n){const d=this.getFragmentStyle(t);if(!d)return null;const y=r.aC(n,d.scope),b=d.options.get(y),T=b?b.value||b.default:null;return T?T.serialize():null}setConfigProperty(t,n,d){const y=this.getFragmentStyle(t);if(!y)return;const b=y.stylesheet.indoor?sp(y.stylesheet.schema):y.stylesheet.schema;if(!b||!b[n])return;const T=r.U(d);if(T.result!=="success")return void Fa(this,T.value);const I=T.value.expression,F=r.aC(n,y.scope),V=y.options.get(F);if(!V)return;let j;const{minValue:G,maxValue:q,stepValue:Q,type:ce,values:ae}=b[n],de=r.U(b[n].default);de.result==="success"&&(j=de.value.expression),j?(this.options.set(F,Object.assign({},V,{value:I,default:j,minValue:G,maxValue:q,stepValue:Q,type:ce,values:ae})),this.updateConfigDependencies(n)):this.fire(new r.y(new Error(`No schema defined for the config option "${n}" in the "${t}" fragment.`)))}getConfig(t){const n=this.getFragmentStyle(t);if(!n)return null;const d=n.stylesheet.schema;if(!d)return null;const y={};for(const b in d){const T=r.aC(b,n.scope),I=n.options.get(T),F=I?I.value||I.default:null;y[b]=F?F.serialize():null}return y}setConfig(t,n){const d=this.getFragmentStyle(t);d&&(d.updateConfig(n,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const n=this.getFragmentStyle(t);return n?n.stylesheet.schema:null}setSchema(t,n){const d=this.getFragmentStyle(t);d&&(d.stylesheet.schema=n,d.updateConfig(d._config,n),this.updateConfigDependencies())}updateConfig(t,n){if(this._config=t,t||n)if(n)for(const d in n){let y,b;const T=r.U(n[d].default);if(T.result==="success"&&(y=T.value.expression),t&&t[d]!==void 0){const q=r.U(t[d]);q.result==="success"&&(b=q.value.expression)}const{minValue:I,maxValue:F,stepValue:V,type:j,values:G}=n[d];if(y){const q=r.aC(d,this.scope);this.options.set(q,{default:y,value:b,minValue:I,maxValue:F,stepValue:V,type:j,values:G})}else this.fire(new r.y(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const n of this._configDependentLayers){const d=this.getLayer(n);if(d){if(t&&!d.configDependencies.has(t))continue;d.possiblyEvaluateVisibility(),this._updateLayer(d)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(n=>{const d=n._styleColorTheme.colorThemeOverride?n._styleColorTheme.colorThemeOverride:n._styleColorTheme.colorTheme;if(d){const y=n._evaluateColorThemeData(d);(!n._styleColorTheme.lut&&y!==""||n._styleColorTheme.lut&&y!==n._styleColorTheme.lut.data)&&n.setColorTheme(d)}}),this._changes.setDirty()}addLayer(t,n,d={}){this._checkLoaded();const y=t.id;if(this._layers[y])return void this.fire(new r.y(new Error(`Layer with id "${y}" already exists on this map`)));let b;if(t.type==="custom"){if(Fa(this,r.ct(t)))return;b=r.cu(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(y,t.source),t=r.cp(t),t=r.l(t,{source:y})),this._validate(Fh,`layers.${y}`,t,{arrayIndex:-1},d))return;b=r.cu(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:y}})}b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid);let T=this._order.length;if(n){const j=this._order.indexOf(n);if(j===-1)return void this.fire(new r.y(new Error(`Layer with id "${n}" does not exist on this map.`)));b.slot===this._layers[n].slot?T=j:r.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,y),this._layerOrderChanged=!0,this._layers[y]=b;const I=this.getOwnLayerSourceCache(b),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&b.canCastShadows()&&F&&(I.castsShadows=!0);const V=this._changes.getRemovedLayer(b);if(V&&b.source&&I&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const j=r.aC(b.source,b.scope);V.type!==b.type?this._changes.updateSourceCache(j,"clear"):(this._changes.updateSourceCache(j,"reload"),I.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(t,n){this._checkLoaded();const d=this._checkLayer(t);if(!d||t===n)return;const y=this._order.indexOf(t);this._order.splice(y,1);let b=this._order.length;if(n){const T=this._order.indexOf(n);if(T===-1)return void this.fire(new r.y(new Error(`Layer with id "${n}" does not exist on this map.`)));d.slot===this._layers[n].slot?b=T:r.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const n=this._checkLayer(t);if(!n)return;n.setEventedParent(null);const d=this._order.indexOf(t);this._order.splice(d,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._changes.removeLayer(n);const y=this.getOwnLayerSourceCache(n);if(y&&y.castsShadows){let b=!1;for(const T in this._layers)if(this._layers[T].source===n.source&&this._layers[T].canCastShadows()){b=!0;break}y.castsShadows=b}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const n in this._layers)if(this._layers[n].type===t)return!0;return!1}setLayerZoomRange(t,n,d){this._checkLoaded();const y=this._checkLayer(t);y&&(y.minzoom===n&&y.maxzoom===d||(n!=null&&(y.minzoom=n),d!=null&&(y.maxzoom=d),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,n){this._checkLoaded();const d=this._checkLayer(t);d&&d.slot!==n&&(d.slot=n,this._updateLayer(d))}setFilter(t,n,d={}){this._checkLoaded();const y=this._checkLayer(t);if(y&&!r.bn(y.filter,n))return n==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(ts,`layers.${y.id}.filter`,n,{layerType:y.type},d)||(y.filter=r.cp(n),this._updateLayer(y)))}getFilter(t){const n=this._checkLayer(t);if(n)return r.cp(n.filter)}setLayoutProperty(t,n,d,y={}){this._checkLoaded();const b=this._checkLayer(t);if(b&&!r.bn(b.getLayoutProperty(n),d)){if(d!=null&&(!y||y.validate!==!1)&&Fa(b,Hu.call(Jr,{key:`layers.${t}.layout.${n}`,layerType:b.type,objectKey:n,value:d,styleSpec:r.a3,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(n,d),b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),this._updateLayer(b)}}getLayoutProperty(t,n){const d=this._checkLayer(t);if(d)return d.getLayoutProperty(n)}setPaintProperty(t,n,d,y={}){this._checkLoaded();const b=this._checkLayer(t);if(!b||r.bn(b.getPaintProperty(n),d)||d!=null&&(!y||y.validate!==!1)&&Fa(b,Jl.call(Jr,{key:`layers.${t}.paint.${n}`,layerType:b.type,objectKey:n,value:d,styleSpec:r.a3})))return;const T=b.setPaintProperty(n,d);b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),T&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(t,n){const d=this._checkLayer(t);if(d)return d.getPaintProperty(n)}setFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:F,importId:V}=t.target,j=this.getFragmentStyle(V),G=j.getFeaturesetLayers(F);for(const{source:q,sourceLayer:Q}of G)j.setFeatureState({id:t.id,source:q,sourceLayer:Q},n)}else if("layerId"in t.target){const{layerId:F}=t.target,V=this.getLayer(F);this.setFeatureState({id:t.id,source:V.source,sourceLayer:V.sourceLayer},n)}return}const d=t.source,y=t.sourceLayer,b=this._checkSource(d);if(!b)return;const T=b.type;if(T==="geojson"&&y)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!y)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(d);for(const F of I)F.setFeatureState(y,t.id,n)}removeFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:F,importId:V}=t.target,j=this.getFragmentStyle(V),G=j.getFeaturesetLayers(F);for(const{source:q,sourceLayer:Q}of G)j.removeFeatureState({id:t.id,source:q,sourceLayer:Q},n)}else if("layerId"in t.target){const{layerId:F}=t.target,V=this.getLayer(F);this.removeFeatureState({id:t.id,source:V.source,sourceLayer:V.sourceLayer},n)}return}const d=t.source,y=this._checkSource(d);if(!y)return;const b=y.type,T=b==="vector"?t.sourceLayer:void 0;if(b==="vector"&&!T)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(d);for(const F of I)F.removeFeatureState(T,t.id,n)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let b;if("featuresetId"in t.target){const{featuresetId:T,importId:I}=t.target,F=this.getFragmentStyle(I),V=F.getFeaturesetLayers(T);for(const{source:j,sourceLayer:G}of V){const q=F.getFeatureState({id:t.id,source:j,sourceLayer:G});if(q&&!b)b=q;else if(!r.bn(b,q))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:T}=t.target,I=this.getLayer(T);b=this.getFeatureState({id:t.id,source:I.source,sourceLayer:I.sourceLayer})}return b}const n=t.source,d=t.sourceLayer,y=this._checkSource(n);if(y){if(y.type!=="vector"||d)return t.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(d,t.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=r.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return r.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),n=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return r.cv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateFilteredLayers(t){for(const n of Object.values(this._mergedLayers))t(n)&&this._updateLayer(n)}_updateLayer(t){this._changes.updateLayer(t);const n=this.getLayerSourceCache(t),d=r.aC(t.source,t.scope),y=this._changes.getUpdatedSourceCaches();t.source&&!y[d]&&n&&n.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),n.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const n=I=>this._mergedLayers[I].is3D(),d=this.order,y={},b=[];for(let I=d.length-1;I>=0;I--){const F=d[I];if(n(F)){y[F]=I;for(const V of t){const j=V[F];if(j)for(const G of j)b.push(G)}}}b.sort((I,F)=>F.intersectionZ-I.intersectionZ);const T=[];for(let I=d.length-1;I>=0;I--){const F=d[I];if(n(F))for(let V=b.length-1;V>=0;V--){const j=b[V].feature;if(j.layer&&y[j.layer.id]<I)break;T.push(j),b.pop()}else for(const V of t){const j=V[F];if(j)for(const G of j)T.push(G.feature)}}return T}queryRenderedFeatures(t,n,d){let y;n&&!Array.isArray(n)&&n.filter&&(this._validate(ts,"queryRenderedFeatures.filter",n.filter,null,n),y=r.aZ(n.filter));const b={},T=j=>{if(tu.has(j.type))return;const G=this.getOwnLayerSourceCache(j),q=b[G.id]=b[G.id]||{sourceCache:G,layers:{},has3DLayers:!1};j.is3D()&&(q.has3DLayers=!0),q.layers[j.fqid]=q.layers[j.fqid]||{styleLayer:j,targets:[]},q.layers[j.fqid].targets.push({filter:y})};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(const j of n.layers){const G=this._layers[j];if(!G)return this.fire(new r.y(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];T(G)}}else for(const j in this._layers)T(this._layers[j]);const I=this._queryRenderedFeatures(t,b,d),F=this._flattenAndSortRenderedFeatures(I),V=[];for(const j of F)r.cs(j.layer.id)===this.scope&&V.push(j);return V}queryRenderedFeatureset(t,n,d){let y;n&&!Array.isArray(n)&&n.filter&&(this._validate(ts,"queryRenderedFeatures.filter",n.filter,null,n),y=r.aZ(n.filter));const b="mock",T=[];if(n&&n.target)T.push(Object.assign({},n,{targetId:b,filter:y}));else{const j=this.getFeaturesetDescriptors();for(const G of j)T.push({targetId:b,filter:y,target:G});for(const{style:G}of this.fragments){const q=G.getFeaturesetDescriptors();for(const Q of q)T.push({targetId:b,filter:y,target:Q})}}const I=this.queryRenderedTargets(t,T,d),F=[],V=new Set;for(const j of I)for(const G of j.variants[b])Wo(G,j,V)||F.push(new r.cw(j,G));return F}queryRenderedTargets(t,n,d){const y={},b=(I,F,V,j)=>{const G=y[F.id]=y[F.id]||{sourceCache:F,layers:{},has3DLayers:!1};if(G.layers[I.fqid]=G.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D()&&(G.has3DLayers=!0),!j)return V.uniqueFeatureID=!1,void G.layers[I.fqid].targets.push(V);G.layers[I.fqid].targets.push(Object.assign({},V,{namespace:j.namespace,properties:j.properties,uniqueFeatureID:j.uniqueFeatureID}))};for(const I of n)if("featuresetId"in I.target){const{featuresetId:F,importId:V}=I.target,j=this.getFragmentStyle(V);if(!j||!j._featuresetSelectors)continue;const G=j._featuresetSelectors[F];if(!G){this.fire(new r.y(new Error(`The featureset '${F}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const q of G){const Q=j.getOwnLayer(q.layerId);Q&&!tu.has(Q.type)&&b(Q,j.getOwnLayerSourceCache(Q),I,q)}}else if("layerId"in I.target){const{layerId:F}=I.target,V=this.getLayer(F);if(!V||tu.has(V.type))continue;b(V,this.getLayerSourceCache(V),I)}const T=this._queryRenderedFeatures(t,y,d);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(t,n,d){const y=[],b=!!this.map._showQueryGeometry,T=Pi.createFromScreenPoints(t,d);for(const I in n){const F=Gc(T,n[I],this._availableImages,d,b);Object.keys(F).length&&y.push(F)}if(this.placement)for(const I in n){if(!n[I].sourceCache._onlySymbols)continue;const F=Po(T.screenGeometry,n[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(F).length&&y.push(F)}return y}querySourceFeatures(t,n){const d=n&&n.filter;d&&this._validate(ts,"querySourceFeatures.filter",d,null,n);let y=[];const b=this.getOwnSourceCaches(t);for(const T of b)y=y.concat(Wc(T,n));return y}addSourceType(t,n,d){return Lo.getSourceType(t)?d(new Error(`A source type called "${t}" already exists.`)):(Lo.setSourceType(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,n,d={}){this._checkLoaded();const y=this.light.getLight();let b=!1;for(const I in t)if(!r.bn(t[I],y[I])){b=!0;break}if(!b)return;const T=this._getTransitionParameters();this.light.setLight(t,n,d),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,n=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),n===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=t;const y=t.source==null;if(n===1){if(this.disableElevatedTerrain)return;if(typeof d.source=="object"){const I="terrain-dem-src";this.addSource(I,d.source),d=r.cp(d),d=r.l(d,{source:I})}const b=r.l({},d),T={};if(this.terrain&&y){b.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(T.style=I.serialize())}if(this._validate(jc,"terrain",b,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&n!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,n),this.fire(new r.z("data",{dataType:"style"}))}else{const b=this.terrain,T=b.get();for(const I of Object.keys(r.a3.terrain))!d.hasOwnProperty(I)&&r.a3.terrain[I].default&&(d[I]=r.a3.terrain[I].default);for(const I in t)if(!r.bn(t[I],T[I])){b.set(t,this.options),this.stylesheet.terrain=t;const F=this._getTransitionParameters({duration:0});b.updateTransitions(F),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const n=this.fog=new pt(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=n.get();const d=this._getTransitionParameters({duration:0});n.updateTransitions(d)}_createSnow(t){const n=this.snow=new fi(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=n.get();const d=this._getTransitionParameters({duration:0});n.updateTransitions(d)}_createRain(t){const n=this.rain=new Ii(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=n.get();const d=this._getTransitionParameters({duration:0});n.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!r.bn(n.get(),t)){n.set(t,this.options),this.stylesheet.fog=n.get();const d=this._getTransitionParameters({duration:0});n.updateTransitions(d)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const n=this.snow;if(!r.bn(n.get(),t)){n.set(t,this.options),this.stylesheet.snow=n.get();const d=this._getTransitionParameters({duration:0});n.updateTransitions(d)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const n=this.rain;if(!r.bn(n.get(),t)){n.set(t,this.options),this.stylesheet.rain=n.get();const d=this._getTransitionParameters({duration:0});n.updateTransitions(d)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},n=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!n)return this._styleColorTheme.lut=null,void t();const d=this._evaluateColorThemeData(n);this._loadColorTheme(d).then(()=>{this.fire(new r.z("colorthemeset")),t()}).catch(y=>{r.w(`Couldn't set color theme: ${y}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,n){const d=this.getFragmentStyle(t);d&&(d._styleColorTheme.colorThemeOverride=n,d._reloadColorTheme())}_getTransitionParameters(t){return{now:r.q.now(),transition:r.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],n=[];for(const d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?t.push(d):n.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...n)}_createTerrain(t,n){const d=this.terrain=new me(t,n,this.scope,this.options);n===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}_force3DLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="fill-extrusion"&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="symbol"&&this._updateLayer(n)}}_validate(t,n,d,y,b={}){if(b&&b.validate===!1)return!1;const T=r.l({},this.serialize());return Fa(this,t.call(Jr,r.l({key:n,style:T,value:d,styleSpec:r.a3},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.cx.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const n=this.getSourceCaches(t);for(const d of n)d.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const n=this.getSourceCaches(t);for(const d of n)d.resume(),d.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let n;this.directionalLight&&(n=nc(this.directionalLight));for(const d in this._mergedSourceCaches)this._mergedSourceCaches[d].update(t,void 0,void 0,n)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const n=this._sourceCaches[t];n.resume(),n.reload()}}_updatePlacement(t,n,d,y,b,T,I=!1){let F=!1,V=!1;const j={},G={};for(const q of this._mergedOrder){const Q=this._mergedLayers[q];if(Q.type!=="symbol")continue;const ce=r.aC(Q.source,Q.scope);let ae=j[ce];if(!ae){const pe=this.getLayerSourceCache(Q);if(!pe)continue;const Te=pe.getRenderableIds(!0).map(ke=>pe.getTileByID(ke));G[ce]=Te.slice(),ae=j[ce]=Te.sort((ke,De)=>De.tileID.overscaledZ-ke.tileID.overscaledZ||(ke.tileID.isLessThan(De.tileID)?-1:1))}const de=this.crossTileSymbolIndex.addLayer(Q,ae,n.center.lng,n.projection);F=F||de}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new r.z("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.q.now(),n.zoom))&&(this.pauseablePlacement=new jm(n,this._mergedOrder,I,d,y,b,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,j,G,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.q.now()),V=!0),F&&this.pauseablePlacement.placement.setStale()),V||F){this._buildingIndex.onNewFrame(n.zoom);for(let q=0;q<this._mergedOrder.length;q++){const Q=this._mergedLayers[this._mergedOrder[q]];if(Q.type!=="symbol")continue;const ce=this.isLayerClipped(Q);this.placement.updateLayerOpacities(Q,j[r.aC(Q.source,Q.scope)],q,ce?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,n){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex(({id:b})=>b===t.id)!==-1)return void this.fire(new r.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!n)return d.push(t),this._loadImports([t],!0);const y=d.findIndex(({id:b})=>b===n);return y===-1&&this.fire(new r.y(new Error(`Import with id "${n}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,y).concat(t).concat(d.slice(y)),this._loadImports([t],!0,n)}updateImport(t,n){this._checkLoaded();const d=this.stylesheet.imports||[],y=this.getImportIndex(t);return y===-1?this:typeof n=="string"?(this.setImportUrl(t,n),this):(n.url&&n.url!==d[y].url&&this.setImportUrl(t,n.url),r.bn(n.config,d[y].config)||this.setImportConfig(t,n.config,n.data.schema),r.bn(n.data,d[y].data)||this.setImportData(t,n.data),this)}moveImport(t,n){this._checkLoaded();let d=this.stylesheet.imports||[];const y=this.getImportIndex(t);if(y===-1)return this;const b=this.getImportIndex(n);if(b===-1)return this;const T=d[y],I=this.fragments[y];return d=d.filter(({id:F})=>F!==t),this.fragments=this.fragments.filter(({id:F})=>F!==t),this.stylesheet.imports=d.slice(0,b).concat(T).concat(d.slice(b)),this.fragments=this.fragments.slice(0,b).concat(I).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(t,n){this._checkLoaded();const d=this.stylesheet.imports||[],y=this.getImportIndex(t);if(y===-1)return this;d[y].url=n;const b=this.fragments[y];return b.style=this._createFragmentStyle(d[y]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(n),this}setImportData(t,n){this._checkLoaded();const d=this.getImportIndex(t),y=this.stylesheet.imports||[];return d===-1?this:n?(this.fragments[d].style.setState(n),this._reloadImports(),this):(delete y[d].data,this.setImportUrl(t,y[d].url))}setImportConfig(t,n,d){this._checkLoaded();const y=this.getImportIndex(t),b=this.stylesheet.imports||[];if(y===-1)return this;n?b[y].config=n:delete b[y].config;const T=this.fragments[y];d&&T.style.stylesheet&&(T.style.stylesheet.schema=d);const I=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=n,T.style.updateConfig(n,I),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const n=this.stylesheet.imports||[],d=this.getImportIndex(t);d!==-1&&(n.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(t){const n=(this.stylesheet.imports||[]).findIndex(d=>d.id===t);return n===-1&&this.fire(new r.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),n}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const n in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[n];d&&t.push(d.getSource())}return t}getSource(t,n){const d=this.getSourceCache(t,n);return d&&d.getSource()}getLayerSource(t){const n=this.getLayerSourceCache(t);return n&&n.getSource()}getSourceCache(t,n){const d=r.aC(t,n);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(t){const n=r.aC(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const n=[];return this._mergedOtherSourceCaches[t]&&n.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&n.push(this._mergedSymbolSourceCaches[t]),n}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const n in t){const d=t[n];d==="reload"?this.reloadSource(n):d==="clear"&&this.clearSource(n)}}updateLayers(t){const n=this._changes.getUpdatedPaintProperties();for(const d of n){const y=this.getLayer(d);y&&y.updateTransitions(t)}}getImages(t,n,d){this.imageManager.getImages(n.icons,n.scope,d),this._updateTilesForChangedImages();const y=b=>{b&&b.setDependencies(n.tileID.key,n.type,n.icons)};y(this._otherSourceCaches[n.source]),y(this._symbolSourceCaches[n.source])}rasterizeImages(t,n,d){this.imageManager.rasterizeImages(n,d)}getGlyphs(t,n,d){this.glyphManager.getGlyphs(n.stacks,n.scope,d)}getResource(t,n,d){return r.cy(n,d)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const n=[];return this._otherSourceCaches[t]&&n.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&n.push(this._symbolSourceCaches[t]),n}_isSourceCacheLoaded(t){const n=this.getOwnSourceCaches(t);return n.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${t}'`))),!1):n.every(d=>d.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,n){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const d=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D()){if(d||n&&n.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Lo.getSourceType=function(u){return Nn[u]},Lo.setSourceType=function(u,t){Nn[u]=t},Lo.registerForPluginStateChange=r.ch;var wl=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Qu=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,lc=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Sl="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Wh=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Ro=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Zo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,iu=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,ru=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,eh=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Xa=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const cc=[];Yr(wl,cc),Yr(lc,cc),Yr(Qu,cc);const nu={"_prelude_fog.vertex.glsl":Ro,"_prelude_terrain.vertex.glsl":Wh,"_prelude_shadow.vertex.glsl":eh,"_prelude_fog.fragment.glsl":Zo,"_prelude_shadow.fragment.glsl":Xa,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":iu,"_prelude_raster_particle.glsl":ru},su={};fr("",Wh),fr(Zo,Ro),fr(Xa,eh),fr(iu,""),fr(ru,"");const qh=fr(Qu,lc),uc=wl;var Ls={background:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:fr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:fr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:fr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:fr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:fr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:fr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:fr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:fr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:fr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:fr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:fr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:fr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:fr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:fr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:fr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:fr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Sl),skyboxGradient:fr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Sl),skyboxCapture:fr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:fr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:fr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:fr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:fr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:fr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:fr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:fr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Yr(u,t){const n=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of n)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=d.split(" ");for(const b of y)t.includes(b)||t.push(b)}}function fr(u,t){const n=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let y=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);y&&(y=y.map(V=>{const j=V.split(" ");return j[j.length-1]}),y=[...new Set(y)]);const b={},T=[],I=[];if(u=u.replace(n,(V,j)=>(I.push(j),"")),(t=t.replace(n,(V,j)=>(T.push(j),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let F=[...cc];Yr(u,F),Yr(t,F);for(const V of[...T,...I])nu[V]||console.error(`Undefined include: ${V}`),su[V]||(su[V]=[],Yr(nu[V],su[V])),F=[...F,...su[V]];return{fragmentSource:u=u.replace(d,(V,j,G,q,Q)=>(b[Q]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
in ${G} ${q} ${Q};
#else
uniform ${G} ${q} u_${Q};
#endif
`:j==="initialize"?`
#ifdef HAS_UNIFORM_u_${Q}
    ${G} ${q} ${Q} = u_${Q};
#endif
`:j==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    in ${G} ${q} ${Q};
#endif
`:j==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(d,(V,j,G,q,Q)=>{const ce=q==="float"?"vec2":q,ae=Q.match(/color/)?"color":ce;return j==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
in ${G} ${q} a_${Q};
#endif
`:b[Q]?j==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
in ${G} ${ce} a_${Q};
out ${G} ${q} ${Q};
#else
uniform ${G} ${q} u_${Q};
#endif
`:j==="initialize"?ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = a_${Q};
#else
    ${G} ${q} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = unpack_mix_${ae}(a_${Q}, u_${Q}_t);
#else
    ${G} ${q} ${Q} = u_${Q};
#endif
`:j==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    in ${G} ${q} a_${Q};
    out ${G} ${q} ${Q};
#endif
`:j==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    ${Q} = a_${Q};
#endif
`:void 0:j==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
in ${G} ${ce} a_${Q};
#else
uniform ${G} ${q} u_${Q};
#endif
`:j==="define-instanced"?ae==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Q}0;
in vec4 a_${Q}1;
in vec4 a_${Q}2;
in vec4 a_${Q}3;
#else
uniform ${G} ${q} u_${Q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${G} ${ce} a_${Q};
#else
uniform ${G} ${q} u_${Q};
#endif
`:j==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    ${G} ${q} ${Q} = a_${Q};
#endif
`:ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${G} ${q} ${Q} = a_${Q};
#else
    ${G} ${q} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${G} ${q} ${Q} = unpack_mix_${ae}(a_${Q}, u_${Q}_t);
#else
    ${G} ${q} ${Q} = u_${Q};
#endif
`}),staticAttributes:y,usedDefines:F,vertexIncludes:T,fragmentIncludes:I}}class lp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,n,d,y,b,T,I,F){this.context=t;let V=this.boundPaintVertexBuffers.length!==y.length;for(let G=0;!V&&G<y.length;G++)this.boundPaintVertexBuffers[G]!==y[G]&&(V=!0);let j=this.boundDynamicVertexBuffers.length!==I.length;for(let G=0;!j&&G<I.length;G++)this.boundDynamicVertexBuffers[G]!==I[G]&&(j=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==d||V||j||this.boundIndexBuffer!==b||this.boundVertexOffset!==T)this.freshBind(n,d,y,b,T,I,F);else{t.bindVertexArrayOES.set(this.vao);for(const G of I)G&&(G.bind(),F&&G.instanceCount&&G.setVertexAttribDivisor(t.gl,n,F));b&&b.dynamicDraw&&b.bind()}}freshBind(t,n,d,y,b,T,I){const F=t.numAttributes,V=this.context,j=V.gl;this.vao&&this.destroy(),this.vao=V.gl.createVertexArray(),V.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=y,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=T,n.enableAttributes(j,t),n.bind(),n.setVertexAttribPointers(j,t,b);for(const G of d)G.enableAttributes(j,t),G.bind(),G.setVertexAttribPointers(j,t,b);for(const G of T)G&&(G.enableAttributes(j,t),G.bind(),G.setVertexAttribPointers(j,t,b),I&&G.instanceCount&&G.setVertexAttribDivisor(j,t,I));y&&y.bind(),V.currentNumAttributes=F}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Tl(u,t){const n=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new r.aa(0,d/n).toLngLat().lat,new r.aa(0,(d+1)/n).toLngLat().lat]}function th(u,t,n,d,y,b,T){const I=u.context,F=I.gl,V=n.hillshadeFBO;if(!V)return;u.prepareDrawTile();const j=u.isTileAffectedByFog(t),G=u.getOrCreateProgram("hillshade",{overrideFog:j});I.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,V.colorAttachment.get());const q=((de,pe,Te,ke)=>{const De=Te.paint.get("hillshade-shadow-color"),Ue=Te.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Le=Te.paint.get("hillshade-highlight-color"),Ne=Te.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Oe=Te.paint.get("hillshade-accent-color"),We=Te.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Qe=Te.paint.get("hillshade-emissive-strength");let xt=r.ai(Te.paint.get("hillshade-illumination-direction"));if(Te.paint.get("hillshade-illumination-anchor")==="viewport")xt-=de.transform.angle;else if(de.style&&de.style.enable3dLights()&&de.style.directionalLight){const Dt=de.style.directionalLight.properties.get("direction"),At=r.cb(Dt.x,Dt.y,Dt.z);xt=r.ai(At[1])}const ut=!de.options.moving;return{u_matrix:ke||de.transform.calculateProjMatrix(pe.tileID.toUnwrapped(),ut),u_image:0,u_latrange:Tl(0,pe.tileID),u_light:[Te.paint.get("hillshade-exaggeration"),xt],u_shadow:De.toRenderColor(Ue?null:Te.lut),u_highlight:Le.toRenderColor(Ne?null:Te.lut),u_emissive_strength:Qe,u_accent:Oe.toRenderColor(We?null:Te.lut)}})(u,n,d,u.terrain?t.projMatrix:null);u.uploadCommonUniforms(I,G,t.toUnwrapped());const{tileBoundsBuffer:Q,tileBoundsIndexBuffer:ce,tileBoundsSegments:ae}=u.getTileBoundsBuffers(n);G.draw(u,F.TRIANGLES,y,b,T,zi.disabled,q,d.id,Q,ce,ae)}function An(u,t,n){if(!t.needsDEMTextureUpload)return;const d=u.context,y=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(n.stride);const b=n.getPixels();t.demTexture?t.demTexture.update(b,{premultiply:!1}):t.demTexture=new r.T(d,b,y.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function bf(u,t,n){const d=u.context,y=d.gl;if(!t.dem)return;const b=t.dem;if(d.activeTexture.set(y.TEXTURE1),An(u,t,b),!t.demTexture)return;t.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const T=b.dim;d.activeTexture.set(y.TEXTURE0);let I=t.hillshadeFBO;if(!I){const q=new r.T(d,{width:T,height:T,data:null},y.RGBA8);q.bind(y.LINEAR,y.CLAMP_TO_EDGE),I=t.hillshadeFBO=d.createFramebuffer(T,T,!0,"renderbuffer"),I.colorAttachment.set(q.texture)}d.bindFramebuffer.set(I.framebuffer),d.viewport.set([0,0,T,T]);const{tileBoundsBuffer:F,tileBoundsIndexBuffer:V,tileBoundsSegments:j}=u.getMercatorTileBoundsBuffers(),G=[];u.linearFloatFilteringSupported()&&G.push("TERRAIN_DEM_FLOAT_FORMAT"),u.getOrCreateProgram("hillshadePrepare",{defines:G}).draw(u,y.TRIANGLES,Si.disabled,Oi.disabled,Xi.unblended,zi.disabled,((q,Q)=>{const ce=Q.stride,ae=r.ab.mat4.create();return r.ab.mat4.ortho(ae,0,r.ag,-r.ag,0,0,1),r.ab.mat4.translate(ae,ae,[0,-r.ag,0]),{u_matrix:ae,u_image:1,u_dimension:[ce,ce],u_zoom:q.overscaledZ}})(t.tileID,b),n.id,F,V,j),t.needsHillshadePrepare=!1}class sn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Yh extends sn{getDefault(){return r.aj.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ir extends sn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Xh extends sn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class ou extends sn{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class wf extends sn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class ih extends sn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Or extends sn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ml extends sn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class rh extends sn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Sf extends sn{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class vo extends sn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class Zh extends sn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Za extends sn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class Kh extends sn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class cp extends sn{getDefault(){return r.aj.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class up extends sn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class hc extends sn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class hp extends sn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Jh extends sn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Qh=class extends sn{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class Tf extends sn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Mf extends sn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class au extends sn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Gm extends sn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Cf extends sn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Wm extends sn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class qm extends sn{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ef extends sn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Af extends sn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ko extends sn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class dp extends sn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ed extends sn{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class lu extends ed{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class td extends ed{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Pf extends ed{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Df extends td{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const cu=(u,t,n)=>({u_matrix:u,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),Cl=(u,t,n,d,y,b,T,I,F,V,j,G,q,Q,ce,ae)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:n,u_zoom_transition:y,u_merc_center:b,u_image0:0,u_frustum_tl:T,u_frustum_tr:I,u_frustum_br:F,u_frustum_bl:V,u_globe_pos:j,u_globe_radius:G,u_viewport:q,u_grid_matrix:ae?Float32Array.from(ae):new Float32Array(9),u_skirt_height:Q,u_far_z_cutoff:ce});function id(u,t){return u!=null&&t!=null&&!(!u.hasData()||!t.hasData())&&u.demTexture!=null&&t.demTexture!=null&&u.tileID.key!==t.tileID.key}const zo=new class{constructor(){this.operations={}}newMorphing(u,t,n,d,y){if(u in this.operations){const b=this.operations[u];b.to.tileID.key!==n.tileID.key&&(b.queued=n)}else this.operations[u]={startTime:d,phase:0,duration:y,from:t,to:n,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const t=this.operations[u];return{from:t.from,to:t.to,phase:t.phase}}update(u){for(const t in this.operations){const n=this.operations[t];for(n.phase=(u-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,u)){delete this.operations[t];break}}}_nextOp(u,t){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=t,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},rd={0:null,1:"TERRAIN_VERTEX_MORPHING"};function uu(u,t,n){if(t===0)return 0;const d=t<1&&n===514?.25/t:1;return 6*Math.pow(1.5,22-u)*Math.max(t,1)*d}function If(u,t){const n=1<<u.z;return!t&&(u.x===0||u.x===n-1)||u.y===0||u.y===n-1}const nd=u=>({u_matrix:u});function nh(u,t,n,d,y){if(y>0){const b=r.q.now(),T=(b-u.timeAdded)/y,I=t?(b-t.timeAdded)/y:-1,F=n.getSource(),V=d.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),j=!t||Math.abs(t.tileID.overscaledZ-V)>Math.abs(u.tileID.overscaledZ-V),G=j&&u.refreshedUponExpiration?1:r.aw(j?T:1-I,0,1);return u.refreshedUponExpiration&&T>=1&&(u.refreshedUponExpiration=!1),t?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}class El extends Yo{constructor(t){const n={type:"raster-dem",maxzoom:t.transform.maxZoom},d=new r.D(r.ci(),null),y=$s("mock-dem",n,d,t.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,n){t.state="loaded",n(null)}}class kf extends Yo{constructor(t){const n=$s("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new r.D(r.ci(),null),t.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,n,d){if(t.freezeTileCoverage)return;this.transform=t;const y=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,T)=>{if(b[T.key]="",!this._tiles[T.key]){const I=new gl(T,this._source.tileSize*T.overscaleFactor(),t.tileZoom);I.state="loaded",this._tiles[T.key]=I}return b},{});for(const b in this._tiles)b in y||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(t){const n=this.proxyCachedFBO[t];if(n!==void 0){const d=Object.values(n);this.renderCachePool.push(...d),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class pp extends r.aG{constructor(t,n,d){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=n,this.projMatrix=d}}class hu extends r.cJ{constructor(t,n){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,y,b]=function(F){const V=new r.b4,j=new r.aU,G=131;V.reserve(17161),j.reserve(33800);const q=r.ag/128,Q=r.ag+q/2,ce=Q+q;for(let de=-q;de<ce;de+=q)for(let pe=-q;pe<ce;pe+=q){const Te=pe<0||pe>Q||de<0||de>Q?24575:0,ke=r.aw(Math.round(pe),0,r.ag),De=r.aw(Math.round(de),0,r.ag);V.emplaceBack(ke+Te,De)}const ae=(de,pe)=>{const Te=pe*G+de;j.emplaceBack(Te+1,Te,Te+G),j.emplaceBack(Te+G,Te+G+1,Te+1)};for(let de=1;de<129;de++)for(let pe=1;pe<129;pe++)ae(pe,de);return[0,129].forEach(de=>{for(let pe=0;pe<130;pe++)ae(pe,de),ae(de,pe)}),[V,j,32768]}(),T=t.context;this.gridBuffer=T.createVertexBuffer(d,r.b6.members),this.gridIndexBuffer=T.createIndexBuffer(y),this.gridSegments=r.b7.simpleSegment(0,0,d.length,y.length),this.gridNoSkirtSegments=r.b7.simpleSegment(0,0,d.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new kf(n.map),this.orthoMatrix=r.ab.mat4.create(),r.ab.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.ag,0,r.ag,0,1);const I=T.gl;this._overlapStencilMode=new Oi({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new El(n.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,n,d){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const y=t.terrain.properties,b=t.terrain.drapeRenderMode===0,T=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.q.now();const I=t.terrain&&t.terrain.scope,F=y.get("source"),V=b?this._mockSourceCache:t.getSourceCache(F,I);if(!V)return void r.w(`Couldn't find terrain source "${F}".`);if(this.sourceCache=V,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(n):y.get("exaggeration"),!n.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const j=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const G=this.getScaledDemTileSize();this.sourceCache.update(n,G,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,j(),this._initializing=!0),j(),n.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const n=this._previousCameraAltitude,d=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=d;const y=n!=null?d-n:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const b=t.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(b);let I=b-this._previousZoom;const F=this._previousUpdateTimestamp;let V=b;this._evaluationZoom!=null&&(V=this._evaluationZoom,Math.abs(b-V)>.5&&(I=.5*(b-V+I)),I*y<0&&(V+=I)),this._evaluationZoom=V;const j=T.getExaggeration(V),G=j===T.getExaggeration(Math.max(0,V-.1));if(G&&Math.abs(j-this._exaggeration)<.01)return j;let q=Math.min(.1,.00375*(this._updateTimestamp-F));return(G||j<.1||Math.abs(I)<1e-4)&&(q=Math.min(.2,4*q)),r.af(this._exaggeration,j,q)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(r.aa.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=n.getIds().map(F=>{const V=n.getTileByID(F).tileID;return V.projMatrix=d.calculateProjMatrix(V.toUnwrapped()),V});(function(F,V){const j=V.transform.pointCoordinate(V.transform.getCameraPoint()),G=new r.P(j.x,j.y);F.sort((q,Q)=>{if(Q.overscaledZ-q.overscaledZ)return Q.overscaledZ-q.overscaledZ;const ce=new r.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),ae=new r.P(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),de=G.mult(1<<q.canonical.z);return de.x-=.5,de.y-=.5,de.distSqr(ce)-de.distSqr(ae)})})(y,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},y.forEach(F=>{this.proxyToSource[F.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const F in T){const V=T[F];if(!V.used||(V!==this.sourceCache&&this.resetTileLookupCache(V.id),this._setupProxiedCoordsForOrtho(V,t[F],b),V.usedForTerrain))continue;const j=t[F];V.getSource().reparseOverscaled&&this._assignTerrainTiles(j)}this.proxiedCoords[n.id]=y.map(F=>new pp(F,F.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const F of this.proxyCoords){const V=this.terrainTileForTile[F.key];if(!V)continue;const j=V.tileID.key;j in I||(this._visibleDemTiles.push(V),I[j]=j)}}_assignTerrainTiles(t){this._initializing||t.forEach(n=>{if(this.terrainTileForTile[n.key])return;const d=this._findTileCoveringTileID(n,this.sourceCache);d&&(this.terrainTileForTile[n.key]=d)})}_prepareDEMTextures(){const t=this.painter.context,n=t.gl;for(const d in this.terrainTileForTile){const y=this.terrainTileForTile[d],b=y.dem;!b||y.demTexture&&!y.needsDEMTextureUpload||(t.activeTexture.set(n.TEXTURE1),An(this.painter,y,b))}}_prepareDemTileUniforms(t,n,d,y){if(!n||n.demTexture==null)return!1;const b=t.tileID.canonical,T=Math.pow(2,n.tileID.canonical.z-b.z),I=y||"";return d[`u_dem_tl${I}`]=[b.x*T%1,b.y*T%1],d[`u_dem_scale${I}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const n=this._visibleDemTiles.reduce((d,y)=>{if(!y.dem)return d;const b=y.dem.tree.minimums[0];return b>0&&t++,d+b},0);return t?n/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const d=this._getLoadedAreaMinimum(),y=new r.cK({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(y,{premultiply:!1}):b=this._emptyDEMTexture=new r.T(t,y,n.R32F,{premultiply:!1}),b}setupElevationDraw(t,n,d){const y=this.painter.context,b=y.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let I=null,F=null,V=1;if(d&&d.morphing&&this._useVertexMorphing){const Q=d.morphing.srcDemTile,ce=d.morphing.dstDemTile;V=d.morphing.phase,Q&&ce&&(this._prepareDemTileUniforms(t,Q,T,"_prev")&&(F=Q),this._prepareDemTileUniforms(t,ce,T)&&(I=ce))}const j=Q=>Q&&Q.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let G=null;var q;if(this.enabled?F&&I?(G=I.demTexture,y.activeTexture.set(b.TEXTURE4),F.demTexture.bind(j(F),b.CLAMP_TO_EDGE),T.u_dem_lerp=V):(I=this.terrainTileForTile[t.tileID.key],G=this._prepareDemTileUniforms(t,I,T)?I.demTexture:this.emptyDEMTexture):G=this.emptyDEMTexture,y.activeTexture.set(b.TEXTURE2),G&&(T.u_dem_size=(q=G).size[0]===1?1:q.size[0]-2,G.bind(j(I),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,n,T),d&&d.useMeterToDem&&I){const Q=(1<<I.tileID.canonical.z)*r.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=Q}if(d&&d.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),n.setTerrainUniformValues(y,T),this.painter.transform.projection.name==="globe"){const Q=this.globeUniformValues(this.painter.transform,t.tileID.canonical,d&&d.useDenormalizedUpVectorScale);n.setGlobeUniformValues(y,Q)}}globeUniformValues(t,n,d){const y=t.projection;return{u_tile_tl_up:y.upVector(n,0,0),u_tile_tr_up:y.upVector(n,r.ag,0),u_tile_br_up:y.upVector(n,r.ag,r.ag),u_tile_bl_up:y.upVector(n,0,r.ag),u_tile_up_scale:d?r.cL(1):y.upVectorScale(n,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const n=this.painter,d=this.painter.context;t.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,b,T,I,F){if(y.transform.projection.name==="globe")(function(V,j,G,q,Q){const ce=V.context,ae=ce.gl;let de,pe;const Te=V.transform,ke=r.cC(V,ce,Te),De=(Dt,At)=>{if(pe===At)return;const ot=[rd[At],"PROJECTION_GLOBE_VIEW"];ke&&ot.push("CUSTOM_ANTIALIASING");const wt=V.isTileAffectedByFog(Dt);de=V.getOrCreateProgram("globeRaster",{defines:ot,overrideFog:wt}),pe=At},Ue=V.colorModeForRenderPass(),Le=new Si(ae.LEQUAL,Si.ReadWrite,V.depthRangeFor3D);zo.update(Q);const Ne=r.cD(Te),Oe=[r.at(Te.center.lng),r.aA(Te.center.lat)],We=V.globeSharedBuffers,Qe=[Te.width*r.q.devicePixelRatio,Te.height*r.q.devicePixelRatio],xt=Float32Array.from(Te.globeMatrix),ut={useDenormalizedUpVectorScale:!0};{const Dt=V.transform,At=uu(Dt.zoom,j.exaggeration(),j.sourceCache._source.tileSize);pe=-1;const ot=ae.TRIANGLES;for(const wt of q){const Vt=G.getTile(wt),st=Oi.disabled,It=j.prevTerrainTileForTile[wt.key],bt=j.terrainTileForTile[wt.key];id(It,bt)&&zo.newMorphing(wt.key,It,bt,Q,250),ce.activeTexture.set(ae.TEXTURE0),Vt.texture&&Vt.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);const Kt=zo.getMorphValuesForProxy(wt.key),Bt=Kt?1:0;Kt&&r.J(ut,{morphing:{srcDemTile:Kt.from,dstDemTile:Kt.to,phase:r.cB(Kt.phase)}});const kt=r.cE(wt.canonical),$t=r.cF(kt.getCenter().lat),Xt=r.cG(wt.canonical,kt,$t,Dt.worldSize/Dt._pixelsPerMercatorPixel),ci=r.bb(r.cH(wt.canonical)),pi=Cl(Dt.expandedFarZProjMatrix,xt,Ne,ci,r.ae(Dt.zoom),Oe,Dt.frustumCorners.TL,Dt.frustumCorners.TR,Dt.frustumCorners.BR,Dt.frustumCorners.BL,Dt.globeCenterInViewSpace,Dt.globeRadius,Qe,At,Dt._farZ,Xt);if(De(wt,Bt),de&&(j.setupElevationDraw(Vt,de,ut),V.uploadCommonUniforms(ce,de,wt.toUnwrapped()),We)){const[Fi,Mi,Ci]=We.getGridBuffers($t,At!==0);de.draw(V,ot,Le,st,Ue,zi.backCCW,pi,"globe_raster",Fi,Mi,Ci)}}}if(We&&(V.renderDefaultNorthPole||V.renderDefaultSouthPole)){const Dt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ke&&Dt.push("CUSTOM_ANTIALIASING"),de=V.getOrCreateProgram("globeRaster",{defines:Dt});for(const At of q){const{x:ot,y:wt,z:Vt}=At.canonical,st=wt===0,It=wt===(1<<Vt)-1,[bt,Kt,Bt,kt]=We.getPoleBuffers(Vt,!1);if(kt&&(st||It)){const $t=G.getTile(At);ce.activeTexture.set(ae.TEXTURE0),$t.texture&&$t.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);let Xt=r.cI(Vt,ot,Te);const ci=r.bb(r.cH(At.canonical)),pi=(Fi,Mi)=>Fi.draw(V,ae.TRIANGLES,Le,Oi.disabled,Ue,zi.disabled,Cl(Te.expandedFarZProjMatrix,Xt,Xt,ci,0,Oe,Te.frustumCorners.TL,Te.frustumCorners.TR,Te.frustumCorners.BR,Te.frustumCorners.BL,Te.globeCenterInViewSpace,Te.globeRadius,Qe,0,Te._farZ),"globe_pole_raster",Mi,Bt,kt);j.setupElevationDraw($t,de,ut),V.uploadCommonUniforms(ce,de,At.toUnwrapped()),st&&V.renderDefaultNorthPole&&pi(de,bt),It&&V.renderDefaultSouthPole&&(Xt=r.ab.mat4.scale(r.ab.mat4.create(),Xt,[1,-1,1]),pi(de,Kt))}}}})(y,b,T,I,F);else{const V=y.context,j=V.gl;let G,q;const Q=y.shadowRenderer,ce=bl(y,y.longestCutoffRange),ae=Ue=>{if(q===Ue)return;const Le=[];Le.push(rd[Ue]),ce.shouldRenderCutoff&&Le.push("RENDER_CUTOFF"),Q&&(Le.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Q.useNormalOffset&&Le.push("NORMAL_OFFSET")),G=y.getOrCreateProgram("terrainRaster",{defines:Le}),q=Ue},de=y.colorModeForRenderPass(),pe=new Si(j.LEQUAL,Si.ReadWrite,y.depthRangeFor3D);zo.update(F);const Te=y.transform,ke=uu(Te.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let De=[0,0,0];if(Q){const Ue=y.style.directionalLight,Le=y.style.ambientLight;Ue&&Le&&(De=Gh(y.style,Ue,Le))}{q=-1;const Ue=j.TRIANGLES,[Le,Ne]=[b.gridIndexBuffer,b.gridSegments];for(const Oe of I){const We=T.getTile(Oe),Qe=Oi.disabled,xt=b.prevTerrainTileForTile[Oe.key],ut=b.terrainTileForTile[Oe.key];id(xt,ut)&&zo.newMorphing(Oe.key,xt,ut,F,250),V.activeTexture.set(j.TEXTURE0),We.texture&&We.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const Dt=zo.getMorphValuesForProxy(Oe.key),At=Dt?1:0;let ot;Dt&&(ot={morphing:{srcDemTile:Dt.from,dstDemTile:Dt.to,phase:r.cB(Dt.phase)}});const wt=cu(Oe.projMatrix,If(Oe.canonical,Te.renderWorldCopies)?ke/10:ke,De);if(ae(At),!G)continue;b.setupElevationDraw(We,G,ot);const Vt=Oe.toUnwrapped();Q&&Q.setupShadows(Vt,G),y.uploadCommonUniforms(V,G,Vt,null,ce),G.draw(y,Ue,pe,Qe,de,zi.backCCW,wt,"terrain_raster",b.gridBuffer,Le,Ne)}}}}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const n=this.painter,d=this.painter.context,y=this.proxySourceCache,b=this.proxiedCoords[y.id],T=this._drapedRenderBatches.shift(),I=n.style.order,F=[];let V=0;for(const j of b){const G=y.getTileByID(j.proxyTileKey),q=y.proxyCachedFBO[j.key]?y.proxyCachedFBO[j.key][t]:void 0,Q=q!==void 0?y.renderCache[q]:this.pool[V++],ce=q!==void 0;if(G.texture=Q.tex,ce&&!Q.dirty){F.push(G.tileID);continue}let ae;d.bindFramebuffer.set(Q.fb.framebuffer),this.renderedToTile=!1,Q.dirty&&(d.clear({color:r.aj.transparent,stencil:0}),Q.dirty=!1);for(let de=T.start;de<=T.end;++de){const pe=n.style._mergedLayers[I[de]];if(pe.isHidden(n.transform.zoom))continue;const Te=n.style.getLayerSourceCache(pe),ke=Te?this.proxyToSource[j.key][Te.id]:[j];if(!ke)continue;const De=ke;d.viewport.set([0,0,Q.fb.width,Q.fb.height]),ae!==(Te?Te.id:null)&&(this._setupStencil(Q,ke,pe,Te),ae=Te?Te.id:null),n.renderLayer(n,Te,pe,De)}if(this._drapedRenderBatches.length===0)for(const de of this._pendingGroundEffectLayers){const pe=n.style._mergedLayers[I[de]];if(pe.isHidden(n.transform.zoom))continue;const Te=n.style.getLayerSourceCache(pe),ke=Te?this.proxyToSource[j.key][Te.id]:[j];if(!ke)continue;const De=ke;d.viewport.set([0,0,Q.fb.width,Q.fb.height]),ae!==(Te?Te.id:null)&&(this._setupStencil(Q,ke,pe,Te),ae=Te?Te.id:null),n.renderLayer(n,Te,pe,De)}this.renderedToTile?(Q.dirty=!0,F.push(G.tileID)):ce||--V,V===5&&(V=0,this.renderToBackBuffer(F))}return this.renderToBackBuffer(F),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,n.width,n.height]),T.end+1}postRender(){}isLayerOrderingCorrect(t){const n=t.order.length;let d=-1,y=n;for(let b=0;b<n;++b)this._style.isLayerDraped(t._mergedLayers[t.order[b]])?d=Math.max(d,b):y=Math.min(y,b);return y>d}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{t=Math.min(t,n.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,n,d){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const T=b.tileID,I=1<<T.overscaledZ,{x:F,y:V}=T.canonical,j=F/I,G=(F+1)/I,q=V/I,Q=(V+1)/I;return{minx:j,miny:q,maxx:G,maxy:Q,t:b.dem.tree.raycastRoot(j,q,G,Q,t,n,d),tile:b}});y.sort((b,T)=>(b.t!==null?b.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const b of y){if(b.t==null)return null;const T=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,t,n,d);if(T!=null)return T}return null}_createFBO(){const t=this.painter.context,n=t.gl,d=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const y=new r.T(t,{width:d[0],height:d[1],data:null},n.RGBA8);y.bind(n.LINEAR,n.CLAMP_TO_EDGE);const b=t.createFramebuffer(d[0],d[1],!0,null);return b.colorAttachment.set(y.texture),b.depthAttachment=new Df(t,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:b,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const n=this._style._mergedLayers[t],d=n.isHidden(this.painter.transform.zoom);return n.type==="hillshade"||n.type==="custom"?!d&&n.shouldRedrape():!d&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const d of this._style.getSources())if(d instanceof Bn){t=!0;break}if(!t)return;const n={};for(let d=0;d<this._style.order.length;++d){const y=this._style._mergedLayers[this._style.order[d]],b=this._style.getLayerSourceCache(y);if(b&&!n[b.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof r.a9){n[b.id]=!0;for(const T of this.proxyCoords){const I=this.proxyToSource[T.key][b.id];if(I)for(const F of I)this._clearRenderCacheForTile(b.id,F)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof Da){t=!0;break}if(!t)return;const n={};for(let d=0;d<this._style.order.length;++d){const y=this._style._mergedLayers[this._style.order[d]],b=this._style.getLayerSourceCache(y);if(!b||n[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const T=y.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const F=this.proxyToSource[I.key][b.id];if(F)for(const V of F){const j=nh(b.getTile(V),b.findLoadedParent(V,0),b,this.painter.transform,T);(j.opacity!==1||j.mix!==0)&&this._clearRenderCacheForTile(b.id,V)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,n=t.length;if(n===0)return;const d=[];this._pendingGroundEffectLayers=[];let y,b=0,T=this._style._mergedLayers[t[b]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++b<n;)T=this._style._mergedLayers[t[b]];for(;b<n;++b){const I=this._style._mergedLayers[t[b]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?y===void 0&&(y=b):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),y!==void 0&&(d.push({start:y,end:b-1}),y=void 0)))}if(y!==void 0&&d.push({start:y,end:b-1}),d.length!==0){const I=d[d.length-1];this._pendingGroundEffectLayers.every(F=>F>I.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(t){const n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){const T=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let I=0;I<T.length;++I){const F=Object.values(T[I]);n.renderCachePool.push(...F)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,y=this._tilesDirty;for(let T=d.length-1;T>=0;T--){const I=d[T];if(n.getTileByID(I.key),n.proxyCachedFBO[I.key]!==void 0){const F=t[I.key],V=this.proxyToSource[I.key];let j=0;for(const G in V){const q=V[G],Q=F[G];if(!Q||Q.length!==q.length||q.some((ce,ae)=>ce!==Q[ae]||y[G]&&y[G].hasOwnProperty(ce.key))){j=-1;break}++j}for(const G in n.proxyCachedFBO[I.key])n.renderCache[n.proxyCachedFBO[I.key][G]].dirty=j<0||j!==Object.values(F).length}}const b=[...this._drapedRenderBatches];b.sort((T,I)=>I.end-I.start-(T.end-T.start));for(const T of b)for(const I of d){if(n.proxyCachedFBO[I.key])continue;let F=n.renderCachePool.pop();F===void 0&&n.renderCache.length<50&&(F=n.renderCache.length,n.renderCache.push(this._createFBO())),F!==void 0&&(n.proxyCachedFBO[I.key]={},n.proxyCachedFBO[I.key][T.start]=F,n.renderCache[F].dirty=!0)}this._tilesDirty={}}_setupStencil(t,n,d,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,T=b.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let I;if(d.isTileClipped())I=n.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Oi.disabled}_renderTileClippingMasks(t,n){const d=this.painter,y=this.painter.context,b=y.gl;d._tileClippingMaskIDs={},y.setColorMode(Xi.disabled),y.setDepthMode(Si.disabled);const T=d.getOrCreateProgram("clippingMask");for(const I of t){const F=d._tileClippingMaskIDs[I.key]=--n;T.draw(d,b.TRIANGLES,Si.disabled,new Oi({func:b.ALWAYS,mask:0},F,255,b.KEEP,b.KEEP,b.REPLACE),Xi.disabled,zi.disabled,nd(I.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const d=[t.x,t.y,1,1];r.ab.vec4.transformMat4(d,d,n.pixelMatrixInverse),r.ab.vec4.scale(d,d,1/d[3]),d[0]/=n.worldSize,d[1]/=n.worldSize;const y=n._camera.position,b=r.bH(1,n.center.lat),T=[y[0],y[1],y[2]/b,0],I=r.ab.vec3.subtract([],d.slice(0,3),T);r.ab.vec3.normalize(I,I);const F=this.raycast(T,I,this._exaggeration);return F!==null&&F?(r.ab.vec3.scaleAndAdd(T,T,I,F),T[3]=T[2],T[2]*=b,T):null}_setupProxiedCoordsForOrtho(t,n,d){if(t.getSource()instanceof r.aJ)return this._setupProxiedCoordsForImageSource(t,n,d);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const y=this.proxiedCoords[t.id]=[],b=this.proxyCoords;for(let F=0;F<b.length;F++){const V=b[F],j=this._findTileCoveringTileID(V,t);if(j){const G=this._createProxiedId(V,j,d[V.key]&&d[V.key][t.id]);y.push(G),this.proxyToSource[V.key][t.id]=[G]}}let T=!1;const I=new Set;for(let F=0;F<n.length;F++){const V=t.getTile(n[F]);if(!V||!V.hasData())continue;const j=this._findTileCoveringTileID(V.tileID,this.proxySourceCache);if(j&&j.tileID.canonical.z!==V.tileID.canonical.z){const G=this.proxyToSource[j.tileID.key][t.id],q=this._createProxiedId(j.tileID,V,d[j.tileID.key]&&d[j.tileID.key][t.id]);G?G.splice(G.length-1,0,q):this.proxyToSource[j.tileID.key][t.id]=[q];const Q=this.proxyToSource[j.tileID.key][t.id];I.has(Q)||I.add(Q),y.push(q),T=!0}}if(this._sourceTilesOverlap[t.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const F of I)F.sort((V,j)=>j.overscaledZ-V.overscaledZ)}_setupProxiedCoordsForImageSource(t,n,d){if(!t.getSource().loaded())return;const y=this.proxiedCoords[t.id]=[],b=this.proxyCoords,T=t.getSource(),I=T.tileID;if(!I)return;const F=new r.P(I.x,I.y)._div(1<<I.z),V=T.coordinates.map(r.aa.fromLngLat).reduce((G,q)=>(G.min.x=Math.min(G.min.x,q.x-F.x),G.min.y=Math.min(G.min.y,q.y-F.y),G.max.x=Math.max(G.max.x,q.x-F.x),G.max.y=Math.max(G.max.y,q.y-F.y),G),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),j=(G,q)=>{const Q=G.wrap+G.canonical.x/(1<<G.canonical.z),ce=G.canonical.y/(1<<G.canonical.z),ae=r.ag/(1<<G.canonical.z),de=q.wrap+q.canonical.x/(1<<q.canonical.z),pe=q.canonical.y/(1<<q.canonical.z);return Q+ae<de+V.min.x||Q>de+V.max.x||ce+ae<pe+V.min.y||ce>pe+V.max.y};for(let G=0;G<b.length;G++){const q=b[G];for(let Q=0;Q<n.length;Q++){const ce=t.getTile(n[Q]);if(!ce||!ce.hasData()||j(q,ce.tileID))continue;const ae=this._createProxiedId(q,ce,d[q.key]&&d[q.key][t.id]),de=this.proxyToSource[q.key][t.id];de?de.push(ae):this.proxyToSource[q.key][t.id]=[ae],y.push(ae)}}}_createProxiedId(t,n,d){let y=this.orthoMatrix;if(d){const b=d.find(T=>T.key===n.tileID.key);if(b)return b}if(n.tileID.key!==t.key){const b=t.canonical.z-n.tileID.canonical.z;let T,I,F;y=r.ab.mat4.create();const V=n.tileID.wrap-t.wrap<<t.overscaledZ;b>0?(T=r.ag>>b,I=T*((n.tileID.canonical.x<<b)-t.canonical.x+V),F=T*((n.tileID.canonical.y<<b)-t.canonical.y)):(T=r.ag<<-b,I=r.ag*(n.tileID.canonical.x-(t.canonical.x+V<<-b)),F=r.ag*(n.tileID.canonical.y-(t.canonical.y<<-b))),r.ab.mat4.ortho(y,0,T,0,T,0,1),r.ab.mat4.translate(y,y,[I,F,0])}return new pp(n.tileID,t.key,y)}_findTileCoveringTileID(t,n){let d=n.getTile(t);if(d&&d.hasData())return d;const y=this._findCoveringTileCache[n.id],b=y[t.key];if(d=b?n.getTileByID(b):null,d&&d.hasData()||b===null)return d;let T=d?d.tileID:t,I=T.overscaledZ;const F=n.getSource().minzoom,V=[];if(!b){const G=n.getSource().maxzoom;if(t.canonical.z>=G){const q=t.canonical.z-G;n.getSource().reparseOverscaled?(I=Math.max(t.canonical.z+2,n.transform.tileZoom),T=new r.aG(I,t.wrap,G,t.canonical.x>>q,t.canonical.y>>q)):q!==0&&(I=G,T=new r.aG(I,t.wrap,G,t.canonical.x>>q,t.canonical.y>>q))}T.key!==t.key&&(V.push(T.key),d=n.getTile(T))}const j=G=>{V.forEach(q=>{y[q]=G}),V.length=0};for(I-=1;I>=F&&(!d||!d.hasData());I--){d&&j(d.tileID.key);const G=T.calculateScaledKey(I);if(d=n.getTileByID(G),d&&d.hasData())break;const q=y[G];if(q===null)break;q===void 0?V.push(G):d=n.getTileByID(q)}return j(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,n){let d=this._tilesDirty[t];d||(d=this._tilesDirty[t]={}),d[n.key]=!0}}function Of(u,t,n){const d=function(I,F,V){const j=r.ab.vec3.dot(F,I),G=r.ab.vec3.dot(V,[.2126,.7152,.0722]),q=(ce,ae,de)=>(1-de)*ce+de*ae,Q=q(1-.3*Math.min(G,1),1,Math.min(j+1,1));return q(.92,1,Math.asin(r.aw(F[2],-1,1))/Math.PI+.5)*Q}(u,[0,0,1],t),y=[0,0,0];r.ab.vec3.scale(y,n.slice(0,3),d);const b=[0,0,0];r.ab.vec3.scale(b,t.slice(0,3),u[2]);const T=[0,0,0];return r.ab.vec3.add(T,y,b),r.cf(T)}const Ym=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Lf=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class Rf{static cacheKey(t,n,d,y){let b=`${n}${y?y.cacheKey:""}`;for(const T of d)t.usedDefines.includes(T)&&(b+=`/${T}`);return b}constructor(t,n,d,y,b,T){const I=t.gl;this.program=I.createProgram(),this.configuration=y,this.name=n,this.fixedDefines=[...T];const F=y?y.getBinderAttributes():[],V=(d.staticAttributes||[]).concat(F);let j=y?y.defines():[];j=j.concat(T.map(de=>`#define ${de}`));const G=`#version 300 es
`;let q=G+j.concat("precision mediump float;",uc,qh.fragmentSource).join(`
`);for(const de of d.fragmentIncludes)q+=`
${nu[de]}`;q+=`
${d.fragmentSource}`;let Q=G+j.concat("precision highp float;",uc,qh.vertexSource).join(`
`);for(const de of d.vertexIncludes)Q+=`
${nu[de]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&d.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(Q+=`
uniform int u_instanceID;
`),Q+=`
${d.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(Q=Q.replaceAll("gl_InstanceID","u_instanceID"));const ce=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(ce,q),I.compileShader(ce),I.attachShader(this.program,ce);const ae=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(ae,Q),I.compileShader(ae),I.attachShader(this.program,ae),this.attributes={},this.numAttributes=V.length;for(let de=0;de<this.numAttributes;de++)if(V[de]){const pe=V[de].startsWith("a_")?V[de]:`a_${V[de]}`;I.bindAttribLocation(this.program,de,pe),this.attributes[pe]=de}I.linkProgram(this.program),I.deleteShader(ae),I.deleteShader(ce),this.fixedUniforms=b(t),this.binderUniforms=y?y.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(de=>({u_instanceID:new r.bN(de)}))(t)),(T.includes("TERRAIN")||n.indexOf("symbol")!==-1||n.indexOf("circle")!==-1)&&(this.terrainUniforms=(de=>({u_dem:new r.bN(de),u_dem_prev:new r.bN(de),u_dem_tl:new r.bK(de),u_dem_scale:new r.bM(de),u_dem_tl_prev:new r.bK(de),u_dem_scale_prev:new r.bM(de),u_dem_size:new r.bM(de),u_dem_lerp:new r.bM(de),u_exaggeration:new r.bM(de),u_depth:new r.bN(de),u_depth_size_inv:new r.bK(de),u_depth_range_unpack:new r.bK(de),u_occluder_half_size:new r.bM(de),u_occlusion_depth_offset:new r.bM(de),u_meter_to_dem:new r.bM(de),u_label_plane_matrix_inv:new r.bJ(de)}))(t)),T.includes("GLOBE")&&(this.globeUniforms=(de=>({u_tile_tl_up:new r.bL(de),u_tile_tr_up:new r.bL(de),u_tile_br_up:new r.bL(de),u_tile_bl_up:new r.bL(de),u_tile_up_scale:new r.bM(de)}))(t)),T.includes("FOG")&&(this.fogUniforms=(de=>({u_fog_matrix:new r.bJ(de),u_fog_range:new r.bK(de),u_fog_color:new r.ca(de),u_fog_horizon_blend:new r.bM(de),u_fog_vertical_limit:new r.bK(de),u_fog_temporal_offset:new r.bM(de),u_frustum_tl:new r.bL(de),u_frustum_tr:new r.bL(de),u_frustum_br:new r.bL(de),u_frustum_bl:new r.bL(de),u_globe_pos:new r.bL(de),u_globe_radius:new r.bM(de),u_globe_transition:new r.bM(de),u_is_globe:new r.bN(de),u_viewport:new r.bK(de)}))(t)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(de=>({u_cutoff_params:new r.ca(de)}))(t)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(de=>({u_lighting_ambient_color:new r.bL(de),u_lighting_directional_dir:new r.bL(de),u_lighting_directional_color:new r.bL(de),u_ground_radiance:new r.bL(de)}))(t)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(de=>({u_light_matrix_0:new r.bJ(de),u_light_matrix_1:new r.bJ(de),u_fade_range:new r.bK(de),u_shadow_normal_offset:new r.bL(de),u_shadow_intensity:new r.bM(de),u_shadow_texel_size:new r.bM(de),u_shadow_map_resolution:new r.bM(de),u_shadow_direction:new r.bL(de),u_shadow_bias:new r.bL(de),u_shadowmap_0:new r.bN(de),u_shadowmap_1:new r.bN(de)}))(t))}}setTerrainUniformValues(t,n){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in n)d[y]&&d[y].set(this.program,y,n[y])}}setGlobeUniformValues(t,n){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in n)d[y]&&d[y].set(this.program,y,n[y])}}setFogUniformValues(t,n){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in n)d[y].set(this.program,y,n[y])}}setCutoffUniformValues(t,n){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in n)d[y].set(this.program,y,n[y])}}setLightsUniformValues(t,n){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in n)d[y].set(this.program,y,n[y])}}setShadowUniformValues(t,n){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;t.program.set(this.program);for(const y in n)d[y].set(this.program,y,n[y])}_drawDebugWireframe(t,n,d,y,b,T,I,F,V,j){const G=t.options.wireframe;if(G.terrain===!1&&G.layers2D===!1&&G.layers3D===!1)return;const q=t.context;if(!(!(!G.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!G.layers2D||t._terrain&&t._terrain.renderingToTexture||!Ym.includes(this.name))||!(!G.layers3D||!Lf.includes(this.name))))return;const Q=q.gl,ce=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,b,q);if(!ce)return;const ae=[...this.fixedDefines];ae.push("DEBUG_WIREFRAME");const de=t.getOrCreateProgram(this.name,{config:this.configuration,defines:ae});q.program.set(de.program);const pe=(De,Ue,Le)=>{if(Ue[De]&&Le[De])for(const Ne in Ue[De])Le[De][Ne]&&Le[De][Ne].set(Le.program,Ne,Ue[De][Ne].current)};V&&V.setUniforms(de.program,q,de.binderUniforms,I,{zoom:F}),pe("fixedUniforms",this,de),pe("terrainUniforms",this,de),pe("globeUniforms",this,de),pe("fogUniforms",this,de),pe("lightsUniforms",this,de),pe("shadowUniforms",this,de),ce.bind(),q.setColorMode(new Xi([Q.ONE,Q.ONE_MINUS_SRC_ALPHA,Q.ZERO,Q.ONE],r.aj.transparent,[!0,!0,!0,!1])),q.setDepthMode(new Si(n.func===Q.LESS?Q.LEQUAL:n.func,Si.ReadOnly,n.range)),q.setStencilMode(Oi.disabled);const Te=3*T.primitiveLength*2,ke=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const De=j||1;for(let Ue=0;Ue<De;++Ue)de.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ue),Q.drawElements(Q.LINES,Te,Q.UNSIGNED_SHORT,ke)}else j&&j>1?Q.drawElementsInstanced(Q.LINES,Te,Q.UNSIGNED_SHORT,ke,j):Q.drawElements(Q.LINES,Te,Q.UNSIGNED_SHORT,ke);b.bind(),q.program.set(this.program),q.setDepthMode(n),q.setStencilMode(d),q.setColorMode(y)}checkUniforms(t,n,d){if(this.fixedDefines.includes(n)){for(const y of Object.keys(d))if(!d[y].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${y} not set but required by ${n} being defined`)}}draw(t,n,d,y,b,T,I,F,V,j,G,q,Q,ce,ae,de){const pe=t.context,Te=pe.gl;if(this.failedToCreate)return;pe.program.set(this.program),pe.setDepthMode(d),pe.setStencilMode(y),pe.setColorMode(b),pe.setCullFace(T);for(const Ue of Object.keys(this.fixedUniforms))this.fixedUniforms[Ue].set(this.program,Ue,I[Ue]);ce&&ce.setUniforms(this.program,pe,this.binderUniforms,q,{zoom:Q});const ke={[Te.POINTS]:1,[Te.LINES]:2,[Te.TRIANGLES]:3,[Te.LINE_STRIP]:1}[n];this.checkUniforms(F,"RENDER_SHADOWS",this.shadowUniforms);const De=de&&de>0?1:void 0;for(const Ue of G.get()){const Le=Ue.vaos||(Ue.vaos={});if((Le[F]||(Le[F]=new lp)).bind(pe,this,V,ce?ce.getPaintVertexBuffers():[],j,Ue.vertexOffset,ae||[],De),this.forceManualRenderingForInstanceIDShaders){const Ne=de||1;for(let Oe=0;Oe<Ne;++Oe)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Oe),j?Te.drawElements(n,Ue.primitiveLength*ke,Te.UNSIGNED_SHORT,Ue.primitiveOffset*ke*2):Te.drawArrays(n,Ue.vertexOffset,Ue.vertexLength)}else de&&de>1?Te.drawElementsInstanced(n,Ue.primitiveLength*ke,Te.UNSIGNED_SHORT,Ue.primitiveOffset*ke*2,de):j?Te.drawElements(n,Ue.primitiveLength*ke,Te.UNSIGNED_SHORT,Ue.primitiveOffset*ke*2):Te.drawArrays(n,Ue.vertexOffset,Ue.vertexLength);n===Te.TRIANGLES&&j&&this._drawDebugWireframe(t,d,y,b,j,Ue,q,Q,ce,de)}}}function du(u,t){const n=Math.pow(2,t.tileID.overscaledZ),d=t.tileSize*Math.pow(2,u.transform.tileZoom)/n,y=d*(t.tileID.canonical.x+t.tileID.wrap*n),b=d*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ar(t,1,u.transform.tileZoom),u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b]}}const pu={terrain:0,flat:1},la=r.ab.mat4.create(),sd=(u,t,n,d,y,b,T,I,F,V,j,G,q,Q,ce,ae,de,pe)=>{const Te=t.style.light,ke=Te.properties.get("position"),De=[ke.x,ke.y,ke.z],Ue=r.ab.mat3.create();Te.properties.get("anchor")==="viewport"&&(r.ab.mat3.fromRotation(Ue,-t.transform.angle),r.ab.vec3.transformMat3(De,De,Ue));const Le=Te.properties.get("color"),Ne=t.transform,Oe={u_matrix:u,u_lightpos:De,u_lightintensity:Te.properties.get("intensity"),u_lightcolor:[Le.r,Le.g,Le.b],u_vertical_gradient:+n,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:la,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:pu[V],u_base_type:pu[j],u_ao:y,u_edge_radius:b,u_width_scale:T,u_flood_light_color:ce,u_vertical_scale:ae,u_flood_light_intensity:de,u_ground_shadow_factor:pe};return Ne.projection.name==="globe"&&(Oe.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],Oe.u_zoom_transition=G,Oe.u_inv_rot_matrix=Q,Oe.u_merc_center=q,Oe.u_up_dir=Ne.projection.upVector(new r.bT(0,0,0),q[0]*r.ag,q[1]*r.ag),Oe.u_height_lift=F),Oe},dc=(u,t,n,d,y,b)=>({u_matrix:u,u_edge_radius:t,u_width_scale:n,u_vertical_scale:d,u_height_type:pu[y],u_base_type:pu[b]}),zf=(u,t,n,d,y,b,T,I,F,V,j,G,q,Q,ce,ae,de)=>{const pe=sd(u,t,n,d,y,b,T,I,V,j,G,q,Q,ce,ae,de,1,[0,0,0]),Te={u_height_factor:-Math.pow(2,I.overscaledZ)/F.tileSize/8};return r.l(pe,du(t,F),Te)},pc=(u,t)=>({u_matrix:u,u_emissive_strength:t}),fu=(u,t,n,d)=>r.l(pc(u,t),du(n,d)),fp=(u,t,n)=>({u_matrix:u,u_world:n,u_emissive_strength:t}),Ff=(u,t,n,d,y)=>r.l(fu(u,t,n,d),{u_world:y}),Xm=(u,t,n,d)=>{const y=r.ag/n.tileSize;return{u_matrix:u,u_camera_to_center_distance:t.getCameraToCenterDistance(d),u_extrude_scale:[t.pixelsToGLUnits[0]/y,t.pixelsToGLUnits[1]/y]}},fc=(u,t,n=1)=>({u_matrix:u,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:n}),od=r.ab.mat4.create(),_i=(u,t,n,d,y,b,T)=>{const I=u.transform,F=I.projection.name==="globe",V=F?r.cN(I.zoom,t.canonical)*I._pixelsPerMercatorPixel:r.ar(n,1,b),j={u_matrix:t.projMatrix,u_extrude_scale:V,u_intensity:T,u_inv_rot_matrix:od,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(F){j.u_inv_rot_matrix=d,j.u_merc_center=y,j.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],j.u_zoom_transition=r.ae(I.zoom);const G=y[0]*r.ag,q=y[1]*r.ag;j.u_up_dir=I.projection.upVector(new r.bT(0,0,0),G,q)}return j};function mu(u,[t,n,d,y],[b,T]){if(b===T)return[0,0,0,0];const I=255*(u-1)/(u*(T-b));return[t*I,n*I,d*I,y*I]}function sh(u,t,[n,d]){return n===d?0:.5/u+(t-n)*(u-1)/(u*(d-n))}const Al=(u,t,n,d,y,b,T,I,F,V,j,G,q,Q,ce,ae,de,pe,Te,ke,De)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:d,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:V,u_fade_t:j.mix,u_opacity:j.opacity*G.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:G.paint.get("raster-brightness-min"),u_brightness_high:G.paint.get("raster-brightness-max"),u_saturation_factor:r.cO(G.paint.get("raster-saturation")),u_contrast_factor:r.cP(G.paint.get("raster-contrast")),u_spin_weights:mc(G.paint.get("raster-hue-rotate")),u_perspective_transform:q,u_raster_elevation:Q,u_zoom_transition:T,u_merc_center:I,u_cutoff_params:F,u_colorization_mix:mu(r.cQ,ae,pe),u_colorization_offset:sh(r.cQ,de,pe),u_color_ramp:ce,u_texture_offset:[ke/(Te+2*ke),Te/(Te+2*ke)],u_texture_res:[Te+2*ke,Te+2*ke],u_emissive_strength:De});function mc(u){u*=Math.PI/180;const t=Math.sin(u),n=Math.cos(u);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const wi=.05,Ba=(u,t,n,d,y,b,T,I,F,V,j,G)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:d,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:V,u_fade_t:j.mix,u_opacity:j.opacity,u_image0:0,u_image1:1,u_raster_elevation:G,u_zoom_transition:T,u_merc_center:I,u_cutoff_params:F}),ad=(u,t,n,d,y,b,T,I,F,V)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_tile_offset:n,u_velocity:d,u_color_ramp:b,u_velocity_res:y,u_max_speed:T,u_uv_offset:I,u_data_scale:[255*F[0],255*F[1]],u_data_offset:V,u_particle_pos_scale:1.1,u_particle_pos_offset:[wi,wi]}),Bf=(u,t,n,d,y,b,T,I,F,V)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_velocity:n,u_velocity_res:d,u_max_speed:y,u_speed_factor:b,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*F[0],255*F[1]],u_data_offset:V,u_particle_pos_scale:1.1,u_particle_pos_offset:[wi,wi]}),ca=r.ab.mat4.create(),mp=(u,t,n,d,y,b,T,I,F,V,j,G,q,Q,ce,ae,de,pe,Te,ke,De,Ue)=>{const Le=y.transform,Ne={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Le.getCameraToCenterDistance(Te),u_rotate_symbol:+n,u_aspect_ratio:Le.width/Le.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:I,u_is_text:+V,u_elevation_from_sea:F?1:0,u_pitch_with_map:+d,u_texsize:j,u_texsize_icon:G,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ca,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ca,u_up_vector:[0,-1,0],u_color_adj_mat:ke,u_icon_transition:De||0,u_gamma_scale:d?y.transform.getCameraToCenterDistance(Te)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:r.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Ue||1};return Te.name==="globe"&&(Ne.u_tile_id=[Q.canonical.x,Q.canonical.y,1<<Q.canonical.z],Ne.u_zoom_transition=ce,Ne.u_inv_rot_matrix=de,Ne.u_merc_center=ae,Ne.u_camera_forward=Le._camera.forward(),Ne.u_ecef_origin=r.cR(Le.globeMatrix,Q.toUnwrapped()),Ne.u_tile_matrix=Float32Array.from(Le.globeMatrix),Ne.u_up_vector=pe),Ne},ld=(u,t,n,d)=>({u_matrix:u,u_emissive_strength:t,u_opacity:n,u_color:d}),Nf=(u,t,n,d,y,b,T,I,F)=>r.l(function(V,j,G,q,Q,ce){const{width:ae,height:de}=q.imageManager.getPixelSize(j),pe=Math.pow(2,ce.tileID.overscaledZ),Te=ce.tileSize*Math.pow(2,q.transform.tileZoom)/pe,ke=Te*(ce.tileID.canonical.x+ce.tileID.wrap*pe),De=Te*ce.tileID.canonical.y;return{u_image:0,u_pattern_tl:G.tl,u_pattern_br:G.br,u_texsize:[ae,de],u_pattern_size:G.displaySize,u_pattern_units_to_pixels:Q?[q.transform.width,-1*q.transform.height]:[1/r.ar(ce,1,q.transform.tileZoom),1/r.ar(ce,1,q.transform.tileZoom)],u_pixel_coord_upper:[ke>>16,De>>16],u_pixel_coord_lower:[65535&ke,65535&De]}}(0,b,T,d,I,F),{u_matrix:u,u_emissive_strength:t,u_opacity:n}),gc=new Float32Array(r.ab.mat4.identity([])),Jo=(u,t,n,d,y,b,T,I,F,V,j,G,q,Q=[0,0,0],ce)=>{const ae=y.style.light,de=ae.properties.get("position"),pe=[-de.x,-de.y,de.z],Te=r.ab.mat3.create();ae.properties.get("anchor")==="viewport"&&(r.ab.mat3.fromRotation(Te,-y.transform.angle),r.ab.vec3.transformMat3(pe,pe,Te));const ke=j.alphaMode==="MASK",De=ae.properties.get("color").toRenderColor(null),Ue=q.paint.get("model-ambient-occlusion-intensity"),Le=q.paint.get("model-color").constantOr(r.aj.white).toRenderColor(null),Ne=q.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:u,u_lighting_matrix:t,u_normal_matrix:n,u_node_matrix:d||gc,u_lightpos:pe,u_lightintensity:ae.properties.get("intensity"),u_lightcolor:[De.r,De.g,De.b],u_camera_pos:Q,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+ke,u_alphaCutoff:j.alphaCutoff,u_baseColorFactor:[T.r,T.g,T.b,T.a],u_emissiveFactor:[I[0],I[1],I[2],1],u_metallicFactor:F,u_roughnessFactor:V,u_baseColorTexture:Os.BaseColor,u_metallicRoughnessTexture:Os.MetallicRoughness,u_normalTexture:Os.Normal,u_occlusionTexture:Os.Occlusion,u_emissionTexture:Os.Emission,u_lutTexture:Os.LUT,u_color_mix:[Le.r,Le.g,Le.b,Ne],u_aoIntensity:Ue,u_emissive_strength:G,u_occlusionTextureTransform:ce||[0,0,0,0]}},cd=(u,t=gc,n=gc)=>({u_matrix:u,u_instance:t,u_node_matrix:n}),oh={fillExtrusion:u=>({u_matrix:new r.bJ(u),u_lightpos:new r.bL(u),u_lightintensity:new r.bM(u),u_lightcolor:new r.bL(u),u_vertical_gradient:new r.bM(u),u_opacity:new r.bM(u),u_edge_radius:new r.bM(u),u_width_scale:new r.bM(u),u_ao:new r.bK(u),u_height_type:new r.bN(u),u_base_type:new r.bN(u),u_tile_id:new r.bL(u),u_zoom_transition:new r.bM(u),u_inv_rot_matrix:new r.bJ(u),u_merc_center:new r.bK(u),u_up_dir:new r.bL(u),u_height_lift:new r.bM(u),u_flood_light_color:new r.bL(u),u_vertical_scale:new r.bM(u),u_flood_light_intensity:new r.bM(u),u_ground_shadow_factor:new r.bL(u)}),fillExtrusionDepth:u=>({u_matrix:new r.bJ(u),u_edge_radius:new r.bM(u),u_width_scale:new r.bM(u),u_vertical_scale:new r.bM(u),u_height_type:new r.bN(u),u_base_type:new r.bN(u)}),fillExtrusionPattern:u=>({u_matrix:new r.bJ(u),u_lightpos:new r.bL(u),u_lightintensity:new r.bM(u),u_lightcolor:new r.bL(u),u_vertical_gradient:new r.bM(u),u_height_factor:new r.bM(u),u_edge_radius:new r.bM(u),u_width_scale:new r.bM(u),u_ao:new r.bK(u),u_height_type:new r.bN(u),u_base_type:new r.bN(u),u_tile_id:new r.bL(u),u_zoom_transition:new r.bM(u),u_inv_rot_matrix:new r.bJ(u),u_merc_center:new r.bK(u),u_up_dir:new r.bL(u),u_height_lift:new r.bM(u),u_image:new r.bN(u),u_texsize:new r.bK(u),u_pixel_coord_upper:new r.bK(u),u_pixel_coord_lower:new r.bK(u),u_tile_units_to_pixels:new r.bM(u),u_opacity:new r.bM(u)}),fillExtrusionGroundEffect:u=>({u_matrix:new r.bJ(u),u_opacity:new r.bM(u),u_ao_pass:new r.bM(u),u_meter_to_tile:new r.bM(u),u_ao:new r.bK(u),u_flood_light_intensity:new r.bM(u),u_flood_light_color:new r.bL(u),u_attenuation:new r.bM(u),u_edge_radius:new r.bM(u),u_fb:new r.bN(u),u_fb_size:new r.bM(u),u_dynamic_offset:new r.bM(u)}),fill:u=>({u_matrix:new r.bJ(u),u_emissive_strength:new r.bM(u)}),fillPattern:u=>({u_matrix:new r.bJ(u),u_emissive_strength:new r.bM(u),u_image:new r.bN(u),u_texsize:new r.bK(u),u_pixel_coord_upper:new r.bK(u),u_pixel_coord_lower:new r.bK(u),u_tile_units_to_pixels:new r.bM(u)}),fillOutline:u=>({u_matrix:new r.bJ(u),u_emissive_strength:new r.bM(u),u_world:new r.bK(u)}),fillOutlinePattern:u=>({u_matrix:new r.bJ(u),u_emissive_strength:new r.bM(u),u_world:new r.bK(u),u_image:new r.bN(u),u_texsize:new r.bK(u),u_pixel_coord_upper:new r.bK(u),u_pixel_coord_lower:new r.bK(u),u_tile_units_to_pixels:new r.bM(u)}),circle:r.cS,collisionBox:u=>({u_matrix:new r.bJ(u),u_camera_to_center_distance:new r.bM(u),u_extrude_scale:new r.bK(u)}),collisionCircle:u=>({u_matrix:new r.bJ(u),u_inv_matrix:new r.bJ(u),u_camera_to_center_distance:new r.bM(u),u_viewport_size:new r.bK(u)}),debug:u=>({u_color:new r.cz(u),u_matrix:new r.bJ(u),u_overlay:new r.bN(u),u_overlay_scale:new r.bM(u)}),clippingMask:u=>({u_matrix:new r.bJ(u)}),heatmap:u=>({u_extrude_scale:new r.bM(u),u_intensity:new r.bM(u),u_matrix:new r.bJ(u),u_inv_rot_matrix:new r.bJ(u),u_merc_center:new r.bK(u),u_tile_id:new r.bL(u),u_zoom_transition:new r.bM(u),u_up_dir:new r.bL(u)}),heatmapTexture:u=>({u_image:new r.bN(u),u_color_ramp:new r.bN(u),u_opacity:new r.bM(u)}),hillshade:u=>({u_matrix:new r.bJ(u),u_image:new r.bN(u),u_latrange:new r.bK(u),u_light:new r.bK(u),u_shadow:new r.cz(u),u_highlight:new r.cz(u),u_emissive_strength:new r.bM(u),u_accent:new r.cz(u)}),hillshadePrepare:u=>({u_matrix:new r.bJ(u),u_image:new r.bN(u),u_dimension:new r.bK(u),u_zoom:new r.bM(u)}),line:r.cT,linePattern:r.cU,raster:u=>({u_matrix:new r.bJ(u),u_normalize_matrix:new r.bJ(u),u_globe_matrix:new r.bJ(u),u_merc_matrix:new r.bJ(u),u_grid_matrix:new r.cA(u),u_tl_parent:new r.bK(u),u_scale_parent:new r.bM(u),u_fade_t:new r.bM(u),u_opacity:new r.bM(u),u_image0:new r.bN(u),u_image1:new r.bN(u),u_brightness_low:new r.bM(u),u_brightness_high:new r.bM(u),u_saturation_factor:new r.bM(u),u_contrast_factor:new r.bM(u),u_spin_weights:new r.bL(u),u_perspective_transform:new r.bK(u),u_raster_elevation:new r.bM(u),u_zoom_transition:new r.bM(u),u_merc_center:new r.bK(u),u_cutoff_params:new r.ca(u),u_colorization_mix:new r.ca(u),u_colorization_offset:new r.bM(u),u_color_ramp:new r.bN(u),u_texture_offset:new r.bK(u),u_texture_res:new r.bK(u),u_emissive_strength:new r.bM(u)}),rasterParticle:u=>({u_matrix:new r.bJ(u),u_normalize_matrix:new r.bJ(u),u_globe_matrix:new r.bJ(u),u_merc_matrix:new r.bJ(u),u_grid_matrix:new r.cA(u),u_tl_parent:new r.bK(u),u_scale_parent:new r.bM(u),u_fade_t:new r.bM(u),u_opacity:new r.bM(u),u_image0:new r.bN(u),u_image1:new r.bN(u),u_raster_elevation:new r.bM(u),u_zoom_transition:new r.bM(u),u_merc_center:new r.bK(u),u_cutoff_params:new r.ca(u)}),rasterParticleTexture:u=>({u_texture:new r.bN(u),u_opacity:new r.bM(u)}),rasterParticleDraw:u=>({u_particle_texture:new r.bN(u),u_particle_texture_side_len:new r.bM(u),u_tile_offset:new r.bK(u),u_velocity:new r.bN(u),u_color_ramp:new r.bN(u),u_velocity_res:new r.bK(u),u_max_speed:new r.bM(u),u_uv_offset:new r.bK(u),u_data_scale:new r.bK(u),u_data_offset:new r.bM(u),u_particle_pos_scale:new r.bM(u),u_particle_pos_offset:new r.bK(u)}),rasterParticleUpdate:u=>({u_particle_texture:new r.bN(u),u_particle_texture_side_len:new r.bM(u),u_velocity:new r.bN(u),u_velocity_res:new r.bK(u),u_max_speed:new r.bM(u),u_speed_factor:new r.bM(u),u_reset_rate:new r.bM(u),u_rand_seed:new r.bM(u),u_uv_offset:new r.bK(u),u_data_scale:new r.bK(u),u_data_offset:new r.bM(u),u_particle_pos_scale:new r.bM(u),u_particle_pos_offset:new r.bK(u)}),symbol:u=>({u_is_size_zoom_constant:new r.bN(u),u_is_size_feature_constant:new r.bN(u),u_size_t:new r.bM(u),u_size:new r.bM(u),u_camera_to_center_distance:new r.bM(u),u_rotate_symbol:new r.bN(u),u_aspect_ratio:new r.bM(u),u_fade_change:new r.bM(u),u_matrix:new r.bJ(u),u_label_plane_matrix:new r.bJ(u),u_coord_matrix:new r.bJ(u),u_is_text:new r.bN(u),u_elevation_from_sea:new r.bN(u),u_pitch_with_map:new r.bN(u),u_texsize:new r.bK(u),u_texsize_icon:new r.bK(u),u_texture:new r.bN(u),u_texture_icon:new r.bN(u),u_gamma_scale:new r.bM(u),u_device_pixel_ratio:new r.bM(u),u_tile_id:new r.bL(u),u_zoom_transition:new r.bM(u),u_inv_rot_matrix:new r.bJ(u),u_merc_center:new r.bK(u),u_camera_forward:new r.bL(u),u_tile_matrix:new r.bJ(u),u_up_vector:new r.bL(u),u_ecef_origin:new r.bL(u),u_is_halo:new r.bN(u),u_icon_transition:new r.bM(u),u_color_adj_mat:new r.bJ(u),u_scale_factor:new r.bM(u)}),background:u=>({u_matrix:new r.bJ(u),u_emissive_strength:new r.bM(u),u_opacity:new r.bM(u),u_color:new r.cz(u)}),backgroundPattern:u=>({u_matrix:new r.bJ(u),u_emissive_strength:new r.bM(u),u_opacity:new r.bM(u),u_image:new r.bN(u),u_pattern_tl:new r.bK(u),u_pattern_br:new r.bK(u),u_texsize:new r.bK(u),u_pattern_size:new r.bK(u),u_pixel_coord_upper:new r.bK(u),u_pixel_coord_lower:new r.bK(u),u_pattern_units_to_pixels:new r.bK(u)}),terrainRaster:u=>({u_matrix:new r.bJ(u),u_image0:new r.bN(u),u_skirt_height:new r.bM(u),u_ground_shadow_factor:new r.bL(u)}),skybox:u=>({u_matrix:new r.bJ(u),u_sun_direction:new r.bL(u),u_cubemap:new r.bN(u),u_opacity:new r.bM(u),u_temporal_offset:new r.bM(u)}),skyboxGradient:u=>({u_matrix:new r.bJ(u),u_color_ramp:new r.bN(u),u_center_direction:new r.bL(u),u_radius:new r.bM(u),u_opacity:new r.bM(u),u_temporal_offset:new r.bM(u)}),skyboxCapture:u=>({u_matrix_3f:new r.cA(u),u_sun_direction:new r.bL(u),u_sun_intensity:new r.bM(u),u_color_tint_r:new r.ca(u),u_color_tint_m:new r.ca(u),u_luminance:new r.bM(u)}),globeRaster:u=>({u_proj_matrix:new r.bJ(u),u_globe_matrix:new r.bJ(u),u_normalize_matrix:new r.bJ(u),u_merc_matrix:new r.bJ(u),u_zoom_transition:new r.bM(u),u_merc_center:new r.bK(u),u_image0:new r.bN(u),u_grid_matrix:new r.cA(u),u_skirt_height:new r.bM(u),u_far_z_cutoff:new r.bM(u),u_frustum_tl:new r.bL(u),u_frustum_tr:new r.bL(u),u_frustum_br:new r.bL(u),u_frustum_bl:new r.bL(u),u_globe_pos:new r.bL(u),u_globe_radius:new r.bM(u),u_viewport:new r.bK(u)}),globeAtmosphere:u=>({u_frustum_tl:new r.bL(u),u_frustum_tr:new r.bL(u),u_frustum_br:new r.bL(u),u_frustum_bl:new r.bL(u),u_horizon:new r.bM(u),u_transition:new r.bM(u),u_fadeout_range:new r.bM(u),u_color:new r.ca(u),u_high_color:new r.ca(u),u_space_color:new r.ca(u),u_temporal_offset:new r.bM(u),u_horizon_angle:new r.bM(u)}),model:u=>({u_matrix:new r.bJ(u),u_lighting_matrix:new r.bJ(u),u_normal_matrix:new r.bJ(u),u_node_matrix:new r.bJ(u),u_lightpos:new r.bL(u),u_lightintensity:new r.bM(u),u_lightcolor:new r.bL(u),u_camera_pos:new r.bL(u),u_opacity:new r.bM(u),u_baseColorFactor:new r.ca(u),u_emissiveFactor:new r.ca(u),u_metallicFactor:new r.bM(u),u_roughnessFactor:new r.bM(u),u_baseTextureIsAlpha:new r.bN(u),u_alphaMask:new r.bN(u),u_alphaCutoff:new r.bM(u),u_baseColorTexture:new r.bN(u),u_metallicRoughnessTexture:new r.bN(u),u_normalTexture:new r.bN(u),u_occlusionTexture:new r.bN(u),u_emissionTexture:new r.bN(u),u_lutTexture:new r.bN(u),u_color_mix:new r.ca(u),u_aoIntensity:new r.bM(u),u_emissive_strength:new r.bM(u),u_occlusionTextureTransform:new r.ca(u)}),modelDepth:u=>({u_matrix:new r.bJ(u),u_instance:new r.bJ(u),u_node_matrix:new r.bJ(u)}),groundShadow:u=>({u_matrix:new r.bJ(u),u_ground_shadow_factor:new r.bL(u)}),stars:u=>({u_matrix:new r.bJ(u),u_up:new r.bL(u),u_right:new r.bL(u),u_intensity_multiplier:new r.bM(u)}),snowParticle:u=>({u_modelview:new r.bJ(u),u_projection:new r.bJ(u),u_time:new r.bM(u),u_cam_pos:new r.bL(u),u_velocityConeAperture:new r.bM(u),u_velocity:new r.bM(u),u_horizontalOscillationRadius:new r.bM(u),u_horizontalOscillationRate:new r.bM(u),u_boxSize:new r.bM(u),u_billboardSize:new r.bM(u),u_simpleShapeParameters:new r.bK(u),u_screenSize:new r.bK(u),u_thinningCenterPos:new r.bK(u),u_thinningShape:new r.bL(u),u_thinningAffectedRatio:new r.bM(u),u_thinningParticleOffset:new r.bM(u),u_particleColor:new r.ca(u),u_direction:new r.bL(u)}),rainParticle:u=>({u_modelview:new r.bJ(u),u_projection:new r.bJ(u),u_time:new r.bM(u),u_cam_pos:new r.bL(u),u_texScreen:new r.bN(u),u_velocityConeAperture:new r.bM(u),u_velocity:new r.bM(u),u_boxSize:new r.bM(u),u_rainDropletSize:new r.bK(u),u_distortionStrength:new r.bM(u),u_rainDirection:new r.bL(u),u_color:new r.ca(u),u_screenSize:new r.bK(u),u_thinningCenterPos:new r.bK(u),u_thinningShape:new r.bL(u),u_thinningAffectedRatio:new r.bM(u),u_thinningParticleOffset:new r.bM(u),u_shapeDirectionalPower:new r.bM(u),u_shapeNormalPower:new r.bM(u),u_mode:new r.bM(u)}),vignette:u=>({u_vignetteShape:new r.bL(u),u_vignetteColor:new r.ca(u)}),occlusion:u=>({u_matrix:new r.bJ(u),u_anchorPos:new r.bL(u),u_screenSizePx:new r.bK(u),u_occluderSizePx:new r.bK(u),u_color:new r.ca(u)})};class Na{constructor(t,n,d,y){this.id=Na.uniqueIdxCounter,Na.uniqueIdxCounter++,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||y||n.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Na.uniqueIdxCounter,Na.uniqueIdxCounter++;const n=this.context.gl;this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Na.uniqueIdxCounter=0;const xo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ss{constructor(t,n,d,y,b,T){this.length=n.length,this.attributes=d,this.itemSize=n.bytesPerElement,this.dynamicDraw=y,this.instanceCount=T,this.context=t;const I=t.gl;this.buffer=I.createBuffer(),t.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||b||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let d=0;d<this.attributes.length;d++){const y=n.attributes[this.attributes[d].name];y!==void 0&&t.enableVertexAttribArray(y)}}setVertexAttribPointers(t,n,d){for(let y=0;y<this.attributes.length;y++){const b=this.attributes[y],T=n.attributes[b.name];T!==void 0&&t.vertexAttribPointer(T,b.components,t[xo[b.type]],!1,this.itemSize,b.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(t,n,d){for(let y=0;y<this.attributes.length;y++){const b=n.attributes[this.attributes[y].name];b!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(b,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class gp{constructor(t,n,d,y,b){this.context=t,this.width=n,this.height=d;const T=this.framebuffer=t.gl.createFramebuffer();y&&(this.colorAttachment=new lu(t,T)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new td(t,T):new Pf(t,T))}destroy(){const t=this.context.gl;if(this.colorAttachment){const n=this.colorAttachment.get();n&&t.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}else{const n=this.depthAttachment.get();n&&t.deleteTexture(n)}t.deleteFramebuffer(this.framebuffer)}}class ah{constructor(t,n){this.gl=t,this.clearColor=new Yh(this),this.clearDepth=new ir(this),this.clearStencil=new Xh(this),this.colorMask=new ou(this),this.depthMask=new wf(this),this.stencilMask=new ih(this),this.stencilFunc=new Or(this),this.stencilOp=new Ml(this),this.stencilTest=new rh(this),this.depthRange=new Sf(this),this.depthTest=new vo(this),this.depthFunc=new Zh(this),this.blend=new Za(this),this.blendFunc=new Kh(this),this.blendColor=new cp(this),this.blendEquation=new up(this),this.cullFace=new hc(this),this.cullFaceSide=new hp(this),this.frontFace=new Jh(this),this.program=new Qh(this),this.activeTexture=new Tf(this),this.viewport=new Mf(this),this.bindFramebuffer=new au(this),this.bindRenderbuffer=new Gm(this),this.bindTexture=new Cf(this),this.bindVertexBuffer=new Wm(this),this.bindElementBuffer=new qm(this),this.bindVertexArrayOES=new Ef(this),this.pixelStoreUnpack=new Af(this),this.pixelStoreUnpackPremultiplyAlpha=new Ko(this),this.pixelStoreUnpackFlipY=new dp(this),this.options=n?Object.assign({},n):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=n&&!!n.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n,d){return new Na(this,t,n,d)}createVertexBuffer(t,n,d,y,b){return new Ss(this,t,n,d,y,b)}createRenderbuffer(t,n,d){const y=this.gl,b=y.createRenderbuffer();return this.bindRenderbuffer.set(b),y.renderbufferStorage(y.RENDERBUFFER,t,n,d),this.bindRenderbuffer.set(null),b}createFramebuffer(t,n,d,y){return new gp(this,t,n,d,y)}clear({color:t,depth:n,stencil:d,colorMask:y}){const b=this.gl;let T=0;t&&(T|=b.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(y||[!0,!0,!0,!0])),n!==void 0&&(T|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),d!==void 0&&(T|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),b.clear(T)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){r.bn(t.blendFunction,Xi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Pl;function lh(u,t,n,d,y,b,T){const I=u.context,F=I.gl,V=u.transform,j=u.getOrCreateProgram("collisionBox"),G=[];let q=0,Q=0;for(let De=0;De<d.length;De++){const Ue=d[De],Le=t.getTile(Ue),Ne=Le.getBucket(n);if(!Ne)continue;const Oe=Xo(Ue,Ne,V);let We=Oe;y[0]===0&&y[1]===0||(We=u.translatePosMatrix(Oe,Le,y,b));const Qe=T?Ne.textCollisionBox:Ne.iconCollisionBox,xt=Ne.collisionCircleArray;if(xt.length>0){const ut=r.ab.mat4.create(),Dt=We;r.ab.mat4.mul(ut,Ne.placementInvProjMatrix,V.glCoordMatrix),r.ab.mat4.mul(ut,ut,Ne.placementViewportMatrix),G.push({circleArray:xt,circleOffset:Q,transform:Dt,invTransform:ut,projection:Ne.getProjection()}),q+=xt.length/4,Q=q}Qe&&(u.terrain&&u.terrain.setupElevationDraw(Le,j),j.draw(u,F.LINES,Si.disabled,Oi.disabled,u.colorModeForRenderPass(),zi.disabled,Xm(We,V,Le,Ne.getProjection()),n.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,null,V.zoom,null,[Qe.collisionVertexBuffer,Qe.collisionVertexBufferExt]))}if(!T||!G.length)return;const ce=u.getOrCreateProgram("collisionCircle"),ae=new r.cV;ae.resize(4*q),ae._trim();let de=0;for(const De of G)for(let Ue=0;Ue<De.circleArray.length/4;Ue++){const Le=4*Ue,Ne=De.circleArray[Le+0],Oe=De.circleArray[Le+1],We=De.circleArray[Le+2],Qe=De.circleArray[Le+3];ae.emplace(de++,Ne,Oe,We,Qe,0),ae.emplace(de++,Ne,Oe,We,Qe,1),ae.emplace(de++,Ne,Oe,We,Qe,2),ae.emplace(de++,Ne,Oe,We,Qe,3)}(!Pl||Pl.length<2*q)&&(Pl=function(De){const Ue=2*De,Le=new r.aU;Le.resize(Ue),Le._trim();for(let Ne=0;Ne<Ue;Ne++){const Oe=6*Ne;Le.uint16[Oe+0]=4*Ne+0,Le.uint16[Oe+1]=4*Ne+1,Le.uint16[Oe+2]=4*Ne+2,Le.uint16[Oe+3]=4*Ne+2,Le.uint16[Oe+4]=4*Ne+3,Le.uint16[Oe+5]=4*Ne+0}return Le}(q));const pe=I.createIndexBuffer(Pl,!0),Te=I.createVertexBuffer(ae,r.cW.members,!0);for(const De of G){const Ue={u_matrix:De.transform,u_inv_matrix:De.invTransform,u_camera_to_center_distance:(ke=V).getCameraToCenterDistance(De.projection),u_viewport_size:[ke.width,ke.height]};ce.draw(u,F.TRIANGLES,Si.disabled,Oi.disabled,u.colorModeForRenderPass(),zi.disabled,Ue,n.id,Te,pe,r.b7.simpleSegment(0,2*De.circleOffset,De.circleArray.length,De.circleArray.length/2),null,V.zoom)}var ke;Te.destroy(),pe.destroy()}const Qo=r.ab.mat4.create();function Qs(u){const t=u._camera.getWorldToCamera(u.worldSize,1),n=r.ab.mat4.multiply([],t,u.globeMatrix);r.ab.mat4.invert(n,n);const d=[0,0,0],y=[0,1,0,0];return r.ab.vec4.transformMat4(y,y,n),d[0]=y[0],d[1]=y[1],d[2]=y[2],r.ab.vec3.normalize(d,d),d}function Vr({width:u,height:t,anchor:n,textOffset:d,textScale:y},b){const{horizontalAlign:T,verticalAlign:I}=r.bD(n),F=-(T-.5)*u,V=-(I-.5)*t,j=r.bC(n,d);return new r.P((F/y+j[0])*b,(V/y+j[1])*b)}function ud(u,t,n,d,y,b,T,I,F,V,j){const G=u.text.placedSymbolArray,q=u.text.dynamicLayoutVertexArray,Q=u.icon.dynamicLayoutVertexArray,ce={},ae=u.getProjection(),de=Ga(I,ae,b),pe=b.elevation,Te=ae.upVectorScale(I.canonical,b.center.lat,b.worldSize).metersToTile;q.clear();for(let ke=0;ke<G.length;ke++){const De=G.get(ke),{tileAnchorX:Ue,tileAnchorY:Le,numGlyphs:Ne}=De,Oe=De.hidden||!De.crossTileID||u.allowVerticalPlacement&&!De.placedOrientation?null:d[De.crossTileID];if(Oe){let We=0,Qe=0,xt=0;if(pe){const bt=pe?pe.getAtTileOffset(I,Ue,Le):0,[Kt,Bt,kt]=ae.upVector(I.canonical,Ue,Le);We=bt*Kt*Te,Qe=bt*Bt*Te,xt=bt*kt*Te}let[ut,Dt,At,ot]=Js(De.projectedAnchorX+We,De.projectedAnchorY+Qe,De.projectedAnchorZ+xt,n?de:T);const wt=rs(b.getCameraToCenterDistance(ae),ot);let Vt=y.evaluateSizeForFeature(u.textSizeData,V,De)*wt/r.bw;n&&(Vt*=u.tilePixelRatio/F);const st=Vr(Oe,Vt);n?({x:ut,y:Dt,z:At}=ae.projectTilePoint(Ue+st.x,Le+st.y,I.canonical),[ut,Dt,At]=Js(ut+We,Dt+Qe,At+xt,T)):(t&&st._rotate(-b.angle),ut+=st.x,Dt+=st.y,At=0);const It=u.allowVerticalPlacement&&De.placedOrientation===r.bq.vertical?Math.PI/2:0;for(let bt=0;bt<Ne;bt++)r.bt(q,ut,Dt,At,It);j&&De.associatedIconIndex>=0&&(ce[De.associatedIconIndex]={x:ut,y:Dt,z:At,angle:It})}else Qr(Ne,q)}if(j){Q.clear();const ke=u.icon.placedSymbolArray;for(let De=0;De<ke.length;De++){const Ue=ke.get(De),{numGlyphs:Le}=Ue,Ne=ce[De];if(Ue.hidden||!Ne)Qr(Le,Q);else{const{x:Oe,y:We,z:Qe,angle:xt}=Ne;for(let ut=0;ut<Le;ut++)r.bt(Q,Oe,We,Qe,xt)}}u.icon.dynamicLayoutVertexBuffer.updateData(Q)}u.text.dynamicLayoutVertexBuffer.updateData(q)}function ch(u,t,n,d,y,b,T={}){const I=n.paint.get("icon-translate"),F=n.paint.get("text-translate"),V=n.paint.get("icon-translate-anchor"),j=n.paint.get("text-translate-anchor"),G=n.layout.get("icon-rotation-alignment"),q=n.layout.get("text-rotation-alignment"),Q=n.layout.get("icon-pitch-alignment"),ce=n.layout.get("text-pitch-alignment"),ae=n.layout.get("icon-keep-upright"),de=n.layout.get("text-keep-upright"),pe=n.paint.get("icon-color-saturation"),Te=n.paint.get("icon-color-contrast"),ke=n.paint.get("icon-color-brightness-min"),De=n.paint.get("icon-color-brightness-max"),Ue=n.layout.get("symbol-elevation-reference")==="sea",Le=u.context,Ne=Le.gl,Oe=u.transform,We=G==="map",Qe=q==="map",xt=Q==="map",ut=ce==="map",Dt=n.layout.get("symbol-sort-key").constantOr(1)!==void 0;let At=!1;const ot=u.depthModeForSublayer(0,Si.ReadOnly),wt=[r.at(Oe.center.lng),r.aA(Oe.center.lat)],Vt=n.layout.get("text-variable-anchor"),st=Oe.projection.name==="globe",It=[],bt=[0,-1,0];for(const Kt of d){const Bt=t.getTile(Kt),kt=Bt.getBucket(n);if(!kt||kt.projection.name==="mercator"&&st||kt.fullyClipped)continue;const $t=kt.projection.name==="globe",Xt=$t?r.ae(Oe.zoom):0,ci=Ga(Kt,kt.getProjection(),Oe),pi=Oe.calculatePixelsToTileUnitsMatrix(Bt),Fi=Vt&&kt.hasTextData(),Mi=kt.hasIconTextFit()&&Fi&&kt.hasIconData(),Ci=kt.getProjection().createInversionMatrix(Oe,Kt.canonical),ji=Ir=>{Oe.depthOcclusionForSymbolsAndCircles&&(n.hasInitialOcclusionOpacityProperties||u.terrain)&&(Ir.push("DEPTH_D24"),Ir.push("DEPTH_OCCLUSION"))},pr=()=>{const Ir=We&&n.layout.get("symbol-placement")!=="point",Mr=[];ji(Mr);const pn=Ir||Mi,ns=n.paint.get("icon-image-cross-fade").constantOr(0);u.terrainRenderModeElevated()&&xt&&Mr.push("PITCH_WITH_MAP_TERRAIN"),$t&&(Mr.push("PROJECTION_GLOBE_VIEW"),pn&&Mr.push("PROJECTED_POS_ON_VIEWPORT")),ns>0&&Mr.push("ICON_TRANSITION"),kt.icon.zOffsetVertexBuffer&&Mr.push("Z_OFFSET"),pe===0&&Te===0&&ke===0&&De===1||Mr.push("COLOR_ADJUSTMENT"),kt.sdfIcons&&Mr.push("RENDER_SDF");const Tn=kt.icon.programConfigurations.get(n.id),qn=u.getOrCreateProgram("symbol",{config:Tn,defines:Mr}),Co=Bt.imageAtlasTexture?Bt.imageAtlasTexture.size:[0,0],Gs=kt.iconSizeData,rn=r.bp(Gs,Oe.zoom),Hr=xt||Oe.pitch!==0,Br=bs(ci,Bt.tileID.canonical,xt,We,Oe,kt.getProjection(),pi),mr=Zd(ci,Bt.tileID.canonical,xt,We,Oe,kt.getProjection(),pi),In=u.translatePosMatrix(mr,Bt,I,V,!0),Yn=u.translatePosMatrix(ci,Bt,I,V),jr=pn?Qo:Br,zs=We&&!xt&&!Ir;let ta=bt;!st&&!Oe.mercatorFromTransition||We||(ta=Qs(Oe));const Eo=$t?ta:bt,ho=n.getColorAdjustmentMatrix(pe,Te,ke,De),Vo=mp(Gs.kind,rn,zs,xt,u,Yn,jr,In,Ue,!1,Co,[0,0],!0,Kt,Xt,wt,Ci,Eo,kt.getProjection(),ho,ns),Uo=Bt.imageAtlasTexture?Bt.imageAtlasTexture:null,jo=n.layout.get("icon-size").constantOr(0)!==1||kt.iconsNeedLinear,nl=kt.sdfIcons||u.options.rotating||u.options.zooming||jo||Hr?Ne.LINEAR:Ne.NEAREST,$o=kt.sdfIcons&&n.paint.get("icon-halo-width").constantOr(1)!==0,Ec=u.terrain&&xt&&Ir?r.ab.mat4.invert(r.ab.mat4.create(),Br):Qo;if(Ir&&kt.icon){const Ac=Oe.elevation,bd=Ac?Ac.getAtTileOffsetFunc(Kt,Oe.center.lat,Oe.worldSize,kt.getProjection()):null,wd=wn(ci,Bt.tileID.canonical,xt,We,Oe,kt.getProjection(),pi);qu(kt,ci,u,!1,wd,mr,xt,ae,bd,Kt)}return{program:qn,buffers:kt.icon,uniformValues:Vo,atlasTexture:Uo,atlasTextureIcon:null,atlasInterpolation:nl,atlasInterpolationIcon:null,isSDF:kt.sdfIcons,hasHalo:$o,tile:Bt,labelPlaneMatrixInv:Ec}},Er=()=>{const Ir=Qe&&n.layout.get("symbol-placement")!=="point",Mr=[],pn=Ir||Vt||Mi;u.terrainRenderModeElevated()&&ut&&Mr.push("PITCH_WITH_MAP_TERRAIN"),$t&&(Mr.push("PROJECTION_GLOBE_VIEW"),pn&&Mr.push("PROJECTED_POS_ON_VIEWPORT")),kt.text.zOffsetVertexBuffer&&Mr.push("Z_OFFSET"),kt.iconsInText&&Mr.push("RENDER_TEXT_AND_SYMBOL"),Mr.push("RENDER_SDF"),ji(Mr);const ns=kt.text.programConfigurations.get(n.id),Tn=u.getOrCreateProgram("symbol",{config:ns,defines:Mr});let qn,Co=[0,0],Gs=null;const rn=kt.textSizeData;kt.iconsInText&&(Co=Bt.imageAtlasTexture?Bt.imageAtlasTexture.size:[0,0],Gs=Bt.imageAtlasTexture?Bt.imageAtlasTexture:null,qn=ut||Oe.pitch!==0||u.options.rotating||u.options.zooming||rn.kind==="composite"||rn.kind==="camera"?Ne.LINEAR:Ne.NEAREST);const Hr=Bt.glyphAtlasTexture?Bt.glyphAtlasTexture.size:[0,0],Br=n.layout.get("text-size-scale-range"),mr=r.aw(u.scaleFactor,Br[0],Br[1]),In=r.bp(rn,Oe.zoom,mr),Yn=bs(ci,Bt.tileID.canonical,ut,Qe,Oe,kt.getProjection(),pi),jr=Zd(ci,Bt.tileID.canonical,ut,Qe,Oe,kt.getProjection(),pi),zs=u.translatePosMatrix(jr,Bt,F,j,!0),ta=u.translatePosMatrix(ci,Bt,F,j),Eo=pn?Qo:Yn,ho=Qe&&!ut&&!Ir;let Vo=bt;!st&&!Oe.mercatorFromTransition||Qe||(Vo=Qs(Oe));const Uo=mp(rn.kind,In,ho,ut,u,ta,Eo,zs,Ue,!0,Hr,Co,!0,Kt,Xt,wt,Ci,$t?Vo:bt,kt.getProjection(),null,null,mr),jo=Bt.glyphAtlasTexture?Bt.glyphAtlasTexture:null,nl=Ne.LINEAR,$o=n.paint.get("text-halo-width").constantOr(1)!==0,Ec=u.terrain&&ut&&Ir?r.ab.mat4.invert(r.ab.mat4.create(),Yn):Qo;if(Ir&&kt.text){const Ac=Oe.elevation,bd=Ac?Ac.getAtTileOffsetFunc(Kt,Oe.center.lat,Oe.worldSize,kt.getProjection()):null,wd=wn(ci,Bt.tileID.canonical,ut,Qe,Oe,kt.getProjection(),pi);qu(kt,ci,u,!0,wd,jr,ut,de,bd,Kt)}return{program:Tn,buffers:kt.text,uniformValues:Uo,atlasTexture:jo,atlasTextureIcon:Gs,atlasInterpolation:nl,atlasInterpolationIcon:qn,isSDF:!0,hasHalo:$o,tile:Bt,labelPlaneMatrixInv:Ec}},dn=kt.icon.segments.get().length,$r=kt.text.segments.get().length,$i=dn&&!T.onlyText?pr():null,lr=$r&&!T.onlyIcons?Er():null,bi=n.paint.get("icon-opacity").constantOr(1),or=n.paint.get("text-opacity").constantOr(1);if(Dt&&kt.canOverlap){At=!0;const Ir=bi&&!T.onlyText?kt.icon.segments.get():[],Mr=or&&!T.onlyIcons?kt.text.segments.get():[];for(const pn of Ir)It.push({segments:new r.b7([pn]),sortKey:pn.sortKey,state:$i});for(const pn of Mr)It.push({segments:new r.b7([pn]),sortKey:pn.sortKey,state:lr})}else T.onlyText||It.push({segments:bi?kt.icon.segments:new r.b7([]),sortKey:0,state:$i}),T.onlyIcons||It.push({segments:or?kt.text.segments:new r.b7([]),sortKey:0,state:lr})}At&&It.sort((Kt,Bt)=>Kt.sortKey-Bt.sortKey);for(const Kt of It){const Bt=Kt.state;if(Bt)if(u.terrain?u.terrain.setupElevationDraw(Bt.tile,Bt.program,{useDepthForOcclusion:Oe.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Bt.labelPlaneMatrixInv}):u.setupDepthForOcclusion(Oe.depthOcclusionForSymbolsAndCircles,Bt.program),Le.activeTexture.set(Ne.TEXTURE0),Bt.atlasTexture&&Bt.atlasTexture.bind(Bt.atlasInterpolation,Ne.CLAMP_TO_EDGE,!0),Bt.atlasTextureIcon&&(Le.activeTexture.set(Ne.TEXTURE1),Bt.atlasTextureIcon&&Bt.atlasTextureIcon.bind(Bt.atlasInterpolationIcon,Ne.CLAMP_TO_EDGE,!0)),u.uploadCommonLightUniforms(u.context,Bt.program),Bt.hasHalo){const kt=Bt.uniformValues;kt.u_is_halo=1,bo(Bt.buffers,Kt.segments,n,u,Bt.program,ot,y,b,kt,2),kt.u_is_halo=0}else{if(Bt.isSDF){const kt=Bt.uniformValues;Bt.hasHalo&&(kt.u_is_halo=1,bo(Bt.buffers,Kt.segments,n,u,Bt.program,ot,y,b,kt,1)),kt.u_is_halo=0}bo(Bt.buffers,Kt.segments,n,u,Bt.program,ot,y,b,Bt.uniformValues,1)}}}function bo(u,t,n,d,y,b,T,I,F,V){const j=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.iconTransitioningVertexBuffer,u.globeExtVertexBuffer,u.zOffsetVertexBuffer];y.draw(d,d.context.gl.TRIANGLES,b,T,I,zi.disabled,F,n.id,u.layoutVertexBuffer,u.indexBuffer,t,n.paint,d.transform.zoom,u.programConfigurations.get(n.id),j,V)}function _p(u,t,n,d,y,b,T){const I=u.context.gl,F=n.paint.get("fill-pattern"),V=n.is3D(),j=V?u.stencilModeFor3D():Oi.disabled,G=F&&F.constantOr(1);let q,Q,ce,ae,de;T?(Q=G&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=I.LINES):(Q=G?"fillPattern":"fill",q=I.TRIANGLES);for(const pe of d){const Te=t.getTile(pe);if(G&&!Te.patternsLoaded())continue;const ke=Te.getBucket(n);if(!ke)continue;u.prepareDrawTile();const De=ke.programConfigurations.get(n.id),Ue=u.isTileAffectedByFog(pe),Le=u.getOrCreateProgram(Q,{config:De,overrideFog:Ue});G&&(u.context.activeTexture.set(I.TEXTURE0),Te.imageAtlasTexture&&Te.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),De.updatePaintBuffers());const Ne=F.constantOr(null);if(Ne&&Te.imageAtlas){const Qe=Te.imageAtlas,xt=r.A.from(Ne).getPrimary().scaleSelf(r.q.devicePixelRatio).serialize(),ut=Qe.patternPositions[xt];ut&&De.setConstantPatternPositions(ut)}const Oe=u.translatePosMatrix(pe.projMatrix,Te,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),We=n.paint.get("fill-emissive-strength");if(T){ae=ke.indexBuffer2,de=ke.segments2;const Qe=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];ce=Q==="fillOutlinePattern"&&G?Ff(Oe,We,u,Te,Qe):fp(Oe,We,Qe)}else ae=ke.indexBuffer,de=ke.segments,ce=G?fu(Oe,We,u,Te):pc(Oe,We);u.uploadCommonUniforms(u.context,Le,pe.toUnwrapped()),Le.draw(u,q,y,V?j:u.stencilModeForClipping(pe),b,zi.disabled,ce,n.id,ke.layoutVertexBuffer,ae,de,n.paint,u.transform.zoom,De,void 0)}}function gu(u,t,n,d,y,b,T,I){n.resetLayerRenderingStats(u);const F=u.context,V=F.gl,j=u.transform,G=n.paint.get("fill-extrusion-pattern"),q=G.constantOr(1),Q=n.paint.get("fill-extrusion-opacity"),ce=u.style.enable3dLights(),ae=n.paint.get(ce&&!q?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),de=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),ae],pe=n.layout.get("fill-extrusion-edge-radius"),Te=pe>0&&!n.paint.get("fill-extrusion-rounded-roof"),ke=Te?0:pe,De=j.projection.name==="globe"?r.d3():0,Ue=j.projection.name==="globe",Le=Ue?r.ae(j.zoom):0,Ne=[r.at(j.center.lng),r.aA(j.center.lat)],Oe=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",We=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(Oe?null:n.lut).toArray01().slice(0,3),Qe=n.paint.get("fill-extrusion-flood-light-intensity"),xt=n.paint.get("fill-extrusion-vertical-scale"),ut=n.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Dt=n.paint.get("fill-extrusion-height-alignment"),At=n.paint.get("fill-extrusion-base-alignment"),ot=bl(u,n.paint.get("fill-extrusion-cutoff-fade-range")),wt=[];let Vt;Ue&&wt.push("PROJECTION_GLOBE_VIEW"),de[0]>0&&wt.push("FAUX_AO"),Te&&wt.push("ZERO_ROOF_RADIUS"),I&&wt.push("HAS_CENTROID"),Qe>0&&wt.push("FLOOD_LIGHT"),ot.shouldRenderCutoff&&wt.push("RENDER_CUTOFF"),ut&&wt.push("RENDER_WALL_MODE");const st=u.renderPass==="shadow",It=u.shadowRenderer,bt=st&&!!It;u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0);let Kt=[0,0,0];if(It){const $t=u.style.directionalLight,Xt=u.style.ambientLight;$t&&Xt&&(Kt=Gh(u.style,$t,Xt)),st||(wt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),It.useNormalOffset&&wt.push("NORMAL_OFFSET")),Vt=wt.concat(["SHADOWS_SINGLE_CASCADE"])}const Bt=bt?"fillExtrusionDepth":q?"fillExtrusionPattern":"fillExtrusion",kt=n.getLayerRenderingStats();for(const $t of d){const Xt=t.getTile($t),ci=Xt.getBucket(n);if(!ci||ci.projection.name!==j.projection.name)continue;let pi=!1;It&&(pi=It.getMaxCascadeForTile($t.toUnwrapped())===0);const Fi=u.isTileAffectedByFog($t),Mi=ci.programConfigurations.get(n.id),Ci=u.getOrCreateProgram(Bt,{config:Mi,defines:pi?Vt:wt,overrideFog:Fi});if(u.terrain&&u.terrain.setupElevationDraw(Xt,Ci,{useMeterToDem:!0}),!ci.centroidVertexBuffer){const lr=Ci.attributes.a_centroid_pos;lr!==void 0&&V.vertexAttrib2f(lr,0,0)}!st&&It&&It.setupShadows(Xt.tileID.toUnwrapped(),Ci,"vector-tile",Xt.tileID.overscaledZ),q&&(u.context.activeTexture.set(V.TEXTURE0),Xt.imageAtlasTexture&&Xt.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Mi.updatePaintBuffers());const ji=G.constantOr(null);if(ji&&Xt.imageAtlas){const lr=Xt.imageAtlas,bi=r.A.from(ji).getPrimary().scaleSelf(r.q.devicePixelRatio),or=lr.patternPositions[bi.serialize()];or&&Mi.setConstantPatternPositions(or)}const pr=n.paint.get("fill-extrusion-vertical-gradient"),Er=1/ci.tileToMeter;let dn;if(st&&It){if(Ka(Xt.tileID,ci,u))continue;const lr=It.calculateShadowPassMatrixFromTile(Xt.tileID.toUnwrapped());dn=dc(lr,ke,Er,xt,Dt,At)}else{const lr=u.translatePosMatrix($t.expandedProjMatrix,Xt,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),bi=j.projection.createInversionMatrix(j,$t.canonical);dn=q?zf(lr,u,pr,Q,de,ke,Er,$t,Xt,De,Dt,At,Le,Ne,bi,We,xt):sd(lr,u,pr,Q,de,ke,Er,$t,De,Dt,At,Le,Ne,bi,We,xt,Qe,Kt)}u.uploadCommonUniforms(F,Ci,$t.toUnwrapped(),null,ot);let $r=ci.segments;if(j.projection.name==="mercator"&&!st&&($r=ci.getVisibleSegments(Xt.tileID,u.terrain,u.transform.getFrustum(0)),!$r.get().length))continue;if(kt)if(st)for(const lr of $r.get())kt.numRenderedVerticesInShadowPass+=lr.primitiveLength;else for(const lr of $r.get())kt.numRenderedVerticesInTransparentPass+=lr.primitiveLength;const $i=[];(u.terrain||I)&&$i.push(ci.centroidVertexBuffer),Ue&&$i.push(ci.layoutVertexExtBuffer),ut&&$i.push(ci.wallVertexBuffer),Ci.draw(u,F.gl.TRIANGLES,y,b,T,zi.backCCW,dn,n.id,ci.layoutVertexBuffer,ci.indexBuffer,$r,n.paint,u.transform.zoom,Mi,$i)}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1)}function Vn(u,t,n,d,y,b,T,I,F,V,j,G,q,Q,ce,ae,de,pe,Te){const ke=u.context,De=ke.gl,Ue=u.transform,Le=u.transform.zoom,Ne=[],Oe=bl(u,n.paint.get("fill-extrusion-cutoff-fade-range"));V==="clear"?(Ne.push("CLEAR_SUBPASS"),Te&&(Ne.push("CLEAR_FROM_TEXTURE"),ke.activeTexture.set(De.TEXTURE0),Te.bind(De.LINEAR,De.CLAMP_TO_EDGE))):V==="sdf"&&Ne.push("SDF_SUBPASS"),de&&Ne.push("HAS_CENTROID"),Oe.shouldRenderCutoff&&Ne.push("RENDER_CUTOFF");const We=n.layout.get("fill-extrusion-edge-radius"),Qe=(xt,ut,Dt,At,ot)=>{const wt=ut.programConfigurations.get(n.id),Vt=u.isTileAffectedByFog(xt),st=u.getOrCreateProgram("fillExtrusionGroundEffect",{config:wt,defines:Ne,overrideFog:Vt}),It=((Kt,Bt,kt,$t,Xt,ci,pi,Fi,Mi,Ci,ji)=>({u_matrix:Bt,u_opacity:kt,u_ao_pass:$t?1:0,u_meter_to_tile:Xt,u_ao:ci,u_flood_light_intensity:pi,u_flood_light_color:Fi,u_attenuation:Mi,u_edge_radius:Ci,u_fb:0,u_fb_size:ji,u_dynamic_offset:1}))(0,At,j,F,ot,[G,q*ot],Q,ce,ae,Le>=17?0:We*ot,Te?Te.size[0]:0),bt=[];de&&bt.push(ut.hiddenByLandmarkVertexBuffer),u.uploadCommonUniforms(ke,st,xt.toUnwrapped(),null,Oe),st.draw(u,ke.gl.TRIANGLES,y,b,T,I,It,n.id,ut.vertexBuffer,ut.indexBuffer,Dt,n.paint,Le,wt,bt)};for(const xt of d){const ut=t.getTile(xt),Dt=ut.getBucket(n);if(!Dt||Dt.projection.name!==Ue.projection.name||!Dt.groundEffect||Dt.groundEffect&&!Dt.groundEffect.hasData())continue;const At=Dt.groundEffect,ot=1/Dt.tileToMeter;{const wt=u.translatePosMatrix(xt.projMatrix,ut,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Vt=At.getDefaultSegment();Qe(xt,At,Vt,wt,ot)}if(pe)for(let wt=0;wt<4;wt++){const Vt=r.d4[wt](xt),st=t.getTile(Vt);if(!st)continue;const It=st.getBucket(n);if(!It||It.projection.name!==Ue.projection.name||!It.groundEffect||It.groundEffect&&!It.groundEffect.hasData())continue;const bt=It.groundEffect;let Kt,Bt;wt===0?(Kt=[-r.ag,0,0],Bt=1):wt===1?(Kt=[r.ag,0,0],Bt=0):wt===2?(Kt=[0,-r.ag,0],Bt=3):(Kt=[0,r.ag,0],Bt=2);const kt=bt.regionSegments[Bt];if(!kt)continue;const $t=new Float32Array(16);r.ab.mat4.translate($t,xt.projMatrix,Kt),Qe(xt,bt,kt,u.translatePosMatrix($t,ut,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),ot)}}}function _c(u,t,n,d,y,b,T){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const I=b?b.findDEMTileFor(n):null;if(!(I&&I.dem||T))return;b&&I&&I.dem&&d.selfDEMTileTimestamp!==I.dem._timestamp&&(d.borderDoneWithNeighborZ=[-1,-1,-1,-1],d.selfDEMTileTimestamp=I.dem._timestamp);const F=pe=>new r.P(Math.ceil((pe+r.d7)*r.d8),0),V=pe=>{const Te=t.getSource().minzoom,ke=Ue=>{const Le=t.getTileByID(Ue);if(Le&&Le.hasData())return Le.getBucket(y)},De=[0,-1,1];for(const Ue of De){if(pe.overscaledZ+Ue<Te)continue;const Le=ke(pe.calculateScaledKey(pe.overscaledZ+Ue));if(Le)return Le}},j=[0,0,0],G=(pe,Te)=>(j[0]=Math.min(pe.min.y,Te.min.y),j[1]=Math.max(pe.max.y,Te.max.y),j[2]=r.ag-Te.min.x>pe.max.x?Te.min.x-r.ag:pe.max.x,j),q=(pe,Te)=>(j[0]=Math.min(pe.min.x,Te.min.x),j[1]=Math.max(pe.max.x,Te.max.x),j[2]=r.ag-Te.min.y>pe.max.y?Te.min.y-r.ag:pe.max.y,j),Q=[(pe,Te)=>G(pe,Te),(pe,Te)=>G(Te,pe),(pe,Te)=>q(pe,Te),(pe,Te)=>q(Te,pe)],ce=(pe,Te,ke,De,Ue,Le,Ne)=>{if(!b)return 0;const Oe=[[Le?ke:pe,Le?pe:ke,0],[Le?ke:Te,Le?Te:ke,0]],We=Ne<0?r.ag+Ne:Ne,Qe=[Le?We:(pe+Te)/2,Le?(pe+Te)/2:We,0];return ke===0&&Ne<0||ke!==0&&Ne>0?b.getForTilePoints(Ue,[Qe],!0,De):Oe.push(Qe),b.getForTilePoints(n,Oe,!0,I),Math.max(Oe[0][2],Oe[1][2],Qe[2])/b.exaggeration()};for(let pe=0;pe<4;pe++){const Te=d.borderFeatureIndices[pe];if(Te.length===0)continue;const ke=r.d4[pe](n),De=V(ke);if(!(De&&De instanceof r.d5))continue;const Ue=b?b.findDEMTileFor(ke):null;if(!(Ue&&Ue.dem||T)||(b&&Ue&&Ue.dem&&d.borderDEMTileTimestamp[pe]!==Ue.dem._timestamp&&(d.borderDoneWithNeighborZ[pe]=-1,d.borderDEMTileTimestamp[pe]=Ue.dem._timestamp),d.borderDoneWithNeighborZ[pe]===De.canonical.z))continue;De.centroidVertexArray.length===0&&De.createCentroidsBuffer();const Le=(pe<2?1:5)-pe,Ne=De.borderDoneWithNeighborZ[Le]!==d.canonical.z,Oe=De.borderFeatureIndices[Le];let We=0;if(d.canonical.z!==De.canonical.z){for(const Qe of Te)d.showCentroid(d.featuresOnBorder[Qe]);if(Ne)for(const Qe of Oe)De.showCentroid(De.featuresOnBorder[Qe]);d.borderDoneWithNeighborZ[pe]=De.canonical.z,De.borderDoneWithNeighborZ[Le]=d.canonical.z}for(const Qe of Te){const xt=d.featuresOnBorder[Qe],ut=d.centroidData[xt.centroidDataIndex],Dt=xt.borders[pe];let At;for(;We<Oe.length;){At=De.featuresOnBorder[Oe[We]];const ot=At.borders[Le];if(ot[1]>Dt[0]+3||ot[0]>Dt[0]-3)break;De.showCentroid(At),We++}if(At&&We<Oe.length){const ot=We;let wt=0;for(;!(At.borders[Le][0]>Dt[1]-3)&&(wt++,++We!==Oe.length);)At=De.featuresOnBorder[Oe[We]];At=De.featuresOnBorder[Oe[ot]];let Vt=!1;if(wt>=1){const bt=At.borders[Le];Math.abs(Dt[0]-bt[0])<3&&Math.abs(Dt[1]-bt[1])<3&&(wt=1,Vt=!0,We=ot+1)}else if(wt===0){d.showCentroid(xt);continue}const st=De.centroidData[At.centroidDataIndex];T&&Vt&&(((ae=ut).flags|(de=st).flags)&r.d6?(ae.flags|=r.d6,de.flags|=r.d6):(ae.flags&=~r.d6,de.flags&=~r.d6));const It=xt.intersectsCount()>1||At.intersectsCount()>1;if(wt>1)We=ot,ut.centroidXY=st.centroidXY=new r.P(0,0);else if(Ue&&Ue.dem&&!It){const bt=Q[pe](ut,st),Kt=pe%2?r.ag-1:0,Bt=ce(bt[0],Math.min(r.ag-1,bt[1]),Kt,Ue,ke,pe<2,bt[2]);ut.centroidXY=st.centroidXY=F(Bt)}else It?ut.centroidXY=st.centroidXY=new r.P(0,0):(ut.centroidXY=d.encodeBorderCentroid(xt),st.centroidXY=De.encodeBorderCentroid(At));d.writeCentroidToBuffer(ut),De.writeCentroidToBuffer(st)}else d.showCentroid(xt)}d.borderDoneWithNeighborZ[pe]=De.canonical.z,De.borderDoneWithNeighborZ[Le]=d.canonical.z}var ae,de;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(u)}const yc=[1,0,0],Gt=[0,1,0],li=[0,0,1];function Ka(u,t,n){const d=n.transform,y=n.shadowRenderer;if(!y)return!0;const b=u.toUnwrapped(),T=d.tileSize*y._cascades[n.currentShadowCascade].scale;let I=t.maxHeight;if(d.elevation){const ae=d.elevation.getMinMaxForTile(u);ae&&(I+=ae.max)}const F=[...y.shadowDirection];F[2]=-F[2];const V=y.computeSimplifiedTileShadowVolume(b,I,T,F);if(!V)return!1;const j=[yc,Gt,li,F,[F[0],0,F[2]],[0,F[1],F[2]]],G=d.projection.name==="globe",q=d.scaleZoom(T),Q=r.bR.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,q,!G),ce=y.getCurrentCascadeFrustum();return Q.intersectsPrecise(V.vertices,V.planes,j)===0||ce.intersectsPrecise(V.vertices,V.planes,j)===0}function on(u){return[u[0]*r.d9,u[1]*r.d9,u[2]*r.d9,0]}function dt(u,t,n,d,y,b,T,I,F){const V=d.getSource(),j=n.globeSharedBuffers;if(!j)return;let G,q,Q;if(t&&(G=d.getTile(t)),V instanceof r.aJ?(q=V.texture,Q=r.cI(0,0,n.transform)):G&&t&&(q=G.texture,Q=r.cI(t.canonical.z,t.canonical.x,n.transform)),!q||!Q)return;u||(Q=r.ab.mat4.scale(r.ab.mat4.create(),Q,[1,-1,1]));const ce=n.context,ae=ce.gl,de=y.paint.get("raster-resampling")==="nearest"?ae.NEAREST:ae.LINEAR,pe=n.colorModeForDrapableLayerRenderPass(b),Te=T.defines;Te.push("GLOBE_POLES");const ke=new Si(ae.LEQUAL,Si.ReadWrite,n.depthRangeFor3D),De=Float32Array.from(n.transform.expandedFarZProjMatrix),Ue=Float32Array.from(r.bb(r.cH(new r.bT(0,0,0))));n.terrain&&n.terrain.prepareDrawTile(),ce.activeTexture.set(ae.TEXTURE0),q.bind(de,ae.CLAMP_TO_EDGE),ce.activeTexture.set(ae.TEXTURE1),q.bind(de,ae.CLAMP_TO_EDGE),q.useMipmap&&ce.extTextureFilterAnisotropic&&n.transform.pitch>20&&ae.texParameterf(ae.TEXTURE_2D,ce.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ce.extTextureFilterAnisotropicMax);const[Le,Ne,Oe,We]=t?j.getPoleBuffers(t.canonical.z,!1):j.getPoleBuffers(0,!0),Qe=y.paint.get("raster-elevation");let xt;u?(xt=Le,n.renderDefaultNorthPole=Qe!==0):(xt=Ne,n.renderDefaultSouthPole=Qe!==0);const ut=on(T.mix),Dt=((ot,wt,Vt,st,It,bt,Kt,Bt,kt,$t,Xt,ci,pi)=>Al(ot,wt,Vt,new Float32Array(16),new Float32Array(9),[0,0],st,[0,0],[0,0,0,0],1,{opacity:1,mix:0},bt,[0,0],Bt,2,$t,Xt,ci,1,0,pi))(De,Ue,Q,r.ae(n.transform.zoom),0,y,0,Qe,0,ut,T.offset,T.range,b),At=n.getOrCreateProgram("raster",{defines:Te});n.uploadCommonUniforms(ce,At,null),At.draw(n,ae.TRIANGLES,ke,F,pe,I,Dt,y.id,xt,Oe,We)}function Vf(u){const t=u._nearZ,n=u.projection.farthestPixelDistance(u),d=n-t,y=.2*u.height,b=t+y;return[t,n,(b-y-t)/d,(b-t)/d]}function uh(u,t,n,d){if(u)return t instanceof is&&u instanceof aa?t.getTextureDescriptor(u,n,!0):{texture:u.texture,mix:on(d.mix),offset:d.offset,buffer:0,tileSize:1}}var hd=r.da([{name:"a_index",type:"Int16",components:1}]);class yp{constructor(t,n,d,y){const b={width:d[0],height:d[1],data:null},T=t.gl;this.targetColorTexture=new r.T(t,b,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(t,b,T.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(n,y),this.lastInvalidatedAt=0}updateParticleTexture(t,n){if(this.particleTextureDimension===n.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const d=this.context.gl,y=n.width*n.height;this.particleTexture0=new r.T(this.context,n,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,n,d.RGBA8,{premultiply:!1,useMipmap:!1});const b=new r.db;b.reserve(y);for(let T=0;T<y;T++)b.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(b,hd.members,!0),this.particleSegment=r.b7.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=n.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=r.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Uf(u,t,n){if(!u)return null;const d=t.getTextureDescriptor(u,n,!0);if(!d)return null;let{texture:y,mix:b,offset:T,tileSize:I,buffer:F,format:V}=d;if(!y||!V)return null;let j=!1;return V==="uint32"&&(j=!0,b[3]=0,b=mu(r.dc,b,[0,n.paint.get("raster-particle-max-speed")]),T=sh(r.dc,T,[0,n.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[F/(I+2*F),I/(I+2*F)],tileSize:I,scalarData:j,scale:b,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[V]]}}function jf(u){const t=u._nearZ,n=u.projection.farthestPixelDistance(u),d=n-t,y=.2*u.height,b=t+y;return[t,n,(b-y-t)/d,(b-t)/d]}const _u=new r.aj(1,0,0,1),Hn=new r.aj(0,1,0,1),$f=new r.aj(0,0,1,1),Hf=new r.aj(1,0,1,1),vc=new r.aj(0,1,1,1);function Dl(u,t,n,d,y,b,T){const I=u.context,F=u.transform,V=I.gl,j=F.projection.name==="globe",G=j?["PROJECTION_GLOBE_VIEW"]:[];let q=r.ab.mat4.clone(n.projMatrix);if(j&&r.ae(F.zoom)>0){const ut=r.ba(n.canonical,F),Dt=r.dd(ut);q=r.ab.mat4.multiply(new Float32Array(16),F.globeMatrix,Dt),r.ab.mat4.multiply(q,F.projMatrix,q)}const Q=r.ab.mat4.create();Q[12]+=2*y/(r.q.devicePixelRatio*F.width),Q[13]+=2*b/(r.q.devicePixelRatio*F.height),r.ab.mat4.multiply(q,Q,q);const ce=u.getOrCreateProgram("debug",{defines:G}),ae=t.getTileByID(n.key);u.terrain&&u.terrain.setupElevationDraw(ae,ce);const de=Si.disabled,pe=Oi.disabled,Te=u.colorModeForRenderPass(),ke="$debug";I.activeTexture.set(V.TEXTURE0),u.emptyTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),j?ae._makeGlobeTileDebugBuffers(u.context,F):ae._makeDebugTileBoundsBuffers(u.context,F.projection);const De=ae._tileDebugBuffer||u.debugBuffer,Ue=ae._tileDebugIndexBuffer||u.debugIndexBuffer,Le=ae._tileDebugSegments||u.debugSegments;if(ce.draw(u,V.LINE_STRIP,de,pe,Te,zi.disabled,fc(q,d),ke,De,Ue,Le,null,null,null,[ae._globeTileDebugBorderBuffer]),T){const ut=ae.latestRawTileData,Dt=Math.floor((ut&&ut.byteLength||0)/1024);let At=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(At+=` => ${n.overscaledZ}`),At+=` ${ae.state}`,At+=` ${Dt}kb`,function(ot,wt){ot.initDebugOverlayCanvas();const Vt=ot.debugOverlayCanvas,st=ot.context.gl,It=ot.debugOverlayCanvas.getContext("2d");It.clearRect(0,0,Vt.width,Vt.height),It.shadowColor="white",It.shadowBlur=2,It.lineWidth=1.5,It.strokeStyle="white",It.textBaseline="top",It.font="bold 36px Open Sans, sans-serif",It.fillText(wt,5,5),It.strokeText(wt,5,5),ot.debugOverlayTexture.update(Vt),ot.debugOverlayTexture.bind(st.LINEAR,st.CLAMP_TO_EDGE)}(u,At)}const Ne=t.getTile(n).tileSize,Oe=512/Math.min(Ne,512)*(n.overscaledZ/F.zoom)*.5,We=ae._tileDebugTextBuffer||u.debugBuffer,Qe=ae._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,xt=ae._tileDebugTextSegments||u.debugSegments;ce.draw(u,V.TRIANGLES,de,pe,Xi.alphaBlended,zi.disabled,fc(q,r.aj.transparent,Oe),ke,We,Qe,xt,null,null,null,[ae._globeTileDebugTextBuffer])}function vp(u,t,n,d){ea(u,0,t+n/2,u.transform.width,n,d)}function xp(u,t,n,d){ea(u,t-n/2,0,n,u.transform.height,d)}function ea(u,t,n,d,y,b){const T=u.context,I=T.gl;I.enable(I.SCISSOR_TEST),I.scissor(t*r.q.devicePixelRatio,n*r.q.devicePixelRatio,d*r.q.devicePixelRatio,y*r.q.devicePixelRatio),T.clear({color:b}),I.disable(I.SCISSOR_TEST)}const yu=r.da([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ua}=yu;function Va(u,t,n,d){u.emplaceBack(t,n,d)}class bp{constructor(t){this.vertexArray=new r.de,this.indices=new r.aU,Va(this.vertexArray,-1,-1,1),Va(this.vertexArray,1,-1,1),Va(this.vertexArray,-1,1,1),Va(this.vertexArray,1,1,1),Va(this.vertexArray,-1,-1,-1),Va(this.vertexArray,1,-1,-1),Va(this.vertexArray,-1,1,-1),Va(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,ua),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=r.b7.simpleSegment(0,0,36,12)}}function ms(u,t,n,d,y,b){const T=u.context.gl,I=t.paint.get("sky-atmosphere-color"),F=t.paint.get("sky-atmosphere-halo-color"),V=t.paint.get("sky-atmosphere-sun-intensity"),j=((G,q,Q,ce,ae)=>({u_matrix_3f:G,u_sun_direction:q,u_sun_intensity:Q,u_color_tint_r:[ce.r,ce.g,ce.b,ce.a],u_color_tint_m:[ae.r,ae.g,ae.b,ae.a],u_luminance:5e-5}))(r.ab.mat3.fromMat4(r.ab.mat3.create(),d),y,V,I,F);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+b,t.skyboxTexture,0),n.draw(u,T.TRIANGLES,Si.disabled,Oi.disabled,Xi.unblended,zi.frontCW,j,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Ts=r.da([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class hh{constructor(t){const n=new r.df;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const d=new r.aU;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(n,Ts.members),this.indexBuffer=t.createIndexBuffer(d),this.segments=r.b7.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const en=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Dr{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class dh{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Xi([1,vl,1,vl],r.aj.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Xi([1,0,1,0],r.aj.transparent,[!1,!1,!1,!0]),this.params=new Dr,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const n=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new hh(n);const d=this.params.sizeRange,y=this.params.intensityRange,b=function(j){const G=r.di(30),q=[];for(let Q=0;Q<j;++Q){const ce=2*Math.PI*G(),ae=Math.acos(1-2*G())-.5*Math.PI;q.push(r.ab.vec3.fromValues(Math.cos(ae)*Math.cos(ce),Math.cos(ae)*Math.sin(ce),Math.sin(ae)))}return q}(this.params.starsCount),T=r.di(300),I=new r.dg,F=new r.aU;let V=0;for(let j=0;j<b.length;++j){const G=r.ab.vec3.scale([],b[j],200),q=Math.max(0,1+.01*d*(1*T()-.5)),Q=Math.max(0,1+.01*y*(1*T()-.5));I.emplaceBack(G[0],G[1],G[2],-1,-1,q,Q),I.emplaceBack(G[0],G[1],G[2],1,-1,q,Q),I.emplaceBack(G[0],G[1],G[2],1,1,q,Q),I.emplaceBack(G[0],G[1],G[2],-1,1,q,Q),F.emplaceBack(V+0,V+1,V+2),F.emplaceBack(V+0,V+2,V+3),V+=4}this.starsVx=n.createVertexBuffer(I,en.members),this.starsIdx=n.createIndexBuffer(F),this.starsSegments=r.b7.simpleSegment(0,0,I.length,F.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,n){const d=t.context,y=d.gl,b=t.transform,T=new Si(y.LEQUAL,Si.ReadOnly,[0,1]),I=r.ae(b.zoom),F=t.style.getLut(n.scope),V=n.properties.get("color-use-theme")==="none",j=n.properties.get("color").toRenderColor(V?null:F).toArray01(),G=n.properties.get("high-color-use-theme")==="none",q=n.properties.get("high-color").toRenderColor(G?null:F).toArray01(),Q=n.properties.get("space-color-use-theme")==="none",ce=n.properties.get("space-color").toRenderColor(Q?null:F).toArray01PremultipliedAlpha(),ae=5e-4,de=r.dh(n.properties.get("horizon-blend"),0,1,ae,.25),pe=r.cC(t,d,b)&&de===ae?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,Te=t.frameCounter/1e3%1,ke=r.ab.vec3.length(b.globeCenterInViewSpace),De=Math.sqrt(Math.pow(ke,2)-Math.pow(pe,2)),Ue=Math.acos(De/ke),Le=Ne=>{const Oe=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ne&&Oe.push("ALPHA_PASS");const We=t.getOrCreateProgram("globeAtmosphere",{defines:Oe}),Qe=((ut,Dt,At,ot,wt,Vt,st,It,bt,Kt,Bt,kt)=>({u_frustum_tl:ut,u_frustum_tr:Dt,u_frustum_br:At,u_frustum_bl:ot,u_horizon:wt,u_transition:Vt,u_fadeout_range:st,u_color:It,u_high_color:bt,u_space_color:Kt,u_temporal_offset:Bt,u_horizon_angle:kt}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,I,de,j,q,ce,Te,Ue);t.uploadCommonUniforms(d,We);const xt=this.atmosphereBuffer;xt&&We.draw(t,y.TRIANGLES,T,Oi.disabled,Ne?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,zi.backCW,Qe,Ne?"atmosphere_glow_alpha":"atmosphere_glow",xt.vertexBuffer,xt.indexBuffer,xt.segments)};Le(!1),Le(!0)}drawStars(t,n){const d=r.aw(n.properties.get("star-intensity"),0,1);if(d===0)return;const y=t.context,b=y.gl,T=t.transform,I=t.getOrCreateProgram("stars"),F=r.ab.quat.identity([]);r.ab.quat.rotateX(F,F,-T._pitch),r.ab.quat.rotateZ(F,F,-T.angle),r.ab.quat.rotateX(F,F,r.ai(T._center.lat)),r.ab.quat.rotateY(F,F,-r.ai(T._center.lng));const V=r.ab.mat4.fromQuat(new Float32Array(16),F),j=r.ab.mat4.multiply([],T.starsProjMatrix,V),G=r.ab.mat3.fromMat4([],V),q=r.ab.mat3.invert([],G),Q=[0,1,0];r.ab.vec3.transformMat3(Q,Q,q),r.ab.vec3.scale(Q,Q,this.params.sizeMultiplier);const ce=[1,0,0];r.ab.vec3.transformMat3(ce,ce,q),r.ab.vec3.scale(ce,ce,this.params.sizeMultiplier);const ae=(de=Q,pe=ce,Te=d,{u_matrix:Float32Array.from(j),u_up:de,u_right:pe,u_intensity_multiplier:Te});var de,pe,Te;t.uploadCommonUniforms(y,I),this.starsVx&&this.starsIdx&&I.draw(t,b.TRIANGLES,Si.disabled,Oi.disabled,this.colorModeAlphaBlendedWriteRGB,zi.disabled,ae,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function wo(u,t){const n=[...u],d=t.cameraWorldSizeForFog/t.worldSize,y=r.ab.mat4.identity([]);return r.ab.mat4.scale(y,y,[d,d,1]),r.ab.mat4.multiply(n,y,n),r.ab.mat4.multiply(n,t.worldToFogMatrix,n),n}function vu(u,t,n,d,y){const b=n.material,T=d.context,{baseColorTexture:I,metallicRoughnessTexture:F}=b.pbrMetallicRoughness,{normalTexture:V,occlusionTexture:j,emissionTexture:G}=b;function q(ce,ae,de){if(ce&&(u.push(ae),T.activeTexture.set(T.gl.TEXTURE0+de),ce.gfxTexture)){const{minFilter:pe,magFilter:Te,wrapS:ke,wrapT:De}=ce.sampler;ce.gfxTexture.bindExtraParam(pe,Te,ke,De)}}q(I,"HAS_TEXTURE_u_baseColorTexture",Os.BaseColor),q(F,"HAS_TEXTURE_u_metallicRoughnessTexture",Os.MetallicRoughness),q(V,"HAS_TEXTURE_u_normalTexture",Os.Normal),q(j,"HAS_TEXTURE_u_occlusionTexture",Os.Occlusion),q(G,"HAS_TEXTURE_u_emissionTexture",Os.Emission),y&&(y.texture||(y.texture=new r.dk(d.context,y.image,[y.image.height,y.image.height,y.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+Os.LUT),y.texture&&y.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),u.push("APPLY_LUT_ON_GPU")),n.texcoordBuffer&&(u.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(n.texcoordBuffer)),n.colorBuffer&&(u.push(n.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(n.colorBuffer)),n.normalBuffer&&(u.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(n.normalBuffer)),n.pbrBuffer&&(u.push("HAS_ATTRIBUTE_a_pbr"),u.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(n.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||u.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||u.push("DIFFUSE_SHADED");const Q=d.shadowRenderer;Q&&(u.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Q.useNormalOffset&&u.push("NORMAL_OFFSET"))}function tn(u,t,n,d,y,b){const T=n.paint.get("model-opacity").constantOr(1),I=t.context,F=new Si(t.context.gl.LEQUAL,Si.ReadWrite,t.depthRangeFor3D),V=t.transform,j=u.mesh,G=j.material,q=G.pbrMetallicRoughness,Q=t.style.fog;let ce;ce=t.transform.projection.zAxisUnit==="pixels"?[...u.nodeModelMatrix]:r.ab.mat4.multiply([],d.zScaleMatrix,u.nodeModelMatrix),r.ab.mat4.multiply(ce,d.negCameraPosMatrix,ce);const ae=r.ab.mat4.invert([],ce);r.ab.mat4.transpose(ae,ae);const de=n.paint.get("model-color-use-theme").constantOr("default")==="none",pe=n.paint.get("model-emissive-strength").constantOr(0),Te=Jo(new Float32Array(u.worldViewProjection),new Float32Array(ce),new Float32Array(ae),null,t,T,q.baseColorFactor.toRenderColor(null),G.emissiveFactor,q.metallicFactor,q.roughnessFactor,G,pe,n),ke={defines:[]},De=[],Ue=t.shadowRenderer;Ue&&(Ue.useNormalOffset=!1),vu(ke.defines,De,j,t,de?null:n.lut);let Le=null;if(Q){const We=wo(u.nodeModelMatrix,t.transform);if(Le=new Float32Array(We),V.projection.name!=="globe"){const Qe=j.aabb.min,xt=j.aabb.max,[ut,Dt]=Q.getOpacityForBounds(We,Qe[0],Qe[1],xt[0],xt[1]);ke.overrideFog=ut>=je||Dt>=je}}const Ne=bl(t,n.paint.get("model-cutoff-fade-range"));Ne.shouldRenderCutoff&&ke.defines.push("RENDER_CUTOFF");const Oe=t.getOrCreateProgram("model",ke);t.uploadCommonUniforms(I,Oe,null,Le,Ne),t.renderPass!=="shadow"&&Ue&&Ue.setupShadowsFromMatrix(u.nodeModelMatrix,Oe),Oe.draw(t,I.gl.TRIANGLES,F,y,b,j.material.doubleSided?zi.disabled:zi.backCCW,Te,n.id,j.vertexBuffer,j.indexBuffer,j.segments,n.paint,t.transform.zoom,void 0,De)}function dd(u,t,n,d,y,b,T){let I;I=u.projection.name==="globe"?r.dl(n,u):[...n],r.ab.mat4.multiply(I,I,t.matrix);const F=r.ab.mat4.multiply([],d,I);if(t.meshes)for(const V of t.meshes){if(V.material.alphaMode!=="BLEND"){T.push({mesh:V,depth:0,modelIndex:y,worldViewProjection:F,nodeModelMatrix:I});continue}const j=r.ab.vec3.transformMat4([],V.centroid,F);!u.isOrthographic&&j[2]<=0||b.push({mesh:V,depth:j[2],modelIndex:y,worldViewProjection:F,nodeModelMatrix:I})}if(t.children)for(const V of t.children)dd(u,V,n,d,y,b,T)}function xu(u,t,n,d){const y=n.shadowRenderer;if(!y)return;const b=y.getShadowPassDepthMode(),T=y.getShadowPassColorMode(),I=y.calculateShadowPassMatrixFromMatrix(t),F=cd(I);n.getOrCreateProgram("modelDepth",{defines:n._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,b,Oi.disabled,T,zi.backCCW,F,d.id,u.vertexBuffer,u.indexBuffer,u.segments,d.paint,n.transform.zoom,void 0,void 0)}function ha(u,t,n){const d=t.updateZoomBasedPaintProperties(),y=function(b,T,I){let F,V,j,G=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&G>0){const q=b.terrain,Q=q.findDEMTileFor(I);Q&&Q.dem?F=r.dn.create(q,I,Q):G=0}if(G===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),G===T.validForExaggeration&&(G===0||F&&F._demTile&&F._demTile.tileID===T.validForDEMTile.id&&F._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const q in T.instancesPerModel){const Q=T.instancesPerModel[q];for(let ce=0;ce<Q.instancedDataArray.length;++ce){const ae=(F?G*F.getElevationAt(0|Q.instancedDataArray.float32[16*ce],0|Q.instancedDataArray.float32[16*ce+1],!0,!0):0)+Q.instancesEvaluatedElevation[ce];Q.instancedDataArray.float32[16*ce+6]=ae,V=V?Math.min(T.terrainElevationMin,ae):ae,j=j?Math.max(T.terrainElevationMax,ae):ae}}return T.terrainElevationMin=V||0,T.terrainElevationMax=j||0,T.validForExaggeration=G,T.validForDEMTile=F&&F._demTile?{id:F._demTile.tileID,timestamp:F._dem._timestamp}:{id:void 0,timestamp:0},!0}(u,t,n);(d||y)&&(t.uploaded=!1,t.upload(u.context))}const Rs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.cd([0,0,0],[r.ag,r.ag,0])};function ls(u,t){const n=1<<u.canonical.z,d=t.getFreeCameraOptions().position,y=t.elevation,b=u.canonical.x/n,T=(u.canonical.x+1)/n,I=u.canonical.y/n,F=(u.canonical.y+1)/n;let V=t._centerAltitude;if(y){const Q=y.getMinMaxForTile(u);Q&&Q.max>V&&(V=Q.max)}const j=r.aw(d.x,b,T)-d.x,G=r.aw(d.y,I,F)-d.y,q=r.bH(V,t.center.lat)-d.z;return t._zoomFromMercatorZ(Math.sqrt(j*j+G*G+q*q))}function ph(u,t,n,d,y,b,T){const I=u.context,F=u.renderPass==="shadow",V=u.shadowRenderer,j=F&&V?V.getShadowPassDepthMode():new Si(I.gl.LEQUAL,Si.ReadWrite,u.depthRangeFor3D),G=u.isTileAffectedByFog(b);if(n.meshes)for(const q of n.meshes){const Q=["MODEL_POSITION_ON_GPU"],ce=[];let ae,de,pe;d.instancedDataArray.length>20&&Q.push("INSTANCED_ARRAYS");const Te=bl(u,t.paint.get("model-cutoff-fade-range"));if(Te.shouldRenderCutoff&&Q.push("RENDER_CUTOFF"),F&&V)ae=u.getOrCreateProgram("modelDepth",{defines:Q}),de=cd(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(n.matrix)),pe=V.getShadowPassColorMode();else{vu(Q,ce,q,u,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),ae=u.getOrCreateProgram("model",{defines:Q,overrideFog:G});const De=q.material,Ue=De.pbrMetallicRoughness,Le=t.paint.get("model-opacity").constantOr(1),Ne=t.paint.get("model-emissive-strength").constantOr(0);de=Jo(b.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),null,u,Le,Ue.baseColorFactor.toRenderColor(null),De.emissiveFactor,Ue.metallicFactor,Ue.roughnessFactor,De,Ne,t,y),V&&(T.shadowUniformsInitialized?ae.setShadowUniformValues(I,V.getShadowUniformValues()):(V.setupShadows(b.toUnwrapped(),ae,"model-tile",b.overscaledZ),T.shadowUniformsInitialized=!0)),pe=Te.shouldRenderCutoff||Le<1||De.alphaMode!=="OPAQUE"?Xi.alphaBlended:Xi.unblended}u.uploadCommonUniforms(I,ae,b.toUnwrapped(),null,Te);const ke=q.material.doubleSided?zi.disabled:zi.backCCW;if(d.instancedDataArray.length>20)ce.push(d.instancedDataBuffer),ae.draw(u,I.gl.TRIANGLES,j,Oi.disabled,pe,ke,de,t.id,q.vertexBuffer,q.indexBuffer,q.segments,t.paint,u.transform.zoom,void 0,ce,d.instancedDataArray.length);else{const De=F?"u_instance":"u_normal_matrix";for(let Ue=0;Ue<d.instancedDataArray.length;++Ue)de[De]=new Float32Array(d.instancedDataArray.arrayBuffer,64*Ue,16),ae.draw(u,I.gl.TRIANGLES,j,Oi.disabled,pe,ke,de,t.id,q.vertexBuffer,q.indexBuffer,q.segments,t.paint,u.transform.zoom,void 0,ce)}}if(n.children)for(const q of n.children)ph(u,t,q,d,y,b,T)}const Il=[1,-1,1];function fh(u,t,n,d){if(!n.modelManager)return!0;const y=n.modelManager;if(!n.shadowRenderer)return!0;const b=n.shadowRenderer,T=t.aabb;let I=!0,F=u.maxHeight;if(F===0){let j=0;for(const G in u.instancesPerModel){const q=y.getModel(G,d);q?j=Math.max(j,Math.max(Math.max(q.aabb.max[0],q.aabb.max[1]),q.aabb.max[2])):I=!1}F=u.maxScale*j*1.41+u.maxVerticalOffset,I&&(u.maxHeight=F)}T.max[2]=F,T.min[2]+=u.terrainElevationMin,T.max[2]+=u.terrainElevationMax,r.ab.vec3.transformMat4(T.min,T.min,t.tileMatrix),r.ab.vec3.transformMat4(T.max,T.max,t.tileMatrix);const V=T.intersects(b.getCurrentCascadeFrustum());return n.currentShadowCascade===0&&(u.isInsideFirstShadowMapFrustum=V===2),V===0}function ln(u,t){const n=u.uniformValues.u_cutoff_params[0],d=u.uniformValues.u_cutoff_params[1],y=u.uniformValues.u_cutoff_params[2],b=u.uniformValues.u_cutoff_params[3];return d===n||b===y?1:r.aw(((t-n)/(d-n)-y)/(b-y),0,1)}function wp(u,t,n,d){if(t.pitch<20)return 1;const y=t.getWorldToCameraMatrix();r.ab.mat4.multiply(y,y,u);const b=r.ab.vec4.fromValues(n.min[0],n.min[1],n.min[2],1);let T=r.ab.vec4.transformMat4(r.ab.vec4.create(),b,y),I=T,F=T;b[1]=n.max[1],T=r.ab.vec4.transformMat4(r.ab.vec4.create(),b,y),I=T[1]<I[1]?T:I,F=T[1]>F[1]?T:F,b[0]=n.max[0],T=r.ab.vec4.transformMat4(r.ab.vec4.create(),b,y),I=T[1]<I[1]?T:I,F=T[1]>F[1]?T:F,b[1]=n.min[1],T=r.ab.vec4.transformMat4(r.ab.vec4.create(),b,y),I=T[1]<I[1]?T:I,F=T[1]>F[1]?T:F;const V=r.aw(d[0],0,1),j=100*t.pixelsPerMeter*r.aw(d[1],0,1),G=r.aw(d[2],0,1),q=r.ab.vec4.lerp(r.ab.vec4.create(),I,F,V),Q=Math.tan(.5*t.fovX),ce=-q[2]*Q;if(j===0)return q[1]<-Math.abs(ce)?G:1;const ae=(-Math.abs(ce)-q[1])/j,de=(Te,ke,De)=>(1-De)*Te+De*ke,pe=r.aw(de(1,G,ae),G,1);return de(1,pe,r.aw((t.pitch-20)/20,0,1))}class Ja{}class kl{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,n,d){{const G=this._storage.get(n.id);if(G)return G.lastUsedFrameIdx=t,G.buf}const y=d.gl,b=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),T=new ArrayBuffer(b),I=new Int16Array(T);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const F=new r.dq;for(let G=0;G<b/2;G+=3){const q=I[G],Q=I[G+1],ce=I[G+2];F.emplaceBack(q,Q),F.emplaceBack(Q,ce),F.emplaceBack(ce,q)}const V=d.bindVertexArrayOES.current,j=new Ja;return j.buf=new Na(d,F),j.lastUsedFrameIdx=t,this._storage.set(n.id,j),d.bindVertexArrayOES.set(V),j.buf}update(t){for(const[n,d]of this._storage)t-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(n))}destroy(){for(const[t,n]of this._storage)n.buf.destroy(),this._storage.delete(t)}}class eo{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Sp=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Tp{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class gs{constructor(t,n){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...n,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...n,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Mp=r.da([{type:"Float32",name:"a_pos_2f",components:2}]);class pd{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,n){const d=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new r.dr,I=new r.aU;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(T,Mp.members),this.vignetteIdx=t.context.createIndexBuffer(I)}const y=r.b7.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,d);const T={u_vignetteShape:(b={vignetteShape:[n.start,n.range,Math.pow(10,n.fadePower)],vignetteColor:[n.color.r,n.color.g,n.color.b,n.color.a*n.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};d.draw(t,t.context.gl.TRIANGLES,Si.disabled,Oi.disabled,Xi.alphaBlended,zi.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,y,{})}var b}}class mh{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,n){const d=t.getFreeCameraOptions().position,y=d.toAltitude(),b=d.toLngLat(),T=r.ai(b.lng),I=r.ai(b.lat),F=t.pixelsPerMeter/n,V=T*r.ds,j=r.ds*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const G=-this._offsetYPrev+j,q=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+V)*F,this._accumulatedOffsetY+=G*F,this._accumulatedElevation+=q*F,this._offsetXPrev=V,this._offsetYPrev=j,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Ol(u,t){return[-(u[0]-Math.floor(u[0]/t)*t),-(u[1]-Math.floor(u[1]/t)*t),-(u[2]-Math.floor(u[2]/t)*t)]}function xc(u){const t=r.di(1323123451230),n=[];for(let d=0;d<u;++d){const y=2*t()-1,b=2*t()-1,T=2*t()-1;n.push(r.ab.vec3.fromValues(y,b,T))}return n}function Ua(u,t,n,d,y){const b=r.aw((y-n)/(d-n),0,1);return(1-b)*u+b*t}class fd{constructor(t){this._movement=new mh,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new pd,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,n){const d=t.transform;this._movement.update(d,this._ppmScaleFactor);const y=d.starsProjMatrix,b=r.ab.quat.identity([]);r.ab.quat.rotateX(b,b,r.ai(90)-d._pitch),r.ab.quat.rotateZ(b,b,-d.angle);const T=r.ab.mat4.fromQuat(new Float32Array(16),b),I=r.ab.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),F=r.ab.mat4.transpose([],I),V=r.ab.mat4.multiply([],F,T),j=Date.now()/1e3;return this._accumulatedTimeFromStart+=(j-this._prevTime)*n,this._prevTime=j,{projectionMatrix:y,modelviewMatrix:V}}}class Ll extends fd{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new gs(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const d=xc(this.particlesCount),y=new r.dt,b=new r.aU;let T=0;const I=r.di(1323123451230);for(let F=0;F<d.length;++F){const V=d[F],j=[2*I()-1,I(),I(),I()];y.emplaceBack(V[0],V[1],V[2],-1,-1,...j),y.emplaceBack(V[0],V[1],V[2],1,-1,...j),y.emplaceBack(V[0],V[1],V[2],1,1,...j),y.emplaceBack(V[0],V[1],V[2],-1,1,...j),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=n.createVertexBuffer(y,Sp.members),this.particlesIdx=n.createIndexBuffer(b)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const n=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},d=t.transform.zoom;if(n.revealStart>d)return;const y=Ua(0,1,n.revealStart,n.revealStart+n.revealRange,d);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let T=[-b.direction.x,b.direction.y,-100];r.ab.vec3.normalize(T,T);const I=structuredClone(this._vignetteParams);I.strength*=y,b.overrideStyleParameters||(b.intensity=t.style.rain.state.density,b.timeFactor=t.style.rain.state.intensity,b.color=structuredClone(t.style.rain.state.color),T=structuredClone(t.style.rain.state.direction),b.screenThinning.intensity=t.style.rain.state.centerThinning,b.dropletSizeX=t.style.rain.state.dropletSize[0],b.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],b.distortionStrength=100*t.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(t.style.rain.state.vignetteColor));const F=this.updateOnRender(t,b.timeFactor),V=t.context,j=V.gl,G=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new r.T(V,{width:t.width,height:t.height,data:null},j.RGBA8)),b.distortionStrength>0&&(V.activeTexture.set(j.TEXTURE0),this.screenTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),j.copyTexSubImage2D(j.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const q=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(V,q),V.activeTexture.set(j.TEXTURE0),this.screenTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const Q=[b.color.r,b.color.g,b.color.b,b.color.a],ce=(ae,de)=>{const pe=Ol(this._movement.getPosition(),ae),Te=b.dropletSizeX,ke=b.dropletSizeX*b.dropletSizeYScale,De=t.width/2,Ue=t.height/2,Le=Ua(0,b.screenThinning.start,0,1,b.screenThinning.intensity),Ne=Ua(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),Oe=Ua(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),We=(Qe={modelview:F.modelviewMatrix,projection:F.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:pe,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:ae,rainDropletSize:[Te,ke],distortionStrength:b.distortionStrength,rainDirection:T,color:Q,screenSize:[G.width,G.height],thinningCenterPos:[De,Ue],thinningShape:[Le,Ne,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:Oe,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:de?0:1},{u_modelview:Float32Array.from(Qe.modelview),u_projection:Float32Array.from(Qe.projection),u_time:Qe.time,u_cam_pos:Qe.camPos,u_texScreen:0,u_velocityConeAperture:Qe.velocityConeAperture,u_velocity:Qe.velocity,u_boxSize:Qe.boxSize,u_rainDropletSize:Qe.rainDropletSize,u_distortionStrength:Qe.distortionStrength,u_rainDirection:Qe.rainDirection,u_color:Qe.color,u_screenSize:Qe.screenSize,u_thinningCenterPos:Qe.thinningCenterPos,u_thinningShape:Qe.thinningShape,u_thinningAffectedRatio:Qe.thinningAffectedRatio,u_thinningParticleOffset:Qe.thinningParticleOffset,u_shapeDirectionalPower:Qe.shapeDirectionalPower,u_shapeNormalPower:Qe.shapeNormalPower,u_mode:Qe.mode});var Qe;const xt=Math.round(b.intensity*this.particlesCount),ut=r.b7.simpleSegment(0,0,4*xt,2*xt);q.draw(t,j.TRIANGLES,Si.disabled,Oi.disabled,Xi.alphaBlended,zi.disabled,We,"rain_particles",this.particlesVx,this.particlesIdx,ut,{})};b.distortionStrength>0&&ce(b.boxSize,!0),ce(b.boxSize,!1),this._vignette.draw(t,I)}}const Cp=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Ep extends fd{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new gs(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const d=xc(this.particlesCount),y=new r.du,b=new r.aU;let T=0;const I=r.di(1323123451230);for(let F=0;F<d.length;++F){const V=d[F],j=I(),G=I(),q=I(),Q=[F/d.length,j,G,q],ce=[I(),I()];y.emplaceBack(V[0],V[1],V[2],-1,-1,...Q,...ce),y.emplaceBack(V[0],V[1],V[2],1,-1,...Q,...ce),y.emplaceBack(V[0],V[1],V[2],1,1,...Q,...ce),y.emplaceBack(V[0],V[1],V[2],-1,1,...Q,...ce),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=n.createVertexBuffer(y,Cp.members),this.particlesIdx=n.createIndexBuffer(b)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const n=structuredClone(this._params);let d=[-n.direction.x,n.direction.y,-100];r.ab.vec3.normalize(d,d);const y=structuredClone(this._vignetteParams),b=n.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=t.transform.zoom;if(b.revealStart>T)return;const I=Ua(0,1,b.revealStart,b.revealStart+b.revealRange,T);y.strength*=I,n.overrideStyleParameters||(n.intensity=t.style.snow.state.density,n.timeFactor=t.style.snow.state.intensity,n.color=structuredClone(t.style.snow.state.color),d=structuredClone(t.style.snow.state.direction),n.screenThinning.intensity=t.style.snow.state.centerThinning,n.billboardSize=2.79*t.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(t.style.snow.state.vignetteColor));const F=this.updateOnRender(t,n.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const V=t.context,j=V.gl,G=t.transform,q=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(V,q),((Q,ce,ae)=>{const de=Ol(this._movement.getPosition(),Q),pe=G.width/2,Te=G.height/2,ke=Ua(0,ae.screenThinning.start,0,1,ae.screenThinning.intensity),De=Ua(.001,ae.screenThinning.range,0,1,ae.screenThinning.intensity),Ue=Ua(0,ae.screenThinning.particleOffset,0,1,ae.screenThinning.intensity),Le=(Ne={modelview:F.modelviewMatrix,projection:F.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:de,velocityConeAperture:ae.velocityConeAperture,velocity:ae.velocity,horizontalOscillationRadius:ae.horizontalOscillationRadius,horizontalOscillationRate:ae.horizontalOscillationRate,boxSize:Q,billboardSize:1*ae.billboardSize,simpleShapeParameters:[ae.shapeFadeStart,ae.shapeFadePower],screenSize:[G.width,G.height],thinningCenterPos:[pe,Te],thinningShape:[ke,De,Math.pow(10,ae.screenThinning.fadePower)],thinningAffectedRatio:ae.screenThinning.affectedRatio,thinningParticleOffset:Ue,color:[ae.color.r,ae.color.g,ae.color.b,ae.color.a],direction:d},{u_modelview:Float32Array.from(Ne.modelview),u_projection:Float32Array.from(Ne.projection),u_time:Ne.time,u_cam_pos:Ne.camPos,u_velocityConeAperture:Ne.velocityConeAperture,u_velocity:Ne.velocity,u_horizontalOscillationRadius:Ne.horizontalOscillationRadius,u_horizontalOscillationRate:Ne.horizontalOscillationRate,u_boxSize:Ne.boxSize,u_billboardSize:Ne.billboardSize,u_simpleShapeParameters:Ne.simpleShapeParameters,u_screenSize:Ne.screenSize,u_thinningCenterPos:Ne.thinningCenterPos,u_thinningShape:Ne.thinningShape,u_thinningAffectedRatio:Ne.thinningAffectedRatio,u_thinningParticleOffset:Ne.thinningParticleOffset,u_particleColor:Ne.color,u_direction:Ne.direction});var Ne;const Oe=Math.round(ae.intensity*this.particlesCount),We=r.b7.simpleSegment(0,0,4*Oe,2*Oe);this.particlesVx&&this.particlesIdx&&q.draw(t,j.TRIANGLES,Si.disabled,Oi.disabled,Xi.alphaBlended,zi.disabled,Le,"snow_particles",this.particlesVx,this.particlesIdx,We,{})})(n.boxSize,0,n),this._vignette.draw(t,y)}}const Fo={symbol:function(u,t,n,d,y){if(u.renderPass!=="translucent")return;const b=Oi.disabled,T=u.colorModeForRenderPass(),I=n.layout.get("text-variable-anchor"),F=n.layout.get("text-size-scale-range"),V=r.aw(u.scaleFactor,F[0],F[1]);I&&function(q,Q,ce,ae,de,pe,Te,ke){const De=Q.transform,Ue=de==="map",Le=pe==="map";for(const Ne of q){const Oe=ae.getTile(Ne),We=Oe.getBucket(ce);if(!We||!We.text||!We.text.segments.get().length)continue;const Qe=r.bp(We.textSizeData,De.zoom,ke),xt=Ga(Ne,We.getProjection(),De),ut=De.calculatePixelsToTileUnitsMatrix(Oe),Dt=bs(xt,Oe.tileID.canonical,Le,Ue,De,We.getProjection(),ut),At=We.hasIconTextFit()&&We.hasIconData();if(Qe){const ot=Math.pow(2,De.zoom-Oe.tileID.overscaledZ);ud(We,Ue,Le,Te,r.cX,De,Dt,Ne,ot,Qe,At)}}}(d,u,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),y,V);const j=n.paint.get("icon-opacity").constantOr(1)!==0,G=n.paint.get("text-opacity").constantOr(1)!==0;n.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(j||G)?ch(u,t,n,d,b,T):(j&&ch(u,t,n,d,b,T,{onlyIcons:!0}),G&&ch(u,t,n,d,b,T,{onlyText:!0})),t.map.showCollisionBoxes&&(lh(u,t,n,d,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),lh(u,t,n,d,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(u,t,n,d){if(u.renderPass!=="translucent")return;const y=n.paint.get("circle-opacity"),b=n.paint.get("circle-stroke-width"),T=n.paint.get("circle-stroke-opacity"),I=n.layout.get("circle-sort-key").constantOr(1)!==void 0,F=n.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(b.constantOr(1)===0||T.constantOr(1)===0))return;const V=u.context,j=V.gl,G=u.transform,q=u.depthModeForSublayer(0,Si.ReadOnly),Q=Oi.disabled,ce=u.colorModeForDrapableLayerRenderPass(F),ae=G.projection.name==="globe",de=[r.at(G.center.lng),r.aA(G.center.lat)],pe=[];for(let ke=0;ke<d.length;ke++){const De=d[ke],Ue=t.getTile(De),Le=Ue.getBucket(n);if(!Le||Le.projection.name!==G.projection.name)continue;const Ne=Le.programConfigurations.get(n.id),Oe=r.cY(n),We=u.isTileAffectedByFog(De);ae&&Oe.push("PROJECTION_GLOBE_VIEW"),Oe.push("DEPTH_D24"),u.terrain&&G.depthOcclusionForSymbolsAndCircles&&Oe.push("DEPTH_OCCLUSION");const Qe=u.getOrCreateProgram("circle",{config:Ne,defines:Oe,overrideFog:We}),xt=Le.layoutVertexBuffer,ut=Le.globeExtVertexBuffer,Dt=Le.indexBuffer,At=G.projection.createInversionMatrix(G,De.canonical),ot={programConfiguration:Ne,program:Qe,layoutVertexBuffer:xt,globeExtVertexBuffer:ut,indexBuffer:Dt,uniformValues:r.cZ(u,De,Ue,At,de,n),tile:Ue};if(I){const wt=Le.segments.get();for(const Vt of wt)pe.push({segments:new r.b7([Vt]),sortKey:Vt.sortKey,state:ot})}else pe.push({segments:Le.segments,sortKey:0,state:ot})}I&&pe.sort((ke,De)=>ke.sortKey-De.sortKey);const Te={useDepthForOcclusion:G.depthOcclusionForSymbolsAndCircles};for(const ke of pe){const{programConfiguration:De,program:Ue,layoutVertexBuffer:Le,globeExtVertexBuffer:Ne,indexBuffer:Oe,uniformValues:We,tile:Qe}=ke.state,xt=ke.segments;u.terrain&&u.terrain.setupElevationDraw(Qe,Ue,Te),u.uploadCommonUniforms(V,Ue,Qe.tileID.toUnwrapped()),Ue.draw(u,j.TRIANGLES,q,Q,ce,zi.disabled,We,n.id,Le,Oe,xt,n.paint,G.zoom,De,[Ne])}},heatmap:function(u,t,n,d){if(n.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const y=u.context,b=y.gl,T=Oi.disabled,I=new Xi([b.ONE,b.ONE,b.ONE,b.ONE],r.aj.transparent,[!0,!0,!0,!0]);(function(Q,ce,ae,de){const pe=Q.gl,Te=ce.width*de,ke=ce.height*de;Q.activeTexture.set(pe.TEXTURE1),Q.viewport.set([0,0,Te,ke]);let De=ae.heatmapFbo;if(!De||De&&(De.width!==Te||De.height!==ke)){De&&De.destroy();const Ue=pe.createTexture();pe.bindTexture(pe.TEXTURE_2D,Ue),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_WRAP_S,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_WRAP_T,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_MIN_FILTER,pe.LINEAR),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_MAG_FILTER,pe.LINEAR),De=ae.heatmapFbo=Q.createFramebuffer(Te,ke,!0,null),function(Le,Ne,Oe,We,Qe,xt){const ut=Le.gl;ut.texImage2D(ut.TEXTURE_2D,0,Le.extRenderToTextureHalfFloat?ut.RGBA16F:ut.RGBA,Qe,xt,0,ut.RGBA,Le.extRenderToTextureHalfFloat?ut.HALF_FLOAT:ut.UNSIGNED_BYTE,null),We.colorAttachment.set(Oe)}(Q,0,Ue,De,Te,ke)}else pe.bindTexture(pe.TEXTURE_2D,De.colorAttachment.get()),Q.bindFramebuffer.set(De.framebuffer)})(y,u,n,u.transform.projection.name==="globe"?.5:.25),y.clear({color:r.aj.transparent});const F=u.transform,V=F.projection.name==="globe",j=V?["PROJECTION_GLOBE_VIEW"]:[],G=V?zi.frontCCW:zi.disabled,q=[r.at(F.center.lng),r.aA(F.center.lat)];for(let Q=0;Q<d.length;Q++){const ce=d[Q];if(t.hasRenderableParent(ce))continue;const ae=t.getTile(ce),de=ae.getBucket(n);if(!de||de.projection.name!==F.projection.name)continue;const pe=u.isTileAffectedByFog(ce),Te=de.programConfigurations.get(n.id),ke=u.getOrCreateProgram("heatmap",{config:Te,defines:j,overrideFog:pe}),{zoom:De}=u.transform;u.terrain&&u.terrain.setupElevationDraw(ae,ke),u.uploadCommonUniforms(y,ke,ce.toUnwrapped());const Ue=F.projection.createInversionMatrix(F,ce.canonical);ke.draw(u,b.TRIANGLES,Si.disabled,T,I,G,_i(u,ce,ae,Ue,q,De,n.paint.get("heatmap-intensity")),n.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,n.paint,u.transform.zoom,Te,V?[de.globeExtVertexBuffer]:null)}y.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(y,b){const T=y.context,I=T.gl,F=b.heatmapFbo;if(!F)return;T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,F.colorAttachment.get()),T.activeTexture.set(I.TEXTURE1);let V=b.colorRampTexture;V||(V=b.colorRampTexture=new r.T(T,b.colorRamp,I.RGBA8)),V.bind(I.LINEAR,I.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,I.TRIANGLES,Si.disabled,Oi.disabled,y.colorModeForRenderPass(),zi.disabled,((j,G,q,Q)=>({u_image:0,u_color_ramp:1,u_opacity:G.paint.get("heatmap-opacity")}))(0,b),b.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,b.paint,y.transform.zoom)}(u,n))},line:function(u,t,n,d){if(u.renderPass!=="translucent")return;const y=n.paint.get("line-opacity"),b=n.paint.get("line-width");if(y.constantOr(1)===0||b.constantOr(1)===0)return;const T=n.paint.get("line-emissive-strength"),I=n.paint.get("line-occlusion-opacity"),F=n.layout.get("line-elevation-reference"),V=n.layout.get("line-width-unit")==="meters",j=F==="sea",G=u.context,q=G.gl;if(n.hasElevatedBuckets&&u.transform.projection.name==="globe")return;const Q=n.layout.get("line-cross-slope"),ce=Q!==void 0,ae=Q<1,de=u.colorModeForDrapableLayerRenderPass(T),pe=u.terrain&&u.terrain.renderingToTexture,Te=pe?1:r.q.devicePixelRatio,ke=n.paint.get("line-dasharray"),De=ke.constantOr(1),Ue=n.layout.get("line-cap"),Le=ke.constantOr(null),Ne=Ue.constantOr(null),Oe=n.paint.get("line-pattern"),We=Oe.constantOr(1),Qe=Oe.constantOr(null),xt=n.paint.get("line-opacity").constantOr(1);let ut=!We&&xt!==1||u.depthOcclusion&&I>0&&I<1;const Dt=n.paint.get("line-gradient"),At=We?"linePattern":"line",ot=r.c_(n);let wt;if(pe&&u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(ut=!1),I!==0&&u.depthOcclusion){const st=n.paint._values["line-opacity"];st&&st.value&&st.value.kind==="constant"?wt=st.value:r.w(`Occlusion opacity for layer ${n.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&ot.push("VARIABLE_LINE_WIDTH");const Vt=(st,It,bt,Kt,Bt)=>{for(const kt of st){const $t=t.getTile(kt);if(We&&!$t.patternsLoaded())continue;const Xt=$t.getBucket(n);if(!Xt||Xt.hasZOffset&&!Bt||!Xt.hasZOffset&&Bt)continue;u.prepareDrawTile();const ci=Xt.programConfigurations.get(n.id),pi=u.isTileAffectedByFog(kt),Fi=u.getOrCreateProgram(At,{config:ci,defines:It,overrideFog:pi,overrideRtt:!Bt&&void 0});if(Qe&&$t.imageAtlas){const $i=r.A.from(Qe).getPrimary().scaleSelf(Te).serialize(),lr=$t.imageAtlas.patternPositions[$i];lr&&ci.setConstantPatternPositions(lr)}if(!We&&Le&&Ne&&$t.lineAtlas){const $i=$t.lineAtlas.getDash(Le,Ne);$i&&ci.setConstantPatternPositions($i)}let[Mi,Ci]=n.paint.get("line-trim-offset");(Ne==="round"||Ne==="square")&&Mi!==Ci&&(Mi===0&&(Mi-=1),Ci===1&&(Ci+=1));const ji=pe?kt.projMatrix:null,pr=V?1/Xt.tileToMeter/r.ar($t,1,u.transform.zoom):1,Er=V?1/Xt.tileToMeter/r.ar($t,1,Math.floor(u.transform.zoom)):1,dn=We?r.c$(u,$t,n,ji,Te,pr,Er,[Mi,Ci]):r.d0(u,$t,n,ji,Xt.lineClipsArray.length,Te,pr,Er,[Mi,Ci]);if(Dt){const $i=Xt.gradients[n.id];let lr=$i.texture;if(n.gradientVersion!==$i.version){let bi=256;if(n.stepInterpolant){const or=t.getSource().maxzoom,Ir=kt.canonical.z===or?Math.ceil(1<<u.transform.maxZoom-kt.canonical.z):1;bi=r.aw(r.d1(Xt.maxLineLength/r.ag*1024*Ir),256,G.maxTextureSize)}$i.gradient=r.d2({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:bi,image:$i.gradient||void 0,clips:Xt.lineClipsArray}),$i.texture?$i.texture.update($i.gradient):$i.texture=new r.T(G,$i.gradient,q.RGBA8),$i.version=n.gradientVersion,lr=$i.texture}G.activeTexture.set(q.TEXTURE1),lr.bind(n.stepInterpolant?q.NEAREST:q.LINEAR,q.CLAMP_TO_EDGE)}De&&(G.activeTexture.set(q.TEXTURE0),$t.lineAtlasTexture&&$t.lineAtlasTexture.bind(q.LINEAR,q.REPEAT),ci.updatePaintBuffers()),We&&(G.activeTexture.set(q.TEXTURE0),$t.imageAtlasTexture&&$t.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),ci.updatePaintBuffers()),Bt&&!j&&u.terrain.setupElevationDraw($t,Fi),u.uploadCommonUniforms(G,Fi,kt.toUnwrapped());const $r=$i=>{wt!=null&&(wt.value=xt*I),Fi.draw(u,q.TRIANGLES,bt,$i,de,zi.disabled,dn,n.id,Xt.layoutVertexBuffer,Xt.indexBuffer,Xt.segments,n.paint,u.transform.zoom,ci,[Xt.layoutVertexBuffer2,Xt.patternVertexBuffer,Xt.zOffsetVertexBuffer]),wt!=null&&(wt.value=xt)};if(ut&&!Bt){const $i=u.stencilModeForClipping(kt).ref;$i===0&&pe&&G.clear({stencil:0});const lr={func:q.EQUAL,mask:255};dn.u_alpha_discard_threshold=.8,$r(new Oi(lr,$i,255,q.KEEP,q.KEEP,q.INVERT)),dn.u_alpha_discard_threshold=0,$r(new Oi(lr,$i,255,q.KEEP,q.KEEP,q.KEEP))}else ut&&Bt&&(dn.u_alpha_discard_threshold=.001),$r(Bt?Kt:u.stencilModeForClipping(kt))}};if(n.hasNonElevatedBuckets){const st=!pe&&u.terrain;I!==0&&st?r.w(`Occlusion opacity for layer ${n.id} is supported on terrain only if the layer has line-z-offset enabled.`):st?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${n.id}.`):Vt(d,ot,u.depthModeForSublayer(0,Si.ReadOnly),Oi.disabled,!1)}if(n.hasElevatedBuckets){ot.push("ELEVATED"),ce&&ot.push(ae?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),j&&ot.push("ELEVATION_REFERENCE_SEA");const st=ut?u.stencilModeFor3D():Oi.disabled,It=new Si(u.depthOcclusion?q.GREATER:q.LEQUAL,Si.ReadOnly,u.depthRangeFor3D);u.forceTerrainMode=!0,Vt(d,ot,It,st,!0),u.forceTerrainMode=!1}ut&&(u.resetStencilClippingMasks(),pe&&G.clear({stencil:0})),I===0||u.depthOcclusion||pe||u.layersWithOcclusionOpacity.push(u.currentLayer)},fill:function(u,t,n,d){const y=n.paint.get("fill-color"),b=n.paint.get("fill-opacity"),T=n.is3D(),I=new Si(u.context.gl.LEQUAL,Si.ReadWrite,u.depthRangeFor3D);if(b.constantOr(1)===0)return;const F=n.paint.get("fill-emissive-strength"),V=u.colorModeForDrapableLayerRenderPass(F),j=n.paint.get("fill-pattern"),G=u.opaquePassEnabledForLayer()&&!j.constantOr(1)&&y.constantOr(r.aj.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===G){const q=T?I:u.depthModeForSublayer(1,u.renderPass==="opaque"?Si.ReadWrite:Si.ReadOnly);_p(u,t,n,d,q,V,!1)}if(!T&&u.renderPass==="translucent"&&n.paint.get("fill-antialias")){const q=T?I:u.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,Si.ReadOnly);_p(u,t,n,d,q,V,!0)}},"fill-extrusion":function(u,t,n,d){const y=n.paint.get("fill-extrusion-opacity"),b=u.context,T=b.gl,I=u.terrain,F=I&&I.renderingToTexture;if(y===0)return;const V=u.conflationActive&&u.style.isLayerClipped(n,t.getSource()),j=u.style.order.indexOf(n.fqid);if(V&&function(G,q,Q,ce,ae){for(const de of ce){const pe=q.getTile(de).getBucket(Q);pe&&(pe.updateReplacement(de,G.replacementSource,ae),pe.uploadCentroid(G.context))}}(u,t,n,d,j),I||V)for(const G of d){const q=t.getTile(G).getBucket(n);q&&_c(u.context,t,G,q,n,I,V)}if(u.renderPass==="shadow"&&u.shadowRenderer){const G=u.shadowRenderer;if(I&&y<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.a9)return;const q=G.getShadowPassDepthMode(),Q=G.getShadowPassColorMode();gu(u,t,n,d,q,Oi.disabled,Q,V)}else if(u.renderPass==="translucent"){const G=!n.paint.get("fill-extrusion-pattern").constantOr(1),q=n.paint.get("fill-extrusion-color").constantOr(r.aj.white);if(!F&&q.a!==0){const Q=new Si(u.context.gl.LEQUAL,Si.ReadWrite,u.depthRangeFor3D);y===1&&G?gu(u,t,n,d,Q,Oi.disabled,Xi.unblended,V):(gu(u,t,n,d,Q,Oi.disabled,Xi.disabled,V),gu(u,t,n,d,Q,u.stencilModeFor3D(),u.colorModeForRenderPass(),V),u.resetStencilClippingMasks())}if(u.style.enable3dLights()&&G&&(!I&&u.transform.projection.name!=="globe"||F)){const Q=n.paint.get("fill-extrusion-opacity"),ce=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),ae=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),de=n.paint.get("fill-extrusion-flood-light-intensity"),pe=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Te=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(pe?null:n.lut).toArray01().slice(0,3),ke=ce>0&&ae>0,De=de>0,Ue=(Ne,Oe,We)=>(1-We)*Ne+We*Oe,Le=Ne=>{const Oe=u.depthModeForSublayer(1,Si.ReadOnly,T.LEQUAL,!0),We=n.paint.get(Ne?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Qe=Ue(.1,3,We),xt=u._showOverdrawInspector;if(!xt){const ut=new Oi({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Dt=new Xi([T.ONE,T.ONE,T.ONE,T.ONE],r.aj.transparent,[!1,!1,!1,!0],T.MIN);Vn(u,t,n,d,Oe,ut,Dt,zi.disabled,Ne,"sdf",Q,ce,ae,de,Te,Qe,V,!1)}{const ut=xt?Oi.disabled:new Oi({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),Dt=xt?u.colorModeForRenderPass():new Xi([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],r.aj.transparent,[!0,!0,!0,!0]);Vn(u,t,n,d,Oe,ut,Dt,zi.disabled,Ne,"color",Q,ce,ae,de,Te,Qe,V,!1)}};if(F){const Ne=(Oe,We,Qe)=>{const xt=u.depthModeForSublayer(1,Si.ReadOnly,T.LEQUAL,!1),ut=n.paint.get(Oe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Dt=Ue(.1,3,ut);{const At=new Xi([T.ONE,T.ONE,T.ONE,T.ONE],r.aj.transparent,[!1,!1,!1,!0]);Vn(u,t,n,d,xt,Oi.disabled,At,zi.disabled,Oe,"clear",Q,ce,ae,de,Te,Dt,V,We)}{const At=new Oi({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),ot=new Xi([T.ONE,T.ONE,T.ONE,T.ONE],r.aj.transparent,[!1,!1,!1,!0],T.MIN);Vn(u,t,n,d,xt,At,ot,zi.disabled,Oe,"sdf",Q,ce,ae,de,Te,Dt,V,We)}{const At=Oe?T.ZERO:T.ONE_MINUS_DST_ALPHA,ot=new Oi({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),wt=new Xi([At,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],r.aj.transparent,[!0,!0,!0,!0]);Vn(u,t,n,d,xt,ot,wt,zi.disabled,Oe,"color",Q,ce,ae,de,Te,Dt,V,We)}{const At=new Xi([T.ONE,T.ONE,T.ONE,Oe?T.ZERO:T.ONE],r.aj.transparent,[!1,!1,!1,!0],Oe?T.FUNC_ADD:T.MAX);Vn(u,t,n,d,xt,Oi.disabled,At,zi.disabled,Oe,"clear",Q,ce,ae,de,Te,Dt,V,We,Qe)}};if(ke||De){let Oe;if(u.prepareDrawTile(),I){const We=I.drapeBufferSize[0],Qe=I.drapeBufferSize[1];Oe=I.framebufferCopyTexture,Oe&&(!Oe||Oe.size[0]===We&&Oe.size[1]===Qe)||(Oe&&Oe.destroy(),Oe=I.framebufferCopyTexture=new r.T(b,new r.r({width:We,height:Qe}),T.RGBA8)),Oe.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,We,Qe)}ke&&Ne(!0,!1,Oe),De&&Ne(!1,!0,Oe)}}else ke&&Le(!0),De&&Le(!1),(ke||De)&&u.resetStencilClippingMasks()}}},hillshade:function(u,t,n,d){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent"||u.style.disableElevatedTerrain)return;const y=u.context,b=u.terrain&&u.terrain.renderingToTexture,[T,I]=u.renderPass!=="translucent"||b?[{},d]:u.stencilConfigForOverlap(d);for(const F of I){const V=t.getTile(F);if(V.needsHillshadePrepare&&u.renderPass==="offscreen")bf(u,V,n);else if(u.renderPass==="translucent"){const j=u.depthModeForSublayer(0,Si.ReadOnly),G=n.paint.get("hillshade-emissive-strength"),q=u.colorModeForDrapableLayerRenderPass(G),Q=b&&u.terrain?u.terrain.stencilModeForRTTOverlap(F):T[F.overscaledZ];th(u,F,V,n,j,Q,q)}}y.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,t,n,d,y,b){if(u.renderPass!=="translucent"||n.paint.get("raster-opacity")===0)return;const T=u.transform.projection.name==="globe",I=n.paint.get("raster-elevation")!==0,F=I&&T;if(u.renderElevatedRasterBackface&&!F)return;const V=u.context,j=V.gl,G=t.getSource(),q=function(Le,Ne,Oe,We){const Qe=Ne.paint.get("raster-color"),xt=Le.type==="raster-array",ut=[],Dt=Ne.paint.get("raster-resampling"),At=Ne.paint.get("raster-color-mix");let ot=Ne.paint.get("raster-color-range");const wt=[At[0],At[1],At[2],0],Vt=At[3];let st=Dt==="nearest"?We.NEAREST:We.LINEAR;if(xt&&(ut.push("RASTER_ARRAY"),Qe||ut.push("RASTER_COLOR"),Dt==="linear"&&ut.push("RASTER_ARRAY_LINEAR"),st=We.NEAREST,!ot&&Le.rasterLayers)){const It=Le.rasterLayers.find(({id:bt})=>bt===Ne.sourceLayer);It&&It.fields&&It.fields.range&&(ot=It.fields.range)}if(ot=ot||[0,1],Qe){ut.push("RASTER_COLOR"),Oe.activeTexture.set(We.TEXTURE2),Ne.updateColorRamp(ot);let It=Ne.colorRampTexture;It||(It=Ne.colorRampTexture=new r.T(Oe,Ne.colorRamp,We.RGBA8)),It.bind(We.LINEAR,We.CLAMP_TO_EDGE)}return{mix:wt,range:ot,offset:Vt,defines:ut,resampling:st}}(G,n,V,j);if(G instanceof r.aJ&&!d.length&&!T)return;const Q=n.paint.get("raster-emissive-strength"),ce=u.colorModeForDrapableLayerRenderPass(Q),ae=u.terrain&&u.terrain.renderingToTexture,de=!u.options.moving,pe=n.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR;if(G instanceof r.aJ&&!d.length&&(G.onNorthPole||G.onSouthPole)){const Le=I?u.stencilModeFor3D():Oi.disabled;return void dt(!!G.onNorthPole,null,u,t,n,Q,q,zi.disabled,Le)}if(!d.length)return;const[Te,ke]=G instanceof r.aJ||ae?[{},d]:u.stencilConfigForOverlap(d),De=ke[ke.length-1].overscaledZ;F&&q.defines.push("PROJECTION_GLOBE_VIEW"),I&&q.defines.push("RENDER_CUTOFF");const Ue=(Le,Ne,Oe)=>{for(const We of Le){const Qe=We.toUnwrapped(),xt=t.getTile(We);if(ae&&(!xt||!xt.hasData()))continue;V.activeTexture.set(j.TEXTURE0);const ut=uh(xt,G,n,q);if(!ut||!ut.texture)continue;const{texture:Dt,mix:At,offset:ot,tileSize:wt,buffer:Vt}=ut;let st,It;ae?(st=Si.disabled,It=We.projMatrix):I?(st=new Si(j.LEQUAL,Si.ReadWrite,u.depthRangeFor3D),It=T?Float32Array.from(u.transform.expandedFarZProjMatrix):u.transform.calculateProjMatrix(Qe,de)):(st=u.depthModeForSublayer(We.overscaledZ-De,n.paint.get("raster-opacity")===1?Si.ReadWrite:Si.ReadOnly,j.LESS),It=u.transform.calculateProjMatrix(Qe,de));const bt=u.terrain&&ae?u.terrain.stencilModeForRTTOverlap(We):Te[We.overscaledZ],Kt=b?0:n.paint.get("raster-fade-duration");xt.registerFadeDuration(Kt);const Bt=t.findLoadedParent(We,0),kt=nh(xt,Bt,t,u.transform,Kt);let $t,Xt;u.terrain&&u.terrain.prepareDrawTile(),V.activeTexture.set(j.TEXTURE0),Dt.bind(pe,j.CLAMP_TO_EDGE),V.activeTexture.set(j.TEXTURE1),Bt?(Bt.texture&&Bt.texture.bind(pe,j.CLAMP_TO_EDGE),$t=Math.pow(2,Bt.tileID.overscaledZ-xt.tileID.overscaledZ),Xt=[xt.tileID.canonical.x*$t%1,xt.tileID.canonical.y*$t%1]):Dt.bind(pe,j.CLAMP_TO_EDGE),Dt.useMipmap&&V.extTextureFilterAnisotropic&&u.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);const ci=u.transform;let pi;const Fi=I?Vf(ci):[0,0,0,0];let Mi,Ci,ji,pr,Er,dn=0;if(F&&G instanceof r.aJ&&G.coordinates.length>3)Mi=Float32Array.from(r.bb(r.cH(new r.bT(0,0,0)))),Ci=Float32Array.from(ci.globeMatrix),ji=Float32Array.from(r.cD(ci)),pr=[r.at(ci.center.lng),r.aA(ci.center.lat)],pi=G.elevatedGlobePerspectiveTransform,Er=G.elevatedGlobeGridMatrix||new Float32Array(9);else if(F){const bi=r.cE(We.canonical);dn=r.cF(bi.getCenter().lat),Mi=Float32Array.from(r.bb(r.cH(We.canonical))),Ci=Float32Array.from(ci.globeMatrix),ji=Float32Array.from(r.cD(ci)),pr=[r.at(ci.center.lng),r.aA(ci.center.lat)],pi=[0,0],Er=Float32Array.from(r.cG(We.canonical,bi,dn,ci.worldSize/ci._pixelsPerMercatorPixel))}else pi=G instanceof r.aJ?G.perspectiveTransform:[0,0],Mi=new Float32Array(16),Ci=new Float32Array(9),ji=new Float32Array(16),pr=[0,0],Er=new Float32Array(9);const $r=Al(It,Mi,Ci,ji,Er,Xt||[0,0],r.ae(u.transform.zoom),pr,Fi,$t||1,kt,n,pi,I?n.paint.get("raster-elevation"):0,2,At,ot,q.range,wt,Vt,Q),$i=u.isTileAffectedByFog(We),lr=u.getOrCreateProgram("raster",{defines:q.defines,overrideFog:$i});if(u.uploadCommonUniforms(V,lr,Qe),G instanceof r.aJ){const bi=G.elevatedGlobeVertexBuffer,or=G.elevatedGlobeIndexBuffer;if(ae||!T)G.boundsBuffer&&G.boundsSegments&&lr.draw(u,j.TRIANGLES,st,Oi.disabled,ce,zi.disabled,$r,n.id,G.boundsBuffer,u.quadTriangleIndexBuffer,G.boundsSegments);else if(bi&&or){const Ir=ci.zoom<=r.c6?G.elevatedGlobeSegments:G.getSegmentsForLongitude(ci.center.lng);Ir&&lr.draw(u,j.TRIANGLES,st,Oi.disabled,ce,Ne,$r,n.id,bi,or,Ir)}}else if(F){st=new Si(j.LEQUAL,Si.ReadOnly,u.depthRangeFor3D);const bi=u.globeSharedBuffers;if(bi){const[or,Ir,Mr]=bi.getGridBuffers(dn,!1);lr.draw(u,j.TRIANGLES,st,Oe||bt,u.colorModeForRenderPass(),Ne,$r,n.id,or,Ir,Mr)}}else{const{tileBoundsBuffer:bi,tileBoundsIndexBuffer:or,tileBoundsSegments:Ir}=u.getTileBoundsBuffers(xt);lr.draw(u,j.TRIANGLES,st,bt,ce,zi.disabled,$r,n.id,bi,or,Ir)}}if(!(G instanceof r.aJ)&&F)for(const We of Le){const Qe=We.canonical.y===(1<<We.canonical.z)-1;We.canonical.y===0&&dt(!0,We,u,t,n,Q,q,Ne,Oe||Oi.disabled),Qe&&dt(!1,We,u,t,n,Q,q,Ne===zi.frontCW?zi.backCW:zi.frontCW,Oe||Oi.disabled)}};F?Ue(ke,u.renderElevatedRasterBackface?zi.backCW:zi.frontCW,u.stencilModeFor3D()):Ue(ke,zi.disabled,void 0),u.resetStencilClippingMasks()},"raster-particle":function(u,t,n,d,y,b){u.renderPass==="offscreen"&&function(T,I,F,V){if(!V.length)return;const j=T.context,G=j.gl,q=I.getSource();if(!(q instanceof is))return;const Q=Math.ceil(Math.sqrt(F.paint.get("raster-particle-count")));let ce=F.particlePositionRGBAImage;if(!ce||ce.width!==Q){const ke=function(De){const Ue=De*De,Le=new Uint8Array(4*Ue),Ne=function(We){return We|=0,We=Math.imul(2747636419^We,2654435769),We=Math.imul(We^We>>>16,2654435769),((We=Math.imul(We^We>>>16,2654435769))>>>0)/4294967296},Oe=1/1.1;for(let We=0;We<Ue;We++){const Qe=Oe*(Ne(2*We+0)+wi),xt=Oe*(Ne(2*We+1)+wi),ut=255*Qe%1,Dt=255*xt%1,At=ut,ot=xt-Dt/255,wt=Dt;Le[4*We+0]=255*(Qe-ut/255),Le[4*We+1]=255*At,Le[4*We+2]=255*ot,Le[4*We+3]=255*wt}return Le}(Q);ce=F.particlePositionRGBAImage=new r.r({width:Q,height:Q},ke)}let ae=F.particleFramebuffer;ae?ae.width!==Q&&(ae.destroy(),ae=F.particleFramebuffer=j.createFramebuffer(Q,Q,!0,null)):ae=F.particleFramebuffer=j.createFramebuffer(Q,Q,!0,null);const de=[];for(const ke of V){const De=I.getTile(ke);if(!(De instanceof aa))continue;const Ue=Uf(De,q,F);if(!Ue)continue;const Le=[De.tileSize,De.tileSize];let Ne=F.tileFramebuffer;Ne||(Ne=F.tileFramebuffer=j.createFramebuffer(Le[0],Le[1],!0,null));let Oe=De.rasterParticleState;Oe||(Oe=De.rasterParticleState=new yp(j,ke,Le,ce));const We=Oe.update(F.lastInvalidatedAt);Oe.particleTextureDimension!==Q&&Oe.updateParticleTexture(ke,ce);const Qe=Oe.targetColorTexture;Oe.targetColorTexture=Oe.backgroundColorTexture,Oe.backgroundColorTexture=Qe;const xt=Oe.particleTexture0;Oe.particleTexture0=Oe.particleTexture1,Oe.particleTexture1=xt,de.push([ke,Ue,Oe,We])}if(de.length===0)return;const pe=r.q.now(),Te=F.previousDrawTimestamp?.001*(pe-F.previousDrawTimestamp):.0167;if(F.previousDrawTimestamp=pe,F.hasColorMap()){j.activeTexture.set(G.TEXTURE0+2);let ke=F.colorRampTexture;ke||(ke=F.colorRampTexture=new r.T(j,F.colorRamp,G.RGBA8)),ke.bind(G.LINEAR,G.CLAMP_TO_EDGE)}j.bindFramebuffer.set(F.tileFramebuffer.framebuffer),function(ke,De,Ue){const Le=ke.context,Ne=Le.gl,Oe=De.tileFramebuffer;Le.activeTexture.set(Ne.TEXTURE0);const We={u_texture:0,u_opacity:1.05*(xt=De.paint.get("raster-particle-fade-opacity-factor"))/(xt+.05)},Qe=ke.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var xt;for(const ut of Ue){const[,,Dt,At]=ut;Oe.colorAttachment.set(Dt.targetColorTexture.texture),Le.viewport.set([0,0,Oe.width,Oe.height]),Le.clear({color:r.aj.transparent}),At&&(Dt.backgroundColorTexture.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE),Qe.draw(ke,Ne.TRIANGLES,Si.disabled,Oi.disabled,Xi.alphaBlended,zi.disabled,We,De.id,ke.viewportBuffer,ke.quadTriangleIndexBuffer,ke.viewportSegments))}}(T,F,de),function(ke,De,Ue,Le){const Ne=ke.context,Oe=Ne.gl,We=Ue.tileFramebuffer,Qe=ke.transform.projection.name==="globe",xt=Ue.paint.get("raster-particle-max-speed");for(const ut of Le){const[Dt,At,ot]=ut;Ne.activeTexture.set(Oe.TEXTURE0+0),At.texture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE),We.colorAttachment.set(ot.targetColorTexture.texture);const wt=ke.getOrCreateProgram("rasterParticleDraw",{defines:At.defines,overrideFog:!1});Ne.activeTexture.set(Oe.TEXTURE0+1);const Vt=At.scalarData?[]:[0,1,2,3].map(bt=>r.d4[bt](Dt));Vt.push(Dt);const st=Dt.canonical.x,It=Dt.canonical.y;for(const bt of Vt){const Kt=De.getTile(Qe?bt.wrapped():bt);if(!Kt)continue;const Bt=Kt.rasterParticleState;if(!Bt)continue;const kt=bt.canonical.x+(1<<bt.canonical.z)*(bt.wrap-Dt.wrap),$t=bt.canonical.y;Bt.particleTexture0.bind(Oe.NEAREST,Oe.CLAMP_TO_EDGE);const Xt=ad(1,Bt.particleTexture0.size[0],[kt-st,$t-It],0,At.texture.size,2,xt,At.textureOffset,At.scale,At.offset);wt.draw(ke,Oe.POINTS,Si.disabled,Oi.disabled,Xi.alphaBlended,zi.disabled,Xt,Ue.id,Bt.particleIndexBuffer,void 0,Bt.particleSegment)}}}(T,I,F,de),j.bindFramebuffer.set(F.particleFramebuffer.framebuffer),function(ke,De,Ue,Le){const Ne=ke.context,Oe=Ne.gl,We=De.paint.get("raster-particle-max-speed"),Qe=Le*De.paint.get("raster-particle-speed-factor")*.15,xt=function(Dt){return Math.pow(Dt,6)}(.01+1*De.paint.get("raster-particle-reset-rate-factor")),ut=De.particleFramebuffer;Ne.viewport.set([0,0,ut.width,ut.height]);for(const Dt of Ue){const[,At,ot]=Dt;Ne.activeTexture.set(Oe.TEXTURE0+0),At.texture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE),Ne.activeTexture.set(Oe.TEXTURE0+1);const wt=ot.particleTexture0;wt.bind(Oe.NEAREST,Oe.CLAMP_TO_EDGE);const Vt=Bf(1,wt.size[0],0,At.texture.size,We,Qe,xt,At.textureOffset,At.scale,At.offset);ut.colorAttachment.set(ot.particleTexture1.texture),Ne.clear({color:r.aj.transparent}),ke.getOrCreateProgram("rasterParticleUpdate",{defines:At.defines}).draw(ke,Oe.TRIANGLES,Si.disabled,Oi.disabled,Xi.unblended,zi.disabled,Vt,De.id,ke.viewportBuffer,ke.quadTriangleIndexBuffer,ke.viewportSegments)}}(T,F,de,Te)}(u,t,n,d),u.renderPass==="translucent"&&(function(T,I,F,V,j){const G=T.context,q=G.gl,Q=I.getSource().tileSize,ce=5*(1-r.ac(r.bY,r.bY+1,T.transform.zoom))*Q+F.paint.get("raster-particle-elevation"),ae=!T.options.moving,de=T.transform.projection.name==="globe";if(!V.length)return;const[pe,Te]=T.stencilConfigForOverlap(V),ke=[];de&&ke.push("PROJECTION_GLOBE_VIEW");const De=T.stencilModeFor3D();for(const Ue of Te){const Le=Ue.toUnwrapped(),Ne=I.getTile(Ue);if(!Ne.rasterParticleState)continue;const Oe=Ne.rasterParticleState,We=100;Ne.registerFadeDuration(We);const Qe=I.findLoadedParent(Ue,0),xt=nh(Ne,Qe,I,T.transform,We);let ut,Dt;T.terrain&&T.terrain.prepareDrawTile(),G.activeTexture.set(q.TEXTURE0),Oe.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),G.activeTexture.set(q.TEXTURE1),Qe&&Qe.rasterParticleState?(Qe.rasterParticleState.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),ut=Math.pow(2,Qe.tileID.overscaledZ-Ne.tileID.overscaledZ),Dt=[Ne.tileID.canonical.x*ut%1,Ne.tileID.canonical.y*ut%1]):Oe.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const At=de?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(Le,ae),ot=T.transform,wt=jf(ot),Vt=r.cE(Ue.canonical),st=r.cF(Vt.getCenter().lat);let It,bt,Kt,Bt,kt;de?(It=Float32Array.from(r.bb(r.cH(Ue.canonical))),bt=Float32Array.from(ot.globeMatrix),Kt=Float32Array.from(r.cD(ot)),Bt=[r.at(ot.center.lng),r.aA(ot.center.lat)],kt=Float32Array.from(r.cG(Ue.canonical,Vt,st,ot.worldSize/ot._pixelsPerMercatorPixel))):(It=new Float32Array(16),bt=new Float32Array(9),Kt=new Float32Array(16),Bt=[0,0],kt=new Float32Array(9));const $t=Ba(At,It,bt,Kt,kt,Dt||[0,0],r.ae(T.transform.zoom),Bt,wt,ut||1,xt,ce),Xt=T.isTileAffectedByFog(Ue),ci=T.getOrCreateProgram("rasterParticle",{defines:ke,overrideFog:Xt});if(T.uploadCommonUniforms(G,ci,Le),de){const pi=new Si(q.LEQUAL,Si.ReadOnly,T.depthRangeFor3D),Fi=0,Mi=T.globeSharedBuffers;if(Mi){const[Ci,ji,pr]=Mi.getGridBuffers(st,Fi!==0);ci.draw(T,q.TRIANGLES,pi,De,Xi.alphaBlended,T.renderElevatedRasterBackface?zi.frontCCW:zi.backCCW,$t,F.id,Ci,ji,pr)}}else{const pi=T.depthModeForSublayer(0,Si.ReadOnly),Fi=pe[Ue.overscaledZ],{tileBoundsBuffer:Mi,tileBoundsIndexBuffer:Ci,tileBoundsSegments:ji}=T.getTileBoundsBuffers(Ne);ci.draw(T,q.TRIANGLES,pi,Fi,Xi.alphaBlended,zi.disabled,$t,F.id,Mi,Ci,ji)}}T.resetStencilClippingMasks()}(u,t,n,d),u.style.map.triggerRepaint())},background:function(u,t,n,d){const y=n.paint.get("background-color"),b=n.paint.get("background-color-use-theme").constantOr("default")==="none",T=n.paint.get("background-opacity"),I=n.paint.get("background-emissive-strength"),F=n.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const V=u.context,j=V.gl,G=u.transform,q=G.tileSize,Q=n.paint.get("background-pattern");let ce;if(Q!==void 0&&(Q===null||(ce=u.imageManager.getPattern(Q.toString(),n.scope,u.style.getLut(n.scope)),!ce)))return;const ae=!Q&&y.a===1&&T===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==ae)return;const de=Oi.disabled,pe=u.depthModeForSublayer(0,ae==="opaque"?Si.ReadWrite:Si.ReadOnly),Te=u.colorModeForDrapableLayerRenderPass(I),ke=Q?"backgroundPattern":"background";let De,Ue=d;if(Ue||(De=u.getBackgroundTiles(),Ue=Object.values(De).map(Le=>Le.tileID)),Q&&(V.activeTexture.set(j.TEXTURE0),u.imageManager.bind(u.context,n.scope)),F){const Le=u.getOrCreateProgram(ke,{overrideFog:!1,overrideRtt:!0}),Ne=new Float32Array(r.ab.mat4.identity([])),Oe=new r.aG(0,0,0,0,0),We=Q?Nf(Ne,I,T,u,0,n.scope,ce,F,{tileID:Oe,tileSize:q}):ld(Ne,I,T,y.toRenderColor(b?null:n.lut));Le.draw(u,j.TRIANGLES,pe,de,Te,zi.disabled,We,n.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments)}else for(const Le of Ue){const Ne=u.isTileAffectedByFog(Le),Oe=u.getOrCreateProgram(ke,{overrideFog:Ne}),We=Le.toUnwrapped(),Qe=d?Le.projMatrix:u.transform.calculateProjMatrix(We);u.prepareDrawTile();const xt=t?t.getTile(Le):De?De[Le.key]:new gl(Le,q,G.zoom,u),ut=Q?Nf(Qe,I,T,u,0,n.scope,ce,F,{tileID:Le,tileSize:q}):ld(Qe,I,T,y.toRenderColor(b?null:n.lut));u.uploadCommonUniforms(V,Oe,We);const{tileBoundsBuffer:Dt,tileBoundsIndexBuffer:At,tileBoundsSegments:ot}=u.getTileBoundsBuffers(xt);Oe.draw(u,j.TRIANGLES,pe,de,Te,zi.disabled,ut,n.id,Dt,At,ot)}},sky:function(u,t,n){const d=u._atmosphere?r.ae(u.transform.zoom):1,y=n.paint.get("sky-opacity")*d;if(y===0)return;const b=u.context,T=n.paint.get("sky-type"),I=new Si(b.gl.LEQUAL,Si.ReadOnly,[0,1]),F=u.frameCounter/1e3%1;T==="atmosphere"?u.renderPass==="offscreen"?n.needsSkyboxCapture(u)&&(function(V,j,G,q){const Q=V.context,ce=Q.gl;let ae=j.skyboxFbo;if(!ae){ae=j.skyboxFbo=Q.createFramebuffer(32,32,!0,null),j.skyboxGeometry=new bp(Q),j.skyboxTexture=Q.gl.createTexture(),ce.bindTexture(ce.TEXTURE_CUBE_MAP,j.skyboxTexture),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_WRAP_S,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_WRAP_T,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_MIN_FILTER,ce.LINEAR),ce.texParameteri(ce.TEXTURE_CUBE_MAP,ce.TEXTURE_MAG_FILTER,ce.LINEAR);for(let ke=0;ke<6;++ke)ce.texImage2D(ce.TEXTURE_CUBE_MAP_POSITIVE_X+ke,0,ce.RGBA,32,32,0,ce.RGBA,ce.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(ae.framebuffer),Q.viewport.set([0,0,32,32]);const de=j.getCenter(V,!0),pe=V.getOrCreateProgram("skyboxCapture"),Te=new Float64Array(16);r.ab.mat4.identity(Te),r.ab.mat4.rotateY(Te,Te,.5*-Math.PI),ms(V,j,pe,Te,de,0),r.ab.mat4.identity(Te),r.ab.mat4.rotateY(Te,Te,.5*Math.PI),ms(V,j,pe,Te,de,1),r.ab.mat4.identity(Te),r.ab.mat4.rotateX(Te,Te,.5*-Math.PI),ms(V,j,pe,Te,de,2),r.ab.mat4.identity(Te),r.ab.mat4.rotateX(Te,Te,.5*Math.PI),ms(V,j,pe,Te,de,3),r.ab.mat4.identity(Te),ms(V,j,pe,Te,de,4),r.ab.mat4.identity(Te),r.ab.mat4.rotateY(Te,Te,Math.PI),ms(V,j,pe,Te,de,5),Q.viewport.set([0,0,V.width,V.height])}(u,n),n.markSkyboxValid(u)):u.renderPass==="sky"&&function(V,j,G,q,Q){const ce=V.context,ae=ce.gl,de=V.transform,pe=V.getOrCreateProgram("skybox");ce.activeTexture.set(ae.TEXTURE0),ae.bindTexture(ae.TEXTURE_CUBE_MAP,j.skyboxTexture);const Te=((ke,De,Ue,Le,Ne)=>({u_matrix:ke,u_sun_direction:De,u_cubemap:0,u_opacity:Le,u_temporal_offset:Ne}))(de.skyboxMatrix,j.getCenter(V,!1),0,q,Q);V.uploadCommonUniforms(ce,pe),pe.draw(V,ae.TRIANGLES,G,Oi.disabled,V.colorModeForRenderPass(),zi.backCW,Te,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(u,n,I,y,F):T==="gradient"&&u.renderPass==="sky"&&function(V,j,G,q,Q){const ce=V.context,ae=ce.gl,de=V.transform,pe=V.getOrCreateProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new bp(ce)),ce.activeTexture.set(ae.TEXTURE0);let Te=j.colorRampTexture;Te||(Te=j.colorRampTexture=new r.T(ce,j.colorRamp,ae.RGBA8)),Te.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);const ke=((De,Ue,Le,Ne,Oe)=>({u_matrix:De,u_color_ramp:0,u_center_direction:Ue,u_radius:r.ai(Le),u_opacity:Ne,u_temporal_offset:Oe}))(de.skyboxMatrix,j.getCenter(V,!1),j.paint.get("sky-gradient-radius"),q,Q);V.uploadCommonUniforms(ce,pe),pe.draw(V,ae.TRIANGLES,G,Oi.disabled,V.colorModeForRenderPass(),zi.backCW,ke,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(u,n,I,y,F)},debug:function(u,t,n,d,y,b){for(let T=0;T<n.length;T++)if(y){const V=new r.aj(d.r*.8,d.g*.8,d.b*.8,1);Dl(u,t,n[T],d,-1,-1,b),Dl(u,t,n[T],d,-1,1,b),Dl(u,t,n[T],d,1,1,b),Dl(u,t,n[T],d,1,-1,b),Dl(u,t,n[T],V,0,0,b)}else Dl(u,t,n[T],d,0,0,b)},custom:function(u,t,n,d){const y=u.context,b=n.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&n.isDraped(t)){if(u.renderPass==="offscreen"){const T=b.prerender;if(T){if(u.setCustomLayerDefaults(),y.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){const I=u.transform.pointMerc;T.call(b,y.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),r.ae(u.transform.zoom),[I.x,I.y],u.transform.pixelsPerMeterRatio)}else T.call(b,y.gl,u.transform.customLayerMatrix());y.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){const I=b.renderToTile;if(I){const F=d[0].canonical,V=new r.aa(F.x+d[0].wrap*(1<<F.z),F.y,F.z);y.setDepthMode(Si.disabled),y.setStencilMode(Oi.disabled),y.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),I.call(b,y.gl,V),y.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),y.setColorMode(u.colorModeForRenderPass()),y.setStencilMode(Oi.disabled);const T=b.renderingMode==="3d"?new Si(u.context.gl.LEQUAL,Si.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,Si.ReadOnly);if(y.setDepthMode(T),u.transform.projection.name==="globe"){const I=u.transform.pointMerc;b.render(y.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),r.ae(u.transform.zoom),[I.x,I.y],u.transform.pixelsPerMeterRatio)}else b.render(y.gl,u.transform.customLayerMatrix());y.setDirty(),u.setBaseState(),y.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(u,t,n,d){if(u.renderPass==="opaque")return;const y=n.paint.get("model-opacity").constantOr(1);if(y===0)return;const b=n.paint.get("model-cast-shadows");if(u.renderPass==="shadow"&&(!b||u.terrain&&y<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof r.a9))return;const T=u.shadowRenderer,I=n.paint.get("model-receive-shadows");T&&(T.useNormalOffset=!0,I||(T.enabled=!1));const F=()=>{T&&(T.useNormalOffset=!0,I||(T.enabled=!0))},V=t.getSource();if(u.renderPass==="light-beam"&&V.type!=="batched-model")return;if(V.type==="vector"||V.type==="geojson")return function(pe,Te,ke,De,Ue){const Le=pe.transform;if(Le.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${Le.projection.name} projection is not yet implemented`);const Ne=Le.getFreeCameraOptions().position;if(!pe.modelManager)return;const Oe=pe.modelManager;ke.modelManager=Oe;const We=pe.shadowRenderer;if(!ke._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Qe=ke._unevaluatedLayout._values["model-id"],xt=Object.assign({},ke.layout.get("model-id").parameters),ut=pe.style.order.indexOf(ke.fqid);for(const Dt of De){const At=Te.getTile(Dt).getBucket(ke);if(!At||At.projection.name!==Le.projection.name)continue;const ot=At.getModelUris();ot&&!At.modelsRequested&&(Oe.addModelsFromBucket(ot,Ue),At.modelsRequested=!0);const wt=ls(Dt,Le);xt.zoom=wt;const Vt=Qe.possiblyEvaluate(xt);if(ha(pe,At,Dt),Rs.shadowUniformsInitialized=!1,Rs.useSingleShadowCascade=!!We&&We.getMaxCascadeForTile(Dt.toUnwrapped())===0,pe.renderPass==="shadow"&&We){if(pe.currentShadowCascade===1&&At.isInsideFirstShadowMapFrustum)continue;const bt=Le.calculatePosMatrix(Dt.toUnwrapped(),Le.worldSize);if(Rs.tileMatrix.set(bt),Rs.shadowTileMatrix=Float32Array.from(We.calculateShadowPassMatrixFromMatrix(bt)),Rs.aabb.min.fill(0),Rs.aabb.max[0]=Rs.aabb.max[1]=r.ag,Rs.aabb.max[2]=0,fh(At,Rs,pe,ke.scope))continue}const st=1<<Dt.canonical.z,It=[((Ne.x-Dt.wrap)*st-Dt.canonical.x)*r.ag,(Ne.y*st-Dt.canonical.y)*r.ag,Ne.z*st*r.ag];pe.conflationActive&&Object.keys(At.instancesPerModel).length>0&&pe.style.isLayerClipped(ke,Te.getSource())&&At.updateReplacement(Dt,pe.replacementSource,ut,Ue)&&(At.uploaded=!1,At.upload(pe.context));for(let bt in At.instancesPerModel){const Kt=At.instancesPerModel[bt];Kt.features.length>0&&(bt=Vt.evaluate(Kt.features[0].feature,{}));const Bt=Oe.getModel(bt,Ue);if(Bt&&Bt.uploaded)for(const kt of Bt.nodes)ph(pe,ke,kt,Kt,It,Dt,Rs)}}}(u,t,n,d,V.type==="vector"?n.scope:""),void F();if(!V.loaded())return;if(V.type==="batched-model")return function(pe,Te,ke,De){ke.resetLayerRenderingStats(pe);const Ue=pe.context,Le=pe.transform,Ne=pe.style.fog,Oe=pe.shadowRenderer;if(Le.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${Le.projection.name} projection is not yet implemented`);const We=pe.transform.getFreeCameraOptions().position,Qe=r.ab.vec3.scale([],[We.x,We.y,We.z],pe.transform.worldSize),xt=r.ab.vec3.negate([],Qe),ut=r.ab.mat4.identity([]),Dt=r.dj(Le.center.lat,Le.zoom),At=r.ab.mat4.fromScaling([],[1,1,1/Dt]);r.ab.mat4.translate(ut,ut,xt);const ot=ke.paint.get("model-opacity").constantOr(1),wt=new Si(Ue.gl.LEQUAL,Si.ReadWrite,pe.depthRangeFor3D),Vt=new Si(Ue.gl.LEQUAL,Si.ReadOnly,pe.depthRangeFor3D),st=new r.cd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),It=pe.renderPass==="shadow",bt=It&&Oe?Oe.getCurrentCascadeFrustum():Le.getFrustum(Le.scaleZoom(Le.worldSize)),Kt=ke.paint.get("model-front-cutoff"),Bt=Kt[2]<1,kt=bl(pe,ke.paint.get("model-cutoff-fade-range")),$t=ke.getLayerRenderingStats();(function(Xt,ci,pi,Fi){const Mi=Xt.terrain?Xt.terrain.exaggeration():0,Ci=Xt.transform.zoom;for(const ji of Fi){const pr=ci.getTile(ji).getBucket(pi);pr&&(Xt.conflationActive&&pr.updateReplacement(ji,Xt.replacementSource),pr.evaluateScale(Xt,pi),Xt.terrain&&Mi>0&&pr.elevationUpdate(Xt.terrain,Mi,ji,pi.source),pr.needsReEvaluation(Xt,Ci,pi)&&pr.evaluate(pi))}})(pe,Te,ke,De),function(){let Xt,ci,pi;Bt?(Xt=De.length-1,ci=-1,pi=-1):(Xt=0,ci=De.length,pi=1);const Fi=new Float64Array(16),Mi=r.ab.vec3.create(),Ci=new r.P(0,0);for(let ji=Xt;ji!==ci;ji+=pi){const pr=De[ji],Er=Te.getTile(pr).getBucket(ke);if(!Er||!Er.uploaded)continue;let dn=!1;Oe&&(dn=Oe.getMaxCascadeForTile(pr.toUnwrapped())===0);const $r=Le.calculatePosMatrix(pr.toUnwrapped(),Le.worldSize),$i=Er.modelTraits;!It&&Bt&&(r.ab.mat4.invert(Fi,$r),r.ab.vec3.transformMat4(Mi,Qe,Fi),Ci.x=Mi[0],Ci.y=Mi[1]);const lr=[];for(const bi of Er.getNodesInfo()){if(bi.hiddenByReplacement||!bi.node.meshes)continue;const or=bi.node;let Ir=0;pe.terrain&&or.elevation&&(Ir=or.elevation*pe.terrain.exaggeration());const Mr=(()=>{const mr=bi.aabb;return st.min=[...mr.min],st.max=[...mr.max],st.min[2]+=Ir,st.max[2]+=Ir,r.ab.vec3.transformMat4(st.min,st.min,$r),r.ab.vec3.transformMat4(st.max,st.max,$r),st})(),pn=bi.evaluatedScale;if(pn[0]<=1&&pn[1]<=1&&pn[2]<=1&&Mr.intersects(bt)===0)continue;if(!It&&Bt){const mr=.16666666666666666;bi.cameraCollisionOpacity=Qe[0]>Mr.min[0]&&Qe[0]<Mr.max[0]&&Qe[1]>Mr.min[1]&&Qe[1]<Mr.max[1]&&Qe[2]*Dt<Mr.max[2]&&or.footprint&&r.bA(Ci,or.footprint)?Math.max(bi.cameraCollisionOpacity-mr,0):Math.min(1,bi.cameraCollisionOpacity+mr)}const ns=[...$r],Tn=or.anchor?or.anchor[0]:0,qn=or.anchor?or.anchor[1]:0;r.ab.mat4.translate(ns,ns,[Tn*(pn[0]-1),qn*(pn[1]-1),Ir]),r.ab.vec3.exactEquals(pn,r.dm)||r.ab.mat4.scale(ns,ns,pn);const Co=r.ab.mat4.multiply([],ns,or.matrix),Gs=r.ab.mat4.multiply([],Le.expandedFarZProjMatrix,Co),rn=r.ab.mat4.multiply([],Le.expandedFarZProjMatrix,ns),Hr=r.ab.vec4.transformMat4([],[Tn,qn,Ir,1],Gs)[2];or.hidden=!1;let Br=ot;It||(Bt&&(Br*=bi.cameraCollisionOpacity,Br*=wp(ns,Le,bi.aabb,Kt)),Br*=ln(kt,Hr)),Br!==0?lr.push({nodeInfo:bi,depth:Hr,opacity:Br,wvpForNode:Gs,wvpForTile:rn,nodeModelMatrix:Co,tileModelMatrix:ns}):or.hidden=!0}It||lr.sort((bi,or)=>!Bt||bi.opacity===1&&or.opacity===1?bi.depth<or.depth?-1:1:bi.opacity===1?-1:or.opacity===1?1:bi.depth>or.depth?-1:1);for(const bi of lr){const or=bi.nodeInfo,Ir=or.node;let Mr=r.ab.mat4.multiply([],At,bi.tileModelMatrix);r.ab.mat4.multiply(Mr,ut,Mr);const pn=r.ab.mat4.invert([],Mr);r.ab.mat4.transpose(pn,pn),r.ab.mat4.scale(pn,pn,Il),Mr=r.ab.mat4.multiply(Mr,Mr,Ir.matrix);const ns=pe.renderPass==="light-beam",Tn=ke.paint.get("model-color-use-theme").constantOr("default")==="none",qn=$i&r.dp.HasMapboxMeshFeatures,Co=qn?0:or.evaluatedRMEA[0][2];for(let Gs=0;Gs<Ir.meshes.length;++Gs){const rn=Ir.meshes[Gs],Hr=Gs===Ir.lightMeshIndex;let Br=bi.wvpForNode;if(Hr){if(!ns&&!pe.terrain&&pe.shadowRenderer){pe.currentLayer<pe.firstLightBeamLayer&&(pe.firstLightBeamLayer=pe.currentLayer);continue}Br=bi.wvpForTile}else if(ns)continue;const mr={defines:[]},In=[];if(!It&&Oe&&(Oe.useNormalOffset=!!rn.normalBuffer),vu(mr.defines,In,rn,pe,Tn?null:ke.lut),qn||mr.defines.push("DIFFUSE_SHADED"),dn&&mr.defines.push("SHADOWS_SINGLE_CASCADE"),$t&&(It?$t.numRenderedVerticesInShadowPass+=rn.vertexArray.length:$t.numRenderedVerticesInTransparentPass+=rn.vertexArray.length),It){xu(rn,bi.nodeModelMatrix,pe,ke);continue}let Yn=null;if(Ne){const Vo=wo(bi.nodeModelMatrix,pe.transform);if(Yn=new Float32Array(Vo),Le.projection.name!=="globe"){const Uo=rn.aabb.min,jo=rn.aabb.max,[nl,$o]=Ne.getOpacityForBounds(Vo,Uo[0],Uo[1],jo[0],jo[1]);mr.overrideFog=nl>=je||$o>=je}}const jr=rn.material;let zs;jr.occlusionTexture&&jr.occlusionTexture.offsetScale&&(zs=jr.occlusionTexture.offsetScale,mr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const ta=pe.getOrCreateProgram("model",mr);!It&&Oe&&Oe.setupShadowsFromMatrix(bi.tileModelMatrix,ta,Oe.useNormalOffset),pe.uploadCommonUniforms(Ue,ta,null,Yn);const Eo=jr.pbrMetallicRoughness;Eo.metallicFactor=.9,Eo.roughnessFactor=.5;const ho=Jo(new Float32Array(Br),new Float32Array(Mr),new Float32Array(pn),new Float32Array(Ir.matrix),pe,bi.opacity,Eo.baseColorFactor.toRenderColor(null),jr.emissiveFactor,Eo.metallicFactor,Eo.roughnessFactor,jr,Co,ke,[0,0,0],zs);!Hr&&(or.hasTranslucentParts||bi.opacity<1)&&ta.draw(pe,Ue.gl.TRIANGLES,wt,Oi.disabled,Xi.disabled,zi.backCCW,ho,ke.id,rn.vertexBuffer,rn.indexBuffer,rn.segments,ke.paint,pe.transform.zoom,void 0,In),ta.draw(pe,Ue.gl.TRIANGLES,Hr?Vt:wt,Oi.disabled,Hr||bi.opacity<1||or.hasTranslucentParts?Xi.alphaBlended:Xi.unblended,zi.backCCW,ho,ke.id,rn.vertexBuffer,rn.indexBuffer,rn.segments,ke.paint,pe.transform.zoom,void 0,In)}}}}()}(u,t,n,d),void F();if(V.type!=="model")return;const j=V.getModels(),G=[],q=u.transform.getFreeCameraOptions().position,Q=r.ab.vec3.scale([],[q.x,q.y,q.z],u.transform.worldSize);r.ab.vec3.negate(Q,Q);const ce=[],ae=[];let de=0;for(const pe of j){const Te=n.paint.get("model-rotation").constantOr(null),ke=n.paint.get("model-scale").constantOr(null),De=n.paint.get("model-translation").constantOr(null);pe.computeModelMatrix(u,Te,ke,De,!0,!0,!1);const Ue=r.ab.mat4.identity([]),Le=r.dj(pe.position.lat,u.transform.zoom),Ne=r.ab.mat4.fromScaling([],[1,1,1/Le]);r.ab.mat4.translate(Ue,Ue,Q),G.push({zScaleMatrix:Ne,negCameraPosMatrix:Ue});for(const Oe of pe.nodes)dd(u.transform,Oe,pe.matrix,u.transform.expandedFarZProjMatrix,de,ce,ae);de++}if(ce.sort((pe,Te)=>Te.depth-pe.depth),u.renderPass!=="shadow"){if(y===1)for(const pe of ae)tn(pe,u,n,G[pe.modelIndex],Oi.disabled,u.colorModeForRenderPass());else{for(const pe of ae)tn(pe,u,n,G[pe.modelIndex],Oi.disabled,Xi.disabled);for(const pe of ae)tn(pe,u,n,G[pe.modelIndex],u.stencilModeFor3D(),u.colorModeForRenderPass());u.resetStencilClippingMasks()}for(const pe of ce)tn(pe,u,n,G[pe.modelIndex],Oi.disabled,u.colorModeForRenderPass());F()}else{for(const pe of ae)xu(pe.mesh,pe.nodeModelMatrix,u,n);for(const pe of ce)xu(pe.mesh,pe.nodeModelMatrix,u,n);F()}}},bu={line:function(u,t,n){if(u.hasElevatedBuckets=!1,u.hasNonElevatedBuckets=!1,u._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||u._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const d=t.getVisibleCoordinates();for(const y of d){const b=t.getTile(y).getBucket(u);if(b&&(b.hasZOffset?u.hasElevatedBuckets=!0:u.hasNonElevatedBuckets=!0,u.hasElevatedBuckets&&u.hasNonElevatedBuckets))break}}}else u.hasNonElevatedBuckets=!0},model:function(u,t,n){const d=t.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(n.modelManager&&n.modelManager.upload(n,d.type==="vector"?u.scope:""));if(d.type==="batched-model"||d.type!=="model")return;const y=d.getModels();for(const b of y)b.upload(n.context)},raster:function(u,t,n){const d=t.getSource();if(!(d instanceof is&&d.loaded()))return;const y=u.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!y)return;const b=u.paint.get("raster-array-band")||d.getInitialBand(y);if(b==null)return;const T=t.getIds().map(I=>t.getTileByID(I));for(const I of T)I.updateNeeded(y,b)&&d.prepareTile(I,y,b)},"raster-particle":function(u,t,n){const d=t.getSource();if(!(d instanceof is&&d.loaded()))return;const y=u.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!y)return;const b=u.paint.get("raster-particle-array-band")||d.getInitialBand(y);if(b==null)return;const T=t.getIds().map(I=>t.getTileByID(I));for(const I of T)I.updateNeeded(y,b)&&d.prepareTile(I,y,b)}};class Qa{constructor(t,n,d,y,b){this.context=new ah(t,n),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=r.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const F of T)this._debugParams.enabledLayers[F]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const F of T)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],F);this.occlusionParams=new eo(b),this.setup(),this.numSublayers=Yo.maxUnderzooming+Yo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.dv,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ic(this),this._wireframeDebugCache=new kl,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const I=new r.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,I,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y}updateTerrain(t,n){const d=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new hu(this,t));const y=this._terrain;this.transform.elevation=d?y:null,y.update(t,this.transform,n),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(t){const n=t.fog;if(!n||this.transform.projection.name==="globe"||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,y]=n.getFovAdjustedRange(this.transform._fov);if(d>y)return void(this.transform.fogCullDistSq=null);const b=d+.78*(y-d);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new hu(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,n){if(this.width=t*r.q.devicePixelRatio,this.height=n*r.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const t=this.context,n=new r.b4;n.emplaceBack(0,0),n.emplaceBack(r.ag,0),n.emplaceBack(0,r.ag),n.emplaceBack(r.ag,r.ag),this.tileExtentBuffer=t.createVertexBuffer(n,r.b6.members),this.tileExtentSegments=r.b7.simpleSegment(0,0,4,2);const d=new r.b4;d.emplaceBack(0,0),d.emplaceBack(r.ag,0),d.emplaceBack(0,r.ag),d.emplaceBack(r.ag,r.ag),this.debugBuffer=t.createVertexBuffer(d,r.b6.members),this.debugSegments=r.b7.simpleSegment(0,0,4,5);const y=new r.b4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(y,r.b6.members),this.viewportSegments=r.b7.simpleSegment(0,0,4,2);const b=new r.aT;b.emplaceBack(0,0,0,0),b.emplaceBack(r.ag,0,r.ag,0),b.emplaceBack(0,r.ag,0,r.ag),b.emplaceBack(r.ag,r.ag,r.ag,r.ag),this.mercatorBoundsBuffer=t.createVertexBuffer(b,r.b9.members),this.mercatorBoundsSegments=r.b7.simpleSegment(0,0,4,2);const T=new r.aU;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(T);const I=new r.b5;for(const V of[0,1,3,2,0])I.emplaceBack(V);this.debugIndexBuffer=t.createIndexBuffer(I),this.emptyTexture=new r.T(t,new r.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=r.ab.mat4.create();const F=this.context.gl;this.stencilClearMode=new Oi({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Si.disabled,this.stencilClearMode,Xi.disabled,zi.disabled,nd(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,n,d){if(!n||this.currentStencilSource===n.id||!t.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const F of d)if(this._tileClippingMaskIDs[F.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=n.id;const y=this.context,b=y.gl;this.nextStencilID+d.length>256&&this.clearStencil(),y.setColorMode(Xi.disabled),y.setDepthMode(Si.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of d){const F=n.getTile(I),V=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:j,tileBoundsIndexBuffer:G,tileBoundsSegments:q}=this.getTileBoundsBuffers(F);T.draw(this,b.TRIANGLES,Si.disabled,new Oi({func:b.ALWAYS,mask:0},V,255,b.KEEP,b.KEEP,b.REPLACE),Xi.disabled,zi.disabled,nd(I.projMatrix),"$clipping",j,G,q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Oi({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const n=this.context.gl;return new Oi({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,d=t.sort((T,I)=>I.overscaledZ-T.overscaledZ),y=d[d.length-1].overscaledZ,b=d[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let I=0;I<b;I++)T[I+y]=new Oi({func:n.GEQUAL,mask:255},I+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=b,[T,d]}return[{[y]:Oi.disabled},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Xi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new r.aj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Xi.unblended:Xi.alphaBlended}colorModeForDrapableLayerRenderPass(t){const n=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Xi([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new r.aj(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,n,d,y=!1){if(this.depthOcclusion)return new Si(this.context.gl.GREATER,Si.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return Si.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Si(d||this.context.gl.LEQUAL,n,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,n=Math.ceil(this.width),d=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),b=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===n&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),n!==0&&d!==0&&(this.depthFBO=new gp(this.context,n,d,!1,"texture"),this.depthTexture=new r.T(this.context,{width:n,height:d,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),t.bindTexture(t.TEXTURE_2D,b),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,n,d,0,0,n,d,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,n)=>t+n/this._fpsHistory.length,0))}render(t,n){const d=r.q.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=n;const y=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(b).filter(ot=>{const wt=y[ot];return!(wt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[wt.type]});let I=T(),F=!1,V=!1;for(const ot of I){const wt=y[ot];wt.type==="circle"&&(F=!0),wt.type==="symbol"&&(wt.hasInitialOcclusionOpacityProperties?V=!0:F=!0)}let j=I.map(ot=>y[ot]);const G=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(r.q.now()),this.imageManager.beginFrame();let q=0,Q=!1;for(const ot in G){const wt=G[ot];wt.used&&(wt.prepare(this.context),wt.getSource().usedInConflation&&++q)}let ce=!1;for(const ot of j)ot.isHidden(this.transform.zoom)||(ot.type==="clip"&&(ce=!0),this.prepareLayer(ot));const ae={},de={},pe={},Te={},ke={};for(const ot in G){const wt=G[ot];ae[ot]=wt.getVisibleCoordinates(),de[ot]=ae[ot].slice().reverse(),pe[ot]=wt.getVisibleCoordinates(!0).reverse(),Te[ot]=wt.getShadowCasterCoordinates(),ke[ot]=wt.sortCoordinatesByDistance(ae[ot])}const De=ot=>{const wt=this.style.getLayerSourceCache(ot);return wt&&wt.used?wt.getSource():null};if(q||ce||this._clippingActiveLastFrame){const ot=[],wt=[];let Vt=0;for(const st of j)this.isSourceForClippingOrConflation(st,De(st))&&(ot.push(st),wt.push(Vt)),Vt++;if(ot&&(ce||ot.length>1)||this._clippingActiveLastFrame){ce=!1;const st=[];for(let It=0;It<ot.length;It++){const bt=ot[It],Kt=wt[It],Bt=this.style.getLayerSourceCache(bt);if(!Bt||!Bt.used||!Bt.getSource().usedInConflation&&bt.type!=="clip")continue;let kt=r.dx,$t=r.by.None;const Xt=[];let ci=!0;if(bt.type==="clip"){kt=Kt;for(const pi of bt.layout.get("clip-layer-types"))$t|=pi==="model"?r.by.Model:pi==="symbol"?r.by.Symbol:r.by.FillExtrusion;for(const pi of bt.layout.get("clip-layer-scope"))Xt.push(pi);bt.isHidden(this.transform.zoom)?ci=!1:ce=!0}ci&&st.push({layer:bt.fqid,cache:Bt,order:kt,clipMask:$t,clipScope:Xt})}this.replacementSource.setSources(st),Q=!0}}this._clippingActiveLastFrame=ce,Q||this.replacementSource.clear(),this.conflationActive=Q,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ot=0;ot<j.length;ot++){const wt=j[ot],Vt=wt.cutoffRange();if(this.longestCutoffRange=Math.max(Vt,this.longestCutoffRange),Vt>0){const st=De(wt);st&&(this.minCutoffZoom=Math.max(st.minzoom,this.minCutoffZoom)),wt.minzoom&&(this.minCutoffZoom=Math.max(wt.minzoom,this.minCutoffZoom))}wt.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ot),this._lastOcclusionLayer=ot)}const Ue=this.style&&this.style.fog;Ue?(this._fogVisible=Ue.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ue.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(pe),this.opaquePassCutoff=0,I=T(),j=I.map(ot=>y[ot]));const Le=this._shadowRenderer;if(Le){Le.updateShadowParameters(this.transform,this.style.directionalLight);for(const ot in G)for(const wt of ae[ot]){let Vt={min:0,max:0};this.terrain&&(Vt=this.terrain.getMinMaxForTile(wt)||Vt),Le.addShadowReceiver(wt.toUnwrapped(),Vt.min,Vt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.dw(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new dh(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Ne=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Oe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Ne&&!this._snow&&(this._snow=new Ep(this)),!Ne&&this._snow&&(this._snow.destroy(),delete this._snow),Oe&&!this._rain&&(this._rain=new Ll(this)),!Oe&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!ds.has(this.context.gl))return;this.renderPass="offscreen";for(const ot of j){const wt=t.getLayerSourceCache(ot);if(!ot.hasOffscreenPass()||ot.isHidden(this.transform.zoom))continue;const Vt=wt?de[wt.id]:void 0;(ot.type==="custom"||ot.type==="raster"||ot.type==="raster-particle"||ot.isSky()||Vt&&Vt.length)&&this.renderLayer(this,wt,ot,Vt)}this.depthRangeFor3D=[0,1-(j.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Te)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const We=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Qe=(()=>{if(n.showOverdrawInspector)return r.aj.black;const ot=this.style.fog;if(ot&&this.transform.projection.supportsFog){const wt=this.style.getLut(ot.scope);if(!We){const Vt=ot.properties.get("color-use-theme")==="none",st=ot.properties.get("color").toRenderColor(Vt?null:wt).toArray01();return new r.aj(...st)}if(We){const Vt=ot.properties.get("space-color-use-theme")==="none",st=ot.properties.get("space-color").toRenderColor(Vt?null:wt).toArray01();return new r.aj(...st)}}return r.aj.transparent})();if(this.context.clear({color:Qe,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&We&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const ot=j[this.currentLayer],wt=t.getLayerSourceCache(ot);if(ot.isSky())continue;const Vt=wt?(ot.is3D()?ke:de)[wt.id]:void 0;this._renderTileClippingMasks(ot,wt,Vt),this.renderLayer(this,wt,ot,Vt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&We&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.ae(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const ot=j[this.currentLayer],wt=t.getLayerSourceCache(ot);ot.isSky()&&this.renderLayer(this,wt,ot,wt?de[wt.id]:void 0)}function xt(ot,wt){let Vt;return wt&&(Vt=(ot.type==="symbol"?pe:ot.is3D()?ke:de)[wt.id]),Vt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const ot=j[this.currentLayer];if(ot.type==="raster"||ot.type==="raster-particle"){const wt=t.getLayerSourceCache(ot);this.renderLayer(this,wt,ot,xt(ot,wt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ut=0;Le&&(ut=Le.getShadowCastingLayerCount());let Dt=!1,At=-1;for(let ot=0;ot<I.length;++ot){const wt=j[ot];wt.isHidden(this.transform.zoom)||wt.is3D()&&(At=ot)}for(V&&At===-1&&(F=!0);this.currentLayer<I.length;){const ot=j[this.currentLayer],wt=t.getLayerSourceCache(ot);if(ot.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ot)){if(ot.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(F&&!Dt&&this.terrain&&!this.transform.isOrthographic&&(Dt=!0,this.blitDepth()),V&&At!==-1&&this.currentLayer===At+1&&!this.transform.isOrthographic&&this.blitDepth(),ot.is3D()||this.terrain||this._renderTileClippingMasks(ot,wt,wt?ae[wt.id]:void 0),this.renderLayer(this,wt,ot,xt(ot,wt)),!this.terrain&&Le&&ut>0&&ot.hasShadowPass()&&--ut==0&&(Le.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Vt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Vt;this.currentLayer++){const st=j[this.currentLayer];if(!st.hasLightBeamPass())continue;const It=t.getLayerSourceCache(st);this.renderLayer(this,It,st,It?de[It.id]:void 0)}this.currentLayer=Vt,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Vt=this.currentLayer;this.depthOcclusion=!0;for(const st of this.layersWithOcclusionOpacity){this.currentLayer=st;const It=j[this.currentLayer],bt=t.getLayerSourceCache(It),Kt=bt?de[bt.id]:void 0;It.is3D()||this.terrain||this._renderTileClippingMasks(It,bt,bt?ae[bt.id]:void 0),this.renderLayer(this,bt,It,Kt)}this.depthOcclusion=!1,this.currentLayer=Vt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ot=null;j.forEach(wt=>{const Vt=t.getLayerSourceCache(wt);Vt&&!wt.isHidden(this.transform.zoom)&&Vt.getVisibleCoordinates().length&&(!ot||ot.getSource().maxzoom<Vt.getSource().maxzoom)&&(ot=Vt)}),ot&&this.options.showTileBoundaries&&Fo.debug(this,ot,ot.getVisibleCoordinates(),r.aj.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Fo.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.aj(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ot){const wt=ot.transform.padding;vp(ot,ot.transform.height-(wt.top||0),3,_u),vp(ot,wt.bottom||0,3,Hn),xp(ot,wt.left||0,3,$f),xp(ot,ot.transform.width-(wt.right||0),3,Hf);const Vt=ot.transform.centerPoint;(function(st,It,bt,Kt){ea(st,It-1,bt-10,2,20,Kt),ea(st,It-10,bt-1,20,2,Kt)})(ot,Vt.x,ot.transform.height-Vt.y,vc)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Q||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:n}=this.transform.projection,d=!n||!n.includes(t.type);if(bu[t.type]&&(d||this.terrain&&t.type==="custom")){const y=this.style.getLayerSourceCache(t);bu[t.type](t,y,this)}this.gpuTimingEnd()}renderLayer(t,n,d,y){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||y&&y.length)&&(this.id=d.id,this.gpuTimingStart(d),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(d.type)&&(!t.terrain||d.type!=="custom")||d.type==="clip"||Fo[d.type](t,n,d,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery,d=this.context.gl;let y=this.gpuTimers[t.id];y||(y=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:d.createQuery()}),y.calls++,d.beginQuery(n.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,n=this.context.gl,d=n.createQuery();this.deferredRenderGpuTimeQueries.push(d),n.beginQuery(t.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const n={};for(const d in t){const y=t[d],b=this.context.extTimerQuery,T=b.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(y.query),n[d]=T}return n}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const n=this.context.gl;let d=0;for(const y of t)d+=n.getQueryParameter(y,n.QUERY_RESULT)/1e6,n.deleteQuery(y);return d}translatePosMatrix(t,n,d,y,b){if(!d[0]&&!d[1])return t;const T=b?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(T){const V=Math.sin(T),j=Math.cos(T);d=[d[0]*j-d[1]*V,d[0]*V+d[1]*j]}const I=[b?d[0]:r.ar(n,d[0],this.transform.zoom),b?d[1]:r.ar(n,d[1],this.transform.zoom),0],F=new Float32Array(16);return r.ab.mat4.translate(F,t,I),F}saveTileTexture(t){const n=t.size[0],d=this._tileTextures[n];d?d.push(t):this._tileTextures[n]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,n,d){const y=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,b=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||y||n!==void 0&&!n||b.push("FOG","FOG_DITHERING"),y&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(t,n){this.cache=this.cache||{};const d=n&&n.defines||[],y=n&&n.config,b=this.currentGlobalDefines(t,n&&n.overrideFog,n&&n.overrideRtt).concat(d),T=Rf.cacheKey(Ls[t],t,b,y);return this.cache[T]||(this.cache[T]=new Rf(this.context,t,Ls[t],y,oh[t],b)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,n){if(this.style.enable3dLights()){const d=this.style.directionalLight,y=this.style.ambientLight;if(d&&y){const b=((T,I,F)=>{const V=T.properties.get("direction"),j=T.properties.get("color-use-theme")==="none",G=T.properties.get("color").toRenderColor(j?null:F.getLut(T.scope)).toArray01(),q=T.properties.get("intensity"),Q=I.properties.get("color-use-theme")==="none",ce=I.properties.get("color").toRenderColor(Q?null:F.getLut(I.scope)).toArray01(),ae=I.properties.get("intensity"),de=[V.x,V.y,V.z],pe=r.cM(ce,ae),Te=r.cM(G,q);return{u_lighting_ambient_color:pe,u_lighting_directional_dir:de,u_lighting_directional_color:Te,u_ground_radiance:Of(de,Te,pe)}})(d,y,this.style);n.setLightsUniformValues(t,b)}}}uploadCommonUniforms(t,n,d,y,b){if(this.uploadCommonLightUniforms(t,n),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const I=T.getOpacity(this.transform.pitch),F=((V,j,G,q,Q,ce,ae,de,pe,Te,ke,De)=>{const Ue=V.transform,Le=j.properties.get("color-use-theme")==="none",Ne=j.properties.get("color").toRenderColor(Le?null:V.style.getLut(j.scope)).toArray01();Ne[3]=q;const Oe=V.frameCounter/1e3%1,[We,Qe]=j.properties.get("vertical-range");return{u_fog_matrix:G?Ue.calculateFogTileMatrix(G):De||V.identityMat,u_fog_range:j.getFovAdjustedRange(Ue._fov),u_fog_color:Ne,u_fog_horizon_blend:j.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(We,Qe),Qe],u_fog_temporal_offset:Oe,u_frustum_tl:Q,u_frustum_tr:ce,u_frustum_br:ae,u_frustum_bl:de,u_globe_pos:pe,u_globe_radius:Te,u_viewport:ke,u_globe_transition:r.ae(Ue.zoom),u_is_globe:+(Ue.projection.name==="globe")}})(this,T,d,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.q.devicePixelRatio,this.transform.height*r.q.devicePixelRatio],y);n.setFogUniformValues(t,F)}b&&n.setCutoffUniformValues(t,b.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,n=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const y of d)n[y.key]=t[y.key]||new gl(y,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,n){return!(!t.is3D()||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!n||n.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let n=this._cachedTileFogOpacities[t.key];return n||(this._cachedTileFogOpacities[t.key]=n=this.style.fog.getOpacityForTile(t)),n[0]>=je||n[1]>=je}setupDepthForOcclusion(t,n,d){const y=this.context,b=y.gl,T=!!d;var I;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(b.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),y.activeTexture.set(b.TEXTURE0),T||n.setTerrainUniformValues(y,d)}}function oo(u,t){let n=!1,d=null;const y=()=>{d=null,n&&(u(),d=setTimeout(y,t),n=!1)};return()=>(n=!0,d||y(),d)}class Gf{constructor(t){this._hashName=t&&encodeURIComponent(t),r.aP(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=oo(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const n=Ap(t);if(this._hashName){const d=this._hashName;let y=!1;const b=location.hash.slice(1).split("&").map(T=>{const I=T.split("=")[0];return I===d?(y=!0,`${I}=${n}`):T}).filter(T=>T);return y||b.push(`${d}=${n}`),`#${b.join("&")}`}return`#${n}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let n;return t.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(n=d)}),(n&&n[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const n=this._getCurrentHash();if(n.length>=3&&!n.some(d=>isNaN(d))){const d=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(n[3]||0):t.getBearing();return t.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:d,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ap(u,t){const n=u.getCenter(),d=Math.round(100*u.getZoom())/100,y=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,y),T=Math.round(n.lng*b)/b,I=Math.round(n.lat*b)/b,F=u.getBearing(),V=u.getPitch();let j=t?`/${T}/${I}/${d}`:`${d}/${I}/${T}`;return(F||V)&&(j+="/"+Math.round(10*F)/10),V&&(j+=`/${Math.round(V)}`),j}const gh={linearity:.3,easing:r.dy(0,0,.3,1)},Wf=r.l({deceleration:2500,maxSpeed:1400},gh),md=r.l({deceleration:20,maxSpeed:1400},gh),Pp=r.l({deceleration:1e3,maxSpeed:360},gh),gd=r.l({deceleration:1e3,maxSpeed:90},gh);class qf{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=r.q.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const n={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)n.zoom+=b.zoomDelta||0,n.bearing+=b.bearingDelta||0,n.pitch+=b.pitchDelta||0,b.panDelta&&n.pan._add(b.panDelta),b.around&&(n.around=b.around),b.pinchAround&&(n.pinchAround=b.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(n.pan.mag()){const b=wc(n.pan.mag(),d,r.l({},Wf,t||{}));y.offset=n.pan.mult(b.amount/n.pan.mag()),y.center=this._map.transform.center,bc(y,b)}if(n.zoom){const b=wc(n.zoom,d,md);y.zoom=this._map.transform.zoom+b.amount,bc(y,b)}if(n.bearing){const b=wc(n.bearing,d,Pp);y.bearing=this._map.transform.bearing+r.aw(b.amount,-179,179),bc(y,b)}if(n.pitch){const b=wc(n.pitch,d,gd);y.pitch=this._map.transform.pitch+b.amount,bc(y,b)}if(y.zoom||y.bearing){const b=n.pinchAround===void 0?n.around:n.pinchAround;y.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function bc(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function wc(u,t,n){const{maxSpeed:d,linearity:y,deceleration:b}=n,T=r.aw(u*y/(t/1e3),-d,d),I=Math.abs(T)/(b*y);return{easing:n.easing,duration:1e3*I,amount:T*(I/2)}}class So extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,d,y={}){const b=Tt(n.getCanvasContainer(),d),T=n.unproject(b);super(t,r.l({point:b,lngLat:T,originalEvent:d},y)),this._defaultPrevented=!1,this.target=n}}class wu extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,d){const y=t==="touchend"?d.changedTouches:d.touches,b=qt(n.getCanvasContainer(),y),T=b.map(F=>n.unproject(F)),I=b.reduce((F,V,j,G)=>F.add(V.div(G.length)),new r.P(0,0));super(t,{points:b,point:I,lngLats:T,lngLat:n.unproject(I),originalEvent:d}),this._defaultPrevented=!1}}class Rl extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n){super("wheel",{originalEvent:n}),this._defaultPrevented=!1}}class _h{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Rl(this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new So(t.type,this._map,t))}mouseup(t){this._map.fire(new So(t.type,this._map,t))}preclick(t){const n=r.l({},t);n.type="preclick",this._map.fire(new So(n.type,this._map,n))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(t),this._map.fire(new So(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new So(t.type,this._map,t))}mouseover(t){this._map.fire(new So(t.type,this._map,t))}mouseout(t){this._map.fire(new So(t.type,this._map,t))}touchstart(t){return this._firePreventable(new wu(t.type,this._map,t))}touchmove(t){this._map.fire(new wu(t.type,this._map,t))}touchend(t){this._map.fire(new wu(t.type,this._map,t))}touchcancel(t){this._map.fire(new wu(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yf{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new So(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new So("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new So(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sn{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(tt(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const d=n,y=this._startPos,b=this._lastPos;if(!y||!b||b.equals(d)||!this._box&&d.dist(y)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=Ae("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const T=Math.min(y.x,d.x),I=Math.max(y.x,d.x),F=Math.min(y.y,d.y),V=Math.max(y.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${F}px)`,this._box.style.width=I-T+"px",this._box.style.height=V-F+"px")})}mouseupWindow(t,n){if(!this._active)return;const d=this._startPos,y=n;if(d&&t.button===0){if(this.reset(),Ve(),d.x!==y.x||d.y!==y.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:t})),{cameraAnimation:b=>b.fitScreenCoordinates(d,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),at(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new r.z(t,{originalEvent:n}))}}function yh(u,t){const n={};for(let d=0;d<u.length;d++)n[u[d].identifier]=t[d];return n}class Dp{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,n,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=function(y){const b=new r.P(0,0);for(const T of y)b._add(T);return b.div(y.length)}(n),this.touches=yh(d,n)))}touchmove(t,n,d){if(this.aborted||!this.centroid)return;const y=yh(d,n);for(const b in this.touches){const T=y[b];(!T||T.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(t,n,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class vh{constructor(t){this.singleTap=new Dp(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,n,d){this.singleTap.touchstart(t,n,d)}touchmove(t,n,d){this.singleTap.touchmove(t,n,d)}touchend(t,n,d){const y=this.singleTap.touchend(t,n,d);if(y){const b=t.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(y)<30;if(b&&T||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Su{constructor(){this._zoomIn=new vh({numTouches:1,numTaps:2}),this._zoomOut=new vh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,d){this._zoomIn.touchstart(t,n,d),this._zoomOut.touchstart(t,n,d)}touchmove(t,n,d){this._zoomIn.touchmove(t,n,d),this._zoomOut.touchmove(t,n,d)}touchend(t,n,d){const y=this._zoomIn.touchend(t,n,d),b=this._zoomOut.touchend(t,n,d);return y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(y)},{originalEvent:t})}):b?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const _d={0:1,2:2};class ao{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,n){return!1}_move(t,n){return{}}mousedown(t,n){if(this._lastPoint)return;const d=Me(t);this._correctButton(t,d)&&(this._lastPoint=n,this._eventButton=d)}mousemoveWindow(t,n){const d=this._lastPoint;if(d){if(t.preventDefault(),this._eventButton!=null&&function(y,b){const T=_d[b];return y.buttons===void 0||(y.buttons&T)!==T}(t,this._eventButton))this.reset();else if(this._moved||!(n.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(d,n)}}mouseupWindow(t){this._lastPoint&&Me(t)===this._eventButton&&(this._moved&&Ve(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class da extends ao{mousedown(t,n){super.mousedown(t,n),this._lastPoint&&(this._active=!0)}_correctButton(t,n){return n===0&&!t.ctrlKey}_move(t,n){return{around:n,panDelta:n.sub(t)}}}class pa extends ao{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const d=.8*(n.x-t.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(t){t.preventDefault()}}class xh extends ao{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const d=-.5*(n.y-t.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(t){t.preventDefault()}}class Pn{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),r.aP(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(t,n,d){return this._calculateTransform(t,n,d)}touchmove(t,n,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!r.dz())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,n,d)}}touchend(t,n,d){this._calculateTransform(t,n,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,d){d.length>0&&(this._active=!0);const y=yh(d,n),b=new r.P(0,0),T=new r.P(0,0);let I=0;for(const V in y){const j=y[V],G=this._touches[V];G&&(b._add(j),T._add(j.sub(G)),I++,y[V]=j)}if(this._touches=y,I<this._minTouches||!T.mag())return;const F=T.div(I);return this._sum._add(F),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(I),panDelta:F}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ae("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class To{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,n,d){return{}}touchstart(t,n,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,d){const y=this._firstTwoTouches;if(!y)return;t.preventDefault();const[b,T]=y,I=Bo(d,n,b),F=Bo(d,n,T);if(!I||!F)return;const V=this._aroundCenter?null:I.add(F).div(2);return this._move([I,F],V,t)}touchend(t,n,d){if(!this._firstTwoTouches)return;const[y,b]=this._firstTwoTouches,T=Bo(d,n,y),I=Bo(d,n,b);T&&I||(this._active&&Ve(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Bo(u,t,n){for(let d=0;d<u.length;d++)if(u[d].identifier===n)return t[d]}function Sc(u,t){return Math.log(u/t)/Math.LN2}class Ur extends To{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Sc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Sc(this._distance,d),pinchAround:n}}}function Xf(u,t){return 180*u.angleWith(t)/Math.PI}class Tc extends To{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const d=this._vector;if(this._vector=t[0].sub(t[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Xf(this._vector,d),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const y=Xf(t,d);return Math.abs(y)<n}}function Ip(u){return Math.abs(u.y)>Math.abs(u.x)}class Tu extends To{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Ip(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,d){const y=this._lastPoints;if(!y)return;const b=t[0].sub(y[0]),T=t[1].sub(y[1]);return this._map._cooperativeGestures&&!r.dz()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(b,T,d.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(b.y+T.y)/2*-.5})}gestureBeginsVertically(t,n,d){if(this._valid!==void 0)return this._valid;const y=t.mag()>=2,b=n.mag()>=2;if(!y&&!b)return;if(!y||!b)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const T=t.y>0==n.y>0;return Ip(t)&&Ip(n)&&T}}const kp={panStep:100,bearingStep:15,pitchStep:10};class Mu{constructor(){const t=kp;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,d=0,y=0,b=0,T=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),b=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),b=1);break;case 38:t.shiftKey?y=1:(t.preventDefault(),T=-1);break;case 40:t.shiftKey?y=-1:(t.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(d=0,y=0),{cameraAnimation:I=>{const F=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:lo,zoom:n?Math.round(F)+n*(t.shiftKey?2:1):F,bearing:I.getBearing()+d*this._bearingStep,pitch:I.getPitch()+y*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:I.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function lo(u){return u*(2-u)}const el=4.000244140625,Dn=1/450;class fa{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Dn,r.aP(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||r.dz()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=r.q.now(),y=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,n!==0&&n%el==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=n,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(y*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=Tt(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const V=this._type==="wheel"&&Math.abs(this._delta)>el?this._wheelZoomRate:this._defaultZoomRate;let j=2/(1+Math.exp(-Math.abs(this._delta*V)));this._delta<0&&j!==0&&(j=1/j);const G=n(),q=Math.pow(2,G),Q=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):q;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(Q*j))),this._type==="wheel"&&(this._startZoom=G,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:n(),y=this._startZoom,b=this._easing;let T,I=!1;if(this._type==="wheel"&&y&&b){const V=Math.min((r.q.now()-this._lastWheelEventTime)/200,1),j=b(V);T=r.af(y,d,j),V<1?this._frameId||(this._frameId=!0):I=!0}else T=d,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let F=T-n();return F*this._lastDelta<0&&(F=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:F,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=r.dA;if(this._prevEase){const d=this._prevEase,y=(r.q.now()-d.start)/d.duration,b=d.easing(y+.01)-d.easing(y),T=.27/Math.sqrt(b*b+1e-4)*.01,I=Math.sqrt(.0729-T*T);n=r.dy(T,I,.25,1)}return this._prevEase={start:r.q.now(),duration:t,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ae("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class tl{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class zl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,n){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(t.shiftKey?-1:1),around:d.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ma{constructor(){this._tap=new vh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,n,d){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=n[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(t,n,d))}touchmove(t,n,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const y=n[0],b=y.y-this._swipePoint.y;return this._swipePoint=y,t.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(t,n,d)}touchend(t,n,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(t,n,d)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zm{constructor(t,n,d){this._el=t,this._mousePan=n,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Km{constructor(t,n,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Fl{constructor(t,n,d,y){this._el=t,this._touchZoom=n,this._touchRotate=d,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const yd=u=>u.zoom||u.drag||u.pitch||u.rotate;class Zf extends r.z{}class Gn{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const d=r.ab.vec3.sub([],n,t);this.radius=r.ab.vec3.length(d[2]<0?r.ab.vec3.div([],d,this.constants):[d[0],d[1],0])}projectRay(t){r.ab.vec3.div(t,t,this.constants),r.ab.vec3.normalize(t,t),r.ab.vec3.mul(t,t,this.constants);const n=r.ab.vec3.scale([],t,this.radius);if(n[2]>0){const d=r.ab.vec3.scale([],[0,0,1],r.ab.vec3.dot(n,[0,0,1])),y=r.ab.vec3.scale([],r.ab.vec3.normalize([],[n[0],n[1],0]),this.radius),b=r.ab.vec3.add([],n,r.ab.vec3.scale([],r.ab.vec3.sub([],r.ab.vec3.add([],y,d),n),2));n[0]=b[0],n[1]=b[1]}return n}}function il(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class vd{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qf(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Gn,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),r.aP(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,b,T]of this._listeners){const I=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(b,I,T)}}destroy(){for(const[t,n,d]of this._listeners){const y=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(n,y,d)}}_addDefaultHandlers(t){const n=this._map,d=n.getCanvasContainer();this._add("mapEvent",new _h(n,t));const y=n.boxZoom=new Sn(n,t);this._add("boxZoom",y);const b=new Su,T=new zl;n.doubleClickZoom=new tl(T,b),this._add("tapZoom",b),this._add("clickZoom",T);const I=new ma;this._add("tapDragZoom",I);const F=n.touchPitch=new Tu(n);this._add("touchPitch",F);const V=new pa(t),j=new xh(t);n.dragRotate=new Km(t,V,j),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);const G=new da(t),q=new Pn(n,t);n.dragPan=new Zm(d,G,q),this._add("mousePan",G),this._add("touchPan",q,["touchZoom","touchRotate"]);const Q=new Tc,ce=new Ur;n.touchZoomRotate=new Fl(d,ce,Q,I),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",ce,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Yf(n));const ae=n.scrollZoom=new fa(n,this);this._add("scrollZoom",ae,["mousePan"]);const de=n.keyboard=new Mu;this._add("keyboard",de);for(const pe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[pe]&&n[pe].enable(t[pe])}_add(t,n,d){this._handlers.push({handlerName:t,handler:n,allowed:d}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!yd(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,n,d){for(const y in t)if(y!==d&&(!n||n.indexOf(y)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const n=[];for(const d of t)this._el.contains(d.target)&&n.push(d);return n}handleEvent(t,n){this._updatingCamera=!0;const d=t.type==="renderFrame",y=d?void 0:t,b={needsRenderFrame:!1},T={},I={},F=t.touches?this._getMapTouches(t.touches):void 0,V=F?qt(this._el,F):d?void 0:Tt(this._el,t);for(const{handlerName:q,handler:Q,allowed:ce}of this._handlers){if(!Q.isEnabled())continue;let ae;this._blockedByActive(I,ce,q)?Q.reset():Q[n||t.type]&&(ae=Q[n||t.type](t,V,F),this.mergeHandlerResult(b,T,ae,q,y),ae&&ae.needsRenderFrame&&this._triggerRenderFrame()),(ae||Q.isActive())&&(I[q]=Q)}const j={};for(const q in this._previousActiveHandlers)I[q]||(j[q]=y);this._previousActiveHandlers=I,(Object.keys(j).length||il(b))&&(this._changes.push([b,T,j]),this._triggerRenderFrame()),(Object.keys(I).length||il(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=b;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))}mergeHandlerResult(t,n,d,y,b){if(!d)return;r.l(t,d);const T={handlerName:y,originalEvent:d.originalEvent||b};d.zoomDelta!==void 0&&(n.zoom=T),d.panDelta!==void 0&&(n.drag=T),d.pitchDelta!==void 0&&(n.pitch=T),d.bearingDelta!==void 0&&(n.rotate=T)}_applyChanges(){const t={},n={},d={};for(const[y,b,T]of this._changes)y.panDelta&&(t.panDelta=(t.panDelta||new r.P(0,0))._add(y.panDelta)),y.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(t.around=y.around),y.aroundCoord!==void 0&&(t.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(t.pinchAround=y.pinchAround),y.noInertia&&(t.noInertia=y.noInertia),r.l(n,b),r.l(d,T);this._updateMapTransform(t,n,d),this._changes=[]}_updateMapTransform(t,n,d){const y=this._map,b=y.transform,T=Te=>[Te.x,Te.y,Te.z];if((Te=>{const ke=this._eventsInProgress.drag;return ke&&!this._handlersById[ke.handlerName].isActive()})()&&!il(t)){const Te=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),Te!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&y._stop(!0),!il(t))return void this._fireEvents(n,d,!0);let{panDelta:I,zoomDelta:F,bearingDelta:V,pitchDelta:j,around:G,aroundCoord:q,pinchAround:Q}=t;b._isCameraConstrained&&(F>0&&(F=0),b._isCameraConstrained=!1),Q!==void 0&&(G=Q),(F||(Te=>n[Te]&&!this._eventsInProgress[Te])("drag"))&&G&&(this._dragOrigin=T(b.pointCoordinate3D(G)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",y._stop(!0),G=G||y.transform.centerPoint,V&&(b.bearing+=V),j&&(b.pitch+=j),b._updateCameraState();const ce=[0,0,0];if(I)if(b.projection.name==="mercator"){const Te=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(G).dir),ke=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(G.sub(I)).dir);ce[0]=ke[0]-Te[0],ce[1]=ke[1]-Te[1]}else{const Te=b.pointCoordinate(G);if(b.projection.name==="globe"){I=I.rotate(-b.angle);const ke=b._pixelsPerMercatorPixel/b.worldSize;ce[0]=-I.x*r.dB(r.aS(Te.y))*ke,ce[1]=-I.y*r.dB(b.center.lat)*ke}else{const ke=b.pointCoordinate(G.sub(I));Te&&ke&&(ce[0]=ke.x-Te.x,ce[1]=ke.y-Te.y)}}const ae=b.zoom,de=[0,0,0];if(F){const Te=T(q||b.pointCoordinate3D(G)),ke={dir:r.ab.vec3.normalize([],r.ab.vec3.sub([],Te,b._camera.position))};if(ke.dir[2]<0){const De=b.zoomDeltaToMovement(Te,F);r.ab.vec3.scale(de,ke.dir,De)}}const pe=r.ab.vec3.add(ce,ce,de);b._translateCameraConstrained(pe),F&&Math.abs(b.zoom-ae)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,d,!0)}_fireEvents(t,n,d){const y=yd(this._eventsInProgress),b=yd(t),T={};for(const j in t){const{originalEvent:G}=t[j];this._eventsInProgress[j]||(T[`${j}start`]=G),this._eventsInProgress[j]=t[j]}!y&&b&&this._fireEvent("movestart",b.originalEvent);for(const j in T)this._fireEvent(j,T[j]);b&&this._fireEvent("move",b.originalEvent);for(const j in t){const{originalEvent:G}=t[j];this._fireEvent(j,G)}const I={};let F;for(const j in this._eventsInProgress){const{handlerName:G,originalEvent:q}=this._eventsInProgress[j];this._handlersById[G].isActive()||(delete this._eventsInProgress[j],F=n[G]||q,I[`${j}end`]=F)}for(const j in I)this._fireEvent(j,I[j]);const V=yd(this._eventsInProgress);if(d&&(y||b)&&!V){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),G=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;j?(G(j.bearing||this._map.getBearing())&&(j.bearing=0),this._map.easeTo(j,{originalEvent:F})):(this._map.fire(new r.z("moveend",{originalEvent:F})),G(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new r.z(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Zf("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const xd="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Cu extends r.E{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=n.respectPrefersReducedMotion!==!1,r.aP(["_renderFrameCallback"],this)}getCenter(){return new r.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,d){return t=r.P.convert(t).mult(-1),this.panTo(this.transform.center,r.l({offset:t},n),d)}panTo(t,n,d){return this.easeTo(r.l({center:t},n),d)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,d){return this.easeTo(r.l({zoom:t},n),d)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,d){return this.easeTo(r.l({bearing:t},n),d)}resetNorth(t,n){return this.rotateTo(0,r.l({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(r.l({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=r.az.convert(t);const d=n&&n.bearing||0,y=n&&n.pitch||0,b=t.getNorthWest(),T=t.getSouthEast();return this._cameraForBounds(this.transform,b,T,d,y,n)}_extendPadding(t){const n={top:0,right:0,bottom:0,left:0};return t==null?r.l({},n,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:r.l({},n,t)}_extendCameraOptions(t){return(t=r.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,n){const d=n.max[0]-n.min[0],y=n.max[1]-n.min[1];return d/y>t.aspect?d/(2*Math.tan(.5*t.fovX)*t.aspect):y/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,n,d,y,b,T){const I=t.clone(),F=this._extendCameraOptions(T);I.bearing=y,I.pitch=b;const V=r.bO.convert(n),j=r.bO.convert(d),G=.5*(V.lat+j.lat),q=.5*(V.lng+j.lng),Q=r.dC(G,q),ce=r.ab.vec3.normalize([],Q),ae=r.ab.vec3.normalize([],r.ab.vec3.cross([],ce,[0,1,0])),de=r.ab.vec3.cross([],ae,ce),pe=[ae[0],ae[1],ae[2],0,de[0],de[1],de[2],0,ce[0],ce[1],ce[2],0,0,0,0,1],Te=[Q,r.dC(V.lat,V.lng),r.dC(j.lat,V.lng),r.dC(j.lat,j.lng),r.dC(V.lat,j.lng),r.dC(G,V.lng),r.dC(G,j.lng),r.dC(V.lat,q),r.dC(j.lat,q)];let ke=r.cd.fromPoints(Te.map(bt=>[r.ab.vec3.dot(ae,bt),r.ab.vec3.dot(de,bt),r.ab.vec3.dot(ce,bt)]));const De=r.ab.vec3.transformMat4([],ke.center,pe);r.ab.vec3.squaredLength(De)===0&&r.ab.vec3.set(De,0,0,1),r.ab.vec3.normalize(De,De),r.ab.vec3.scale(De,De,r.ax),I.center=r.dD(De);const Ue=I.getWorldToCameraMatrix(),Le=r.ab.mat4.invert(new Float64Array(16),Ue);ke=r.cd.applyTransform(ke,r.ab.mat4.multiply([],Ue,pe));const Ne=this._extendAABB(ke,I,F,y);if(!Ne)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ke=Ne,r.ab.vec3.transformMat4(De,De,Ue);const Oe=.5*(ke.max[2]-ke.min[2]),We=this._minimumAABBFrustumDistance(I,ke),Qe=r.ab.vec3.scale([],[0,0,1],Oe),xt=r.ab.vec3.add(Qe,De,Qe),ut=We+(I.pitch===0?0:r.ab.vec3.distance(De,xt)),Dt=I.globeCenterInViewSpace,At=r.ab.vec3.sub([],De,[Dt[0],Dt[1],Dt[2]]);r.ab.vec3.normalize(At,At),r.ab.vec3.scale(At,At,ut);const ot=r.ab.vec3.add([],De,At);r.ab.vec3.transformMat4(ot,ot,Le);const wt=r.ds/r.ax,Vt=r.ab.vec3.length(ot),st=r.bH(Math.max(Vt*wt-r.ds,Number.EPSILON),0),It=Math.min(I.zoomFromMercatorZAdjusted(st),F.maxZoom);return It>.5*(r.c6+r.bY)?(I.setProjection({name:"mercator"}),I.zoom=It,this._cameraForBounds(I,n,d,y,b,T)):{center:I.center,zoom:It,bearing:y,pitch:b}}_extendAABB(t,n,d,y){const b=.5*((d.padding.left||0)+(d.padding.right||0)),T=.5*((d.padding.top||0)+(d.padding.bottom||0)),I=T,F=b,V=b,j=T,G=n.width-(F+V),q=n.height-(I+j),Q=r.ab.vec3.sub([],t.max,t.min),ce=Math.min(G/Q[0],q/Q[1]),ae=Math.min(n.scaleZoom(n.scale*ce),d.maxZoom);if(isNaN(ae))return null;const de=n.scale/n.zoomScale(ae),pe=new r.cd([t.min[0]-F*de,t.min[1]-j*de,t.min[2]],[t.max[0]+V*de,t.max[1]+I*de,t.max[2]]),Te=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new r.P(d.offset.x,d.offset.y):r.P.convert(d.offset)).rotate(-r.ai(y));return pe.center[0]-=Te.x*de,pe.center[1]+=Te.y*de,pe}queryTerrainElevation(t,n){const d=this.transform.elevation;return d?(n=r.l({},{exaggerated:!0},n),d.getAtPoint(r.aa.fromLngLat(t),null,n.exaggerated)):null}_cameraForBounds(t,n,d,y,b,T){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,n,d,y,b,T);const I=t.clone(),F=this._extendCameraOptions(T);I.bearing=y,I.pitch=b;const V=r.bO.convert(n),j=r.bO.convert(d),G=new r.bO(V.lng,j.lat),q=new r.bO(j.lng,V.lat),Q=I.project(V),ce=I.project(j),ae=this.queryTerrainElevation(V),de=this.queryTerrainElevation(j),pe=this.queryTerrainElevation(G),Te=this.queryTerrainElevation(q),ke=[[Q.x,Q.y,Math.min(ae||0,de||0,pe||0,Te||0)],[ce.x,ce.y,Math.max(ae||0,de||0,pe||0,Te||0)]];let De=r.cd.fromPoints(ke);const Ue=I.getWorldToCameraMatrix(),Le=r.ab.mat4.invert(new Float64Array(16),Ue);De=r.cd.applyTransform(De,Ue);const Ne=this._extendAABB(De,I,F,y);if(!Ne)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");De=Ne;const Oe=.5*r.ab.vec3.sub([],De.max,De.min)[2],We=this._minimumAABBFrustumDistance(I,De),Qe=[0,0,1,0];r.ab.vec4.transformMat4(Qe,Qe,Ue),r.ab.vec4.normalize(Qe,Qe);const xt=r.ab.vec3.scale([],Qe,We+Oe),ut=r.ab.vec3.add([],De.center,xt);r.ab.vec3.transformMat4(De.center,De.center,Le),r.ab.vec3.transformMat4(ut,ut,Le);const Dt=I.unproject(new r.P(De.center[0],De.center[1])),At=r.dE(I.projection,Dt),ot=Math.pow(2,At),wt=Math.min(I._zoomFromMercatorZ(ut[2]*I.pixelsPerMeter*ot/I.worldSize),F.maxZoom);return I.mercatorFromTransition&&wt<.5*(r.c6+r.bY)?(I.setProjection({name:"globe"}),I.zoom=wt,this._cameraForBounds(I,n,d,y,b,T)):{center:Dt,zoom:wt,bearing:y,pitch:b}}fitBounds(t,n,d){const y=this.cameraForBounds(t,n);return this._fitInternal(y,n,d)}fitScreenCoordinates(t,n,d,y,b){const T=r.P.convert(t),I=r.P.convert(n),F=new r.P(Math.min(T.x,I.x),Math.min(T.y,I.y)),V=new r.P(Math.max(T.x,I.x),Math.max(T.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,I))return this;const j=this.transform.pointLocation3D(F),G=this.transform.pointLocation3D(V),q=this.transform.pointLocation3D(new r.P(F.x,V.y)),Q=this.transform.pointLocation3D(new r.P(V.x,F.y)),ce=[Math.min(j.lng,G.lng,q.lng,Q.lng),Math.min(j.lat,G.lat,q.lat,Q.lat)],ae=[Math.max(j.lng,G.lng,q.lng,Q.lng),Math.max(j.lat,G.lat,q.lat,Q.lat)],de=y&&y.pitch?y.pitch:this.getPitch(),pe=this._cameraForBounds(this.transform,ce,ae,d,de,y);return this._fitInternal(pe,y,b)}_fitInternal(t,n,d){return t?(n=r.l(t,n)).linear?this.easeTo(n,d):this.flyTo(n,d):this}jumpTo(t,n){this.stop();const d=t.preloadOnly?this.transform.clone():this.transform;let y=!1,b=!1,T=!1;"zoom"in t&&d.zoom!==+t.zoom&&(y=!0,d.zoom=+t.zoom),t.center!==void 0&&(d.center=r.bO.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(b=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(T=!0,d.pitch=+t.pitch);const I=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!d.isPaddingEqual(I))if(t.retainPadding===!1){const F=d.clone();F.padding=I,d.setLocationAtPoint(d.center,F.centerPoint)}else d.padding=I;return t.preloadOnly?(this._preloadTiles(d),this):(this.fire(new r.z("movestart",n)).fire(new r.z("move",n)),y&&this.fire(new r.z("zoomstart",n)).fire(new r.z("zoom",n)).fire(new r.z("zoomend",n)),b&&this.fire(new r.z("rotatestart",n)).fire(new r.z("rotate",n)).fire(new r.z("rotateend",n)),T&&this.fire(new r.z("pitchstart",n)).fire(new r.z("pitch",n)).fire(new r.z("pitchend",n)),this.fire(new r.z("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(xd),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){const d=this.transform;if(!d.projection.supportsFreeCamera)return r.w(xd),this;this.stop();const y=d.zoom,b=d.pitch,T=d.bearing;d.setFreeCameraOptions(t);const I=y!==d.zoom,F=b!==d.pitch,V=T!==d.bearing;return this.fire(new r.z("movestart",n)).fire(new r.z("move",n)),I&&this.fire(new r.z("zoomstart",n)).fire(new r.z("zoom",n)).fire(new r.z("zoomend",n)),V&&this.fire(new r.z("rotatestart",n)).fire(new r.z("rotate",n)).fire(new r.z("rotateend",n)),F&&this.fire(new r.z("pitchstart",n)).fire(new r.z("pitch",n)).fire(new r.z("pitchend",n)),this.fire(new r.z("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),((t=r.l({offset:[0,0],duration:500,easing:r.dA},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const d=this.transform,y=this.getZoom(),b=this.getBearing(),T=this.getPitch(),I=this.getPadding(),F="zoom"in t?+t.zoom:y,V="bearing"in t?this._normalizeBearing(t.bearing,b):b,j="pitch"in t?+t.pitch:T,G=this._extendPadding(t.padding),q=r.P.convert(t.offset);let Q,ce,ae;if(d.projection.name==="globe"){const Qe=r.aa.fromLngLat(d.center),xt=q.rotate(-d.angle);Qe.x+=xt.x/d.worldSize,Qe.y+=xt.y/d.worldSize;const ut=Qe.toLngLat(),Dt=r.bO.convert(t.center||ut);this._normalizeCenter(Dt),Q=d.centerPoint.add(xt),ce=new r.P(Qe.x,Qe.y).mult(d.worldSize),ae=new r.P(r.at(Dt.lng),r.aA(Dt.lat)).mult(d.worldSize).sub(ce)}else{Q=d.centerPoint.add(q);const Qe=d.pointLocation(Q),xt=r.bO.convert(t.center||Qe);this._normalizeCenter(xt),ce=d.project(Qe),ae=d.project(xt).sub(ce)}const de=d.zoomScale(F-y);let pe,Te;t.around&&(pe=r.bO.convert(t.around),Te=d.locationPoint(pe));const ke=this._zooming||F!==y,De=this._rotating||b!==V,Ue=this._pitching||j!==T,Le=!d.isPaddingEqual(G),Ne=t.retainPadding===!1?d.clone():d,Oe=Qe=>xt=>{if(ke&&(Qe.zoom=r.af(y,F,xt)),De&&(Qe.bearing=r.af(b,V,xt)),Ue&&(Qe.pitch=r.af(T,j,xt)),Le&&(Ne.interpolatePadding(I,G,xt),Q=Ne.centerPoint.add(q)),pe)Qe.setLocationAtPoint(pe,Te);else{const ut=Qe.zoomScale(Qe.zoom-y),Dt=F>y?Math.min(2,de):Math.max(.5,de),At=Math.pow(Dt,1-xt),ot=Qe.unproject(ce.add(ae.mult(xt*At)).mult(ut));Qe.setLocationAtPoint(Qe.renderWorldCopies?ot.wrap():ot,Q)}return t.preloadOnly||this._fireMoveEvents(n),Qe};if(t.preloadOnly){const Qe=this._emulate(Oe,t.duration,d);return this._preloadTiles(Qe),this}const We={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ke,this._rotating=De,this._pitching=Ue,this._padding=Le,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,We),this._ease(Oe(d),Qe=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(n,Qe)},t),this}_prepareEase(t,n,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),n||d.moving||this.fire(new r.z("movestart",t)),this._zooming&&!d.zooming&&this.fire(new r.z("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new r.z("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new r.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new r.z("move",t)),this._zooming&&this.fire(new r.z("zoom",t)),this._rotating&&this.fire(new r.z("rotate",t)),this._pitching&&this.fire(new r.z("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,y=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new r.z("zoomend",t)),y&&this.fire(new r.z("rotateend",t)),b&&this.fire(new r.z("pitchend",t)),this.fire(new r.z("moveend",t))}flyTo(t,n){if(this._prefersReducedMotion(t)){const bt=r.ay(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(bt,n)}this.stop(),t=r.l({offset:[0,0],speed:1.2,curve:1.42,easing:r.dA},t);const d=this.transform,y=this.getZoom(),b=this.getBearing(),T=this.getPitch(),I=this.getPadding(),F="zoom"in t?r.aw(+t.zoom,d.minZoom,d.maxZoom):y,V="bearing"in t?this._normalizeBearing(t.bearing,b):b,j="pitch"in t?+t.pitch:T,G=this._extendPadding(t.padding),q=d.zoomScale(F-y),Q=r.P.convert(t.offset);let ce=d.centerPoint.add(Q);const ae=d.pointLocation(ce),de=r.bO.convert(t.center||ae);this._normalizeCenter(de);const pe=d.project(ae),Te=d.project(de).sub(pe);let ke=t.curve;const De=Math.max(d.width,d.height),Ue=De/q,Le=Te.mag();if("minZoom"in t){const bt=r.aw(Math.min(t.minZoom,y,F),d.minZoom,d.maxZoom),Kt=De/d.zoomScale(bt-y);ke=Math.sqrt(Kt/Le*2)}const Ne=ke*ke;function Oe(bt){const Kt=(Ue*Ue-De*De+(bt?-1:1)*Ne*Ne*Le*Le)/(2*(bt?Ue:De)*Ne*Le);return Math.log(Math.sqrt(Kt*Kt+1)-Kt)}function We(bt){return(Math.exp(bt)-Math.exp(-bt))/2}function Qe(bt){return(Math.exp(bt)+Math.exp(-bt))/2}const xt=Oe(0);let ut=function(bt){return Qe(xt)/Qe(xt+ke*bt)},Dt=function(bt){return De*((Qe(xt)*(We(Kt=xt+ke*bt)/Qe(Kt))-We(xt))/Ne)/Le;var Kt},At=(Oe(1)-xt)/ke;if(Math.abs(Le)<1e-6||!isFinite(At)){if(Math.abs(De-Ue)<1e-6)return this.easeTo(t,n);const bt=Ue<De?-1:1;At=Math.abs(Math.log(Ue/De))/ke,Dt=function(){return 0},ut=function(Kt){return Math.exp(bt*ke*Kt)}}t.duration="duration"in t?+t.duration:1e3*At/("screenSpeed"in t?+t.screenSpeed/ke:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const ot=b!==V,wt=j!==T,Vt=!d.isPaddingEqual(G),st=t.retainPadding===!1?d.clone():d,It=bt=>Kt=>{const Bt=Kt*At,kt=1/ut(Bt);bt.zoom=Kt===1?F:y+bt.scaleZoom(kt),ot&&(bt.bearing=r.af(b,V,Kt)),wt&&(bt.pitch=r.af(T,j,Kt)),Vt&&(st.interpolatePadding(I,G,Kt),ce=st.centerPoint.add(Q));const $t=Kt===1?de:bt.unproject(pe.add(Te.mult(Dt(Bt))).mult(kt));return bt.setLocationAtPoint(bt.renderWorldCopies?$t.wrap():$t,ce),bt._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(n),bt};if(t.preloadOnly){const bt=this._emulate(It,t.duration,d);return this._preloadTiles(bt),this}return this._zooming=!0,this._rotating=ot,this._pitching=wt,this._padding=Vt,this._prepareEase(n,!1),this._ease(It(d),()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,n)}if(!t){const d=this.handlers;d&&d.stop(!1)}return this}_ease(t,n,d){d.animate===!1||d.duration===0?(t(1),n()):(this._easeStart=r.q.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((r.q.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=r.bF(t,-180,180);const d=Math.abs(t-n);return Math.abs(t-360-n)<d&&(t-=360),Math.abs(t+360-n)<d&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(n.maxBounds||n.projection.name!=="globe"&&!n.renderWorldCopies)return;const d=t.lng-n.center.lng;t.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&r.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,n,d){const y=Math.ceil(15*n/1e3),b=[],T=t(d.clone());for(let I=0;I<=y;I++){const F=T(I/y);b.push(F.clone())}return b}_preloadTiles(t,n){}}class bh{constructor(t={}){this.options=t,r.aP(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const n=this.options&&this.options.compact,d=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ae("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);const y=Ae("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",d),this._innerContainer=Ae("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),n===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(t){const d=n.reduce((y,b,T)=>(b.value&&(y+=`${b.key}=${b.value}${T<n.length-1?"&":""}`),y),"?");t.href=`${r.e.FEEDBACK_URL}/${d}#${Ap(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const n=this._map.style._mergedSourceCaches;for(const y in n){const b=n[y];if(b.used){const T=b.getSource();T.attribution&&t.indexOf(T.attribution)<0&&t.push(T.attribution)}}t.sort((y,b)=>y.length-b.length),t=t.filter((y,b)=>{for(let T=b+1;T<t.length;T++)if(t[T].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const d=t.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Mo{constructor(){r.aP(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Ae("div","mapboxgl-ctrl");const n=Ae("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const n in t){const d=t[n].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const n=t[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class No{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,d=n?this._queue.concat(n):this._queue;for(const y of d)if(y.id===t)return void(y.cancelled=!0)}run(t=0){const n=this._currentlyRunning=this._queue;this._queue=[];for(const d of n)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Mc{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=r.cB((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,n,d){this._start=this.getValue(n),this._end=t,this._startTime=n,this._endTime=n+d}}const ga={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Cc extends r.z{constructor(t,n,d,y){const{point:b,lngLat:T,originalEvent:I,target:F}=t;super(t.type,{point:b,lngLat:T,originalEvent:I,target:F}),this.preventDefault=()=>{t.preventDefault()},this.id=n,this.interaction=d,this.feature=y}}class Op{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,n){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const d=n.filter;let y=n.type;d&&this.filters.set(t,r.aZ(d)),y==="mouseover"&&(y="mouseenter"),y==="mouseout"&&(y="mouseleave");const b=this.interactionsByType.get(y)||new Map;y==="mouseenter"||y==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,n)):b.size===0&&this.map.on(y,this.handleType),b.size===0&&this.interactionsByType.set(y,b),b.set(t,n),this.typeById.set(t,y)}get(t){const n=this.typeById.get(t);if(!n)return;const d=this.interactionsByType.get(n);return d?d.get(t):void 0}remove(t){const n=this.typeById.get(t);if(!n)return;this.typeById.delete(t),this.filters.delete(t);const d=this.interactionsByType.get(n);d&&(d.delete(t),n==="mouseenter"||n==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):d.size===0&&this.map.off(n,this.handleType))}queryTargets(t,n){const d=[];for(const[y,b]of n)b.target&&d.push({targetId:y,target:b.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(t,d,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const n=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());n.length&&(t.type="mouseenter",this.handleType(t,n));const d=new Map;for(const[y,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(y)||d.set(b.id,b);d.size&&(t.type="mouseleave",this.handleType(t,Array.from(d.values())))}handleOut(t){const n=Array.from(this.hoveredFeatures.values()).map(({feature:d})=>d);n.length&&(t.type="mouseleave",this.handleType(t,n)),this.hoveredFeatures.clear()}handleType(t,n){const d=Array.from(this.interactionsByType.get(t.type)).reverse(),y=!!n;n=n||this.queryTargets(t.point,d);const b=t.type==="mouseenter";let T=!1;const I=new Set;for(const F of n){for(const[V,j]of d){if(!j.target)continue;const G=F.variants?F.variants[V]:null;if(G){for(const q of G){if(Wo(q,F,I,V))continue;const Q=new r.cw(F,q),ce=Hc(q,F,V);y&&(Q.state=this.map.getFeatureState(Q));const ae=b?this.prevHoveredFeatures.get(ce):null,de=new Cc(t,V,j,Q),pe=ae?ae.stop:j.handler(de);if(b&&this.hoveredFeatures.set(ce,{feature:F,stop:pe}),pe!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[F,V]of d){const{handler:j,target:G}=V;if(!G&&j(new Cc(t,F,V,null))!==!1)break}}}function Cr(u,t){if(Array.isArray(u)&&Array.isArray(t)){const n=new Set(u),d=new Set(t);return n.size===d.size&&u.every(y=>d.has(y))}return r.bn(u,t)}const rl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Lp={showCompass:!0,showZoom:!0,visualizePitch:!1};class Rp{constructor(t,n,d=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new pa({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,d&&(this.mousePitch=new xh({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),r.aP(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(t,n){this.mouseRotate.mousedown(t,n),this.mousePitch&&this.mousePitch.mousedown(t,n),tt()}move(t,n){const d=this.map,y=this.mouseRotate.mousemoveWindow(t,n),b=y&&y.bearingDelta;if(b&&d.setBearing(d.getBearing()+b),this.mousePitch){const T=this.mousePitch.mousemoveWindow(t,n),I=T&&T.pitchDelta;I&&d.setPitch(d.getPitch()+I)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){at(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(r.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Tt(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Tt(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=qt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=qt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Bl(u,t,n){if(u=new r.bO(u.lng,u.lat),t){const d=new r.bO(u.lng-360,u.lat),y=new r.bO(u.lng+360,u.lat),b=360*Math.ceil(Math.abs(u.lng-n.center.lng)/360),T=n.locationPoint(u).distSqr(t),I=t.x<0||t.y<0||t.x>n.width||t.y>n.height;n.locationPoint(d).distSqr(t)<T&&(I||Math.abs(d.lng-n.center.lng)<b)?u=d:n.locationPoint(y).distSqr(t)<T&&(I||Math.abs(y.lng-n.center.lng)<b)&&(u=y)}for(;Math.abs(u.lng-n.center.lng)>180;){const d=n.locationPoint(u);if(d.x>=0&&d.y>=0&&d.x<=n.width&&d.y<=n.height)break;u.lng>n.center.lng?u.lng-=360:u.lng+=360}return u}const _a={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ya extends r.E{constructor(t,n){if(super(),(t instanceof HTMLElement||n)&&(t=r.l({element:t},n)),r.aP(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=r.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ae("div");const b=41,T=27,I=Re("svg",{display:"block",height:b*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${b}`},this._element),F=Re("radialGradient",{id:"shadowGradient"},Re("defs",{},I));Re("stop",{offset:"10%","stop-opacity":.4},F),Re("stop",{offset:"100%","stop-opacity":.05},F),Re("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),Re("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),Re("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),Re("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=r.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const d=this._element.classList;for(const b in _a)d.remove(`mapboxgl-marker-anchor-${b}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`);const y=t&&t.className?t.className.trim().split(/\s+/):[];d.add(...y),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=r.bO.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const n=t.code,d=t.charCode||t.keyCode;n!=="Space"&&n!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(t){const n=t.originalEvent.target,d=this._element;this._popup&&(n===d||d.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,n=this._pos;if(!t||!n)return!1;const d=t.unproject(n),y=t.getFreeCameraOptions();if(!y.position)return!1;const b=y.position.toLngLat();return b.distanceTo(d)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const n=this._pos;if(!n||n.x<0||n.x>t.transform.width||n.y<0||n.y>t.transform.height)return void this._clearFadeTimer();const d=t.unproject(n);let y;t._showingGlobe()&&r.dH(t.transform,this._lngLat)?y=0:(y=1-t._queryFogOpacity(d),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const n=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${_a[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${n.x}px,${n.y}px)
        `}_calculateXYTransform(){const t=this._pos,n=this._map,d=this.getPitchAlignment();if(!n||!t||d!=="map")return"";if(!n._showingGlobe()){const F=n.getPitch();return F?`rotateX(${F}deg)`:""}const y=r.c4(r.dI(n.transform,this._lngLat)),b=t.sub(r.dJ(n.transform)),T=Math.abs(b.x)+Math.abs(b.y);if(T===0)return"";const I=y/T;return`rotateX(${-b.y*I}deg) rotateY(${b.x*I}deg)`}_calculateZTransform(){const t=this._pos,n=this._map;if(!n||!t)return"";let d=0;const y=this.getRotationAlignment();if(y==="map")if(n._showingGlobe()){const b=n.project(new r.bO(this._lngLat.lng,this._lngLat.lat+.001)),T=n.project(new r.bO(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);d=r.c4(Math.atan2(T.y,T.x))-90}else d=-n.getBearing();else if(y==="horizon"){const b=r.ac(4,6,n.getZoom()),T=r.dJ(n.transform);T.y+=b*n.transform.height;const I=t.sub(T),F=r.c4(Math.atan2(I.y,I.x));d=(F>90?F-270:F+90)*(1-b)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=Bl(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=r.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const n=this._map;if(!n)return;const d=this._pointerdownPos,y=this._positionDelta;if(d&&y){if(!this._isDragging){const b=this._clickTolerance||n._clickTolerance;if(t.point.dist(d)<b)return;this._isDragging=!0}this._pos=t.point.sub(y),this._lngLat=n.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(t){const n=this._map,d=this._pos;n&&d&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(d),this._pointerdownPos=t.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const n=this._map;return n&&(t?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const to={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},co={maxWidth:100,unit:"metric"},Wn={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},zp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},uo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Fp(u=new r.P(0,0),t="bottom"){if(typeof u=="number"){const n=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(t){case"top":return new r.P(0,u);case"top-left":return new r.P(n,n);case"top-right":return new r.P(-n,n);case"bottom":return new r.P(0,-u);case"bottom-left":return new r.P(n,-n);case"bottom-right":return new r.P(-n,-n);case"left":return new r.P(u,0);case"right":return new r.P(-u,0)}return new r.P(0,0)}return u instanceof r.P||Array.isArray(u)?r.P.convert(u):r.P.convert(u[t]||[0,0])}return{version:W,supported:xe.supported,setRTLTextPlugin:r.dK,getRTLTextPluginStatus:r.dL,Map:class extends Cu{constructor(u){oe.mark(ie.create);const t=u;if((u=r.l({},rl,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&r.dF(window)&&(u.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new za(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),u),this._repaint=!!u.repaint,this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new No,this._domRenderTaskQueue=new No,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.aV(),this._locale=r.l({},ga,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._tessellationStep=u.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=u.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Mc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=u.scaleFactor,this._requestManager=new ni(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,this._contextCreateOptions=u.contextCreateOptions?Object.assign({},u.contextCreateOptions):{},typeof u.container=="string"){const n=document.getElementById(u.container);if(!n)throw new Error(`Container '${u.container.toString()}' not found.`);this._container=n}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),this._spriteFormat=u.spriteFormat,r.aP(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Tp),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new vd(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,(u.style||!u.testMode)&&this.setStyle(u.style||r.e.DEFAULT_STYLE,{config:u.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),this.indoor=new op(this),u.hash&&(this._hash=new Gf(typeof u.hash=="string"&&u.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch});const n=u.bounds;n&&(this.resize(),this.fitBounds(n,r.l({},u.fitBoundsOptions,{duration:0})))}this.resize(),u.attributionControl&&this.addControl(new bh({customAttribution:u.customAttribution})),this._logoControl=new Mo,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new r.z(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new r.z(`${n.dataType}dataloading`,n))}),this._interactions=new Op(this)}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=u.onAdd(this);this._controls.push(u);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(n,d.firstChild):d.appendChild(n),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new r.z("movestart",u)).fire(new r.z("move",u)),this.fire(new r.z("resize",u)),t&&this.fire(new r.z("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(r.az.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(u){return this._scaleFactor=u,this.painter.scaleFactor=u,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(t=>t==="auto"?navigator.language:t):u}setLanguage(u){const t=this._parseLanguage(u);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const u=this.transform,t=u.projection.name;let n;t==="globe"&&u.zoom>=r.bY?(u.setMercatorFromTransition(),n=!0):t==="mercator"&&u.zoom<r.bY&&(u.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(u,t){return this._updateProjection(u||t||{name:"mercator"})}_updateProjection(u){let t;return t=u.name==="globe"&&this.transform.zoom>=r.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(u){return this.transform.locationPoint3D(r.bO.convert(u))}unproject(u){return this.transform.pointLocation3D(r.P.convert(u))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,t,n){const d=y=>{let b=[];if(Array.isArray(t)){const T=t.filter(I=>this.getLayer(I));b=T.length?this.queryRenderedFeatures(y,{layers:T}):[]}else b=this.queryRenderedFeatures(y,{target:t});return b};if(u==="mouseenter"||u==="mouseover"){let y=!1;return{listener:n,targets:t,delegates:{mousemove:T=>{const I=d(T.point);I.length?y||(y=!0,n.call(this,new So(u,this,T.originalEvent,{features:I}))):y=!1},mouseout:()=>{y=!1}}}}if(u==="mouseleave"||u==="mouseout"){let y=!1;return{listener:n,targets:t,delegates:{mousemove:I=>{d(I.point).length?y=!0:y&&(y=!1,n.call(this,new So(u,this,I.originalEvent)))},mouseout:I=>{y&&(y=!1,n.call(this,new So(u,this,I.originalEvent)))}}}}{const y=b=>{const T=d(b.point);T.length&&(b.features=T,n.call(this,b),delete b.features)};return{listener:n,targets:t,delegates:{[u]:y}}}}on(u,t,n){if(typeof t=="function"||n===void 0)return super.on(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(u,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(d);for(const y in d.delegates)this.on(y,d.delegates[y]);return this}once(u,t,n){if(typeof t=="function"||n===void 0)return super.once(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(u,t,n);for(const y in d.delegates)this.once(y,d.delegates[y]);return this}off(u,t,n){if(typeof t=="function"||n===void 0)return super.off(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._delegatedListeners?this._delegatedListeners[u]:void 0;return d&&(y=>{for(let b=0;b<y.length;b++){const T=y[b];if(T.listener===n&&Cr(T.targets,t)){for(const I in T.delegates)this.off(I,T.delegates[I]);return y.splice(b,1),this}}})(d),this}queryRenderedFeatures(u,t){if(!this.style)return[];if(u===void 0||u instanceof r.P||Array.isArray(u)||t!==void 0||(t=u,u=void 0),u=u||[[0,0],[this.transform.width,this.transform.height]],!t){const b=this.style.queryRenderedFeatures(u,void 0,this.transform),T=this.style.queryRenderedFeatureset(u,void 0,this.transform);return b.concat(T)}let n=!0;if(t.target&&(n=this._isTargetValid(t.target),n&&!t.layers))return this.style.queryRenderedFeatureset(u,t,this.transform);let d=!0;if(t.layers&&Array.isArray(t.layers)){for(const b of t.layers)if(!this._isValidId(b)){d=!1;break}if(d&&!t.target)return this.style.queryRenderedFeatures(u,t,this.transform)}let y=[];return d&&(y=y.concat(this.style.queryRenderedFeatures(u,t,this.transform))),n&&(y=y.concat(this.style.queryRenderedFeatureset(u,t,this.transform))),y}querySourceFeatures(u,t){return!u||typeof u=="string"&&!this._isValidId(u)?[]:this.style.querySourceFeatures(u,t)}isPointOnSurface(u){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&r.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(u))}addInteraction(u,t){return this._interactions.add(u,t),this}removeInteraction(u){return this._interactions.remove(u),this}setStyle(u,t){return t=r.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&u&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(u,(n,d)=>{n?(r.w(`Unable to perform style diff: ${String(n.message||n.error||n)}. Rebuilding the style from scratch.`),this._updateStyle(u,t)):d&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(u,t))}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u){const n=r.l({},t);t&&t.config&&(n.initialConfig=t.config,delete n.config),this.style=new Lo(this,n).load(u),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Lo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(u){return u==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.cr(u)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${u}".`))),!1)}_isTargetValid(u){return"featuresetId"in u?this._isValidId("importId"in u?u.importId:u.featuresetId):"layerId"in u&&this._isValidId(u.layerId)}_areTargetsValid(u){if(Array.isArray(u)){for(const t of u)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(u)}addSource(u,t){return this._isValidId(u)?(this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)):this}isSourceLoaded(u){return!!this._isValidId(u)&&!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(u,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,n)}removeSource(u){return this._isValidId(u)?(this.style.removeSource(u),this._updateTerrain(),this._update(!0)):this}getSource(u){return this._isValidId(u)?this.style.getOwnSource(u):null}addImage(u,t,{pixelRatio:n=1,sdf:d=!1,stretchX:y,stretchY:b,content:T}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:I,height:F,data:V}=r.q.getImageData(t);this.style.addImage(u,{data:new r.r({width:I,height:F},V),pixelRatio:n,stretchX:y,stretchY:b,content:T,sdf:d,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:F}=t,V=t;this.style.addImage(u,{data:new r.r({width:I,height:F},new Uint8Array(V.data)),pixelRatio:n,stretchX:y,stretchY:b,content:T,sdf:d,usvg:!1,version:0,userImage:V}),V.onAdd&&V.onAdd(this,u)}}updateImage(u,t){this._lazyInitEmptyStyle();const n=this.style.getImage(u);if(!n)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?r.q.getImageData(t):t,{width:y,height:b,data:T}=d;if(y===void 0||b===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(n.usvg?n.icon.usvg_tree.width:n.data.width)||b!==(n.usvg?n.icon.usvg_tree.height:n.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${y}, ${b})
                must be that same as the previous version of the image
                (${n.data.width}, ${n.data.height})`)));const I=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let F=!1;n.usvg?(n.data=new r.r({width:y,height:b},new Uint8Array(T)),n.usvg=!1,n.icon=void 0,F=!0):n.data.replace(T,I),this.style.updateImage(u,n,F)}hasImage(u){return u?!!this.style&&!!this.style.getImage(u):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,t){r.o(this._requestManager.transformRequest(u,r.R.Image),(n,d)=>{t(n,d instanceof HTMLImageElement?r.q.getImageData(d):d)})}listImages(){return this.style.listImages()}addModel(u,t){this._lazyInitEmptyStyle(),this.style.addModel(u,t)}hasModel(u){return u?this.style.hasModel(u):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(u){this.style.removeModel(u)}listModels(){return this.style.listModels()}addLayer(u,t){return this._isValidId(u.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)):this}getSlot(u){const t=this.getLayer(u);return t&&t.slot||null}setSlot(u,t){return this.style.setSlot(u,t),this.style.mergeLayers(),this._update(!0)}addImport(u,t){return this.style.addImport(u,t),this}updateImport(u,t){return typeof t!="string"&&t.id!==u?(this.removeImport(u),this.addImport(t)):(this.style.updateImport(u,t),this._update(!0))}removeImport(u){return this.style.removeImport(u),this}moveImport(u,t){return this.style.moveImport(u,t),this._update(!0)}moveLayer(u,t){return this._isValidId(u)?(this.style.moveLayer(u,t),this._update(!0)):this}removeLayer(u){return this._isValidId(u)?(this.style.removeLayer(u),this._update(!0)):this}getLayer(u){if(!this._isValidId(u))return null;const t=this.style.getOwnLayer(u);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(u,t,n){return this._isValidId(u)?(this.style.setLayerZoomRange(u,t,n),this._update(!0)):this}setFilter(u,t,n={}){return this._isValidId(u)?(this.style.setFilter(u,t,n),this._update(!0)):this}getFilter(u){return this._isValidId(u)?this.style.getFilter(u):null}setPaintProperty(u,t,n,d={}){return this._isValidId(u)?(this.style.setPaintProperty(u,t,n,d),this._update(!0)):this}getPaintProperty(u,t){return this._isValidId(u)?this.style.getPaintProperty(u,t):null}setLayoutProperty(u,t,n,d={}){return this._isValidId(u)?(this.style.setLayoutProperty(u,t,n,d),this._update(!0)):this}getLayoutProperty(u,t){return this._isValidId(u)?this.style.getLayoutProperty(u,t):null}getSchema(u){return this.style.getSchema(u)}setSchema(u,t){return this.style.setSchema(u,t),this._update(!0)}getConfig(u){return this.style.getConfig(u)}setConfig(u,t){return this.style.setConfig(u,t),this._update(!0)}getConfigProperty(u,t){return this.style.getConfigProperty(u,t)}setConfigProperty(u,t,n){return this.style.setConfigProperty(u,t,n),this._update(!0)}getFeaturesetDescriptors(u){return this.style.getFeaturesetDescriptors(u)}setLights(u){if(this._lazyInitEmptyStyle(),u&&u.length===1&&u[0].type==="flat"){const t=u[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(u),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const u=this.style.getLights()||[];return u.length===0&&u.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),u}setLight(u,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:u}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(u){return this._lazyInitEmptyStyle(),this.style.setSnow(u),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(u){return this._lazyInitEmptyStyle(),this.style.setRain(u),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(u){return this._lazyInitEmptyStyle(),this.style.setColorTheme(u),this._update(!0)}setImportColorTheme(u,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(u,t),this._update(!0)}setCamera(u){return this.style.setCamera(u),this._triggerCameraUpdate(u)}_triggerCameraUpdate(u){return this._update(this.transform.setOrthographicProjectionAtLowPitch(u["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.bO.convert(u),this.transform):0}setFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.setFeatureState(u,t),this._update())}removeFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.removeFeatureState(u,t),this._update())}getFeatureState(u){return u.source&&!this._isValidId(u.source)?null:this.style.getFeatureState(u)}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let n,d,y,b=this._container;for(;b&&(!d||!y);){const T=window.getComputedStyle(b).transform;T&&T!=="none"&&(n=T.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&n[0]!=="0"&&n[0]!=="1"&&(d=n[0]),n[3]&&n[3]!=="0"&&n[3]!=="1"&&(y=n[3])),b=b.parentElement}this._containerWidth=d?Math.abs(u/d):u,this._containerHeight=y?Math.abs(t/y):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ae("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Ae("div","mapboxgl-canvas-container",u);this._canvas=Ae("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=Ae("div","mapboxgl-control-container",u),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(y=>{d[y]=Ae("div",`mapboxgl-ctrl-${y}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,t){const n=r.q.devicePixelRatio||1;this._canvas.width=n*Math.ceil(u),this._canvas.height=n*Math.ceil(t),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const t=this._markers.indexOf(u);t!==-1&&this._markers.splice(t,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){const t=this._popups.indexOf(u);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const u=r.l({},xe.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",u);t?(Bi(t,!0),this.painter=new Qa(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",n=>{n.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.m.testSupport(t)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let t;this.fire(new r.z("renderstart")),++this._frameId;const n=this.painter.context.extTimerQuery,d=r.q.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=y.createQuery(),y.beginQuery(n.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const V=this.transform.zoom,j=this.transform.pitch,G=r.q.now(),q=new r.a8(V,{now:G,fadeDuration:b,pitch:j,transition:this.style.transition});this.style.update(q)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(d),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(d);const I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),I&&(this._placementDirty=I.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,oe.mark(ie.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const V=r.q.now()-d;y.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{const j=y.getQueryParameter(t,y.QUERY_RESULT)/1e6;y.deleteQuery(t),this.fire(new r.z("gpu-timing-frame",{cpuTime:V,gpuTime:j}))},50)}if(this.listens("gpu-timing-layer")){const V=this.painter.collectGpuTimers();setTimeout(()=>{const j=this.painter.queryGpuTimers(V);this.fire(new r.z("gpu-timing-layer",{layerTimes:j}))},50)}if(this.listens("gpu-timing-deferred-render")){const V=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const j=this.painter.queryGpuTimeDeferredRender(V);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:j}))},50)}const F=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(F||this._repaint)this.triggerRepaint();else{const V=this.idle();if(V&&(T=this._updateAverageElevation(d,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),V&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const j=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:j})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||F||(this._fullyLoaded=!0,oe.mark(ie.fullLoad),this._performanceMetricsCollection&&qr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(const t of this._markers)u&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!u||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(u,t=!1){const n=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&n(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(t||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const y=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=u;const T=Math.abs(y-b);if(T>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(b),n(b);this._averageElevation.easeTo(b,u,300)}else if(T>1e-4)return this._averageElevation.jumpTo(b),n(b)}return!!this._averageElevation.isEasing(u)&&n(this._averageElevation.getValue(u))}_authenticate(){Ye(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===Ti||u.status===401)){const t=this.painter.context.gl;Bi(t,!1),this._logoControl instanceof Mo&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Wr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&_n(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,d=n.createFramebuffer();function y(b){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,b,0);const T=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,T),T}return n.bindFramebuffer(n.FRAMEBUFFER,d),this._canvasPixelComparison(y(u),t.canvasCopies.map(y),t.timeStamps)}_canvasPixelComparison(u,t,n){let d=n[1]-n[0];const y=u.length/4;for(let b=0;b<t.length;b++){const T=t[b];let I=0;for(let F=0;F<T.length;F+=4)T[F]===u[F]&&T[F+1]===u[F+1]&&T[F+2]===u[F+2]&&T[F+3]===u[F+3]&&(I+=1);d+=(n[b+2]-n[b+1])*(1-I/y)}return d}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),ds.delete(this.painter.context.gl),es.remove(),vi.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=r.q.frame(t=>{const n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(t)}))}_preloadTiles(u){const t=this.style?this.style.getSourceCaches():[];return r.bl(t,(n,d)=>n._preloadTiles(u,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(u){this._showParseStatus!==u&&(this._showParseStatus=u,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(u){this._showLayers2DWireframe!==u&&(this._showLayers2DWireframe=u,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(u){this._showLayers3DWireframe!==u&&(this._showLayers3DWireframe=u,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,this._tp.refreshUI(),u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,this._tp.refreshUI(),u&&this._update())}_setCacheLimits(u,t){r.dG(u,t)}get version(){return W}},NavigationControl:class{constructor(u={}){this.options=r.l({},Lp,u),this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(r.aP(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Ae("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Ae("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aP(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:t}):n.resetNorth({},{originalEvent:t}))}),this._compassIcon=Ae("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const t=u.getZoom(),n=t===u.getMaxZoom(),d=t===u.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Rp(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,t){const n=Ae("button",u,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(u,t){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${t}`);u.setAttribute("aria-label",n),u.firstElementChild&&u.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends r.E{constructor(u={}){super();const t=navigator.geolocation;this.options=r.l({geolocation:t},to,u),r.aP(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=oo(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){const t=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,u(n)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(n=>t(n.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),n=u.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",u)),this._finish()}}_updateCamera(u){const t=new r.bO(u.coords.longitude,u.coords.latitude),n=u.coords.accuracy,d=this._map.getBearing(),y=r.l({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),y,{geolocateSource:!0})}_updateMarker(u){if(u){const t=new r.bO(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map.transform,t=r.bH(1,u._center.lat)*u.worldSize,n=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Ae("button","mapboxgl-ctrl-geolocate",this._container),Ae("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ae("div","mapboxgl-user-location"),this._dotElement.appendChild(Ae("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ae("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ya({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ae("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ya({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:bh,ScaleControl:class{constructor(u={}){this.options=r.l({},co,u),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aP(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const u=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,d=t._containerWidth/2-u/2,y=t.unproject([d,n]),b=t.unproject([d+u,n]),T=y.distanceTo(b);if(this.options.unit==="imperial"){const I=3.2808*T;I>5280?this._setScale(u,I/5280,"mile"):this._setScale(u,I,"foot")}else this.options.unit==="nautical"?this._setScale(u,T/1852,"nautical-mile"):T>=1e3?this._setScale(u,T/1e3,"kilometer"):this._setScale(u,T,"meter")}_setScale(u,t,n){this._map._requestDomTask(()=>{const d=function(b){const T=Math.pow(10,`${Math.floor(b)}`.length-1);let I=b/T;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(F){const V=Math.pow(10,Math.ceil(-Math.log(F)/Math.LN10));return Math.round(F*V)/V}(I),T*I}(t),y=d/t;this._container.innerHTML=this._isNumberFormatSupported&&n!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(d):`${d}&nbsp;${Wn[n]}`,this._container.style.width=u*y+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u={}){this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:r.w("Full screen control 'container' must be a DOM element.")),r.aP(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=Ae("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ae("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(u){super(),this.options=r.l(Object.create(zp),u),r.aP(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=r.bO.convert(u),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const t=document.createDocumentFragment(),n=document.createElement("body");let d;for(n.innerHTML=u;d=n.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Ae("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(u),this.options.closeButton){const n=this._closeButton=Ae("button","mapboxgl-popup-close-button",t);n.type="button",n.setAttribute("aria-label","Close popup"),n.innerHTML='<span aria-hidden="true">&#215;</span>',n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let t;return this._classList.delete(u)?t=!1:(this._classList.add(u),t=!0),this._updateClassList(),t}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,d=this._pos;if(!t||!n||!d)return"bottom";const y=n.offsetWidth,b=n.offsetHeight,T=d.x<y/2,I=d.x>t.transform.width-y/2;if(d.y+u<b)return T?"top-left":I?"top-right":"top";if(d.y>t.transform.height-b){if(T)return"bottom-left";if(I)return"bottom-right"}return T?"left":I?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),u.className=t.join(" ")}_update(u){const t=this._map,n=this._content;if(!t||!this._lngLat&&!this._trackPointer||!n)return;let d=this._container;if(d||(d=this._container=Ae("div","mapboxgl-popup",t.getContainer()),this._tip=Ae("div","mapboxgl-popup-tip",d),d.appendChild(n)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Bl(this._lngLat,this._pos,t.transform)),!this._trackPointer||u){const y=this._pos=this._trackPointer&&u instanceof r.P?u:t.project(this._lngLat),b=Fp(this.options.offset),T=this._anchor=this._getAnchor(b.y),I=Fp(this.options.offset,T),F=y.add(I).round();t._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${_a[T]} translate(${F.x}px,${F.y}px)`)})}if(!this._marker&&t._showingGlobe()){const y=r.dH(t.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(uo);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:ya,Style:Lo,LngLat:r.bO,LngLatBounds:r.az,Point:r.P,MercatorCoordinate:r.aa,FreeCameraOptions:$h,Evented:r.E,config:r.e,prewarm:r.dM,clearPrewarmedResources:r.dN,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(u){r.e.ACCESS_TOKEN=u},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(u){r.e.API_URL=u},get workerCount(){return r.dO.workerCount},set workerCount(u){r.dO.workerCount=u},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){r.e.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){r.dP(u)},get workerUrl(){return r.dQ.workerUrl},set workerUrl(u){r.dQ.workerUrl=u},get workerClass(){return r.dQ.workerClass},set workerClass(u){r.dQ.workerClass=u},get workerParams(){return r.dQ.workerParams},set workerParams(u){r.dQ.workerParams=u},get dracoUrl(){return r.dR()},set dracoUrl(u){r.dS(u)},get meshoptUrl(){return r.dT()},set meshoptUrl(u){r.dU(u)},setNow:r.q.setNow,restoreNow:r.q.restoreNow}});var N=_;return N})}(Ry)),Ry.exports}var c3=l3();const uT=t_(c3),u3=["Austria","Belgium","Bulgaria","Croatia","Cyprus","Czech Republic","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Ireland","Italy","Latvia","Lithuania","Luxembourg","Malta","Netherlands","Poland","Portugal","Romania","Slovakia","Slovenia","Spain","Sweden"],h3=({vesselId:m,fromDate:g,toDate:a})=>{const[c,_]=Xe.useState([]),A=Xe.useRef(null),N=Xe.useRef({}),r=(Se,xe)=>Se.reduce((Ae,Re)=>((Ae[Re[xe]]=Ae[Re[xe]]||[]).push(Re),Ae),{}),W=(Se=[])=>Se.map(xe=>[xe.long,xe.lat]),ie=async(Se,xe)=>{try{const He=(await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${xe},${Se}.json?access_token=pk.eyJ1IjoiaXRlY2hkZXNrIiwiYSI6ImNsbzB2Ym90ZzAyOHkycG1wbGdzbDkwdHYifQ.m9ESpZNzQefxh1rRRs4tXA`)).json()).features.find(ht=>ht.place_type.includes("country")),rt=He==null?void 0:He.text;return console.log("country",rt),u3.includes(rt)}catch(Ae){return console.error("Error checking EU country:",Ae),!1}},oe=async()=>{try{const Se=await fA({vesselId:m||"",fromDate:g,toDate:a});if(Se.length){const xe=r(Se,"voyageNo"),Ae=await Promise.all(Object.keys(xe).map(async Re=>{const He=xe[Re][0],rt=await ie(He.lat,He.long);return{coordinates:W(xe[Re]),color:rt?"#36AB2F":"#2b7fff"}}));_(Ae)}else console.warn("No voyage routes data received.")}catch(Se){console.error("Error fetching vessel voyage routes:",Se)}};Xe.useEffect(()=>(A.current||(uT.accessToken="pk.eyJ1IjoiaXRlY2hkZXNrIiwiYSI6ImNsbzB2Ym90ZzAyOHkycG1wbGdzbDkwdHYifQ.m9ESpZNzQefxh1rRRs4tXA",A.current=new uT.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[37.551544,19.412756],zoom:1,preserveDrawingBuffer:!0,attributionControl:!1,scrollZoom:!0}),A.current.on("load",()=>{console.log("Map loaded")})),()=>{var Se;(Se=A.current)==null||Se.remove(),A.current=null}),[]),Xe.useEffect(()=>{m&&g&&a&&oe()},[m,g,a]);const he=()=>{A.current&&(Object.keys(N.current).forEach(Se=>{var Ae,Re;(Ae=A.current)!=null&&Ae.getLayer(Se)&&A.current.removeLayer(Se);const xe=Se.replace("Layer","Source");(Re=A.current)!=null&&Re.getSource(xe)&&A.current.removeSource(xe)}),N.current={})};Xe.useEffect(()=>{A.current&&c.length>0&&(A.current.isStyleLoaded()?(he(),ve(c)):A.current.once("styledata",()=>{he(),ve(c)}))},[c]);const ve=Se=>{Se.forEach((xe,Ae)=>{var rt,ht;const Re=`multilineStringSource${Ae}`,He=`multilineStringLayer${Ae}`;(rt=A.current)==null||rt.addSource(Re,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"MultiPoint",coordinates:xe.coordinates}}}),(ht=A.current)==null||ht.addLayer({id:He,type:"circle",source:Re,paint:{"circle-color":xe.color,"circle-radius":2}}),N.current[He]=!0})};return hi.jsx("div",{id:"map",style:{width:"100%",height:"350px"}})},Qg={black:"#000",white:"#fff"},_m={300:"#e57373",400:"#ef5350",500:"#f44336",700:"#d32f2f",800:"#c62828"},ym={50:"#f3e5f5",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",700:"#7b1fa2"},vm={50:"#e3f2fd",200:"#90caf9",400:"#42a5f5",700:"#1976d2",800:"#1565c0"},xm={300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",700:"#0288d1",900:"#01579b"},bm={300:"#81c784",400:"#66bb6a",500:"#4caf50",700:"#388e3c",800:"#2e7d32",900:"#1b5e20"},Bg={300:"#ffb74d",400:"#ffa726",500:"#ff9800",700:"#f57c00",900:"#e65100"},d3={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"};function pf(m,...g){const a=new URL(`https://mui.com/production-error/?code=${m}`);return g.forEach(c=>a.searchParams.append("args[]",c)),`Minified MUI error #${m}; visit ${a} for the full message.`}const p3="$$material";var f3=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,m3=t2(function(m){return f3.test(m)||m.charCodeAt(0)===111&&m.charCodeAt(1)===110&&m.charCodeAt(2)<91}),g3=m3,_3=function(g){return g!=="theme"},hT=function(g){return typeof g=="string"&&g.charCodeAt(0)>96?g3:_3},dT=function(g,a,c){var _;if(a){var A=a.shouldForwardProp;_=g.__emotion_forwardProp&&A?function(N){return g.__emotion_forwardProp(N)&&A(N)}:A}return typeof _!="function"&&c&&(_=g.__emotion_forwardProp),_},y3=function(g){var a=g.cache,c=g.serialized,_=g.isStringTag;return Nx(a,c,_),o2(function(){return n2(a,c,_)}),null},v3=function m(g,a){var c=g.__emotion_real===g,_=c&&g.__emotion_base||g,A,N;a!==void 0&&(A=a.label,N=a.target);var r=dT(g,a,c),W=r||hT(_),ie=!W("as");return function(){var oe=arguments,he=c&&g.__emotion_styles!==void 0?g.__emotion_styles.slice(0):[];if(A!==void 0&&he.push("label:"+A+";"),oe[0]==null||oe[0].raw===void 0)he.push.apply(he,oe);else{var ve=oe[0];he.push(ve[0]);for(var Se=oe.length,xe=1;xe<Se;xe++)he.push(oe[xe],ve[xe])}var Ae=l2(function(Re,He,rt){var ht=ie&&Re.as||_,tt="",at=[],Lt=Re;if(Re.theme==null){Lt={};for(var Ve in Re)Lt[Ve]=Re[Ve];Lt.theme=Xe.useContext(c2)}typeof Re.className=="string"?tt=r2(He.registered,at,Re.className):Re.className!=null&&(tt=Re.className+" ");var Tt=h0(he.concat(at),He.registered,Lt);tt+=He.key+"-"+Tt.name,N!==void 0&&(tt+=" "+N);var qt=ie&&r===void 0?hT(ht):W,Me={};for(var gt in Re)ie&&gt==="as"||qt(gt)&&(Me[gt]=Re[gt]);return Me.className=tt,rt&&(Me.ref=rt),Xe.createElement(Xe.Fragment,null,Xe.createElement(y3,{cache:He,serialized:Tt,isStringTag:typeof ht=="string"}),Xe.createElement(ht,Me))});return Ae.displayName=A!==void 0?A:"Styled("+(typeof _=="string"?_:_.displayName||_.name||"Component")+")",Ae.defaultProps=g.defaultProps,Ae.__emotion_real=Ae,Ae.__emotion_base=_,Ae.__emotion_styles=he,Ae.__emotion_forwardProp=r,Object.defineProperty(Ae,"toString",{value:function(){return"."+N}}),Ae.withComponent=function(Re,He){var rt=m(Re,yr({},a,He,{shouldForwardProp:dT(Ae,He,!0)}));return rt.apply(void 0,he)},Ae}},x3=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],Ex=v3.bind(null);x3.forEach(function(m){Ex[m]=Ex(m)});function b3(m,g){return Ex(m,g)}function w3(m,g){Array.isArray(m.__emotion_styles)&&(m.__emotion_styles=g(m.__emotion_styles))}const pT=[];function fT(m){return pT[0]=m,h0(pT)}var cx={exports:{}},Un={};/**
 * @license React
 * react-is.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mT;function S3(){if(mT)return Un;mT=1;var m=Symbol.for("react.transitional.element"),g=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),A=Symbol.for("react.consumer"),N=Symbol.for("react.context"),r=Symbol.for("react.forward_ref"),W=Symbol.for("react.suspense"),ie=Symbol.for("react.suspense_list"),oe=Symbol.for("react.memo"),he=Symbol.for("react.lazy"),ve=Symbol.for("react.view_transition"),Se=Symbol.for("react.client.reference");function xe(Ae){if(typeof Ae=="object"&&Ae!==null){var Re=Ae.$$typeof;switch(Re){case m:switch(Ae=Ae.type,Ae){case a:case _:case c:case W:case ie:case ve:return Ae;default:switch(Ae=Ae&&Ae.$$typeof,Ae){case N:case r:case he:case oe:return Ae;case A:return Ae;default:return Re}}case g:return Re}}}return Un.ContextConsumer=A,Un.ContextProvider=N,Un.Element=m,Un.ForwardRef=r,Un.Fragment=a,Un.Lazy=he,Un.Memo=oe,Un.Portal=g,Un.Profiler=_,Un.StrictMode=c,Un.Suspense=W,Un.SuspenseList=ie,Un.isContextConsumer=function(Ae){return xe(Ae)===A},Un.isContextProvider=function(Ae){return xe(Ae)===N},Un.isElement=function(Ae){return typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===m},Un.isForwardRef=function(Ae){return xe(Ae)===r},Un.isFragment=function(Ae){return xe(Ae)===a},Un.isLazy=function(Ae){return xe(Ae)===he},Un.isMemo=function(Ae){return xe(Ae)===oe},Un.isPortal=function(Ae){return xe(Ae)===g},Un.isProfiler=function(Ae){return xe(Ae)===_},Un.isStrictMode=function(Ae){return xe(Ae)===c},Un.isSuspense=function(Ae){return xe(Ae)===W},Un.isSuspenseList=function(Ae){return xe(Ae)===ie},Un.isValidElementType=function(Ae){return typeof Ae=="string"||typeof Ae=="function"||Ae===a||Ae===_||Ae===c||Ae===W||Ae===ie||typeof Ae=="object"&&Ae!==null&&(Ae.$$typeof===he||Ae.$$typeof===oe||Ae.$$typeof===N||Ae.$$typeof===A||Ae.$$typeof===r||Ae.$$typeof===Se||Ae.getModuleId!==void 0)},Un.typeOf=xe,Un}var gT;function T3(){return gT||(gT=1,cx.exports=S3()),cx.exports}var _M=T3();function Fu(m){if(typeof m!="object"||m===null)return!1;const g=Object.getPrototypeOf(m);return(g===null||g===Object.prototype||Object.getPrototypeOf(g)===null)&&!(Symbol.toStringTag in m)&&!(Symbol.iterator in m)}function yM(m){if(Xe.isValidElement(m)||_M.isValidElementType(m)||!Fu(m))return m;const g={};return Object.keys(m).forEach(a=>{g[a]=yM(m[a])}),g}function hl(m,g,a={clone:!0}){const c=a.clone?{...m}:m;return Fu(m)&&Fu(g)&&Object.keys(g).forEach(_=>{Xe.isValidElement(g[_])||_M.isValidElementType(g[_])?c[_]=g[_]:Fu(g[_])&&Object.prototype.hasOwnProperty.call(m,_)&&Fu(m[_])?c[_]=hl(m[_],g[_],a):a.clone?c[_]=Fu(g[_])?yM(g[_]):g[_]:c[_]=g[_]}),c}const M3=m=>{const g=Object.keys(m).map(a=>({key:a,val:m[a]}))||[];return g.sort((a,c)=>a.val-c.val),g.reduce((a,c)=>({...a,[c.key]:c.val}),{})};function C3(m){const{values:g={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:a="px",step:c=5,..._}=m,A=M3(g),N=Object.keys(A);function r(ve){return`@media (min-width:${typeof g[ve]=="number"?g[ve]:ve}${a})`}function W(ve){return`@media (max-width:${(typeof g[ve]=="number"?g[ve]:ve)-c/100}${a})`}function ie(ve,Se){const xe=N.indexOf(Se);return`@media (min-width:${typeof g[ve]=="number"?g[ve]:ve}${a}) and (max-width:${(xe!==-1&&typeof g[N[xe]]=="number"?g[N[xe]]:Se)-c/100}${a})`}function oe(ve){return N.indexOf(ve)+1<N.length?ie(ve,N[N.indexOf(ve)+1]):r(ve)}function he(ve){const Se=N.indexOf(ve);return Se===0?r(N[1]):Se===N.length-1?W(N[Se]):ie(ve,N[N.indexOf(ve)+1]).replace("@media","@media not all and")}return{keys:N,values:A,up:r,down:W,between:ie,only:oe,not:he,unit:a,..._}}function E3(m,g){if(!m.containerQueries)return g;const a=Object.keys(g).filter(c=>c.startsWith("@container")).sort((c,_)=>{var N,r;const A=/min-width:\s*([0-9.]+)/;return+(((N=c.match(A))==null?void 0:N[1])||0)-+(((r=_.match(A))==null?void 0:r[1])||0)});return a.length?a.reduce((c,_)=>{const A=g[_];return delete c[_],c[_]=A,c},{...g}):g}function A3(m,g){return g==="@"||g.startsWith("@")&&(m.some(a=>g.startsWith(`@${a}`))||!!g.match(/^@\d/))}function P3(m,g){const a=g.match(/^@([^/]+)?\/?(.+)?$/);if(!a)return null;const[,c,_]=a,A=Number.isNaN(+c)?c||0:+c;return m.containerQueries(_).up(A)}function D3(m){const g=(A,N)=>A.replace("@media",N?`@container ${N}`:"@container");function a(A,N){A.up=(...r)=>g(m.breakpoints.up(...r),N),A.down=(...r)=>g(m.breakpoints.down(...r),N),A.between=(...r)=>g(m.breakpoints.between(...r),N),A.only=(...r)=>g(m.breakpoints.only(...r),N),A.not=(...r)=>{const W=g(m.breakpoints.not(...r),N);return W.includes("not all and")?W.replace("not all and ","").replace("min-width:","width<").replace("max-width:","width>").replace("and","or"):W}}const c={},_=A=>(a(c,A),c);return a(_),{...m,containerQueries:_}}const I3={borderRadius:4};function Gg(m,g){return g?hl(m,g,{clone:!1}):m}const w0={xs:0,sm:600,md:900,lg:1200,xl:1536},_T={keys:["xs","sm","md","lg","xl"],up:m=>`@media (min-width:${w0[m]}px)`},k3={containerQueries:m=>({up:g=>{let a=typeof g=="number"?g:w0[g]||g;return typeof a=="number"&&(a=`${a}px`),m?`@container ${m} (min-width:${a})`:`@container (min-width:${a})`}})};function Oh(m,g,a){const c=m.theme||{};if(Array.isArray(g)){const A=c.breakpoints||_T;return g.reduce((N,r,W)=>(N[A.up(A.keys[W])]=a(g[W]),N),{})}if(typeof g=="object"){const A=c.breakpoints||_T;return Object.keys(g).reduce((N,r)=>{if(A3(A.keys,r)){const W=P3(c.containerQueries?c:k3,r);W&&(N[W]=a(g[r],r))}else if(Object.keys(A.values||w0).includes(r)){const W=A.up(r);N[W]=a(g[r],r)}else{const W=r;N[W]=g[W]}return N},{})}return a(g)}function O3(m={}){var a;return((a=m.keys)==null?void 0:a.reduce((c,_)=>{const A=m.up(_);return c[A]={},c},{}))||{}}function L3(m,g){return m.reduce((a,c)=>{const _=a[c];return(!_||Object.keys(_).length===0)&&delete a[c],a},g)}function Ma(m){if(typeof m!="string")throw new Error(pf(7));return m.charAt(0).toUpperCase()+m.slice(1)}function S0(m,g,a=!0){if(!g||typeof g!="string")return null;if(m&&m.vars&&a){const c=`vars.${g}`.split(".").reduce((_,A)=>_&&_[A]?_[A]:null,m);if(c!=null)return c}return g.split(".").reduce((c,_)=>c&&c[_]!=null?c[_]:null,m)}function s0(m,g,a,c=a){let _;return typeof m=="function"?_=m(a):Array.isArray(m)?_=m[a]||c:_=S0(m,a)||c,g&&(_=g(_,c,m)),_}function Ys(m){const{prop:g,cssProperty:a=m.prop,themeKey:c,transform:_}=m,A=N=>{if(N[g]==null)return null;const r=N[g],W=N.theme,ie=S0(W,c)||{};return Oh(N,r,he=>{let ve=s0(ie,_,he);return he===ve&&typeof he=="string"&&(ve=s0(ie,_,`${g}${he==="default"?"":Ma(he)}`,he)),a===!1?ve:{[a]:ve}})};return A.propTypes={},A.filterProps=[g],A}function R3(m){const g={};return a=>(g[a]===void 0&&(g[a]=m(a)),g[a])}const z3={m:"margin",p:"padding"},F3={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},yT={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},B3=R3(m=>{if(m.length>2)if(yT[m])m=yT[m];else return[m];const[g,a]=m.split(""),c=z3[g],_=F3[a]||"";return Array.isArray(_)?_.map(A=>c+A):[c+_]}),rb=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],nb=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...rb,...nb];function c_(m,g,a,c){const _=S0(m,g,!0)??a;return typeof _=="number"||typeof _=="string"?A=>typeof A=="string"?A:typeof _=="string"?_.startsWith("var(")&&A===0?0:_.startsWith("var(")&&A===1?_:`calc(${A} * ${_})`:_*A:Array.isArray(_)?A=>{if(typeof A=="string")return A;const N=Math.abs(A),r=_[N];return A>=0?r:typeof r=="number"?-r:typeof r=="string"&&r.startsWith("var(")?`calc(-1 * ${r})`:`-${r}`}:typeof _=="function"?_:()=>{}}function sb(m){return c_(m,"spacing",8)}function u_(m,g){return typeof g=="string"||g==null?g:m(g)}function N3(m,g){return a=>m.reduce((c,_)=>(c[_]=u_(g,a),c),{})}function V3(m,g,a,c){if(!g.includes(a))return null;const _=B3(a),A=N3(_,c),N=m[a];return Oh(m,N,A)}function vM(m,g){const a=sb(m.theme);return Object.keys(m).map(c=>V3(m,g,c,a)).reduce(Gg,{})}function Ns(m){return vM(m,rb)}Ns.propTypes={};Ns.filterProps=rb;function Vs(m){return vM(m,nb)}Vs.propTypes={};Vs.filterProps=nb;function xM(m=8,g=sb({spacing:m})){if(m.mui)return m;const a=(...c)=>(c.length===0?[1]:c).map(A=>{const N=g(A);return typeof N=="number"?`${N}px`:N}).join(" ");return a.mui=!0,a}function T0(...m){const g=m.reduce((c,_)=>(_.filterProps.forEach(A=>{c[A]=_}),c),{}),a=c=>Object.keys(c).reduce((_,A)=>g[A]?Gg(_,g[A](c)):_,{});return a.propTypes={},a.filterProps=m.reduce((c,_)=>c.concat(_.filterProps),[]),a}function Xl(m){return typeof m!="number"?m:`${m}px solid`}function Kl(m,g){return Ys({prop:m,themeKey:"borders",transform:g})}const U3=Kl("border",Xl),j3=Kl("borderTop",Xl),$3=Kl("borderRight",Xl),H3=Kl("borderBottom",Xl),G3=Kl("borderLeft",Xl),W3=Kl("borderColor"),q3=Kl("borderTopColor"),Y3=Kl("borderRightColor"),X3=Kl("borderBottomColor"),Z3=Kl("borderLeftColor"),K3=Kl("outline",Xl),J3=Kl("outlineColor"),M0=m=>{if(m.borderRadius!==void 0&&m.borderRadius!==null){const g=c_(m.theme,"shape.borderRadius",4),a=c=>({borderRadius:u_(g,c)});return Oh(m,m.borderRadius,a)}return null};M0.propTypes={};M0.filterProps=["borderRadius"];T0(U3,j3,$3,H3,G3,W3,q3,Y3,X3,Z3,M0,K3,J3);const C0=m=>{if(m.gap!==void 0&&m.gap!==null){const g=c_(m.theme,"spacing",8),a=c=>({gap:u_(g,c)});return Oh(m,m.gap,a)}return null};C0.propTypes={};C0.filterProps=["gap"];const E0=m=>{if(m.columnGap!==void 0&&m.columnGap!==null){const g=c_(m.theme,"spacing",8),a=c=>({columnGap:u_(g,c)});return Oh(m,m.columnGap,a)}return null};E0.propTypes={};E0.filterProps=["columnGap"];const A0=m=>{if(m.rowGap!==void 0&&m.rowGap!==null){const g=c_(m.theme,"spacing",8),a=c=>({rowGap:u_(g,c)});return Oh(m,m.rowGap,a)}return null};A0.propTypes={};A0.filterProps=["rowGap"];const Q3=Ys({prop:"gridColumn"}),ez=Ys({prop:"gridRow"}),tz=Ys({prop:"gridAutoFlow"}),iz=Ys({prop:"gridAutoColumns"}),rz=Ys({prop:"gridAutoRows"}),nz=Ys({prop:"gridTemplateColumns"}),sz=Ys({prop:"gridTemplateRows"}),oz=Ys({prop:"gridTemplateAreas"}),az=Ys({prop:"gridArea"});T0(C0,E0,A0,Q3,ez,tz,iz,rz,nz,sz,oz,az);function Cm(m,g){return g==="grey"?g:m}const lz=Ys({prop:"color",themeKey:"palette",transform:Cm}),cz=Ys({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:Cm}),uz=Ys({prop:"backgroundColor",themeKey:"palette",transform:Cm});T0(lz,cz,uz);function ll(m){return m<=1&&m!==0?`${m*100}%`:m}const hz=Ys({prop:"width",transform:ll}),ob=m=>{if(m.maxWidth!==void 0&&m.maxWidth!==null){const g=a=>{var _,A,N,r,W;const c=((N=(A=(_=m.theme)==null?void 0:_.breakpoints)==null?void 0:A.values)==null?void 0:N[a])||w0[a];return c?((W=(r=m.theme)==null?void 0:r.breakpoints)==null?void 0:W.unit)!=="px"?{maxWidth:`${c}${m.theme.breakpoints.unit}`}:{maxWidth:c}:{maxWidth:ll(a)}};return Oh(m,m.maxWidth,g)}return null};ob.filterProps=["maxWidth"];const dz=Ys({prop:"minWidth",transform:ll}),pz=Ys({prop:"height",transform:ll}),fz=Ys({prop:"maxHeight",transform:ll}),mz=Ys({prop:"minHeight",transform:ll});Ys({prop:"size",cssProperty:"width",transform:ll});Ys({prop:"size",cssProperty:"height",transform:ll});const gz=Ys({prop:"boxSizing"});T0(hz,ob,dz,pz,fz,mz,gz);const h_={border:{themeKey:"borders",transform:Xl},borderTop:{themeKey:"borders",transform:Xl},borderRight:{themeKey:"borders",transform:Xl},borderBottom:{themeKey:"borders",transform:Xl},borderLeft:{themeKey:"borders",transform:Xl},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:Xl},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:M0},color:{themeKey:"palette",transform:Cm},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:Cm},backgroundColor:{themeKey:"palette",transform:Cm},p:{style:Vs},pt:{style:Vs},pr:{style:Vs},pb:{style:Vs},pl:{style:Vs},px:{style:Vs},py:{style:Vs},padding:{style:Vs},paddingTop:{style:Vs},paddingRight:{style:Vs},paddingBottom:{style:Vs},paddingLeft:{style:Vs},paddingX:{style:Vs},paddingY:{style:Vs},paddingInline:{style:Vs},paddingInlineStart:{style:Vs},paddingInlineEnd:{style:Vs},paddingBlock:{style:Vs},paddingBlockStart:{style:Vs},paddingBlockEnd:{style:Vs},m:{style:Ns},mt:{style:Ns},mr:{style:Ns},mb:{style:Ns},ml:{style:Ns},mx:{style:Ns},my:{style:Ns},margin:{style:Ns},marginTop:{style:Ns},marginRight:{style:Ns},marginBottom:{style:Ns},marginLeft:{style:Ns},marginX:{style:Ns},marginY:{style:Ns},marginInline:{style:Ns},marginInlineStart:{style:Ns},marginInlineEnd:{style:Ns},marginBlock:{style:Ns},marginBlockStart:{style:Ns},marginBlockEnd:{style:Ns},displayPrint:{cssProperty:!1,transform:m=>({"@media print":{display:m}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:C0},rowGap:{style:A0},columnGap:{style:E0},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:ll},maxWidth:{style:ob},minWidth:{transform:ll},height:{transform:ll},maxHeight:{transform:ll},minHeight:{transform:ll},boxSizing:{},font:{themeKey:"font"},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}};function _z(...m){const g=m.reduce((c,_)=>c.concat(Object.keys(_)),[]),a=new Set(g);return m.every(c=>a.size===Object.keys(c).length)}function yz(m,g){return typeof m=="function"?m(g):m}function vz(){function m(a,c,_,A){const N={[a]:c,theme:_},r=A[a];if(!r)return{[a]:c};const{cssProperty:W=a,themeKey:ie,transform:oe,style:he}=r;if(c==null)return null;if(ie==="typography"&&c==="inherit")return{[a]:c};const ve=S0(_,ie)||{};return he?he(N):Oh(N,c,xe=>{let Ae=s0(ve,oe,xe);return xe===Ae&&typeof xe=="string"&&(Ae=s0(ve,oe,`${a}${xe==="default"?"":Ma(xe)}`,xe)),W===!1?Ae:{[W]:Ae}})}function g(a){const{sx:c,theme:_={}}=a||{};if(!c)return null;const A=_.unstable_sxConfig??h_;function N(r){let W=r;if(typeof r=="function")W=r(_);else if(typeof r!="object")return r;if(!W)return null;const ie=O3(_.breakpoints),oe=Object.keys(ie);let he=ie;return Object.keys(W).forEach(ve=>{const Se=yz(W[ve],_);if(Se!=null)if(typeof Se=="object")if(A[ve])he=Gg(he,m(ve,Se,_,A));else{const xe=Oh({theme:_},Se,Ae=>({[ve]:Ae}));_z(xe,Se)?he[ve]=g({sx:Se,theme:_}):he=Gg(he,xe)}else he=Gg(he,m(ve,Se,_,A))}),E3(_,L3(oe,he))}return Array.isArray(c)?c.map(N):N(c)}return g}const Rm=vz();Rm.filterProps=["sx"];function xz(m,g){var c;const a=this;if(a.vars){if(!((c=a.colorSchemes)!=null&&c[m])||typeof a.getColorSchemeSelector!="function")return{};let _=a.getColorSchemeSelector(m);return _==="&"?g:((_.includes("data-")||_.includes("."))&&(_=`*:where(${_.replace(/\s*&$/,"")}) &`),{[_]:g})}return a.palette.mode===m?g:{}}function bM(m={},...g){const{breakpoints:a={},palette:c={},spacing:_,shape:A={},...N}=m,r=C3(a),W=xM(_);let ie=hl({breakpoints:r,direction:"ltr",components:{},palette:{mode:"light",...c},spacing:W,shape:{...I3,...A}},N);return ie=D3(ie),ie.applyStyles=xz,ie=g.reduce((oe,he)=>hl(oe,he),ie),ie.unstable_sxConfig={...h_,...N==null?void 0:N.unstable_sxConfig},ie.unstable_sx=function(he){return Rm({sx:he,theme:this})},ie}const bz=m=>{var c;const g={systemProps:{},otherProps:{}},a=((c=m==null?void 0:m.theme)==null?void 0:c.unstable_sxConfig)??h_;return Object.keys(m).forEach(_=>{a[_]?g.systemProps[_]=m[_]:g.otherProps[_]=m[_]}),g};function wz(m){const{sx:g,...a}=m,{systemProps:c,otherProps:_}=bz(a);let A;return Array.isArray(g)?A=[c,...g]:typeof g=="function"?A=(...N)=>{const r=g(...N);return Fu(r)?{...c,...r}:c}:A={...c,...g},{..._,sx:A}}const vT=m=>m,Sz=()=>{let m=vT;return{configure(g){m=g},generate(g){return m(g)},reset(){m=vT}}},Tz=Sz(),Mz={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function jd(m,g,a="Mui"){const c=Mz[g];return c?`${a}-${c}`:`${Tz.generate(m)}-${g}`}function $d(m,g,a="Mui"){const c={};return g.forEach(_=>{c[_]=jd(m,_,a)}),c}function wM(m){const{variants:g,...a}=m,c={variants:g,style:fT(a),isProcessed:!0};return c.style===a||g&&g.forEach(_=>{typeof _.style!="function"&&(_.style=fT(_.style))}),c}const Cz=bM();function ux(m){return m!=="ownerState"&&m!=="theme"&&m!=="sx"&&m!=="as"}function Ez(m){return m?(g,a)=>a[m]:null}function Az(m,g,a){m.theme=Iz(m.theme)?a:m.theme[g]||m.theme}function zy(m,g){const a=typeof g=="function"?g(m):g;if(Array.isArray(a))return a.flatMap(c=>zy(m,c));if(Array.isArray(a==null?void 0:a.variants)){let c;if(a.isProcessed)c=a.style;else{const{variants:_,...A}=a;c=A}return SM(m,a.variants,[c])}return a!=null&&a.isProcessed?a.style:a}function SM(m,g,a=[]){var _;let c;e:for(let A=0;A<g.length;A+=1){const N=g[A];if(typeof N.props=="function"){if(c??(c={...m,...m.ownerState,ownerState:m.ownerState}),!N.props(c))continue}else for(const r in N.props)if(m[r]!==N.props[r]&&((_=m.ownerState)==null?void 0:_[r])!==N.props[r])continue e;typeof N.style=="function"?(c??(c={...m,...m.ownerState,ownerState:m.ownerState}),a.push(N.style(c))):a.push(N.style)}return a}function Pz(m={}){const{themeId:g,defaultTheme:a=Cz,rootShouldForwardProp:c=ux,slotShouldForwardProp:_=ux}=m;function A(r){Az(r,g,a)}return(r,W={})=>{w3(r,at=>at.filter(Lt=>Lt!==Rm));const{name:ie,slot:oe,skipVariantsResolver:he,skipSx:ve,overridesResolver:Se=Ez(Oz(oe)),...xe}=W,Ae=he!==void 0?he:oe&&oe!=="Root"&&oe!=="root"||!1,Re=ve||!1;let He=ux;oe==="Root"||oe==="root"?He=c:oe?He=_:kz(r)&&(He=void 0);const rt=b3(r,{shouldForwardProp:He,label:Dz(),...xe}),ht=at=>{if(typeof at=="function"&&at.__emotion_real!==at)return function(Ve){return zy(Ve,at)};if(Fu(at)){const Lt=wM(at);return Lt.variants?function(Tt){return zy(Tt,Lt)}:Lt.style}return at},tt=(...at)=>{const Lt=[],Ve=at.map(ht),Tt=[];if(Lt.push(A),ie&&Se&&Tt.push(function(oi){var zt,ii;const ni=(ii=(zt=oi.theme.components)==null?void 0:zt[ie])==null?void 0:ii.styleOverrides;if(!ni)return null;const Mt={};for(const Yt in ni)Mt[Yt]=zy(oi,ni[Yt]);return Se(oi,Mt)}),ie&&!Ae&&Tt.push(function(oi){var Mt,zt;const Ti=oi.theme,ni=(zt=(Mt=Ti==null?void 0:Ti.components)==null?void 0:Mt[ie])==null?void 0:zt.variants;return ni?SM(oi,ni):null}),Re||Tt.push(Rm),Array.isArray(Ve[0])){const gt=Ve.shift(),oi=new Array(Lt.length).fill(""),Ti=new Array(Tt.length).fill("");let ni;ni=[...oi,...gt,...Ti],ni.raw=[...oi,...gt.raw,...Ti],Lt.unshift(ni)}const qt=[...Lt,...Ve,...Tt],Me=rt(...qt);return r.muiName&&(Me.muiName=r.muiName),Me};return rt.withConfig&&(tt.withConfig=rt.withConfig),tt}}function Dz(m,g){return void 0}function Iz(m){for(const g in m)return!1;return!0}function kz(m){return typeof m=="string"&&m.charCodeAt(0)>96}function Oz(m){return m&&m.charAt(0).toLowerCase()+m.slice(1)}function Ax(m,g){const a={...g};for(const c in m)if(Object.prototype.hasOwnProperty.call(m,c)){const _=c;if(_==="components"||_==="slots")a[_]={...m[_],...a[_]};else if(_==="componentsProps"||_==="slotProps"){const A=m[_],N=g[_];if(!N)a[_]=A||{};else if(!A)a[_]=N;else{a[_]={...N};for(const r in A)if(Object.prototype.hasOwnProperty.call(A,r)){const W=r;a[_][W]=Ax(A[W],N[W])}}}else a[_]===void 0&&(a[_]=m[_])}return a}const Lz=typeof window<"u"?Xe.useLayoutEffect:Xe.useEffect;function Rz(m,g=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER){return Math.max(g,Math.min(m,a))}function ab(m,g=0,a=1){return Rz(m,g,a)}function zz(m){m=m.slice(1);const g=new RegExp(`.{1,${m.length>=6?2:1}}`,"g");let a=m.match(g);return a&&a[0].length===1&&(a=a.map(c=>c+c)),a?`rgb${a.length===4?"a":""}(${a.map((c,_)=>_<3?parseInt(c,16):Math.round(parseInt(c,16)/255*1e3)/1e3).join(", ")})`:""}function Ud(m){if(m.type)return m;if(m.charAt(0)==="#")return Ud(zz(m));const g=m.indexOf("("),a=m.substring(0,g);if(!["rgb","rgba","hsl","hsla","color"].includes(a))throw new Error(pf(9,m));let c=m.substring(g+1,m.length-1),_;if(a==="color"){if(c=c.split(" "),_=c.shift(),c.length===4&&c[3].charAt(0)==="/"&&(c[3]=c[3].slice(1)),!["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].includes(_))throw new Error(pf(10,_))}else c=c.split(",");return c=c.map(A=>parseFloat(A)),{type:a,values:c,colorSpace:_}}const Fz=m=>{const g=Ud(m);return g.values.slice(0,3).map((a,c)=>g.type.includes("hsl")&&c!==0?`${a}%`:a).join(" ")},$g=(m,g)=>{try{return Fz(m)}catch{return m}};function P0(m){const{type:g,colorSpace:a}=m;let{values:c}=m;return g.includes("rgb")?c=c.map((_,A)=>A<3?parseInt(_,10):_):g.includes("hsl")&&(c[1]=`${c[1]}%`,c[2]=`${c[2]}%`),g.includes("color")?c=`${a} ${c.join(" ")}`:c=`${c.join(", ")}`,`${g}(${c})`}function TM(m){m=Ud(m);const{values:g}=m,a=g[0],c=g[1]/100,_=g[2]/100,A=c*Math.min(_,1-_),N=(ie,oe=(ie+a/30)%12)=>_-A*Math.max(Math.min(oe-3,9-oe,1),-1);let r="rgb";const W=[Math.round(N(0)*255),Math.round(N(8)*255),Math.round(N(4)*255)];return m.type==="hsla"&&(r+="a",W.push(g[3])),P0({type:r,values:W})}function Px(m){m=Ud(m);let g=m.type==="hsl"||m.type==="hsla"?Ud(TM(m)).values:m.values;return g=g.map(a=>(m.type!=="color"&&(a/=255),a<=.03928?a/12.92:((a+.055)/1.055)**2.4)),Number((.2126*g[0]+.7152*g[1]+.0722*g[2]).toFixed(3))}function Bz(m,g){const a=Px(m),c=Px(g);return(Math.max(a,c)+.05)/(Math.min(a,c)+.05)}function e_(m,g){return m=Ud(m),g=ab(g),(m.type==="rgb"||m.type==="hsl")&&(m.type+="a"),m.type==="color"?m.values[3]=`/${g}`:m.values[3]=g,P0(m)}function by(m,g,a){try{return e_(m,g)}catch{return m}}function D0(m,g){if(m=Ud(m),g=ab(g),m.type.includes("hsl"))m.values[2]*=1-g;else if(m.type.includes("rgb")||m.type.includes("color"))for(let a=0;a<3;a+=1)m.values[a]*=1-g;return P0(m)}function Jn(m,g,a){try{return D0(m,g)}catch{return m}}function I0(m,g){if(m=Ud(m),g=ab(g),m.type.includes("hsl"))m.values[2]+=(100-m.values[2])*g;else if(m.type.includes("rgb"))for(let a=0;a<3;a+=1)m.values[a]+=(255-m.values[a])*g;else if(m.type.includes("color"))for(let a=0;a<3;a+=1)m.values[a]+=(1-m.values[a])*g;return P0(m)}function Qn(m,g,a){try{return I0(m,g)}catch{return m}}function Nz(m,g=.15){return Px(m)>.5?D0(m,g):I0(m,g)}function wy(m,g,a){try{return Nz(m,g)}catch{return m}}function Vz(m,g){typeof m=="function"?m(g):m&&(m.current=g)}function Fy(m){const g=Xe.useRef(m);return Lz(()=>{g.current=m}),Xe.useRef((...a)=>(0,g.current)(...a)).current}function xT(...m){return Xe.useMemo(()=>m.every(g=>g==null)?null:g=>{m.forEach(a=>{Vz(a,g)})},m)}const bT={};function MM(m,g){const a=Xe.useRef(bT);return a.current===bT&&(a.current=m(g)),a}const Uz=[];function jz(m){Xe.useEffect(m,Uz)}class lb{constructor(){Li(this,"currentId",null);Li(this,"clear",()=>{this.currentId!==null&&(clearTimeout(this.currentId),this.currentId=null)});Li(this,"disposeEffect",()=>this.clear)}static create(){return new lb}start(g,a){this.clear(),this.currentId=setTimeout(()=>{this.currentId=null,a()},g)}}function $z(){const m=MM(lb.create).current;return jz(m.disposeEffect),m}function wT(m){try{return m.matches(":focus-visible")}catch{}return!1}function mf(m,g,a=void 0){const c={};for(const _ in m){const A=m[_];let N="",r=!0;for(let W=0;W<A.length;W+=1){const ie=A[W];ie&&(N+=(r===!0?"":" ")+g(ie),r=!1,a&&a[ie]&&(N+=" "+a[ie]))}c[_]=N}return c}const Hz=Xe.createContext(void 0);function Gz(m){const{theme:g,name:a,props:c}=m;if(!g||!g.components||!g.components[a])return c;const _=g.components[a];return _.defaultProps?Ax(_.defaultProps,c):!_.styleOverrides&&!_.variants?Ax(_,c):c}function Wz({props:m,name:g}){const a=Xe.useContext(Hz);return Gz({props:m,name:g,theme:{components:a}})}const ST={theme:void 0};function qz(m){let g,a;return function(_){let A=g;return(A===void 0||_.theme!==a)&&(ST.theme=_.theme,A=wM(m(ST)),g=A,a=_.theme),A}}function Yz(m=""){function g(...c){if(!c.length)return"";const _=c[0];return typeof _=="string"&&!_.match(/(#|\(|\)|(-?(\d*\.)?\d+)(px|em|%|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc))|^(-?(\d*\.)?\d+)$|(\d+ \d+ \d+)/)?`, var(--${m?`${m}-`:""}${_}${g(...c.slice(1))})`:`, ${_}`}return(c,..._)=>`var(--${m?`${m}-`:""}${c}${g(..._)})`}const TT=(m,g,a,c=[])=>{let _=m;g.forEach((A,N)=>{N===g.length-1?Array.isArray(_)?_[Number(A)]=a:_&&typeof _=="object"&&(_[A]=a):_&&typeof _=="object"&&(_[A]||(_[A]=c.includes(A)?[]:{}),_=_[A])})},Xz=(m,g,a)=>{function c(_,A=[],N=[]){Object.entries(_).forEach(([r,W])=>{(!a||a&&!a([...A,r]))&&W!=null&&(typeof W=="object"&&Object.keys(W).length>0?c(W,[...A,r],Array.isArray(W)?[...N,r]:N):g([...A,r],W,N))})}c(m)},Zz=(m,g)=>typeof g=="number"?["lineHeight","fontWeight","opacity","zIndex"].some(c=>m.includes(c))||m[m.length-1].toLowerCase().includes("opacity")?g:`${g}px`:g;function hx(m,g){const{prefix:a,shouldSkipGeneratingVar:c}=g||{},_={},A={},N={};return Xz(m,(r,W,ie)=>{if((typeof W=="string"||typeof W=="number")&&(!c||!c(r,W))){const oe=`--${a?`${a}-`:""}${r.join("-")}`,he=Zz(r,W);Object.assign(_,{[oe]:he}),TT(A,r,`var(${oe})`,ie),TT(N,r,`var(${oe}, ${he})`,ie)}},r=>r[0]==="vars"),{css:_,vars:A,varsWithDefaults:N}}function Kz(m,g={}){const{getSelector:a=Re,disableCssColorScheme:c,colorSchemeSelector:_}=g,{colorSchemes:A={},components:N,defaultColorScheme:r="light",...W}=m,{vars:ie,css:oe,varsWithDefaults:he}=hx(W,g);let ve=he;const Se={},{[r]:xe,...Ae}=A;if(Object.entries(Ae||{}).forEach(([ht,tt])=>{const{vars:at,css:Lt,varsWithDefaults:Ve}=hx(tt,g);ve=hl(ve,Ve),Se[ht]={css:Lt,vars:at}}),xe){const{css:ht,vars:tt,varsWithDefaults:at}=hx(xe,g);ve=hl(ve,at),Se[r]={css:ht,vars:tt}}function Re(ht,tt){var Lt,Ve;let at=_;if(_==="class"&&(at=".%s"),_==="data"&&(at="[data-%s]"),_!=null&&_.startsWith("data-")&&!_.includes("%s")&&(at=`[${_}="%s"]`),ht){if(at==="media")return m.defaultColorScheme===ht?":root":{[`@media (prefers-color-scheme: ${((Ve=(Lt=A[ht])==null?void 0:Lt.palette)==null?void 0:Ve.mode)||ht})`]:{":root":tt}};if(at)return m.defaultColorScheme===ht?`:root, ${at.replace("%s",String(ht))}`:at.replace("%s",String(ht))}return":root"}return{vars:ve,generateThemeVars:()=>{let ht={...ie};return Object.entries(Se).forEach(([,{vars:tt}])=>{ht=hl(ht,tt)}),ht},generateStyleSheets:()=>{var Tt,qt;const ht=[],tt=m.defaultColorScheme||"light";function at(Me,gt){Object.keys(gt).length&&ht.push(typeof Me=="string"?{[Me]:{...gt}}:Me)}at(a(void 0,{...oe}),oe);const{[tt]:Lt,...Ve}=Se;if(Lt){const{css:Me}=Lt,gt=(qt=(Tt=A[tt])==null?void 0:Tt.palette)==null?void 0:qt.mode,oi=!c&&gt?{colorScheme:gt,...Me}:{...Me};at(a(tt,{...oi}),oi)}return Object.entries(Ve).forEach(([Me,{css:gt}])=>{var ni,Mt;const oi=(Mt=(ni=A[Me])==null?void 0:ni.palette)==null?void 0:Mt.mode,Ti=!c&&oi?{colorScheme:oi,...gt}:{...gt};at(a(Me,{...Ti}),Ti)}),ht}}}function Jz(m){return function(a){return m==="media"?`@media (prefers-color-scheme: ${a})`:m?m.startsWith("data-")&&!m.includes("%s")?`[${m}="${a}"] &`:m==="class"?`.${a} &`:m==="data"?`[data-${a}] &`:`${m.replace("%s",a)} &`:"&"}}function CM(){return{text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:Qg.white,default:Qg.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}}}const Qz=CM();function EM(){return{text:{primary:Qg.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:Qg.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}}}const MT=EM();function CT(m,g,a,c){const _=c.light||c,A=c.dark||c*1.5;m[g]||(m.hasOwnProperty(a)?m[g]=m[a]:g==="light"?m.light=I0(m.main,_):g==="dark"&&(m.dark=D0(m.main,A)))}function eF(m="light"){return m==="dark"?{main:vm[200],light:vm[50],dark:vm[400]}:{main:vm[700],light:vm[400],dark:vm[800]}}function tF(m="light"){return m==="dark"?{main:ym[200],light:ym[50],dark:ym[400]}:{main:ym[500],light:ym[300],dark:ym[700]}}function iF(m="light"){return m==="dark"?{main:_m[500],light:_m[300],dark:_m[700]}:{main:_m[700],light:_m[400],dark:_m[800]}}function rF(m="light"){return m==="dark"?{main:xm[400],light:xm[300],dark:xm[700]}:{main:xm[700],light:xm[500],dark:xm[900]}}function nF(m="light"){return m==="dark"?{main:bm[400],light:bm[300],dark:bm[700]}:{main:bm[800],light:bm[500],dark:bm[900]}}function sF(m="light"){return m==="dark"?{main:Bg[400],light:Bg[300],dark:Bg[700]}:{main:"#ed6c02",light:Bg[500],dark:Bg[900]}}function cb(m){const{mode:g="light",contrastThreshold:a=3,tonalOffset:c=.2,..._}=m,A=m.primary||eF(g),N=m.secondary||tF(g),r=m.error||iF(g),W=m.info||rF(g),ie=m.success||nF(g),oe=m.warning||sF(g);function he(Ae){return Bz(Ae,MT.text.primary)>=a?MT.text.primary:Qz.text.primary}const ve=({color:Ae,name:Re,mainShade:He=500,lightShade:rt=300,darkShade:ht=700})=>{if(Ae={...Ae},!Ae.main&&Ae[He]&&(Ae.main=Ae[He]),!Ae.hasOwnProperty("main"))throw new Error(pf(11,Re?` (${Re})`:"",He));if(typeof Ae.main!="string")throw new Error(pf(12,Re?` (${Re})`:"",JSON.stringify(Ae.main)));return CT(Ae,"light",rt,c),CT(Ae,"dark",ht,c),Ae.contrastText||(Ae.contrastText=he(Ae.main)),Ae};let Se;return g==="light"?Se=CM():g==="dark"&&(Se=EM()),hl({common:{...Qg},mode:g,primary:ve({color:A,name:"primary"}),secondary:ve({color:N,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:ve({color:r,name:"error"}),warning:ve({color:oe,name:"warning"}),info:ve({color:W,name:"info"}),success:ve({color:ie,name:"success"}),grey:d3,contrastThreshold:a,getContrastText:he,augmentColor:ve,tonalOffset:c,...Se},_)}function oF(m){const g={};return Object.entries(m).forEach(c=>{const[_,A]=c;typeof A=="object"&&(g[_]=`${A.fontStyle?`${A.fontStyle} `:""}${A.fontVariant?`${A.fontVariant} `:""}${A.fontWeight?`${A.fontWeight} `:""}${A.fontStretch?`${A.fontStretch} `:""}${A.fontSize||""}${A.lineHeight?`/${A.lineHeight} `:""}${A.fontFamily||""}`)}),g}function aF(m,g){return{toolbar:{minHeight:56,[m.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[m.up("sm")]:{minHeight:64}},...g}}function lF(m){return Math.round(m*1e5)/1e5}const ET={textTransform:"uppercase"},AT='"Roboto", "Helvetica", "Arial", sans-serif';function cF(m,g){const{fontFamily:a=AT,fontSize:c=14,fontWeightLight:_=300,fontWeightRegular:A=400,fontWeightMedium:N=500,fontWeightBold:r=700,htmlFontSize:W=16,allVariants:ie,pxToRem:oe,...he}=typeof g=="function"?g(m):g,ve=c/14,Se=oe||(Re=>`${Re/W*ve}rem`),xe=(Re,He,rt,ht,tt)=>({fontFamily:a,fontWeight:Re,fontSize:Se(He),lineHeight:rt,...a===AT?{letterSpacing:`${lF(ht/He)}em`}:{},...tt,...ie}),Ae={h1:xe(_,96,1.167,-1.5),h2:xe(_,60,1.2,-.5),h3:xe(A,48,1.167,0),h4:xe(A,34,1.235,.25),h5:xe(A,24,1.334,0),h6:xe(N,20,1.6,.15),subtitle1:xe(A,16,1.75,.15),subtitle2:xe(N,14,1.57,.1),body1:xe(A,16,1.5,.15),body2:xe(A,14,1.43,.15),button:xe(N,14,1.75,.4,ET),caption:xe(A,12,1.66,.4),overline:xe(A,12,2.66,1,ET),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return hl({htmlFontSize:W,pxToRem:Se,fontFamily:a,fontSize:c,fontWeightLight:_,fontWeightRegular:A,fontWeightMedium:N,fontWeightBold:r,...Ae},he,{clone:!1})}const uF=.2,hF=.14,dF=.12;function ys(...m){return[`${m[0]}px ${m[1]}px ${m[2]}px ${m[3]}px rgba(0,0,0,${uF})`,`${m[4]}px ${m[5]}px ${m[6]}px ${m[7]}px rgba(0,0,0,${hF})`,`${m[8]}px ${m[9]}px ${m[10]}px ${m[11]}px rgba(0,0,0,${dF})`].join(",")}const pF=["none",ys(0,2,1,-1,0,1,1,0,0,1,3,0),ys(0,3,1,-2,0,2,2,0,0,1,5,0),ys(0,3,3,-2,0,3,4,0,0,1,8,0),ys(0,2,4,-1,0,4,5,0,0,1,10,0),ys(0,3,5,-1,0,5,8,0,0,1,14,0),ys(0,3,5,-1,0,6,10,0,0,1,18,0),ys(0,4,5,-2,0,7,10,1,0,2,16,1),ys(0,5,5,-3,0,8,10,1,0,3,14,2),ys(0,5,6,-3,0,9,12,1,0,3,16,2),ys(0,6,6,-3,0,10,14,1,0,4,18,3),ys(0,6,7,-4,0,11,15,1,0,4,20,3),ys(0,7,8,-4,0,12,17,2,0,5,22,4),ys(0,7,8,-4,0,13,19,2,0,5,24,4),ys(0,7,9,-4,0,14,21,2,0,5,26,4),ys(0,8,9,-5,0,15,22,2,0,6,28,5),ys(0,8,10,-5,0,16,24,2,0,6,30,5),ys(0,8,11,-5,0,17,26,2,0,6,32,5),ys(0,9,11,-5,0,18,28,2,0,7,34,6),ys(0,9,12,-6,0,19,29,2,0,7,36,6),ys(0,10,13,-6,0,20,31,3,0,8,38,7),ys(0,10,13,-6,0,21,33,3,0,8,40,7),ys(0,10,14,-6,0,22,35,3,0,8,42,7),ys(0,11,14,-7,0,23,36,3,0,9,44,8),ys(0,11,15,-7,0,24,38,3,0,9,46,8)],fF={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},mF={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function PT(m){return`${Math.round(m)}ms`}function gF(m){if(!m)return 0;const g=m/36;return Math.min(Math.round((4+15*g**.25+g/5)*10),3e3)}function _F(m){const g={...fF,...m.easing},a={...mF,...m.duration};return{getAutoHeightDuration:gF,create:(_=["all"],A={})=>{const{duration:N=a.standard,easing:r=g.easeInOut,delay:W=0,...ie}=A;return(Array.isArray(_)?_:[_]).map(oe=>`${oe} ${typeof N=="string"?N:PT(N)} ${r} ${typeof W=="string"?W:PT(W)}`).join(",")},...m,easing:g,duration:a}}const yF={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};function vF(m){return Fu(m)||typeof m>"u"||typeof m=="string"||typeof m=="boolean"||typeof m=="number"||Array.isArray(m)}function AM(m={}){const g={...m};function a(c){const _=Object.entries(c);for(let A=0;A<_.length;A++){const[N,r]=_[A];!vF(r)||N.startsWith("unstable_")?delete c[N]:Fu(r)&&(c[N]={...r},a(c[N]))}}return a(g),`import { unstable_createBreakpoints as createBreakpoints, createTransitions } from '@mui/material/styles';

const theme = ${JSON.stringify(g,null,2)};

theme.breakpoints = createBreakpoints(theme.breakpoints || {});
theme.transitions = createTransitions(theme.transitions || {});

export default theme;`}function Dx(m={},...g){const{breakpoints:a,mixins:c={},spacing:_,palette:A={},transitions:N={},typography:r={},shape:W,...ie}=m;if(m.vars&&m.generateThemeVars===void 0)throw new Error(pf(20));const oe=cb(A),he=bM(m);let ve=hl(he,{mixins:aF(he.breakpoints,c),palette:oe,shadows:pF.slice(),typography:cF(oe,r),transitions:_F(N),zIndex:{...yF}});return ve=hl(ve,ie),ve=g.reduce((Se,xe)=>hl(Se,xe),ve),ve.unstable_sxConfig={...h_,...ie==null?void 0:ie.unstable_sxConfig},ve.unstable_sx=function(xe){return Rm({sx:xe,theme:this})},ve.toRuntimeSource=AM,ve}function xF(m){let g;return m<1?g=5.11916*m**2:g=4.5*Math.log(m+1)+2,Math.round(g*10)/1e3}const bF=[...Array(25)].map((m,g)=>{if(g===0)return"none";const a=xF(g);return`linear-gradient(rgba(255 255 255 / ${a}), rgba(255 255 255 / ${a}))`});function PM(m){return{inputPlaceholder:m==="dark"?.5:.42,inputUnderline:m==="dark"?.7:.42,switchTrackDisabled:m==="dark"?.2:.12,switchTrack:m==="dark"?.3:.38}}function DM(m){return m==="dark"?bF:[]}function wF(m){const{palette:g={mode:"light"},opacity:a,overlays:c,..._}=m,A=cb(g);return{palette:A,opacity:{...PM(A.mode),...a},overlays:c||DM(A.mode),..._}}function SF(m){var g;return!!m[0].match(/(cssVarPrefix|colorSchemeSelector|rootSelector|typography|mixins|breakpoints|direction|transitions)/)||!!m[0].match(/sxConfig$/)||m[0]==="palette"&&!!((g=m[1])!=null&&g.match(/(mode|contrastThreshold|tonalOffset)/))}const TF=m=>[...[...Array(25)].map((g,a)=>`--${m?`${m}-`:""}overlays-${a}`),`--${m?`${m}-`:""}palette-AppBar-darkBg`,`--${m?`${m}-`:""}palette-AppBar-darkColor`],MF=m=>(g,a)=>{const c=m.rootSelector||":root",_=m.colorSchemeSelector;let A=_;if(_==="class"&&(A=".%s"),_==="data"&&(A="[data-%s]"),_!=null&&_.startsWith("data-")&&!_.includes("%s")&&(A=`[${_}="%s"]`),m.defaultColorScheme===g){if(g==="dark"){const N={};return TF(m.cssVarPrefix).forEach(r=>{N[r]=a[r],delete a[r]}),A==="media"?{[c]:a,"@media (prefers-color-scheme: dark)":{[c]:N}}:A?{[A.replace("%s",g)]:N,[`${c}, ${A.replace("%s",g)}`]:a}:{[c]:{...a,...N}}}if(A&&A!=="media")return`${c}, ${A.replace("%s",String(g))}`}else if(g){if(A==="media")return{[`@media (prefers-color-scheme: ${String(g)})`]:{[c]:a}};if(A)return A.replace("%s",String(g))}return c};function CF(m,g){g.forEach(a=>{m[a]||(m[a]={})})}function ri(m,g,a){!m[g]&&a&&(m[g]=a)}function Hg(m){return typeof m!="string"||!m.startsWith("hsl")?m:TM(m)}function Th(m,g){`${g}Channel`in m||(m[`${g}Channel`]=$g(Hg(m[g])))}function EF(m){return typeof m=="number"?`${m}px`:typeof m=="string"||typeof m=="function"||Array.isArray(m)?m:"8px"}const Pu=m=>{try{return m()}catch{}},AF=(m="mui")=>Yz(m);function dx(m,g,a,c){if(!g)return;g=g===!0?{}:g;const _=c==="dark"?"dark":"light";if(!a){m[c]=wF({...g,palette:{mode:_,...g==null?void 0:g.palette}});return}const{palette:A,...N}=Dx({...a,palette:{mode:_,...g==null?void 0:g.palette}});return m[c]={...g,palette:A,opacity:{...PM(_),...g==null?void 0:g.opacity},overlays:(g==null?void 0:g.overlays)||DM(_)},N}function PF(m={},...g){const{colorSchemes:a={light:!0},defaultColorScheme:c,disableCssColorScheme:_=!1,cssVarPrefix:A="mui",shouldSkipGeneratingVar:N=SF,colorSchemeSelector:r=a.light&&a.dark?"media":void 0,rootSelector:W=":root",...ie}=m,oe=Object.keys(a)[0],he=c||(a.light&&oe!=="light"?"light":oe),ve=AF(A),{[he]:Se,light:xe,dark:Ae,...Re}=a,He={...Re};let rt=Se;if((he==="dark"&&!("dark"in a)||he==="light"&&!("light"in a))&&(rt=!0),!rt)throw new Error(pf(21,he));const ht=dx(He,rt,ie,he);xe&&!He.light&&dx(He,xe,void 0,"light"),Ae&&!He.dark&&dx(He,Ae,void 0,"dark");let tt={defaultColorScheme:he,...ht,cssVarPrefix:A,colorSchemeSelector:r,rootSelector:W,getCssVar:ve,colorSchemes:He,font:{...oF(ht.typography),...ht.font},spacing:EF(ie.spacing)};Object.keys(tt.colorSchemes).forEach(qt=>{const Me=tt.colorSchemes[qt].palette,gt=oi=>{const Ti=oi.split("-"),ni=Ti[1],Mt=Ti[2];return ve(oi,Me[ni][Mt])};if(Me.mode==="light"&&(ri(Me.common,"background","#fff"),ri(Me.common,"onBackground","#000")),Me.mode==="dark"&&(ri(Me.common,"background","#000"),ri(Me.common,"onBackground","#fff")),CF(Me,["Alert","AppBar","Avatar","Button","Chip","FilledInput","LinearProgress","Skeleton","Slider","SnackbarContent","SpeedDialAction","StepConnector","StepContent","Switch","TableCell","Tooltip"]),Me.mode==="light"){ri(Me.Alert,"errorColor",Jn(Me.error.light,.6)),ri(Me.Alert,"infoColor",Jn(Me.info.light,.6)),ri(Me.Alert,"successColor",Jn(Me.success.light,.6)),ri(Me.Alert,"warningColor",Jn(Me.warning.light,.6)),ri(Me.Alert,"errorFilledBg",gt("palette-error-main")),ri(Me.Alert,"infoFilledBg",gt("palette-info-main")),ri(Me.Alert,"successFilledBg",gt("palette-success-main")),ri(Me.Alert,"warningFilledBg",gt("palette-warning-main")),ri(Me.Alert,"errorFilledColor",Pu(()=>Me.getContrastText(Me.error.main))),ri(Me.Alert,"infoFilledColor",Pu(()=>Me.getContrastText(Me.info.main))),ri(Me.Alert,"successFilledColor",Pu(()=>Me.getContrastText(Me.success.main))),ri(Me.Alert,"warningFilledColor",Pu(()=>Me.getContrastText(Me.warning.main))),ri(Me.Alert,"errorStandardBg",Qn(Me.error.light,.9)),ri(Me.Alert,"infoStandardBg",Qn(Me.info.light,.9)),ri(Me.Alert,"successStandardBg",Qn(Me.success.light,.9)),ri(Me.Alert,"warningStandardBg",Qn(Me.warning.light,.9)),ri(Me.Alert,"errorIconColor",gt("palette-error-main")),ri(Me.Alert,"infoIconColor",gt("palette-info-main")),ri(Me.Alert,"successIconColor",gt("palette-success-main")),ri(Me.Alert,"warningIconColor",gt("palette-warning-main")),ri(Me.AppBar,"defaultBg",gt("palette-grey-100")),ri(Me.Avatar,"defaultBg",gt("palette-grey-400")),ri(Me.Button,"inheritContainedBg",gt("palette-grey-300")),ri(Me.Button,"inheritContainedHoverBg",gt("palette-grey-A100")),ri(Me.Chip,"defaultBorder",gt("palette-grey-400")),ri(Me.Chip,"defaultAvatarColor",gt("palette-grey-700")),ri(Me.Chip,"defaultIconColor",gt("palette-grey-700")),ri(Me.FilledInput,"bg","rgba(0, 0, 0, 0.06)"),ri(Me.FilledInput,"hoverBg","rgba(0, 0, 0, 0.09)"),ri(Me.FilledInput,"disabledBg","rgba(0, 0, 0, 0.12)"),ri(Me.LinearProgress,"primaryBg",Qn(Me.primary.main,.62)),ri(Me.LinearProgress,"secondaryBg",Qn(Me.secondary.main,.62)),ri(Me.LinearProgress,"errorBg",Qn(Me.error.main,.62)),ri(Me.LinearProgress,"infoBg",Qn(Me.info.main,.62)),ri(Me.LinearProgress,"successBg",Qn(Me.success.main,.62)),ri(Me.LinearProgress,"warningBg",Qn(Me.warning.main,.62)),ri(Me.Skeleton,"bg",`rgba(${gt("palette-text-primaryChannel")} / 0.11)`),ri(Me.Slider,"primaryTrack",Qn(Me.primary.main,.62)),ri(Me.Slider,"secondaryTrack",Qn(Me.secondary.main,.62)),ri(Me.Slider,"errorTrack",Qn(Me.error.main,.62)),ri(Me.Slider,"infoTrack",Qn(Me.info.main,.62)),ri(Me.Slider,"successTrack",Qn(Me.success.main,.62)),ri(Me.Slider,"warningTrack",Qn(Me.warning.main,.62));const oi=wy(Me.background.default,.8);ri(Me.SnackbarContent,"bg",oi),ri(Me.SnackbarContent,"color",Pu(()=>Me.getContrastText(oi))),ri(Me.SpeedDialAction,"fabHoverBg",wy(Me.background.paper,.15)),ri(Me.StepConnector,"border",gt("palette-grey-400")),ri(Me.StepContent,"border",gt("palette-grey-400")),ri(Me.Switch,"defaultColor",gt("palette-common-white")),ri(Me.Switch,"defaultDisabledColor",gt("palette-grey-100")),ri(Me.Switch,"primaryDisabledColor",Qn(Me.primary.main,.62)),ri(Me.Switch,"secondaryDisabledColor",Qn(Me.secondary.main,.62)),ri(Me.Switch,"errorDisabledColor",Qn(Me.error.main,.62)),ri(Me.Switch,"infoDisabledColor",Qn(Me.info.main,.62)),ri(Me.Switch,"successDisabledColor",Qn(Me.success.main,.62)),ri(Me.Switch,"warningDisabledColor",Qn(Me.warning.main,.62)),ri(Me.TableCell,"border",Qn(by(Me.divider,1),.88)),ri(Me.Tooltip,"bg",by(Me.grey[700],.92))}if(Me.mode==="dark"){ri(Me.Alert,"errorColor",Qn(Me.error.light,.6)),ri(Me.Alert,"infoColor",Qn(Me.info.light,.6)),ri(Me.Alert,"successColor",Qn(Me.success.light,.6)),ri(Me.Alert,"warningColor",Qn(Me.warning.light,.6)),ri(Me.Alert,"errorFilledBg",gt("palette-error-dark")),ri(Me.Alert,"infoFilledBg",gt("palette-info-dark")),ri(Me.Alert,"successFilledBg",gt("palette-success-dark")),ri(Me.Alert,"warningFilledBg",gt("palette-warning-dark")),ri(Me.Alert,"errorFilledColor",Pu(()=>Me.getContrastText(Me.error.dark))),ri(Me.Alert,"infoFilledColor",Pu(()=>Me.getContrastText(Me.info.dark))),ri(Me.Alert,"successFilledColor",Pu(()=>Me.getContrastText(Me.success.dark))),ri(Me.Alert,"warningFilledColor",Pu(()=>Me.getContrastText(Me.warning.dark))),ri(Me.Alert,"errorStandardBg",Jn(Me.error.light,.9)),ri(Me.Alert,"infoStandardBg",Jn(Me.info.light,.9)),ri(Me.Alert,"successStandardBg",Jn(Me.success.light,.9)),ri(Me.Alert,"warningStandardBg",Jn(Me.warning.light,.9)),ri(Me.Alert,"errorIconColor",gt("palette-error-main")),ri(Me.Alert,"infoIconColor",gt("palette-info-main")),ri(Me.Alert,"successIconColor",gt("palette-success-main")),ri(Me.Alert,"warningIconColor",gt("palette-warning-main")),ri(Me.AppBar,"defaultBg",gt("palette-grey-900")),ri(Me.AppBar,"darkBg",gt("palette-background-paper")),ri(Me.AppBar,"darkColor",gt("palette-text-primary")),ri(Me.Avatar,"defaultBg",gt("palette-grey-600")),ri(Me.Button,"inheritContainedBg",gt("palette-grey-800")),ri(Me.Button,"inheritContainedHoverBg",gt("palette-grey-700")),ri(Me.Chip,"defaultBorder",gt("palette-grey-700")),ri(Me.Chip,"defaultAvatarColor",gt("palette-grey-300")),ri(Me.Chip,"defaultIconColor",gt("palette-grey-300")),ri(Me.FilledInput,"bg","rgba(255, 255, 255, 0.09)"),ri(Me.FilledInput,"hoverBg","rgba(255, 255, 255, 0.13)"),ri(Me.FilledInput,"disabledBg","rgba(255, 255, 255, 0.12)"),ri(Me.LinearProgress,"primaryBg",Jn(Me.primary.main,.5)),ri(Me.LinearProgress,"secondaryBg",Jn(Me.secondary.main,.5)),ri(Me.LinearProgress,"errorBg",Jn(Me.error.main,.5)),ri(Me.LinearProgress,"infoBg",Jn(Me.info.main,.5)),ri(Me.LinearProgress,"successBg",Jn(Me.success.main,.5)),ri(Me.LinearProgress,"warningBg",Jn(Me.warning.main,.5)),ri(Me.Skeleton,"bg",`rgba(${gt("palette-text-primaryChannel")} / 0.13)`),ri(Me.Slider,"primaryTrack",Jn(Me.primary.main,.5)),ri(Me.Slider,"secondaryTrack",Jn(Me.secondary.main,.5)),ri(Me.Slider,"errorTrack",Jn(Me.error.main,.5)),ri(Me.Slider,"infoTrack",Jn(Me.info.main,.5)),ri(Me.Slider,"successTrack",Jn(Me.success.main,.5)),ri(Me.Slider,"warningTrack",Jn(Me.warning.main,.5));const oi=wy(Me.background.default,.98);ri(Me.SnackbarContent,"bg",oi),ri(Me.SnackbarContent,"color",Pu(()=>Me.getContrastText(oi))),ri(Me.SpeedDialAction,"fabHoverBg",wy(Me.background.paper,.15)),ri(Me.StepConnector,"border",gt("palette-grey-600")),ri(Me.StepContent,"border",gt("palette-grey-600")),ri(Me.Switch,"defaultColor",gt("palette-grey-300")),ri(Me.Switch,"defaultDisabledColor",gt("palette-grey-600")),ri(Me.Switch,"primaryDisabledColor",Jn(Me.primary.main,.55)),ri(Me.Switch,"secondaryDisabledColor",Jn(Me.secondary.main,.55)),ri(Me.Switch,"errorDisabledColor",Jn(Me.error.main,.55)),ri(Me.Switch,"infoDisabledColor",Jn(Me.info.main,.55)),ri(Me.Switch,"successDisabledColor",Jn(Me.success.main,.55)),ri(Me.Switch,"warningDisabledColor",Jn(Me.warning.main,.55)),ri(Me.TableCell,"border",Jn(by(Me.divider,1),.68)),ri(Me.Tooltip,"bg",by(Me.grey[700],.92))}Th(Me.background,"default"),Th(Me.background,"paper"),Th(Me.common,"background"),Th(Me.common,"onBackground"),Th(Me,"divider"),Object.keys(Me).forEach(oi=>{const Ti=Me[oi];oi!=="tonalOffset"&&Ti&&typeof Ti=="object"&&(Ti.main&&ri(Me[oi],"mainChannel",$g(Hg(Ti.main))),Ti.light&&ri(Me[oi],"lightChannel",$g(Hg(Ti.light))),Ti.dark&&ri(Me[oi],"darkChannel",$g(Hg(Ti.dark))),Ti.contrastText&&ri(Me[oi],"contrastTextChannel",$g(Hg(Ti.contrastText))),oi==="text"&&(Th(Me[oi],"primary"),Th(Me[oi],"secondary")),oi==="action"&&(Ti.active&&Th(Me[oi],"active"),Ti.selected&&Th(Me[oi],"selected")))})}),tt=g.reduce((qt,Me)=>hl(qt,Me),tt);const at={prefix:A,disableCssColorScheme:_,shouldSkipGeneratingVar:N,getSelector:MF(tt)},{vars:Lt,generateThemeVars:Ve,generateStyleSheets:Tt}=Kz(tt,at);return tt.vars=Lt,Object.entries(tt.colorSchemes[tt.defaultColorScheme]).forEach(([qt,Me])=>{tt[qt]=Me}),tt.generateThemeVars=Ve,tt.generateStyleSheets=Tt,tt.generateSpacing=function(){return xM(ie.spacing,sb(this))},tt.getColorSchemeSelector=Jz(r),tt.spacing=tt.generateSpacing(),tt.shouldSkipGeneratingVar=N,tt.unstable_sxConfig={...h_,...ie==null?void 0:ie.unstable_sxConfig},tt.unstable_sx=function(Me){return Rm({sx:Me,theme:this})},tt.toRuntimeSource=AM,tt}function DT(m,g,a){m.colorSchemes&&a&&(m.colorSchemes[g]={...a!==!0&&a,palette:cb({...a===!0?{}:a.palette,mode:g})})}function DF(m={},...g){const{palette:a,cssVariables:c=!1,colorSchemes:_=a?void 0:{light:!0},defaultColorScheme:A=a==null?void 0:a.mode,...N}=m,r=A||"light",W=_==null?void 0:_[r],ie={..._,...a?{[r]:{...typeof W!="boolean"&&W,palette:a}}:void 0};if(c===!1){if(!("colorSchemes"in m))return Dx(m,...g);let oe=a;"palette"in m||ie[r]&&(ie[r]!==!0?oe=ie[r].palette:r==="dark"&&(oe={mode:"dark"}));const he=Dx({...m,palette:oe},...g);return he.defaultColorScheme=r,he.colorSchemes=ie,he.palette.mode==="light"&&(he.colorSchemes.light={...ie.light!==!0&&ie.light,palette:he.palette},DT(he,"dark",ie.dark)),he.palette.mode==="dark"&&(he.colorSchemes.dark={...ie.dark!==!0&&ie.dark,palette:he.palette},DT(he,"light",ie.light)),he}return!a&&!("light"in ie)&&r==="light"&&(ie.light=!0),PF({...N,colorSchemes:ie,defaultColorScheme:r,...typeof c!="boolean"&&c},...g)}const IF=DF();function kF(m){return m!=="ownerState"&&m!=="theme"&&m!=="sx"&&m!=="as"}const OF=m=>kF(m)&&m!=="classes",Bc=Pz({themeId:p3,defaultTheme:IF,rootShouldForwardProp:OF});function LF(){return wz}const Nm=qz;function Hd(m){return Wz(m)}function RF(m,g){m.prototype=Object.create(g.prototype),m.prototype.constructor=m,Vy(m,g)}const IT=Qt.createContext(null);function ub(m,g){var a=function(A){return g&&Xe.isValidElement(A)?g(A):A},c=Object.create(null);return m&&Xe.Children.map(m,function(_){return _}).forEach(function(_){c[_.key]=a(_)}),c}function zF(m,g){m=m||{},g=g||{};function a(oe){return oe in g?g[oe]:m[oe]}var c=Object.create(null),_=[];for(var A in m)A in g?_.length&&(c[A]=_,_=[]):_.push(A);var N,r={};for(var W in g){if(c[W])for(N=0;N<c[W].length;N++){var ie=c[W][N];r[c[W][N]]=a(ie)}r[W]=a(W)}for(N=0;N<_.length;N++)r[_[N]]=a(_[N]);return r}function sf(m,g,a){return a[g]!=null?a[g]:m.props[g]}function FF(m,g){return ub(m.children,function(a){return Xe.cloneElement(a,{onExited:g.bind(null,a),in:!0,appear:sf(a,"appear",m),enter:sf(a,"enter",m),exit:sf(a,"exit",m)})})}function BF(m,g,a){var c=ub(m.children),_=zF(g,c);return Object.keys(_).forEach(function(A){var N=_[A];if(Xe.isValidElement(N)){var r=A in g,W=A in c,ie=g[A],oe=Xe.isValidElement(ie)&&!ie.props.in;W&&(!r||oe)?_[A]=Xe.cloneElement(N,{onExited:a.bind(null,N),in:!0,exit:sf(N,"exit",m),enter:sf(N,"enter",m)}):!W&&r&&!oe?_[A]=Xe.cloneElement(N,{in:!1}):W&&r&&Xe.isValidElement(ie)&&(_[A]=Xe.cloneElement(N,{onExited:a.bind(null,N),in:ie.props.in,exit:sf(N,"exit",m),enter:sf(N,"enter",m)}))}}),_}var NF=Object.values||function(m){return Object.keys(m).map(function(g){return m[g]})},VF={component:"div",childFactory:function(g){return g}},hb=function(m){RF(g,m);function g(c,_){var A;A=m.call(this,c,_)||this;var N=A.handleExited.bind(YT(A));return A.state={contextValue:{isMounting:!0},handleExited:N,firstRender:!0},A}var a=g.prototype;return a.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},a.componentWillUnmount=function(){this.mounted=!1},g.getDerivedStateFromProps=function(_,A){var N=A.children,r=A.handleExited,W=A.firstRender;return{children:W?FF(_,r):BF(_,N,r),firstRender:!1}},a.handleExited=function(_,A){var N=ub(this.props.children);_.key in N||(_.props.onExited&&_.props.onExited(A),this.mounted&&this.setState(function(r){var W=yr({},r.children);return delete W[_.key],{children:W}}))},a.render=function(){var _=this.props,A=_.component,N=_.childFactory,r=WT(_,["component","childFactory"]),W=this.state.contextValue,ie=NF(this.state.children).map(N);return delete r.appear,delete r.enter,delete r.exit,A===null?Qt.createElement(IT.Provider,{value:W},ie):Qt.createElement(IT.Provider,{value:W},Qt.createElement(A,r,ie))},g}(Qt.Component);hb.propTypes={};hb.defaultProps=VF;class o0{constructor(){Li(this,"mountEffect",()=>{this.shouldMount&&!this.didMount&&this.ref.current!==null&&(this.didMount=!0,this.mounted.resolve())});this.ref={current:null},this.mounted=null,this.didMount=!1,this.shouldMount=!1,this.setShouldMount=null}static create(){return new o0}static use(){const g=MM(o0.create).current,[a,c]=Xe.useState(!1);return g.shouldMount=a,g.setShouldMount=c,Xe.useEffect(g.mountEffect,[a]),g}mount(){return this.mounted||(this.mounted=jF(),this.shouldMount=!0,this.setShouldMount(this.shouldMount)),this.mounted}start(...g){this.mount().then(()=>{var a;return(a=this.ref.current)==null?void 0:a.start(...g)})}stop(...g){this.mount().then(()=>{var a;return(a=this.ref.current)==null?void 0:a.stop(...g)})}pulsate(...g){this.mount().then(()=>{var a;return(a=this.ref.current)==null?void 0:a.pulsate(...g)})}}function UF(){return o0.use()}function jF(){let m,g;const a=new Promise((c,_)=>{m=c,g=_});return a.resolve=m,a.reject=g,a}function $F(m){const{className:g,classes:a,pulsate:c=!1,rippleX:_,rippleY:A,rippleSize:N,in:r,onExited:W,timeout:ie}=m,[oe,he]=Xe.useState(!1),ve=gn(g,a.ripple,a.rippleVisible,c&&a.ripplePulsate),Se={width:N,height:N,top:-(N/2)+A,left:-(N/2)+_},xe=gn(a.child,oe&&a.childLeaving,c&&a.childPulsate);return!r&&!oe&&he(!0),Xe.useEffect(()=>{if(!r&&W!=null){const Ae=setTimeout(W,ie);return()=>{clearTimeout(Ae)}}},[W,r,ie]),hi.jsx("span",{className:ve,style:Se,children:hi.jsx("span",{className:xe})})}const ql=$d("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),Ix=550,HF=80,GF=Fm`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`,WF=Fm`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`,qF=Fm`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`,YF=Bc("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),XF=Bc($F,{name:"MuiTouchRipple",slot:"Ripple"})`
  opacity: 0;
  position: absolute;

  &.${ql.rippleVisible} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${GF};
    animation-duration: ${Ix}ms;
    animation-timing-function: ${({theme:m})=>m.transitions.easing.easeInOut};
  }

  &.${ql.ripplePulsate} {
    animation-duration: ${({theme:m})=>m.transitions.duration.shorter}ms;
  }

  & .${ql.child} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${ql.childLeaving} {
    opacity: 0;
    animation-name: ${WF};
    animation-duration: ${Ix}ms;
    animation-timing-function: ${({theme:m})=>m.transitions.easing.easeInOut};
  }

  & .${ql.childPulsate} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${qF};
    animation-duration: 2500ms;
    animation-timing-function: ${({theme:m})=>m.transitions.easing.easeInOut};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`,ZF=Xe.forwardRef(function(g,a){const c=Hd({props:g,name:"MuiTouchRipple"}),{center:_=!1,classes:A={},className:N,...r}=c,[W,ie]=Xe.useState([]),oe=Xe.useRef(0),he=Xe.useRef(null);Xe.useEffect(()=>{he.current&&(he.current(),he.current=null)},[W]);const ve=Xe.useRef(!1),Se=$z(),xe=Xe.useRef(null),Ae=Xe.useRef(null),Re=Xe.useCallback(tt=>{const{pulsate:at,rippleX:Lt,rippleY:Ve,rippleSize:Tt,cb:qt}=tt;ie(Me=>[...Me,hi.jsx(XF,{classes:{ripple:gn(A.ripple,ql.ripple),rippleVisible:gn(A.rippleVisible,ql.rippleVisible),ripplePulsate:gn(A.ripplePulsate,ql.ripplePulsate),child:gn(A.child,ql.child),childLeaving:gn(A.childLeaving,ql.childLeaving),childPulsate:gn(A.childPulsate,ql.childPulsate)},timeout:Ix,pulsate:at,rippleX:Lt,rippleY:Ve,rippleSize:Tt},oe.current)]),oe.current+=1,he.current=qt},[A]),He=Xe.useCallback((tt={},at={},Lt=()=>{})=>{const{pulsate:Ve=!1,center:Tt=_||at.pulsate,fakeElement:qt=!1}=at;if((tt==null?void 0:tt.type)==="mousedown"&&ve.current){ve.current=!1;return}(tt==null?void 0:tt.type)==="touchstart"&&(ve.current=!0);const Me=qt?null:Ae.current,gt=Me?Me.getBoundingClientRect():{width:0,height:0,left:0,top:0};let oi,Ti,ni;if(Tt||tt===void 0||tt.clientX===0&&tt.clientY===0||!tt.clientX&&!tt.touches)oi=Math.round(gt.width/2),Ti=Math.round(gt.height/2);else{const{clientX:Mt,clientY:zt}=tt.touches&&tt.touches.length>0?tt.touches[0]:tt;oi=Math.round(Mt-gt.left),Ti=Math.round(zt-gt.top)}if(Tt)ni=Math.sqrt((2*gt.width**2+gt.height**2)/3),ni%2===0&&(ni+=1);else{const Mt=Math.max(Math.abs((Me?Me.clientWidth:0)-oi),oi)*2+2,zt=Math.max(Math.abs((Me?Me.clientHeight:0)-Ti),Ti)*2+2;ni=Math.sqrt(Mt**2+zt**2)}tt!=null&&tt.touches?xe.current===null&&(xe.current=()=>{Re({pulsate:Ve,rippleX:oi,rippleY:Ti,rippleSize:ni,cb:Lt})},Se.start(HF,()=>{xe.current&&(xe.current(),xe.current=null)})):Re({pulsate:Ve,rippleX:oi,rippleY:Ti,rippleSize:ni,cb:Lt})},[_,Re,Se]),rt=Xe.useCallback(()=>{He({},{pulsate:!0})},[He]),ht=Xe.useCallback((tt,at)=>{if(Se.clear(),(tt==null?void 0:tt.type)==="touchend"&&xe.current){xe.current(),xe.current=null,Se.start(0,()=>{ht(tt,at)});return}xe.current=null,ie(Lt=>Lt.length>0?Lt.slice(1):Lt),he.current=at},[Se]);return Xe.useImperativeHandle(a,()=>({pulsate:rt,start:He,stop:ht}),[rt,He,ht]),hi.jsx(YF,{className:gn(ql.root,A.root,N),ref:Ae,...r,children:hi.jsx(hb,{component:null,exit:!0,children:W})})});function KF(m){return jd("MuiButtonBase",m)}const JF=$d("MuiButtonBase",["root","disabled","focusVisible"]),QF=m=>{const{disabled:g,focusVisible:a,focusVisibleClassName:c,classes:_}=m,N=mf({root:["root",g&&"disabled",a&&"focusVisible"]},KF,_);return a&&c&&(N.root+=` ${c}`),N},eB=Bc("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(m,g)=>g.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${JF.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),tB=Xe.forwardRef(function(g,a){const c=Hd({props:g,name:"MuiButtonBase"}),{action:_,centerRipple:A=!1,children:N,className:r,component:W="button",disabled:ie=!1,disableRipple:oe=!1,disableTouchRipple:he=!1,focusRipple:ve=!1,focusVisibleClassName:Se,LinkComponent:xe="a",onBlur:Ae,onClick:Re,onContextMenu:He,onDragLeave:rt,onFocus:ht,onFocusVisible:tt,onKeyDown:at,onKeyUp:Lt,onMouseDown:Ve,onMouseLeave:Tt,onMouseUp:qt,onTouchEnd:Me,onTouchMove:gt,onTouchStart:oi,tabIndex:Ti=0,TouchRippleProps:ni,touchRippleRef:Mt,type:zt,...ii}=c,Yt=Xe.useRef(null),jt=UF(),Ri=xT(jt.ref,Mt),[Yi,Wi]=Xe.useState(!1);ie&&Yi&&Wi(!1),Xe.useImperativeHandle(_,()=>({focusVisible:()=>{Wi(!0),Yt.current.focus()}}),[]);const vi=jt.shouldMount&&!oe&&!ie;Xe.useEffect(()=>{Yi&&ve&&!oe&&jt.pulsate()},[oe,ve,Yi,jt]);const Wr=Mh(jt,"start",Ve,he),an=Mh(jt,"stop",He,he),_n=Mh(jt,"stop",rt,he),En=Mh(jt,"stop",qt,he),qr=Mh(jt,"stop",xr=>{Yi&&xr.preventDefault(),Tt&&Tt(xr)},he),es=Mh(jt,"start",oi,he),Ye=Mh(jt,"stop",Me,he),ds=Mh(jt,"stop",gt,he),Bi=Mh(jt,"stop",xr=>{wT(xr.target)||Wi(!1),Ae&&Ae(xr)},!1),Xs=Fy(xr=>{Yt.current||(Yt.current=xr.currentTarget),wT(xr.target)&&(Wi(!0),tt&&tt(xr)),ht&&ht(xr)}),Wt=()=>{const xr=Yt.current;return W&&W!=="button"&&!(xr.tagName==="A"&&xr.href)},jn=Fy(xr=>{ve&&!xr.repeat&&Yi&&xr.key===" "&&jt.stop(xr,()=>{jt.start(xr)}),xr.target===xr.currentTarget&&Wt()&&xr.key===" "&&xr.preventDefault(),at&&at(xr),xr.target===xr.currentTarget&&Wt()&&xr.key==="Enter"&&!ie&&(xr.preventDefault(),Re&&Re(xr))}),As=Fy(xr=>{ve&&xr.key===" "&&Yi&&!xr.defaultPrevented&&jt.stop(xr,()=>{jt.pulsate(xr)}),Lt&&Lt(xr),Re&&xr.target===xr.currentTarget&&Wt()&&xr.key===" "&&!xr.defaultPrevented&&Re(xr)});let mo=W;mo==="button"&&(ii.href||ii.to)&&(mo=xe);const rr={};mo==="button"?(rr.type=zt===void 0?"button":zt,rr.disabled=ie):(!ii.href&&!ii.to&&(rr.role="button"),ie&&(rr["aria-disabled"]=ie));const $n=xT(a,Yt),xs={...c,centerRipple:A,component:W,disabled:ie,disableRipple:oe,disableTouchRipple:he,focusRipple:ve,tabIndex:Ti,focusVisible:Yi},Ca=QF(xs);return hi.jsxs(eB,{as:mo,className:gn(Ca.root,r),ownerState:xs,onBlur:Bi,onClick:Re,onContextMenu:an,onFocus:Xs,onKeyDown:jn,onKeyUp:As,onMouseDown:Wr,onMouseLeave:qr,onMouseUp:En,onDragLeave:_n,onTouchEnd:Ye,onTouchMove:ds,onTouchStart:es,ref:$n,tabIndex:ie?-1:Ti,type:zt,...rr,...ii,children:[N,vi?hi.jsx(ZF,{ref:Ri,center:A,...ni}):null]})});function Mh(m,g,a,c=!1){return Fy(_=>(a&&a(_),c||m[g](_),!0))}function iB(m){return typeof m.main=="string"}function rB(m,g=[]){if(!iB(m))return!1;for(const a of g)if(!m.hasOwnProperty(a)||typeof m[a]!="string")return!1;return!0}function IM(m=[]){return([,g])=>g&&rB(g,m)}function nB(m){return jd("MuiCircularProgress",m)}$d("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);const Rd=44,kx=Fm`
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
`,Ox=Fm`
  0% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: 0;
  }

  50% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -15px;
  }

  100% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: -126px;
  }
`,sB=typeof kx!="string"?n_`
        animation: ${kx} 1.4s linear infinite;
      `:null,oB=typeof Ox!="string"?n_`
        animation: ${Ox} 1.4s ease-in-out infinite;
      `:null,aB=m=>{const{classes:g,variant:a,color:c,disableShrink:_}=m,A={root:["root",a,`color${Ma(c)}`],svg:["svg"],circle:["circle",`circle${Ma(a)}`,_&&"circleDisableShrink"]};return mf(A,nB,g)},lB=Bc("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(m,g)=>{const{ownerState:a}=m;return[g.root,g[a.variant],g[`color${Ma(a.color)}`]]}})(Nm(({theme:m})=>({display:"inline-block",variants:[{props:{variant:"determinate"},style:{transition:m.transitions.create("transform")}},{props:{variant:"indeterminate"},style:sB||{animation:`${kx} 1.4s linear infinite`}},...Object.entries(m.palette).filter(IM()).map(([g])=>({props:{color:g},style:{color:(m.vars||m).palette[g].main}}))]}))),cB=Bc("svg",{name:"MuiCircularProgress",slot:"Svg",overridesResolver:(m,g)=>g.svg})({display:"block"}),uB=Bc("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(m,g)=>{const{ownerState:a}=m;return[g.circle,g[`circle${Ma(a.variant)}`],a.disableShrink&&g.circleDisableShrink]}})(Nm(({theme:m})=>({stroke:"currentColor",variants:[{props:{variant:"determinate"},style:{transition:m.transitions.create("stroke-dashoffset")}},{props:{variant:"indeterminate"},style:{strokeDasharray:"80px, 200px",strokeDashoffset:0}},{props:({ownerState:g})=>g.variant==="indeterminate"&&!g.disableShrink,style:oB||{animation:`${Ox} 1.4s ease-in-out infinite`}}]}))),hB=Xe.forwardRef(function(g,a){const c=Hd({props:g,name:"MuiCircularProgress"}),{className:_,color:A="primary",disableShrink:N=!1,size:r=40,style:W,thickness:ie=3.6,value:oe=0,variant:he="indeterminate",...ve}=c,Se={...c,color:A,disableShrink:N,size:r,thickness:ie,value:oe,variant:he},xe=aB(Se),Ae={},Re={},He={};if(he==="determinate"){const rt=2*Math.PI*((Rd-ie)/2);Ae.strokeDasharray=rt.toFixed(3),He["aria-valuenow"]=Math.round(oe),Ae.strokeDashoffset=`${((100-oe)/100*rt).toFixed(3)}px`,Re.transform="rotate(-90deg)"}return hi.jsx(lB,{className:gn(xe.root,_),style:{width:r,height:r,...Re,...W},ownerState:Se,ref:a,role:"progressbar",...He,...ve,children:hi.jsx(cB,{className:xe.svg,ownerState:Se,viewBox:`${Rd/2} ${Rd/2} ${Rd} ${Rd}`,children:hi.jsx(uB,{className:xe.circle,style:Ae,ownerState:Se,cx:Rd,cy:Rd,r:(Rd-ie)/2,fill:"none",strokeWidth:ie})})})});function dB(m){return jd("MuiTypography",m)}$d("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const pB={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},fB=LF(),mB=m=>{const{align:g,gutterBottom:a,noWrap:c,paragraph:_,variant:A,classes:N}=m,r={root:["root",A,m.align!=="inherit"&&`align${Ma(g)}`,a&&"gutterBottom",c&&"noWrap",_&&"paragraph"]};return mf(r,dB,N)},gB=Bc("span",{name:"MuiTypography",slot:"Root",overridesResolver:(m,g)=>{const{ownerState:a}=m;return[g.root,a.variant&&g[a.variant],a.align!=="inherit"&&g[`align${Ma(a.align)}`],a.noWrap&&g.noWrap,a.gutterBottom&&g.gutterBottom,a.paragraph&&g.paragraph]}})(Nm(({theme:m})=>{var g;return{margin:0,variants:[{props:{variant:"inherit"},style:{font:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}},...Object.entries(m.typography).filter(([a,c])=>a!=="inherit"&&c&&typeof c=="object").map(([a,c])=>({props:{variant:a},style:c})),...Object.entries(m.palette).filter(IM()).map(([a])=>({props:{color:a},style:{color:(m.vars||m).palette[a].main}})),...Object.entries(((g=m.palette)==null?void 0:g.text)||{}).filter(([,a])=>typeof a=="string").map(([a])=>({props:{color:`text${Ma(a)}`},style:{color:(m.vars||m).palette.text[a]}})),{props:({ownerState:a})=>a.align!=="inherit",style:{textAlign:"var(--Typography-textAlign)"}},{props:({ownerState:a})=>a.noWrap,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},{props:({ownerState:a})=>a.gutterBottom,style:{marginBottom:"0.35em"}},{props:({ownerState:a})=>a.paragraph,style:{marginBottom:16}}]}})),kT={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},_B=Xe.forwardRef(function(g,a){const{color:c,..._}=Hd({props:g,name:"MuiTypography"}),A=!pB[c],N=fB({..._,...A&&{color:c}}),{align:r="inherit",className:W,component:ie,gutterBottom:oe=!1,noWrap:he=!1,paragraph:ve=!1,variant:Se="body1",variantMapping:xe=kT,...Ae}=N,Re={...N,align:r,color:c,className:W,component:ie,gutterBottom:oe,noWrap:he,paragraph:ve,variant:Se,variantMapping:xe},He=ie||(ve?"p":xe[Se]||kT[Se])||"span",rt=mB(Re);return hi.jsx(gB,{as:He,ref:a,className:gn(rt.root,W),...Ae,ownerState:Re,style:{...r!=="inherit"&&{"--Typography-textAlign":r},...Ae.style}})}),kM=Xe.createContext();function yB(m){return jd("MuiTable",m)}$d("MuiTable",["root","stickyHeader"]);const vB=m=>{const{classes:g,stickyHeader:a}=m;return mf({root:["root",a&&"stickyHeader"]},yB,g)},xB=Bc("table",{name:"MuiTable",slot:"Root",overridesResolver:(m,g)=>{const{ownerState:a}=m;return[g.root,a.stickyHeader&&g.stickyHeader]}})(Nm(({theme:m})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...m.typography.body2,padding:m.spacing(2),color:(m.vars||m).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:g})=>g.stickyHeader,style:{borderCollapse:"separate"}}]}))),OT="table",bB=Xe.forwardRef(function(g,a){const c=Hd({props:g,name:"MuiTable"}),{className:_,component:A=OT,padding:N="normal",size:r="medium",stickyHeader:W=!1,...ie}=c,oe={...c,component:A,padding:N,size:r,stickyHeader:W},he=vB(oe),ve=Xe.useMemo(()=>({padding:N,size:r,stickyHeader:W}),[N,r,W]);return hi.jsx(kM.Provider,{value:ve,children:hi.jsx(xB,{as:A,role:A===OT?null:"table",ref:a,className:gn(he.root,_),ownerState:oe,...ie})})}),db=Xe.createContext();function wB(m){return jd("MuiTableBody",m)}$d("MuiTableBody",["root"]);const SB=m=>{const{classes:g}=m;return mf({root:["root"]},wB,g)},TB=Bc("tbody",{name:"MuiTableBody",slot:"Root",overridesResolver:(m,g)=>g.root})({display:"table-row-group"}),MB={variant:"body"},LT="tbody",CB=Xe.forwardRef(function(g,a){const c=Hd({props:g,name:"MuiTableBody"}),{className:_,component:A=LT,...N}=c,r={...c,component:A},W=SB(r);return hi.jsx(db.Provider,{value:MB,children:hi.jsx(TB,{className:gn(W.root,_),as:A,ref:a,role:A===LT?null:"rowgroup",ownerState:r,...N})})});function EB(m){return jd("MuiTableCell",m)}const AB=$d("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),PB=m=>{const{classes:g,variant:a,align:c,padding:_,size:A,stickyHeader:N}=m,r={root:["root",a,N&&"stickyHeader",c!=="inherit"&&`align${Ma(c)}`,_!=="normal"&&`padding${Ma(_)}`,`size${Ma(A)}`]};return mf(r,EB,g)},DB=Bc("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(m,g)=>{const{ownerState:a}=m;return[g.root,g[a.variant],g[`size${Ma(a.size)}`],a.padding!=="normal"&&g[`padding${Ma(a.padding)}`],a.align!=="inherit"&&g[`align${Ma(a.align)}`],a.stickyHeader&&g.stickyHeader]}})(Nm(({theme:m})=>({...m.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:m.vars?`1px solid ${m.vars.palette.TableCell.border}`:`1px solid
    ${m.palette.mode==="light"?I0(e_(m.palette.divider,1),.88):D0(e_(m.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(m.vars||m).palette.text.primary,lineHeight:m.typography.pxToRem(24),fontWeight:m.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(m.vars||m).palette.text.primary}},{props:{variant:"footer"},style:{color:(m.vars||m).palette.text.secondary,lineHeight:m.typography.pxToRem(21),fontSize:m.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${AB.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:g})=>g.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(m.vars||m).palette.background.default}}]}))),Sy=Xe.forwardRef(function(g,a){const c=Hd({props:g,name:"MuiTableCell"}),{align:_="inherit",className:A,component:N,padding:r,scope:W,size:ie,sortDirection:oe,variant:he,...ve}=c,Se=Xe.useContext(kM),xe=Xe.useContext(db),Ae=xe&&xe.variant==="head";let Re;N?Re=N:Re=Ae?"th":"td";let He=W;Re==="td"?He=void 0:!He&&Ae&&(He="col");const rt=he||xe&&xe.variant,ht={...c,align:_,component:Re,padding:r||(Se&&Se.padding?Se.padding:"normal"),size:ie||(Se&&Se.size?Se.size:"medium"),sortDirection:oe,stickyHeader:rt==="head"&&Se&&Se.stickyHeader,variant:rt},tt=PB(ht);let at=null;return oe&&(at=oe==="asc"?"ascending":"descending"),hi.jsx(DB,{as:Re,ref:a,className:gn(tt.root,A),"aria-sort":at,scope:He,ownerState:ht,...ve})});function IB(m){return jd("MuiTableRow",m)}const RT=$d("MuiTableRow",["root","selected","hover","head","footer"]),kB=m=>{const{classes:g,selected:a,hover:c,head:_,footer:A}=m;return mf({root:["root",a&&"selected",c&&"hover",_&&"head",A&&"footer"]},IB,g)},OB=Bc("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(m,g)=>{const{ownerState:a}=m;return[g.root,a.head&&g.head,a.footer&&g.footer]}})(Nm(({theme:m})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${RT.hover}:hover`]:{backgroundColor:(m.vars||m).palette.action.hover},[`&.${RT.selected}`]:{backgroundColor:m.vars?`rgba(${m.vars.palette.primary.mainChannel} / ${m.vars.palette.action.selectedOpacity})`:e_(m.palette.primary.main,m.palette.action.selectedOpacity),"&:hover":{backgroundColor:m.vars?`rgba(${m.vars.palette.primary.mainChannel} / calc(${m.vars.palette.action.selectedOpacity} + ${m.vars.palette.action.hoverOpacity}))`:e_(m.palette.primary.main,m.palette.action.selectedOpacity+m.palette.action.hoverOpacity)}}}))),zT="tr",FT=Xe.forwardRef(function(g,a){const c=Hd({props:g,name:"MuiTableRow"}),{className:_,component:A=zT,hover:N=!1,selected:r=!1,...W}=c,ie=Xe.useContext(db),oe={...c,component:A,hover:N,selected:r,head:ie&&ie.variant==="head",footer:ie&&ie.variant==="footer"},he=kB(oe);return hi.jsx(OB,{as:A,ref:a,className:gn(he.root,_),role:A===zT?null:"row",ownerState:oe,...W})});function LB({tabs:m,activeTab:g,onTabChange:a}){return hi.jsx("div",{className:"tab_Sec_box",children:hi.jsx("div",{className:"tab_Sec flex gap-[0_30px]",children:m.map((c,_)=>hi.jsx(tB,{children:hi.jsx("div",{className:`tab_menu ${g===(c==null?void 0:c.id)||c!=null&&c.value?"active":""}`,onClick:()=>a(_,c),children:(c==null?void 0:c.name)!==void 0?c==null?void 0:c.name:c==null?void 0:c.label})},_))})})}const Ng=({label:m,count:g})=>hi.jsxs("div",{className:"p-4 rounded shadow border border-borderColor bg-white",children:[hi.jsx("h3",{className:"text-sm text-gray-500 mb-1",children:m}),hi.jsx("h5",{className:"text-lg font-semibold",children:g})]});var By={exports:{}},RB=By.exports,BT;function zB(){return BT||(BT=1,function(m,g){(function(a,c){m.exports=c(nA())})(typeof self<"u"?self:RB,function(a){return function(c){function _(N){if(A[N])return A[N].exports;var r=A[N]={i:N,l:!1,exports:{}};return c[N].call(r.exports,r,r.exports,_),r.l=!0,r.exports}var A={};return _.m=c,_.c=A,_.d=function(N,r,W){_.o(N,r)||Object.defineProperty(N,r,{configurable:!1,enumerable:!0,get:W})},_.n=function(N){var r=N&&N.__esModule?function(){return N.default}:function(){return N};return _.d(r,"a",r),r},_.o=function(N,r){return Object.prototype.hasOwnProperty.call(N,r)},_.p="",_(_.s=0)}([function(c,_,A){function N(){return N=Object.assign?Object.assign.bind():function(rt){for(var ht=1;ht<arguments.length;ht++){var tt=arguments[ht];for(var at in tt)Object.prototype.hasOwnProperty.call(tt,at)&&(rt[at]=tt[at])}return rt},N.apply(this,arguments)}function r(rt){return he(rt)||oe(rt)||ie(rt)||W()}function W(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ie(rt,ht){if(rt){if(typeof rt=="string")return ve(rt,ht);var tt=Object.prototype.toString.call(rt).slice(8,-1);return tt==="Object"&&rt.constructor&&(tt=rt.constructor.name),tt==="Map"||tt==="Set"?Array.from(rt):tt==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(tt)?ve(rt,ht):void 0}}function oe(rt){if(typeof Symbol<"u"&&rt[Symbol.iterator]!=null||rt["@@iterator"]!=null)return Array.from(rt)}function he(rt){if(Array.isArray(rt))return ve(rt)}function ve(rt,ht){(ht==null||ht>rt.length)&&(ht=rt.length);for(var tt=0,at=new Array(ht);tt<ht;tt++)at[tt]=rt[tt];return at}function Se(rt){"@babel/helpers - typeof";return(Se=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ht){return typeof ht}:function(ht){return ht&&typeof Symbol=="function"&&ht.constructor===Symbol&&ht!==Symbol.prototype?"symbol":typeof ht})(rt)}Object.defineProperty(_,"__esModule",{value:!0}),A.d(_,"HighchartsReact",function(){return He});var xe=A(1),Ae=A.n(xe),Re=typeof window<"u"?xe.useLayoutEffect:xe.useEffect,He=Object(xe.memo)(Object(xe.forwardRef)(function(rt,ht){var tt=Object(xe.useRef)(),at=Object(xe.useRef)(),Lt=Object(xe.useRef)(rt.constructorType),Ve=Object(xe.useRef)(rt.highcharts);return Re(function(){function Tt(){var Me=rt.highcharts||(typeof window>"u"?"undefined":Se(window))==="object"&&window.Highcharts,gt=rt.constructorType||"chart";Me?Me[gt]?rt.options?at.current=Me[gt](tt.current,rt.options,rt.callback):console.warn('The "options" property was not passed.'):console.warn('The "constructorType" property is incorrect or some required module is not imported.'):console.warn('The "highcharts" property was not passed.')}if(at.current){if(rt.allowChartUpdate!==!1)if(rt.constructorType!==Lt.current||rt.highcharts!==Ve.current)Lt.current=rt.constructorType,Ve.current=rt.highcharts,Tt();else if(!rt.immutable&&at.current){var qt;(qt=at.current).update.apply(qt,[rt.options].concat(r(rt.updateArgs||[!0,!0])))}else Tt()}else Tt()},[rt.options,rt.allowChartUpdate,rt.updateArgs,rt.containerProps,rt.highcharts,rt.constructorType]),Re(function(){return function(){at.current&&(at.current.destroy(),at.current=null)}},[]),Object(xe.useImperativeHandle)(ht,function(){return{get chart(){return at.current},container:tt}},[]),Ae.a.createElement("div",N({},rt.containerProps,{ref:tt}))}));_.default=He},function(c,_){c.exports=a}])})}(By)),By.exports}var FB=zB();const BB=t_(FB);var Ny={exports:{}},NB=Ny.exports,NT;function VB(){return NT||(NT=1,function(m,g){(function(a,c){a._Highcharts=c(),m.exports=a._Highcharts})(typeof window>"u"?NB:window,()=>(()=>{let a,c;var _,A,N,r,W,ie,oe,he,ve,Se,xe,Ae,Re,He,rt,ht,tt,at={};at.d=(Y,h)=>{for(var v in h)at.o(h,v)&&!at.o(Y,v)&&Object.defineProperty(Y,v,{enumerable:!0,get:h[v]})},at.o=(Y,h)=>Object.prototype.hasOwnProperty.call(Y,h);var Lt={};at.d(Lt,{default:()=>$0}),function(Y){var h,v,S;Y.SVG_NS="http://www.w3.org/2000/svg",Y.product="Highcharts",Y.version="12.1.2",Y.win=typeof window<"u"?window:{},Y.doc=Y.win.document,Y.svg=Y.doc&&Y.doc.createElementNS&&!!Y.doc.createElementNS(Y.SVG_NS,"svg").createSVGRect,Y.pageLang=(S=(v=(h=Y.doc)==null?void 0:h.documentElement)==null?void 0:v.closest("[lang]"))==null?void 0:S.lang,Y.userAgent=Y.win.navigator&&Y.win.navigator.userAgent||"",Y.isChrome=Y.win.chrome,Y.isFirefox=Y.userAgent.indexOf("Firefox")!==-1,Y.isMS=/(edge|msie|trident)/i.test(Y.userAgent)&&!Y.win.opera,Y.isSafari=!Y.isChrome&&Y.userAgent.indexOf("Safari")!==-1,Y.isTouchDevice=/(Mobile|Android|Windows Phone)/.test(Y.userAgent),Y.isWebKit=Y.userAgent.indexOf("AppleWebKit")!==-1,Y.deg2rad=2*Math.PI/360,Y.marginNames=["plotTop","marginRight","marginBottom","plotLeft"],Y.noop=function(){},Y.supportsPassiveEvents=function(){let D=!1;if(!Y.isMS){let L=Object.defineProperty({},"passive",{get:function(){D=!0}});Y.win.addEventListener&&Y.win.removeEventListener&&(Y.win.addEventListener("testPassive",Y.noop,L),Y.win.removeEventListener("testPassive",Y.noop,L))}return D}(),Y.charts=[],Y.composed=[],Y.dateFormats={},Y.seriesTypes={},Y.symbolSizes={},Y.chartCount=0}(_||(_={}));let Ve=_,{charts:Tt,doc:qt,win:Me}=Ve;function gt(Y,h,v,S){let D=h?"Highcharts error":"Highcharts warning";Y===32&&(Y=`${D}: Deprecated member`);let L=Yt(Y),z=L?`${D} #${Y}: www.highcharts.com/errors/${Y}/`:Y.toString();if(S!==void 0){let B="";L&&(z+="?"),qr(S,function(U,X){B+=`
 - ${X}: ${U}`,L&&(z+=encodeURI(X)+"="+encodeURI(U))}),z+=B}Ye(Ve,"displayError",{chart:v,code:Y,message:z,params:S},function(){if(h)throw Error(z);Me.console&&gt.messages.indexOf(z)===-1&&console.warn(z)}),gt.messages.push(z)}function oi(Y,h){return parseInt(Y,h||10)}function Ti(Y){return typeof Y=="string"}function ni(Y){let h=Object.prototype.toString.call(Y);return h==="[object Array]"||h==="[object Array Iterator]"}function Mt(Y,h){return!!Y&&typeof Y=="object"&&(!h||!ni(Y))}function zt(Y){return Mt(Y)&&typeof Y.nodeType=="number"}function ii(Y){let h=Y&&Y.constructor;return!!(Mt(Y,!0)&&!zt(Y)&&h&&h.name&&h.name!=="Object")}function Yt(Y){return typeof Y=="number"&&!isNaN(Y)&&Y<1/0&&Y>-1/0}function jt(Y){return Y!=null}function Ri(Y,h,v){let S,D=Ti(h)&&!jt(v),L=(z,B)=>{jt(z)?Y.setAttribute(B,z):D?(S=Y.getAttribute(B))||B!=="class"||(S=Y.getAttribute(B+"Name")):Y.removeAttribute(B)};return Ti(h)?L(v,h):qr(h,L),S}function Yi(Y){return ni(Y)?Y:[Y]}function Wi(Y,h){let v;for(v in Y||(Y={}),h)Y[v]=h[v];return Y}function vi(){let Y=arguments,h=Y.length;for(let v=0;v<h;v++){let S=Y[v];if(S!=null)return S}}function Wr(Y,h){Wi(Y.style,h)}function an(Y){return Math.pow(10,Math.floor(Math.log(Y)/Math.LN10))}function _n(Y,h){return Y>1e14?Y:parseFloat(Y.toPrecision(h||14))}(gt||(gt={})).messages=[],Math.easeInOutSine=function(Y){return-.5*(Math.cos(Math.PI*Y)-1)};let En=Array.prototype.find?function(Y,h){return Y.find(h)}:function(Y,h){let v,S=Y.length;for(v=0;v<S;v++)if(h(Y[v],v))return Y[v]};function qr(Y,h,v){for(let S in Y)Object.hasOwnProperty.call(Y,S)&&h.call(v||Y[S],Y[S],S,Y)}function es(Y,h,v){function S(z,B){let U=Y.removeEventListener;U&&U.call(Y,z,B,!1)}function D(z){let B,U;Y.nodeName&&(h?(B={})[h]=!0:B=z,qr(B,function(X,te){if(z[te])for(U=z[te].length;U--;)S(te,z[te][U].fn)}))}let L=typeof Y=="function"&&Y.prototype||Y;if(Object.hasOwnProperty.call(L,"hcEvents")){let z=L.hcEvents;if(h){let B=z[h]||[];v?(z[h]=B.filter(function(U){return v!==U.fn}),S(h,v)):(D(z),z[h]=[])}else D(z),delete L.hcEvents}}function Ye(Y,h,v,S){if(v=v||{},qt.createEvent&&(Y.dispatchEvent||Y.fireEvent&&Y!==Ve)){let D=qt.createEvent("Events");D.initEvent(h,!0,!0),v=Wi(D,v),Y.dispatchEvent?Y.dispatchEvent(v):Y.fireEvent(h,v)}else if(Y.hcEvents){v.target||Wi(v,{preventDefault:function(){v.defaultPrevented=!0},target:Y,type:h});let D=[],L=Y,z=!1;for(;L.hcEvents;)Object.hasOwnProperty.call(L,"hcEvents")&&L.hcEvents[h]&&(D.length&&(z=!0),D.unshift.apply(D,L.hcEvents[h])),L=Object.getPrototypeOf(L);z&&D.sort((B,U)=>B.order-U.order),D.forEach(B=>{B.fn.call(Y,v)===!1&&v.preventDefault()})}S&&!v.defaultPrevented&&S.call(Y,v)}let ds=function(){let Y=Math.random().toString(36).substring(2,9)+"-",h=0;return function(){return"highcharts-"+(a?"":Y)+h++}}();Me.jQuery&&(Me.jQuery.fn.highcharts=function(){let Y=[].slice.call(arguments);if(this[0])return Y[0]?(new Ve[Ti(Y[0])?Y.shift():"Chart"](this[0],Y[0],Y[1]),this):Tt[Ri(this[0],"data-highcharts-chart")]});let Bi={addEvent:function(Y,h,v,S={}){let D=typeof Y=="function"&&Y.prototype||Y;Object.hasOwnProperty.call(D,"hcEvents")||(D.hcEvents={});let L=D.hcEvents;Ve.Point&&Y instanceof Ve.Point&&Y.series&&Y.series.chart&&(Y.series.chart.runTrackerClick=!0);let z=Y.addEventListener;z&&z.call(Y,h,v,!!Ve.supportsPassiveEvents&&{passive:S.passive===void 0?h.indexOf("touch")!==-1:S.passive,capture:!1}),L[h]||(L[h]=[]);let B={fn:v,order:typeof S.order=="number"?S.order:1/0};return L[h].push(B),L[h].sort((U,X)=>U.order-X.order),function(){es(Y,h,v)}},arrayMax:function(Y){let h=Y.length,v=Y[0];for(;h--;)Y[h]>v&&(v=Y[h]);return v},arrayMin:function(Y){let h=Y.length,v=Y[0];for(;h--;)Y[h]<v&&(v=Y[h]);return v},attr:Ri,clamp:function(Y,h,v){return Y>h?Y<v?Y:v:h},clearTimeout:function(Y){jt(Y)&&clearTimeout(Y)},correctFloat:_n,createElement:function(Y,h,v,S,D){let L=qt.createElement(Y);return h&&Wi(L,h),D&&Wr(L,{padding:"0",border:"none",margin:"0"}),v&&Wr(L,v),S&&S.appendChild(L),L},crisp:function(Y,h=0,v){let S=h%2/2,D=v?-1:1;return(Math.round(Y*D-S)+S)*D},css:Wr,defined:jt,destroyObjectProperties:function(Y,h,v){qr(Y,function(S,D){S!==h&&(S!=null&&S.destroy)&&S.destroy(),(S!=null&&S.destroy||!v)&&delete Y[D]})},diffObjects:function(Y,h,v,S){let D={};return function L(z,B,U,X){let te=v?B:z;qr(z,function(K,re){if(!X&&S&&S.indexOf(re)>-1&&B[re]){K=Yi(K),U[re]=[];for(let ue=0;ue<Math.max(K.length,B[re].length);ue++)B[re][ue]&&(K[ue]===void 0?U[re][ue]=B[re][ue]:(U[re][ue]={},L(K[ue],B[re][ue],U[re][ue],X+1)))}else Mt(K,!0)&&!K.nodeType?(U[re]=ni(K)?[]:{},L(K,B[re]||{},U[re],X+1),Object.keys(U[re]).length!==0||re==="colorAxis"&&X===0||delete U[re]):(z[re]!==B[re]||re in z&&!(re in B))&&re!=="__proto__"&&re!=="constructor"&&(U[re]=te[re])})}(Y,h,D,0),D},discardElement:function(Y){Y&&Y.parentElement&&Y.parentElement.removeChild(Y)},erase:function(Y,h){let v=Y.length;for(;v--;)if(Y[v]===h){Y.splice(v,1);break}},error:gt,extend:Wi,extendClass:function(Y,h){let v=function(){};return v.prototype=new Y,Wi(v.prototype,h),v},find:En,fireEvent:Ye,getAlignFactor:(Y="")=>({center:.5,right:1,middle:.5,bottom:1})[Y]||0,getClosestDistance:function(Y,h){let v,S,D,L=!h;return Y.forEach(z=>{if(z.length>1)for(D=z.length-1;D>0;D--)(S=z[D]-z[D-1])<0&&!L?(h==null||h(),h=void 0):S&&(v===void 0||S<v)&&(v=S)}),v},getMagnitude:an,getNestedProperty:function(Y,h){let v=Y.split(".");for(;v.length&&jt(h);){let S=v.shift();if(S===void 0||S==="__proto__")return;if(S==="this"){let L;return Mt(h)&&(L=h["@this"]),L??h}let D=h[S.replace(/[\\'"]/g,"")];if(!jt(D)||typeof D=="function"||typeof D.nodeType=="number"||D===Me)return;h=D}return h},getStyle:function Y(h,v,S){let D;if(v==="width"){let z=Math.min(h.offsetWidth,h.scrollWidth),B=h.getBoundingClientRect&&h.getBoundingClientRect().width;return B<z&&B>=z-1&&(z=Math.floor(B)),Math.max(0,z-(Y(h,"padding-left",!0)||0)-(Y(h,"padding-right",!0)||0))}if(v==="height")return Math.max(0,Math.min(h.offsetHeight,h.scrollHeight)-(Y(h,"padding-top",!0)||0)-(Y(h,"padding-bottom",!0)||0));let L=Me.getComputedStyle(h,void 0);return L&&(D=L.getPropertyValue(v),vi(S,v!=="opacity")&&(D=oi(D))),D},insertItem:function(Y,h){let v,S=Y.options.index,D=h.length;for(v=Y.options.isInternal?D:0;v<D+1;v++)if(!h[v]||Yt(S)&&S<vi(h[v].options.index,h[v]._i)||h[v].options.isInternal){h.splice(v,0,Y);break}return v},isArray:ni,isClass:ii,isDOMElement:zt,isFunction:function(Y){return typeof Y=="function"},isNumber:Yt,isObject:Mt,isString:Ti,merge:function(Y,...h){let v,S=[Y,...h],D={},L=function(B,U){return typeof B!="object"&&(B={}),qr(U,function(X,te){te!=="__proto__"&&te!=="constructor"&&(!Mt(X,!0)||ii(X)||zt(X)?B[te]=U[te]:B[te]=L(B[te]||{},X))}),B};Y===!0&&(D=S[1],S=Array.prototype.slice.call(S,2));let z=S.length;for(v=0;v<z;v++)D=L(D,S[v]);return D},normalizeTickInterval:function(Y,h,v,S,D){let L,z=Y;v=vi(v,an(Y));let B=Y/v;for(!h&&(h=D?[1,1.2,1.5,2,2.5,3,4,5,6,8,10]:[1,2,2.5,5,10],S===!1&&(v===1?h=h.filter(function(U){return U%1==0}):v<=.1&&(h=[1/v]))),L=0;L<h.length&&(z=h[L],(!D||!(z*v>=Y))&&(D||!(B<=(h[L]+(h[L+1]||h[L]))/2)));L++);return _n(z*v,-Math.round(Math.log(.001)/Math.LN10))},objectEach:qr,offset:function(Y){let h=qt.documentElement,v=Y.parentElement||Y.parentNode?Y.getBoundingClientRect():{top:0,left:0,width:0,height:0};return{top:v.top+(Me.pageYOffset||h.scrollTop)-(h.clientTop||0),left:v.left+(Me.pageXOffset||h.scrollLeft)-(h.clientLeft||0),width:v.width,height:v.height}},pad:function(Y,h,v){return Array((h||2)+1-String(Y).replace("-","").length).join(v||"0")+Y},pick:vi,pInt:oi,pushUnique:function(Y,h){return 0>Y.indexOf(h)&&!!Y.push(h)},relativeLength:function(Y,h,v){return/%$/.test(Y)?h*parseFloat(Y)/100+(v||0):parseFloat(Y)},removeEvent:es,replaceNested:function(Y,...h){let v,S;do for(S of(v=Y,h))Y=Y.replace(S[0],S[1]);while(Y!==v);return Y},splat:Yi,stableSort:function(Y,h){let v,S,D=Y.length;for(S=0;S<D;S++)Y[S].safeI=S;for(Y.sort(function(L,z){return(v=h(L,z))===0?L.safeI-z.safeI:v}),S=0;S<D;S++)delete Y[S].safeI},syncTimeout:function(Y,h,v){return h>0?setTimeout(Y,h,v):(Y.call(0,v),-1)},timeUnits:{millisecond:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:24192e5,year:314496e5},ucfirst:function(Y){return Ti(Y)?Y.substring(0,1).toUpperCase()+Y.substring(1):String(Y)},uniqueKey:ds,useSerialIds:function(Y){return a=vi(Y,a)},wrap:function(Y,h,v){let S=Y[h];Y[h]=function(){let D=arguments,L=this;return v.apply(this,[function(){return S.apply(L,arguments.length?arguments:D)}].concat([].slice.call(arguments)))}}},{pageLang:Xs,win:Wt}=Ve,{defined:jn,error:As,extend:mo,isNumber:rr,isObject:$n,isString:xs,merge:Ca,objectEach:xr,pad:go,splat:nr,timeUnits:Kr,ucfirst:ra}=Bi,dl=Ve.isSafari&&Wt.Intl&&!Wt.Intl.DateTimeFormat.prototype.formatRange,Zs=Y=>Y.main===void 0,Ea=Y=>["D","L","M","X","J","V","S"].indexOf(Y),$a=class{constructor(Y){this.options={timezone:"UTC"},this.variableTimezone=!1,this.Date=Wt.Date,this.update(Y)}update(Y={}){this.dTLCache={},this.options=Y=Ca(!0,this.options,Y);let{timezoneOffset:h,useUTC:v}=Y;this.Date=Y.Date||Wt.Date||Date;let S=Y.timezone;jn(v)&&(S=v?"UTC":void 0),h&&h%60==0&&(S="Etc/GMT"+(h>0?"+":"")+h/60),this.variableTimezone=S!=="UTC"&&(S==null?void 0:S.indexOf("Etc/GMT"))!==0,this.timezone=S,["months","shortMonths","weekdays","shortWeekdays"].forEach(D=>{let L=/months/i.test(D),z=/short/.test(D),B={timeZone:"UTC"};B[L?"month":"weekday"]=z?"short":"long",this[D]=(L?[0,1,2,3,4,5,6,7,8,9,10,11]:[3,4,5,6,7,8,9]).map(U=>this.dateFormat(B,(L?31:1)*24*36e5*U))})}toParts(Y){let[h,v,S,D,L,z,B]=this.dateTimeFormat({weekday:"narrow",day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},Y,"es").split(/(?:, |\/|:)/g);return[D,+S-1,v,L,z,B,Math.floor(Number(Y)||0)%1e3,Ea(h)].map(Number)}dateTimeFormat(Y,h,v=this.options.locale||Xs){let S=JSON.stringify(Y)+v;xs(Y)&&(Y=this.str2dtf(Y));let D=this.dTLCache[S];if(!D){Y.timeZone??(Y.timeZone=this.timezone);try{D=new Intl.DateTimeFormat(v,Y)}catch(L){/Invalid time zone/i.test(L.message)?(As(34),Y.timeZone="UTC",D=new Intl.DateTimeFormat(v,Y)):As(L.message,!1)}}return this.dTLCache[S]=D,(D==null?void 0:D.format(h))||""}str2dtf(Y,h={}){let v={L:{fractionalSecondDigits:3},S:{second:"2-digit"},M:{minute:"numeric"},H:{hour:"2-digit"},k:{hour:"numeric"},E:{weekday:"narrow"},a:{weekday:"short"},A:{weekday:"long"},d:{day:"2-digit"},e:{day:"numeric"},b:{month:"short"},B:{month:"long"},m:{month:"2-digit"},o:{month:"numeric"},y:{year:"2-digit"},Y:{year:"numeric"}};return Object.keys(v).forEach(S=>{Y.indexOf(S)!==-1&&mo(h,v[S])}),h}makeTime(Y,h,v=1,S=0,D,L,z){let B=this.Date.UTC(Y,h,v,S,D||0,L||0,z||0);if(this.timezone!=="UTC"){let U=this.getTimezoneOffset(B);if(B+=U,[2,3,8,9,10,11].indexOf(h)!==-1&&(S<5||S>20)){let X=this.getTimezoneOffset(B);U!==X?B+=X-U:U-36e5!==this.getTimezoneOffset(B-36e5)||dl||(B-=36e5)}}return B}parse(Y){if(!xs(Y))return Y??void 0;let h=(Y=Y.replace(/\//g,"-").replace(/(GMT|UTC)/,"")).indexOf("Z")>-1||/([+-][0-9]{2}):?[0-9]{2}$/.test(Y),v=/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/.test(Y);h||v||(Y+="Z");let S=Date.parse(Y);if(rr(S))return S+(!h||v?this.getTimezoneOffset(S):0)}getTimezoneOffset(Y){if(this.timezone!=="UTC"){let[h,v,S,D,L=0]=this.dateTimeFormat({timeZoneName:"shortOffset"},Y,"en").split(/(GMT|:)/).map(Number),z=-(36e5*(S+L/60));if(rr(z))return z}return 0}dateFormat(Y,h,v){var D;let S=(D=Ve.defaultOptions)==null?void 0:D.lang;if(!jn(h)||isNaN(h))return(S==null?void 0:S.invalidDate)||"";if(xs(Y=Y??"%Y-%m-%d %H:%M:%S")){let L,z=/%\[([a-zA-Z]+)\]/g;for(;L=z.exec(Y);)Y=Y.replace(L[0],this.dateTimeFormat(L[1],h))}if(xs(Y)&&Y.indexOf("%")!==-1){let L=this,[z,B,U,X,te,K,re,ue]=this.toParts(h),ge=(S==null?void 0:S.weekdays)||this.weekdays,ye=(S==null?void 0:S.shortWeekdays)||this.shortWeekdays,be=(S==null?void 0:S.months)||this.months,_e=(S==null?void 0:S.shortMonths)||this.shortMonths;xr(mo({a:ye?ye[ue]:ge[ue].substr(0,3),A:ge[ue],d:go(U),e:go(U,2," "),w:ue,b:_e[B],B:be[B],m:go(B+1),o:B+1,y:z.toString().substr(2,2),Y:z,H:go(X),k:X,I:go(X%12||12),l:X%12||12,M:go(te),p:X<12?"AM":"PM",P:X<12?"am":"pm",S:go(K),L:go(re,3)},Ve.dateFormats),function(Fe,ze){if(xs(Y))for(;Y.indexOf("%"+ze)!==-1;)Y=Y.replace("%"+ze,typeof Fe=="function"?Fe.call(L,h):Fe)})}else if($n(Y)){let L=(this.getTimezoneOffset(h)||0)/36e5,z=this.timezone||"Etc/GMT"+(L>=0?"+":"")+L,{prefix:B="",suffix:U=""}=Y;Y=B+this.dateTimeFormat(mo({timeZone:z},Y),h)+U}return v?ra(Y):Y}resolveDTLFormat(Y){return $n(Y,!0)?$n(Y,!0)&&Zs(Y)?{main:Y}:Y:{main:(Y=nr(Y))[0],from:Y[1],to:Y[2]}}getTimeTicks(Y,h,v,S){let D=this,L=[],z={},{count:B=1,unitRange:U}=Y,[X,te,K,re,ue,ge]=D.toParts(h),ye=(h||0)%1e3,be;if(S??(S=1),jn(h)){if(ye=U>=Kr.second?0:B*Math.floor(ye/B),U>=Kr.second&&(ge=U>=Kr.minute?0:B*Math.floor(ge/B)),U>=Kr.minute&&(ue=U>=Kr.hour?0:B*Math.floor(ue/B)),U>=Kr.hour&&(re=U>=Kr.day?0:B*Math.floor(re/B)),U>=Kr.day&&(K=U>=Kr.month?1:Math.max(1,B*Math.floor(K/B))),U>=Kr.month&&(te=U>=Kr.year?0:B*Math.floor(te/B)),U>=Kr.year&&(X-=X%B),U===Kr.week){B&&(h=D.makeTime(X,te,K,re,ue,ge,ye));let ze=Ea(this.dateTimeFormat({timeZone:this.timezone,weekday:"narrow"},h,"es"));K+=-ze+S+(ze<S?-7:0)}h=D.makeTime(X,te,K,re,ue,ge,ye),D.variableTimezone&&jn(v)&&(be=v-h>4*Kr.month||D.getTimezoneOffset(h)!==D.getTimezoneOffset(v));let _e=h,Fe=1;for(;_e<v;)L.push(_e),U===Kr.year?_e=D.makeTime(X+Fe*B,0):U===Kr.month?_e=D.makeTime(X,te+Fe*B):be&&(U===Kr.day||U===Kr.week)?_e=D.makeTime(X,te,K+Fe*B*(U===Kr.day?1:7)):be&&U===Kr.hour&&B>1?_e=D.makeTime(X,te,K,re+Fe*B):_e+=U*B,Fe++;L.push(_e),U<=Kr.hour&&L.length<1e4&&L.forEach(ze=>{ze%18e5==0&&D.dateFormat("%H%M%S%L",ze)==="000000000"&&(z[ze]="day")})}return L.info=mo(Y,{higherRanks:z,totalRange:U*B}),L}getDateFormat(Y,h,v,S){let D=this.dateFormat("%m-%d %H:%M:%S.%L",h),L="01-01 00:00:00.000",z={millisecond:15,second:12,minute:9,hour:6,day:3},B="millisecond",U=B;for(B in Kr){if(Y===Kr.week&&+this.dateFormat("%w",h)===v&&D.substr(6)===L.substr(6)){B="week";break}if(Kr[B]>Y){B=U;break}if(z[B]&&D.substr(z[B])!==L.substr(z[B]))break;B!=="week"&&(U=B)}return this.resolveDTLFormat(S[B]).main}},{isTouchDevice:Nc}=Ve,{fireEvent:Vc,merge:ro}=Bi,na={colors:["#2caffe","#544fc5","#00e272","#fe6a35","#6b8abc","#d568fb","#2ee0ca","#fa4b42","#feb56a","#91e8e1"],symbols:["circle","diamond","square","triangle","triangle-down"],lang:{locale:void 0,loading:"Loading...",months:void 0,shortMonths:void 0,weekdays:void 0,numericSymbols:["k","M","G","T","P","E"],resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1"},global:{buttonTheme:{fill:"#f7f7f7",padding:8,r:2,stroke:"#cccccc","stroke-width":1,style:{color:"#333333",cursor:"pointer",fontSize:"0.8em",fontWeight:"normal"},states:{hover:{fill:"#e6e6e6"},select:{fill:"#e6e9ff",style:{color:"#000000",fontWeight:"bold"}},disabled:{style:{color:"#cccccc"}}}}},time:{Date:void 0,timezone:"UTC",timezoneOffset:0,useUTC:void 0},chart:{alignThresholds:!1,panning:{enabled:!1,type:"x"},styledMode:!1,borderRadius:0,colorCount:10,allowMutatingData:!0,ignoreHiddenSeries:!0,spacing:[10,10,15,10],resetZoomButton:{theme:{},position:{}},reflow:!0,type:"line",zooming:{singleTouch:!1,resetButton:{theme:{zIndex:6},position:{align:"right",x:-10,y:10}}},width:null,height:null,borderColor:"#334eff",backgroundColor:"#ffffff",plotBorderColor:"#cccccc"},title:{style:{color:"#333333",fontWeight:"bold"},text:"Chart title",margin:15,minScale:.67},subtitle:{style:{color:"#666666",fontSize:"0.8em"},text:""},caption:{margin:15,style:{color:"#666666",fontSize:"0.8em"},text:"",align:"left",verticalAlign:"bottom"},plotOptions:{},legend:{enabled:!0,align:"center",alignColumns:!0,className:"highcharts-no-tooltip",events:{},layout:"horizontal",itemMarginBottom:2,itemMarginTop:2,labelFormatter:function(){return this.name},borderColor:"#999999",borderRadius:0,navigation:{style:{fontSize:"0.8em"},activeColor:"#0022ff",inactiveColor:"#cccccc"},itemStyle:{color:"#333333",cursor:"pointer",fontSize:"0.8em",textDecoration:"none",textOverflow:"ellipsis"},itemHoverStyle:{color:"#000000"},itemHiddenStyle:{color:"#666666",textDecoration:"line-through"},shadow:!1,itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},squareSymbol:!0,symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{fontSize:"0.8em",fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"45%"},style:{position:"absolute",backgroundColor:"#ffffff",opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:{duration:300,easing:Y=>Math.sqrt(1-Math.pow(Y-1,2))},borderRadius:3,dateTimeLabelFormats:{millisecond:"%[AebHMSL]",second:"%[AebHMS]",minute:"%[AebHM]",hour:"%[AebHM]",day:"%[AebY]",week:"Week from %[AebY]",month:"%[BY]",year:"%Y"},footerFormat:"",headerShape:"callout",hideDelay:500,padding:8,shape:"callout",shared:!1,snap:Nc?25:10,headerFormat:'<span style="font-size: 0.8em">{ucfirst point.key}</span><br/>',pointFormat:'<span style="color:{point.color}">●</span> {series.name}: <b>{point.y}</b><br/>',backgroundColor:"#ffffff",borderWidth:void 0,shadow:!0,stickOnContact:!1,style:{color:"#333333",cursor:"default",fontSize:"0.8em"},useHTML:!1},credits:{enabled:!0,href:"https://www.highcharts.com?credits",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:"#999999",fontSize:"0.6em"},text:"Highcharts.com"}},pl=new $a(na.time),zn={defaultOptions:na,defaultTime:pl,getOptions:function(){return na},setOptions:function(Y){return Vc(Ve,"setOptions",{options:Y}),ro(!0,na,Y),Y.time&&pl.update(na.time),Y.lang&&"locale"in Y.lang&&pl.update({locale:Y.lang.locale}),na}},{isNumber:Aa,merge:qi,pInt:Fn,defined:$u}=Bi;class Jr{static parse(h){return h?new Jr(h):Jr.None}constructor(h){let v,S,D,L;this.rgba=[NaN,NaN,NaN,NaN],this.input=h;let z=Ve.Color;if(z&&z!==Jr)return new z(h);if(typeof h=="object"&&h.stops!==void 0)this.stops=h.stops.map(B=>new Jr(B[1]));else if(typeof h=="string")for(this.input=h=Jr.names[h.toLowerCase()]||h,D=Jr.parsers.length;D--&&!S;)(v=(L=Jr.parsers[D]).regex.exec(h))&&(S=L.parse(v));S&&(this.rgba=S)}get(h){let v=this.input,S=this.rgba;if(typeof v=="object"&&this.stops!==void 0){let D=qi(v);return D.stops=[].slice.call(D.stops),this.stops.forEach((L,z)=>{D.stops[z]=[D.stops[z][0],L.get(h)]}),D}return S&&Aa(S[0])?h!=="rgb"&&(h||S[3]!==1)?h==="a"?`${S[3]}`:"rgba("+S.join(",")+")":"rgb("+S[0]+","+S[1]+","+S[2]+")":v}brighten(h){let v=this.rgba;if(this.stops)this.stops.forEach(function(S){S.brighten(h)});else if(Aa(h)&&h!==0)for(let S=0;S<3;S++)v[S]+=Fn(255*h),v[S]<0&&(v[S]=0),v[S]>255&&(v[S]=255);return this}setOpacity(h){return this.rgba[3]=h,this}tweenTo(h,v){let S=this.rgba,D=h.rgba;if(!Aa(S[0])||!Aa(D[0]))return h.input||"none";let L=D[3]!==1||S[3]!==1,z=(U,X)=>U+(S[X]-U)*(1-v),B=D.slice(0,3).map(z).map(Math.round);return L&&B.push(z(D[3],3)),(L?"rgba(":"rgb(")+B.join(",")+")"}}Jr.names={white:"#ffffff",black:"#000000"},Jr.parsers=[{regex:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d?(?:\.\d+)?)\s*\)/,parse:function(Y){return[Fn(Y[1]),Fn(Y[2]),Fn(Y[3]),parseFloat(Y[4],10)]}},{regex:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/,parse:function(Y){return[Fn(Y[1]),Fn(Y[2]),Fn(Y[3]),1]}},{regex:/^#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])?$/i,parse:function(Y){return[Fn(Y[1]+Y[1],16),Fn(Y[2]+Y[2],16),Fn(Y[3]+Y[3],16),$u(Y[4])?Fn(Y[4]+Y[4],16)/255:1]}},{regex:/^#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})?$/i,parse:function(Y){return[Fn(Y[1],16),Fn(Y[2],16),Fn(Y[3],16),$u(Y[4])?Fn(Y[4],16)/255:1]}}],Jr.None=new Jr("");let{parse:Pa}=Jr,{win:Uc}=Ve,{isNumber:fl,objectEach:jc}=Bi;class Ps{constructor(h,v,S){this.pos=NaN,this.options=v,this.elem=h,this.prop=S}dSetter(){let h=this.paths,v=h&&h[0],S=h&&h[1],D=this.now||0,L=[];if(D!==1&&v&&S)if(v.length===S.length&&D<1)for(let z=0;z<S.length;z++){let B=v[z],U=S[z],X=[];for(let te=0;te<U.length;te++){let K=B[te],re=U[te];fl(K)&&fl(re)&&!(U[0]==="A"&&(te===4||te===5))?X[te]=K+D*(re-K):X[te]=re}L.push(X)}else L=S;else L=this.toD||[];this.elem.attr("d",L,void 0,!0)}update(){let h=this.elem,v=this.prop,S=this.now,D=this.options.step;this[v+"Setter"]?this[v+"Setter"]():h.attr?h.element&&h.attr(v,S,null,!0):h.style[v]=S+this.unit,D&&D.call(h,S,this)}run(h,v,S){let D=this,L=D.options,z=function(X){return!z.stopped&&D.step(X)},B=Uc.requestAnimationFrame||function(X){setTimeout(X,13)},U=function(){for(let X=0;X<Ps.timers.length;X++)Ps.timers[X]()||Ps.timers.splice(X--,1);Ps.timers.length&&B(U)};h!==v||this.elem["forceAnimate:"+this.prop]?(this.startTime=+new Date,this.start=h,this.end=v,this.unit=S,this.now=this.start,this.pos=0,z.elem=this.elem,z.prop=this.prop,z()&&Ps.timers.push(z)===1&&B(U)):(delete L.curAnim[this.prop],L.complete&&Object.keys(L.curAnim).length===0&&L.complete.call(this.elem))}step(h){let v,S,D=+new Date,L=this.options,z=this.elem,B=L.complete,U=L.duration,X=L.curAnim;return z.attr&&!z.element?v=!1:h||D>=U+this.startTime?(this.now=this.end,this.pos=1,this.update(),X[this.prop]=!0,S=!0,jc(X,function(te){te!==!0&&(S=!1)}),S&&B&&B.call(z),v=!1):(this.pos=L.easing((D-this.startTime)/U),this.now=this.start+(this.end-this.start)*this.pos,this.update(),v=!0),v}initPath(h,v,S){let D=h.startX,L=h.endX,z=S.slice(),B=h.isArea,U=B?2:1,X=v&&S.length>v.length&&S.hasStackedCliffs,te,K,re,ue,ge=v&&v.slice();if(!ge||X)return[z,z];function ye(_e,Fe){for(;_e.length<K;){let ze=_e[0],ft=Fe[K-_e.length];if(ft&&ze[0]==="M"&&(ft[0]==="C"?_e[0]=["C",ze[1],ze[2],ze[1],ze[2],ze[1],ze[2]]:_e[0]=["L",ze[1],ze[2]]),_e.unshift(ze),B){let St=_e.pop();_e.push(_e[_e.length-1],St)}}}function be(_e){for(;_e.length<K;){let Fe=_e[Math.floor(_e.length/U)-1].slice();if(Fe[0]==="C"&&(Fe[1]=Fe[5],Fe[2]=Fe[6]),B){let ze=_e[Math.floor(_e.length/U)].slice();_e.splice(_e.length/2,0,Fe,ze)}else _e.push(Fe)}}if(D&&L&&L.length){for(re=0;re<D.length;re++){if(D[re]===L[0]){te=re;break}if(D[0]===L[L.length-D.length+re]){te=re,ue=!0;break}if(D[D.length-1]===L[L.length-D.length+re]){te=D.length-re;break}}te===void 0&&(ge=[])}return ge.length&&fl(te)&&(K=z.length+te*U,ue?(ye(ge,z),be(z)):(ye(z,ge),be(ge))),[ge,z]}fillSetter(){Ps.prototype.strokeSetter.apply(this,arguments)}strokeSetter(){this.elem.attr(this.prop,Pa(this.start).tweenTo(Pa(this.end),this.pos),void 0,!0)}}Ps.timers=[];let{defined:$c,getStyle:zh,isArray:Fh,isNumber:ts,isObject:Jl,merge:Hu,objectEach:Gu,pick:Ds}=Bi;function Go(Y){return Jl(Y)?Hu({duration:500,defer:0},Y):{duration:Y?500:0,defer:0}}function vt(Y,h){let v=Ps.timers.length;for(;v--;)Ps.timers[v].elem!==Y||h&&h!==Ps.timers[v].prop||(Ps.timers[v].stopped=!0)}let se={animate:function(Y,h,v){let S,D="",L,z,B;Jl(v)||(B=arguments,v={duration:B[2],easing:B[3],complete:B[4]}),ts(v.duration)||(v.duration=400),v.easing=typeof v.easing=="function"?v.easing:Math[v.easing]||Math.easeInOutSine,v.curAnim=Hu(h),Gu(h,function(U,X){vt(Y,X),z=new Ps(Y,v,X),L=void 0,X==="d"&&Fh(h.d)?(z.paths=z.initPath(Y,Y.pathArray,h.d),z.toD=h.d,S=0,L=1):Y.attr?S=Y.attr(X):(S=parseFloat(zh(Y,X))||0,X!=="opacity"&&(D="px")),L||(L=U),typeof L=="string"&&L.match("px")&&(L=L.replace(/px/g,"")),z.run(S,L,D)})},animObject:Go,getDeferredAnimation:function(Y,h,v){let S=Go(h),D=v?[v]:Y.series,L=0,z=0;return D.forEach(B=>{let U=Go(B.options.animation);L=Jl(h)&&$c(h.defer)?S.defer:Math.max(L,U.duration+U.defer),z=Math.min(S.duration,U.duration)}),Y.renderer.forExport&&(L=0),{defer:Math.max(0,L-z),duration:Math.min(L,z)}},setAnimation:function(Y,h){h.renderer.globalAnimation=Ds(Y,h.options.chart.animation,!0)},stop:vt},{SVG_NS:me,win:we}=Ve,{attr:Be,createElement:je,css:Ke,error:lt,isFunction:Je,isString:mt,objectEach:pt,splat:yt}=Bi,{trustedTypes:Rt}=we,Zt=Rt&&Je(Rt.createPolicy)&&Rt.createPolicy("highcharts",{createHTML:Y=>Y}),Jt=Zt?Zt.createHTML(""):"";class fi{static filterUserAttributes(h){return pt(h,(v,S)=>{let D=!0;fi.allowedAttributes.indexOf(S)===-1&&(D=!1),["background","dynsrc","href","lowsrc","src"].indexOf(S)!==-1&&(D=mt(v)&&fi.allowedReferences.some(L=>v.indexOf(L)===0)),D||(lt(33,!1,void 0,{"Invalid attribute in config":`${S}`}),delete h[S]),mt(v)&&h[S]&&(h[S]=v.replace(/</g,"&lt;"))}),h}static parseStyle(h){return h.split(";").reduce((v,S)=>{let D=S.split(":").map(z=>z.trim()),L=D.shift();return L&&D.length&&(v[L.replace(/-([a-z])/g,z=>z[1].toUpperCase())]=D.join(":")),v},{})}static setElementHTML(h,v){h.innerHTML=fi.emptyHTML,v&&new fi(v).addToDOM(h)}constructor(h){this.nodes=typeof h=="string"?this.parseMarkup(h):h}addToDOM(h){return function v(S,D){let L;return yt(S).forEach(function(z){let B,U=z.tagName,X=z.textContent?Ve.doc.createTextNode(z.textContent):void 0,te=fi.bypassHTMLFiltering;if(U)if(U==="#text")B=X;else if(fi.allowedTags.indexOf(U)!==-1||te){let K=U==="svg"?me:D.namespaceURI||me,re=Ve.doc.createElementNS(K,U),ue=z.attributes||{};pt(z,function(ge,ye){ye!=="tagName"&&ye!=="attributes"&&ye!=="children"&&ye!=="style"&&ye!=="textContent"&&(ue[ye]=ge)}),Be(re,te?ue:fi.filterUserAttributes(ue)),z.style&&Ke(re,z.style),X&&re.appendChild(X),v(z.children||[],re),B=re}else lt(33,!1,void 0,{"Invalid tagName in config":U});B&&D.appendChild(B),L=B}),L}(this.nodes,h)}parseMarkup(h){let v,S=[];h=h.trim().replace(/ style=(["'])/g," data-style=$1");try{v=new DOMParser().parseFromString(Zt?Zt.createHTML(h):h,"text/html")}catch{}if(!v){let L=je("div");L.innerHTML=h,v={body:L}}let D=(L,z)=>{let B=L.nodeName.toLowerCase(),U={tagName:B};B==="#text"&&(U.textContent=L.textContent||"");let X=L.attributes;if(X){let te={};[].forEach.call(X,K=>{K.name==="data-style"?U.style=fi.parseStyle(K.value):te[K.name]=K.value}),U.attributes=te}if(L.childNodes.length){let te=[];[].forEach.call(L.childNodes,K=>{D(K,te)}),te.length&&(U.children=te)}z.push(U)};return[].forEach.call(v.body.childNodes,L=>D(L,S)),S}}fi.allowedAttributes=["alt","aria-controls","aria-describedby","aria-expanded","aria-haspopup","aria-hidden","aria-label","aria-labelledby","aria-live","aria-pressed","aria-readonly","aria-roledescription","aria-selected","class","clip-path","color","colspan","cx","cy","d","dx","dy","disabled","fill","filterUnits","flood-color","flood-opacity","height","href","id","in","in2","markerHeight","markerWidth","offset","opacity","operator","orient","padding","paddingLeft","paddingRight","patternUnits","r","radius","refX","refY","role","scope","slope","src","startOffset","stdDeviation","stroke","stroke-linecap","stroke-width","style","tableValues","result","rowspan","summary","target","tabindex","text-align","text-anchor","textAnchor","textLength","title","type","valign","width","x","x1","x2","xlink:href","y","y1","y2","zIndex"],fi.allowedReferences=["https://","http://","mailto:","/","../","./","#"],fi.allowedTags=["a","abbr","b","br","button","caption","circle","clipPath","code","dd","defs","div","dl","dt","em","feComponentTransfer","feComposite","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMorphology","feOffset","feMerge","feMergeNode","filter","h1","h2","h3","h4","h5","h6","hr","i","img","li","linearGradient","marker","ol","p","path","pattern","pre","rect","small","span","stop","strong","style","sub","sup","svg","table","text","textPath","thead","title","tbody","tspan","td","th","tr","u","ul","#text"],fi.emptyHTML=Jt,fi.bypassHTMLFiltering=!1;let{defaultOptions:Ii,defaultTime:ki}=zn,{pageLang:Pi}=Ve,{extend:dr,getNestedProperty:br,isArray:sr,isNumber:wr,isObject:Pr,isString:Bn,pick:Da,ucfirst:is}=Bi,Nn={add:(Y,h)=>Y+h,divide:(Y,h)=>h!==0?Y/h:"",eq:(Y,h)=>Y==h,each:function(Y){let h=arguments[arguments.length-1];return!!sr(Y)&&Y.map((v,S)=>Wo(h.body,dr(Pr(v)?v:{"@this":v},{"@index":S,"@first":S===0,"@last":S===Y.length-1}))).join("")},ge:(Y,h)=>Y>=h,gt:(Y,h)=>Y>h,if:Y=>!!Y,le:(Y,h)=>Y<=h,lt:(Y,h)=>Y<h,multiply:(Y,h)=>Y*h,ne:(Y,h)=>Y!=h,subtract:(Y,h)=>Y-h,ucfirst:is,unless:Y=>!Y},$s={},Hc=Y=>/^["'].+["']$/.test(Y);function Wo(Y="",h,v){let S=/\{([\p{L}\d:\.,;\-\/<>\[\]%_@+"'’= #\(\)]+)\}/gu,D=/\(([\p{L}\d:\.,;\-\/<>\[\]%_@+"'= ]+)\)/gu,L=[],z=/f$/,B=/\.(\d)/,U=(v==null?void 0:v.options.lang)||Ii.lang,X=v&&v.time||ki,te=v&&v.numberFormatter||Gc,K=(be="")=>{let _e;return be==="true"||be!=="false"&&((_e=Number(be)).toString()===be?_e:Hc(be)?be.slice(1,-1):br(be,h))},re,ue,ge=0,ye;for(;(re=S.exec(Y))!==null;){let be=re,_e=D.exec(re[1]);_e&&(re=_e,ye=!0),ue&&ue.isBlock||(ue={ctx:h,expression:re[1],find:re[0],isBlock:re[1].charAt(0)==="#",start:re.index,startInner:re.index+re[0].length,length:re[0].length});let Fe=(ue.isBlock?be:re)[1].split(" ")[0].replace("#","");Nn[Fe]&&(ue.isBlock&&Fe===ue.fn&&ge++,ue.fn||(ue.fn=Fe));let ze=re[1]==="else";if(ue.isBlock&&ue.fn&&(re[1]===`/${ue.fn}`||ze))if(ge)!ze&&ge--;else{let ft=ue.startInner,St=Y.substr(ft,re.index-ft);ue.body===void 0?(ue.body=St,ue.startInner=re.index+re[0].length):ue.elseBody=St,ue.find+=St+re[0],ze||(L.push(ue),ue=void 0)}else ue.isBlock||L.push(ue);if(_e&&!(ue!=null&&ue.isBlock))break}return L.forEach(be=>{let _e,Fe,{body:ze,elseBody:ft,expression:St,fn:_t}=be;if(_t){let Ot=[be],Pt=[],Ft=St.length,di=0,gi;for(Fe=0;Fe<=Ft;Fe++){let Ai=St.charAt(Fe);gi||Ai!=='"'&&Ai!=="'"?gi===Ai&&(gi=""):gi=Ai,gi||Ai!==" "&&Fe!==Ft||(Pt.push(St.substr(di,Fe-di)),di=Fe+1)}for(Fe=Nn[_t].length;Fe--;)Ot.unshift(K(Pt[Fe+1]));_e=Nn[_t].apply(h,Ot),be.isBlock&&typeof _e=="boolean"&&(_e=Wo(_e?ze:ft,h,v))}else{let Ot=Hc(St)?[St]:St.split(":");if(_e=K(Ot.shift()||""),Ot.length&&typeof _e=="number"){let Pt=Ot.join(":");if(z.test(Pt)){let Ft=parseInt((Pt.match(B)||["","-1"])[1],10);_e!==null&&(_e=te(_e,Ft,U.decimalPoint,Pt.indexOf(",")>-1?U.thousandsSep:""))}else _e=X.dateFormat(Pt,_e)}D.lastIndex=0,D.test(be.find)&&Bn(_e)&&(_e=`"${_e}"`)}Y=Y.replace(be.find,Da(_e,""))}),ye?Wo(Y,h,v):Y}function Gc(Y,h,v,S){var ye;h=+h;let D,L,[z,B]=(Y=+Y||0).toString().split("e").map(Number),U=((ye=this==null?void 0:this.options)==null?void 0:ye.lang)||Ii.lang,X=(Y.toString().split(".")[1]||"").split("e")[0].length,te=h,K={};v??(v=U.decimalPoint),S??(S=U.thousandsSep),h===-1?h=Math.min(X,20):wr(h)?h&&B<0&&((L=h+B)>=0?(z=+z.toExponential(L).split("e")[0],h=L):(z=Math.floor(z),Y=h<20?+(z*Math.pow(10,B)).toFixed(h):0,B=0)):h=2,B&&(h??(h=2),Y=z),wr(h)&&h>=0&&(K.minimumFractionDigits=h,K.maximumFractionDigits=h),S===""&&(K.useGrouping=!1);let re=S||v,ue=re?"en":(this==null?void 0:this.locale)||U.locale||Pi,ge=JSON.stringify(K)+ue;return D=($s[ge]??($s[ge]=new Intl.NumberFormat(ue,K))).format(Y),re&&(D=D.replace(/([,\.])/g,"_$1").replace(/_\,/g,S??",").replace("_.",v??".")),(h||+D!=0)&&(!(B<0)||te)||(D="0"),B&&+D!=0&&(D+="e"+(B<0?"":"+")+B),D}let Po={dateFormat:function(Y,h,v){return ki.dateFormat(Y,h,v)},format:Wo,helpers:Nn,numberFormat:Gc};(function(Y){let h;Y.rendererTypes={},Y.getRendererType=function(v=h){return Y.rendererTypes[v]||Y.rendererTypes[h]},Y.registerRendererType=function(v,S,D){Y.rendererTypes[v]=S,(!h||D)&&(h=v,Ve.Renderer=S)}})(A||(A={}));let Wc=A,{clamp:Gd,pick:Wd,pushUnique:Ks,stableSort:Do}=Bi;(N||(N={})).distribute=function Y(h,v,S){let D=h,L=D.reducedLen||v,z=(ze,ft)=>ze.target-ft.target,B=[],U=h.length,X=[],te=B.push,K,re,ue,ge=!0,ye,be,_e=0,Fe;for(K=U;K--;)_e+=h[K].size;if(_e>L){for(Do(h,(ze,ft)=>(ft.rank||0)-(ze.rank||0)),ue=(Fe=h[0].rank===h[h.length-1].rank)?U/2:-1,re=Fe?ue:U-1;ue&&_e>L;)ye=h[K=Math.floor(re)],Ks(X,K)&&(_e-=ye.size),re+=ue,Fe&&re>=h.length&&(ue/=2,re=ue);X.sort((ze,ft)=>ft-ze).forEach(ze=>te.apply(B,h.splice(ze,1)))}for(Do(h,z),h=h.map(ze=>({size:ze.size,targets:[ze.target],align:Wd(ze.align,.5)}));ge;){for(K=h.length;K--;)ye=h[K],be=(Math.min.apply(0,ye.targets)+Math.max.apply(0,ye.targets))/2,ye.pos=Gd(be-ye.size*ye.align,0,v-ye.size);for(K=h.length,ge=!1;K--;)K>0&&h[K-1].pos+h[K-1].size>h[K].pos&&(h[K-1].size+=h[K].size,h[K-1].targets=h[K-1].targets.concat(h[K].targets),h[K-1].align=.5,h[K-1].pos+h[K-1].size>v&&(h[K-1].pos=v-h[K-1].size),h.splice(K,1),ge=!0)}return te.apply(D,B),K=0,h.some(ze=>{let ft=0;return(ze.targets||[]).some(()=>(D[K].pos=ze.pos+ft,S!==void 0&&Math.abs(D[K].pos-D[K].target)>S?(D.slice(0,K+1).forEach(St=>delete St.pos),D.reducedLen=(D.reducedLen||v)-.1*v,D.reducedLen>.1*v&&Y(D,v,S),!0):(ft+=D[K].size,K++,!1)))}),Do(D,z),D};let qo=N,{animate:Ia,animObject:sa,stop:oa}=se,{deg2rad:Wu,doc:ml,svg:gl,SVG_NS:aa,win:gf,isFirefox:qd}=Ve,{addEvent:Yo,attr:Ar,createElement:Yd,crisp:Di,css:Xd,defined:Io,erase:Bh,extend:Ji,fireEvent:qc,getAlignFactor:Ha,isArray:yi,isFunction:Lr,isNumber:Sr,isObject:Hs,isString:ka,merge:Tr,objectEach:Oa,pick:ps,pInt:_l,pushUnique:bs,replaceNested:wn,syncTimeout:Zd,uniqueKey:Js}=Bi;class rs{_defaultGetter(h){let v=ps(this[h+"Value"],this[h],this.element?this.element.getAttribute(h):null,0);return/^-?[\d\.]+$/.test(v)&&(v=parseFloat(v)),v}_defaultSetter(h,v,S){S.setAttribute(v,h)}add(h){let v,S=this.renderer,D=this.element;return h&&(this.parentGroup=h),this.textStr!==void 0&&this.element.nodeName==="text"&&S.buildText(this),this.added=!0,(!h||h.handleZ||this.zIndex)&&(v=this.zIndexSetter()),v||(h?h.element:S.box).appendChild(D),this.onAdd&&this.onAdd(),this}addClass(h,v){let S=v?"":this.attr("class")||"";return(h=(h||"").split(/ /g).reduce(function(D,L){return S.indexOf(L)===-1&&D.push(L),D},S?[S]:[]).join(" "))!==S&&this.attr("class",h),this}afterSetters(){this.doTransform&&(this.updateTransform(),this.doTransform=!1)}align(h,v,S,D=!0){let L=this.renderer,z=L.alignedObjects,B=!!h;h?(this.alignOptions=h,this.alignByTranslate=v,this.alignTo=S):(h=this.alignOptions||{},v=this.alignByTranslate,S=this.alignTo);let U=!S||ka(S)?S||"renderer":void 0;U&&(B&&bs(z,this),S=void 0);let X=ps(S,L[U],L),te=(X.x||0)+(h.x||0)+((X.width||0)-(h.width||0))*Ha(h.align),K=(X.y||0)+(h.y||0)+((X.height||0)-(h.height||0))*Ha(h.verticalAlign),re={"text-align":h==null?void 0:h.align};return re[v?"translateX":"x"]=Math.round(te),re[v?"translateY":"y"]=Math.round(K),D&&(this[this.placed?"animate":"attr"](re),this.placed=!0),this.alignAttr=re,this}alignSetter(h){let v={left:"start",center:"middle",right:"end"};v[h]&&(this.alignValue=h,this.element.setAttribute("text-anchor",v[h]))}animate(h,v,S){let D=sa(ps(v,this.renderer.globalAnimation,!0)),L=D.defer;return ml.hidden&&(D.duration=0),D.duration!==0?(S&&(D.complete=S),Zd(()=>{this.element&&Ia(this,h,D)},L)):(this.attr(h,void 0,S||D.complete),Oa(h,function(z,B){D.step&&D.step.call(this,z,{prop:B,pos:1,elem:this})},this)),this}applyTextOutline(h){let v=this.element;h.indexOf("contrast")!==-1&&(h=h.replace(/contrast/g,this.renderer.getContrast(v.style.fill)));let S=h.split(" "),D=S[S.length-1],L=S[0];if(L&&L!=="none"&&Ve.svg){this.fakeTS=!0,L=L.replace(/(^[\d\.]+)(.*?)$/g,function(te,K,re){return 2*Number(K)+re}),this.removeTextOutline();let z=ml.createElementNS(aa,"tspan");Ar(z,{class:"highcharts-text-outline",fill:D,stroke:D,"stroke-width":L,"stroke-linejoin":"round"});let B=v.querySelector("textPath")||v;[].forEach.call(B.childNodes,te=>{let K=te.cloneNode(!0);K.removeAttribute&&["fill","stroke","stroke-width","stroke"].forEach(re=>K.removeAttribute(re)),z.appendChild(K)});let U=0;[].forEach.call(B.querySelectorAll("text tspan"),te=>{U+=Number(te.getAttribute("dy"))});let X=ml.createElementNS(aa,"tspan");X.textContent="​",Ar(X,{x:Number(v.getAttribute("x")),dy:-U}),z.appendChild(X),B.insertBefore(z,B.firstChild)}}attr(h,v,S,D){let{element:L}=this,z=rs.symbolCustomAttribs,B,U,X=this,te;return typeof h=="string"&&v!==void 0&&(B=h,(h={})[B]=v),typeof h=="string"?X=(this[h+"Getter"]||this._defaultGetter).call(this,h,L):(Oa(h,function(K,re){te=!1,D||oa(this,re),this.symbolName&&z.indexOf(re)!==-1&&(U||(this.symbolAttr(h),U=!0),te=!0),this.rotation&&(re==="x"||re==="y")&&(this.doTransform=!0),te||(this[re+"Setter"]||this._defaultSetter).call(this,K,re,L)},this),this.afterSetters()),S&&S.call(this),X}clip(h){if(h&&!h.clipPath){let v=Js()+"-",S=this.renderer.createElement("clipPath").attr({id:v}).add(this.renderer.defs);Ji(h,{clipPath:S,id:v,count:0}),h.add(S)}return this.attr("clip-path",h?`url(${this.renderer.url}#${h.id})`:"none")}crisp(h,v){v=Math.round(v||h.strokeWidth||0);let S=h.x||this.x||0,D=h.y||this.y||0,L=(h.width||this.width||0)+S,z=(h.height||this.height||0)+D,B=Di(S,v),U=Di(D,v);return Ji(h,{x:B,y:U,width:Di(L,v)-B,height:Di(z,v)-U}),Io(h.strokeWidth)&&(h.strokeWidth=v),h}complexColor(h,v,S){let D=this.renderer,L,z,B,U,X,te,K,re,ue,ge,ye=[],be;qc(this.renderer,"complexColor",{args:arguments},function(){if(h.radialGradient?z="radialGradient":h.linearGradient&&(z="linearGradient"),z){if(B=h[z],X=D.gradients,te=h.stops,ue=S.radialReference,yi(B)&&(h[z]=B={x1:B[0],y1:B[1],x2:B[2],y2:B[3],gradientUnits:"userSpaceOnUse"}),z==="radialGradient"&&ue&&!Io(B.gradientUnits)&&(U=B,B=Tr(B,D.getRadialAttr(ue,U),{gradientUnits:"userSpaceOnUse"})),Oa(B,function(_e,Fe){Fe!=="id"&&ye.push(Fe,_e)}),Oa(te,function(_e){ye.push(_e)}),X[ye=ye.join(",")])ge=X[ye].attr("id");else{B.id=ge=Js();let _e=X[ye]=D.createElement(z).attr(B).add(D.defs);_e.radAttr=U,_e.stops=[],te.forEach(function(Fe){Fe[1].indexOf("rgba")===0?(K=(L=Jr.parse(Fe[1])).get("rgb"),re=L.get("a")):(K=Fe[1],re=1);let ze=D.createElement("stop").attr({offset:Fe[0],"stop-color":K,"stop-opacity":re}).add(_e);_e.stops.push(ze)})}be="url("+D.url+"#"+ge+")",S.setAttribute(v,be),S.gradient=ye,h.toString=function(){return be}}})}css(h){let v=this.styles,S={},D=this.element,L,z=!v;if(v&&Oa(h,function(B,U){v&&v[U]!==B&&(S[U]=B,z=!0)}),z){v&&(h=Ji(v,S)),h.width===null||h.width==="auto"?delete this.textWidth:D.nodeName.toLowerCase()==="text"&&h.width&&(L=this.textWidth=_l(h.width)),Ji(this.styles,h),L&&!gl&&this.renderer.forExport&&delete h.width;let B=qd&&h.fontSize||null;B&&(Sr(B)||/^\d+$/.test(B))&&(h.fontSize+="px");let U=Tr(h);D.namespaceURI===this.SVG_NS&&(["textOutline","textOverflow","whiteSpace","width"].forEach(X=>U&&delete U[X]),U.color&&(U.fill=U.color)),Xd(D,U)}return this.added&&(this.element.nodeName==="text"&&this.renderer.buildText(this),h.textOutline&&this.applyTextOutline(h.textOutline)),this}dashstyleSetter(h){let v,S=this["stroke-width"];if(S==="inherit"&&(S=1),h=h&&h.toLowerCase()){let D=h.replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(",");for(v=D.length;v--;)D[v]=""+_l(D[v])*ps(S,NaN);h=D.join(",").replace(/NaN/g,"none"),this.element.setAttribute("stroke-dasharray",h)}}destroy(){var U;let h=this,v=h.element||{},S=h.renderer,D=v.ownerSVGElement,L=v.nodeName==="SPAN"&&h.parentGroup||void 0,z,B;if(v.onclick=v.onmouseout=v.onmouseover=v.onmousemove=v.point=null,oa(h),h.clipPath&&D){let X=h.clipPath;[].forEach.call(D.querySelectorAll("[clip-path],[CLIP-PATH]"),function(te){te.getAttribute("clip-path").indexOf(X.element.id)>-1&&te.removeAttribute("clip-path")}),h.clipPath=X.destroy()}if(h.connector=(U=h.connector)==null?void 0:U.destroy(),h.stops){for(B=0;B<h.stops.length;B++)h.stops[B].destroy();h.stops.length=0,h.stops=void 0}for(h.safeRemoveChild(v);L&&L.div&&L.div.childNodes.length===0;)z=L.parentGroup,h.safeRemoveChild(L.div),delete L.div,L=z;h.alignOptions&&Bh(S.alignedObjects,h),Oa(h,function(X,te){h[te]&&h[te].parentGroup===h&&h[te].destroy&&h[te].destroy(),delete h[te]})}dSetter(h,v,S){yi(h)&&(typeof h[0]=="string"&&(h=this.renderer.pathToSegments(h)),this.pathArray=h,h=h.reduce((D,L,z)=>L&&L.join?(z?D+" ":"")+L.join(" "):(L||"").toString(),"")),/(NaN| {2}|^$)/.test(h)&&(h="M 0 0"),this[v]!==h&&(S.setAttribute(v,h),this[v]=h)}fillSetter(h,v,S){typeof h=="string"?S.setAttribute(v,h):h&&this.complexColor(h,v,S)}hrefSetter(h,v,S){S.setAttributeNS("http://www.w3.org/1999/xlink",v,h)}getBBox(h,v){let S,D,L,z,{alignValue:B,element:U,renderer:X,styles:te,textStr:K}=this,{cache:re,cacheKeys:ue}=X,ge=U.namespaceURI===this.SVG_NS,ye=ps(v,this.rotation,0),be=X.styledMode?U&&rs.prototype.getStyle.call(U,"font-size"):te.fontSize;if(Io(K)&&((z=K.toString()).indexOf("<")===-1&&(z=z.replace(/\d/g,"0")),z+=["",X.rootFontSize,be,ye,this.textWidth,B,te.lineClamp,te.textOverflow,te.fontWeight].join(",")),z&&!h&&(S=re[z]),!S||S.polygon){if(ge||X.forExport){try{L=this.fakeTS&&function(Fe){let ze=U.querySelector(".highcharts-text-outline");ze&&Xd(ze,{display:Fe})},Lr(L)&&L("none"),S=U.getBBox?Ji({},U.getBBox()):{width:U.offsetWidth,height:U.offsetHeight,x:0,y:0},Lr(L)&&L("")}catch{}(!S||S.width<0)&&(S={x:0,y:0,width:0,height:0})}else S=this.htmlGetBBox();D=S.height,ge&&(S.height=D={"11px,17":14,"13px,20":16}[`${be||""},${Math.round(D)}`]||D),ye&&(S=this.getRotatedBox(S,ye));let _e={bBox:S};qc(this,"afterGetBBox",_e),S=_e.bBox}if(z&&(K===""||S.height>0)){for(;ue.length>250;)delete re[ue.shift()];re[z]||ue.push(z),re[z]=S}return S}getRotatedBox(h,v){let{x:S,y:D,width:L,height:z}=h,{alignValue:B,translateY:U,rotationOriginX:X=0,rotationOriginY:te=0}=this,K=Ha(B),re=Number(this.element.getAttribute("y")||0)-(U?0:D),ue=v*Wu,ge=(v-90)*Wu,ye=Math.cos(ue),be=Math.sin(ue),_e=L*ye,Fe=L*be,ze=Math.cos(ge),ft=Math.sin(ge),[[St,_t],[Ot,Pt]]=[X,te].map(_r=>[_r-_r*ye,_r*be]),Ft=S+K*(L-_e)+St+Pt+re*ze,di=Ft+_e,gi=di-z*ze,Ai=gi-_e,ai=D+re-K*Fe-_t+Ot+re*ft,Ei=ai+Fe,Zi=Ei-z*ft,kr=Zi-Fe,Gi=Math.min(Ft,di,gi,Ai),gr=Math.min(ai,Ei,Zi,kr),Vi=Math.max(Ft,di,gi,Ai)-Gi,Qi=Math.max(ai,Ei,Zi,kr)-gr;return{x:Gi,y:gr,width:Vi,height:Qi,polygon:[[Ft,ai],[di,Ei],[gi,Zi],[Ai,kr]]}}getStyle(h){return gf.getComputedStyle(this.element||this,"").getPropertyValue(h)}hasClass(h){return(""+this.attr("class")).split(" ").indexOf(h)!==-1}hide(){return this.attr({visibility:"hidden"})}htmlGetBBox(){return{height:0,width:0,x:0,y:0}}constructor(h,v){this.onEvents={},this.opacity=1,this.SVG_NS=aa,this.element=v==="span"||v==="body"?Yd(v):ml.createElementNS(this.SVG_NS,v),this.renderer=h,this.styles={},qc(this,"afterInit")}on(h,v){let{onEvents:S}=this;return S[h]&&S[h](),S[h]=Yo(this.element,h,v),this}opacitySetter(h,v,S){let D=Number(Number(h).toFixed(3));this.opacity=D,S.setAttribute(v,D)}reAlign(){var h;(h=this.alignOptions)!=null&&h.width&&this.alignOptions.align!=="left"&&(this.alignOptions.width=this.getBBox().width,this.placed=!1,this.align())}removeClass(h){return this.attr("class",(""+this.attr("class")).replace(ka(h)?RegExp(`(^| )${h}( |$)`):h," ").replace(/ +/g," ").trim())}removeTextOutline(){let h=this.element.querySelector("tspan.highcharts-text-outline");h&&this.safeRemoveChild(h)}safeRemoveChild(h){let v=h.parentNode;v&&v.removeChild(h)}setRadialReference(h){let v=this.element.gradient&&this.renderer.gradients[this.element.gradient];return this.element.radialReference=h,v&&v.radAttr&&v.animate(this.renderer.getRadialAttr(h,v.radAttr)),this}shadow(h){var L;let{renderer:v}=this,S=Tr(((L=this.parentGroup)==null?void 0:L.rotation)===90?{offsetX:-1,offsetY:-1}:{},Hs(h)?h:{}),D=v.shadowDefinition(S);return this.attr({filter:h?`url(${v.url}#${D})`:"none"})}show(h=!0){return this.attr({visibility:h?"inherit":"visible"})}"stroke-widthSetter"(h,v,S){this[v]=h,S.setAttribute(v,h)}strokeWidth(){if(!this.renderer.styledMode)return this["stroke-width"]||0;let h=this.getStyle("stroke-width"),v=0,S;return/px$/.test(h)?v=_l(h):h!==""&&(Ar(S=ml.createElementNS(aa,"rect"),{width:h,"stroke-width":0}),this.element.parentNode.appendChild(S),v=S.getBBox().width,S.parentNode.removeChild(S)),v}symbolAttr(h){let v=this;rs.symbolCustomAttribs.forEach(function(S){v[S]=ps(h[S],v[S])}),v.attr({d:v.renderer.symbols[v.symbolName](v.x,v.y,v.width,v.height,v)})}textSetter(h){h!==this.textStr&&(delete this.textPxLength,this.textStr=h,this.added&&this.renderer.buildText(this),this.reAlign())}titleSetter(h){let v=this.element,S=v.getElementsByTagName("title")[0]||ml.createElementNS(this.SVG_NS,"title");v.insertBefore?v.insertBefore(S,v.firstChild):v.appendChild(S),S.textContent=wn(ps(h,""),[/<[^>]*>/g,""]).replace(/&lt;/g,"<").replace(/&gt;/g,">")}toFront(){let h=this.element;return h.parentNode.appendChild(h),this}translate(h,v){return this.attr({translateX:h,translateY:v})}updateTransform(h="transform"){var re;let{element:v,matrix:S,rotation:D=0,rotationOriginX:L,rotationOriginY:z,scaleX:B,scaleY:U,translateX:X=0,translateY:te=0}=this,K=["translate("+X+","+te+")"];Io(S)&&K.push("matrix("+S.join(",")+")"),D&&(K.push("rotate("+D+" "+ps(L,v.getAttribute("x"),0)+" "+ps(z,v.getAttribute("y")||0)+")"),((re=this.text)==null?void 0:re.element.tagName)==="SPAN"&&this.text.attr({rotation:D,rotationOriginX:(L||0)-this.padding,rotationOriginY:(z||0)-this.padding})),(Io(B)||Io(U))&&K.push("scale("+ps(B,1)+" "+ps(U,1)+")"),K.length&&!(this.text||this).textPath&&v.setAttribute(h,K.join(" "))}visibilitySetter(h,v,S){h==="inherit"?S.removeAttribute(v):this[v]!==h&&S.setAttribute(v,h),this[v]=h}xGetter(h){return this.element.nodeName==="circle"&&(h==="x"?h="cx":h==="y"&&(h="cy")),this._defaultGetter(h)}zIndexSetter(h,v){let S=this.renderer,D=this.parentGroup,L=(D||S).element||S.box,z=this.element,B=L===S.box,U,X,te,K=!1,re,ue=this.added,ge;if(Io(h)?(z.setAttribute("data-z-index",h),h=+h,this[v]===h&&(ue=!1)):Io(this[v])&&z.removeAttribute("data-z-index"),this[v]=h,ue){for((h=this.zIndex)&&D&&(D.handleZ=!0),ge=(U=L.childNodes).length-1;ge>=0&&!K;ge--)re=!Io(te=(X=U[ge]).getAttribute("data-z-index")),X!==z&&(h<0&&re&&!B&&!ge?(L.insertBefore(z,U[ge]),K=!0):(_l(te)<=h||re&&(!Io(h)||h>=0))&&(L.insertBefore(z,U[ge+1]),K=!0));K||(L.insertBefore(z,U[B?3:0]),K=!0)}return K}}rs.symbolCustomAttribs=["anchorX","anchorY","clockwise","end","height","innerR","r","start","width","x","y"],rs.prototype.strokeSetter=rs.prototype.fillSetter,rs.prototype.yGetter=rs.prototype.xGetter,rs.prototype.matrixSetter=rs.prototype.rotationOriginXSetter=rs.prototype.rotationOriginYSetter=rs.prototype.rotationSetter=rs.prototype.scaleXSetter=rs.prototype.scaleYSetter=rs.prototype.translateXSetter=rs.prototype.translateYSetter=rs.prototype.verticalAlignSetter=function(Y,h){this[h]=Y,this.doTransform=!0};let _o=rs,{defined:qu,extend:Yu,getAlignFactor:Is,isNumber:yo,merge:ks,pick:Yc,removeEvent:La}=Bi;class Qr extends _o{constructor(h,v,S,D,L,z,B,U,X,te){let K;super(h,"g"),this.paddingLeftSetter=this.paddingSetter,this.paddingRightSetter=this.paddingSetter,this.doUpdate=!1,this.textStr=v,this.x=S,this.y=D,this.anchorX=z,this.anchorY=B,this.baseline=X,this.className=te,this.addClass(te==="button"?"highcharts-no-tooltip":"highcharts-label"),te&&this.addClass("highcharts-"+te),this.text=h.text(void 0,0,0,U).attr({zIndex:1}),typeof L=="string"&&((K=/^url\((.*?)\)$/.test(L))||this.renderer.symbols[L])&&(this.symbolKey=L),this.bBox=Qr.emptyBBox,this.padding=3,this.baselineOffset=0,this.needsBox=h.styledMode||K,this.deferredAttr={},this.alignFactor=0}alignSetter(h){let v=Is(h);this.textAlign=h,v!==this.alignFactor&&(this.alignFactor=v,this.bBox&&yo(this.xSetting)&&this.attr({x:this.xSetting}))}anchorXSetter(h,v){this.anchorX=h,this.boxAttr(v,Math.round(h)-this.getCrispAdjust()-this.xSetting)}anchorYSetter(h,v){this.anchorY=h,this.boxAttr(v,h-this.ySetting)}boxAttr(h,v){this.box?this.box.attr(h,v):this.deferredAttr[h]=v}css(h){if(h){let v={};h=ks(h),Qr.textProps.forEach(S=>{h[S]!==void 0&&(v[S]=h[S],delete h[S])}),this.text.css(v),"fontSize"in v||"fontWeight"in v?this.updateTextPadding():("width"in v||"textOverflow"in v)&&this.updateBoxSize()}return _o.prototype.css.call(this,h)}destroy(){La(this.element,"mouseenter"),La(this.element,"mouseleave"),this.text&&this.text.destroy(),this.box&&(this.box=this.box.destroy()),_o.prototype.destroy.call(this)}fillSetter(h,v){h&&(this.needsBox=!0),this.fill=h,this.boxAttr(v,h)}getBBox(h,v){this.textStr&&this.bBox.width===0&&this.bBox.height===0&&this.updateBoxSize();let{padding:S,height:D=0,translateX:L=0,translateY:z=0,width:B=0}=this,U=Yc(this.paddingLeft,S),X=v??(this.rotation||0),te={width:B,height:D,x:L+this.bBox.x-U,y:z+this.bBox.y-S+this.baselineOffset};return X&&(te=this.getRotatedBox(te,X)),te}getCrispAdjust(){return(this.renderer.styledMode&&this.box?this.box.strokeWidth():this["stroke-width"]?parseInt(this["stroke-width"],10):0)%2/2}heightSetter(h){this.heightSetting=h,this.doUpdate=!0}afterSetters(){super.afterSetters(),this.doUpdate&&(this.updateBoxSize(),this.doUpdate=!1)}onAdd(){this.text.add(this),this.attr({text:Yc(this.textStr,""),x:this.x||0,y:this.y||0}),this.box&&qu(this.anchorX)&&this.attr({anchorX:this.anchorX,anchorY:this.anchorY})}paddingSetter(h,v){yo(h)?h!==this[v]&&(this[v]=h,this.updateTextPadding()):this[v]=void 0}rSetter(h,v){this.boxAttr(v,h)}strokeSetter(h,v){this.stroke=h,this.boxAttr(v,h)}"stroke-widthSetter"(h,v){h&&(this.needsBox=!0),this["stroke-width"]=h,this.boxAttr(v,h)}"text-alignSetter"(h){this.textAlign=this["text-align"]=h,this.updateTextPadding()}textSetter(h){h!==void 0&&this.text.attr({text:h}),this.updateTextPadding(),this.reAlign()}updateBoxSize(){let h,v=this.text,S={},D=this.padding,L=this.bBox=(!yo(this.widthSetting)||!yo(this.heightSetting)||this.textAlign)&&qu(v.textStr)?v.getBBox(void 0,0):Qr.emptyBBox;this.width=this.getPaddedWidth(),this.height=(this.heightSetting||L.height||0)+2*D;let z=this.renderer.fontMetrics(v);if(this.baselineOffset=D+Math.min((this.text.firstLineMetrics||z).b,L.height||1/0),this.heightSetting&&(this.baselineOffset+=(this.heightSetting-z.h)/2),this.needsBox&&!v.textPath){if(!this.box){let B=this.box=this.symbolKey?this.renderer.symbol(this.symbolKey):this.renderer.rect();B.addClass((this.className==="button"?"":"highcharts-label-box")+(this.className?" highcharts-"+this.className+"-box":"")),B.add(this)}h=this.getCrispAdjust(),S.x=h,S.y=(this.baseline?-this.baselineOffset:0)+h,S.width=Math.round(this.width),S.height=Math.round(this.height),this.box.attr(Yu(S,this.deferredAttr)),this.deferredAttr={}}}updateTextPadding(){let h=this.text,v=h.styles.textAlign||this.textAlign;if(!h.textPath){this.updateBoxSize();let S=this.baseline?0:this.baselineOffset,D=(this.paddingLeft??this.padding)+Is(v)*(this.widthSetting??this.bBox.width);(D!==h.x||S!==h.y)&&(h.attr({align:v,x:D}),S!==void 0&&h.attr("y",S)),h.x=D,h.y=S}}widthSetter(h){this.widthSetting=yo(h)?h:void 0,this.doUpdate=!0}getPaddedWidth(){let h=this.padding,v=Yc(this.paddingLeft,h),S=Yc(this.paddingRight,h);return(this.widthSetting||this.bBox.width||0)+v+S}xSetter(h){this.x=h,this.alignFactor&&(h-=this.alignFactor*this.getPaddedWidth(),this["forceAnimate:x"]=!0),this.xSetting=Math.round(h),this.attr("translateX",this.xSetting)}ySetter(h){this.ySetting=this.y=Math.round(h),this.attr("translateY",this.ySetting)}}Qr.emptyBBox={width:0,height:0,x:0,y:0},Qr.textProps=["color","direction","fontFamily","fontSize","fontStyle","fontWeight","lineClamp","lineHeight","textAlign","textDecoration","textOutline","textOverflow","whiteSpace","width"];let{defined:ko,isNumber:ws,pick:yn}=Bi;function Xc(Y,h,v,S,D){let L=[];if(D){let z=D.start||0,B=yn(D.r,v),U=yn(D.r,S||v),X=2e-4/(D.borderRadius?1:Math.max(B,1)),te=Math.abs((D.end||0)-z-2*Math.PI)<X,K=(D.end||0)-(te?X:0),re=D.innerR,ue=yn(D.open,te),ge=Math.cos(z),ye=Math.sin(z),be=Math.cos(K),_e=Math.sin(K),Fe=yn(D.longArc,K-z-Math.PI<X?0:1),ze=["A",B,U,0,Fe,yn(D.clockwise,1),Y+B*be,h+U*_e];ze.params={start:z,end:K,cx:Y,cy:h},L.push(["M",Y+B*ge,h+U*ye],ze),ko(re)&&((ze=["A",re,re,0,Fe,ko(D.clockwise)?1-D.clockwise:0,Y+re*ge,h+re*ye]).params={start:K,end:z,cx:Y,cy:h},L.push(ue?["M",Y+re*be,h+re*_e]:["L",Y+re*be,h+re*_e],ze)),ue||L.push(["Z"])}return L}function Xo(Y,h,v,S,D){return D&&D.r?Ga(Y,h,v,S,D):[["M",Y,h],["L",Y+v,h],["L",Y+v,h+S],["L",Y,h+S],["Z"]]}function Ga(Y,h,v,S,D){let L=(D==null?void 0:D.r)||0;return[["M",Y+L,h],["L",Y+v-L,h],["A",L,L,0,0,1,Y+v,h+L],["L",Y+v,h+S-L],["A",L,L,0,0,1,Y+v-L,h+S],["L",Y+L,h+S],["A",L,L,0,0,1,Y,h+S-L],["L",Y,h+L],["A",L,L,0,0,1,Y+L,h],["Z"]]}let Zc={arc:Xc,callout:function(Y,h,v,S,D){let L=Math.min(D&&D.r||0,v,S),z=L+6,B=D&&D.anchorX,U=D&&D.anchorY||0,X=Ga(Y,h,v,S,{r:L});if(!ws(B)||B<v&&B>0&&U<S&&U>0)return X;if(Y+B>v-z)if(U>h+z&&U<h+S-z)X.splice(3,1,["L",Y+v,U-6],["L",Y+v+6,U],["L",Y+v,U+6],["L",Y+v,h+S-L]);else if(B<v){let te=U<h+z,K=te?h:h+S;X.splice(te?2:5,0,["L",B,U],["L",Y+v-L,K])}else X.splice(3,1,["L",Y+v,S/2],["L",B,U],["L",Y+v,S/2],["L",Y+v,h+S-L]);else if(Y+B<z)if(U>h+z&&U<h+S-z)X.splice(7,1,["L",Y,U+6],["L",Y-6,U],["L",Y,U-6],["L",Y,h+L]);else if(B>0){let te=U<h+z,K=te?h:h+S;X.splice(te?1:6,0,["L",B,U],["L",Y+L,K])}else X.splice(7,1,["L",Y,S/2],["L",B,U],["L",Y,S/2],["L",Y,h+L]);else U>S&&B<v-z?X.splice(5,1,["L",B+6,h+S],["L",B,h+S+6],["L",B-6,h+S],["L",Y+L,h+S]):U<0&&B>z&&X.splice(1,1,["L",B-6,h],["L",B,h-6],["L",B+6,h],["L",v-L,h]);return X},circle:function(Y,h,v,S){return Xc(Y+v/2,h+S/2,v/2,S/2,{start:.5*Math.PI,end:2.5*Math.PI,open:!1})},diamond:function(Y,h,v,S){return[["M",Y+v/2,h],["L",Y+v,h+S/2],["L",Y+v/2,h+S],["L",Y,h+S/2],["Z"]]},rect:Xo,roundedRect:Ga,square:Xo,triangle:function(Y,h,v,S){return[["M",Y+v/2,h],["L",Y+v,h+S],["L",Y,h+S],["Z"]]},"triangle-down":function(Y,h,v,S){return[["M",Y,h],["L",Y+v,h],["L",Y+v/2,h+S],["Z"]]}},{doc:Oo,SVG_NS:Kd,win:Ra}=Ve,{attr:Jd,extend:Qd,fireEvent:no,isString:ep,objectEach:Nh,pick:Xu}=Bi,Ql=(Y,h)=>Y.substring(0,h)+"…",Vm=class{constructor(Y){let h=Y.styles;this.renderer=Y.renderer,this.svgElement=Y,this.width=Y.textWidth,this.textLineHeight=h&&h.lineHeight,this.textOutline=h&&h.textOutline,this.ellipsis=!!(h&&h.textOverflow==="ellipsis"),this.lineClamp=h==null?void 0:h.lineClamp,this.noWrap=!!(h&&h.whiteSpace==="nowrap")}buildSVG(){let Y=this.svgElement,h=Y.element,v=Y.renderer,S=Xu(Y.textStr,"").toString(),D=S.indexOf("<")!==-1,L=h.childNodes,z=!Y.added&&v.box,B=[S,this.ellipsis,this.noWrap,this.textLineHeight,this.textOutline,Y.getStyle("font-size"),Y.styles.lineClamp,this.width].join(",");if(B!==Y.textCache){Y.textCache=B,delete Y.actualWidth;for(let U=L.length;U--;)h.removeChild(L[U]);if(D||this.ellipsis||this.width||Y.textPath||S.indexOf(" ")!==-1&&(!this.noWrap||/<br.*?>/g.test(S))){if(S!==""){z&&z.appendChild(h);let U=new fi(S);this.modifyTree(U.nodes),U.addToDOM(h),this.modifyDOM(),this.ellipsis&&(h.textContent||"").indexOf("…")!==-1&&Y.attr("title",this.unescapeEntities(Y.textStr||"",["&lt;","&gt;"])),z&&z.removeChild(h)}}else h.appendChild(Oo.createTextNode(this.unescapeEntities(S)));ep(this.textOutline)&&Y.applyTextOutline&&Y.applyTextOutline(this.textOutline)}}modifyDOM(){let Y,h=this.svgElement,v=Jd(h.element,"x");for(h.firstLineMetrics=void 0;(Y=h.element.firstChild)&&/^[\s\u200B]*$/.test(Y.textContent||" ");)h.element.removeChild(Y);[].forEach.call(h.element.querySelectorAll("tspan.highcharts-br"),(z,B)=>{z.nextSibling&&z.previousSibling&&(B===0&&z.previousSibling.nodeType===1&&(h.firstLineMetrics=h.renderer.fontMetrics(z.previousSibling)),Jd(z,{dy:this.getLineHeight(z.nextSibling),x:v}))});let S=this.width||0;if(!S)return;let D=(z,B)=>{var ye;let U=z.textContent||"",X=U.replace(/([^\^])-/g,"$1- ").split(" "),te=!this.noWrap&&(X.length>1||h.element.childNodes.length>1),K=this.getLineHeight(B),re=Math.max(0,S-.8*K),ue=0,ge=h.actualWidth;if(te){let be=[],_e=[];for(;B.firstChild&&B.firstChild!==z;)_e.push(B.firstChild),B.removeChild(B.firstChild);for(;X.length;)if(X.length&&!this.noWrap&&ue>0&&(be.push(z.textContent||""),z.textContent=X.join(" ").replace(/- /g,"-")),this.truncate(z,void 0,X,ue===0&&ge||0,S,re,(Fe,ze)=>X.slice(0,ze).join(" ").replace(/- /g,"-")),ge=h.actualWidth,ue++,this.lineClamp&&ue>=this.lineClamp){X.length&&(this.truncate(z,z.textContent||"",void 0,0,S,re,Ql),z.textContent=((ye=z.textContent)==null?void 0:ye.replace("…",""))+"…");break}_e.forEach(Fe=>{B.insertBefore(Fe,z)}),be.forEach(Fe=>{B.insertBefore(Oo.createTextNode(Fe),z);let ze=Oo.createElementNS(Kd,"tspan");ze.textContent="​",Jd(ze,{dy:K,x:v}),B.insertBefore(ze,z)})}else this.ellipsis&&U&&this.truncate(z,U,void 0,0,S,re,Ql)},L=z=>{[].slice.call(z.childNodes).forEach(B=>{B.nodeType===Ra.Node.TEXT_NODE?D(B,z):(B.className.baseVal.indexOf("highcharts-br")!==-1&&(h.actualWidth=0),L(B))})};L(h.element)}getLineHeight(Y){let h=Y.nodeType===Ra.Node.TEXT_NODE?Y.parentElement:Y;return this.textLineHeight?parseInt(this.textLineHeight.toString(),10):this.renderer.fontMetrics(h||this.svgElement.element).h}modifyTree(Y){let h=(v,S)=>{let{attributes:D={},children:L,style:z={},tagName:B}=v,U=this.renderer.styledMode;if(B==="b"||B==="strong"?U?D.class="highcharts-strong":z.fontWeight="bold":(B==="i"||B==="em")&&(U?D.class="highcharts-emphasized":z.fontStyle="italic"),z&&z.color&&(z.fill=z.color),B==="br"){D.class="highcharts-br",v.textContent="​";let X=Y[S+1];X&&X.textContent&&(X.textContent=X.textContent.replace(/^ +/gm,""))}else B==="a"&&L&&L.some(X=>X.tagName==="#text")&&(v.children=[{children:L,tagName:"tspan"}]);B!=="#text"&&B!=="a"&&(v.tagName="tspan"),Qd(v,{attributes:D,style:z}),L&&L.filter(X=>X.tagName!=="#text").forEach(h)};Y.forEach(h),no(this.svgElement,"afterModifyTree",{nodes:Y})}truncate(Y,h,v,S,D,L,z){let B,U,X=this.svgElement,{rotation:te}=X,K=[],re=v&&!S?1:0,ue=(h||v||"").length,ge=ue;v||(D=L);let ye=function(be,_e){let Fe=_e||be,ze=Y.parentNode;if(ze&&K[Fe]===void 0&&ze.getSubStringLength)try{K[Fe]=S+ze.getSubStringLength(0,v?Fe+1:Fe)}catch{}return K[Fe]};if(X.rotation=0,S+(U=ye(Y.textContent.length))>D){for(;re<=ue;)ge=Math.ceil((re+ue)/2),v&&(B=z(v,ge)),U=ye(ge,B&&B.length-1),re===ue?re=ue+1:U>D?ue=ge-1:re=ge;ue===0?Y.textContent="":h&&ue===h.length-1||(Y.textContent=B||z(h||v,ge)),this.ellipsis&&U>D&&this.truncate(Y,Y.textContent||"",void 0,0,D,L,Ql)}v&&v.splice(0,ge),X.actualWidth=U,X.rotation=te}unescapeEntities(Y,h){return Nh(this.renderer.escapes,function(v,S){h&&h.indexOf(v)!==-1||(Y=Y.toString().replace(RegExp(v,"g"),S))}),Y}},{defaultOptions:Um}=zn,{charts:Zu,deg2rad:Kc,doc:Jc,isFirefox:ec,isMS:Vh,isWebKit:Wa,noop:yl,SVG_NS:jm,symbolSizes:tc,win:tp}=Ve,{addEvent:Ku,attr:Uh,createElement:ip,crisp:vl,css:Xi,defined:Si,destroyObjectProperties:jh,extend:Oi,isArray:Qc,isNumber:xl,isObject:zi,isString:eu,merge:qa,pick:Ju,pInt:$h,replaceNested:so,uniqueKey:Os}=Bi;class ei{constructor(h,v,S,D,L,z,B){let U,X,te=this.createElement("svg").attr({version:"1.1",class:"highcharts-root"}),K=te.element;B||te.css(this.getStyle(D||{})),h.appendChild(K),Uh(h,"dir","ltr"),h.innerHTML.indexOf("xmlns")===-1&&Uh(K,"xmlns",this.SVG_NS),this.box=K,this.boxWrapper=te,this.alignedObjects=[],this.url=this.getReferenceURL(),this.createElement("desc").add().element.appendChild(Jc.createTextNode("Created with Highcharts 12.1.2")),this.defs=this.createElement("defs").add(),this.allowHTML=z,this.forExport=L,this.styledMode=B,this.gradients={},this.cache={},this.cacheKeys=[],this.imgCount=0,this.rootFontSize=te.getStyle("font-size"),this.setSize(v,S,!1),ec&&h.getBoundingClientRect&&((U=function(){Xi(h,{left:0,top:0}),X=h.getBoundingClientRect(),Xi(h,{left:Math.ceil(X.left)-X.left+"px",top:Math.ceil(X.top)-X.top+"px"})})(),this.unSubPixelFix=Ku(tp,"resize",U))}definition(h){return new fi([h]).addToDOM(this.defs.element)}getReferenceURL(){if((ec||Wa)&&Jc.getElementsByTagName("base").length){if(!Si(c)){let h=Os(),v=new fi([{tagName:"svg",attributes:{width:8,height:8},children:[{tagName:"defs",children:[{tagName:"clipPath",attributes:{id:h},children:[{tagName:"rect",attributes:{width:4,height:4}}]}]},{tagName:"rect",attributes:{id:"hitme",width:8,height:8,"clip-path":`url(#${h})`,fill:"rgba(0,0,0,0.001)"}}]}]).addToDOM(Jc.body);Xi(v,{position:"fixed",top:0,left:0,zIndex:9e5});let S=Jc.elementFromPoint(6,6);c=(S&&S.id)==="hitme",Jc.body.removeChild(v)}if(c)return so(tp.location.href.split("#")[0],[/<[^>]*>/g,""],[/([\('\)])/g,"\\$1"],[/ /g,"%20"])}return""}getStyle(h){return this.style=Oi({fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif',fontSize:"1rem"},h),this.style}setStyle(h){this.boxWrapper.css(this.getStyle(h))}isHidden(){return!this.boxWrapper.getBBox().width}destroy(){let h=this.defs;return this.box=null,this.boxWrapper=this.boxWrapper.destroy(),jh(this.gradients||{}),this.gradients=null,this.defs=h.destroy(),this.unSubPixelFix&&this.unSubPixelFix(),this.alignedObjects=null,null}createElement(h){return new this.Element(this,h)}getRadialAttr(h,v){return{cx:h[0]-h[2]/2+(v.cx||0)*h[2],cy:h[1]-h[2]/2+(v.cy||0)*h[2],r:(v.r||0)*h[2]}}shadowDefinition(h){let v=[`highcharts-drop-shadow-${this.chartIndex}`,...Object.keys(h).map(D=>`${D}-${h[D]}`)].join("-").toLowerCase().replace(/[^a-z\d\-]/g,""),S=qa({color:"#000000",offsetX:1,offsetY:1,opacity:.15,width:5},h);return this.defs.element.querySelector(`#${v}`)||this.definition({tagName:"filter",attributes:{id:v,filterUnits:S.filterUnits},children:this.getShadowFilterContent(S)}),v}getShadowFilterContent(h){return[{tagName:"feDropShadow",attributes:{dx:h.offsetX,dy:h.offsetY,"flood-color":h.color,"flood-opacity":Math.min(5*h.opacity,1),stdDeviation:h.width/2}}]}buildText(h){new Vm(h).buildSVG()}getContrast(h){let v=Jr.parse(h).rgba.map(D=>{let L=D/255;return L<=.03928?L/12.92:Math.pow((L+.055)/1.055,2.4)}),S=.2126*v[0]+.7152*v[1]+.0722*v[2];return 1.05/(S+.05)>(S+.05)/.05?"#FFFFFF":"#000000"}button(h,v,S,D,L={},z,B,U,X,te){let K=this.label(h,v,S,X,void 0,void 0,te,void 0,"button"),re=this.styledMode,ue=arguments,ge=0;L=qa(Um.global.buttonTheme,L),re&&(delete L.fill,delete L.stroke,delete L["stroke-width"]);let ye=L.states||{},be=L.style||{};delete L.states,delete L.style;let _e=[fi.filterUserAttributes(L)],Fe=[be];return re||["hover","select","disabled"].forEach((ze,ft)=>{_e.push(qa(_e[0],fi.filterUserAttributes(ue[ft+5]||ye[ze]||{}))),Fe.push(_e[ft+1].style),delete _e[ft+1].style}),Ku(K.element,Vh?"mouseover":"mouseenter",function(){ge!==3&&K.setState(1)}),Ku(K.element,Vh?"mouseout":"mouseleave",function(){ge!==3&&K.setState(ge)}),K.setState=(ze=0)=>{if(ze!==1&&(K.state=ge=ze),K.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][ze]),!re){K.attr(_e[ze]);let ft=Fe[ze];zi(ft)&&K.css(ft)}},K.attr(_e[0]),!re&&(K.css(Oi({cursor:"default"},be)),te&&K.text.css({pointerEvents:"none"})),K.on("touchstart",ze=>ze.stopPropagation()).on("click",function(ze){ge!==3&&D.call(K,ze)})}crispLine(h,v){let[S,D]=h;return Si(S[1])&&S[1]===D[1]&&(S[1]=D[1]=vl(S[1],v)),Si(S[2])&&S[2]===D[2]&&(S[2]=D[2]=vl(S[2],v)),h}path(h){let v=this.styledMode?{}:{fill:"none"};return Qc(h)?v.d=h:zi(h)&&Oi(v,h),this.createElement("path").attr(v)}circle(h,v,S){let D=zi(h)?h:h===void 0?{}:{x:h,y:v,r:S},L=this.createElement("circle");return L.xSetter=L.ySetter=function(z,B,U){U.setAttribute("c"+B,z)},L.attr(D)}arc(h,v,S,D,L,z){let B;zi(h)?(v=(B=h).y,S=B.r,D=B.innerR,L=B.start,z=B.end,h=B.x):B={innerR:D,start:L,end:z};let U=this.symbol("arc",h,v,S,S,B);return U.r=S,U}rect(h,v,S,D,L,z){let B=zi(h)?h:h===void 0?{}:{x:h,y:v,r:L,width:Math.max(S||0,0),height:Math.max(D||0,0)},U=this.createElement("rect");return this.styledMode||(z!==void 0&&(B["stroke-width"]=z,Oi(B,U.crisp(B))),B.fill="none"),U.rSetter=function(X,te,K){U.r=X,Uh(K,{rx:X,ry:X})},U.rGetter=function(){return U.r||0},U.attr(B)}roundedRect(h){return this.symbol("roundedRect").attr(h)}setSize(h,v,S){this.width=h,this.height=v,this.boxWrapper.animate({width:h,height:v},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:Ju(S,!0)?void 0:0}),this.alignElements()}g(h){let v=this.createElement("g");return h?v.attr({class:"highcharts-"+h}):v}image(h,v,S,D,L,z){let B={preserveAspectRatio:"none"};xl(v)&&(B.x=v),xl(S)&&(B.y=S),xl(D)&&(B.width=D),xl(L)&&(B.height=L);let U=this.createElement("image").attr(B),X=function(te){U.attr({href:h}),z.call(U,te)};if(z){U.attr({href:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="});let te=new tp.Image;Ku(te,"load",X),te.src=h,te.complete&&X({})}else U.attr({href:h});return U}symbol(h,v,S,D,L,z){let B,U,X,te,K=this,re=/^url\((.*?)\)$/,ue=re.test(h),ge=!ue&&(this.symbols[h]?h:"circle"),ye=ge&&this.symbols[ge];if(ye)typeof v=="number"&&(U=ye.call(this.symbols,v||0,S||0,D||0,L||0,z)),B=this.path(U),K.styledMode||B.attr("fill","none"),Oi(B,{symbolName:ge||void 0,x:v,y:S,width:D,height:L}),z&&Oi(B,z);else if(ue){X=h.match(re)[1];let be=B=this.image(X);be.imgwidth=Ju(z&&z.width,tc[X]&&tc[X].width),be.imgheight=Ju(z&&z.height,tc[X]&&tc[X].height),te=_e=>_e.attr({width:_e.width,height:_e.height}),["width","height"].forEach(_e=>{be[`${_e}Setter`]=function(Fe,ze){this[ze]=Fe;let{alignByTranslate:ft,element:St,width:_t,height:Ot,imgwidth:Pt,imgheight:Ft}=this,di=ze==="width"?Pt:Ft,gi=1;z&&z.backgroundSize==="within"&&_t&&Ot&&Pt&&Ft?(gi=Math.min(_t/Pt,Ot/Ft),Uh(St,{width:Math.round(Pt*gi),height:Math.round(Ft*gi)})):St&&di&&St.setAttribute(ze,di),!ft&&Pt&&Ft&&this.translate(((_t||0)-Pt*gi)/2,((Ot||0)-Ft*gi)/2)}}),Si(v)&&be.attr({x:v,y:S}),be.isImg=!0,be.symbolUrl=h,Si(be.imgwidth)&&Si(be.imgheight)?te(be):(be.attr({width:0,height:0}),ip("img",{onload:function(){let _e=Zu[K.chartIndex];this.width===0&&(Xi(this,{position:"absolute",top:"-999em"}),Jc.body.appendChild(this)),tc[X]={width:this.width,height:this.height},be.imgwidth=this.width,be.imgheight=this.height,be.element&&te(be),this.parentNode&&this.parentNode.removeChild(this),K.imgCount--,K.imgCount||!_e||_e.hasLoaded||_e.onload()},src:X}),this.imgCount++)}return B}clipRect(h,v,S,D){return this.rect(h,v,S,D,0)}text(h,v,S,D){let L={};if(D&&(this.allowHTML||!this.forExport))return this.html(h,v,S);L.x=Math.round(v||0),S&&(L.y=Math.round(S)),Si(h)&&(L.text=h);let z=this.createElement("text").attr(L);return D&&(!this.forExport||this.allowHTML)||(z.xSetter=function(B,U,X){let te=X.getElementsByTagName("tspan"),K=X.getAttribute(U);for(let re=0,ue;re<te.length;re++)(ue=te[re]).getAttribute(U)===K&&ue.setAttribute(U,B);X.setAttribute(U,B)}),z}fontMetrics(h){let v=$h(_o.prototype.getStyle.call(h,"font-size")||0),S=v<24?v+3:Math.round(1.2*v),D=Math.round(.8*S);return{h:S,b:D,f:v}}rotCorr(h,v,S){let D=h;return v&&S&&(D=Math.max(D*Math.cos(v*Kc),4)),{x:-h/3*Math.sin(v*Kc),y:D}}pathToSegments(h){let v=[],S=[],D={A:8,C:7,H:2,L:3,M:3,Q:5,S:5,T:3,V:2};for(let L=0;L<h.length;L++)eu(S[0])&&xl(h[L])&&S.length===D[S[0].toUpperCase()]&&h.splice(L,0,S[0].replace("M","L").replace("m","l")),typeof h[L]=="string"&&(S.length&&v.push(S.slice(0)),S.length=0),S.push(h[L]);return v.push(S.slice(0)),v}label(h,v,S,D,L,z,B,U,X){return new Qr(this,h,v,S,D,L,z,B,U,X)}alignElements(){this.alignedObjects.forEach(h=>h.align())}}Oi(ei.prototype,{Element:_o,SVG_NS:jm,escapes:{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},symbols:Zc,draw:yl}),Wc.registerRendererType("svg",ei,!0);let{composed:rp}=Ve,{attr:Hh,css:za,createElement:bl,defined:fs,extend:Ya,getAlignFactor:np,isNumber:ic,pInt:rc,pushUnique:nc}=Bi;function Gh(Y,h,v){var D;let S=((D=this.div)==null?void 0:D.style)||v.style;_o.prototype[`${h}Setter`].call(this,Y,h,v),S&&(S[h]=Y)}let $m=(Y,h)=>{var v;if(!Y.div){let S=Hh(Y.element,"class"),D=Y.css,L=bl("div",S?{className:S}:void 0,{position:"absolute",left:`${Y.translateX||0}px`,top:`${Y.translateY||0}px`,...Y.styles,display:Y.display,opacity:Y.opacity,visibility:Y.visibility},((v=Y.parentGroup)==null?void 0:v.div)||h);Y.classSetter=(z,B,U)=>{U.setAttribute("class",z),L.className=z},Y.translateXSetter=Y.translateYSetter=(z,B)=>{Y[B]=z,L.style[B==="translateX"?"left":"top"]=`${z}px`,Y.doTransform=!0},Y.opacitySetter=Y.visibilitySetter=Gh,Y.css=z=>(D.call(Y,z),z.cursor&&(L.style.cursor=z.cursor),z.pointerEvents&&(L.style.pointerEvents=z.pointerEvents),Y),Y.on=function(){return _o.prototype.on.apply({element:L,onEvents:Y.onEvents},arguments),Y},Y.div=L}return Y.div};class sc extends _o{static compose(h){nc(rp,this.compose)&&(h.prototype.html=function(v,S,D){return new sc(this,"span").attr({text:v,x:Math.round(S),y:Math.round(D)})})}constructor(h,v){super(h,v),this.css({position:"absolute",...h.styledMode?{}:{fontFamily:h.style.fontFamily,fontSize:h.style.fontSize}})}getSpanCorrection(h,v,S){this.xCorr=-h*S,this.yCorr=-v}css(h){let v,{element:S}=this,D=S.tagName==="SPAN"&&h&&"width"in h,L=D&&h.width;return D&&(delete h.width,this.textWidth=rc(L)||void 0,v=!0),(h==null?void 0:h.textOverflow)==="ellipsis"&&(h.overflow="hidden"),h!=null&&h.lineClamp&&(h.display="-webkit-box",h.WebkitLineClamp=h.lineClamp,h.WebkitBoxOrient="vertical",h.overflow="hidden"),ic(Number(h==null?void 0:h.fontSize))&&(h.fontSize=h.fontSize+"px"),Ya(this.styles,h),za(S,h),v&&this.updateTransform(),this}htmlGetBBox(){let{element:h}=this;return{x:h.offsetLeft,y:h.offsetTop,width:h.offsetWidth,height:h.offsetHeight}}updateTransform(){var _e;if(!this.added){this.alignOnAdd=!0;return}let{element:h,renderer:v,rotation:S,rotationOriginX:D,rotationOriginY:L,scaleX:z,scaleY:B,styles:U,textAlign:X="left",textWidth:te,translateX:K=0,translateY:re=0,x:ue=0,y:ge=0}=this,{display:ye="block",whiteSpace:be}=U;if(za(h,{marginLeft:`${K}px`,marginTop:`${re}px`}),h.tagName==="SPAN"){let Fe,ze=[S,X,h.innerHTML,te,this.textAlign].join(","),ft=-(((_e=this.parentGroup)==null?void 0:_e.padding)*1)||0;if(te!==this.oldTextWidth){let Pt=this.textPxLength?this.textPxLength:(za(h,{width:"",whiteSpace:be||"nowrap"}),h.offsetWidth),Ft=te||0;(Ft>this.oldTextWidth||Pt>Ft)&&(/[ \-]/.test(h.textContent||h.innerText)||h.style.textOverflow==="ellipsis")&&(za(h,{width:Pt>Ft||S||z?te+"px":"auto",display:ye,whiteSpace:be||"normal"}),this.oldTextWidth=te)}ze!==this.cTT&&(Fe=v.fontMetrics(h).b,fs(S)&&(S!==(this.oldRotation||0)||X!==this.oldAlign)&&this.setSpanRotation(S,ft,ft),this.getSpanCorrection(!fs(S)&&!this.textWidth&&this.textPxLength||h.offsetWidth,Fe,np(X)));let{xCorr:St=0,yCorr:_t=0}=this,Ot={left:`${ue+St}px`,top:`${ge+_t}px`,textAlign:X,transformOrigin:`${(D??ue)-St-ue-ft}px ${(L??ge)-_t-ge-ft}px`};(z||B)&&(Ot.transform=`scale(${z??1},${B??1})`),za(h,Ot),this.cTT=ze,this.oldRotation=S,this.oldAlign=X}}setSpanRotation(h,v,S){za(this.element,{transform:`rotate(${h}deg)`,transformOrigin:`${v}% ${S}px`})}add(h){let v,S=this.renderer.box.parentNode,D=[];if(this.parentGroup=h,h&&!(v=h.div)){let L=h;for(;L;)D.push(L),L=L.parentGroup;for(let z of D.reverse())v=$m(z,S)}return(v||S).appendChild(this.element),this.added=!0,this.alignOnAdd&&this.updateTransform(),this}textSetter(h){h!==this.textStr&&(delete this.bBox,delete this.oldTextWidth,fi.setElementHTML(this.element,h??""),this.textStr=h,this.doTransform=!0)}alignSetter(h){this.alignValue=this.textAlign=h,this.doTransform=!0}xSetter(h,v){this[v]=h,this.doTransform=!0}}let oc=sc.prototype;oc.visibilitySetter=oc.opacitySetter=Gh,oc.ySetter=oc.rotationSetter=oc.rotationOriginXSetter=oc.rotationOriginYSetter=oc.xSetter,function(Y){Y.xAxis={alignTicks:!0,allowDecimals:void 0,panningEnabled:!0,zIndex:2,zoomEnabled:!0,dateTimeLabelFormats:{millisecond:{main:"%[HMSL]",range:!1},second:{main:"%[HMS]",range:!1},minute:{main:"%[HM]",range:!1},hour:{main:"%[HM]",range:!1},day:{main:"%[eb]"},week:{main:"%[eb]"},month:{main:"%[bY]"},year:{main:"%Y"}},endOnTick:!1,gridLineDashStyle:"Solid",gridZIndex:1,labels:{autoRotationLimit:80,distance:15,enabled:!0,indentation:10,overflow:"justify",reserveSpace:void 0,rotation:void 0,staggerLines:0,step:0,useHTML:!1,zIndex:7,style:{color:"#333333",cursor:"default",fontSize:"0.8em",textOverflow:"ellipsis"}},maxPadding:.01,minorGridLineDashStyle:"Solid",minorTickLength:2,minorTickPosition:"outside",minorTicksPerMajor:5,minPadding:.01,offset:void 0,reversed:void 0,reversedStacks:!1,showEmpty:!0,showFirstLabel:!0,showLastLabel:!0,startOfWeek:1,startOnTick:!1,tickLength:10,tickPixelInterval:100,tickmarkPlacement:"between",tickPosition:"outside",title:{align:"middle",useHTML:!1,x:0,y:0,style:{color:"#666666",fontSize:"0.8em"}},visible:!0,minorGridLineColor:"#f2f2f2",minorGridLineWidth:1,minorTickColor:"#999999",lineColor:"#333333",lineWidth:1,gridLineColor:"#e6e6e6",gridLineWidth:void 0,tickColor:"#333333"},Y.yAxis={reversedStacks:!0,endOnTick:!0,maxPadding:.05,minPadding:.05,tickPixelInterval:72,showLastLabel:!0,labels:{x:void 0},startOnTick:!0,title:{text:"Values"},stackLabels:{animation:{},allowOverlap:!1,enabled:!1,crop:!0,overflow:"justify",formatter:function(){let{numberFormatter:h}=this.axis.chart;return h(this.total||0,-1)},style:{color:"#000000",fontSize:"0.7em",fontWeight:"bold",textOutline:"1px contrast"}},gridLineWidth:1,lineWidth:0}}(r||(r={}));let _f=r,{addEvent:sp,isFunction:op,objectEach:Hm,removeEvent:yf}=Bi;(W||(W={})).registerEventOptions=function(Y,h){Y.eventOptions=Y.eventOptions||{},Hm(h.events,function(v,S){Y.eventOptions[S]!==v&&(Y.eventOptions[S]&&(yf(Y,S,Y.eventOptions[S]),delete Y.eventOptions[S]),op(v)&&(Y.eventOptions[S]=v,sp(Y,S,v,{order:0})))})};let Fa=W,{deg2rad:ap}=Ve,{clamp:vf,correctFloat:tu,defined:ac,destroyObjectProperties:xf,extend:Lo,fireEvent:wl,getAlignFactor:Qu,isNumber:lc,merge:Sl,objectEach:Wh,pick:Ro}=Bi,Zo=class{constructor(Y,h,v,S,D){this.isNew=!0,this.isNewLabel=!0,this.axis=Y,this.pos=h,this.type=v||"",this.parameters=D||{},this.tickmarkOffset=this.parameters.tickmarkOffset,this.options=this.parameters.options,wl(this,"init"),v||S||this.addLabel()}addLabel(){let Y=this,h=Y.axis,v=h.options,S=h.chart,D=h.categories,L=h.logarithmic,z=h.names,B=Y.pos,U=Ro(Y.options&&Y.options.labels,v.labels),X=h.tickPositions,te=B===X[0],K=B===X[X.length-1],re=(!U.step||U.step===1)&&h.tickInterval===1,ue=X.info,ge=Y.label,ye,be,_e,Fe=this.parameters.category||(D?Ro(D[B],z[B],B):B);L&&lc(Fe)&&(Fe=tu(L.lin2log(Fe))),h.dateTime&&(ue?ye=(be=S.time.resolveDTLFormat(v.dateTimeLabelFormats[!v.grid&&ue.higherRanks[B]||ue.unitName])).main:lc(Fe)&&(ye=h.dateTime.getXDateFormat(Fe,v.dateTimeLabelFormats||{}))),Y.isFirst=te,Y.isLast=K;let ze={axis:h,chart:S,dateTimeLabelFormat:ye,isFirst:te,isLast:K,pos:B,tick:Y,tickPositionInfo:ue,value:Fe};wl(this,"labelFormat",ze);let ft=Ot=>U.formatter?U.formatter.call(Ot,Ot):U.format?(Ot.text=h.defaultLabelFormatter.call(Ot),Po.format(U.format,Ot,S)):h.defaultLabelFormatter.call(Ot),St=ft.call(ze,ze),_t=be&&be.list;_t?Y.shortenLabel=function(){for(_e=0;_e<_t.length;_e++)if(Lo(ze,{dateTimeLabelFormat:_t[_e]}),ge.attr({text:ft.call(ze,ze)}),ge.getBBox().width<h.getSlotWidth(Y)-2*(U.padding||0))return;ge.attr({text:""})}:Y.shortenLabel=void 0,re&&h._addedPlotLB&&Y.moveLabel(St,U),ac(ge)||Y.movedLabel?ge&&ge.textStr!==St&&!re&&(!ge.textWidth||U.style.width||ge.styles.width||ge.css({width:null}),ge.attr({text:St}),ge.textPxLength=ge.getBBox().width):(Y.label=ge=Y.createLabel(St,U),Y.rotation=0)}createLabel(Y,h,v){let S=this.axis,{renderer:D,styledMode:L}=S.chart,z=ac(Y)&&h.enabled?D.text(Y,v==null?void 0:v.x,v==null?void 0:v.y,h.useHTML).add(S.labelGroup):void 0;if(z){let B=h.style.whiteSpace||"normal";L||z.css(Sl(h.style,{whiteSpace:"nowrap"})),z.textPxLength=z.getBBox().width,L||z.css({whiteSpace:B})}return z}destroy(){xf(this,this.axis)}getPosition(Y,h,v,S){let D=this.axis,L=D.chart,z=S&&L.oldChartHeight||L.chartHeight,B={x:Y?tu(D.translate(h+v,void 0,void 0,S)+D.transB):D.left+D.offset+(D.opposite?(S&&L.oldChartWidth||L.chartWidth)-D.right-D.left:0),y:Y?z-D.bottom+D.offset-(D.opposite?D.height:0):tu(z-D.translate(h+v,void 0,void 0,S)-D.transB)};return B.y=vf(B.y,-1e9,1e9),wl(this,"afterGetPosition",{pos:B}),B}getLabelPosition(Y,h,v,S,D,L,z,B){let U,X,te=this.axis,K=te.transA,re=te.isLinked&&te.linkedParent?te.linkedParent.reversed:te.reversed,ue=te.staggerLines,ge=te.tickRotCorr||{x:0,y:0},ye=S||te.reserveSpaceDefault?0:-te.labelOffset*(te.labelAlign==="center"?.5:1),be=D.distance,_e={};return U=te.side===0?v.rotation?-be:-v.getBBox().height:te.side===2?ge.y+be:Math.cos(v.rotation*ap)*(ge.y-v.getBBox(!1,0).height/2),ac(D.y)&&(U=te.side===0&&te.horiz?D.y+U:D.y),Y=Y+Ro(D.x,[0,1,0,-1][te.side]*be)+ye+ge.x-(L&&S?L*K*(re?-1:1):0),h=h+U-(L&&!S?L*K*(re?1:-1):0),ue&&(X=z/(B||1)%ue,te.opposite&&(X=ue-X-1),h+=X*(te.labelOffset/ue)),_e.x=Y,_e.y=Math.round(h),wl(this,"afterGetLabelPosition",{pos:_e,tickmarkOffset:L,index:z}),_e}getLabelSize(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0}getMarkPath(Y,h,v,S,D=!1,L){return L.crispLine([["M",Y,h],["L",Y+(D?0:-v),h+(D?v:0)]],S)}handleOverflow(Y){let h=this.axis,v=h.options.labels,S=Y.x,D=h.chart.chartWidth,L=h.chart.spacing,z=Ro(h.labelLeft,Math.min(h.pos,L[3])),B=Ro(h.labelRight,Math.max(h.isRadial?0:h.pos+h.len,D-L[1])),U=this.label,X=this.rotation,te=Qu(h.labelAlign||U.attr("align")),K=U.getBBox().width,re=h.getSlotWidth(this),ue=re,ge=1,ye,be,_e;X||v.overflow!=="justify"?X<0&&S-te*K<z?_e=Math.round(S/Math.cos(X*ap)-z):X>0&&S+te*K>B&&(_e=Math.round((D-S)/Math.cos(X*ap))):(ye=S-te*K,be=S+(1-te)*K,ye<z?ue=Y.x+ue*(1-te)-z:be>B&&(ue=B-Y.x+ue*te,ge=-1),(ue=Math.min(re,ue))<re&&h.labelAlign==="center"&&(Y.x+=ge*(re-ue-te*(re-Math.min(K,ue)))),(K>ue||h.autoRotation&&(U.styles||{}).width)&&(_e=ue)),_e&&U&&(this.shortenLabel?this.shortenLabel():U.css(Lo({},{width:Math.floor(_e)+"px",lineClamp:h.isRadial?0:1})))}moveLabel(Y,h){let v=this,S=v.label,D=v.axis,L=!1,z;S&&S.textStr===Y?(v.movedLabel=S,L=!0,delete v.label):Wh(D.ticks,function(B){L||B.isNew||B===v||!B.label||B.label.textStr!==Y||(v.movedLabel=B.label,L=!0,B.labelPos=v.movedLabel.xy,delete B.label)}),!L&&(v.labelPos||S)&&(z=v.labelPos||S.xy,v.movedLabel=v.createLabel(Y,h,z),v.movedLabel&&v.movedLabel.attr({opacity:0}))}render(Y,h,v){let S=this.axis,D=S.horiz,L=this.pos,z=Ro(this.tickmarkOffset,S.tickmarkOffset),B=this.getPosition(D,L,z,h),U=B.x,X=B.y,te=S.pos,K=te+S.len,re=D?U:X;!S.chart.polar&&this.isNew&&(tu(re)<te||re>K)&&(v=0);let ue=Ro(v,this.label&&this.label.newOpacity,1);v=Ro(v,1),this.isActive=!0,this.renderGridLine(h,v),this.renderMark(B,v),this.renderLabel(B,h,ue,Y),this.isNew=!1,wl(this,"afterRender")}renderGridLine(Y,h){let v=this.axis,S=v.options,D={},L=this.pos,z=this.type,B=Ro(this.tickmarkOffset,v.tickmarkOffset),U=v.chart.renderer,X=this.gridLine,te,K=S.gridLineWidth,re=S.gridLineColor,ue=S.gridLineDashStyle;this.type==="minor"&&(K=S.minorGridLineWidth,re=S.minorGridLineColor,ue=S.minorGridLineDashStyle),X||(v.chart.styledMode||(D.stroke=re,D["stroke-width"]=K||0,D.dashstyle=ue),z||(D.zIndex=1),Y&&(h=0),this.gridLine=X=U.path().attr(D).addClass("highcharts-"+(z?z+"-":"")+"grid-line").add(v.gridGroup)),X&&(te=v.getPlotLinePath({value:L+B,lineWidth:X.strokeWidth(),force:"pass",old:Y,acrossPanes:!1}))&&X[Y||this.isNew?"attr":"animate"]({d:te,opacity:h})}renderMark(Y,h){let v=this.axis,S=v.options,D=v.chart.renderer,L=this.type,z=v.tickSize(L?L+"Tick":"tick"),B=Y.x,U=Y.y,X=Ro(S[L!=="minor"?"tickWidth":"minorTickWidth"],!L&&v.isXAxis?1:0),te=S[L!=="minor"?"tickColor":"minorTickColor"],K=this.mark,re=!K;z&&(v.opposite&&(z[0]=-z[0]),K||(this.mark=K=D.path().addClass("highcharts-"+(L?L+"-":"")+"tick").add(v.axisGroup),v.chart.styledMode||K.attr({stroke:te,"stroke-width":X})),K[re?"attr":"animate"]({d:this.getMarkPath(B,U,z[0],K.strokeWidth(),v.horiz,D),opacity:h}))}renderLabel(Y,h,v,S){let D=this.axis,L=D.horiz,z=D.options,B=this.label,U=z.labels,X=U.step,te=Ro(this.tickmarkOffset,D.tickmarkOffset),K=Y.x,re=Y.y,ue=!0;B&&lc(K)&&(B.xy=Y=this.getLabelPosition(K,re,B,L,U,te,S,X),(!this.isFirst||this.isLast||z.showFirstLabel)&&(!this.isLast||this.isFirst||z.showLastLabel)?!L||U.step||U.rotation||h||v===0||this.handleOverflow(Y):ue=!1,X&&S%X&&(ue=!1),ue&&lc(Y.y)?(Y.opacity=v,B[this.isNewLabel?"attr":"animate"](Y).show(!0),this.isNewLabel=!1):(B.hide(),this.isNewLabel=!0))}replaceMovedLabel(){let Y=this.label,h=this.axis;Y&&!this.isNew&&(Y.animate({opacity:0},void 0,Y.destroy),delete this.label),h.isDirty=!0,this.label=this.movedLabel,delete this.movedLabel}},{animObject:iu}=se,{xAxis:ru,yAxis:eh}=_f,{defaultOptions:Xa}=zn,{registerEventOptions:cc}=Fa,{deg2rad:nu}=Ve,{arrayMax:su,arrayMin:qh,clamp:uc,correctFloat:Ls,defined:Yr,destroyObjectProperties:fr,erase:lp,error:Tl,extend:th,fireEvent:An,getClosestDistance:bf,insertItem:sn,isArray:Yh,isNumber:ir,isString:Xh,merge:ou,normalizeTickInterval:wf,objectEach:ih,pick:Or,relativeLength:Ml,removeEvent:rh,splat:Sf,syncTimeout:vo}=Bi,Zh=(Y,h)=>wf(h,void 0,void 0,Or(Y.options.allowDecimals,h<.5||Y.tickAmount!==void 0),!!Y.tickAmount);th(Xa,{xAxis:ru,yAxis:ou(ru,eh)});class Za{constructor(h,v,S){this.init(h,v,S)}init(h,v,S=this.coll){let D=S==="xAxis",L=this.isZAxis||(h.inverted?!D:D);this.chart=h,this.horiz=L,this.isXAxis=D,this.coll=S,An(this,"init",{userOptions:v}),this.opposite=Or(v.opposite,this.opposite),this.side=Or(v.side,this.side,L?this.opposite?0:2:this.opposite?1:3),this.setOptions(v);let z=this.options,B=z.labels;this.type??(this.type=z.type||"linear"),this.uniqueNames??(this.uniqueNames=z.uniqueNames??!0),An(this,"afterSetType"),this.userOptions=v,this.minPixelPadding=0,this.reversed=Or(z.reversed,this.reversed),this.visible=z.visible,this.zoomEnabled=z.zoomEnabled,this.hasNames=this.type==="category"||z.categories===!0,this.categories=Yh(z.categories)&&z.categories||(this.hasNames?[]:void 0),this.names||(this.names=[],this.names.keys={}),this.plotLinesAndBandsGroups={},this.positiveValuesOnly=!!this.logarithmic,this.isLinked=Yr(z.linkedTo),this.ticks={},this.labelEdge=[],this.minorTicks={},this.plotLinesAndBands=[],this.alternateBands={},this.len??(this.len=0),this.minRange=this.userMinRange=z.minRange||z.maxZoom,this.range=z.range,this.offset=z.offset||0,this.max=void 0,this.min=void 0;let U=Or(z.crosshair,Sf(h.options.tooltip.crosshairs)[D?0:1]);this.crosshair=U===!0?{}:U,h.axes.indexOf(this)===-1&&(D?h.axes.splice(h.xAxis.length,0,this):h.axes.push(this),sn(this,h[this.coll])),h.orderItems(this.coll),this.series=this.series||[],h.inverted&&!this.isZAxis&&D&&!Yr(this.reversed)&&(this.reversed=!0),this.labelRotation=ir(B.rotation)?B.rotation:void 0,cc(this,z),An(this,"afterInit")}setOptions(h){let v=this.horiz?{labels:{autoRotation:[-45],padding:3},margin:15}:{labels:{padding:1},title:{rotation:90*this.side}};this.options=ou(v,Xa[this.coll],h),An(this,"afterSetOptions",{userOptions:h})}defaultLabelFormatter(){let h=this.axis,{numberFormatter:v}=this.chart,S=ir(this.value)?this.value:NaN,D=h.chart.time,L=h.categories,z=this.dateTimeLabelFormat,B=Xa.lang,U=B.numericSymbols,X=B.numericSymbolMagnitude||1e3,te=h.logarithmic?Math.abs(S):h.tickInterval,K=U&&U.length,re,ue;if(L)ue=`${this.value}`;else if(z)ue=D.dateFormat(z,S,!0);else if(K&&U&&te>=1e3)for(;K--&&ue===void 0;)te>=(re=Math.pow(X,K+1))&&10*S%re==0&&U[K]!==null&&S!==0&&(ue=v(S/re,-1)+U[K]);return ue===void 0&&(ue=Math.abs(S)>=1e4?v(S,-1):v(S,-1,void 0,"")),ue}getSeriesExtremes(){let h,v=this;An(this,"getSeriesExtremes",null,function(){v.hasVisibleSeries=!1,v.dataMin=v.dataMax=v.threshold=void 0,v.softThreshold=!v.isXAxis,v.series.forEach(S=>{if(S.reserveSpace()){let D=S.options,L,z=D.threshold,B,U;if(v.hasVisibleSeries=!0,v.positiveValuesOnly&&0>=(z||0)&&(z=void 0),v.isXAxis)(L=S.getColumn("x")).length&&(L=v.logarithmic?L.filter(X=>X>0):L,B=(h=S.getXExtremes(L)).min,U=h.max,ir(B)||B instanceof Date||(L=L.filter(ir),B=(h=S.getXExtremes(L)).min,U=h.max),L.length&&(v.dataMin=Math.min(Or(v.dataMin,B),B),v.dataMax=Math.max(Or(v.dataMax,U),U)));else{let X=S.applyExtremes();ir(X.dataMin)&&(B=X.dataMin,v.dataMin=Math.min(Or(v.dataMin,B),B)),ir(X.dataMax)&&(U=X.dataMax,v.dataMax=Math.max(Or(v.dataMax,U),U)),Yr(z)&&(v.threshold=z),(!D.softThreshold||v.positiveValuesOnly)&&(v.softThreshold=!1)}}})}),An(this,"afterGetSeriesExtremes")}translate(h,v,S,D,L,z){var ye;let B=this.linkedParent||this,U=D&&B.old?B.old.min:B.min;if(!ir(U))return NaN;let X=B.minPixelPadding,te=(B.isOrdinal||((ye=B.brokenAxis)==null?void 0:ye.hasBreaks)||B.logarithmic&&L)&&B.lin2val,K=1,re=0,ue=D&&B.old?B.old.transA:B.transA,ge=0;return ue||(ue=B.transA),S&&(K*=-1,re=B.len),B.reversed&&(K*=-1,re-=K*(B.sector||B.len)),v?(ge=(h=h*K+re-X)/ue+U,te&&(ge=B.lin2val(ge))):(te&&(h=B.val2lin(h)),ge=K*(h-U)*ue+re+K*X+(ir(z)?ue*z:0),B.isRadial||(ge=Ls(ge))),ge}toPixels(h,v){var S;return this.translate(((S=this.chart)==null?void 0:S.time.parse(h))??NaN,!1,!this.horiz,void 0,!0)+(v?0:this.pos)}toValue(h,v){return this.translate(h-(v?0:this.pos),!0,!this.horiz,void 0,!0)}getPlotLinePath(h){let v=this,S=v.chart,D=v.left,L=v.top,z=h.old,B=h.value,U=h.lineWidth,X=z&&S.oldChartHeight||S.chartHeight,te=z&&S.oldChartWidth||S.chartWidth,K=v.transB,re=h.translatedValue,ue=h.force,ge,ye,be,_e,Fe;function ze(St,_t,Ot){return ue!=="pass"&&(St<_t||St>Ot)&&(ue?St=uc(St,_t,Ot):Fe=!0),St}let ft={value:B,lineWidth:U,old:z,force:ue,acrossPanes:h.acrossPanes,translatedValue:re};return An(this,"getPlotLinePath",ft,function(St){ge=be=(re=uc(re=Or(re,v.translate(B,void 0,void 0,z)),-1e9,1e9))+K,ye=_e=X-re-K,ir(re)?v.horiz?(ye=L,_e=X-v.bottom+(v.options.isInternal?0:S.scrollablePixelsY||0),ge=be=ze(ge,D,D+v.width)):(ge=D,be=te-v.right+(S.scrollablePixelsX||0),ye=_e=ze(ye,L,L+v.height)):(Fe=!0,ue=!1),St.path=Fe&&!ue?void 0:S.renderer.crispLine([["M",ge,ye],["L",be,_e]],U||1)}),ft.path}getLinearTickPositions(h,v,S){let D,L,z,B=Ls(Math.floor(v/h)*h),U=Ls(Math.ceil(S/h)*h),X=[];if(Ls(B+h)===B&&(z=20),this.single)return[v];for(D=B;D<=U&&(X.push(D),(D=Ls(D+h,z))!==L);)L=D;return X}getMinorTickInterval(){let{minorTicks:h,minorTickInterval:v}=this.options;return h===!0?Or(v,"auto"):h!==!1?v:void 0}getMinorTickPositions(){var te;let h=this.options,v=this.tickPositions,S=this.minorTickInterval,D=this.pointRangePadding||0,L=(this.min||0)-D,z=(this.max||0)+D,B=(te=this.brokenAxis)!=null&&te.hasBreaks?this.brokenAxis.unitLength:z-L,U=[],X;if(B&&B/S<this.len/3){let K=this.logarithmic;if(K)this.paddedTicks.forEach(function(re,ue,ge){ue&&U.push.apply(U,K.getLogTickPositions(S,ge[ue-1],ge[ue],!0))});else if(this.dateTime&&this.getMinorTickInterval()==="auto")U=U.concat(this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(S),L,z,h.startOfWeek));else for(X=L+(v[0]-L)%S;X<=z&&X!==U[0];X+=S)U.push(X)}return U.length!==0&&this.trimTicks(U),U}adjustForMinRange(){let h=this.options,v=this.logarithmic,S=this.chart.time,{max:D,min:L,minRange:z}=this,B,U,X,te;this.isXAxis&&z===void 0&&!v&&(z=Yr(h.min)||Yr(h.max)||Yr(h.floor)||Yr(h.ceiling)?null:Math.min(5*(bf(this.series.map(K=>{let re=K.getColumn("x");return K.xIncrement?re.slice(0,2):re}))||0),this.dataMax-this.dataMin)),ir(D)&&ir(L)&&ir(z)&&D-L<z&&(U=this.dataMax-this.dataMin>=z,B=(z-D+L)/2,X=[L-B,S.parse(h.min)??L-B],U&&(X[2]=v?v.log2lin(this.dataMin):this.dataMin),te=[(L=su(X))+z,S.parse(h.max)??L+z],U&&(te[2]=v?v.log2lin(this.dataMax):this.dataMax),(D=qh(te))-L<z&&(X[0]=D-z,X[1]=S.parse(h.min)??D-z,L=su(X))),this.minRange=z,this.min=L,this.max=D}getClosest(){let h,v;if(this.categories)v=1;else{let S=[];this.series.forEach(function(D){let L=D.closestPointRange,z=D.getColumn("x");z.length===1?S.push(z[0]):D.sorted&&Yr(L)&&D.reserveSpace()&&(v=Yr(v)?Math.min(v,L):L)}),S.length&&(S.sort((D,L)=>D-L),h=bf([S]))}return h&&v?Math.min(h,v):h||v}nameToX(h){let v=Yh(this.options.categories),S=v?this.categories:this.names,D=h.options.x,L;return h.series.requireSorting=!1,Yr(D)||(D=this.uniqueNames&&S?v?S.indexOf(h.name):Or(S.keys[h.name],-1):h.series.autoIncrement()),D===-1?!v&&S&&(L=S.length):ir(D)&&(L=D),L!==void 0?(this.names[L]=h.name,this.names.keys[h.name]=L):h.x&&(L=h.x),L}updateNames(){let h=this,v=this.names;v.length>0&&(Object.keys(v.keys).forEach(function(S){delete v.keys[S]}),v.length=0,this.minRange=this.userMinRange,(this.series||[]).forEach(S=>{S.xIncrement=null,(!S.points||S.isDirtyData)&&(h.max=Math.max(h.max||0,S.dataTable.rowCount-1),S.processData(),S.generatePoints());let D=S.getColumn("x").slice();S.data.forEach((L,z)=>{let B=D[z];L!=null&&L.options&&L.name!==void 0&&(B=h.nameToX(L))!==void 0&&B!==L.x&&(D[z]=L.x=B)}),S.dataTable.setColumn("x",D)}))}setAxisTranslation(){let h=this,v=h.max-h.min,S=h.linkedParent,D=!!h.categories,L=h.isXAxis,z=h.axisPointRange||0,B,U=0,X=0,te,K=h.transA;(L||D||z)&&(B=h.getClosest(),S?(U=S.minPointOffset,X=S.pointRangePadding):h.series.forEach(function(re){let ue=D?1:L?Or(re.options.pointRange,B,0):h.axisPointRange||0,ge=re.options.pointPlacement;if(z=Math.max(z,ue),!h.single||D){let ye=re.is("xrange")?!L:L;U=Math.max(U,ye&&Xh(ge)?0:ue/2),X=Math.max(X,ye&&ge==="on"?0:ue)}}),te=h.ordinal&&h.ordinal.slope&&B?h.ordinal.slope/B:1,h.minPointOffset=U*=te,h.pointRangePadding=X*=te,h.pointRange=Math.min(z,h.single&&D?1:v),L&&B&&(h.closestPointRange=B)),h.translationSlope=h.transA=K=h.staticScale||h.len/(v+X||1),h.transB=h.horiz?h.left:h.bottom,h.minPixelPadding=K*U,An(this,"afterSetAxisTranslation")}minFromRange(){let{max:h,min:v}=this;return ir(h)&&ir(v)&&h-v||void 0}setTickInterval(h){var Zi,kr,Gi,gr;let{categories:v,chart:S,dataMax:D,dataMin:L,dateTime:z,isXAxis:B,logarithmic:U,options:X,softThreshold:te}=this,K=S.time,re=ir(this.threshold)?this.threshold:void 0,ue=this.minRange||0,{ceiling:ge,floor:ye,linkedTo:be,softMax:_e,softMin:Fe}=X,ze=ir(be)&&((Zi=S[this.coll])==null?void 0:Zi[be]),ft=X.tickPixelInterval,St=X.maxPadding,_t=X.minPadding,Ot=0,Pt,Ft=ir(X.tickInterval)&&X.tickInterval>=0?X.tickInterval:void 0,di,gi,Ai,ai;if(z||v||ze||this.getTickAmount(),Ai=Or(this.userMin,K.parse(X.min)),ai=Or(this.userMax,K.parse(X.max)),ze?(this.linkedParent=ze,Pt=ze.getExtremes(),this.min=Or(Pt.min,Pt.dataMin),this.max=Or(Pt.max,Pt.dataMax),this.type!==ze.type&&Tl(11,!0,S)):(te&&Yr(re)&&ir(D)&&ir(L)&&(L>=re?(di=re,_t=0):D<=re&&(gi=re,St=0)),this.min=Or(Ai,di,L),this.max=Or(ai,gi,D)),ir(this.max)&&ir(this.min)&&(U&&(this.positiveValuesOnly&&!h&&0>=Math.min(this.min,Or(L,this.min))&&Tl(10,!0,S),this.min=Ls(U.log2lin(this.min),16),this.max=Ls(U.log2lin(this.max),16)),this.range&&ir(L)&&(this.userMin=this.min=Ai=Math.max(L,this.minFromRange()||0),this.userMax=ai=this.max,this.range=void 0)),An(this,"foundExtremes"),this.adjustForMinRange(),ir(this.min)&&ir(this.max)){if(!ir(this.userMin)&&ir(Fe)&&Fe<this.min&&(this.min=Ai=Fe),!ir(this.userMax)&&ir(_e)&&_e>this.max&&(this.max=ai=_e),v||this.axisPointRange||(kr=this.stacking)!=null&&kr.usePercentage||ze||!(Ot=this.max-this.min)||(!Yr(Ai)&&_t&&(this.min-=Ot*_t),Yr(ai)||!St||(this.max+=Ot*St)),!ir(this.userMin)&&ir(ye)&&(this.min=Math.max(this.min,ye)),!ir(this.userMax)&&ir(ge)&&(this.max=Math.min(this.max,ge)),te&&ir(L)&&ir(D)){let Vi=re||0;!Yr(Ai)&&this.min<Vi&&L>=Vi?this.min=X.minRange?Math.min(Vi,this.max-ue):Vi:!Yr(ai)&&this.max>Vi&&D<=Vi&&(this.max=X.minRange?Math.max(Vi,this.min+ue):Vi)}!S.polar&&this.min>this.max&&(Yr(X.min)?this.max=this.min:Yr(X.max)&&(this.min=this.max)),Ot=this.max-this.min}if(this.min!==this.max&&ir(this.min)&&ir(this.max)?ze&&!Ft&&ft===ze.options.tickPixelInterval?this.tickInterval=Ft=ze.tickInterval:this.tickInterval=Or(Ft,this.tickAmount?Ot/Math.max(this.tickAmount-1,1):void 0,v?1:Ot*ft/Math.max(this.len,ft)):this.tickInterval=1,B&&!h){let Vi=this.min!==((Gi=this.old)==null?void 0:Gi.min)||this.max!==((gr=this.old)==null?void 0:gr.max);this.series.forEach(function(Qi){var _r;Qi.forceCrop=(_r=Qi.forceCropping)==null?void 0:_r.call(Qi),Qi.processData(Vi)}),An(this,"postProcessData",{hasExtremesChanged:Vi})}this.setAxisTranslation(),An(this,"initialAxisTranslation"),this.pointRange&&!Ft&&(this.tickInterval=Math.max(this.pointRange,this.tickInterval));let Ei=Or(X.minTickInterval,z&&!this.series.some(Vi=>!Vi.sorted)?this.closestPointRange:0);!Ft&&this.tickInterval<Ei&&(this.tickInterval=Ei),z||U||Ft||(this.tickInterval=Zh(this,this.tickInterval)),this.tickAmount||(this.tickInterval=this.unsquish()),this.setTickPositions()}setTickPositions(){var te,K;let h=this.options,v=h.tickPositions,S=h.tickPositioner,D=this.getMinorTickInterval(),L=!this.isPanning,z=L&&h.startOnTick,B=L&&h.endOnTick,U=[],X;if(this.tickmarkOffset=this.categories&&h.tickmarkPlacement==="between"&&this.tickInterval===1?.5:0,this.single=this.min===this.max&&Yr(this.min)&&!this.tickAmount&&(this.min%1==0||h.allowDecimals!==!1),v)U=v.slice();else if(ir(this.min)&&ir(this.max)){if(!((te=this.ordinal)!=null&&te.positions)&&(this.max-this.min)/this.tickInterval>Math.max(2*this.len,200))U=[this.min,this.max],Tl(19,!1,this.chart);else if(this.dateTime)U=this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(this.tickInterval,h.units),this.min,this.max,h.startOfWeek,(K=this.ordinal)==null?void 0:K.positions,this.closestPointRange,!0);else if(this.logarithmic)U=this.logarithmic.getLogTickPositions(this.tickInterval,this.min,this.max);else{let re=this.tickInterval,ue=re;for(;ue<=2*re&&(U=this.getLinearTickPositions(this.tickInterval,this.min,this.max),this.tickAmount&&U.length>this.tickAmount);)this.tickInterval=Zh(this,ue*=1.1)}U.length>this.len&&(U=[U[0],U[U.length-1]])[0]===U[1]&&(U.length=1),S&&(this.tickPositions=U,(X=S.apply(this,[this.min,this.max]))&&(U=X))}this.tickPositions=U,this.minorTickInterval=D==="auto"&&this.tickInterval?this.tickInterval/h.minorTicksPerMajor:D,this.paddedTicks=U.slice(0),this.trimTicks(U,z,B),!this.isLinked&&ir(this.min)&&ir(this.max)&&(this.single&&U.length<2&&!this.categories&&!this.series.some(re=>re.is("heatmap")&&re.options.pointPlacement==="between")&&(this.min-=.5,this.max+=.5),v||X||this.adjustTickAmount()),An(this,"afterSetTickPositions")}trimTicks(h,v,S){let D=h[0],L=h[h.length-1],z=!this.isOrdinal&&this.minPointOffset||0;if(An(this,"trimTicks"),!this.isLinked){if(v&&D!==-1/0)this.min=D;else for(;this.min-z>h[0];)h.shift();if(S)this.max=L;else for(;this.max+z<h[h.length-1];)h.pop();h.length===0&&Yr(D)&&!this.options.tickPositions&&h.push((L+D)/2)}}alignToOthers(){let h,v=this,S=v.chart,D=[this],L=v.options,z=S.options.chart,B=this.coll==="yAxis"&&z.alignThresholds,U=[];if(v.thresholdAlignment=void 0,(z.alignTicks!==!1&&L.alignTicks||B)&&L.startOnTick!==!1&&L.endOnTick!==!1&&!v.logarithmic){let X=K=>{let{horiz:re,options:ue}=K;return[re?ue.left:ue.top,ue.width,ue.height,ue.pane].join(",")},te=X(this);S[this.coll].forEach(function(K){let{series:re}=K;re.length&&re.some(ue=>ue.visible)&&K!==v&&X(K)===te&&(h=!0,D.push(K))})}if(h&&B){D.forEach(te=>{let K=te.getThresholdAlignment(v);ir(K)&&U.push(K)});let X=U.length>1?U.reduce((te,K)=>te+=K,0)/U.length:void 0;D.forEach(te=>{te.thresholdAlignment=X})}return h}getThresholdAlignment(h){if((!ir(this.dataMin)||this!==h&&this.series.some(v=>v.isDirty||v.isDirtyData))&&this.getSeriesExtremes(),ir(this.threshold)){let v=uc((this.threshold-(this.dataMin||0))/((this.dataMax||0)-(this.dataMin||0)),0,1);return this.options.reversed&&(v=1-v),v}}getTickAmount(){let h=this.options,v=h.tickPixelInterval,S=h.tickAmount;Yr(h.tickInterval)||S||!(this.len<v)||this.isRadial||this.logarithmic||!h.startOnTick||!h.endOnTick||(S=2),!S&&this.alignToOthers()&&(S=Math.ceil(this.len/v)+1),S<4&&(this.finalTickAmt=S,S=5),this.tickAmount=S}adjustTickAmount(){let h=this,{finalTickAmt:v,max:S,min:D,options:L,tickPositions:z,tickAmount:B,thresholdAlignment:U}=h,X=z==null?void 0:z.length,te=Or(h.threshold,h.softThreshold?0:null),K,re,ue=h.tickInterval,ge,ye=()=>z.push(Ls(z[z.length-1]+ue)),be=()=>z.unshift(Ls(z[0]-ue));if(ir(U)&&(ge=U<.5?Math.ceil(U*(B-1)):Math.floor(U*(B-1)),L.reversed&&(ge=B-1-ge)),h.hasData()&&ir(D)&&ir(S)){let _e=()=>{h.transA*=(X-1)/(B-1),h.min=L.startOnTick?z[0]:Math.min(D,z[0]),h.max=L.endOnTick?z[z.length-1]:Math.max(S,z[z.length-1])};if(ir(ge)&&ir(h.threshold)){for(;z[ge]!==te||z.length!==B||z[0]>D||z[z.length-1]<S;){for(z.length=0,z.push(h.threshold);z.length<B;)z[ge]===void 0||z[ge]>h.threshold?be():ye();if(ue>8*h.tickInterval)break;ue*=2}_e()}else if(X<B){for(;z.length<B;)z.length%2||D===te?ye():be();_e()}if(Yr(v)){for(re=K=z.length;re--;)(v===3&&re%2==1||v<=2&&re>0&&re<K-1)&&z.splice(re,1);h.finalTickAmt=void 0}}}setScale(){var z,B;let{coll:h,stacking:v}=this,S=!1,D=!1;this.series.forEach(U=>{S=S||U.isDirtyData||U.isDirty,D=D||U.xAxis&&U.xAxis.isDirty||!1}),this.setAxisSize();let L=this.len!==(this.old&&this.old.len);L||S||D||this.isLinked||this.forceRedraw||this.userMin!==(this.old&&this.old.userMin)||this.userMax!==(this.old&&this.old.userMax)||this.alignToOthers()?(v&&h==="yAxis"&&v.buildStacks(),this.forceRedraw=!1,this.userMinRange||(this.minRange=void 0),this.getSeriesExtremes(),this.setTickInterval(),v&&h==="xAxis"&&v.buildStacks(),this.isDirty||(this.isDirty=L||this.min!==((z=this.old)==null?void 0:z.min)||this.max!==((B=this.old)==null?void 0:B.max))):v&&v.cleanStacks(),S&&delete this.allExtremes,An(this,"afterSetScale")}setExtremes(h,v,S=!0,D,L){let z=this.chart;this.series.forEach(B=>{delete B.kdTree}),h=z.time.parse(h),v=z.time.parse(v),An(this,"setExtremes",L=th(L,{min:h,max:v}),B=>{this.userMin=B.min,this.userMax=B.max,this.eventArgs=B,S&&z.redraw(D)})}setAxisSize(){let h=this.chart,v=this.options,S=v.offsets||[0,0,0,0],D=this.horiz,L=this.width=Math.round(Ml(Or(v.width,h.plotWidth-S[3]+S[1]),h.plotWidth)),z=this.height=Math.round(Ml(Or(v.height,h.plotHeight-S[0]+S[2]),h.plotHeight)),B=this.top=Math.round(Ml(Or(v.top,h.plotTop+S[0]),h.plotHeight,h.plotTop)),U=this.left=Math.round(Ml(Or(v.left,h.plotLeft+S[3]),h.plotWidth,h.plotLeft));this.bottom=h.chartHeight-z-B,this.right=h.chartWidth-L-U,this.len=Math.max(D?L:z,0),this.pos=D?U:B}getExtremes(){let h=this.logarithmic;return{min:h?Ls(h.lin2log(this.min)):this.min,max:h?Ls(h.lin2log(this.max)):this.max,dataMin:this.dataMin,dataMax:this.dataMax,userMin:this.userMin,userMax:this.userMax}}getThreshold(h){let v=this.logarithmic,S=v?v.lin2log(this.min):this.min,D=v?v.lin2log(this.max):this.max;return h===null||h===-1/0?h=S:h===1/0?h=D:S>h?h=S:D<h&&(h=D),this.translate(h,0,1,0,1)}autoLabelAlign(h){let v=(Or(h,0)-90*this.side+720)%360,S={align:"center"};return An(this,"autoLabelAlign",S,function(D){v>15&&v<165?D.align="right":v>195&&v<345&&(D.align="left")}),S.align}tickSize(h){let v=this.options,S=Or(v[h==="tick"?"tickWidth":"minorTickWidth"],h==="tick"&&this.isXAxis&&!this.categories?1:0),D=v[h==="tick"?"tickLength":"minorTickLength"],L;S&&D&&(v[h+"Position"]==="inside"&&(D=-D),L=[D,S]);let z={tickSize:L};return An(this,"afterTickSize",z),z.tickSize}labelMetrics(){let h=this.chart.renderer,v=this.ticks,S=v[Object.keys(v)[0]]||{};return this.chart.renderer.fontMetrics(S.label||S.movedLabel||h.box)}unsquish(){let h=this.options.labels,v=h.padding||0,S=this.horiz,D=this.tickInterval,L=this.len/(((this.categories?1:0)+this.max-this.min)/D),z=h.rotation,B=Ls(.8*this.labelMetrics().h),U=Math.max(this.max-this.min,0),X=function(ge){let ye=(ge+2*v)/(L||1);return(ye=ye>1?Math.ceil(ye):1)*D>U&&ge!==1/0&&L!==1/0&&U&&(ye=Math.ceil(U/D)),Ls(ye*D)},te=D,K,re=Number.MAX_VALUE,ue;if(S){if(!h.staggerLines&&(ir(z)?ue=[z]:L<h.autoRotationLimit&&(ue=h.autoRotation)),ue){let ge,ye;for(let be of ue)(be===z||be&&be>=-90&&be<=90)&&(ye=(ge=X(Math.abs(B/Math.sin(nu*be))))+Math.abs(be/360))<re&&(re=ye,K=be,te=ge)}}else te=X(.75*B);return this.autoRotation=ue,this.labelRotation=Or(K,ir(z)?z:0),h.step?D:te}getSlotWidth(h){let v=this.chart,S=this.horiz,D=this.options.labels,L=Math.max(this.tickPositions.length-(this.categories?0:1),1),z=v.margin[3];if(h&&ir(h.slotWidth))return h.slotWidth;if(S&&D.step<2&&!this.isRadial)return D.rotation?0:(this.staggerLines||1)*this.len/L;if(!S){let B=D.style.width;if(B!==void 0)return parseInt(String(B),10);if(z)return z-v.spacing[3]}return .33*v.chartWidth}renderUnsquish(){let h=this.chart,v=h.renderer,S=this.tickPositions,D=this.ticks,L=this.options.labels,z=L.style,B=this.horiz,U=this.getSlotWidth(),X=Math.max(1,Math.round(U-(B?2*(L.padding||0):L.distance||0))),te={},K=this.labelMetrics(),re=z.lineClamp,ue,ge=re??(Math.floor(this.len/(S.length*K.h))||1),ye=0;Xh(L.rotation)||(te.rotation=L.rotation||0),S.forEach(function(be){var ze;let _e=D[be];_e.movedLabel&&_e.replaceMovedLabel();let Fe=((ze=_e.label)==null?void 0:ze.textPxLength)||0;Fe>ye&&(ye=Fe)}),this.maxLabelLength=ye,this.autoRotation?ye>X&&ye>K.h?te.rotation=this.labelRotation:this.labelRotation=0:U&&(ue=X),te.rotation&&(ue=ye>.5*h.chartHeight?.33*h.chartHeight:ye,re||(ge=1)),this.labelAlign=L.align||this.autoLabelAlign(this.labelRotation),this.labelAlign&&(te.align=this.labelAlign),S.forEach(function(be){let _e=D[be],Fe=_e&&_e.label,ze=z.width,ft={};Fe&&(Fe.attr(te),_e.shortenLabel?_e.shortenLabel():ue&&!ze&&z.whiteSpace!=="nowrap"&&(ue<(Fe.textPxLength||0)||Fe.element.tagName==="SPAN")?Fe.css(th(ft,{width:`${ue}px`,lineClamp:ge})):!Fe.styles.width||ft.width||ze||Fe.css({width:"auto"}),_e.rotation=te.rotation)},this),this.tickRotCorr=v.rotCorr(K.b,this.labelRotation||0,this.side!==0)}hasData(){return this.series.some(function(h){return h.hasData()})||this.options.showEmpty&&Yr(this.min)&&Yr(this.max)}addTitle(h){let v,S=this.chart.renderer,D=this.horiz,L=this.opposite,z=this.options.title,B=this.chart.styledMode;this.axisTitle||((v=z.textAlign)||(v=(D?{low:"left",middle:"center",high:"right"}:{low:L?"right":"left",middle:"center",high:L?"left":"right"})[z.align]),this.axisTitle=S.text(z.text||"",0,0,z.useHTML).attr({zIndex:7,rotation:z.rotation||0,align:v}).addClass("highcharts-axis-title"),B||this.axisTitle.css(ou(z.style)),this.axisTitle.add(this.axisGroup),this.axisTitle.isNew=!0),B||z.style.width||this.isRadial||this.axisTitle.css({width:this.len+"px"}),this.axisTitle[h?"show":"hide"](h)}generateTick(h){let v=this.ticks;v[h]?v[h].addLabel():v[h]=new Zo(this,h)}createGroups(){let{axisParent:h,chart:v,coll:S,options:D}=this,L=v.renderer,z=(B,U,X)=>L.g(B).attr({zIndex:X}).addClass(`highcharts-${S.toLowerCase()}${U} `+(this.isRadial?`highcharts-radial-axis${U} `:"")+(D.className||"")).add(h);this.axisGroup||(this.gridGroup=z("grid","-grid",D.gridZIndex),this.axisGroup=z("axis","",D.zIndex),this.labelGroup=z("axis-labels","-labels",D.labels.zIndex))}getOffset(){let h=this,{chart:v,horiz:S,options:D,side:L,ticks:z,tickPositions:B,coll:U}=h,X=v.inverted&&!h.isZAxis?[1,0,3,2][L]:L,te=h.hasData(),K=D.title,re=D.labels,ue=ir(D.crossing),ge=v.axisOffset,ye=v.clipOffset,be=[-1,1,1,-1][L],_e,Fe=0,ze,ft=0,St=0,_t,Ot;if(h.showAxis=_e=te||D.showEmpty,h.staggerLines=h.horiz&&re.staggerLines||void 0,h.createGroups(),te||h.isLinked?(B.forEach(function(Pt){h.generateTick(Pt)}),h.renderUnsquish(),h.reserveSpaceDefault=L===0||L===2||{1:"left",3:"right"}[L]===h.labelAlign,Or(re.reserveSpace,!ue&&null,h.labelAlign==="center"||null,h.reserveSpaceDefault)&&B.forEach(function(Pt){St=Math.max(z[Pt].getLabelSize(),St)}),h.staggerLines&&(St*=h.staggerLines),h.labelOffset=St*(h.opposite?-1:1)):ih(z,function(Pt,Ft){Pt.destroy(),delete z[Ft]}),K!=null&&K.text&&K.enabled!==!1&&(h.addTitle(_e),_e&&!ue&&K.reserveSpace!==!1&&(h.titleOffset=Fe=h.axisTitle.getBBox()[S?"height":"width"],ft=Yr(ze=K.offset)?0:Or(K.margin,S?5:10))),h.renderLine(),h.offset=be*Or(D.offset,ge[L]?ge[L]+(D.margin||0):0),h.tickRotCorr=h.tickRotCorr||{x:0,y:0},Ot=L===0?-h.labelMetrics().h:L===2?h.tickRotCorr.y:0,_t=Math.abs(St)+ft,St&&(_t-=Ot,_t+=be*(S?Or(re.y,h.tickRotCorr.y+be*re.distance):Or(re.x,be*re.distance))),h.axisTitleMargin=Or(ze,_t),h.getMaxLabelDimensions&&(h.maxLabelDimensions=h.getMaxLabelDimensions(z,B)),U!=="colorAxis"&&ye){let Pt=this.tickSize("tick");ge[L]=Math.max(ge[L],(h.axisTitleMargin||0)+Fe+be*h.offset,_t,B&&B.length&&Pt?Pt[0]+be*h.offset:0);let Ft=!h.axisLine||D.offset?0:h.axisLine.strokeWidth()/2;ye[X]=Math.max(ye[X],Ft)}An(this,"afterGetOffset")}getLinePath(h){let v=this.chart,S=this.opposite,D=this.offset,L=this.horiz,z=this.left+(S?this.width:0)+D,B=v.chartHeight-this.bottom-(S?this.height:0)+D;return S&&(h*=-1),v.renderer.crispLine([["M",L?this.left:z,L?B:this.top],["L",L?v.chartWidth-this.right:z,L?B:v.chartHeight-this.bottom]],h)}renderLine(){this.axisLine||(this.axisLine=this.chart.renderer.path().addClass("highcharts-axis-line").add(this.axisGroup),this.chart.styledMode||this.axisLine.attr({stroke:this.options.lineColor,"stroke-width":this.options.lineWidth,zIndex:7}))}getTitlePosition(h){let v=this.horiz,S=this.left,D=this.top,L=this.len,z=this.options.title,B=v?S:D,U=this.opposite,X=this.offset,te=z.x,K=z.y,re=this.chart.renderer.fontMetrics(h),ue=h?Math.max(h.getBBox(!1,0).height-re.h-1,0):0,ge={low:B+(v?0:L),middle:B+L/2,high:B+(v?L:0)}[z.align],ye=(v?D+this.height:S)+(v?1:-1)*(U?-1:1)*(this.axisTitleMargin||0)+[-ue,ue,re.f,-ue][this.side],be={x:v?ge+te:ye+(U?this.width:0)+X+te,y:v?ye+K-(U?this.height:0)+X:ge+K};return An(this,"afterGetTitlePosition",{titlePosition:be}),be}renderMinorTick(h,v){let S=this.minorTicks;S[h]||(S[h]=new Zo(this,h,"minor")),v&&S[h].isNew&&S[h].render(null,!0),S[h].render(null,!1,1)}renderTick(h,v,S){let D=this.isLinked,L=this.ticks;(!D||h>=this.min&&h<=this.max||this.grid&&this.grid.isColumn)&&(L[h]||(L[h]=new Zo(this,h)),S&&L[h].isNew&&L[h].render(v,!0,-1),L[h].render(v))}render(){let h,v,S=this,D=S.chart,L=S.logarithmic,z=D.renderer,B=S.options,U=S.isLinked,X=S.tickPositions,te=S.axisTitle,K=S.ticks,re=S.minorTicks,ue=S.alternateBands,ge=B.stackLabels,ye=B.alternateGridColor,be=B.crossing,_e=S.tickmarkOffset,Fe=S.axisLine,ze=S.showAxis,ft=iu(z.globalAnimation);if(S.labelEdge.length=0,S.overlap=!1,[K,re,ue].forEach(function(St){ih(St,function(_t){_t.isActive=!1})}),ir(be)){let St=this.isXAxis?D.yAxis[0]:D.xAxis[0],_t=[1,-1,-1,1][this.side];if(St){let Ot=St.toPixels(be,!0);S.horiz&&(Ot=St.len-Ot),S.offset=_t*Ot}}if(S.hasData()||U){let St=S.chart.hasRendered&&S.old&&ir(S.old.min);S.minorTickInterval&&!S.categories&&S.getMinorTickPositions().forEach(function(_t){S.renderMinorTick(_t,St)}),X.length&&(X.forEach(function(_t,Ot){S.renderTick(_t,Ot,St)}),_e&&(S.min===0||S.single)&&(K[-1]||(K[-1]=new Zo(S,-1,null,!0)),K[-1].render(-1))),ye&&X.forEach(function(_t,Ot){v=X[Ot+1]!==void 0?X[Ot+1]+_e:S.max-_e,Ot%2==0&&_t<S.max&&v<=S.max+(D.polar?-_e:_e)&&(ue[_t]||(ue[_t]=new Ve.PlotLineOrBand(S,{})),h=_t+_e,ue[_t].options={from:L?L.lin2log(h):h,to:L?L.lin2log(v):v,color:ye,className:"highcharts-alternate-grid"},ue[_t].render(),ue[_t].isActive=!0)}),S._addedPlotLB||(S._addedPlotLB=!0,(B.plotLines||[]).concat(B.plotBands||[]).forEach(function(_t){S.addPlotBandOrLine(_t)}))}[K,re,ue].forEach(function(St){let _t=[],Ot=ft.duration;ih(St,function(Pt,Ft){Pt.isActive||(Pt.render(Ft,!1,0),Pt.isActive=!1,_t.push(Ft))}),vo(function(){let Pt=_t.length;for(;Pt--;)St[_t[Pt]]&&!St[_t[Pt]].isActive&&(St[_t[Pt]].destroy(),delete St[_t[Pt]])},St!==ue&&D.hasRendered&&Ot?Ot:0)}),Fe&&(Fe[Fe.isPlaced?"animate":"attr"]({d:this.getLinePath(Fe.strokeWidth())}),Fe.isPlaced=!0,Fe[ze?"show":"hide"](ze)),te&&ze&&(te[te.isNew?"attr":"animate"](S.getTitlePosition(te)),te.isNew=!1),ge&&ge.enabled&&S.stacking&&S.stacking.renderStackTotals(),S.old={len:S.len,max:S.max,min:S.min,transA:S.transA,userMax:S.userMax,userMin:S.userMin},S.isDirty=!1,An(this,"afterRender")}redraw(){this.visible&&(this.render(),this.plotLinesAndBands.forEach(function(h){h.render()})),this.series.forEach(function(h){h.isDirty=!0})}getKeepProps(){return this.keepProps||Za.keepProps}destroy(h){let v=this,S=v.plotLinesAndBands,D=this.eventOptions;if(An(this,"destroy",{keepEvents:h}),h||rh(v),[v.ticks,v.minorTicks,v.alternateBands].forEach(function(L){fr(L)}),S){let L=S.length;for(;L--;)S[L].destroy()}for(let L in["axisLine","axisTitle","axisGroup","gridGroup","labelGroup","cross","scrollbar"].forEach(function(z){v[z]&&(v[z]=v[z].destroy())}),v.plotLinesAndBandsGroups)v.plotLinesAndBandsGroups[L]=v.plotLinesAndBandsGroups[L].destroy();ih(v,function(L,z){v.getKeepProps().indexOf(z)===-1&&delete v[z]}),this.eventOptions=D}drawCrosshair(h,v){let S=this.crosshair,D=Or(S&&S.snap,!0),L=this.chart,z,B,U,X=this.cross,te;if(An(this,"drawCrosshair",{e:h,point:v}),h||(h=this.cross&&this.cross.e),S&&(Yr(v)||!D)!==!1){if(D?Yr(v)&&(B=Or(this.coll!=="colorAxis"?v.crosshairPos:null,this.isXAxis?v.plotX:this.len-v.plotY)):B=h&&(this.horiz?h.chartX-this.pos:this.len-h.chartY+this.pos),Yr(B)&&(te={value:v&&(this.isXAxis?v.x:Or(v.stackY,v.y)),translatedValue:B},L.polar&&th(te,{isCrosshair:!0,chartX:h&&h.chartX,chartY:h&&h.chartY,point:v}),z=this.getPlotLinePath(te)||null),!Yr(z)){this.hideCrosshair();return}U=this.categories&&!this.isRadial,X||(this.cross=X=L.renderer.path().addClass("highcharts-crosshair highcharts-crosshair-"+(U?"category ":"thin ")+(S.className||"")).attr({zIndex:Or(S.zIndex,2)}).add(),!L.styledMode&&(X.attr({stroke:S.color||(U?Jr.parse("#ccd3ff").setOpacity(.25).get():"#cccccc"),"stroke-width":Or(S.width,1)}).css({"pointer-events":"none"}),S.dashStyle&&X.attr({dashstyle:S.dashStyle}))),X.show().attr({d:z}),U&&!S.width&&X.attr({"stroke-width":this.transA}),this.cross.e=h}else this.hideCrosshair();An(this,"afterDrawCrosshair",{e:h,point:v})}hideCrosshair(){this.cross&&this.cross.hide(),An(this,"afterHideCrosshair")}update(h,v){let S=this.chart;h=ou(this.userOptions,h),this.destroy(!0),this.init(S,h),S.isDirtyBox=!0,Or(v,!0)&&S.redraw()}remove(h){let v=this.chart,S=this.coll,D=this.series,L=D.length;for(;L--;)D[L]&&D[L].remove(!1);lp(v.axes,this),lp(v[S]||[],this),v.orderItems(S),this.destroy(),v.isDirtyBox=!0,Or(h,!0)&&v.redraw()}setTitle(h,v){this.update({title:h},v)}setCategories(h,v){this.update({categories:h},v)}}Za.keepProps=["coll","extKey","hcEvents","len","names","series","userMax","userMin"];let{addEvent:Kh,getMagnitude:cp,normalizeTickInterval:up,timeUnits:hc}=Bi;(function(Y){function h(){return this.chart.time.getTimeTicks.apply(this.chart.time,arguments)}function v(){if(this.type!=="datetime"){this.dateTime=void 0;return}this.dateTime||(this.dateTime=new S(this))}Y.compose=function(D){return D.keepProps.includes("dateTime")||(D.keepProps.push("dateTime"),D.prototype.getTimeTicks=h,Kh(D,"afterSetType",v)),D};class S{constructor(L){this.axis=L}normalizeTimeTickInterval(L,z){let B=z||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]],U=B[B.length-1],X=hc[U[0]],te=U[1],K;for(K=0;K<B.length&&(X=hc[(U=B[K])[0]],te=U[1],!B[K+1]||!(L<=(X*te[te.length-1]+hc[B[K+1][0]])/2));K++);X===hc.year&&L<5*X&&(te=[1,2,5]);let re=up(L/X,te,U[0]==="year"?Math.max(cp(L/X),1):1);return{unitRange:X,count:re,unitName:U[0]}}getXDateFormat(L,z){let{axis:B}=this,U=B.chart.time;return B.closestPointRange?U.getDateFormat(B.closestPointRange,L,B.options.startOfWeek,z)||U.resolveDTLFormat(z.year).main:U.resolveDTLFormat(z.day).main}}Y.Additions=S})(ie||(ie={}));let hp=ie,{addEvent:Jh,normalizeTickInterval:Qh,pick:Tf}=Bi;(function(Y){function h(){this.type!=="logarithmic"?this.logarithmic=void 0:this.logarithmic??(this.logarithmic=new S(this))}function v(){let D=this.logarithmic;D&&(this.lin2val=function(L){return D.lin2log(L)},this.val2lin=function(L){return D.log2lin(L)})}Y.compose=function(D){return D.keepProps.includes("logarithmic")||(D.keepProps.push("logarithmic"),Jh(D,"afterSetType",h),Jh(D,"afterInit",v)),D};class S{constructor(L){this.axis=L}getLogTickPositions(L,z,B,U){let X=this.axis,te=X.len,K=X.options,re=[];if(U||(this.minorAutoInterval=void 0),L>=.5)L=Math.round(L),re=X.getLinearTickPositions(L,z,B);else if(L>=.08){let ue,ge,ye,be,_e,Fe,ze,ft=Math.floor(z);for(ue=L>.3?[1,2,4]:L>.15?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9],ge=ft;ge<B+1&&!ze;ge++)for(ye=0,be=ue.length;ye<be&&!ze;ye++)(_e=this.log2lin(this.lin2log(ge)*ue[ye]))>z&&(!U||Fe<=B)&&Fe!==void 0&&re.push(Fe),Fe>B&&(ze=!0),Fe=_e}else{let ue=this.lin2log(z),ge=this.lin2log(B),ye=U?X.getMinorTickInterval():K.tickInterval,be=K.tickPixelInterval/(U?5:1),_e=U?te/X.tickPositions.length:te;L=Qh(L=Tf(ye==="auto"?null:ye,this.minorAutoInterval,(ge-ue)*be/(_e||1))),re=X.getLinearTickPositions(L,ue,ge).map(this.log2lin),U||(this.minorAutoInterval=L/5)}return U||(X.tickInterval=L),re}lin2log(L){return Math.pow(10,L)}log2lin(L){return Math.log(L)/Math.LN10}}Y.Additions=S})(oe||(oe={}));let Mf=oe,{erase:au,extend:Gm,isNumber:Cf}=Bi;(function(Y){let h;function v(X){return this.addPlotBandOrLine(X,"plotBands")}function S(X,te){let K=this.userOptions,re=new h(this,X);if(this.visible&&(re=re.render()),re){if(this._addedPlotLB||(this._addedPlotLB=!0,(K.plotLines||[]).concat(K.plotBands||[]).forEach(ue=>{this.addPlotBandOrLine(ue)})),te){let ue=K[te]||[];ue.push(X),K[te]=ue}this.plotLinesAndBands.push(re)}return re}function D(X){return this.addPlotBandOrLine(X,"plotLines")}function L(X,te,K){K=K||this.options;let re=this.getPlotLinePath({value:te,force:!0,acrossPanes:K.acrossPanes}),ue=[],ge=this.horiz,ye=!Cf(this.min)||!Cf(this.max)||X<this.min&&te<this.min||X>this.max&&te>this.max,be=this.getPlotLinePath({value:X,force:!0,acrossPanes:K.acrossPanes}),_e,Fe=1,ze;if(be&&re)for(ye&&(ze=be.toString()===re.toString(),Fe=0),_e=0;_e<be.length;_e+=2){let ft=be[_e],St=be[_e+1],_t=re[_e],Ot=re[_e+1];(ft[0]==="M"||ft[0]==="L")&&(St[0]==="M"||St[0]==="L")&&(_t[0]==="M"||_t[0]==="L")&&(Ot[0]==="M"||Ot[0]==="L")&&(ge&&_t[1]===ft[1]?(_t[1]+=Fe,Ot[1]+=Fe):ge||_t[2]!==ft[2]||(_t[2]+=Fe,Ot[2]+=Fe),ue.push(["M",ft[1],ft[2]],["L",St[1],St[2]],["L",Ot[1],Ot[2]],["L",_t[1],_t[2]],["Z"])),ue.isFlat=ze}return ue}function z(X){this.removePlotBandOrLine(X)}function B(X){let te=this.plotLinesAndBands,K=this.options,re=this.userOptions;if(te){let ue=te.length;for(;ue--;)te[ue].id===X&&te[ue].destroy();[K.plotLines||[],re.plotLines||[],K.plotBands||[],re.plotBands||[]].forEach(function(ge){for(ue=ge.length;ue--;)(ge[ue]||{}).id===X&&au(ge,ge[ue])})}}function U(X){this.removePlotBandOrLine(X)}Y.compose=function(X,te){let K=te.prototype;return K.addPlotBand||(h=X,Gm(K,{addPlotBand:v,addPlotLine:D,addPlotBandOrLine:S,getPlotBandPath:L,removePlotBand:z,removePlotLine:U,removePlotBandOrLine:B})),te}})(he||(he={}));let Wm=he,{addEvent:qm,arrayMax:Ef,arrayMin:Af,defined:Ko,destroyObjectProperties:dp,erase:ed,fireEvent:lu,merge:td,objectEach:Pf,pick:Df}=Bi;class cu{static compose(h,v){return qm(h,"afterInit",function(){this.labelCollectors.push(()=>{var D;let S=[];for(let L of this.axes)for(let{label:z,options:B}of L.plotLinesAndBands)z&&!((D=B==null?void 0:B.label)!=null&&D.allowOverlap)&&S.push(z);return S})}),Wm.compose(cu,v)}constructor(h,v){this.axis=h,this.options=v,this.id=v.id}render(){lu(this,"render");let{axis:h,options:v}=this,{horiz:S,logarithmic:D}=h,{color:L,events:z,zIndex:B=0}=v,{renderer:U,time:X}=h.chart,te={},K=X.parse(v.to),re=X.parse(v.from),ue=X.parse(v.value),ge=v.borderWidth,ye=v.label,{label:be,svgElem:_e}=this,Fe=[],ze,ft=Ko(re)&&Ko(K),St=Ko(ue),_t=!_e,Ot={class:"highcharts-plot-"+(ft?"band ":"line ")+(v.className||"")},Pt=ft?"bands":"lines";if(!h.chart.styledMode&&(St?(Ot.stroke=L||"#999999",Ot["stroke-width"]=Df(v.width,1),v.dashStyle&&(Ot.dashstyle=v.dashStyle)):ft&&(Ot.fill=L||"#e6e9ff",ge&&(Ot.stroke=v.borderColor,Ot["stroke-width"]=ge))),te.zIndex=B,Pt+="-"+B,(ze=h.plotLinesAndBandsGroups[Pt])||(h.plotLinesAndBandsGroups[Pt]=ze=U.g("plot-"+Pt).attr(te).add()),_e||(this.svgElem=_e=U.path().attr(Ot).add(ze)),Ko(ue))Fe=h.getPlotLinePath({value:(D==null?void 0:D.log2lin(ue))??ue,lineWidth:_e.strokeWidth(),acrossPanes:v.acrossPanes});else{if(!(Ko(re)&&Ko(K)))return;Fe=h.getPlotBandPath((D==null?void 0:D.log2lin(re))??re,(D==null?void 0:D.log2lin(K))??K,v)}return!this.eventsAdded&&z&&(Pf(z,(Ft,di)=>{_e==null||_e.on(di,gi=>{z[di].apply(this,[gi])})}),this.eventsAdded=!0),(_t||!_e.d)&&(Fe!=null&&Fe.length)?_e.attr({d:Fe}):_e&&(Fe?(_e.show(),_e.animate({d:Fe})):_e.d&&(_e.hide(),be&&(this.label=be=be.destroy()))),ye&&(Ko(ye.text)||Ko(ye.formatter))&&(Fe!=null&&Fe.length)&&h.width>0&&h.height>0&&!Fe.isFlat?(ye=td({align:S&&ft?"center":void 0,x:S?!ft&&4:10,verticalAlign:!S&&ft?"middle":void 0,y:S?ft?16:10:ft?6:-4,rotation:S&&!ft?90:0,...ft?{inside:!0}:{}},ye),this.renderLabel(ye,Fe,ft,B)):be&&be.hide(),this}renderLabel(h,v,S,D){var ge;let L=this.axis,z=L.chart.renderer,B=h.inside,U=this.label;U||(this.label=U=z.text(this.getLabelText(h),0,0,h.useHTML).attr({align:h.textAlign||h.align,rotation:h.rotation,class:"highcharts-plot-"+(S?"band":"line")+"-label "+(h.className||""),zIndex:D}),L.chart.styledMode||U.css(td({fontSize:"0.8em",textOverflow:S&&!B?"":"ellipsis"},h.style)),U.add());let X=v.xBounds||[v[0][1],v[1][1],S?v[2][1]:v[0][1]],te=v.yBounds||[v[0][2],v[1][2],S?v[2][2]:v[0][2]],K=Af(X),re=Af(te),ue=Ef(X)-K;U.align(h,!1,{x:K,y:re,width:ue,height:Ef(te)-re}),(!U.alignValue||U.alignValue==="left"||Ko(B))&&U.css({width:(((ge=h.style)==null?void 0:ge.width)||(S&&B?ue:U.rotation===90?L.height-(U.alignAttr.y-L.top):(h.clip?L.width:L.chart.chartWidth)-(U.alignAttr.x-L.left)))+"px"}),U.show(!0)}getLabelText(h){return Ko(h.formatter)?h.formatter.call(this):h.text}destroy(){ed(this.axis.plotLinesAndBands,this),delete this.axis,dp(this)}}let{animObject:Cl}=se,{format:id}=Po,{composed:zo,dateFormats:rd,doc:uu,isSafari:If}=Ve,{distribute:nd}=qo,{addEvent:nh,clamp:El,css:kf,discardElement:pp,extend:hu,fireEvent:Of,isArray:Ym,isNumber:Lf,isObject:Rf,isString:du,merge:pu,pick:la,pushUnique:sd,splat:dc,syncTimeout:zf}=Bi;class pc{constructor(h,v,S){this.allowShared=!0,this.crosshairs=[],this.distance=0,this.isHidden=!0,this.isSticky=!1,this.options={},this.outside=!1,this.chart=h,this.init(h,v),this.pointer=S}bodyFormatter(h){return h.map(v=>{let S=v.series.tooltipOptions,D=v.formatPrefix||"point";return(S[D+"Formatter"]||v.tooltipFormatter).call(v,S[D+"Format"]||"")})}cleanSplit(h){this.chart.series.forEach(function(v){let S=v&&v.tt;S&&(!S.isActive||h?v.tt=S.destroy():S.isActive=!1)})}defaultFormatter(h){let v,S=this.points||dc(this);return(v=(v=[h.headerFooterFormatter(S[0])]).concat(h.bodyFormatter(S))).push(h.headerFooterFormatter(S[0],!0)),v}destroy(){this.label&&(this.label=this.label.destroy()),this.split&&(this.cleanSplit(!0),this.tt&&(this.tt=this.tt.destroy())),this.renderer&&(this.renderer=this.renderer.destroy(),pp(this.container)),Bi.clearTimeout(this.hideTimer)}getAnchor(h,v){let S,{chart:D,pointer:L}=this,z=D.inverted,B=D.plotTop,U=D.plotLeft;if((h=dc(h))[0].series&&h[0].series.yAxis&&!h[0].series.yAxis.options.reversedStacks&&(h=h.slice().reverse()),this.followPointer&&v)v.chartX===void 0&&(v=L.normalize(v)),S=[v.chartX-U,v.chartY-B];else if(h[0].tooltipPos)S=h[0].tooltipPos;else{let X=0,te=0;h.forEach(function(K){let re=K.pos(!0);re&&(X+=re[0],te+=re[1])}),X/=h.length,te/=h.length,this.shared&&h.length>1&&v&&(z?X=v.chartX:te=v.chartY),S=[X-U,te-B]}return S.map(Math.round)}getClassName(h,v,S){let D=this.options,L=h.series,z=L.options;return[D.className,"highcharts-label",S&&"highcharts-tooltip-header",v?"highcharts-tooltip-box":"highcharts-tooltip",!S&&"highcharts-color-"+la(h.colorIndex,L.colorIndex),z&&z.className].filter(du).join(" ")}getLabel({anchorX:h,anchorY:v}={anchorX:0,anchorY:0}){let S=this,D=this.chart.styledMode,L=this.options,z=this.split&&this.allowShared,B=this.container,U=this.chart.renderer;if(this.label){let X=!this.label.hasClass("highcharts-label");(!z&&X||z&&!X)&&this.destroy()}if(!this.label){if(this.outside){let X=this.chart,te=X.options.chart.style,K=Wc.getRendererType();this.container=B=Ve.doc.createElement("div"),B.className="highcharts-tooltip-container "+(X.renderTo.className.match(/(highcharts[a-zA-Z0-9-]+)\s?/gm)||""),kf(B,{position:"absolute",top:"1px",pointerEvents:"none",zIndex:Math.max(this.options.style.zIndex||0,(te&&te.zIndex||0)+3)}),this.renderer=U=new K(B,0,0,te,void 0,void 0,U.styledMode)}if(z?this.label=U.g("tooltip"):(this.label=U.label("",h,v,L.shape,void 0,void 0,L.useHTML,void 0,"tooltip").attr({padding:L.padding,r:L.borderRadius}),D||this.label.attr({fill:L.backgroundColor,"stroke-width":L.borderWidth||0}).css(L.style).css({pointerEvents:L.style.pointerEvents||(this.shouldStickOnContact()?"auto":"none")})),S.outside){let X=this.label;[X.xSetter,X.ySetter].forEach((te,K)=>{X[K?"ySetter":"xSetter"]=re=>{te.call(X,S.distance),X[K?"y":"x"]=re,B&&(B.style[K?"top":"left"]=`${re}px`)}})}this.label.attr({zIndex:8}).shadow(L.shadow).add()}return B&&!B.parentElement&&Ve.doc.body.appendChild(B),this.label}getPlayingField(){let{body:h,documentElement:v}=uu,{chart:S,distance:D,outside:L}=this;return{width:L?Math.max(h.scrollWidth,v.scrollWidth,h.offsetWidth,v.offsetWidth,v.clientWidth)-2*D-2:S.chartWidth,height:L?Math.max(h.scrollHeight,v.scrollHeight,h.offsetHeight,v.offsetHeight,v.clientHeight):S.chartHeight}}getPosition(h,v,S){var Zi,kr;let{distance:D,chart:L,outside:z,pointer:B}=this,{inverted:U,plotLeft:X,plotTop:te,polar:K}=L,{plotX:re=0,plotY:ue=0}=S,ge={},ye=U&&S.h||0,{height:be,width:_e}=this.getPlayingField(),Fe=B.getChartPosition(),ze=Gi=>Gi*Fe.scaleX,ft=Gi=>Gi*Fe.scaleY,St=Gi=>{let gr=Gi==="x";return[Gi,gr?_e:be,gr?h:v].concat(z?[gr?ze(h):ft(v),gr?Fe.left-D+ze(re+X):Fe.top-D+ft(ue+te),0,gr?_e:be]:[gr?h:v,gr?re+X:ue+te,gr?X:te,gr?X+L.plotWidth:te+L.plotHeight])},_t=St("y"),Ot=St("x"),Pt,Ft=!!S.negative;!K&&((kr=(Zi=L.hoverSeries)==null?void 0:Zi.yAxis)!=null&&kr.reversed)&&(Ft=!Ft);let di=!this.followPointer&&la(S.ttBelow,!K&&!U===Ft),gi=function(Gi,gr,Vi,Qi,_r,un,kn){let zr=z?Gi==="y"?ft(D):ze(D):D,Gr=(Vi-Qi)/2,Xr=Qi<_r-D,Ms=_r+D+Qi<gr,ss=_r-zr-Vi+Gr,Cs=_r+zr-Gr;if(di&&Ms)ge[Gi]=Cs;else if(!di&&Xr)ge[Gi]=ss;else if(Xr)ge[Gi]=Math.min(kn-Qi,ss-ye<0?ss:ss-ye);else{if(!Ms)return!1;ge[Gi]=Math.max(un,Cs+ye+Vi>gr?Cs:Cs+ye)}},Ai=function(Gi,gr,Vi,Qi,_r){if(_r<D||_r>gr-D)return!1;_r<Vi/2?ge[Gi]=1:_r>gr-Qi/2?ge[Gi]=gr-Qi-2:ge[Gi]=_r-Vi/2},ai=function(Gi){[_t,Ot]=[Ot,_t],Pt=Gi},Ei=()=>{gi.apply(0,_t)!==!1?Ai.apply(0,Ot)!==!1||Pt||(ai(!0),Ei()):Pt?ge.x=ge.y=0:(ai(!0),Ei())};return(U&&!K||this.len>1)&&ai(),Ei(),ge}hide(h){let v=this;Bi.clearTimeout(this.hideTimer),h=la(h,this.options.hideDelay),this.isHidden||(this.hideTimer=zf(function(){let S=v.getLabel();v.getLabel().animate({opacity:0},{duration:h&&150,complete:()=>{S.hide(),v.container&&v.container.remove()}}),v.isHidden=!0},h))}init(h,v){this.chart=h,this.options=v,this.crosshairs=[],this.isHidden=!0,this.split=v.split&&!h.inverted&&!h.polar,this.shared=v.shared||this.split,this.outside=la(v.outside,!!(h.scrollablePixelsX||h.scrollablePixelsY))}shouldStickOnContact(h){return!!(!this.followPointer&&this.options.stickOnContact&&(!h||this.pointer.inClass(h.target,"highcharts-tooltip")))}move(h,v,S,D){let L=this,z=Cl(!L.isHidden&&L.options.animation),B=L.followPointer||(L.len||0)>1,U={x:h,y:v};B||(U.anchorX=S,U.anchorY=D),z.step=()=>L.drawTracker(),L.getLabel().animate(U,z)}refresh(h,v){let{chart:S,options:D,pointer:L,shared:z}=this,B=dc(h),U=B[0],X=D.format,te=D.formatter||this.defaultFormatter,K=S.styledMode,re=this.allowShared;if(!D.enabled||!U.series)return;Bi.clearTimeout(this.hideTimer),this.allowShared=!(!Ym(h)&&h.series&&h.series.noSharedTooltip),re=re&&!this.allowShared,this.followPointer=!this.split&&U.series.tooltipOptions.followPointer;let ue=this.getAnchor(h,v),ge=ue[0],ye=ue[1];z&&this.allowShared&&(L.applyInactiveState(B),B.forEach(Fe=>Fe.setState("hover")),U.points=B),this.len=B.length;let be=du(X)?id(X,U,S):te.call(U,this);U.points=void 0;let _e=U.series;if(this.distance=la(_e.tooltipOptions.distance,16),be===!1)this.hide();else{if(this.split&&this.allowShared)this.renderSplit(be,B);else{let Fe=ge,ze=ye;if(v&&L.isDirectTouch&&(Fe=v.chartX-S.plotLeft,ze=v.chartY-S.plotTop),S.polar||_e.options.clip===!1||B.some(ft=>L.isDirectTouch||ft.series.shouldShowTooltip(Fe,ze))){let ft=this.getLabel(re&&this.tt||{});(!D.style.width||K)&&ft.css({width:(this.outside?this.getPlayingField():S.spacingBox).width+"px"}),ft.attr({class:this.getClassName(U),text:be&&be.join?be.join(""):be}),this.outside&&ft.attr({x:El(ft.x||0,0,this.getPlayingField().width-(ft.width||0)-1)}),K||ft.attr({stroke:D.borderColor||U.color||_e.color||"#666666"}),this.updatePosition({plotX:ge,plotY:ye,negative:U.negative,ttBelow:U.ttBelow,h:ue[2]||0})}else{this.hide();return}}this.isHidden&&this.label&&this.label.attr({opacity:1}).show(),this.isHidden=!1}Of(this,"refresh")}renderSplit(h,v){var gr;let S=this,{chart:D,chart:{chartWidth:L,chartHeight:z,plotHeight:B,plotLeft:U,plotTop:X,scrollablePixelsY:te=0,scrollablePixelsX:K,styledMode:re},distance:ue,options:ge,options:{positioner:ye},pointer:be}=S,{scrollLeft:_e=0,scrollTop:Fe=0}=((gr=D.scrollablePlotArea)==null?void 0:gr.scrollingContainer)||{},ze=S.outside&&typeof K!="number"?uu.documentElement.getBoundingClientRect():{left:_e,right:_e+L},ft=S.getLabel(),St=this.renderer||D.renderer,_t=!!(D.xAxis[0]&&D.xAxis[0].opposite),{left:Ot,top:Pt}=be.getChartPosition(),Ft=X+Fe,di=0,gi=B-te;function Ai(Vi,Qi,_r,un,kn=!0){let zr,Gr;return _r?(zr=_t?0:gi,Gr=El(Vi-un/2,ze.left,ze.right-un-(S.outside?Ot:0))):(zr=Qi-Ft,Gr=El(Gr=kn?Vi-un-ue:Vi+ue,kn?Gr:ze.left,ze.right)),{x:Gr,y:zr}}du(h)&&(h=[!1,h]);let ai=h.slice(0,v.length+1).reduce(function(Vi,Qi,_r){if(Qi!==!1&&Qi!==""){let un=v[_r-1]||{isHeader:!0,plotX:v[0].plotX,plotY:B,series:{}},kn=un.isHeader,zr=kn?S:un.series,Gr=zr.tt=function(os,Xn,Bs){let Pc=os,{isHeader:Cd,series:em}=Xn;if(!Pc){let Ed={padding:ge.padding,r:ge.borderRadius};re||(Ed.fill=ge.backgroundColor,Ed["stroke-width"]=ge.borderWidth??1),Pc=St.label("",0,0,ge[Cd?"headerShape":"shape"],void 0,void 0,ge.useHTML).addClass(S.getClassName(Xn,!0,Cd)).attr(Ed).add(ft)}return Pc.isActive=!0,Pc.attr({text:Bs}),re||Pc.css(ge.style).attr({stroke:ge.borderColor||Xn.color||em.color||"#333333"}),Pc}(zr.tt,un,Qi.toString()),Xr=Gr.getBBox(),Ms=Xr.width+Gr.strokeWidth();kn&&(di=Xr.height,gi+=di,_t&&(Ft-=di));let{anchorX:ss,anchorY:Cs}=function(os){let Xn,Bs,{isHeader:Pc,plotX:Cd=0,plotY:em=0,series:Ed}=os;if(Pc)Xn=Math.max(U+Cd,U),Bs=X+B/2;else{let{xAxis:sg,yAxis:Gp}=Ed;Xn=sg.pos+El(Cd,-ue,sg.len+ue),Ed.shouldShowTooltip(0,Gp.pos-X+em,{ignoreX:!0})&&(Bs=Gp.pos+em)}return{anchorX:Xn=El(Xn,ze.left-ue,ze.right+ue),anchorY:Bs}}(un);if(typeof Cs=="number"){let os=Xr.height+1,Xn=ye?ye.call(S,Ms,os,un):Ai(ss,Cs,kn,Ms);Vi.push({align:ye?0:void 0,anchorX:ss,anchorY:Cs,boxWidth:Ms,point:un,rank:la(Xn.rank,kn?1:0),size:os,target:Xn.y,tt:Gr,x:Xn.x})}else Gr.isActive=!1}return Vi},[]);!ye&&ai.some(Vi=>{let{outside:Qi}=S,_r=(Qi?Ot:0)+Vi.anchorX;return _r<ze.left&&_r+Vi.boxWidth<ze.right||_r<Ot-ze.left+Vi.boxWidth&&ze.right-_r>_r})&&(ai=ai.map(Vi=>{let{x:Qi,y:_r}=Ai(Vi.anchorX,Vi.anchorY,Vi.point.isHeader,Vi.boxWidth,!1);return hu(Vi,{target:_r,x:Qi})})),S.cleanSplit(),nd(ai,gi);let Ei={left:Ot,right:Ot};ai.forEach(function(Vi){let{x:Qi,boxWidth:_r,isHeader:un}=Vi;!un&&(S.outside&&Ot+Qi<Ei.left&&(Ei.left=Ot+Qi),!un&&S.outside&&Ei.left+_r>Ei.right&&(Ei.right=Ot+Qi))}),ai.forEach(function(Vi){let{x:Qi,anchorX:_r,anchorY:un,pos:kn,point:{isHeader:zr}}=Vi,Gr={visibility:kn===void 0?"hidden":"inherit",x:Qi,y:(kn||0)+Ft,anchorX:_r,anchorY:un};if(S.outside&&Qi<_r){let Xr=Ot-Ei.left;Xr>0&&(zr||(Gr.x=Qi+Xr,Gr.anchorX=_r+Xr),zr&&(Gr.x=(Ei.right-Ei.left)/2,Gr.anchorX=_r+Xr))}Vi.tt.attr(Gr)});let{container:Zi,outside:kr,renderer:Gi}=S;if(kr&&Zi&&Gi){let{width:Vi,height:Qi,x:_r,y:un}=ft.getBBox();Gi.setSize(Vi+_r,Qi+un,!1),Zi.style.left=Ei.left+"px",Zi.style.top=Pt+"px"}If&&ft.attr({opacity:ft.opacity===1?.999:1})}drawTracker(){if(!this.shouldStickOnContact()){this.tracker&&(this.tracker=this.tracker.destroy());return}let h=this.chart,v=this.label,S=this.shared?h.hoverPoints:h.hoverPoint;if(!v||!S)return;let D={x:0,y:0,width:0,height:0},L=this.getAnchor(S),z=v.getBBox();L[0]+=h.plotLeft-(v.translateX||0),L[1]+=h.plotTop-(v.translateY||0),D.x=Math.min(0,L[0]),D.y=Math.min(0,L[1]),D.width=L[0]<0?Math.max(Math.abs(L[0]),z.width-L[0]):Math.max(Math.abs(L[0]),z.width),D.height=L[1]<0?Math.max(Math.abs(L[1]),z.height-Math.abs(L[1])):Math.max(Math.abs(L[1]),z.height),this.tracker?this.tracker.attr(D):(this.tracker=v.renderer.rect(D).addClass("highcharts-tracker").add(v),h.styledMode||this.tracker.attr({fill:"rgba(0,0,0,0)"}))}styledModeFormat(h){return h.replace('style="font-size: 0.8em"','class="highcharts-header"').replace(/style="color:{(point|series)\.color}"/g,'class="highcharts-color-{$1.colorIndex} {series.options.className} {point.options.className}"')}headerFooterFormatter(h,v){let S=h.series,D=S.tooltipOptions,L=S.xAxis,z=L&&L.dateTime,B={isFooter:v,point:h},U=D.xDateFormat||"",X=D[v?"footerFormat":"headerFormat"];return Of(this,"headerFormatter",B,function(te){if(z&&!U&&Lf(h.key)&&(U=z.getXDateFormat(h.key,D.dateTimeLabelFormats)),z&&U){if(Rf(U)){let K=U;rd[0]=re=>S.chart.time.dateFormat(K,re),U="%0"}(h.tooltipDateKeys||["key"]).forEach(K=>{X=X.replace(RegExp("point\\."+K+"([ \\)}])",""),`(point.${K}:${U})$1`)})}S.chart.styledMode&&(X=this.styledModeFormat(X)),te.text=id(X,h,this.chart)}),B.text||""}update(h){this.destroy(),this.init(this.chart,pu(!0,this.options,h))}updatePosition(h){let{chart:v,container:S,distance:D,options:L,pointer:z,renderer:B}=this,{height:U=0,width:X=0}=this.getLabel(),{left:te,top:K,scaleX:re,scaleY:ue}=z.getChartPosition(),ge=(L.positioner||this.getPosition).call(this,X,U,h),ye=Ve.doc,be=(h.plotX||0)+v.plotLeft,_e=(h.plotY||0)+v.plotTop,Fe;B&&S&&(L.positioner&&(ge.x+=te-D,ge.y+=K-D),Fe=(L.borderWidth||0)+2*D+2,B.setSize(El(X+Fe,0,ye.documentElement.clientWidth)-1,U+Fe,!1),(re!==1||ue!==1)&&(kf(S,{transform:`scale(${re}, ${ue})`}),be*=re,_e*=ue),be+=te-ge.x,_e+=K-ge.y),this.move(Math.round(ge.x),Math.round(ge.y||0),be,_e)}}(function(Y){Y.compose=function(h){sd(zo,"Core.Tooltip")&&nh(h,"afterInit",function(){let v=this.chart;v.options.tooltip&&(v.tooltip=new Y(v,v.options.tooltip,this))})}})(pc||(pc={}));let fu=pc,{animObject:fp}=se,{defaultOptions:Ff}=zn,{format:Xm}=Po,{addEvent:fc,crisp:od,erase:_i,extend:mu,fireEvent:sh,getNestedProperty:Al,isArray:mc,isFunction:wi,isNumber:Ba,isObject:ad,merge:Bf,pick:ca,syncTimeout:mp,removeEvent:ld,uniqueKey:Nf}=Bi;class gc{animateBeforeDestroy(){let h=this,v={x:h.startXPos,opacity:0},S=h.getGraphicalProps();S.singular.forEach(function(D){h[D]=h[D].animate(D==="dataLabel"?{x:h[D].startXPos,y:h[D].startYPos,opacity:0}:v)}),S.plural.forEach(function(D){h[D].forEach(function(L){L.element&&L.animate(mu({x:h.startXPos},L.startYPos?{x:L.startXPos,y:L.startYPos}:{}))})})}applyOptions(h,v){let S=this.series,D=S.options.pointValKey||S.pointValKey;return mu(this,h=gc.prototype.optionsToObject.call(this,h)),this.options=this.options?mu(this.options,h):h,h.group&&delete this.group,h.dataLabels&&delete this.dataLabels,D&&(this.y=gc.prototype.getNestedProperty.call(this,D)),this.selected&&(this.state="select"),"name"in this&&v===void 0&&S.xAxis&&S.xAxis.hasNames&&(this.x=S.xAxis.nameToX(this)),this.x===void 0&&S?this.x=v??S.autoIncrement():Ba(h.x)&&S.options.relativeXValue?this.x=S.autoIncrement(h.x):typeof this.x=="string"&&(v??(v=S.chart.time.parse(this.x)),Ba(v)&&(this.x=v)),this.isNull=this.isValid&&!this.isValid(),this.formatPrefix=this.isNull?"null":"point",this}destroy(){if(!this.destroyed){let h=this,v=h.series,S=v.chart,D=v.options.dataSorting,L=S.hoverPoints,z=fp(h.series.chart.renderer.globalAnimation),B=()=>{for(let U in(h.graphic||h.graphics||h.dataLabel||h.dataLabels)&&(ld(h),h.destroyElements()),h)delete h[U]};h.legendItem&&S.legend.destroyItem(h),L&&(h.setState(),_i(L,h),L.length||(S.hoverPoints=null)),h===S.hoverPoint&&h.onMouseOut(),D&&D.enabled?(this.animateBeforeDestroy(),mp(B,z.duration)):B(),S.pointCount--}this.destroyed=!0}destroyElements(h){let v=this,S=v.getGraphicalProps(h);S.singular.forEach(function(D){v[D]=v[D].destroy()}),S.plural.forEach(function(D){v[D].forEach(function(L){L&&L.element&&L.destroy()}),delete v[D]})}firePointEvent(h,v,S){let D=this,L=this.series.options;D.manageEvent(h),h==="click"&&L.allowPointSelect&&(S=function(z){!D.destroyed&&D.select&&D.select(null,z.ctrlKey||z.metaKey||z.shiftKey)}),sh(D,h,v,S)}getClassName(){return"highcharts-point"+(this.selected?" highcharts-point-select":"")+(this.negative?" highcharts-negative":"")+(this.isNull?" highcharts-null-point":"")+(this.colorIndex!==void 0?" highcharts-color-"+this.colorIndex:"")+(this.options.className?" "+this.options.className:"")+(this.zone&&this.zone.className?" "+this.zone.className.replace("highcharts-negative",""):"")}getGraphicalProps(h){let v,S,D=this,L=[],z={singular:[],plural:[]};for((h=h||{graphic:1,dataLabel:1}).graphic&&L.push("graphic","connector"),h.dataLabel&&L.push("dataLabel","dataLabelPath","dataLabelUpper"),S=L.length;S--;)D[v=L[S]]&&z.singular.push(v);return["graphic","dataLabel"].forEach(function(B){let U=B+"s";h[B]&&D[U]&&z.plural.push(U)}),z}getNestedProperty(h){return h?h.indexOf("custom.")===0?Al(h,this.options):this[h]:void 0}getZone(){let h=this.series,v=h.zones,S=h.zoneAxis||"y",D,L=0;for(D=v[0];this[S]>=D.value;)D=v[++L];return this.nonZonedColor||(this.nonZonedColor=this.color),D&&D.color&&!this.options.color?this.color=D.color:this.color=this.nonZonedColor,D}hasNewShapeType(){return(this.graphic&&(this.graphic.symbolName||this.graphic.element.nodeName))!==this.shapeType}constructor(h,v,S){this.formatPrefix="point",this.visible=!0,this.point=this,this.series=h,this.applyOptions(v,S),this.id??(this.id=Nf()),this.resolveColor(),h.chart.pointCount++,sh(this,"afterInit")}isValid(){return(Ba(this.x)||this.x instanceof Date)&&Ba(this.y)}optionsToObject(h){var te;let v=this.series,S=v.options.keys,D=S||v.pointArrayMap||["y"],L=D.length,z={},B,U=0,X=0;if(Ba(h)||h===null)z[D[0]]=h;else if(mc(h))for(!S&&h.length>L&&((B=typeof h[0])=="string"?(te=v.xAxis)!=null&&te.dateTime?z.x=v.chart.time.parse(h[0]):z.name=h[0]:B==="number"&&(z.x=h[0]),U++);X<L;)S&&h[U]===void 0||(D[X].indexOf(".")>0?gc.prototype.setNestedProperty(z,h[U],D[X]):z[D[X]]=h[U]),U++,X++;else typeof h=="object"&&(z=h,h.dataLabels&&(v.hasDataLabels=()=>!0),h.marker&&(v._hasPointMarkers=!0));return z}pos(h,v=this.plotY){if(!this.destroyed){let{plotX:S,series:D}=this,{chart:L,xAxis:z,yAxis:B}=D,U=0,X=0;if(Ba(S)&&Ba(v))return h&&(U=z?z.pos:L.plotLeft,X=B?B.pos:L.plotTop),L.inverted&&z&&B?[B.len-v+X,z.len-S+U]:[S+U,v+X]}}resolveColor(){let h=this.series,v=h.chart.options.chart,S=h.chart.styledMode,D,L,z=v.colorCount,B;delete this.nonZonedColor,h.options.colorByPoint?(S||(D=(L=h.options.colors||h.chart.options.colors)[h.colorCounter],z=L.length),B=h.colorCounter,h.colorCounter++,h.colorCounter===z&&(h.colorCounter=0)):(S||(D=h.color),B=h.colorIndex),this.colorIndex=ca(this.options.colorIndex,B),this.color=ca(this.options.color,D)}setNestedProperty(h,v,S){return S.split(".").reduce(function(D,L,z,B){let U=B.length-1===z;return D[L]=U?v:ad(D[L],!0)?D[L]:{},D[L]},h),h}shouldDraw(){return!this.isNull}tooltipFormatter(h){var U;let{chart:v,pointArrayMap:S=["y"],tooltipOptions:D}=this.series,{valueDecimals:L="",valuePrefix:z="",valueSuffix:B=""}=D;return v.styledMode&&(h=((U=v.tooltip)==null?void 0:U.styledModeFormat(h))||h),S.forEach(X=>{X="{point."+X,(z||B)&&(h=h.replace(RegExp(X+"}","g"),z+X+"}"+B)),h=h.replace(RegExp(X+"}","g"),X+":,."+L+"f}")}),Xm(h,this,v)}update(h,v,S,D){let L,z=this,B=z.series,U=z.graphic,X=B.chart,te=B.options;function K(){z.applyOptions(h);let re=U&&z.hasMockGraphic,ue=z.y===null?!re:re;U&&ue&&(z.graphic=U.destroy(),delete z.hasMockGraphic),ad(h,!0)&&(U&&U.element&&h&&h.marker&&h.marker.symbol!==void 0&&(z.graphic=U.destroy()),h!=null&&h.dataLabels&&z.dataLabel&&(z.dataLabel=z.dataLabel.destroy())),L=z.index;let ge={};for(let ye of B.dataColumnKeys())ge[ye]=z[ye];B.dataTable.setRow(ge,L),te.data[L]=ad(te.data[L],!0)||ad(h,!0)?z.options:ca(h,te.data[L]),B.isDirty=B.isDirtyData=!0,!B.fixedBox&&B.hasCartesianSeries&&(X.isDirtyBox=!0),te.legendType==="point"&&(X.isDirtyLegend=!0),v&&X.redraw(S)}v=ca(v,!0),D===!1?K():z.firePointEvent("update",{options:h},K)}remove(h,v){this.series.removePoint(this.series.data.indexOf(this),h,v)}select(h,v){let S=this,D=S.series,L=D.chart;h=ca(h,!S.selected),this.selectedStaging=h,S.firePointEvent(h?"select":"unselect",{accumulate:v},function(){S.selected=S.options.selected=h,D.options.data[D.data.indexOf(S)]=S.options,S.setState(h&&"select"),v||L.getSelectedPoints().forEach(function(z){let B=z.series;z.selected&&z!==S&&(z.selected=z.options.selected=!1,B.options.data[B.data.indexOf(z)]=z.options,z.setState(L.hoverPoints&&B.options.inactiveOtherPoints?"inactive":""),z.firePointEvent("unselect"))})}),delete this.selectedStaging}onMouseOver(h){let{inverted:v,pointer:S}=this.series.chart;S&&(h=h?S.normalize(h):S.getChartCoordinatesFromPoint(this,v),S.runPointActions(h,this))}onMouseOut(){let h=this.series.chart;this.firePointEvent("mouseOut"),this.series.options.inactiveOtherPoints||(h.hoverPoints||[]).forEach(function(v){v.setState()}),h.hoverPoints=h.hoverPoint=null}manageEvent(h){var D,L,z,B,U,X,te;let v=Bf(this.series.options.point,this.options),S=(D=v.events)==null?void 0:D[h];wi(S)&&(!((L=this.hcEvents)!=null&&L[h])||((B=(z=this.hcEvents)==null?void 0:z[h])==null?void 0:B.map(K=>K.fn).indexOf(S))===-1)?((U=this.importedUserEvent)==null||U.call(this),this.importedUserEvent=fc(this,h,S),this.hcEvents&&(this.hcEvents[h].userEvent=!0)):this.importedUserEvent&&!S&&((X=this.hcEvents)!=null&&X[h])&&((te=this.hcEvents)!=null&&te[h].userEvent)&&(ld(this,h),delete this.hcEvents[h],Object.keys(this.hcEvents)||delete this.importedUserEvent)}setState(h,v){var _t;let S=this.series,D=this.state,L=S.options.states[h||"normal"]||{},z=Ff.plotOptions[S.type].marker&&S.options.marker,B=z&&z.enabled===!1,U=z&&z.states&&z.states[h||"normal"]||{},X=U.enabled===!1,te=this.marker||{},K=S.chart,re=z&&S.markerAttribs,ue=S.halo,ge,ye,be,_e=S.stateMarkerGraphic,Fe;if((h=h||"")===this.state&&!v||this.selected&&h!=="select"||L.enabled===!1||h&&(X||B&&U.enabled===!1)||h&&te.states&&te.states[h]&&te.states[h].enabled===!1)return;if(this.state=h,re&&(ge=S.markerAttribs(this,h)),this.graphic&&!this.hasMockGraphic){if(D&&this.graphic.removeClass("highcharts-point-"+D),h&&this.graphic.addClass("highcharts-point-"+h),!K.styledMode){ye=S.pointAttribs(this,h),be=ca(K.options.chart.animation,L.animation);let Ot=ye.opacity;S.options.inactiveOtherPoints&&Ba(Ot)&&(this.dataLabels||[]).forEach(function(Pt){Pt&&!Pt.hasClass("highcharts-data-label-hidden")&&(Pt.animate({opacity:Ot},be),Pt.connector&&Pt.connector.animate({opacity:Ot},be))}),this.graphic.animate(ye,be)}ge&&this.graphic.animate(ge,ca(K.options.chart.animation,U.animation,z.animation)),_e&&_e.hide()}else h&&U&&(Fe=te.symbol||S.symbol,_e&&_e.currentSymbol!==Fe&&(_e=_e.destroy()),ge&&(_e?_e[v?"animate":"attr"]({x:ge.x,y:ge.y}):Fe&&(S.stateMarkerGraphic=_e=K.renderer.symbol(Fe,ge.x,ge.y,ge.width,ge.height,Bf(z,U)).add(S.markerGroup),_e.currentSymbol=Fe)),!K.styledMode&&_e&&this.state!=="inactive"&&_e.attr(S.pointAttribs(this,h))),_e&&(_e[h&&this.isInside?"show":"hide"](),_e.element.point=this,_e.addClass(this.getClassName(),!0));let ze=L.halo,ft=this.graphic||_e,St=ft&&ft.visibility||"inherit";ze&&ze.size&&ft&&St!=="hidden"&&!this.isCluster?(ue||(S.halo=ue=K.renderer.path().add(ft.parentGroup)),ue.show()[v?"animate":"attr"]({d:this.haloPath(ze.size)}),ue.attr({class:"highcharts-halo highcharts-color-"+ca(this.colorIndex,S.colorIndex)+(this.className?" "+this.className:""),visibility:St,zIndex:-1}),ue.point=this,K.styledMode||ue.attr(mu({fill:this.color||S.color,"fill-opacity":ze.opacity},fi.filterUserAttributes(ze.attributes||{})))):(_t=ue==null?void 0:ue.point)!=null&&_t.haloPath&&!ue.point.destroyed&&ue.animate({d:ue.point.haloPath(0)},null,ue.hide),sh(this,"afterSetState",{state:h})}haloPath(h){let v=this.pos();return v?this.series.chart.renderer.symbols.circle(od(v[0],1)-h,v[1]-h,2*h,2*h):[]}}let Jo=gc,{parse:cd}=Jr,{charts:oh,composed:Na,isTouchDevice:xo}=Ve,{addEvent:Ss,attr:gp,css:ah,extend:Pl,find:lh,fireEvent:Qo,isNumber:Qs,isObject:Vr,objectEach:ud,offset:ch,pick:bo,pushUnique:_p,splat:gu}=Bi;class Vn{applyInactiveState(h){let v=[],S;(h||[]).forEach(function(D){S=D.series,v.push(S),S.linkedParent&&v.push(S.linkedParent),S.linkedSeries&&(v=v.concat(S.linkedSeries)),S.navigatorSeries&&v.push(S.navigatorSeries)}),this.chart.series.forEach(function(D){v.indexOf(D)===-1?D.setState("inactive",!0):D.options.inactiveOtherPoints&&D.setAllPointsToState("inactive")})}destroy(){let h=this;this.eventsToUnbind.forEach(v=>v()),this.eventsToUnbind=[],!Ve.chartCount&&(Vn.unbindDocumentMouseUp.forEach(v=>v.unbind()),Vn.unbindDocumentMouseUp.length=0,Vn.unbindDocumentTouchEnd&&(Vn.unbindDocumentTouchEnd=Vn.unbindDocumentTouchEnd())),clearInterval(h.tooltipTimeout),ud(h,function(v,S){h[S]=void 0})}getSelectionMarkerAttrs(h,v){let S={args:{chartX:h,chartY:v},attrs:{},shapeType:"rect"};return Qo(this,"getSelectionMarkerAttrs",S,D=>{let L,{chart:z,zoomHor:B,zoomVert:U}=this,{mouseDownX:X=0,mouseDownY:te=0}=z,K=D.attrs;K.x=z.plotLeft,K.y=z.plotTop,K.width=B?1:z.plotWidth,K.height=U?1:z.plotHeight,B&&(L=h-X,K.width=Math.max(1,Math.abs(L)),K.x=(L>0?0:L)+X),U&&(L=v-te,K.height=Math.max(1,Math.abs(L)),K.y=(L>0?0:L)+te)}),S}drag(h){let{chart:v}=this,{mouseDownX:S=0,mouseDownY:D=0}=v,{panning:L,panKey:z,selectionMarkerFill:B}=v.options.chart,U=v.plotLeft,X=v.plotTop,te=v.plotWidth,K=v.plotHeight,re=Vr(L)?L.enabled:L,ue=z&&h[`${z}Key`],ge=h.chartX,ye=h.chartY,be,_e=this.selectionMarker;if((!_e||!_e.touch)&&(ge<U?ge=U:ge>U+te&&(ge=U+te),ye<X?ye=X:ye>X+K&&(ye=X+K),this.hasDragged=Math.sqrt(Math.pow(S-ge,2)+Math.pow(D-ye,2)),this.hasDragged>10)){be=v.isInsidePlot(S-U,D-X,{visiblePlotOnly:!0});let{shapeType:Fe,attrs:ze}=this.getSelectionMarkerAttrs(ge,ye);(v.hasCartesianSeries||v.mapView)&&this.hasZoom&&be&&!ue&&!_e&&(this.selectionMarker=_e=v.renderer[Fe](),_e.attr({class:"highcharts-selection-marker",zIndex:7}).add(),v.styledMode||_e.attr({fill:B||cd("#334eff").setOpacity(.25).get()})),_e&&_e.attr(ze),be&&!_e&&re&&v.pan(h,L)}}dragStart(h){let v=this.chart;v.mouseIsDown=h.type,v.cancelClick=!1,v.mouseDownX=h.chartX,v.mouseDownY=h.chartY}getSelectionBox(h){let v={args:{marker:h},result:h.getBBox()};return Qo(this,"getSelectionBox",v),v.result}drop(h){let v,{chart:S,selectionMarker:D}=this;for(let L of S.axes)L.isPanning&&(L.isPanning=!1,(L.options.startOnTick||L.options.endOnTick||L.series.some(z=>z.boosted))&&(L.forceRedraw=!0,L.setExtremes(L.userMin,L.userMax,!1),v=!0));if(v&&S.redraw(),D&&h){if(this.hasDragged){let L=this.getSelectionBox(D);S.transform({axes:S.axes.filter(z=>z.zoomEnabled&&(z.coll==="xAxis"&&this.zoomX||z.coll==="yAxis"&&this.zoomY)),selection:{originalEvent:h,xAxis:[],yAxis:[],...L},from:L})}Qs(S.index)&&(this.selectionMarker=D.destroy())}S&&Qs(S.index)&&(ah(S.container,{cursor:S._cursor}),S.cancelClick=this.hasDragged>10,S.mouseIsDown=!1,this.hasDragged=0,this.pinchDown=[])}findNearestKDPoint(h,v,S){let D;return h.forEach(function(L){let z=!(L.noSharedTooltip&&v)&&0>L.options.findNearestPointBy.indexOf("y"),B=L.searchPoint(S,z);Vr(B,!0)&&B.series&&(!Vr(D,!0)||function(U,X){var ue,ge;let te=U.distX-X.distX,K=U.dist-X.dist,re=((ue=X.series.group)==null?void 0:ue.zIndex)-((ge=U.series.group)==null?void 0:ge.zIndex);return te!==0&&v?te:K!==0?K:re!==0?re:U.series.index>X.series.index?-1:1}(D,B)>0)&&(D=B)}),D}getChartCoordinatesFromPoint(h,v){let{xAxis:S,yAxis:D}=h.series,L=h.shapeArgs;if(S&&D){let z=h.clientX??h.plotX??0,B=h.plotY||0;return h.isNode&&L&&Qs(L.x)&&Qs(L.y)&&(z=L.x,B=L.y),v?{chartX:D.len+D.pos-B,chartY:S.len+S.pos-z}:{chartX:z+S.pos,chartY:B+D.pos}}if(L&&L.x&&L.y)return{chartX:L.x,chartY:L.y}}getChartPosition(){if(this.chartPosition)return this.chartPosition;let{container:h}=this.chart,v=ch(h);this.chartPosition={left:v.left,top:v.top,scaleX:1,scaleY:1};let{offsetHeight:S,offsetWidth:D}=h;return D>2&&S>2&&(this.chartPosition.scaleX=v.width/D,this.chartPosition.scaleY=v.height/S),this.chartPosition}getCoordinates(h){let v={xAxis:[],yAxis:[]};for(let S of this.chart.axes)v[S.isXAxis?"xAxis":"yAxis"].push({axis:S,value:S.toValue(h[S.horiz?"chartX":"chartY"])});return v}getHoverData(h,v,S,D,L,z){let B=[],U=function(ue){return ue.visible&&!(!L&&ue.directTouch)&&bo(ue.options.enableMouseTracking,!0)},X=v,te,K={chartX:z?z.chartX:void 0,chartY:z?z.chartY:void 0,shared:L};Qo(this,"beforeGetHoverData",K),te=X&&!X.stickyTracking?[X]:S.filter(ue=>ue.stickyTracking&&(K.filter||U)(ue));let re=D&&h||!z?h:this.findNearestKDPoint(te,L,z);return X=re&&re.series,re&&(L&&!X.noSharedTooltip?(te=S.filter(function(ue){return K.filter?K.filter(ue):U(ue)&&!ue.noSharedTooltip})).forEach(function(ue){let ge=lh(ue.points,function(ye){return ye.x===re.x&&!ye.isNull});Vr(ge)&&(ue.boosted&&ue.boost&&(ge=ue.boost.getPoint(ge)),B.push(ge))}):B.push(re)),Qo(this,"afterGetHoverData",K={hoverPoint:re}),{hoverPoint:K.hoverPoint,hoverSeries:X,hoverPoints:B}}getPointFromEvent(h){let v=h.target,S;for(;v&&!S;)S=v.point,v=v.parentNode;return S}onTrackerMouseOut(h){let v=this.chart,S=h.relatedTarget,D=v.hoverSeries;this.isDirectTouch=!1,!D||!S||D.stickyTracking||this.inClass(S,"highcharts-tooltip")||this.inClass(S,"highcharts-series-"+D.index)&&this.inClass(S,"highcharts-tracker")||D.onMouseOut()}inClass(h,v){let S=h,D;for(;S;){if(D=gp(S,"class")){if(D.indexOf(v)!==-1)return!0;if(D.indexOf("highcharts-container")!==-1)return!1}S=S.parentElement}}constructor(h,v){var S;this.hasDragged=0,this.pointerCaptureEventsToUnbind=[],this.eventsToUnbind=[],this.options=v,this.chart=h,this.runChartClick=!!((S=v.chart.events)!=null&&S.click),this.pinchDown=[],this.setDOMEvents(),Qo(this,"afterInit")}normalize(h,v){let S=h.touches,D=S?S.length?S.item(0):bo(S.changedTouches,h.changedTouches)[0]:h;v||(v=this.getChartPosition());let L=D.pageX-v.left,z=D.pageY-v.top;return Pl(h,{chartX:Math.round(L/=v.scaleX),chartY:Math.round(z/=v.scaleY)})}onContainerClick(h){let v=this.chart,S=v.hoverPoint,D=this.normalize(h),L=v.plotLeft,z=v.plotTop;!v.cancelClick&&(S&&this.inClass(D.target,"highcharts-tracker")?(Qo(S.series,"click",Pl(D,{point:S})),v.hoverPoint&&S.firePointEvent("click",D)):(Pl(D,this.getCoordinates(D)),v.isInsidePlot(D.chartX-L,D.chartY-z,{visiblePlotOnly:!0})&&Qo(v,"click",D)))}onContainerMouseDown(h){var S;let v=(1&(h.buttons||h.button))==1;h=this.normalize(h),Ve.isFirefox&&h.button!==0&&this.onContainerMouseMove(h),(h.button===void 0||v)&&(this.zoomOption(h),v&&((S=h.preventDefault)==null||S.call(h)),this.dragStart(h))}onContainerMouseLeave(h){let{pointer:v}=oh[bo(Vn.hoverChartIndex,-1)]||{};h=this.normalize(h),this.onContainerMouseMove(h),v&&!this.inClass(h.relatedTarget,"highcharts-tooltip")&&(v.reset(),v.chartPosition=void 0)}onContainerMouseEnter(){delete this.chartPosition}onContainerMouseMove(h){let v=this.chart,S=v.tooltip,D=this.normalize(h);this.setHoverChartIndex(h),(v.mouseIsDown==="mousedown"||this.touchSelect(D))&&this.drag(D),!v.openMenu&&(this.inClass(D.target,"highcharts-tracker")||v.isInsidePlot(D.chartX-v.plotLeft,D.chartY-v.plotTop,{visiblePlotOnly:!0}))&&!(S&&S.shouldStickOnContact(D))&&(this.inClass(D.target,"highcharts-no-tooltip")?this.reset(!1,0):this.runPointActions(D))}onDocumentTouchEnd(h){this.onDocumentMouseUp(h)}onContainerTouchMove(h){this.touchSelect(h)?this.onContainerMouseMove(h):this.touch(h)}onContainerTouchStart(h){this.touchSelect(h)?this.onContainerMouseDown(h):(this.zoomOption(h),this.touch(h,!0))}onDocumentMouseMove(h){let v=this.chart,S=v.tooltip,D=this.chartPosition,L=this.normalize(h,D);!D||v.isInsidePlot(L.chartX-v.plotLeft,L.chartY-v.plotTop,{visiblePlotOnly:!0})||S&&S.shouldStickOnContact(L)||L.target!==v.container.ownerDocument&&this.inClass(L.target,"highcharts-tracker")||this.reset()}onDocumentMouseUp(h){var v,S;(S=(v=oh[bo(Vn.hoverChartIndex,-1)])==null?void 0:v.pointer)==null||S.drop(h)}pinch(h){let v=this,{chart:S,hasZoom:D,lastTouches:L}=v,z=[].map.call(h.touches||[],K=>v.normalize(K)),B=z.length,U=B===1&&(v.inClass(h.target,"highcharts-tracker")&&S.runTrackerClick||v.runChartClick),X=S.tooltip,te=B===1&&bo(X==null?void 0:X.options.followTouchMove,!0);B>1?v.initiated=!0:te&&(v.initiated=!1),D&&v.initiated&&!U&&h.cancelable!==!1&&h.preventDefault(),h.type==="touchstart"?(v.pinchDown=z,v.res=!0,S.mouseDownX=h.chartX):te?this.runPointActions(v.normalize(h)):L&&(Qo(S,"touchpan",{originalEvent:h,touches:z},()=>{let K=re=>{let ue=re[0],ge=re[1]||ue;return{x:ue.chartX,y:ue.chartY,width:ge.chartX-ue.chartX,height:ge.chartY-ue.chartY}};S.transform({axes:S.axes.filter(re=>re.zoomEnabled&&(this.zoomHor&&re.horiz||this.zoomVert&&!re.horiz)),to:K(z),from:K(L),trigger:h.type})}),v.res&&(v.res=!1,this.reset(!1,0))),v.lastTouches=z}reset(h,v){let S=this.chart,D=S.hoverSeries,L=S.hoverPoint,z=S.hoverPoints,B=S.tooltip,U=B&&B.shared?z:L;h&&U&&gu(U).forEach(function(X){X.series.isCartesian&&X.plotX===void 0&&(h=!1)}),h?B&&U&&gu(U).length&&(B.refresh(U),B.shared&&z?z.forEach(function(X){X.setState(X.state,!0),X.series.isCartesian&&(X.series.xAxis.crosshair&&X.series.xAxis.drawCrosshair(null,X),X.series.yAxis.crosshair&&X.series.yAxis.drawCrosshair(null,X))}):L&&(L.setState(L.state,!0),S.axes.forEach(function(X){X.crosshair&&L.series[X.coll]===X&&X.drawCrosshair(null,L)}))):(L&&L.onMouseOut(),z&&z.forEach(function(X){X.setState()}),D&&D.onMouseOut(),B&&B.hide(v),this.unDocMouseMove&&(this.unDocMouseMove=this.unDocMouseMove()),S.axes.forEach(function(X){X.hideCrosshair()}),S.hoverPoints=S.hoverPoint=void 0)}runPointActions(h,v,S){let D=this.chart,L=D.series,z=D.tooltip&&D.tooltip.options.enabled?D.tooltip:void 0,B=!!z&&z.shared,U=v||D.hoverPoint,X=U&&U.series||D.hoverSeries,te=(!h||h.type!=="touchmove")&&(!!v||X&&X.directTouch&&this.isDirectTouch),K=this.getHoverData(U,X,L,te,B,h);U=K.hoverPoint,X=K.hoverSeries;let re=K.hoverPoints,ue=X&&X.tooltipOptions.followPointer&&!X.tooltipOptions.split,ge=B&&X&&!X.noSharedTooltip;if(U&&(S||U!==D.hoverPoint||z&&z.isHidden)){if((D.hoverPoints||[]).forEach(function(ye){re.indexOf(ye)===-1&&ye.setState()}),D.hoverSeries!==X&&X.onMouseOver(),this.applyInactiveState(re),(re||[]).forEach(function(ye){ye.setState("hover")}),D.hoverPoint&&D.hoverPoint.firePointEvent("mouseOut"),!U.series)return;D.hoverPoints=re,D.hoverPoint=U,U.firePointEvent("mouseOver",void 0,()=>{z&&U&&z.refresh(ge?re:U,h)})}else if(ue&&z&&!z.isHidden){let ye=z.getAnchor([{}],h);D.isInsidePlot(ye[0],ye[1],{visiblePlotOnly:!0})&&z.updatePosition({plotX:ye[0],plotY:ye[1]})}this.unDocMouseMove||(this.unDocMouseMove=Ss(D.container.ownerDocument,"mousemove",ye=>{var be,_e;return(_e=(be=oh[Vn.hoverChartIndex??-1])==null?void 0:be.pointer)==null?void 0:_e.onDocumentMouseMove(ye)}),this.eventsToUnbind.push(this.unDocMouseMove)),D.axes.forEach(function(ye){let be,_e=bo((ye.crosshair||{}).snap,!0);!_e||(be=D.hoverPoint)&&be.series[ye.coll]===ye||(be=lh(re,Fe=>Fe.series&&Fe.series[ye.coll]===ye)),be||!_e?ye.drawCrosshair(h,be):ye.hideCrosshair()})}setDOMEvents(){let h=this.chart.container,v=h.ownerDocument;h.onmousedown=this.onContainerMouseDown.bind(this),h.onmousemove=this.onContainerMouseMove.bind(this),h.onclick=this.onContainerClick.bind(this),this.eventsToUnbind.push(Ss(h,"mouseenter",this.onContainerMouseEnter.bind(this)),Ss(h,"mouseleave",this.onContainerMouseLeave.bind(this))),Vn.unbindDocumentMouseUp.some(D=>D.doc===v)||Vn.unbindDocumentMouseUp.push({doc:v,unbind:Ss(v,"mouseup",this.onDocumentMouseUp.bind(this))});let S=this.chart.renderTo.parentElement;for(;S&&S.tagName!=="BODY";)this.eventsToUnbind.push(Ss(S,"scroll",()=>{delete this.chartPosition})),S=S.parentElement;this.eventsToUnbind.push(Ss(h,"touchstart",this.onContainerTouchStart.bind(this),{passive:!1}),Ss(h,"touchmove",this.onContainerTouchMove.bind(this),{passive:!1})),Vn.unbindDocumentTouchEnd||(Vn.unbindDocumentTouchEnd=Ss(v,"touchend",this.onDocumentTouchEnd.bind(this),{passive:!1})),this.setPointerCapture(),Ss(this.chart,"redraw",this.setPointerCapture.bind(this))}setPointerCapture(){var L,z;if(!xo)return;let h=this.pointerCaptureEventsToUnbind,v=this.chart,S=v.container,D=bo((L=v.options.tooltip)==null?void 0:L.followTouchMove,!0)&&v.series.some(B=>B.options.findNearestPointBy.indexOf("y")>-1);!this.hasPointerCapture&&D?(h.push(Ss(S,"pointerdown",B=>{var U,X;(U=B.target)!=null&&U.hasPointerCapture(B.pointerId)&&((X=B.target)==null||X.releasePointerCapture(B.pointerId))}),Ss(S,"pointermove",B=>{var U,X;(X=(U=v.pointer)==null?void 0:U.getPointFromEvent(B))==null||X.onMouseOver(B)})),v.styledMode||ah(S,{"touch-action":"none"}),S.className+=" highcharts-no-touch-action",this.hasPointerCapture=!0):this.hasPointerCapture&&!D&&(h.forEach(B=>B()),h.length=0,v.styledMode||ah(S,{"touch-action":bo((z=v.options.chart.style)==null?void 0:z["touch-action"],"manipulation")}),S.className=S.className.replace(" highcharts-no-touch-action",""),this.hasPointerCapture=!1)}setHoverChartIndex(h){var D;let v=this.chart,S=Ve.charts[bo(Vn.hoverChartIndex,-1)];if(S&&S!==v){let L={relatedTarget:v.container};h&&!(h!=null&&h.relatedTarget)&&Object.assign({},h,L),(D=S.pointer)==null||D.onContainerMouseLeave(h||L)}S&&S.mouseIsDown||(Vn.hoverChartIndex=v.index)}touch(h,v){let S,{chart:D,pinchDown:L=[]}=this;this.setHoverChartIndex(),(h=this.normalize(h)).touches.length===1?D.isInsidePlot(h.chartX-D.plotLeft,h.chartY-D.plotTop,{visiblePlotOnly:!0})&&!D.openMenu?(v&&this.runPointActions(h),h.type==="touchmove"&&(S=!!L[0]&&Math.pow(L[0].chartX-h.chartX,2)+Math.pow(L[0].chartY-h.chartY,2)>=16),bo(S,!0)&&this.pinch(h)):v&&this.reset():h.touches.length===2&&this.pinch(h)}touchSelect(h){return!!(this.chart.zooming.singleTouch&&h.touches&&h.touches.length===1)}zoomOption(h){let v=this.chart,S=v.inverted,D=v.zooming.type||"",L,z;/touch/.test(h.type)&&(D=bo(v.zooming.pinchType,D)),this.zoomX=L=/x/.test(D),this.zoomY=z=/y/.test(D),this.zoomHor=L&&!S||z&&S,this.zoomVert=z&&!S||L&&S,this.hasZoom=L||z}}Vn.unbindDocumentMouseUp=[],function(Y){Y.compose=function(h){_p(Na,"Core.Pointer")&&Ss(h,"beforeRender",function(){this.pointer=new Y(this,this.options)})}}(Vn||(Vn={}));let _c=Vn,{fireEvent:yc,isArray:Gt,objectEach:li,uniqueKey:Ka}=Bi,on=class{constructor(Y={}){this.autoId=!Y.id,this.columns={},this.id=Y.id||Ka(),this.modified=this,this.rowCount=0,this.versionTag=Ka();let h=0;li(Y.columns||{},(v,S)=>{this.columns[S]=v.slice(),h=Math.max(h,v.length)}),this.applyRowCount(h)}applyRowCount(Y){this.rowCount=Y,li(this.columns,h=>{Gt(h)&&(h.length=Y)})}getColumn(Y,h){return this.columns[Y]}getColumns(Y,h){return(Y||Object.keys(this.columns)).reduce((v,S)=>(v[S]=this.columns[S],v),{})}getRow(Y,h){return(h||Object.keys(this.columns)).map(v=>{var S;return(S=this.columns[v])==null?void 0:S[Y]})}setColumn(Y,h=[],v=0,S){this.setColumns({[Y]:h},v,S)}setColumns(Y,h,v){let S=this.rowCount;li(Y,(D,L)=>{this.columns[L]=D.slice(),S=D.length}),this.applyRowCount(S),v!=null&&v.silent||(yc(this,"afterSetColumns"),this.versionTag=Ka())}setRow(Y,h=this.rowCount,v,S){let{columns:D}=this,L=v?this.rowCount+1:h+1;li(Y,(z,B)=>{let U=D[B]||(S==null?void 0:S.addColumns)!==!1&&Array(L);U&&(v?U.splice(h,0,z):U[h]=z,D[B]=U)}),L>this.rowCount&&this.applyRowCount(L),S!=null&&S.silent||(yc(this,"afterSetRows"),this.versionTag=Ka())}},{extend:dt,merge:Vf,pick:uh}=Bi;(function(Y){function h(v,S,D){var ft,St;let L=this.legendItem=this.legendItem||{},{chart:z,options:B}=this,{baseline:U=0,symbolWidth:X,symbolHeight:te}=v,K=this.symbol||"circle",re=te/2,ue=z.renderer,ge=L.group,ye=U-Math.round((((ft=v.fontMetrics)==null?void 0:ft.b)||te)*(D?.4:.3)),be={},_e,Fe=B.marker,ze=0;if(z.styledMode||(be["stroke-width"]=Math.min(B.lineWidth||0,24),B.dashStyle?be.dashstyle=B.dashStyle:B.linecap==="square"||(be["stroke-linecap"]="round")),L.line=ue.path().addClass("highcharts-graph").attr(be).add(ge),D&&(L.area=ue.path().addClass("highcharts-area").add(ge)),be["stroke-linecap"]&&(ze=Math.min(L.line.strokeWidth(),X)/2),X){let _t=[["M",ze,ye],["L",X-ze,ye]];L.line.attr({d:_t}),(St=L.area)==null||St.attr({d:[..._t,["L",X-ze,U],["L",ze,U]]})}if(Fe&&Fe.enabled!==!1&&X){let _t=Math.min(uh(Fe.radius,re),re);K.indexOf("url")===0&&(Fe=Vf(Fe,{width:te,height:te}),_t=0),L.symbol=_e=ue.symbol(K,X/2-_t,ye-_t,2*_t,2*_t,dt({context:"legend"},Fe)).addClass("highcharts-point").add(ge),_e.isMarker=!0}}Y.areaMarker=function(v,S){h.call(this,v,S,!0)},Y.lineMarker=h,Y.rectangle=function(v,S){let D=S.legendItem||{},L=v.options,z=v.symbolHeight,B=L.squareSymbol,U=B?z:v.symbolWidth;D.symbol=this.chart.renderer.rect(B?(v.symbolWidth-z)/2:0,v.baseline-z+1,U,z,uh(v.options.symbolRadius,z/2)).addClass("highcharts-point").attr({zIndex:3}).add(D.group)}})(ve||(ve={}));let hd=ve,{defaultOptions:yp}=zn,{extend:Uf,extendClass:jf,merge:_u}=Bi;(function(Y){function h(v,S){let D=yp.plotOptions||{},L=S.defaultOptions,z=S.prototype;return z.type=v,z.pointClass||(z.pointClass=Jo),!Y.seriesTypes[v]&&(L&&(D[v]=L),Y.seriesTypes[v]=S,!0)}Y.seriesTypes=Ve.seriesTypes,Y.registerSeriesType=h,Y.seriesType=function(v,S,D,L,z){let B=yp.plotOptions||{};if(S=S||"",B[v]=_u(B[S],D),delete Y.seriesTypes[v],h(v,jf(Y.seriesTypes[S]||function(){},L)),Y.seriesTypes[v].prototype.type=v,z){class U extends Jo{}Uf(U.prototype,z),Y.seriesTypes[v].prototype.pointClass=U}return Y.seriesTypes[v]}})(Se||(Se={}));let Hn=Se,{animObject:$f,setAnimation:Hf}=se,{defaultOptions:vc}=zn,{registerEventOptions:Dl}=Fa,{svg:vp,win:xp}=Ve,{seriesTypes:ea}=Hn,{arrayMax:yu,arrayMin:ua,clamp:Va,correctFloat:bp,crisp:ms,defined:Ts,destroyObjectProperties:hh,diffObjects:en,erase:Dr,error:dh,extend:wo,find:vu,fireEvent:tn,getClosestDistance:dd,getNestedProperty:xu,insertItem:ha,isArray:Rs,isNumber:ls,isString:ph,merge:Il,objectEach:fh,pick:ln,removeEvent:wp,syncTimeout:Ja}=Bi;class kl{constructor(){this.zoneAxis="y"}init(h,v){let S;tn(this,"init",{options:v}),this.dataTable??(this.dataTable=new on);let D=h.series;this.eventsToUnbind=[],this.chart=h,this.options=this.setOptions(v);let L=this.options,z=L.visible!==!1;this.linkedSeries=[],this.bindAxes(),wo(this,{name:L.name,state:"",visible:z,selected:L.selected===!0}),Dl(this,L);let B=L.events;(B&&B.click||L.point&&L.point.events&&L.point.events.click||L.allowPointSelect)&&(h.runTrackerClick=!0),this.getColor(),this.getSymbol(),this.isCartesian&&(h.hasCartesianSeries=!0),D.length&&(S=D[D.length-1]),this._i=ln(S&&S._i,-1)+1,this.opacity=this.options.opacity,h.orderItems("series",ha(this,D)),L.dataSorting&&L.dataSorting.enabled?this.setDataSortingOptions():this.points||this.data||this.setData(L.data,!1),tn(this,"afterInit")}is(h){return ea[h]&&this instanceof ea[h]}bindAxes(){let h,v=this,S=v.options,D=v.chart;tn(this,"bindAxes",null,function(){(v.axisTypes||[]).forEach(function(L){(D[L]||[]).forEach(function(z){h=z.options,(ln(S[L],0)===z.index||S[L]!==void 0&&S[L]===h.id)&&(ha(v,z.series),v[L]=z,z.isDirty=!0)}),v[L]||v.optionalAxis===L||dh(18,!0,D)})}),tn(this,"afterBindAxes")}hasData(){return this.visible&&this.dataMax!==void 0&&this.dataMin!==void 0||this.visible&&this.dataTable.rowCount>0}hasMarkerChanged(h,v){let S=h.marker,D=v.marker||{};return S&&(D.enabled&&!S.enabled||D.symbol!==S.symbol||D.height!==S.height||D.width!==S.width)}autoIncrement(h){let v,S=this.options,{pointIntervalUnit:D,relativeXValue:L}=this.options,z=this.chart.time,B=this.xIncrement??z.parse(S.pointStart)??0;if(this.pointInterval=v=ln(this.pointInterval,S.pointInterval,1),L&&ls(h)&&(v*=h),D){let U=z.toParts(B);D==="day"?U[2]+=v:D==="month"?U[1]+=v:D==="year"&&(U[0]+=v),v=z.makeTime.apply(z,U)-B}return L&&ls(h)?B+v:(this.xIncrement=B+v,B)}setDataSortingOptions(){let h=this.options;wo(this,{requireSorting:!1,sorted:!1,enabledDataSorting:!0,allowDG:!1}),Ts(h.pointRange)||(h.pointRange=1)}setOptions(h){var be,_e;let v,S=this.chart,D=S.options.plotOptions,L=S.userOptions||{},z=Il(h),B=S.styledMode,U={plotOptions:D,userOptions:z};tn(this,"setOptions",U);let X=U.plotOptions[this.type],te=L.plotOptions||{},K=te.series||{},re=vc.plotOptions[this.type]||{},ue=te[this.type]||{};this.userOptions=U.userOptions;let ge=Il(X,D.series,ue,z);this.tooltipOptions=Il(vc.tooltip,(be=vc.plotOptions.series)==null?void 0:be.tooltip,re==null?void 0:re.tooltip,S.userOptions.tooltip,(_e=te.series)==null?void 0:_e.tooltip,ue.tooltip,z.tooltip),this.stickyTracking=ln(z.stickyTracking,ue.stickyTracking,K.stickyTracking,!!this.tooltipOptions.shared&&!this.noSharedTooltip||ge.stickyTracking),X.marker===null&&delete ge.marker,this.zoneAxis=ge.zoneAxis||"y";let ye=this.zones=(ge.zones||[]).map(Fe=>({...Fe}));return(ge.negativeColor||ge.negativeFillColor)&&!ge.zones&&(v={value:ge[this.zoneAxis+"Threshold"]||ge.threshold||0,className:"highcharts-negative"},B||(v.color=ge.negativeColor,v.fillColor=ge.negativeFillColor),ye.push(v)),ye.length&&Ts(ye[ye.length-1].value)&&ye.push(B?{}:{color:this.color,fillColor:this.fillColor}),tn(this,"afterSetOptions",{options:ge}),ge}getName(){return ln(this.options.name,"Series "+(this.index+1))}getCyclic(h,v,S){let D,L,z=this.chart,B=`${h}Index`,U=`${h}Counter`,X=(S==null?void 0:S.length)||z.options.chart.colorCount;!v&&(Ts(L=ln(h==="color"?this.options.colorIndex:void 0,this[B]))?D=L:(z.series.length||(z[U]=0),D=z[U]%X,z[U]+=1),S&&(v=S[D])),D!==void 0&&(this[B]=D),this[h]=v}getColor(){this.chart.styledMode?this.getCyclic("color"):this.options.colorByPoint?this.color="#cccccc":this.getCyclic("color",this.options.color||vc.plotOptions[this.type].color,this.chart.options.colors)}getPointsCollection(){return(this.hasGroupedData?this.points:this.data)||[]}getSymbol(){let h=this.options.marker;this.getCyclic("symbol",h.symbol,this.chart.options.symbols)}getColumn(h,v){return(v?this.dataTable.modified:this.dataTable).getColumn(h,!0)||[]}findPointIndex(h,v){let S,D,L,z=h.id,B=h.x,U=this.points,X=this.options.dataSorting;if(z){let te=this.chart.get(z);te instanceof Jo&&(S=te)}else if(this.linkedParent||this.enabledDataSorting||this.options.relativeXValue){let te=K=>!K.touched&&K.index===h.index;if(X&&X.matchByName?te=K=>!K.touched&&K.name===h.name:this.options.relativeXValue&&(te=K=>!K.touched&&K.options.x===h.x),!(S=vu(U,te)))return}return S&&(L=S&&S.index)!==void 0&&(D=!0),L===void 0&&ls(B)&&(L=this.getColumn("x").indexOf(B,v)),L!==-1&&L!==void 0&&this.cropped&&(L=L>=this.cropStart?L-this.cropStart:L),!D&&ls(L)&&U[L]&&U[L].touched&&(L=void 0),L}updateData(h,v){let S=this.options,D=S.dataSorting,L=this.points,z=[],B=this.requireSorting,U=h.length===L.length,X,te,K,re,ue=!0;if(this.xIncrement=null,h.forEach(function(ye,be){let _e,Fe=Ts(ye)&&this.pointClass.prototype.optionsToObject.call({series:this},ye)||{},ze=Fe.x;Fe.id||ls(ze)?((_e=this.findPointIndex(Fe,re))===-1||_e===void 0?z.push(ye):L[_e]&&ye!==S.data[_e]?(L[_e].update(ye,!1,null,!1),L[_e].touched=!0,B&&(re=_e+1)):L[_e]&&(L[_e].touched=!0),(!U||be!==_e||D&&D.enabled||this.hasDerivedData)&&(X=!0)):z.push(ye)},this),X)for(te=L.length;te--;)(K=L[te])&&!K.touched&&K.remove&&K.remove(!1,v);else!U||D&&D.enabled?ue=!1:(h.forEach(function(ye,be){ye===L[be].y||L[be].destroyed||L[be].update(ye,!1,null,!1)}),z.length=0);if(L.forEach(function(ye){ye&&(ye.touched=!1)}),!ue)return!1;z.forEach(function(ye){this.addPoint(ye,!1,null,null,!1)},this);let ge=this.getColumn("x");return this.xIncrement===null&&ge.length&&(this.xIncrement=yu(ge),this.autoIncrement()),!0}dataColumnKeys(){return["x",...this.pointArrayMap||["y"]]}setData(h,v=!0,S,D){var Ot,Pt;let L=this.points,z=L&&L.length||0,B=this.options,U=this.chart,X=B.dataSorting,te=this.xAxis,K=B.turboThreshold,re=this.dataTable,ue=this.dataColumnKeys(),ge=this.pointValKey||"y",ye=(this.pointArrayMap||[]).length,be=B.keys,_e,Fe,ze=0,ft=1,St;U.options.chart.allowMutatingData||(B.data&&delete this.options.data,this.userOptions.data&&delete this.userOptions.data,St=Il(!0,h));let _t=(h=St||h||[]).length;if(X&&X.enabled&&(h=this.sortData(h)),U.options.chart.allowMutatingData&&D!==!1&&_t&&z&&!this.cropped&&!this.hasGroupedData&&this.visible&&!this.boosted&&(Fe=this.updateData(h,S)),!Fe){this.xIncrement=null,this.colorCounter=0;let Ft=K&&_t>K;if(Ft){let di=this.getFirstValidPoint(h),gi=this.getFirstValidPoint(h,_t-1,-1),Ai=ai=>!!(Rs(ai)&&(be||ls(ai[0])));if(ls(di)&&ls(gi)){let ai=[],Ei=[];for(let Zi of h)ai.push(this.autoIncrement()),Ei.push(Zi);re.setColumns({x:ai,[ge]:Ei})}else if(Ai(di)&&Ai(gi))if(ye){let ai=di.length===ye?1:0,Ei=Array(ue.length).fill(0).map(()=>[]);for(let Zi of h){ai&&Ei[0].push(this.autoIncrement());for(let kr=ai;kr<=ye;kr++)(Ot=Ei[kr])==null||Ot.push(Zi[kr-ai])}re.setColumns(ue.reduce((Zi,kr,Gi)=>(Zi[kr]=Ei[Gi],Zi),{}))}else{be&&(ze=be.indexOf("x"),ft=be.indexOf("y"),ze=ze>=0?ze:0,ft=ft>=0?ft:1),di.length===1&&(ft=0);let ai=[],Ei=[];if(ze===ft)for(let Zi of h)ai.push(this.autoIncrement()),Ei.push(Zi[ft]);else for(let Zi of h)ai.push(Zi[ze]),Ei.push(Zi[ft]);re.setColumns({x:ai,[ge]:Ei})}else Ft=!1}if(!Ft){let di=ue.reduce((gi,Ai)=>(gi[Ai]=[],gi),{});for(_e=0;_e<_t;_e++){let gi=this.pointClass.prototype.applyOptions.apply({series:this},[h[_e]]);for(let Ai of ue)di[Ai][_e]=gi[Ai]}re.setColumns(di)}for(ph(this.getColumn("y")[0])&&dh(14,!0,U),this.data=[],this.options.data=this.userOptions.data=h,_e=z;_e--;)(Pt=L[_e])==null||Pt.destroy();te&&(te.minRange=te.userMinRange),this.isDirty=U.isDirtyBox=!0,this.isDirtyData=!!L,S=!1}B.legendType==="point"&&(this.processData(),this.generatePoints()),v&&U.redraw(S)}sortData(h){let v=this,S=v.options.dataSorting.sortKey||"y",D=function(L,z){return Ts(z)&&L.pointClass.prototype.optionsToObject.call({series:L},z)||{}};return h.forEach(function(L,z){h[z]=D(v,L),h[z].index=z},this),h.concat().sort((L,z)=>{let B=xu(S,L),U=xu(S,z);return U<B?-1:U>B?1:0}).forEach(function(L,z){L.x=z},this),v.linkedSeries&&v.linkedSeries.forEach(function(L){let z=L.options,B=z.data;z.dataSorting&&z.dataSorting.enabled||!B||(B.forEach(function(U,X){B[X]=D(L,U),h[X]&&(B[X].x=h[X].x,B[X].index=X)}),L.setData(B,!1))}),h}getProcessedData(h){let v=this,{dataTable:S,isCartesian:D,options:L,xAxis:z}=v,B=L.cropThreshold,U=h||v.getExtremesFromAll,X=z==null?void 0:z.logarithmic,te=S.rowCount,K,re,ue=0,ge,ye,be,_e=v.getColumn("x"),Fe=S,ze=!1;return z&&(ye=(ge=z.getExtremes()).min,be=ge.max,ze=!!(z.categories&&!z.names.length),D&&v.sorted&&!U&&(!B||te>B||v.forceCrop)&&(_e[te-1]<ye||_e[0]>be?Fe=new on:v.getColumn(v.pointValKey||"y").length&&(_e[0]<ye||_e[te-1]>be)&&(Fe=(K=this.cropData(S,ye,be)).modified,ue=K.start,re=!0))),_e=Fe.getColumn("x")||[],{modified:Fe,cropped:re,cropStart:ue,closestPointRange:dd([X?_e.map(X.log2lin):_e],()=>v.requireSorting&&!ze&&dh(15,!1,v.chart))}}processData(h){let v=this.xAxis,S=this.dataTable;if(this.isCartesian&&!this.isDirty&&!v.isDirty&&!this.yAxis.isDirty&&!h)return!1;let D=this.getProcessedData();S.modified=D.modified,this.cropped=D.cropped,this.cropStart=D.cropStart,this.closestPointRange=this.basePointRange=D.closestPointRange,tn(this,"afterProcessData")}cropData(h,v,S){let D=h.getColumn("x",!0)||[],L=D.length,z={},B,U,X=0,te=L;for(B=0;B<L;B++)if(D[B]>=v){X=Math.max(0,B-1);break}for(U=B;U<L;U++)if(D[U]>S){te=U+1;break}for(let K of this.dataColumnKeys()){let re=h.getColumn(K,!0);re&&(z[K]=re.slice(X,te))}return{modified:new on({columns:z}),start:X,end:te}}generatePoints(){var St,_t;let h=this.options,v=this.processedData||h.data,S=this.dataTable.modified,D=this.getColumn("x",!0),L=this.pointClass,z=S.rowCount,B=this.cropStart||0,U=this.hasGroupedData,X=h.keys,te=[],K=h.dataGrouping&&h.dataGrouping.groupAll?B:0,re=(St=this.xAxis)==null?void 0:St.categories,ue=this.pointArrayMap||["y"],ge=this.dataColumnKeys(),ye,be,_e,Fe,ze=this.data,ft;if(!ze&&!U){let Ot=[];Ot.length=(v==null?void 0:v.length)||0,ze=this.data=Ot}for(X&&U&&(this.options.keys=!1),Fe=0;Fe<z;Fe++)be=B+Fe,U?((_e=new L(this,S.getRow(Fe,ge)||[])).dataGroup=this.groupMap[K+Fe],(_t=_e.dataGroup)!=null&&_t.options&&(_e.options=_e.dataGroup.options,wo(_e,_e.dataGroup.options),delete _e.dataLabels)):(_e=ze[be],ft=v?v[be]:S.getRow(Fe,ue),_e||ft===void 0||(ze[be]=_e=new L(this,ft,D[Fe]))),_e&&(_e.index=U?K+Fe:be,te[Fe]=_e,_e.category=(re==null?void 0:re[_e.x])??_e.x,_e.key=_e.name??_e.category);if(this.options.keys=X,ze&&(z!==(ye=ze.length)||U))for(Fe=0;Fe<ye;Fe++)Fe!==B||U||(Fe+=z),ze[Fe]&&(ze[Fe].destroyElements(),ze[Fe].plotX=void 0);this.data=ze,this.points=te,tn(this,"afterGeneratePoints")}getXExtremes(h){return{min:ua(h),max:yu(h)}}getExtremes(h,v){var St;let{xAxis:S,yAxis:D}=this,L=v||this.getExtremesFromAll||this.options.getExtremesFromAll,z=L&&this.cropped?this.dataTable:this.dataTable.modified,B=z.rowCount,U=h||this.stackedYData,X=U?[U]:((St=this.keysAffectYAxis||this.pointArrayMap||["y"])==null?void 0:St.map(_t=>z.getColumn(_t,!0)||[]))||[],te=this.getColumn("x",!0),K=[],re=this.requireSorting&&!this.is("column")?1:0,ue=!!D&&D.positiveValuesOnly,ge=L||this.cropped||!S,ye,be,_e,Fe=0,ze=0;for(S&&(Fe=(ye=S.getExtremes()).min,ze=ye.max),_e=0;_e<B;_e++)if(be=te[_e],ge||(te[_e+re]||be)>=Fe&&(te[_e-re]||be)<=ze)for(let _t of X){let Ot=_t[_e];ls(Ot)&&(Ot>0||!ue)&&K.push(Ot)}let ft={activeYData:K,dataMin:ua(K),dataMax:yu(K)};return tn(this,"afterGetExtremes",{dataExtremes:ft}),ft}applyExtremes(){let h=this.getExtremes();return this.dataMin=h.dataMin,this.dataMax=h.dataMax,h}getFirstValidPoint(h,v=0,S=1){let D=h.length,L=v;for(;L>=0&&L<D;){if(Ts(h[L]))return h[L];L+=S}}translate(){var Fe;this.generatePoints();let h=this.options,v=h.stacking,S=this.xAxis,D=this.enabledDataSorting,L=this.yAxis,z=this.points,B=z.length,U=this.pointPlacementToXValue(),X=!!U,te=h.threshold,K=h.startFromThreshold?te:0,re,ue,ge,ye,be=Number.MAX_VALUE;function _e(ze){return Va(ze,-1e9,1e9)}for(re=0;re<B;re++){let ze,ft=z[re],St=ft.x,_t,Ot,Pt=ft.y,Ft=ft.low,di=v&&((Fe=L.stacking)==null?void 0:Fe.stacks[(this.negStacks&&Pt<(K?0:te)?"-":"")+this.stackKey]);ue=S.translate(St,!1,!1,!1,!0,U),ft.plotX=ls(ue)?bp(_e(ue)):void 0,v&&this.visible&&di&&di[St]&&(ye=this.getStackIndicator(ye,St,this.index),!ft.isNull&&ye.key&&(Ot=(_t=di[St]).points[ye.key]),_t&&Rs(Ot)&&(Ft=Ot[0],Pt=Ot[1],Ft===K&&ye.key===di[St].base&&(Ft=ln(ls(te)?te:L.min)),L.positiveValuesOnly&&Ts(Ft)&&Ft<=0&&(Ft=void 0),ft.total=ft.stackTotal=ln(_t.total),ft.percentage=Ts(ft.y)&&_t.total?ft.y/_t.total*100:void 0,ft.stackY=Pt,this.irregularWidths||_t.setOffset(this.pointXOffset||0,this.barW||0,void 0,void 0,void 0,this.xAxis))),ft.yBottom=Ts(Ft)?_e(L.translate(Ft,!1,!0,!1,!0)):void 0,this.dataModify&&(Pt=this.dataModify.modifyValue(Pt,re)),ls(Pt)&&ft.plotX!==void 0&&(ze=ls(ze=L.translate(Pt,!1,!0,!1,!0))?_e(ze):void 0),ft.plotY=ze,ft.isInside=this.isPointInside(ft),ft.clientX=X?bp(S.translate(St,!1,!1,!1,!0,U)):ue,ft.negative=(ft.y||0)<(te||0),ft.isNull||ft.visible===!1||(ge!==void 0&&(be=Math.min(be,Math.abs(ue-ge))),ge=ue),ft.zone=this.zones.length?ft.getZone():void 0,!ft.graphic&&this.group&&D&&(ft.isNew=!0)}this.closestPointRangePx=be,tn(this,"afterTranslate")}getValidPoints(h,v,S){let D=this.chart;return(h||this.points||[]).filter(function(L){let{plotX:z,plotY:B}=L;return!!((S||!L.isNull&&ls(B))&&(!v||D.isInsidePlot(z,B,{inverted:D.inverted})))&&L.visible!==!1})}getClipBox(){let{chart:h,xAxis:v,yAxis:S}=this,{x:D,y:L,width:z,height:B}=Il(h.clipBox);return v&&v.len!==h.plotSizeX&&(z=v.len),S&&S.len!==h.plotSizeY&&(B=S.len),h.inverted&&!this.invertible&&([z,B]=[B,z]),{x:D,y:L,width:z,height:B}}getSharedClipKey(){return this.sharedClipKey=(this.options.xAxis||0)+","+(this.options.yAxis||0),this.sharedClipKey}setClip(){let{chart:h,group:v,markerGroup:S}=this,D=h.sharedClips,L=h.renderer,z=this.getClipBox(),B=this.getSharedClipKey(),U=D[B];U?U.animate(z):D[B]=U=L.clipRect(z),v&&v.clip(this.options.clip===!1?void 0:U),S&&S.clip()}animate(h){let{chart:v,group:S,markerGroup:D}=this,L=v.inverted,z=$f(this.options.animation),B=[this.getSharedClipKey(),z.duration,z.easing,z.defer].join(","),U=v.sharedClips[B],X=v.sharedClips[B+"m"];if(h&&S){let te=this.getClipBox();if(U)U.attr("height",te.height);else{te.width=0,L&&(te.x=v.plotHeight),U=v.renderer.clipRect(te),v.sharedClips[B]=U;let K={x:-99,y:-99,width:L?v.plotWidth+199:99,height:L?99:v.plotHeight+199};X=v.renderer.clipRect(K),v.sharedClips[B+"m"]=X}S.clip(U),D==null||D.clip(X)}else if(U&&!U.hasClass("highcharts-animating")){let te=this.getClipBox(),K=z.step;(D!=null&&D.element.childNodes.length||v.series.length>1)&&(z.step=function(re,ue){K&&K.apply(ue,arguments),ue.prop==="width"&&(X!=null&&X.element)&&X.attr(L?"height":"width",re+99)}),U.addClass("highcharts-animating").animate(te,z)}}afterAnimate(){this.setClip(),fh(this.chart.sharedClips,(h,v,S)=>{h&&!this.chart.container.querySelector(`[clip-path="url(#${h.id})"]`)&&(h.destroy(),delete S[v])}),this.finishedAnimating=!0,tn(this,"afterAnimate")}drawPoints(h=this.points){let v,S,D,L,z,B,U,X=this.chart,te=X.styledMode,{colorAxis:K,options:re}=this,ue=re.marker,ge=this[this.specialGroup||"markerGroup"],ye=this.xAxis,be=ln(ue.enabled,!ye||!!ye.isRadial||null,this.closestPointRangePx>=ue.enabledThreshold*ue.radius);if(ue.enabled!==!1||this._hasPointMarkers)for(v=0;v<h.length;v++)if(L=(D=(S=h[v]).graphic)?"animate":"attr",z=S.marker||{},B=!!S.marker,(be&&z.enabled===void 0||z.enabled)&&!S.isNull&&S.visible!==!1){let _e=ln(z.symbol,this.symbol,"rect");U=this.markerAttribs(S,S.selected&&"select"),this.enabledDataSorting&&(S.startXPos=ye.reversed?-(U.width||0):ye.width);let Fe=S.isInside!==!1;if(!D&&Fe&&((U.width||0)>0||S.hasImage)&&(S.graphic=D=X.renderer.symbol(_e,U.x,U.y,U.width,U.height,B?z:ue).add(ge),this.enabledDataSorting&&X.hasRendered&&(D.attr({x:S.startXPos}),L="animate")),D&&L==="animate"&&D[Fe?"show":"hide"](Fe).animate(U),D){let ze=this.pointAttribs(S,te||!S.selected?void 0:"select");te?K&&D.css({fill:ze.fill}):D[L](ze)}D&&D.addClass(S.getClassName(),!0)}else D&&(S.graphic=D.destroy())}markerAttribs(h,v){let S=this.options,D=S.marker,L=h.marker||{},z=L.symbol||D.symbol,B={},U,X,te=ln(L.radius,D&&D.radius);v&&(U=D.states[v],te=ln((X=L.states&&L.states[v])&&X.radius,U&&U.radius,te&&te+(U&&U.radiusPlus||0))),h.hasImage=z&&z.indexOf("url")===0,h.hasImage&&(te=0);let K=h.pos();return ls(te)&&K&&(S.crisp&&(K[0]=ms(K[0],h.hasImage?0:z==="rect"?(D==null?void 0:D.lineWidth)||0:1)),B.x=K[0]-te,B.y=K[1]-te),te&&(B.width=B.height=2*te),B}pointAttribs(h,v){let S=this.options.marker,D=h&&h.options,L=D&&D.marker||{},z=D&&D.color,B=h&&h.color,U=h&&h.zone&&h.zone.color,X,te,K=this.color,re,ue,ge=ln(L.lineWidth,S.lineWidth),ye=1;return K=z||U||B||K,re=L.fillColor||S.fillColor||K,ue=L.lineColor||S.lineColor||K,v=v||"normal",X=S.states[v]||{},ge=ln((te=L.states&&L.states[v]||{}).lineWidth,X.lineWidth,ge+ln(te.lineWidthPlus,X.lineWidthPlus,0)),re=te.fillColor||X.fillColor||re,{stroke:ue=te.lineColor||X.lineColor||ue,"stroke-width":ge,fill:re,opacity:ye=ln(te.opacity,X.opacity,ye)}}destroy(h){let v,S,D,L=this,z=L.chart,B=/AppleWebKit\/533/.test(xp.navigator.userAgent),U=L.data||[];for(tn(L,"destroy",{keepEventsForUpdate:h}),this.removeEvents(h),(L.axisTypes||[]).forEach(function(X){(D=L[X])&&D.series&&(Dr(D.series,L),D.isDirty=D.forceRedraw=!0)}),L.legendItem&&L.chart.legend.destroyItem(L),v=U.length;v--;)(S=U[v])&&S.destroy&&S.destroy();for(let X of L.zones)hh(X,void 0,!0);Bi.clearTimeout(L.animationTimeout),fh(L,function(X,te){X instanceof _o&&!X.survive&&X[B&&te==="group"?"hide":"destroy"]()}),z.hoverSeries===L&&(z.hoverSeries=void 0),Dr(z.series,L),z.orderItems("series"),fh(L,function(X,te){h&&te==="hcEvents"||delete L[te]})}applyZones(){let{area:h,chart:v,graph:S,zones:D,points:L,xAxis:z,yAxis:B,zoneAxis:U}=this,{inverted:X,renderer:te}=v,K=this[`${U}Axis`],{isXAxis:re,len:ue=0,minPointOffset:ge=0}=K||{},ye=((S==null?void 0:S.strokeWidth())||0)/2+1,be=(_e,Fe=0,ze=0)=>{X&&(ze=ue-ze);let{translated:ft=0,lineClip:St}=_e,_t=ze-ft;St==null||St.push(["L",Fe,Math.abs(_t)<ye?ze-ye*(_t<=0?-1:1):ft])};if(D.length&&(S||h)&&K&&ls(K.min)){let _e=K.getExtremes().max+ge,Fe=St=>{St.forEach((_t,Ot)=>{(_t[0]==="M"||_t[0]==="L")&&(St[Ot]=[_t[0],re?ue-_t[1]:_t[1],re?_t[2]:ue-_t[2]])})};if(D.forEach(St=>{St.lineClip=[],St.translated=Va(K.toPixels(ln(St.value,_e),!0)||0,0,ue)}),S&&!this.showLine&&S.hide(),h&&h.hide(),U==="y"&&L.length<z.len)for(let St of L){let{plotX:_t,plotY:Ot,zone:Pt}=St,Ft=Pt&&D[D.indexOf(Pt)-1];Pt&&be(Pt,_t,Ot),Ft&&be(Ft,_t,Ot)}let ze=[],ft=K.toPixels(K.getExtremes().min-ge,!0);D.forEach(St=>{var kr,Gi;let _t=St.lineClip||[],Ot=Math.round(St.translated||0);z.reversed&&_t.reverse();let{clip:Pt,simpleClip:Ft}=St,di=0,gi=0,Ai=z.len,ai=B.len;re?(di=Ot,Ai=ft):(gi=Ot,ai=ft);let Ei=[["M",di,gi],["L",Ai,gi],["L",Ai,ai],["L",di,ai],["Z"]],Zi=[Ei[0],..._t,Ei[1],Ei[2],...ze,Ei[3],Ei[4]];ze=_t.reverse(),ft=Ot,X&&(Fe(Zi),h&&Fe(Ei)),Pt?(Pt.animate({d:Zi}),Ft==null||Ft.animate({d:Ei})):(Pt=St.clip=te.path(Zi),h&&(Ft=St.simpleClip=te.path(Ei))),S&&((kr=St.graph)==null||kr.clip(Pt)),h&&((Gi=St.area)==null||Gi.clip(Ft))})}else this.visible&&(S&&S.show(),h&&h.show())}plotGroup(h,v,S,D,L){let z=this[h],B=!z,U={visibility:S,zIndex:D||.1};return Ts(this.opacity)&&!this.chart.styledMode&&this.state!=="inactive"&&(U.opacity=this.opacity),z||(this[h]=z=this.chart.renderer.g().add(L)),z.addClass("highcharts-"+v+" highcharts-series-"+this.index+" highcharts-"+this.type+"-series "+(Ts(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(z.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0),z.attr(U)[B?"attr":"animate"](this.getPlotBox(v)),z}getPlotBox(h){let v=this.xAxis,S=this.yAxis,D=this.chart,L=D.inverted&&!D.polar&&v&&this.invertible&&h==="series";return D.inverted&&(v=S,S=this.xAxis),{translateX:v?v.left:D.plotLeft,translateY:S?S.top:D.plotTop,rotation:L?90:0,rotationOriginX:L?(v.len-S.len)/2:0,rotationOriginY:L?(v.len+S.len)/2:0,scaleX:L?-1:1,scaleY:1}}removeEvents(h){let{eventsToUnbind:v}=this;h||wp(this),v.length&&(v.forEach(S=>{S()}),v.length=0)}render(){var te,K,re,ue,ge;let h=this,{chart:v,options:S,hasRendered:D}=h,L=$f(S.animation),z=h.visible?"inherit":"hidden",B=S.zIndex,U=v.seriesGroup,X=h.finishedAnimating?0:L.duration;tn(this,"render"),h.plotGroup("group","series",z,B,U),h.markerGroup=h.plotGroup("markerGroup","markers",z,B,U),S.clip!==!1&&h.setClip(),X&&((te=h.animate)==null||te.call(h,!0)),h.drawGraph&&(h.drawGraph(),h.applyZones()),h.visible&&h.drawPoints(),(K=h.drawDataLabels)==null||K.call(h),(re=h.redrawPoints)==null||re.call(h),S.enableMouseTracking&&((ue=h.drawTracker)==null||ue.call(h)),X&&((ge=h.animate)==null||ge.call(h)),D||(X&&L.defer&&(X+=L.defer),h.animationTimeout=Ja(()=>{h.afterAnimate()},X||0)),h.isDirty=!1,h.hasRendered=!0,tn(h,"afterRender")}redraw(){let h=this.isDirty||this.isDirtyData;this.translate(),this.render(),h&&delete this.kdTree}reserveSpace(){return this.visible||!this.chart.options.chart.ignoreHiddenSeries}searchPoint(h,v){let{xAxis:S,yAxis:D}=this,L=this.chart.inverted;return this.searchKDTree({clientX:L?S.len-h.chartY+S.pos:h.chartX-S.pos,plotY:L?D.len-h.chartX+D.pos:h.chartY-D.pos},v,h)}buildKDTree(h){this.buildingKdTree=!0;let v=this,S=v.options.findNearestPointBy.indexOf("y")>-1?2:1;delete v.kdTree,Ja(function(){v.kdTree=function D(L,z,B){let U,X,te=L==null?void 0:L.length;if(te)return U=v.kdAxisArray[z%B],L.sort((K,re)=>(K[U]||0)-(re[U]||0)),{point:L[X=Math.floor(te/2)],left:D(L.slice(0,X),z+1,B),right:D(L.slice(X+1),z+1,B)}}(v.getValidPoints(void 0,!v.directTouch),S,S),v.buildingKdTree=!1},v.options.kdNow||(h==null?void 0:h.type)==="touchstart"?0:1)}searchKDTree(h,v,S,D,L){let z=this,[B,U]=this.kdAxisArray,X=v?"distX":"dist",te=(z.options.findNearestPointBy||"").indexOf("y")>-1?2:1,K=!!z.isBubble,re=D||((ge,ye,be)=>[(ge[be]||0)<(ye[be]||0)?ge:ye,!1]),ue=L||((ge,ye)=>ge<ye);if(this.kdTree||this.buildingKdTree||this.buildKDTree(S),this.kdTree)return function ge(ye,be,_e,Fe){var di;let ze=be.point,ft=z.kdAxisArray[_e%Fe],St=ze,_t=!1;(function(gi,Ai){var Qi;let ai=gi[B],Ei=Ai[B],Zi=Ts(ai)&&Ts(Ei)?ai-Ei:null,kr=gi[U],Gi=Ai[U],gr=Ts(kr)&&Ts(Gi)?kr-Gi:0,Vi=K&&((Qi=Ai.marker)==null?void 0:Qi.radius)||0;Ai.dist=Math.sqrt((Zi&&Zi*Zi||0)+gr*gr)-Vi,Ai.distX=Ts(Zi)?Math.abs(Zi)-Vi:Number.MAX_VALUE})(ye,ze);let Ot=(ye[ft]||0)-(ze[ft]||0)+(K&&((di=ze.marker)==null?void 0:di.radius)||0),Pt=Ot<0?"left":"right",Ft=Ot<0?"right":"left";return be[Pt]&&([St,_t]=re(ze,ge(ye,be[Pt],_e+1,Fe),X)),be[Ft]&&ue(Math.sqrt(Ot*Ot),St[X],_t)&&(St=re(St,ge(ye,be[Ft],_e+1,Fe),X)[0]),St}(h,this.kdTree,te,te)}pointPlacementToXValue(){let{options:h,xAxis:v}=this,S=h.pointPlacement;return S==="between"&&(S=v.reversed?-.5:.5),ls(S)?S*(h.pointRange||v.pointRange):0}isPointInside(h){let{chart:v,xAxis:S,yAxis:D}=this,{plotX:L=-1,plotY:z=-1}=h;return z>=0&&z<=(D?D.len:v.plotHeight)&&L>=0&&L<=(S?S.len:v.plotWidth)}drawTracker(){var re;let h=this,v=h.options,S=v.trackByArea,D=[].concat((S?h.areaPath:h.graphPath)||[]),L=h.chart,z=L.pointer,B=L.renderer,U=((re=L.options.tooltip)==null?void 0:re.snap)||0,X=()=>{v.enableMouseTracking&&L.hoverSeries!==h&&h.onMouseOver()},te="rgba(192,192,192,"+(vp?1e-4:.002)+")",K=h.tracker;K?K.attr({d:D}):h.graph&&(h.tracker=K=B.path(D).attr({visibility:h.visible?"inherit":"hidden",zIndex:2}).addClass(S?"highcharts-tracker-area":"highcharts-tracker-line").add(h.group),L.styledMode||K.attr({"stroke-linecap":"round","stroke-linejoin":"round",stroke:te,fill:S?te:"none","stroke-width":h.graph.strokeWidth()+(S?0:2*U)}),[h.tracker,h.markerGroup,h.dataLabelsGroup].forEach(ue=>{ue&&(ue.addClass("highcharts-tracker").on("mouseover",X).on("mouseout",ge=>{z==null||z.onTrackerMouseOut(ge)}),v.cursor&&!L.styledMode&&ue.css({cursor:v.cursor}),ue.on("touchstart",X))})),tn(this,"afterDrawTracker")}addPoint(h,v,S,D,L){let z,B,U=this.options,{chart:X,data:te,dataTable:K,xAxis:re}=this,ue=re&&re.hasNames&&re.names,ge=U.data,ye=this.getColumn("x");v=ln(v,!0);let be={series:this};this.pointClass.prototype.applyOptions.apply(be,[h]);let _e=be.x;if(B=ye.length,this.requireSorting&&_e<ye[B-1])for(z=!0;B&&ye[B-1]>_e;)B--;K.setRow(be,B,!0,{addColumns:!1}),ue&&be.name&&(ue[_e]=be.name),ge==null||ge.splice(B,0,h),(z||this.processedData)&&(this.data.splice(B,0,null),this.processData()),U.legendType==="point"&&this.generatePoints(),S&&(te[0]&&te[0].remove?te[0].remove(!1):([te,ge,...Object.values(K.getColumns())].filter(Ts).forEach(Fe=>{Fe.shift()}),K.rowCount-=1,tn(K,"afterDeleteRows"))),L!==!1&&tn(this,"addPoint",{point:be}),this.isDirty=!0,this.isDirtyData=!0,v&&X.redraw(D)}removePoint(h,v,S){let D=this,{chart:L,data:z,points:B,dataTable:U}=D,X=z[h],te=function(){[(B==null?void 0:B.length)===z.length?B:void 0,z,D.options.data,...Object.values(U.getColumns())].filter(Ts).forEach(K=>{K.splice(h,1)}),U.rowCount-=1,tn(U,"afterDeleteRows"),X==null||X.destroy(),D.isDirty=!0,D.isDirtyData=!0,v&&L.redraw()};Hf(S,L),v=ln(v,!0),X?X.firePointEvent("remove",null,te):te()}remove(h,v,S,D){let L=this,z=L.chart;function B(){L.destroy(D),z.isDirtyLegend=z.isDirtyBox=!0,z.linkSeries(D),ln(h,!0)&&z.redraw(v)}S!==!1?tn(L,"remove",null,B):B()}update(h,v){var _e,Fe;tn(this,"update",{options:h=en(h,this.userOptions)});let S=this,D=S.chart,L=S.userOptions,z=S.initialType||S.type,B=D.options.plotOptions,U=ea[z].prototype,X=S.finishedAnimating&&{animation:!1},te={},K,re,ue=["colorIndex","eventOptions","navigatorSeries","symbolIndex","baseSeries"],ge=h.type||L.type||D.options.chart.type,ye=!(this.hasDerivedData||ge&&ge!==this.type||h.keys!==void 0||h.pointStart!==void 0||h.pointInterval!==void 0||h.relativeXValue!==void 0||h.joinBy||h.mapData||["dataGrouping","pointStart","pointInterval","pointIntervalUnit","keys"].some(ze=>S.hasOptionChanged(ze)));ge=ge||z,ye?(ue.push("data","isDirtyData","isDirtyCanvas","points","dataTable","processedData","xIncrement","cropped","_hasPointMarkers","hasDataLabels","nodes","layout","level","mapMap","mapData","minY","maxY","minX","maxX","transformGroups"),h.visible!==!1&&ue.push("area","graph"),S.parallelArrays.forEach(function(ze){ue.push(ze+"Data")}),h.data&&(h.dataSorting&&wo(S.options.dataSorting,h.dataSorting),this.setData(h.data,!1))):this.dataTable.modified=this.dataTable,h=Il(L,{index:L.index===void 0?S.index:L.index,pointStart:((_e=B==null?void 0:B.series)==null?void 0:_e.pointStart)??L.pointStart??S.getColumn("x")[0]},!ye&&{data:S.options.data},h,X),ye&&h.data&&(h.data=S.options.data),(ue=["group","markerGroup","dataLabelsGroup","transformGroup"].concat(ue)).forEach(function(ze){ue[ze]=S[ze],delete S[ze]});let be=!1;if(ea[ge]){if(be=ge!==S.type,S.remove(!1,!1,!1,!0),be)if(D.propFromSeries(),Object.setPrototypeOf)Object.setPrototypeOf(S,ea[ge].prototype);else{let ze=Object.hasOwnProperty.call(S,"hcEvents")&&S.hcEvents;for(re in U)S[re]=void 0;wo(S,ea[ge].prototype),ze?S.hcEvents=ze:delete S.hcEvents}}else dh(17,!0,D,{missingModuleFor:ge});if(ue.forEach(function(ze){S[ze]=ue[ze]}),S.init(D,h),ye&&this.points)for(let ze of((K=S.options).visible===!1?(te.graphic=1,te.dataLabel=1):(this.hasMarkerChanged(K,L)&&(te.graphic=1),(Fe=S.hasDataLabels)!=null&&Fe.call(S)||(te.dataLabel=1)),this.points))ze&&ze.series&&(ze.resolveColor(),Object.keys(te).length&&ze.destroyElements(te),K.showInLegend===!1&&ze.legendItem&&D.legend.destroyItem(ze));S.initialType=z,D.linkSeries(),D.setSortedData(),be&&S.linkedSeries.length&&(S.isDirtyData=!0),tn(this,"afterUpdate"),ln(v,!0)&&D.redraw(!!ye&&void 0)}setName(h){this.name=this.options.name=this.userOptions.name=h,this.chart.isDirtyLegend=!0}hasOptionChanged(h){var B,U;let v=this.chart,S=this.options[h],D=v.options.plotOptions,L=this.userOptions[h],z=ln((B=D==null?void 0:D[this.type])==null?void 0:B[h],(U=D==null?void 0:D.series)==null?void 0:U[h]);return L&&!Ts(z)?S!==L:S!==ln(z,S)}onMouseOver(){let h=this.chart,v=h.hoverSeries,S=h.pointer;S==null||S.setHoverChartIndex(),v&&v!==this&&v.onMouseOut(),this.options.events.mouseOver&&tn(this,"mouseOver"),this.setState("hover"),h.hoverSeries=this}onMouseOut(){let h=this.options,v=this.chart,S=v.tooltip,D=v.hoverPoint;v.hoverSeries=null,D&&D.onMouseOut(),this&&h.events.mouseOut&&tn(this,"mouseOut"),S&&!this.stickyTracking&&(!S.shared||this.noSharedTooltip)&&S.hide(),v.series.forEach(function(L){L.setState("",!0)})}setState(h,v){let S=this,D=S.options,L=S.graph,z=D.inactiveOtherPoints,B=D.states,U=ln(B[h||"normal"]&&B[h||"normal"].animation,S.chart.options.chart.animation),X=D.lineWidth,te=D.opacity;if(h=h||"",S.state!==h&&([S.group,S.markerGroup,S.dataLabelsGroup].forEach(function(K){K&&(S.state&&K.removeClass("highcharts-series-"+S.state),h&&K.addClass("highcharts-series-"+h))}),S.state=h,!S.chart.styledMode)){if(B[h]&&B[h].enabled===!1)return;if(h&&(X=B[h].lineWidth||X+(B[h].lineWidthPlus||0),te=ln(B[h].opacity,te)),L&&!L.dashstyle&&ls(X))for(let K of[L,...this.zones.map(re=>re.graph)])K==null||K.animate({"stroke-width":X},U);z||[S.group,S.markerGroup,S.dataLabelsGroup,S.labelBySeries].forEach(function(K){K&&K.animate({opacity:te},U)})}v&&z&&S.points&&S.setAllPointsToState(h||void 0)}setAllPointsToState(h){this.points.forEach(function(v){v.setState&&v.setState(h)})}setVisible(h,v){var U;let S=this,D=S.chart,L=D.options.chart.ignoreHiddenSeries,z=S.visible;S.visible=h=S.options.visible=S.userOptions.visible=h===void 0?!z:h;let B=h?"show":"hide";["group","dataLabelsGroup","markerGroup","tracker","tt"].forEach(X=>{var te;(te=S[X])==null||te[B]()}),(D.hoverSeries===S||((U=D.hoverPoint)==null?void 0:U.series)===S)&&S.onMouseOut(),S.legendItem&&D.legend.colorizeItem(S,h),S.isDirty=!0,S.options.stacking&&D.series.forEach(X=>{X.options.stacking&&X.visible&&(X.isDirty=!0)}),S.linkedSeries.forEach(X=>{X.setVisible(h,!1)}),L&&(D.isDirtyBox=!0),tn(S,B),v!==!1&&D.redraw()}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}select(h){this.selected=h=this.options.selected=h===void 0?!this.selected:h,this.checkbox&&(this.checkbox.checked=h),tn(this,h?"select":"unselect")}shouldShowTooltip(h,v,S={}){return S.series=this,S.visiblePlotOnly=!0,this.chart.isInsidePlot(h,v,S)}drawLegendSymbol(h,v){var S;(S=hd[this.options.legendSymbol||"rectangle"])==null||S.call(this,h,v)}}kl.defaultOptions={lineWidth:2,allowPointSelect:!1,crisp:!0,showCheckbox:!1,animation:{duration:1e3},enableMouseTracking:!0,events:{},marker:{enabledThreshold:2,lineColor:"#ffffff",lineWidth:0,radius:4,states:{normal:{animation:!0},hover:{animation:{duration:150},enabled:!0,radiusPlus:2,lineWidthPlus:1},select:{fillColor:"#cccccc",lineColor:"#000000",lineWidth:2}}},point:{events:{}},dataLabels:{animation:{},align:"center",borderWidth:0,defer:!0,formatter:function(){let{numberFormatter:Y}=this.series.chart;return typeof this.y!="number"?"":Y(this.y,-1)},padding:5,style:{fontSize:"0.7em",fontWeight:"bold",color:"contrast",textOutline:"1px contrast"},verticalAlign:"bottom",x:0,y:0},cropThreshold:300,opacity:1,pointRange:0,softThreshold:!0,states:{normal:{animation:!0},hover:{animation:{duration:150},lineWidthPlus:1,marker:{},halo:{size:10,opacity:.25}},select:{animation:{duration:0}},inactive:{animation:{duration:150},opacity:.2}},stickyTracking:!0,turboThreshold:1e3,findNearestPointBy:"x"},kl.types=Hn.seriesTypes,kl.registerType=Hn.registerSeriesType,wo(kl.prototype,{axisTypes:["xAxis","yAxis"],coll:"series",colorCounter:0,directTouch:!1,invertible:!0,isCartesian:!0,kdAxisArray:["clientX","plotY"],parallelArrays:["x","y"],pointClass:Jo,requireSorting:!0,sorted:!0}),Hn.series=kl;let eo=kl,{animObject:Sp,setAnimation:Tp}=se,{registerEventOptions:gs}=Fa,{composed:Mp,marginNames:pd}=Ve,{distribute:mh}=qo,{format:Ol}=Po,{addEvent:xc,createElement:Ua,css:fd,defined:Ll,discardElement:Cp,find:Ep,fireEvent:Fo,isNumber:bu,merge:Qa,pick:oo,pushUnique:Gf,relativeLength:Ap,stableSort:gh,syncTimeout:Wf}=Bi;class md{constructor(h,v){this.allItems=[],this.initialItemY=0,this.itemHeight=0,this.itemMarginBottom=0,this.itemMarginTop=0,this.itemX=0,this.itemY=0,this.lastItemY=0,this.lastLineHeight=0,this.legendHeight=0,this.legendWidth=0,this.maxItemWidth=0,this.maxLegendWidth=0,this.offsetWidth=0,this.padding=0,this.pages=[],this.symbolHeight=0,this.symbolWidth=0,this.titleHeight=0,this.totalItemWidth=0,this.widthOption=0,this.chart=h,this.setOptions(v),v.enabled&&(this.render(),gs(this,v),xc(this.chart,"endResize",function(){this.legend.positionCheckboxes()})),xc(this.chart,"render",()=>{this.options.enabled&&this.proximate&&(this.proximatePositions(),this.positionItems())})}setOptions(h){let v=oo(h.padding,8);this.options=h,this.chart.styledMode||(this.itemStyle=h.itemStyle,this.itemHiddenStyle=Qa(this.itemStyle,h.itemHiddenStyle)),this.itemMarginTop=h.itemMarginTop,this.itemMarginBottom=h.itemMarginBottom,this.padding=v,this.initialItemY=v-5,this.symbolWidth=oo(h.symbolWidth,16),this.pages=[],this.proximate=h.layout==="proximate"&&!this.chart.inverted,this.baseline=void 0}update(h,v){let S=this.chart;this.setOptions(Qa(!0,this.options,h)),"events"in this.options&&gs(this,this.options),this.destroy(),S.isDirtyLegend=S.isDirtyBox=!0,oo(v,!0)&&S.redraw(),Fo(this,"afterUpdate",{redraw:v})}colorizeItem(h,v){var X;let S=h.color,{area:D,group:L,label:z,line:B,symbol:U}=h.legendItem||{};if((h instanceof eo||h instanceof Jo)&&(h.color=((X=h.options)==null?void 0:X.legendSymbolColor)||S),L==null||L[v?"removeClass":"addClass"]("highcharts-legend-item-hidden"),!this.chart.styledMode){let{itemHiddenStyle:te={}}=this,K=te.color,{fillColor:re,fillOpacity:ue,lineColor:ge,marker:ye}=h.options,be=_e=>(!v&&(_e.fill&&(_e.fill=K),_e.stroke&&(_e.stroke=K)),_e);z==null||z.css(Qa(v?this.itemStyle:te)),B==null||B.attr(be({stroke:ge||h.color})),U&&U.attr(be(ye&&U.isMarker?h.pointAttribs():{fill:h.color})),D==null||D.attr(be({fill:re||h.color,"fill-opacity":re?1:ue??.75}))}h.color=S,Fo(this,"afterColorizeItem",{item:h,visible:v})}positionItems(){this.allItems.forEach(this.positionItem,this),this.chart.isResizing||this.positionCheckboxes()}positionItem(h){let{group:v,x:S=0,y:D=0}=h.legendItem||{},L=this.options,z=L.symbolPadding,B=!L.rtl,U=h.checkbox;if(v&&v.element){let X={translateX:B?S:this.legendWidth-S-2*z-4,translateY:D};v[Ll(v.translateY)?"animate":"attr"](X,void 0,()=>{Fo(this,"afterPositionItem",{item:h})})}U&&(U.x=S,U.y=D)}destroyItem(h){let v=h.checkbox,S=h.legendItem||{};for(let D of["group","label","line","symbol"])S[D]&&(S[D]=S[D].destroy());v&&Cp(v),h.legendItem=void 0}destroy(){for(let h of this.getAllItems())this.destroyItem(h);for(let h of["clipRect","up","down","pager","nav","box","title","group"])this[h]&&(this[h]=this[h].destroy());this.display=null}positionCheckboxes(){let h,v=this.group&&this.group.alignAttr,S=this.clipHeight||this.legendHeight,D=this.titleHeight;v&&(h=v.translateY,this.allItems.forEach(function(L){let z,B=L.checkbox;B&&(z=h+D+B.y+(this.scrollOffset||0)+3,fd(B,{left:v.translateX+L.checkboxOffset+B.x-20+"px",top:z+"px",display:this.proximate||z>h-6&&z<h+S-6?"":"none"}))},this))}renderTitle(){let h=this.options,v=this.padding,S=h.title,D,L=0;S.text&&(this.title||(this.title=this.chart.renderer.label(S.text,v-3,v-4,void 0,void 0,void 0,h.useHTML,void 0,"legend-title").attr({zIndex:1}),this.chart.styledMode||this.title.css(S.style),this.title.add(this.group)),S.width||this.title.css({width:this.maxLegendWidth+"px"}),L=(D=this.title.getBBox()).height,this.offsetWidth=D.width,this.contentGroup.attr({translateY:L})),this.titleHeight=L}setText(h){let v=this.options;h.legendItem.label.attr({text:v.labelFormat?Ol(v.labelFormat,h,this.chart):v.labelFormatter.call(h)})}renderItem(h){let v=h.legendItem=h.legendItem||{},S=this.chart,D=S.renderer,L=this.options,z=L.layout==="horizontal",B=this.symbolWidth,U=L.symbolPadding||0,X=this.itemStyle,te=this.itemHiddenStyle,K=z?oo(L.itemDistance,20):0,re=!L.rtl,ue=!h.series,ge=!ue&&h.series.drawLegendSymbol?h.series:h,ye=ge.options,be=!!this.createCheckboxForItem&&ye&&ye.showCheckbox,_e=L.useHTML,Fe=h.options.className,ze=v.label,ft=B+U+K+(be?20:0);!ze&&(v.group=D.g("legend-item").addClass("highcharts-"+ge.type+"-series highcharts-color-"+h.colorIndex+(Fe?" "+Fe:"")+(ue?" highcharts-series-"+h.index:"")).attr({zIndex:1}).add(this.scrollGroup),v.label=ze=D.text("",re?B+U:-U,this.baseline||0,_e),S.styledMode||ze.css(Qa(h.visible?X:te)),ze.attr({align:re?"left":"right",zIndex:2}).add(v.group),!this.baseline&&(this.fontMetrics=D.fontMetrics(ze),this.baseline=this.fontMetrics.f+3+this.itemMarginTop,ze.attr("y",this.baseline),this.symbolHeight=oo(L.symbolHeight,this.fontMetrics.f),L.squareSymbol&&(this.symbolWidth=oo(L.symbolWidth,Math.max(this.symbolHeight,16)),ft=this.symbolWidth+U+K+(be?20:0),re&&ze.attr("x",this.symbolWidth+U))),ge.drawLegendSymbol(this,h),this.setItemEvents&&this.setItemEvents(h,ze,_e)),be&&!h.checkbox&&this.createCheckboxForItem&&this.createCheckboxForItem(h),this.colorizeItem(h,h.visible),(S.styledMode||!X.width)&&ze.css({width:(L.itemWidth||this.widthOption||S.spacingBox.width)-ft+"px"}),this.setText(h);let St=ze.getBBox(),_t=this.fontMetrics&&this.fontMetrics.h||0;h.itemWidth=h.checkboxOffset=L.itemWidth||v.labelWidth||St.width+ft,this.maxItemWidth=Math.max(this.maxItemWidth,h.itemWidth),this.totalItemWidth+=h.itemWidth,this.itemHeight=h.itemHeight=Math.round(v.labelHeight||(St.height>1.5*_t?St.height:_t))}layoutItem(h){let v=this.options,S=this.padding,D=v.layout==="horizontal",L=h.itemHeight,z=this.itemMarginBottom,B=this.itemMarginTop,U=D?oo(v.itemDistance,20):0,X=this.maxLegendWidth,te=v.alignColumns&&this.totalItemWidth>X?this.maxItemWidth:h.itemWidth,K=h.legendItem||{};D&&this.itemX-S+te>X&&(this.itemX=S,this.lastLineHeight&&(this.itemY+=B+this.lastLineHeight+z),this.lastLineHeight=0),this.lastItemY=B+this.itemY+z,this.lastLineHeight=Math.max(L,this.lastLineHeight),K.x=this.itemX,K.y=this.itemY,D?this.itemX+=te:(this.itemY+=B+L+z,this.lastLineHeight=L),this.offsetWidth=this.widthOption||Math.max((D?this.itemX-S-(h.checkbox?0:U):te)+S,this.offsetWidth)}getAllItems(){let h=[];return this.chart.series.forEach(function(v){let S=v&&v.options;v&&oo(S.showInLegend,!Ll(S.linkedTo)&&void 0,!0)&&(h=h.concat((v.legendItem||{}).labels||(S.legendType==="point"?v.data:v)))}),Fo(this,"afterGetAllItems",{allItems:h}),h}getAlignment(){let h=this.options;return this.proximate?h.align.charAt(0)+"tv":h.floating?"":h.align.charAt(0)+h.verticalAlign.charAt(0)+h.layout.charAt(0)}adjustMargins(h,v){let S=this.chart,D=this.options,L=this.getAlignment();L&&[/(lth|ct|rth)/,/(rtv|rm|rbv)/,/(rbh|cb|lbh)/,/(lbv|lm|ltv)/].forEach(function(z,B){z.test(L)&&!Ll(h[B])&&(S[pd[B]]=Math.max(S[pd[B]],S.legend[(B+1)%2?"legendHeight":"legendWidth"]+[1,-1,-1,1][B]*D[B%2?"x":"y"]+oo(D.margin,12)+v[B]+(S.titleOffset[B]||0)))})}proximatePositions(){let h,v=this.chart,S=[],D=this.options.align==="left";for(let L of(this.allItems.forEach(function(z){let B,U,X=D,te,K;z.yAxis&&(z.xAxis.options.reversed&&(X=!X),z.points&&(B=Ep(X?z.points:z.points.slice(0).reverse(),function(re){return bu(re.plotY)})),U=this.itemMarginTop+z.legendItem.label.getBBox().height+this.itemMarginBottom,K=z.yAxis.top-v.plotTop,te=z.visible?(B?B.plotY:z.yAxis.height)+(K-.3*U):K+z.yAxis.height,S.push({target:te,size:U,item:z}))},this),mh(S,v.plotHeight)))h=L.item.legendItem||{},bu(L.pos)&&(h.y=v.plotTop-v.spacing[0]+L.pos)}render(){let h=this.chart,v=h.renderer,S=this.options,D=this.padding,L=this.getAllItems(),z,B,U,X=this.group,te,K=this.box;this.itemX=D,this.itemY=this.initialItemY,this.offsetWidth=0,this.lastItemY=0,this.widthOption=Ap(S.width,h.spacingBox.width-D),te=h.spacingBox.width-2*D-S.x,["rm","lm"].indexOf(this.getAlignment().substring(0,2))>-1&&(te/=2),this.maxLegendWidth=this.widthOption||te,X||(this.group=X=v.g("legend").addClass(S.className||"").attr({zIndex:7}).add(),this.contentGroup=v.g().attr({zIndex:1}).add(X),this.scrollGroup=v.g().add(this.contentGroup)),this.renderTitle(),gh(L,(re,ue)=>(re.options&&re.options.legendIndex||0)-(ue.options&&ue.options.legendIndex||0)),S.reversed&&L.reverse(),this.allItems=L,this.display=z=!!L.length,this.lastLineHeight=0,this.maxItemWidth=0,this.totalItemWidth=0,this.itemHeight=0,L.forEach(this.renderItem,this),L.forEach(this.layoutItem,this),B=(this.widthOption||this.offsetWidth)+D,U=this.lastItemY+this.lastLineHeight+this.titleHeight,U=this.handleOverflow(U)+D,K||(this.box=K=v.rect().addClass("highcharts-legend-box").attr({r:S.borderRadius}).add(X)),h.styledMode||K.attr({stroke:S.borderColor,"stroke-width":S.borderWidth||0,fill:S.backgroundColor||"none"}).shadow(S.shadow),B>0&&U>0&&K[K.placed?"animate":"attr"](K.crisp.call({},{x:0,y:0,width:B,height:U},K.strokeWidth())),X[z?"show":"hide"](),h.styledMode&&X.getStyle("display")==="none"&&(B=U=0),this.legendWidth=B,this.legendHeight=U,z&&this.align(),this.proximate||this.positionItems(),Fo(this,"afterRender")}align(h=this.chart.spacingBox){let v=this.chart,S=this.options,D=h.y;/(lth|ct|rth)/.test(this.getAlignment())&&v.titleOffset[0]>0?D+=v.titleOffset[0]:/(lbh|cb|rbh)/.test(this.getAlignment())&&v.titleOffset[2]>0&&(D-=v.titleOffset[2]),D!==h.y&&(h=Qa(h,{y:D})),v.hasRendered||(this.group.placed=!1),this.group.align(Qa(S,{width:this.legendWidth,height:this.legendHeight,verticalAlign:this.proximate?"top":S.verticalAlign}),!0,h)}handleOverflow(h){let v=this,S=this.chart,D=S.renderer,L=this.options,z=L.y,B=L.verticalAlign==="top",U=this.padding,X=L.maxHeight,te=L.navigation,K=oo(te.animation,!0),re=te.arrowSize||12,ue=this.pages,ge=this.allItems,ye=function(Ot){typeof Ot=="number"?_t.attr({height:Ot}):_t&&(v.clipRect=_t.destroy(),v.contentGroup.clip()),v.contentGroup.div&&(v.contentGroup.div.style.clip=Ot?"rect("+U+"px,9999px,"+(U+Ot)+"px,0)":"auto")},be=function(Ot){return v[Ot]=D.circle(0,0,1.3*re).translate(re/2,re/2).add(St),S.styledMode||v[Ot].attr("fill","rgba(0,0,0,0.0001)"),v[Ot]},_e,Fe,ze,ft=S.spacingBox.height+(B?-z:z)-U,St=this.nav,_t=this.clipRect;return L.layout!=="horizontal"||L.verticalAlign==="middle"||L.floating||(ft/=2),X&&(ft=Math.min(ft,X)),ue.length=0,h&&ft>0&&h>ft&&te.enabled!==!1?(this.clipHeight=_e=Math.max(ft-20-this.titleHeight-U,0),this.currentPage=oo(this.currentPage,1),this.fullHeight=h,ge.forEach((Ot,Pt)=>{let Ft=(ze=Ot.legendItem||{}).y||0,di=Math.round(ze.label.getBBox().height),gi=ue.length;(!gi||Ft-ue[gi-1]>_e&&(Fe||Ft)!==ue[gi-1])&&(ue.push(Fe||Ft),gi++),ze.pageIx=gi-1,Fe&&((ge[Pt-1].legendItem||{}).pageIx=gi-1),Pt===ge.length-1&&Ft+di-ue[gi-1]>_e&&Ft>ue[gi-1]&&(ue.push(Ft),ze.pageIx=gi),Ft!==Fe&&(Fe=Ft)}),_t||(_t=v.clipRect=D.clipRect(0,U-2,9999,0),v.contentGroup.clip(_t)),ye(_e),St||(this.nav=St=D.g().attr({zIndex:1}).add(this.group),this.up=D.symbol("triangle",0,0,re,re).add(St),be("upTracker").on("click",function(){v.scroll(-1,K)}),this.pager=D.text("",15,10).addClass("highcharts-legend-navigation"),!S.styledMode&&te.style&&this.pager.css(te.style),this.pager.add(St),this.down=D.symbol("triangle-down",0,0,re,re).add(St),be("downTracker").on("click",function(){v.scroll(1,K)})),v.scroll(0),h=ft):St&&(ye(),this.nav=St.destroy(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0),h}scroll(h,v){let S=this.chart,D=this.pages,L=D.length,z=this.clipHeight,B=this.options.navigation,U=this.pager,X=this.padding,te=this.currentPage+h;te>L&&(te=L),te>0&&(v!==void 0&&Tp(v,S),this.nav.attr({translateX:X,translateY:z+this.padding+7+this.titleHeight,visibility:"inherit"}),[this.up,this.upTracker].forEach(function(K){K.attr({class:te===1?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})}),U.attr({text:te+"/"+L}),[this.down,this.downTracker].forEach(function(K){K.attr({x:18+this.pager.getBBox().width,class:te===L?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})},this),S.styledMode||(this.up.attr({fill:te===1?B.inactiveColor:B.activeColor}),this.upTracker.css({cursor:te===1?"default":"pointer"}),this.down.attr({fill:te===L?B.inactiveColor:B.activeColor}),this.downTracker.css({cursor:te===L?"default":"pointer"})),this.scrollOffset=-D[te-1]+this.initialItemY,this.scrollGroup.animate({translateY:this.scrollOffset}),this.currentPage=te,this.positionCheckboxes(),Wf(()=>{Fo(this,"afterScroll",{currentPage:te})},Sp(oo(v,S.renderer.globalAnimation,!0)).duration))}setItemEvents(h,v,S){let D=this,L=h.legendItem||{},z=D.chart.renderer.boxWrapper,B=h instanceof Jo,U=h instanceof eo,X="highcharts-legend-"+(B?"point":"series")+"-active",te=D.chart.styledMode,K=S?[v,L.symbol]:[L.group],re=ue=>{D.allItems.forEach(ge=>{h!==ge&&[ge].concat(ge.linkedSeries||[]).forEach(ye=>{ye.setState(ue,!B)})})};for(let ue of K)ue&&ue.on("mouseover",function(){h.visible&&re("inactive"),h.setState("hover"),h.visible&&z.addClass(X),te||v.css(D.options.itemHoverStyle)}).on("mouseout",function(){D.chart.styledMode||v.css(Qa(h.visible?D.itemStyle:D.itemHiddenStyle)),re(""),z.removeClass(X),h.setState()}).on("click",function(ge){let ye=function(){h.setVisible&&h.setVisible(),re(h.visible?"inactive":"")};z.removeClass(X),Fo(D,"itemClick",{browserEvent:ge,legendItem:h},ye),B?h.firePointEvent("legendItemClick",{browserEvent:ge}):U&&Fo(h,"legendItemClick",{browserEvent:ge})})}createCheckboxForItem(h){h.checkbox=Ua("input",{type:"checkbox",className:"highcharts-legend-checkbox",checked:h.selected,defaultChecked:h.selected},this.options.itemCheckboxStyle,this.chart.container),xc(h.checkbox,"click",function(v){let S=v.target;Fo(h.series||h,"checkboxClick",{checked:S.checked,item:h},function(){h.select()})})}}(function(Y){Y.compose=function(h){Gf(Mp,"Core.Legend")&&xc(h,"beforeMargins",function(){this.legend=new Y(this,this.options.legend)})}})(md||(md={}));let Pp=md,{animate:gd,animObject:qf,setAnimation:bc}=se,{defaultOptions:wc}=zn,{numberFormat:So}=Po,{registerEventOptions:wu}=Fa,{charts:Rl,doc:_h,marginNames:Yf,svg:Sn,win:yh}=Ve,{seriesTypes:Dp}=Hn,{addEvent:vh,attr:Su,createElement:_d,css:ao,defined:da,diffObjects:pa,discardElement:xh,erase:Pn,error:To,extend:Bo,find:Sc,fireEvent:Ur,getAlignFactor:Xf,getStyle:Tc,isArray:Ip,isNumber:Tu,isObject:kp,isString:Mu,merge:lo,objectEach:el,pick:Dn,pInt:fa,relativeLength:tl,removeEvent:zl,splat:ma,syncTimeout:Zm,uniqueKey:Km}=Bi;class Fl{static chart(h,v,S){return new Fl(h,v,S)}constructor(h,v,S){this.sharedClips={};let D=[...arguments];(Mu(h)||h.nodeName)&&(this.renderTo=D.shift()),this.init(D[0],D[1])}setZoomOptions(){let h=this.options.chart,v=h.zooming;this.zooming={...v,type:Dn(h.zoomType,v.type),key:Dn(h.zoomKey,v.key),pinchType:Dn(h.pinchType,v.pinchType),singleTouch:Dn(h.zoomBySingleTouch,v.singleTouch,!1),resetButton:lo(v.resetButton,h.resetZoomButton)}}init(h,v){Ur(this,"init",{args:arguments},function(){var z;let S=lo(wc,h),D=S.chart,L=this.renderTo||D.renderTo;this.userOptions=Bo({},h),(this.renderTo=Mu(L)?_h.getElementById(L):L)||To(13,!0,this),this.margin=[],this.spacing=[],this.labelCollectors=[],this.callback=v,this.isResizing=0,this.options=S,this.axes=[],this.series=[],this.locale=S.lang.locale??((z=this.renderTo.closest("[lang]"))==null?void 0:z.lang),this.time=new $a(Bo(S.time||{},{locale:this.locale})),S.time=this.time.options,this.numberFormatter=(D.numberFormatter||So).bind(this),this.styledMode=D.styledMode,this.hasCartesianSeries=D.showAxes,this.index=Rl.length,Rl.push(this),Ve.chartCount++,wu(this,D),this.xAxis=[],this.yAxis=[],this.pointCount=this.colorCounter=this.symbolCounter=0,this.setZoomOptions(),Ur(this,"afterInit"),this.firstRender()})}initSeries(h){let v=this.options.chart,S=h.type||v.type,D=Dp[S];D||To(17,!0,this,{missingModuleFor:S});let L=new D;return typeof L.init=="function"&&L.init(this,h),L}setSortedData(){this.getSeriesOrderByLinks().forEach(function(h){h.points||h.data||!h.enabledDataSorting||h.setData(h.options.data,!1)})}getSeriesOrderByLinks(){return this.series.concat().sort(function(h,v){return h.linkedSeries.length||v.linkedSeries.length?v.linkedSeries.length-h.linkedSeries.length:0})}orderItems(h,v=0){let S=this[h],D=this.options[h]=ma(this.options[h]).slice(),L=this.userOptions[h]=this.userOptions[h]?ma(this.userOptions[h]).slice():[];if(this.hasRendered&&(D.splice(v),L.splice(v)),S)for(let z=v,B=S.length;z<B;++z){let U=S[z];U&&(U.index=z,U instanceof eo&&(U.name=U.getName()),U.options.isInternal||(D[z]=U.options,L[z]=U.userOptions))}}isInsidePlot(h,v,S={}){var be;let{inverted:D,plotBox:L,plotLeft:z,plotTop:B,scrollablePlotBox:U}=this,{scrollLeft:X=0,scrollTop:te=0}=S.visiblePlotOnly&&((be=this.scrollablePlotArea)==null?void 0:be.scrollingContainer)||{},K=S.series,re=S.visiblePlotOnly&&U||L,ue=S.inverted?v:h,ge=S.inverted?h:v,ye={x:ue,y:ge,isInsidePlot:!0,options:S};if(!S.ignoreX){let _e=K&&(D&&!this.polar?K.yAxis:K.xAxis)||{pos:z,len:1/0},Fe=S.paneCoordinates?_e.pos+ue:z+ue;Fe>=Math.max(X+z,_e.pos)&&Fe<=Math.min(X+z+re.width,_e.pos+_e.len)||(ye.isInsidePlot=!1)}if(!S.ignoreY&&ye.isInsidePlot){let _e=!D&&S.axis&&!S.axis.isXAxis&&S.axis||K&&(D?K.xAxis:K.yAxis)||{pos:B,len:1/0},Fe=S.paneCoordinates?_e.pos+ge:B+ge;Fe>=Math.max(te+B,_e.pos)&&Fe<=Math.min(te+B+re.height,_e.pos+_e.len)||(ye.isInsidePlot=!1)}return Ur(this,"afterIsInsidePlot",ye),ye.isInsidePlot}redraw(h){Ur(this,"beforeRedraw");let v=this.hasCartesianSeries?this.axes:this.colorAxis||[],S=this.series,D=this.pointer,L=this.legend,z=this.userOptions.legend,B=this.renderer,U=B.isHidden(),X=[],te,K,re,ue=this.isDirtyBox,ge=this.isDirtyLegend,ye;for(B.rootFontSize=B.boxWrapper.getStyle("font-size"),this.setResponsive&&this.setResponsive(!1),bc(!!this.hasRendered&&h,this),U&&this.temporaryDisplay(),this.layOutTitles(!1),re=S.length;re--;)if(((ye=S[re]).options.stacking||ye.options.centerInCategory)&&(K=!0,ye.isDirty)){te=!0;break}if(te)for(re=S.length;re--;)(ye=S[re]).options.stacking&&(ye.isDirty=!0);S.forEach(function(be){be.isDirty&&(be.options.legendType==="point"?(typeof be.updateTotals=="function"&&be.updateTotals(),ge=!0):z&&(z.labelFormatter||z.labelFormat)&&(ge=!0)),be.isDirtyData&&Ur(be,"updatedData")}),ge&&L&&L.options.enabled&&(L.render(),this.isDirtyLegend=!1),K&&this.getStacks(),v.forEach(function(be){be.updateNames(),be.setScale()}),this.getMargins(),v.forEach(function(be){be.isDirty&&(ue=!0)}),v.forEach(function(be){let _e=be.min+","+be.max;be.extKey!==_e&&(be.extKey=_e,X.push(function(){Ur(be,"afterSetExtremes",Bo(be.eventArgs,be.getExtremes())),delete be.eventArgs})),(ue||K)&&be.redraw()}),ue&&this.drawChartBox(),Ur(this,"predraw"),S.forEach(function(be){(ue||be.isDirty)&&be.visible&&be.redraw(),be.isDirtyData=!1}),D&&D.reset(!0),B.draw(),Ur(this,"redraw"),Ur(this,"render"),U&&this.temporaryDisplay(!0),X.forEach(function(be){be.call()})}get(h){let v=this.series;function S(L){return L.id===h||L.options&&L.options.id===h}let D=Sc(this.axes,S)||Sc(this.series,S);for(let L=0;!D&&L<v.length;L++)D=Sc(v[L].points||[],S);return D}createAxes(){let h=this.userOptions;for(let v of(Ur(this,"createAxes"),["xAxis","yAxis"]))for(let S of h[v]=ma(h[v]||{}))new Za(this,S,v);Ur(this,"afterCreateAxes")}getSelectedPoints(){return this.series.reduce((h,v)=>(v.getPointsCollection().forEach(S=>{Dn(S.selectedStaging,S.selected)&&h.push(S)}),h),[])}getSelectedSeries(){return this.series.filter(h=>h.selected)}setTitle(h,v,S){this.applyDescription("title",h),this.applyDescription("subtitle",v),this.applyDescription("caption",void 0),this.layOutTitles(S)}applyDescription(h,v){var z;let S=this,D=this.options[h]=lo(this.options[h],v),L=this[h];L&&v&&(this[h]=L=L.destroy()),D&&!L&&((L=this.renderer.text(D.text,0,0,D.useHTML).attr({align:D.align,class:"highcharts-"+h,zIndex:D.zIndex||4}).css({textOverflow:"ellipsis",whiteSpace:"nowrap"}).add()).update=function(B,U){S.applyDescription(h,B),S.layOutTitles(U)},this.styledMode||L.css(Bo(h==="title"?{fontSize:this.options.isStock?"1em":"1.2em"}:{},D.style)),L.textPxLength=L.getBBox().width,L.css({whiteSpace:(z=D.style)==null?void 0:z.whiteSpace}),this[h]=L)}layOutTitles(h=!0){var B,U,X,te;let v=[0,0,0],{options:S,renderer:D,spacingBox:L}=this;["title","subtitle","caption"].forEach(K=>{var be;let re=this[K],ue=this.options[K],ge=lo(L),ye=(re==null?void 0:re.textPxLength)||0;if(re&&ue){Ur(this,"layOutTitle",{alignTo:ge,key:K,textPxLength:ye});let _e=D.fontMetrics(re),Fe=_e.b,ze=_e.h,ft=ue.verticalAlign||"top",St=ft==="top",_t=St&&ue.minScale||1,Ot=K==="title"?St?-3:0:St?v[0]+2:0,Pt=Math.min(ge.width/ye,1),Ft=Math.max(_t,Pt),di=lo({y:ft==="bottom"?Fe:Ot+Fe},{align:K==="title"?Pt<_t?"left":"center":(be=this.title)==null?void 0:be.alignValue},ue),gi=ue.width||(Pt>_t?this.chartWidth:ge.width)/Ft;re.alignValue!==di.align&&(re.placed=!1);let Ai=Math.round(re.css({width:`${gi}px`}).getBBox(ue.useHTML).height);if(di.height=Ai,re.align(di,!1,ge).attr({align:di.align,scaleX:Ft,scaleY:Ft,"transform-origin":`${ge.x+ye*Ft*Xf(di.align)} ${ze}`}),!ue.floating){let ai=Ai*(Ai<1.2*ze?1:Ft);ft==="top"?v[0]=Math.ceil(v[0]+ai):ft==="bottom"&&(v[2]=Math.ceil(v[2]+ai))}}},this),v[0]&&(((B=S.title)==null?void 0:B.verticalAlign)||"top")==="top"&&(v[0]+=((U=S.title)==null?void 0:U.margin)||0),v[2]&&((X=S.caption)==null?void 0:X.verticalAlign)==="bottom"&&(v[2]+=((te=S.caption)==null?void 0:te.margin)||0);let z=!this.titleOffset||this.titleOffset.join(",")!==v.join(",");this.titleOffset=v,Ur(this,"afterLayOutTitles"),!this.isDirtyBox&&z&&(this.isDirtyBox=this.isDirtyLegend=z,this.hasRendered&&h&&this.isDirtyBox&&this.redraw())}getContainerBox(){let h=[].map.call(this.renderTo.children,S=>{if(S!==this.container){let D=S.style.display;return S.style.display="none",[S,D]}}),v={width:Tc(this.renderTo,"width",!0)||0,height:Tc(this.renderTo,"height",!0)||0};return h.filter(Boolean).forEach(([S,D])=>{S.style.display=D}),v}getChartSize(){var z;let h=this.options.chart,v=h.width,S=h.height,D=this.getContainerBox(),L=D.height<=1||!((z=this.renderTo.parentElement)!=null&&z.style.height)&&this.renderTo.style.height==="100%";this.chartWidth=Math.max(0,v||D.width||600),this.chartHeight=Math.max(0,tl(S,this.chartWidth)||(L?400:D.height)),this.containerBox=D}temporaryDisplay(h){let v=this.renderTo,S;if(h)for(;v&&v.style;)v.hcOrigStyle&&(ao(v,v.hcOrigStyle),delete v.hcOrigStyle),v.hcOrigDetached&&(_h.body.removeChild(v),v.hcOrigDetached=!1),v=v.parentNode;else for(;v&&v.style&&(_h.body.contains(v)||v.parentNode||(v.hcOrigDetached=!0,_h.body.appendChild(v)),(Tc(v,"display",!1)==="none"||v.hcOricDetached)&&(v.hcOrigStyle={display:v.style.display,height:v.style.height,overflow:v.style.overflow},S={display:"block",overflow:"hidden"},v!==this.renderTo&&(S.height=0),ao(v,S),v.offsetWidth||v.style.setProperty("display","block","important")),(v=v.parentNode)!==_h.body););}setClassName(h){this.container.className="highcharts-container "+(h||"")}getContainer(){var re;let h,v=this.options,S=v.chart,D="data-highcharts-chart",L=Km(),z=this.renderTo,B=fa(Su(z,D));Tu(B)&&Rl[B]&&Rl[B].hasRendered&&Rl[B].destroy(),Su(z,D,this.index),z.innerHTML=fi.emptyHTML,S.skipClone||z.offsetWidth||this.temporaryDisplay(),this.getChartSize();let U=this.chartHeight,X=this.chartWidth;ao(z,{overflow:"hidden"}),this.styledMode||(h=Bo({position:"relative",overflow:"hidden",width:X+"px",height:U+"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)",userSelect:"none","touch-action":"manipulation",outline:"none",padding:"0px"},S.style||{}));let te=_d("div",{id:L},h,z);this.container=te,this.getChartSize(),X===this.chartWidth||(X=this.chartWidth,this.styledMode||ao(te,{width:Dn((re=S.style)==null?void 0:re.width,X+"px")})),this.containerBox=this.getContainerBox(),this._cursor=te.style.cursor;let K=S.renderer||!Sn?Wc.getRendererType(S.renderer):ei;if(this.renderer=new K(te,X,U,void 0,S.forExport,v.exporting&&v.exporting.allowHTML,this.styledMode),bc(void 0,this),this.setClassName(S.className),this.styledMode)for(let ue in v.defs)this.renderer.definition(v.defs[ue]);else this.renderer.setStyle(S.style);this.renderer.chartIndex=this.index,Ur(this,"afterGetContainer")}getMargins(h){let{spacing:v,margin:S,titleOffset:D}=this;this.resetMargins(),D[0]&&!da(S[0])&&(this.plotTop=Math.max(this.plotTop,D[0]+v[0])),D[2]&&!da(S[2])&&(this.marginBottom=Math.max(this.marginBottom,D[2]+v[2])),this.legend&&this.legend.display&&this.legend.adjustMargins(S,v),Ur(this,"getMargins"),h||this.getAxisMargins()}getAxisMargins(){let h=this,v=h.axisOffset=[0,0,0,0],S=h.colorAxis,D=h.margin,L=function(z){z.forEach(function(B){B.visible&&B.getOffset()})};h.hasCartesianSeries?L(h.axes):S&&S.length&&L(S),Yf.forEach(function(z,B){da(D[B])||(h[z]+=v[B])}),h.setChartSize()}getOptions(){return pa(this.userOptions,wc)}reflow(h){var L;let v=this,S=v.containerBox,D=v.getContainerBox();(L=v.pointer)==null||delete L.chartPosition,!v.isPrinting&&!v.isResizing&&S&&D.width&&((D.width!==S.width||D.height!==S.height)&&(Bi.clearTimeout(v.reflowTimeout),v.reflowTimeout=Zm(function(){v.container&&v.setSize(void 0,void 0,!1)},h?100:0)),v.containerBox=D)}setReflow(){let h=this,v=S=>{var D;(D=h.options)!=null&&D.chart.reflow&&h.hasLoaded&&h.reflow(S)};if(typeof ResizeObserver=="function")new ResizeObserver(v).observe(h.renderTo);else{let S=vh(yh,"resize",v);vh(this,"destroy",S)}}setSize(h,v,S){let D=this,L=D.renderer;D.isResizing+=1,bc(S,D);let z=L.globalAnimation;D.oldChartHeight=D.chartHeight,D.oldChartWidth=D.chartWidth,h!==void 0&&(D.options.chart.width=h),v!==void 0&&(D.options.chart.height=v),D.getChartSize();let{chartWidth:B,chartHeight:U,scrollablePixelsX:X=0,scrollablePixelsY:te=0}=D;(D.isDirtyBox||B!==D.oldChartWidth||U!==D.oldChartHeight)&&(D.styledMode||(z?gd:ao)(D.container,{width:`${B+X}px`,height:`${U+te}px`},z),D.setChartSize(!0),L.setSize(B,U,z),D.axes.forEach(function(K){K.isDirty=!0,K.setScale()}),D.isDirtyLegend=!0,D.isDirtyBox=!0,D.layOutTitles(),D.getMargins(),D.redraw(z),D.oldChartHeight=void 0,Ur(D,"resize"),setTimeout(()=>{D&&Ur(D,"endResize")},qf(z).duration)),D.isResizing-=1}setChartSize(h){let v,S,D,L,{chartHeight:z,chartWidth:B,inverted:U,spacing:X,renderer:te}=this,K=this.clipOffset,re=Math[U?"floor":"round"];this.plotLeft=v=Math.round(this.plotLeft),this.plotTop=S=Math.round(this.plotTop),this.plotWidth=D=Math.max(0,Math.round(B-v-this.marginRight)),this.plotHeight=L=Math.max(0,Math.round(z-S-this.marginBottom)),this.plotSizeX=U?L:D,this.plotSizeY=U?D:L,this.spacingBox=te.spacingBox={x:X[3],y:X[0],width:B-X[3]-X[1],height:z-X[0]-X[2]},this.plotBox=te.plotBox={x:v,y:S,width:D,height:L},K&&(this.clipBox={x:re(K[3]),y:re(K[0]),width:re(this.plotSizeX-K[1]-K[3]),height:re(this.plotSizeY-K[0]-K[2])}),h||(this.axes.forEach(function(ue){ue.setAxisSize(),ue.setAxisTranslation()}),te.alignElements()),Ur(this,"afterSetChartSize",{skipAxes:h})}resetMargins(){Ur(this,"resetMargins");let h=this,v=h.options.chart,S=v.plotBorderWidth||0,D=S/2;["margin","spacing"].forEach(function(L){let z=v[L],B=kp(z)?z:[z,z,z,z];["Top","Right","Bottom","Left"].forEach(function(U,X){h[L][X]=Dn(v[L+U],B[X])})}),Yf.forEach(function(L,z){h[L]=Dn(h.margin[z],h.spacing[z])}),h.axisOffset=[0,0,0,0],h.clipOffset=[D,D,D,D],h.plotBorderWidth=S}drawChartBox(){let h=this.options.chart,v=this.renderer,S=this.chartWidth,D=this.chartHeight,L=this.styledMode,z=this.plotBGImage,B=h.backgroundColor,U=h.plotBackgroundColor,X=h.plotBackgroundImage,te=this.plotLeft,K=this.plotTop,re=this.plotWidth,ue=this.plotHeight,ge=this.plotBox,ye=this.clipRect,be=this.clipBox,_e=this.chartBackground,Fe=this.plotBackground,ze=this.plotBorder,ft,St,_t,Ot="animate";_e||(this.chartBackground=_e=v.rect().addClass("highcharts-background").add(),Ot="attr"),L?ft=St=_e.strokeWidth():(St=(ft=h.borderWidth||0)+(h.shadow?8:0),_t={fill:B||"none"},(ft||_e["stroke-width"])&&(_t.stroke=h.borderColor,_t["stroke-width"]=ft),_e.attr(_t).shadow(h.shadow)),_e[Ot]({x:St/2,y:St/2,width:S-St-ft%2,height:D-St-ft%2,r:h.borderRadius}),Ot="animate",Fe||(Ot="attr",this.plotBackground=Fe=v.rect().addClass("highcharts-plot-background").add()),Fe[Ot](ge),!L&&(Fe.attr({fill:U||"none"}).shadow(h.plotShadow),X&&(z?(X!==z.attr("href")&&z.attr("href",X),z.animate(ge)):this.plotBGImage=v.image(X,te,K,re,ue).add())),ye?ye.animate({width:be.width,height:be.height}):this.clipRect=v.clipRect(be),Ot="animate",ze||(Ot="attr",this.plotBorder=ze=v.rect().addClass("highcharts-plot-border").attr({zIndex:1}).add()),L||ze.attr({stroke:h.plotBorderColor,"stroke-width":h.plotBorderWidth||0,fill:"none"}),ze[Ot](ze.crisp({x:te,y:K,width:re,height:ue},-ze.strokeWidth())),this.isDirtyBox=!1,Ur(this,"afterDrawChartBox")}propFromSeries(){let h,v,S,D=this,L=D.options.chart,z=D.options.series;["inverted","angular","polar"].forEach(function(B){for(v=Dp[L.type],S=L[B]||v&&v.prototype[B],h=z&&z.length;!S&&h--;)(v=Dp[z[h].type])&&v.prototype[B]&&(S=!0);D[B]=S})}linkSeries(h){let v=this,S=v.series;S.forEach(function(D){D.linkedSeries.length=0}),S.forEach(function(D){let{linkedTo:L}=D.options;if(Mu(L)){let z;(z=L===":previous"?v.series[D.index-1]:v.get(L))&&z.linkedParent!==D&&(z.linkedSeries.push(D),D.linkedParent=z,z.enabledDataSorting&&D.setDataSortingOptions(),D.visible=Dn(D.options.visible,z.options.visible,D.visible))}}),Ur(this,"afterLinkSeries",{isUpdating:h})}renderSeries(){this.series.forEach(function(h){h.translate(),h.render()})}render(){var te;let h=this.axes,v=this.colorAxis,S=this.renderer,D=this.options.chart.axisLayoutRuns||2,L=K=>{K.forEach(re=>{re.visible&&re.render()})},z=0,B=!0,U,X=0;for(let K of(this.setTitle(),Ur(this,"beforeMargins"),(te=this.getStacks)==null||te.call(this),this.getMargins(!0),this.setChartSize(),h)){let{options:re}=K,{labels:ue}=re;if(this.hasCartesianSeries&&K.horiz&&K.visible&&ue.enabled&&K.series.length&&K.coll!=="colorAxis"&&!this.polar){z=re.tickLength,K.createGroups();let ge=new Zo(K,0,"",!0),ye=ge.createLabel("x",ue);if(ge.destroy(),ye&&Dn(ue.reserveSpace,!Tu(re.crossing))&&(z=ye.getBBox().height+ue.distance+Math.max(re.offset||0,0)),z){ye==null||ye.destroy();break}}}for(this.plotHeight=Math.max(this.plotHeight-z,0);(B||U||D>1)&&X<D;){let K=this.plotWidth,re=this.plotHeight;for(let ue of h)X===0?ue.setScale():(ue.horiz&&B||!ue.horiz&&U)&&ue.setTickInterval(!0);X===0?this.getAxisMargins():this.getMargins(),B=K/this.plotWidth>(X?1:1.1),U=re/this.plotHeight>(X?1:1.05),X++}this.drawChartBox(),this.hasCartesianSeries?L(h):v&&v.length&&L(v),this.seriesGroup||(this.seriesGroup=S.g("series-group").attr({zIndex:3}).shadow(this.options.chart.seriesGroupShadow).add()),this.renderSeries(),this.addCredits(),this.setResponsive&&this.setResponsive(),this.hasRendered=!0}addCredits(h){let v=this,S=lo(!0,this.options.credits,h);S.enabled&&!this.credits&&(this.credits=this.renderer.text(S.text+(this.mapCredits||""),0,0).addClass("highcharts-credits").on("click",function(){S.href&&(yh.location.href=S.href)}).attr({align:S.position.align,zIndex:8}),v.styledMode||this.credits.css(S.style),this.credits.add().align(S.position),this.credits.update=function(D){v.credits=v.credits.destroy(),v.addCredits(D)})}destroy(){let h,v=this,S=v.axes,D=v.series,L=v.container,z=L&&L.parentNode;for(Ur(v,"destroy"),v.renderer.forExport?Pn(Rl,v):Rl[v.index]=void 0,Ve.chartCount--,v.renderTo.removeAttribute("data-highcharts-chart"),zl(v),h=S.length;h--;)S[h]=S[h].destroy();for(this.scroller&&this.scroller.destroy&&this.scroller.destroy(),h=D.length;h--;)D[h]=D[h].destroy();["title","subtitle","chartBackground","plotBackground","plotBGImage","plotBorder","seriesGroup","clipRect","credits","pointer","rangeSelector","legend","resetZoomButton","tooltip","renderer"].forEach(function(B){let U=v[B];U&&U.destroy&&(v[B]=U.destroy())}),L&&(L.innerHTML=fi.emptyHTML,zl(L),z&&xh(L)),el(v,function(B,U){delete v[U]})}firstRender(){var D;let h=this,v=h.options;h.getContainer(),h.resetMargins(),h.setChartSize(),h.propFromSeries(),h.createAxes();let S=Ip(v.series)?v.series:[];v.series=[],S.forEach(function(L){h.initSeries(L)}),h.linkSeries(),h.setSortedData(),Ur(h,"beforeRender"),h.render(),(D=h.pointer)==null||D.getChartPosition(),h.renderer.imgCount||h.hasLoaded||h.onload(),h.temporaryDisplay(!0)}onload(){this.callbacks.concat([this.callback]).forEach(function(h){h&&this.index!==void 0&&h.apply(this,[this])},this),Ur(this,"load"),Ur(this,"render"),da(this.index)&&this.setReflow(),this.warnIfA11yModuleNotLoaded(),this.hasLoaded=!0}warnIfA11yModuleNotLoaded(){let{options:h,title:v}=this;!h||this.accessibility||(this.renderer.boxWrapper.attr({role:"img","aria-label":(v&&v.element.textContent||"").replace(/</g,"&lt;")}),h.accessibility&&h.accessibility.enabled===!1||To('Highcharts warning: Consider including the "accessibility.js" module to make your chart more usable for people with disabilities. Set the "accessibility.enabled" option to false to remove this warning. See https://www.highcharts.com/docs/accessibility/accessibility-module.',!1,this))}addSeries(h,v,S){let D,L=this;return h&&(v=Dn(v,!0),Ur(L,"addSeries",{options:h},function(){D=L.initSeries(h),L.isDirtyLegend=!0,L.linkSeries(),D.enabledDataSorting&&D.setData(h.data,!1),Ur(L,"afterAddSeries",{series:D}),v&&L.redraw(S)})),D}addAxis(h,v,S,D){return this.createAxis(v?"xAxis":"yAxis",{axis:h,redraw:S,animation:D})}addColorAxis(h,v,S){return this.createAxis("colorAxis",{axis:h,redraw:v,animation:S})}createAxis(h,v){let S=new Za(this,v.axis,h);return Dn(v.redraw,!0)&&this.redraw(v.animation),S}showLoading(h){let v=this,S=v.options,D=S.loading,L=function(){z&&ao(z,{left:v.plotLeft+"px",top:v.plotTop+"px",width:v.plotWidth+"px",height:v.plotHeight+"px"})},z=v.loadingDiv,B=v.loadingSpan;z||(v.loadingDiv=z=_d("div",{className:"highcharts-loading highcharts-loading-hidden"},null,v.container)),B||(v.loadingSpan=B=_d("span",{className:"highcharts-loading-inner"},null,z),vh(v,"redraw",L)),z.className="highcharts-loading",fi.setElementHTML(B,Dn(h,S.lang.loading,"")),v.styledMode||(ao(z,Bo(D.style,{zIndex:10})),ao(B,D.labelStyle),v.loadingShown||(ao(z,{opacity:0,display:""}),gd(z,{opacity:D.style.opacity||.5},{duration:D.showDuration||0}))),v.loadingShown=!0,L()}hideLoading(){let h=this.options,v=this.loadingDiv;v&&(v.className="highcharts-loading highcharts-loading-hidden",this.styledMode||gd(v,{opacity:0},{duration:h.loading.hideDuration||100,complete:function(){ao(v,{display:"none"})}})),this.loadingShown=!1}update(h,v,S,D){let L,z,B,U=this,X={credits:"addCredits",title:"setTitle",subtitle:"setSubtitle",caption:"setCaption"},te=h.isResponsiveOptions,K=[];Ur(U,"update",{options:h}),te||U.setResponsive(!1,!0),h=pa(h,U.options),U.userOptions=lo(U.userOptions,h);let re=h.chart;re&&(lo(!0,U.options.chart,re),this.setZoomOptions(),"className"in re&&U.setClassName(re.className),("inverted"in re||"polar"in re||"type"in re)&&(U.propFromSeries(),L=!0),"alignTicks"in re&&(L=!0),"events"in re&&wu(this,re),el(re,function(ye,be){U.propsRequireUpdateSeries.indexOf("chart."+be)!==-1&&(z=!0),U.propsRequireDirtyBox.indexOf(be)!==-1&&(U.isDirtyBox=!0),U.propsRequireReflow.indexOf(be)===-1||(U.isDirtyBox=!0,te||(B=!0))}),!U.styledMode&&re.style&&U.renderer.setStyle(U.options.chart.style||{})),!U.styledMode&&h.colors&&(this.options.colors=h.colors),el(h,function(ye,be){U[be]&&typeof U[be].update=="function"?U[be].update(ye,!1):typeof U[X[be]]=="function"?U[X[be]](ye):be!=="colors"&&U.collectionsWithUpdate.indexOf(be)===-1&&lo(!0,U.options[be],h[be]),be!=="chart"&&U.propsRequireUpdateSeries.indexOf(be)!==-1&&(z=!0)}),this.collectionsWithUpdate.forEach(function(ye){h[ye]&&(ma(h[ye]).forEach(function(be,_e){let Fe,ze=da(be.id);ze&&(Fe=U.get(be.id)),!Fe&&U[ye]&&(Fe=U[ye][Dn(be.index,_e)])&&(ze&&da(Fe.options.id)||Fe.options.isInternal)&&(Fe=void 0),Fe&&Fe.coll===ye&&(Fe.update(be,!1),S&&(Fe.touched=!0)),!Fe&&S&&U.collectionsWithInit[ye]&&(U.collectionsWithInit[ye][0].apply(U,[be].concat(U.collectionsWithInit[ye][1]||[]).concat([!1])).touched=!0)}),S&&U[ye].forEach(function(be){be.touched||be.options.isInternal?delete be.touched:K.push(be)}))}),K.forEach(function(ye){ye.chart&&ye.remove&&ye.remove(!1)}),L&&U.axes.forEach(function(ye){ye.update({},!1)}),z&&U.getSeriesOrderByLinks().forEach(function(ye){ye.chart&&ye.update({},!1)},this);let ue=re&&re.width,ge=re&&(Mu(re.height)?tl(re.height,ue||U.chartWidth):re.height);B||Tu(ue)&&ue!==U.chartWidth||Tu(ge)&&ge!==U.chartHeight?U.setSize(ue,ge,D):Dn(v,!0)&&U.redraw(D),Ur(U,"afterUpdate",{options:h,redraw:v,animation:D})}setSubtitle(h,v){this.applyDescription("subtitle",h),this.layOutTitles(v)}setCaption(h,v){this.applyDescription("caption",h),this.layOutTitles(v)}showResetZoom(){let h=this,v=wc.lang,S=h.zooming.resetButton,D=S.theme,L=S.relativeTo==="chart"||S.relativeTo==="spacingBox"?null:"plotBox";function z(){h.zoomOut()}Ur(this,"beforeShowResetZoom",null,function(){h.resetZoomButton=h.renderer.button(v.resetZoom,null,null,z,D).attr({align:S.position.align,title:v.resetZoomTitle}).addClass("highcharts-reset-zoom").add().align(S.position,!1,L)}),Ur(this,"afterShowResetZoom")}zoomOut(){Ur(this,"selection",{resetSelection:!0},()=>this.transform({reset:!0,trigger:"zoom"}))}pan(h,v){let S=this,D=typeof v=="object"?v:{enabled:v,type:"x"},L=D.type,z=L&&S[{x:"xAxis",xy:"axes",y:"yAxis"}[L]].filter(U=>U.options.panningEnabled&&!U.options.isInternal),B=S.options.chart;B!=null&&B.panning&&(B.panning=D),Ur(this,"pan",{originalEvent:h},()=>{S.transform({axes:z,event:h,to:{x:h.chartX-(S.mouseDownX||0),y:h.chartY-(S.mouseDownY||0)},trigger:"pan"}),ao(S.container,{cursor:"move"})})}transform(h){var ge;let{axes:v=this.axes,event:S,from:D={},reset:L,selection:z,to:B={},trigger:U}=h,{inverted:X,time:te}=this,K=!1,re,ue;for(let ye of((ge=this.hoverPoints)==null||ge.forEach(be=>be.setState()),v)){let{horiz:be,len:_e,minPointOffset:Fe=0,options:ze,reversed:ft}=ye,St=be?"width":"height",_t=be?"x":"y",Ot=Dn(B[St],ye.len),Pt=Dn(D[St],ye.len),Ft=10>Math.abs(Ot)?1:Ot/Pt,di=(D[_t]||0)+Pt/2-ye.pos,gi=di-((B[_t]??ye.pos)+Ot/2-ye.pos)/Ft,Ai=ft&&!X||!ft&&X?-1:1;if(!L&&(di<0||di>ye.len))continue;let ai=ye.toValue(gi,!0)+(z||ye.isOrdinal?0:Fe*Ai),Ei=ye.toValue(gi+_e/Ft,!0)-(z||ye.isOrdinal?0:Fe*Ai||0),Zi=ye.allExtremes;if(ai>Ei&&([ai,Ei]=[Ei,ai]),Ft===1&&!L&&ye.coll==="yAxis"&&!Zi){for(let Xn of ye.series){let Bs=Xn.getExtremes(Xn.getProcessedData(!0).modified.getColumn("y")||[],!0);Zi??(Zi={dataMin:Number.MAX_VALUE,dataMax:-Number.MAX_VALUE}),Tu(Bs.dataMin)&&Tu(Bs.dataMax)&&(Zi.dataMin=Math.min(Bs.dataMin,Zi.dataMin),Zi.dataMax=Math.max(Bs.dataMax,Zi.dataMax))}ye.allExtremes=Zi}let{dataMin:kr,dataMax:Gi,min:gr,max:Vi}=Bo(ye.getExtremes(),Zi||{}),Qi=te.parse(ze.min),_r=te.parse(ze.max),un=kr??Qi,kn=Gi??_r,zr=Ei-ai,Gr=ye.categories?0:Math.min(zr,kn-un),Xr=un-Gr*(da(Qi)?0:ze.minPadding),Ms=kn+Gr*(da(_r)?0:ze.maxPadding),ss=ye.allowZoomOutside||Ft===1||U!=="zoom"&&Ft>1,Cs=Math.min(Qi??Xr,Xr,ss?gr:Xr),os=Math.max(_r??Ms,Ms,ss?Vi:Ms);(!ye.isOrdinal||ye.options.overscroll||Ft!==1||L)&&(ai<Cs&&(ai=Cs,Ft>=1&&(Ei=ai+zr)),Ei>os&&(Ei=os,Ft>=1&&(ai=Ei-zr)),(L||ye.series.length&&(ai!==gr||Ei!==Vi)&&ai>=Cs&&Ei<=os)&&(z?z[ye.coll].push({axis:ye,min:ai,max:Ei}):(ye.isPanning=U!=="zoom",ye.isPanning&&(ue=!0),ye.setExtremes(L?void 0:ai,L?void 0:Ei,!1,!1,{move:gi,trigger:U,scale:Ft}),!L&&(ai>Cs||Ei<os)&&U!=="mousewheel"&&(re=!0)),K=!0),S&&(this[be?"mouseDownX":"mouseDownY"]=S[be?"chartX":"chartY"]))}return K&&(z?Ur(this,"selection",z,()=>{delete h.selection,h.trigger="zoom",this.transform(h)}):(!re||ue||this.resetZoomButton?!re&&this.resetZoomButton&&(this.resetZoomButton=this.resetZoomButton.destroy()):this.showResetZoom(),this.redraw(U==="zoom"&&(this.options.chart.animation??this.pointCount<100)))),K}}Bo(Fl.prototype,{callbacks:[],collectionsWithInit:{xAxis:[Fl.prototype.addAxis,[!0]],yAxis:[Fl.prototype.addAxis,[!1]],series:[Fl.prototype.addSeries]},collectionsWithUpdate:["xAxis","yAxis","series"],propsRequireDirtyBox:["backgroundColor","borderColor","borderWidth","borderRadius","plotBackgroundColor","plotBackgroundImage","plotBorderColor","plotBorderWidth","plotShadow","shadow"],propsRequireReflow:["margin","marginTop","marginRight","marginBottom","marginLeft","spacing","spacingTop","spacingRight","spacingBottom","spacingLeft"],propsRequireUpdateSeries:["chart.inverted","chart.polar","chart.ignoreHiddenSeries","chart.type","colors","plotOptions","time","tooltip"]});let{stop:yd}=se,{composed:Zf}=Ve,{addEvent:Gn,createElement:il,css:vd,defined:xd,erase:Cu,merge:bh,pushUnique:Mo}=Bi;function No(){let Y=this.scrollablePlotArea;(this.scrollablePixelsX||this.scrollablePixelsY)&&!Y&&(this.scrollablePlotArea=Y=new ga(this)),Y==null||Y.applyFixed()}function Mc(){this.chart.scrollablePlotArea&&(this.chart.scrollablePlotArea.isDirty=!0)}class ga{static compose(h,v,S){Mo(Zf,this.compose)&&(Gn(h,"afterInit",Mc),Gn(v,"afterSetChartSize",D=>this.afterSetSize(D.target,D)),Gn(v,"render",No),Gn(S,"show",Mc))}static afterSetSize(h,v){let S,D,L,{minWidth:z,minHeight:B}=h.options.chart.scrollablePlotArea||{},{clipBox:U,plotBox:X,inverted:te,renderer:K}=h;if(!K.forExport&&(z?(h.scrollablePixelsX=S=Math.max(0,z-h.chartWidth),S&&(h.scrollablePlotBox=bh(h.plotBox),X.width=h.plotWidth+=S,U[te?"height":"width"]+=S,L=!0)):B&&(h.scrollablePixelsY=D=Math.max(0,B-h.chartHeight),xd(D)&&(h.scrollablePlotBox=bh(h.plotBox),X.height=h.plotHeight+=D,U[te?"width":"height"]+=D,L=!1)),xd(L)&&!v.skipAxes))for(let re of h.axes)(re.horiz===L||h.hasParallelCoordinates&&re.coll==="yAxis")&&(re.setAxisSize(),re.setAxisTranslation())}constructor(h){var ue;let v,S=h.options.chart,D=Wc.getRendererType(),L=S.scrollablePlotArea||{},z=this.moveFixedElements.bind(this),B={WebkitOverflowScrolling:"touch",overflowX:"hidden",overflowY:"hidden"};h.scrollablePixelsX&&(B.overflowX="auto"),h.scrollablePixelsY&&(B.overflowY="auto"),this.chart=h;let U=this.parentDiv=il("div",{className:"highcharts-scrolling-parent"},{position:"relative"},h.renderTo),X=this.scrollingContainer=il("div",{className:"highcharts-scrolling"},B,U),te=this.innerContainer=il("div",{className:"highcharts-inner-container"},void 0,X),K=this.fixedDiv=il("div",{className:"highcharts-fixed"},{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:(((ue=S.style)==null?void 0:ue.zIndex)||0)+2,top:0},void 0,!0),re=this.fixedRenderer=new D(K,h.chartWidth,h.chartHeight,S.style);this.mask=re.path().attr({fill:S.backgroundColor||"#fff","fill-opacity":L.opacity??.85,zIndex:-1}).addClass("highcharts-scrollable-mask").add(),X.parentNode.insertBefore(K,X),vd(h.renderTo,{overflow:"visible"}),Gn(h,"afterShowResetZoom",z),Gn(h,"afterApplyDrilldown",z),Gn(h,"afterLayOutTitles",z),Gn(X,"scroll",()=>{let{pointer:ge,hoverPoint:ye}=h;ge&&(delete ge.chartPosition,ye&&(v=ye),ge.runPointActions(void 0,v,!0))}),te.appendChild(h.container)}applyFixed(){var di;let{chart:h,fixedRenderer:v,isDirty:S,scrollingContainer:D}=this,{axisOffset:L,chartWidth:z,chartHeight:B,container:U,plotHeight:X,plotLeft:te,plotTop:K,plotWidth:re,scrollablePixelsX:ue=0,scrollablePixelsY:ge=0}=h,{scrollPositionX:ye=0,scrollPositionY:be=0}=h.options.chart.scrollablePlotArea||{},_e=z+ue,Fe=B+ge;v.setSize(z,B),(S??!0)&&(this.isDirty=!1,this.moveFixedElements()),yd(h.container),vd(U,{width:`${_e}px`,height:`${Fe}px`}),h.renderer.boxWrapper.attr({width:_e,height:Fe,viewBox:[0,0,_e,Fe].join(" ")}),(di=h.chartBackground)==null||di.attr({width:_e,height:Fe}),vd(D,{width:`${z}px`,height:`${B}px`}),xd(S)||(D.scrollLeft=ue*ye,D.scrollTop=ge*be);let ze=K-L[0]-1,ft=te-L[3]-1,St=K+X+L[2]+1,_t=te+re+L[1]+1,Ot=te+re-ue,Pt=K+X-ge,Ft=[["M",0,0]];ue?Ft=[["M",0,ze],["L",te-1,ze],["L",te-1,St],["L",0,St],["Z"],["M",Ot,ze],["L",z,ze],["L",z,St],["L",Ot,St],["Z"]]:ge&&(Ft=[["M",ft,0],["L",ft,K-1],["L",_t,K-1],["L",_t,0],["Z"],["M",ft,Pt],["L",ft,B],["L",_t,B],["L",_t,Pt],["Z"]]),h.redrawTrigger!=="adjustHeight"&&this.mask.attr({d:Ft})}moveFixedElements(){let h,{container:v,inverted:S,scrollablePixelsX:D,scrollablePixelsY:L}=this.chart,z=this.fixedRenderer,B=ga.fixedSelectors;if(D&&!S?h=".highcharts-yaxis":D&&S||L&&!S?h=".highcharts-xaxis":L&&S&&(h=".highcharts-yaxis"),h&&!(this.chart.hasParallelCoordinates&&h===".highcharts-yaxis"))for(let U of[`${h}:not(.highcharts-radial-axis)`,`${h}-labels:not(.highcharts-radial-axis-labels)`])Mo(B,U);else for(let U of[".highcharts-xaxis",".highcharts-yaxis"])for(let X of[`${U}:not(.highcharts-radial-axis)`,`${U}-labels:not(.highcharts-radial-axis-labels)`])Cu(B,X);for(let U of B)[].forEach.call(v.querySelectorAll(U),X=>{(X.namespaceURI===z.SVG_NS?z.box:z.box.parentNode).appendChild(X),X.style.pointerEvents="auto"})}}ga.fixedSelectors=[".highcharts-breadcrumbs-group",".highcharts-contextbutton",".highcharts-caption",".highcharts-credits",".highcharts-drillup-button",".highcharts-legend",".highcharts-legend-checkbox",".highcharts-navigator-series",".highcharts-navigator-xaxis",".highcharts-navigator-yaxis",".highcharts-navigator",".highcharts-range-selector-group",".highcharts-reset-zoom",".highcharts-scrollbar",".highcharts-subtitle",".highcharts-title"];let{format:Cc}=Po,{series:Op}=Hn,{destroyObjectProperties:Cr,fireEvent:rl,getAlignFactor:Lp,isNumber:Rp,pick:Bl}=Bi,_a=class{constructor(Y,h,v,S,D){let L=Y.chart.inverted,z=Y.reversed;this.axis=Y;let B=this.isNegative=!!v!=!!z;this.options=h=h||{},this.x=S,this.total=null,this.cumulative=null,this.points={},this.hasValidPoints=!1,this.stack=D,this.leftCliff=0,this.rightCliff=0,this.alignOptions={align:h.align||(L?B?"left":"right":"center"),verticalAlign:h.verticalAlign||(L?"middle":B?"bottom":"top"),y:h.y,x:h.x},this.textAlign=h.textAlign||(L?B?"right":"left":"center")}destroy(){Cr(this,this.axis)}render(Y){let h=this.axis.chart,v=this.options,S=v.format,D=S?Cc(S,this,h):v.formatter.call(this);if(this.label)this.label.attr({text:D,visibility:"hidden"});else{this.label=h.renderer.label(D,null,void 0,v.shape,void 0,void 0,v.useHTML,!1,"stack-labels");let L={r:v.borderRadius||0,text:D,padding:Bl(v.padding,5),visibility:"hidden"};h.styledMode||(L.fill=v.backgroundColor,L.stroke=v.borderColor,L["stroke-width"]=v.borderWidth,this.label.css(v.style||{})),this.label.attr(L),this.label.added||this.label.add(Y)}this.label.labelrank=h.plotSizeY,rl(this,"afterRender")}setOffset(Y,h,v,S,D,L){let{alignOptions:z,axis:B,label:U,options:X,textAlign:te}=this,K=B.chart,re=this.getStackBox({xOffset:Y,width:h,boxBottom:v,boxTop:S,defaultX:D,xAxis:L}),{verticalAlign:ue}=z;if(U&&re){let ge=U.getBBox(void 0,0),ye=U.padding,be=Bl(X.overflow,"justify")==="justify",_e;z.x=X.x||0,z.y=X.y||0;let{x:Fe,y:ze}=this.adjustStackPosition({labelBox:ge,verticalAlign:ue,textAlign:te});re.x-=Fe,re.y-=ze,U.align(z,!1,re),(_e=K.isInsidePlot(U.alignAttr.x+z.x+Fe,U.alignAttr.y+z.y+ze))||(be=!1),be&&Op.prototype.justifyDataLabel.call(B,U,z,U.alignAttr,ge,re),U.attr({x:U.alignAttr.x,y:U.alignAttr.y,rotation:X.rotation,rotationOriginX:ge.width*Lp(X.textAlign||"center"),rotationOriginY:ge.height/2}),Bl(!be&&X.crop,!0)&&(_e=Rp(U.x)&&Rp(U.y)&&K.isInsidePlot(U.x-ye+(U.width||0),U.y)&&K.isInsidePlot(U.x+ye,U.y)),U[_e?"show":"hide"]()}rl(this,"afterSetOffset",{xOffset:Y,width:h})}adjustStackPosition({labelBox:Y,verticalAlign:h,textAlign:v}){return{x:Y.width/2+Y.width/2*(2*Lp(v)-1),y:Y.height/2*2*(1-Lp(h))}}getStackBox(Y){let h=this.axis,v=h.chart,{boxTop:S,defaultX:D,xOffset:L,width:z,boxBottom:B}=Y,U=h.stacking.usePercentage?100:Bl(S,this.total,0),X=h.toPixels(U),te=Y.xAxis||v.xAxis[0],K=Bl(D,te.translate(this.x))+L,re=Math.abs(X-h.toPixels(B||Rp(h.min)&&h.logarithmic&&h.logarithmic.lin2log(h.min)||0)),ue=v.inverted,ge=this.isNegative;return ue?{x:(ge?X:X-re)-v.plotLeft,y:te.height-K-z+te.top-v.plotTop,width:re,height:z}:{x:K+te.transB-v.plotLeft,y:(ge?X-re:X)-v.plotTop,width:z,height:re}}},{getDeferredAnimation:ya}=se,{series:{prototype:to}}=Hn,{addEvent:co,correctFloat:Wn,defined:zp,destroyObjectProperties:uo,fireEvent:Fp,isNumber:Nl,objectEach:u,pick:t}=Bi;function n(){let Y=this.inverted;this.axes.forEach(h=>{h.stacking&&h.stacking.stacks&&h.hasVisibleSeries&&(h.stacking.oldStacks=h.stacking.stacks)}),this.series.forEach(h=>{let v=h.xAxis&&h.xAxis.options||{};h.options.stacking&&h.reserveSpace()&&(h.stackKey=[h.type,t(h.options.stack,""),Y?v.top:v.left,Y?v.height:v.width].join(","))})}function d(){var h;let Y=this.stacking;if(Y){let v=Y.stacks;u(v,(S,D)=>{uo(S),delete v[D]}),(h=Y.stackTotalGroup)==null||h.destroy()}}function y(){this.stacking||(this.stacking=new j(this))}function b(Y,h,v,S){return!zp(Y)||Y.x!==h||S&&Y.stackKey!==S?Y={x:h,index:0,key:S,stackKey:S}:Y.index++,Y.key=[v,h,Y.index].join(","),Y}function T(){let Y,h=this,v=h.yAxis,S=h.stackKey||"",D=v.stacking.stacks,L=h.getColumn("x",!0),z=h.options.stacking,B=h[z+"Stacker"];B&&[S,"-"+S].forEach(U=>{var ue;let X=L.length,te,K,re;for(;X--;)te=L[X],Y=h.getStackIndicator(Y,te,h.index,U),K=(ue=D[U])==null?void 0:ue[te],(re=K==null?void 0:K.points[Y.key||""])&&B.call(h,re,K,X)})}function I(Y,h,v){let S=h.total?100/h.total:0;Y[0]=Wn(Y[0]*S),Y[1]=Wn(Y[1]*S),this.stackedYData[v]=Y[1]}function F(Y){(this.is("column")||this.is("columnrange"))&&(this.options.centerInCategory&&this.chart.series.length>1?to.setStackedPoints.call(this,Y,"group"):Y.stacking.resetStacks())}function V(Y,h){var Pt,Ft;let v,S,D,L,z,B,U,X=h||this.options.stacking;if(!X||!this.reserveSpace()||({group:"xAxis"}[X]||"yAxis")!==Y.coll)return;let te=this.getColumn("x",!0),K=this.getColumn(this.pointValKey||"y",!0),re=[],ue=K.length,ge=this.options,ye=ge.threshold||0,be=ge.startFromThreshold?ye:0,_e=ge.stack,Fe=h?`${this.type},${X}`:this.stackKey||"",ze="-"+Fe,ft=this.negStacks,St=Y.stacking,_t=St.stacks,Ot=St.oldStacks;for(St.stacksTouched+=1,U=0;U<ue;U++){let di=te[U]||0,gi=K[U],Ai=Nl(gi)&&gi||0;B=(v=this.getStackIndicator(v,di,this.index)).key||"",_t[z=(S=ft&&Ai<(be?0:ye))?ze:Fe]||(_t[z]={}),_t[z][di]||((Pt=Ot[z])!=null&&Pt[di]?(_t[z][di]=Ot[z][di],_t[z][di].total=null):_t[z][di]=new _a(Y,Y.options.stackLabels,!!S,di,_e)),D=_t[z][di],gi!==null?(D.points[B]=D.points[this.index]=[t(D.cumulative,be)],zp(D.cumulative)||(D.base=B),D.touched=St.stacksTouched,v.index>0&&this.singleStacks===!1&&(D.points[B][0]=D.points[this.index+","+di+",0"][0])):(delete D.points[B],delete D.points[this.index]);let ai=D.total||0;X==="percent"?(L=S?Fe:ze,ai=ft&&((Ft=_t[L])!=null&&Ft[di])?(L=_t[L][di]).total=Math.max(L.total||0,ai)+Math.abs(Ai):Wn(ai+Math.abs(Ai))):X==="group"?Nl(gi)&&ai++:ai=Wn(ai+Ai),X==="group"?D.cumulative=(ai||1)-1:D.cumulative=Wn(t(D.cumulative,be)+Ai),D.total=ai,gi!==null&&(D.points[B].push(D.cumulative),re[U]=D.cumulative,D.hasValidPoints=!0)}X==="percent"&&(St.usePercentage=!0),X!=="group"&&(this.stackedYData=re),St.oldStacks={}}class j{constructor(h){this.oldStacks={},this.stacks={},this.stacksTouched=0,this.axis=h}buildStacks(){let h,v,S=this.axis,D=S.series,L=S.coll==="xAxis",z=S.options.reversedStacks,B=D.length;for(this.resetStacks(),this.usePercentage=!1,v=B;v--;)h=D[z?v:B-v-1],L&&h.setGroupedPoints(S),h.setStackedPoints(S);if(!L)for(v=0;v<B;v++)D[v].modifyStacks();Fp(S,"afterBuildStacks")}cleanStacks(){this.oldStacks&&(this.stacks=this.oldStacks,u(this.stacks,h=>{u(h,v=>{v.cumulative=v.total})}))}resetStacks(){u(this.stacks,h=>{u(h,(v,S)=>{Nl(v.touched)&&v.touched<this.stacksTouched?(v.destroy(),delete h[S]):(v.total=null,v.cumulative=null)})})}renderStackTotals(){var B;let h=this.axis,v=h.chart,S=v.renderer,D=this.stacks,L=ya(v,((B=h.options.stackLabels)==null?void 0:B.animation)||!1),z=this.stackTotalGroup=this.stackTotalGroup||S.g("stack-labels").attr({zIndex:6,opacity:0}).add();z.translate(v.plotLeft,v.plotTop),u(D,U=>{u(U,X=>{X.render(z)})}),z.animate({opacity:1},L)}}(xe||(xe={})).compose=function(Y,h,v){let S=h.prototype,D=v.prototype;S.getStacks||(co(Y,"init",y),co(Y,"destroy",d),S.getStacks=n,D.getStackIndicator=b,D.modifyStacks=T,D.percentStacker=I,D.setGroupedPoints=F,D.setStackedPoints=V)};let G=xe,{defined:q,merge:Q,isObject:ce}=Bi;class ae extends eo{drawGraph(){let h=this.options,v=(this.gappedPath||this.getGraphPath).call(this),S=this.chart.styledMode;[this,...this.zones].forEach((D,L)=>{let z,B=D.graph,U=B?"animate":"attr",X=D.dashStyle||h.dashStyle;B?(B.endX=this.preventGraphAnimation?null:v.xMap,B.animate({d:v})):v.length&&(D.graph=B=this.chart.renderer.path(v).addClass("highcharts-graph"+(L?` highcharts-zone-graph-${L-1} `:" ")+(L&&D.className||"")).attr({zIndex:1}).add(this.group)),B&&!S&&(z={stroke:!L&&h.lineColor||D.color||this.color||"#cccccc","stroke-width":h.lineWidth||0,fill:this.fillGraph&&this.color||"none"},X?z.dashstyle=X:h.linecap!=="square"&&(z["stroke-linecap"]=z["stroke-linejoin"]="round"),B[U](z).shadow(h.shadow&&Q({filterUnits:"userSpaceOnUse"},ce(h.shadow)?h.shadow:{}))),B&&(B.startX=v.xMap,B.isArea=v.isArea)})}getGraphPath(h,v,S){let D=this,L=D.options,z=[],B=[],U,X=L.step,te=(h=h||D.points).reversed;return te&&h.reverse(),(X={right:1,center:2}[X]||X&&3)&&te&&(X=4-X),(h=this.getValidPoints(h,!1,!(L.connectNulls&&!v&&!S))).forEach(function(K,re){let ue,ge=K.plotX,ye=K.plotY,be=h[re-1],_e=K.isNull||typeof ye!="number";(K.leftCliff||be&&be.rightCliff)&&!S&&(U=!0),_e&&!q(v)&&re>0?U=!L.connectNulls:_e&&!v?U=!0:(re===0||U?ue=[["M",K.plotX,K.plotY]]:D.getPointSpline?ue=[D.getPointSpline(h,K,re)]:X?(ue=X===1?[["L",be.plotX,ye]]:X===2?[["L",(be.plotX+ge)/2,be.plotY],["L",(be.plotX+ge)/2,ye]]:[["L",ge,be.plotY]]).push(["L",ge,ye]):ue=[["L",ge,ye]],B.push(K.x),X&&(B.push(K.x),X===2&&B.push(K.x)),z.push.apply(z,ue),U=!1)}),z.xMap=B,D.graphPath=z,z}}ae.defaultOptions=Q(eo.defaultOptions,{legendSymbol:"lineMarker"}),Hn.registerSeriesType("line",ae);let{seriesTypes:{line:de}}=Hn,{extend:pe,merge:Te,objectEach:ke,pick:De}=Bi;class Ue extends de{drawGraph(){this.areaPath=[],super.drawGraph.apply(this);let{areaPath:h,options:v}=this;[this,...this.zones].forEach((S,D)=>{let L={},z=S.fillColor||v.fillColor,B=S.area,U=B?"animate":"attr";B?(B.endX=this.preventGraphAnimation?null:h.xMap,B.animate({d:h})):(L.zIndex=0,(B=S.area=this.chart.renderer.path(h).addClass("highcharts-area"+(D?` highcharts-zone-area-${D-1} `:" ")+(D&&S.className||"")).add(this.group)).isArea=!0),this.chart.styledMode||(L.fill=z||S.color||this.color,L["fill-opacity"]=z?1:v.fillOpacity??.75,B.css({pointerEvents:this.stickyTracking?"none":"auto"})),B[U](L),B.startX=h.xMap,B.shiftUnit=v.step?2:1})}getGraphPath(h){let v,S,D,L=de.prototype.getGraphPath,z=this.options,B=z.stacking,U=this.yAxis,X=[],te=[],K=this.index,re=U.stacking.stacks[this.stackKey],ue=z.threshold,ge=Math.round(U.getThreshold(z.threshold)),ye=De(z.connectNulls,B==="percent"),be=function(_t,Ot,Pt){let Ft=h[_t],di=B&&re[Ft.x].points[K],gi=Ft[Pt+"Null"]||0,Ai=Ft[Pt+"Cliff"]||0,ai,Ei,Zi=!0;Ai||gi?(ai=(gi?di[0]:di[1])+Ai,Ei=di[0]+Ai,Zi=!!gi):!B&&h[Ot]&&h[Ot].isNull&&(ai=Ei=ue),ai!==void 0&&(te.push({plotX:v,plotY:ai===null?ge:U.getThreshold(ai),isNull:Zi,isCliff:!0}),X.push({plotX:v,plotY:Ei===null?ge:U.getThreshold(Ei),doCurve:!1}))};h=h||this.points,B&&(h=this.getStackPoints(h));for(let _t=0,Ot=h.length;_t<Ot;++_t)B||(h[_t].leftCliff=h[_t].rightCliff=h[_t].leftNull=h[_t].rightNull=void 0),S=h[_t].isNull,v=De(h[_t].rectPlotX,h[_t].plotX),D=B?De(h[_t].yBottom,ge):ge,S&&!ye||(ye||be(_t,_t-1,"left"),S&&!B&&ye||(te.push(h[_t]),X.push({x:_t,plotX:v,plotY:D})),ye||be(_t,_t+1,"right"));let _e=L.call(this,te,!0,!0);X.reversed=!0;let Fe=L.call(this,X,!0,!0),ze=Fe[0];ze&&ze[0]==="M"&&(Fe[0]=["L",ze[1],ze[2]]);let ft=_e.concat(Fe);ft.length&&ft.push(["Z"]);let St=L.call(this,te,!1,ye);return this.chart.series.length>1&&B&&te.some(_t=>_t.isCliff)&&(ft.hasStackedCliffs=St.hasStackedCliffs=!0),ft.xMap=_e.xMap,this.areaPath=ft,St}getStackPoints(h){let v=this,S=[],D=[],L=this.xAxis,z=this.yAxis,B=z.stacking.stacks[this.stackKey],U={},X=z.series,te=X.length,K=z.options.reversedStacks?1:-1,re=X.indexOf(v);if(h=h||this.points,this.options.stacking){for(let ge=0;ge<h.length;ge++)h[ge].leftNull=h[ge].rightNull=void 0,U[h[ge].x]=h[ge];ke(B,function(ge,ye){ge.total!==null&&D.push(ye)}),D.sort(function(ge,ye){return ge-ye});let ue=X.map(ge=>ge.visible);D.forEach(function(ge,ye){let be=0,_e,Fe;if(U[ge]&&!U[ge].isNull)S.push(U[ge]),[-1,1].forEach(function(ze){let ft=ze===1?"rightNull":"leftNull",St=B[D[ye+ze]],_t=0;if(St){let Ot=re;for(;Ot>=0&&Ot<te;){let Pt=X[Ot].index;!(_e=St.points[Pt])&&(Pt===v.index?U[ge][ft]=!0:ue[Ot]&&(Fe=B[ge].points[Pt])&&(_t-=Fe[1]-Fe[0])),Ot+=K}}U[ge][ze===1?"rightCliff":"leftCliff"]=_t});else{let ze=re;for(;ze>=0&&ze<te;){let ft=X[ze].index;if(_e=B[ge].points[ft]){be=_e[1];break}ze+=K}be=De(be,0),be=z.translate(be,0,1,0,1),S.push({isNull:!0,plotX:L.translate(ge,0,0,0,1),x:ge,plotY:be,yBottom:be})}})}return S}}Ue.defaultOptions=Te(de.defaultOptions,{threshold:0,legendSymbol:"areaMarker"}),pe(Ue.prototype,{singleStacks:!1}),Hn.registerSeriesType("area",Ue);let{line:Le}=Hn.seriesTypes,{merge:Ne,pick:Oe}=Bi;class We extends Le{getPointSpline(h,v,S){let D,L,z,B,U=v.plotX||0,X=v.plotY||0,te=h[S-1],K=h[S+1];function re(ge){return ge&&!ge.isNull&&ge.doCurve!==!1&&!v.isCliff}if(re(te)&&re(K)){let ge=te.plotX||0,ye=te.plotY||0,be=K.plotX||0,_e=K.plotY||0,Fe=0;D=(1.5*U+ge)/2.5,L=(1.5*X+ye)/2.5,z=(1.5*U+be)/2.5,B=(1.5*X+_e)/2.5,z!==D&&(Fe=(B-L)*(z-U)/(z-D)+X-B),L+=Fe,B+=Fe,L>ye&&L>X?(L=Math.max(ye,X),B=2*X-L):L<ye&&L<X&&(L=Math.min(ye,X),B=2*X-L),B>_e&&B>X?(B=Math.max(_e,X),L=2*X-B):B<_e&&B<X&&(B=Math.min(_e,X),L=2*X-B),v.rightContX=z,v.rightContY=B,v.controlPoints={low:[D,L],high:[z,B]}}let ue=["C",Oe(te.rightContX,te.plotX,0),Oe(te.rightContY,te.plotY,0),Oe(D,U,0),Oe(L,X,0),U,X];return te.rightContX=te.rightContY=void 0,ue}}We.defaultOptions=Ne(Le.defaultOptions),Hn.registerSeriesType("spline",We);let Qe=We,{area:xt,area:{prototype:ut}}=Hn.seriesTypes,{extend:Dt,merge:At}=Bi;class ot extends Qe{}ot.defaultOptions=At(Qe.defaultOptions,xt.defaultOptions),Dt(ot.prototype,{getGraphPath:ut.getGraphPath,getStackPoints:ut.getStackPoints,drawGraph:ut.drawGraph}),Hn.registerSeriesType("areaspline",ot);let{animObject:wt}=se,{parse:Vt}=Jr,{noop:st}=Ve,{clamp:It,crisp:bt,defined:Kt,extend:Bt,fireEvent:kt,isArray:$t,isNumber:Xt,merge:ci,pick:pi,objectEach:Fi}=Bi;class Mi extends eo{animate(h){let v,S,D=this,L=this.yAxis,z=L.pos,B=L.reversed,U=D.options,{clipOffset:X,inverted:te}=this.chart,K={},re=te?"translateX":"translateY";h&&X?(K.scaleY=.001,S=It(L.toPixels(U.threshold||0),z,z+L.len),te?(S+=B?-Math.floor(X[0]):Math.ceil(X[2]),K.translateX=S-L.len):(S+=B?Math.ceil(X[0]):-Math.floor(X[2]),K.translateY=S),D.clipBox&&D.setClip(),D.group.attr(K)):(v=Number(D.group.attr(re)),D.group.animate({scaleY:1},Bt(wt(D.options.animation),{step:function(ue,ge){D.group&&(K[re]=v+ge.pos*(z-v),D.group.attr(K))}})))}init(h,v){super.init.apply(this,arguments);let S=this;(h=S.chart).hasRendered&&h.series.forEach(function(D){D.type===S.type&&(D.isDirty=!0)})}getColumnMetrics(){var ye,be;let h=this,v=h.options,S=h.xAxis,D=h.yAxis,L=S.options.reversedStacks,z=S.reversed&&!L||!S.reversed&&L,B={},U,X=0;v.grouping===!1?X=1:h.chart.series.forEach(function(_e){let Fe,ze=_e.yAxis,ft=_e.options;_e.type===h.type&&_e.reserveSpace()&&D.len===ze.len&&D.pos===ze.pos&&(ft.stacking&&ft.stacking!=="group"?(B[U=_e.stackKey]===void 0&&(B[U]=X++),Fe=B[U]):ft.grouping!==!1&&(Fe=X++),_e.columnIndex=Fe)});let te=Math.min(Math.abs(S.transA)*(!((ye=S.brokenAxis)!=null&&ye.hasBreaks)&&((be=S.ordinal)==null?void 0:be.slope)||v.pointRange||S.closestPointRange||S.tickInterval||1),S.len),K=te*v.groupPadding,re=(te-2*K)/(X||1),ue=Math.min(v.maxPointWidth||S.len,pi(v.pointWidth,re*(1-2*v.pointPadding))),ge=(h.columnIndex||0)+(z?1:0);return h.columnMetrics={width:ue,offset:(re-ue)/2+(K+ge*re-te/2)*(z?-1:1),paddedWidth:re,columnCount:X},h.columnMetrics}crispCol(h,v,S,D){let L=this.borderWidth,z=this.chart.inverted;return D=bt(v+D,L,z)-(v=bt(v,L,z)),this.options.crisp&&(S=bt(h+S,L)-(h=bt(h,L))),{x:h,y:v,width:S,height:D}}adjustForMissingColumns(h,v,S,D){var L;if(!S.isNull&&D.columnCount>1){let z=this.xAxis.series.filter(te=>te.visible).map(te=>te.index),B=0,U=0;Fi((L=this.xAxis.stacking)==null?void 0:L.stacks,te=>{var ge;let K=typeof S.x=="number"?(ge=te[S.x.toString()])==null?void 0:ge.points:void 0,re=K==null?void 0:K[this.index],ue={};if(K&&$t(re)){let ye=this.index,be=Object.keys(K).filter(_e=>!_e.match(",")&&K[_e]&&K[_e].length>1).map(parseFloat).filter(_e=>z.indexOf(_e)!==-1).filter(_e=>{let Fe=this.chart.series[_e].options,ze=Fe.stacking&&Fe.stack;if(Kt(ze)){if(Xt(ue[ze]))return ye===_e&&(ye=ue[ze]),!1;ue[ze]=_e}return!0}).sort((_e,Fe)=>Fe-_e);B=be.indexOf(ye),U=be.length}}),B=this.xAxis.reversed?U-1-B:B;let X=(U-1)*D.paddedWidth+v;h=(S.plotX||0)+X/2-v-B*D.paddedWidth}return h}translate(){let h=this,v=h.chart,S=h.options,D=h.dense=h.closestPointRange*h.xAxis.transA<2,L=h.borderWidth=pi(S.borderWidth,D?0:1),z=h.xAxis,B=h.yAxis,U=S.threshold,X=pi(S.minPointLength,5),te=h.getColumnMetrics(),K=te.width,re=h.pointXOffset=te.offset,ue=h.dataMin,ge=h.dataMax,ye=h.translatedThreshold=B.getThreshold(U),be=h.barW=Math.max(K,1+2*L);S.pointPadding&&S.crisp&&(be=Math.ceil(be)),eo.prototype.translate.apply(h),h.points.forEach(function(_e){let Fe=pi(_e.yBottom,ye),ze=999+Math.abs(Fe),ft=_e.plotX||0,St=It(_e.plotY,-ze,B.len+ze),_t,Ot=Math.min(St,Fe),Pt=Math.max(St,Fe)-Ot,Ft=K,di=ft+re,gi=be;X&&Math.abs(Pt)<X&&(Pt=X,_t=!B.reversed&&!_e.negative||B.reversed&&_e.negative,Xt(U)&&Xt(ge)&&_e.y===U&&ge<=U&&(B.min||0)<U&&(ue!==ge||(B.max||0)<=U)&&(_t=!_t,_e.negative=!_e.negative),Ot=Math.abs(Ot-ye)>X?Fe-X:ye-(_t?X:0)),Kt(_e.options.pointWidth)&&(di-=Math.round(((Ft=gi=Math.ceil(_e.options.pointWidth))-K)/2)),S.centerInCategory&&(di=h.adjustForMissingColumns(di,Ft,_e,te)),_e.barX=di,_e.pointWidth=Ft,_e.tooltipPos=v.inverted?[It(B.len+B.pos-v.plotLeft-St,B.pos-v.plotLeft,B.len+B.pos-v.plotLeft),z.len+z.pos-v.plotTop-di-gi/2,Pt]:[z.left-v.plotLeft+di+gi/2,It(St+B.pos-v.plotTop,B.pos-v.plotTop,B.len+B.pos-v.plotTop),Pt],_e.shapeType=h.pointClass.prototype.shapeType||"roundedRect",_e.shapeArgs=h.crispCol(di,_e.isNull?ye:Ot,gi,_e.isNull?0:Pt)}),kt(this,"afterColumnTranslate")}drawGraph(){this.group[this.dense?"addClass":"removeClass"]("highcharts-dense-data")}pointAttribs(h,v){let S=this.options,D=this.pointAttrToOptions||{},L=D.stroke||"borderColor",z=D["stroke-width"]||"borderWidth",B,U,X,te=h&&h.color||this.color,K=h&&h[L]||S[L]||te,re=h&&h.options.dashStyle||S.dashStyle,ue=h&&h[z]||S[z]||this[z]||0,ge=pi(h&&h.opacity,S.opacity,1);h&&this.zones.length&&(U=h.getZone(),te=h.options.color||U&&(U.color||h.nonZonedColor)||this.color,U&&(K=U.borderColor||K,re=U.dashStyle||re,ue=U.borderWidth||ue)),v&&h&&(X=(B=ci(S.states[v],h.options.states&&h.options.states[v]||{})).brightness,te=B.color||X!==void 0&&Vt(te).brighten(B.brightness).get()||te,K=B[L]||K,ue=B[z]||ue,re=B.dashStyle||re,ge=pi(B.opacity,ge));let ye={fill:te,stroke:K,"stroke-width":ue,opacity:ge};return re&&(ye.dashstyle=re),ye}drawPoints(h=this.points){let v,S=this,D=this.chart,L=S.options,z=D.renderer,B=L.animationLimit||250;h.forEach(function(U){let X=U.plotY,te=U.graphic,K=!!te,re=te&&D.pointCount<B?"animate":"attr";Xt(X)&&U.y!==null?(v=U.shapeArgs,te&&U.hasNewShapeType()&&(te=te.destroy()),S.enabledDataSorting&&(U.startXPos=S.xAxis.reversed?-(v&&v.width||0):S.xAxis.width),!te&&(U.graphic=te=z[U.shapeType](v).add(U.group||S.group),te&&S.enabledDataSorting&&D.hasRendered&&D.pointCount<B&&(te.attr({x:U.startXPos}),K=!0,re="animate")),te&&K&&te[re](ci(v)),D.styledMode||te[re](S.pointAttribs(U,U.selected&&"select")).shadow(U.allowShadow!==!1&&L.shadow),te&&(te.addClass(U.getClassName(),!0),te.attr({visibility:U.visible?"inherit":"hidden"}))):te&&(U.graphic=te.destroy())})}drawTracker(h=this.points){let v,S=this,D=S.chart,L=D.pointer,z=function(B){L==null||L.normalize(B);let U=L==null?void 0:L.getPointFromEvent(B),X=!D.scrollablePlotArea||D.isInsidePlot(B.chartX-D.plotLeft,B.chartY-D.plotTop,{visiblePlotOnly:!0});L&&U&&S.options.enableMouseTracking&&X&&(L.isDirectTouch=!0,U.onMouseOver(B))};h.forEach(function(B){v=$t(B.dataLabels)?B.dataLabels:B.dataLabel?[B.dataLabel]:[],B.graphic&&(B.graphic.element.point=B),v.forEach(function(U){(U.div||U.element).point=B})}),S._hasTracking||(S.trackerGroups.forEach(function(B){S[B]&&(S[B].addClass("highcharts-tracker").on("mouseover",z).on("mouseout",function(U){L==null||L.onTrackerMouseOut(U)}).on("touchstart",z),!D.styledMode&&S.options.cursor&&S[B].css({cursor:S.options.cursor}))}),S._hasTracking=!0),kt(this,"afterDrawTracker")}remove(){let h=this,v=h.chart;v.hasRendered&&v.series.forEach(function(S){S.type===h.type&&(S.isDirty=!0)}),eo.prototype.remove.apply(h,arguments)}}Mi.defaultOptions=ci(eo.defaultOptions,{borderRadius:3,centerInCategory:!1,groupPadding:.2,marker:null,pointPadding:.1,minPointLength:0,cropThreshold:50,pointRange:null,states:{hover:{halo:!1,brightness:.1},select:{color:"#cccccc",borderColor:"#000000"}},dataLabels:{align:void 0,verticalAlign:void 0,y:void 0},startFromThreshold:!0,stickyTracking:!1,tooltip:{distance:6},threshold:0,borderColor:"#ffffff"}),Bt(Mi.prototype,{directTouch:!0,getSymbol:st,negStacks:!0,trackerGroups:["group","dataLabelsGroup"]}),Hn.registerSeriesType("column",Mi);let Ci=Mi,{getDeferredAnimation:ji}=se,{format:pr}=Po,{defined:Er,extend:dn,fireEvent:$r,getAlignFactor:$i,isArray:lr,isString:bi,merge:or,objectEach:Ir,pick:Mr,pInt:pn,splat:ns}=Bi;(function(Y){function h(){return U(this).some(te=>te==null?void 0:te.enabled)}function v(te,K,re,ue,ge){var di;let{chart:ye,enabledDataSorting:be}=this,_e=this.isCartesian&&ye.inverted,Fe=te.plotX,ze=te.plotY,ft=re.rotation||0,St=Er(Fe)&&Er(ze)&&ye.isInsidePlot(Fe,Math.round(ze),{inverted:_e,paneCoordinates:!0,series:this}),_t=ft===0&&Mr(re.overflow,be?"none":"justify")==="justify",Ot=this.visible&&te.visible!==!1&&Er(Fe)&&(te.series.forceDL||be&&!_t||St||Mr(re.inside,!!this.options.stacking)&&ue&&ye.isInsidePlot(Fe,_e?ue.x+1:ue.y+ue.height-1,{inverted:_e,paneCoordinates:!0,series:this})),Pt=te.pos();if(Ot&&Pt){var Ft;let gi=K.getBBox(),Ai=K.getBBox(void 0,0);if(ue=dn({x:Pt[0],y:Math.round(Pt[1]),width:0,height:0},ue||{}),re.alignTo==="plotEdges"&&this.isCartesian&&(ue[_e?"x":"y"]=0,ue[_e?"width":"height"]=((di=this.yAxis)==null?void 0:di.len)||0),dn(re,{width:gi.width,height:gi.height}),Ft=ue,be&&this.xAxis&&!_t&&this.setDataLabelStartPos(te,K,ge,St,Ft),K.align(or(re,{width:Ai.width,height:Ai.height}),!1,ue,!1),K.alignAttr.x+=$i(re.align)*(Ai.width-gi.width),K.alignAttr.y+=$i(re.verticalAlign)*(Ai.height-gi.height),K[K.placed?"animate":"attr"]({"text-align":K.alignAttr["text-align"]||"center",x:K.alignAttr.x+(gi.width-Ai.width)/2,y:K.alignAttr.y+(gi.height-Ai.height)/2,rotationOriginX:(K.width||0)/2,rotationOriginY:(K.height||0)/2}),_t&&ue.height>=0)this.justifyDataLabel(K,re,K.alignAttr,gi,ue,ge);else if(Mr(re.crop,!0)){let{x:ai,y:Ei}=K.alignAttr;Ot=ye.isInsidePlot(ai,Ei,{paneCoordinates:!0,series:this})&&ye.isInsidePlot(ai+gi.width-1,Ei+gi.height-1,{paneCoordinates:!0,series:this})}re.shape&&!ft&&K[ge?"attr":"animate"]({anchorX:Pt[0],anchorY:Pt[1]})}ge&&be&&(K.placed=!1),Ot||be&&!_t?(K.show(),K.placed=!0):(K.hide(),K.placed=!1)}function S(){return this.plotGroup("dataLabelsGroup","data-labels",this.hasRendered?"inherit":"hidden",this.options.dataLabels.zIndex||6)}function D(te){let K=this.hasRendered||0,re=this.initDataLabelsGroup().attr({opacity:+K});return!K&&re&&(this.visible&&re.show(),this.options.animation?re.animate({opacity:1},te):re.attr({opacity:1})),re}function L(te){var Ot;let K;te=te||this.points;let re=this,ue=re.chart,ge=re.options,ye=ue.renderer,{backgroundColor:be,plotBackgroundColor:_e}=ue.options.chart,Fe=ye.getContrast(bi(_e)&&_e||bi(be)&&be||"#000000"),ze=U(re),{animation:ft,defer:St}=ze[0],_t=St?ji(ue,ft,re):{defer:0,duration:0};$r(this,"drawDataLabels"),(Ot=re.hasDataLabels)!=null&&Ot.call(re)&&(K=this.initDataLabels(_t),te.forEach(Pt=>{var gi,Ai;let Ft=Pt.dataLabels||[];ns(B(ze,Pt.dlOptions||((gi=Pt.options)==null?void 0:gi.dataLabels))).forEach((ai,Ei)=>{let Zi=ai.enabled&&(Pt.visible||Pt.dataLabelOnHidden)&&(!Pt.isNull||Pt.dataLabelOnNull)&&function(Ms,ss){let Cs=ss.filter;if(Cs){let os=Cs.operator,Xn=Ms[Cs.property],Bs=Cs.value;return os===">"&&Xn>Bs||os==="<"&&Xn<Bs||os===">="&&Xn>=Bs||os==="<="&&Xn<=Bs||os==="=="&&Xn==Bs||os==="==="&&Xn===Bs||os==="!="&&Xn!=Bs||os==="!=="&&Xn!==Bs}return!0}(Pt,ai),{backgroundColor:kr,borderColor:Gi,distance:gr,style:Vi={}}=ai,Qi,_r,un,kn={},zr=Ft[Ei],Gr=!zr,Xr;Zi&&(_r=Er(Qi=Mr(ai[Pt.formatPrefix+"Format"],ai.format))?pr(Qi,Pt,ue):(ai[Pt.formatPrefix+"Formatter"]||ai.formatter).call(Pt,ai),un=ai.rotation,!ue.styledMode&&(Vi.color=Mr(ai.color,Vi.color,bi(re.color)?re.color:void 0,"#000000"),Vi.color==="contrast"?(kr!=="none"&&(Xr=kr),Pt.contrastColor=ye.getContrast(Xr!=="auto"&&Xr||Pt.color||re.color),Vi.color=Xr||!Er(gr)&&ai.inside||0>pn(gr||0)||ge.stacking?Pt.contrastColor:Fe):delete Pt.contrastColor,ge.cursor&&(Vi.cursor=ge.cursor)),kn={r:ai.borderRadius||0,rotation:un,padding:ai.padding,zIndex:1},ue.styledMode||(kn.fill=kr==="auto"?Pt.color:kr,kn.stroke=Gi==="auto"?Pt.color:Gi,kn["stroke-width"]=ai.borderWidth),Ir(kn,(Ms,ss)=>{Ms===void 0&&delete kn[ss]})),!zr||Zi&&Er(_r)&&!!zr.div==!!ai.useHTML&&(zr.rotation&&ai.rotation||zr.rotation===ai.rotation)||(zr=void 0,Gr=!0),Zi&&Er(_r)&&(zr?kn.text=_r:(zr=ye.label(_r,0,0,ai.shape,void 0,void 0,ai.useHTML,void 0,"data-label")).addClass(" highcharts-data-label-color-"+Pt.colorIndex+" "+(ai.className||"")+(ai.useHTML?" highcharts-tracker":"")),zr&&(zr.options=ai,zr.attr(kn),ue.styledMode?Vi.width&&zr.css({width:Vi.width,textOverflow:Vi.textOverflow,whiteSpace:Vi.whiteSpace}):zr.css(Vi).shadow(ai.shadow),$r(zr,"beforeAddingDataLabel",{labelOptions:ai,point:Pt}),zr.added||zr.add(K),re.alignDataLabel(Pt,zr,ai,void 0,Gr),zr.isActive=!0,Ft[Ei]&&Ft[Ei]!==zr&&Ft[Ei].destroy(),Ft[Ei]=zr))});let di=Ft.length;for(;di--;)Ft[di]&&Ft[di].isActive?Ft[di].isActive=!1:((Ai=Ft[di])==null||Ai.destroy(),Ft.splice(di,1));Pt.dataLabel=Ft[0],Pt.dataLabels=Ft})),$r(this,"afterDrawDataLabels")}function z(te,K,re,ue,ge,ye){let be=this.chart,_e=K.align,Fe=K.verticalAlign,ze=te.box?0:te.padding||0,ft=be.inverted?this.yAxis:this.xAxis,St=ft?ft.left-be.plotLeft:0,_t=be.inverted?this.xAxis:this.yAxis,Ot=_t?_t.top-be.plotTop:0,{x:Pt=0,y:Ft=0}=K,di,gi;return(di=(re.x||0)+ze+St)<0&&(_e==="right"&&Pt>=0?(K.align="left",K.inside=!0):Pt-=di,gi=!0),(di=(re.x||0)+ue.width-ze+St)>be.plotWidth&&(_e==="left"&&Pt<=0?(K.align="right",K.inside=!0):Pt+=be.plotWidth-di,gi=!0),(di=re.y+ze+Ot)<0&&(Fe==="bottom"&&Ft>=0?(K.verticalAlign="top",K.inside=!0):Ft-=di,gi=!0),(di=(re.y||0)+ue.height-ze+Ot)>be.plotHeight&&(Fe==="top"&&Ft<=0?(K.verticalAlign="bottom",K.inside=!0):Ft+=be.plotHeight-di,gi=!0),gi&&(K.x=Pt,K.y=Ft,te.placed=!ye,te.align(K,void 0,ge)),gi}function B(te,K){let re=[],ue;if(lr(te)&&!lr(K))re=te.map(function(ge){return or(ge,K)});else if(lr(K)&&!lr(te))re=K.map(function(ge){return or(te,ge)});else if(lr(te)||lr(K)){if(lr(te)&&lr(K))for(ue=Math.max(te.length,K.length);ue--;)re[ue]=or(te[ue],K[ue])}else re=or(te,K);return re}function U(te){var re,ue;let K=te.chart.options.plotOptions;return ns(B(B((re=K==null?void 0:K.series)==null?void 0:re.dataLabels,(ue=K==null?void 0:K[te.type])==null?void 0:ue.dataLabels),te.options.dataLabels))}function X(te,K,re,ue,ge){let ye=this.chart,be=ye.inverted,_e=this.xAxis,Fe=_e.reversed,ze=((be?K.height:K.width)||0)/2,ft=te.pointWidth,St=ft?ft/2:0;K.startXPos=be?ge.x:Fe?-ze-St:_e.width-ze+St,K.startYPos=be?Fe?this.yAxis.height-ze+St:-ze-St:ge.y,ue?K.visibility==="hidden"&&(K.show(),K.attr({opacity:0}).animate({opacity:1})):K.attr({opacity:1}).animate({opacity:0},void 0,K.hide),ye.hasRendered&&(re&&K.attr({x:K.startXPos,y:K.startYPos}),K.placed=!0)}Y.compose=function(te){let K=te.prototype;K.initDataLabels||(K.initDataLabels=D,K.initDataLabelsGroup=S,K.alignDataLabel=v,K.drawDataLabels=L,K.justifyDataLabel=z,K.setDataLabelStartPos=X,K.hasDataLabels=h)}})(Ae||(Ae={}));let Tn=Ae,{composed:qn}=Ve,{series:Co}=Hn,{merge:Gs,pick:rn,pushUnique:Hr}=Bi;(function(Y){function h(v,S,D,L,z){let B=this.chart.inverted,U=v.series,X=(U.xAxis?U.xAxis.len:this.chart.plotSizeX)||0,te=(U.yAxis?U.yAxis.len:this.chart.plotSizeY)||0,K=v.dlBox||v.shapeArgs,re=rn(v.below,v.plotY>rn(this.translatedThreshold,te)),ue=rn(D.inside,!!this.options.stacking);if(K){if(L=Gs(K),!(D.overflow==="allow"&&D.crop===!1)){L.y<0&&(L.height+=L.y,L.y=0);let ge=L.y+L.height-te;ge>0&&ge<L.height-1&&(L.height-=ge)}B&&(L={x:te-L.y-L.height,y:X-L.x-L.width,width:L.height,height:L.width}),ue||(B?(L.x+=re?0:L.width,L.width=0):(L.y+=re?L.height:0,L.height=0))}D.align=rn(D.align,!B||ue?"center":re?"right":"left"),D.verticalAlign=rn(D.verticalAlign,B||ue?"middle":re?"top":"bottom"),Co.prototype.alignDataLabel.call(this,v,S,D,L,z),D.inside&&v.contrastColor&&S.css({color:v.contrastColor})}Y.compose=function(v){Tn.compose(Co),Hr(qn,"ColumnDataLabel")&&(v.prototype.alignDataLabel=h)}})(Re||(Re={}));let Br=Re,{extend:mr,merge:In}=Bi;class Yn extends Ci{}Yn.defaultOptions=In(Ci.defaultOptions,{}),mr(Yn.prototype,{inverted:!0}),Hn.registerSeriesType("bar",Yn);let{column:jr,line:zs}=Hn.seriesTypes,{addEvent:ta,extend:Eo,merge:ho}=Bi;class Vo extends zs{applyJitter(){let h=this,v=this.options.jitter,S=this.points.length;v&&this.points.forEach(function(D,L){["x","y"].forEach(function(z,B){if(v[z]&&!D.isNull){let U=`plot${z.toUpperCase()}`,X=h[`${z}Axis`],te=v[z]*X.transA;if(X&&!X.logarithmic){let K=Math.max(0,(D[U]||0)-te),re=Math.min(X.len,(D[U]||0)+te);D[U]=K+(re-K)*function(ue){let ge=1e4*Math.sin(ue);return ge-Math.floor(ge)}(L+B*S),z==="x"&&(D.clientX=D.plotX)}}})})}drawGraph(){this.options.lineWidth?super.drawGraph():this.graph&&(this.graph=this.graph.destroy())}}Vo.defaultOptions=ho(zs.defaultOptions,{lineWidth:0,findNearestPointBy:"xy",jitter:{x:0,y:0},marker:{enabled:!0},tooltip:{headerFormat:'<span style="color:{point.color}">●</span> <span style="font-size: 0.8em"> {series.name}</span><br/>',pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>"}}),Eo(Vo.prototype,{drawTracker:jr.prototype.drawTracker,sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","markerGroup","dataLabelsGroup"]}),ta(Vo,"afterTranslate",function(){this.applyJitter()}),Hn.registerSeriesType("scatter",Vo);let{deg2rad:Uo}=Ve,{fireEvent:jo,isNumber:nl,pick:$o,relativeLength:Ec}=Bi;(function(Y){Y.getCenter=function(){let h=this.options,v=this.chart,S=2*(h.slicedOffset||0),D=v.plotWidth-2*S,L=v.plotHeight-2*S,z=h.center,B=Math.min(D,L),U=h.thickness,X,te=h.size,K=h.innerSize||0,re,ue;typeof te=="string"&&(te=parseFloat(te)),typeof K=="string"&&(K=parseFloat(K));let ge=[$o(z==null?void 0:z[0],"50%"),$o(z==null?void 0:z[1],"50%"),$o(te&&te<0?void 0:h.size,"100%"),$o(K&&K<0?void 0:h.innerSize||0,"0%")];for(!v.angular||this instanceof eo||(ge[3]=0),re=0;re<4;++re)ue=ge[re],X=re<2||re===2&&/%$/.test(ue),ge[re]=Ec(ue,[D,L,B,ge[2]][re])+(X?S:0);return ge[3]>ge[2]&&(ge[3]=ge[2]),nl(U)&&2*U<ge[2]&&U>0&&(ge[3]=ge[2]-2*U),jo(this,"afterGetCenter",{positions:ge}),ge},Y.getStartAndEndRadians=function(h,v){let S=nl(h)?h:0,D=nl(v)&&v>S&&v-S<360?v:S+360;return{start:Uo*(S+-90),end:Uo*(D+-90)}}})(He||(He={}));let Ac=He,{setAnimation:bd}=se,{addEvent:wd,defined:d_,extend:k0,isNumber:O0,pick:p_,relativeLength:f_}=Bi;class Jm extends Jo{getConnectorPath(h){let v=h.dataLabelPosition,S=h.options||{},D=S.connectorShape,L=this.connectorShapes[D]||D;return v&&L.call(this,{...v.computed,alignment:v.alignment},v.connectorPosition,S)||[]}getTranslate(){return this.sliced&&this.slicedTranslation||{translateX:0,translateY:0}}haloPath(h){let v=this.shapeArgs;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(v.x,v.y,v.r+h,v.r+h,{innerR:v.r-1,start:v.start,end:v.end,borderRadius:v.borderRadius})}constructor(h,v,S){super(h,v,S),this.half=0,this.name??(this.name="Slice");let D=L=>{this.slice(L.type==="select")};wd(this,"select",D),wd(this,"unselect",D)}isValid(){return O0(this.y)&&this.y>=0}setVisible(h,v=!0){h!==this.visible&&this.update({visible:h??!this.visible},v,void 0,!1)}slice(h,v,S){let D=this.series;bd(S,D.chart),v=p_(v,!0),this.sliced=this.options.sliced=h=d_(h)?h:!this.sliced,D.options.data[D.data.indexOf(this)]=this.options,this.graphic&&this.graphic.animate(this.getTranslate())}}k0(Jm.prototype,{connectorShapes:{fixedOffset:function(Y,h,v){let S=h.breakAt,D=h.touchingSliceAt,L=v.softConnector?["C",Y.x+(Y.alignment==="left"?-5:5),Y.y,2*S.x-D.x,2*S.y-D.y,S.x,S.y]:["L",S.x,S.y];return[["M",Y.x,Y.y],L,["L",D.x,D.y]]},straight:function(Y,h){let v=h.touchingSliceAt;return[["M",Y.x,Y.y],["L",v.x,v.y]]},crookedLine:function(Y,h,v){let{angle:S=this.angle||0,breakAt:D,touchingSliceAt:L}=h,{series:z}=this,[B,U,X]=z.center,te=X/2,{plotLeft:K,plotWidth:re}=z.chart,ue=Y.alignment==="left",{x:ge,y:ye}=Y,be=D.x;if(v.crookDistance){let Fe=f_(v.crookDistance,1);be=ue?B+te+(re+K-B-te)*(1-Fe):K+(B-te)*Fe}else be=B+(U-ye)*Math.tan(S-Math.PI/2);let _e=[["M",ge,ye]];return(ue?be<=ge&&be>=D.x:be>=ge&&be<=D.x)&&_e.push(["L",be,ye]),_e.push(["L",D.x,D.y],["L",L.x,L.y]),_e}}});let{getStartAndEndRadians:m_}=Ac,{noop:Qm}=Ve,{clamp:g_,extend:__,fireEvent:Kf,merge:Vl,pick:Fs}=Bi;class Jf extends eo{animate(h){let v=this,S=v.points,D=v.startAngleRad;h||S.forEach(function(L){let z=L.graphic,B=L.shapeArgs;z&&B&&(z.attr({r:Fs(L.startR,v.center&&v.center[3]/2),start:D,end:D}),z.animate({r:B.r,start:B.start,end:B.end},v.options.animation))})}drawEmpty(){let h,v,S=this.startAngleRad,D=this.endAngleRad,L=this.options;this.total===0&&this.center?(h=this.center[0],v=this.center[1],this.graph||(this.graph=this.chart.renderer.arc(h,v,this.center[1]/2,0,S,D).addClass("highcharts-empty-series").add(this.group)),this.graph.attr({d:Zc.arc(h,v,this.center[2]/2,0,{start:S,end:D,innerR:this.center[3]/2})}),this.chart.styledMode||this.graph.attr({"stroke-width":L.borderWidth,fill:L.fillColor||"none",stroke:L.color||"#cccccc"})):this.graph&&(this.graph=this.graph.destroy())}drawPoints(){let h=this.chart.renderer;this.points.forEach(function(v){v.graphic&&v.hasNewShapeType()&&(v.graphic=v.graphic.destroy()),v.graphic||(v.graphic=h[v.shapeType](v.shapeArgs).add(v.series.group),v.delayedRendering=!0)})}generatePoints(){super.generatePoints(),this.updateTotals()}getX(h,v,S,D){let L=this.center,z=this.radii?this.radii[S.index]||0:L[2]/2,B=D.dataLabelPosition,U=(B==null?void 0:B.distance)||0,X=Math.asin(g_((h-L[1])/(z+U),-1,1));return L[0]+Math.cos(X)*(z+U)*(v?-1:1)+(U>0?(v?-1:1)*(D.padding||0):0)}hasData(){return!!this.dataTable.rowCount}redrawPoints(){let h,v,S,D,L=this,z=L.chart;this.drawEmpty(),L.group&&!z.styledMode&&L.group.shadow(L.options.shadow),L.points.forEach(function(B){let U={};v=B.graphic,!B.isNull&&v?(D=B.shapeArgs,h=B.getTranslate(),z.styledMode||(S=L.pointAttribs(B,B.selected&&"select")),B.delayedRendering?(v.setRadialReference(L.center).attr(D).attr(h),z.styledMode||v.attr(S).attr({"stroke-linejoin":"round"}),B.delayedRendering=!1):(v.setRadialReference(L.center),z.styledMode||Vl(!0,U,S),Vl(!0,U,D,h),v.animate(U)),v.attr({visibility:B.visible?"inherit":"hidden"}),v.addClass(B.getClassName(),!0)):v&&(B.graphic=v.destroy())})}sortByAngle(h,v){h.sort(function(S,D){return S.angle!==void 0&&(D.angle-S.angle)*v})}translate(h){Kf(this,"translate"),this.generatePoints();let v=this.options,S=v.slicedOffset,D=m_(v.startAngle,v.endAngle),L=this.startAngleRad=D.start,z=(this.endAngleRad=D.end)-L,B=this.points,U=v.ignoreHiddenPoint,X=B.length,te,K,re,ue,ge,ye,be,_e=0;for(h||(this.center=h=this.getCenter()),ye=0;ye<X;ye++){be=B[ye],te=L+_e*z,be.isValid()&&(!U||be.visible)&&(_e+=be.percentage/100),K=L+_e*z;let Fe={x:h[0],y:h[1],r:h[2]/2,innerR:h[3]/2,start:Math.round(1e3*te)/1e3,end:Math.round(1e3*K)/1e3};be.shapeType="arc",be.shapeArgs=Fe,(re=(K+te)/2)>1.5*Math.PI?re-=2*Math.PI:re<-Math.PI/2&&(re+=2*Math.PI),be.slicedTranslation={translateX:Math.round(Math.cos(re)*S),translateY:Math.round(Math.sin(re)*S)},ue=Math.cos(re)*h[2]/2,ge=Math.sin(re)*h[2]/2,be.tooltipPos=[h[0]+.7*ue,h[1]+.7*ge],be.half=re<-Math.PI/2||re>Math.PI/2?1:0,be.angle=re}Kf(this,"afterTranslate")}updateTotals(){let h=this.points,v=h.length,S=this.options.ignoreHiddenPoint,D,L,z=0;for(D=0;D<v;D++)(L=h[D]).isValid()&&(!S||L.visible)&&(z+=L.y);for(D=0,this.total=z;D<v;D++)(L=h[D]).percentage=z>0&&(L.visible||!S)?L.y/z*100:0,L.total=z}}Jf.defaultOptions=Vl(eo.defaultOptions,{borderRadius:3,center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{connectorPadding:5,connectorShape:"crookedLine",crookDistance:void 0,distance:30,enabled:!0,formatter:function(){return this.isNull?void 0:this.name},softConnector:!0,x:0},fillColor:void 0,ignoreHiddenPoint:!0,inactiveOtherPoints:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,stickyTracking:!1,tooltip:{followPointer:!0},borderColor:"#ffffff",borderWidth:1,lineWidth:void 0,states:{hover:{brightness:.1}}}),__(Jf.prototype,{axisTypes:[],directTouch:!0,drawGraph:void 0,drawTracker:Ci.prototype.drawTracker,getCenter:Ac.getCenter,getSymbol:Qm,invertible:!1,isCartesian:!1,noSharedTooltip:!0,pointAttribs:Ci.prototype.pointAttribs,pointClass:Jm,requireSorting:!1,searchPoint:Qm,trackerGroups:["group","dataLabelsGroup"]}),Hn.registerSeriesType("pie",Jf);let{composed:Bp,noop:L0}=Ve,{distribute:R0}=qo,{series:Sd}=Hn,{arrayMax:y_,clamp:Eu,defined:Td,pick:z0,pushUnique:F0,relativeLength:v_}=Bi;(function(Y){let h={radialDistributionY:function(z,B){var U;return(((U=B.dataLabelPosition)==null?void 0:U.top)||0)+z.distributeBox.pos},radialDistributionX:function(z,B,U,X,te){let K=te.dataLabelPosition;return z.getX(U<((K==null?void 0:K.top)||0)+2||U>((K==null?void 0:K.bottom)||0)-2?X:U,B.half,B,te)},justify:function(z,B,U,X){var te;return X[0]+(z.half?-1:1)*(U+(((te=B.dataLabelPosition)==null?void 0:te.distance)||0))},alignToPlotEdges:function(z,B,U,X){let te=z.getBBox().width;return B?te+X:U-te-X},alignToConnectors:function(z,B,U,X){let te=0,K;return z.forEach(function(re){(K=re.dataLabel.getBBox().width)>te&&(te=K)}),B?te+X:U-te-X}};function v(z,B){let U=Math.PI/2,{start:X=0,end:te=0}=z.shapeArgs||{},K=z.angle||0;B>0&&X<U&&te>U&&K>U/2&&K<1.5*U&&(K=K<=U?Math.max(U/2,(X+U)/2):Math.min(1.5*U,(U+te)/2));let{center:re,options:ue}=this,ge=re[2]/2,ye=Math.cos(K),be=Math.sin(K),_e=re[0]+ye*ge,Fe=re[1]+be*ge,ze=Math.min((ue.slicedOffset||0)+(ue.borderWidth||0),B/5);return{natural:{x:_e+ye*B,y:Fe+be*B},computed:{},alignment:B<0?"center":z.half?"right":"left",connectorPosition:{angle:K,breakAt:{x:_e+ye*ze,y:Fe+be*ze},touchingSliceAt:{x:_e,y:Fe}},distance:B}}function S(){var Ot;let z=this,B=z.points,U=z.chart,X=U.plotWidth,te=U.plotHeight,K=U.plotLeft,re=Math.round(U.chartWidth/3),ue=z.center,ge=ue[2]/2,ye=ue[1],be=[[],[]],_e=[0,0,0,0],Fe=z.dataLabelPositioners,ze,ft,St,_t=0;z.visible&&((Ot=z.hasDataLabels)!=null&&Ot.call(z))&&(B.forEach(Pt=>{(Pt.dataLabels||[]).forEach(Ft=>{Ft.shortened&&(Ft.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),Ft.shortened=!1)})}),Sd.prototype.drawDataLabels.apply(z),B.forEach(Pt=>{(Pt.dataLabels||[]).forEach((Ft,di)=>{var Ei;let gi=ue[2]/2,Ai=Ft.options,ai=v_((Ai==null?void 0:Ai.distance)||0,gi);di===0&&be[Pt.half].push(Pt),!Td((Ei=Ai==null?void 0:Ai.style)==null?void 0:Ei.width)&&Ft.getBBox().width>re&&(Ft.css({width:Math.round(.7*re)+"px"}),Ft.shortened=!0),Ft.dataLabelPosition=this.getDataLabelPosition(Pt,ai),_t=Math.max(_t,ai)})}),be.forEach((Pt,Ft)=>{let di=Pt.length,gi=[],Ai,ai,Ei=0,Zi;di&&(z.sortByAngle(Pt,Ft-.5),_t>0&&(Ai=Math.max(0,ye-ge-_t),ai=Math.min(ye+ge+_t,U.plotHeight),Pt.forEach(kr=>{(kr.dataLabels||[]).forEach(Gi=>{var Vi;let gr=Gi.dataLabelPosition;gr&&gr.distance>0&&(gr.top=Math.max(0,ye-ge-gr.distance),gr.bottom=Math.min(ye+ge+gr.distance,U.plotHeight),Ei=Gi.getBBox().height||21,Gi.lineHeight=U.renderer.fontMetrics(Gi.text||Gi).h+2*Gi.padding,kr.distributeBox={target:(((Vi=Gi.dataLabelPosition)==null?void 0:Vi.natural.y)||0)-gr.top+Gi.lineHeight/2,size:Ei,rank:kr.y},gi.push(kr.distributeBox))})}),R0(gi,Zi=ai+Ei-Ai,Zi/5)),Pt.forEach(kr=>{(kr.dataLabels||[]).forEach(Gi=>{let gr=Gi.options||{},Vi=kr.distributeBox,Qi=Gi.dataLabelPosition,_r=(Qi==null?void 0:Qi.natural.y)||0,un=gr.connectorPadding||0,kn=Gi.lineHeight||21,zr=(kn-Gi.getBBox().height)/2,Gr=0,Xr=_r,Ms="inherit";if(Qi){if(gi&&Td(Vi)&&Qi.distance>0&&(Vi.pos===void 0?Ms="hidden":(St=Vi.size,Xr=Fe.radialDistributionY(kr,Gi))),gr.justify)Gr=Fe.justify(kr,Gi,ge,ue);else switch(gr.alignTo){case"connectors":Gr=Fe.alignToConnectors(Pt,Ft,X,K);break;case"plotEdges":Gr=Fe.alignToPlotEdges(Gi,Ft,X,K);break;default:Gr=Fe.radialDistributionX(z,kr,Xr-zr,_r,Gi)}if(Qi.attribs={visibility:Ms,align:Qi.alignment},Qi.posAttribs={x:Gr+(gr.x||0)+({left:un,right:-un}[Qi.alignment]||0),y:Xr+(gr.y||0)-kn/2},Qi.computed.x=Gr,Qi.computed.y=Xr-zr,z0(gr.crop,!0)){let ss;Gr-(ft=Gi.getBBox().width)<un&&Ft===1?(ss=Math.round(ft-Gr+un),_e[3]=Math.max(ss,_e[3])):Gr+ft>X-un&&Ft===0&&(ss=Math.round(Gr+ft-X+un),_e[1]=Math.max(ss,_e[1])),Xr-St/2<0?_e[0]=Math.max(Math.round(-Xr+St/2),_e[0]):Xr+St/2>te&&(_e[2]=Math.max(Math.round(Xr+St/2-te),_e[2])),Qi.sideOverflow=ss}}})}))}),(y_(_e)===0||this.verifyDataLabelOverflow(_e))&&(this.placeDataLabels(),this.points.forEach(Pt=>{(Pt.dataLabels||[]).forEach(Ft=>{var ai;let{connectorColor:di,connectorWidth:gi=1}=Ft.options||{},Ai=Ft.dataLabelPosition;if(gi){let Ei;ze=Ft.connector,Ai&&Ai.distance>0?(Ei=!ze,ze||(Ft.connector=ze=U.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+Pt.colorIndex+(Pt.className?" "+Pt.className:"")).add(z.dataLabelsGroup)),U.styledMode||ze.attr({"stroke-width":gi,stroke:di||Pt.color||"#666666"}),ze[Ei?"attr":"animate"]({d:Pt.getConnectorPath(Ft)}),ze.attr({visibility:(ai=Ai.attribs)==null?void 0:ai.visibility})):ze&&(Ft.connector=ze.destroy())}})})))}function D(){this.points.forEach(z=>{(z.dataLabels||[]).forEach(B=>{var X;let U=B.dataLabelPosition;U?(U.sideOverflow&&(B.css({width:Math.max(B.getBBox().width-U.sideOverflow,0)+"px",textOverflow:(((X=B.options)==null?void 0:X.style)||{}).textOverflow||"ellipsis"}),B.shortened=!0),B.attr(U.attribs),B[B.moved?"animate":"attr"](U.posAttribs),B.moved=!0):B&&B.attr({y:-9999})}),delete z.distributeBox},this)}function L(z){let B=this.center,U=this.options,X=U.center,te=U.minSize||80,K=te,re=U.size!==null;return!re&&(X[0]!==null?K=Math.max(B[2]-Math.max(z[1],z[3]),te):(K=Math.max(B[2]-z[1]-z[3],te),B[0]+=(z[3]-z[1])/2),X[1]!==null?K=Eu(K,te,B[2]-Math.max(z[0],z[2])):(K=Eu(K,te,B[2]-z[0]-z[2]),B[1]+=(z[0]-z[2])/2),K<B[2]?(B[2]=K,B[3]=Math.min(U.thickness?Math.max(0,K-2*U.thickness):Math.max(0,v_(U.innerSize||0,K)),K),this.translate(B),this.drawDataLabels&&this.drawDataLabels()):re=!0),re}Y.compose=function(z){if(Tn.compose(Sd),F0(Bp,"PieDataLabel")){let B=z.prototype;B.dataLabelPositioners=h,B.alignDataLabel=L0,B.drawDataLabels=S,B.getDataLabelPosition=v,B.placeDataLabels=D,B.verifyDataLabelOverflow=L}}})(rt||(rt={}));let B0=rt;(function(Y){Y.getCenterOfPoints=function(h){let v=h.reduce((S,D)=>(S.x+=D.x,S.y+=D.y,S),{x:0,y:0});return{x:v.x/h.length,y:v.y/h.length}},Y.getDistanceBetweenPoints=function(h,v){return Math.sqrt(Math.pow(v.x-h.x,2)+Math.pow(v.y-h.y,2))},Y.getAngleBetweenPoints=function(h,v){return Math.atan2(v.x-h.x,v.y-h.y)},Y.pointInPolygon=function({x:h,y:v},S){let D=S.length,L,z,B=!1;for(L=0,z=D-1;L<D;z=L++){let[U,X]=S[L],[te,K]=S[z];X>v!=K>v&&h<(te-U)*(v-X)/(K-X)+U&&(B=!B)}return B}})(ht||(ht={}));let{pointInPolygon:N0}=ht,{addEvent:V0,fireEvent:x_,objectEach:Qf,pick:U0}=Bi;function Md(Y){let h=Y.length,v=(te,K)=>!(K.x>=te.x+te.width||K.x+K.width<=te.x||K.y>=te.y+te.height||K.y+K.height<=te.y),S=(te,K)=>{for(let re of te)if(N0({x:re[0],y:re[1]},K))return!0;return!1},D,L,z,B,U,X=!1;for(let te=0;te<h;te++)(D=Y[te])&&(D.oldOpacity=D.opacity,D.newOpacity=1,D.absoluteBox=function(K){var re,ue;if(K&&(!K.alignAttr||K.placed)){let ge=K.box?0:K.padding||0,ye=K.alignAttr||{x:K.attr("x"),y:K.attr("y")},be=K.getBBox();return K.width=be.width,K.height=be.height,{x:ye.x+(((re=K.parentGroup)==null?void 0:re.translateX)||0)+ge,y:ye.y+(((ue=K.parentGroup)==null?void 0:ue.translateY)||0)+ge,width:(K.width||0)-2*ge,height:(K.height||0)-2*ge,polygon:be==null?void 0:be.polygon}}}(D));Y.sort((te,K)=>(K.labelrank||0)-(te.labelrank||0));for(let te=0;te<h;++te){B=(L=Y[te])&&L.absoluteBox;let K=B==null?void 0:B.polygon;for(let re=te+1;re<h;++re){U=(z=Y[re])&&z.absoluteBox;let ue=!1;if(B&&U&&L!==z&&L.newOpacity!==0&&z.newOpacity!==0&&L.visibility!=="hidden"&&z.visibility!=="hidden"){let ge=U.polygon;if(K&&ge&&K!==ge?S(K,ge)&&(ue=!0):v(B,U)&&(ue=!0),ue){let ye=L.labelrank<z.labelrank?L:z,be=ye.text;ye.newOpacity=0,be!=null&&be.element.querySelector("textPath")&&be.hide()}}}}for(let te of Y)b_(te,this)&&(X=!0);X&&x_(this,"afterHideAllOverlappingLabels")}function b_(Y,h){let v,S,D=!1;return Y&&(S=Y.newOpacity,Y.oldOpacity!==S&&(Y.hasClass("highcharts-data-label")?(Y[S?"removeClass":"addClass"]("highcharts-data-label-hidden"),v=function(){h.styledMode||Y.css({pointerEvents:S?"auto":"none"})},D=!0,Y[Y.isOld?"animate":"attr"]({opacity:S},void 0,v),x_(h,"afterHideOverlappingLabel")):Y.attr({opacity:S})),Y.isOld=!0),D}function cs(){var v;let Y=this,h=[];for(let S of Y.labelCollectors||[])h=h.concat(S());for(let S of Y.yAxis||[])S.stacking&&S.options.stackLabels&&!S.options.stackLabels.allowOverlap&&Qf(S.stacking.stacks,D=>{Qf(D,L=>{L.label&&h.push(L.label)})});for(let S of Y.series||[])if(S.visible&&((v=S.hasDataLabels)!=null&&v.call(S))){let D=L=>{for(let z of L)z.visible&&(z.dataLabels||[]).forEach(B=>{var X;let U=B.options||{};B.labelrank=U0(U.labelrank,z.labelrank,(X=z.shapeArgs)==null?void 0:X.height),U.allowOverlap??Number(U.distance)>0?(B.oldOpacity=B.opacity,B.newOpacity=1,b_(B,Y)):h.push(B)})};D(S.nodes||[]),D(S.points)}this.hideOverlappingLabels(h)}let Np={compose:function(Y){let h=Y.prototype;h.hideOverlappingLabels||(h.hideOverlappingLabels=Md,V0(Y,"render",cs))}},{defaultOptions:w_}=zn,{noop:Vp}=Ve,{addEvent:Up,extend:jp,isObject:eg,merge:S_,relativeLength:wh}=Bi,tg={radius:0,scope:"stack",where:void 0},$p=Vp,T_=Vp;function M_(Y,h,v,S,D={}){let L=$p(Y,h,v,S,D),{innerR:z=0,r:B=v,start:U=0,end:X=0}=D;if(D.open||!D.borderRadius)return L;let te=X-U,K=Math.sin(te/2),re=Math.max(Math.min(wh(D.borderRadius||0,B-z),(B-z)/2,B*K/(1+K)),0),ue=Math.min(re,te/Math.PI*2*z),ge=L.length-1;for(;ge--;)(function(ye,be,_e){let Fe,ze,ft,St=ye[be],_t=ye[be+1];if(_t[0]==="Z"&&(_t=ye[0]),(St[0]==="M"||St[0]==="L")&&_t[0]==="A"?(Fe=St,ze=_t,ft=!0):St[0]==="A"&&(_t[0]==="M"||_t[0]==="L")&&(Fe=_t,ze=St),Fe&&ze&&ze.params){let Ot=ze[1],Pt=ze[5],Ft=ze.params,{start:di,end:gi,cx:Ai,cy:ai}=Ft,Ei=Pt?Ot-_e:Ot+_e,Zi=Ei?Math.asin(_e/Ei):0,kr=Pt?Zi:-Zi,Gi=Math.cos(Zi)*Ei;ft?(Ft.start=di+kr,Fe[1]=Ai+Gi*Math.cos(di),Fe[2]=ai+Gi*Math.sin(di),ye.splice(be+1,0,["A",_e,_e,0,0,1,Ai+Ot*Math.cos(Ft.start),ai+Ot*Math.sin(Ft.start)])):(Ft.end=gi-kr,ze[6]=Ai+Ot*Math.cos(Ft.end),ze[7]=ai+Ot*Math.sin(Ft.end),ye.splice(be+1,0,["A",_e,_e,0,0,1,Ai+Gi*Math.cos(gi),ai+Gi*Math.sin(gi)])),ze[4]=Math.abs(Ft.end-Ft.start)<Math.PI?0:1}})(L,ge,ge>1?ue:re);return L}function ig(){var Y,h;if(this.options.borderRadius&&!(this.chart.is3d&&this.chart.is3d())){let{options:v,yAxis:S}=this,D=v.stacking==="percent",L=(h=(Y=w_.plotOptions)==null?void 0:Y[this.type])==null?void 0:h.borderRadius,z=Hp(v.borderRadius,eg(L)?L:{}),B=S.options.reversed;for(let U of this.points){let{shapeArgs:X}=U;if(U.shapeType==="roundedRect"&&X){let{width:te=0,height:K=0,y:re=0}=X,ue=re,ge=K;if(z.scope==="stack"&&U.stackTotal){let Fe=S.translate(D?100:U.stackTotal,!1,!0,!1,!0),ze=S.translate(v.threshold||0,!1,!0,!1,!0),ft=this.crispCol(0,Math.min(Fe,ze),0,Math.abs(Fe-ze));ue=ft.y,ge=ft.height}let ye=(U.negative?-1:1)*(B?-1:1)==-1,be=z.where;!be&&this.is("waterfall")&&Math.abs((U.yBottom||0)-(this.translatedThreshold||0))>this.borderWidth&&(be="all"),be||(be="end");let _e=Math.min(wh(z.radius,te),te/2,be==="all"?K/2:1/0)||0;be==="end"&&(ye&&(ue-=_e),ge+=_e),jp(X,{brBoxHeight:ge,brBoxY:ue,r:_e})}}}}function Hp(Y,h){return eg(Y)||(Y={radius:Y||0}),S_(tg,h,Y)}function rg(){let Y=Hp(this.options.borderRadius);for(let h of this.points){let v=h.shapeArgs;v&&(v.borderRadius=wh(Y.radius,(v.r||0)-(v.innerR||0)))}}function C_(Y,h,v,S,D={}){let L=T_(Y,h,v,S,D),{r:z=0,brBoxHeight:B=S,brBoxY:U=h}=D,X=h-U,te=U+B-(h+S),K=X-z>-.1?0:z,re=te-z>-.1?0:z,ue=Math.max(K&&X,0),ge=Math.max(re&&te,0),ye=[Y+K,h],be=[Y+v-K,h],_e=[Y+v,h+K],Fe=[Y+v,h+S-re],ze=[Y+v-re,h+S],ft=[Y+re,h+S],St=[Y,h+S-re],_t=[Y,h+K],Ot=(Pt,Ft)=>Math.sqrt(Math.pow(Pt,2)-Math.pow(Ft,2));if(ue){let Pt=Ot(K,K-ue);ye[0]-=Pt,be[0]+=Pt,_e[1]=_t[1]=h+K-ue}if(S<K-ue){let Pt=Ot(K,K-ue-S);_e[0]=Fe[0]=Y+v-K+Pt,ze[0]=Math.min(_e[0],ze[0]),ft[0]=Math.max(Fe[0],ft[0]),St[0]=_t[0]=Y+K-Pt,_e[1]=_t[1]=h+S}if(ge){let Pt=Ot(re,re-ge);ze[0]+=Pt,ft[0]-=Pt,Fe[1]=St[1]=h+S-re+ge}if(S<re-ge){let Pt=Ot(re,re-ge-S);_e[0]=Fe[0]=Y+v-re+Pt,be[0]=Math.min(_e[0],be[0]),ye[0]=Math.max(Fe[0],ye[0]),St[0]=_t[0]=Y+re-Pt,Fe[1]=St[1]=h}return L.length=0,L.push(["M",...ye],["L",...be],["A",K,K,0,0,1,..._e],["L",...Fe],["A",re,re,0,0,1,...ze],["L",...ft],["A",re,re,0,0,1,...St],["L",..._t],["A",K,K,0,0,1,...ye],["Z"]),L}let{diffObjects:E_,extend:A_,find:P_,merge:ng,pick:va,uniqueKey:D_}=Bi;(function(Y){function h(S,D){let L=S.condition;(L.callback||function(){return this.chartWidth<=va(L.maxWidth,Number.MAX_VALUE)&&this.chartHeight<=va(L.maxHeight,Number.MAX_VALUE)&&this.chartWidth>=va(L.minWidth,0)&&this.chartHeight>=va(L.minHeight,0)}).call(this)&&D.push(S._id)}function v(S,D){let L=this.options.responsive,z=this.currentResponsive,B=[],U;!D&&L&&L.rules&&L.rules.forEach(K=>{K._id===void 0&&(K._id=D_()),this.matchResponsiveRule(K,B)},this);let X=ng(...B.map(K=>P_((L||{}).rules||[],re=>re._id===K)).map(K=>K&&K.chartOptions));X.isResponsiveOptions=!0,B=B.toString()||void 0;let te=z&&z.ruleIds;B===te||(z&&(this.currentResponsive=void 0,this.updatingResponsive=!0,this.update(z.undoOptions,S,!0),this.updatingResponsive=!1),B?((U=E_(X,this.options,!0,this.collectionsWithUpdate)).isResponsiveOptions=!0,this.currentResponsive={ruleIds:B,mergedOptions:X,undoOptions:U},this.updatingResponsive||this.update(X,S,!0)):this.currentResponsive=void 0)}Y.compose=function(S){let D=S.prototype;return D.matchResponsiveRule||A_(D,{matchResponsiveRule:h,setResponsive:v}),S}})(tt||(tt={}));let j0=tt;Ve.AST=fi,Ve.Axis=Za,Ve.Chart=Fl,Ve.Color=Jr,Ve.DataLabel=Tn,Ve.DataTableCore=on,Ve.Fx=Ps,Ve.HTMLElement=sc,Ve.Legend=Pp,Ve.LegendSymbol=hd,Ve.OverlappingDataLabels=Ve.OverlappingDataLabels||Np,Ve.PlotLineOrBand=cu,Ve.Point=Jo,Ve.Pointer=_c,Ve.RendererRegistry=Wc,Ve.Series=eo,Ve.SeriesRegistry=Hn,Ve.StackItem=_a,Ve.SVGElement=_o,Ve.SVGRenderer=ei,Ve.Templating=Po,Ve.Tick=Zo,Ve.Time=$a,Ve.Tooltip=fu,Ve.animate=se.animate,Ve.animObject=se.animObject,Ve.chart=Fl.chart,Ve.color=Jr.parse,Ve.dateFormat=Po.dateFormat,Ve.defaultOptions=zn.defaultOptions,Ve.distribute=qo.distribute,Ve.format=Po.format,Ve.getDeferredAnimation=se.getDeferredAnimation,Ve.getOptions=zn.getOptions,Ve.numberFormat=Po.numberFormat,Ve.seriesType=Hn.seriesType,Ve.setAnimation=se.setAnimation,Ve.setOptions=zn.setOptions,Ve.stop=se.stop,Ve.time=zn.defaultTime,Ve.timers=Ps.timers,{compose:function(Y,h,v){let S=Y.types.pie;if(!h.symbolCustomAttribs.includes("borderRadius")){let D=v.prototype.symbols;Up(Y,"afterColumnTranslate",ig,{order:9}),Up(S,"afterTranslate",rg),h.symbolCustomAttribs.push("borderRadius","brBoxHeight","brBoxY"),$p=D.arc,T_=D.roundedRect,D.arc=M_,D.roundedRect=C_}},optionsToObject:Hp}.compose(Ve.Series,Ve.SVGElement,Ve.SVGRenderer),Br.compose(Ve.Series.types.column),Tn.compose(Ve.Series),hp.compose(Ve.Axis),sc.compose(Ve.SVGRenderer),Pp.compose(Ve.Chart),Mf.compose(Ve.Axis),Np.compose(Ve.Chart),B0.compose(Ve.Series.types.pie),cu.compose(Ve.Chart,Ve.Axis),_c.compose(Ve.Chart),j0.compose(Ve.Chart),ga.compose(Ve.Axis,Ve.Chart,Ve.Series),G.compose(Ve.Axis,Ve.Chart,Ve.Series),fu.compose(Ve.Pointer),Bi.extend(Ve,Bi);let $0=Ve;return Lt.default})())}(Ny)),Ny.exports}var UB=VB();const jB=t_(UB),$B=({vesselId:m,fromDate:g,toDate:a})=>{const[c,_]=Xe.useState([]);Xe.useEffect(()=>{m&&g&&a&&A()},[m,g,a]);const A=async()=>{try{const xe=await hA(m,g,a);_(xe)}catch(xe){console.error("Error fetching CII Graph Data:",xe)}},N=c.map(xe=>new Date(xe.yDate).toLocaleDateString("en-GB",{day:"2-digit",month:"short"})),r=c.map(xe=>xe.ciIref),W=c.map(xe=>xe.ciide-xe.ciicd),ie=c.map(xe=>xe.ciide-xe.ciicd),oe=c.map(xe=>xe.ciicd-xe.ciibc),he=c.map(xe=>xe.ciibc-xe.ciiab),ve=c.map(xe=>xe.ciiab),Se={chart:{type:"area",height:400,backgroundColor:"white",scrollablePlotArea:{minWidth:800,scrollPositionX:1}},title:{text:"IMO – Carbon Intensity Indicator (CII)",align:"left",style:{fontWeight:"bold",fontSize:"16px",color:"#303e67"}},xAxis:{categories:N,tickInterval:15,labels:{rotation:-45}},yAxis:{title:{text:"AER (gCO2/DWTxnm)"},min:Math.floor(c.reduce((xe,Ae)=>Math.min(xe,Ae.yxLow),1/0)*1e3)/1e3,max:Math.ceil(c.reduce((xe,Ae)=>Math.max(xe,Ae.yxUp),-1/0)*1e3)/1e3,tickInterval:.5,gridLineColor:"lightgray"},plotOptions:{area:{stacking:"normal",lineColor:"transparent",tooltip:{pointFormatter:()=>""},marker:{enabled:!1}}},series:[{name:"Red",data:W,type:"area",color:"red"},{name:"Orange",data:ie,type:"area",color:"orange"},{name:"Yellow",data:oe,type:"area",color:"yellow"},{name:"Light Green",data:he,type:"area",color:"lightgreen"},{name:"Dark Green",data:ve,type:"area",color:"green"},{name:"AER Trend",data:c.map(xe=>xe.ciicO2),type:"line",color:"blue",lineWidth:2,marker:{enabled:!1}},{name:"Reference Line",type:"line",data:r,dashStyle:"Dash",color:"black",lineWidth:2,marker:{enabled:!1}}],legend:{enabled:!1}};return hi.jsx(BB,{highcharts:jB,options:Se})};function HB(m){const[g,a]=Xe.useState(!0),[c,_]=Xe.useState(null),[A,N]=Xe.useState(!1),r=()=>{a(!1),N(!0)};return Xe.useEffect(()=>{if(!document){const he=new Error(`[ScriptLoadingError] document not defined when attempting to load ${m}`);_(he);return}const W=document.querySelector(`script[src="${m}"]`);if(W!=null&&W.dataset.loaded){r();return}const ie=W||document.createElement("script");W||(ie.src=m);const oe=()=>{ie.dataset.loaded="1",r()};ie.addEventListener("load",oe),ie.addEventListener("error",he=>{console.error("Failed to load script:",m,he);const ve=new Error(`[ScriptLoadingError] Failed to load script: ${m}`);_(ve)}),W||document.head.append(ie)},[]),{isLoading:g,error:c,isSuccess:A}}const GB=m=>m&&m.charts,VT=(m,g)=>{const{controls:a,toolbarItems:c,getChartEditor:_}=m;return g&&g.charts&&g.visualization&&g.visualization.ChartWrapper&&g.visualization.Dashboard&&(!a||g.visualization.ChartWrapper)&&(!_||g.visualization.ChartEditor)&&(!c||g.visualization.drawToolbar)},WB=m=>window.google;function qB(m){const{chartVersion:g="current",chartPackages:a=["corechart","controls"],chartLanguage:c="en",mapsApiKey:_}=m,[A,N]=Xe.useState(null),[r,W]=Xe.useState(null),[ie,oe]=Xe.useState(null),{isLoading:he,error:ve,isSuccess:Se}=HB(m.chartLoaderScriptUrl||"https://www.gstatic.com/charts/loader.js");return Xe.useEffect(()=>{if(!Se)return;const xe=WB();if(!GB(xe)){const Ae=new Error("[ScriptInitializationError] Script loaded but Google not attached to window.");W(Ae);return}if(VT(m,xe)){N(xe);return}xe.charts.load(g,{packages:a,language:c,mapsApiKey:_}),xe.charts.setOnLoadCallback(()=>{if(!VT(m,xe)){const Ae=new Error("[GoogleChartsInitializationError] Google Charts not ready after load callback.");console.error(Ae),oe(Ae);return}N(xe)})},[Se]),{error:ve||r||ie,isLoading:he,google:A}}const OM={legend_toggle:!1,options:{},legendToggle:!1,getChartWrapper:()=>{},spreadSheetQueryParameters:{headers:1,gid:1},rootProps:{},chartWrapperParams:{},chartLoaderScriptUrl:"https://www.gstatic.com/charts/loader.js"},YB=m=>{const{isReady:g,chartControls:a,filter:c}=m;return!g||!a||!(a!=null&&a.length)?null:Qt.createElement(Qt.Fragment,null,a.filter(_=>{let{controlProp:A,control:N}=_;return c?c({control:N,controlProp:A}):!0}).map(_=>{let{control:A}=_;return Qt.createElement("div",{key:A.getContainerId(),id:A.getContainerId()})}))};let UT=0;const LM=()=>(UT+=1,`reactgooglegraph-${UT}`),Du=class Du{};Li(Du,"initializeControls",g=>{for(let a=0;a<g.length;a+=1){const{controlType:c,options:_,controlWrapperParams:A}=g[a].controlProp;A&&"state"in A&&g[a].control.setState(A.state),g[a].control.setOptions(_),g[a].control.setControlType(c)}}),Li(Du,"listenToControlEvents",(g,a)=>{const{google:c}=a;return g.flatMap(_=>{const{control:A,controlProp:N}=_,{controlEvents:r=[]}=N;return r.map(W=>{const{callback:ie,eventName:oe}=W;return c.visualization.events.addListener(A,oe,function(){for(var he=arguments.length,ve=new Array(he),Se=0;Se<he;Se++)ve[Se]=arguments[Se];ie({chartWrapper:null,controlWrapper:A,props:a,google:c,eventArgs:ve})})})})}),Li(Du,"createControlId",g=>{let a;return typeof g>"u"?a=`googlechart-control-${LM()}`:a=g,a}),Li(Du,"createChartControls",g=>{const{controls:a,google:c}=g;return a?a.map((_,A)=>{const{controlID:N,controlType:r,options:W,controlWrapperParams:ie}=_,oe=Du.createControlId(N);return{controlProp:_,control:new c.visualization.ControlWrapper({containerId:oe,controlType:r,options:W,...ie})}}):null}),Li(Du,"addControls",g=>{const{chartWrapper:a,chartDashboard:c}=g,_=Du.createChartControls(g);return!_||!c||!a?null:(c.bind(_.map(A=>{let{control:N}=A;return N}),a),Du.initializeControls(_),_)});let a0=Du;const XB=m=>{const[g,a]=Xe.useState(null);return[Xe.useMemo(()=>!g||!m?null:m.map((_,A)=>{const N=g[A];return N?{controlProp:_,control:N}:void 0}).flatMap(_=>_?[_]:[]),[g,m]),a]},ZB=(m,g)=>{Xe.useEffect(()=>{const a=a0.listenToControlEvents(m??[],g);return()=>{a.forEach(c=>{g.google.visualization.events.removeListener(c)})}},[m,g])},KB=m=>{const[g,a]=XB(m.controls);return ZB(g??[],m),{addControls:_=>{const A=a0.addControls(_);a((A==null?void 0:A.map(N=>N.control))??null)},renderControl:_=>{const{chartWrapper:A,chartDashboard:N}=m;return Xe.createElement(YB,{...m,isReady:!!(A&&N),chartControls:g,filter:_})}}},JB=m=>{const g=Xe.useRef(null);return{chartId:(()=>{const{graphID:_,graph_id:A}=m,N=_||A;let r;return N?r=N:r=g.current||LM(),g.current=r,g.current})()}},QB=["#3366CC","#DC3912","#FF9900","#109618","#990099","#3B3EAC","#0099C6","#DD4477","#66AA00","#B82E2E","#316395","#994499","#22AA99","#AAAA11","#6633CC","#E67300","#8B0707","#329262","#5574A6","#3B3EAC"],e4=async function(m,g){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return new Promise((c,_)=>{const A=`${a.headers?`headers=${a.headers}`:"headers=0"}`,N=`${a.query?`&tq=${encodeURIComponent(a.query)}`:""}`,r=`${a.gid?`&gid=${a.gid}`:""}`,W=`${a.sheet?`&sheet=${a.sheet}`:""}`,ie=`${a.access_token?`&access_token=${a.access_token}`:""}`,oe=`${A}${r}${W}${N}${ie}`,he=`${g}/gviz/tq?${oe}`;new m.visualization.Query(he).send(Se=>{Se.isError()?_(`Error in query:  ${Se.getMessage()} ${Se.getDetailedMessage()}`):c(Se.getDataTable())})})},t4="#CCCCCC",Hl=class Hl{};Li(Hl,"grayOutHiddenColumnsLabel",(g,a)=>{const{googleChartWrapper:c,options:_}=g;if(!c){console.error("googleChartWrapper is not defined");return}const A=c.getDataTable();if(!A)return;const N=A.getNumberOfColumns();if(a.length>0===!1)return;const W=Array.from({length:N-1}).map((ie,oe)=>{const he=Hl.getColumnId(A,oe+1);return a.includes(he)?t4:_&&_.colors?_.colors[oe]:QB[oe]});c.setOptions({..._,colors:W}),c.draw()}),Li(Hl,"listenToLegendToggle",(g,a)=>{const[c,_]=a,{google:A,googleChartWrapper:N}=g;if(!N){console.error("googleChartWrapper is not defined");return}return A.visualization.events.addListener(N,"select",()=>{const W=N.getChart().getSelection(),ie=N.getDataTable();if(W.length===0||W[0].row!==null||!ie)return;const oe=W[0].column,he=Hl.getColumnId(ie,oe);c!=null&&c.includes(he)?_(ve=>[...ve.filter(Se=>Se!==he)]):_(ve=>[...ve,he])})}),Li(Hl,"draw",async g=>{const{data:a,diffdata:c,rows:_,columns:A,options:N,chartType:r,formatters:W,spreadSheetUrl:ie,spreadSheetQueryParameters:oe,googleChartDashboard:he,googleChartWrapper:ve,google:Se,hiddenColumns:xe,legendToggle:Ae,legend_toggle:Re}=g;if(!ve){console.error("draw was called with googleChartWrapper = null");return}let He,rt=null;if(c){const Ve=Se.visualization.arrayToDataTable(c.old),Tt=Se.visualization.arrayToDataTable(c.new);rt=Se.visualization[r].prototype.computeDiff(Ve,Tt)}a?a instanceof Se.visualization.DataTable?He=a:Array.isArray(a)?He=Se.visualization.arrayToDataTable(a):He=new Se.visualization.DataTable(a):_&&A?He=Se.visualization.arrayToDataTable([A,..._]):ie?He=await e4(Se,ie,oe):He=Se.visualization.arrayToDataTable([]);const ht=He.getNumberOfColumns(),tt=Array(ht).fill(0).map((Ve,Tt)=>{const qt=Hl.getColumnId(He,Tt);return xe.includes(qt)?{label:He.getColumnLabel(Tt),type:He.getColumnType(Tt),calc:()=>null}:Tt}),at=ve.getChart();ve.getChartType()==="Timeline"&&at&&at.clearChart(),ve.setChartType(r),ve.setOptions(N||{});const Lt=new Se.visualization.DataView(He);Lt.setColumns(tt),ve.setDataTable(Lt),ve.draw(),he&&he.draw(He),rt&&(ve.setDataTable(rt),ve.draw()),W&&(Hl.applyFormatters({dataTable:He,formatters:W,google:Se}),ve.setDataTable(He),ve.draw()),(Ae===!0||Re===!0)&&Hl.grayOutHiddenColumnsLabel(g,xe)}),Li(Hl,"getColumnId",(g,a)=>g.getColumnId(a)||g.getColumnLabel(a)),Li(Hl,"applyFormatters",g=>{let{dataTable:a,formatters:c,google:_}=g;for(let A of c)switch(A.type){case"ArrowFormat":{new _.visualization.ArrowFormat(A.options).format(a,A.column);return}case"BarFormat":{new _.visualization.BarFormat(A.options).format(a,A.column);return}case"ColorFormat":{const N=new _.visualization.ColorFormat(A.options),{ranges:r}=A;if(r)for(let W of r)N.addRange(...W);N.format(a,A.column);return}case"DateFormat":{new _.visualization.DateFormat(A.options).format(a,A.column);return}case"NumberFormat":{new _.visualization.NumberFormat(A.options).format(a,A.column);return}case"PatternFormat":{new _.visualization.PatternFormat(A.options).format(a,A.column);return}default:{console.warn(`Unknown formatter type: ${A.type}`);return}}});let Wg=Hl;const i4=m=>{const{google:g,googleChartWrapper:a,googleChartDashboard:c}=m,[_,A]=Xe.useState([]);Xe.useEffect(()=>{a&&Wg.draw({...m,hiddenColumns:_,googleChartWrapper:a,googleChartDashboard:c,google:g})},[_,m.data,m.rows,m.columns,m.options,m.chartLoaderScriptUrl,m.chartType,m.formatters,m.spreadSheetUrl,m.spreadSheetQueryParameters,m.legendToggle,m.legend_toggle]);const N=()=>{const{googleChartWrapper:ie}=m;ie&&ie.draw()},r=ie=>{const oe=[],{legendToggle:he,legend_toggle:ve}=m;if(Wg.draw({...m,hiddenColumns:_,googleChartWrapper:ie,googleChartDashboard:c,google:g}),window.addEventListener("resize",N),ve||he){const Se=Wg.listenToLegendToggle(m,[_,A]);Se&&oe.push(Se)}return oe},W=(ie,oe)=>{window.removeEventListener("resize",N),oe.forEach(he=>{g.visualization.events.removeListener(he)}),ie.getChartType()==="Timeline"&&ie.getChart()&&ie.getChart().clearChart()};Xe.useEffect(()=>{if(!a)return;const ie=r(a);return()=>{W(a,ie)}},[a,r,W])},r4=m=>{const{chartEvents:g,google:a,googleChartWrapper:c}=m;if(g){if(!c){console.warn("listenToEvents was called before chart wrapper ready.");return}return g.map(_=>{let{eventName:A,callback:N}=_;return a.visualization.events.addListener(c,A,function(){for(var r=arguments.length,W=new Array(r),ie=0;ie<r;ie++)W[ie]=arguments[ie];N({chartWrapper:c,props:m,google:a,eventArgs:W})})})}},n4=m=>{Xe.useEffect(()=>{if(!m.googleChartWrapper)return;const g=r4(m);return()=>{g==null||g.forEach(a=>{m.google.visualization.events.removeListener(a)})}},[m])},s4=m=>{const[g,a]=Xe.useState(null),[c,_]=Xe.useState(null),{addControls:A,renderControl:N}=KB({...m,chartDashboard:c,chartWrapper:g});n4({...m,googleChartWrapper:g});const{chartId:r}=JB(m),W=Xe.useRef(null),ie=Xe.useRef(null);Xe.useEffect(()=>{const{options:He,google:rt,chartType:ht,chartWrapperParams:tt,toolbarItems:at,getChartEditor:Lt,getChartWrapper:Ve,onLoad:Tt}=m,qt={chartType:ht,options:He,containerId:r,...tt},Me=new rt.visualization.ChartWrapper(qt);Me.setOptions(He||{}),Ve==null||Ve(Me,rt);const gt=new rt.visualization.Dashboard(W.current);at&&rt.visualization.drawToolbar(ie.current,at);let oi=null;Lt&&(oi=new rt.visualization.ChartEditor,Lt({chartEditor:oi,chartWrapper:Me,google:rt})),A({...m,chartDashboard:gt,chartWrapper:Me}),a(Me),_(gt),Tt==null||Tt(rt,{google:rt,chartWrapper:Me,chartEditor:oi,chartDashboard:gt})},[]),i4({...m,googleChartWrapper:g,googleChartDashboard:c});const oe=()=>{const{width:He,height:rt,options:ht,style:tt,className:at,rootProps:Lt,google:Ve}=m,Tt={height:rt||ht&&ht.height,width:He||ht&&ht.width,...tt};return Xe.createElement("div",{id:r,style:Tt,className:at,...Lt})},he=()=>m.toolbarItems?Xe.createElement("div",{ref:ie}):null,{width:ve,height:Se,options:xe,style:Ae}=m,Re={height:Se||xe&&xe.height,width:ve||xe&&xe.width,...Ae};return m.render?Xe.createElement("div",{ref:W,style:Re},Xe.createElement("div",{ref:ie,id:"toolbar"}),m.render({renderChart:oe,renderControl:N,renderToolbar:he})):Xe.createElement("div",{ref:W,style:Re},N(He=>{let{controlProp:rt}=He;return rt.controlPosition!=="bottom"}),oe(),N(He=>{let{controlProp:rt}=He;return rt.controlPosition==="bottom"}),he())},o4=Xe.createContext(OM),a4=m=>{let{children:g,value:a}=m;return Xe.createElement(o4.Provider,{value:a},g)},l4=m=>{const{google:g,isLoading:a,error:c}=qB(m);return a?m.loader??null:c?m.errorElement??null:g?Qt.createElement(s4,{google:g,...m}):null},c4=m=>{const g={...OM,...m};return Qt.createElement(a4,{value:g},Qt.createElement(l4,g))};var jT;(function(m){m.annotation="annotation",m.annotationText="annotationText",m.certainty="certainty",m.emphasis="emphasis",m.interval="interval",m.scope="scope",m.style="style",m.tooltip="tooltip",m.domain="domain"})(jT||(jT={}));const u4=({pieData:m,pieOptions:g={},isLimited:a=!1})=>{const c=a?m.slice(0,5):m;return hi.jsx(c4,{chartType:"PieChart",width:"100%",height:"200px",data:c,options:g})},pb=({title:m,isLoading:g,data:a,total:c,pieOptions:_={},isLimited:A=!1,isVertical:N=!1})=>{const r=[["Label","Value"],...a.map(W=>[W.label,Math.round(W.value)])];return hi.jsxs("div",{className:"p-2 border border-borderColor",children:[hi.jsx(_B,{variant:"h6",fontWeight:600,mb:1,children:m}),g?hi.jsx("div",{className:"flex justify-center items-center",children:hi.jsx(hB,{size:24})}):hi.jsxs("div",{className:`${N?"grid":"grid grid-cols-3"} items-start gap-2`,children:[hi.jsx("div",{className:`${N?"":"col-span-1"}`,children:hi.jsx(bB,{size:"small",children:hi.jsxs(CB,{children:[hi.jsxs(FT,{children:[hi.jsx(Sy,{className:"!font-bold",children:"Total"}),hi.jsx(Sy,{className:"!font-bold",align:"right",children:Math.round(c).toLocaleString()})]}),a.map((W,ie)=>hi.jsxs(FT,{children:[hi.jsx(Sy,{children:W.label}),hi.jsx(Sy,{align:"right",children:Math.round(W.value).toLocaleString()})]},ie))]})})}),hi.jsx("div",{className:`relative ${N?"":"col-span-2"}`,children:hi.jsx(u4,{pieData:r,pieOptions:_,isLimited:A})})]})]})},h4=({vesselId:m,fromDate:g,toDate:a})=>{const[c,_]=Xe.useState([]),[A,N]=Xe.useState(0),[r,W]=Xe.useState(!1);Xe.useEffect(()=>{m&&g&&a&&ie()},[m,g,a]);const ie=async()=>{try{W(!0);const xe=(await dA(m,g,a)).filter(Re=>Re.distanceCat==="DistCov"),Ae=xe.reduce((Re,He)=>{const rt=(He.distanceVal1||0)+(He.distanceVal2||0)+(He.distanceVal3||0);return Re+rt},0);_(xe),N(Ae)}catch(Se){console.error("Error fetching vessel distance:",Se)}finally{W(!1)}},he=[...c].sort((Se,xe)=>{const Ae=(Se.distanceVal1||0)+(Se.distanceVal2||0)+(Se.distanceVal3||0);return(xe.distanceVal1||0)+(xe.distanceVal2||0)+(xe.distanceVal3||0)-Ae}).map(Se=>({label:Se.distanceName,value:(Se.distanceVal1||0)+(Se.distanceVal2||0)+(Se.distanceVal3||0)})),ve={pieHole:.4,legend:{position:"right"},chartArea:{width:"70%",height:"75%"}};return hi.jsx(pb,{title:"Distance covered in Voyage Period [nm]",isLoading:r,data:he,total:A,pieOptions:ve,isLimited:!0})},d4=({isOpen:m,onClose:g,children:a,containerRef:c})=>{const _=Xe.useRef(null);return Xe.useEffect(()=>{function A(N){_.current&&!_.current.contains(N.target)&&(c!=null&&c.current)&&!c.current.contains(N.target)&&g()}return document.addEventListener("mousedown",A),()=>{document.removeEventListener("mousedown",A)}},[g,c]),hi.jsx("div",{className:`dropdown-menu absolute right-0 mt-2 ${m?"open":"hidden"}`,ref:_,children:a})},p4=({vesselId:m,fromDate:g,toDate:a})=>{const[c,_]=Xe.useState([]),[A,N]=Xe.useState(0),[r,W]=Xe.useState(!1);Xe.useEffect(()=>{m&&g&&a&&ie()},[m,g,a]);const ie=async()=>{try{W(!0);const Se=(await $T(m,g,a)).filter(Ae=>Ae.distanceCat==="CargoCov"),xe=Se.reduce((Ae,Re)=>{const He=(Re.distanceVal1||0)+(Re.distanceVal2||0)+(Re.distanceVal3||0);return Ae+He},0);_(Se),N(xe)}catch(ve){console.error("Error fetching vessel cargo delivered:",ve)}finally{W(!1)}},oe=c.map(ve=>({label:ve.distanceName,value:(ve.distanceVal1||0)+(ve.distanceVal2||0)+(ve.distanceVal3||0)})),he={pieHole:.4,legend:{position:"bottom"},chartArea:{width:"90%",height:"75%"}};return hi.jsx(pb,{title:"Cargo Delivered in Voyage Period [MT]",isLoading:r,data:oe,total:A,pieOptions:he,isLimited:!0,isVertical:!0})},f4=({vesselId:m,fromDate:g,toDate:a})=>{const[c,_]=Xe.useState([]),[A,N]=Xe.useState(0),[r,W]=Xe.useState(!1);Xe.useEffect(()=>{m&&g&&a&&ie()},[m,g,a]);const ie=async()=>{try{W(!0);const Se=await pA(m,g,a),xe=Se.reduce((Ae,Re)=>{const He=(Re.hfo||0)+(Re.vlsfo||0)+(Re.ulsfo||0)+(Re.mgo||0);return Ae+He},0);_(Se),N(xe)}catch(Se){console.error("Error fetching vessel FOC data:",Se)}finally{W(!1)}},he=[...c].sort((Se,xe)=>{const Ae=(Se.hfo||0)+(Se.vlsfo||0)+(Se.ulsfo||0)+(Se.mgo||0);return(xe.hfo||0)+(xe.vlsfo||0)+(xe.ulsfo||0)+(xe.mgo||0)-Ae}).map(Se=>({label:Se.machinary,value:(Se.hfo||0)+(Se.vlsfo||0)+(Se.ulsfo||0)+(Se.mgo||0)})),ve={pieHole:.4,legend:{position:"right"},chartArea:{width:"70%",height:"75%"}};return hi.jsx(pb,{title:"Machinery Consumption in Voyage Period",isLoading:r,data:he,total:A,pieOptions:ve,isLimited:!0})},y4=({title:m})=>{const g=Yw(Tt=>Tt.user.userDetails),a=sA(),{data:c,loading:_}=Yw(Tt=>Tt.fleet),[A,N]=Xe.useState(null),[r,W]=Xe.useState(""),[ie,oe]=Xe.useState(0),[he,ve]=Xe.useState(0),[Se,xe]=Xe.useState(!1),Ae=Xe.useRef(null),[Re,He]=Xe.useState({startDate:"",endDate:"",vesselType:"",vesselNames:[]}),rt=[{id:0,label:"Emission"},{id:1,label:"EU ETS"},{id:2,label:"Fuel EU"}],ht=(Tt,qt)=>{oe(Tt),console.log("Selected Tab:",qt.label)};Xe.useEffect(()=>{Re.startDate&&Re.endDate&&a(oA({userId:g.accountID,startDate:Re.startDate,endDate:Re.endDate}))},[a,g.accountID,Re.startDate,Re.endDate]);const tt=Tt=>{He(Tt)},at=Xe.useMemo(()=>c.filter(Tt=>{const qt=Re.vesselType?Tt.vesselType===Re.vesselType:!0,Me=Re.vesselNames.length>0?Re.vesselNames.includes(Tt.name):!0;return qt&&Me}),[c,Re]),Lt=Xe.useMemo(()=>at.filter(Tt=>Tt.name.toLowerCase().includes(r.toLowerCase())),[at,r]);Xe.useEffect(()=>{Lt.length>0?N(Lt[0].vesselID):N(null)},[Lt]);const Ve=Xe.useMemo(()=>Lt.find(Tt=>Tt.vesselID===A),[Lt,A]);return Xe.useEffect(()=>{(async()=>{if(A&&Re.startDate&&Re.endDate)try{const Me=(await $T(A,Re.startDate,Re.endDate)).reduce((gt,oi)=>gt+oi.distanceVal1,0);ve(Math.round(Me))}catch(qt){console.error("Error fetching cargo delivered:",qt),ve(0)}})()},[A,Re.startDate,Re.endDate]),Xe.useEffect(()=>{document.title=m},[m]),hi.jsxs("div",{className:"grid px-4 gap-4",children:[hi.jsx(aA,{status:_}),hi.jsxs("div",{className:"grid md:grid-cols-5",children:[hi.jsx("h1",{className:"text-lg font-semibold",children:"Fleet"}),Ve?hi.jsxs("div",{className:"flex items-center",children:[hi.jsx("span",{className:"vr-line"}),hi.jsx("h1",{className:"text-lg font-semibold",children:Ve.name})]}):hi.jsx("div",{className:"col-span-1"}),hi.jsx("div",{className:"col-span-2"}),hi.jsxs("div",{className:"relative justify-self-end",ref:Ae,children:[hi.jsx("button",{className:"btn bg-green-500 text-white px-2 py-1 font-semibold",onClick:()=>xe(!Se),children:hi.jsx(uA,{size:18})}),hi.jsx(d4,{isOpen:Se,onClose:()=>xe(!1),containerRef:Ae,children:hi.jsx(n3,{fleetData:c,onFilterChange:tt})})]})]}),hi.jsxs("div",{className:"grid md:grid-cols-5 border border-borderColor rounded shadow min-h-screen overflow-hidden",children:[hi.jsxs("div",{className:"p-4 col-span-1",children:[hi.jsx("input",{type:"text",placeholder:"Search Vessel...",value:r,onChange:Tt=>W(Tt.target.value),className:"mb-4 w-full p-2 border border-borderColor rounded"}),Lt.length>0?hi.jsx("ul",{className:"space-y-2",children:Lt.map(Tt=>hi.jsxs("li",{onClick:()=>N(Tt.vesselID),className:`p-3 flex justify-between items-center bg-white shadow-sm cursor-pointer hover:bg-gray-100 ${A===Tt.vesselID?"border-green-500 border":""}`,children:[hi.jsxs("div",{children:[hi.jsx("div",{className:"font-semibold text-sm ",children:Tt.name}),hi.jsxs("div",{className:"text-[12px] text-gray-600",children:[Tt.vesselID," / ",Tt.vesselType]})]}),hi.jsx(o3,{status:Tt.cii})]},Tt.vesselID))}):!_&&hi.jsx("p",{children:"No search data found."})]}),hi.jsx("div",{className:" col-span-3 bg-white border-borderColor border-x p-4",children:Lt.length>0&&Ve?hi.jsxs(hi.Fragment,{children:[hi.jsx("div",{className:"flex justify-between mb-4",children:hi.jsxs("h2",{className:"text-[14px] font-semibold",children:["Voyage for the selected period : ",Re.startDate," - ",Re.endDate]})}),hi.jsx("div",{className:"relative p-2 border border-borderColor",children:hi.jsx(h3,{vesselId:String(Ve.vesselID),fromDate:Re.startDate,toDate:Re.endDate})}),hi.jsxs("div",{className:"mt-4",children:[hi.jsx(LB,{tabs:rt,activeTab:ie,onTabChange:ht}),hi.jsx("div",{style:{marginTop:"20px"},children:ie===0&&hi.jsxs("div",{children:[hi.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[hi.jsx(Ng,{label:"Total Distance",count:Ve.totDistance}),hi.jsx(Ng,{label:"CO2",count:Ve.aerT2W}),hi.jsx(Ng,{label:"CO2e",count:Ve.aerW2W}),hi.jsx(Ng,{label:"EEOI",count:Ve.eeoi}),hi.jsx(Ng,{label:"Total Cargo",count:he})]}),hi.jsx("div",{className:"mt-5 relative p-2 border border-borderColor",children:hi.jsx($B,{vesselId:String(Ve.vesselID),fromDate:Re.startDate,toDate:Re.endDate})}),hi.jsx("div",{className:"mt-5",children:hi.jsx(h4,{vesselId:String(Ve.vesselID),fromDate:Re.startDate,toDate:Re.endDate})})," ",hi.jsx("div",{className:"mt-5",children:hi.jsx(f4,{vesselId:String(Ve.vesselID),fromDate:Re.startDate,toDate:Re.endDate})})]})})]})]}):hi.jsx("p",{children:"No vessels found."})}),hi.jsx("div",{className:"col-span-1",children:Lt.length>0&&Ve&&hi.jsx("div",{children:ie===0&&hi.jsx("div",{className:"mt-0",children:hi.jsx(p4,{vesselId:String(Ve.vesselID),fromDate:Re.startDate,toDate:Re.endDate})})})})]})]})};export{y4 as FleetOverview,y4 as default};
